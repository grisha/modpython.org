From python_eager at yahoo.com  Mon Jan  2 04:09:41 2006
From: python_eager at yahoo.com (python eager)
Date: Mon Jan  2 04:10:24 2006
Subject: [mod_python] for loop doubt
Message-ID: <20060102090941.47173.qmail@web36404.mail.mud.yahoo.com>

Hi
     in python server pages i am using for loop . but it will not work properly. The code will be as follow as :
  <td> Date of Birth </td>
                     <td>
                       
                            <select name="dob">
                                        <% for n in range(31):   %>
                                              res.write("<option>" + <%=n%> + "</option>"):
                                        
                            </select>                     
                                            
                    </td>
   
  But it will not work. What is the error , i cannt found the error. Would any one have solution please send mail me. Thank You Very much. and also Happy New Year
   
  Note : very urget for me .reply wanted
   
  regards
  Python_Eager
   

		
---------------------------------
Yahoo! for Good - Make a difference this year. 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20060102/ca0892b2/attachment.html
From nlv11281 at natlab.research.philips.com  Mon Jan  2 05:20:32 2006
From: nlv11281 at natlab.research.philips.com (Mike Looijmans)
Date: Mon Jan  2 05:20:41 2006
Subject: [mod_python] for loop doubt
In-Reply-To: <20060102090941.47173.qmail@web36404.mail.mud.yahoo.com>
References: <20060102090941.47173.qmail@web36404.mail.mud.yahoo.com>
Message-ID: <43B8FE70.2030808@natlab.research.philips.com>

There are several errors, so I'm not surprised that you cannot find it:

- "res" is probably a misspelled "req"
- Indentation is completely wrong
- ending %> after for is probably not what you meant.
- using req.write(...) to output a PSP script?
- invalid colon at end of that line

You probably meant the following:
....
	<select name="dob">
	<%
	for n in range(31):
		req.write("<option>%s</option>" % n)
	# end for
	%>
	</select>
....

This cryptic thing should do the same, but quicker and without indentation:

<%= [("<option>%s</option>" % n) for n in range(31)] %>

--
Mike Looijmans
Philips Natlab / Topic Automation


python eager wrote:
> Hi
>    in python server pages i am using for loop . but it will not work 
> properly. The code will be as follow as :
> <td> Date of Birth </td>
>                      <td>
>                       
>                             <select name="dob">
>                                         <% for n in range(31):   %>
>                                               res.write("<option>" + 
> <%=n%> + "</option>"):
>                                        
>                             </select>                    
>                                     nbsp;       
>                     </td>
>  
> But it will not work. What is the error , i cannt found the error. Would 
> any one have solution please send mail me. Thank You Very much. and also 
> Happy New Year
>  
> Note : very urget for me .reply wanted
>  
> regards
> Python_Eager
>  
> 
> ------------------------------------------------------------------------
> Yahoo! for Good - Make a difference this year. 
> <http://us.rd.yahoo.com/mail_us/taglines/charity/*http://brand.yahoo.com/cybergivingweek2005/> 
> 
> 
> 
> ------------------------------------------------------------------------
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python

From johnbmudd at gmail.com  Mon Jan  2 08:45:24 2006
From: johnbmudd at gmail.com (John Mudd)
Date: Mon Jan  2 08:45:28 2006
Subject: [mod_python] pychecker with mod_python?
Message-ID: <8cbda4900601020545v376d26al4935feac793c33c1@mail.gmail.com>

Any advice on using pychecker with mod_python?  I tried the example
below.  next I tried importing pychecker.checker, after setting
sys.stdout=sys.stderr in checker.py.  But that just gave me this msg.

    warning: couldn't find real module for
    class <type 'pyexpat.xmlparser'>
    (module name: pyexpat)



$ pychecker index.py
Processing index...
  ImportError: No module named _apache

Warnings...

index:1: NOT PROCESSED UNABLE TO IMPORT
$

From johnbmudd at gmail.com  Mon Jan  2 10:54:16 2006
From: johnbmudd at gmail.com (John Mudd)
Date: Mon Jan  2 10:54:21 2006
Subject: [mod_python] Re: pychecker with mod_python?
In-Reply-To: <8cbda4900601020545v376d26al4935feac793c33c1@mail.gmail.com>
References: <8cbda4900601020545v376d26al4935feac793c33c1@mail.gmail.com>
Message-ID: <8cbda4900601020754p41647fc5v184dc165610c9e93@mail.gmail.com>

Just wrap your mod_python specific imports as shown here.  Pychecker
will complain about missing globals but at least it will check the
remaining code.

try:
    from mod_python                 import apache
except:
    pass


On 1/2/06, John Mudd <johnbmudd@gmail.com> wrote:
> Any advice on using pychecker with mod_python?  I tried the example
> below.  next I tried importing pychecker.checker, after setting
> sys.stdout=sys.stderr in checker.py.  But that just gave me this msg.
>
>     warning: couldn't find real module for
>     class <type 'pyexpat.xmlparser'>
>     (module name: pyexpat)
>
>
>
> $ pychecker index.py
> Processing index...
>   ImportError: No module named _apache
>
> Warnings...
>
> index:1: NOT PROCESSED UNABLE TO IMPORT
> $
>

From blais at furius.ca  Mon Jan  2 13:23:43 2006
From: blais at furius.ca (Martin Blais)
Date: Mon Jan  2 13:23:46 2006
Subject: [mod_python] child process XXXX still did not exit,
	sending a SIGTERM
Message-ID: <8393fff0601021023h414383e1w1884b5ca9f5fd25f@mail.gmail.com>

Hi

I'm getting messages like this in my apache2 log when I stop it after
running requests to a mod_python-based web app:

==> /var/log/apache2/error_log <==
[Mon Jan 02 13:04:12 2006] [warn] child process 21806 still did not
exit, sending a SIGTERM
[Mon Jan 02 13:04:12 2006] [warn] child process 21768 still did not
exit, sending a SIGTERM
[Mon Jan 02 13:04:12 2006] [warn] child process 21792 still did not
exit, sending a SIGTERM
[Mon Jan 02 13:04:14 2006] [warn] child process 21806 still did not
exit, sending a SIGTERM
[Mon Jan 02 13:04:14 2006] [warn] child process 21768 still did not
exit, sending a SIGTERM
[Mon Jan 02 13:04:14 2006] [warn] child process 21792 still did not
exit, sending a SIGTERM
[Mon Jan 02 13:04:16 2006] [warn] child process 21806 still did not
exit, sending a SIGTERM
[Mon Jan 02 13:04:16 2006] [warn] child process 21768 still did not
exit, sending a SIGTERM
[Mon Jan 02 13:04:16 2006] [warn] child process 21792 still did not
exit, sending a SIGTERM
[Mon Jan 02 13:04:18 2006] [error] child process 21806 still did not
exit, sending a SIGKILL
[Mon Jan 02 13:04:18 2006] [error] child process 21768 still did not
exit, sending a SIGKILL
[Mon Jan 02 13:04:18 2006] [error] child process 21792 still did not
exit, sending a SIGKILL
[Mon Jan 02 13:04:19 2006] [info] removed PID file
/var/run/apache2.pid (pid=21754)
[Mon Jan 02 13:04:19 2006] [notice] caught SIGTERM, shutting down

I've been tracking the problem, and on exit, the cleanup function (in
Python) that I registered with the mod_python server does get called,
and exits.

I saw somewhere that recompiling expat, and then all the rest (in my
case, python-2.4.2, apache2, mod_python-3.1.4, psycopg2) might fix the
issue (it would be due to a library incompatibility).  I did this, and
the problem still occurs.  I also tried using mod_python-3.2.5b and
the problem persists.  This is all running on Linux (Gentoo).

Any clue on how to debug this issue further?  I'm currently trying to
run gdb on a non-daemon apache2, or trying to attach to a running
child.  The problem is a bit tricky to fix, since it does not happen
always -- but always happens at least after I run a lot of requests
e.g. my automated test suite for my web app.

Any hints would be appreciated.

cheers,

From blais at furius.ca  Mon Jan  2 15:10:38 2006
From: blais at furius.ca (Martin Blais)
Date: Mon Jan  2 15:10:40 2006
Subject: [mod_python] Re: child process XXXX still did not exit,
	sending a SIGTERM
In-Reply-To: <8393fff0601021023h414383e1w1884b5ca9f5fd25f@mail.gmail.com>
References: <8393fff0601021023h414383e1w1884b5ca9f5fd25f@mail.gmail.com>
Message-ID: <8393fff0601021210t1a83e837ga636177d3eef27f4@mail.gmail.com>

Before someone asks, I did not get seg faults in my log, so that's not
the problem.

On closer inspection though, I do have a few SSL error messages like these:

[Mon Jan 02 15:07:30 2006] [info] (70014)End of file found: SSL
handshake interrupted by system [Hint: Stop button pressed in
browser?!]
[Mon Jan 02 15:07:30 2006] [info] Connection to child 0 closed with
abortive shutdown(server furius.dyndns.biz:443, client 127.0.0.1)
[Mon Jan 02 15:07:31 2006] [info] Connection to child 9 established
(server furius.dyndns.biz:443, client 127.0.0.1)
[Mon Jan 02 15:07:31 2006] [info] Seeding PRNG with 136 bytes of entropy

... the number of which does not match the number of zombie children
(does not mean that it's not the problem though).

Any information/tips welcome.




On 1/2/06, Martin Blais <blais@furius.ca> wrote:
> Hi
>
> I'm getting messages like this in my apache2 log when I stop it after
> running requests to a mod_python-based web app:
>
> ==> /var/log/apache2/error_log <==
> [Mon Jan 02 13:04:12 2006] [warn] child process 21806 still did not
> exit, sending a SIGTERM
> [Mon Jan 02 13:04:12 2006] [warn] child process 21768 still did not
> exit, sending a SIGTERM
> [Mon Jan 02 13:04:12 2006] [warn] child process 21792 still did not
> exit, sending a SIGTERM
> [Mon Jan 02 13:04:14 2006] [warn] child process 21806 still did not
> exit, sending a SIGTERM
> [Mon Jan 02 13:04:14 2006] [warn] child process 21768 still did not
> exit, sending a SIGTERM
> [Mon Jan 02 13:04:14 2006] [warn] child process 21792 still did not
> exit, sending a SIGTERM
> [Mon Jan 02 13:04:16 2006] [warn] child process 21806 still did not
> exit, sending a SIGTERM
> [Mon Jan 02 13:04:16 2006] [warn] child process 21768 still did not
> exit, sending a SIGTERM
> [Mon Jan 02 13:04:16 2006] [warn] child process 21792 still did not
> exit, sending a SIGTERM
> [Mon Jan 02 13:04:18 2006] [error] child process 21806 still did not
> exit, sending a SIGKILL
> [Mon Jan 02 13:04:18 2006] [error] child process 21768 still did not
> exit, sending a SIGKILL
> [Mon Jan 02 13:04:18 2006] [error] child process 21792 still did not
> exit, sending a SIGKILL
> [Mon Jan 02 13:04:19 2006] [info] removed PID file
> /var/run/apache2.pid (pid=21754)
> [Mon Jan 02 13:04:19 2006] [notice] caught SIGTERM, shutting down
>
> I've been tracking the problem, and on exit, the cleanup function (in
> Python) that I registered with the mod_python server does get called,
> and exits.
>
> I saw somewhere that recompiling expat, and then all the rest (in my
> case, python-2.4.2, apache2, mod_python-3.1.4, psycopg2) might fix the
> issue (it would be due to a library incompatibility).  I did this, and
> the problem still occurs.  I also tried using mod_python-3.2.5b and
> the problem persists.  This is all running on Linux (Gentoo).
>
> Any clue on how to debug this issue further?  I'm currently trying to
> run gdb on a non-daemon apache2, or trying to attach to a running
> child.  The problem is a bit tricky to fix, since it does not happen
> always -- but always happens at least after I run a lot of requests
> e.g. my automated test suite for my web app.
>
> Any hints would be appreciated.
>
> cheers,
>

From blais at furius.ca  Mon Jan  2 15:17:13 2006
From: blais at furius.ca (Martin Blais)
Date: Mon Jan  2 15:17:16 2006
Subject: [mod_python] Re: child process XXXX still did not exit,
	sending a SIGTERM
In-Reply-To: <8393fff0601021210t1a83e837ga636177d3eef27f4@mail.gmail.com>
References: <8393fff0601021023h414383e1w1884b5ca9f5fd25f@mail.gmail.com>
	<8393fff0601021210t1a83e837ga636177d3eef27f4@mail.gmail.com>
Message-ID: <8393fff0601021217y197eea8dyeebe7638ce395c9b@mail.gmail.com>

On 1/2/06, Martin Blais <blais@furius.ca> wrote:
> Before someone asks, I did not get seg faults in my log, so that's not
> the problem.
>
> On closer inspection though, I do have a few SSL error messages like these:
>
> [Mon Jan 02 15:07:30 2006] [info] (70014)End of file found: SSL
> handshake interrupted by system [Hint: Stop button pressed in
> browser?!]
> [Mon Jan 02 15:07:30 2006] [info] Connection to child 0 closed with
> abortive shutdown(server furius.dyndns.biz:443, client 127.0.0.1)
> [Mon Jan 02 15:07:31 2006] [info] Connection to child 9 established
> (server furius.dyndns.biz:443, client 127.0.0.1)
> [Mon Jan 02 15:07:31 2006] [info] Seeding PRNG with 136 bytes of entropy
>
> ... the number of which does not match the number of zombie children
> (does not mean that it's not the problem though).
>
> Any information/tips welcome.

It's not the SSL errors, I just reproduced the zombie child error
without getting the SSL errors (it's my automated test code that
somehow creates the SSL problems, fiddling a lot with the browser does
not cause SSL errors, but will result in children not wanting to die).


>
>
> On 1/2/06, Martin Blais <blais@furius.ca> wrote:
> > Hi
> >
> > I'm getting messages like this in my apache2 log when I stop it after
> > running requests to a mod_python-based web app:
> >
> > ==> /var/log/apache2/error_log <==
> > [Mon Jan 02 13:04:12 2006] [warn] child process 21806 still did not
> > exit, sending a SIGTERM
> > [Mon Jan 02 13:04:12 2006] [warn] child process 21768 still did not
> > exit, sending a SIGTERM
> > [Mon Jan 02 13:04:12 2006] [warn] child process 21792 still did not
> > exit, sending a SIGTERM
> > [Mon Jan 02 13:04:14 2006] [warn] child process 21806 still did not
> > exit, sending a SIGTERM
> > [Mon Jan 02 13:04:14 2006] [warn] child process 21768 still did not
> > exit, sending a SIGTERM
> > [Mon Jan 02 13:04:14 2006] [warn] child process 21792 still did not
> > exit, sending a SIGTERM
> > [Mon Jan 02 13:04:16 2006] [warn] child process 21806 still did not
> > exit, sending a SIGTERM
> > [Mon Jan 02 13:04:16 2006] [warn] child process 21768 still did not
> > exit, sending a SIGTERM
> > [Mon Jan 02 13:04:16 2006] [warn] child process 21792 still did not
> > exit, sending a SIGTERM
> > [Mon Jan 02 13:04:18 2006] [error] child process 21806 still did not
> > exit, sending a SIGKILL
> > [Mon Jan 02 13:04:18 2006] [error] child process 21768 still did not
> > exit, sending a SIGKILL
> > [Mon Jan 02 13:04:18 2006] [error] child process 21792 still did not
> > exit, sending a SIGKILL
> > [Mon Jan 02 13:04:19 2006] [info] removed PID file
> > /var/run/apache2.pid (pid=21754)
> > [Mon Jan 02 13:04:19 2006] [notice] caught SIGTERM, shutting down
> >
> > I've been tracking the problem, and on exit, the cleanup function (in
> > Python) that I registered with the mod_python server does get called,
> > and exits.
> >
> > I saw somewhere that recompiling expat, and then all the rest (in my
> > case, python-2.4.2, apache2, mod_python-3.1.4, psycopg2) might fix the
> > issue (it would be due to a library incompatibility).  I did this, and
> > the problem still occurs.  I also tried using mod_python-3.2.5b and
> > the problem persists.  This is all running on Linux (Gentoo).
> >
> > Any clue on how to debug this issue further?  I'm currently trying to
> > run gdb on a non-daemon apache2, or trying to attach to a running
> > child.  The problem is a bit tricky to fix, since it does not happen
> > always -- but always happens at least after I run a lot of requests
> > e.g. my automated test suite for my web app.
> >
> > Any hints would be appreciated.
> >
> > cheers,
> >
>

From grahamd at dscpl.com.au  Mon Jan  2 16:12:58 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Mon Jan  2 16:13:03 2006
Subject: [mod_python] for loop doubt
Message-ID: <1136236378.12883@dscpl.user.openhosting.com>

Using req.write() in PSP partly defeats the purpose of using it in the
first place. Ie., to avoid having to fiddle with req object directly. For
another example of how to do for loops see:

<html>
  <head>
    <title>
      3-2.py
    </title>
  </head>
  <body>
    <table >
<%
for key in req.subprocess_env.keys():
      # indent
%>
      <tr>
        <td><%=key%></td>
        <td><%=req.subprocess_env[key]%></td>
      </tr>
<%
# end for
%>
    </table>
    <p>test</p>
  </body>
</html>


Indenting levels is critical with PSP. It defaults internally to using a tab
width for laying out its own auto generated code. If you use a different
indent level you have to be quite careful to include the comment hints
so it knows what indent level you are using, eg., "# indent" in the above.

See:

  http://www.modpython.org/pipermail/mod_python/2005-May/018102.html

for further information about indenting issues and further loop examples.

Graham



Mike Looijmans wrote ..
> There are several errors, so I'm not surprised that you cannot find it:
> 
> - "res" is probably a misspelled "req"
> - Indentation is completely wrong
> - ending %> after for is probably not what you meant.
> - using req.write(...) to output a PSP script?
> - invalid colon at end of that line
> 
> You probably meant the following:
> ....
> 	<select name="dob">
> 	<%
> 	for n in range(31):
> 		req.write("<option>%s</option>" % n)
> 	# end for
> 	%>
> 	</select>
> ....
> 
> This cryptic thing should do the same, but quicker and without indentation:
> 
> <%= [("<option>%s</option>" % n) for n in range(31)] %>
> 
> --
> Mike Looijmans
> Philips Natlab / Topic Automation
> 
> 
> python eager wrote:
> > Hi
> >    in python server pages i am using for loop . but it will not work
> > properly. The code will be as follow as :
> > <td> Date of Birth </td>
> >                      <td>
> >                       
> >                             <select name="dob">
> >                                         <% for n in range(31):   %>
> >                                               res.write("<option>" +
> > <%=n%> + "</option>"):
> >                                        
> >                             </select>                    
> >                                     nbsp;       
> >                     </td>
> >  
> > But it will not work. What is the error , i cannt found the error. Would
> > any one have solution please send mail me. Thank You Very much. and also
> > Happy New Year
> >  
> > Note : very urget for me .reply wanted
> >  
> > regards
> > Python_Eager
> >  
> > 
> > ------------------------------------------------------------------------
> > Yahoo! for Good - Make a difference this year. 
> > <http://us.rd.yahoo.com/mail_us/taglines/charity/*http://brand.yahoo.com/cybergivingweek2005/>
> > 
> > 
> > 
> > ------------------------------------------------------------------------
> > 
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://mailman.modpython.org/mailman/listinfo/mod_python
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
From grahamd at dscpl.com.au  Mon Jan  2 16:20:39 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Mon Jan  2 16:20:52 2006
Subject: [mod_python] Re: child process XXXX still did not exit,
	sending a SIGTERM
Message-ID: <1136236839.17348@dscpl.user.openhosting.com>

Instead of using "apachectl restart", try using "apachectl graceful" to see
if that makes any difference.

You may also want to adjust GracefulShutdownTimeout for this case to
only allow a certain time for child processes to shutdown.

  http://httpd.apache.org/docs/2.2/mod/mpm_common.html#gracefulshutdowntimeout

By fiddling with this, you may be able to see if given time that the child
processes do actually shutdown, or whether they actually hang. If they
hang, then you may be able to attach using gdb to the child process and
work out where it is hanging.

It may just be a case that with Python loaded it takes longer to shutdown
than Apache expects it to and so it abruptly kills it. I haven't been able
to find any directive for specifying a shutdown timeout for "restart" which
it waits before it kills the child processes.

Graham

Martin Blais wrote ..
> On 1/2/06, Martin Blais <blais@furius.ca> wrote:
> > Before someone asks, I did not get seg faults in my log, so that's not
> > the problem.
> >
> > On closer inspection though, I do have a few SSL error messages like
> these:
> >
> > [Mon Jan 02 15:07:30 2006] [info] (70014)End of file found: SSL
> > handshake interrupted by system [Hint: Stop button pressed in
> > browser?!]
> > [Mon Jan 02 15:07:30 2006] [info] Connection to child 0 closed with
> > abortive shutdown(server furius.dyndns.biz:443, client 127.0.0.1)
> > [Mon Jan 02 15:07:31 2006] [info] Connection to child 9 established
> > (server furius.dyndns.biz:443, client 127.0.0.1)
> > [Mon Jan 02 15:07:31 2006] [info] Seeding PRNG with 136 bytes of entropy
> >
> > ... the number of which does not match the number of zombie children
> > (does not mean that it's not the problem though).
> >
> > Any information/tips welcome.
> 
> It's not the SSL errors, I just reproduced the zombie child error
> without getting the SSL errors (it's my automated test code that
> somehow creates the SSL problems, fiddling a lot with the browser does
> not cause SSL errors, but will result in children not wanting to die).
> 
> 
> >
> >
> > On 1/2/06, Martin Blais <blais@furius.ca> wrote:
> > > Hi
> > >
> > > I'm getting messages like this in my apache2 log when I stop it after
> > > running requests to a mod_python-based web app:
> > >
> > > ==> /var/log/apache2/error_log <==
> > > [Mon Jan 02 13:04:12 2006] [warn] child process 21806 still did not
> > > exit, sending a SIGTERM
> > > [Mon Jan 02 13:04:12 2006] [warn] child process 21768 still did not
> > > exit, sending a SIGTERM
> > > [Mon Jan 02 13:04:12 2006] [warn] child process 21792 still did not
> > > exit, sending a SIGTERM
> > > [Mon Jan 02 13:04:14 2006] [warn] child process 21806 still did not
> > > exit, sending a SIGTERM
> > > [Mon Jan 02 13:04:14 2006] [warn] child process 21768 still did not
> > > exit, sending a SIGTERM
> > > [Mon Jan 02 13:04:14 2006] [warn] child process 21792 still did not
> > > exit, sending a SIGTERM
> > > [Mon Jan 02 13:04:16 2006] [warn] child process 21806 still did not
> > > exit, sending a SIGTERM
> > > [Mon Jan 02 13:04:16 2006] [warn] child process 21768 still did not
> > > exit, sending a SIGTERM
> > > [Mon Jan 02 13:04:16 2006] [warn] child process 21792 still did not
> > > exit, sending a SIGTERM
> > > [Mon Jan 02 13:04:18 2006] [error] child process 21806 still did not
> > > exit, sending a SIGKILL
> > > [Mon Jan 02 13:04:18 2006] [error] child process 21768 still did not
> > > exit, sending a SIGKILL
> > > [Mon Jan 02 13:04:18 2006] [error] child process 21792 still did not
> > > exit, sending a SIGKILL
> > > [Mon Jan 02 13:04:19 2006] [info] removed PID file
> > > /var/run/apache2.pid (pid=21754)
> > > [Mon Jan 02 13:04:19 2006] [notice] caught SIGTERM, shutting down
> > >
> > > I've been tracking the problem, and on exit, the cleanup function (in
> > > Python) that I registered with the mod_python server does get called,
> > > and exits.
> > >
> > > I saw somewhere that recompiling expat, and then all the rest (in my
> > > case, python-2.4.2, apache2, mod_python-3.1.4, psycopg2) might fix
> the
> > > issue (it would be due to a library incompatibility).  I did this,
> and
> > > the problem still occurs.  I also tried using mod_python-3.2.5b and
> > > the problem persists.  This is all running on Linux (Gentoo).
> > >
> > > Any clue on how to debug this issue further?  I'm currently trying
> to
> > > run gdb on a non-daemon apache2, or trying to attach to a running
> > > child.  The problem is a bit tricky to fix, since it does not happen
> > > always -- but always happens at least after I run a lot of requests
> > > e.g. my automated test suite for my web app.
> > >
> > > Any hints would be appreciated.
> > >
> > > cheers,
> > >
> >
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
From blais at furius.ca  Mon Jan  2 16:28:55 2006
From: blais at furius.ca (Martin Blais)
Date: Mon Jan  2 16:28:59 2006
Subject: [mod_python] Re: child process XXXX still did not exit,
	sending a SIGTERM
In-Reply-To: <1136236839.17348@dscpl.user.openhosting.com>
References: <1136236839.17348@dscpl.user.openhosting.com>
Message-ID: <8393fff0601021328q59b54271qa84520c32ed88955@mail.gmail.com>

Thanks Graham.

Looks like a new directive only available in 2.2...   will update now.

More info:  I'm starting to hack into mod_python to find out what's
happening there, and python_finalize() is not called for the offending
processes.





On 1/2/06, Graham Dumpleton <grahamd@dscpl.com.au> wrote:
> Instead of using "apachectl restart", try using "apachectl graceful" to see
> if that makes any difference.
>
> You may also want to adjust GracefulShutdownTimeout for this case to
> only allow a certain time for child processes to shutdown.
>
>   http://httpd.apache.org/docs/2.2/mod/mpm_common.html#gracefulshutdowntimeout
>
> By fiddling with this, you may be able to see if given time that the child
> processes do actually shutdown, or whether they actually hang. If they
> hang, then you may be able to attach using gdb to the child process and
> work out where it is hanging.
>
> It may just be a case that with Python loaded it takes longer to shutdown
> than Apache expects it to and so it abruptly kills it. I haven't been able
> to find any directive for specifying a shutdown timeout for "restart" which
> it waits before it kills the child processes.
>
> Graham
>
> Martin Blais wrote ..
> > On 1/2/06, Martin Blais <blais@furius.ca> wrote:
> > > Before someone asks, I did not get seg faults in my log, so that's not
> > > the problem.
> > >
> > > On closer inspection though, I do have a few SSL error messages like
> > these:
> > >
> > > [Mon Jan 02 15:07:30 2006] [info] (70014)End of file found: SSL
> > > handshake interrupted by system [Hint: Stop button pressed in
> > > browser?!]
> > > [Mon Jan 02 15:07:30 2006] [info] Connection to child 0 closed with
> > > abortive shutdown(server furius.dyndns.biz:443, client 127.0.0.1)
> > > [Mon Jan 02 15:07:31 2006] [info] Connection to child 9 established
> > > (server furius.dyndns.biz:443, client 127.0.0.1)
> > > [Mon Jan 02 15:07:31 2006] [info] Seeding PRNG with 136 bytes of entropy
> > >
> > > ... the number of which does not match the number of zombie children
> > > (does not mean that it's not the problem though).
> > >
> > > Any information/tips welcome.
> >
> > It's not the SSL errors, I just reproduced the zombie child error
> > without getting the SSL errors (it's my automated test code that
> > somehow creates the SSL problems, fiddling a lot with the browser does
> > not cause SSL errors, but will result in children not wanting to die).
> >
> >
> > >
> > >
> > > On 1/2/06, Martin Blais <blais@furius.ca> wrote:
> > > > Hi
> > > >
> > > > I'm getting messages like this in my apache2 log when I stop it after
> > > > running requests to a mod_python-based web app:
> > > >
> > > > ==> /var/log/apache2/error_log <==
> > > > [Mon Jan 02 13:04:12 2006] [warn] child process 21806 still did not
> > > > exit, sending a SIGTERM
> > > > [Mon Jan 02 13:04:12 2006] [warn] child process 21768 still did not
> > > > exit, sending a SIGTERM
> > > > [Mon Jan 02 13:04:12 2006] [warn] child process 21792 still did not
> > > > exit, sending a SIGTERM
> > > > [Mon Jan 02 13:04:14 2006] [warn] child process 21806 still did not
> > > > exit, sending a SIGTERM
> > > > [Mon Jan 02 13:04:14 2006] [warn] child process 21768 still did not
> > > > exit, sending a SIGTERM
> > > > [Mon Jan 02 13:04:14 2006] [warn] child process 21792 still did not
> > > > exit, sending a SIGTERM
> > > > [Mon Jan 02 13:04:16 2006] [warn] child process 21806 still did not
> > > > exit, sending a SIGTERM
> > > > [Mon Jan 02 13:04:16 2006] [warn] child process 21768 still did not
> > > > exit, sending a SIGTERM
> > > > [Mon Jan 02 13:04:16 2006] [warn] child process 21792 still did not
> > > > exit, sending a SIGTERM
> > > > [Mon Jan 02 13:04:18 2006] [error] child process 21806 still did not
> > > > exit, sending a SIGKILL
> > > > [Mon Jan 02 13:04:18 2006] [error] child process 21768 still did not
> > > > exit, sending a SIGKILL
> > > > [Mon Jan 02 13:04:18 2006] [error] child process 21792 still did not
> > > > exit, sending a SIGKILL
> > > > [Mon Jan 02 13:04:19 2006] [info] removed PID file
> > > > /var/run/apache2.pid (pid=21754)
> > > > [Mon Jan 02 13:04:19 2006] [notice] caught SIGTERM, shutting down
> > > >
> > > > I've been tracking the problem, and on exit, the cleanup function (in
> > > > Python) that I registered with the mod_python server does get called,
> > > > and exits.
> > > >
> > > > I saw somewhere that recompiling expat, and then all the rest (in my
> > > > case, python-2.4.2, apache2, mod_python-3.1.4, psycopg2) might fix
> > the
> > > > issue (it would be due to a library incompatibility).  I did this,
> > and
> > > > the problem still occurs.  I also tried using mod_python-3.2.5b and
> > > > the problem persists.  This is all running on Linux (Gentoo).
> > > >
> > > > Any clue on how to debug this issue further?  I'm currently trying
> > to
> > > > run gdb on a non-daemon apache2, or trying to attach to a running
> > > > child.  The problem is a bit tricky to fix, since it does not happen
> > > > always -- but always happens at least after I run a lot of requests
> > > > e.g. my automated test suite for my web app.
> > > >
> > > > Any hints would be appreciated.
> > > >
> > > > cheers,
> > > >
> > >
> >
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://mailman.modpython.org/mailman/listinfo/mod_python
>

From blais at furius.ca  Mon Jan  2 17:31:29 2006
From: blais at furius.ca (Martin Blais)
Date: Mon Jan  2 17:31:32 2006
Subject: [mod_python] Re: child process XXXX still did not exit,
	sending a SIGTERM
In-Reply-To: <8393fff0601021328q59b54271qa84520c32ed88955@mail.gmail.com>
References: <1136236839.17348@dscpl.user.openhosting.com>
	<8393fff0601021328q59b54271qa84520c32ed88955@mail.gmail.com>
Message-ID: <8393fff0601021431m233bd99dka68a7fec655efff1@mail.gmail.com>

I think there is a deadlock somewhere, I start apache2 in debug mode
and eventually manage to interrupt in this stack frame (where it
remains stuck, cont'inuing does not help):


    #0  0xb7b9b054 in __pthread_sigsuspend () from /lib/libpthread.so.0
    #1  0xb7b9ae98 in __pthread_wait_for_restart_signal () from
/lib/libpthread.so.0
    #2  0xb7b9bd6b in sem_wait@@GLIBC_2.1 () from /lib/libpthread.so.0
    #3  0xb79d943f in PyThread_acquire_lock () from
/usr/lib/apache2/modules/mod_python.so
    #4  0xb79d262e in PyThreadState_Delete () from
/usr/lib/apache2/modules/mod_python.so
    #5  0xb79d21e8 in PyInterpreterState_Delete () from
/usr/lib/apache2/modules/mod_python.so
    #6  0xb79d3318 in Py_Finalize () from /usr/lib/apache2/modules/mod_python.so
    #7  0xb794eeea in python_finalize (data=0x0) at mod_python.c:1823
    #8  0xb7c7a6ed in apr_pool_cleanup_run () from /usr/lib/libapr-0.so.0
    #9  0xb7c79f8d in apr_pool_destroy () from /usr/lib/libapr-0.so.0
    #10 0x0806860c in ap_graceful_stop_signalled ()
    #11 0xb7b9def5 in __pthread_sighandler () from /lib/libpthread.so.0
    #12 <signal handler called>
    #13 0xb7b240b8 in poll () from /lib/libc.so.6
    #14 0xb7c7b2af in apr_poll () from /usr/lib/libapr-0.so.0
    #15 0x08068952 in ap_graceful_stop_signalled ()
    #16 0x08067f0d in ap_graceful_stop_signalled ()
    #17 0x08067954 in ap_mpm_run ()
    #18 0x0806f02f in main ()


So I've added traces to python_finalize():


static apr_status_t python_finalize(void *data)
{
    interpreterdata *idata;
    pid_t pid = getpid();

    idata = get_interpreter(NULL, NULL);

    fprintf(stderr, "python_finalize %d\n", pid);
    fflush(stderr);

    if (idata) {

      fprintf(stderr, "  python_finalize %d - before \n", pid);
      fflush(stderr);

      Py_Finalize();

      fprintf(stderr, "  python_finalize %d - after\n", pid);
      fflush(stderr);

#ifdef WITH_THREAD
        PyEval_ReleaseLock();
#endif

      fprintf(stderr, "  python_finalize %d - after\n", pid);
      fflush(stderr);
    }


    return APR_SUCCESS;

}



And I get this log, which confirms that indeed the child never leaves
Py_Finalize().



==> /var/log/apache2/error_log <==
[Mon Jan 02 17:29:17 2006] [error] python_cleanup 29677 - interp
[Mon Jan 02 17:29:17 2006] [error] python_cleanup 29678 - interp
[Mon Jan 02 17:29:17 2006] [error] python_cleanup 29677 - before
python_finalize 29680
  python_finalize 29680 - before
  python_finalize 29680 - after
  python_finalize 29680 - after
python_finalize 29681
  python_finalize 29681 - before
  python_finalize 29681 - after
  python_finalize 29681 - after
python_finalize 29686
  python_finalize 29686 - before
  python_finalize 29686 - after
  python_finalize 29686 - after
[Mon Jan 02 17:29:17 2006] [error] python_cleanup 29678 - before
python_finalize 29679
  python_finalize 29679 - before
  python_finalize 29679 - after
  python_finalize 29679 - after
python_finalize 29688
  python_finalize 29688 - before
  python_finalize 29688 - after
  python_finalize 29688 - after
dracohandler.py: child 29677 finishing childExit
[Mon Jan 02 17:29:18 2006] [error] python_cleanup 29677 - after
[Mon Jan 02 17:29:18 2006] [error] python_cleanup 29677 - released
python_finalize 29677
  python_finalize 29677 - before
dracohandler.py: child 29678 finishing childExit
[Mon Jan 02 17:29:18 2006] [error] python_cleanup 29678 - after
[Mon Jan 02 17:29:18 2006] [error] python_cleanup 29678 - released
python_finalize 29678
  python_finalize 29678 - before
  python_finalize 29677 - after
  python_finalize 29677 - after
python_finalize 29687
  python_finalize 29687 - before
  python_finalize 29687 - after
  python_finalize 29687 - after
[Mon Jan 02 17:29:21 2006] [warn] child process 29678 still did not
exit, sending a SIGTERM
[Mon Jan 02 17:29:23 2006] [warn] child process 29678 still did not
exit, sending a SIGTERM
[Mon Jan 02 17:29:25 2006] [warn] child process 29678 still did not
exit, sending a SIGTERM
[Mon Jan 02 17:29:27 2006] [error] child process 29678 still did not
exit, sending a SIGKILL
[Mon Jan 02 17:29:28 2006] [info] removed PID file
/var/run/apache2.pid (pid=29673)
[Mon Jan 02 17:29:28 2006] [notice] caught SIGTERM, shutting down







On 1/2/06, Martin Blais <blais@furius.ca> wrote:
> Thanks Graham.
>
> Looks like a new directive only available in 2.2...   will update now.
>
> More info:  I'm starting to hack into mod_python to find out what's
> happening there, and python_finalize() is not called for the offending
> processes.
>
>
>
>
>
> On 1/2/06, Graham Dumpleton <grahamd@dscpl.com.au> wrote:
> > Instead of using "apachectl restart", try using "apachectl graceful" to see
> > if that makes any difference.
> >
> > You may also want to adjust GracefulShutdownTimeout for this case to
> > only allow a certain time for child processes to shutdown.
> >
> >   http://httpd.apache.org/docs/2.2/mod/mpm_common.html#gracefulshutdowntimeout
> >
> > By fiddling with this, you may be able to see if given time that the child
> > processes do actually shutdown, or whether they actually hang. If they
> > hang, then you may be able to attach using gdb to the child process and
> > work out where it is hanging.
> >
> > It may just be a case that with Python loaded it takes longer to shutdown
> > than Apache expects it to and so it abruptly kills it. I haven't been able
> > to find any directive for specifying a shutdown timeout for "restart" which
> > it waits before it kills the child processes.
> >
> > Graham
> >
> > Martin Blais wrote ..
> > > On 1/2/06, Martin Blais <blais@furius.ca> wrote:
> > > > Before someone asks, I did not get seg faults in my log, so that's not
> > > > the problem.
> > > >
> > > > On closer inspection though, I do have a few SSL error messages like
> > > these:
> > > >
> > > > [Mon Jan 02 15:07:30 2006] [info] (70014)End of file found: SSL
> > > > handshake interrupted by system [Hint: Stop button pressed in
> > > > browser?!]
> > > > [Mon Jan 02 15:07:30 2006] [info] Connection to child 0 closed with
> > > > abortive shutdown(server furius.dyndns.biz:443, client 127.0.0.1)
> > > > [Mon Jan 02 15:07:31 2006] [info] Connection to child 9 established
> > > > (server furius.dyndns.biz:443, client 127.0.0.1)
> > > > [Mon Jan 02 15:07:31 2006] [info] Seeding PRNG with 136 bytes of entropy
> > > >
> > > > ... the number of which does not match the number of zombie children
> > > > (does not mean that it's not the problem though).
> > > >
> > > > Any information/tips welcome.
> > >
> > > It's not the SSL errors, I just reproduced the zombie child error
> > > without getting the SSL errors (it's my automated test code that
> > > somehow creates the SSL problems, fiddling a lot with the browser does
> > > not cause SSL errors, but will result in children not wanting to die).
> > >
> > >
> > > >
> > > >
> > > > On 1/2/06, Martin Blais <blais@furius.ca> wrote:
> > > > > Hi
> > > > >
> > > > > I'm getting messages like this in my apache2 log when I stop it after
> > > > > running requests to a mod_python-based web app:
> > > > >
> > > > > ==> /var/log/apache2/error_log <==
> > > > > [Mon Jan 02 13:04:12 2006] [warn] child process 21806 still did not
> > > > > exit, sending a SIGTERM
> > > > > [Mon Jan 02 13:04:12 2006] [warn] child process 21768 still did not
> > > > > exit, sending a SIGTERM
> > > > > [Mon Jan 02 13:04:12 2006] [warn] child process 21792 still did not
> > > > > exit, sending a SIGTERM
> > > > > [Mon Jan 02 13:04:14 2006] [warn] child process 21806 still did not
> > > > > exit, sending a SIGTERM
> > > > > [Mon Jan 02 13:04:14 2006] [warn] child process 21768 still did not
> > > > > exit, sending a SIGTERM
> > > > > [Mon Jan 02 13:04:14 2006] [warn] child process 21792 still did not
> > > > > exit, sending a SIGTERM
> > > > > [Mon Jan 02 13:04:16 2006] [warn] child process 21806 still did not
> > > > > exit, sending a SIGTERM
> > > > > [Mon Jan 02 13:04:16 2006] [warn] child process 21768 still did not
> > > > > exit, sending a SIGTERM
> > > > > [Mon Jan 02 13:04:16 2006] [warn] child process 21792 still did not
> > > > > exit, sending a SIGTERM
> > > > > [Mon Jan 02 13:04:18 2006] [error] child process 21806 still did not
> > > > > exit, sending a SIGKILL
> > > > > [Mon Jan 02 13:04:18 2006] [error] child process 21768 still did not
> > > > > exit, sending a SIGKILL
> > > > > [Mon Jan 02 13:04:18 2006] [error] child process 21792 still did not
> > > > > exit, sending a SIGKILL
> > > > > [Mon Jan 02 13:04:19 2006] [info] removed PID file
> > > > > /var/run/apache2.pid (pid=21754)
> > > > > [Mon Jan 02 13:04:19 2006] [notice] caught SIGTERM, shutting down
> > > > >
> > > > > I've been tracking the problem, and on exit, the cleanup function (in
> > > > > Python) that I registered with the mod_python server does get called,
> > > > > and exits.
> > > > >
> > > > > I saw somewhere that recompiling expat, and then all the rest (in my
> > > > > case, python-2.4.2, apache2, mod_python-3.1.4, psycopg2) might fix
> > > the
> > > > > issue (it would be due to a library incompatibility).  I did this,
> > > and
> > > > > the problem still occurs.  I also tried using mod_python-3.2.5b and
> > > > > the problem persists.  This is all running on Linux (Gentoo).
> > > > >
> > > > > Any clue on how to debug this issue further?  I'm currently trying
> > > to
> > > > > run gdb on a non-daemon apache2, or trying to attach to a running
> > > > > child.  The problem is a bit tricky to fix, since it does not happen
> > > > > always -- but always happens at least after I run a lot of requests
> > > > > e.g. my automated test suite for my web app.
> > > > >
> > > > > Any hints would be appreciated.
> > > > >
> > > > > cheers,
> > > > >
> > > >
> > >
> > > _______________________________________________
> > > Mod_python mailing list
> > > Mod_python@modpython.org
> > > http://mailman.modpython.org/mailman/listinfo/mod_python
> >
>

From grahamd at dscpl.com.au  Mon Jan  2 18:15:38 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Mon Jan  2 18:15:48 2006
Subject: [mod_python] Re: child process XXXX still did not exit,
	sending a SIGTERM
Message-ID: <1136243738.21310@dscpl.user.openhosting.com>

Maybe mod_python has to be a bit more orderly as far as how it ends
interpreters. Ie., maybe it should end each interpreter it has created
explicitly using Py_EndInterpreter().

This though may be dependent on first getting changes described in:

  http://issues.apache.org/jira/browse/MODPYTHON-77

incorporated. Specifically, the attachment:

  http://issues.apache.org/jira/secure/attachment/12320489/grahamd_20051105.tar.gz

Actually, this change may in itself fix the issue as it saves away the
first interpreter state as "main_interpreter" and that will then be the
interpreter state used to do the cleanup. This isn't the case at the
moment.

Can you apply that patch and see if things improve?

Beyond that, as I suggest, maybe it needs to be more orderly and
end each interpreter besides "main_interpreter" and then finally call
Py_Finalize().

Graham


Martin Blais wrote ..
> I think there is a deadlock somewhere, I start apache2 in debug mode
> and eventually manage to interrupt in this stack frame (where it
> remains stuck, cont'inuing does not help):
> 
> 
>     #0  0xb7b9b054 in __pthread_sigsuspend () from /lib/libpthread.so.0
>     #1  0xb7b9ae98 in __pthread_wait_for_restart_signal () from
> /lib/libpthread.so.0
>     #2  0xb7b9bd6b in sem_wait@@GLIBC_2.1 () from /lib/libpthread.so.0
>     #3  0xb79d943f in PyThread_acquire_lock () from
> /usr/lib/apache2/modules/mod_python.so
>     #4  0xb79d262e in PyThreadState_Delete () from
> /usr/lib/apache2/modules/mod_python.so
>     #5  0xb79d21e8 in PyInterpreterState_Delete () from
> /usr/lib/apache2/modules/mod_python.so
>     #6  0xb79d3318 in Py_Finalize () from /usr/lib/apache2/modules/mod_python.so
>     #7  0xb794eeea in python_finalize (data=0x0) at mod_python.c:1823
>     #8  0xb7c7a6ed in apr_pool_cleanup_run () from /usr/lib/libapr-0.so.0
>     #9  0xb7c79f8d in apr_pool_destroy () from /usr/lib/libapr-0.so.0
>     #10 0x0806860c in ap_graceful_stop_signalled ()
>     #11 0xb7b9def5 in __pthread_sighandler () from /lib/libpthread.so.0
>     #12 <signal handler called>
>     #13 0xb7b240b8 in poll () from /lib/libc.so.6
>     #14 0xb7c7b2af in apr_poll () from /usr/lib/libapr-0.so.0
>     #15 0x08068952 in ap_graceful_stop_signalled ()
>     #16 0x08067f0d in ap_graceful_stop_signalled ()
>     #17 0x08067954 in ap_mpm_run ()
>     #18 0x0806f02f in main ()
> 
> 
> So I've added traces to python_finalize():
> 
> 
> static apr_status_t python_finalize(void *data)
> {
>     interpreterdata *idata;
>     pid_t pid = getpid();
> 
>     idata = get_interpreter(NULL, NULL);
> 
>     fprintf(stderr, "python_finalize %d\n", pid);
>     fflush(stderr);
> 
>     if (idata) {
> 
>       fprintf(stderr, "  python_finalize %d - before \n", pid);
>       fflush(stderr);
> 
>       Py_Finalize();
> 
>       fprintf(stderr, "  python_finalize %d - after\n", pid);
>       fflush(stderr);
> 
> #ifdef WITH_THREAD
>         PyEval_ReleaseLock();
> #endif
> 
>       fprintf(stderr, "  python_finalize %d - after\n", pid);
>       fflush(stderr);
>     }
> 
> 
>     return APR_SUCCESS;
> 
> }
> 
> 
> 
> And I get this log, which confirms that indeed the child never leaves
> Py_Finalize().
> 
> 
> 
> ==> /var/log/apache2/error_log <==
> [Mon Jan 02 17:29:17 2006] [error] python_cleanup 29677 - interp
> [Mon Jan 02 17:29:17 2006] [error] python_cleanup 29678 - interp
> [Mon Jan 02 17:29:17 2006] [error] python_cleanup 29677 - before
> python_finalize 29680
>   python_finalize 29680 - before
>   python_finalize 29680 - after
>   python_finalize 29680 - after
> python_finalize 29681
>   python_finalize 29681 - before
>   python_finalize 29681 - after
>   python_finalize 29681 - after
> python_finalize 29686
>   python_finalize 29686 - before
>   python_finalize 29686 - after
>   python_finalize 29686 - after
> [Mon Jan 02 17:29:17 2006] [error] python_cleanup 29678 - before
> python_finalize 29679
>   python_finalize 29679 - before
>   python_finalize 29679 - after
>   python_finalize 29679 - after
> python_finalize 29688
>   python_finalize 29688 - before
>   python_finalize 29688 - after
>   python_finalize 29688 - after
> dracohandler.py: child 29677 finishing childExit
> [Mon Jan 02 17:29:18 2006] [error] python_cleanup 29677 - after
> [Mon Jan 02 17:29:18 2006] [error] python_cleanup 29677 - released
> python_finalize 29677
>   python_finalize 29677 - before
> dracohandler.py: child 29678 finishing childExit
> [Mon Jan 02 17:29:18 2006] [error] python_cleanup 29678 - after
> [Mon Jan 02 17:29:18 2006] [error] python_cleanup 29678 - released
> python_finalize 29678
>   python_finalize 29678 - before
>   python_finalize 29677 - after
>   python_finalize 29677 - after
> python_finalize 29687
>   python_finalize 29687 - before
>   python_finalize 29687 - after
>   python_finalize 29687 - after
> [Mon Jan 02 17:29:21 2006] [warn] child process 29678 still did not
> exit, sending a SIGTERM
> [Mon Jan 02 17:29:23 2006] [warn] child process 29678 still did not
> exit, sending a SIGTERM
> [Mon Jan 02 17:29:25 2006] [warn] child process 29678 still did not
> exit, sending a SIGTERM
> [Mon Jan 02 17:29:27 2006] [error] child process 29678 still did not
> exit, sending a SIGKILL
> [Mon Jan 02 17:29:28 2006] [info] removed PID file
> /var/run/apache2.pid (pid=29673)
> [Mon Jan 02 17:29:28 2006] [notice] caught SIGTERM, shutting down
> 
> 
> 
> 
> 
> 
> 
> On 1/2/06, Martin Blais <blais@furius.ca> wrote:
> > Thanks Graham.
> >
> > Looks like a new directive only available in 2.2...   will update now.
> >
> > More info:  I'm starting to hack into mod_python to find out what's
> > happening there, and python_finalize() is not called for the offending
> > processes.
> >
> >
> >
> >
> >
> > On 1/2/06, Graham Dumpleton <grahamd@dscpl.com.au> wrote:
> > > Instead of using "apachectl restart", try using "apachectl graceful"
> to see
> > > if that makes any difference.
> > >
> > > You may also want to adjust GracefulShutdownTimeout for this case to
> > > only allow a certain time for child processes to shutdown.
> > >
> > >   http://httpd.apache.org/docs/2.2/mod/mpm_common.html#gracefulshutdowntimeout
> > >
> > > By fiddling with this, you may be able to see if given time that the
> child
> > > processes do actually shutdown, or whether they actually hang. If they
> > > hang, then you may be able to attach using gdb to the child process
> and
> > > work out where it is hanging.
> > >
> > > It may just be a case that with Python loaded it takes longer to shutdown
> > > than Apache expects it to and so it abruptly kills it. I haven't been
> able
> > > to find any directive for specifying a shutdown timeout for "restart"
> which
> > > it waits before it kills the child processes.
> > >
> > > Graham
> > >
> > > Martin Blais wrote ..
> > > > On 1/2/06, Martin Blais <blais@furius.ca> wrote:
> > > > > Before someone asks, I did not get seg faults in my log, so that's
> not
> > > > > the problem.
> > > > >
> > > > > On closer inspection though, I do have a few SSL error messages
> like
> > > > these:
> > > > >
> > > > > [Mon Jan 02 15:07:30 2006] [info] (70014)End of file found: SSL
> > > > > handshake interrupted by system [Hint: Stop button pressed in
> > > > > browser?!]
> > > > > [Mon Jan 02 15:07:30 2006] [info] Connection to child 0 closed
> with
> > > > > abortive shutdown(server furius.dyndns.biz:443, client 127.0.0.1)
> > > > > [Mon Jan 02 15:07:31 2006] [info] Connection to child 9 established
> > > > > (server furius.dyndns.biz:443, client 127.0.0.1)
> > > > > [Mon Jan 02 15:07:31 2006] [info] Seeding PRNG with 136 bytes of
> entropy
> > > > >
> > > > > ... the number of which does not match the number of zombie children
> > > > > (does not mean that it's not the problem though).
> > > > >
> > > > > Any information/tips welcome.
> > > >
> > > > It's not the SSL errors, I just reproduced the zombie child error
> > > > without getting the SSL errors (it's my automated test code that
> > > > somehow creates the SSL problems, fiddling a lot with the browser
> does
> > > > not cause SSL errors, but will result in children not wanting to
> die).
> > > >
> > > >
> > > > >
> > > > >
> > > > > On 1/2/06, Martin Blais <blais@furius.ca> wrote:
> > > > > > Hi
> > > > > >
> > > > > > I'm getting messages like this in my apache2 log when I stop
> it after
> > > > > > running requests to a mod_python-based web app:
> > > > > >
> > > > > > ==> /var/log/apache2/error_log <==
> > > > > > [Mon Jan 02 13:04:12 2006] [warn] child process 21806 still did
> not
> > > > > > exit, sending a SIGTERM
> > > > > > [Mon Jan 02 13:04:12 2006] [warn] child process 21768 still did
> not
> > > > > > exit, sending a SIGTERM
> > > > > > [Mon Jan 02 13:04:12 2006] [warn] child process 21792 still did
> not
> > > > > > exit, sending a SIGTERM
> > > > > > [Mon Jan 02 13:04:14 2006] [warn] child process 21806 still did
> not
> > > > > > exit, sending a SIGTERM
> > > > > > [Mon Jan 02 13:04:14 2006] [warn] child process 21768 still did
> not
> > > > > > exit, sending a SIGTERM
> > > > > > [Mon Jan 02 13:04:14 2006] [warn] child process 21792 still did
> not
> > > > > > exit, sending a SIGTERM
> > > > > > [Mon Jan 02 13:04:16 2006] [warn] child process 21806 still did
> not
> > > > > > exit, sending a SIGTERM
> > > > > > [Mon Jan 02 13:04:16 2006] [warn] child process 21768 still did
> not
> > > > > > exit, sending a SIGTERM
> > > > > > [Mon Jan 02 13:04:16 2006] [warn] child process 21792 still did
> not
> > > > > > exit, sending a SIGTERM
> > > > > > [Mon Jan 02 13:04:18 2006] [error] child process 21806 still
> did not
> > > > > > exit, sending a SIGKILL
> > > > > > [Mon Jan 02 13:04:18 2006] [error] child process 21768 still
> did not
> > > > > > exit, sending a SIGKILL
> > > > > > [Mon Jan 02 13:04:18 2006] [error] child process 21792 still
> did not
> > > > > > exit, sending a SIGKILL
> > > > > > [Mon Jan 02 13:04:19 2006] [info] removed PID file
> > > > > > /var/run/apache2.pid (pid=21754)
> > > > > > [Mon Jan 02 13:04:19 2006] [notice] caught SIGTERM, shutting
> down
> > > > > >
> > > > > > I've been tracking the problem, and on exit, the cleanup function
> (in
> > > > > > Python) that I registered with the mod_python server does get
> called,
> > > > > > and exits.
> > > > > >
> > > > > > I saw somewhere that recompiling expat, and then all the rest
> (in my
> > > > > > case, python-2.4.2, apache2, mod_python-3.1.4, psycopg2) might
> fix
> > > > the
> > > > > > issue (it would be due to a library incompatibility).  I did
> this,
> > > > and
> > > > > > the problem still occurs.  I also tried using mod_python-3.2.5b
> and
> > > > > > the problem persists.  This is all running on Linux (Gentoo).
> > > > > >
> > > > > > Any clue on how to debug this issue further?  I'm currently trying
> > > > to
> > > > > > run gdb on a non-daemon apache2, or trying to attach to a running
> > > > > > child.  The problem is a bit tricky to fix, since it does not
> happen
> > > > > > always -- but always happens at least after I run a lot of requests
> > > > > > e.g. my automated test suite for my web app.
> > > > > >
> > > > > > Any hints would be appreciated.
> > > > > >
> > > > > > cheers,
> > > > > >
> > > > >
> > > >
> > > > _______________________________________________
> > > > Mod_python mailing list
> > > > Mod_python@modpython.org
> > > > http://mailman.modpython.org/mailman/listinfo/mod_python
> > >
> >
From blais at furius.ca  Mon Jan  2 18:20:48 2006
From: blais at furius.ca (Martin Blais)
Date: Mon Jan  2 18:20:51 2006
Subject: [mod_python] Re: child process XXXX still did not exit,
	sending a SIGTERM
In-Reply-To: <1136243738.21310@dscpl.user.openhosting.com>
References: <1136243738.21310@dscpl.user.openhosting.com>
Message-ID: <8393fff0601021520k17fb0572g1391b16818c17ef6@mail.gmail.com>

On 1/2/06, Graham Dumpleton <grahamd@dscpl.com.au> wrote:
> Maybe mod_python has to be a bit more orderly as far as how it ends
> interpreters. Ie., maybe it should end each interpreter it has created
> explicitly using Py_EndInterpreter().
>
> This though may be dependent on first getting changes described in:
>
>   http://issues.apache.org/jira/browse/MODPYTHON-77
>
> incorporated. Specifically, the attachment:
>
>   http://issues.apache.org/jira/secure/attachment/12320489/grahamd_20051105.tar.gz
>
> Actually, this change may in itself fix the issue as it saves away the
> first interpreter state as "main_interpreter" and that will then be the
> interpreter state used to do the cleanup. This isn't the case at the
> moment.
>
> Can you apply that patch and see if things improve?

Thanks, will do!

> Beyond that, as I suggest, maybe it needs to be more orderly and
> end each interpreter besides "main_interpreter" and then finally call
> Py_Finalize().

I just found more info by fiddling just now, it seems to happen only
-- but not always, but most of the time anyway -- when I do a
redirect!  When I do not redirect I never have the problem.  When I
redirect it hangs most of the time, apart from the occasional clean
exit.

That is, my when handler returns code 302.

Will investigate further in a few hours, this is a good starting point I think.

thanks Graham.
cheers,

From python_eager at yahoo.com  Mon Jan  2 23:23:59 2006
From: python_eager at yahoo.com (python eager)
Date: Mon Jan  2 23:24:02 2006
Subject: [mod_python] Thanks for solving = for loop doubt 
In-Reply-To: <1136236378.12883@dscpl.user.openhosting.com>
Message-ID: <20060103042359.81887.qmail@web36409.mail.mud.yahoo.com>

Hi,
     i am very happy to get this solution from yours. I  followed your code snippets and finally i got the answer. Once again i am very happy and thank you to all .
   
  bye
  Python Eager
   
  

Graham Dumpleton <grahamd@dscpl.com.au> wrote:
  Using req.write() in PSP partly defeats the purpose of using it in the
first place. Ie., to avoid having to fiddle with req object directly. For
another example of how to do for loops see:






  
for key in req.subprocess_env.keys():
      # indent
%>
    
  
  

# end for
%>

  test





Indenting levels is critical with PSP. It defaults internally to using a tab
width for laying out its own auto generated code. If you use a different
indent level you have to be quite careful to include the comment hints
so it knows what indent level you are using, eg., "# indent" in the above.

See:

http://www.modpython.org/pipermail/mod_python/2005-May/018102.html

for further information about indenting issues and further loop examples.

Graham



Mike Looijmans wrote ..
> There are several errors, so I'm not surprised that you cannot find it:
> 
> - "res" is probably a misspelled "req"
> - Indentation is completely wrong
> - ending %> after for is probably not what you meant.
> - using req.write(...) to output a PSP script?
> - invalid colon at end of that line
> 
> You probably meant the following:
> ....
> > >
> ....
> 
> This cryptic thing should do the same, but quicker and without indentation:
> 
> %s" % n) for n in range(31)] %>
> 
> --
> Mike Looijmans
> Philips Natlab / Topic Automation
> 
> 
> python eager wrote:
> > Hi
> > in python server pages i am using for loop . but it will not work
> > properly. The code will be as follow as :
> > Date of Birth 
> > 
> > 
> > > > > > res.write("" +> > + ""):> > > > 
> > nbsp; 
> > 
> > 
> > But it will not work. What is the error , i cannt found the error. Would
> > any one have solution please send mail me. Thank You Very much. and also
> > Happy New Year
> > 
> > Note : very urget for me .reply wanted
> > 
> > regards
> > Python_Eager
> > 
> > 
> > ------------------------------------------------------------------------
> > Yahoo! for Good - Make a difference this year. 
> > 
> > 
> > 
> > 
> > ------------------------------------------------------------------------
> > 
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://mailman.modpython.org/mailman/listinfo/mod_python
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
  


		
---------------------------------
 Yahoo! DSL Something to write home about. Just $16.99/mo. or less
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20060102/2ae8a535/attachment-0001.html
From python_eager at yahoo.com  Mon Jan  2 23:51:02 2006
From: python_eager at yahoo.com (python eager)
Date: Mon Jan  2 23:51:05 2006
Subject: [mod_python] Query in Connection With Access Database 
Message-ID: <20060103045102.4045.qmail@web36411.mail.mud.yahoo.com>

Hi
     i got error while connecting datas with Ms-Access. I got the following error
   
  import win32com.client
ImportError: No module named win32com.client
   
  My Code As Follows :
   
      #CODE STARTS HERE
import win32com.client
engine = win32com.client.Dispatch("DAO.DBEngine.36")
db=engine.OpenDatabase("C:\My Documents\Employee.mdb")
rs = db.OpenRecordset("Employee")
  fields = rs.Fields
  def cycle(rs):
    rs.MoveFirst()
    while(rs.EOF==0):
        for a in range(0,f.Count):
            print f.Item(a)
        rs.MoveNext()
#END CODE

  Employee.mdb contains three fields
   1. EmployeeNumber = number (primary key)
  2. Employee Name = text
  3. Salary  = number
   
  please give me the solution for this error. If you have sample code for this send me it will be useful for me. ( Data's retrieve from msaccess and also datas insert into msaccess ). Please send the solution.
   
  regards
  Python Eager
   

		
---------------------------------
Yahoo! Photos
 Ring in the New Year with Photo Calendars. Add photos, events, holidays, whatever.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20060102/c6851894/attachment.html
From nicolas.lehuen at gmail.com  Tue Jan  3 02:02:50 2006
From: nicolas.lehuen at gmail.com (Nicolas Lehuen)
Date: Tue Jan  3 02:02:55 2006
Subject: [mod_python] Query in Connection With Access Database
In-Reply-To: <20060103045102.4045.qmail@web36411.mail.mud.yahoo.com>
References: <20060103045102.4045.qmail@web36411.mail.mud.yahoo.com>
Message-ID: <c298f2d70601022302y4cebfb60t@mail.gmail.com>

I wouldn't like to state the obvious, but have you installed pywin32 ?

http://sourceforge.net/projects/pywin32/

Regards,
Nicolas

2006/1/3, python eager <python_eager@yahoo.com>:
> Hi
>    i got error while connecting datas with Ms-Access. I got the following
> error
>
> import win32com.client
> ImportError: No module named win32com.client
>
> My Code As Follows :
>
>     #CODE STARTS HERE
> import win32com.client
> engine = win32com.client.Dispatch("DAO.DBEngine.36")
> db=engine.OpenDatabase("C:\My Documents\Employee.mdb")
> rs = db.OpenRecordset("Employee")
> fields = rs.Fields
> def cycle(rs):
>     rs.MoveFirst()
>     while(rs.EOF==0):
>         for a in range(0,f.Count):
>             print f.Item(a)
>         rs.MoveNext()
> #END CODE
>
> Employee.mdb contains three fields
>  1. EmployeeNumber = number (primary key)
> 2. Employee Name = text
> 3. Salary  = number
>
> please give me the solution for this error. If you have sample code for this
> send me it will be useful for me. ( Data's retrieve from msaccess and also
> datas insert into msaccess ). Please send the solution.
>
> regards
> Python Eager
>
>
>  ________________________________
> Yahoo! Photos
>  Ring in the New Year with Photo Calendars. Add photos, events, holidays,
> whatever.
>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
>
>

From python_eager at yahoo.com  Tue Jan  3 07:58:24 2006
From: python_eager at yahoo.com (python eager)
Date: Tue Jan  3 07:58:27 2006
Subject: [mod_python] query reg retrieve values from psp
Message-ID: <20060103125824.20736.qmail@web36402.mail.mud.yahoo.com>

Hi
    I am using .psp page, and the values are passed into .py. I am unable to get only one value from text box. In that text box has disabled field. 
   
  The code is as below for .psp
   
               <input type="text" name="salary" size ="10" /> This text box disabled using javascript while loading.
   
  The code is as below for .py
            self.writeln("Salary :")
           self.writeln(req.field('salary'))
   
  if i remove the disabled option for this text box i will get the answer. But if the disabled opiton is enabled i will get the following error ;
   
  self.writeln(req.field('salary'))
  File ".\WebKit\HTTPRequest.py", line 202, in field [edit]
  KeyError: 'salary'
   
   
  please give the solution for this.
   
  Thanks
  Python Eager
   

		
---------------------------------
 Yahoo! DSL Something to write home about. Just $16.99/mo. or less
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20060103/fc7983ce/attachment.html
From nlv11281 at natlab.research.philips.com  Tue Jan  3 08:15:39 2006
From: nlv11281 at natlab.research.philips.com (Mike Looijmans)
Date: Tue Jan  3 08:15:51 2006
Subject: [mod_python] query reg retrieve values from psp
In-Reply-To: <20060103125824.20736.qmail@web36402.mail.mud.yahoo.com>
References: <20060103125824.20736.qmail@web36402.mail.mud.yahoo.com>
Message-ID: <43BA78FB.6020609@natlab.research.philips.com>

Sounds like normal HTML behaviour - a DISABLED input does not post its 
data to the server.

To avoid an exception when the form field is not there, use 
form.get(..), form.has_key(..) or just catch the KeyError and handle it.

--
Mike Looijmans
Philips Natlab / Topic Automation


python eager wrote:
> Hi
>   I am using .psp page, and the values are passed into .py. I am unable 
> to get only one value from text box. In that text box has disabled field.
>  
> The code is as below for .psp
>  
>              <input type="text" name="salary" size ="10" /> This text 
> box disabled using javascript while loading.
>  
> The code is as below for .py
>           self.writeln("Salary :")
>            self.writeln(req.field('salary'))
>  
> if i remove the disabled option for this text box i will get the answer. 
> But if the disabled opiton is enabled i will get the following error ;
>  
> self.writeln(req.field('salary'))
>   File ".\WebKit\HTTPRequest.py", line 202, in field [edit] 
> <http://localhost:8080/Admin/EditFile?filename=C%3A%5CWebware-0.9%5CWebKit%5C.%5CWebKit%5CHTTPRequest.py&line=202>
>   KeyError: 'salary'
>  
>  
> please give the solution for this.
>  
> Thanks
> Python Eager
>  
> 
> ------------------------------------------------------------------------
> Yahoo! DSL 
> <http://pa.yahoo.com/*http://us.rd.yahoo.com/evt=37474/*http://promo.yahoo.com/broadband/ 
>  > Something to write home about. Just $16.99/mo. or less
> 
> 
> ------------------------------------------------------------------------
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python

From blais at furius.ca  Tue Jan  3 10:32:11 2006
From: blais at furius.ca (Martin Blais)
Date: Tue Jan  3 10:32:13 2006
Subject: [mod_python] Re: child process XXXX still did not exit,
	sending a SIGTERM
In-Reply-To: <1136243738.21310@dscpl.user.openhosting.com>
References: <1136243738.21310@dscpl.user.openhosting.com>
Message-ID: <8393fff0601030732l6bc49cd6x12e333407a380590@mail.gmail.com>

On 1/2/06, Graham Dumpleton <grahamd@dscpl.com.au> wrote:
> Maybe mod_python has to be a bit more orderly as far as how it ends
> interpreters. Ie., maybe it should end each interpreter it has created
> explicitly using Py_EndInterpreter().
>
> This though may be dependent on first getting changes described in:
>
>   http://issues.apache.org/jira/browse/MODPYTHON-77
>
> incorporated. Specifically, the attachment:
>
>   http://issues.apache.org/jira/secure/attachment/12320489/grahamd_20051105.tar.gz
>
> Actually, this change may in itself fix the issue as it saves away the
> first interpreter state as "main_interpreter" and that will then be the
> interpreter state used to do the cleanup. This isn't the case at the
> moment.
>
> Can you apply that patch and see if things improve?
>
> Beyond that, as I suggest, maybe it needs to be more orderly and
> end each interpreter besides "main_interpreter" and then finally call
> Py_Finalize().

Hi Graham

I applied the patch at the link you mention, and it does not resolve
the issue.  The problem still occurs.

I read the discussion, and I gather from it that there is an issue
with using multiple interpreters.  This is my case: I have two
separate web apps using a python handler with different names.  I
suppose I don't have a choice, right?  I couldn't specify two
different apps in the same interpreter, if I have some globals in some
of the common imported modules?

From blais at furius.ca  Tue Jan  3 16:34:37 2006
From: blais at furius.ca (Martin Blais)
Date: Tue Jan  3 16:34:41 2006
Subject: [mod_python] Re: child process XXXX still did not exit,
	sending a SIGTERM
In-Reply-To: <8393fff0601030732l6bc49cd6x12e333407a380590@mail.gmail.com>
References: <1136243738.21310@dscpl.user.openhosting.com>
	<8393fff0601030732l6bc49cd6x12e333407a380590@mail.gmail.com>
Message-ID: <8393fff0601031334v458bd853if8bdb79645dcdbc@mail.gmail.com>

On 1/3/06, Martin Blais <blais@furius.ca> wrote:
> Hi Graham
>
> I applied the patch at the link you mention, and it does not resolve
> the issue.  The problem still occurs.
>
> I read the discussion, and I gather from it that there is an issue
> with using multiple interpreters.  This is my case: I have two
> separate web apps using a python handler with different names.  I
> suppose I don't have a choice, right?  I couldn't specify two
> different apps in the same interpreter, if I have some globals in some
> of the common imported modules?

I also tried now with a single interpreter, the problem is still
there, named explicitly or not.

After much hacking (all day today), I added the explicit
Py_EndInterpreter calls and it still hangs on destruction. 
Specifically, it hangs on PyImport_Cleanup() in Py_EndInterpreter(). 
I'm having trouble pinpointing exactly which symbol makes it hang.  It
seems to happen when cleaning the logging module.  I saw that logging
register an atexit hook, tried to remove that, does not fix the
problem.

Patch on the latest beta (3.2.5b) to come at some point.  I need to
rip out my horrible tracing code that I inserted all over the place.

Question:
Why do we need to create a new thread state on every handler call?  Is
this for  MPM worker support?

From grahamd at dscpl.com.au  Tue Jan  3 17:08:56 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Tue Jan  3 17:09:09 2006
Subject: [mod_python] Re: child process XXXX still did not exit,
	sending a SIGTERM
Message-ID: <1136326136.13046@dscpl.user.openhosting.com>

Martin Blais wrote ..
> After much hacking (all day today), I added the explicit
> Py_EndInterpreter calls and it still hangs on destruction. 
> Specifically, it hangs on PyImport_Cleanup() in Py_EndInterpreter(). 
> I'm having trouble pinpointing exactly which symbol makes it hang.  It
> seems to happen when cleaning the logging module.  I saw that logging
> register an atexit hook, tried to remove that, does not fix the
> problem.

Hmmm, you have gotten ahead of me. I was going to work out some code to
end each interpreter explicitly this morning.

One of the things I wanted to get from doing that was to determine which
of the named interpreters was it hanging on. Was it "main_interpreter"
or one of those for a virtual host? Knowing which interpreter it was might
give clues especially if that interpreter is loading odd Python code.

I need to refamiliarise myself with the code and get back to you on
other questions. I also really need to work out how to duplicate it in my
system. I have had it occur before occassionaly, but not recently, so
don't know which code triggers it. I can't see how just a 302 redirection
would cause a problem, but will try a few things.

Graham
From grahamd at dscpl.com.au  Tue Jan  3 17:17:19 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Tue Jan  3 17:17:34 2006
Subject: [mod_python] Re: child process XXXX still did not exit,
	sending a SIGTERM
Message-ID: <1136326639.18298@dscpl.user.openhosting.com>

Martin Blais wrote ..
> On 1/3/06, Martin Blais <blais@furius.ca> wrote:
> Question:
> Why do we need to create a new thread state on every handler call?  Is
> this for  MPM worker support?

You need to do it for threading in general in Python, which in practice
is only really relevant to MPM worker.

Technically you don't have to create one on every call if you were to
have a pool of thread state objects which you reuse, but it is simpler
to just create one for each top level request. It serves the same
purpose without the complexity of some pooling data structures for
thread state objects.

Graham
From grahamd at dscpl.com.au  Tue Jan  3 18:24:16 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Tue Jan  3 18:24:36 2006
Subject: [mod_python] Re: child process XXXX still did not exit,
	sending a SIGTERM
Message-ID: <1136330656.26679@dscpl.user.openhosting.com>

Graham Dumpleton wrote ..
> Martin Blais wrote ..
> > After much hacking (all day today), I added the explicit
> > Py_EndInterpreter calls and it still hangs on destruction. 
> > Specifically, it hangs on PyImport_Cleanup() in Py_EndInterpreter().
> > I'm having trouble pinpointing exactly which symbol makes it hang.  It
> > seems to happen when cleaning the logging module.  I saw that logging
> > register an atexit hook, tried to remove that, does not fix the
> > problem.
> 
> Hmmm, you have gotten ahead of me. I was going to work out some code to
> end each interpreter explicitly this morning.

FWIW, I would have stuck the following just prior to get_interpreter()
call in python_finalize() to try and debug which intepreter it may have
been getting stuck in. It is a bit tricky as it makes use of the thread
state object that make_interpreter() left inaccessible from when the
interepreter was first created. In general, this code probably will not
work for more complicated systems where additional C code had
created additional thread states associated with an intepreter as the
Py_EndInterpreter() call expects there to be only one remaining. Note
this assumes that multiple interpreter fix I reference is applied.


    /* XXX */
                                                    PyThreadState *tstate;
    PyObject *key, *value;
    char *name;
    int pos = 0;

#ifdef WITH_THREAD
    PyEval_AcquireLock();

    while (PyDict_Next(interpreters, &pos, &key, &value)) {
        name = PyString_AsString(key);
        ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_NOTICE, 0, 0,
                     "%d interpreter %s", getpid(), name);        if (strcmp(name,MAIN_INTERPRETER) != 0) {
            idata = (interpreterdata *)PyCObject_AsVoidPtr(value);
            tstate = idata->istate->tstate_head;
            PyThreadState_Swap(tstate);
            ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_NOTICE, 0, 0,
                         "%d end interpreter %s", getpid(), name);
            Py_EndInterpreter(tstate);
            PyThreadState_Swap(NULL);
            ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_NOTICE, 0, 0,
                         "%d done interpreter %s", getpid(), name);
        }
        else
        {
            ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_NOTICE, 0, 0,
                         "%d skip interpreter %s", getpid(), name);
        }
    }

    PyEval_ReleaseLock();

    ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_NOTICE, 0, 0,
                 "%d now do finalize", getpid());
#endif
    
    /* XXX */
From blais at furius.ca  Tue Jan  3 23:50:10 2006
From: blais at furius.ca (Martin Blais)
Date: Tue Jan  3 23:50:12 2006
Subject: [mod_python] Re: child process XXXX still did not exit,
	sending a SIGTERM
In-Reply-To: <1136330656.26679@dscpl.user.openhosting.com>
References: <1136330656.26679@dscpl.user.openhosting.com>
Message-ID: <8393fff0601032050m72581f41j7ed22a0c437cb651@mail.gmail.com>

On 1/3/06, Graham Dumpleton <grahamd@dscpl.com.au> wrote:
> Graham Dumpleton wrote ..
> > Martin Blais wrote ..
> > > After much hacking (all day today), I added the explicit
> > > Py_EndInterpreter calls and it still hangs on destruction.
> > > Specifically, it hangs on PyImport_Cleanup() in Py_EndInterpreter().
> > > I'm having trouble pinpointing exactly which symbol makes it hang.  It
> > > seems to happen when cleaning the logging module.  I saw that logging
> > > register an atexit hook, tried to remove that, does not fix the
> > > problem.
> >
> > Hmmm, you have gotten ahead of me. I was going to work out some code to
> > end each interpreter explicitly this morning.
>
> FWIW, I would have stuck the following just prior to get_interpreter()
> call in python_finalize() to try and debug which intepreter it may have
> been getting stuck in. It is a bit tricky as it makes use of the thread
> state object that make_interpreter() left inaccessible from when the
> interepreter was first created. In general, this code probably will not
> work for more complicated systems where additional C code had
> created additional thread states associated with an intepreter as the
> Py_EndInterpreter() call expects there to be only one remaining. Note
> this assumes that multiple interpreter fix I reference is applied.

Hehe it seems we have been walking on the same paths, indeed.

On my side, I changed the code to remove that original thread-state
right after a new interpreter is created.  I traced all the tstate
creations and made sure to not have any extra thread-states lying
around.  Will submit patch when I clean up the stuff.   However, I
found that trying to do remove the original thread-state from the
first interpreter results in some other error (PyDict_??? ... related
to modules, lost my log file).  In the end I just decided to leave it
for now, and not to explicitly end the main_interpreter (because at
that point it has two thread-states).  I thought of doing like you did
for the main_interpreter, with the original tstate.

Anyway, in any case, it hangs in my own custom interpreter, and not in
the main_interpreter.

My main problem is getting more info at that point, because even if I
attach a gdb to the cihld process, apache insists on sending it
SIGKILL 10 seconds later.  I just had an idea on the way to dinner,
that I could "simulate" finalisation by calling python_finalize from
the handler by returning a special signal number, just for this
purpose.

One other thing I did is reproduce Py_EndInterpreter within
mod_python, and it hangs on PyImport_Cleanup().  I turned up
Py_VerboseFlag and it seems to stop at the logging module.  logging
has some atexit calls, so I tried clearing that but it did not stop
the problem.  Need to look further, this is a tough bugger of a bug.

About the thread-state creation: it might be faster to eventually use
the pooling solution, rather than creating new tstates all the time,
the thread-state creation is light, but there is a small lock in
there.

cheers,

From blais at furius.ca  Wed Jan  4 00:00:56 2006
From: blais at furius.ca (Martin Blais)
Date: Wed Jan  4 00:00:59 2006
Subject: [mod_python] Re: child process XXXX still did not exit,
	sending a SIGTERM
In-Reply-To: <1136330656.26679@dscpl.user.openhosting.com>
References: <1136330656.26679@dscpl.user.openhosting.com>
Message-ID: <8393fff0601032100v1d3e3342p142df146b30f4cf9@mail.gmail.com>

On 1/3/06, Graham Dumpleton <grahamd@dscpl.com.au> wrote:
>     /* XXX */
>                                                     PyThreadState *tstate;
>     PyObject *key, *value;
>     char *name;
>     int pos = 0;
>
> #ifdef WITH_THREAD
>     PyEval_AcquireLock();
>
>     while (PyDict_Next(interpreters, &pos, &key, &value)) {
>         name = PyString_AsString(key);
>         ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_NOTICE, 0, 0,
>                      "%d interpreter %s", getpid(), name);        if (strcmp(name,MAIN_INTERPRETER) != 0) {
>             idata = (interpreterdata *)PyCObject_AsVoidPtr(value);
>             tstate = idata->istate->tstate_head;
>             PyThreadState_Swap(tstate);
>             ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_NOTICE, 0, 0,
>                          "%d end interpreter %s", getpid(), name);
>             Py_EndInterpreter(tstate);
>             PyThreadState_Swap(NULL);
>             ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_NOTICE, 0, 0,
>                          "%d done interpreter %s", getpid(), name);
>         }
>         else
>         {

BTW, I think that right here you need to setup a thread-state and call
Py_EndInterpreter for those other interpreters as well, no?





>             ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_NOTICE, 0, 0,
>                          "%d skip interpreter %s", getpid(), name);
>         }
>     }
>
>     PyEval_ReleaseLock();
>
>     ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_NOTICE, 0, 0,
>                  "%d now do finalize", getpid());
> #endif
>
>     /* XXX */
>

From blais at furius.ca  Wed Jan  4 00:04:32 2006
From: blais at furius.ca (Martin Blais)
Date: Wed Jan  4 00:04:35 2006
Subject: [mod_python] Re: child process XXXX still did not exit,
	sending a SIGTERM
In-Reply-To: <8393fff0601032100v1d3e3342p142df146b30f4cf9@mail.gmail.com>
References: <1136330656.26679@dscpl.user.openhosting.com>
	<8393fff0601032100v1d3e3342p142df146b30f4cf9@mail.gmail.com>
Message-ID: <8393fff0601032104l2fc6598o139b67cf6e81bde@mail.gmail.com>

On 1/4/06, Martin Blais <blais@furius.ca> wrote:
> On 1/3/06, Graham Dumpleton <grahamd@dscpl.com.au> wrote:
> >     /* XXX */
> >                                                     PyThreadState *tstate;
> >     PyObject *key, *value;
> >     char *name;
> >     int pos = 0;
> >
> > #ifdef WITH_THREAD
> >     PyEval_AcquireLock();
> >
> >     while (PyDict_Next(interpreters, &pos, &key, &value)) {
> >         name = PyString_AsString(key);
> >         ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_NOTICE, 0, 0,
> >                      "%d interpreter %s", getpid(), name);        if (strcmp(name,MAIN_INTERPRETER) != 0) {
> >             idata = (interpreterdata *)PyCObject_AsVoidPtr(value);
> >             tstate = idata->istate->tstate_head;
> >             PyThreadState_Swap(tstate);
> >             ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_NOTICE, 0, 0,
> >                          "%d end interpreter %s", getpid(), name);
> >             Py_EndInterpreter(tstate);
> >             PyThreadState_Swap(NULL);
> >             ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_NOTICE, 0, 0,
> >                          "%d done interpreter %s", getpid(), name);
> >         }
> >         else
> >         {
>
> BTW, I think that right here you need to setup a thread-state and call
> Py_EndInterpreter for those other interpreters as well, no?

Oopsy, sorry, I misread.  This is indeed what you're doing.  Never
mind.  Me tired.

From grahamd at dscpl.com.au  Wed Jan  4 00:16:16 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Wed Jan  4 00:16:38 2006
Subject: [mod_python] Re: child process XXXX still did not exit,
	sending a SIGTERM
Message-ID: <1136351776.11553@dscpl.user.openhosting.com>

Martin Blais wrote ..
> Anyway, in any case, it hangs in my own custom interpreter, and not in
> the main_interpreter.
> 
> My main problem is getting more info at that point, because even if I
> attach a gdb to the cihld process, apache insists on sending it
> SIGKILL 10 seconds later.

Which is why I suggested using "apachectl graceful" as if I read the
documentation correctly, the main Apache process will wait for the child
to exit properly. By default if ShutdownGracefulTimeout is not set or 0,
it will wait indefinitely and thus wouldn't kill it. This would allow
you time to attach gdb.

This is of course assuming that that is how it does in fact work. :-)

Graham

From sean at barriescene.com  Wed Jan  4 00:20:11 2006
From: sean at barriescene.com (Sean Jamieson)
Date: Wed Jan  4 00:20:16 2006
Subject: [mod_python] Feature Request: Additions to mod_python.util
Message-ID: <43BB5B0B.3010908@barriescene.com>

Hi, I don't know if what I'm about to ask has already been requested, or 
if this is the right list, but here I go:

I have been using mod_python for about 3 weeks now, and have come up 
with a few things that I'd like to see added into the util module (I'm 
assuming this might be the right place for them).

1. a refresh() sibling to the redirect() function; I use the Refresh 
header quite often in my applications.

2. html(encode|decode) for translating all defined entity characters; 
currently pythons default cgi.escape only translates "&", "<" and ">", 
and xml.sax.saxutils.escape is both silly if you're not using sax for 
anything else, and not convenient as you have to give it the translation 
table. Also a simple method to unescape these is quite useful aswell.

I've thought of other things aswell, but I can't remember what they were 
right now :-)

This is a great project, keep up the good work.

Thanks,
Sean
From blais at furius.ca  Wed Jan  4 00:25:05 2006
From: blais at furius.ca (Martin Blais)
Date: Wed Jan  4 00:25:08 2006
Subject: [mod_python] Re: child process XXXX still did not exit,
	sending a SIGTERM
In-Reply-To: <8393fff0601032050m72581f41j7ed22a0c437cb651@mail.gmail.com>
References: <1136330656.26679@dscpl.user.openhosting.com>
	<8393fff0601032050m72581f41j7ed22a0c437cb651@mail.gmail.com>
Message-ID: <8393fff0601032125h3ff279b5hca6bda67b509c3be@mail.gmail.com>

On 1/3/06, Martin Blais <blais@furius.ca> wrote:
> My main problem is getting more info at that point, because even if I
> attach a gdb to the cihld process, apache insists on sending it
> SIGKILL 10 seconds later.  I just had an idea on the way to dinner,
> that I could "simulate" finalisation by calling python_finalize from
> the handler by returning a special signal number, just for this
> purpose.

FWIW, I just implemented this easily: I add a hook in python_handler
to call the finalization code and then exit.  Then I bound a resource
in my web app that return the magic code (442).  So what I do is start
apache, fetch some resources which always trigger the problem, then
fetch the special resource, and watch the finalization code be run and
the child exits.

I was hoping for it to hang, so that I could attach a debugger on it
and inspect my Python child to see what the bugger was doing, but
guess what... when called from the handler, the finalization code
always succeeds!  Go figure.  Is this useful information?


Patch below:

--- mod_python.c        2006-01-03 19:17:44.000000000 -0500
+++ mod_python.orig.c   2006-01-03 11:44:56.000000000 -0500
@@ -1122,14 +1122,6 @@
         else {
             result = PyInt_AsLong(resultobject);

-            /* Fake finalization, just to test and attach a debugger to it. */
-            if ( result == 442 ) {
-              Py_XDECREF(resultobject);
-
-              python_finalize(NULL);
-              exit(0);
-            }
-
             /* authen handlers need one more thing
              * if authentication failed and this handler is not
              * authoritative, let the others handle it

From blais at furius.ca  Wed Jan  4 01:17:03 2006
From: blais at furius.ca (Martin Blais)
Date: Wed Jan  4 01:17:05 2006
Subject: [mod_python] Re: child process XXXX still did not exit,
	sending a SIGTERM
In-Reply-To: <1136351776.11553@dscpl.user.openhosting.com>
References: <1136351776.11553@dscpl.user.openhosting.com>
Message-ID: <8393fff0601032217w3433596n1ce373153464f1cd@mail.gmail.com>

On 1/4/06, Graham Dumpleton <grahamd@dscpl.com.au> wrote:
> Martin Blais wrote ..
> > Anyway, in any case, it hangs in my own custom interpreter, and not in
> > the main_interpreter.
> >
> > My main problem is getting more info at that point, because even if I
> > attach a gdb to the cihld process, apache insists on sending it
> > SIGKILL 10 seconds later.
>
> Which is why I suggested using "apachectl graceful" as if I read the
> documentation correctly, the main Apache process will wait for the child
> to exit properly. By default if ShutdownGracefulTimeout is not set or 0,
> it will wait indefinitely and thus wouldn't kill it. This would allow
> you time to attach gdb.
>
> This is of course assuming that that is how it does in fact work. :-)

I know, but this is only available in apache 2.2.

I think I got my hands on something here, here is what I got from a
gdb backtrace when I quickly attach before the child is killed:

#0  0xb7bec054 in __pthread_sigsuspend () from /lib/libpthread.so.0
#1  0xb7bebe98 in __pthread_wait_for_restart_signal () from /lib/libpthread.so.0
#2  0xb7becd6b in sem_wait@@GLIBC_2.1 () from /lib/libpthread.so.0
#3  0xb7a2a54f in PyThread_acquire_lock () from
/usr/lib/apache2/modules/mod_python.so
#4  0xb7a2373e in PyThreadState_Delete () from
/usr/lib/apache2/modules/mod_python.so
#5  0xb7a232f8 in PyInterpreterState_Delete () from
/usr/lib/apache2/modules/mod_python.so
#6  0xb7a24663 in Py_EndInterpreter () from
/usr/lib/apache2/modules/mod_python.so
#7  0xb799ff08 in python_finalize () from /usr/lib/apache2/modules/mod_python.so
#8  0xb7ccb6ed in apr_pool_cleanup_run () from /usr/lib/libapr-0.so.0
#9  0xb7ccaf8d in apr_pool_destroy () from /usr/lib/libapr-0.so.0
#10 0x0806860c in ap_graceful_stop_signalled ()
#11 0xb7beeef5 in __pthread_sighandler () from /lib/libpthread.so.0
#12 <signal handler called>
#13 0xb7b750b8 in poll () from /lib/libc.so.6
#14 0xb7ccc2af in apr_poll () from /usr/lib/libapr-0.so.0
#15 0xb7ccca53 in apr_wait_for_io_or_timeout () from /usr/lib/libapr-0.so.0
#16 0xb7cc1f74 in apr_socket_recv () from /usr/lib/libapr-0.so.0
#17 0xb7dd9335 in apr_bucket_socket_create () from /usr/lib/libaprutil-0.so.0
#18 0xb7dd9bce in apr_brigade_split_line () from /usr/lib/libaprutil-0.so.0
#19 0x0807fdfb in ap_get_request_note ()
#20 0x080767a6 in ap_get_brigade ()
#21 0xb7f3db96 in ?? () from /usr/lib/apache2/modules/mod_logio.so
#22 0x08250d80 in ?? ()
#23 0x08272020 in ?? ()
#24 0x00000001 in ?? ()
#25 0x00000000 in ?? ()

Apache terminates its children by sending them a signal in the first
place (#12).   Then, in the Python HEAD_LOCK
(Python-2.4.2/Python/pystate.c), I inspected the code and I can't find
a deadlock problem.  But the pthread semaphore seem to use a signal
itself (the name of the call in frame #0), and we're already in a
signal handler, isn't this prohibited?

Can't remember just now.  (more tomorrow.)

good night,

From grahamd at dscpl.com.au  Wed Jan  4 01:37:34 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Wed Jan  4 01:37:47 2006
Subject: [mod_python] Re: child process XXXX still did not exit,
	sending a SIGTERM
Message-ID: <1136356654.27806@dscpl.user.openhosting.com>

Martin Blais wrote ..
> On 1/4/06, Graham Dumpleton <grahamd@dscpl.com.au> wrote:
> > Martin Blais wrote ..
> > > Anyway, in any case, it hangs in my own custom interpreter, and not
> in
> > > the main_interpreter.
> > >
> > > My main problem is getting more info at that point, because even if
> I
> > > attach a gdb to the cihld process, apache insists on sending it
> > > SIGKILL 10 seconds later.
> >
> > Which is why I suggested using "apachectl graceful" as if I read the
> > documentation correctly, the main Apache process will wait for the child
> > to exit properly. By default if ShutdownGracefulTimeout is not set or
> 0,
> > it will wait indefinitely and thus wouldn't kill it. This would allow
> > you time to attach gdb.
> >
> > This is of course assuming that that is how it does in fact work. :-)
> 
> I know, but this is only available in apache 2.2.

Hmmm, missed that the GracefulShutdownTimeout was only added
in 2.2. Since 2.0 had graceful shutdown, assumed that that directive
was in 2.0 as well. Pity.

Graham

From grahamd at dscpl.com.au  Wed Jan  4 05:29:36 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Wed Jan  4 05:31:43 2006
Subject: [mod_python] Re: child process XXXX still did not exit,
	sending a SIGTERM
In-Reply-To: <8393fff0601032217w3433596n1ce373153464f1cd@mail.gmail.com>
References: <1136351776.11553@dscpl.user.openhosting.com>
	<8393fff0601032217w3433596n1ce373153464f1cd@mail.gmail.com>
Message-ID: <096aeb5e6def26f49b3952c888cc1b0e@dscpl.com.au>


On 04/01/2006, at 5:17 PM, Martin Blais wrote:
> I think I got my hands on something here, here is what I got from a
> gdb backtrace when I quickly attach before the child is killed:
>
> #0  0xb7bec054 in __pthread_sigsuspend () from /lib/libpthread.so.0
> #1  0xb7bebe98 in __pthread_wait_for_restart_signal () from 
> /lib/libpthread.so.0
> #2  0xb7becd6b in sem_wait@@GLIBC_2.1 () from /lib/libpthread.so.0
> #3  0xb7a2a54f in PyThread_acquire_lock () from
> /usr/lib/apache2/modules/mod_python.so
> #4  0xb7a2373e in PyThreadState_Delete () from
> /usr/lib/apache2/modules/mod_python.so
> #5  0xb7a232f8 in PyInterpreterState_Delete () from
> /usr/lib/apache2/modules/mod_python.so
> #6  0xb7a24663 in Py_EndInterpreter () from
> /usr/lib/apache2/modules/mod_python.so
> #7  0xb799ff08 in python_finalize () from 
> /usr/lib/apache2/modules/mod_python.so
> #8  0xb7ccb6ed in apr_pool_cleanup_run () from /usr/lib/libapr-0.so.0
> #9  0xb7ccaf8d in apr_pool_destroy () from /usr/lib/libapr-0.so.0
> #10 0x0806860c in ap_graceful_stop_signalled ()
> #11 0xb7beeef5 in __pthread_sighandler () from /lib/libpthread.so.0
> #12 <signal handler called>
> #13 0xb7b750b8 in poll () from /lib/libc.so.6
> #14 0xb7ccc2af in apr_poll () from /usr/lib/libapr-0.so.0
> #15 0xb7ccca53 in apr_wait_for_io_or_timeout () from 
> /usr/lib/libapr-0.so.0
> #16 0xb7cc1f74 in apr_socket_recv () from /usr/lib/libapr-0.so.0
> #17 0xb7dd9335 in apr_bucket_socket_create () from 
> /usr/lib/libaprutil-0.so.0
> #18 0xb7dd9bce in apr_brigade_split_line () from 
> /usr/lib/libaprutil-0.so.0
> #19 0x0807fdfb in ap_get_request_note ()
> #20 0x080767a6 in ap_get_brigade ()
> #21 0xb7f3db96 in ?? () from /usr/lib/apache2/modules/mod_logio.so
> #22 0x08250d80 in ?? ()
> #23 0x08272020 in ?? ()
> #24 0x00000001 in ?? ()
> #25 0x00000000 in ?? ()
>
> Apache terminates its children by sending them a signal in the first
> place (#12).   Then, in the Python HEAD_LOCK
> (Python-2.4.2/Python/pystate.c), I inspected the code and I can't find
> a deadlock problem.  But the pthread semaphore seem to use a signal
> itself (the name of the call in frame #0), and we're already in a
> signal handler, isn't this prohibited?

The stack trace is a bit bogus from what I can tell. In the various MPMs
I looked at, the ap_graceful_stop_signalled() function simple sets a
variable and returns. It doesn't go calling apr_pool_destroy().

Anyway, seeing the stack trace I can see where the problem lies and can
simulate the situation with a test case.

What it all comes down to is the signal handler for a SIGTERM in the
child process is registered as:

   apr_signal(SIGTERM, just_die);

Thus when the SIGTERM is received it calls just_die(). The just_die()
function calls clean_child_exit(), which if there is found to be a
memory pool in existence for the child process calls apr_pool_destroy()
on that memory pool.

The problem then is that mod_python registers a cleanup handler
associated with that memory pool, namely python_finalize(). Ie., it
calls:

   apr_pool_cleanup_register(p, NULL, python_finalize, 
apr_pool_cleanup_null);

This means that when that memory pool is destroyed, the 
python_finalize()
function is being called, which is wrong in that situation for a couple
of reasons.

The first reason is that complex things should not be done from inside 
of
signal handlers unless the code which is called is heavily protected
against being called by signal handlers when in critical sections. There
is no way that general Python API functions are going to fall into that
category.

The second reason is that at the time that the signal occurs, the main
program thread is already deep within Python code and probably has 
various
locks acquired. When the signal handler calls into Py_Finalize() it is
most likely reaching a point where it wants to acquire the same lock
as the main program thread has and it effectively deadlocks as the
signal handler can't proceed until it gets the lock, but the main
program thread can't give it up while the signal handler is running.

At least this is the case on UNIX systems, where signal handlers
interrupt the execution of the main program thread, unlike Win32 where
signal handlers are a distinct thread in their own right.

My immediate question is why does Py_Finalize() even need to be called
within the context of the child process if it is simply being killed off
anyway. I know that for the Apache main process if doing a restart that
Py_Finalize() needs to be called as the same process is kept around,
but for a child process I don't see the point except maybe to flush
out stderr/stdout which aren't typically used in mod_python anyway.

Time now to work out why python_finalize() needs to be called. Maybe
it can't simply not do anything when called in the context of the child
process.

Graham

From grahamd at dscpl.com.au  Wed Jan  4 06:10:10 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Wed Jan  4 06:10:39 2006
Subject: [mod_python] Re: child process XXXX still did not exit,
	sending a SIGTERM
In-Reply-To: <096aeb5e6def26f49b3952c888cc1b0e@dscpl.com.au>
References: <1136351776.11553@dscpl.user.openhosting.com>
	<8393fff0601032217w3433596n1ce373153464f1cd@mail.gmail.com>
	<096aeb5e6def26f49b3952c888cc1b0e@dscpl.com.au>
Message-ID: <9a2acb31102d3307da9523a2cf6c52f7@dscpl.com.au>


On 04/01/2006, at 9:29 PM, Graham Dumpleton wrote:
> My immediate question is why does Py_Finalize() even need to be called
> within the context of the child process if it is simply being killed 
> off
> anyway. I know that for the Apache main process if doing a restart that
> Py_Finalize() needs to be called as the same process is kept around,
> but for a child process I don't see the point except maybe to flush
> out stderr/stdout which aren't typically used in mod_python anyway.
>
> Time now to work out why python_finalize() needs to be called. Maybe
> it can't simply not do anything when called in the context of the child
> process.

That should have been "can simply" not "can't simply".

Anyway, one could put:

     if (child_init_pool)
         return APR_SUCCESS;

at the start of python_finalize() and that would at least avoid any 
problems
with the signal handler trying to do complicated stuff like call into 
Python
and cause a deadlock.

Even with this, it isn't going to avoid all problems as you can't 
totally
eliminate the possible need for the Apache to forcibly kill the child
process. There simply could be reasons that the signal handler couldn't
run due to signals being blocked for example. For some reason I seem to
be seeing just this case in my test example on Mac OS X and I haven't 
yet
worked out why the python_finalize() function isn't being run, 
suggesting
that the signal handler isn't even being called.

Can you at least try the above little addition to python_finalize() and
see if it makes any difference in your specific case.

Graham

From python_eager at yahoo.com  Wed Jan  4 07:12:21 2006
From: python_eager at yahoo.com (python eager)
Date: Wed Jan  4 07:12:26 2006
Subject: [mod_python] error connecting in oracle 9i
Message-ID: <20060104121221.39115.qmail@web36404.mail.mud.yahoo.com>

Hi
     i am connecting my database oracle 9i. While connecting i am getting the following error
   
  connection = cx_Oracle.connect("haribabu", "saibaba", "python")
RuntimeError: Unable to acquire Oracle environment handle
   
  username = haribabu
  password = saibaba
  hoststring = python
   
  can u solve this problem
   
  Thank you
  regards
  Python Eager
   



__________________________________________________
Do You Yahoo!?
Tired of spam?  Yahoo! Mail has the best spam protection around 
http://mail.yahoo.com 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20060104/d5753a9f/attachment.html
From nlv11281 at natlab.research.philips.com  Wed Jan  4 07:38:14 2006
From: nlv11281 at natlab.research.philips.com (Mike Looijmans)
Date: Wed Jan  4 07:38:24 2006
Subject: [mod_python] Feature Request: Additions to mod_python.util
In-Reply-To: <43BB5B0B.3010908@barriescene.com>
References: <43BB5B0B.3010908@barriescene.com>
Message-ID: <43BBC1B6.8040605@natlab.research.philips.com>

> 2. html(encode|decode) for translating all defined entity characters; 
> currently pythons default cgi.escape only translates "&", "<" and ">", 
> and xml.sax.saxutils.escape is both silly if you're not using sax for 
> anything else, and not convenient as you have to give it the translation 
> table.

I probably understand your question wrong, but...
&<> are the only characters that need escaping, so cgi.escape should be 
sufficient. International characters can be output using the right 
codepage in your header, or by using &...; markups.

 > Also a simple method to unescape these is quite useful aswell.

What would you use it for (I never had any need for it in >5 years of 
server programming in many, many languages)?

From jim at qlf.com  Wed Jan  4 09:45:18 2006
From: jim at qlf.com (Jim Steil)
Date: Wed Jan  4 09:45:22 2006
Subject: [mod_python] Session Management for the beginner
Message-ID: <43BBDF7E.7050107@qlf.com>

Hi, I'm new to mod_python and apache in general, and am confused about 
how to implement session management.  I'm using the Publisher handler 
and PSP templates.

Here is the relevant portion of my http.conf file:

<Directory "c:/program files/apache group/apache2/htdocs/motion">
      AddHandler mod_python .py
      PythonHandler mod_python.publisher
      PythonAuthenHandler myAuthScript
      PythonDebug On
      AuthType Basic
      AuthName "Restricted Area"
      require valid-user
</Directory>

...and here is my python module:

from mod_python import psp

import time
import mx.ODBC
import mx.ODBC.Windows

def secUserList(req, page='', sortSeq=''):
    if page:
        startPage = int(page)
    else:
        startPage = 1
   
    pageLength = 20
   
    sql = 'call secUser_list(\'' + sortSeq + '\', ' + repr(startPage) + 
', ' + repr(pageLength) + ')'
    db = mx.ODBC.Windows.DriverConnect('DSN=motion;UID=userid;PWD=password')
    c = db.cursor()
    c.execute(sql)
   
    htmlText = ''
    for secUserId, firstName, lastName, logonName, email in c.fetchall():
        htmlText = htmlText + '<tr 
onmouseover="style.backgroundColor=\'#FFF0AF\'; style.cursor=\'hand\';" 
onclick="location.href=\'secUserProfile?secUserId=' + "%i" % secUserId + 
'\'" onmouseout="style.backgroundColor=\'#ffffff\';"><td>' + firstName + 
'</td><td>' + lastName + '</td><td>' + logonName + '</td><td>' + email + 
'</td></tr>\n'
       
    previousPage = 1
    if startPage > 1:
        previousPage = startPage - 1
   
    nextPage = startPage + 1
    c.close()
    db.close()
   
    parmDict = {'title':'User List', 'rowHtml':htmlText, 
'previousPage':previousPage, 'nextPage':nextPage, 'startPage':startPage}
   
    template = psp.PSP(req, filename='secUserList.html')
    template.run(vars = parmDict)


My question is;  How do I implement the session?  Where do I put the 
code?  I want to be able to store my database login credentials in the 
session object.  I'm guessing I'm missing something really obvious, but 
can't seem to get my head around it.  Any help or pointers to good 
examples would really be appreciated.

    -Jim

-- 
Jim Steil
IT Manager
Quality Liquid Feeds
(608) 935-2345
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20060104/49c3679e/attachment-0001.html
From blais at furius.ca  Wed Jan  4 11:19:45 2006
From: blais at furius.ca (Martin Blais)
Date: Wed Jan  4 11:19:47 2006
Subject: [mod_python] Re: child process XXXX still did not exit,
	sending a SIGTERM
In-Reply-To: <096aeb5e6def26f49b3952c888cc1b0e@dscpl.com.au>
References: <1136351776.11553@dscpl.user.openhosting.com>
	<8393fff0601032217w3433596n1ce373153464f1cd@mail.gmail.com>
	<096aeb5e6def26f49b3952c888cc1b0e@dscpl.com.au>
Message-ID: <8393fff0601040819i21dadc2csb32d598e94fbf19b@mail.gmail.com>

On 1/4/06, Graham Dumpleton <grahamd@dscpl.com.au> wrote:
>
> The stack trace is a bit bogus from what I can tell. In the various MPMs
> I looked at, the ap_graceful_stop_signalled() function simple sets a
> variable and returns. It doesn't go calling apr_pool_destroy().

I'm still not sure how the normal termination communication message
between the apache parent and its child happens, I thought it was
supposed to be via the scoreboard, but the stack trace seems to
indicate via a signal.  When I attach gdb on the running child prior
to stopping the app, when I stop apache it gets SIGTERM right away,
and not when a timeout occurs.  I guess I should dig in apache and
libc now (won't happen for another 2 weeks, I have some important work
to move on to now for a deadline), to find out how the normal
termination is supposed to occur.

Note that if I attach gdb before I shutdown apache I can't reproduce
this stack trace.  I need to attach after I terminate apache to get to
this.




> Anyway, seeing the stack trace I can see where the problem lies and can
> simulate the situation with a test case.
>
> What it all comes down to is the signal handler for a SIGTERM in the
> child process is registered as:
>
>    apr_signal(SIGTERM, just_die);
>
> Thus when the SIGTERM is received it calls just_die(). The just_die()
> function calls clean_child_exit(), which if there is found to be a
> memory pool in existence for the child process calls apr_pool_destroy()
> on that memory pool.
>
> The problem then is that mod_python registers a cleanup handler
> associated with that memory pool, namely python_finalize(). Ie., it
> calls:
>
>    apr_pool_cleanup_register(p, NULL, python_finalize,
> apr_pool_cleanup_null);
>
> This means that when that memory pool is destroyed, the
> python_finalize()
> function is being called, which is wrong in that situation for a couple
> of reasons.

Maybe we should change the way python_finalize() is being triggered.
Any ideas?


>
> The first reason is that complex things should not be done from inside
> of
> signal handlers unless the code which is called is heavily protected
> against being called by signal handlers when in critical sections. There
> is no way that general Python API functions are going to fall into that
> category.

Indeed.


> The second reason is that at the time that the signal occurs, the main
> program thread is already deep within Python code and probably has
> various
> locks acquired. When the signal handler calls into Py_Finalize() it is

I don't know about that, the trace does not indicate that we're
processing a request at all.  But it could happen I suppose.

What we could/should do on that signal is to simply mark a variable
for later exiting the wait-loop.  That must be somewhere within the
apache libs.  This way we could terminate properly without being in a
signal handler.


> most likely reaching a point where it wants to acquire the same lock
> as the main program thread has and it effectively deadlocks as the
> signal handler can't proceed until it gets the lock, but the main
> program thread can't give it up while the signal handler is running.
>
> At least this is the case on UNIX systems, where signal handlers
> interrupt the execution of the main program thread, unlike Win32 where
> signal handlers are a distinct thread in their own right.
>
> My immediate question is why does Py_Finalize() even need to be called
> within the context of the child process if it is simply being killed off
> anyway. I know that for the Apache main process if doing a restart that
> Py_Finalize() needs to be called as the same process is kept around,
> but for a child process I don't see the point except maybe to flush
> out stderr/stdout which aren't typically used in mod_python anyway.

I'm still not convinced if it is being killed off or asked to
gracefully go down.


> Time now to work out why python_finalize() needs to be called. Maybe
> it can't simply not do anything when called in the context of the child
> process.


> Anyway, one could put:
>
>      if (child_init_pool)
>          return APR_SUCCESS;
>
> at the start of python_finalize() and that would at least avoid any
> problems
> with the signal handler trying to do complicated stuff like call into
> Python
> and cause a deadlock.

> Can you at least try the above little addition to python_finalize() and
> see if it makes any difference in your specific case.

Oh yes.  Problem completely gone... but then again python_finalize is
not being called for any of the children (I checked with some logging
traces), whilst before some of the children managed to terminate
gracefully.

Hmm, I think we either need to find a way to terminate outside of a
signal handler, or to forego calling Py_Finalize entirely (I don't
like the latter "solution").

From jpg at jgassociates.ca  Wed Jan  4 12:24:57 2006
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Wed Jan  4 12:23:58 2006
Subject: [mod_python] Session Management for the beginner
In-Reply-To: <43BBDF7E.7050107@qlf.com>
References: <43BBDF7E.7050107@qlf.com>
Message-ID: <43BC04E9.3090205@jgassociates.ca>

Jim Steil wrote:
> Hi, I'm new to mod_python and apache in general, and am confused about 
> how to implement session management.  I'm using the Publisher handler 
> and PSP templates.
> 
> Here is the relevant portion of my http.conf file:
> 
> <Directory "c:/program files/apache group/apache2/htdocs/motion">
>      AddHandler mod_python .py
>      PythonHandler mod_python.publisher
>      PythonAuthenHandler myAuthScript
>      PythonDebug On
>      AuthType Basic
>      AuthName "Restricted Area"
>      require valid-user
> </Directory>
> 
> ...and here is my python module:
> 
> from mod_python import psp
> 
> import time
> import mx.ODBC
> import mx.ODBC.Windows
> 
> def secUserList(req, page='', sortSeq=''):
>    if page:
>        startPage = int(page)
>    else:
>        startPage = 1
>      pageLength = 20
>      sql = 'call secUser_list(\'' + sortSeq + '\', ' + repr(startPage) + 
> ', ' + repr(pageLength) + ')'
>    db = mx.ODBC.Windows.DriverConnect('DSN=motion;UID=userid;PWD=password')
>    c = db.cursor()
>    c.execute(sql)
>      htmlText = ''
>    for secUserId, firstName, lastName, logonName, email in c.fetchall():
>        htmlText = htmlText + '<tr 
> onmouseover="style.backgroundColor=\'#FFF0AF\'; style.cursor=\'hand\';" 
> onclick="location.href=\'secUserProfile?secUserId=' + "%i" % secUserId + 
> '\'" onmouseout="style.backgroundColor=\'#ffffff\';"><td>' + firstName + 
> '</td><td>' + lastName + '</td><td>' + logonName + '</td><td>' + email + 
> '</td></tr>\n'
>          previousPage = 1
>    if startPage > 1:
>        previousPage = startPage - 1
>      nextPage = startPage + 1
>    c.close()
>    db.close()
>      parmDict = {'title':'User List', 'rowHtml':htmlText, 
> 'previousPage':previousPage, 'nextPage':nextPage, 'startPage':startPage}
>      template = psp.PSP(req, filename='secUserList.html')
>    template.run(vars = parmDict)
> 
> 
> My question is;  How do I implement the session?

from mod_python import Session

   Where do I put the
> code?  

Most likely in your handler, (secUserList?) but it can go where ever you 
  want to access the session data. Make sure you only create one session 
object per request though. If you need to pass it around to other 
functions in a single request then stuff it into your request object.

def secUserList(req):

     # creating the session instance will either load an existing session
     # or create a new one
     req.sess = Session.Session()
     if req.sess.is_new():
         req.sess['visits'] = 0

     req.write('you have visited this page %d times' %
                  req.sess['visits'])

     doSomeOtherStuff(req)
     req.sess['visits'] += 1

     # You must save the session to make it persistent
     req.sess.save()

def doSomeOtherStuff(req):
     req.sess['stuff'] = 'wonderful'


> I want to be able to store my database login credentials in the 
> session object.  I'm guessing I'm missing something really obvious, but 
> can't seem to get my head around it.  

Don't think so hard. ;) It really is as simple as it looks.

> Any help or pointers to good 
> examples would really be appreciated.

Just think of the session object as a persistent dictionary. The correct 
dictionary to load for a request is determined by a cookie which is 
automatically set for you when you create the session.

Jim
From sean at barriescene.com  Wed Jan  4 12:44:31 2006
From: sean at barriescene.com (Sean Jamieson)
Date: Wed Jan  4 12:44:36 2006
Subject: [mod_python] Feature Request: Additions to mod_python.util
In-Reply-To: <43BBC1B6.8040605@natlab.research.philips.com>
References: <43BB5B0B.3010908@barriescene.com>
	<43BBC1B6.8040605@natlab.research.philips.com>
Message-ID: <43BC097F.1060606@barriescene.com>

"or by using &...; markups."
this is exactly the point, the method(s) would translate all of these 
entities, which are defined in the (X)HTML specification

"What would you use it for"
the need has come up many times in my 6 years of web development, for 
varrious reasons.

Mike Looijmans wrote:

>> 2. html(encode|decode) for translating all defined entity characters; 
>> currently pythons default cgi.escape only translates "&", "<" and 
>> ">", and xml.sax.saxutils.escape is both silly if you're not using 
>> sax for anything else, and not convenient as you have to give it the 
>> translation table.
>
>
> I probably understand your question wrong, but...
> &<> are the only characters that need escaping, so cgi.escape should 
> be sufficient. International characters can be output using the right 
> codepage in your header, or by using &...; markups.
>
> > Also a simple method to unescape these is quite useful aswell.
>
> What would you use it for (I never had any need for it in >5 years of 
> server programming in many, many languages)?
>
>
>
From deron.meranda at gmail.com  Wed Jan  4 14:17:44 2006
From: deron.meranda at gmail.com (Deron Meranda)
Date: Wed Jan  4 14:17:48 2006
Subject: [mod_python] Feature Request: Additions to mod_python.util
In-Reply-To: <43BC097F.1060606@barriescene.com>
References: <43BB5B0B.3010908@barriescene.com>
	<43BBC1B6.8040605@natlab.research.philips.com>
	<43BC097F.1060606@barriescene.com>
Message-ID: <5c06fa770601041117y2f12ae19k562e7447f27a4ce7@mail.gmail.com>

> >> 2. html(encode|decode) for translating all defined entity characters;
> >> currently pythons default cgi.escape only translates "&", "<" and
> >> ">", and xml.sax.saxutils.escape is both silly if you're not using
> >> sax for anything else, and not convenient as you have to give it the
> >> translation table.
> >
> >
> > I probably understand your question wrong, but...
> > &<> are the only characters that need escaping, so cgi.escape should
> > be sufficient. International characters can be output using the right
> > codepage in your header, or by using &...; markups.

Remember that cgi.escape can take an optional second parameter,
which when True will also escape the double-quote, ", character.
That is quite useful when the string is part of an attribute value
within an (X)HTML tag.  Then, really, you should have no need to escape
any other character.

The best technique is to simply output UTF-8 documents, writing
the raw unicode characters into the document.  If using unicode
strings in python code, just use the encode string method to get
it into utf8, such as: u'hello'.encode('utf8')

Using UTF-8, you don't need any entity references at all, other than the
four: &amp;, &lt;, &gt;, and &#34 -- which is what cgi.escape
does.

> > > Also a simple method to unescape these is quite useful aswell.

For a simple way, look at the standard htmlentitydefs module.
It should be pretty easy to write a search-replace function which
uses those dictionaries.

Of course to do it correctly is pretty hard, especially in full XML
where you may have things like CDATA sections and such.  So
usually you need to use a full XML parser.
--
Deron Meranda

From jim at qlf.com  Wed Jan  4 18:07:23 2006
From: jim at qlf.com (Jim Steil)
Date: Wed Jan  4 18:07:33 2006
Subject: [mod_python] Session Management for the beginner
In-Reply-To: <43BC04E9.3090205@jgassociates.ca>
References: <43BBDF7E.7050107@qlf.com> <43BC04E9.3090205@jgassociates.ca>
Message-ID: <43BC552B.8030801@qlf.com>

Jim:

Thanks for the info.  However, I'm still having trouble.  I don't know 
if this is the problem, but this code does NOT exist in a handler that I 
wrote.  I didn't write a handler, I'm just using the publisher handler.  
I have written an authentication handler and that is working correctly 
but I don't know what I need to do to make my own handler and have it 
work like the publisher handler.  Again, I'm probably trying too hard 
and not seeing the obvious.  I have been looking all over the web and 
can't seem to find a good custom handler example.

Thanks again, I'll keep plugging away to try to understand what's going on.

    -Jim

Jim Steil
IT Manager
Quality Liquid Feeds
(608) 935-2345


Jim Gallacher wrote:
> Jim Steil wrote:
>> Hi, I'm new to mod_python and apache in general, and am confused 
>> about how to implement session management.  I'm using the Publisher 
>> handler and PSP templates.
>>
>> Here is the relevant portion of my http.conf file:
>>
>> <Directory "c:/program files/apache group/apache2/htdocs/motion">
>>      AddHandler mod_python .py
>>      PythonHandler mod_python.publisher
>>      PythonAuthenHandler myAuthScript
>>      PythonDebug On
>>      AuthType Basic
>>      AuthName "Restricted Area"
>>      require valid-user
>> </Directory>
>>
>> ...and here is my python module:
>>
>> from mod_python import psp
>>
>> import time
>> import mx.ODBC
>> import mx.ODBC.Windows
>>
>> def secUserList(req, page='', sortSeq=''):
>>    if page:
>>        startPage = int(page)
>>    else:
>>        startPage = 1
>>      pageLength = 20
>>      sql = 'call secUser_list(\'' + sortSeq + '\', ' + 
>> repr(startPage) + ', ' + repr(pageLength) + ')'
>>    db = 
>> mx.ODBC.Windows.DriverConnect('DSN=motion;UID=userid;PWD=password')
>>    c = db.cursor()
>>    c.execute(sql)
>>      htmlText = ''
>>    for secUserId, firstName, lastName, logonName, email in c.fetchall():
>>        htmlText = htmlText + '<tr 
>> onmouseover="style.backgroundColor=\'#FFF0AF\'; 
>> style.cursor=\'hand\';" 
>> onclick="location.href=\'secUserProfile?secUserId=' + "%i" % 
>> secUserId + '\'" 
>> onmouseout="style.backgroundColor=\'#ffffff\';"><td>' + firstName + 
>> '</td><td>' + lastName + '</td><td>' + logonName + '</td><td>' + 
>> email + '</td></tr>\n'
>>          previousPage = 1
>>    if startPage > 1:
>>        previousPage = startPage - 1
>>      nextPage = startPage + 1
>>    c.close()
>>    db.close()
>>      parmDict = {'title':'User List', 'rowHtml':htmlText, 
>> 'previousPage':previousPage, 'nextPage':nextPage, 'startPage':startPage}
>>      template = psp.PSP(req, filename='secUserList.html')
>>    template.run(vars = parmDict)
>>
>>
>> My question is;  How do I implement the session?
>
> from mod_python import Session
>
>   Where do I put the
>> code?  
>
> Most likely in your handler, (secUserList?) but it can go where ever 
> you  want to access the session data. Make sure you only create one 
> session object per request though. If you need to pass it around to 
> other functions in a single request then stuff it into your request 
> object.
>
> def secUserList(req):
>
>     # creating the session instance will either load an existing session
>     # or create a new one
>     req.sess = Session.Session()
>     if req.sess.is_new():
>         req.sess['visits'] = 0
>
>     req.write('you have visited this page %d times' %
>                  req.sess['visits'])
>
>     doSomeOtherStuff(req)
>     req.sess['visits'] += 1
>
>     # You must save the session to make it persistent
>     req.sess.save()
>
> def doSomeOtherStuff(req):
>     req.sess['stuff'] = 'wonderful'
>
>
>> I want to be able to store my database login credentials in the 
>> session object.  I'm guessing I'm missing something really obvious, 
>> but can't seem to get my head around it.  
>
> Don't think so hard. ;) It really is as simple as it looks.
>
>> Any help or pointers to good examples would really be appreciated.
>
> Just think of the session object as a persistent dictionary. The 
> correct dictionary to load for a request is determined by a cookie 
> which is automatically set for you when you create the session.
>
> Jim
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20060104/7023d287/attachment.html
From jpg at jgassociates.ca  Wed Jan  4 18:58:43 2006
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Wed Jan  4 18:55:49 2006
Subject: [mod_python] Session Management for the beginner
In-Reply-To: <43BC552B.8030801@qlf.com>
References: <43BBDF7E.7050107@qlf.com> <43BC04E9.3090205@jgassociates.ca>
	<43BC552B.8030801@qlf.com>
Message-ID: <43BC6133.4020405@jgassociates.ca>

Jim Steil wrote:
> Jim:
> 
> Thanks for the info.  However, I'm still having trouble.  I don't know 
> if this is the problem, but this code does NOT exist in a handler that I 
> wrote.  I didn't write a handler, I'm just using the publisher handler.  
> I have written an authentication handler and that is working correctly 
> but I don't know what I need to do to make my own handler and have it 
> work like the publisher handler.  Again, I'm probably trying too hard 
> and not seeing the obvious.  I have been looking all over the web and 
> can't seem to find a good custom handler example.
> 
> Thanks again, I'll keep plugging away to try to understand what's going on.
> 
>    -Jim


I tend to use the term "handler" to refer to anything that handles a 
request, which is just plain wrong. ;) If you want to use the publisher 
handler just drop a script in the appropriate directory and either call 
it (which will used the index method by default) or one of it's other 
methods.

Plop the following in your motion folder and try calling it with 
http://example.com/motion/mptest or 
http://example.com/motion/mptest/secUserList. (Note that the indentation 
may have been messed up when I did the copy and paste from your original 
code). Also note that I forgot the req parameter in my previous Session 
example. :(

You can modify your secUserList.html to make use of the count paramater 
passed to your psp template and see the effect of the session.

Jim

mptest.py
---------

# uses the mod_python.publisher handler

import time
import mx.ODBC
import mx.ODBC.Windows

from mod_python import Session


# url is http://example.com/motion/mptest
def index(req):
     sess = Session.Session(req)
     if sess.is_new():
         sess['count'] = 0
     sess['count'] += 1
     req.content_type = 'text/plain'
     req.write('This is the index page\nVisits: %d\n' % sess['count'])
     sess.save()


# url is http://example.com/motion/mptest/secUserList
def secUserList(req, page='', sortSeq=''):
     sess = Session.Session(req)
     if sess.is_new():
         sess['count'] = 0
     sess['count'] += 1
     sess.save()

     if page:
         startPage = int(page)
     else:
         startPage = 1
     pageLength = 20
     sql = 'call secUser_list(\'' + sortSeq + '\', ' + repr(startPage) + 
', ' + repr(pageLength) + ')'
     db = 
mx.ODBC.Windows.DriverConnect('DSN=motion;UID=userid;PWD=password')
     c = db.cursor()
     c.execute(sql)
     htmlText = ''
     for secUserId, firstName, lastName, logonName, email in c.fetchall():
         htmlText = htmlText + '<tr 
onmouseover="style.backgroundColor=\'#FFF0AF\'; style.cursor=\'hand\';" 
onclick="location.href=\'secUserProfile?secUserId=' + "%i" % secUserId + 
'\'" onmouseout="style.backgroundColor=\'#ffffff\';"><td>' + firstName + 
'</td><td>' + lastName + '</td><td>' + logonName + '</td><td>' + email + 
'</td></tr>\n'
         previousPage = 1
     if startPage > 1:
         previousPage = startPage - 1
         nextPage = startPage + 1
     c.close()
     db.close()
     parmDict = {'count':sess['count'], 'title':'User List', 
'rowHtml':htmlText, 'previousPage':previousPage, 'nextPage':nextPage, 
'startPage':startPage}
     template = psp.PSP(req, filename='secUserList.html')
     template.run(vars = parmDict)



From joeb at mit.edu  Wed Jan  4 22:20:22 2006
From: joeb at mit.edu (Joseph Barillari)
Date: Wed Jan  4 22:20:25 2006
Subject: [mod_python] How can one examine dynamically added handlers?
Message-ID: <20060105032021.GA28980@barillari.org>

Hi,

I'm a big fan of mod_python -- I've been using it for a few days and
it's been great so far.

I'm a bit confused by the add_handler function, though.  Is there any
way to get a list (from within the PDB, for instance) of all the
dynamically registered handlers for a given request?

Because add_handler fails silently if the supplied handler is bogus,
it's not easy to figure out where problems lie. If I add a
PythonHandler with add_handler, and it doesn't get executed, is there
an easy way to tell if it didn't get executed because it (a) wasn't
the first handler on the list, (b) had an invalid module name, or (c)
some other reason?

I've dug around in the source; it appears that the handlers for future
phases (i.e., not the current phase) are stored in request_req->pool,
which isn't visible from within Python.

                         
If specificity helps, my current problem is this: I have the following
two lines in a PythonTransHandler:

req.add_handler("PythonLogHandler","mptest::loghandler")
req.add_handler("PythonHandler","mptest::handler")

The PythonLogHandler gets executed, but the PythonHandler doesn't. I
suspect this is because the default action for log-handlers is to
execute everything, but the default action for content handlers
(PythonHandler) is to execute only the first handler in the list -- so
the default apache handler gets executed instead. I'm not sure how to
override this using add_handler.

thanks in advance,

Joe
From grahamd at dscpl.com.au  Wed Jan  4 22:56:23 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Wed Jan  4 22:56:31 2006
Subject: [mod_python] How can one examine dynamically added handlers?
Message-ID: <1136433383.7083@dscpl.user.openhosting.com>

Joseph Barillari wrote ..
> I'm a big fan of mod_python -- I've been using it for a few days and
> it's been great so far.

Yet you seem to be diving straight into a complex area of mod_python
where few if any people dwell. Ie., most wouldn't use dynamic registration
of handlers.

> I'm a bit confused by the add_handler function, though.  Is there any
> way to get a list (from within the PDB, for instance) of all the
> dynamically registered handlers for a given request?

The handlers of the current executing handler phase are available in
"req.hlist". Unfortunately, the only way of seeing the complete list is
to iterative call "req.hlist.next()" which has the side effect of discarding
that at the head of the list. In other words, to seem them you actually
unravel the list. If doing it from inside Pdb session and you are going
to abort the request, probably not a problem, in other circumstances
unravelling the list will prevent later handlers from running as they
will be deregistered. There is no way of interogating from Pdb the
handlers for a later phase.

> Because add_handler fails silently if the supplied handler is bogus,
> it's not easy to figure out where problems lie. If I add a
> PythonHandler with add_handler, and it doesn't get executed, is there
> an easy way to tell if it didn't get executed because it (a) wasn't
> the first handler on the list, (b) had an invalid module name, or (c)
> some other reason?

First off, ensure you are using mod_python 3.2.5b at least. Some
handler registration issues when using PythonHandlerModule and
other cases are dealt with in that. Better reporting of other issues can
be obtained by applying the changes mentioned in:

  http://issues.apache.org/jira/browse/MODPYTHON-98

on top of 3.2.5b.

> If specificity helps, my current problem is this: I have the following
> two lines in a PythonTransHandler:
> 
> req.add_handler("PythonLogHandler","mptest::loghandler")
> req.add_handler("PythonHandler","mptest::handler")
> 
> The PythonLogHandler gets executed, but the PythonHandler doesn't.

In your .htaccess file for that directory or other appropriate place
in Apache configuration for that directory, actually have:

  SetHandler mod_python

or:

  AddHandler mod_python .ext

where ".ext" is replaced with what ever extension the URL will have
you are using to access the resource?

Without one of these, a PythonHandler will not be called, whether it
be specified in the Apache configuration or add dynamically using
req.add_handler() by an earlier handler phase.

> I suspect this is because the default action for log-handlers is to
> execute everything, but the default action for content handlers
> (PythonHandler) is to execute only the first handler in the list -- so
> the default apache handler gets executed instead. I'm not sure how to
> override this using add_handler.

All handlers in any phase will be executed provided that each returns
apache.OK. If they return any other value processing of further handlers
in that phase will be aborted. Aborting in a phase, can cause later
phases to be aborted as well, except for PythonLogHandler which is
always called regardless.

The other return types that a handler could return are apache.DECLINED
which will cause aborting of just that phase and Apache will go looking
for inbuilt handlers that might instead apply to the request. Eg, serving
up a static file. Later phases still run in this case. If apache.DONE is
returned, it indicates that handler has responded with a complete
response, including setting appropriate status in request object. As such
any further handlers in that phase or latter phases will be skipped.

Handlers may also return various HTTP error code responses which again
will cause subsequent handlers to that phase and later phases to be skipped.

Thus, what happens depends on what your return from your handler.

Graham
From jim at qlf.com  Thu Jan  5 01:06:30 2006
From: jim at qlf.com (Jim Steil)
Date: Thu Jan  5 01:06:39 2006
Subject: [mod_python] Session Management for the beginner
In-Reply-To: <43BC6133.4020405@jgassociates.ca>
References: <43BBDF7E.7050107@qlf.com> <43BC04E9.3090205@jgassociates.ca>
	<43BC552B.8030801@qlf.com> <43BC6133.4020405@jgassociates.ca>
Message-ID: <43BCB766.9010507@qlf.com>

Ok, now I get it, and have it working.  I'm pretty sure my problem was 
that I was trying to seed the session with some values in my 
authentication handler and then grab the values when it got to my 
secUserList handler.  I took the stuff out of my authentication handler 
and now it works fine.  But, I'm interested in pursuing something you 
wrote in your earlier post saying that I could pass the session object 
in the req object.  I may give that a try tomorrow.  Otherwise, I'll 
assuming I could set my values in a cookie and read them later.

Thanks for the help, and especially for sticking with me until I 
understood what was going on.  Things are much clearer now for me.

    -Jim

Jim Steil
IT Manager
Quality Liquid Feeds
(608) 935-2345


Jim Gallacher wrote:
> Jim Steil wrote:
>> Jim:
>>
>> Thanks for the info.  However, I'm still having trouble.  I don't 
>> know if this is the problem, but this code does NOT exist in a 
>> handler that I wrote.  I didn't write a handler, I'm just using the 
>> publisher handler.  I have written an authentication handler and that 
>> is working correctly but I don't know what I need to do to make my 
>> own handler and have it work like the publisher handler.  Again, I'm 
>> probably trying too hard and not seeing the obvious.  I have been 
>> looking all over the web and can't seem to find a good custom handler 
>> example.
>>
>> Thanks again, I'll keep plugging away to try to understand what's 
>> going on.
>>
>>    -Jim
>
>
> I tend to use the term "handler" to refer to anything that handles a 
> request, which is just plain wrong. ;) If you want to use the 
> publisher handler just drop a script in the appropriate directory and 
> either call it (which will used the index method by default) or one of 
> it's other methods.
>
> Plop the following in your motion folder and try calling it with 
> http://example.com/motion/mptest or 
> http://example.com/motion/mptest/secUserList. (Note that the 
> indentation may have been messed up when I did the copy and paste from 
> your original code). Also note that I forgot the req parameter in my 
> previous Session example. :(
>
> You can modify your secUserList.html to make use of the count 
> paramater passed to your psp template and see the effect of the session.
>
> Jim
>
> mptest.py
> ---------
>
> # uses the mod_python.publisher handler
>
> import time
> import mx.ODBC
> import mx.ODBC.Windows
>
> from mod_python import Session
>
>
> # url is http://example.com/motion/mptest
> def index(req):
>     sess = Session.Session(req)
>     if sess.is_new():
>         sess['count'] = 0
>     sess['count'] += 1
>     req.content_type = 'text/plain'
>     req.write('This is the index page\nVisits: %d\n' % sess['count'])
>     sess.save()
>
>
> # url is http://example.com/motion/mptest/secUserList
> def secUserList(req, page='', sortSeq=''):
>     sess = Session.Session(req)
>     if sess.is_new():
>         sess['count'] = 0
>     sess['count'] += 1
>     sess.save()
>
>     if page:
>         startPage = int(page)
>     else:
>         startPage = 1
>     pageLength = 20
>     sql = 'call secUser_list(\'' + sortSeq + '\', ' + repr(startPage) 
> + ', ' + repr(pageLength) + ')'
>     db = 
> mx.ODBC.Windows.DriverConnect('DSN=motion;UID=userid;PWD=password')
>     c = db.cursor()
>     c.execute(sql)
>     htmlText = ''
>     for secUserId, firstName, lastName, logonName, email in c.fetchall():
>         htmlText = htmlText + '<tr 
> onmouseover="style.backgroundColor=\'#FFF0AF\'; 
> style.cursor=\'hand\';" 
> onclick="location.href=\'secUserProfile?secUserId=' + "%i" % secUserId 
> + '\'" onmouseout="style.backgroundColor=\'#ffffff\';"><td>' + 
> firstName + '</td><td>' + lastName + '</td><td>' + logonName + 
> '</td><td>' + email + '</td></tr>\n'
>         previousPage = 1
>     if startPage > 1:
>         previousPage = startPage - 1
>         nextPage = startPage + 1
>     c.close()
>     db.close()
>     parmDict = {'count':sess['count'], 'title':'User List', 
> 'rowHtml':htmlText, 'previousPage':previousPage, 'nextPage':nextPage, 
> 'startPage':startPage}
>     template = psp.PSP(req, filename='secUserList.html')
>     template.run(vars = parmDict)
>
>
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20060105/e4509ad6/attachment.html
From joeb at mit.edu  Thu Jan  5 19:08:36 2006
From: joeb at mit.edu (Joseph Barillari)
Date: Thu Jan  5 19:08:44 2006
Subject: [mod_python] How can one examine dynamically added handlers?
In-Reply-To: <1136433383.7083@dscpl.user.openhosting.com>
References: <1136433383.7083@dscpl.user.openhosting.com>
Message-ID: <20060106000834.GA21954@barillari.org>

On Wed, Jan 04, 2006 at 10:56:23PM -0500, Graham Dumpleton wrote:
> Joseph Barillari wrote ..
> > I'm a big fan of mod_python -- I've been using it for a few days and
> > it's been great so far.
> 
> Yet you seem to be diving straight into a complex area of mod_python
> where few if any people dwell. Ie., most wouldn't use dynamic registration
> of handlers.

I can get the same effect by inserting conditionals into statically
registered handlers, without resorting to dynamic registration. I'd
thought add_handler() would make for a cleaner setup, but it looks
like it would markedly increase the debugging complexity.

Thank you for the detailed explanation of handler registration -- I
hadn't realized that Apache wouldn't call a (statically or
dynamically) registered PythonHandler unless a SetHandler directive
was present.

best,

Joe
From grahamd at dscpl.com.au  Thu Jan  5 19:31:18 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Thu Jan  5 19:31:28 2006
Subject: [mod_python] How can one examine dynamically added handlers?
Message-ID: <1136507478.30673@dscpl.user.openhosting.com>

Joseph Barillari wrote ..
> I hadn't realized that Apache wouldn't call a (statically or
> dynamically) registered PythonHandler unless a SetHandler directive
> was present.

As I said, you seem to have jumped right into the complex stuff. Usually
people start out with PythonHandler's registered in the configuration file
and thus they find out pretty quickly that PythonHandler must be paired
with SetHandler or AddHandler. Note that SetHandler or AddHandler is
not needed for any other phases, only that for the content handler phase
as specified using PythonHandler.

Graham
From python_eager at yahoo.com  Fri Jan  6 00:32:16 2006
From: python_eager at yahoo.com (python eager)
Date: Fri Jan  6 00:32:20 2006
Subject: [mod_python] error connecting database oracle 9i
Message-ID: <20060106053216.97500.qmail@web36403.mail.mud.yahoo.com>

    Hi
    i trying to connect oracle 9i through python . While connecting i am facing follwing the error
  
connection = cx_Oracle.connect("myusername", "mypassword", "mydatabase")
 RuntimeError: Unable to acquire Oracle environment handle
 
  path of  ORACLE_HOME = C:\oracle\ora92\BIN;C:\PYTHON24;C:\WINDOWS\system32;C:\WINDOWS\System32\Wbem

   please solve this problem

i am waiting for your reply
   
  regards
  Python _Eager
   



__________________________________________________
Do You Yahoo!?
Tired of spam?  Yahoo! Mail has the best spam protection around 
http://mail.yahoo.com 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20060105/131ddd79/attachment.html
From nick at dd.revealed.net  Fri Jan  6 10:21:32 2006
From: nick at dd.revealed.net (Nick)
Date: Fri Jan  6 10:21:39 2006
Subject: [mod_python] error connecting database oracle 9i
In-Reply-To: <20060106053216.97500.qmail@web36403.mail.mud.yahoo.com>
References: <20060106053216.97500.qmail@web36403.mail.mud.yahoo.com>
Message-ID: <43BE8AFC.7040700@dd.revealed.net>

It's been a couple years since I worked with cx_Oracle in mod_python, I 
believe I got around this problem by setting ORACLE_HOME in the global 
/etc/profile.  But that was a much older version of cx_Oracle, and 
ORACLE_HOME may have been statically compiled into the library.

You may be able to directly insert ORACLE_HOME into os.environ before 
importing cx_Oracle.

Nick

python eager wrote:
> 
> Hi
>   i trying to connect oracle 9i through python . While connecting i am 
> facing follwing the error
> 
> connection = cx_Oracle.connect("myusername", "mypassword", "mydatabase")
>  RuntimeError: Unable to acquire Oracle environment handle
>  
> path of  ORACLE_HOME = 
> C:\oracle\ora92\BIN;C:\PYTHON24;C:\WINDOWS\system32;C:\WINDOWS\System32\Wbem
>  please solve this problem
> 
> i am waiting for your reply
>  
> regards
> Python _Eager
>  
> 
> __________________________________________________
> Do You Yahoo!?
> Tired of spam? Yahoo! Mail has the best spam protection around
> http://mail.yahoo.com
> 
> 
> ------------------------------------------------------------------------
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python

From nick at dd.revealed.net  Fri Jan  6 10:27:53 2006
From: nick at dd.revealed.net (Nick)
Date: Fri Jan  6 10:27:58 2006
Subject: [mod_python] error connecting database oracle 9i
In-Reply-To: <43BE8AFC.7040700@dd.revealed.net>
References: <20060106053216.97500.qmail@web36403.mail.mud.yahoo.com>
	<43BE8AFC.7040700@dd.revealed.net>
Message-ID: <43BE8C79.2070304@dd.revealed.net>

Well I just noticed that you're on windows, so the /etc/profile thing isn't 
going to help, but you may be able to set ORACLE_HOME in the environment 
variables for whatever user apache runs as on windows (I'm assuming you 
don't run it as SYSTEM; that's probably a bad idea).

Or my other suggestion should work fine for you.

Nick

Nick wrote:
> It's been a couple years since I worked with cx_Oracle in mod_python, I 
> believe I got around this problem by setting ORACLE_HOME in the global 
> /etc/profile.  But that was a much older version of cx_Oracle, and 
> ORACLE_HOME may have been statically compiled into the library.
> 
> You may be able to directly insert ORACLE_HOME into os.environ before 
> importing cx_Oracle.
> 
> Nick
> 
> python eager wrote:
> 
>>
>> Hi
>>   i trying to connect oracle 9i through python . While connecting i am 
>> facing follwing the error
>>
>> connection = cx_Oracle.connect("myusername", "mypassword", "mydatabase")
>>  RuntimeError: Unable to acquire Oracle environment handle
>>  
>> path of  ORACLE_HOME = 
>> C:\oracle\ora92\BIN;C:\PYTHON24;C:\WINDOWS\system32;C:\WINDOWS\System32\Wbem 
>>
>>  please solve this problem
>>
>> i am waiting for your reply
>>  
>> regards
>> Python _Eager
>>  
>>
>> __________________________________________________
>> Do You Yahoo!?
>> Tired of spam? Yahoo! Mail has the best spam protection around
>> http://mail.yahoo.com
>>
>>
>> ------------------------------------------------------------------------
>>
>> _______________________________________________
>> Mod_python mailing list
>> Mod_python@modpython.org
>> http://mailman.modpython.org/mailman/listinfo/mod_python
> 
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python

From steve.morin at gmail.com  Fri Jan  6 12:12:50 2006
From: steve.morin at gmail.com (steve morin)
Date: Fri Jan  6 12:12:54 2006
Subject: [mod_python] xmlrpc over mod_python
Message-ID: <fc048bcb0601060912j45d3f060p5a79707723bd559b@mail.gmail.com>

Does anyone have any experience serving xmlrpc from a mod_python set
up for scalability?
Or can anyone point me in the right direction?  I have been searching
online for references and haven't found any.
Steve
--


Lisp Programming - You don't know what your missing ...

======================================
Help Send Laurie to Veterinary School
http://www.sendlaurietovetschool.com

From azaroth at liverpool.ac.uk  Fri Jan  6 12:24:28 2006
From: azaroth at liverpool.ac.uk (Robert Sanderson)
Date: Fri Jan  6 12:24:31 2006
Subject: [mod_python] xmlrpc over mod_python
In-Reply-To: <fc048bcb0601060912j45d3f060p5a79707723bd559b@mail.gmail.com>
References: <fc048bcb0601060912j45d3f060p5a79707723bd559b@mail.gmail.com>
Message-ID: <Pine.GSO.4.58.0601061723240.25726@uxa.liv.ac.uk>


>Does anyone have any experience serving xmlrpc from a mod_python set
>up for scalability?

Yep.  Or at least SOAP and REST, if not actual xmlrpc.

>Or can anyone point me in the right direction?  I have been searching
>online for references and haven't found any.

We use ZSI + mod_python and haven't run into any trouble so far.

Rob
From grahamd at dscpl.com.au  Fri Jan  6 16:32:26 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Fri Jan  6 16:32:41 2006
Subject: [mod_python] xmlrpc over mod_python
In-Reply-To: <fc048bcb0601060912j45d3f060p5a79707723bd559b@mail.gmail.com>
References: <fc048bcb0601060912j45d3f060p5a79707723bd559b@mail.gmail.com>
Message-ID: <1FC08311-035C-4AAC-9DD8-9CE174EAF4A8@dscpl.com.au>


On 07/01/2006, at 4:12 AM, steve morin wrote:

> Does anyone have any experience serving xmlrpc from a mod_python set
> up for scalability?
> Or can anyone point me in the right direction?  I have been searching
> online for references and haven't found any.

It certainly can be done. Can you be more specific about your concerns?

As to implementations showing how one can integrate mod_python and
XML-RPC together see XML-RPC service wrapper in Vampire:

   http://svn.dscpl.com.au/vampire/trunk/software/vampire/xmlrpc.py
   http://www.dscpl.com.au/projects/vampire
   http://www.dscpl.com.au/projects/vampire/articles/ 
vampire-001.html#implementing-web-services

Someone else has another implementation at:

   http://www.saddi.com/software/xmlrpchandler/

Depending on exactly what you are trying to do and how sophisticated
you need to get, might be able to suggest other options you can explore
as well.

Graham
From joeb at mit.edu  Fri Jan  6 17:35:20 2006
From: joeb at mit.edu (Joseph Barillari)
Date: Fri Jan  6 17:35:25 2006
Subject: [mod_python] xmlrpc over mod_python
In-Reply-To: <1FC08311-035C-4AAC-9DD8-9CE174EAF4A8@dscpl.com.au>
References: <fc048bcb0601060912j45d3f060p5a79707723bd559b@mail.gmail.com>
	<1FC08311-035C-4AAC-9DD8-9CE174EAF4A8@dscpl.com.au>
Message-ID: <20060106223519.GI10543@barillari.org>

On Sat, Jan 07, 2006 at 08:32:26AM +1100, Graham Dumpleton wrote:
> 
> On 07/01/2006, at 4:12 AM, steve morin wrote:
> 
> >Does anyone have any experience serving xmlrpc from a mod_python set
> >up for scalability?
> >Or can anyone point me in the right direction?  I have been searching
> >online for references and haven't found any.
> 
> It certainly can be done. Can you be more specific about your concerns?
> 
> As to implementations showing how one can integrate mod_python and
> XML-RPC together see XML-RPC service wrapper in Vampire:
> 
>   http://svn.dscpl.com.au/vampire/trunk/software/vampire/xmlrpc.py
>   http://www.dscpl.com.au/projects/vampire
>   http://www.dscpl.com.au/projects/vampire/articles/ 
> vampire-001.html#implementing-web-services
> 
> Someone else has another implementation at:
> 
>   http://www.saddi.com/software/xmlrpchandler/

Yet another implementation (that I haven't yet tested) is here:

http://quackmaster.net/index.py/MiniProjects

Joe
From listspam at flowtheory.net  Fri Jan  6 19:15:59 2006
From: listspam at flowtheory.net (Joshua Ginsberg)
Date: Fri Jan  6 19:16:48 2006
Subject: [mod_python] xmlrpc over mod_python
In-Reply-To: <fc048bcb0601060912j45d3f060p5a79707723bd559b@mail.gmail.com>
References: <fc048bcb0601060912j45d3f060p5a79707723bd559b@mail.gmail.com>
Message-ID: <1136592959.27028.15.camel@localhost.localdomain>

Other options to consider --

SimpleXMLRPCServer can be easily embedded in mod_python... if you just
need a small handful of methods, go this route. It's especially nice for
doing simple wrappers around existing Python library functions.

Zope3 is certainly a more enterprise way to go -- ZODB objects' methods
can be called via XMLRPC.

The scalability of XMLRPC with mod_python will have everything to do
with the XML parser you use and the engineering of your code. It is
unlikely that mod_python would be a bottleneck to effective XMLRPC
serving.

-jag

On Fri, 2006-01-06 at 12:12 -0500, steve morin wrote:
> Does anyone have any experience serving xmlrpc from a mod_python set
> up for scalability?
> Or can anyone point me in the right direction?  I have been searching
> online for references and haven't found any.
> Steve
> --
> 
> 
> Lisp Programming - You don't know what your missing ...
> 
> ======================================
> Help Send Laurie to Veterinary School
> http://www.sendlaurietovetschool.com
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python

From sean at barriescene.com  Fri Jan  6 21:51:33 2006
From: sean at barriescene.com (Sean Jamieson)
Date: Fri Jan  6 21:51:42 2006
Subject: [mod_python] Session expires early
Message-ID: <43BF2CB5.9050301@barriescene.com>

Does anyone know why, or has anyone else notices, that a session seems 
to time out reguardless of when it was last accessed?
i.e. I'm browsing along for 20-30 minutes, and then the I click a link 
after being idle less than 5 minutes, and suddenly my session is expired.

This even happend today when I was showing something to a client, on my 
laptop.
From celavi at 163.com  Sat Jan  7 07:50:21 2006
From: celavi at 163.com (celavi)
Date: Sat Jan  7 08:35:57 2006
Subject: [mod_python] [SPAM] unsubscribe
Message-ID: <000e01c61388$ec389910$0312a8c0@dingyj>


-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20060107/63869b07/attachment.html
From nogradi at gmail.com  Sat Jan  7 15:50:23 2006
From: nogradi at gmail.com (Daniel Nogradi)
Date: Sat Jan  7 15:50:28 2006
Subject: [mod_python] streaming zipped data with publisher
Message-ID: <5f56302b0601071250i42a8222cgbddf330e85f715be@mail.gmail.com>

Is it possible to "stream" zipped data using the publisher handler?

In my situation I would create the zipped archive upon client input
and want to return the archive immediately. What I have in mind is
creating a zip archive (using the zipfile module perhaps) in memory
and than sending that to the client without actually creating a zip
file on the disk of the server.

In case this would not be possible I could live with creating a
temporary file and returning that to the client, but at the moment the
only way I can do this is through a link (such as <a
href='data.zip'>click here</a>)  but in this case it would be a 2-step
process: (1) user clicks on something which creates the archive and
sends back the link in html (2) user clicks on the link. Is it not
possible to send the zip file immediately after its creation?

From sean at barriescene.com  Sat Jan  7 16:55:55 2006
From: sean at barriescene.com (Sean Jamieson)
Date: Sat Jan  7 16:56:08 2006
Subject: [mod_python] streaming zipped data with publisher
In-Reply-To: <5f56302b0601071250i42a8222cgbddf330e85f715be@mail.gmail.com>
References: <5f56302b0601071250i42a8222cgbddf330e85f715be@mail.gmail.com>
Message-ID: <43C038EB.60102@barriescene.com>

Sure it is, even with the temporary file option, all you have to do is 
set the content-type header to application/x-gzipped or something like 
that (application/octet-stream is always a fallback value; this forces 
download, and doesn't allow it to recognize the file format for use with 
an external application), then output the file (possibly setting the 
Content-Length header first, to be polite)

with or with out the file is your choice, all you have to do is output 
the binary data, and no other output (not even a single space) or you 
will corrupt it.

Daniel Nogradi wrote:

>Is it possible to "stream" zipped data using the publisher handler?
>
>In my situation I would create the zipped archive upon client input
>and want to return the archive immediately. What I have in mind is
>creating a zip archive (using the zipfile module perhaps) in memory
>and than sending that to the client without actually creating a zip
>file on the disk of the server.
>
>In case this would not be possible I could live with creating a
>temporary file and returning that to the client, but at the moment the
>only way I can do this is through a link (such as <a
>href='data.zip'>click here</a>)  but in this case it would be a 2-step
>process: (1) user clicks on something which creates the archive and
>sends back the link in html (2) user clicks on the link. Is it not
>possible to send the zip file immediately after its creation?
>
>_______________________________________________
>Mod_python mailing list
>Mod_python@modpython.org
>http://mailman.modpython.org/mailman/listinfo/mod_python
>
>
>  
>

From grahamd at dscpl.com.au  Sat Jan  7 20:15:02 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Sat Jan  7 20:15:20 2006
Subject: [mod_python] streaming zipped data with publisher
In-Reply-To: <43C038EB.60102@barriescene.com>
References: <5f56302b0601071250i42a8222cgbddf330e85f715be@mail.gmail.com>
	<43C038EB.60102@barriescene.com>
Message-ID: <f67813665ac250d00d1a912e7b0e2a30@dscpl.com.au>

On 08/01/2006, at 8:55 AM, Sean Jamieson wrote:

> Sure it is, even with the temporary file option, all you have to do is 
> set the content-type header to application/x-gzipped or something like 
> that (application/octet-stream is always a fallback value; this forces 
> download, and doesn't allow it to recognize the file format for use 
> with an external application), then output the file (possibly setting 
> the Content-Length header first, to be polite)
>
> with or with out the file is your choice, all you have to do is output 
> the binary data, and no other output (not even a single space) or you 
> will corrupt it.
>
> Daniel Nogradi wrote:
>
>> Is it possible to "stream" zipped data using the publisher handler?
>>
>> In my situation I would create the zipped archive upon client input
>> and want to return the archive immediately. What I have in mind is
>> creating a zip archive (using the zipfile module perhaps) in memory
>> and than sending that to the client without actually creating a zip
>> file on the disk of the server.
>>
>> In case this would not be possible I could live with creating a
>> temporary file and returning that to the client, but at the moment the
>> only way I can do this is through a link (such as <a
>> href='data.zip'>click here</a>)  but in this case it would be a 2-step
>> process: (1) user clicks on something which creates the archive and
>> sends back the link in html (2) user clicks on the link. Is it not
>> possible to send the zip file immediately after its creation?

I am not sure you are talking about the same thing here. The "zipfile"
module is for creating an archive containing other enclosed files.
This is different to merely compressing any output returned from a
handler.

If it was the case that it is only about compressing the output, doing
it inside a published function is possibly not a good idea anyway. A
better way would be to use the DEFLATE output filter as implemented by
the Apache mod_deflate module.

This module is however only available in Apache 2.0 and is not compiled
in by default, so you have to enable its inclusion when "configure" is
run prior to building Apache. Also, at the moment, because mod_python
doesn't allow dynamic registration of output filters from a handler,
it would apply to all requests in a directory, or those returning a
certain type of output, or possibly by URL if you are tricky.

Also should be pointed out that mod_deflate will only compress output
where the client says it is willing to accept it as gzip'd data by
having set the "Accept-Encoding: gzip" incoming header. One can forcibly
set this though from a handler to force it to do it anyway.

Anyway, the point I am trying to make is there are perhaps better tools
for doing the job than trying to compress on the fly in Python code 
running
under mod_python, although technically one could write the equivalent of
mod_deflate in Python if you wanted to. If you did write it in Python
though, you would still be better off installing it as an output filter.
For it all to work nicely may have to wait until mod_python 3.3 though,
where I hope to get some improvements made to working with filters.

   http://issues.apache.org/jira/browse/MODPYTHON-103
   http://issues.apache.org/jira/browse/MODPYTHON-104

Anyway, back to the original posters question. If I read the code for 
the
"zipfile" module correctly, when you use the ZipFile class with "w" mode
to create a zip file, the first argument only needs to be a file like
object. That is, it doesn't need to be a actual file on disk. Instead it
could be an instance of the StringIO class. I have not use ZipFile to
create an archive, but something perhaps like the following may work.

   import zipfile
   import StringIO

   buffer = StringIO.StringIO()
   myzip = zipfile.ZipFile(buffer,"w")

   ... build up zip

   myzip.close()

   data = buffer.getvalue()

After this, your zip file as a string will be in data and you can then
return it as the response content.

Graham

From courtneyludwin at yahoo.com  Sat Jan  7 22:56:32 2006
From: courtneyludwin at yahoo.com (courtney ludwin)
Date: Sat Jan  7 22:56:34 2006
Subject: [mod_python] Feature Request: Additions to mod_python.util
In-Reply-To: <43BB5B0B.3010908@barriescene.com>
Message-ID: <20060108035632.33216.qmail@web34809.mail.mud.yahoo.com>

Yo Sean,
I just wrote the encode/decode functions recently and
posted them on by blog:
http://2centspoorer.blogspot.com/2006/01/urlencoderdecoder-for-python.html

regards,
Courtney


anyway here it is...


_keys = [
  "$", "&", "+", ",", "/", ":", ";", "=", "?", "@", "
", '"',
  "<", ">", "#", "%", "{", "}", "|", "\\", "^", "~",
"[", "]", "`"]

_vals = [
  '%24', '%26', '%2B', '%2C', '%2F', '%3A', '%3B',
'%3D', '%3F',
  '%40', '%20', '%22', '%3C', '%3E', '%23', '%25',
'%7B', '%7D',
  '%7C', '%5C', '%5E', '%7E', '%5B', '%5D', '%60']

def encode(str=""): 
  """ URL Encodes a string with out side effects
  """
  return "".join([_swap(x) for x in str])

def decode(str=""):
  """ Takes a URL encoded string and decodes it with
out side effects
  """
  if not str: return None
  for v in _vals:
    if v in str: str = str.replace(v,
_keys[_vals.index(v)])
  return str 

def _swap(x):
  """ Helper function for encode. 
  """
  if x in _keys: return _vals[_keys.index(x)]
  return x

### units ###
if __name__ == "__main__":
  assert("".join(_keys) ==
decode(encode("".join(_keys))))
  assert("".join(_vals) ==
encode(decode("".join(_vals))))
  print "passed all unit tests."




--- Sean Jamieson <sean@barriescene.com> wrote:

> Hi, I don't know if what I'm about to ask has
> already been requested, or 
> if this is the right list, but here I go:
> 
> I have been using mod_python for about 3 weeks now,
> and have come up 
> with a few things that I'd like to see added into
> the util module (I'm 
> assuming this might be the right place for them).
> 
> 1. a refresh() sibling to the redirect() function; I
> use the Refresh 
> header quite often in my applications.
> 
> 2. html(encode|decode) for translating all defined
> entity characters; 
> currently pythons default cgi.escape only translates
> "&", "<" and ">", 
> and xml.sax.saxutils.escape is both silly if you're
> not using sax for 
> anything else, and not convenient as you have to
> give it the translation 
> table. Also a simple method to unescape these is
> quite useful aswell.
> 
> I've thought of other things aswell, but I can't
> remember what they were 
> right now :-)
> 
> This is a great project, keep up the good work.
> 
> Thanks,
> Sean
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
>
http://mailman.modpython.org/mailman/listinfo/mod_python
> 



		
__________________________________________ 
Yahoo! DSL ? Something to write home about. 
Just $16.99/mo. or less. 
dsl.yahoo.com 

From courtneyludwin at yahoo.com  Sat Jan  7 23:13:55 2006
From: courtneyludwin at yahoo.com (courtney ludwin)
Date: Sat Jan  7 23:13:57 2006
Subject: [mod_python] Feature Request: Additions to mod_python.util
In-Reply-To: <20060108035632.33216.qmail@web34809.mail.mud.yahoo.com>
Message-ID: <20060108041355.60641.qmail@web34808.mail.mud.yahoo.com>

I misread,
My reply was for "URL" (encode/decode)ing not html
(ecnode/decode)ing.

Sorry bout that,
Courtney

--- courtney ludwin <courtneyludwin@yahoo.com> wrote:

> Yo Sean,
> I just wrote the encode/decode functions recently
> and
> posted them on by blog:
>
http://2centspoorer.blogspot.com/2006/01/urlencoderdecoder-for-python.html
> 
> regards,
> Courtney
> 
> 
> anyway here it is...
> 
> 
> _keys = [
>   "$", "&", "+", ",", "/", ":", ";", "=", "?", "@",
> "
> ", '"',
>   "<", ">", "#", "%", "{", "}", "|", "\\", "^", "~",
> "[", "]", "`"]
> 
> _vals = [
>   '%24', '%26', '%2B', '%2C', '%2F', '%3A', '%3B',
> '%3D', '%3F',
>   '%40', '%20', '%22', '%3C', '%3E', '%23', '%25',
> '%7B', '%7D',
>   '%7C', '%5C', '%5E', '%7E', '%5B', '%5D', '%60']
> 
> def encode(str=""): 
>   """ URL Encodes a string with out side effects
>   """
>   return "".join([_swap(x) for x in str])
> 
> def decode(str=""):
>   """ Takes a URL encoded string and decodes it with
> out side effects
>   """
>   if not str: return None
>   for v in _vals:
>     if v in str: str = str.replace(v,
> _keys[_vals.index(v)])
>   return str 
> 
> def _swap(x):
>   """ Helper function for encode. 
>   """
>   if x in _keys: return _vals[_keys.index(x)]
>   return x
> 
> ### units ###
> if __name__ == "__main__":
>   assert("".join(_keys) ==
> decode(encode("".join(_keys))))
>   assert("".join(_vals) ==
> encode(decode("".join(_vals))))
>   print "passed all unit tests."
> 
> 
> 
> 
> --- Sean Jamieson <sean@barriescene.com> wrote:
> 
> > Hi, I don't know if what I'm about to ask has
> > already been requested, or 
> > if this is the right list, but here I go:
> > 
> > I have been using mod_python for about 3 weeks
> now,
> > and have come up 
> > with a few things that I'd like to see added into
> > the util module (I'm 
> > assuming this might be the right place for them).
> > 
> > 1. a refresh() sibling to the redirect() function;
> I
> > use the Refresh 
> > header quite often in my applications.
> > 
> > 2. html(encode|decode) for translating all defined
> > entity characters; 
> > currently pythons default cgi.escape only
> translates
> > "&", "<" and ">", 
> > and xml.sax.saxutils.escape is both silly if
> you're
> > not using sax for 
> > anything else, and not convenient as you have to
> > give it the translation 
> > table. Also a simple method to unescape these is
> > quite useful aswell.
> > 
> > I've thought of other things aswell, but I can't
> > remember what they were 
> > right now :-)
> > 
> > This is a great project, keep up the good work.
> > 
> > Thanks,
> > Sean
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> >
>
http://mailman.modpython.org/mailman/listinfo/mod_python
> > 
> 
> 
> 
> 		
> __________________________________________ 
> Yahoo! DSL ? Something to write home about. 
> Just $16.99/mo. or less. 
> dsl.yahoo.com 
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
>
http://mailman.modpython.org/mailman/listinfo/mod_python
> 



		
__________________________________________ 
Yahoo! DSL ? Something to write home about. 
Just $16.99/mo. or less. 
dsl.yahoo.com 

From grahamd at dscpl.com.au  Sun Jan  8 05:34:19 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Sun Jan  8 05:34:31 2006
Subject: [mod_python] Session expires early
In-Reply-To: <43BF2CB5.9050301@barriescene.com>
References: <43BF2CB5.9050301@barriescene.com>
Message-ID: <f2b2d87d6908086b84bfd4c185cb4937@dscpl.com.au>


On 07/01/2006, at 1:51 PM, Sean Jamieson wrote:

> Does anyone know why, or has anyone else notices, that a session seems 
> to time out reguardless of when it was last accessed?
> i.e. I'm browsing along for 20-30 minutes, and then the I click a link 
> after being idle less than 5 minutes, and suddenly my session is 
> expired.
>
> This even happend today when I was showing something to a client, on 
> my laptop.

AFAIK, the person who best understands the session code is not checking
email at the moment. At least, haven't seen anything from them for a
while.

First question from me. What version of mod_python are you using? If not
using version 3.2.5b, can you at least upgrade and confirm whether you
see the same problem in that version.

Also and more importantly, in the page access' between when you log in
and when it expires, is your code ever actually saving the session 
object
for any reason?

I can't remember if a save is a prerequisite for having the last 
accessed
time updated in the session database. Ie., if you don't do a save, that
you accessed the session is never recorded and so it will expire as soon
as the timeout value elapses.

Surely not everyone who understands session is still on holidays! :-)

Graham

From fabianosidler at gmail.com  Sun Jan  8 15:28:31 2006
From: fabianosidler at gmail.com (Fabiano Sidler)
Date: Sun Jan  8 15:28:39 2006
Subject: [mod_python] python module loaded, but not parsed (huh?)
Message-ID: <d3d66b1c0601081228g718af5cco@mail.gmail.com>

Hi folks!

Just come back from holidays, I wanted to run a script with
mod_python. According to the logs, mod_python was successfully loaded
and my python module is getting imported, but the browser only
receives the script code instead of its output. As usually, my
.htaccess is fine:

SetHandler python-program
PythonHandler mymodule
PythonDebug On

There aren't no AllowOverride statements making the above settings
fail. Can someone help me to fix this weird behaviour?
Thank you in advance!

Greetings,
Fips

From grahamd at dscpl.com.au  Sun Jan  8 16:28:42 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Sun Jan  8 16:28:45 2006
Subject: [mod_python] python module loaded, but not parsed (huh?)
Message-ID: <1136755722.8064@dscpl.user.openhosting.com>

Fabiano Sidler wrote ..
> Hi folks!
> 
> Just come back from holidays, I wanted to run a script with
> mod_python. According to the logs, mod_python was successfully loaded
> and my python module is getting imported, but the browser only
> receives the script code instead of its output. As usually, my
> .htaccess is fine:
> 
> SetHandler python-program
> PythonHandler mymodule
> PythonDebug On
> 
> There aren't no AllowOverride statements making the above settings
> fail. Can someone help me to fix this weird behaviour?
> Thank you in advance!


If receiving script code, presuming you are using URL ending in
'mymodule.py'.

Try the following.

1. Put a file hello.txt in the same directory with something in it and
try and access it using URL ending in 'hello.txt' instead of
'mymodule.py'. If it returns the contents of that file, it probably
isn't using mod_python at all.

2. Introduce a syntax error in your '.htaccess' file. Ie., add a line
containing just 'XXX'. If accessing anything in that directory yields
a 500 error, the '.htaccess' file is at least being consulted. If you
don't get a 500 error, then main Apache configuration has been
changed so as to disallow you to have a '.htaccess' file. The main
Apache configuration does not probably have the required:

  AllowOverride FileInfo

for that directory.

3. Add logging in your handler code to see if it truly is being loaded
and run. Ie.,

  from mod_python import apache

  apache.log_error("loading module")

  def handler(req):
    apache.log_error("running handler")
    ....

4. Ensure that your handler is not returning apache.DECLINED, which
would mean that Apache falls back to serving up static file. Ie., your
source code if the URL happened to match that.

5. Read:

  http://www.dscpl.com.au/articles/modpython-001.html

for other debugging hints and ideas.

Graham
From python_eager at yahoo.com  Mon Jan  9 04:37:50 2006
From: python_eager at yahoo.com (python eager)
Date: Mon Jan  9 04:37:57 2006
Subject: [mod_python] reg sql query
Message-ID: <20060109093750.76667.qmail@web36402.mail.mud.yahoo.com>

Hi
     i am insert three datas from form into sql through python. While running there is no error. But the datas are not stored in that table. If the values are print through self.writeln(fieldname). it will be working properly. the values are not stored in that table..
  All the connections are nice.
   
   cursor.execute("INSERT INTO PERSONALDETAILS(FIRSTNAME,MIDDLENAME,LASTNAME) VALUES ('%s', '%s', '%s')"
                         % (fname,mname,lname))
   
  Please solve this problem.
   
  Thank you
   
  bye
  Python Eager
   
   

		
---------------------------------
 Yahoo! DSL Something to write home about. Just $16.99/mo. or less
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20060109/6f721df7/attachment.html
From nlv11281 at natlab.research.philips.com  Mon Jan  9 04:51:17 2006
From: nlv11281 at natlab.research.philips.com (Mike Looijmans)
Date: Mon Jan  9 04:51:25 2006
Subject: [mod_python] reg sql query
In-Reply-To: <20060109093750.76667.qmail@web36402.mail.mud.yahoo.com>
References: <20060109093750.76667.qmail@web36402.mail.mud.yahoo.com>
Message-ID: <43C23215.3080802@natlab.research.philips.com>

Probably, your DBMS requires you to commit the data, e.g. using db.commit()

I would appreciate it if you post questions regarding generic Python and 
Oracle to a more appropriate maillist or newsgroup - they're not related 
to mod_python at all.

--
Mike Looijmans
Philips Natlab / Topic Automation


python eager wrote:
> Hi
>    i am insert three datas from form into sql through python. While 
> running there is no error. But the datas are not stored in that table. 
> If the values are print through self.writeln(fieldname). it will be 
> working properly. the values are not stored in that table..
> All the connections are nice.
>  
>  cursor.execute("INSERT INTO 
> PERSONALDETAILS(FIRSTNAME,MIDDLENAME,LASTNAME) VALUES ('%s', '%s', '%s')"
>                          % (fname,mname,lname))
>  
> Please solve this problem.
>  
> Thank you
>  
> bye
> Python Eager
>  
>  
> 
> ------------------------------------------------------------------------
> Yahoo! DSL 
> <http://pa.yahoo.com/*http://us.rd.yahoo.com/evt=37474/*http://promo.yahoo.com/broadband/ 
>  > Something to write home about. Just $16.99/mo. or less
> 
> 
> ------------------------------------------------------------------------
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python

From nlv11281 at natlab.research.philips.com  Mon Jan  9 04:51:53 2006
From: nlv11281 at natlab.research.philips.com (Mike Looijmans)
Date: Mon Jan  9 04:52:00 2006
Subject: [mod_python] streaming zipped data with publisher]
Message-ID: <43C23239.3090605@natlab.research.philips.com>

Daniel Nogradi wrote:
> Is it possible to "stream" zipped data using the publisher handler?

Sure. I'm streaming multi-gigabyte TAR archives to/from tape and other
storage this way.

The ZIPfile and TARfile units are quite alike.

In my case, using a temporary file is not an option - the archives may
span multiple 400GB (no, that's not a typo) tapes.

When streaming out the data, set the 'Transfer-Encoding' header to
"chunked". This is neccesary because you don't know forehand how much
data you'll be sending. Output the data in chunks, by writing the (hex)
size of the chunk, followed by \r\n and the data, followed by \r\n.

This code snippet copies data from the 'stream' to 'wfile' using chunked
  encoding:

             while 1:
                 data = stream.read()
                 if not data:
                     break
                 # chunk header is <hex-size>\r\n
                 l = len(data)
                 wfile.write("%x\r\n" % l)
                 # output data
                 wfile.write(data)
                 # chunk footer
                 wfile.write("\r\n")
             # write chunk terminator
             wfile.write("0\r\n\r\n")

All that's left to do is grab the output from the Zipfile writer and
send it to the chunk encoder. You can probably directly replace
zipfile.write().

Mike.


-- 
Mike Looijmans
Philips Natlab / Topic Automation

From python_eager at yahoo.com  Mon Jan  9 05:06:31 2006
From: python_eager at yahoo.com (python eager)
Date: Mon Jan  9 05:06:34 2006
Subject: [mod_python] thank you for solving - reg sql query ( now working
	fine)
Message-ID: <20060109100631.99313.qmail@web36403.mail.mud.yahoo.com>

  Hi
     Thank you for solving the sql query. Now the values are stored inside the database.
  thank you.
   
  regards
  Python Eager
   


		
---------------------------------
Yahoo! Photos ? Showcase holiday pictures in hardcover
 Photo Books. You design it and we?ll bind it!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20060109/be786ed0/attachment.html
From jcigar at ulb.ac.be  Mon Jan  9 05:11:32 2006
From: jcigar at ulb.ac.be (Julien Cigar)
Date: Mon Jan  9 05:07:32 2006
Subject: [mod_python] reg sql query
In-Reply-To: <20060109093750.76667.qmail@web36402.mail.mud.yahoo.com>
References: <20060109093750.76667.qmail@web36402.mail.mud.yahoo.com>
Message-ID: <43C236D4.2060603@ulb.ac.be>

The correct syntax is :
cursor.execute("INSERT INTO 
PERSONALDETAILS(FIRSTNAME,MIDDLENAME,LASTNAME) VALUES (%s, %s, %s)", 
(fname, mname, lname))

python eager wrote:

> Hi
>    i am insert three datas from form into sql through python. While 
> running there is no error. But the datas are not stored in that table. 
> If the values are print through self.writeln(fieldname). it will be 
> working properly. the values are not stored in that table..
> All the connections are nice.
>  
>  cursor.execute("INSERT INTO 
> PERSONALDETAILS(FIRSTNAME,MIDDLENAME,LASTNAME) VALUES ('%s', '%s', '%s')"
>                          % (fname,mname,lname))
>  
> Please solve this problem.
>  
> Thank you
>  
> bye
> Python Eager
>  
>  
>
> ------------------------------------------------------------------------
> Yahoo! DSL 
> <http://pa.yahoo.com/*http://us.rd.yahoo.com/evt=37474/*http://promo.yahoo.com/broadband/%20> 
> Something to write home about. Just $16.99/mo. or less
>
>------------------------------------------------------------------------
>
>_______________________________________________
>Mod_python mailing list
>Mod_python@modpython.org
>http://mailman.modpython.org/mailman/listinfo/mod_python
>  
>


-- 
Julien Cigar
Belgian Biodiversity Platform
http://www.biodiversity.be
Universit? Libre de Bruxelles
Campus de la Plaine CP 257
B?timent NO, Bureau 4 N4 115C (Niveau 4)
Boulevard du Triomphe, entr?e ULB 2
B-1050 Bruxelles
Work: jcigar@ulb.ac.be
Personal: mage@mordor.ath.cx

From python_eager at yahoo.com  Mon Jan  9 05:19:05 2006
From: python_eager at yahoo.com (python eager)
Date: Mon Jan  9 05:19:09 2006
Subject: [mod_python] facing sql error
Message-ID: <20060109101905.95829.qmail@web36414.mail.mud.yahoo.com>

Hi 
   
  Hi this is my code snippet. 
   
            req = self.request()
          fname = req.field('fname')
          mname = req.field('mname')
          lname = req.field('lname')
          dbconnection = cx_Oracle.connect("myuser", "mypassword", "mydatabase")
          cursor = dbconnection.cursor()
          cursor.arraysize = 50
          self.writeln("hello")
          cursor.execute("INSERT INTO PERSONALDETAILS     (firstname,middlename,lastname) VALUES (%s, %s, %s)", (fname,mname,lname))
   dbconnection.commit()
  
While executing i am getting the following error 
   
  cursor.execute("INSERT INTO PERSONALDETAILS(firstname,middlename,lastname) VALUES (%s, %s, %s)", (fname,mname,lname))
DatabaseError: ORA-01036: illegal variable name/number
   
  please solve this problem.
   
  regards
  Python Eager
   

		
---------------------------------
 Yahoo! DSL Something to write home about. Just $16.99/mo. or less
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20060109/bff66b45/attachment.html
From nogradi at gmail.com  Mon Jan  9 05:36:55 2006
From: nogradi at gmail.com (Daniel Nogradi)
Date: Mon Jan  9 05:37:02 2006
Subject: [mod_python] Re: streaming zipped data with publisher
In-Reply-To: <f67813665ac250d00d1a912e7b0e2a30@dscpl.com.au>
References: <5f56302b0601071250i42a8222cgbddf330e85f715be@mail.gmail.com>
	<43C038EB.60102@barriescene.com>
	<f67813665ac250d00d1a912e7b0e2a30@dscpl.com.au>
Message-ID: <5f56302b0601090236lef5bbacv3ed4ca700181f9c1@mail.gmail.com>

On 1/8/06, Graham Dumpleton <grahamd@dscpl.com.au> wrote:
> On 08/01/2006, at 8:55 AM, Sean Jamieson wrote:
>
> > Sure it is, even with the temporary file option, all you have to do is
> > set the content-type header to application/x-gzipped or something like
> > that (application/octet-stream is always a fallback value; this forces
> > download, and doesn't allow it to recognize the file format for use
> > with an external application), then output the file (possibly setting
> > the Content-Length header first, to be polite)
> >
> > with or with out the file is your choice, all you have to do is output
> > the binary data, and no other output (not even a single space) or you
> > will corrupt it.
> >
> > Daniel Nogradi wrote:
> >
> >> Is it possible to "stream" zipped data using the publisher handler?
> >>
> >> In my situation I would create the zipped archive upon client input
> >> and want to return the archive immediately. What I have in mind is
> >> creating a zip archive (using the zipfile module perhaps) in memory
> >> and than sending that to the client without actually creating a zip
> >> file on the disk of the server.
> >>
> >> In case this would not be possible I could live with creating a
> >> temporary file and returning that to the client, but at the moment the
> >> only way I can do this is through a link (such as <a
> >> href='data.zip'>click here</a>)  but in this case it would be a 2-step
> >> process: (1) user clicks on something which creates the archive and
> >> sends back the link in html (2) user clicks on the link. Is it not
> >> possible to send the zip file immediately after its creation?
>
> I am not sure you are talking about the same thing here. The "zipfile"
> module is for creating an archive containing other enclosed files.
> This is different to merely compressing any output returned from a
> handler.
>
> If it was the case that it is only about compressing the output, doing
> it inside a published function is possibly not a good idea anyway. A
> better way would be to use the DEFLATE output filter as implemented by
> the Apache mod_deflate module.
>
> This module is however only available in Apache 2.0 and is not compiled
> in by default, so you have to enable its inclusion when "configure" is
> run prior to building Apache. Also, at the moment, because mod_python
> doesn't allow dynamic registration of output filters from a handler,
> it would apply to all requests in a directory, or those returning a
> certain type of output, or possibly by URL if you are tricky.
>
> Also should be pointed out that mod_deflate will only compress output
> where the client says it is willing to accept it as gzip'd data by
> having set the "Accept-Encoding: gzip" incoming header. One can forcibly
> set this though from a handler to force it to do it anyway.
>
> Anyway, the point I am trying to make is there are perhaps better tools
> for doing the job than trying to compress on the fly in Python code
> running
> under mod_python, although technically one could write the equivalent of
> mod_deflate in Python if you wanted to. If you did write it in Python
> though, you would still be better off installing it as an output filter.
> For it all to work nicely may have to wait until mod_python 3.3 though,
> where I hope to get some improvements made to working with filters.
>
>    http://issues.apache.org/jira/browse/MODPYTHON-103
>    http://issues.apache.org/jira/browse/MODPYTHON-104
>
> Anyway, back to the original posters question. If I read the code for
> the
> "zipfile" module correctly, when you use the ZipFile class with "w" mode
> to create a zip file, the first argument only needs to be a file like
> object. That is, it doesn't need to be a actual file on disk. Instead it
> could be an instance of the StringIO class. I have not use ZipFile to
> create an archive, but something perhaps like the following may work.
>
>    import zipfile
>    import StringIO
>
>    buffer = StringIO.StringIO()
>    myzip = zipfile.ZipFile(buffer,"w")
>
>    ... build up zip
>
>    myzip.close()
>
>    data = buffer.getvalue()
>
> After this, your zip file as a string will be in data and you can then
> return it as the response content.
>
> Graham
>

Thanks all for the very useful info!

As Graham pointed out, I wasn't talking about zipping everything I
send to the clients, only zipping a file once in a while when users
request an archive of a bunch of files. And, more importantly, I don't
want to store the zip file, but create it upon request, send it, and
delete it.

It seems this StringIO solution is best. Only I'm not sure how I
return the 'data' (in your example) since I'm using the publisher
handler. As far as I understand, perhaps I'm wrong here, the publisher
handler does all header stuff by itself, but in this case I need to
set content length, content type, etc, so how does this go with
publisher?

From nlv11281 at natlab.research.philips.com  Mon Jan  9 06:01:21 2006
From: nlv11281 at natlab.research.philips.com (Mike Looijmans)
Date: Mon Jan  9 06:01:26 2006
Subject: [mod_python] Re: streaming zipped data with publisher
In-Reply-To: <5f56302b0601090236lef5bbacv3ed4ca700181f9c1@mail.gmail.com>
References: <5f56302b0601071250i42a8222cgbddf330e85f715be@mail.gmail.com>	<43C038EB.60102@barriescene.com>	<f67813665ac250d00d1a912e7b0e2a30@dscpl.com.au>
	<5f56302b0601090236lef5bbacv3ed4ca700181f9c1@mail.gmail.com>
Message-ID: <43C24281.5070703@natlab.research.philips.com>

> As Graham pointed out, I wasn't talking about zipping everything I
> send to the clients, only zipping a file once in a while when users
> request an archive of a bunch of files. And, more importantly, I don't
> want to store the zip file, but create it upon request, send it, and
> delete it.
> 
> It seems this StringIO solution is best. Only I'm not sure how I
> return the 'data' (in your example) since I'm using the publisher
> handler. As far as I understand, perhaps I'm wrong here, the publisher
> handler does all header stuff by itself, but in this case I need to
> set content length, content type, etc, so how does this go with
> publisher?

I bet you can get away with the following:

req.add_header('Content-Type', 'application/octet-stream')
myzip = zipfile.ZipFile(req,"w")
##   ... build up zip
myzip.close()

(req is the request object from publisher)

ZipFile will just output the data directly to the client now. Publisher 
will (hopefully) chunk-encode it.

No temp files, and no memory hog (which StringIO might do...)

An alternative to chunked encoding (but less 'nice' since the client 
cannot determine whether the transfer was aborted or not) is to add 
"Connection: Close" to the headers (effectively using HTTP/1.0 protocol).

--
Mike Looijmans
Philips Natlab / Topic Automation


From nogradi at gmail.com  Mon Jan  9 06:43:12 2006
From: nogradi at gmail.com (Daniel Nogradi)
Date: Mon Jan  9 06:43:18 2006
Subject: [mod_python] Re: streaming zipped data with publisher
In-Reply-To: <43C24281.5070703@natlab.research.philips.com>
References: <5f56302b0601071250i42a8222cgbddf330e85f715be@mail.gmail.com>
	<43C038EB.60102@barriescene.com>
	<f67813665ac250d00d1a912e7b0e2a30@dscpl.com.au>
	<5f56302b0601090236lef5bbacv3ed4ca700181f9c1@mail.gmail.com>
	<43C24281.5070703@natlab.research.philips.com>
Message-ID: <5f56302b0601090343q2ea7da7bud35ad5530c8f0a98@mail.gmail.com>

> > As Graham pointed out, I wasn't talking about zipping everything I
> > send to the clients, only zipping a file once in a while when users
> > request an archive of a bunch of files. And, more importantly, I don't
> > want to store the zip file, but create it upon request, send it, and
> > delete it.
> >
> > It seems this StringIO solution is best. Only I'm not sure how I
> > return the 'data' (in your example) since I'm using the publisher
> > handler. As far as I understand, perhaps I'm wrong here, the publisher
> > handler does all header stuff by itself, but in this case I need to
> > set content length, content type, etc, so how does this go with
> > publisher?
>
> I bet you can get away with the following:
>
> req.add_header('Content-Type', 'application/octet-stream')
> myzip = zipfile.ZipFile(req,"w")
> ##   ... build up zip
> myzip.close()
>
> (req is the request object from publisher)
>
> ZipFile will just output the data directly to the client now. Publisher
> will (hopefully) chunk-encode it.
>
> No temp files, and no memory hog (which StringIO might do...)
>
> An alternative to chunked encoding (but less 'nice' since the client
> cannot determine whether the transfer was aborted or not) is to add
> "Connection: Close" to the headers (effectively using HTTP/1.0 protocol).


Great, thanks, that was exactly what I was looking for.

From python_eager at yahoo.com  Mon Jan  9 08:01:17 2006
From: python_eager at yahoo.com (python eager)
Date: Mon Jan  9 08:01:32 2006
Subject: [mod_python] error while inserting data
Message-ID: <20060109130117.97540.qmail@web36404.mail.mud.yahoo.com>

  Hi 
   i m getting the following errors. Please solve this problem
  Hi this is my code snippet. 
   
            req = self.request()
          fname = req.field('fname')
          mname = req.field('mname')
          lname = req.field('lname')
          dbconnection = cx_Oracle.connect("myuser", "mypassword", "mydatabase")
          cursor = dbconnection.cursor()
          cursor.arraysize = 50
          self.writeln("hello")
          cursor.execute("INSERT INTO PERSONALDETAILS     (firstname,middlename,lastname) VALUES (%s, %s, %s)", (fname,mname,lname))
   dbconnection.commit()
  
While executing i am getting the following error 
   
  cursor.execute("INSERT INTO PERSONALDETAILS(firstname,middlename,lastname) VALUES (%s, %s, %s)", (fname,mname,lname))
DatabaseError: ORA-01036: illegal variable name/number
   
  please solve this problem.
   
  regards
  Python Eager
   


		
---------------------------------
Yahoo! Photos
 Ring in the New Year with Photo Calendars. Add photos, events, holidays, whatever.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20060109/b52d89c9/attachment.html
From nogradi at gmail.com  Mon Jan  9 11:02:24 2006
From: nogradi at gmail.com (Daniel Nogradi)
Date: Mon Jan  9 11:02:32 2006
Subject: [mod_python] Re: error while inserting data
Message-ID: <5f56302b0601090802y3a7a4aabs195691f8978d5542@mail.gmail.com>

Inserting variables of type string into other strings goes like this:

name = "John"
formatted_string = "your name is: %s" % name

or with more variables:

name = "John"
age = "13"
formatted_string = "your name is: %s and your age is: %s" % ( name, age )

Thus you should have:

cursor.execute("INSERT INTO PERSONALDETAILS
(firstname,middlename,lastname) VALUES (%s, %s, %s)" %
(fname,mname,lname) )

Note the % sign.

From listspam at flowtheory.net  Mon Jan  9 11:21:25 2006
From: listspam at flowtheory.net (Joshua Ginsberg)
Date: Mon Jan  9 11:21:34 2006
Subject: [mod_python] Re: error while inserting data
In-Reply-To: <5f56302b0601090802y3a7a4aabs195691f8978d5542@mail.gmail.com>
References: <5f56302b0601090802y3a7a4aabs195691f8978d5542@mail.gmail.com>
Message-ID: <1136823685.647.6.camel@localhost.localdomain>

I certainly hope Oracle requires single ticks around your strings...
wouldn't you want ('%s', '%s', '%s')? And this doesn't even try to
account for what happens if your strings have single ticks in them...

I know the MySQLdb driver handles this gracefully... you provide the
string with %s'es for variables and then provide a second argument that
is an n-tuple with the values for substitution. It surrounds strings
with single-ticks, doubling when necessary, and leaves un-ticked data
(e.g. int, double) alone without ticks.

YMMV.

-jag

On Mon, 2006-01-09 at 17:02 +0100, Daniel Nogradi wrote:
> Inserting variables of type string into other strings goes like this:
> 
> name = "John"
> formatted_string = "your name is: %s" % name
> 
> or with more variables:
> 
> name = "John"
> age = "13"
> formatted_string = "your name is: %s and your age is: %s" % ( name, age )
> 
> Thus you should have:
> 
> cursor.execute("INSERT INTO PERSONALDETAILS
> (firstname,middlename,lastname) VALUES (%s, %s, %s)" %
> (fname,mname,lname) )
> 
> Note the % sign.
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python

From list at joreybump.com  Mon Jan  9 11:28:25 2006
From: list at joreybump.com (Jorey Bump)
Date: Mon Jan  9 11:28:44 2006
Subject: [mod_python] Re: error while inserting data
In-Reply-To: <5f56302b0601090802y3a7a4aabs195691f8978d5542@mail.gmail.com>
References: <5f56302b0601090802y3a7a4aabs195691f8978d5542@mail.gmail.com>
Message-ID: <43C28F29.8070702@joreybump.com>

Daniel Nogradi wrote:
> Inserting variables of type string into other strings goes like this:
> 
> name = "John"
> formatted_string = "your name is: %s" % name
> 
> or with more variables:
> 
> name = "John"
> age = "13"
> formatted_string = "your name is: %s and your age is: %s" % ( name, age )
> 
> Thus you should have:
> 
> cursor.execute("INSERT INTO PERSONALDETAILS
> (firstname,middlename,lastname) VALUES (%s, %s, %s)" %
> (fname,mname,lname) )
> 
> Note the % sign.

As a safeguard against SQL injection, data should always be inserted 
into a database using placeholders, especially if supplied by users (or 
any external interface, no matter how authoritative). This is typically 
in the form cursor.execute(querystring, tuple):

querystring = "INSERT INTO user (fname, lname) VALUES (%s, %s)"
values = (firstname, lastname)
cursor.execute(querystring, values)

Using simple python string substitution is quite dangerous in web forms. 
Placeholders allow the database to do the work of escaping values safely.


From nick at dd.revealed.net  Mon Jan  9 11:50:27 2006
From: nick at dd.revealed.net (Nick)
Date: Mon Jan  9 11:50:29 2006
Subject: [mod_python] Re: error while inserting data
In-Reply-To: <43C28F29.8070702@joreybump.com>
References: <5f56302b0601090802y3a7a4aabs195691f8978d5542@mail.gmail.com>
	<43C28F29.8070702@joreybump.com>
Message-ID: <43C29453.4020303@dd.revealed.net>

cx_Oracle uses the :arg notation.

Nick

Jorey Bump wrote:
> Daniel Nogradi wrote:
> 
>> Inserting variables of type string into other strings goes like this:
>>
>> name = "John"
>> formatted_string = "your name is: %s" % name
>>
>> or with more variables:
>>
>> name = "John"
>> age = "13"
>> formatted_string = "your name is: %s and your age is: %s" % ( name, age )
>>
>> Thus you should have:
>>
>> cursor.execute("INSERT INTO PERSONALDETAILS
>> (firstname,middlename,lastname) VALUES (%s, %s, %s)" %
>> (fname,mname,lname) )
>>
>> Note the % sign.
> 
> 
> As a safeguard against SQL injection, data should always be inserted 
> into a database using placeholders, especially if supplied by users (or 
> any external interface, no matter how authoritative). This is typically 
> in the form cursor.execute(querystring, tuple):
> 
> querystring = "INSERT INTO user (fname, lname) VALUES (%s, %s)"
> values = (firstname, lastname)
> cursor.execute(querystring, values)
> 
> Using simple python string substitution is quite dangerous in web forms. 
> Placeholders allow the database to do the work of escaping values safely.
> 
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python

From trepca at gmail.com  Mon Jan  9 13:43:33 2006
From: trepca at gmail.com (Sebastjan Trepca)
Date: Mon Jan  9 13:43:37 2006
Subject: [mod_python] Unit testing in mod_python
Message-ID: <cd329af80601091043u58feab26va70b0be57ba73172@mail.gmail.com>

Hi,

does anyone know of any mod_python unittest module which could generate a
"fake request" so you could effectivly test your handlers?

For example:
import my_handler

fake_request = get_basic_request(qs="test1=1&test2=2")
assert my_handler.handle(fake_request)==apache.OK
assert fake_request.out.startswith('<html>')

Thanks, Sebastjan
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20060109/f3d8946c/attachment.html
From HansJoachim.Ehlers at eumetsat.int  Mon Jan  9 13:55:35 2006
From: HansJoachim.Ehlers at eumetsat.int (Hans-Joachim Ehlers)
Date: Mon Jan  9 13:56:06 2006
Subject: [mod_python] make failed on AIX 5.1 using xlc
Message-ID: <s3c2bfd4.001@gwn0201.eumetsat.int>

Hi folk,
i am trying to build mod-python 3.1.4 on AIX 5.1 with xlc
During the gmake i get the following error: .... 1506-196 (E)
Initialization between types "void(*)(void*)" and "void(*)(struct
_object*)" is not allowed 

any Tips ?
tai 
Hajo

For details see below

given:
AIX 5.1
vac 6.0 ( IBM xlc)
mod-python 3.1.4
Python 2.4.2 build as shared Lib application
Apache 2.0.55

$ ./configure CC=xlc_r \
 --with-thread       \
 --with-python=/usr/local/bin/python \
 --with-apxs=/usr/local/apache2/bin/apxs 


$ gmake[1]: Entering directory
`/homespace/hjehlers/workbench/modpython/mod_python-3.1.4/src'

Compiling for DSO.

/usr/local/apache2/bin/apxs
-I/homespace/hjehlers/workbench/modpython/mod_python-3.1.4/src/include
-I/usr/local/apache2/include -I/usr/local/include/python2.4 -c
mod_python.c _apachemodule.c requestobject.c tableobject.c util.c
serverobject.c connobject.c filterobject.c hlist.c hlistobject.c
-L/usr/local/lib/python2.4/config  -Wl,-bE:Modules/python.exp -lld  
-L/opt/freeware/lib -ltk8.3 -ltcl8.3    -lm  -lpython2.4   -ldl    -lm
/usr/local/apache2/build/libtool --silent --mode=compile xlc_r
-prefer-pic   -U__STR__ -D_THREAD_SAFE -D_USE_IRS -DAP_DEBUG -g -qHALT=E
-qfullpath -qinitauto=FE -qcheck=all -qinfo=pro
-I/usr/local/apache2/include  -I/usr/local/apache2/include  
-I/usr/local/apache2/include 
-I/homespace/hjehlers/workbench/modpython/mod_python-3.1.4/src/include
-I/usr/local/apache2/include -I/usr/local/include/python2.4  -c -o
mod_python.lo mod_python.c && touch mod_python.slo
/usr/local/apache2/build/libtool --silent --mode=compile xlc_r
-prefer-pic   -U__STR__ -D_THREAD_SAFE -D_USE_IRS -DAP_DEBUG -g -qHALT=E
-qfullpath -qinitauto=FE -qcheck=all -qinfo=pro
-I/usr/local/apache2/include  -I/usr/local/apache2/include  
-I/usr/local/apache2/include 
-I/homespace/hjehlers/workbench/modpython/mod_python-3.1.4/src/include
-I/usr/local/apache2/include -I/usr/local/include/python2.4  -c -o
_apachemodule.lo _apachemodule.c && touch _apachemodule.slo
/usr/local/apache2/build/libtool --silent --mode=compile xlc_r
-prefer-pic   -U__STR__ -D_THREAD_SAFE -D_USE_IRS -DAP_DEBUG -g -qHALT=E
-qfullpath -qinitauto=FE -qcheck=all -qinfo=pro
-I/usr/local/apache2/include  -I/usr/local/apache2/include  
-I/usr/local/apache2/include 
-I/homespace/hjehlers/workbench/modpython/mod_python-3.1.4/src/include
-I/usr/local/apache2/include -I/usr/local/include/python2.4  -c -o
requestobject.lo requestobject.c && touch requestobject.slo
"requestobject.c", line 1381.5: 1506-196 (E) Initialization between
types "void(*)(void*)" and "void(*)(struct _object*)" is not allowed.
apxs:Error: Command failed with rc=65536
.
gmake[1]: *** [mod_python.so] Error 1
gmake[1]: Leaving directory
`/homespace/hjehlers/workbench/modpython/mod_python-3.1.4/src'
gmake: *** [do_dso] Error 2

From grahamd at dscpl.com.au  Mon Jan  9 16:38:37 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Mon Jan  9 16:38:43 2006
Subject: [mod_python] make failed on AIX 5.1 using xlc
Message-ID: <1136842717.13932@dscpl.user.openhosting.com>

Seems to be some quirk with xlc compiler. Never liked that compiler,
always did strange things.

Try hacking the code so that instead of:

  (destructor)request_dealloc,     /* tp_free */

it says:

  (void(*)(void*))request_dealloc,     /* tp_free */

Try a typedef for the function pointer if I got the cast wrong or it
doesn't want to accept that.

Graham

Hans-Joachim Ehlers wrote ..
> Hi folk,
> i am trying to build mod-python 3.1.4 on AIX 5.1 with xlc
> During the gmake i get the following error: .... 1506-196 (E)
> Initialization between types "void(*)(void*)" and "void(*)(struct
> _object*)" is not allowed 
> 
> any Tips ?
> tai 
> Hajo
> 
> For details see below
> 
> given:
> AIX 5.1
> vac 6.0 ( IBM xlc)
> mod-python 3.1.4
> Python 2.4.2 build as shared Lib application
> Apache 2.0.55
> 
> $ ./configure CC=xlc_r \
>  --with-thread       \
>  --with-python=/usr/local/bin/python \
>  --with-apxs=/usr/local/apache2/bin/apxs 
> 
> 
> $ gmake[1]: Entering directory
> `/homespace/hjehlers/workbench/modpython/mod_python-3.1.4/src'
> 
> Compiling for DSO.
> 
> /usr/local/apache2/bin/apxs
> -I/homespace/hjehlers/workbench/modpython/mod_python-3.1.4/src/include
> -I/usr/local/apache2/include -I/usr/local/include/python2.4 -c
> mod_python.c _apachemodule.c requestobject.c tableobject.c util.c
> serverobject.c connobject.c filterobject.c hlist.c hlistobject.c
> -L/usr/local/lib/python2.4/config  -Wl,-bE:Modules/python.exp -lld  
> -L/opt/freeware/lib -ltk8.3 -ltcl8.3    -lm  -lpython2.4   -ldl    -lm
> /usr/local/apache2/build/libtool --silent --mode=compile xlc_r
> -prefer-pic   -U__STR__ -D_THREAD_SAFE -D_USE_IRS -DAP_DEBUG -g -qHALT=E
> -qfullpath -qinitauto=FE -qcheck=all -qinfo=pro
> -I/usr/local/apache2/include  -I/usr/local/apache2/include  
> -I/usr/local/apache2/include 
> -I/homespace/hjehlers/workbench/modpython/mod_python-3.1.4/src/include
> -I/usr/local/apache2/include -I/usr/local/include/python2.4  -c -o
> mod_python.lo mod_python.c && touch mod_python.slo
> /usr/local/apache2/build/libtool --silent --mode=compile xlc_r
> -prefer-pic   -U__STR__ -D_THREAD_SAFE -D_USE_IRS -DAP_DEBUG -g -qHALT=E
> -qfullpath -qinitauto=FE -qcheck=all -qinfo=pro
> -I/usr/local/apache2/include  -I/usr/local/apache2/include  
> -I/usr/local/apache2/include 
> -I/homespace/hjehlers/workbench/modpython/mod_python-3.1.4/src/include
> -I/usr/local/apache2/include -I/usr/local/include/python2.4  -c -o
> _apachemodule.lo _apachemodule.c && touch _apachemodule.slo
> /usr/local/apache2/build/libtool --silent --mode=compile xlc_r
> -prefer-pic   -U__STR__ -D_THREAD_SAFE -D_USE_IRS -DAP_DEBUG -g -qHALT=E
> -qfullpath -qinitauto=FE -qcheck=all -qinfo=pro
> -I/usr/local/apache2/include  -I/usr/local/apache2/include  
> -I/usr/local/apache2/include 
> -I/homespace/hjehlers/workbench/modpython/mod_python-3.1.4/src/include
> -I/usr/local/apache2/include -I/usr/local/include/python2.4  -c -o
> requestobject.lo requestobject.c && touch requestobject.slo
> "requestobject.c", line 1381.5: 1506-196 (E) Initialization between
> types "void(*)(void*)" and "void(*)(struct _object*)" is not allowed.
> apxs:Error: Command failed with rc=65536
> .
> gmake[1]: *** [mod_python.so] Error 1
> gmake[1]: Leaving directory
> `/homespace/hjehlers/workbench/modpython/mod_python-3.1.4/src'
> gmake: *** [do_dso] Error 2
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
From grahamd at dscpl.com.au  Mon Jan  9 16:53:10 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Mon Jan  9 16:53:13 2006
Subject: [mod_python] Unit testing in mod_python
Message-ID: <1136843590.22806@dscpl.user.openhosting.com>

Sebastjan Trepca wrote ..
> Hi,
> 
> does anyone know of any mod_python unittest module which could generate
> a
> "fake request" so you could effectivly test your handlers?
> 
> For example:
> import my_handler
> 
> fake_request = get_basic_request(qs="test1=1&test2=2")
> assert my_handler.handle(fake_request)==apache.OK
> assert fake_request.out.startswith('<html>')

It isn't going to be quite what you want, as it still requires Apache for the
tests, but have a look at the 'test' directory in mod_python for a way of
setting up automated testing for code running under Apache.

To set up a test framework that can adequately emulate the mod_python
environment outside of Apache would probably be technically possible,
just a bit of work to write.

Graham
From grahamd at dscpl.com.au  Mon Jan  9 21:08:15 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Mon Jan  9 21:08:18 2006
Subject: [mod_python] Book on mod_python?
Message-ID: <1136858895.26060@dscpl.user.openhosting.com>

Bill Anderson wrote ..
> On Fri, 2005-05-27 at 10:01 +0200, Oyvind Ostlund wrote:
> > I am so sure that I once saw a book on mod_python, but now I can't seem
> >  to find any at all? Was it a mod_perl book I saw? Is there a book on
> >  mod_python? If so, anyone have a link?
> 
> I am currently in the process of getting one finished and published.
> *Hopefully* in the next year it should be out. 
> 
> Cheers,
> Bill
> 
> -- 
> Bill Anderson <bill@immosys.com>


Has anyone ever seen anything about this book for mod_python that
was supposed to be in the works?

Has anyone seen anything about any book at all on mod_python? A
couple of years back publishers apparently weren't really interested in
the topic, maybe things have changed since .....

Graham
From courtneyludwin at yahoo.com  Tue Jan 10 01:52:05 2006
From: courtneyludwin at yahoo.com (courtney ludwin)
Date: Tue Jan 10 01:52:09 2006
Subject: [mod_python] SetHandler trick to have pretty url's
Message-ID: <20060110065205.60534.qmail@web34811.mail.mud.yahoo.com>

I was looking for a way to pretty up my mod_python
url's the other day and I figured out a trick that
works w/ the 'FilesMatch' directive in httpd.conf, I
figure I'd share with the list....

 <FilesMatch "(^[^\.]*$|^[^\?]*[\?]+[^$]+$)">
    SetHandler python-program
    PythonHandler common.dispatch.dispatcher
    PythonDebug On
  </FilesMatch>

This match expression says anything without a file
extension should be handled by dispatcher.py otherwise
apache should handle it normally.  I wrote the
dispatcher use a config file to map url's to
mod_python handlers.

Followed up a quick example in my blog:
http://2centspoorer.blogspot.com/2006/01/creating-your-own-modpython-request.html

Hope you find it useful.

Thanks,
Courtney


		
__________________________________________ 
Yahoo! DSL ? Something to write home about. 
Just $16.99/mo. or less. 
dsl.yahoo.com 

From grahamd at dscpl.com.au  Tue Jan 10 04:14:55 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Tue Jan 10 04:15:08 2006
Subject: [mod_python] SetHandler trick to have pretty url's
In-Reply-To: <20060110065205.60534.qmail@web34811.mail.mud.yahoo.com>
References: <20060110065205.60534.qmail@web34811.mail.mud.yahoo.com>
Message-ID: <7515070139c5b26110856958342ebd61@dscpl.com.au>


On 10/01/2006, at 5:52 PM, courtney ludwin wrote:

> I was looking for a way to pretty up my mod_python
> url's the other day and I figured out a trick that
> works w/ the 'FilesMatch' directive in httpd.conf, I
> figure I'd share with the list....
>
>  <FilesMatch "(^[^\.]*$|^[^\?]*[\?]+[^$]+$)">
>     SetHandler python-program
>     PythonHandler common.dispatch.dispatcher
>     PythonDebug On
>   </FilesMatch>
>
> This match expression says anything without a file
> extension should be handled by dispatcher.py otherwise
> apache should handle it normally.  I wrote the
> dispatcher use a config file to map url's to
> mod_python handlers.
>
> Followed up a quick example in my blog:
> http://2centspoorer.blogspot.com/2006/01/creating-your-own-modpython- 
> request.html
>
> Hope you find it useful.

For simple cases, your handler could simply include the following at
the start:

   stub, extn = os.path.splitext(req.filename)
   if not extn:
     return apache.DECLINED

Returning apache.DECLINED will trigger Apache to perform its normal
handling of static files. Thus, accessing any static file such as
an image will still result in the image being returned.

If you wanted to mix PHP in the same directory, you have to be a
bit more tricky and disable mod_python in the Apache configuration
for the .php extension if using this trick. Ie.,

   SetHandler python-program
   PythonHandler common.dispatch.dispatcher
   PythonDebug On

   <Files *.php>
   SetHandler None
   </Files>

This latter approach means everything goes to Apache but you disable
it for extensions which should be handled by Apache. This works the
opposite way of what you are doing. You could even say:

   SetHandler python-program
   PythonHandler common.dispatch.dispatcher
   PythonDebug On

   <Files *.*>
   SetHandler None
   </Files>

This does away with your complicated FilesMatch pattern altogether and
the change to the handler isn't needed either.

Graham

From nlv11281 at natlab.research.philips.com  Tue Jan 10 04:24:41 2006
From: nlv11281 at natlab.research.philips.com (Mike Looijmans)
Date: Tue Jan 10 04:24:46 2006
Subject: [mod_python] Unit testing in mod_python
Message-ID: <43C37D59.10601@natlab.research.philips.com>

I did something like that to emulate a mod_python environment when the
host was actually running CGI. This gave max performance on our main
sites, while the one site running CGI could still use the same scripts.
The extra code/overhead needed to emulate mod_python was much less than 
the performance penalty that cgihandler would impose on the scripts.

I'll dig up the code.

Basically, it just created a "request" object like this:

class Request:
	def __init__(self):
		...
	def write(self, data):
		...

I just added extra fields/methods to the Request emulator 'on demand',
by just running the site in CGI and see what fails.

--
Mike Looijmans
Philips Natlab / Topic Automation


Sebastjan Trepca wrote:
> Hi,
> 
> does anyone know of any mod_python unittest module which could generate 
> a "fake request" so you could effectivly test your handlers?
> 
> For example:
> import my_handler
> 
> fake_request = get_basic_request(qs="test1=1&test2=2")
> assert my_handler.handle(fake_request)==apache.OK
> assert fake_request.out.startswith('<html>')
> 
> Thanks, Sebastjan
> 
> 
> ------------------------------------------------------------------------
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python

From grahamd at dscpl.com.au  Tue Jan 10 04:25:18 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Tue Jan 10 04:25:31 2006
Subject: [mod_python] SetHandler trick to have pretty url's
In-Reply-To: <7515070139c5b26110856958342ebd61@dscpl.com.au>
References: <20060110065205.60534.qmail@web34811.mail.mud.yahoo.com>
	<7515070139c5b26110856958342ebd61@dscpl.com.au>
Message-ID: <59bc7c7fe4bb17528889cf96a5ec42e9@dscpl.com.au>


On 10/01/2006, at 8:14 PM, Graham Dumpleton wrote:

>
> On 10/01/2006, at 5:52 PM, courtney ludwin wrote:
>
>>  <FilesMatch "(^[^\.]*$|^[^\?]*[\?]+[^$]+$)">
>>     SetHandler python-program
>>     PythonHandler common.dispatch.dispatcher
>>     PythonDebug On
>>   </FilesMatch>
>
>   SetHandler python-program
>   PythonHandler common.dispatch.dispatcher
>   PythonDebug On
>
>   <Files *.*>
>   SetHandler None
>   </Files>

BTW, I should point out that both of these techniques are actually
dangerous to use if you keep your Python code for your handler in
the same directory. That is because your .py and .pyc files are
accessible for people to download. Always a good idea to also use:

   <Files "*.py">
   deny from all
   </Files>
   <Files "*.pyc">
   deny from all
   </Files>

Or similar obscure regular expression which catches both at the
same time.

Graham

From HansJoachim.Ehlers at eumetsat.int  Tue Jan 10 05:18:15 2006
From: HansJoachim.Ehlers at eumetsat.int (Hans-Joachim Ehlers)
Date: Tue Jan 10 05:19:07 2006
Subject: [mod_python] make failed on AIX 5.1 using xlc
Message-ID: <s3c3981f.082@gwn0201.eumetsat.int>

First sorry for Top posting. I have to use an &GR() novell email client

Next Error:
"tableobject.c", line 1057.5: 1506-196 (E) Initialization between types
"void(*)(void*)" and "void(*)(struct _object*)" is not allowed.
apxs:Error: Command failed with rc=65536

Changed : "tableobject.c", line 1057.5
from
    (destructor)table_dealloc,              /* tp_free */
to
    (void(*)(void*))table_dealloc,          /* tp_free */


Changed: "serverobject.c", line 335.5:
from
    (destructor)server_dealloc,      /* tp_free */
to
    (void(*)(void*))server_dealloc,          /* tp_free */

...

1)
so all /* tp_free */ lines has been changed to     (void(*)(void*))
instead of    (destructor)

No further problems with Code sofar.

2)
Under AIX the Compilation of python is somehow quite uncommon
Just see the out from from the mod_python make:

/usr/local/apache2/build/libtool --silent --mode=link xlc_r -o
mod_python.la  -rpath /usr/local/apache2/modules -module -avoid-version 
-Wl,-brtl  hlistobject.lo hlist.lo filterobject.lo connobject.lo
serverobject.lo util.lo tableobject.lo requestobject.lo _apachemodule.lo
mod_python.lo -L/usr/local/lib/python2.4/config
-Wl,-bE:Modules/python.exp -lld -L/opt/freeware/lib -ltk8.3 -ltcl8.3 -lm
-lpython2.4 -ldl -lm
ld: 0706-004 Cannot find or read export file: Modules/python.exp

These ./python.exp can be found as
/usr/local/lib/python2.4/config/python.exp in the installed python
distribution
So the Makefile for Modpython should have a Section for AIX where the
makefile does the following:
Get the python installation directory ( in my case
/usr/local/lib/python2.4 )
Create a Subdirectory in ./src for Modules ( mkdir Modules )
Creates a Link in ./src/Modules to
/usr/local/lib/python2.4/config/python.exp 

OR
just makes mkdir ./src/Modules && touch ./src/Modules/python.exp

I have tested both without problems but i would prefer the first one.

After that i get from a make:
xlc_r -O -Isrc/include -I/usr/local/include/python2.4 -c
src/_pspmodule.c -o build/temp.aix-5.1-2.4/src/_pspmodule.o
"src/_pspmodule.c", line 32.61: 1506-137 (E) Declaration must declare
at least one declarator, tag, or the members of an enumeration.

but still compiles 

A make install will pass with out any error
I would like to provide a patch file for the Makefile but i am a totaly
newbe to C programming and building so i hope the above information will
help

No runtime testing has been done yet 

With kind regards
Hajo


>>> "Graham Dumpleton" <grahamd@dscpl.com.au> 09/01/06 22:38 >>>
Seems to be some quirk with xlc compiler. Never liked that compiler,
always did strange things.

Try hacking the code so that instead of:

  (destructor)request_dealloc,     /* tp_free */

it says:

  (void(*)(void*))request_dealloc,     /* tp_free */

Try a typedef for the function pointer if I got the cast wrong or it
doesn't want to accept that.

Graham

Hans-Joachim Ehlers wrote ..
> Hi folk,
> i am trying to build mod-python 3.1.4 on AIX 5.1 with xlc
> During the gmake i get the following error: .... 1506-196 (E)
> Initialization between types "void(*)(void*)" and "void(*)(struct
> _object*)" is not allowed 
> 
> any Tips ?
> tai 
> Hajo
> 
> For details see below
> 
> given:
> AIX 5.1
> vac 6.0 ( IBM xlc)
> mod-python 3.1.4
> Python 2.4.2 build as shared Lib application
> Apache 2.0.55
> 
> $ ./configure CC=xlc_r \
>  --with-thread       \
>  --with-python=/usr/local/bin/python \
>  --with-apxs=/usr/local/apache2/bin/apxs 
> 
> 
> $ gmake[1]: Entering directory
> `/homespace/hjehlers/workbench/modpython/mod_python-3.1.4/src'
> 
> Compiling for DSO.
> 
> /usr/local/apache2/bin/apxs
>
-I/homespace/hjehlers/workbench/modpython/mod_python-3.1.4/src/include
> -I/usr/local/apache2/include -I/usr/local/include/python2.4 -c
> mod_python.c _apachemodule.c requestobject.c tableobject.c util.c
> serverobject.c connobject.c filterobject.c hlist.c hlistobject.c
> -L/usr/local/lib/python2.4/config  -Wl,-bE:Modules/python.exp -lld  
> -L/opt/freeware/lib -ltk8.3 -ltcl8.3    -lm  -lpython2.4   -ldl   
-lm
> /usr/local/apache2/build/libtool --silent --mode=compile xlc_r
> -prefer-pic   -U__STR__ -D_THREAD_SAFE -D_USE_IRS -DAP_DEBUG -g
-qHALT=E
> -qfullpath -qinitauto=FE -qcheck=all -qinfo=pro
> -I/usr/local/apache2/include  -I/usr/local/apache2/include  
> -I/usr/local/apache2/include 
>
-I/homespace/hjehlers/workbench/modpython/mod_python-3.1.4/src/include
> -I/usr/local/apache2/include -I/usr/local/include/python2.4  -c -o
> mod_python.lo mod_python.c && touch mod_python.slo
> /usr/local/apache2/build/libtool --silent --mode=compile xlc_r
> -prefer-pic   -U__STR__ -D_THREAD_SAFE -D_USE_IRS -DAP_DEBUG -g
-qHALT=E
> -qfullpath -qinitauto=FE -qcheck=all -qinfo=pro
> -I/usr/local/apache2/include  -I/usr/local/apache2/include  
> -I/usr/local/apache2/include 
>
-I/homespace/hjehlers/workbench/modpython/mod_python-3.1.4/src/include
> -I/usr/local/apache2/include -I/usr/local/include/python2.4  -c -o
> _apachemodule.lo _apachemodule.c && touch _apachemodule.slo
> /usr/local/apache2/build/libtool --silent --mode=compile xlc_r
> -prefer-pic   -U__STR__ -D_THREAD_SAFE -D_USE_IRS -DAP_DEBUG -g
-qHALT=E
> -qfullpath -qinitauto=FE -qcheck=all -qinfo=pro
> -I/usr/local/apache2/include  -I/usr/local/apache2/include  
> -I/usr/local/apache2/include 
>
-I/homespace/hjehlers/workbench/modpython/mod_python-3.1.4/src/include
> -I/usr/local/apache2/include -I/usr/local/include/python2.4  -c -o
> requestobject.lo requestobject.c && touch requestobject.slo
> "requestobject.c", line 1381.5: 1506-196 (E) Initialization between
> types "void(*)(void*)" and "void(*)(struct _object*)" is not
allowed.
> apxs:Error: Command failed with rc=65536
> .
> gmake[1]: *** [mod_python.so] Error 1
> gmake[1]: Leaving directory
> `/homespace/hjehlers/workbench/modpython/mod_python-3.1.4/src'
> gmake: *** [do_dso] Error 2
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org 
> http://mailman.modpython.org/mailman/listinfo/mod_python
From grahamd at dscpl.com.au  Tue Jan 10 05:33:57 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Tue Jan 10 05:34:19 2006
Subject: [mod_python] make failed on AIX 5.1 using xlc
In-Reply-To: <s3c3981f.081@gwn0201.eumetsat.int>
References: <s3c3981f.081@gwn0201.eumetsat.int>
Message-ID: <303cdf397c471cf5960927ce6775d9e2@dscpl.com.au>


On 10/01/2006, at 9:18 PM, Hans-Joachim Ehlers wrote:

> 2)
> Under AIX the Compilation of python is somehow quite uncommon
> Just see the out from from the mod_python make:
>
> /usr/local/apache2/build/libtool --silent --mode=link xlc_r -o
> mod_python.la  -rpath /usr/local/apache2/modules -module -avoid-version
> -Wl,-brtl  hlistobject.lo hlist.lo filterobject.lo connobject.lo
> serverobject.lo util.lo tableobject.lo requestobject.lo 
> _apachemodule.lo
> mod_python.lo -L/usr/local/lib/python2.4/config
> -Wl,-bE:Modules/python.exp -lld -L/opt/freeware/lib -ltk8.3 -ltcl8.3 
> -lm
> -lpython2.4 -ldl -lm
> ld: 0706-004 Cannot find or read export file: Modules/python.exp
>
> These ./python.exp can be found as
> /usr/local/lib/python2.4/config/python.exp in the installed python
> distribution
> So the Makefile for Modpython should have a Section for AIX where the
> makefile does the following:
> Get the python installation directory ( in my case
> /usr/local/lib/python2.4 )
> Create a Subdirectory in ./src for Modules ( mkdir Modules )
> Creates a Link in ./src/Modules to
> /usr/local/lib/python2.4/config/python.exp
>
> OR
> just makes mkdir ./src/Modules && touch ./src/Modules/python.exp
>
> I have tested both without problems but i would prefer the first one.

Look at /usr/local/lib/python2.4/config/Makefile. The mod_python
makefile is most likely getting the '-Wl,-bE:Modules/python.exp'
out of there.

Either one of two things might be wrong. First might be that the
option is exactly that and therefore that Makefile in Python is wrong.

Second thing that might be wrong is that the option is actually
written as '-El,-bE:$(DESTDIR)$(LIBPL)/python.exp' and that is what
mod_python is using but DESTDIR and LIBPL aren't actually set and
thus are being replaced with nothing.

If the latter, one might argue that mod_python could set one or both
of these variables in its makefile somehow to ensure they are expanded
correctly.

Find where '-El,-bE' is defined in the Python installed Makefile and
email back that line and the few either side of it.

> After that i get from a make:
> xlc_r -O -Isrc/include -I/usr/local/include/python2.4 -c
> src/_pspmodule.c -o build/temp.aix-5.1-2.4/src/_pspmodule.o
> "src/_pspmodule.c", line 32.61: 1506-137 (E) Declaration must declare
> at least one declarator, tag, or the members of an enumeration.
>
> but still compiles

If that is the line:

   static int yy_init_globals (yyscan_t yyscanner ) {return 0;};

it is because of the extraneous semicolon on the end of the line. From
memory, both AIX C compiler and Sun C++ compiler would complain about
such extra semicolons.

> A make install will pass with out any error
> I would like to provide a patch file for the Makefile but i am a totaly
> newbe to C programming and building so i hope the above information 
> will
> help
>
> No runtime testing has been done yet
>
> With kind regards
> Hajo
>
>
>>>> "Graham Dumpleton" <grahamd@dscpl.com.au> 09/01/06 22:38 >>>
> Seems to be some quirk with xlc compiler. Never liked that compiler,
> always did strange things.
>
> Try hacking the code so that instead of:
>
>   (destructor)request_dealloc,     /* tp_free */
>
> it says:
>
>   (void(*)(void*))request_dealloc,     /* tp_free */
>
> Try a typedef for the function pointer if I got the cast wrong or it
> doesn't want to accept that.
>
> Graham
>
> Hans-Joachim Ehlers wrote ..
>> Hi folk,
>> i am trying to build mod-python 3.1.4 on AIX 5.1 with xlc
>> During the gmake i get the following error: .... 1506-196 (E)
>> Initialization between types "void(*)(void*)" and "void(*)(struct
>> _object*)" is not allowed
>>
>> any Tips ?
>> tai
>> Hajo
>>
>> For details see below
>>
>> given:
>> AIX 5.1
>> vac 6.0 ( IBM xlc)
>> mod-python 3.1.4
>> Python 2.4.2 build as shared Lib application
>> Apache 2.0.55
>>
>> $ ./configure CC=xlc_r \
>>  --with-thread       \
>>  --with-python=/usr/local/bin/python \
>>  --with-apxs=/usr/local/apache2/bin/apxs
>>
>>
>> $ gmake[1]: Entering directory
>> `/homespace/hjehlers/workbench/modpython/mod_python-3.1.4/src'
>>
>> Compiling for DSO.
>>
>> /usr/local/apache2/bin/apxs
>>
> -I/homespace/hjehlers/workbench/modpython/mod_python-3.1.4/src/include
>> -I/usr/local/apache2/include -I/usr/local/include/python2.4 -c
>> mod_python.c _apachemodule.c requestobject.c tableobject.c util.c
>> serverobject.c connobject.c filterobject.c hlist.c hlistobject.c
>> -L/usr/local/lib/python2.4/config  -Wl,-bE:Modules/python.exp -lld
>> -L/opt/freeware/lib -ltk8.3 -ltcl8.3    -lm  -lpython2.4   -ldl
> -lm
>> /usr/local/apache2/build/libtool --silent --mode=compile xlc_r
>> -prefer-pic   -U__STR__ -D_THREAD_SAFE -D_USE_IRS -DAP_DEBUG -g
> -qHALT=E
>> -qfullpath -qinitauto=FE -qcheck=all -qinfo=pro
>> -I/usr/local/apache2/include  -I/usr/local/apache2/include
>> -I/usr/local/apache2/include
>>
> -I/homespace/hjehlers/workbench/modpython/mod_python-3.1.4/src/include
>> -I/usr/local/apache2/include -I/usr/local/include/python2.4  -c -o
>> mod_python.lo mod_python.c && touch mod_python.slo
>> /usr/local/apache2/build/libtool --silent --mode=compile xlc_r
>> -prefer-pic   -U__STR__ -D_THREAD_SAFE -D_USE_IRS -DAP_DEBUG -g
> -qHALT=E
>> -qfullpath -qinitauto=FE -qcheck=all -qinfo=pro
>> -I/usr/local/apache2/include  -I/usr/local/apache2/include
>> -I/usr/local/apache2/include
>>
> -I/homespace/hjehlers/workbench/modpython/mod_python-3.1.4/src/include
>> -I/usr/local/apache2/include -I/usr/local/include/python2.4  -c -o
>> _apachemodule.lo _apachemodule.c && touch _apachemodule.slo
>> /usr/local/apache2/build/libtool --silent --mode=compile xlc_r
>> -prefer-pic   -U__STR__ -D_THREAD_SAFE -D_USE_IRS -DAP_DEBUG -g
> -qHALT=E
>> -qfullpath -qinitauto=FE -qcheck=all -qinfo=pro
>> -I/usr/local/apache2/include  -I/usr/local/apache2/include
>> -I/usr/local/apache2/include
>>
> -I/homespace/hjehlers/workbench/modpython/mod_python-3.1.4/src/include
>> -I/usr/local/apache2/include -I/usr/local/include/python2.4  -c -o
>> requestobject.lo requestobject.c && touch requestobject.slo
>> "requestobject.c", line 1381.5: 1506-196 (E) Initialization between
>> types "void(*)(void*)" and "void(*)(struct _object*)" is not
> allowed.
>> apxs:Error: Command failed with rc=65536
>> .
>> gmake[1]: *** [mod_python.so] Error 1
>> gmake[1]: Leaving directory
>> `/homespace/hjehlers/workbench/modpython/mod_python-3.1.4/src'
>> gmake: *** [do_dso] Error 2
>>
>> _______________________________________________
>> Mod_python mailing list
>> Mod_python@modpython.org
>> http://mailman.modpython.org/mailman/listinfo/mod_python

From HansJoachim.Ehlers at eumetsat.int  Tue Jan 10 06:47:08 2006
From: HansJoachim.Ehlers at eumetsat.int (Hans-Joachim Ehlers)
Date: Tue Jan 10 06:47:44 2006
Subject: [mod_python] make failed on AIX 5.1 using xlc
Message-ID: <s3c3aceb.007@gwn0201.eumetsat.int>

>Find where '-El,-bE' is defined in the Python installed Makefile and
>email back that line and the few either side of it.
I think you mean : '-Wl,bE' This option is set with the   LINKFORSHARED
Variable
See extract from Makefile and configure.in 
BTW: The python tarball has a ./Python-2.4.2/Modules/python.exp

Shell i open a bug with the python group ?

Regarding:

>> but still compiles
>
> If that is the line:
>   static int yy_init_globals (yyscan_t yyscanner ) {return 0;};

Yes it is this line 

>
> it is because of the extraneous semicolon on the end of the line.
From
>memory, both AIX C compiler and Sun C++ compiler would complain about
> such extra semicolons.

So i can ignore the error message or do i have to change that line ?

regards
Hajo


>From /usr/local/lib/python/config/Makefile ( +NNN means line No. )

   +34  LINKCC=         $(srcdir)/Modules/makexp_aix Modules/python.exp
. $(LIBRARY); $(PURIFY) $(CC)

   +56  # Compiler options
   +57  OPT=            -O
   +58  BASECFLAGS=
   +59  CFLAGS=         $(BASECFLAGS) $(OPT)
   +60  CPPFLAGS=       -I. -I$(srcdir)/Include
   +61  LDFLAGS=        -L/opt/freeware/lib -ltk8.3 -ltcl8.3
   +62  LDLAST=
   +63  SGI_ABI=
   +64  CCSHARED=
   +65  LINKFORSHARED=  -Wl,-bE:Modules/python.exp -lld
   +66  # Extra C flags added for building the interpreter object
files.
   +67  CFLAGSFORSHARED=
   +68  # C flags used for building the interpreter object files
   +69  PY_CFLAGS=      $(CFLAGS) $(CPPFLAGS) $(CFLAGSFORSHARED)
-DPy_BUILD_CORE
   +70

   +96  # Symbols used for using shared libraries
   +97  SO=             .so
   +98  LDSHARED=       $(BINLIBDEST)/config/ld_so_aix $(CC)
-bI:$(BINLIBDEST)/config/python.exp
   +99  BLDSHARED=      $(srcdir)/Modules/ld_so_aix $(CC)
-bI:Modules/python.exp

  +326  # Build the interpreter
  +327  $(BUILDPYTHON): Modules/$(MAINOBJ) $(LIBRARY) $(LDLIBRARY)
  +328                  $(LINKCC) $(LDFLAGS) $(LINKFORSHARED) -o $@ \
  +329                          Modules/$(MAINOBJ) \
  +330                          $(BLDLIBRARY) $(LIBS) $(MODLIBS)
$(SYSLIBS) $(LDLAST)

Extract from the Python configure.in
...
# This is altered for AIX in order to build the export list before
# linking.
AC_SUBST(LINKCC)
AC_MSG_CHECKING(LINKCC)
if test -z "$LINKCC"
then
....
        AIX*)
           exp_extra="\"\""
           if test $ac_sys_release -ge 5 -o \
                   $ac_sys_release -eq 4 -a `uname -r` -ge 2 ; then
               exp_extra="."
           fi
           LINKCC="\$(srcdir)/Modules/makexp_aix Modules/python.exp
$exp_extra \$(LIBRARY); $LINKCC";;
....
fi
....
# Python, as opposed to building Python itself as a shared library.)
AC_MSG_CHECKING(LDSHARED)
if test -z "$LDSHARED"
then
        case $ac_sys_system/$ac_sys_release in
        AIX*)
                BLDSHARED="\$(srcdir)/Modules/ld_so_aix \$(CC)
-bI:Modules/python.exp"
                LDSHARED="\$(BINLIBDEST)/config/ld_so_aix \$(CC)
-bI:\$(BINLIBDEST)/config/python.exp"
                ;;
.....
# LINKFORSHARED are the flags passed to the $(CC) command that links
# the python executable -- this is only needed for a few systems
AC_MSG_CHECKING(LINKFORSHARED)
if test -z "$LINKFORSHARED"
then
        case $ac_sys_system/$ac_sys_release in
        AIX*)   LINKFORSHARED='-Wl,-bE:Modules/python.exp -lld';;
.....






>>> Graham Dumpleton <grahamd@dscpl.com.au> 10/01/06 11:33 >>>

On 10/01/2006, at 9:18 PM, Hans-Joachim Ehlers wrote:

> 2)
> Under AIX the Compilation of python is somehow quite uncommon
> Just see the out from from the mod_python make:
>
> /usr/local/apache2/build/libtool --silent --mode=link xlc_r -o
> mod_python.la  -rpath /usr/local/apache2/modules -module
-avoid-version
> -Wl,-brtl  hlistobject.lo hlist.lo filterobject.lo connobject.lo
> serverobject.lo util.lo tableobject.lo requestobject.lo 
> _apachemodule.lo
> mod_python.lo -L/usr/local/lib/python2.4/config
> -Wl,-bE:Modules/python.exp -lld -L/opt/freeware/lib -ltk8.3 -ltcl8.3

> -lm
> -lpython2.4 -ldl -lm
> ld: 0706-004 Cannot find or read export file: Modules/python.exp
>
> These ./python.exp can be found as
> /usr/local/lib/python2.4/config/python.exp in the installed python
> distribution
> So the Makefile for Modpython should have a Section for AIX where
the
> makefile does the following:
> Get the python installation directory ( in my case
> /usr/local/lib/python2.4 )
> Create a Subdirectory in ./src for Modules ( mkdir Modules )
> Creates a Link in ./src/Modules to
> /usr/local/lib/python2.4/config/python.exp
>
> OR
> just makes mkdir ./src/Modules && touch ./src/Modules/python.exp
>
> I have tested both without problems but i would prefer the first
one.

Look at /usr/local/lib/python2.4/config/Makefile. The mod_python
makefile is most likely getting the '-Wl,-bE:Modules/python.exp'
out of there.

Either one of two things might be wrong. First might be that the
option is exactly that and therefore that Makefile in Python is wrong.

Second thing that might be wrong is that the option is actually
written as '-El,-bE:$(DESTDIR)$(LIBPL)/python.exp' and that is what
mod_python is using but DESTDIR and LIBPL aren't actually set and
thus are being replaced with nothing.

If the latter, one might argue that mod_python could set one or both
of these variables in its makefile somehow to ensure they are expanded
correctly.

Find where '-El,-bE' is defined in the Python installed Makefile and
email back that line and the few either side of it.

> After that i get from a make:
> xlc_r -O -Isrc/include -I/usr/local/include/python2.4 -c
> src/_pspmodule.c -o build/temp.aix-5.1-2.4/src/_pspmodule.o
> "src/_pspmodule.c", line 32.61: 1506-137 (E) Declaration must
declare
> at least one declarator, tag, or the members of an enumeration.
>
> but still compiles

If that is the line:

   static int yy_init_globals (yyscan_t yyscanner ) {return 0;};

it is because of the extraneous semicolon on the end of the line. From
memory, both AIX C compiler and Sun C++ compiler would complain about
such extra semicolons.

> A make install will pass with out any error
> I would like to provide a patch file for the Makefile but i am a
totaly
> newbe to C programming and building so i hope the above information 
> will
> help
>
> No runtime testing has been done yet
>
> With kind regards
> Hajo
>
>
>>>> "Graham Dumpleton" <grahamd@dscpl.com.au> 09/01/06 22:38 >>>
> Seems to be some quirk with xlc compiler. Never liked that compiler,
> always did strange things.
>
> Try hacking the code so that instead of:
>
>   (destructor)request_dealloc,     /* tp_free */
>
> it says:
>
>   (void(*)(void*))request_dealloc,     /* tp_free */
>
> Try a typedef for the function pointer if I got the cast wrong or it
> doesn't want to accept that.
>
> Graham
>
> Hans-Joachim Ehlers wrote ..
>> Hi folk,
>> i am trying to build mod-python 3.1.4 on AIX 5.1 with xlc
>> During the gmake i get the following error: .... 1506-196 (E)
>> Initialization between types "void(*)(void*)" and "void(*)(struct
>> _object*)" is not allowed
>>
>> any Tips ?
>> tai
>> Hajo
>>
>> For details see below
>>
>> given:
>> AIX 5.1
>> vac 6.0 ( IBM xlc)
>> mod-python 3.1.4
>> Python 2.4.2 build as shared Lib application
>> Apache 2.0.55
>>
>> $ ./configure CC=xlc_r \
>>  --with-thread       \
>>  --with-python=/usr/local/bin/python \
>>  --with-apxs=/usr/local/apache2/bin/apxs
>>
>>
>> $ gmake[1]: Entering directory
>> `/homespace/hjehlers/workbench/modpython/mod_python-3.1.4/src'
>>
>> Compiling for DSO.
>>
>> /usr/local/apache2/bin/apxs
>>
>
-I/homespace/hjehlers/workbench/modpython/mod_python-3.1.4/src/include
>> -I/usr/local/apache2/include -I/usr/local/include/python2.4 -c
>> mod_python.c _apachemodule.c requestobject.c tableobject.c util.c
>> serverobject.c connobject.c filterobject.c hlist.c hlistobject.c
>> -L/usr/local/lib/python2.4/config  -Wl,-bE:Modules/python.exp -lld
>> -L/opt/freeware/lib -ltk8.3 -ltcl8.3    -lm  -lpython2.4   -ldl
> -lm
>> /usr/local/apache2/build/libtool --silent --mode=compile xlc_r
>> -prefer-pic   -U__STR__ -D_THREAD_SAFE -D_USE_IRS -DAP_DEBUG -g
> -qHALT=E
>> -qfullpath -qinitauto=FE -qcheck=all -qinfo=pro
>> -I/usr/local/apache2/include  -I/usr/local/apache2/include
>> -I/usr/local/apache2/include
>>
>
-I/homespace/hjehlers/workbench/modpython/mod_python-3.1.4/src/include
>> -I/usr/local/apache2/include -I/usr/local/include/python2.4  -c -o
>> mod_python.lo mod_python.c && touch mod_python.slo
>> /usr/local/apache2/build/libtool --silent --mode=compile xlc_r
>> -prefer-pic   -U__STR__ -D_THREAD_SAFE -D_USE_IRS -DAP_DEBUG -g
> -qHALT=E
>> -qfullpath -qinitauto=FE -qcheck=all -qinfo=pro
>> -I/usr/local/apache2/include  -I/usr/local/apache2/include
>> -I/usr/local/apache2/include
>>
>
-I/homespace/hjehlers/workbench/modpython/mod_python-3.1.4/src/include
>> -I/usr/local/apache2/include -I/usr/local/include/python2.4  -c -o
>> _apachemodule.lo _apachemodule.c && touch _apachemodule.slo
>> /usr/local/apache2/build/libtool --silent --mode=compile xlc_r
>> -prefer-pic   -U__STR__ -D_THREAD_SAFE -D_USE_IRS -DAP_DEBUG -g
> -qHALT=E
>> -qfullpath -qinitauto=FE -qcheck=all -qinfo=pro
>> -I/usr/local/apache2/include  -I/usr/local/apache2/include
>> -I/usr/local/apache2/include
>>
>
-I/homespace/hjehlers/workbench/modpython/mod_python-3.1.4/src/include
>> -I/usr/local/apache2/include -I/usr/local/include/python2.4  -c -o
>> requestobject.lo requestobject.c && touch requestobject.slo
>> "requestobject.c", line 1381.5: 1506-196 (E) Initialization between
>> types "void(*)(void*)" and "void(*)(struct _object*)" is not
> allowed.
>> apxs:Error: Command failed with rc=65536
>> .
>> gmake[1]: *** [mod_python.so] Error 1
>> gmake[1]: Leaving directory
>> `/homespace/hjehlers/workbench/modpython/mod_python-3.1.4/src'
>> gmake: *** [do_dso] Error 2
>>
>> _______________________________________________
>> Mod_python mailing list
>> Mod_python@modpython.org 
>> http://mailman.modpython.org/mailman/listinfo/mod_python 

From dave at davebritton.com  Tue Jan 10 07:32:52 2006
From: dave at davebritton.com (Dave Britton)
Date: Tue Jan 10 07:34:10 2006
Subject: [mod_python] error while inserting data
References: <20060109130117.97540.qmail@web36404.mail.mud.yahoo.com>
Message-ID: <097601c615e1$fa1fa2c0$0500a8c0@brittonfamily.org>

Construct the sql query and print it out before you do the cursor.execute. Then you can see what is wrong with the query that causes it to fail in Oracle. eg:

sql = "INSERT INTO PERSONALDETAILS (firstname,middlename,lastname) VALUES (%s, %s, %s)"%(fname,mname,lname)
writeln(sql)
# now you will see the bad SQL statement!

Possibly you have no value for one of the cgi variables because of leaving the form field blank (such as no middle name), which will cause the function to fail because that variable will not exist. You must be sure you have default values set for your cgi variable in the function definition eg: def index(req, fname="", mname='"", lname="") so that all variables will exist and have valid string definitions even if the user does not enter anything into that field on the html form. Also, maybe you misspelled one of the form variable names in the html form. We cannot tell from this snippet.
-Dave
  ----- Original Message ----- 
  From: python eager 
  To: mod_python@modpython.org 
  Sent: Monday, January 09, 2006 8:01 AM
  Subject: [mod_python] error while inserting data


  Hi 
   i m getting the following errors. Please solve this problem
  Hi this is my code snippet. 

            req = self.request()
            fname = req.field('fname')
            mname = req.field('mname')
            lname = req.field('lname')
            dbconnection = cx_Oracle.connect("myuser", "mypassword", "mydatabase")
            cursor = dbconnection.cursor()
            cursor.arraysize = 50
            self.writeln("hello")
            cursor.execute("INSERT INTO PERSONALDETAILS     (firstname,middlename,lastname) VALUES (%s, %s, %s)", (fname,mname,lname))
   dbconnection.commit()

  While executing i am getting the following error 

  cursor.execute("INSERT INTO PERSONALDETAILS(firstname,middlename,lastname) VALUES (%s, %s, %s)", (fname,mname,lname))
  DatabaseError: ORA-01036: illegal variable name/number

  please solve this problem.

  regards
  Python Eager



------------------------------------------------------------------------------
  Yahoo! Photos
  Ring in the New Year with Photo Calendars. Add photos, events, holidays, whatever.


------------------------------------------------------------------------------


  _______________________________________________
  Mod_python mailing list
  Mod_python@modpython.org
  http://mailman.modpython.org/mailman/listinfo/mod_python
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20060110/30dd323a/attachment-0001.html
From emlynj at gmail.com  Tue Jan 10 08:06:57 2006
From: emlynj at gmail.com (Emlyn Jones)
Date: Tue Jan 10 08:07:06 2006
Subject: [mod_python] urlopen permissions
Message-ID: <f4b5a9620601100506j7ec1645dw6536b8c55631fc74@mail.gmail.com>

Hello,
I'm not convinced that this is a specific mod_python problem but I'm not
sure exactly how to explain it in generic terms so hopefully someone here
can point me in the right direction.
I have a python script which calls urllib2.urlopen to open a url on a remote
server (google). It works fine from the command line but when I run it from
a mod_python.psp page I get:

HTTPError: HTTP Error 403: Forbidden

Clearly this is something to do with the permissions of the apache user vs
my shell user but what is the safest way to allow this script to run?

Regards,
Emlyn.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20060110/f3b2074b/attachment.html
From courtneyludwin at yahoo.com  Tue Jan 10 09:21:30 2006
From: courtneyludwin at yahoo.com (courtney ludwin)
Date: Tue Jan 10 09:21:33 2006
Subject: [mod_python] SetHandler trick to have pretty url's
In-Reply-To: <59bc7c7fe4bb17528889cf96a5ec42e9@dscpl.com.au>
Message-ID: <20060110142131.37076.qmail@web34804.mail.mud.yahoo.com>

Good call on the "Deny from all" I keep the python src
in it's own directory structure away from htdocs.  I
have had issues in the past w/ "SetHandler none"
before, I remember it not working that well.

The reason that I set up the url map was so that my
python code could live in it's own directory
structure, one that makes sense from a package
perspective not necessarily a url perspective.

e.g.:

conf/
  urlmap.config  

htdocs/
  css/
  images/
  js/
  somefile.html

src/
  somecoolap/
    common/
    appspecific1/
    appspecific2/


Courtney

--- Graham Dumpleton <grahamd@dscpl.com.au> wrote:

> 
> On 10/01/2006, at 8:14 PM, Graham Dumpleton wrote:
> 
> >
> > On 10/01/2006, at 5:52 PM, courtney ludwin wrote:
> >
> >>  <FilesMatch "(^[^\.]*$|^[^\?]*[\?]+[^$]+$)">
> >>     SetHandler python-program
> >>     PythonHandler common.dispatch.dispatcher
> >>     PythonDebug On
> >>   </FilesMatch>
> >
> >   SetHandler python-program
> >   PythonHandler common.dispatch.dispatcher
> >   PythonDebug On
> >
> >   <Files *.*>
> >   SetHandler None
> >   </Files>
> 
> BTW, I should point out that both of these
> techniques are actually
> dangerous to use if you keep your Python code for
> your handler in
> the same directory. That is because your .py and
> .pyc files are
> accessible for people to download. Always a good
> idea to also use:
> 
>    <Files "*.py">
>    deny from all
>    </Files>
>    <Files "*.pyc">
>    deny from all
>    </Files>
> 
> Or similar obscure regular expression which catches
> both at the
> same time.
> 
> Graham
> 
> 



		
__________________________________________ 
Yahoo! DSL ? Something to write home about. 
Just $16.99/mo. or less. 
dsl.yahoo.com 

From deron.meranda at gmail.com  Tue Jan 10 11:18:20 2006
From: deron.meranda at gmail.com (Deron Meranda)
Date: Tue Jan 10 11:18:23 2006
Subject: [mod_python] SetHandler trick to have pretty url's
In-Reply-To: <59bc7c7fe4bb17528889cf96a5ec42e9@dscpl.com.au>
References: <20060110065205.60534.qmail@web34811.mail.mud.yahoo.com>
	<7515070139c5b26110856958342ebd61@dscpl.com.au>
	<59bc7c7fe4bb17528889cf96a5ec42e9@dscpl.com.au>
Message-ID: <5c06fa770601100818s26118510o463c08f11a34f465@mail.gmail.com>

On 1/10/06, Graham Dumpleton <grahamd@dscpl.com.au> wrote:
> ...your .py and .pyc files are
> accessible for people to download. Always a good idea to also use:
>
>    <Files "*.py">
>    deny from all
>    </Files>
>    <Files "*.pyc">
>    deny from all
>    </Files>

Don't forget your *.pyo files as well, if you have any.
--
Deron Meranda

From grahamd at dscpl.com.au  Tue Jan 10 16:54:54 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Tue Jan 10 16:55:03 2006
Subject: [mod_python] make failed on AIX 5.1 using xlc
Message-ID: <1136930094.26974@dscpl.user.openhosting.com>

Hans-Joachim Ehlers wrote ..
> >Find where '-El,-bE' is defined in the Python installed Makefile and
> >email back that line and the few either side of it.
> I think you mean : '-Wl,bE' This option is set with the   LINKFORSHARED
> Variable
> See extract from Makefile and configure.in 
> BTW: The python tarball has a ./Python-2.4.2/Modules/python.exp
> 
> Shell i open a bug with the python group ?

Possibly not.

What I would suggest first is that you find a Python extension module off
the net that has both a C code component and a Python component and
which uses distutils module for installation. These are ones which usually
have a "setup.py" file. Since you are doing web stuff, maybe you should
try Cheetah.

Try and install the module, if the configuration in that Python installed
Makefile, which is also consulted by distutils module for installation,
causes the compilation of the C component of the Python package being
built to fail, then it would an issue which is possibly reported to main
Python developers, or at least sorted out on Python news group or
mailing list as to what is wrong as at that point it would be independent
of mod_python.

If the C component of the Python package builds okay, then it is more
likely how mod_python is using the information in that Python Makefile
that is the problem.

Specifically, the "configure" script of mod_python contains:

  PyLFS=`grep "^LINKFORSHARED=" ${PyLIBPL}/Makefile | cut -f2 -d= | tr '\011\012\015' '   '`
  PyLDFLAGS=`grep "^LDFLAGS=" ${PyLIBPL}/Makefile | cut -f2 -d= | tr '\011\012\015' '   '`
  LDFLAGS="${LDFLAGS} ${PyLFS} ${PyLDFLAGS}"
  LDFLAGS="${LDFLAGS} ${PY_LDFLAGS}"

Thus, it is extracted LINKFORSHARED out of the Python Makefile and used
it to construct the LDFLAGS for the generated mod_python Makefile.

As much as one could make mod_python handle it, am not sure it is
worth the trouble. I would simply suggest that after you run 'configure'
that you edit the generated makefile, probably 'src/Makefile' and delete
the '-Wl,-bE:Modules/python.exp' option from it.

Similar situation for the function cast you had to change in requestobject.c.
It just becomes to much of a pain to try and deal with the strangeness of
lessor used compilers.

Graham

> Regarding:
> 
> >> but still compiles
> >
> > If that is the line:
> >   static int yy_init_globals (yyscan_t yyscanner ) {return 0;};
> 
> Yes it is this line 
> 
> >
> > it is because of the extraneous semicolon on the end of the line.
> From
> >memory, both AIX C compiler and Sun C++ compiler would complain about
> > such extra semicolons.
> 
> So i can ignore the error message or do i have to change that line ?
> 
> regards
> Hajo
> 
> 
> >From /usr/local/lib/python/config/Makefile ( +NNN means line No. )
> 
>    +34  LINKCC=         $(srcdir)/Modules/makexp_aix Modules/python.exp
> . $(LIBRARY); $(PURIFY) $(CC)
> 
>    +56  # Compiler options
>    +57  OPT=            -O
>    +58  BASECFLAGS=
>    +59  CFLAGS=         $(BASECFLAGS) $(OPT)
>    +60  CPPFLAGS=       -I. -I$(srcdir)/Include
>    +61  LDFLAGS=        -L/opt/freeware/lib -ltk8.3 -ltcl8.3
>    +62  LDLAST=
>    +63  SGI_ABI=
>    +64  CCSHARED=
>    +65  LINKFORSHARED=  -Wl,-bE:Modules/python.exp -lld
>    +66  # Extra C flags added for building the interpreter object
> files.
>    +67  CFLAGSFORSHARED=
>    +68  # C flags used for building the interpreter object files
>    +69  PY_CFLAGS=      $(CFLAGS) $(CPPFLAGS) $(CFLAGSFORSHARED)
> -DPy_BUILD_CORE
>    +70
> 
>    +96  # Symbols used for using shared libraries
>    +97  SO=             .so
>    +98  LDSHARED=       $(BINLIBDEST)/config/ld_so_aix $(CC)
> -bI:$(BINLIBDEST)/config/python.exp
>    +99  BLDSHARED=      $(srcdir)/Modules/ld_so_aix $(CC)
> -bI:Modules/python.exp
> 
>   +326  # Build the interpreter
>   +327  $(BUILDPYTHON): Modules/$(MAINOBJ) $(LIBRARY) $(LDLIBRARY)
>   +328                  $(LINKCC) $(LDFLAGS) $(LINKFORSHARED) -o $@ \
>   +329                          Modules/$(MAINOBJ) \
>   +330                          $(BLDLIBRARY) $(LIBS) $(MODLIBS)
> $(SYSLIBS) $(LDLAST)
> 
> Extract from the Python configure.in
> ...
> # This is altered for AIX in order to build the export list before
> # linking.
> AC_SUBST(LINKCC)
> AC_MSG_CHECKING(LINKCC)
> if test -z "$LINKCC"
> then
> ....
>         AIX*)
>            exp_extra="\"\""
>            if test $ac_sys_release -ge 5 -o \
>                    $ac_sys_release -eq 4 -a `uname -r` -ge 2 ; then
>                exp_extra="."
>            fi
>            LINKCC="\$(srcdir)/Modules/makexp_aix Modules/python.exp
> $exp_extra \$(LIBRARY); $LINKCC";;
> ....
> fi
> ....
> # Python, as opposed to building Python itself as a shared library.)
> AC_MSG_CHECKING(LDSHARED)
> if test -z "$LDSHARED"
> then
>         case $ac_sys_system/$ac_sys_release in
>         AIX*)
>                 BLDSHARED="\$(srcdir)/Modules/ld_so_aix \$(CC)
> -bI:Modules/python.exp"
>                 LDSHARED="\$(BINLIBDEST)/config/ld_so_aix \$(CC)
> -bI:\$(BINLIBDEST)/config/python.exp"
>                 ;;
> .....
> # LINKFORSHARED are the flags passed to the $(CC) command that links
> # the python executable -- this is only needed for a few systems
> AC_MSG_CHECKING(LINKFORSHARED)
> if test -z "$LINKFORSHARED"
> then
>         case $ac_sys_system/$ac_sys_release in
>         AIX*)   LINKFORSHARED='-Wl,-bE:Modules/python.exp -lld';;
> .....
> 
> 
> 
> 
> 
> 
> >>> Graham Dumpleton <grahamd@dscpl.com.au> 10/01/06 11:33 >>>
> 
> On 10/01/2006, at 9:18 PM, Hans-Joachim Ehlers wrote:
> 
> > 2)
> > Under AIX the Compilation of python is somehow quite uncommon
> > Just see the out from from the mod_python make:
> >
> > /usr/local/apache2/build/libtool --silent --mode=link xlc_r -o
> > mod_python.la  -rpath /usr/local/apache2/modules -module
> -avoid-version
> > -Wl,-brtl  hlistobject.lo hlist.lo filterobject.lo connobject.lo
> > serverobject.lo util.lo tableobject.lo requestobject.lo 
> > _apachemodule.lo
> > mod_python.lo -L/usr/local/lib/python2.4/config
> > -Wl,-bE:Modules/python.exp -lld -L/opt/freeware/lib -ltk8.3 -ltcl8.3
> 
> > -lm
> > -lpython2.4 -ldl -lm
> > ld: 0706-004 Cannot find or read export file: Modules/python.exp
> >
> > These ./python.exp can be found as
> > /usr/local/lib/python2.4/config/python.exp in the installed python
> > distribution
> > So the Makefile for Modpython should have a Section for AIX where
> the
> > makefile does the following:
> > Get the python installation directory ( in my case
> > /usr/local/lib/python2.4 )
> > Create a Subdirectory in ./src for Modules ( mkdir Modules )
> > Creates a Link in ./src/Modules to
> > /usr/local/lib/python2.4/config/python.exp
> >
> > OR
> > just makes mkdir ./src/Modules && touch ./src/Modules/python.exp
> >
> > I have tested both without problems but i would prefer the first
> one.
> 
> Look at /usr/local/lib/python2.4/config/Makefile. The mod_python
> makefile is most likely getting the '-Wl,-bE:Modules/python.exp'
> out of there.
> 
> Either one of two things might be wrong. First might be that the
> option is exactly that and therefore that Makefile in Python is wrong.
> 
> Second thing that might be wrong is that the option is actually
> written as '-El,-bE:$(DESTDIR)$(LIBPL)/python.exp' and that is what
> mod_python is using but DESTDIR and LIBPL aren't actually set and
> thus are being replaced with nothing.
> 
> If the latter, one might argue that mod_python could set one or both
> of these variables in its makefile somehow to ensure they are expanded
> correctly.
> 
> Find where '-El,-bE' is defined in the Python installed Makefile and
> email back that line and the few either side of it.
> 
> > After that i get from a make:
> > xlc_r -O -Isrc/include -I/usr/local/include/python2.4 -c
> > src/_pspmodule.c -o build/temp.aix-5.1-2.4/src/_pspmodule.o
> > "src/_pspmodule.c", line 32.61: 1506-137 (E) Declaration must
> declare
> > at least one declarator, tag, or the members of an enumeration.
> >
> > but still compiles
> 
> If that is the line:
> 
>    static int yy_init_globals (yyscan_t yyscanner ) {return 0;};
> 
> it is because of the extraneous semicolon on the end of the line. From
> memory, both AIX C compiler and Sun C++ compiler would complain about
> such extra semicolons.
> 
> > A make install will pass with out any error
> > I would like to provide a patch file for the Makefile but i am a
> totaly
> > newbe to C programming and building so i hope the above information 
> > will
> > help
> >
> > No runtime testing has been done yet
> >
> > With kind regards
> > Hajo
> >
> >
> >>>> "Graham Dumpleton" <grahamd@dscpl.com.au> 09/01/06 22:38 >>>
> > Seems to be some quirk with xlc compiler. Never liked that compiler,
> > always did strange things.
> >
> > Try hacking the code so that instead of:
> >
> >   (destructor)request_dealloc,     /* tp_free */
> >
> > it says:
> >
> >   (void(*)(void*))request_dealloc,     /* tp_free */
> >
> > Try a typedef for the function pointer if I got the cast wrong or it
> > doesn't want to accept that.
> >
> > Graham
> >
> > Hans-Joachim Ehlers wrote ..
> >> Hi folk,
> >> i am trying to build mod-python 3.1.4 on AIX 5.1 with xlc
> >> During the gmake i get the following error: .... 1506-196 (E)
> >> Initialization between types "void(*)(void*)" and "void(*)(struct
> >> _object*)" is not allowed
> >>
> >> any Tips ?
> >> tai
> >> Hajo
> >>
> >> For details see below
> >>
> >> given:
> >> AIX 5.1
> >> vac 6.0 ( IBM xlc)
> >> mod-python 3.1.4
> >> Python 2.4.2 build as shared Lib application
> >> Apache 2.0.55
> >>
> >> $ ./configure CC=xlc_r \
> >>  --with-thread       \
> >>  --with-python=/usr/local/bin/python \
> >>  --with-apxs=/usr/local/apache2/bin/apxs
> >>
> >>
> >> $ gmake[1]: Entering directory
> >> `/homespace/hjehlers/workbench/modpython/mod_python-3.1.4/src'
> >>
> >> Compiling for DSO.
> >>
> >> /usr/local/apache2/bin/apxs
> >>
> >
> -I/homespace/hjehlers/workbench/modpython/mod_python-3.1.4/src/include
> >> -I/usr/local/apache2/include -I/usr/local/include/python2.4 -c
> >> mod_python.c _apachemodule.c requestobject.c tableobject.c util.c
> >> serverobject.c connobject.c filterobject.c hlist.c hlistobject.c
> >> -L/usr/local/lib/python2.4/config  -Wl,-bE:Modules/python.exp -lld
> >> -L/opt/freeware/lib -ltk8.3 -ltcl8.3    -lm  -lpython2.4   -ldl
> > -lm
> >> /usr/local/apache2/build/libtool --silent --mode=compile xlc_r
> >> -prefer-pic   -U__STR__ -D_THREAD_SAFE -D_USE_IRS -DAP_DEBUG -g
> > -qHALT=E
> >> -qfullpath -qinitauto=FE -qcheck=all -qinfo=pro
> >> -I/usr/local/apache2/include  -I/usr/local/apache2/include
> >> -I/usr/local/apache2/include
> >>
> >
> -I/homespace/hjehlers/workbench/modpython/mod_python-3.1.4/src/include
> >> -I/usr/local/apache2/include -I/usr/local/include/python2.4  -c -o
> >> mod_python.lo mod_python.c && touch mod_python.slo
> >> /usr/local/apache2/build/libtool --silent --mode=compile xlc_r
> >> -prefer-pic   -U__STR__ -D_THREAD_SAFE -D_USE_IRS -DAP_DEBUG -g
> > -qHALT=E
> >> -qfullpath -qinitauto=FE -qcheck=all -qinfo=pro
> >> -I/usr/local/apache2/include  -I/usr/local/apache2/include
> >> -I/usr/local/apache2/include
> >>
> >
> -I/homespace/hjehlers/workbench/modpython/mod_python-3.1.4/src/include
> >> -I/usr/local/apache2/include -I/usr/local/include/python2.4  -c -o
> >> _apachemodule.lo _apachemodule.c && touch _apachemodule.slo
> >> /usr/local/apache2/build/libtool --silent --mode=compile xlc_r
> >> -prefer-pic   -U__STR__ -D_THREAD_SAFE -D_USE_IRS -DAP_DEBUG -g
> > -qHALT=E
> >> -qfullpath -qinitauto=FE -qcheck=all -qinfo=pro
> >> -I/usr/local/apache2/include  -I/usr/local/apache2/include
> >> -I/usr/local/apache2/include
> >>
> >
> -I/homespace/hjehlers/workbench/modpython/mod_python-3.1.4/src/include
> >> -I/usr/local/apache2/include -I/usr/local/include/python2.4  -c -o
> >> requestobject.lo requestobject.c && touch requestobject.slo
> >> "requestobject.c", line 1381.5: 1506-196 (E) Initialization between
> >> types "void(*)(void*)" and "void(*)(struct _object*)" is not
> > allowed.
> >> apxs:Error: Command failed with rc=65536
> >> .
> >> gmake[1]: *** [mod_python.so] Error 1
> >> gmake[1]: Leaving directory
> >> `/homespace/hjehlers/workbench/modpython/mod_python-3.1.4/src'
> >> gmake: *** [do_dso] Error 2
> >>
> >> _______________________________________________
> >> Mod_python mailing list
> >> Mod_python@modpython.org 
> >> http://mailman.modpython.org/mailman/listinfo/mod_python 
From ccbean at gmail.com  Tue Jan 10 17:30:16 2006
From: ccbean at gmail.com (Colin Bean)
Date: Tue Jan 10 17:30:19 2006
Subject: [mod_python] urlopen permissions
In-Reply-To: <f4b5a9620601100506j7ec1645dw6536b8c55631fc74@mail.gmail.com>
References: <f4b5a9620601100506j7ec1645dw6536b8c55631fc74@mail.gmail.com>
Message-ID: <29a6ca010601101430k607c6ad9pc5167b266f640438@mail.gmail.com>

It looks like the 403 is being returned by Google, rather than your copy of
Apache.  I believe that Google has some rules designed to block web crawlers
/ scrapers under some circumstances.  One possibility would be that running
your script under apache changes something in the request headers that makes
Google block the request.  That's just a guess, though (and my knowledge of
Google's behavior is based on a project I did a couple of years ago; so take
it with a grain of salt).  Have you tried this code on some other URLs?
What kind of results do you get then?

hth,
-Colin



On 1/10/06, Emlyn Jones <emlynj@gmail.com> wrote:
>
> Hello,
> I'm not convinced that this is a specific mod_python problem but I'm not
> sure exactly how to explain it in generic terms so hopefully someone here
> can point me in the right direction.
> I have a python script which calls urllib2.urlopen to open a url on a
> remote server (google). It works fine from the command line but when I run
> it from a mod_python.psp page I get:
>
> HTTPError: HTTP Error 403: Forbidden
>
> Clearly this is something to do with the permissions of the apache user vs
> my shell user but what is the safest way to allow this script to run?
>
> Regards,
> Emlyn.
>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20060110/906a3865/attachment.html
From richard at voip.co.uk  Tue Jan 10 21:28:48 2006
From: richard at voip.co.uk (Richard Smith)
Date: Tue Jan 10 21:28:52 2006
Subject: [mod_python] Pattern Based Frameworks
Message-ID: <43C46D60.3050706@voip.co.uk>

Hey guys and gals,

I'm doing some research into open source pattern based frameworks for
Mod_Python...

Now the reason I'm posting to this list and not googling is quite simple.
The frameworks have to adhere to the following 3 rules:

No bloat: No unneccessary libraries/modules/support. Just a simple pattern
based request handler architecture.

No dependancy on any specific components: so Cheetah/CherryPy/Quixiote et al

Pure mod_python: the framework was built to work on mod_python alone. Any
subsequent contributions that allow it to work on other execution models but
are not a core part of the source are allowed.

Must be pattern based (Observer, singleton, MVC etc)

Must use realtime rendering of templates rather than a pre-compiled template.

I know this is a fairly tall order on the stakes of things, and hence why
I've had considerable difficulty in locating such frameworks.

I'd love to discuss onlist what people think of the various frameworks
available.

-- 
Richard Smith
Platform Engineer, VoIP.co.uk
Tel: +44 (0) 1908 764196
From grahamd at dscpl.com.au  Tue Jan 10 22:35:23 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Tue Jan 10 22:35:25 2006
Subject: [mod_python] Pattern Based Frameworks
Message-ID: <1136950523.13027@dscpl.user.openhosting.com>

Your requirements are a bit confusing. I've made a few comments
below, but before I get into an indepth discussion, how much do
you really know about mod_python, or are you relatively new to it?
Knowing this would help me in knowing where to pitch and further
detailed response.

Richard Smith wrote ..
> Hey guys and gals,
> 
> I'm doing some research into open source pattern based frameworks for
> Mod_Python...
> 
> Now the reason I'm posting to this list and not googling is quite simple.
> The frameworks have to adhere to the following 3 rules:
> 
> No bloat: No unneccessary libraries/modules/support. Just a simple pattern
> based request handler architecture.

Careful not to confuse large with bloat. Something can be large but
still well coded performance wise. It just may be that it has a large
feature set.

> No dependancy on any specific components: so Cheetah/CherryPy/Quixiote
> et al

Not sure why you may have bundled Cheetah in there as it sits quite
distinct from CherryPy and Quixiote. With Cheetah, it is basically just
a template system. It can be used on a number of other lower level
dispatchers. CherryPy and Quixiote are primarly dispatchers. That
CherryPy can sit on top of mod_python doesn't really matter, as it
pretty well ignores what URL mapping might be performed by Apache and
does the URL interpretation and dispatching itself. Ie., CherryPy really
just uses mod_python as a jump off point and doesn't really make use
of much of mod_python at all. Ie., doesn't use mod_python sessions,
form processing etc etc.

> Pure mod_python: the framework was built to work on mod_python alone. Any
> subsequent contributions that allow it to work on other execution models
> but
> are not a core part of the source are allowed.

This would again be where something like CherryPy doesn't qualify. The fact that
it does everything itself means it could quite as easily host of WSGI. Cheetah
doesn't really care what it is used with so isn't ruled out by this requirement.

Note, I am not pushing Cheetah over other systems, but just pointing out
that not sure why you have disqualified it already.

> Must be pattern based (Observer, singleton, MVC etc)

Pattern is such a general and misused term even if you quote examples. You
may want to provide more of a description of what you are hoping for.

> Must use realtime rendering of templates rather than a pre-compiled template.

Any specific reason why? The only problem with pre-compiled templates
is that systems that use them often don't implement a way of performing
on the fly reloading of template code when it changes on disk. Mod_python
has automatic module reloading which can help with that if the templating
system understands it to a degree, but for that to work properly will still
necessitate mod_python's automatic module reloading to be fixed as it is
currently broken in various way. A new implementation is basically ready
for experimenting with once mod_python 3.2 final is out of the way.

> I know this is a fairly tall order on the stakes of things, and hence why
> I've had considerable difficulty in locating such frameworks.
> 
> I'd love to discuss onlist what people think of the various frameworks
> available.

Happy to have a discussion, but rather than just give a list of frameworks,
would rather more understand the style of how you want to work and how close
an association with mod_python you really want.

Hope it doesn't sound like I am being too difficult.

Graham
From python_eager at yahoo.com  Wed Jan 11 00:14:18 2006
From: python_eager at yahoo.com (python eager)
Date: Wed Jan 11 00:14:22 2006
Subject: [mod_python] How to compare?
Message-ID: <20060111051418.25725.qmail@web36410.mail.mud.yahoo.com>

Hi ,
      here  i am comparing both the values of form value and table value. But it will not work . The result will be print "not equal". Table values are retrieved fine. Here what mistake i did. No compilation error and run time error. Please solve this problem.
   
  Code Snippet :
   
            req = self.request()
          pid = int(req.field('pid'))
          self.writeln(pid)
         
            dbconnection = cx_Oracle.connect("myusername", "mypassword", "mydatabase")
          cursor = dbconnection.cursor()
          cursor.arraysize = 50
          cursor.execute("SELECT PID FROM PERSONALDETAILS order by pid")
          for PID in cursor.fetchall():
             # Comparing here both formvalue and table value ( both are numeric)              
              if pid==PID:
                  self.writeln("Equal")
              else:
                  self.writeln("Not Equal")
   
  Thank you
  Python_Eager

			
---------------------------------
Yahoo! Photos
 Got holiday prints? See all the ways to get quality prints in your hands ASAP.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20060110/8f2575b5/attachment-0001.html
From grahamd at dscpl.com.au  Wed Jan 11 00:32:03 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Wed Jan 11 00:32:05 2006
Subject: [mod_python] How to compare?
Message-ID: <1136957523.21686@dscpl.user.openhosting.com>

As I told you when you made your first post, please use the Python DB-SIG
mailing list, or the main comp.lang.python news group for questions about
Oracle DB interfaces for Python. Just because you are using them in the
context of mod_python does not mean they are a mod_python question.
For the Python DB-SIG mailing list see:

  http://mail.python.org/mailman/listinfo/db-sig

For comp.lang.python newgroup, see:

  http://groups.google.com/group/comp.lang.python?hl=en

I'm patient, but you have ignored a couple of suggestions that there are
better places to ask these questions. Keep this up and you are most likely
just going to annoy people and they will stop being nice an answering
your questions.

Graham

python eager wrote ..
> Hi ,
>       here  i am comparing both the values of form value and table value.
> But it will not work . The result will be print "not equal". Table values
> are retrieved fine. Here what mistake i did. No compilation error and run
> time error. Please solve this problem.
>    
>   Code Snippet :
>    
>             req = self.request()
>           pid = int(req.field('pid'))
>           self.writeln(pid)
>          
>             dbconnection = cx_Oracle.connect("myusername", "mypassword",
> "mydatabase")
>           cursor = dbconnection.cursor()
>           cursor.arraysize = 50
>           cursor.execute("SELECT PID FROM PERSONALDETAILS order by pid")
>           for PID in cursor.fetchall():
>              # Comparing here both formvalue and table value ( both are
> numeric)              
>               if pid==PID:
>                   self.writeln("Equal")
>               else:
>                   self.writeln("Not Equal")
>    
>   Thank you
>   Python_Eager
> 
> 			
> ---------------------------------
> Yahoo! Photos
>  Got holiday prints? See all the ways to get quality prints in your hands
> ASAP.
From igp-dev at infogridpacific.com  Wed Jan 11 07:28:10 2006
From: igp-dev at infogridpacific.com (IGP-DEV)
Date: Wed Jan 11 01:57:57 2006
Subject: [mod_python] [SPAM] Caching Problem
Message-ID: <43C4F9DA.3050900@infogridpacific.com>

Hello friends ,
We are using Apache Server Version - 2.0.52 and mod-python version 3.1.4
I have enable disk based caching using mod-disk-cache as follows :-
<IfModule mod_cache.c>
    <IfModule mod_disk_cache.c>
        CacheRoot /var/cache/mod_proxy
        CacheSize  102400
        CacheMaxExpire 604800
        CacheEnable disk /
        CacheGcInterval 24
        CachegcDaily 23
        CacheDirLevels 3
        CacheDirLength 2
    </IfModule>
</IfModule>
The above settings were turned on in Apache configuration file.
But there is one problem , when the client browser requests for a html 
page for first time the servers delivers it and caching is being done , 
but when the  client browser clears its chache and again requests the 
same page , a string of html
is displayed on the browser.
Can you tell me why is it so and is there a solution for the above problem?
Thanks in advance ,
Regards,
Atul K
From grahamd at dscpl.com.au  Wed Jan 11 03:23:57 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Wed Jan 11 03:24:11 2006
Subject: [mod_python] Caching Problem
In-Reply-To: <43C4F9DA.3050900@infogridpacific.com>
References: <43C4F9DA.3050900@infogridpacific.com>
Message-ID: <6359F335-FCB9-4E2F-B295-64C0DDED12A3@dscpl.com.au>


On 11/01/2006, at 11:28 PM, IGP-DEV wrote:

> Hello friends ,
> We are using Apache Server Version - 2.0.52 and mod-python version  
> 3.1.4
> I have enable disk based caching using mod-disk-cache as follows :-
> <IfModule mod_cache.c>
>    <IfModule mod_disk_cache.c>
>        CacheRoot /var/cache/mod_proxy
>        CacheSize  102400
>        CacheMaxExpire 604800
>        CacheEnable disk /
>        CacheGcInterval 24
>        CachegcDaily 23
>        CacheDirLevels 3
>        CacheDirLength 2
>    </IfModule>
> </IfModule>
> The above settings were turned on in Apache configuration file.
> But there is one problem , when the client browser requests for a  
> html page for first time the servers delivers it and caching is  
> being done , but when the  client browser clears its chache and  
> again requests the same page , a string of html
> is displayed on the browser.
> Can you tell me why is it so and is there a solution for the above  
> problem?

Where exactly does mod_python fit into the picture here? Is a mod_python
handler generating the HTML page?

If the HTML page is being generated by mod_python, does the handler
explicitly set the content type for the initial response which is  
then being
cached? Also, is the URL used, use ".html" in it, or a REST style URL  
with
no extension?

Finally, what web browser is being used and does the request go direct
to the web server or via a firewall proxy?

Graham
From emlynj at gmail.com  Wed Jan 11 06:44:22 2006
From: emlynj at gmail.com (Emlyn Jones)
Date: Wed Jan 11 06:44:25 2006
Subject: [mod_python] urlopen permissions
In-Reply-To: <29a6ca010601101430k607c6ad9pc5167b266f640438@mail.gmail.com>
References: <f4b5a9620601100506j7ec1645dw6536b8c55631fc74@mail.gmail.com>
	<29a6ca010601101430k607c6ad9pc5167b266f640438@mail.gmail.com>
Message-ID: <f4b5a9620601110344l59aa619fu7e39d4e91df5b81a@mail.gmail.com>

Your right!
I thought I had solved that one by explicitly adding a user-agent header.
Turns out the urllib2 in python2.2 adds it's own anyway (mod_python used 2.2,
my shell gives me 2.4). I've upgraded mod_python to python2.4 and it works.
Now I get a seg fault from xml.dom.minidom.parsestring which again only
happens via mod_python not from the shell (although I guess that could just
be a fluke), grrr. More googling I guess!

Thanks for your help.
Emlyn.

On 1/10/06, Colin Bean <ccbean@gmail.com> wrote:
>
> It looks like the 403 is being returned by Google, rather than your copy
> of Apache.  I believe that Google has some rules designed to block web
> crawlers / scrapers under some circumstances.  One possibility would be that
> running your script under apache changes something in the request headers
> that makes Google block the request.  That's just a guess, though (and my
> knowledge of Google's behavior is based on a project I did a couple of years
> ago; so take it with a grain of salt).  Have you tried this code on some
> other URLs?  What kind of results do you get then?
>
> hth,
> -Colin
>
>
>
> On 1/10/06, Emlyn Jones <emlynj@gmail.com > wrote:
>
> > Hello,
> > I'm not convinced that this is a specific mod_python problem but I'm not
> > sure exactly how to explain it in generic terms so hopefully someone here
> > can point me in the right direction.
> > I have a python script which calls urllib2.urlopen to open a url on a
> > remote server (google). It works fine from the command line but when I run
> > it from a mod_python.psp page I get:
> >
> > HTTPError: HTTP Error 403: Forbidden
> >
> > Clearly this is something to do with the permissions of the apache user
> > vs my shell user but what is the safest way to allow this script to run?
> >
> > Regards,
> > Emlyn.
> >
> >
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://mailman.modpython.org/mailman/listinfo/mod_python
> >
> >
> >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20060111/40f2950b/attachment.html
From jpg at jgassociates.ca  Wed Jan 11 08:24:56 2006
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Wed Jan 11 08:24:59 2006
Subject: [mod_python] urlopen permissions
In-Reply-To: <f4b5a9620601110344l59aa619fu7e39d4e91df5b81a@mail.gmail.com>
References: <f4b5a9620601100506j7ec1645dw6536b8c55631fc74@mail.gmail.com>	<29a6ca010601101430k607c6ad9pc5167b266f640438@mail.gmail.com>
	<f4b5a9620601110344l59aa619fu7e39d4e91df5b81a@mail.gmail.com>
Message-ID: <43C50728.50108@jgassociates.ca>

Emlyn Jones wrote:
> Your right!
> I thought I had solved that one by explicitly adding a user-agent header.
> Turns out the urllib2 in python2.2 adds it's own anyway (mod_python used 2.2,
> my shell gives me 2.4). I've upgraded mod_python to python2.4 and it works.
> Now I get a seg fault from xml.dom.minidom.parsestring which again only
> happens via mod_python not from the shell (although I guess that could just
> be a fluke), grrr. More googling I guess!

This sort of seg fault is a result of python and some other apache 
module using different library versions of some component. libexpat is 
often the culprit.
Jim
From HansJoachim.Ehlers at eumetsat.int  Wed Jan 11 08:29:56 2006
From: HansJoachim.Ehlers at eumetsat.int (Hans-Joachim Ehlers)
Date: Wed Jan 11 08:30:14 2006
Subject: [mod_python] make failed on AIX 5.1 using xlc
Message-ID: <s3c51671.089@gwn0201.eumetsat.int>


Graham Dumpleton" <grahamd@dscpl.com.au> 10/01/06 22:54  wrote
>Similar situation for the function cast you had to change in
requestobject.c.
>It just becomes to much of a pain to try and deal with the strangeness
of
>lessor used compilers.
I made which the gcc (3.2.2) a syntax check against the patched file
and it does not complains. 
So it would be nice and if the change will not cause trouble to have in
the source code. Otherwise at the next revision me and other will run in
the same or similar issue

Thanks again for your support.
Hajo

From jellej at pacbell.net  Wed Jan 11 13:26:40 2006
From: jellej at pacbell.net (jelle)
Date: Wed Jan 11 13:30:40 2006
Subject: [mod_python] Need help with server register_cleanup
In-Reply-To: <1136858895.26060@dscpl.user.openhosting.com>
References: <1136858895.26060@dscpl.user.openhosting.com>
Message-ID: <Pine.LNX.4.61.0601110947130.26581@treebeard>


Hi All,

I'm trying to use mp_server register_cleanup to dump some collected 
runtime stats but need a more explicit code example.

As I understand it, server.register_cleanup function is called when the 
apache child process is terminated. Currently I have an apache directive 
set as MaxRequestsPerChild 10 to test that functionality.

Questions:

I'm using mp_servlets, should the register_cleanup call be in the mainline 
of a commonly imported file or should it be placed in a commonly called 
function or either way?

What is the appropriate import statement?

Does the callable function expect and parameters?

What is the complete call look like?

Thanks,
Jelle

-- 

I always start a play by calling the characters A, B and C.
  -- Harold Pinter

From grahamd at dscpl.com.au  Wed Jan 11 14:44:57 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Wed Jan 11 14:45:16 2006
Subject: [mod_python] urlopen permissions
In-Reply-To: <43C50728.50108@jgassociates.ca>
References: <f4b5a9620601100506j7ec1645dw6536b8c55631fc74@mail.gmail.com>	<29a6ca010601101430k607c6ad9pc5167b266f640438@mail.gmail.com>
	<f4b5a9620601110344l59aa619fu7e39d4e91df5b81a@mail.gmail.com>
	<43C50728.50108@jgassociates.ca>
Message-ID: <A988718D-ECE1-4A58-8473-8B86EACEAFA4@dscpl.com.au>


On 12/01/2006, at 12:24 AM, Jim Gallacher wrote:

> Emlyn Jones wrote:
>> Your right!
>> I thought I had solved that one by explicitly adding a user-agent  
>> header.
>> Turns out the urllib2 in python2.2 adds it's own anyway  
>> (mod_python used 2.2,
>> my shell gives me 2.4). I've upgraded mod_python to python2.4 and  
>> it works.
>> Now I get a seg fault from xml.dom.minidom.parsestring which again  
>> only
>> happens via mod_python not from the shell (although I guess that  
>> could just
>> be a fluke), grrr. More googling I guess!
>
> This sort of seg fault is a result of python and some other apache  
> module using different library versions of some component. libexpat  
> is often the culprit.

For debugging libexpat issues see:

   http://www.dscpl.com.au/articles/modpython-006.html

Graham
From dave at davebritton.com  Wed Jan 11 15:40:24 2006
From: dave at davebritton.com (Dave Britton)
Date: Wed Jan 11 15:41:44 2006
Subject: [mod_python] publisher form values
References: <f4b5a9620601100506j7ec1645dw6536b8c55631fc74@mail.gmail.com>	<29a6ca010601101430k607c6ad9pc5167b266f640438@mail.gmail.com><f4b5a9620601110344l59aa619fu7e39d4e91df5b81a@mail.gmail.com><43C50728.50108@jgassociates.ca>
	<A988718D-ECE1-4A58-8473-8B86EACEAFA4@dscpl.com.au>
Message-ID: <013e01c616ef$3fb96fb0$0500a8c0@brittonfamily.org>

I am running modpython 2.7 on apache 1.3
I have an html form that is generated dynamically based on database entries,
so it may have an arbitrary number of fields displayed. In the module that
generates them they are numbered field1, field2, etc.
eg: (dynamically output html)

<form action = "handleform" method = "post">
Field1 <input type = "text" name = "field1"><br>
Field2 <input type = "text" name = "field2"><br>
Field3 <input type = "text" name = "field3"><br>
<input type = "submit"></form>

-- now, there might be 1 or 2 or x number of input fields, so I want to use
the **kwds parameter form for the processing function, eg:

def handleform(req, **kwds):

and I was hoping this would just work, and I would get a nifty and
arbitarily long set of variables name field1 - fieldn, but I couldn't seem
to make the syntax work. I reverted to just using this:

cgi={}
 for i in req.form.list:
      cgi[i.name]=i.value

to construct my own dictionary, but I am wondering if there is supposed to
be an easy way to do this in publisher and I am just too unfamiliar with
using **kwds to figure it out.
Thanks for any suggestions!

-Dave Britton

From HansJoachim.Ehlers at eumetsat.int  Wed Jan 11 15:52:46 2006
From: HansJoachim.Ehlers at eumetsat.int (Hans-Joachim Ehlers)
Date: Wed Jan 11 15:53:02 2006
Subject: [mod_python] could not import mod_python.apache. ( Modpython -3.1.4
	)
Message-ID: <s3c57e3b.013@gwn0201.eumetsat.int>

Apache 2.0.55
Python 2.4.2
modpython -3.1.4
AIX 5.1


Doing the following steps 
1) Starting Apache as ./httpd -X ( Apache is using 'nobody' as uid &
gid 
2) Opening a page on this host  http://MyHost:/cgi-bin/mptest.py

will lead to the following entries in the apache errorlog:

[Wed Jan 11 20:19:29 2006] [notice] Apache/2.0.55 (Unix) DAV/2
mod_python/3.1.4 Python/2.4.2 configured -- resuming normal operations
[Wed Jan 11 20:19:35 2006] [error] make_obcallback: could not import
mod_python.apache.\n
'import site' failed; use -v for traceback
'import site' failed; use -v for traceback
ImportError: No module named mod_python.apache

A direct import with python show the following output
1431$ python
Python 2.4.2 (#1, Jan 11 2006, 19:56:08) [C] on aix5
Type "help", "copyright", "credits" or "license" for more information.
>>> from mod_python import apache
Traceback (most recent call last):
  File "<stdin>", line 1, in ?
  File "/usr/local/lib/python2.4/site-packages/mod_python/apache.py",
line 28, in ?
    import _apache
ImportError: No module named _apache

Down below is also an output from
$python -v
>>>> from mod_python import apache

BTW:
Since my pythion has been build with tkinter support - a debug version
of python will not work with mod_python at all because of something like
invaled thread .

Any hints ?
tnx
Hajo


1432$ python -v
...
>>> from mod_python import apache
import mod_python # directory
/usr/local/lib/python2.4/site-packages/mod_python
# /usr/local/lib/python2.4/site-packages/mod_python/__init__.pyc
matches /usr/local/lib/python2.4/site-packages/mod_python/__init__.py
import mod_python # precompiled from
/usr/local/lib/python2.4/site-packages/mod_python/__init__.pyc
# /usr/local/lib/python2.4/site-packages/mod_python/apache.pyc matches
/usr/local/lib/python2.4/site-packages/mod_python/apache.py
import mod_python.apache # precompiled from
/usr/local/lib/python2.4/site-packages/mod_python/apache.pyc
# /usr/local/lib/python2.4/traceback.pyc matches
/usr/local/lib/python2.4/traceback.py
import traceback # precompiled from
/usr/local/lib/python2.4/traceback.pyc
dlopen("/usr/local/lib/python2.4/lib-dynload/time.so", 2);
import time # dynamically loaded from
/usr/local/lib/python2.4/lib-dynload/time.so
# /usr/local/lib/python2.4/pdb.pyc matches
/usr/local/lib/python2.4/pdb.py
import pdb # precompiled from /usr/local/lib/python2.4/pdb.pyc
# /usr/local/lib/python2.4/cmd.pyc matches
/usr/local/lib/python2.4/cmd.py
import cmd # precompiled from /usr/local/lib/python2.4/cmd.pyc
# /usr/local/lib/python2.4/string.pyc matches
/usr/local/lib/python2.4/string.py
import string # precompiled from /usr/local/lib/python2.4/string.pyc
# /usr/local/lib/python2.4/re.pyc matches
/usr/local/lib/python2.4/re.py
import re # precompiled from /usr/local/lib/python2.4/re.pyc
# /usr/local/lib/python2.4/sre.pyc matches
/usr/local/lib/python2.4/sre.py
import sre # precompiled from /usr/local/lib/python2.4/sre.pyc
# /usr/local/lib/python2.4/sre_compile.pyc matches
/usr/local/lib/python2.4/sre_compile.py
import sre_compile # precompiled from
/usr/local/lib/python2.4/sre_compile.pyc
import _sre # builtin
# /usr/local/lib/python2.4/sre_constants.pyc matches
/usr/local/lib/python2.4/sre_constants.py
import sre_constants # precompiled from
/usr/local/lib/python2.4/sre_constants.pyc
# /usr/local/lib/python2.4/sre_parse.pyc matches
/usr/local/lib/python2.4/sre_parse.py
import sre_parse # precompiled from
/usr/local/lib/python2.4/sre_parse.pyc
dlopen("/usr/local/lib/python2.4/lib-dynload/strop.so", 2);
import strop # dynamically loaded from
/usr/local/lib/python2.4/lib-dynload/strop.so
# /usr/local/lib/python2.4/bdb.pyc matches
/usr/local/lib/python2.4/bdb.py
import bdb # precompiled from /usr/local/lib/python2.4/bdb.pyc
# /usr/local/lib/python2.4/repr.pyc matches
/usr/local/lib/python2.4/repr.py
import repr # precompiled from /usr/local/lib/python2.4/repr.pyc
dlopen("/usr/local/lib/python2.4/lib-dynload/itertools.so", 2);
import itertools # dynamically loaded from
/usr/local/lib/python2.4/lib-dynload/itertools.so
# /usr/local/lib/python2.4/pprint.pyc matches
/usr/local/lib/python2.4/pprint.py
import pprint # precompiled from /usr/local/lib/python2.4/pprint.pyc
dlopen("/usr/local/lib/python2.4/lib-dynload/cStringIO.so", 2);
import cStringIO # dynamically loaded from
/usr/local/lib/python2.4/lib-dynload/cStringIO.so
import imp # builtin
Traceback (most recent call last):
  File "<stdin>", line 1, in ?
  File "/usr/local/lib/python2.4/site-packages/mod_python/apache.py",
line 28, in ?
    import _apache
ImportError: No module named _apache
>>>


From sean at barriescene.com  Wed Jan 11 15:59:14 2006
From: sean at barriescene.com (Sean Jamieson)
Date: Wed Jan 11 15:59:42 2006
Subject: [mod_python] publisher form values
In-Reply-To: <013e01c616ef$3fb96fb0$0500a8c0@brittonfamily.org>
References: <f4b5a9620601100506j7ec1645dw6536b8c55631fc74@mail.gmail.com>	<29a6ca010601101430k607c6ad9pc5167b266f640438@mail.gmail.com><f4b5a9620601110344l59aa619fu7e39d4e91df5b81a@mail.gmail.com><43C50728.50108@jgassociates.ca>	<A988718D-ECE1-4A58-8473-8B86EACEAFA4@dscpl.com.au>
	<013e01c616ef$3fb96fb0$0500a8c0@brittonfamily.org>
Message-ID: <43C571A2.2030903@barriescene.com>

my suggestion: just omit the numeric part of the name, and access the 
fields as a list

in publisher:
def processform( req, the_field ):
    if type( the_field ) is list:
        for field in the_field:
           print field


Dave Britton wrote:

>I am running modpython 2.7 on apache 1.3
>I have an html form that is generated dynamically based on database entries,
>so it may have an arbitrary number of fields displayed. In the module that
>generates them they are numbered field1, field2, etc.
>eg: (dynamically output html)
>
><form action = "handleform" method = "post">
>Field1 <input type = "text" name = "field1"><br>
>Field2 <input type = "text" name = "field2"><br>
>Field3 <input type = "text" name = "field3"><br>
><input type = "submit"></form>
>
>-- now, there might be 1 or 2 or x number of input fields, so I want to use
>the **kwds parameter form for the processing function, eg:
>
>def handleform(req, **kwds):
>
>and I was hoping this would just work, and I would get a nifty and
>arbitarily long set of variables name field1 - fieldn, but I couldn't seem
>to make the syntax work. I reverted to just using this:
>
>cgi={}
> for i in req.form.list:
>      cgi[i.name]=i.value
>
>to construct my own dictionary, but I am wondering if there is supposed to
>be an easy way to do this in publisher and I am just too unfamiliar with
>using **kwds to figure it out.
>Thanks for any suggestions!
>
>-Dave Britton
>
>_______________________________________________
>Mod_python mailing list
>Mod_python@modpython.org
>http://mailman.modpython.org/mailman/listinfo/mod_python
>
>
>  
>

From emlynj at gmail.com  Wed Jan 11 16:39:34 2006
From: emlynj at gmail.com (Emlyn Jones)
Date: Wed Jan 11 16:39:43 2006
Subject: [mod_python] urlopen permissions
In-Reply-To: <A988718D-ECE1-4A58-8473-8B86EACEAFA4@dscpl.com.au>
References: <f4b5a9620601100506j7ec1645dw6536b8c55631fc74@mail.gmail.com>
	<43C50728.50108@jgassociates.ca>
	<A988718D-ECE1-4A58-8473-8B86EACEAFA4@dscpl.com.au>
Message-ID: <200601112139.35063.emlynj@gmail.com>

On Wednesday 11 Jan 2006 19:44, Graham Dumpleton wrote:
> On 12/01/2006, at 12:24 AM, Jim Gallacher wrote:
> > Emlyn Jones wrote:
> >> Your right!
> >> I thought I had solved that one by explicitly adding a user-agent
> >> header.
> >> Turns out the urllib2 in python2.2 adds it's own anyway
> >> (mod_python used 2.2,
> >> my shell gives me 2.4). I've upgraded mod_python to python2.4 and
> >> it works.
> >> Now I get a seg fault from xml.dom.minidom.parsestring which again
> >> only
> >> happens via mod_python not from the shell (although I guess that
> >> could just
> >> be a fluke), grrr. More googling I guess!
> >
> > This sort of seg fault is a result of python and some other apache
> > module using different library versions of some component. libexpat
> > is often the culprit.
>
> For debugging libexpat issues see:
>
>    http://www.dscpl.com.au/articles/modpython-006.html
>
> Graham

Fantastic. Everything is working perfectly now.

Thanks very much for everybodys help.

Regards,
Emlyn.
From grahamd at dscpl.com.au  Wed Jan 11 16:42:00 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Wed Jan 11 16:42:09 2006
Subject: [mod_python] publisher form values
Message-ID: <1137015720.30499@dscpl.user.openhosting.com>

Dave Britton wrote ..
> I am running modpython 2.7 on apache 1.3
> I have an html form that is generated dynamically based on database entries,
> so it may have an arbitrary number of fields displayed. In the module that
> generates them they are numbered field1, field2, etc.
> eg: (dynamically output html)
> 
> <form action = "handleform" method = "post">
> Field1 <input type = "text" name = "field1"><br>
> Field2 <input type = "text" name = "field2"><br>
> Field3 <input type = "text" name = "field3"><br>
> <input type = "submit"></form>
> 
> -- now, there might be 1 or 2 or x number of input fields, so I want to
> use
> the **kwds parameter form for the processing function, eg:
> 
> def handleform(req, **kwds):
> 
> and I was hoping this would just work, and I would get a nifty and
> arbitarily long set of variables name field1 - fieldn, but I couldn't seem
> to make the syntax work. I reverted to just using this:
> 
> cgi={}
>  for i in req.form.list:
>       cgi[i.name]=i.value
> 
> to construct my own dictionary, but I am wondering if there is supposed
> to
> be an easy way to do this in publisher and I am just too unfamiliar with
> using **kwds to figure it out.

In mod_python 2.7, having unspecified form arguments passed through
a keyword argument dictionary, ie., '**kwargs' syntax, was not supported.
This feature is in mod_python 3.1 though.

Your options are to access req.form as you are doing, don't use numbers
on form arguments in list as suggested by other poster, or upgrade to
Apache 2.0/mod_python 3.1.4.

The only other option that exists is to use mod_python.publisher drop in
replacement from Vampire. This supports '**kwargs' syntax for unspecified
form parameters. The Vampire version of publisher is the only way of
currently getting a system which will work the same on mod_python 2.7
and mod_python 3.1.

Graham
From grahamd at dscpl.com.au  Wed Jan 11 17:13:42 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Wed Jan 11 17:13:44 2006
Subject: [mod_python] Need help with server register_cleanup
Message-ID: <1137017622.22434@dscpl.user.openhosting.com>

jelle wrote ..
> I'm trying to use mp_server register_cleanup to dump some collected 
> runtime stats but need a more explicit code example.
> 
> As I understand it, server.register_cleanup function is called when the
> apache child process is terminated. Currently I have an apache directive
> set as MaxRequestsPerChild 10 to test that functionality.
> 
> Questions:
> 
> I'm using mp_servlets, should the register_cleanup call be in the mainline
> of a commonly imported file or should it be placed in a commonly called
> function or either way?
> 
> What is the appropriate import statement?
> 
> Does the callable function expect and parameters?
> 
> What is the complete call look like?

In mod_python 2.7 and 3.1, to register a cleanup handler to be
executed when the server is shutdown, a call needs to be made to:

  req.server.register_cleanup()

Because the function is accessed via the request object, the call can only
be made from with the context of an executing handler where there
request object is actually available. Thus:

  def cleanup(data):
    ...

  def handler(req):
    req.server.register_cleanup(req,cleanup)
    ...

The problem here is that you don't actually want the function to be called
everytime the request handler is called. Thus you need to have a flag to
indicate whether you have already called it. Presuming you are using a
non threaded Apache MPM, you would thus write:

  flag = False

  def handler(req):
     if not flag:
       flag = True
       req.server.register_cleanup(req,cleanup)

If you are using a multithreaded MPM, access to that flag and the call to
register the cleanup function is going to have to be thread protected so
that the initialisation isn't done by two different threads at the same time.

The next problem you need to contend with is that if module reloading
if allowed on this module it will result in registration happening every time
the module is reloaded. Thus, you actually need to put the code in a
separate module which is not the subject of module reloading. Ie., it
should be a distinct module on your PYTHONPATH imported using 'import'
and not in the document tree.

  # myinitmodule.py

  try:
    import threading
  except:
    import dummy_threading as threading

  lock = threading.Lock()

  flag = False
  
  def cleanup(data):
    ...

  def register_cleanup(req):
    lock.acquire()
    if not flag:
      flag = True
      req.server.register_cleanup(req,cleanup)
    lock.release()

  # handler.py

  import myinitmodule

  def handler(req):
    myinitmodule.register_cleanup(req)
    ...

Having said that, it is not gauranteed that the cleanup handler will
actually be called. It will only be called when there is a clean shutdown.
If the Apache child process gets hung on shutdown and the parent
process has to explicitly kill it, the cleanup handler may not be called.
This is compounded by the currently known issue of:

  http://issues.apache.org/jira/browse/MODPYTHON-109

The above is the portable way of doing it for different versions of
mod_python. In mod_python 3.2, you are also able to access the
function for registering a cleanup function direct from the 'apache'
module. This call does not require the request object to be available.
Thus in mod_python 3.2, you can actually say:

  # myinitmodule.py

  from mod_python import apache

  try:
    import threading
  except:
    import dummy_threading as threading

  lock = threading.Lock()

  flag = False
  
  def cleanup(data):
    ...

  def register_cleanup():
    lock.acquire()
    if not flag:
      flag = True
      apache.register_cleanup(cleanup)
    lock.release()

  # handler.py

  import myinitmodule
  myinitmodule.register_cleanup()

  def handler(req):
    ...

Because in mod_python 3.2 you can do this, you could even use the
PythonImport directive to import a module which does the registration
and thus avoid having to do it in some handler module.

Graham
From HansJoachim.Ehlers at eumetsat.int  Wed Jan 11 17:16:14 2006
From: HansJoachim.Ehlers at eumetsat.int (Hans-Joachim Ehlers)
Date: Wed Jan 11 17:16:40 2006
Subject: Addedum - [mod_python] could not import mod_python.apache.
Message-ID: <s3c591d2.075@gwn0201.eumetsat.int>

TRUSS output 
I did a 
$ export PYTHONPATH=/usr/local
$ truss -f  "./bin/httpd -XA

If you take a look at the long output from truss you will see:

open("/usr/local/lib/python2.4/lib-dynload/time.so", O_RDONLY) = 9
2506852:        kioctl(9, 22528, 0x00000000, 0x00000000)        Err#25 ENOTTY

Does that mean: That the system is not able to load the program 'time.so' from the python installation ?
BTW: I have a similar behaviour on a suse 9.3 pro system.
hth
Hajo


+21475  2506852:        statx("/usr/local/apache2/cgi-bin/mptest.py", 0x2FF22230, 76, 01) = 0
+21476  2506852:        _getpid()                                       = 2506852
+21477  2506852:        statx("/usr/local/lib/python2.4/site-packages/mod_python/apache", 0x2FF21370, 76, 0) Err#2  ENOENT
+21478  2506852:        open("/usr/local/lib/python2.4/site-packages/mod_python/apache.so", O_RDONLY) Err#2  ENOENT
+21479  2506852:        open("/usr/local/lib/python2.4/site-packages/mod_python/apachemodule.so", O_RDONLY) Err#2  ENOENT
+21480  2506852:        open("/usr/local/lib/python2.4/site-packages/mod_python/apache.py", O_RDONLY) = 9
+21481  2506852:        kioctl(9, 22528, 0x00000000, 0x00000000)        Err#25 ENOTTY
+21482  2506852:        fstatx(9, 0x2FF21360, 76, 0)                    = 0
+21483  2506852:        open("/usr/local/lib/python2.4/site-packages/mod_python/apache.pyc", O_RDONLY) = 10
+21484  2506852:        kioctl(10, 22528, 0x00000000, 0x00000000)       Err#25 ENOTTY
+21485  2506852:        kioctl(10, 22528, 0x00000000, 0x00000000)       Err#25 ENOTTY
+21486  2506852:        kread(10, " m ?\r\n I ? ? A c\0\0\0".., 4096)   = 4096
+21487  2506852:        fstatx(10, 0x2FF1D2B0, 76, 0)                   = 0
+21488  2506852:        kread(10, "15\0 d\b\0 t04\0 |\n\0 i".., 4096)   = 4096
+21489  2506852:        kread(10, "1D\0\0\0 R >\0\0\0 t10\0".., 4096)   = 4096
+21490  2506852:        kread(10, " (02\0\0\0 N R9C\0\0\0 (".., 4096)   = 4096
+21491  2506852:        kread(10, " v i r o n ,   s t d i n".., 4096)   = 4096
+21492  2506852:        kread(10, "\0\0 A P _ M P M Q _ M A".., 4096)   = 1268
+21493  2506852:        kread(10, "\0\0 A P _ M P M Q _ M A".., 4096)   = 0
+21494  2506852:        close(10)                                       = 0
+21495  2506852:        statx("/usr/local/lib/python2.4/site-packages/mod_python/time", 0x2FF201F0, 76, 0) Err#2  ENOENT
+21496  2506852:        open("/usr/local/lib/python2.4/site-packages/mod_python/time.so", O_RDONLY) Err#2  ENOENT
+21497  2506852:        open("/usr/local/lib/python2.4/site-packages/mod_python/timemodule.so", O_RDONLY) Err#2  ENOENT
+21498  2506852:        open("/usr/local/lib/python2.4/site-packages/mod_python/time.py", O_RDONLY) Err#2  ENOENT
+21499  2506852:        open("/usr/local/lib/python2.4/site-packages/mod_python/time.pyc", O_RDONLY) Err#2  ENOENT
+21500  2506852:        statx("/usr/local/lib/python24.zip/time", 0x2FF201F0, 76, 0) Err#2  ENOENT
+21501  2506852:        open("/usr/local/lib/python24.zip/time.so", O_RDONLY) Err#2  ENOENT
+21502  2506852:        open("/usr/local/lib/python24.zip/timemodule.so", O_RDONLY) Err#2  ENOENT
+21503  2506852:        open("/usr/local/lib/python24.zip/time.py", O_RDONLY) Err#2  ENOENT
+21504  2506852:        open("/usr/local/lib/python24.zip/time.pyc", O_RDONLY) Err#2  ENOENT
+21505  2506852:        statx("/usr/local/lib/python2.4/time", 0x2FF201F0, 76, 0) Err#2  ENOENT
+21506  2506852:        open("/usr/local/lib/python2.4/time.so", O_RDONLY) Err#2  ENOENT
+21507  2506852:        open("/usr/local/lib/python2.4/timemodule.so", O_RDONLY) Err#2  ENOENT
+21508  2506852:        open("/usr/local/lib/python2.4/time.py", O_RDONLY) Err#2  ENOENT
+21509  2506852:        open("/usr/local/lib/python2.4/time.pyc", O_RDONLY) Err#2  ENOENT
+21510  2506852:        statx("/usr/local/lib/python2.4/plat-aix5/time", 0x2FF201F0, 76, 0) Err#2  ENOENT
+21511  2506852:        open("/usr/local/lib/python2.4/plat-aix5/time.so", O_RDONLY) Err#2  ENOENT
+21512  2506852:        open("/usr/local/lib/python2.4/plat-aix5/timemodule.so", O_RDONLY) Err#2  ENOENT
+21513  2506852:        open("/usr/local/lib/python2.4/plat-aix5/time.py", O_RDONLY) Err#2  ENOENT
+21514  2506852:        open("/usr/local/lib/python2.4/plat-aix5/time.pyc", O_RDONLY) Err#2  ENOENT
+21515  2506852:        statx("/usr/local/lib/python2.4/lib-tk/time", 0x2FF201F0, 76, 0) Err#2  ENOENT
+21516  2506852:        open("/usr/local/lib/python2.4/lib-tk/time.so", O_RDONLY) Err#2  ENOENT
+21517  2506852:        open("/usr/local/lib/python2.4/lib-tk/timemodule.so", O_RDONLY) Err#2  ENOENT
+21518  2506852:        open("/usr/local/lib/python2.4/lib-tk/time.py", O_RDONLY) Err#2  ENOENT
+21519  2506852:        open("/usr/local/lib/python2.4/lib-tk/time.pyc", O_RDONLY) Err#2  ENOENT
+21520  2506852:        statx("/usr/local/lib/python2.4/lib-dynload/time", 0x2FF201F0, 76, 0) Err#2  ENOENT
+21521  2506852:        open("/usr/local/lib/python2.4/lib-dynload/time.so", O_RDONLY) = 10
+21522  2506852:        kioctl(10, 22528, 0x00000000, 0x00000000)       Err#25 ENOTTY
+21523  2506852:        fstatx(10, 0x2FF203A0, 76, 0)                   = 0
+21524  2506852:        __loadx(0x01070280, 0x2FF184E0, 0x00003E80, 0x2FF20718, 0x00000000, 0x00020000, 0x00000000, 0x00000000
) = 0x00000000
+21525  2506852:        loadquery(0x00000001, 0x20559990, 0x00001FF8, 0x000034F0, 0x00000000, 0x103DA097, 0x103DA097, 0xF05431
74) = 0x00000000
+21526  2506852:        close(10)                                       = 0
+21527  2506852:        close(9)                                        = 0
+21528  2506852:        kwrite(6, " [ W e d   J a n   1 1  ".., 90)     = 90
+21529  2506852:        kfcntl(1, F_GETFL, 0x20227638)                  = 67108865
+21530  2506852:        kwrite(2, " T r a c e b a c", 8)                = 8
+21531  2506852:        kwrite(2, " k   ( m o s t  ", 8)                = 8
+21532  2506852:        kwrite(2, " r e c e n t   c", 8)                = 8
+21533  2506852:        kwrite(2, " a l l   l a s t", 8)                = 8
+21534  2506852:        kwrite(2, " ) :\n", 3)                          = 3
+21535  2506852:        open("/usr/local/lib/python2.4/site-packages/mod_python/apache.py", O_RDONLY) = 9
+21536  2506852:        kioctl(9, 22528, 0x00000000, 0x00000000)        Err#25 ENOTTY
+21537  2506852:        kwrite(2, "     F i l e   "", 8)                = 8
+21538  2506852:        kwrite(2, " / u s r / l o c", 8)                = 8
+21539  2506852:        kwrite(2, " a l / l i b / p", 8)                = 8
+21540  2506852:        kwrite(2, " y t h o n 2 . 4", 8)                = 8
+21541  2506852:        kwrite(2, " / s i t e - p a", 8)                = 8
+21542  2506852:        kwrite(2, " c k a g e s / m", 8)                = 8
+21543  2506852:        kwrite(2, " o d _ p y t h o", 8)                = 8
+21544  2506852:        kwrite(2, " n / a p a c h e", 8)                = 8
+21545  2506852:        kwrite(2, " . p y " ,   l i", 8)                = 8
+21546  2506852:        kwrite(2, " n e   2 2 ,   i", 8)                = 8
+21547  2506852:        kwrite(2, " n   ?\n", 4)                        = 4
+21548  2506852:        kioctl(9, 22528, 0x00000000, 0x00000000)        Err#25 ENOTTY
+21549  2506852:        kread(9, "   #\n   #   C o p y r i".., 4096)    = 4096
+21550  2506852:        kwrite(2, "        ", 4)                        = 4
+21551  2506852:        kwrite(2, " i m p o r t   t", 8)                = 8
+21552  2506852:        kwrite(2, " i m e\n", 4)                        = 4
+21553  2506852:        close(9)                                        = 0
+21554  2506852:        kwrite(2, " I m p o r t E r r o r", 11)         = 11
+21555  2506852:        kwrite(2, " :  ", 2)                            = 2
+21556  2506852:        kwrite(2, " E x e c   f o r m a t  ".., 17)     = 17
+21557  2506852:        kwrite(2, "\n", 1)                              = 1
+21558  2506852:        kwritev(8, 0x2FF22400, 2, 0x00000000)           = 871
+21559  2506852:        kwrite(7, " 1 7 2 . 1 6 . 9 . 4 6  ".., 87)     = 87
+21560  2506852:        shutdown(0x00000008, 0x00000001, 0xFEFEFEFE, 0xFEFEFEFE, 0x2FF223F4, 0xFEFEFEFE, 0xFEFEFEFE, 0xFEFEFEF
E) = 0x00000000
+21561  2506852:        _poll(0x2FF22398, 0x00000001, 0x000007D0, 0x00000000, 0x00000000, 0x00000000, 0xFFFFFFFF, 0xFFFFFFFF)
= 0x00000001
+21562  2506852:        kread(8, " ? ? ? ? ? ? ? ? ? ? ? ?".., 512)     = 0
+21563  2506852:        close(8)                                        = 0
+21564  2506852:        kread(4, " ?", 1)                               Err#11 EAGAIN
+21565  2506852:        naccept(0x00000003, 0x20537BEC, 0x20537C08, 0x00000000, 0x00000011, 0x00000000, 0xF04F3E60, 0xFEFEFEFE
) = 0x00000008
+21566  2506852:        ngetsockname(0x00000008, 0x20537BA4, 0x20537BC0, 0x0000000C, 0x00000000, 0x00000000, 0xF04F3E60, 0x000
00000) = 0x00000000
+21567  2506852:        kfcntl(8, F_GETFL, 0x00000000)                  = 2
+21568  2506852:        kioctl(8, -2147195266, 0x2FF222E0, 0x00000000)  = 0
+21569  2506852:        kioctl(8, -2147195267, 0x2FF222E0, 0x00000000)  = 0
+21570  2506852:        kfcntl(8, F_SETFL, 0x00000006)                  = 0
+21571  2506852:        kread(8, " G E T   / f a v i c o n".., 8000)    = 324
+21572  2506852:        statx("/usr/local/apache2/htdocs/favicon.ico", 0x2FF22280, 76, 0) Err#2  ENOENT
+21573  2506852:        statx("/usr", 0x2FF22230, 76, 01)               = 0
+21574  2506852:        statx("/usr/local", 0x2FF22230, 76, 01)         = 0
+21575  2506852:        statx("/usr/local/apache2", 0x2FF22230, 76, 01) = 0
+21576  2506852:        statx("/usr/local/apache2/htdocs", 0x2FF22230, 76, 01) = 0
+21577  2506852:        statx("/usr/local/apache2/htdocs/favicon.ico", 0x2FF22230, 76, 01) Err#2  ENOENT
+21578  2506852:        _getpid()                                       = 2506852
+21579  2506852:        kwrite(6, " [ W e d   J a n   1 1  ".., 115)    = 115
+21580  2506852:        kread(8, " G E T   / f a v i c o n".., 8000)    Err#11 EAGAIN
+21581  2506852:        kwritev(8, 0x2FF22400, 2, 0x00000000)           = 571
+21582  2506852:        kwrite(7, " 1 7 2 . 1 6 . 9 . 4 6  ".., 81)     = 81
+21583  2506852:        _poll(0x2FF22128, 0x00000001, 0x00003A98, 0x00000000, 0x00000000, 0x00000000, 0xFFFFFFFF, 0xFFFFFFFF)
(sleeping...)
+21584  2506852:        _poll(0x2FF22128, 0x00000001, 0x00003A98, 0x00000000, 0x00000000, 0x00000000, 0xFFFFFFFF, 0xFFFFFFFF)
Err#4  EINTR
+21585  2506852:            Received signal #2, SIGINT [caught]
+21586  2506852:        close(8)                                        = 0
+21587  2506852:        statx("/usr/local/lib/python24.zip", 0x2FF20318, 76, 0) Err#2  ENOENT
+21588  2506852:        statx("/usr/local/lib", 0x2FF20318, 76, 0)      = 0
+21589  2506852:        statx("/usr/local/lib/python24.zip/site", 0x2FF20950, 76, 0) Err#2  ENOENT
+21590  2506852:        open("/usr/local/lib/python24.zip/site.so", O_RDONLY) Err#2  ENOENT
+21591  2506852:        open("/usr/local/lib/python24.zip/sitemodule.so", O_RDONLY) Err#2  ENOENT
+21592  2506852:        open("/usr/local/lib/python24.zip/site.py", O_RDONLY) Err#2  ENOENT
+21593  2506852:        open("/usr/local/lib/python24.zip/site.pyc", O_RDONLY) Err#2  ENOENT
+21594  2506852:        statx("/usr/local/lib/python2.4/", 0x2FF20318, 76, 0) = 0
+21595  2506852:        statx("/usr/local/lib/python2.4/site", 0x2FF20950, 76, 0) Err#2  ENOENT
+21596  2506852:        open("/usr/local/lib/python2.4/site.so", O_RDONLY) Err#2  ENOENT
+21597  2506852:        open("/usr/local/lib/python2.4/sitemodule.so", O_RDONLY) Err#2  ENOENT
+21598  2506852:        open("/usr/local/lib/python2.4/site.py", O_RDONLY) = 8
+21599  2506852:        kioctl(8, 22528, 0x00000000, 0x00000000)        Err#25 ENOTTY
+21600  2506852:        fstatx(8, 0x2FF20940, 76, 0)                    = 0
+21601  2506852:        open("/usr/local/lib/python2.4/site.pyc", O_RDONLY) = 9
+21602  2506852:        kioctl(9, 22528, 0x00000000, 0x00000000)        Err#25 ENOTTY
+21603  2506852:        kioctl(9, 22528, 0x00000000, 0x00000000)        Err#25 ENOTTY
+21604  2506852:        kread(9, " m ?\r\n ? b ? C c\0\0\0".., 4096)    = 4096
+21605  2506852:        fstatx(9, 0x2FF1C890, 76, 0)                    = 0
+21606  2506852:        kread(9, "83\0\0 }\0\0 x d\0 t02\0".., 4096)    = 4096
+21607  2506852:        kread(9, " n o t i c e . i17\0\0\0".., 4096)    = 4096
+21608  2506852:        kread(9, "\0\0\0 R9A\0\0\0 (\0\0\0".., 4096)    = 1279
+21609  2506852:        kread(9, "\0\0\0 R9A\0\0\0 (\0\0\0".., 4096)    = 0
+21610  2506852:        close(9)                                        = 0
+21611  2506852:        statx("/usr/local/lib/python24.zip/os", 0x2FF1F7D0, 76, 0) Err#2  ENOENT
+21612  2506852:        open("/usr/local/lib/python24.zip/os.so", O_RDONLY) Err#2  ENOENT
+21613  2506852:        open("/usr/local/lib/python24.zip/osmodule.so", O_RDONLY) Err#2  ENOENT
+21614  2506852:        open("/usr/local/lib/python24.zip/os.py", O_RDONLY) Err#2  ENOENT
+21615  2506852:        open("/usr/local/lib/python24.zip/os.pyc", O_RDONLY) Err#2  ENOENT
+21616  2506852:        statx("/usr/local/lib/python2.4/os", 0x2FF1F7D0, 76, 0) Err#2  ENOENT
+21617  2506852:        open("/usr/local/lib/python2.4/os.so", O_RDONLY) Err#2  ENOENT
+21618  2506852:        open("/usr/local/lib/python2.4/osmodule.so", O_RDONLY) Err#2  ENOENT
+21619  2506852:        open("/usr/local/lib/python2.4/os.py", O_RDONLY) = 9
+21620  2506852:        kioctl(9, 22528, 0x00000000, 0x00000000)        Err#25 ENOTTY
+21621  2506852:        fstatx(9, 0x2FF1F7C0, 76, 0)                    = 0
+21622  2506852:        open("/usr/local/lib/python2.4/os.pyc", O_RDONLY) = 10
+21623  2506852:        kioctl(10, 22528, 0x00000000, 0x00000000)       Err#25 ENOTTY
+21624  2506852:        kioctl(10, 22528, 0x00000000, 0x00000000)       Err#25 ENOTTY
+21625  2506852:        kread(10, " m ?\r\n ? b ? C c\0\0\0".., 4096)   = 4096
+21626  2506852:        fstatx(10, 0x2FF1B710, 76, 0)                   = 0
+21627  2506852:        sbrk(0x00010010)                                = 0x20565070
+21628  2506852:        kread(10, " t h   s e g m e n t   (".., 4096)   = 4096
+21629  2506852:        kread(10, " x c e p t i o n   o b j".., 4096)   = 4096
+21630  2506852:        kread(10, "\0 }02\0 |02\0 |03\0 |04".., 4096)   = 4096
+21631  2506852:        kread(10, " x i t s   n o r m a l l".., 4096)   = 4096
+21632  2506852:        kread(10, " c m d t07\0\0\0 b u f s".., 4096)   = 3916
+21633  2506852:        kread(10, " c m d t07\0\0\0 b u f s".., 4096)   = 0
+21634  2506852:        close(10)                                       = 0
+21635  2506852:        statx("/usr/local/lib/python24.zip/posixpath", 0x2FF1E650, 76, 0) Err#2  ENOENT
+21636  2506852:        open("/usr/local/lib/python24.zip/posixpath.so", O_RDONLY) Err#2  ENOENT
+21637  2506852:        open("/usr/local/lib/python24.zip/posixpathmodule.so", O_RDONLY) Err#2  ENOENT
+21638  2506852:        open("/usr/local/lib/python24.zip/posixpath.py", O_RDONLY) Err#2  ENOENT
+21639  2506852:        open("/usr/local/lib/python24.zip/posixpath.pyc", O_RDONLY) Err#2  ENOENT
+21640  2506852:        statx("/usr/local/lib/python2.4/posixpath", 0x2FF1E650, 76, 0) Err#2  ENOENT
+21641  2506852:        open("/usr/local/lib/python2.4/posixpath.so", O_RDONLY) Err#2  ENOENT
+21642  2506852:        open("/usr/local/lib/python2.4/posixpathmodule.so", O_RDONLY) Err#2  ENOENT
+21643  2506852:        open("/usr/local/lib/python2.4/posixpath.py", O_RDONLY) = 10
+21644  2506852:        kioctl(10, 22528, 0x00000000, 0x00000000)       Err#25 ENOTTY
+21645  2506852:        fstatx(10, 0x2FF1E640, 76, 0)                   = 0
+21646  2506852:        open("/usr/local/lib/python2.4/posixpath.pyc", O_RDONLY) = 11
+21647  2506852:        kioctl(11, 22528, 0x00000000, 0x00000000)       Err#25 ENOTTY
+21648  2506852:        kioctl(11, 22528, 0x00000000, 0x00000000)       Err#25 ENOTTY
+21649  2506852:        kread(11, " m ?\r\n ? b ? C c\0\0\0".., 4096)   = 4096
+21650  2506852:        fstatx(11, 0x2FF1A590, 76, 0)                   = 0
+21651  2506852:        kread(11, " a t ( ) . N (04\0\0\0 R".., 4096)   = 4096
+21652  2506852:        kread(11, "100107\006010F0103011301".., 4096)   = 3940
+21653  2506852:        kread(11, "100107\006010F0103011301".., 4096)   = 0
+21654  2506852:        close(11)                                       = 0
+21655  2506852:        statx("/usr/local/lib/python24.zip/stat", 0x2FF1D4D0, 76, 0) Err#2  ENOENT
+21656  2506852:        open("/usr/local/lib/python24.zip/stat.so", O_RDONLY) Err#2  ENOENT
+21657  2506852:        open("/usr/local/lib/python24.zip/statmodule.so", O_RDONLY) Err#2  ENOENT
+21658  2506852:        open("/usr/local/lib/python24.zip/stat.py", O_RDONLY) Err#2  ENOENT
+21659  2506852:        open("/usr/local/lib/python24.zip/stat.pyc", O_RDONLY) Err#2  ENOENT
+21660  2506852:        statx("/usr/local/lib/python2.4/stat", 0x2FF1D4D0, 76, 0) Err#2  ENOENT
+21661  2506852:        open("/usr/local/lib/python2.4/stat.so", O_RDONLY) Err#2  ENOENT
+21662  2506852:        open("/usr/local/lib/python2.4/statmodule.so", O_RDONLY) Err#2  ENOENT
+21663  2506852:        open("/usr/local/lib/python2.4/stat.py", O_RDONLY) = 11
+21664  2506852:        kioctl(11, 22528, 0x00000000, 0x00000000)       Err#25 ENOTTY
+21665  2506852:        fstatx(11, 0x2FF1D4C0, 76, 0)                   = 0
+21666  2506852:        open("/usr/local/lib/python2.4/stat.pyc", O_RDONLY) = 12
+21667  2506852:        kioctl(12, 22528, 0x00000000, 0x00000000)       Err#25 ENOTTY
+21668  2506852:        kioctl(12, 22528, 0x00000000, 0x00000000)       Err#25 ENOTTY
+21669  2506852:        kread(12, " m ?\r\n ? b ? C c\0\0\0".., 4096)   = 2459
+21670  2506852:        fstatx(12, 0x2FF19410, 76, 0)                   = 0
+21671  2506852:        kread(12, " m ?\r\n ? b ? C c\0\0\0".., 4096)   = 0
+21672  2506852:        close(12)                                       = 0
+21673  2506852:        close(11)                                       = 0
+21674  2506852:        close(10)                                       = 0
+21675  2506852:        statx("/usr/local/lib/python24.zip/UserDict", 0x2FF1E650, 76, 0) Err#2  ENOENT
+21676  2506852:        open("/usr/local/lib/python24.zip/UserDict.so", O_RDONLY) Err#2  ENOENT
+21677  2506852:        open("/usr/local/lib/python24.zip/UserDictmodule.so", O_RDONLY) Err#2  ENOENT
+21678  2506852:        open("/usr/local/lib/python24.zip/UserDict.py", O_RDONLY) Err#2  ENOENT
+21679  2506852:        open("/usr/local/lib/python24.zip/UserDict.pyc", O_RDONLY) Err#2  ENOENT
+21680  2506852:        statx("/usr/local/lib/python2.4/UserDict", 0x2FF1E650, 76, 0) Err#2  ENOENT
+21681  2506852:        open("/usr/local/lib/python2.4/UserDict.so", O_RDONLY) Err#2  ENOENT
+21682  2506852:        open("/usr/local/lib/python2.4/UserDictmodule.so", O_RDONLY) Err#2  ENOENT
+21683  2506852:        open("/usr/local/lib/python2.4/UserDict.py", O_RDONLY) = 10
+21684  2506852:        kioctl(10, 22528, 0x00000000, 0x00000000)       Err#25 ENOTTY
+21685  2506852:        fstatx(10, 0x2FF1E640, 76, 0)                   = 0
+21686  2506852:        open("/usr/local/lib/python2.4/UserDict.pyc", O_RDONLY) = 11
+21687  2506852:        kioctl(11, 22528, 0x00000000, 0x00000000)       Err#25 ENOTTY
+21688  2506852:        kioctl(11, 22528, 0x00000000, 0x00000000)       Err#25 ENOTTY
+21689  2506852:        kread(11, " m ?\r\n ? b ? C c\0\0\0".., 4096)   = 4096
+21690  2506852:        fstatx(11, 0x2FF1A590, 76, 0)                   = 0
+21691  2506852:        kread(11, "\0\0\0\0 R\b\0\0\0 R\0\0".., 4096)   = 3682
+21692  2506852:        kread(11, "\0\0\0\0 R\b\0\0\0 R\0\0".., 4096)   = 0
+21693  2506852:        close(11)                                       = 0
+21694  2506852:        close(10)                                       = 0
+21695  2506852:        statx("/usr/local/lib/python24.zip/copy_reg", 0x2FF1E650, 76, 0) Err#2  ENOENT
+21696  2506852:        open("/usr/local/lib/python24.zip/copy_reg.so", O_RDONLY) Err#2  ENOENT
+21697  2506852:        open("/usr/local/lib/python24.zip/copy_regmodule.so", O_RDONLY) Err#2  ENOENT
+21698  2506852:        open("/usr/local/lib/python24.zip/copy_reg.py", O_RDONLY) Err#2  ENOENT
+21699  2506852:        open("/usr/local/lib/python24.zip/copy_reg.pyc", O_RDONLY) Err#2  ENOENT
+21700  2506852:        statx("/usr/local/lib/python2.4/copy_reg", 0x2FF1E650, 76, 0) Err#2  ENOENT
+21701  2506852:        open("/usr/local/lib/python2.4/copy_reg.so", O_RDONLY) Err#2  ENOENT
+21702  2506852:        open("/usr/local/lib/python2.4/copy_regmodule.so", O_RDONLY) Err#2  ENOENT
+21703  2506852:        open("/usr/local/lib/python2.4/copy_reg.py", O_RDONLY) = 10
+21704  2506852:        kioctl(10, 22528, 0x00000000, 0x00000000)       Err#25 ENOTTY
+21705  2506852:        fstatx(10, 0x2FF1E640, 76, 0)                   = 0
+21706  2506852:        open("/usr/local/lib/python2.4/copy_reg.pyc", O_RDONLY) = 11
+21707  2506852:        kioctl(11, 22528, 0x00000000, 0x00000000)       Err#25 ENOTTY
+21708  2506852:        kioctl(11, 22528, 0x00000000, 0x00000000)       Err#25 ENOTTY
+21709  2506852:        kread(11, " m ?\r\n ? b ? C c\0\0\0".., 4096)   = 4096
+21710  2506852:        fstatx(11, 0x2FF1A590, 76, 0)                   = 0
+21711  2506852:        kread(11, " |02\0 j03\0 p16\001 t06".., 4096)   = 757
+21712  2506852:        kread(11, " |02\0 j03\0 p16\001 t06".., 4096)   = 0
+21713  2506852:        close(11)                                       = 0
+21714  2506852:        statx("/usr/local/lib/python24.zip/types", 0x2FF1D4D0, 76, 0) Err#2  ENOENT
+21715  2506852:        open("/usr/local/lib/python24.zip/types.so", O_RDONLY) Err#2  ENOENT
+21716  2506852:        open("/usr/local/lib/python24.zip/typesmodule.so", O_RDONLY) Err#2  ENOENT
+21717  2506852:        open("/usr/local/lib/python24.zip/types.py", O_RDONLY) Err#2  ENOENT
+21718  2506852:        open("/usr/local/lib/python24.zip/types.pyc", O_RDONLY) Err#2  ENOENT
+21719  2506852:        statx("/usr/local/lib/python2.4/types", 0x2FF1D4D0, 76, 0) Err#2  ENOENT
+21720  2506852:        open("/usr/local/lib/python2.4/types.so", O_RDONLY) Err#2  ENOENT
+21721  2506852:        open("/usr/local/lib/python2.4/typesmodule.so", O_RDONLY) Err#2  ENOENT
+21722  2506852:        open("/usr/local/lib/python2.4/types.py", O_RDONLY) = 11
+21723  2506852:        kioctl(11, 22528, 0x00000000, 0x00000000)       Err#25 ENOTTY
+21724  2506852:        fstatx(11, 0x2FF1D4C0, 76, 0)                   = 0
+21725  2506852:        open("/usr/local/lib/python2.4/types.pyc", O_RDONLY) = 12
+21726  2506852:        kioctl(12, 22528, 0x00000000, 0x00000000)       Err#25 ENOTTY
+21727  2506852:        kioctl(12, 22528, 0x00000000, 0x00000000)       Err#25 ENOTTY
+21728  2506852:        kread(12, " m ?\r\n ? b ? C c\0\0\0".., 4096)   = 2561
+21729  2506852:        fstatx(12, 0x2FF19410, 76, 0)                   = 0
+21730  2506852:        kread(12, " m ?\r\n ? b ? C c\0\0\0".., 4096)   = 0
+21731  2506852:        close(12)                                       = 0
+21732  2506852:        close(11)                                       = 0
+21733  2506852:        close(10)                                       = 0
+21734  2506852:        close(9)                                        = 0
+21735  2506852:        statx("/usr/local/lib/python2.4/site-packages", 0x2FF20108, 76, 0) = 0
+21736  2506852:        statx("/usr/local/lib/python2.4/site-packages", 0x2FF1FF60, 76, 0) = 0
+21737  2506852:        open("/usr/local/lib/python2.4/site-packages", O_RDONLY) = 9
+21738  2506852:        getdirent(9, 0x20563568, 4096)                  = 76
+21739  2506852:        lseek(9, 0, 0)                                  = 0
+21740  2506852:        kfcntl(9, F_GETFD, 0x202276FC)                  = 0
+21741  2506852:        kfcntl(9, F_SETFD, 0x00000001)                  = 0
+21742  2506852:        getdirent(9, 0x20563568, 4096)                  = 76
+21743  2506852:        getdirent(9, 0x20563568, 4096)                  = 0
+21744  2506852:        close(9)                                        = 0
+21745  2506852:        statx("/usr/local/lib/site-python", 0x2FF20108, 76, 0) Err#2  ENOENT
+21746  2506852:        statx("/usr/local/lib/python24.zip/sitecustomize", 0x2FF1F450, 76, 0) Err#2  ENOENT
+21747  2506852:        open("/usr/local/lib/python24.zip/sitecustomize.so", O_RDONLY) Err#2  ENOENT
+21748  2506852:        open("/usr/local/lib/python24.zip/sitecustomizemodule.so", O_RDONLY) Err#2  ENOENT
+21749  2506852:        open("/usr/local/lib/python24.zip/sitecustomize.py", O_RDONLY) Err#2  ENOENT
+21750  2506852:        open("/usr/local/lib/python24.zip/sitecustomize.pyc", O_RDONLY) Err#2  ENOENT
+21751  2506852:        statx("/usr/local/lib/python2.4", 0x2FF1EE18, 76, 0) = 0
+21752  2506852:        statx("/usr/local/lib/python2.4/sitecustomize", 0x2FF1F450, 76, 0) Err#2  ENOENT
+21753  2506852:        open("/usr/local/lib/python2.4/sitecustomize.so", O_RDONLY) Err#2  ENOENT
+21754  2506852:        open("/usr/local/lib/python2.4/sitecustomizemodule.so", O_RDONLY) Err#2  ENOENT
+21755  2506852:        open("/usr/local/lib/python2.4/sitecustomize.py", O_RDONLY) Err#2  ENOENT
+21756  2506852:        open("/usr/local/lib/python2.4/sitecustomize.pyc", O_RDONLY) Err#2  ENOENT
+21757  2506852:        statx("/usr/local/lib/python2.4/plat-aix5", 0x2FF1EE18, 76, 0) = 0
+21758  2506852:        statx("/usr/local/lib/python2.4/plat-aix5/sitecustomize", 0x2FF1F450, 76, 0) Err#2  ENOENT
+21759  2506852:        open("/usr/local/lib/python2.4/plat-aix5/sitecustomize.so", O_RDONLY) Err#2  ENOENT
+21760  2506852:        open("/usr/local/lib/python2.4/plat-aix5/sitecustomizemodule.so", O_RDONLY) Err#2  ENOENT
+21761  2506852:        open("/usr/local/lib/python2.4/plat-aix5/sitecustomize.py", O_RDONLY) Err#2  ENOENT
+21762  2506852:        open("/usr/local/lib/python2.4/plat-aix5/sitecustomize.pyc", O_RDONLY) Err#2  ENOENT
+21763  2506852:        statx("/usr/local/lib/python2.4/lib-tk", 0x2FF1EE18, 76, 0) = 0
+21764  2506852:        statx("/usr/local/lib/python2.4/lib-tk/sitecustomize", 0x2FF1F450, 76, 0) Err#2  ENOENT
+21765  2506852:        open("/usr/local/lib/python2.4/lib-tk/sitecustomize.so", O_RDONLY) Err#2  ENOENT
+21766  2506852:        open("/usr/local/lib/python2.4/lib-tk/sitecustomizemodule.so", O_RDONLY) Err#2  ENOENT
+21767  2506852:        open("/usr/local/lib/python2.4/lib-tk/sitecustomize.py", O_RDONLY) Err#2  ENOENT
+21768  2506852:        open("/usr/local/lib/python2.4/lib-tk/sitecustomize.pyc", O_RDONLY) Err#2  ENOENT
+21769  2506852:        statx("/usr/local/lib/python2.4/lib-dynload", 0x2FF1EE18, 76, 0) = 0
+21770  2506852:        statx("/usr/local/lib/python2.4/lib-dynload/sitecustomize", 0x2FF1F450, 76, 0) Err#2  ENOENT
+21771  2506852:        open("/usr/local/lib/python2.4/lib-dynload/sitecustomize.so", O_RDONLY) Err#2  ENOENT
+21772  2506852:        open("/usr/local/lib/python2.4/lib-dynload/sitecustomizemodule.so", O_RDONLY) Err#2  ENOENT
+21773  2506852:        open("/usr/local/lib/python2.4/lib-dynload/sitecustomize.py", O_RDONLY) Err#2  ENOENT
+21774  2506852:        open("/usr/local/lib/python2.4/lib-dynload/sitecustomize.pyc", O_RDONLY) Err#2  ENOENT
+21775  2506852:        statx("/usr/local/lib/python2.4/site-packages", 0x2FF1EE18, 76, 0) = 0
+21776  2506852:        statx("/usr/local/lib/python2.4/site-packages/sitecustomize", 0x2FF1F450, 76, 0) Err#2  ENOENT
+21777  2506852:        open("/usr/local/lib/python2.4/site-packages/sitecustomize.so", O_RDONLY) Err#2  ENOENT
+21778  2506852:        open("/usr/local/lib/python2.4/site-packages/sitecustomizemodule.so", O_RDONLY) Err#2  ENOENT
+21779  2506852:        open("/usr/local/lib/python2.4/site-packages/sitecustomize.py", O_RDONLY) Err#2  ENOENT
+21780  2506852:        open("/usr/local/lib/python2.4/site-packages/sitecustomize.pyc", O_RDONLY) Err#2  ENOENT
+21781  2506852:        close(8)                                        = 0
+21782  2506852:        statx("/usr/local/lib/python24.zip/mod_python", 0x2FF209F0, 76, 0) Err#2  ENOENT
+21783  2506852:        open("/usr/local/lib/python24.zip/mod_python.so", O_RDONLY) Err#2  ENOENT
+21784  2506852:        open("/usr/local/lib/python24.zip/mod_pythonmodule.so", O_RDONLY) Err#2  ENOENT
+21785  2506852:        open("/usr/local/lib/python24.zip/mod_python.py", O_RDONLY) Err#2  ENOENT
+21786  2506852:        open("/usr/local/lib/python24.zip/mod_python.pyc", O_RDONLY) Err#2  ENOENT
+21787  2506852:        statx("/usr/local/lib/python2.4/mod_python", 0x2FF209F0, 76, 0) Err#2  ENOENT
+21788  2506852:        open("/usr/local/lib/python2.4/mod_python.so", O_RDONLY) Err#2  ENOENT
+21789  2506852:        open("/usr/local/lib/python2.4/mod_pythonmodule.so", O_RDONLY) Err#2  ENOENT
+21790  2506852:        open("/usr/local/lib/python2.4/mod_python.py", O_RDONLY) Err#2  ENOENT
+21791  2506852:        open("/usr/local/lib/python2.4/mod_python.pyc", O_RDONLY) Err#2  ENOENT
+21792  2506852:        statx("/usr/local/lib/python2.4/plat-aix5/mod_python", 0x2FF209F0, 76, 0) Err#2  ENOENT
+21793  2506852:        open("/usr/local/lib/python2.4/plat-aix5/mod_python.so", O_RDONLY) Err#2  ENOENT
+21794  2506852:        open("/usr/local/lib/python2.4/plat-aix5/mod_pythonmodule.so", O_RDONLY) Err#2  ENOENT
+21795  2506852:        open("/usr/local/lib/python2.4/plat-aix5/mod_python.py", O_RDONLY) Err#2  ENOENT
+21796  2506852:        open("/usr/local/lib/python2.4/plat-aix5/mod_python.pyc", O_RDONLY) Err#2  ENOENT
+21797  2506852:        statx("/usr/local/lib/python2.4/lib-tk/mod_python", 0x2FF209F0, 76, 0) Err#2  ENOENT
+21798  2506852:        open("/usr/local/lib/python2.4/lib-tk/mod_python.so", O_RDONLY) Err#2  ENOENT
+21799  2506852:        open("/usr/local/lib/python2.4/lib-tk/mod_pythonmodule.so", O_RDONLY) Err#2  ENOENT
+21800  2506852:        open("/usr/local/lib/python2.4/lib-tk/mod_python.py", O_RDONLY) Err#2  ENOENT
+21801  2506852:        open("/usr/local/lib/python2.4/lib-tk/mod_python.pyc", O_RDONLY) Err#2  ENOENT
+21802  2506852:        statx("/usr/local/lib/python2.4/lib-dynload/mod_python", 0x2FF209F0, 76, 0) Err#2  ENOENT
+21803  2506852:        open("/usr/local/lib/python2.4/lib-dynload/mod_python.so", O_RDONLY) Err#2  ENOENT
+21804  2506852:        open("/usr/local/lib/python2.4/lib-dynload/mod_pythonmodule.so", O_RDONLY) Err#2  ENOENT
+21805  2506852:        open("/usr/local/lib/python2.4/lib-dynload/mod_python.py", O_RDONLY) Err#2  ENOENT
+21806  2506852:        open("/usr/local/lib/python2.4/lib-dynload/mod_python.pyc", O_RDONLY) Err#2  ENOENT
+21807  2506852:        statx("/usr/local/lib/python2.4/site-packages/mod_python", 0x2FF209F0, 76, 0) = 0
+21808  2506852:        statx("/usr/local/lib/python2.4/site-packages/mod_python/__init__.py", 0x2FF20920, 76, 0) = 0
+21809  2506852:        statx("/usr/local/lib/python2.4/site-packages/mod_python/__init__", 0x2FF20580, 76, 0) Err#2  ENOENT
+21810  2506852:        open("/usr/local/lib/python2.4/site-packages/mod_python/__init__.so", O_RDONLY) Err#2  ENOENT
+21811  2506852:        open("/usr/local/lib/python2.4/site-packages/mod_python/__init__module.so", O_RDONLY) Err#2  ENOENT
+21812  2506852:        open("/usr/local/lib/python2.4/site-packages/mod_python/__init__.py", O_RDONLY) = 8
+21813  2506852:        kioctl(8, 22528, 0x00000000, 0x00000000)        Err#25 ENOTTY
+21814  2506852:        fstatx(8, 0x2FF20570, 76, 0)                    = 0
+21815  2506852:        open("/usr/local/lib/python2.4/site-packages/mod_python/__init__.pyc", O_RDONLY) = 9
+21816  2506852:        kioctl(9, 22528, 0x00000000, 0x00000000)        Err#25 ENOTTY
+21817  2506852:        kioctl(9, 22528, 0x00000000, 0x00000000)        Err#25 ENOTTY
+21818  2506852:        kread(9, " m ?\r\n I ? ? A c\0\0\0".., 4096)    = 236
+21819  2506852:        fstatx(9, 0x2FF1C4C0, 76, 0)                    = 0
+21820  2506852:        kread(9, " m ?\r\n I ? ? A c\0\0\0".., 4096)    = 0
+21821  2506852:        close(9)                                        = 0
+21822  2506852:        close(8)                                        = 0


From grahamd at dscpl.com.au  Wed Jan 11 17:49:56 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Wed Jan 11 17:50:02 2006
Subject: [mod_python] make failed on AIX 5.1 using xlc
Message-ID: <1137019796.13455@dscpl.user.openhosting.com>

Hans-Joachim Ehlers wrote ..
> 
> Graham Dumpleton" <grahamd@dscpl.com.au> 10/01/06 22:54  wrote
> >Similar situation for the function cast you had to change in
> requestobject.c.
> >It just becomes to much of a pain to try and deal with the strangeness
> of
> >lessor used compilers.
> I made which the gcc (3.2.2) a syntax check against the patched file
> and it does not complains. 
> So it would be nice and if the change will not cause trouble to have in
> the source code. Otherwise at the next revision me and other will run in
> the same or similar issue

If you put the code back to how it was originally, ie., no hack for the
function cast, does GNU C compile it then?

The problem is that the code as originally written is syntactically
correct and is what it should be. It is a problem with the compiler
or platform that is the real problem. It is not a good idea to introduce
such a hack, which technically is wrong and may then cause another
compiler or platform to fail. In other words, it may fix your particular
problem, but may in turn cause problems for a lot of others if the
change were made.

Graham

From grahamd at dscpl.com.au  Wed Jan 11 18:08:32 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Wed Jan 11 18:08:38 2006
Subject: Addedum - [mod_python] could not import mod_python.apache.
Message-ID: <1137020912.25263@dscpl.user.openhosting.com>

Hans-Joachim Ehlers wrote ..
> TRUSS output 
> I did a 
> $ export PYTHONPATH=/usr/local

That seems to be a strange location to be setting PYTHONPATH to.

> $ truss -f  "./bin/httpd -XA
> 
> If you take a look at the long output from truss you will see:
> 
> open("/usr/local/lib/python2.4/lib-dynload/time.so", O_RDONLY) = 9
> 2506852:        kioctl(9, 22528, 0x00000000, 0x00000000)        Err#25
> ENOTTY
> 
> Does that mean: That the system is not able to load the program 'time.so'
> from the python installation ?

No. the open() call is succeeding quite happily as it returns a file descriptor
number. The following line is about something else.

Graham
From grahamd at dscpl.com.au  Wed Jan 11 18:26:36 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Wed Jan 11 18:26:42 2006
Subject: Addedum - [mod_python] could not import mod_python.apache.
Message-ID: <1137021996.4007@dscpl.user.openhosting.com>

Graham Dumpleton wrote ..
> Hans-Joachim Ehlers wrote ..
> > TRUSS output 
> > I did a 
> > $ export PYTHONPATH=/usr/local
> 
> That seems to be a strange location to be setting PYTHONPATH to.
> 
> > $ truss -f  "./bin/httpd -XA
> > 
> > If you take a look at the long output from truss you will see:
> > 
> > open("/usr/local/lib/python2.4/lib-dynload/time.so", O_RDONLY) = 9
> > 2506852:        kioctl(9, 22528, 0x00000000, 0x00000000)        Err#25
> > ENOTTY
> > 
> > Does that mean: That the system is not able to load the program 'time.so'
> > from the python installation ?
> 
> No. the open() call is succeeding quite happily as it returns a file descriptor
> number. The following line is about something else.

Well, that line in itself doesn't show a problem, but latter:

+21554  2506852:        kwrite(2, " I m p o r t E r r o r", 11)         = 11
+21555  2506852:        kwrite(2, " :  ", 2)                            = 2
+21556  2506852:        kwrite(2, " E x e c   f o r m a t  ".., 17)     = 17

possibly does for time.so import.

I think you were using mod_python 3.1.X. Suggest you get down mod_python 3.2
which does a better job of ensuring Python errors which occur during startup are
flushed to the Apache log.

That or turn on verbose mode for your trace tool for write date on file descriptor 2.
Ie., stderr. Then you might see what the full error is. Then track down what the
error message means when Python generates it.

Graham
From HansJoachim.Ehlers at eumetsat.int  Thu Jan 12 04:36:06 2006
From: HansJoachim.Ehlers at eumetsat.int (Hans-Joachim Ehlers)
Date: Thu Jan 12 04:36:44 2006
Subject: [mod_python] make failed on AIX 5.1 using xlc
Message-ID: <s3c63135.052@gwn0201.eumetsat.int>


>>>> "Graham Dumpleton" <grahamd@dscpl.com.au> 11/01/06 23:49 >>>
>Hans-Joachim Ehlers wrote ..
>> 
>> Graham Dumpleton" <grahamd@dscpl.com.au> 10/01/06 22:54  wrote
>> >Similar situation for the function cast you had to change in
>> requestobject.c.
>> >It just becomes to much of a pain to try and deal with the
strangeness
>> of
>> >lessor used compilers.
>> I made which the gcc (3.2.2) a syntax check against the patched
file
>> and it does not complains. 
>> So it would be nice and if the change will not cause trouble to have
in
>> the source code. Otherwise at the next revision me and other will
run in
>> the same or similar issue

>If you put the code back to how it was originally, ie., no hack for
the
>function cast, does GNU C compile it then?

Without any problem. The gnu compiler compiles also the patched
version

>The problem is that the code as originally written is syntactically
>correct and is what it should be. It is a problem with the compiler
>or platform that is the real problem. It is not a good idea to
introduce
>such a hack, which technically is wrong and may then cause another
>compiler or platform to fail. In other words, it may fix your
particular
>problem, but may in turn cause problems for a lot of others if the
>change were made.

I disagree at this point:
A syntax check with the gcc compiler shows for the requestobject.c

gcc -fsyntax-only -pedantic  -I/usr/local/apache2/include 
-I/usr/local/apache2/include   -I/usr/local/apache2/include 
-I$HOME/workbench/modpython/mod_python-3.1.4/src/include
-I/usr/local/apache2/include -I/usr/local/include/python2.4 
requestobject.c

requestobject.c: In function `getreq_recmbr_off':
requestobject.c:1121: warning: ISO C90 does not support `long long'
requestobject.c:1122: warning: ISO C90 does not support `long long'
requestobject.c:1122: warning: ISO C90 does not support `long long'
requestobject.c: At top level:
----> requestobject.c:1381: warning: initialization from incompatible
pointer type

Where   line 1381 is exactly:  (destructor)request_dealloc,     /*
tp_free */
If i fix the line to  (void(*)(void*))request_dealloc the GCC will not
t complain anymore.
So from my native view i would say that the original code is not
correct from the syntax view. 

requestobject.c: In function `getreq_recmbr_off':
requestobject.c:1121: warning: ISO C90 does not support `long long'
requestobject.c:1122: warning: ISO C90 does not support `long long'
requestobject.c:1122: warning: ISO C90 does not support `long long'
---->

Hajo

From grahamd at dscpl.com.au  Thu Jan 12 04:46:03 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Thu Jan 12 04:46:25 2006
Subject: [mod_python] make failed on AIX 5.1 using xlc
In-Reply-To: <s3c63135.051@gwn0201.eumetsat.int>
References: <s3c63135.051@gwn0201.eumetsat.int>
Message-ID: <7d5fbf749235e8bc4e0080ddae2cffb9@dscpl.com.au>


On 12/01/2006, at 8:36 PM, Hans-Joachim Ehlers wrote:
> Where   line 1381 is exactly:  (destructor)request_dealloc,     /*
> tp_free */
> If i fix the line to  (void(*)(void*))request_dealloc the GCC will not
> t complain anymore.
> So from my native view i would say that the original code is not
> correct from the syntax view.

Actually, it turns out it is wrong for other reasons. That whole line
has been replaced in mod_python 3.2 and that struct member is simply
set to 0.

Get down mod_python 3.2.5b and see if that compiles without problem.

Graham

From python_eager at yahoo.com  Thu Jan 12 05:39:41 2006
From: python_eager at yahoo.com (python eager)
Date: Thu Jan 12 05:39:45 2006
Subject: [mod_python] error occur while comparing
Message-ID: <20060112103941.48198.qmail@web36412.mail.mud.yahoo.com>

  Hi ,
      here  i am comparing both the values of form value and table value. But it will not work . The result will be print "not equal". Table values are retrieved fine. Here what mistake i did. No compilation error and run time error. Please solve this problem.
   
  Code Snippet :
   
            req = self.request()
          pid = int(req.field('pid'))
          self.writeln(pid)
         
            dbconnection = cx_Oracle.connect("myusername", "mypassword", "mydatabase")
          cursor = dbconnection.cursor()
          cursor.arraysize = 50
          cursor.execute("SELECT PID FROM PERSONALDETAILS order by pid")
          for PID in cursor.fetchall():
             # Comparing here both formvalue and table value ( both are numeric)              
              if pid==PID:
                  self.writeln("Equal")
              else:
                  self.writeln("Not Equal")
   
  Thank you
  Python_Eager


		
---------------------------------
Yahoo! Photos ? Showcase holiday pictures in hardcover
 Photo Books. You design it and we?ll bind it!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20060112/3c78124d/attachment.html
From grahamd at dscpl.com.au  Thu Jan 12 16:48:29 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Thu Jan 12 16:48:32 2006
Subject: [mod_python] error occur while comparing
Message-ID: <1137102509.7103@dscpl.user.openhosting.com>

You are persistent, I give you that.

Some questions you should answer yourself and which may help you
to work out what you are doing wrong.

First, what have you actually done to debug the problem? Have you
generated any debug output from your handler back to the web page
to confirm what the values being compared are and what the types
of the values are?

Since your script isn't particularly dependent on mod_python, have
you extracted it into a standalone command line script where it will
be easier to debug?

Ie., if run as a command line script, you can still use 'print' to
output debugging. If run under mod_python you need to either log debug
to the Apache log file and look in the error log file for the messages,
or write the debug back to the web browser so you can see it. For
example, you might use:

           from mod_python import apache

           for PID in cursor.fetchall():
               apache.log_error("pid=%s"%`pid`)
               apache.log_error("type pid=%s"%`type(pid)`)
               apache.log_error("PID=%s"%`PID`)
               apache.log_error("type PID=%s"%`type(PID)`)
               if pid==PID:
                   self.writeln("Equal")
               else:
                   self.writeln("Not Equal")

or:

           req.content_type = 'text/plain'
           for PID in cursor.fetchall():
               req.write("pid=%s\n"%`pid`)
               req.write("type pid=%s\n"%`type(pid)`)
               req.write("PID=%s\n"%`PID`)
               req.write("type PID=%s\n"%`type(PID)`)
               if pid==PID:
                   self.writeln("Equal")
               else:
                   self.writeln("Not Equal")

If you are going to keep posting these questions to mod_python list
instead of a list more specific to the Python DB API being used, at
least read:

  http://www.catb.org/~esr/faqs/smart-questions.html

Graham

python eager wrote ..
>   Hi ,
>       here  i am comparing both the values of form value and table value.
> But it will not work . The result will be print "not equal". Table values
> are retrieved fine. Here what mistake i did. No compilation error and run
> time error. Please solve this problem.
>    
>   Code Snippet :
>    
>             req = self.request()
>           pid = int(req.field('pid'))
>           self.writeln(pid)
>          
>             dbconnection = cx_Oracle.connect("myusername", "mypassword",
> "mydatabase")
>           cursor = dbconnection.cursor()
>           cursor.arraysize = 50
>           cursor.execute("SELECT PID FROM PERSONALDETAILS order by pid")
>           for PID in cursor.fetchall():
>              # Comparing here both formvalue and table value ( both are
> numeric)              
>               if pid==PID:
>                   self.writeln("Equal")
>               else:
>                   self.writeln("Not Equal")
>    
>   Thank you
>   Python_Eager
> 
> 
> 		
> ---------------------------------
> Yahoo! Photos ? Showcase holiday pictures in hardcover
>  Photo Books. You design it and we?ll bind it!
From fabianosidler at gmail.com  Thu Jan 12 17:56:50 2006
From: fabianosidler at gmail.com (Fabiano Sidler)
Date: Thu Jan 12 17:56:55 2006
Subject: [mod_python] python module loaded, but not parsed (huh?)
In-Reply-To: <1136755722.8064@dscpl.user.openhosting.com>
References: <1136755722.8064@dscpl.user.openhosting.com>
Message-ID: <d3d66b1c0601121456k47bd432dt@mail.gmail.com>

First: Thanks a lot for your help! :)

I now added a metaclass to the module for class object creation being
logged. They all get created, hence, mod_python is used and works
correctly until here. But it seems that just as soon the module is
imported by mod_python, it sends the module code to the client instead
of running it.

Thanks,
Fips

From grahamd at dscpl.com.au  Thu Jan 12 18:16:02 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Thu Jan 12 18:16:15 2006
Subject: [mod_python] python module loaded, but not parsed (huh?)
Message-ID: <1137107762.30101@dscpl.user.openhosting.com>

Fabiano Sidler wrote ..
> First: Thanks a lot for your help! :)
> 
> I now added a metaclass to the module for class object creation being
> logged. They all get created, hence, mod_python is used and works
> correctly until here. But it seems that just as soon the module is
> imported by mod_python, it sends the module code to the client instead
> of running it.

Unfortunately your email doesn't really provide that much to go on. What
would be better is if you can post a small, but complete, handler module
code file that you are using. Ensure that it shows what logging you have
added as suggested in previous email. Also show the output from the
error log file so it can be seen what log code is being run.

The contents of your .htaccess file and which version of mod_python you
are running would also be useful.

Graham
From trepca at gmail.com  Fri Jan 13 10:20:00 2006
From: trepca at gmail.com (Sebastjan Trepca)
Date: Fri Jan 13 10:20:16 2006
Subject: [mod_python] Session expires early
In-Reply-To: <f2b2d87d6908086b84bfd4c185cb4937@dscpl.com.au>
References: <43BF2CB5.9050301@barriescene.com>
	<f2b2d87d6908086b84bfd4c185cb4937@dscpl.com.au>
Message-ID: <cd329af80601130720j44c77ae1xd8dd662b7917d82a@mail.gmail.com>

Yeah, BaseSession object does not save last accessed time if you just read
the session object so it works only for the given timeout and that is wrong
IMO.
All other session management systems save access times transparently and I
don't see a reason why shouldn't mod_python do that too.

At least documentation could mention this issue for now ...

Sebastjan

On 1/8/06, Graham Dumpleton <grahamd@dscpl.com.au> wrote:
>
>
> On 07/01/2006, at 1:51 PM, Sean Jamieson wrote:
>
> > Does anyone know why, or has anyone else notices, that a session seems
> > to time out reguardless of when it was last accessed?
> > i.e. I'm browsing along for 20-30 minutes, and then the I click a link
> > after being idle less than 5 minutes, and suddenly my session is
> > expired.
> >
> > This even happend today when I was showing something to a client, on
> > my laptop.
>
> AFAIK, the person who best understands the session code is not checking
> email at the moment. At least, haven't seen anything from them for a
> while.
>
> First question from me. What version of mod_python are you using? If not
> using version 3.2.5b, can you at least upgrade and confirm whether you
> see the same problem in that version.
>
> Also and more importantly, in the page access' between when you log in
> and when it expires, is your code ever actually saving the session
> object
> for any reason?
>
> I can't remember if a save is a prerequisite for having the last
> accessed
> time updated in the session database. Ie., if you don't do a save, that
> you accessed the session is never recorded and so it will expire as soon
> as the timeout value elapses.
>
> Surely not everyone who understands session is still on holidays! :-)
>
> Graham
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20060113/d5994f7f/attachment.html
From fabianosidler at gmail.com  Fri Jan 13 19:54:43 2006
From: fabianosidler at gmail.com (Fabiano Sidler)
Date: Fri Jan 13 19:54:46 2006
Subject: [mod_python] python module loaded, but not parsed (huh?)
In-Reply-To: <1137107762.30101@dscpl.user.openhosting.com>
References: <1137107762.30101@dscpl.user.openhosting.com>
Message-ID: <d3d66b1c0601131654n331a64ccp@mail.gmail.com>

2006/1/13, Graham Dumpleton <grahamd@dscpl.com.au>:
> Unfortunately your email doesn't really provide that much to go on.

Sorry for that! But meanwhile I located the problem:
--- testwebapp.py ---
from container import WebApp, Request

class MyWebApp(WebApp):
	title='My WebApplication'
	def run():
		Request.setContentType('text/html')
		Request.write('Foobar!')

--- container.py ---
class WebAppMeta(type):
	def __new__(cls, name, bases, d):
		from types import FunctionType as Function
		for i in d:
			if type(d[i]) is Function:
				d[i] = staticmethod(d[i])
		loadmodule(cls.__module__, cls)
		return super(WebAppMeta, cls).__new__(cls, name, bases, d)

class WebApp:
	__metaclass__=WebAppMeta
	def someBasicFooBarMethods(): pass

def loadmodule(mod, cls):
	from mod_python import apache
	class Request: pass
	def handler(req):
		Request.write = staticmethod(req.write)
		cls.run()
		return apache.OK
	mod.Request = Request
	mod.handler = handler

The interesting[tm] thing now is that on creation of the
testwebapp.MyWebApp class, loadmodule()'s mod argument is container
instead of my assumption, in which it was testwebapp. As the
consequence, the name testwebapp.handler is not set and mod_python
delivers the script code to the client, annoyingly without any message
to the logs!
Is there a way to achieve what I wanted to do, or will I have to
change my whole app design? As I posted earlier, I'm doing a
server-independent interface for writing webapps and its specification
is already made. I would dislike beginning from 0.

Thank you lots for your help!
Greetings,
Fips

From grahamd at dscpl.com.au  Fri Jan 13 21:40:51 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Fri Jan 13 21:41:09 2006
Subject: [mod_python] python module loaded, but not parsed (huh?)
In-Reply-To: <d3d66b1c0601131654n331a64ccp@mail.gmail.com>
References: <1137107762.30101@dscpl.user.openhosting.com>
	<d3d66b1c0601131654n331a64ccp@mail.gmail.com>
Message-ID: <44FE271F-7DE9-4FEE-A861-B82F0D92DDF5@dscpl.com.au>


On 14/01/2006, at 11:54 AM, Fabiano Sidler wrote:
> The interesting[tm] thing now is that on creation of the
> testwebapp.MyWebApp class, loadmodule()'s mod argument is container
> instead of my assumption, in which it was testwebapp. As the
> consequence, the name testwebapp.handler is not set and mod_python
> delivers the script code to the client, annoyingly without any message
> to the logs!

Use mod_python 3.2.5b (hopefully 3.2.6 final soon). This addresses that
particular problem of not getting an error message when the handler  
could
not be found. First documented in:

   http://issues.apache.org/jira/browse/MODPYTHON-46

> Is there a way to achieve what I wanted to do, or will I have to
> change my whole app design? As I posted earlier, I'm doing a
> server-independent interface for writing webapps and its specification
> is already made. I would dislike beginning from 0.

Ahhh, I'll have to look through your code and past emails to see what  
you
wanted to achieve, not real clear on that point right now. ;-)

Graham
From grahamd at dscpl.com.au  Fri Jan 13 22:09:07 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Fri Jan 13 22:09:20 2006
Subject: [mod_python] python module loaded, but not parsed (huh?)
In-Reply-To: <44FE271F-7DE9-4FEE-A861-B82F0D92DDF5@dscpl.com.au>
References: <1137107762.30101@dscpl.user.openhosting.com>
	<d3d66b1c0601131654n331a64ccp@mail.gmail.com>
	<44FE271F-7DE9-4FEE-A861-B82F0D92DDF5@dscpl.com.au>
Message-ID: <2743380B-F8CE-42AD-8E18-4972A52C8DF7@dscpl.com.au>


On 14/01/2006, at 1:40 PM, Graham Dumpleton wrote:

>> Is there a way to achieve what I wanted to do, or will I have to
>> change my whole app design? As I posted earlier, I'm doing a
>> server-independent interface for writing webapps and its  
>> specification
>> is already made. I would dislike beginning from 0.
>
> Ahhh, I'll have to look through your code and past emails to see  
> what you
> wanted to achieve, not real clear on that point right now. ;-)

Hmmm, I looked at your code, its awfully complicated. Have you ever
considered using WSGI if you want a server independent interface?
Using WSGI would save you a lot of effort as it has already been spec'd
out and there are adaptors for lots of servers, including mod_python.
PEP for WSGI can be found at:

   http://www.python.org/peps/pep-0333.html

Use Google to find other WSGI stuff including adaptors.

Graham


From fabianosidler at gmail.com  Fri Jan 13 22:52:24 2006
From: fabianosidler at gmail.com (Fabiano Sidler)
Date: Fri Jan 13 22:52:27 2006
Subject: [mod_python] python module loaded, but not parsed (huh?)
In-Reply-To: <2743380B-F8CE-42AD-8E18-4972A52C8DF7@dscpl.com.au>
References: <1137107762.30101@dscpl.user.openhosting.com>
	<d3d66b1c0601131654n331a64ccp@mail.gmail.com>
	<44FE271F-7DE9-4FEE-A861-B82F0D92DDF5@dscpl.com.au>
	<2743380B-F8CE-42AD-8E18-4972A52C8DF7@dscpl.com.au>
Message-ID: <d3d66b1c0601131952r703bdc6eu@mail.gmail.com>

Wow! Two answers within this short time! Are you competing yourself? ;)

2006/1/14, Graham Dumpleton <grahamd@dscpl.com.au>:
> Hmmm, I looked at your code, its awfully complicated.

Which one? The older is much more difficult than the one I have by
now. Actually, the container now only set the name for invoking the
application (handler in this case) and generates some static classes
like Request.

> Have you ever considered using WSGI if you want a server independent
> interface?

Yes, but I need a fully-featured server for testing things like
session handling and cookies in the code above my interface. A port to
WSGI I will add as soon as the actual application development is going
on.

The problem now is: How can I get the name 'handler' to be set at the
right place? I'll work on it after a few hours of sleep! ;)

Best wishes,
Fips

From grahamd at dscpl.com.au  Sat Jan 14 01:34:43 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Sat Jan 14 01:35:03 2006
Subject: [mod_python] python module loaded, but not parsed (huh?)
In-Reply-To: <d3d66b1c0601131952r703bdc6eu@mail.gmail.com>
References: <1137107762.30101@dscpl.user.openhosting.com>
	<d3d66b1c0601131654n331a64ccp@mail.gmail.com>
	<44FE271F-7DE9-4FEE-A861-B82F0D92DDF5@dscpl.com.au>
	<2743380B-F8CE-42AD-8E18-4972A52C8DF7@dscpl.com.au>
	<d3d66b1c0601131952r703bdc6eu@mail.gmail.com>
Message-ID: <ab09576194ac95f779114e421e51859e@dscpl.com.au>


On 14/01/2006, at 2:52 PM, Fabiano Sidler wrote:

> Wow! Two answers within this short time! Are you competing yourself? ;)
>
> 2006/1/14, Graham Dumpleton <grahamd@dscpl.com.au>:
>> Hmmm, I looked at your code, its awfully complicated.
>
> Which one? The older is much more difficult than the one I have by
> now. Actually, the container now only set the name for invoking the
> application (handler in this case) and generates some static classes
> like Request.
In this last thread, you have only posted one bit of code. I used the 
term
"complicated" because you use features line metaclasses, static methods
creation, overloading of new, etc. It just seems to fail the test of 
keeping
it simple for me. I can't really see the reason for doing it all, it 
just seems
to me that it is only going to result in something that will be hard to
maintain by someone done the track.

> The problem now is: How can I get the name 'handler' to be set at the
> right place? I'll work on it after a few hours of sleep! ;)
Well, I had a snooze for a couple of hours and didn't help me much. ;-)

In one of your emails you said you were using configuration of:

? SetHandler python-program
? PythonHandler mymodule
? PythonDebug On

This means mymodule::handler() needed to exist. Your quote code
did not even have a mymodule.py and there was no handler() at
global scope in the code, the only reference to handler() was nested
in a function. You were somehow trying to stuff the handler() method
into a module of a class, but that wasn't going to work as the type of
cls.__module__ is a string not a module, so attempts to set Request
and handler in the module were going to be applied to a string object.
Ie., a value containing the name of the module, not the actual module.
All in all, it?wasn't even clear where the entry point was going to be 
to
trigger stuff to created. It also worried me as well that you were 
making
req.write() a static method.

Let me describe a few basic concepts about mod_python which may
help you (or not).

When you specify 'PythonHandler', the value can be the name of a
module, in which case that module must provide a 'handler()" function
as entry point. Or, it can specify 'module::name' where name is the
name of a function in the module to use as an entry point. Whatever
the entry point is, it needs to take the single argument which is the
request object.

What most people don't realise is that if 'name' identifies an unbound
method of a?class type, an instance of the class type will be created
and then the method will be called. Thus you can have:

? # .htaccess

? SetHandler python-program
? PythonHandler example::MyWebApp.__call__

? # example.py

? from mod_python import apache

   class MyWebApp:
     def __init__(self,req):
       apache.log_error("__init__")
       pass
     def __call__(self,req):
       apache.log_error("__call__")
       req.content_type = 'text/plain'
       req.write('hello')
       return apache.OK
?? ?
In terms of what you are doing, if you wanted an instance of MyWebApp
to be created on each class, this is what you would be best off doing.
The __init__() method could do any initialisation which might be 
specific
to mod_python to create your server independent interface. Because
__init__() must accept a request object, derived classes couldn't 
override
it though for their own purposes.

Now I don't know if this helps in anyway. I could ramble on a bit more 
about
other things that may be of interest, but have to run out the door 
right now.

Graham



From fabianosidler at gmail.com  Sat Jan 14 06:57:41 2006
From: fabianosidler at gmail.com (Fabiano Sidler)
Date: Sat Jan 14 06:57:43 2006
Subject: [mod_python] python module loaded, but not parsed (huh?)
In-Reply-To: <ab09576194ac95f779114e421e51859e@dscpl.com.au>
References: <1137107762.30101@dscpl.user.openhosting.com>
	<d3d66b1c0601131654n331a64ccp@mail.gmail.com>
	<44FE271F-7DE9-4FEE-A861-B82F0D92DDF5@dscpl.com.au>
	<2743380B-F8CE-42AD-8E18-4972A52C8DF7@dscpl.com.au>
	<d3d66b1c0601131952r703bdc6eu@mail.gmail.com>
	<ab09576194ac95f779114e421e51859e@dscpl.com.au>
Message-ID: <d3d66b1c0601140357x67f28c2w@mail.gmail.com>

2006/1/14, Graham Dumpleton <grahamd@dscpl.com.au>:
> I used the term "complicated" because you use features line
> metaclasses, static methods creation, overloading of new, etc. It just
> seems to fail the test of keeping it simple for me. I can't really see the
> reason for doing it all.

The reason is that the user of my interface shouldn't have to care
about things like a "req" object as well as applications using the
interface should work without any change of code. Therefore,
server-specific things must be done while importing the container, as
there is, for example, setting the global name 'handler'.

> You were somehow trying to stuff the handler() method
> into a module of a class, but that wasn't going to work as the type of
> cls.__module__ is a string not a module, so attempts to set Request
> and handler in the module were going to be applied to a string object.

Oops, my mistake! It was an untested example. In my other code, I pass
sys.modules[cls.__module__] to loadmodule(), not cls.__module__
itself. Sorry for confusion!
The strange thing is still the same: Why is the module string of the
metaclass module being passed to loadmodule instead of the module
string of the class object being created by the metaclass,
cls.__module__? I can't see a solution for this! :(

Greetings,
Fips

From webb.sprague at gmail.com  Sat Jan 14 14:17:55 2006
From: webb.sprague at gmail.com (Webb Sprague)
Date: Sat Jan 14 14:18:00 2006
Subject: [mod_python] Trouble compiling mod_python on gentoo
Message-ID: <b11ea23c0601141117r3f31feb3yc219196aa1249fd7@mail.gmail.com>

Hi all

I am unable to compile mod_python on a gentoo machine (all updated,
~x86, etc), both using emerge and by hand, please help if you can... 
(Also, please email me directly as well as the list, if possible).

Here is my configure command:

./configure --prefix=/usr/local/mod_python-3.1.4  --with-apxs=/usr/sbin/apxs2

Here is the error:

<snip>
checking where Python include files are... -I/usr/include/python2.4
./configure: line 2951: syntax error near unexpected token `('
./configure: line 2951: `as_me=`(basename "$0") 2>/dev/null ||'

Here are my specs:

mod_python version: 3.1.4, but same error on 3.2.5b and 3.1.3
bash version: 3.1.5
apache2 -V:
Server version: Apache/2.0.55
Server built:   Jan 12 2006 03:53:14
Server's Module Magic Number: 20020903:11
Architecture:   32-bit
Server compiled with....
 -D APACHE_MPM_DIR="server/mpm/prefork"
 -D APR_HAS_SENDFILE
 -D APR_HAS_MMAP
 -D APR_HAVE_IPV6 (IPv4-mapped addresses enabled)
 -D APR_USE_SYSVSEM_SERIALIZE
 -D APR_USE_PTHREAD_SERIALIZE
 -D SINGLE_LISTEN_UNSERIALIZED_ACCEPT
 -D APR_HAS_OTHER_CHILD
 -D AP_HAVE_RELIABLE_PIPED_LOGS
 -D HTTPD_ROOT="/usr"
 -D SUEXEC_BIN="/usr/sbin/suexec2"
 -D DEFAULT_PIDLOG="/var/run/httpd.pid"
 -D DEFAULT_SCOREBOARD="logs/apache_runtime_status"
 -D DEFAULT_LOCKFILE="/var/run/accept.lock"
 -D DEFAULT_ERRORLOG="logs/error_log"
 -D AP_TYPES_CONFIG_FILE="/etc/apache2/mime.types"
 -D SERVER_CONFIG_FILE="/etc/apache2/httpd.conf"

Here is where I think the configure script goes south:

# Name of the executable.
as_me=`(basename "$0") 2>/dev/null ||                   ## This is line 2951
$as_expr X/"$0" : '.*/\([^/][^/]*\)/*$' \| \
         X"$0" : 'X\(//\)$' \| \
         X"$0" : 'X\(/\)$' \| \
         .     : '\(.\)' 2>/dev/null ||
echo X/"$0" |
    sed '/^.*\/\([^/][^/]*\)\/*$/{ s//\1/; q; }
          /^X\/\(\/\/\)$/{ s//\1/; q; }
          /^X\/\(\/\).*/{ s//\1/; q; }
          s/.*/./; q'`

Any help would be great, or I can file a bug report if someone tells me where.

Thx
W

From grahamd at dscpl.com.au  Sat Jan 14 15:40:55 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Sat Jan 14 15:41:06 2006
Subject: [mod_python] python module loaded, but not parsed (huh?)
In-Reply-To: <d3d66b1c0601140357x67f28c2w@mail.gmail.com>
References: <1137107762.30101@dscpl.user.openhosting.com>
	<d3d66b1c0601131654n331a64ccp@mail.gmail.com>
	<44FE271F-7DE9-4FEE-A861-B82F0D92DDF5@dscpl.com.au>
	<2743380B-F8CE-42AD-8E18-4972A52C8DF7@dscpl.com.au>
	<d3d66b1c0601131952r703bdc6eu@mail.gmail.com>
	<ab09576194ac95f779114e421e51859e@dscpl.com.au>
	<d3d66b1c0601140357x67f28c2w@mail.gmail.com>
Message-ID: <4d396c03115b21b243d197c6afddc1a0@dscpl.com.au>


On 14/01/2006, at 10:57 PM, Fabiano Sidler wrote:

> Oops, my mistake! It was an untested example. In my other code, I pass
> sys.modules[cls.__module__] to loadmodule(), not cls.__module__
> itself.

Accessing into sys.modules like this will most likely not work in
mod_python 3.3. At least not for the module imported using the
PythonHandler directive. This is because modules imported by the
mod_python module loaded will not be registered in sys.modules.
 From mod_python 3.2, modules imported by the module loader in the
mod_python.publisher layer will not be added into sys.modules
either.

Anyway, I wish you luck. Still reckon you would be better building
on work from WSGI or even WebStack:

   http://www.boddie.org.uk/python/WebStack.html

But if the point is to learn stuff, then by all means keep going
the way you are.

Graham

From grahamd at dscpl.com.au  Sat Jan 14 15:50:12 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Sat Jan 14 15:50:28 2006
Subject: [mod_python] Trouble compiling mod_python on gentoo
In-Reply-To: <b11ea23c0601141117r3f31feb3yc219196aa1249fd7@mail.gmail.com>
References: <b11ea23c0601141117r3f31feb3yc219196aa1249fd7@mail.gmail.com>
Message-ID: <aa965aca5a5c34a7a4ba8cdcfa0d5054@dscpl.com.au>

Only suggestion I can give you to debug it is to run configure as:

   sh -x ./configure --prefix=/usr/local/mod_python-3.1.4  
--with-apxs=/usr/sbin/apxs2 > my.log 2>&1

The -x option will cause what what the shell is doing at each point
to be displayed. Make sure you log the output to a file as there will
be a lot. This may or may not tell you what is happening.

The quoted configure script snippet you give is the same as what works
on other platforms, so must be something strange to do with your user
environment, or what shell is linked as '/bin/sh'. You might even try:

   bash -x ./configure --prefix=/usr/local/mod_python-3.1.4  
--with-apxs=/usr/sbin/apxs2

to see if it makes a difference.

BTW, if you are using C Shell and not a Bourne Shell, you will need to
change how output send to log.

Graham

On 15/01/2006, at 6:17 AM, Webb Sprague wrote:

> Hi all
>
> I am unable to compile mod_python on a gentoo machine (all updated,
> ~x86, etc), both using emerge and by hand, please help if you can...
> (Also, please email me directly as well as the list, if possible).
>
> Here is my configure command:
>
> ./configure --prefix=/usr/local/mod_python-3.1.4  
> --with-apxs=/usr/sbin/apxs2
>
> Here is the error:
>
> <snip>
> checking where Python include files are... -I/usr/include/python2.4
> ./configure: line 2951: syntax error near unexpected token `('
> ./configure: line 2951: `as_me=`(basename "$0") 2>/dev/null ||'
>
> Here are my specs:
>
> mod_python version: 3.1.4, but same error on 3.2.5b and 3.1.3
> bash version: 3.1.5
> apache2 -V:
> Server version: Apache/2.0.55
> Server built:   Jan 12 2006 03:53:14
> Server's Module Magic Number: 20020903:11
> Architecture:   32-bit
> Server compiled with....
>  -D APACHE_MPM_DIR="server/mpm/prefork"
>  -D APR_HAS_SENDFILE
>  -D APR_HAS_MMAP
>  -D APR_HAVE_IPV6 (IPv4-mapped addresses enabled)
>  -D APR_USE_SYSVSEM_SERIALIZE
>  -D APR_USE_PTHREAD_SERIALIZE
>  -D SINGLE_LISTEN_UNSERIALIZED_ACCEPT
>  -D APR_HAS_OTHER_CHILD
>  -D AP_HAVE_RELIABLE_PIPED_LOGS
>  -D HTTPD_ROOT="/usr"
>  -D SUEXEC_BIN="/usr/sbin/suexec2"
>  -D DEFAULT_PIDLOG="/var/run/httpd.pid"
>  -D DEFAULT_SCOREBOARD="logs/apache_runtime_status"
>  -D DEFAULT_LOCKFILE="/var/run/accept.lock"
>  -D DEFAULT_ERRORLOG="logs/error_log"
>  -D AP_TYPES_CONFIG_FILE="/etc/apache2/mime.types"
>  -D SERVER_CONFIG_FILE="/etc/apache2/httpd.conf"
>
> Here is where I think the configure script goes south:
>
> # Name of the executable.
> as_me=`(basename "$0") 2>/dev/null ||                   ## This is 
> line 2951
> $as_expr X/"$0" : '.*/\([^/][^/]*\)/*$' \| \
>          X"$0" : 'X\(//\)$' \| \
>          X"$0" : 'X\(/\)$' \| \
>          .     : '\(.\)' 2>/dev/null ||
> echo X/"$0" |
>     sed '/^.*\/\([^/][^/]*\)\/*$/{ s//\1/; q; }
>           /^X\/\(\/\/\)$/{ s//\1/; q; }
>           /^X\/\(\/\).*/{ s//\1/; q; }
>           s/.*/./; q'`
>
> Any help would be great, or I can file a bug report if someone tells 
> me where.
>
> Thx
> W
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python

From webb.sprague at gmail.com  Sat Jan 14 18:06:32 2006
From: webb.sprague at gmail.com (Webb Sprague)
Date: Sat Jan 14 18:06:34 2006
Subject: [mod_python] Trouble compiling mod_python on gentoo
In-Reply-To: <aa965aca5a5c34a7a4ba8cdcfa0d5054@dscpl.com.au>
References: <b11ea23c0601141117r3f31feb3yc219196aa1249fd7@mail.gmail.com>
	<aa965aca5a5c34a7a4ba8cdcfa0d5054@dscpl.com.au>
Message-ID: <b11ea23c0601141506q173c217at208b214f3ee9878d@mail.gmail.com>

Someone filed a bug report:

http://bugs.gentoo.org/show_bug.cgi?id=118948

Thanks to Graham and all.
W

On 1/14/06, Graham Dumpleton <grahamd@dscpl.com.au> wrote:
> Only suggestion I can give you to debug it is to run configure as:
>
>    sh -x ./configure --prefix=/usr/local/mod_python-3.1.4
> --with-apxs=/usr/sbin/apxs2 > my.log 2>&1
>
> The -x option will cause what what the shell is doing at each point
> to be displayed. Make sure you log the output to a file as there will
> be a lot. This may or may not tell you what is happening.
>
> The quoted configure script snippet you give is the same as what works
> on other platforms, so must be something strange to do with your user
> environment, or what shell is linked as '/bin/sh'. You might even try:
>
>    bash -x ./configure --prefix=/usr/local/mod_python-3.1.4
> --with-apxs=/usr/sbin/apxs2
>
> to see if it makes a difference.
>
> BTW, if you are using C Shell and not a Bourne Shell, you will need to
> change how output send to log.
>
> Graham
>
> On 15/01/2006, at 6:17 AM, Webb Sprague wrote:
>
> > Hi all
> >
> > I am unable to compile mod_python on a gentoo machine (all updated,
> > ~x86, etc), both using emerge and by hand, please help if you can...
> > (Also, please email me directly as well as the list, if possible).
> >
> > Here is my configure command:
> >
> > ./configure --prefix=/usr/local/mod_python-3.1.4
> > --with-apxs=/usr/sbin/apxs2
> >
> > Here is the error:
> >
> > <snip>
> > checking where Python include files are... -I/usr/include/python2.4
> > ./configure: line 2951: syntax error near unexpected token `('
> > ./configure: line 2951: `as_me=`(basename "$0") 2>/dev/null ||'
> >
> > Here are my specs:
> >
> > mod_python version: 3.1.4, but same error on 3.2.5b and 3.1.3
> > bash version: 3.1.5
> > apache2 -V:
> > Server version: Apache/2.0.55
> > Server built:   Jan 12 2006 03:53:14
> > Server's Module Magic Number: 20020903:11
> > Architecture:   32-bit
> > Server compiled with....
> >  -D APACHE_MPM_DIR="server/mpm/prefork"
> >  -D APR_HAS_SENDFILE
> >  -D APR_HAS_MMAP
> >  -D APR_HAVE_IPV6 (IPv4-mapped addresses enabled)
> >  -D APR_USE_SYSVSEM_SERIALIZE
> >  -D APR_USE_PTHREAD_SERIALIZE
> >  -D SINGLE_LISTEN_UNSERIALIZED_ACCEPT
> >  -D APR_HAS_OTHER_CHILD
> >  -D AP_HAVE_RELIABLE_PIPED_LOGS
> >  -D HTTPD_ROOT="/usr"
> >  -D SUEXEC_BIN="/usr/sbin/suexec2"
> >  -D DEFAULT_PIDLOG="/var/run/httpd.pid"
> >  -D DEFAULT_SCOREBOARD="logs/apache_runtime_status"
> >  -D DEFAULT_LOCKFILE="/var/run/accept.lock"
> >  -D DEFAULT_ERRORLOG="logs/error_log"
> >  -D AP_TYPES_CONFIG_FILE="/etc/apache2/mime.types"
> >  -D SERVER_CONFIG_FILE="/etc/apache2/httpd.conf"
> >
> > Here is where I think the configure script goes south:
> >
> > # Name of the executable.
> > as_me=`(basename "$0") 2>/dev/null ||                   ## This is
> > line 2951
> > $as_expr X/"$0" : '.*/\([^/][^/]*\)/*$' \| \
> >          X"$0" : 'X\(//\)$' \| \
> >          X"$0" : 'X\(/\)$' \| \
> >          .     : '\(.\)' 2>/dev/null ||
> > echo X/"$0" |
> >     sed '/^.*\/\([^/][^/]*\)\/*$/{ s//\1/; q; }
> >           /^X\/\(\/\/\)$/{ s//\1/; q; }
> >           /^X\/\(\/\).*/{ s//\1/; q; }
> >           s/.*/./; q'`
> >
> > Any help would be great, or I can file a bug report if someone tells
> > me where.
> >
> > Thx
> > W
> >
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://mailman.modpython.org/mailman/listinfo/mod_python
>
>

From webb.sprague at gmail.com  Sat Jan 14 22:26:56 2006
From: webb.sprague at gmail.com (Webb Sprague)
Date: Sat Jan 14 22:27:00 2006
Subject: [mod_python] Trouble compiling mod_python on gentoo
In-Reply-To: <b11ea23c0601141506q173c217at208b214f3ee9878d@mail.gmail.com>
References: <b11ea23c0601141117r3f31feb3yc219196aa1249fd7@mail.gmail.com>
	<aa965aca5a5c34a7a4ba8cdcfa0d5054@dscpl.com.au>
	<b11ea23c0601141506q173c217at208b214f3ee9878d@mail.gmail.com>
Message-ID: <b11ea23c0601141926h2dd0d39eta6cfaa0d1e40986e@mail.gmail.com>

I just set my gentoo bash to 3.0-r14 (1), and mod_python installed nicely.

(1) "emerge =bash-3.0-r14"

Hopefully this will get fixed later.



On 1/14/06, Webb Sprague <webb.sprague@gmail.com> wrote:
> Someone filed a bug report:
>
> http://bugs.gentoo.org/show_bug.cgi?id=118948
>
> Thanks to Graham and all.
> W
>
> On 1/14/06, Graham Dumpleton <grahamd@dscpl.com.au> wrote:
> > Only suggestion I can give you to debug it is to run configure as:
> >
> >    sh -x ./configure --prefix=/usr/local/mod_python-3.1.4
> > --with-apxs=/usr/sbin/apxs2 > my.log 2>&1
> >
> > The -x option will cause what what the shell is doing at each point
> > to be displayed. Make sure you log the output to a file as there will
> > be a lot. This may or may not tell you what is happening.
> >
> > The quoted configure script snippet you give is the same as what works
> > on other platforms, so must be something strange to do with your user
> > environment, or what shell is linked as '/bin/sh'. You might even try:
> >
> >    bash -x ./configure --prefix=/usr/local/mod_python-3.1.4
> > --with-apxs=/usr/sbin/apxs2
> >
> > to see if it makes a difference.
> >
> > BTW, if you are using C Shell and not a Bourne Shell, you will need to
> > change how output send to log.
> >
> > Graham
> >
> > On 15/01/2006, at 6:17 AM, Webb Sprague wrote:
> >
> > > Hi all
> > >
> > > I am unable to compile mod_python on a gentoo machine (all updated,
> > > ~x86, etc), both using emerge and by hand, please help if you can...
> > > (Also, please email me directly as well as the list, if possible).
> > >
> > > Here is my configure command:
> > >
> > > ./configure --prefix=/usr/local/mod_python-3.1.4
> > > --with-apxs=/usr/sbin/apxs2
> > >
> > > Here is the error:
> > >
> > > <snip>
> > > checking where Python include files are... -I/usr/include/python2.4
> > > ./configure: line 2951: syntax error near unexpected token `('
> > > ./configure: line 2951: `as_me=`(basename "$0") 2>/dev/null ||'
> > >
> > > Here are my specs:
> > >
> > > mod_python version: 3.1.4, but same error on 3.2.5b and 3.1.3
> > > bash version: 3.1.5
> > > apache2 -V:
> > > Server version: Apache/2.0.55
> > > Server built:   Jan 12 2006 03:53:14
> > > Server's Module Magic Number: 20020903:11
> > > Architecture:   32-bit
> > > Server compiled with....
> > >  -D APACHE_MPM_DIR="server/mpm/prefork"
> > >  -D APR_HAS_SENDFILE
> > >  -D APR_HAS_MMAP
> > >  -D APR_HAVE_IPV6 (IPv4-mapped addresses enabled)
> > >  -D APR_USE_SYSVSEM_SERIALIZE
> > >  -D APR_USE_PTHREAD_SERIALIZE
> > >  -D SINGLE_LISTEN_UNSERIALIZED_ACCEPT
> > >  -D APR_HAS_OTHER_CHILD
> > >  -D AP_HAVE_RELIABLE_PIPED_LOGS
> > >  -D HTTPD_ROOT="/usr"
> > >  -D SUEXEC_BIN="/usr/sbin/suexec2"
> > >  -D DEFAULT_PIDLOG="/var/run/httpd.pid"
> > >  -D DEFAULT_SCOREBOARD="logs/apache_runtime_status"
> > >  -D DEFAULT_LOCKFILE="/var/run/accept.lock"
> > >  -D DEFAULT_ERRORLOG="logs/error_log"
> > >  -D AP_TYPES_CONFIG_FILE="/etc/apache2/mime.types"
> > >  -D SERVER_CONFIG_FILE="/etc/apache2/httpd.conf"
> > >
> > > Here is where I think the configure script goes south:
> > >
> > > # Name of the executable.
> > > as_me=`(basename "$0") 2>/dev/null ||                   ## This is
> > > line 2951
> > > $as_expr X/"$0" : '.*/\([^/][^/]*\)/*$' \| \
> > >          X"$0" : 'X\(//\)$' \| \
> > >          X"$0" : 'X\(/\)$' \| \
> > >          .     : '\(.\)' 2>/dev/null ||
> > > echo X/"$0" |
> > >     sed '/^.*\/\([^/][^/]*\)\/*$/{ s//\1/; q; }
> > >           /^X\/\(\/\/\)$/{ s//\1/; q; }
> > >           /^X\/\(\/\).*/{ s//\1/; q; }
> > >           s/.*/./; q'`
> > >
> > > Any help would be great, or I can file a bug report if someone tells
> > > me where.
> > >
> > > Thx
> > > W
> > >
> > > _______________________________________________
> > > Mod_python mailing list
> > > Mod_python@modpython.org
> > > http://mailman.modpython.org/mailman/listinfo/mod_python
> >
> >
>

From yjfuk at 126.com  Sun Jan 15 06:13:12 2006
From: yjfuk at 126.com (=?gb2312?B?eWpmdWs=?=)
Date: Sun Jan 15 06:13:56 2006
Subject: [mod_python] [SPAM] session lost
Message-ID: <43CA2E48.000061.09866@m66.126.com>

mod_python was installed under the windows.I had writed a program to learn session,but it didn't work well under the windows,the session is always lost.but when i run it under linux, it worked well. Does modpython not support windows well?I'm a beginer in mod_python.







-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20060115/909c0d51/attachment.html
From administrator at leebrown.org  Sun Jan 15 11:00:17 2006
From: administrator at leebrown.org (Lee Brown)
Date: Sun Jan 15 11:00:40 2006
Subject: [SPAM] [mod_python] [SPAM] session lost
In-Reply-To: <43CA2E48.000061.09866@m66.126.com>
Message-ID: <004f01c619ec$c76689c0$0301a8c0@uberbox>

Greetings!
 
I've been using mod_python under WinXP without any problems.  I think the
problem is more likely due to a difference in configuration between the two
platforms.  I suggest that you should first check these things:
 
1 - Verify that both platforms are running the same version of Apache.
2 - Verify that both platforms are running the same version of Python.
3 - Verify that both platforms are running the same version of Mod Python.
4 - Verify that both Apache installations are configured the same way.  Most
import, verify that they are both using the same kind of MPM module.
 
If these things check out, then the next thing to do would be to post a
sample of your handler code.

Best Regards,
Lee E. Brown
(administrator@leebrown.org)


 

  _____  

From: mod_python-bounces@modpython.org [mailto:mod_python-bounces@modpython.
org] On Behalf Of yjfuk
Sent: Sunday, January 15, 2006 6:13 AM
To: mod_python@modpython.org
Subject: [SPAM] [mod_python] [SPAM] session lost



mod_python was installed under the windows.I had writed a program to learn
session,but it didn't work well under the windows,the session is always
lost.but when i run it under linux, it worked well. Does modpython not
support windows well?I'm a beginer in mod_python.

















HI                      
   
<http://adclient.163.com/event.ng/Type=click&FlightID=46628&AdID=48547&Targe
tID=635&Segments=80,94,289,416&Targets=1758,92,635&Values=31,43,51,60,72,78,
82,91,100,110,150,312,330,332,457,499,586,615,702,733,734&RawValues=&Redirec
t=http://photo.163.com/> 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20060115/eefa65ad/attachment-0001.html
From dan.eloff at gmail.com  Sun Jan 15 17:32:10 2006
From: dan.eloff at gmail.com (Dan Eloff)
Date: Sun Jan 15 17:32:14 2006
Subject: [mod_python] Can't seem to get mod_python working, please help me
Message-ID: <4817b6fc0601151432j6072ad2bx30c50bed5e7d361e@mail.gmail.com>

I installed mod_python on my XP pro system with apache 2.0.55 and
python 2.4.2 I get an internal server error when trying to load any
.py

I added this to the bottom of my conifg file, and added the load
module statement as well.

<Directory />
        AddHandler mod_python .py
        PythonHandler mptest
        PythonDebug On
</Directory>

The module seems to be loading correctly. mod_python also seems to be
installed correctly, when I try and import mod_python from an
interpreter it says it can't find _apache.

The relevant lines from the log file are pasted below. The url I try
to access is localhost/test.py, which doesn't exist, but I don't think
that matters to mod_python, it will try to handle it anyway, but never
seems to get that far.

What are some things I should check or some things I can try to get it working?

Thanks,
-Dan

[Sun Jan 15 13:53:32 2006] [notice] Apache/2.0.55 (Win32)
mod_python/3.2.2b Python/2.4.2 PHP/5.1.1 configured -- resuming normal
operations
[Sun Jan 15 13:53:32 2006] [notice] Server built: Oct  9 2005 19:16:56
[Sun Jan 15 13:53:32 2006] [notice] Parent: Created child process 2716
[Sun Jan 15 13:53:32 2006] [notice] mod_python: Creating 8 session
mutexes based on 0 max processes and 10 max threads.
[Sun Jan 15 13:53:32 2006] [notice] Child 2716: Child process is running
[Sun Jan 15 13:53:32 2006] [notice] Child 2716: Acquired the start mutex.
[Sun Jan 15 13:53:32 2006] [notice] Child 2716: Starting 10 worker threads.
[Sun Jan 15 13:57:02 2006] [error] make_obcallback: could not import
mod_python.apache.\n
[Sun Jan 15 13:57:02 2006] [error] python_handler: no interpreter
callback found.
[Sun Jan 15 13:57:02 2006] [error] [client 127.0.0.1] python_handler:
Can't get/create interpreter.

From grahamd at dscpl.com.au  Sun Jan 15 17:46:57 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Sun Jan 15 17:47:00 2006
Subject: [mod_python] session lost
Message-ID: <1137365217.26825@dscpl.user.openhosting.com>

Lee Brown wrote ..
> Greetings!
>  
> I've been using mod_python under WinXP without any problems.  I think the
> problem is more likely due to a difference in configuration between the
> two
> platforms.  I suggest that you should first check these things:
>  
> 1 - Verify that both platforms are running the same version of Apache.
> 2 - Verify that both platforms are running the same version of Python.
> 3 - Verify that both platforms are running the same version of Mod Python.
> 4 - Verify that both Apache installations are configured the same way.
> Most
> import, verify that they are both using the same kind of MPM module.

It isn't actually possible to run the same MPM module for Apache as on
Win32 it uses the "winnt" MPM module and on UNIX, your main choices
are "prefork" and "worker".

Although both "winnt" and "worker" support multithreading, with "worker"
you can still have multiple child processes where as with "winnt" you only
have the one.

This distinction is important, as it dictates what the default session database
implementation used is.

        if (threaded and ((not forked) or (daemons == 1))):
            sess_type = 'MemorySession'
        else:
            sess_type = 'DbmSession'

Thus, default on "winnt" which is thread and not forked, is "MemorySession".
With "worker", unless fixed to only use one child process, it will be "DbmSession".
The "prefork" MPM will also use "DbmSession" as default.

Generally the "MemorySession" support on Win32 works fine, as it doesn't rely
on a filesystem based database, thus hard for it to be stuffed, unless someone
had specifically configure mod_python to always use "DbmSession" or some
other session database type.

> From: mod_python-bounces@modpython.org [mailto:mod_python-bounces@modpython.
> org] On Behalf Of yjfuk
> 
> mod_python was installed under the windows.I had writed a program to learn
> session,but it didn't work well under the windows,the session is always
> lost.but when i run it under linux, it worked well. Does modpython not
> support windows well?I'm a beginer in mod_python.

If the original poster could define what they actually mean by "session is always
lost" that would help. As would minimal handler code which exhibits problem.
Finally, is the same browser being used in both cases.

In respect of session being lost, is it that the immediately following page access
requires login again, or that after 30 minutes it requires login again even though
there were intermediate page accesses.

BTW, since mod_python 3.2.6b is now out, I would strongly recommend an
upgrade to that version to eliminate it being a problem which has since been
fixed already.


Graham
From grahamd at dscpl.com.au  Sun Jan 15 17:58:01 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Sun Jan 15 17:58:05 2006
Subject: [mod_python] Can't seem to get mod_python working, please help me
Message-ID: <1137365881.3982@dscpl.user.openhosting.com>

I am not a Win32 person, others are and will probably give better answers,
but... what user is Apache running as. Does that user have access to the
Python runtime installation. The errors suggest it doesn't have access, or
is looking in a different location. 

Dan Eloff wrote ..
> I added this to the bottom of my conifg file, and added the load
> module statement as well.
> 
> <Directory />
>         AddHandler mod_python .py
>         PythonHandler mptest
>         PythonDebug On
> </Directory>

As a side note, specifying that everything under '/' slash should have
mod_python applied to it is probably not the best way to go. You should
consider being more specific than that and only specify the particular
directories under your document tree or elsewhere you want it to apply.

BTW, for getting mod_python working first time, you might also want
to see:

  http://www.dscpl.com.au/articles/modpython-001.html

You can also see past mailing list discussions about your make_obcallback
problem using search on mod_python site:

  http://www.google.com/search?q=windows+make_obcallback&q=site%3Awww.modpython.org

Prior suggestions may help in your case.

Graham
From administrator at leebrown.org  Sun Jan 15 18:01:30 2006
From: administrator at leebrown.org (Lee Brown)
Date: Sun Jan 15 18:01:51 2006
Subject: [mod_python] session lost
In-Reply-To: <1137365217.26825@dscpl.user.openhosting.com>
Message-ID: <005f01c61a27$9f6e71e0$0301a8c0@uberbox>

Greetings!

Ah!  Thanks for the pointer.  Somehow, I had it in my head that the winnt
MPM and the worker MPM were essentially equal.  Now I see why it makes a
difference as far as mod_python is concerned.

Best Regards,
Lee E. Brown
(administrator@leebrown.org)

-----Original Message-----
From: mod_python-bounces@modpython.org
[mailto:mod_python-bounces@modpython.org] On Behalf Of Graham Dumpleton
Sent: Sunday, January 15, 2006 5:47 PM
To: mod_python@modpython.org
Subject: RE: [mod_python] session lost

...Thus, default on "winnt" which is thread and not forked, is
"MemorySession".
With "worker", unless fixed to only use one child process, it will be
"DbmSession".
The "prefork" MPM will also use "DbmSession" as default....



From grahamd at dscpl.com.au  Sun Jan 15 18:06:56 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Sun Jan 15 18:06:59 2006
Subject: [mod_python] session lost
Message-ID: <1137366416.11590@dscpl.user.openhosting.com>

Lee Brown wrote ..
> Greetings!
> 
> Ah!  Thanks for the pointer.  Somehow, I had it in my head that the winnt
> MPM and the worker MPM were essentially equal.  Now I see why it makes
> a difference as far as mod_python is concerned.

Another area where it matters and where it usually shows as an issue is
that in "winnt" MPM, global module data is truly global to all handlers
in that interpreter and can be relied upon. In "worker", the fact that
there can be multiple child processes means that global data isn't
global in the sense that other child processes will have their own copy. This
is sometimes an issue where people have written handler code on Windows,
relying on global data being the same for all handlers, but then find it
isn't when they move to a Linux based system.

Graham
From administrator at leebrown.org  Sun Jan 15 19:02:40 2006
From: administrator at leebrown.org (Lee Brown)
Date: Sun Jan 15 19:03:23 2006
Subject: [mod_python] Can't seem to get mod_python working, please help me
In-Reply-To: <4817b6fc0601151432j6072ad2bx30c50bed5e7d361e@mail.gmail.com>
Message-ID: <006101c61a30$2b2c3e30$0301a8c0@uberbox>

Greetings!

I think Graham is right; you could have either a path problem or a
user/permission problem.

First, make sure that both the directory for the python interpreter and the
directory where mod_python was installed are available in the PATH
environment variable.  Open a new command prompt window in whatever
directory your mptest.py resides and execute "python mptest.py"  If your
PATH is set correctly, you will get the "No module named _apache" error.  If
you get "No module named mod_python" then the interpreter path is fine, but
you need to put mod_python.py where the interpreter can find it.

Next, temporarily set the permissions on the Python root directory to grant
full control to everyone.  Restart your Apache server and see if that fixes
the problem.  If it does, set the permissions of the Python root directory
to grant full control to whatever user the Apache process is running as.

If none of this helps, give us a holler back and let us know what happened.

Best Regards,
Lee E. Brown
(administrator@leebrown.org)

-----Original Message-----
From: mod_python-bounces@modpython.org
[mailto:mod_python-bounces@modpython.org] On Behalf Of Dan Eloff
Sent: Sunday, January 15, 2006 5:32 PM
To: mod_python@modpython.org
Subject: [mod_python] Can't seem to get mod_python working, please help me

I installed mod_python on my XP pro system with apache 2.0.55 and python
2.4.2 I get an internal server error when trying to load any .py

I added this to the bottom of my conifg file, and added the load module
statement as well.

<Directory />
        AddHandler mod_python .py
        PythonHandler mptest
        PythonDebug On
</Directory>

The module seems to be loading correctly. mod_python also seems to be
installed correctly, when I try and import mod_python from an interpreter it
says it can't find _apache.

The relevant lines from the log file are pasted below. The url I try to
access is localhost/test.py, which doesn't exist, but I don't think that
matters to mod_python, it will try to handle it anyway, but never seems to
get that far.

What are some things I should check or some things I can try to get it
working?

Thanks,
-Dan

[Sun Jan 15 13:53:32 2006] [notice] Apache/2.0.55 (Win32) mod_python/3.2.2b
Python/2.4.2 PHP/5.1.1 configured -- resuming normal operations [Sun Jan 15
13:53:32 2006] [notice] Server built: Oct  9 2005 19:16:56 [Sun Jan 15
13:53:32 2006] [notice] Parent: Created child process 2716 [Sun Jan 15
13:53:32 2006] [notice] mod_python: Creating 8 session mutexes based on 0
max processes and 10 max threads.
[Sun Jan 15 13:53:32 2006] [notice] Child 2716: Child process is running
[Sun Jan 15 13:53:32 2006] [notice] Child 2716: Acquired the start mutex.
[Sun Jan 15 13:53:32 2006] [notice] Child 2716: Starting 10 worker threads.
[Sun Jan 15 13:57:02 2006] [error] make_obcallback: could not import
mod_python.apache.\n [Sun Jan 15 13:57:02 2006] [error] python_handler: no
interpreter callback found.
[Sun Jan 15 13:57:02 2006] [error] [client 127.0.0.1] python_handler:
Can't get/create interpreter.

_______________________________________________
Mod_python mailing list
Mod_python@modpython.org
http://mailman.modpython.org/mailman/listinfo/mod_python

From dan.eloff at gmail.com  Sun Jan 15 20:23:07 2006
From: dan.eloff at gmail.com (Dan Eloff)
Date: Sun Jan 15 20:23:10 2006
Subject: [mod_python] Can't seem to get mod_python working, please help me
In-Reply-To: <006101c61a30$2b2c3e30$0301a8c0@uberbox>
References: <4817b6fc0601151432j6072ad2bx30c50bed5e7d361e@mail.gmail.com>
	<006101c61a30$2b2c3e30$0301a8c0@uberbox>
Message-ID: <4817b6fc0601151723p71ff67bcme15efee0e41a6a04@mail.gmail.com>

Ok I tried your suggestions, but I get the "No module named _apache"
error. I modified the path earlier to add the python directory, which
enabled the module to load (previously it couldn't find python24.dll)
I added the site-packages directory as well, but no effect. I don't
know how to change the permissions, but I installed apache as the user
I am now, and there are only two users on this computer, both with
full admin priveledges. Besides which apache loads php just fine (I
also commented the lines regarding php out but it had no effect)

I also started up the interpreter and checked sys.path, it had a lot
of entries in there, including of course the site-packages directory
and the htdocs directory.

I'm rather baffled now as to why it won't work.

Thanks,
-Dan

On 1/15/06, Lee Brown <administrator@leebrown.org> wrote:
> Greetings!
>
> I think Graham is right; you could have either a path problem or a
> user/permission problem.
>
> First, make sure that both the directory for the python interpreter and the
> directory where mod_python was installed are available in the PATH
> environment variable.  Open a new command prompt window in whatever
> directory your mptest.py resides and execute "python mptest.py"  If your
> PATH is set correctly, you will get the "No module named _apache" error.  If
> you get "No module named mod_python" then the interpreter path is fine, but
> you need to put mod_python.py where the interpreter can find it.
>
> Next, temporarily set the permissions on the Python root directory to grant
> full control to everyone.  Restart your Apache server and see if that fixes
> the problem.  If it does, set the permissions of the Python root directory
> to grant full control to whatever user the Apache process is running as.
>
> If none of this helps, give us a holler back and let us know what happened.
>
> Best Regards,
> Lee E. Brown
> (administrator@leebrown.org)
>
> -----Original Message-----
> From: mod_python-bounces@modpython.org
> [mailto:mod_python-bounces@modpython.org] On Behalf Of Dan Eloff
> Sent: Sunday, January 15, 2006 5:32 PM
> To: mod_python@modpython.org
> Subject: [mod_python] Can't seem to get mod_python working, please help me
>
> I installed mod_python on my XP pro system with apache 2.0.55 and python
> 2.4.2 I get an internal server error when trying to load any .py
>
> I added this to the bottom of my conifg file, and added the load module
> statement as well.
>
> <Directory />
>         AddHandler mod_python .py
>         PythonHandler mptest
>         PythonDebug On
> </Directory>
>
> The module seems to be loading correctly. mod_python also seems to be
> installed correctly, when I try and import mod_python from an interpreter it
> says it can't find _apache.
>
> The relevant lines from the log file are pasted below. The url I try to
> access is localhost/test.py, which doesn't exist, but I don't think that
> matters to mod_python, it will try to handle it anyway, but never seems to
> get that far.
>
> What are some things I should check or some things I can try to get it
> working?
>
> Thanks,
> -Dan
>
> [Sun Jan 15 13:53:32 2006] [notice] Apache/2.0.55 (Win32) mod_python/3.2.2b
> Python/2.4.2 PHP/5.1.1 configured -- resuming normal operations [Sun Jan 15
> 13:53:32 2006] [notice] Server built: Oct  9 2005 19:16:56 [Sun Jan 15
> 13:53:32 2006] [notice] Parent: Created child process 2716 [Sun Jan 15
> 13:53:32 2006] [notice] mod_python: Creating 8 session mutexes based on 0
> max processes and 10 max threads.
> [Sun Jan 15 13:53:32 2006] [notice] Child 2716: Child process is running
> [Sun Jan 15 13:53:32 2006] [notice] Child 2716: Acquired the start mutex.
> [Sun Jan 15 13:53:32 2006] [notice] Child 2716: Starting 10 worker threads.
> [Sun Jan 15 13:57:02 2006] [error] make_obcallback: could not import
> mod_python.apache.\n [Sun Jan 15 13:57:02 2006] [error] python_handler: no
> interpreter callback found.
> [Sun Jan 15 13:57:02 2006] [error] [client 127.0.0.1] python_handler:
> Can't get/create interpreter.
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
>

From grahamd at dscpl.com.au  Sun Jan 15 20:56:39 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Sun Jan 15 20:56:41 2006
Subject: [mod_python] Can't seem to get mod_python working, please help me
Message-ID: <1137376599.16414@dscpl.user.openhosting.com>

Dan Eloff wrote ..
> Ok I tried your suggestions, but I get the "No module named _apache"
> error.

Which is exactly what you do want for when you run Python outside of
Apache and try to load mod_python. Highlighting what Lee said:

  If your PATH is set correctly, you will get the "No module named _apache" error.

The reason is that the "_apache" module is a special dynamically loaded
module which is only imported into Python when the mod_python.dll is
loaded within the context of Apache.

Thus from the command line Python it will never find "_apache". What it
at least shows though is that the mod_python package installed into the
Python installation was found.

So it is back to why when mod_python.dll is loaded into Apache that it
can not find the mod_python package which is installed into the Python
installation.

Again, we get back to my lack of knowledge of Win32 systems. :-(

BTW, I think for 3.3, we really better add some stuff in mod_python
whereby when this sort of problem occurs, we dump all sorts of info
out about what Python is being used, what sys.path is used etc. Would
make thinks a lot easier as far as seeing what is wrong.

Graham

> I modified the path earlier to add the python directory, which
> enabled the module to load (previously it couldn't find python24.dll)
> I added the site-packages directory as well, but no effect. I don't
> know how to change the permissions, but I installed apache as the user
> I am now, and there are only two users on this computer, both with
> full admin priveledges. Besides which apache loads php just fine (I
> also commented the lines regarding php out but it had no effect)
> 
> I also started up the interpreter and checked sys.path, it had a lot
> of entries in there, including of course the site-packages directory
> and the htdocs directory.
> 
> I'm rather baffled now as to why it won't work.
> 
> Thanks,
> -Dan
> 
> On 1/15/06, Lee Brown <administrator@leebrown.org> wrote:
> > Greetings!
> >
> > I think Graham is right; you could have either a path problem or a
> > user/permission problem.
> >
> > First, make sure that both the directory for the python interpreter and
> the
> > directory where mod_python was installed are available in the PATH
> > environment variable.  Open a new command prompt window in whatever
> > directory your mptest.py resides and execute "python mptest.py"  If your
> > PATH is set correctly, you will get the "No module named _apache" error.
> If
> > you get "No module named mod_python" then the interpreter path is fine,
> but
> > you need to put mod_python.py where the interpreter can find it.
> >
> > Next, temporarily set the permissions on the Python root directory to
> grant
> > full control to everyone.  Restart your Apache server and see if that
> fixes
> > the problem.  If it does, set the permissions of the Python root directory
> > to grant full control to whatever user the Apache process is running
> as.
> >
> > If none of this helps, give us a holler back and let us know what happened.
> >
> > Best Regards,
> > Lee E. Brown
> > (administrator@leebrown.org)
> >
> > -----Original Message-----
> > From: mod_python-bounces@modpython.org
> > [mailto:mod_python-bounces@modpython.org] On Behalf Of Dan Eloff
> > Sent: Sunday, January 15, 2006 5:32 PM
> > To: mod_python@modpython.org
> > Subject: [mod_python] Can't seem to get mod_python working, please help
> me
> >
> > I installed mod_python on my XP pro system with apache 2.0.55 and python
> > 2.4.2 I get an internal server error when trying to load any .py
> >
> > I added this to the bottom of my conifg file, and added the load module
> > statement as well.
> >
> > <Directory />
> >         AddHandler mod_python .py
> >         PythonHandler mptest
> >         PythonDebug On
> > </Directory>
> >
> > The module seems to be loading correctly. mod_python also seems to be
> > installed correctly, when I try and import mod_python from an interpreter
> it
> > says it can't find _apache.
> >
> > The relevant lines from the log file are pasted below. The url I try
> to
> > access is localhost/test.py, which doesn't exist, but I don't think that
> > matters to mod_python, it will try to handle it anyway, but never seems
> to
> > get that far.
> >
> > What are some things I should check or some things I can try to get it
> > working?
> >
> > Thanks,
> > -Dan
> >
> > [Sun Jan 15 13:53:32 2006] [notice] Apache/2.0.55 (Win32) mod_python/3.2.2b
> > Python/2.4.2 PHP/5.1.1 configured -- resuming normal operations [Sun
> Jan 15
> > 13:53:32 2006] [notice] Server built: Oct  9 2005 19:16:56 [Sun Jan 15
> > 13:53:32 2006] [notice] Parent: Created child process 2716 [Sun Jan 15
> > 13:53:32 2006] [notice] mod_python: Creating 8 session mutexes based
> on 0
> > max processes and 10 max threads.
> > [Sun Jan 15 13:53:32 2006] [notice] Child 2716: Child process is running
> > [Sun Jan 15 13:53:32 2006] [notice] Child 2716: Acquired the start mutex.
> > [Sun Jan 15 13:53:32 2006] [notice] Child 2716: Starting 10 worker threads.
> > [Sun Jan 15 13:57:02 2006] [error] make_obcallback: could not import
> > mod_python.apache.\n [Sun Jan 15 13:57:02 2006] [error] python_handler:
> no
> > interpreter callback found.
> > [Sun Jan 15 13:57:02 2006] [error] [client 127.0.0.1] python_handler:
> > Can't get/create interpreter.
> >
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://mailman.modpython.org/mailman/listinfo/mod_python
> >
> >
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
From estrand at isomedia.com  Sun Jan 15 20:59:28 2006
From: estrand at isomedia.com (Eric Strand)
Date: Sun Jan 15 20:59:41 2006
Subject: [mod_python] PSP Handler - related alternatives?
Message-ID: <43CAFE00.5020808@isomedia.com>

Hello,

I'm looking for a little advice from fellow mod_python users who use the 
PSP handler.

I'm using the PSP Handler, not so much to embed Python code within HTML, 
but to use the handler's feature of relating a URL to a specific file, 
and also its caching behavior so that an apache restart is not required 
when I edit a .psp file.

Most of my pages do not contain HTML what-so-ever, so the step of 
parsing a .psp file effectively just strips the enclosing <% and %> tags 
from around my Python code.  Though this happens only once per 
interpreter due to caching, it still seems inefficient to me.

I poked around the psp.py file and altered the PSP.load_from_file() 
function so that the source is read directly from a psp file, instead of 
returned from the parsing step.  This, and removing the <% %> tags from 
my PSP files, results in the same behavior as the original PSP.

Though this works just fine, I am not really using the PSP handler for 
it's intended use.  So I wonder whether there might be better techniques 
out there.  Primarily I just want to relate a URL to a file of python 
code used to generate a page.  Any comments are appreciated!

Thanks,
Eric
From grahamd at dscpl.com.au  Sun Jan 15 22:41:24 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Sun Jan 15 22:41:29 2006
Subject: [mod_python] PSP Handler - related alternatives?
Message-ID: <1137382884.17326@dscpl.user.openhosting.com>

Eric Strand wrote ..
> Though this works just fine, I am not really using the PSP handler for
> it's intended use.  So I wonder whether there might be better techniques
> out there.  Primarily I just want to relate a URL to a file of python 
> code used to generate a page.  Any comments are appreciated!

There are a few alternatives.

First is to use mod_python.publisher. It effectively implements two
levels of URL mapping. At the first level, the leading portion of a URL
is mapped to a file containing your Python code. Thus, if you were using
AddHandler with the .py extension to trigger mod_python.publisher, and
it was enabled from the root of the document tree, a URL of "/file.py"
would target an actual file called "file.py" in your document tree. The
"index()" method in that file would then be called.

Note though that the functions mapped to by mod_python.publisher are not
written exactly as basic mod_python handlers. The main difference you
need to know is that the result of the function is what is translated
into the page content. The mod_python documentation covers the
differences.

The second level of URL mapping that mod_python.publisher implements
takes what appears after the port of the URL that targetted the file, and
maps that against functions/objects contained in the file. Thus if you URL
was "/file.py/index" it would also target the "index()" function. This just
happens to be the same as the default when on object identifier part
exists in the URL. Another example would be "/file.py/form". In this case
it would expect a function called "form()" to be present in the file and it
would call that instead.

If there are object instances present in the file, it can also traverse their
structure and call a member function of an object instance. If for example
you had an object of type "Database" and you an instance of it created and
named as the variable "database", with the class having a member function
called "drop()", you could use a URL "/file.py/database/drop" to access it.

The mod_python.publisher module is  a part of mod_python. For anything
else you need to explore outside of the core mod_python package. Two
worth considering are mpservlets and Vampire. Both provides multiple levels
of URL mapping through file to objects inside etc. In mpservlets it is your
traditional servlet based type system. In Vampire more traditional basic
mod_python handler calling mechanism is used.

Hope this helps.

Graham
From preppiepjh at gmail.com  Mon Jan 16 02:49:37 2006
From: preppiepjh at gmail.com (JungHoonPark)
Date: Mon Jan 16 02:49:42 2006
Subject: [mod_python]install error with apache2.2.0 In FreeBSD5.4
Message-ID: <2add78400601152349m4829395ai@mail.gmail.com>

Hello^^

I'm a beginner in using mod_python.

I'd like to use mod_python3.1.4 with apache2.2.0, so install using
ports collection in FreeBSD5.4

But, some error occurs.
I already installed python2.4.2.

Error is below.
------------------------------------------------------------------------------------------------------------------
Compiling for DSO.

/usr/local/sbin/apxs
-I/usr/ports/www/mod_python3/work/mod_python-3.1.4/src/include
-I/usr/local/include/apache22 -I/usr/local/include/python2.4 -c
mod_python.c _apachemodule.c requestobject.c tableobject.c util.c
serverobject.c connobject.c filterobject.c hlist.c hlistobject.c
-L/usr/local/lib/python2.4/config  -Wl,--export-dynamic -lm
-lpython2.4 -lutil -lstdc++ -lm
/usr/local/build-1/libtool --silent --mode=compile cc -prefer-pic -O
-pipe    -I/usr/local/include/apache22  -I/usr/local/include/apr-1
-I/usr/local/include/apr-1 -I/usr/local/include
-I/usr/ports/www/mod_python3/work/mod_python-3.1.4/src/include
-I/usr/local/include/apache22 -I/usr/local/include/python2.4  -c -o
mod_python.lo mod_python.c && touch mod_python.slo
libtool: compile: unable to infer tagged configuration
libtool: compile: specify a tag with `--tag'
apxs:Error: Command failed with rc=65536
----------------------------------------------------------------------------------------------------------------------

I don't know what is wrong... :(

From grahamd at dscpl.com.au  Mon Jan 16 04:21:43 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Mon Jan 16 04:21:55 2006
Subject: [mod_python]install error with apache2.2.0 In FreeBSD5.4
In-Reply-To: <2add78400601152349m4829395ai@mail.gmail.com>
References: <2add78400601152349m4829395ai@mail.gmail.com>
Message-ID: <17144AF0-AC15-4EF7-A6F4-B3646809A0CD@dscpl.com.au>

It should have got further than that, but the short story is that  
Apache 2.2 is
not current supported. You will need to use Apache 2.0. If you get  
the same
problem as below with Apache 2.0 then get back to us. Details about 2.2
incompatibilities can be viewed at:

   http://issues.apache.org/jira/browse/MODPYTHON-78

Graham

On 16/01/2006, at 6:49 PM, JungHoonPark wrote:

> Hello^^
>
> I'm a beginner in using mod_python.
>
> I'd like to use mod_python3.1.4 with apache2.2.0, so install using
> ports collection in FreeBSD5.4
>
> But, some error occurs.
> I already installed python2.4.2.
>
> Error is below.
> ---------------------------------------------------------------------- 
> --------------------------------------------
> Compiling for DSO.
>
> /usr/local/sbin/apxs
> -I/usr/ports/www/mod_python3/work/mod_python-3.1.4/src/include
> -I/usr/local/include/apache22 -I/usr/local/include/python2.4 -c
> mod_python.c _apachemodule.c requestobject.c tableobject.c util.c
> serverobject.c connobject.c filterobject.c hlist.c hlistobject.c
> -L/usr/local/lib/python2.4/config  -Wl,--export-dynamic -lm
> -lpython2.4 -lutil -lstdc++ -lm
> /usr/local/build-1/libtool --silent --mode=compile cc -prefer-pic -O
> -pipe    -I/usr/local/include/apache22  -I/usr/local/include/apr-1
> -I/usr/local/include/apr-1 -I/usr/local/include
> -I/usr/ports/www/mod_python3/work/mod_python-3.1.4/src/include
> -I/usr/local/include/apache22 -I/usr/local/include/python2.4  -c -o
> mod_python.lo mod_python.c && touch mod_python.slo
> libtool: compile: unable to infer tagged configuration
> libtool: compile: specify a tag with `--tag'
> apxs:Error: Command failed with rc=65536
> ---------------------------------------------------------------------- 
> ------------------------------------------------
>
> I don't know what is wrong... :(
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python

From administrator at leebrown.org  Mon Jan 16 08:58:23 2006
From: administrator at leebrown.org (Lee Brown)
Date: Mon Jan 16 08:59:00 2006
Subject: [mod_python] Can't seem to get mod_python working, please help me
In-Reply-To: <4817b6fc0601151723p71ff67bcme15efee0e41a6a04@mail.gmail.com>
Message-ID: <006901c61aa4$ea75b860$0301a8c0@uberbox>

Greetings!

Actually, we're doing pretty good; we know that the path is correct and that
mod_python is accessible.

Next, make sure that Apache is running and then start a python interpreter
shell.  Open Task Manager, go to the Processes tab, and see under which user
credentials apache.exe and python.exe are running.

Best Regards,
Lee E. Brown
(administrator@leebrown.org)

-----Original Message-----
From: mod_python-bounces@modpython.org
[mailto:mod_python-bounces@modpython.org] On Behalf Of Dan Eloff
Sent: Sunday, January 15, 2006 8:23 PM
To: mod_python@modpython.org
Subject: Re: [mod_python] Can't seem to get mod_python working, please help
me

Ok I tried your suggestions, but I get the "No module named _apache"
error. I modified the path earlier to add the python directory, which
enabled the module to load (previously it couldn't find python24.dll) I
added the site-packages directory as well, but no effect. I don't know how
to change the permissions, but I installed apache as the user I am now, and
there are only two users on this computer, both with full admin priveledges.
Besides which apache loads php just fine (I also commented the lines
regarding php out but it had no effect)

I also started up the interpreter and checked sys.path, it had a lot of
entries in there, including of course the site-packages directory and the
htdocs directory.

I'm rather baffled now as to why it won't work.

Thanks,
-Dan

On 1/15/06, Lee Brown <administrator@leebrown.org> wrote:
> Greetings!
>
> I think Graham is right; you could have either a path problem or a 
> user/permission problem.
>
> First, make sure that both the directory for the python interpreter 
> and the directory where mod_python was installed are available in the 
> PATH environment variable.  Open a new command prompt window in 
> whatever directory your mptest.py resides and execute "python 
> mptest.py"  If your PATH is set correctly, you will get the "No module 
> named _apache" error.  If you get "No module named mod_python" then 
> the interpreter path is fine, but you need to put mod_python.py where the
interpreter can find it.
>
> Next, temporarily set the permissions on the Python root directory to 
> grant full control to everyone.  Restart your Apache server and see if 
> that fixes the problem.  If it does, set the permissions of the Python 
> root directory to grant full control to whatever user the Apache process
is running as.
>
> If none of this helps, give us a holler back and let us know what
happened.
>
> Best Regards,
> Lee E. Brown
> (administrator@leebrown.org)
>
> -----Original Message-----
> From: mod_python-bounces@modpython.org 
> [mailto:mod_python-bounces@modpython.org] On Behalf Of Dan Eloff
> Sent: Sunday, January 15, 2006 5:32 PM
> To: mod_python@modpython.org
> Subject: [mod_python] Can't seem to get mod_python working, please 
> help me
>
> I installed mod_python on my XP pro system with apache 2.0.55 and 
> python
> 2.4.2 I get an internal server error when trying to load any .py
>
> I added this to the bottom of my conifg file, and added the load 
> module statement as well.
>
> <Directory />
>         AddHandler mod_python .py
>         PythonHandler mptest
>         PythonDebug On
> </Directory>
>
> The module seems to be loading correctly. mod_python also seems to be 
> installed correctly, when I try and import mod_python from an 
> interpreter it says it can't find _apache.
>
> The relevant lines from the log file are pasted below. The url I try 
> to access is localhost/test.py, which doesn't exist, but I don't think 
> that matters to mod_python, it will try to handle it anyway, but never 
> seems to get that far.
>
> What are some things I should check or some things I can try to get it 
> working?
>
> Thanks,
> -Dan
>
> [Sun Jan 15 13:53:32 2006] [notice] Apache/2.0.55 (Win32) 
> mod_python/3.2.2b
> Python/2.4.2 PHP/5.1.1 configured -- resuming normal operations [Sun 
> Jan 15
> 13:53:32 2006] [notice] Server built: Oct  9 2005 19:16:56 [Sun Jan 15
> 13:53:32 2006] [notice] Parent: Created child process 2716 [Sun Jan 15
> 13:53:32 2006] [notice] mod_python: Creating 8 session mutexes based 
> on 0 max processes and 10 max threads.
> [Sun Jan 15 13:53:32 2006] [notice] Child 2716: Child process is 
> running [Sun Jan 15 13:53:32 2006] [notice] Child 2716: Acquired the start
mutex.
> [Sun Jan 15 13:53:32 2006] [notice] Child 2716: Starting 10 worker
threads.
> [Sun Jan 15 13:57:02 2006] [error] make_obcallback: could not import 
> mod_python.apache.\n [Sun Jan 15 13:57:02 2006] [error] 
> python_handler: no interpreter callback found.
> [Sun Jan 15 13:57:02 2006] [error] [client 127.0.0.1] python_handler:
> Can't get/create interpreter.
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
>

_______________________________________________
Mod_python mailing list
Mod_python@modpython.org
http://mailman.modpython.org/mailman/listinfo/mod_python

From dan.eloff at gmail.com  Mon Jan 16 13:14:46 2006
From: dan.eloff at gmail.com (Dan Eloff)
Date: Mon Jan 16 13:14:49 2006
Subject: [mod_python] Can't seem to get mod_python working, please help me
In-Reply-To: <006901c61aa4$ea75b860$0301a8c0@uberbox>
References: <4817b6fc0601151723p71ff67bcme15efee0e41a6a04@mail.gmail.com>
	<006901c61aa4$ea75b860$0301a8c0@uberbox>
Message-ID: <4817b6fc0601161014t687be95ci546c9f1b3ecbf358@mail.gmail.com>

Ok apache is running with SYSTEM credentials, the same as a bunch of
other services I recognize in there, including MySQL. Python is
running as Wiley Coyote (my username.)

Does that tell us anything?

This is my python path:

>>> sys.path
['', 'C:\\Program Files\\Python\\python24.zip',
'C:\\Documents and Settings\\Wily Coyote\\My Documents\\HTDOCS',
'C:\\Program Files\\Python\\DLLs', 'C:\\Program Files\\Python\\lib',
'C:\\Program Files\\Python\\lib\\plat-win', 'C:\\Program
Files\\Python\\lib\\lib-tk',
'C:\\Program Files\\Python', 'C:\\Program Files\\Python\\lib\\site-packages']

This is my path environment variable:

%SystemRoot%\system32;%SystemRoot%;%SystemRoot%\System32\Wbem;
C:\Program Files\ATI Technologies\ATI Control Panel;C:\Program
Files\ATI Technologies\ATI.ACE\;C:\Program Files\QuickTime\QTSystem\;
C:\Program Files\Common Files\Adobe\AGL;
C:\Program Files\ActiveState Komodo 3.1\;
C:\Program Files\Python;C:\Program Files\Python\Lib\site-packages

-Dan

On 1/16/06, Lee Brown <administrator@leebrown.org> wrote:
> Greetings!
>
> Actually, we're doing pretty good; we know that the path is correct and that
> mod_python is accessible.
>
> Next, make sure that Apache is running and then start a python interpreter
> shell.  Open Task Manager, go to the Processes tab, and see under which user
> credentials apache.exe and python.exe are running.
>
> Best Regards,
> Lee E. Brown
> (administrator@leebrown.org)
>
> -----Original Message-----
> From: mod_python-bounces@modpython.org
> [mailto:mod_python-bounces@modpython.org] On Behalf Of Dan Eloff
> Sent: Sunday, January 15, 2006 8:23 PM
> To: mod_python@modpython.org
> Subject: Re: [mod_python] Can't seem to get mod_python working, please help
> me
>
> Ok I tried your suggestions, but I get the "No module named _apache"
> error. I modified the path earlier to add the python directory, which
> enabled the module to load (previously it couldn't find python24.dll) I
> added the site-packages directory as well, but no effect. I don't know how
> to change the permissions, but I installed apache as the user I am now, and
> there are only two users on this computer, both with full admin priveledges.
> Besides which apache loads php just fine (I also commented the lines
> regarding php out but it had no effect)
>
> I also started up the interpreter and checked sys.path, it had a lot of
> entries in there, including of course the site-packages directory and the
> htdocs directory.
>
> I'm rather baffled now as to why it won't work.
>
> Thanks,
> -Dan
>
> On 1/15/06, Lee Brown <administrator@leebrown.org> wrote:
> > Greetings!
> >
> > I think Graham is right; you could have either a path problem or a
> > user/permission problem.
> >
> > First, make sure that both the directory for the python interpreter
> > and the directory where mod_python was installed are available in the
> > PATH environment variable.  Open a new command prompt window in
> > whatever directory your mptest.py resides and execute "python
> > mptest.py"  If your PATH is set correctly, you will get the "No module
> > named _apache" error.  If you get "No module named mod_python" then
> > the interpreter path is fine, but you need to put mod_python.py where the
> interpreter can find it.
> >
> > Next, temporarily set the permissions on the Python root directory to
> > grant full control to everyone.  Restart your Apache server and see if
> > that fixes the problem.  If it does, set the permissions of the Python
> > root directory to grant full control to whatever user the Apache process
> is running as.
> >
> > If none of this helps, give us a holler back and let us know what
> happened.
> >
> > Best Regards,
> > Lee E. Brown
> > (administrator@leebrown.org)
> >
> > -----Original Message-----
> > From: mod_python-bounces@modpython.org
> > [mailto:mod_python-bounces@modpython.org] On Behalf Of Dan Eloff
> > Sent: Sunday, January 15, 2006 5:32 PM
> > To: mod_python@modpython.org
> > Subject: [mod_python] Can't seem to get mod_python working, please
> > help me
> >
> > I installed mod_python on my XP pro system with apache 2.0.55 and
> > python
> > 2.4.2 I get an internal server error when trying to load any .py
> >
> > I added this to the bottom of my conifg file, and added the load
> > module statement as well.
> >
> > <Directory />
> >         AddHandler mod_python .py
> >         PythonHandler mptest
> >         PythonDebug On
> > </Directory>
> >
> > The module seems to be loading correctly. mod_python also seems to be
> > installed correctly, when I try and import mod_python from an
> > interpreter it says it can't find _apache.
> >
> > The relevant lines from the log file are pasted below. The url I try
> > to access is localhost/test.py, which doesn't exist, but I don't think
> > that matters to mod_python, it will try to handle it anyway, but never
> > seems to get that far.
> >
> > What are some things I should check or some things I can try to get it
> > working?
> >
> > Thanks,
> > -Dan
> >
> > [Sun Jan 15 13:53:32 2006] [notice] Apache/2.0.55 (Win32)
> > mod_python/3.2.2b
> > Python/2.4.2 PHP/5.1.1 configured -- resuming normal operations [Sun
> > Jan 15
> > 13:53:32 2006] [notice] Server built: Oct  9 2005 19:16:56 [Sun Jan 15
> > 13:53:32 2006] [notice] Parent: Created child process 2716 [Sun Jan 15
> > 13:53:32 2006] [notice] mod_python: Creating 8 session mutexes based
> > on 0 max processes and 10 max threads.
> > [Sun Jan 15 13:53:32 2006] [notice] Child 2716: Child process is
> > running [Sun Jan 15 13:53:32 2006] [notice] Child 2716: Acquired the start
> mutex.
> > [Sun Jan 15 13:53:32 2006] [notice] Child 2716: Starting 10 worker
> threads.
> > [Sun Jan 15 13:57:02 2006] [error] make_obcallback: could not import
> > mod_python.apache.\n [Sun Jan 15 13:57:02 2006] [error]
> > python_handler: no interpreter callback found.
> > [Sun Jan 15 13:57:02 2006] [error] [client 127.0.0.1] python_handler:
> > Can't get/create interpreter.
> >
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://mailman.modpython.org/mailman/listinfo/mod_python
> >
> >
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
>

From luismg at gmx.net  Mon Jan 16 20:15:21 2006
From: luismg at gmx.net (Luis M. Gonzalez)
Date: Mon Jan 16 20:15:24 2006
Subject: [mod_python] Sessions (Aaaarggghhhh!!)
Message-ID: <000c01c61b03$7e41c850$f8dbebc9@luis>

Hi Folks!

I'm needing some help with this problem...
I just started playing with mod_python yesterday, and after pulling my hair with installation problems and configurations,
I managed to get it working and I also could write some basic little apps.

Right now, I'm almost finished with a simple shopping cart, wich is an instance of class "cart" and contains, obviously, items with their prices and quantities.
It performs the usual actions, such add item, update quantity, etc.
The problem is that when I perform any of these actions, the cart is created again, and the previous information gets lost.
It seems that there's a problem with my session handling, but I can't figure out what's wrong...

This is how I create the session for my shopping cart:

s = Session.Session(req)

s = Session.Session(req)
if not hasattr(s,'x'):
    s['x']= cart()
    s.save() 

 and this is the code that handles the operations:

if form['action']=='upqty':
    try:
        if int(form['qty'])==0:
            del s['x'].items[form['item']]
            s.save()
        else:
            s['x'].upqty(form['item'],int(form['qty']))
            s.save()
        s['x'].pp()
        
    except:
        print 'Bad entry. Try again...with numbers'
elif form['action']=='ad':
    try:
        if form['item']=='':
     print 'no item to add'
        else:
     s['x'].ad(form['item'],float(form['price']),int(form['qty']))
            s.save()
         s['x'].pp()
            
    except:
 print 'Bad entry. Try again...with numbers'
s.save()   


Note that I use exclusively the PSP programming style, and this is my Apache conf:

<Directory "C:\Archivos de programa\Apache Group\Apache2\htdocs">
    AddHandler mod_python .psp
    PythonHandler mod_python.psp
    PythonDebug On
</Directory>


Please! I would highly appreciate any hint from you guys!
Thanks in advance and regards,

Luis
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20060116/d9d46af0/attachment.html
From jpg at jgassociates.ca  Mon Jan 16 22:20:36 2006
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Mon Jan 16 22:16:52 2006
Subject: [mod_python] Sessions (Aaaarggghhhh!!)
In-Reply-To: <000c01c61b03$7e41c850$f8dbebc9@luis>
References: <000c01c61b03$7e41c850$f8dbebc9@luis>
Message-ID: <43CC6284.5050707@jgassociates.ca>

Luis M. Gonzalez wrote:
> Hi Folks!
> 
> I'm needing some help with this problem...
> I just started playing with mod_python yesterday, and after pulling my hair with installation problems and configurations,
> I managed to get it working and I also could write some basic little apps.
> 
> Right now, I'm almost finished with a simple shopping cart, wich is an instance of class "cart" and contains, obviously, items with their prices and quantities.
> It performs the usual actions, such add item, update quantity, etc.
> The problem is that when I perform any of these actions, the cart is created again, and the previous information gets lost.
> It seems that there's a problem with my session handling, but I can't figure out what's wrong...
> 
> This is how I create the session for my shopping cart:
> 
> s = Session.Session(req)
> 
> s = Session.Session(req)

I assume this is a copy and paste error, but if it's not... do *not* 
create 2 session objects in the same request. Session locking (which is 
on by default) will result in a deadlock.

> if not hasattr(s,'x'):
>     s['x']= cart()

You can also use s.is_new() to determine if this is a new session which 
may require some sort of initialization code for your cart.

Sessions are saved as pickles, and you are likely to run into problems 
trying to save an instance of your class in the session. It's best to 
stick to simple types like strings, integers and so on (including lists 
and dicts).

>     s.save() 
> 
>  and this is the code that handles the operations:
> 
> if form['action']=='upqty':
>     try:
>         if int(form['qty'])==0:
>             del s['x'].items[form['item']]
>             s.save()
>         else:
>             s['x'].upqty(form['item'],int(form['qty']))
>             s.save()
>         s['x'].pp()
>         
>     except:
>         print 'Bad entry. Try again...with numbers'
> elif form['action']=='ad':
>     try:
>         if form['item']=='':
>      print 'no item to add'
>         else:
>      s['x'].ad(form['item'],float(form['price']),int(form['qty']))
>             s.save()
>          s['x'].pp()
>             
>     except:
>  print 'Bad entry. Try again...with numbers'
> s.save()   


You will likely have better luck if you just save a list of your cart 
data in the session.

items = [{'item':form['item'], 'qty':form['qty']}, {.. more items ..}, ]
s['cart_items'] = items
s.save()

As an aside doing all those saves is going to kill your performance as 
each save requires pickling the data and writing it to disk (unless you 
are using MemorySession and apache mpm-threaded on windows). Just do one 
save at the end of your code block.

Jim



From rare_bug at yahoo.com  Mon Jan 16 23:30:41 2006
From: rare_bug at yahoo.com (aditama kun)
Date: Mon Jan 16 23:30:50 2006
Subject: [mod_python] moin moin setup.py cannot be executed
Message-ID: <20060117043041.42653.qmail@web33903.mail.mud.yahoo.com>

i am using mod python together with my moinmoin
packages. The installation of apache, python, mod
python succeed(By looking at apache panel that showing
apache, mod python and python @status bar).

the problem is when i executed these command

c:\python setup.py --quiet install --prefix="C:\moin"
--record=install.log

i have added the python path at environment variables,
the problem is he can't find the setup.py, even i have
added these line in the moin.cgi into like this : 

sys.path.insert(0, 'C:/moin')

anyone know the problem???

__________________________________________________
Do You Yahoo!?
Tired of spam?  Yahoo! Mail has the best spam protection around 
http://mail.yahoo.com 
From luismg at gmx.net  Tue Jan 17 00:25:57 2006
From: luismg at gmx.net (Luis M. Gonzalez)
Date: Tue Jan 17 00:26:00 2006
Subject: [mod_python] Sessions (Aaaarggghhhh!!)
Message-ID: <001f01c61b26$803d0e30$f8dbebc9@luis>

Thank you Jim!!

 You were right.
 Instead of saving the cart items into a cart instance, I did it into a 
simple dictionary.
 I also saved the dict only once at the end the code block.

 Thanks again and best regards,
 Luis

 

From luismg at gmx.net  Tue Jan 17 00:31:52 2006
From: luismg at gmx.net (Luis M. Gonzalez)
Date: Tue Jan 17 00:31:56 2006
Subject: [mod_python] Google Groups ?
Message-ID: <002501c61b27$54733a30$f8dbebc9@luis>

Hello there!

I am new to the list and I spent two days struggling with mod_python (installation, configuration, etc, etc...)
While searching for information, I saw that someone started a Google Group for Mod-python, but it seems innactive.
Wouldn't it be better if everybody starts using it?

Searching for info in this mailing list is a pain in the neck... no way to navigate threads, no way to search archives, etc...
I've seen that many others mailing lits (python related) moved to Google Groups and the result was great.
As for the existing archives, we could simply put a link to the new Group and leave the existing archives for reading only.

I really believe it will be a very good change for everybody interested in mod_python.
Just think about all the questions that are asked over and over again because nobody can find the previous ones...

Well, I just wanted to bring it up again. Think about it...

Thanks,
Luis 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20060117/a52ee77f/attachment-0001.html
From grahamd at dscpl.com.au  Tue Jan 17 00:33:59 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Tue Jan 17 00:34:03 2006
Subject: [mod_python] Sessions (Aaaarggghhhh!!)
Message-ID: <1137476039.21977@dscpl.user.openhosting.com>

Luis M. Gonzalez wrote ..
> Thank you Jim!!
> 
>  You were right.
>  Instead of saving the cart items into a cart instance, I did it into a
> simple dictionary.
>  I also saved the dict only once at the end the code block.

To provide some background as to why saving class objects is not good,
have a read of:

  http://www.dscpl.com.au/articles/modpython-005.html

Graham
From grahamd at dscpl.com.au  Tue Jan 17 00:52:13 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Tue Jan 17 00:52:19 2006
Subject: [mod_python] Google Groups ?
Message-ID: <1137477133.967@dscpl.user.openhosting.com>

Luis M. Gonzalez wrote ..
> Hello there!
> 
> I am new to the list and I spent two days struggling with mod_python (installation,
> configuration, etc, etc...)
> While searching for information, I saw that someone started a Google Group
> for Mod-python, but it seems innactive.
> Wouldn't it be better if everybody starts using it?

Gatewaying message to Google groups or something like that was discussed
previously and it was decided not to do it. Reasons were partly technical and
probably partly apathy. In the main, most people probably simply perfered
it as email.

> Searching for info in this mailing list is a pain in the neck... no way
> to navigate threads, no way to search archives, etc...

You can search from the mod_python home page. The search will actually
do the whole mod_python web site, including FAQ as well. When I want to
restrict to just the mailing list I use 'inurl:pipermail' in the search term, eg:

  inurl:pipermail core dump

Yields Google search of:

  http://www.google.com/search?q=inurl%3Apipermail+core+dump&q=site%3Awww.modpython.org

Viewing my month/thread/author/date can be found at:

  http://www.modpython.org/pipermail/mod_python/

You had probably found that one already though. Not perfect, but works.

> I've seen that many others mailing lits (python related) moved to Google
> Groups and the result was great.
> As for the existing archives, we could simply put a link to the new Group
> and leave the existing archives for reading only.
> 
> I really believe it will be a very good change for everybody interested
> in mod_python.
> Just think about all the questions that are asked over and over again because
> nobody can find the previous ones...

Actually, most of the time we find that people ask questions because they
couldn't be bothered to go look for answers first. If you actually did a search
first, then you are possibly in the minority.

What is a probably the biggest pain as far as I am concerned, is that when
people do ask questions and we supply possible answers, they never post
back to confirm whether the solution did solve the problem. Lacking this
positive response, one never knows if one is actually giving helpful or correct
answers which other people can rely on if they do find the mailing list archive.
Most frustrating. :-(

Graham
From joeb at mit.edu  Tue Jan 17 01:07:16 2006
From: joeb at mit.edu (Joseph Barillari)
Date: Tue Jan 17 01:07:11 2006
Subject: [mod_python] Sessions (Aaaarggghhhh!!)
In-Reply-To: <1137476039.21977@dscpl.user.openhosting.com>
References: <1137476039.21977@dscpl.user.openhosting.com>
Message-ID: <20060117060715.GB4764@barillari.org>

On Tue, Jan 17, 2006 at 12:33:59AM -0500, Graham Dumpleton wrote:
> Luis M. Gonzalez wrote ..
> > Thank you Jim!!
> > 
> >  You were right.
> >  Instead of saving the cart items into a cart instance, I did it into a
> > simple dictionary.
> >  I also saved the dict only once at the end the code block.
> 
> To provide some background as to why saving class objects is not good,
> have a read of:
> 
>   http://www.dscpl.com.au/articles/modpython-005.html

Interesting. Is there any way to store a code object in a mod_python
session? From what I've read, that general technique lets you do some
neat tricks:

http://lib.store.yahoo.net/lib/paulgraham/bbnexcerpts.txt

Joe
From grahamd at dscpl.com.au  Tue Jan 17 06:00:26 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Tue Jan 17 06:00:40 2006
Subject: [mod_python] Sessions (Aaaarggghhhh!!)
In-Reply-To: <20060117060715.GB4764@barillari.org>
References: <1137476039.21977@dscpl.user.openhosting.com>
	<20060117060715.GB4764@barillari.org>
Message-ID: <C2530278-9954-4A84-893D-B9CF5261D3CF@dscpl.com.au>


On 17/01/2006, at 5:07 PM, Joseph Barillari wrote:

> On Tue, Jan 17, 2006 at 12:33:59AM -0500, Graham Dumpleton wrote:
>> Luis M. Gonzalez wrote ..
>>> Thank you Jim!!
>>>
>>>  You were right.
>>>  Instead of saving the cart items into a cart instance, I did it  
>>> into a
>>> simple dictionary.
>>>  I also saved the dict only once at the end the code block.
>>
>> To provide some background as to why saving class objects is not  
>> good,
>> have a read of:
>>
>>   http://www.dscpl.com.au/articles/modpython-005.html
>
> Interesting. Is there any way to store a code object in a mod_python
> session? From what I've read, that general technique lets you do some
> neat tricks:
>
> http://lib.store.yahoo.net/lib/paulgraham/bbnexcerpts.txt

Rather than storing in a session an actual function object, you can
store the full path of the module and the name of the function. Ie.,
something like:

   def callback():
     ...

   def handler(req):
     ...
     session["callback"] = (__file__,"callback")
     session.save()

Later on when the session is restored and you need to call the function
you can do something like:

     (file,function_name) = session["callback"]
     (directory,module_name) = os.path.split(file)
     module_name = os.path.splitext(module_name)[0]

     module = apache.import_module(module_name,path=[directory])
     getattr(module,function_name)()

In other words you just use a level of indirection and do the lookup of
the module and function yourself, rather than pickle doing it for you.

The restoration will hopefully be simpler in mod_python 3.3 if I my
proposal for changes to apache.import_module() is accepted. There you
will hopefully be able to also supply the full path to the module as
first argument instead. Ie.,

     (file,name) = session["callback"]
     module = apache.import_module(file)
     getattr(module,name)()

Does this allow you to achieve what you want?

PS, I haven't actually read the article you referenced yet as getting
late at night and brain not able to comprehend it.

Graham

From administrator at leebrown.org  Tue Jan 17 07:22:10 2006
From: administrator at leebrown.org (Lee Brown)
Date: Tue Jan 17 07:23:09 2006
Subject: [mod_python] Can't seem to get mod_python working, please help me
In-Reply-To: <4817b6fc0601161014t687be95ci546c9f1b3ecbf358@mail.gmail.com>
Message-ID: <008001c61b60$a3d4f210$0301a8c0@uberbox>

Greetings!

Right-click on your python installation directory and select "sharing and
security."  Click on the "security" tab."  (If you don't see a "security"
tab, you need to disable "simple file sharing.")

Make sure that user SYSTEM is listed in the top box and make sure that user
SYSTEM has "full control" selected in the bottom box.  Otherwise, user
SYSTEM has no authority to execute python.

Windows XP has gotten a bad rap for being insecure, but it in fact has a
good suite of security features that most people simply are unaware of or
simply do not use.  The NTFS file system has very fined-grained, unix-like
control over user/group permissions, but most XP users don't take advantage
of it.  Using administrator-level accounts all the time is also a very bad
idea - it is just like running everything as "root" on a unix box.

If you are going to be using this computer as a web server accessible to the
outside world, please believe me that you're going to need to know how to
use these features and more.  While securing an XP box for the web is beyond
the scope of this mailing list, please consider doing the following:

1 - Read up on XP system administration and security.  There are several
good books on the subject - contact me off-line if you need a
recommendation.

2 - Get yourself behind a hardware firewall.

3 - Establish specific users/groups for your web services and give these
identities very specific access to only those things they need in order to
run.

4 - Harden your Apache server against attack.  I very highly recommend
mod_security (http://www.modsecurity.org)


Best Regards,
Lee E. Brown
(administrator@leebrown.org)

-----Original Message-----
From: mod_python-bounces@modpython.org
[mailto:mod_python-bounces@modpython.org] On Behalf Of Dan Eloff
Sent: Monday, January 16, 2006 1:15 PM
To: mod_python@modpython.org
Subject: Re: [mod_python] Can't seem to get mod_python working, please help
me

Ok apache is running with SYSTEM credentials, the same as a bunch of other
services I recognize in there, including MySQL. Python is running as Wiley
Coyote (my username.)

Does that tell us anything?


From jon at coral8.com  Tue Jan 17 11:35:56 2006
From: jon at coral8.com (Jon Rosen)
Date: Tue Jan 17 11:34:03 2006
Subject: [mod_python] Google Groups ?
In-Reply-To: <1137477133.967@dscpl.user.openhosting.com>
References: <1137477133.967@dscpl.user.openhosting.com>
Message-ID: <43CD1CEC.9040307@coral8.com>

I agree.  I for one am not a big believer and centralizing these things 
within the context of a commercial company, particularly Google.  Hey, I 
use Google like we all do, and I even use some Google groups, but I 
think there are also benefits derived from not being forced to view 
their ads, etc.  I like having independent email lists which handle this 
kind of interaction quite nicely thank you.

Jon Rosen
Coral8, Inc.

Graham Dumpleton wrote:

>Luis M. Gonzalez wrote ..
>  
>
>>Hello there!
>>
>>I am new to the list and I spent two days struggling with mod_python (installation,
>>configuration, etc, etc...)
>>While searching for information, I saw that someone started a Google Group
>>for Mod-python, but it seems innactive.
>>Wouldn't it be better if everybody starts using it?
>>    
>>
>
>Gatewaying message to Google groups or something like that was discussed
>previously and it was decided not to do it. Reasons were partly technical and
>probably partly apathy. In the main, most people probably simply perfered
>it as email.
>
>  
>
>>Searching for info in this mailing list is a pain in the neck... no way
>>to navigate threads, no way to search archives, etc...
>>    
>>
>
>You can search from the mod_python home page. The search will actually
>do the whole mod_python web site, including FAQ as well. When I want to
>restrict to just the mailing list I use 'inurl:pipermail' in the search term, eg:
>
>  inurl:pipermail core dump
>
>Yields Google search of:
>
>  http://www.google.com/search?q=inurl%3Apipermail+core+dump&q=site%3Awww.modpython.org
>
>Viewing my month/thread/author/date can be found at:
>
>  http://www.modpython.org/pipermail/mod_python/
>
>You had probably found that one already though. Not perfect, but works.
>
>  
>
>>I've seen that many others mailing lits (python related) moved to Google
>>Groups and the result was great.
>>As for the existing archives, we could simply put a link to the new Group
>>and leave the existing archives for reading only.
>>
>>I really believe it will be a very good change for everybody interested
>>in mod_python.
>>Just think about all the questions that are asked over and over again because
>>nobody can find the previous ones...
>>    
>>
>
>Actually, most of the time we find that people ask questions because they
>couldn't be bothered to go look for answers first. If you actually did a search
>first, then you are possibly in the minority.
>
>What is a probably the biggest pain as far as I am concerned, is that when
>people do ask questions and we supply possible answers, they never post
>back to confirm whether the solution did solve the problem. Lacking this
>positive response, one never knows if one is actually giving helpful or correct
>answers which other people can rely on if they do find the mailing list archive.
>Most frustrating. :-(
>
>Graham
>_______________________________________________
>Mod_python mailing list
>Mod_python@modpython.org
>http://mailman.modpython.org/mailman/listinfo/mod_python
>
>  
>


-- 
---------------------------------------------------------------
"The difference between theory and reality is that in theory,
 there is no difference between theory and reality,
 but in reality, there is." - Anonymous

From list at joreybump.com  Tue Jan 17 11:47:07 2006
From: list at joreybump.com (Jorey Bump)
Date: Tue Jan 17 11:47:22 2006
Subject: [mod_python] moin moin setup.py cannot be executed
In-Reply-To: <20060117043041.42653.qmail@web33903.mail.mud.yahoo.com>
References: <20060117043041.42653.qmail@web33903.mail.mud.yahoo.com>
Message-ID: <43CD1F8B.60508@joreybump.com>

This is not a moinmoin list. You are more likely to get better responses 
by using one of their forums. They might even have a wiki. :)

aditama kun wrote:
> i am using mod python together with my moinmoin
> packages. The installation of apache, python, mod
> python succeed(By looking at apache panel that showing
> apache, mod python and python @status bar).
> 
> the problem is when i executed these command
> 
> c:\python setup.py --quiet install --prefix="C:\moin"
> --record=install.log
> 
> i have added the python path at environment variables,
> the problem is he can't find the setup.py, even i have
> added these line in the moin.cgi into like this : 
> 
> sys.path.insert(0, 'C:/moin')
> 
> anyone know the problem???

There could be any number of problems with the command you show above. 
Is your python binary really c:\python? Does your current working 
directory contain setup.py? Do you have a valid reason for specifying a 
different location with --prefix?

If you have a sane setup and proper permissions, you are likely to have 
better results with the default:

  python /path/to/setup.py install --record=install.log

Watch the error messages and look at the log to see what might be the 
problem.



From dan.eloff at gmail.com  Tue Jan 17 14:12:52 2006
From: dan.eloff at gmail.com (Dan Eloff)
Date: Tue Jan 17 14:12:56 2006
Subject: [mod_python] Can't seem to get mod_python working, please help me
In-Reply-To: <4817b6fc0601171112h22f37d99u518d6fd21e7ac0e2@mail.gmail.com>
References: <4817b6fc0601161014t687be95ci546c9f1b3ecbf358@mail.gmail.com>
	<008001c61b60$a3d4f210$0301a8c0@uberbox>
	<4817b6fc0601171112h22f37d99u518d6fd21e7ac0e2@mail.gmail.com>
Message-ID: <4817b6fc0601171112g45fdfb5cud75158ab27e1558c@mail.gmail.com>

Hi Lee, thanks for helping me

I checked up and SYSTEM has full control over the python directory.
WIly Coyote (me) is listed as the owner of the directory, and has
special permissions checked, when I click on advanced it seems to
indicate that Wily Coyote also has Full Control (no big surprise or I
wouldn't be able to execute python.

I'm actually just setting up this computer as a development machine, I
wouldn't use Win Xp as a production server as it has artificial limits
placed on how many connections it can accept (max 25 simultaneous I
think.) This is in order to force people to use Windows Server OS.

If you think of anything else, please let me know.

Thanks,
-Dan

From nicolas.lehuen at gmail.com  Tue Jan 17 14:31:56 2006
From: nicolas.lehuen at gmail.com (Nicolas Lehuen)
Date: Tue Jan 17 14:32:02 2006
Subject: [mod_python] moin moin setup.py cannot be executed
In-Reply-To: <43CD1F8B.60508@joreybump.com>
References: <20060117043041.42653.qmail@web33903.mail.mud.yahoo.com>
	<43CD1F8B.60508@joreybump.com>
Message-ID: <c298f2d70601171131v67d83753j@mail.gmail.com>

FYI, I recently successfully installed a MoinMoin wiki on Windows 2000
with mod_python 3.2.5b by following the setup instruction found on
MoinMoin's wiki. So it can be done !

Regards,
Nicolas

2006/1/17, Jorey Bump <list@joreybump.com>:
> This is not a moinmoin list. You are more likely to get better responses
> by using one of their forums. They might even have a wiki. :)
>
> aditama kun wrote:
> > i am using mod python together with my moinmoin
> > packages. The installation of apache, python, mod
> > python succeed(By looking at apache panel that showing
> > apache, mod python and python @status bar).
> >
> > the problem is when i executed these command
> >
> > c:\python setup.py --quiet install --prefix="C:\moin"
> > --record=install.log
> >
> > i have added the python path at environment variables,
> > the problem is he can't find the setup.py, even i have
> > added these line in the moin.cgi into like this :
> >
> > sys.path.insert(0, 'C:/moin')
> >
> > anyone know the problem???
>
> There could be any number of problems with the command you show above.
> Is your python binary really c:\python? Does your current working
> directory contain setup.py? Do you have a valid reason for specifying a
> different location with --prefix?
>
> If you have a sane setup and proper permissions, you are likely to have
> better results with the default:
>
>   python /path/to/setup.py install --record=install.log
>
> Watch the error messages and look at the log to see what might be the
> problem.
>
>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>

From python_eager at yahoo.com  Wed Jan 18 01:50:30 2006
From: python_eager at yahoo.com (python eager)
Date: Wed Jan 18 01:50:34 2006
Subject: [mod_python] reg editor doubt
Message-ID: <20060118065030.9129.qmail@web36401.mail.mud.yahoo.com>

Hi
     i am using PYTHON SHELL editor. If i put dot notation for instance it won't display what are the methods in that class. Please help me , how to get methods are inside the class if i put dot notation for object.
  I am using python 2.4.2 downloaded from python.org
  please help me.
   
  thank you
  Python Eager
   

			
---------------------------------
Yahoo! Photos
 Got holiday prints? See all the ways to get quality prints in your hands ASAP.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20060117/ef5bd893/attachment.html
From dan.eloff at gmail.com  Wed Jan 18 02:50:30 2006
From: dan.eloff at gmail.com (Dan Eloff)
Date: Wed Jan 18 02:50:34 2006
Subject: [mod_python] Now we're getting somewhere. Where does mod_python
	install these files?
Message-ID: <4817b6fc0601172350h49bf5c8fkb87c7f68cc899fdb@mail.gmail.com>

Progress.

11:34:27 PM	Apache.exe:2216	OPEN	C:\Program
Files\Python\python24.zip\	NOT FOUND	Options: Open Directory  Access:
All
11:34:27 PM	Apache.exe:2216	OPEN	C:\Program
Files\Python\python24.zip\mod_python.pyd	PATH NOT FOUND	Options: Open 
Access: All
11:34:27 PM	Apache.exe:2216	OPEN	C:\Program
Files\Python\python24.zip\mod_python.dll	PATH NOT FOUND	Options: Open 
Access: All
11:34:27 PM	Apache.exe:2216	OPEN	C:\Program
Files\Python\python24.zip\mod_python.py	PATH NOT FOUND	Options: Open 
Access: All
11:34:27 PM	Apache.exe:2216	OPEN	C:\Program
Files\Python\python24.zip\mod_python.pyw	PATH NOT FOUND	Options: Open 
Access: All
11:34:27 PM	Apache.exe:2216	OPEN	C:\Program
Files\Python\python24.zip\mod_python.pyc	PATH NOT FOUND	Options: Open 
Access: All

Apache looks in a few other places for these files, but never finds
them. I imagine they are the source of all my troubles. Where are they
meant to be and why are they not there?

Thanks,
-Dan


On 1/17/06, Dan Eloff <dan.eloff@gmail.com> wrote:
> Hi Lee, thanks for helping me
>
> I checked up and SYSTEM has full control over the python directory.
> WIly Coyote (me) is listed as the owner of the directory, and has
> special permissions checked, when I click on advanced it seems to
> indicate that Wily Coyote also has Full Control (no big surprise or I
> wouldn't be able to execute python.
>
> I'm actually just setting up this computer as a development machine, I
> wouldn't use Win Xp as a production server as it has artificial limits
> placed on how many connections it can accept (max 25 simultaneous I
> think.) This is in order to force people to use Windows Server OS.
>
> If you think of anything else, please let me know.
>
> Thanks,
> -Dan
>

From dan.eloff at gmail.com  Wed Jan 18 03:21:58 2006
From: dan.eloff at gmail.com (Dan Eloff)
Date: Wed Jan 18 03:22:01 2006
Subject: [mod_python] reg editor doubt
In-Reply-To: <20060118065030.9129.qmail@web36401.mail.mud.yahoo.com>
References: <20060118065030.9129.qmail@web36401.mail.mud.yahoo.com>
Message-ID: <4817b6fc0601180021q5525a939r2161ae4d1ebad4c8@mail.gmail.com>

This question would be more appropriate on the python discussion
group, but the answer is, it depends. Python is a very dynamic
language and it is not easily possible to determine what methods are
in a particular object. Some editors do a reasonably good job at this,
others do not. If you try a dot after an object in your editor and it
displays nothing, you either disabled the feature somewhere, or the
editor has no idea what methods the object has. You can look at the
options/preferences in your editor to rule out the first, but there's
not much you can do if it's outside the functionality of your editor,
other than try another editor (and no editor is perfect.)

-Dan

On 1/17/06, python eager <python_eager@yahoo.com> wrote:
> Hi
>    i am using PYTHON SHELL editor. If i put dot notation for instance it
> won't display what are the methods in that class. Please help me , how to
> get methods are inside the class if i put dot notation for object.
> I am using python 2.4.2 downloaded from python.org
> please help me.
>
> thank you
> Python Eager
>
>
>  ________________________________
> Yahoo! Photos
>  Got holiday prints? See all the ways to get quality prints in your hands
> ASAP.
>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
>
>

From python_eager at yahoo.com  Wed Jan 18 04:15:44 2006
From: python_eager at yahoo.com (python eager)
Date: Wed Jan 18 04:15:48 2006
Subject: [mod_python] reg forward page
Message-ID: <20060118091544.62632.qmail@web36407.mail.mud.yahoo.com>

Hi
     from python, how to forward the psp page and how retain the values which are getting in python, that should be display in python server pages (psp). Please help me. 
   
  Note : in java struts is mainted this logic using findforward. Automatically the struts forwarded to particular jsp page. Like that i need.
   
  Please help me
   
  Thank you
  Python _Eager
   

		
---------------------------------
Yahoo! Photos
 Ring in the New Year with Photo Calendars. Add photos, events, holidays, whatever.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20060118/833531b7/attachment.html
From nogradi at gmail.com  Wed Jan 18 06:50:32 2006
From: nogradi at gmail.com (Daniel Nogradi)
Date: Wed Jan 18 06:50:37 2006
Subject: [mod_python] How do you use mod_python?
Message-ID: <5f56302b0601180350p657c4a8dqbf89224d8dd345db@mail.gmail.com>

Some time ago there was a post (I think by Grisha) asking "why are you
using mod_python?". It would be interesting to see answers from many
users to a related question, _how_ do you use mod_python?

A little more specifically, the various ways of using mod_python that
I have in mind (which list is very much limited by my knowledge)
include

(1) writing custom handlers for every new project
(2) writing a universal handler which serves various unrelated projects
(3) using the publisher handler for every project
(4) tweaking the publisher handler for every new project in different ways
(5) using the publisher for some of the projects but writing new
handlers for others

And of course there could be many more ways of using mod_python that
just didn't come into my mind at the moment or don't even know about
it.

So, after all, how do you use mod_python?

From dave at davebritton.com  Wed Jan 18 08:41:39 2006
From: dave at davebritton.com (Dave Britton)
Date: Wed Jan 18 08:43:04 2006
Subject: [mod_python] How do you use mod_python?
References: <5f56302b0601180350p657c4a8dqbf89224d8dd345db@mail.gmail.com>
Message-ID: <076401c61c34$e9607e10$0500a8c0@brittonfamily.org>

I currently use mod_python to provide a database-driven web site for a class
I teach at City College. With no concern for fancy presentation issues, the
site needs an easy way to prepare and deliver and grade class assignments
online, in which each student's assignment is personalized (or at least
randomized to be individual). The publisher handler is all I am using at the
moment, since it is easy and works well, although I expect to add Graham's
Vampire system soon for added functionality. Python with mod_python has been
fast, flexible and powerful for this purpose so far. The specific "how" is
pretty vanilla compared to what I read in this list:  1) I like to put the
whole application in one module, different functions of which are called by
each page, so the structure or pattern is 2) to collect the incoming cgi
variables (which is convenient with mod_python), 3) open the database with
MySQLdb, 4) figure out whatever needs figuring out with python code, and 5)
construct the html output string in the process, using forms to pass cgi
intemediate information, especially any session-like page-to-page persistent
information, as hidden variables, with the html form ACTION usually being a
function in the application module. Then 6) close the database and 7) return
the html string and 8) wait for the user to fill in a form and/or click a
form button on the delivered page so we can do it all again.

I've done several other web-based applications in this fashion before. One
particularly useful aspect of it is the ability to dynamically create
complex javascript when required. Another application used mod_python in
combination with ZSI SOAP to dynamically deliver an application that ran on
the local webserver but enabled retrieval and update of a remote vendor's
database.

I'm using older versions of apache and mod_python (1.3/2.7) for this current
classroom application because I haven't gotten the spacetime to upgrade
(I've been through that process before and it isn't easy enough to take
lightly) so fancy modern conveniences like Session are still in the future.

I'm starting a new application to manage a huge database of neurophysiology
research data which may involve figuring out how to do things like database
connection pooling and running lengthy background processing jobs (possibly
on other machines) that will let you check their status and control them by
web page.

Overall the "how I use mod_python" answer is to stay straight up out of the
box, no messing with it, try to zen out what it likes to do and use it that
way.

-Dave
----- Original Message ----- 
From: "Daniel Nogradi" <nogradi@gmail.com>
To: <mod_python@modpython.org>
Sent: Wednesday, January 18, 2006 6:50 AM
Subject: [mod_python] How do you use mod_python?


> Some time ago there was a post (I think by Grisha) asking "why are you
> using mod_python?". It would be interesting to see answers from many
> users to a related question, _how_ do you use mod_python?
>
> A little more specifically, the various ways of using mod_python that
> I have in mind (which list is very much limited by my knowledge)
> include
>
> (1) writing custom handlers for every new project
> (2) writing a universal handler which serves various unrelated projects
> (3) using the publisher handler for every project
> (4) tweaking the publisher handler for every new project in different ways
> (5) using the publisher for some of the projects but writing new
> handlers for others
>
> And of course there could be many more ways of using mod_python that
> just didn't come into my mind at the moment or don't even know about
> it.
>
> So, after all, how do you use mod_python?
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
>

From oduzlevski at intechjanus.com  Wed Jan 18 09:41:28 2006
From: oduzlevski at intechjanus.com (Ognen Duzlevski)
Date: Wed Jan 18 09:41:30 2006
Subject: [mod_python] How do you use mod_python?
In-Reply-To: <5f56302b0601180350p657c4a8dqbf89224d8dd345db@mail.gmail.com>
References: <5f56302b0601180350p657c4a8dqbf89224d8dd345db@mail.gmail.com>
Message-ID: <43CE5398.5050307@intechjanus.com>

Hi,

I use mod_python based on what is here: 
http://www.modpython.org/pipermail/mod_python/2005-March/017639.html

Customized it a bit to support sessions for example. Using it heavily 
with Cheetah.

My application framework is a bit different though. My pages are defined 
in xml which can include "role" information (who can access what on the 
page). This role information has to conform to the database "role" 
definitions (and is as fine-grained as you want to make it). The xml 
page definition is then stored in the database. When a user requests a 
page, the page executes a db function called GetPage() which passes the 
user id and page name. The database then retrieves the xml page 
definition, goes through it, applies all the db select sql that was 
defined in the xml and substitutes the results as additional xml tags. 
At the same time the xml is "filtered" for the "role" access against the 
user id and all their roles. The modified xml is then returned to the 
mod_python app which applies the xml->html (and all css stuff) to 
produce the final html for the user. This whole approach allows me to 
automate most of the tasks - if a page changes, I change its xml 
definition and run a script to store it in the database. From there it's 
all automated.

Thanks,
Ognen

Daniel Nogradi wrote:

>Some time ago there was a post (I think by Grisha) asking "why are you
>using mod_python?". It would be interesting to see answers from many
>users to a related question, _how_ do you use mod_python?
>
>A little more specifically, the various ways of using mod_python that
>I have in mind (which list is very much limited by my knowledge)
>include
>
>(1) writing custom handlers for every new project
>(2) writing a universal handler which serves various unrelated projects
>(3) using the publisher handler for every project
>(4) tweaking the publisher handler for every new project in different ways
>(5) using the publisher for some of the projects but writing new
>handlers for others
>
>And of course there could be many more ways of using mod_python that
>just didn't come into my mind at the moment or don't even know about
>it.
>
>So, after all, how do you use mod_python?
>
>_______________________________________________
>Mod_python mailing list
>Mod_python@modpython.org
>http://mailman.modpython.org/mailman/listinfo/mod_python
>  
>

From blaise at laflamme.org  Wed Jan 18 10:25:20 2006
From: blaise at laflamme.org (Laflamme Blaise)
Date: Wed Jan 18 10:25:24 2006
Subject: [mod_python] How do you use mod_python?
In-Reply-To: <200601181441.k0IEfmen024351@modpython.org>
References: <200601181441.k0IEfmen024351@modpython.org>
Message-ID: <C6894E4E-3F3A-40A8-99C6-97F6890AA005@laflamme.org>

Hi,

currently I use mod_python for project based on XML/XSLT, MySQL and  
mpservlet handler. I found this way of working very straightforward  
and object oriented. Here's the libraries I'm using:

1. mpservlet
2. lxml (lbxslt/libxml2) and elementtree
3. MySQLDB (mysql)

Have a nice day!

Blaise Laflamme
blaise@laflamme.org


> From: Daniel Nogradi <nogradi@gmail.com>
> Date: January 18, 2006 6:50:32 AM EST (CA)
> To: mod_python@modpython.org
> Subject: [mod_python] How do you use mod_python?
>
>
> Some time ago there was a post (I think by Grisha) asking "why are you
> using mod_python?". It would be interesting to see answers from many
> users to a related question, _how_ do you use mod_python?
>
> A little more specifically, the various ways of using mod_python that
> I have in mind (which list is very much limited by my knowledge)
> include
>
> (1) writing custom handlers for every new project
> (2) writing a universal handler which serves various unrelated  
> projects
> (3) using the publisher handler for every project
> (4) tweaking the publisher handler for every new project in  
> different ways
> (5) using the publisher for some of the projects but writing new
> handlers for others
>
> And of course there could be many more ways of using mod_python that
> just didn't come into my mind at the moment or don't even know about
> it.
>
> So, after all, how do you use mod_python?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20060118/59eb415e/attachment.html
From emlynj at gmail.com  Wed Jan 18 10:36:15 2006
From: emlynj at gmail.com (Emlyn Jones)
Date: Wed Jan 18 10:36:19 2006
Subject: [mod_python] How do you use mod_python?
In-Reply-To: <5f56302b0601180350p657c4a8dqbf89224d8dd345db@mail.gmail.com>
References: <5f56302b0601180350p657c4a8dqbf89224d8dd345db@mail.gmail.com>
Message-ID: <f4b5a9620601180736s2679be70g9bc9d36ec6eb8982@mail.gmail.com>

On 1/18/06, Daniel Nogradi <nogradi@gmail.com> wrote:
> Some time ago there was a post (I think by Grisha) asking "why are you
> using mod_python?". It would be interesting to see answers from many
> users to a related question, _how_ do you use mod_python?
>
> A little more specifically, the various ways of using mod_python that
> I have in mind (which list is very much limited by my knowledge)
> include
>
> (1) writing custom handlers for every new project
> (2) writing a universal handler which serves various unrelated projects
> (3) using the publisher handler for every project
> (4) tweaking the publisher handler for every new project in different ways
> (5) using the publisher for some of the projects but writing new
> handlers for others
>
> And of course there could be many more ways of using mod_python that
> just didn't come into my mind at the moment or don't even know about
> it.
>
> So, after all, how do you use mod_python?
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>

What about:
 (6) Python Server Pages

 I use psp alongside code to read in a html file, substitute some key
words with values from my Python code and then spit it out via the req
object. That way my psp pages are pure Python and by display code is
pure(ish) html/javascript.

Cheers,
Emlyn.

From nick at dd.revealed.net  Wed Jan 18 10:48:34 2006
From: nick at dd.revealed.net (Nick)
Date: Wed Jan 18 10:48:43 2006
Subject: [mod_python] How do you use mod_python?
In-Reply-To: <f4b5a9620601180736s2679be70g9bc9d36ec6eb8982@mail.gmail.com>
References: <5f56302b0601180350p657c4a8dqbf89224d8dd345db@mail.gmail.com>
	<f4b5a9620601180736s2679be70g9bc9d36ec6eb8982@mail.gmail.com>
Message-ID: <43CE6352.6040503@dd.revealed.net>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Emlyn Jones wrote:
| What about:
|  (6) Python Server Pages
|
|  I use psp alongside code to read in a html file, substitute some key
| words with values from my Python code and then spit it out via the req
| object. That way my psp pages are pure Python and by display code is
| pure(ish) html/javascript.

PSE (my project) does something similar, though it's pretty much a
generic application server type handler, like JSP.

~    http://nick.borko.org/pse

Nick
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.1 (GNU/Linux)

iD8DBQFDzmNRv4zJ7LQ+i84RAuY4AJsHm0G+cyo6tNlxhYBa2AcFMcTd4wCdG6Ab
7PtvOoKq/2Ij1PoyYJuqJ6o=
=+b82
-----END PGP SIGNATURE-----
From courtneyludwin at yahoo.com  Wed Jan 18 11:02:12 2006
From: courtneyludwin at yahoo.com (courtney ludwin)
Date: Wed Jan 18 11:02:15 2006
Subject: [mod_python] How do you use mod_python?
In-Reply-To: <5f56302b0601180350p657c4a8dqbf89224d8dd345db@mail.gmail.com>
Message-ID: <20060118160212.41527.qmail@web34807.mail.mud.yahoo.com>

About a week and a half ago I bloged about my setup:
http://2centspoorer.blogspot.com/2006/01/creating-your-own-modpython-request.html

I use a handler that acts like a dispatcher to do 3
things:
1) map url's to resources 
  (this matches the urls with the python code that
hits the db and fills a cheetah template).
2) do all the boilerplate req.headers and req.write
type stuffs
3) handle my sessions.
  (I've been using mod_python since back in the day
when sessions were not part of the project and
Grisha's std response was persist them to a db. -- so
i did and it works great.)

http://socallocal.com/ was a site that I worked on
about a year ago but never had time to finish or
promote (it gets no traffic) cause I accepted a
position working at a startup.  It was ment to be like
a classified ads type site but I used it to flush out
many of my design ideas.  All the content on
socallocal.com is dynamic and driven off of mysql (w/
some caching where needed).

The site is actually very fast even tho I run it off
my home pc (p3 900) but I have a slow DSL connection
so it may seem not that fast.

Thanks,
Courtney


--- Daniel Nogradi <nogradi@gmail.com> wrote:

> Some time ago there was a post (I think by Grisha)
> asking "why are you
> using mod_python?". It would be interesting to see
> answers from many
> users to a related question, _how_ do you use
> mod_python?
> 
> A little more specifically, the various ways of
> using mod_python that
> I have in mind (which list is very much limited by
> my knowledge)
> include
> 
> (1) writing custom handlers for every new project
> (2) writing a universal handler which serves various
> unrelated projects
> (3) using the publisher handler for every project
> (4) tweaking the publisher handler for every new
> project in different ways
> (5) using the publisher for some of the projects but
> writing new
> handlers for others
> 
> And of course there could be many more ways of using
> mod_python that
> just didn't come into my mind at the moment or don't
> even know about
> it.
> 
> So, after all, how do you use mod_python?
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
>
http://mailman.modpython.org/mailman/listinfo/mod_python
> 


__________________________________________________
Do You Yahoo!?
Tired of spam?  Yahoo! Mail has the best spam protection around 
http://mail.yahoo.com 
From dan.eloff at gmail.com  Wed Jan 18 11:48:21 2006
From: dan.eloff at gmail.com (Dan Eloff)
Date: Wed Jan 18 11:48:25 2006
Subject: [mod_python] Re: Now we're getting somewhere. Where does mod_python
	install these files?
In-Reply-To: <4817b6fc0601172350h49bf5c8fkb87c7f68cc899fdb@mail.gmail.com>
References: <4817b6fc0601172350h49bf5c8fkb87c7f68cc899fdb@mail.gmail.com>
Message-ID: <4817b6fc0601180848i58154056v9e1c9241eaf160bc@mail.gmail.com>

Actually it appears this is python's import behaviour. I compared this
behaviour to the working mod_python on another PC, and here's the
difference (both have a similar python path)

Working (2.4):
>>> sys.path
['', 'C:\\Windows\\system32\\python24.zip', 'C:\\Program
Files\\Python', 'C:\\Program Files\\Python\\DLLs', 'C:\\Program
Files\\Python\\lib', 'C:\\Program Files\\Python\\lib\\plat-win',
'C:\\Program Files\\Python\\lib\\lib-tk',
'C:\\Program Files\\Python\\lib\\site-packages']

Not Working (2.4.2):
>>> sys.path
['', 'C:\\Program Files\\Python\\python24.zip', 'C:\\Program
Files\\Python\\DLLs', 'C:\\Program Files\\Python\\lib', 'C:\\Program
Files\\Python\\lib\\plat-win',
'C:\\Program Files\\Python\\lib\\lib-tk', 'C:\\Program Files\\Python',
 'C:\\Program Files\\Python\\lib\\site-packages']


The working one searches for mod_python in:
C:\Windows\system32\python24.zip
C:\Program Files\Python\Lib
C:\Program Files\Python\DLLs
C:\Program Files\Python\Lib\lib-tk
C:\Program Files\Apache Group\Apache2
C:\Program Files\Apache Group\Apache2\bin
C:\Program Files\Python
C:\Program Files\Python\lib\site-packages - SUCCESS

The broken one searches for mod_python in:
C:\Program Files\Python\python24.zip
C:\Program Files\Apache Group\Apache2\DLLs
C:\Program Files\Apache Group\Apache2\lib
C:\Program Files\Apache Group\Apache2\lib\plat-win
C:\Program Files\Apache Group\Apache2\lib\lib-tk
C:\Program Files\Apache Group\Apache2\bin - GIVES UP

Clearly python has gone beserk, replacing instances of C:\Program
Files\Python with Apache's directory, and not even searching
everything. The first thing I'm going to try is roll back to python
2.4.

-Dan

From dan.eloff at gmail.com  Wed Jan 18 15:25:27 2006
From: dan.eloff at gmail.com (Dan Eloff)
Date: Wed Jan 18 15:25:32 2006
Subject: [mod_python] Re: Now we're getting somewhere. Where does mod_python
	install these files?
In-Reply-To: <4817b6fc0601180848i58154056v9e1c9241eaf160bc@mail.gmail.com>
References: <4817b6fc0601172350h49bf5c8fkb87c7f68cc899fdb@mail.gmail.com>
	<4817b6fc0601180848i58154056v9e1c9241eaf160bc@mail.gmail.com>
Message-ID: <4817b6fc0601181225k458cbb70oea0790915c0945f8@mail.gmail.com>

And rolling back to python 2.4 fixed the problem immediately. I don't
know if python 2.4.2 is broken, or just if mod_python is broken for
2.4.2.

-Dan

On 1/18/06, Dan Eloff <dan.eloff@gmail.com> wrote:
> Actually it appears this is python's import behaviour. I compared this
> behaviour to the working mod_python on another PC, and here's the
> difference (both have a similar python path)
>
> Working (2.4):
> >>> sys.path
> ['', 'C:\\Windows\\system32\\python24.zip', 'C:\\Program
> Files\\Python', 'C:\\Program Files\\Python\\DLLs', 'C:\\Program
> Files\\Python\\lib', 'C:\\Program Files\\Python\\lib\\plat-win',
> 'C:\\Program Files\\Python\\lib\\lib-tk',
> 'C:\\Program Files\\Python\\lib\\site-packages']
>
> Not Working (2.4.2):
> >>> sys.path
> ['', 'C:\\Program Files\\Python\\python24.zip', 'C:\\Program
> Files\\Python\\DLLs', 'C:\\Program Files\\Python\\lib', 'C:\\Program
> Files\\Python\\lib\\plat-win',
> 'C:\\Program Files\\Python\\lib\\lib-tk', 'C:\\Program Files\\Python',
>  'C:\\Program Files\\Python\\lib\\site-packages']
>
>
> The working one searches for mod_python in:
> C:\Windows\system32\python24.zip
> C:\Program Files\Python\Lib
> C:\Program Files\Python\DLLs
> C:\Program Files\Python\Lib\lib-tk
> C:\Program Files\Apache Group\Apache2
> C:\Program Files\Apache Group\Apache2\bin
> C:\Program Files\Python
> C:\Program Files\Python\lib\site-packages - SUCCESS
>
> The broken one searches for mod_python in:
> C:\Program Files\Python\python24.zip
> C:\Program Files\Apache Group\Apache2\DLLs
> C:\Program Files\Apache Group\Apache2\lib
> C:\Program Files\Apache Group\Apache2\lib\plat-win
> C:\Program Files\Apache Group\Apache2\lib\lib-tk
> C:\Program Files\Apache Group\Apache2\bin - GIVES UP
>
> Clearly python has gone beserk, replacing instances of C:\Program
> Files\Python with Apache's directory, and not even searching
> everything. The first thing I'm going to try is roll back to python
> 2.4.
>
> -Dan
>

From nicolas.lehuen at gmail.com  Wed Jan 18 15:54:35 2006
From: nicolas.lehuen at gmail.com (Nicolas Lehuen)
Date: Wed Jan 18 15:54:38 2006
Subject: [mod_python] Re: Now we're getting somewhere. Where does
	mod_python install these files?
In-Reply-To: <4817b6fc0601181225k458cbb70oea0790915c0945f8@mail.gmail.com>
References: <4817b6fc0601172350h49bf5c8fkb87c7f68cc899fdb@mail.gmail.com>
	<4817b6fc0601180848i58154056v9e1c9241eaf160bc@mail.gmail.com>
	<4817b6fc0601181225k458cbb70oea0790915c0945f8@mail.gmail.com>
Message-ID: <c298f2d70601181254x3277a8dcg@mail.gmail.com>

It isn't broken for 2.4.2, I run it on a daily basis both on a
development machine and a production server.

What distribution are you using ? I'm using the ActiveState build for Win32.

Regards,
Nicolas

2006/1/18, Dan Eloff <dan.eloff@gmail.com>:
> And rolling back to python 2.4 fixed the problem immediately. I don't
> know if python 2.4.2 is broken, or just if mod_python is broken for
> 2.4.2.
>
> -Dan
>
> On 1/18/06, Dan Eloff <dan.eloff@gmail.com> wrote:
> > Actually it appears this is python's import behaviour. I compared this
> > behaviour to the working mod_python on another PC, and here's the
> > difference (both have a similar python path)
> >
> > Working (2.4):
> > >>> sys.path
> > ['', 'C:\\Windows\\system32\\python24.zip', 'C:\\Program
> > Files\\Python', 'C:\\Program Files\\Python\\DLLs', 'C:\\Program
> > Files\\Python\\lib', 'C:\\Program Files\\Python\\lib\\plat-win',
> > 'C:\\Program Files\\Python\\lib\\lib-tk',
> > 'C:\\Program Files\\Python\\lib\\site-packages']
> >
> > Not Working (2.4.2):
> > >>> sys.path
> > ['', 'C:\\Program Files\\Python\\python24.zip', 'C:\\Program
> > Files\\Python\\DLLs', 'C:\\Program Files\\Python\\lib', 'C:\\Program
> > Files\\Python\\lib\\plat-win',
> > 'C:\\Program Files\\Python\\lib\\lib-tk', 'C:\\Program Files\\Python',
> >  'C:\\Program Files\\Python\\lib\\site-packages']
> >
> >
> > The working one searches for mod_python in:
> > C:\Windows\system32\python24.zip
> > C:\Program Files\Python\Lib
> > C:\Program Files\Python\DLLs
> > C:\Program Files\Python\Lib\lib-tk
> > C:\Program Files\Apache Group\Apache2
> > C:\Program Files\Apache Group\Apache2\bin
> > C:\Program Files\Python
> > C:\Program Files\Python\lib\site-packages - SUCCESS
> >
> > The broken one searches for mod_python in:
> > C:\Program Files\Python\python24.zip
> > C:\Program Files\Apache Group\Apache2\DLLs
> > C:\Program Files\Apache Group\Apache2\lib
> > C:\Program Files\Apache Group\Apache2\lib\plat-win
> > C:\Program Files\Apache Group\Apache2\lib\lib-tk
> > C:\Program Files\Apache Group\Apache2\bin - GIVES UP
> >
> > Clearly python has gone beserk, replacing instances of C:\Program
> > Files\Python with Apache's directory, and not even searching
> > everything. The first thing I'm going to try is roll back to python
> > 2.4.
> >
> > -Dan
> >
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>

From dan.eloff at gmail.com  Wed Jan 18 16:00:46 2006
From: dan.eloff at gmail.com (Dan Eloff)
Date: Wed Jan 18 16:00:49 2006
Subject: [mod_python] Re: Now we're getting somewhere. Where does
	mod_python install these files?
In-Reply-To: <c298f2d70601181254x3277a8dcg@mail.gmail.com>
References: <4817b6fc0601172350h49bf5c8fkb87c7f68cc899fdb@mail.gmail.com>
	<4817b6fc0601180848i58154056v9e1c9241eaf160bc@mail.gmail.com>
	<4817b6fc0601181225k458cbb70oea0790915c0945f8@mail.gmail.com>
	<c298f2d70601181254x3277a8dcg@mail.gmail.com>
Message-ID: <4817b6fc0601181300w5767b3eds8e2e5ed30dd01abc@mail.gmail.com>

Just the standard one available off python.org. Maybe it works fine,
who knows, but it sure doesn't work for me.

-Dan

On 1/18/06, Nicolas Lehuen <nicolas.lehuen@gmail.com> wrote:
> It isn't broken for 2.4.2, I run it on a daily basis both on a
> development machine and a production server.
>
> What distribution are you using ? I'm using the ActiveState build for Win32.
>
> Regards,
> Nicolas
>
> 2006/1/18, Dan Eloff <dan.eloff@gmail.com>:
> > And rolling back to python 2.4 fixed the problem immediately. I don't
> > know if python 2.4.2 is broken, or just if mod_python is broken for
> > 2.4.2.
> >
> > -Dan
> >
> > On 1/18/06, Dan Eloff <dan.eloff@gmail.com> wrote:
> > > Actually it appears this is python's import behaviour. I compared this
> > > behaviour to the working mod_python on another PC, and here's the
> > > difference (both have a similar python path)
> > >
> > > Working (2.4):
> > > >>> sys.path
> > > ['', 'C:\\Windows\\system32\\python24.zip', 'C:\\Program
> > > Files\\Python', 'C:\\Program Files\\Python\\DLLs', 'C:\\Program
> > > Files\\Python\\lib', 'C:\\Program Files\\Python\\lib\\plat-win',
> > > 'C:\\Program Files\\Python\\lib\\lib-tk',
> > > 'C:\\Program Files\\Python\\lib\\site-packages']
> > >
> > > Not Working (2.4.2):
> > > >>> sys.path
> > > ['', 'C:\\Program Files\\Python\\python24.zip', 'C:\\Program
> > > Files\\Python\\DLLs', 'C:\\Program Files\\Python\\lib', 'C:\\Program
> > > Files\\Python\\lib\\plat-win',
> > > 'C:\\Program Files\\Python\\lib\\lib-tk', 'C:\\Program Files\\Python',
> > >  'C:\\Program Files\\Python\\lib\\site-packages']
> > >
> > >
> > > The working one searches for mod_python in:
> > > C:\Windows\system32\python24.zip
> > > C:\Program Files\Python\Lib
> > > C:\Program Files\Python\DLLs
> > > C:\Program Files\Python\Lib\lib-tk
> > > C:\Program Files\Apache Group\Apache2
> > > C:\Program Files\Apache Group\Apache2\bin
> > > C:\Program Files\Python
> > > C:\Program Files\Python\lib\site-packages - SUCCESS
> > >
> > > The broken one searches for mod_python in:
> > > C:\Program Files\Python\python24.zip
> > > C:\Program Files\Apache Group\Apache2\DLLs
> > > C:\Program Files\Apache Group\Apache2\lib
> > > C:\Program Files\Apache Group\Apache2\lib\plat-win
> > > C:\Program Files\Apache Group\Apache2\lib\lib-tk
> > > C:\Program Files\Apache Group\Apache2\bin - GIVES UP
> > >
> > > Clearly python has gone beserk, replacing instances of C:\Program
> > > Files\Python with Apache's directory, and not even searching
> > > everything. The first thing I'm going to try is roll back to python
> > > 2.4.
> > >
> > > -Dan
> > >
> >
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://mailman.modpython.org/mailman/listinfo/mod_python
> >
>

From grahamd at dscpl.com.au  Wed Jan 18 16:57:22 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Wed Jan 18 16:57:25 2006
Subject: [mod_python] reg forward page
Message-ID: <1137621442.12585@dscpl.user.openhosting.com>

python eager wrote ..
> Hi
>      from python, how to forward the psp page and how retain the values
> which are getting in python, that should be display in python server pages
> (psp). Please help me. 
>    
>   Note : in java struts is mainted this logic using findforward. Automatically
> the struts forwarded to particular jsp page. Like that i need.

It is not totally clear what you mean in some of what you ask. I would
suggest three areas of psp/mod_python that you should look at and work
out for yourself if they may or may not be appropriate in the context of
how you are doing things.

First off is that mod_python.psp pages do support the 'include' statement.

  <%@ include file="/file/to/include"%>

This will allow you to include another PSP page into the first at the point
required. It should still have access to the same request object as the parent.
See:

  http://www.modpython.org/live/current/doc-html/pyapi-psp.html

For details on PSP syntax.

If you want to be able to include within a PSP page the output of a completely
different handler into a PSP page, you may be able to use req.internal_redirect().
This method of the request object allows you to direct Apache to process a
sub request for a different URI. The URI may even map to static files or handlers
written in something other than mod_python.

Passing data through a req.internal_redirect() call can be trick. Only ways of
really doing it are to store the data in the 'notes' or 'subprocess_env'. See:

  http://www.modpython.org/live/current/doc-html/pyapi-mprequest-meth.html
  http://www.modpython.org/pipermail/mod_python/2005-April/017920.html
  http://www.modpython.org/pipermail/mod_python/2005-April/017922.html
  
Ensure you track back and forth through the mailing list discussion about
passing data through req.internal_redirect() to get the full picture.

Finally, if you want to chain the output of multiple handlers together, ie., add
after the complete output of the PSP page output from some other handler. You
can use req.add_handler(). Again see:

  http://www.modpython.org/live/current/doc-html/pyapi-mprequest-meth.html

Graham
From grahamd at dscpl.com.au  Wed Jan 18 20:14:44 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Wed Jan 18 20:14:52 2006
Subject: [mod_python] How do you use mod_python?
Message-ID: <1137633284.6230@dscpl.user.openhosting.com>

Daniel Nogradi wrote ..
> Some time ago there was a post (I think by Grisha) asking "why are you
> using mod_python?". It would be interesting to see answers from many
> users to a related question, _how_ do you use mod_python?
> 
> A little more specifically, the various ways of using mod_python that
> I have in mind (which list is very much limited by my knowledge)
> include
> 
> (1) writing custom handlers for every new project
> (2) writing a universal handler which serves various unrelated projects
> (3) using the publisher handler for every project
> (4) tweaking the publisher handler for every new project in different ways
> (5) using the publisher for some of the projects but writing new
> handlers for others
> 
> And of course there could be many more ways of using mod_python that
> just didn't come into my mind at the moment or don't even know about
> it.
> 
> So, after all, how do you use mod_python?

I don't. Well, that isn't totally true, but it is true that I never seem
to actually end up using mod_python to produce any actual applications
or web sites. I got into mod_python to try and clean up how I did my own
web site and as I always seem to do, I got so caught up in working out
how to do the infrastructure, I never get onto the real task at hand.

People who have seen how much I post on the mailing list and rant in
general about mod_python may find this surprising. Truth is, I simply
find working on the lower level architectural stuff and the development
of reusable components that others could use to be of much more
interest. I might even suggest that because my development of these
components is not strictly tied to the goal of a particular end user web
application, that I am able to look more widely at what is required in
general and provide a better library of components than may come out of
a project whose primary goal was a specific web application.

That said, I have been working now for over six months on a new package
as a successor to Vampire. This doesn't build on Vampire though, instead
I threw out Vampire and started over again, only really keeping what I
learnt from it. If people can handle another of my long rants, I'll go
into what I am up to with this new package and how it uses mod_python.
This may or may not be of interest in respect of the question of the
original poster. I promise that I am in the process of looking at
setting up my own blog and when that is done I'll take my rants there
instead and leave the mailing list alone .... :-)

Some background first. A lot of people who come to use mod_python seem
to like the great deal of flexibility it provides you as far as being
able to make a handler do what ever you want. At the same time, the
desire for this level of control usually means these same people will
not consider using a higher level package written by someone else for
mod_python. This can be understandable, as these higher level packages
usually impose one specific way of doing things and that may actually be
quite different to how a basic handler in mod_python works. Thus, one
has to buy into that way of doing things and it isn't typically possible
to combine use of such a package with other handlers written for
mod_python.

For myself, looking at how people often outright refuse to use third
party packages is really frustrating. You see people constantly
reinventing the wheel, but not necessarily doing a good job of it
because they don't always have a full understanding of how mod_python
works. Well, what I am working on now is intended to provide one with
some of the benefits of having what a higher level package can provide,
but in a componentised way that is compatible with how basic handlers
work so that you can still mix in use of existing handlers. Towards the
end of Vampire, it started to introduce some of these ideas, but it had
already been built on a more monolithic lower layer so was ultimately
doomed. Thus the need to create a new package, which I am calling Lamia.

Now, in Lamia nearly everything is a component, but where every
component respects the calling semantics of a basic mod_python handler.
Lamia does not though act as a top level dispatcher, thus, when you
specify the PythonHandler directive, you are still referring to a module
file which you create and write, how you then use the components that
Lamia provides is up to you. Thus, for the examples I provide below,
assume that you have set the Apache configuration to be:

  <Directory /some/path/root>
  SetHandler mod_python
  PythonHandler _myapp::root
  </Directory>

The directory '/some/path/root' would contain your Python module file
called '_myapp.py'. Rather than use the default entry point of "handler()",
I have explicitly specified that it be called 'root()' instead for reasons I
will not go into here.

To illustrate what I mean by "componentised", consider the most basic
task that one has to solve with mod_python. That is, how do you get URLs
mapped to a specific handler. If you specify your own handler with the
PythonHandler directive, it is basically all up to you to work this out.
One instead could use mod_python.publisher, with it providing two levels
of mapping, first to files and second to objects within files. In using
mod_python.publisher however, you have already departed from the
standard calling semantics of a basic handler and have to write your
code differently as a result. It also locks you into that particular model
though and so you have lost some measure of control.

In Lamia, the intent is that if you want to map the location from the URL
to a specific Python module file, you would use the component called
'MapLocationToModule'. The '_myapp.py' module file would then contain:

  import os
  from lamia.handlers import *

  __here__ = os.path.dirname(__file__)

  root = HandlerRoot(
    handler = MapLocationToModule(
        root_directory = __here__,
    ),
  )

Note that 'HandlerRoot' can in the main be ignored, it only needs to be
used for the root level entry point which PythonHandler calls. Its job
is to undo the URL mapping that Apache itself has done so that any
handler can reinterpret the URL itself properly.

I'll mention other issues with this file in a moment, but the end result
is that the location specified by the URL is processed and a search made
for a Python module code file below the specified root directory which
matches the request. If found, the module is automatically loaded and an
appropriate handler called.

Thus if the location within the URL rooted at this directory specifies
'index.html' and an 'index.py' file exists, if it contains a handler
function called 'handler()' then that will be called. That handler is
specified like any other basic mod_python handler function and you can
do what ever you want in it. You could from that point totally ignore
Lamia and what other components it provide. The 'index.py' file might
therefore simply contain:

  from mod_python import apache

  def handler(req):
    req.content_type = 'text/plain'
    req.write('hello world\n')
    return apache.OK

Returning to the 'root' handler in '_myapp.py'. Some may be thinking
that that isn't actually a handler function. Well, truth be known,
mod_python doesn't care if it isn't a function, it just has to be a
callable Python object. In this case it is an instance of the
'HandlerRoot' object and that object has overloaded the '__call__()'
method so it is callable. Ie., the same as saying:

  class Handler:
    def __init__(self,**args):
        ...
    def __call__(self,req):
        ...

All the components in Lamia use this technique. That is, they are
actually instances of objects, whereby keyword arguments can be supplied
to the constructor which then later customise how the component behaves
when it is actually called to handle a request. In the case of
'HandlerRoot', all it does is reset some of the attributes of the
request object and then calls the handler supplied as argument to the
constructor. That handler then being an instance of
'MapLocationToModule' which does the dispatching of the request to
another module based on the URL.

To quickly delve into how a couple of other components may be used in
the Python module file mapped to by 'MapLocationToModule', consider
the following for 'index.py'.

  from mod_python import apache

  from lama.handlers import *

  def handler_txt(req):
    req.content_type = 'text/plain'
    req.write('hello world\n')
    return apache.OK

  def handler_html(req):
    req.content_type = 'text/html'
    req.write('<html><body><p>hello world</p></body></html>')
    return apache.OK

  handler = Handlers(
    MapExtension(
      txt = handler_txt,
      html = handler_html,
    ),
    NotFound(),
  )

When 'MapLocationToModule' dispatches the request to the module, it
actually ignores any extension present on the URL. Thus, requests for
both 'index.html' and 'index.txt' would be sent to 'index.py' to be
handled.

In order to make it easier to handle responses for different extensions,
Lamia provides other components which can look at the extension and
map requests based on different extensions to different handlers. For
this example, 'MapExtension' is used. The definition of what extensions
map to what handlers is performed using keyword parameters. Again,
the target handler is a standard mod_python basic handler and you can
write it however you want.

Wrapped around 'MapExtension' you will note the 'Handlers' component.
This is a special component whose purpose is to apply each handler it
is provided in turn until one is able to fulfil the request. Thus, if a request
comes in for 'index.jpg', because there is no mapping for that extension,
the 'NotFound' component is triggered and a HTTP 404 response is
generated instead.

Note that 'MapExtension' isn't the only component that could have been
used to perform this specific task. Usually there are a few different
options depending on your tastes. Thus, you might instead have used:

  handler = Handlers(
    MapExtensionToDictionary(
      handlers = {
        '.txt': handler_txt,
        '.html': handler_html,
      }
    ),
    NotFound(),
  )

or something like:

  handler = Handlers(
    IfExtensionEquals(
      value = '.txt',
      handler = handler_txt,
    ),
    IfExtensionEquals(
      value = '.html',
      handler = handler_html,
    ),
    NotFound(),
  )

Take the case of no extension at all now, you might want to instead map that
to member functions of an object. Well you can do that as well. As a quick
example:

  class _Handlers:
    def form(req):
       ...

  object = _Handlers()

  handler = Handlers(
    MapExtensionToDictionary(
      handlers = {
        '': MapLocationToObject(
          handlers = object,
        ),
        '.txt': handler_txt,
        '.html': handler_html,
      }
    ),
    NotFound(),
  )

Now if you get a request with no extension on 'index' in the URL, the
part of that URL after that point will be mapped where possible to the
member functions of the instance of '_Handlers' class defined in that
file. So, ignoring issue of extensions on the next component of the URL
for the moment, a request of the form 'index/form' will map to the
member function called 'form'. Thus with the 'MapLocationToModule' and
'MapLocationToObject' components you are effectively doing what
mod_python.publisher is doing, but you have a lot better control over
when it is being done.

You might now start to see what I am up to. In some respect the intent
is not to change how you write the most basic handler which performs the
real work. It is to provide components which do all the hard work of
dealing with URL processing and working out which handler is called in
the first place. These components can be used selectively where required
and avoids the creation of some monolithic upper layer through which all
requests are processed and which may therefore irrevocably dictate how
your application has to be structured. The way the components are
constructed and used means you keep all the control and it is not lost to
some monolithic layer.

At the moment I have implemented over 100 components. These range from
components for mapping parts of a URL to handlers, components for
performing conditionals, components for returning error responses,
components for interogating or setting attributes in the request object,
to components for implementing basic authentication and session based
form authentication. There are even handlers which simply defer to other
higher level layers such as mod_python.publisher and mod_python.psp, or
which triggers precompiled code for such things as Cheetah templates.

The beauty of all this is that because every component is actually a
handler, there is no problem with you creating your own componentised
handlers which can be used in conjunction with what is in Lamia. For
example, I do not yet provide a component to map to WSGI, but it would
be easy for some one to do that if they wanted. You could even write
components to map to other monolithic systems such as CherryPy or
mpservlets.

In some respects, one could say that Lamia is like WSGI, except that it
is tailored specifically to how mod_python works and does not throw away
all the good stuff that mod_python has to offer.

Anyway, sorry for the long rant. In respect of the question of how are
people using mod_python, this is probably no quite the answer you had
in mind, but hope it is of interest.

In parting, I will just provide one extended example which I have been
playing with, but not yet finalised. But then, I probably shouldn't as
people will then start to think that it is all to complicated after all
and think I am loony. The example implements form/session based login
mechanism for a set of pages implemented using Cheetah, where it all
simply draws on predefined components.


    from lamia.handlers import *
    from lamia.handlers_Cheetah import *

    import _users
    import os

    _userDatabase = _users.UserDatabase()
    __here__ = os.path.dirname(__file__)

    handler = Handlers(

        IfLocationEquals(
            value = '/',
            handler = RedirectToLocation(
                location = 'index.html',
            ),
        ),

        SetHandler(
            handler_name = 'cheetah',
            handler = MapLocationToCheetah(
                directory = __here__,
                resource_extension = '.html',
                allow_path_info = False,
            ),
        ),

        CacheControl(
            directive = 'no-cache',
        ),

        CreateUserSession(),

        IfLocationMatches(
            pattern = '/_*',
            handler = NotFound(),
        ),

        IfResourceEquals(
            value = 'login.html',
            handler = MapToHandler(
                handler_name = 'cheetah',
            ),
        ),

        FormAuthentication(
            database = _userDatabase,
            login = 'login.html'
        ),

        MapToHandler(
            handler_name = 'cheetah',
        ),

        NotFound(),

    )


I should go do some real work now. ;-)

Graham


From David.Bear at asu.edu  Wed Jan 18 20:42:12 2006
From: David.Bear at asu.edu (David Bear)
Date: Wed Jan 18 20:43:06 2006
Subject: [mod_python] How do you use mod_python?
In-Reply-To: <C6894E4E-3F3A-40A8-99C6-97F6890AA005@laflamme.org>
References: <200601181441.k0IEfmen024351@modpython.org>
	<C6894E4E-3F3A-40A8-99C6-97F6890AA005@laflamme.org>
Message-ID: <20060119014212.GD21633@asu.edu>

I was hoping modpython would give me a fast way of running python
programs -- sort of like a fastcgi but focused on python programs.

Yet, I've not seen any documentation on setting this up (I admit I
have not done exhaustive reading, but I don't recall seeing this in
the howto's I've looked at).

can modpython be used as a fast way of doing execcgi and other calling
python programs from the web?  I don't think I want to create an
apache handler for this? or do I?

-- 
David Bear
phone: 	480-965-8257
fax: 	480-965-9189
College of Public Programs/ASU
Wilson Hall 232
Tempe, AZ 85287-0803
 "Beware the IP portfolio, everyone will be suspect of trespassing"
From list at joreybump.com  Wed Jan 18 20:57:32 2006
From: list at joreybump.com (Jorey Bump)
Date: Wed Jan 18 20:57:39 2006
Subject: [mod_python] How do you use mod_python?
In-Reply-To: <20060119014212.GD21633@asu.edu>
References: <200601181441.k0IEfmen024351@modpython.org>	<C6894E4E-3F3A-40A8-99C6-97F6890AA005@laflamme.org>
	<20060119014212.GD21633@asu.edu>
Message-ID: <43CEF20C.1080800@joreybump.com>

David Bear wrote:
> I was hoping modpython would give me a fast way of running python
> programs -- sort of like a fastcgi but focused on python programs.
> 
> Yet, I've not seen any documentation on setting this up (I admit I
> have not done exhaustive reading, but I don't recall seeing this in
> the howto's I've looked at).
> 
> can modpython be used as a fast way of doing execcgi and other calling
> python programs from the web?  I don't think I want to create an
> apache handler for this? or do I?

mod_python includes a CGI handler that emulates the CGI environment:

  http://www.modpython.org/live/current/doc-html/hand-cgi.html

I prefer Publisher, myself.
From dan.eloff at gmail.com  Wed Jan 18 21:15:38 2006
From: dan.eloff at gmail.com (Dan Eloff)
Date: Wed Jan 18 21:15:43 2006
Subject: [mod_python] Re: Now we're getting somewhere. Where does
	mod_python install these files?
In-Reply-To: <4817b6fc0601181300w5767b3eds8e2e5ed30dd01abc@mail.gmail.com>
References: <4817b6fc0601172350h49bf5c8fkb87c7f68cc899fdb@mail.gmail.com>
	<4817b6fc0601180848i58154056v9e1c9241eaf160bc@mail.gmail.com>
	<4817b6fc0601181225k458cbb70oea0790915c0945f8@mail.gmail.com>
	<c298f2d70601181254x3277a8dcg@mail.gmail.com>
	<4817b6fc0601181300w5767b3eds8e2e5ed30dd01abc@mail.gmail.com>
Message-ID: <4817b6fc0601181815w66bafa23x2f2cceaafa626fe7@mail.gmail.com>

I just downloaded and installed the latest python dist from
activestate and it seems to be working just fine. That's the last time
I use another distribution.

-Dan

On 1/18/06, Dan Eloff <dan.eloff@gmail.com> wrote:
> Just the standard one available off python.org. Maybe it works fine,
> who knows, but it sure doesn't work for me.
>
> -Dan
>
> On 1/18/06, Nicolas Lehuen <nicolas.lehuen@gmail.com> wrote:
> > It isn't broken for 2.4.2, I run it on a daily basis both on a
> > development machine and a production server.
> >
> > What distribution are you using ? I'm using the ActiveState build for Win32.
> >
> > Regards,
> > Nicolas
> >
> > 2006/1/18, Dan Eloff <dan.eloff@gmail.com>:
> > > And rolling back to python 2.4 fixed the problem immediately. I don't
> > > know if python 2.4.2 is broken, or just if mod_python is broken for
> > > 2.4.2.
> > >
> > > -Dan
> > >
> > > On 1/18/06, Dan Eloff <dan.eloff@gmail.com> wrote:
> > > > Actually it appears this is python's import behaviour. I compared this
> > > > behaviour to the working mod_python on another PC, and here's the
> > > > difference (both have a similar python path)
> > > >
> > > > Working (2.4):
> > > > >>> sys.path
> > > > ['', 'C:\\Windows\\system32\\python24.zip', 'C:\\Program
> > > > Files\\Python', 'C:\\Program Files\\Python\\DLLs', 'C:\\Program
> > > > Files\\Python\\lib', 'C:\\Program Files\\Python\\lib\\plat-win',
> > > > 'C:\\Program Files\\Python\\lib\\lib-tk',
> > > > 'C:\\Program Files\\Python\\lib\\site-packages']
> > > >
> > > > Not Working (2.4.2):
> > > > >>> sys.path
> > > > ['', 'C:\\Program Files\\Python\\python24.zip', 'C:\\Program
> > > > Files\\Python\\DLLs', 'C:\\Program Files\\Python\\lib', 'C:\\Program
> > > > Files\\Python\\lib\\plat-win',
> > > > 'C:\\Program Files\\Python\\lib\\lib-tk', 'C:\\Program Files\\Python',
> > > >  'C:\\Program Files\\Python\\lib\\site-packages']
> > > >
> > > >
> > > > The working one searches for mod_python in:
> > > > C:\Windows\system32\python24.zip
> > > > C:\Program Files\Python\Lib
> > > > C:\Program Files\Python\DLLs
> > > > C:\Program Files\Python\Lib\lib-tk
> > > > C:\Program Files\Apache Group\Apache2
> > > > C:\Program Files\Apache Group\Apache2\bin
> > > > C:\Program Files\Python
> > > > C:\Program Files\Python\lib\site-packages - SUCCESS
> > > >
> > > > The broken one searches for mod_python in:
> > > > C:\Program Files\Python\python24.zip
> > > > C:\Program Files\Apache Group\Apache2\DLLs
> > > > C:\Program Files\Apache Group\Apache2\lib
> > > > C:\Program Files\Apache Group\Apache2\lib\plat-win
> > > > C:\Program Files\Apache Group\Apache2\lib\lib-tk
> > > > C:\Program Files\Apache Group\Apache2\bin - GIVES UP
> > > >
> > > > Clearly python has gone beserk, replacing instances of C:\Program
> > > > Files\Python with Apache's directory, and not even searching
> > > > everything. The first thing I'm going to try is roll back to python
> > > > 2.4.
> > > >
> > > > -Dan
> > > >
> > >
> > > _______________________________________________
> > > Mod_python mailing list
> > > Mod_python@modpython.org
> > > http://mailman.modpython.org/mailman/listinfo/mod_python
> > >
> >
>

From mikeisgreat at gmail.com  Thu Jan 19 12:08:41 2006
From: mikeisgreat at gmail.com (Michael Steinfeld)
Date: Thu Jan 19 12:08:44 2006
Subject: [mod_python] openbsd mod_python
Message-ID: <3d5db09e0601190908h4c84cd0i14148ce9bce6dad4@mail.gmail.com>

I am running OpenBSD 3.8 powerpc
I compiled installed apache2.2.0 with enable .so
I added python 2.4.1 via pkg_add
I downloaded mod_python 3.1.4 compiled with apxs

built mod_python fine, im conderned about this message and how to resolve it ...

*** Warning: Trying to link with static lib archive
/usr/local/lib/python2.4/config/libpython2.4.a.
*** I have the capability to make that library automatically link in when
*** you link to this library.  But I can only do this if you have a
*** shared version of the library, which you do not appear to have
*** because the file extensions .a of this argument makes me believe
*** that it is just a static archive that I should not used here.
=================================================
trying to start apache errors ....

=================================================

# /home/mike/www/bin/apachectl start
/home/mike/www/bin/httpd:/home/mike/www/modules/mod_python.so:
undefined symbol 'PyObject_GenericGetAttr'
/home/mike/www/bin/httpd:/home/mike/www/modules/mod_python.so:
undefined symbol 'PyObject_GenericGetAttr'
/home/mike/www/bin/httpd:/home/mike/www/modules/mod_python.so:
undefined symbol 'PyObject_GenericGetAttr'
/home/mike/www/bin/httpd:/home/mike/www/modules/mod_python.so:
undefined symbol 'PyObject_GenericGetAttr'
/home/mike/www/bin/httpd:/home/mike/www/modules/mod_python.so:
undefined symbol 'PyObject_GenericSetAttr'
/home/mike/www/bin/httpd:/home/mike/www/modules/mod_python.so:
undefined symbol 'PyObject_GenericSetAttr'
/home/mike/www/bin/httpd:/home/mike/www/modules/mod_python.so:
undefined symbol '_Py_NoneStruct'
/home/mike/www/bin/httpd:/home/mike/www/modules/mod_python.so:
undefined symbol '_Py_NoneStruct'
/home/mike/www/bin/httpd:/home/mike/www/modules/mod_python.so:
undefined symbol '_Py_NoneStruct'
/home/mike/www/bin/httpd:/home/mike/www/modules/mod_python.so:
undefined symbol '_Py_NoneStruct'
/home/mike/www/bin/httpd:/home/mike/www/modules/mod_python.so:
undefined symbol '_Py_NoneStruct'
/home/mike/www/bin/httpd:/home/mike/www/modules/mod_python.so:
undefined symbol '_Py_NoneStruct'
/home/mike/www/bin/httpd:/home/mike/www/modules/mod_python.so:
undefined symbol '_Py_NoneStruct'
/home/mike/www/bin/httpd:/home/mike/www/modules/mod_python.so:
undefined symbol '_Py_NoneStruct'
/home/mike/www/bin/httpd:/home/mike/www/modules/mod_python.so:
undefined symbol 'PyExc_ValueError'
/httpd: Syntax error on line 55 of /home/mike/www/conf/httpd.conf:
Cannot load /home/mike/www/modules/mod_python.so into server: Cannot
load specified object

--
-mike

From list at joreybump.com  Thu Jan 19 12:35:13 2006
From: list at joreybump.com (Jorey Bump)
Date: Thu Jan 19 12:35:22 2006
Subject: [mod_python] openbsd mod_python
In-Reply-To: <3d5db09e0601190908h4c84cd0i14148ce9bce6dad4@mail.gmail.com>
References: <3d5db09e0601190908h4c84cd0i14148ce9bce6dad4@mail.gmail.com>
Message-ID: <43CFCDD1.9060304@joreybump.com>

Michael Steinfeld wrote:
> I am running OpenBSD 3.8 powerpc
> I compiled installed apache2.2.0 with enable .so
> I added python 2.4.1 via pkg_add
> I downloaded mod_python 3.1.4 compiled with apxs

Please use apache 2.0.x instead. You may also want to try the latest 
mod_python beta, which may contain important fixes.

No version of mod_python is compatible with apache 2.2, yet. Get it 
working with 2.0 before you attempt to tackle these compatibility 
issues. The python-dev list is definitely interested in any 
contributions or patches that will preserve compatibility between Apache 
2.x versions.

It's also nice to hear from an OpenBSD user, but since that platform is 
heavily tweaked, it's useful to test installation on another platform 
for comparison, to flag OpenBSD-specific issues.
From mikeisgreat at gmail.com  Thu Jan 19 13:17:23 2006
From: mikeisgreat at gmail.com (Michael Steinfeld)
Date: Thu Jan 19 13:17:27 2006
Subject: [mod_python] openbsd mod_python
In-Reply-To: <3d5db09e0601191014q4791a79dg449282974b0950df@mail.gmail.com>
References: <3d5db09e0601190908h4c84cd0i14148ce9bce6dad4@mail.gmail.com>
	<43CFCDD1.9060304@joreybump.com>
	<3d5db09e0601190958h7d41166eu173ce23838147159@mail.gmail.com>
	<3d5db09e0601191014q4791a79dg449282974b0950df@mail.gmail.com>
Message-ID: <3d5db09e0601191017x77f2799bk86fb9fa81842eea4@mail.gmail.com>

I forgot to mention the platform ...
that is actually running on my G5

Python 2.4.1 (#1, Sep 4 2005, 01:46:49) [GCC 4.0.0 (Apple Computer,
Inc. build 5026)]
('Darwin', 'g5', '8.4.0', 'Darwin Kernel Version 8.4.0: Tue Jan 3
18:22:10 PST 2006; root:xnu-792.6.56.obj~1/RELEASE_PPC', 'Power
Macintosh')


On 1/19/06, Michael Steinfeld <mikeisgreat@gmail.com> wrote:
> however, I thought this would be fun to look at =)
>
> [Thu Jan 19 11:24:50 2006] [notice] mod_python: Creating 32 session
> mutexes based on 256 max processes and 0 max threads.
> [Thu Jan 19 11:24:50 2006] [notice] Apache/2.2.0 (Unix)
> mod_python/3.1.4 Python/2.4.1 PHP/5.1.1 mod_ssl/2.2.0 OpenSSL/0.9.7g
> mod_chroot/0.4 configured -- resuming normal operations
> [Thu Jan 19 11:24:52 2006] [notice] mod_python: (Re)importing module
> 'mod_python.psp'
>
>
> On 1/19/06, Michael Steinfeld <mikeisgreat@gmail.com> wrote:
> > On 1/19/06, Jorey Bump <list@joreybump.com> wrote:
> > > Michael Steinfeld wrote:
> > > > I am running OpenBSD 3.8 powerpc
> > > > I compiled installed apache2.2.0 with enable .so
> > > > I added python 2.4.1 via pkg_add
> > > > I downloaded mod_python 3.1.4 compiled with apxs
> > >
> > > Please use apache 2.0.x instead. You may also want to try the latest
> > > mod_python beta, which may contain important fixes
> >
> > Yeah, there were compatability issues there as well.
> > I'll see what happens with apache 2.0
> >
> > thanks for the heads up.
> >
> > >
> > > No version of mod_python is compatible with apache 2.2, yet. Get it
> > > working with 2.0 before you attempt to tackle these compatibility
> > > issues. The python-dev list is definitely interested in any
> > > contributions or patches that will preserve compatibility between Apache
> > > 2.x versions.
> > >
> > > It's also nice to hear from an OpenBSD user, but since that platform is
> > > heavily tweaked, it's useful to test installation on another platform
> > > for comparison, to flag OpenBSD-specific issues.
> > > _______________________________________________
> > > Mod_python mailing list
> > > Mod_python@modpython.org
> > > http://mailman.modpython.org/mailman/listinfo/mod_python
> > >
> >
> >
> > --
> > -mike
> >
>
>
> --
> -mike
>


--
-mike

From mikeisgreat at gmail.com  Thu Jan 19 13:23:06 2006
From: mikeisgreat at gmail.com (Michael Steinfeld)
Date: Thu Jan 19 13:23:09 2006
Subject: [mod_python] openbsd mod_python
In-Reply-To: <3d5db09e0601191017x77f2799bk86fb9fa81842eea4@mail.gmail.com>
References: <3d5db09e0601190908h4c84cd0i14148ce9bce6dad4@mail.gmail.com>
	<43CFCDD1.9060304@joreybump.com>
	<3d5db09e0601190958h7d41166eu173ce23838147159@mail.gmail.com>
	<3d5db09e0601191014q4791a79dg449282974b0950df@mail.gmail.com>
	<3d5db09e0601191017x77f2799bk86fb9fa81842eea4@mail.gmail.com>
Message-ID: <3d5db09e0601191023t797b2557g2100e7c7c6ee92da@mail.gmail.com>

here is the same error using apache 2.0 with mod_python 3.1.4 on openbsd

# ../../www/bin/apachectl start
/home/mike/www/bin/httpd:/home/mike/www/modules/mod_python.so:
undefined symbol 'PyObject_GenericGetAttr'
/home/mike/www/bin/httpd:/home/mike/www/modules/mod_python.so:
undefined symbol 'PyObject_GenericGetAttr'
/home/mike/www/bin/httpd:/home/mike/www/modules/mod_python.so:
undefined symbol 'PyObject_GenericGetAttr'
/home/mike/www/bin/httpd:/home/mike/www/modules/mod_python.so:
undefined symbol 'PyObject_GenericGetAttr'
/home/mike/www/bin/httpd:/home/mike/www/modules/mod_python.so:
undefined symbol 'PyObject_GenericSetAttr'
/home/mike/www/bin/httpd:/home/mike/www/modules/mod_python.so:
undefined symbol 'PyObject_GenericSetAttr'
/home/mike/www/bin/httpd:/home/mike/www/modules/mod_python.so:
undefined symbol '_Py_NoneStruct'
/home/mike/www/bin/httpd:/home/mike/www/modules/mod_python.so:
undefined symbol '_Py_NoneStruct'
/home/mike/www/bin/httpd:/home/mike/www/modules/mod_python.so:
undefined symbol '_Py_NoneStruct'
/home/mike/www/bin/httpd:/home/mike/www/modules/mod_python.so:
undefined symbol '_Py_NoneStruct'
/home/mike/www/bin/httpd:/home/mike/www/modules/mod_python.so:
undefined symbol '_Py_NoneStruct'
/home/mike/www/bin/httpd:/home/mike/www/modules/mod_python.so:
undefined symbol '_Py_NoneStruct'
/home/mike/www/bin/httpd:/home/mike/www/modules/mod_python.so:
undefined symbol '_Py_NoneStruct'
/home/mike/www/bin/httpd:/home/mike/www/modules/mod_python.so:
undefined symbol '_Py_NoneStruct'
/home/mike/www/bin/httpd:/home/mike/www/modules/mod_python.so:
undefined symbol 'PyExc_ValueError'
/home/mike/www/bin/httpd:/home/mike/www/modules/mod_python.so:
undefined symbol 'PyExc_ValueError'
/home/mike/www/bin/httpd:/home/mike/www/modules/mod_python.so:
undefined symbol 'PyExc_ValueError'
/home/mike/www/bin/httpd:/home/mike/www/modules/mod_python.so:
undefined symbol 'PyExc_ValueError'
/home/mike/www/bin/httpd:/home/mike/www/modules/mod_python.so:
undefined symbol 'PyExc_ValueError'
/home/mike/www/bin/httpd:/home/mike/www/modules/mod_python.so:
undefined symbol 'PyExc_IOError'
/home/mike/www/bin/httpd:/home/mike/www/modules/mod_python.so:
undefined symbol 'PyExc_IOError'
/home/mike/www/bin/httpd:/home/mike/www/modules/mod_python.so:
undefined symbol 'PyExc_IOError'
/home/mike/www/bin/httpd:/home/mike/www/modules/mod_python.so:
undefined symbol 'PyString_Type'
/home/mike/www/bin/httpd:/home/mike/www/modules/mod_python.so:
undefined symbol 'PyString_Type'
/home/mike/www/bin/httpd:/home/mike/www/modules/mod_python.so:
undefined symbol 'PyString_Type'
/home/mike/www/bin/httpd:/home/mike/www/modules/mod_python.so:
undefined symbol 'PyString_Type'
/home/mike/www/bin/httpd:/home/mike/www/modules/mod_python.so:
undefined symbol 'PyExc_TypeError'
/home/mike/www/bin/httpd:/home/mike/www/modules/mod_python.so:
undefined symbol 'PyExc_TypeError'
/home/mike/www/bin/httpd:/home/mike/www/modules/mod_python.so:
undefined symbol 'PyExc_TypeError'
/home/mike/www/bin/httpd:/home/mSyntax error on line 232 of
/home/mike/www/conf/httpd.conf:
Cannot load /home/mike/www/modules/mod_python.so into server: Cannot
load specified object








On 1/19/06, Michael Steinfeld <mikeisgreat@gmail.com> wrote:
> I forgot to mention the platform ...
> that is actually running on my G5
>
> Python 2.4.1 (#1, Sep 4 2005, 01:46:49) [GCC 4.0.0 (Apple Computer,
> Inc. build 5026)]
> ('Darwin', 'g5', '8.4.0', 'Darwin Kernel Version 8.4.0: Tue Jan 3
> 18:22:10 PST 2006; root:xnu-792.6.56.obj~1/RELEASE_PPC', 'Power
> Macintosh')
>
>
> On 1/19/06, Michael Steinfeld <mikeisgreat@gmail.com> wrote:
> > however, I thought this would be fun to look at =)
> >
> > [Thu Jan 19 11:24:50 2006] [notice] mod_python: Creating 32 session
> > mutexes based on 256 max processes and 0 max threads.
> > [Thu Jan 19 11:24:50 2006] [notice] Apache/2.2.0 (Unix)
> > mod_python/3.1.4 Python/2.4.1 PHP/5.1.1 mod_ssl/2.2.0 OpenSSL/0.9.7g
> > mod_chroot/0.4 configured -- resuming normal operations
> > [Thu Jan 19 11:24:52 2006] [notice] mod_python: (Re)importing module
> > 'mod_python.psp'
> >
> >
> > On 1/19/06, Michael Steinfeld <mikeisgreat@gmail.com> wrote:
> > > On 1/19/06, Jorey Bump <list@joreybump.com> wrote:
> > > > Michael Steinfeld wrote:
> > > > > I am running OpenBSD 3.8 powerpc
> > > > > I compiled installed apache2.2.0 with enable .so
> > > > > I added python 2.4.1 via pkg_add
> > > > > I downloaded mod_python 3.1.4 compiled with apxs
> > > >
> > > > Please use apache 2.0.x instead. You may also want to try the latest
> > > > mod_python beta, which may contain important fixes
> > >
> > > Yeah, there were compatability issues there as well.
> > > I'll see what happens with apache 2.0
> > >
> > > thanks for the heads up.
> > >
> > > >
> > > > No version of mod_python is compatible with apache 2.2, yet. Get it
> > > > working with 2.0 before you attempt to tackle these compatibility
> > > > issues. The python-dev list is definitely interested in any
> > > > contributions or patches that will preserve compatibility between Apache
> > > > 2.x versions.
> > > >
> > > > It's also nice to hear from an OpenBSD user, but since that platform is
> > > > heavily tweaked, it's useful to test installation on another platform
> > > > for comparison, to flag OpenBSD-specific issues.
> > > > _______________________________________________
> > > > Mod_python mailing list
> > > > Mod_python@modpython.org
> > > > http://mailman.modpython.org/mailman/listinfo/mod_python
> > > >
> > >
> > >
> > > --
> > > -mike
> > >
> >
> >
> > --
> > -mike
> >
>
>
> --
> -mike
>


--
-mike

From captain.fleming at gmail.com  Thu Jan 19 13:40:08 2006
From: captain.fleming at gmail.com (Captain.Fleming)
Date: Thu Jan 19 13:39:26 2006
Subject: [mod_python] mod_python tutorial?
Message-ID: <43CFDD08.50405@gmail.com>

Hey, I am a python programmer (duh), but not for that long...
I have discovered mod_python, yet I do not know a good tutorial of how 
to use it...
Since I was surprised in the strength of python, I would like to use 
that, in stead of PHP
Are there any suggestions?

Lots of thanks!
CPF

From list at joreybump.com  Thu Jan 19 14:15:13 2006
From: list at joreybump.com (Jorey Bump)
Date: Thu Jan 19 14:15:21 2006
Subject: [mod_python] mod_python tutorial?
In-Reply-To: <43CFDD08.50405@gmail.com>
References: <43CFDD08.50405@gmail.com>
Message-ID: <43CFE541.6090608@joreybump.com>

Captain.Fleming wrote:
> Hey, I am a python programmer (duh), but not for that long...
> I have discovered mod_python, yet I do not know a good tutorial of how 
> to use it...
> Since I was surprised in the strength of python, I would like to use 
> that, in stead of PHP
> Are there any suggestions?

mod_python works at a lower level than PHP. There are many high level 
handlers from which to choose. mod_python includes Publisher & PSP. My 
recommendation to any beginner is to read the complete (but short) 
documentation:

  http://www.modpython.org/live/current/doc-html/

Try out the included handlers before trying to write your own. Take a 
look at other handlers that are available. Then choose the one that 
suits your style or write your own.

Remember that mod_python attempts to leverage Python, so much of the 
functionality is provided by modules in the standard library or in 
site-packages, with mod_python providing an interface to Apache. Some 
handlers are more transparent than others, depending on their design 
goals. This means that you will often be looking outside of mod_python 
when trying to find features or functionality similar to PHP.
From sean at barriescene.com  Thu Jan 19 15:35:34 2006
From: sean at barriescene.com (Sean Jamieson)
Date: Thu Jan 19 15:35:44 2006
Subject: [mod_python] PYC download prompt
Message-ID: <43CFF816.8020509@barriescene.com>

Has anyone else run into the problem, that when there is some unknown 
error with mod_python it spits out the .pyc version of your source code? 
either that or gives a File Not Found (rather than a useful error)?

I have a source that is working fine on my laptop:
Apache/2.0.54 (Ubuntu) mod_python/3.1.3 Python/2.4.2
and my dev server has the same setup...

What happend when I copied the source to my dev server was:
1) I got a Not Found error
2) I refreshed
3) I was given the .pyc for the file requested

again, this works fine on my laptop which is using the same 
OS/apache/python/mod_python
there maybe some minor differences in apache config, but nothing that I 
know of which would affect mod_python.

Can anyone give me a clue as to where I should try looking?

Sean
From dg at sponsera.com  Thu Jan 19 15:56:30 2006
From: dg at sponsera.com (David Geller)
Date: Thu Jan 19 15:56:37 2006
Subject: [mod_python] How do you use mod_python?
In-Reply-To: <43CEF20C.1080800@joreybump.com>
References: <200601181441.k0IEfmen024351@modpython.org>	<C6894E4E-3F3A-40A8-99C6-97F6890AA005@laflamme.org>	<20060119014212.GD21633@asu.edu>
	<43CEF20C.1080800@joreybump.com>
Message-ID: <43CFFCFE.7090201@sponsera.com>

Hi all,

Well, my use of mod_python for developing web apps has been progressive 
and gradual.

The first use (when I was just learning Python) was for a simple rss 
reader - and there, I wrote custom handlers, doing everything "by hand". 
Even the database was done "raw" - no ORM's or anything fancy.

Next, I discovered Cheetah, and combined it with mod_python. Which was 
cool, and worked for what I needed to do - but then my needs were simple.

After looking and evaluating what seems like dozens of packages (which I 
try continually to do at least a little of) I came to what I still think 
is one of the best packages out there for advanced templating and 
providing a basic framework for complex applications: Myghty. The 
package is superb, the documentation second to none (which is very 
important), and the support from the author, Mike Bayer, and the 
community excellent. Due to its high-level nature, it distances your 
application from mod_python, and in fact supports mod_python among other 
python web interfaces transparently.

Using mod_python, Myghty, FormEncode and SqlObject, I wrote a 
forum/bulletin board system called Topicale (which, alas, I have not had 
time to refine to where I feel comfortable to release !) Also wrote an 
extensive package for doing questionnaires on the web, which was 
deployed and used extensively for almost two years.

We now operate a family of dynamically-concocted websites for obtaining 
leads for professionals (www.capitalcounselors.com is one example) - 
they use mod_python, along with Myghty.

I am now looking into this new database package, also by Mike Bayer, 
called Sqlalchemy. I may not quite be ready for prime time, but it looks 
extremely promising for all things database in Python. It separates 
schema definitions from objects, and lets you combine the two in a 
multitude of ways which seems really flexible.

Anyway, if you want to use Apache, mod_python works just fine. And if 
you use something like Myghty, it makes things much much easier and 
opens up a world of possibilities with minimal work (although, as usual, 
things tend to always take more work than they should!).

Cheers-
David


From grahamd at dscpl.com.au  Thu Jan 19 16:32:16 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Thu Jan 19 16:32:23 2006
Subject: [mod_python] openbsd mod_python
Message-ID: <1137706336.26846@dscpl.user.openhosting.com>

I am confused. Are you running bog standard OpenBSD, Apple retail version
of Mac OS X or Darwin?

If you are running Mac OS X, the problem you are seeing may be because you
are starting up Apache with mod_python where mod_python was built against
Python 2.4.1, but the 'python' executable which is first found in your PATH
is that supplied with Mac OS X, ie. /usr/bin/python (2.3).

Thus, if manually starting Apache using 'apachectl', make sure that 'python'
found in your PATH is Python 2.4.1 version.

I also would suggest that you perhaps trying building mod_python with the
standard version of Python shipped with Mac OS X instead of 2.4.1 to see if
you get any further. Also try using mod_python 3.2.6 instead as well as it
includes fixes for issues that would sometime cause problems on Mac OS X.

Graham

Michael Steinfeld wrote ..
> here is the same error using apache 2.0 with mod_python 3.1.4 on openbsd
> 
> # ../../www/bin/apachectl start
> /home/mike/www/bin/httpd:/home/mike/www/modules/mod_python.so:
> undefined symbol 'PyObject_GenericGetAttr'
> /home/mike/www/bin/httpd:/home/mike/www/modules/mod_python.so:
> undefined symbol 'PyObject_GenericGetAttr'
> /home/mike/www/bin/httpd:/home/mike/www/modules/mod_python.so:
> undefined symbol 'PyObject_GenericGetAttr'
> /home/mike/www/bin/httpd:/home/mike/www/modules/mod_python.so:
> undefined symbol 'PyObject_GenericGetAttr'
> /home/mike/www/bin/httpd:/home/mike/www/modules/mod_python.so:
> undefined symbol 'PyObject_GenericSetAttr'
> /home/mike/www/bin/httpd:/home/mike/www/modules/mod_python.so:
> undefined symbol 'PyObject_GenericSetAttr'
> /home/mike/www/bin/httpd:/home/mike/www/modules/mod_python.so:
> undefined symbol '_Py_NoneStruct'
> /home/mike/www/bin/httpd:/home/mike/www/modules/mod_python.so:
> undefined symbol '_Py_NoneStruct'
> /home/mike/www/bin/httpd:/home/mike/www/modules/mod_python.so:
> undefined symbol '_Py_NoneStruct'
> /home/mike/www/bin/httpd:/home/mike/www/modules/mod_python.so:
> undefined symbol '_Py_NoneStruct'
> /home/mike/www/bin/httpd:/home/mike/www/modules/mod_python.so:
> undefined symbol '_Py_NoneStruct'
> /home/mike/www/bin/httpd:/home/mike/www/modules/mod_python.so:
> undefined symbol '_Py_NoneStruct'
> /home/mike/www/bin/httpd:/home/mike/www/modules/mod_python.so:
> undefined symbol '_Py_NoneStruct'
> /home/mike/www/bin/httpd:/home/mike/www/modules/mod_python.so:
> undefined symbol '_Py_NoneStruct'
> /home/mike/www/bin/httpd:/home/mike/www/modules/mod_python.so:
> undefined symbol 'PyExc_ValueError'
> /home/mike/www/bin/httpd:/home/mike/www/modules/mod_python.so:
> undefined symbol 'PyExc_ValueError'
> /home/mike/www/bin/httpd:/home/mike/www/modules/mod_python.so:
> undefined symbol 'PyExc_ValueError'
> /home/mike/www/bin/httpd:/home/mike/www/modules/mod_python.so:
> undefined symbol 'PyExc_ValueError'
> /home/mike/www/bin/httpd:/home/mike/www/modules/mod_python.so:
> undefined symbol 'PyExc_ValueError'
> /home/mike/www/bin/httpd:/home/mike/www/modules/mod_python.so:
> undefined symbol 'PyExc_IOError'
> /home/mike/www/bin/httpd:/home/mike/www/modules/mod_python.so:
> undefined symbol 'PyExc_IOError'
> /home/mike/www/bin/httpd:/home/mike/www/modules/mod_python.so:
> undefined symbol 'PyExc_IOError'
> /home/mike/www/bin/httpd:/home/mike/www/modules/mod_python.so:
> undefined symbol 'PyString_Type'
> /home/mike/www/bin/httpd:/home/mike/www/modules/mod_python.so:
> undefined symbol 'PyString_Type'
> /home/mike/www/bin/httpd:/home/mike/www/modules/mod_python.so:
> undefined symbol 'PyString_Type'
> /home/mike/www/bin/httpd:/home/mike/www/modules/mod_python.so:
> undefined symbol 'PyString_Type'
> /home/mike/www/bin/httpd:/home/mike/www/modules/mod_python.so:
> undefined symbol 'PyExc_TypeError'
> /home/mike/www/bin/httpd:/home/mike/www/modules/mod_python.so:
> undefined symbol 'PyExc_TypeError'
> /home/mike/www/bin/httpd:/home/mike/www/modules/mod_python.so:
> undefined symbol 'PyExc_TypeError'
> /home/mike/www/bin/httpd:/home/mSyntax error on line 232 of
> /home/mike/www/conf/httpd.conf:
> Cannot load /home/mike/www/modules/mod_python.so into server: Cannot
> load specified object
> 
> 
> 
> 
> 
> 
> 
> 
> On 1/19/06, Michael Steinfeld <mikeisgreat@gmail.com> wrote:
> > I forgot to mention the platform ...
> > that is actually running on my G5
> >
> > Python 2.4.1 (#1, Sep 4 2005, 01:46:49) [GCC 4.0.0 (Apple Computer,
> > Inc. build 5026)]
> > ('Darwin', 'g5', '8.4.0', 'Darwin Kernel Version 8.4.0: Tue Jan 3
> > 18:22:10 PST 2006; root:xnu-792.6.56.obj~1/RELEASE_PPC', 'Power
> > Macintosh')
> >
> >
> > On 1/19/06, Michael Steinfeld <mikeisgreat@gmail.com> wrote:
> > > however, I thought this would be fun to look at =)
> > >
> > > [Thu Jan 19 11:24:50 2006] [notice] mod_python: Creating 32 session
> > > mutexes based on 256 max processes and 0 max threads.
> > > [Thu Jan 19 11:24:50 2006] [notice] Apache/2.2.0 (Unix)
> > > mod_python/3.1.4 Python/2.4.1 PHP/5.1.1 mod_ssl/2.2.0 OpenSSL/0.9.7g
> > > mod_chroot/0.4 configured -- resuming normal operations
> > > [Thu Jan 19 11:24:52 2006] [notice] mod_python: (Re)importing module
> > > 'mod_python.psp'
> > >
> > >
> > > On 1/19/06, Michael Steinfeld <mikeisgreat@gmail.com> wrote:
> > > > On 1/19/06, Jorey Bump <list@joreybump.com> wrote:
> > > > > Michael Steinfeld wrote:
> > > > > > I am running OpenBSD 3.8 powerpc
> > > > > > I compiled installed apache2.2.0 with enable .so
> > > > > > I added python 2.4.1 via pkg_add
> > > > > > I downloaded mod_python 3.1.4 compiled with apxs
> > > > >
> > > > > Please use apache 2.0.x instead. You may also want to try the latest
> > > > > mod_python beta, which may contain important fixes
> > > >
> > > > Yeah, there were compatability issues there as well.
> > > > I'll see what happens with apache 2.0
> > > >
> > > > thanks for the heads up.
> > > >
> > > > >
> > > > > No version of mod_python is compatible with apache 2.2, yet. Get
> it
> > > > > working with 2.0 before you attempt to tackle these compatibility
> > > > > issues. The python-dev list is definitely interested in any
> > > > > contributions or patches that will preserve compatibility between
> Apache
> > > > > 2.x versions.
> > > > >
> > > > > It's also nice to hear from an OpenBSD user, but since that platform
> is
> > > > > heavily tweaked, it's useful to test installation on another platform
> > > > > for comparison, to flag OpenBSD-specific issues.
> > > > > _______________________________________________
> > > > > Mod_python mailing list
> > > > > Mod_python@modpython.org
> > > > > http://mailman.modpython.org/mailman/listinfo/mod_python
> > > > >
> > > >
> > > >
> > > > --
> > > > -mike
> > > >
> > >
> > >
> > > --
> > > -mike
> > >
> >
> >
> > --
> > -mike
> >
> 
> 
> --
> -mike
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
From nogradi at gmail.com  Thu Jan 19 16:41:46 2006
From: nogradi at gmail.com (Daniel Nogradi)
Date: Thu Jan 19 16:41:50 2006
Subject: [mod_python] How do you use mod_python?
In-Reply-To: <3E52FE5C-9788-4C1E-BEDD-3E2AAAA9B199@comcast.net>
References: <5f56302b0601180350p657c4a8dqbf89224d8dd345db@mail.gmail.com>
	<3E52FE5C-9788-4C1E-BEDD-3E2AAAA9B199@comcast.net>
Message-ID: <5f56302b0601191341w7d1c4402n4991bfc5b41c80bc@mail.gmail.com>

Thanks all for the numerous replies!

The way I use modpython is through the publisher handler, but just around
these days I thought about writing another handler to have more control over
mapping url-s to code. But I don't think a single handler will solve every
problem of every project and the answers I got seem to confirm this.

> For myself, looking at how people often outright refuse to use third
> party packages is really frustrating.

Well, I think there are very good reasons for sticking to 'core' packages
and staying away from third party stuff and that's reliablility. Take
mod_python for example, since it's associated to ASF one can be more or less
sure that it will be maintained, bugfixed, etc. But even though your Vampire
package is probably great and flexible, you just said yourself that you will
drop it soon and come up with a different design. What if in 2 years you
decide to drop this one again and come up with an even better one with no
backward compatibility? I think uncertainities of these type are the factors
that keep users away from not very mature projects, even though they are
excellent piece of software. Stable and reliable maintainance on a long run
is equally important.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20060119/d34a57d7/attachment.html
From luismg at gmx.net  Thu Jan 19 16:49:11 2006
From: luismg at gmx.net (Luis M. Gonzalez)
Date: Thu Jan 19 16:49:11 2006
Subject: [mod_python] Sessions again...
Message-ID: <003801c61d42$30ca2900$f8dbebc9@luis>

Hi folks,

I made significant progress since I started playing with mod_python last week-end,
and I created a shopping cart and a script for handling pagination of recorsets with record navigation bars.
Everything works great, except for one little problem:

If I test one of these scripts (any of them), it works great, but if I test the other one without restarting the browser, I get a strange error message that, I guess, has to do with session variables.
This is the error message:

Mod_python error: "PythonHandler mod_python.psp"

Traceback (most recent call last):

  File "C:\Python24\Lib\site-packages\mod_python\apache.py", line 299, in HandlerDispatch
    result = object(req)

  File "C:\Python24\Lib\site-packages\mod_python\psp.py", line 302, in handler
    p.run()

  File "C:\Python24\Lib\site-packages\mod_python\psp.py", line 213, in run
    exec code in global_scope

  File "C:/Archivos de programa/Apache Group/Apache2/htdocs/test/zzxx.psp", line 18, in ?
    tmpl.run(vars = {   'dbmodule': dbmodule,

  File "C:\Python24\Lib\site-packages\mod_python\psp.py", line 213, in run
    exec code in global_scope

  File "C:/Archivos de programa/Apache Group/Apache2/htdocs/test\recset.tmpl", line 111, in ?
    r.counter = s['counter']

KeyError: 'counter'
Here, "counter" is a session variable I defined in one of these scripts.
If I test the other script first and then this one, I get the same error message, but instead of pinting to "counter", it points to "items", which is the other session variable.

Summing up:
Each script works great when tested first, but the second one gives me this error message.
On the other hand, If I test them separately (restarting the browser for each one), they both work great.

What could be the problem?
Any hint would be highy appreciated...

Best regards,
Luis
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20060119/0c3a9f35/attachment.html
From grahamd at dscpl.com.au  Thu Jan 19 17:22:28 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Thu Jan 19 17:22:30 2006
Subject: [mod_python] How do you use mod_python?
Message-ID: <1137709348.25917@dscpl.user.openhosting.com>

Daniel Nogradi wrote ..
> Thanks all for the numerous replies!
> 
> The way I use modpython is through the publisher handler, but just around
> these days I thought about writing another handler to have more control
> over
> mapping url-s to code. But I don't think a single handler will solve every
> problem of every project and the answers I got seem to confirm this.
> 
> > For myself, looking at how people often outright refuse to use third
> > party packages is really frustrating.
> 
> Well, I think there are very good reasons for sticking to 'core' packages
> and staying away from third party stuff and that's reliablility. Take
> mod_python for example, since it's associated to ASF one can be more or
> less
> sure that it will be maintained, bugfixed, etc. But even though your Vampire
> package is probably great and flexible, you just said yourself that you
> will
> drop it soon and come up with a different design. What if in 2 years you
> decide to drop this one again and come up with an even better one with
> no
> backward compatibility? I think uncertainities of these type are the factors
> that keep users away from not very mature projects, even though they are
> excellent piece of software. Stable and reliable maintainance on a long
> run
> is equally important.

Reasonable comments. Although is some cases the justification that
people give for not using third party software is a bit silly. The worst
I have seen are Debian fanatics who wil refuse to use a package if it is
not available as a Debian package. I have even seen some cases where
they wouldn't use a newer verison of mod_python because it hadn't been
packaged yet, even though it fixed the problem they were having.

For Vampire at least, it will not dissappear and I will still make it
available and support it as need be even if I don't further develop it.
If I do make it unavailable, it would only be after many many years and
I was confident no one was using it or interested in it any more. That
is the way I work, although I accept that other developers may not have
the same attitude.

If you want some evidence that I don't give up on packages completely,
check out a package called OSE (http://ose.sourceforge.net) some time. I
started this package in 1990 and it was first made freely available in
1993. Although I am not actively extending it, given that it is more or
less feature complete for what its purpose was, I still make the
occasional release to address issues or make minor additions. If I can
just get my documentation sorted out, I will even take the beta tag off
the latest version, but this mod_python stuff has distracted me. :-)

Overall I think the biggest problem with many third party packages is
that people who develop them come mainly from the perspective of an
application developer. They work out what is required for the
application at hand but without too much thought of structuring the
underlying layers as a good reusable framework in itself. I truly
believe that to write good reusable code you need to have a completely
different mindset and not many are really good at that. If I am going to
use a third party package, I am thus more concerned about how it is
implemented and structured. If the code inside is a piece of crap and
the developer does stop looking after it, then I would obviously have
more issues than if the code was well structured. At least if the code
is well structured one is going to have more confidence that you could
maintain it yourself if need be. Most users though aren't generally
prepared to step up and do that and just expect everything to be
provided and done for them by others.


Graham
From jpg at jgassociates.ca  Thu Jan 19 17:25:12 2006
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Thu Jan 19 17:23:14 2006
Subject: [mod_python] Sessions again...
In-Reply-To: <003801c61d42$30ca2900$f8dbebc9@luis>
References: <003801c61d42$30ca2900$f8dbebc9@luis>
Message-ID: <43D011C8.7050906@jgassociates.ca>

Luis M. Gonzalez wrote:
> Hi folks,
> 
> I made significant progress since I started playing with mod_python last week-end,
> and I created a shopping cart and a script for handling pagination of recorsets with record navigation bars.
> Everything works great, except for one little problem:
> 
> If I test one of these scripts (any of them), it works great, but if I test the other one without restarting the browser, I get a strange error message that, I guess, has to do with session variables.
> This is the error message:
> 
> Mod_python error: "PythonHandler mod_python.psp"
> 
> Traceback (most recent call last):
> 
>   File "C:\Python24\Lib\site-packages\mod_python\apache.py", line 299, in HandlerDispatch
>     result = object(req)
> 
>   File "C:\Python24\Lib\site-packages\mod_python\psp.py", line 302, in handler
>     p.run()
> 
>   File "C:\Python24\Lib\site-packages\mod_python\psp.py", line 213, in run
>     exec code in global_scope
> 
>   File "C:/Archivos de programa/Apache Group/Apache2/htdocs/test/zzxx.psp", line 18, in ?
>     tmpl.run(vars = {   'dbmodule': dbmodule,
> 
>   File "C:\Python24\Lib\site-packages\mod_python\psp.py", line 213, in run
>     exec code in global_scope
> 
>   File "C:/Archivos de programa/Apache Group/Apache2/htdocs/test\recset.tmpl", line 111, in ?
>     r.counter = s['counter']
> 
> KeyError: 'counter'
> Here, "counter" is a session variable I defined in one of these scripts.
> If I test the other script first and then this one, I get the same error message, but instead of pinting to "counter", it points to "items", which is the other session variable.
> 
> Summing up:
> Each script works great when tested first, but the second one gives me this error message.
> On the other hand, If I test them separately (restarting the browser for each one), they both work great.
> 
> What could be the problem?
> Any hint would be highy appreciated...

You'll need to clarify your problem a little, but I think you may be 
assuming that you get a different session object for each script. That 
is not the case, at least by default. You get one session object per 
browser so if you want to use it in independent scripts, each script 
will need to catch the KeyError exception or do some other test to see 
if you need to initialize your session data.

You can also do some thing like this:

r.counter = sess.get('counter', 0)
...
...
r.counter += 1
sess['counter'] = r.counter
sess.save()

Jim
From grahamd at dscpl.com.au  Thu Jan 19 17:27:40 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Thu Jan 19 17:37:46 2006
Subject: [mod_python] PYC download prompt
Message-ID: <1137709660.29214@dscpl.user.openhosting.com>

Sean Jamieson wrote ..
> Has anyone else run into the problem, that when there is some unknown 
> error with mod_python it spits out the .pyc version of your source code?
> either that or gives a File Not Found (rather than a useful error)?
> 
> I have a source that is working fine on my laptop:
> Apache/2.0.54 (Ubuntu) mod_python/3.1.3 Python/2.4.2
> and my dev server has the same setup...
> 
> What happend when I copied the source to my dev server was:
> 1) I got a Not Found error
> 2) I refreshed
> 3) I was given the .pyc for the file requested
> 
> again, this works fine on my laptop which is using the same 
> OS/apache/python/mod_python
> there maybe some minor differences in apache config, but nothing that I
> know of which would affect mod_python.
> 
> Can anyone give me a clue as to where I should try looking?

One can get wierd things like this happening if you have MultiViews
enabled and are using URLs which have no extensions.

So for starters try using:

  Options -MultiViews

in your Apache configuration and see if things change.

Also, what handler are you using, your own, mod_python.publisher
or something else? It is possible that you might be hitting one of
the issues since fixed in mod_python 3.2.

Graham
From luismg at gmx.net  Thu Jan 19 17:49:07 2006
From: luismg at gmx.net (Luis M. Gonzalez)
Date: Thu Jan 19 17:49:07 2006
Subject: [mod_python] Sessions again...
References: <003801c61d42$30ca2900$f8dbebc9@luis>
	<43D011C8.7050906@jgassociates.ca>
Message-ID: <000d01c61d4a$9075c320$f8dbebc9@luis>

Ok, Jim, I'll clarify the problem:
Both scripts initiate their sessions the same way and with the same name:

Script nr.1:

    s= Session.Session(req)
    if s.is_new():
       s['items'] = {}

Script nr.2:

    s= Session.Session(req)
    if s.is_new():
       s['counter'] = 0

I did it this way because I asume that for using both scripts in the same 
site, I should have only one session started.
(Note that I also tried starting different sessions for each script, with 
different names, but the problem persists).

Actually, I already fixed this problem (with a wacky work-around though...).
In each script, I created the session variable corresponding to the other 
script, as follows:

Script nr.1:

    s = Session.Session(req)
    if s.is_new():
        s['counter'] = 0
        s['items']= {} # workaround to avoid trouble with cart script

Script nr.2:

    s = Session.Session(req)
    if s.is_new():
        s['items']= {}
        s['counter'] = 0 # workaround to avoid trouble with recset script

Well, this fixed the problem in this case, but i don't think this woraround 
fits into mod_python's best practices...

Luis



> You'll need to clarify your problem a little, but I think you may be 
> assuming that you get a different session object for each script. That is 
> not the case, at least by default. You get one session object per browser 
> so if you want to use it in independent scripts, each script will need to 
> catch the KeyError exception or do some other test to see if you need to 
> initialize your session data.
>
> You can also do some thing like this:
>
> r.counter = sess.get('counter', 0)
> ...
> ...
> r.counter += 1
> sess['counter'] = r.counter
> sess.save()
>
> Jim
> 

From grahamd at dscpl.com.au  Thu Jan 19 17:51:17 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Thu Jan 19 17:51:21 2006
Subject: [mod_python] Sessions again...
Message-ID: <1137711077.11628@dscpl.user.openhosting.com>

Jim Gallacher wrote ..
> Luis M. Gonzalez wrote:
> > What could be the problem?
> > Any hint would be highy appreciated...
> 
> You'll need to clarify your problem a little, but I think you may be 
> assuming that you get a different session object for each script. That
> is not the case, at least by default. You get one session object per 
> browser so if you want to use it in independent scripts, each script 
> will need to catch the KeyError exception or do some other test to see
> if you need to initialize your session data.

Would more or less agree with Jim, but also point out that if you do
need distinct session objects to be used for different parts of your URL
namespace, you really need to put the distinct scripts in different
directories and for each directory root to have its own PythonHandler
directive. From memory that is enough to trigger a different context
for sessions to operate in.

Otherwise you need to be setting the ApplicationPath option value in
the Apache configuration so it is different for each part of the URL
namespace. That is still going to be hard if you have all your scripts
in the same directory. There is reference to ApplicationPath in:

  http://www.modpython.org/live/current/doc-html/pyapi-sess-classes.html

It is probably not obvious though what the option is really about.

Graham
From list at joreybump.com  Thu Jan 19 17:52:12 2006
From: list at joreybump.com (Jorey Bump)
Date: Thu Jan 19 17:52:21 2006
Subject: [mod_python] How do you use mod_python?
In-Reply-To: <1137709348.25917@dscpl.user.openhosting.com>
References: <1137709348.25917@dscpl.user.openhosting.com>
Message-ID: <43D0181C.8020402@joreybump.com>

Graham Dumpleton wrote:

> Reasonable comments. Although is some cases the justification that
> people give for not using third party software is a bit silly. The worst
> I have seen are Debian fanatics who wil refuse to use a package if it is
> not available as a Debian package. I have even seen some cases where
> they wouldn't use a newer verison of mod_python because it hadn't been
> packaged yet, even though it fixed the problem they were having.

Having run Debian systems in production, I'll say that the main appeal 
is the ease with which it can be maintained, as long as you stay within 
the package system. Unfortunately, Sarge didn't live up to my 
expectations, so I've moved on to something else. Woody was incredible, 
though.


From grahamd at dscpl.com.au  Thu Jan 19 18:01:33 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Thu Jan 19 18:01:37 2006
Subject: [mod_python] Sessions again...
Message-ID: <1137711693.18375@dscpl.user.openhosting.com>

Luis M. Gonzalez wrote ..
> Ok, Jim, I'll clarify the problem:
> Both scripts initiate their sessions the same way and with the same name:
> 
> Script nr.1:
> 
>     s= Session.Session(req)
>     if s.is_new():
>        s['items'] = {}
> 
> Script nr.2:
> 
>     s= Session.Session(req)
>     if s.is_new():
>        s['counter'] = 0
> 
> I did it this way because I asume that for using both scripts in the same
> site, I should have only one session started.
> (Note that I also tried starting different sessions for each script, with
> different names, but the problem persists).
> 
> Actually, I already fixed this problem (with a wacky work-around though...).
> In each script, I created the session variable corresponding to the other
> script, as follows:

That is not a wacky work around, it is what must be done. For any
scripts which are located under the same PythonHandler directive, the
session object initialisation, ie., what is done when s.is_new() is
true, must be the same for all scripts. If not done like this, as you
are finding, when the other script is run it will be missing what it
needs as it hasn't has the opportunity to do its initialisation. The
other option as Jim pointed out is to effectively ignore s.is_new() and
simply add a default for the value if the attribute isn't present.

In general it is a good idea to separate out initialisation for a new
session object into a separate common routine which all scripts call, if
there are special attributes which need to be set up.

Graham

> Script nr.1:
> 
>     s = Session.Session(req)
>     if s.is_new():
>         s['counter'] = 0
>         s['items']= {} # workaround to avoid trouble with cart script
> 
> Script nr.2:
> 
>     s = Session.Session(req)
>     if s.is_new():
>         s['items']= {}
>         s['counter'] = 0 # workaround to avoid trouble with recset script
> 
> Well, this fixed the problem in this case, but i don't think this woraround
> fits into mod_python's best practices...
> 
> Luis
> 
> 
> 
> > You'll need to clarify your problem a little, but I think you may be
> > assuming that you get a different session object for each script. That
> is 
> > not the case, at least by default. You get one session object per browser
> > so if you want to use it in independent scripts, each script will need
> to 
> > catch the KeyError exception or do some other test to see if you need
> to 
> > initialize your session data.
> >
> > You can also do some thing like this:
> >
> > r.counter = sess.get('counter', 0)
> > ...
> > ...
> > r.counter += 1
> > sess['counter'] = r.counter
> > sess.save()
> >
> > Jim
> > 
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
From jpg at jgassociates.ca  Thu Jan 19 19:17:59 2006
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Thu Jan 19 19:15:24 2006
Subject: [mod_python] Sessions again...
In-Reply-To: <000d01c61d4a$9075c320$f8dbebc9@luis>
References: <003801c61d42$30ca2900$f8dbebc9@luis>	<43D011C8.7050906@jgassociates.ca>
	<000d01c61d4a$9075c320$f8dbebc9@luis>
Message-ID: <43D02C37.3000609@jgassociates.ca>

Luis M. Gonzalez wrote:
> Ok, Jim, I'll clarify the problem:
> Both scripts initiate their sessions the same way and with the same name:
> 
> Script nr.1:
> 
>    s= Session.Session(req)
>    if s.is_new():
>       s['items'] = {}
> 
> Script nr.2:
> 
>    s= Session.Session(req)
>    if s.is_new():
>       s['counter'] = 0
> 
> I did it this way because I asume that for using both scripts in the 
> same site, I should have only one session started.

You are correct, but as you've discovered the order that the scripts are 
called by the client will effect which initialization routine will be 
executed. This is one of the things that can make using sessions tricky.

> (Note that I also tried starting different sessions for each script, 
> with different names, but the problem persists).

The name is not relevant. The thing that counts is the value of the 
pysid cookie which is set in the browser. It is this cookie that 
determines which session will be instantiated when Session.Session is 
called. A new session is created if there is no cookie, otherwise the 
corresponding session data is pulled from the persistent store.

> Actually, I already fixed this problem (with a wacky work-around 
> though...).
> In each script, I created the session variable corresponding to the 
> other script, as follows:
> 
> Script nr.1:
> 
>    s = Session.Session(req)
>    if s.is_new():
>        s['counter'] = 0
>        s['items']= {} # workaround to avoid trouble with cart script
> 
> Script nr.2:
> 
>    s = Session.Session(req)
>    if s.is_new():
>        s['items']= {}
>        s['counter'] = 0 # workaround to avoid trouble with recset script
> 
> Well, this fixed the problem in this case, but i don't think this 
> woraround fits into mod_python's best practices...

It may look ugly, but it's not totally wacky. The problem is that it 
will make maintainence more difficult as you are coupling 2 scripts that 
may not be related. If you want to make changes in script #2 12 months 
from now, will you remember why you have s['items'] = {} in there when 
it's not used anywhere else in that particular script? You might be 
better off using some combination of is_new and hasattr.

nr.1:
if not hasattr(s, 'counter') or s.is_new():
     do_nr1_session_init(s)

nr.2:
if not hasattr(s, 'items') or s.is_new():
     do_nr2_session_init(s)

If you really do want distinct session objects for each script you'll 
need to investigate some of the options Graham presented in another 
email in this thread.

Jim
From mikeisgreat at gmail.com  Thu Jan 19 20:20:52 2006
From: mikeisgreat at gmail.com (Michael Steinfeld)
Date: Thu Jan 19 20:20:58 2006
Subject: [mod_python] script works, but I need to understand the difference
Message-ID: <3d5db09e0601191720t392cb283v31f3ab4c9398c46e@mail.gmail.com>

I gave up on installing mod_python on openbsd temporarily ... if  you
read my last question.

Anyhow,

my apache config looks like this:

This Works
##############################
AddHandler mod_python .psp .py
PythonHandler mod_python.psp
PythonDebug On


This does not
##############################
AddHandler python-program .py .psp
PythonHandler mod_python.publisher
PythonDebug On


Should I be using mod_python.publisher? or the above? I am confused.
Please enlighten me.

Also,

Here is a script I wrote which works fine with the above but not
mod_python.publisher
the error is below the script


############
#  index.psp  #
############
<html>
<%
if form.has_key('name'):
   greet = 'Hello, %s!' % form['name'].capitalize()
else:
   greet = 'Hello there!'
# end
%>
  <h1><%= greet %></h1>
<%
import time
%>
<h1>Current time is
<%= time.ctime() %> </h1>
<%
import os, sys
%>
<h2>Yes, This is a <%= os.name %> based operating system </h2>
<h2>The platform is: <%= sys.platform %></h2>
<h3><%= sys.version %></h3>
<h3><%= os.uname() %></h3>
<h3>
<%=
os.popen( 'uptime' ).read()
%>
</h3>
</html>



#########################
Error

Mod_python error: "PythonHandler mod_python.publisher"

Traceback (most recent call last):

  File "/opt/local/lib/python2.4/site-packages/mod_python/apache.py",
line 299, in HandlerDispatch
    result = object(req)

  File "/opt/local/lib/python2.4/site-packages/mod_python/publisher.py",
line 98, in handler
    path=[path])

  File "/opt/local/lib/python2.4/site-packages/mod_python/apache.py",
line 457, in import_module
    module = imp.load_module(mname, f, p, d)

  File "/var/www/htdocs/index.py", line 1



    ^

SyntaxError: invalid syntax

--
-mike

From grahamd at dscpl.com.au  Thu Jan 19 22:53:32 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Thu Jan 19 22:53:36 2006
Subject: [mod_python] script works, but I need to understand the difference
Message-ID: <1137729212.4834@dscpl.user.openhosting.com>

Michael Steinfeld wrote ..
> I gave up on installing mod_python on openbsd temporarily ... if  you
> read my last question.
> 
> Anyhow,
> 
> my apache config looks like this:
> 
> This Works
> ##############################
> AddHandler mod_python .psp .py
> PythonHandler mod_python.psp
> PythonDebug On
> 
> 
> This does not
> ##############################
> AddHandler python-program .py .psp
> PythonHandler mod_python.publisher
> PythonDebug On
> 
> 
> Should I be using mod_python.publisher? or the above? I am confused.

If you want to use both mod_python.publisher and mod_python.psp on
different extensions in the same directory, you will need to use
something like:

AddHandler mod_python .py .psp
PythonHandler mod_python.psp | .psp
PythonHandler mod_python.publisher | .py

Ie., qualify PythonHandler with the extension.

Graham

> Please enlighten me.
> 
> Also,
> 
> Here is a script I wrote which works fine with the above but not
> mod_python.publisher
> the error is below the script
> 
> 
> ############
> #  index.psp  #
> ############
> <html>
> <%
> if form.has_key('name'):
>    greet = 'Hello, %s!' % form['name'].capitalize()
> else:
>    greet = 'Hello there!'
> # end
> %>
>   <h1><%= greet %></h1>
> <%
> import time
> %>
> <h1>Current time is
> <%= time.ctime() %> </h1>
> <%
> import os, sys
> %>
> <h2>Yes, This is a <%= os.name %> based operating system </h2>
> <h2>The platform is: <%= sys.platform %></h2>
> <h3><%= sys.version %></h3>
> <h3><%= os.uname() %></h3>
> <h3>
> <%=
> os.popen( 'uptime' ).read()
> %>
> </h3>
> </html>
> 
> 
> 
> #########################
> Error
> 
> Mod_python error: "PythonHandler mod_python.publisher"
> 
> Traceback (most recent call last):
> 
>   File "/opt/local/lib/python2.4/site-packages/mod_python/apache.py",
> line 299, in HandlerDispatch
>     result = object(req)
> 
>   File "/opt/local/lib/python2.4/site-packages/mod_python/publisher.py",
> line 98, in handler
>     path=[path])
> 
>   File "/opt/local/lib/python2.4/site-packages/mod_python/apache.py",
> line 457, in import_module
>     module = imp.load_module(mname, f, p, d)
> 
>   File "/var/www/htdocs/index.py", line 1
> 
> 
> 
>     ^
> 
> SyntaxError: invalid syntax
> 
> --
> -mike
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
From dpopowich at comcast.net  Fri Jan 20 09:02:57 2006
From: dpopowich at comcast.net (Daniel J. Popowich)
Date: Fri Jan 20 09:02:37 2006
Subject: [mod_python] How do you use mod_python?
In-Reply-To: <5f56302b0601180350p657c4a8dqbf89224d8dd345db@mail.gmail.com>
References: <5f56302b0601180350p657c4a8dqbf89224d8dd345db@mail.gmail.com>
Message-ID: <17360.60817.63451.335832@io.astro.umass.edu>


Daniel Nogradi writes:
> Some time ago there was a post (I think by Grisha) asking "why are you
> using mod_python?". It would be interesting to see answers from many
> users to a related question, _how_ do you use mod_python?

I use mod_python as the low-level framework to write mpservlets.  I
now write all my web-apps with mpservlets.  I have used mpservlets for
projects large (I've written two content management systems with it)
and small (publishing the Cartoon of the Day to lighten the spirit for
my department).  Yes, I eat my own dog food, as someone else put it.

Why mpservlets?  This is best summed up from a section from
the README:

    ============
    1. Overview
    ============

    If mod_python's publisher handler is a functional view of
    the web, the servlet handler is an object oriented view of
    the web.  It is inspired by WebWare
    (http://webware.sourceforge.net).

    I programmed with WebWare for many projects.  I loved the
    object oriented view of the web it promoted and found it to
    be a very productive tool to quickly prototype web
    applications.  However, I found it lacking in a number of
    ways: 1) it has its own server process that needs to be
    started and managed, this is in addition to apache or
    another web server; 2) its class hierarchy is rather deep:
    there are five classes, inclusive, in the hierarchy between
    the base class and the class that represents an HTML page
    (there are only two in Mod_python Servlets); 3) even though
    a web server like apache manages processes and/or threads,
    WebWare has its own extensive thread management system which
    adds complexity to an overall web application; 4) WebWare
    promotes a comprehensive buy-in to their framework that,
    personally, I found unwieldy.

    In short, I found WebWare too "big" for my needs and started
    looking for something more streamlined.  I couldn't find it.

    Since I never intended on using a web server other than
    apache, it made sense to give mod_python a closer look than
    I had before.  It was immediately clear that process/thread
    management came "free" by using an apache handler.  The
    publisher handler is clearly a powerful tool, but I missed
    the OO view of WebWare.  I looked at mod_python handlers
    that are available in the opensource community, but found
    most required a buy-in to their framework and/or content
    management system.

    At some point I realized it would be VERY easy to implement
    the best features of WebWare as a mod_python handler without
    the bloat and management burdens of other systems.  Best of
    all, it would be easy to reuse many features of mod_python
    without re-inventing the wheel (Session, Cookie,
    FieldStorage, etc.)


Cheers,


Daniel Popowich
---------------
http://home.comcast.net/~d.popowich/mpservlets/
From luismg at gmx.net  Fri Jan 20 11:49:21 2006
From: luismg at gmx.net (Luis M. Gonzalez)
Date: Fri Jan 20 11:49:20 2006
Subject: [mod_python] Sessions again...
Message-ID: <000901c61de1$78cd85e0$f8dbebc9@luis>



 Graham, Jim, thank you very much for your quick an accurate advices!



 ----- Original Message ----- 
 From: "Graham Dumpleton" <grahamd@dscpl.com.au>
 To: "Luis M. Gonzalez" <luismg@gmx.net>
 Cc: "Jim Gallacher" <jpg@jgassociates.ca>; <mod_python@modpython.org>
 Sent: Thursday, January 19, 2006 8:01 PM
 Subject: Re: [mod_python] Sessions again...


> Luis M. Gonzalez wrote ..
>> Ok, Jim, I'll clarify the problem:
>> Both scripts initiate their sessions the same way and with the same name:
>>
>> Script nr.1:
>>
>>     s= Session.Session(req)
>>     if s.is_new():
>>        s['items'] = {}
>>
>> Script nr.2:
>>
>>     s= Session.Session(req)
>>     if s.is_new():
>>        s['counter'] = 0
>>
>> I did it this way because I asume that for using both scripts in the same
>> site, I should have only one session started.
>> (Note that I also tried starting different sessions for each script, with
>> different names, but the problem persists).
>>
>> Actually, I already fixed this problem (with a wacky work-around 
>> though...).
>> In each script, I created the session variable corresponding to the other
>> script, as follows:
>>
> That is not a wacky work around, it is what must be done. For any
> scripts which are located under the same PythonHandler directive, the
> session object initialisation, ie., what is done when s.is_new() is
> true, must be the same for all scripts. If not done like this, as you
> are finding, when the other script is run it will be missing what it
> needs as it hasn't has the opportunity to do its initialisation. The
> other option as Jim pointed out is to effectively ignore s.is_new() and
> simply add a default for the value if the attribute isn't present.
>
> In general it is a good idea to separate out initialisation for a new
> session object into a separate common routine which all scripts call, if
> there are special attributes which need to be set up.
>
> Graham

From sean at barriescene.com  Fri Jan 20 12:27:54 2006
From: sean at barriescene.com (Sean Jamieson)
Date: Fri Jan 20 12:28:03 2006
Subject: [mod_python] PYC download prompt
In-Reply-To: <1137709660.29214@dscpl.user.openhosting.com>
References: <1137709660.29214@dscpl.user.openhosting.com>
Message-ID: <43D11D9A.60601@barriescene.com>

Graham Dumpleton wrote:

>Sean Jamieson wrote ..
>  
>
>>Has anyone else run into the problem, that when there is some unknown 
>>error with mod_python it spits out the .pyc version of your source code?
>>either that or gives a File Not Found (rather than a useful error)?
>>
>>I have a source that is working fine on my laptop:
>>Apache/2.0.54 (Ubuntu) mod_python/3.1.3 Python/2.4.2
>>and my dev server has the same setup...
>>
>>What happend when I copied the source to my dev server was:
>>1) I got a Not Found error
>>2) I refreshed
>>3) I was given the .pyc for the file requested
>>
>>again, this works fine on my laptop which is using the same 
>>OS/apache/python/mod_python
>>there maybe some minor differences in apache config, but nothing that I
>>know of which would affect mod_python.
>>
>>Can anyone give me a clue as to where I should try looking?
>>    
>>
>
>One can get wierd things like this happening if you have MultiViews
>enabled and are using URLs which have no extensions.
>
>So for starters try using:
>
>  Options -MultiViews
>
>in your Apache configuration and see if things change.
>
>Also, what handler are you using, your own, mod_python.publisher
>or something else? It is possible that you might be hitting one of
>the issues since fixed in mod_python 3.2.
>
>Graham
>
>  
>
Puiblisher, and yes, I realized that the .pyc being sent was a result of 
MultiViews later on. My main issue now, is that my codebase which runs 
fine on my laptop, does not run on my development server; both are 
running the same software.

I've been trying to find some key difference in apache's configuration 
that may cause it, but alas, no matter how much I copy it doesn't work.

This is rather serious, as I have a client waiting to see this thing, 
this afternoon.

Sean
From jure at dijaski.net  Fri Jan 20 12:52:07 2006
From: jure at dijaski.net (Jure Vrscaj)
Date: Fri Jan 20 12:52:32 2006
Subject: [mod_python] Different scripts with same names and sys.path
	confusion
Message-ID: <43D12347.7010400@dijaski.net>

Hello,

I'm working on a web-based gui for some application in mod_python, using 
publisher as a request handler. The project was going on ok, until I 
made a copy of the application, so that one copy could be used for 
testing/development and the other for real usage. But, as soon as two 
copies existed on the same server, one being requested after another, I 
noticed some strange effects:

At first, every now and then, I got a "404 Not Found" error when 
requesting one of the two copies. I traced the error which was raised in 
apache.py, the reason being that the module's directory I was trying to 
access wasn't in the path(which is calculated from request url). I 
commented out the check, and tried again. Now the error was gone, but 
another issue arised: when requesting for example the development page, 
which has the title set to "Test", instead of seeing the correct title, 
I got (seemingly randomly) titles from both the test site and the real one.

I figured that wrong modules are being used/imported and made the script 
output sys.path. The path contained both: root folder of the testing 
site and next to it root folder of the real site, which was probably the 
reason why the titles were unstable. I tried setting PythonPath, with no 
effect.

My system specs are:
- redhat linux
- httpd-2.0.46-54.ent (apache2.0)
- python-2.2.3-6.1
- mod_python-3.0.3-5.ent
- handler: mod_python.publisher

I would use Vampire, but couldn't get it to work on python2.2.

Any suggestions on how to overcome this problem really appreciated, I 
don't mind if each module is reloaded for every request, as long as it's 
the right module. (the application is using classic python import 
command for module importing)

regards,
jure
From jpg at jgassociates.ca  Fri Jan 20 13:02:23 2006
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Fri Jan 20 13:01:18 2006
Subject: [mod_python] PYC download prompt
In-Reply-To: <43D11D9A.60601@barriescene.com>
References: <1137709660.29214@dscpl.user.openhosting.com>
	<43D11D9A.60601@barriescene.com>
Message-ID: <43D125AF.3080300@jgassociates.ca>

Sean Jamieson wrote:
> Graham Dumpleton wrote:
> 
>> Sean Jamieson wrote ..
>>  
>>
>>> Has anyone else run into the problem, that when there is some unknown 
>>> error with mod_python it spits out the .pyc version of your source code?
>>> either that or gives a File Not Found (rather than a useful error)?
>>>
>>> I have a source that is working fine on my laptop:
>>> Apache/2.0.54 (Ubuntu) mod_python/3.1.3 Python/2.4.2
>>> and my dev server has the same setup...
>>>
>>> What happend when I copied the source to my dev server was:
>>> 1) I got a Not Found error
>>> 2) I refreshed
>>> 3) I was given the .pyc for the file requested
>>>
>>> again, this works fine on my laptop which is using the same 
>>> OS/apache/python/mod_python
>>> there maybe some minor differences in apache config, but nothing that I
>>> know of which would affect mod_python.
>>>
>>> Can anyone give me a clue as to where I should try looking?
>>>   
>>
>>
>> One can get wierd things like this happening if you have MultiViews
>> enabled and are using URLs which have no extensions.
>>
>> So for starters try using:
>>
>>  Options -MultiViews
>>
>> in your Apache configuration and see if things change.
>>
>> Also, what handler are you using, your own, mod_python.publisher
>> or something else? It is possible that you might be hitting one of
>> the issues since fixed in mod_python 3.2.
>>
>> Graham
>>
>>  
>>
> Puiblisher, and yes, I realized that the .pyc being sent was a result of 
> MultiViews later on. My main issue now, is that my codebase which runs 
> fine on my laptop, does not run on my development server; both are 
> running the same software.
> 
> I've been trying to find some key difference in apache's configuration 
> that may cause it, but alas, no matter how much I copy it doesn't work.
> 
> This is rather serious, as I have a client waiting to see this thing, 
> this afternoon.

Is the server publicly accessible? If so I can see what I get from here. 
If you don't want the URL on the mailing list you can email me privately.

Jim


From nicolas.lehuen at gmail.com  Fri Jan 20 13:13:49 2006
From: nicolas.lehuen at gmail.com (Nicolas Lehuen)
Date: Fri Jan 20 13:13:55 2006
Subject: [mod_python] Different scripts with same names and sys.path
	confusion
In-Reply-To: <43D12347.7010400@dijaski.net>
References: <43D12347.7010400@dijaski.net>
Message-ID: <c298f2d70601201013u7142fb73i@mail.gmail.com>

Hi Jure,

This is a very well know bug of mod_python.publisher that has been
fixed in the 3.2 version (whose final release should be made really
really soon now).

As a work around you can try to define two different PythonInterpreter
names for each application (for example in a .htaccess file at the
root of each application). This way your two applications will run
into different Python interpreters and you should see your problem
disappear.

Regards,
Nicolas

2006/1/20, Jure Vrscaj <jure@dijaski.net>:
> Hello,
>
> I'm working on a web-based gui for some application in mod_python, using
> publisher as a request handler. The project was going on ok, until I
> made a copy of the application, so that one copy could be used for
> testing/development and the other for real usage. But, as soon as two
> copies existed on the same server, one being requested after another, I
> noticed some strange effects:
>
> At first, every now and then, I got a "404 Not Found" error when
> requesting one of the two copies. I traced the error which was raised in
> apache.py, the reason being that the module's directory I was trying to
> access wasn't in the path(which is calculated from request url). I
> commented out the check, and tried again. Now the error was gone, but
> another issue arised: when requesting for example the development page,
> which has the title set to "Test", instead of seeing the correct title,
> I got (seemingly randomly) titles from both the test site and the real one.
>
> I figured that wrong modules are being used/imported and made the script
> output sys.path. The path contained both: root folder of the testing
> site and next to it root folder of the real site, which was probably the
> reason why the titles were unstable. I tried setting PythonPath, with no
> effect.
>
> My system specs are:
> - redhat linux
> - httpd-2.0.46-54.ent (apache2.0)
> - python-2.2.3-6.1
> - mod_python-3.0.3-5.ent
> - handler: mod_python.publisher
>
> I would use Vampire, but couldn't get it to work on python2.2.
>
> Any suggestions on how to overcome this problem really appreciated, I
> don't mind if each module is reloaded for every request, as long as it's
> the right module. (the application is using classic python import
> command for module importing)
>
> regards,
> jure
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>

From sean at barriescene.com  Fri Jan 20 13:19:30 2006
From: sean at barriescene.com (Sean Jamieson)
Date: Fri Jan 20 13:19:35 2006
Subject: [mod_python] PYC download prompt
In-Reply-To: <43D125AF.3080300@jgassociates.ca>
References: <1137709660.29214@dscpl.user.openhosting.com>
	<43D11D9A.60601@barriescene.com> <43D125AF.3080300@jgassociates.ca>
Message-ID: <43D129B2.1000906@barriescene.com>

Jim Gallacher wrote:

> Sean Jamieson wrote:
>
>> Graham Dumpleton wrote:
>>
>>> Sean Jamieson wrote ..
>>>  
>>>
>>>> Has anyone else run into the problem, that when there is some 
>>>> unknown error with mod_python it spits out the .pyc version of your 
>>>> source code?
>>>> either that or gives a File Not Found (rather than a useful error)?
>>>>
>>>> I have a source that is working fine on my laptop:
>>>> Apache/2.0.54 (Ubuntu) mod_python/3.1.3 Python/2.4.2
>>>> and my dev server has the same setup...
>>>>
>>>> What happend when I copied the source to my dev server was:
>>>> 1) I got a Not Found error
>>>> 2) I refreshed
>>>> 3) I was given the .pyc for the file requested
>>>>
>>>> again, this works fine on my laptop which is using the same 
>>>> OS/apache/python/mod_python
>>>> there maybe some minor differences in apache config, but nothing 
>>>> that I
>>>> know of which would affect mod_python.
>>>>
>>>> Can anyone give me a clue as to where I should try looking?
>>>>   
>>>
>>>
>>>
>>> One can get wierd things like this happening if you have MultiViews
>>> enabled and are using URLs which have no extensions.
>>>
>>> So for starters try using:
>>>
>>>  Options -MultiViews
>>>
>>> in your Apache configuration and see if things change.
>>>
>>> Also, what handler are you using, your own, mod_python.publisher
>>> or something else? It is possible that you might be hitting one of
>>> the issues since fixed in mod_python 3.2.
>>>
>>> Graham
>>>
>>>  
>>>
>> Puiblisher, and yes, I realized that the .pyc being sent was a result 
>> of MultiViews later on. My main issue now, is that my codebase which 
>> runs fine on my laptop, does not run on my development server; both 
>> are running the same software.
>>
>> I've been trying to find some key difference in apache's 
>> configuration that may cause it, but alas, no matter how much I copy 
>> it doesn't work.
>>
>> This is rather serious, as I have a client waiting to see this thing, 
>> this afternoon.
>
>
> Is the server publicly accessible? If so I can see what I get from 
> here. If you don't want the URL on the mailing list you can email me 
> privately.
>
> Jim

currently there is nothing to get, now, when one tries to go to the URL, 
the browser does nothing, literally. i.e. if you're on the directory 
index page, and you click one of the .py files, or a directory with an 
index.py, it does nothing, if I open a new tab, and paste the URL, hit 
enter or click 'go', it does nothing, nothing loads, it still says 
(Untitled) as if it went nowhere.

and this seems to only happen when I try to import something from my 
codebase,
a plain .py file that simply has the following defined, works:

def index( req ):
    return req.filename

I just don't get what's going on here, it doesn't make the least bit of 
sense.

Sean
From jpg at jgassociates.ca  Fri Jan 20 13:31:07 2006
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Fri Jan 20 13:30:00 2006
Subject: [mod_python] PYC download prompt
In-Reply-To: <43D129B2.1000906@barriescene.com>
References: <1137709660.29214@dscpl.user.openhosting.com>
	<43D11D9A.60601@barriescene.com> <43D125AF.3080300@jgassociates.ca>
	<43D129B2.1000906@barriescene.com>
Message-ID: <43D12C6B.5040108@jgassociates.ca>

Sean Jamieson wrote:
> Jim Gallacher wrote:
> 
>> Sean Jamieson wrote:
>>
>>> Graham Dumpleton wrote:
>>>
>>>> Sean Jamieson wrote ..
>>>>  
>>>>
>>>>> Has anyone else run into the problem, that when there is some 
>>>>> unknown error with mod_python it spits out the .pyc version of your 
>>>>> source code?
>>>>> either that or gives a File Not Found (rather than a useful error)?
>>>>>
>>>>> I have a source that is working fine on my laptop:
>>>>> Apache/2.0.54 (Ubuntu) mod_python/3.1.3 Python/2.4.2
>>>>> and my dev server has the same setup...
>>>>>
>>>>> What happend when I copied the source to my dev server was:
>>>>> 1) I got a Not Found error
>>>>> 2) I refreshed
>>>>> 3) I was given the .pyc for the file requested
>>>>>
>>>>> again, this works fine on my laptop which is using the same 
>>>>> OS/apache/python/mod_python
>>>>> there maybe some minor differences in apache config, but nothing 
>>>>> that I
>>>>> know of which would affect mod_python.
>>>>>
>>>>> Can anyone give me a clue as to where I should try looking?
>>>>>   
>>>>
>>>>
>>>>
>>>>
>>>> One can get wierd things like this happening if you have MultiViews
>>>> enabled and are using URLs which have no extensions.
>>>>
>>>> So for starters try using:
>>>>
>>>>  Options -MultiViews
>>>>
>>>> in your Apache configuration and see if things change.
>>>>
>>>> Also, what handler are you using, your own, mod_python.publisher
>>>> or something else? It is possible that you might be hitting one of
>>>> the issues since fixed in mod_python 3.2.
>>>>
>>>> Graham
>>>>
>>>>  
>>>>
>>> Puiblisher, and yes, I realized that the .pyc being sent was a result 
>>> of MultiViews later on. My main issue now, is that my codebase which 
>>> runs fine on my laptop, does not run on my development server; both 
>>> are running the same software.
>>>
>>> I've been trying to find some key difference in apache's 
>>> configuration that may cause it, but alas, no matter how much I copy 
>>> it doesn't work.
>>>
>>> This is rather serious, as I have a client waiting to see this thing, 
>>> this afternoon.
>>
>>
>>
>> Is the server publicly accessible? If so I can see what I get from 
>> here. If you don't want the URL on the mailing list you can email me 
>> privately.
>>
>> Jim
> 
> 
> currently there is nothing to get, now, when one tries to go to the URL, 
> the browser does nothing, literally. i.e. if you're on the directory 
> index page, and you click one of the .py files, or a directory with an 
> index.py, it does nothing, if I open a new tab, and paste the URL, hit 
> enter or click 'go', it does nothing, nothing loads, it still says 
> (Untitled) as if it went nowhere.
> 
> and this seems to only happen when I try to import something from my 
> codebase,
> a plain .py file that simply has the following defined, works:
> 
> def index( req ):
>    return req.filename
> 
> I just don't get what's going on here, it doesn't make the least bit of 
> sense.

I'll agree with you there.

I'm sure this is stating the obvious but is there anything in the error 
log? Have you tried logging a message to the error log? 
(req.log_error("It's alive!"))

Have you taken a look at the page source for the page returned? I've 
been tricked by this before where I haven't set the content_type and 
returned some string representation of an object which the browser 
interprets as an html tag. eg <thingy.main.thing object at 0xb7d2670c>.

Jim




From sean at barriescene.com  Fri Jan 20 14:23:56 2006
From: sean at barriescene.com (Sean Jamieson)
Date: Fri Jan 20 14:24:19 2006
Subject: [mod_python] PYC download prompt
In-Reply-To: <43D12C6B.5040108@jgassociates.ca>
References: <1137709660.29214@dscpl.user.openhosting.com>
	<43D11D9A.60601@barriescene.com> <43D125AF.3080300@jgassociates.ca>
	<43D129B2.1000906@barriescene.com>
	<43D12C6B.5040108@jgassociates.ca>
Message-ID: <43D138CC.7090701@barriescene.com>

Jim Gallacher wrote:

> Sean Jamieson wrote:
>
>> Jim Gallacher wrote:
>>
>>> Sean Jamieson wrote:
>>>
>>>> Graham Dumpleton wrote:
>>>>
>>>>> Sean Jamieson wrote ..
>>>>>  
>>>>>
>>>>>> Has anyone else run into the problem, that when there is some 
>>>>>> unknown error with mod_python it spits out the .pyc version of 
>>>>>> your source code?
>>>>>> either that or gives a File Not Found (rather than a useful error)?
>>>>>>
>>>>>> I have a source that is working fine on my laptop:
>>>>>> Apache/2.0.54 (Ubuntu) mod_python/3.1.3 Python/2.4.2
>>>>>> and my dev server has the same setup...
>>>>>>
>>>>>> What happend when I copied the source to my dev server was:
>>>>>> 1) I got a Not Found error
>>>>>> 2) I refreshed
>>>>>> 3) I was given the .pyc for the file requested
>>>>>>
>>>>>> again, this works fine on my laptop which is using the same 
>>>>>> OS/apache/python/mod_python
>>>>>> there maybe some minor differences in apache config, but nothing 
>>>>>> that I
>>>>>> know of which would affect mod_python.
>>>>>>
>>>>>> Can anyone give me a clue as to where I should try looking?
>>>>>>   
>>>>>
>>>>>
>>>>>
>>>>>
>>>>>
>>>>> One can get wierd things like this happening if you have MultiViews
>>>>> enabled and are using URLs which have no extensions.
>>>>>
>>>>> So for starters try using:
>>>>>
>>>>>  Options -MultiViews
>>>>>
>>>>> in your Apache configuration and see if things change.
>>>>>
>>>>> Also, what handler are you using, your own, mod_python.publisher
>>>>> or something else? It is possible that you might be hitting one of
>>>>> the issues since fixed in mod_python 3.2.
>>>>>
>>>>> Graham
>>>>>
>>>>>  
>>>>>
>>>> Puiblisher, and yes, I realized that the .pyc being sent was a 
>>>> result of MultiViews later on. My main issue now, is that my 
>>>> codebase which runs fine on my laptop, does not run on my 
>>>> development server; both are running the same software.
>>>>
>>>> I've been trying to find some key difference in apache's 
>>>> configuration that may cause it, but alas, no matter how much I 
>>>> copy it doesn't work.
>>>>
>>>> This is rather serious, as I have a client waiting to see this 
>>>> thing, this afternoon.
>>>
>>>
>>>
>>>
>>> Is the server publicly accessible? If so I can see what I get from 
>>> here. If you don't want the URL on the mailing list you can email me 
>>> privately.
>>>
>>> Jim
>>
>>
>>
>> currently there is nothing to get, now, when one tries to go to the 
>> URL, the browser does nothing, literally. i.e. if you're on the 
>> directory index page, and you click one of the .py files, or a 
>> directory with an index.py, it does nothing, if I open a new tab, and 
>> paste the URL, hit enter or click 'go', it does nothing, nothing 
>> loads, it still says (Untitled) as if it went nowhere.
>>
>> and this seems to only happen when I try to import something from my 
>> codebase,
>> a plain .py file that simply has the following defined, works:
>>
>> def index( req ):
>>    return req.filename
>>
>> I just don't get what's going on here, it doesn't make the least bit 
>> of sense.
>
>
> I'll agree with you there.
>
> I'm sure this is stating the obvious but is there anything in the 
> error log? Have you tried logging a message to the error log? 
> (req.log_error("It's alive!"))
>
> Have you taken a look at the page source for the page returned? I've 
> been tricked by this before where I haven't set the content_type and 
> returned some string representation of an object which the browser 
> interprets as an html tag. eg <thingy.main.thing object at 0xb7d2670c>.
>
> Jim

no. I don't think you get what I mean, the page does not transition to 
any other page.
i.e. 1) I and viewing the Directory Index
      2) I click the test.py that imports something from my project
      3) firefox's loading icon spins for a second
      4) I am still seeing the Directory Index

apache2/error.log is showing more than a few segfaults...
From jpg at jgassociates.ca  Fri Jan 20 14:47:14 2006
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Fri Jan 20 14:45:49 2006
Subject: [mod_python] PYC download prompt
In-Reply-To: <43D138CC.7090701@barriescene.com>
References: <1137709660.29214@dscpl.user.openhosting.com>	<43D11D9A.60601@barriescene.com>
	<43D125AF.3080300@jgassociates.ca>	<43D129B2.1000906@barriescene.com>	<43D12C6B.5040108@jgassociates.ca>
	<43D138CC.7090701@barriescene.com>
Message-ID: <43D13E42.8060401@jgassociates.ca>

Sean Jamieson wrote:
> Jim Gallacher wrote:
> 
>> Sean Jamieson wrote:
>>
>>> Jim Gallacher wrote:
>>>
>>>> Sean Jamieson wrote:
>>>>
>>>>> Graham Dumpleton wrote:
>>>>>
>>>>>> Sean Jamieson wrote ..
>>>>>>  
>>>>>>
>>>>>>> Has anyone else run into the problem, that when there is some 
>>>>>>> unknown error with mod_python it spits out the .pyc version of 
>>>>>>> your source code?
>>>>>>> either that or gives a File Not Found (rather than a useful error)?
>>>>>>>
>>>>>>> I have a source that is working fine on my laptop:
>>>>>>> Apache/2.0.54 (Ubuntu) mod_python/3.1.3 Python/2.4.2
>>>>>>> and my dev server has the same setup...
>>>>>>>
>>>>>>> What happend when I copied the source to my dev server was:
>>>>>>> 1) I got a Not Found error
>>>>>>> 2) I refreshed
>>>>>>> 3) I was given the .pyc for the file requested
>>>>>>>
>>>>>>> again, this works fine on my laptop which is using the same 
>>>>>>> OS/apache/python/mod_python
>>>>>>> there maybe some minor differences in apache config, but nothing 
>>>>>>> that I
>>>>>>> know of which would affect mod_python.
>>>>>>>
>>>>>>> Can anyone give me a clue as to where I should try looking?
>>>>>>>   
>>>>>>
>>>>>>
>>>>>>
>>>>>>
>>>>>>
>>>>>>
>>>>>> One can get wierd things like this happening if you have MultiViews
>>>>>> enabled and are using URLs which have no extensions.
>>>>>>
>>>>>> So for starters try using:
>>>>>>
>>>>>>  Options -MultiViews
>>>>>>
>>>>>> in your Apache configuration and see if things change.
>>>>>>
>>>>>> Also, what handler are you using, your own, mod_python.publisher
>>>>>> or something else? It is possible that you might be hitting one of
>>>>>> the issues since fixed in mod_python 3.2.
>>>>>>
>>>>>> Graham
>>>>>>
>>>>>>  
>>>>>>
>>>>> Puiblisher, and yes, I realized that the .pyc being sent was a 
>>>>> result of MultiViews later on. My main issue now, is that my 
>>>>> codebase which runs fine on my laptop, does not run on my 
>>>>> development server; both are running the same software.
>>>>>
>>>>> I've been trying to find some key difference in apache's 
>>>>> configuration that may cause it, but alas, no matter how much I 
>>>>> copy it doesn't work.
>>>>>
>>>>> This is rather serious, as I have a client waiting to see this 
>>>>> thing, this afternoon.
>>>>
>>>>
>>>>
>>>>
>>>>
>>>> Is the server publicly accessible? If so I can see what I get from 
>>>> here. If you don't want the URL on the mailing list you can email me 
>>>> privately.
>>>>
>>>> Jim
>>>
>>>
>>>
>>>
>>> currently there is nothing to get, now, when one tries to go to the 
>>> URL, the browser does nothing, literally. i.e. if you're on the 
>>> directory index page, and you click one of the .py files, or a 
>>> directory with an index.py, it does nothing, if I open a new tab, and 
>>> paste the URL, hit enter or click 'go', it does nothing, nothing 
>>> loads, it still says (Untitled) as if it went nowhere.
>>>
>>> and this seems to only happen when I try to import something from my 
>>> codebase,
>>> a plain .py file that simply has the following defined, works:
>>>
>>> def index( req ):
>>>    return req.filename
>>>
>>> I just don't get what's going on here, it doesn't make the least bit 
>>> of sense.
>>
>>
>>
>> I'll agree with you there.
>>
>> I'm sure this is stating the obvious but is there anything in the 
>> error log? Have you tried logging a message to the error log? 
>> (req.log_error("It's alive!"))
>>
>> Have you taken a look at the page source for the page returned? I've 
>> been tricked by this before where I haven't set the content_type and 
>> returned some string representation of an object which the browser 
>> interprets as an html tag. eg <thingy.main.thing object at 0xb7d2670c>.
>>
>> Jim
> 
> 
> no. I don't think you get what I mean, the page does not transition to 
> any other page.
> i.e. 1) I and viewing the Directory Index
>      2) I click the test.py that imports something from my project
>      3) firefox's loading icon spins for a second
>      4) I am still seeing the Directory Index

You're right. I thought you were getting just a blank page.

> apache2/error.log is showing more than a few segfaults...

Segfaults! Now we are getting somewhere. There are likely some subtle 
differences in the python libraries and apache modules being used on the 
server and laptop. The usual culprits libexpat and mysql clientlib used 
by php, but other libs can cause problems too. These links may help you 
sort it out:

http://www.dscpl.com.au/articles/modpython-006.html
http://www.modpython.org/FAQ/faqw.py?req=all#2.13

Jim
From jpg at jgassociates.ca  Fri Jan 20 15:54:04 2006
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Fri Jan 20 15:52:14 2006
Subject: [mod_python] PYC download prompt
In-Reply-To: <43D14317.3050105@barriescene.com>
References: <1137709660.29214@dscpl.user.openhosting.com>	<43D11D9A.60601@barriescene.com>
	<43D125AF.3080300@jgassociates.ca>	<43D129B2.1000906@barriescene.com>	<43D12C6B.5040108@jgassociates.ca>
	<43D138CC.7090701@barriescene.com>
	<43D13E42.8060401@jgassociates.ca>
	<43D14317.3050105@barriescene.com>
Message-ID: <43D14DEC.7070509@jgassociates.ca>

Sean Jamieson wrote:
> Jim Gallacher wrote:
> 
>> Sean Jamieson wrote:
>>> apache2/error.log is showing more than a few segfaults...
>>
>>
>>
>> Segfaults! Now we are getting somewhere. There are likely some subtle 
>> differences in the python libraries and apache modules being used on 
>> the server and laptop. The usual culprits libexpat and mysql clientlib 
>> used by php, but other libs can cause problems too. These links may 
>> help you sort it out:
>>
>> http://www.dscpl.com.au/articles/modpython-006.html
>> http://www.modpython.org/FAQ/faqw.py?req=all#2.13
>>
>> Jim
> 
> 
> I made the segfault stop, but I'm not sure why exactly...
> to start at the beginning, there was another weirdness going on with 
> mod_python, that was not a big deal, and I assumed to be "just how it 
> works":
> if my project is in a subdirectory under the document root, I'd have to 
> do my imports from the document root.
> i.e.
> DocumentRoot /var/www
> Project Root /var/www/project
> /var/www/project/index.py:
>    import project.package.module
> this seems strange as I sholud only have to do
>    import package.module
> with out having to include the directory that index.py actually resides 
> in...
> Now, keeping that in mind, I uploaded the source to my dev server, and 
> to stop the segfaults I simply changes the imports to the second 
> (expected) from, excluding the 'project' directory from the import path.
> *inhale*
> 
> I don't know if that really fixed anything, or just caused some other 
> error to be happening that prevents the whatever code is segfaulting 
> from actually being run.
> But, in either case, I get no error or output or log messages telling me 
> useful. All I do get is:
> [notice] mod_python: (Re)importing module 'index' with path set to 
> '['/.....']'
> and once in a while this is above it:
> [notice] mod_python: (Re)importing module 'mod_python.publisher'

Publisher has it's own import and reload mechanism. Using a python 
import statement for modules that may also be imported by 
mod_python.publisher may give interesting results. If your 
project.package.module does not contain functions that are published 
directly I would suggest moving it completely out of your DocumentRoot 
and put it somewhere on your python path, or use the apache PythonPath 
directive to add it to the path. eg.

   PythonPath "['/home/sean/website-modules/',] + sys.path"

This import issue is not likely related to the segfaults however.

> OTOH, that link you gave me about PHP's mysql libs conflicting with 
> mod_python and MySQLdb might be the very thing causing problems, but 
> BOTH my laptop and my dev server have php4.4.0 installed... and both are 
> from ubuntu's apt (infact, I haven't custom compiled anything on either 
> machine since I built them, all are package managed, and recently updated)

A few weeks ago I ran apt-get update for python related packages on one 
of my debian machines and immediately started getting apache segfaults. 
Turned out that php4-mysql was using libmysqlclient.so.10 and the new 
python was using libmysqlclient.so.12. Updating php4-mysql brought the 2 
libs in line and the segfault went away. I don't think this sort of 
problem is easily solved by any package manager, so it's something to 
keep in mind when doing updates.

Jim

PS. It's a good idea to keep discussions on list.

From grahamd at dscpl.com.au  Fri Jan 20 15:52:57 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Fri Jan 20 15:53:23 2006
Subject: [mod_python] Different scripts with same names and sys.path
	confusion
In-Reply-To: <43D12347.7010400@dijaski.net>
References: <43D12347.7010400@dijaski.net>
Message-ID: <FCA4B1B5-6C09-4C1A-B2C2-E447F3FEC41C@dscpl.com.au>


On 21/01/2006, at 4:52 AM, Jure Vrscaj wrote:

> My system specs are:
> - redhat linux
> - httpd-2.0.46-54.ent (apache2.0)
> - python-2.2.3-6.1
> - mod_python-3.0.3-5.ent
> - handler: mod_python.publisher
>
> I would use Vampire, but couldn't get it to work on python2.2.

Nicolas pointed out that mod_python 3.2 will solve the problem you  
are having with
mod_python.publisher. Be aware though that mod_python 3.2 requires  
you to have
at least Python 2.3 or some things will not work. Vampire similarly  
has a requirement
for Python 2.3 (although I didn't think it did), so either way you  
would have to upgrade.

Thus the only workable solution if you have to use Python 2.2, is the  
PythonInterpreter
directive that Nicolas also pointed out.

Graham
From grisha at modpython.org  Sat Jan 21 14:35:36 2006
From: grisha at modpython.org (Vince Perry)
Date: Fri Jan 20 16:26:20 2006
Subject: [mod_python] [SPAM] RE:RE: Your loan is approved
Message-ID: <edxhfnPCQWNGHgrisha@modpython.org>

Dear Homeowner,

http://yourforless.com/?ra=ciel


You have been approved for a $402,000 house loan at a 3.45% Fixed R.ate.
This offer is being presented to you right now!. Your credit history is in no way a factor.
We have 99% approval rate.
To take advantage of this Limited Time Opportunity,

please take a minute and confirm your curiosity or intention to accept this loan, at the following web-site:

http://yourforless.com/?ra=ciel


Best Regards
Ella DeElla

http://yourforless.com/lit.html

accede





From list at joreybump.com  Fri Jan 20 16:28:47 2006
From: list at joreybump.com (Jorey Bump)
Date: Fri Jan 20 16:29:01 2006
Subject: [mod_python] script works, but I need to understand the difference
In-Reply-To: <3d5db09e0601191720t392cb283v31f3ab4c9398c46e@mail.gmail.com>
References: <3d5db09e0601191720t392cb283v31f3ab4c9398c46e@mail.gmail.com>
Message-ID: <43D1560F.5020706@joreybump.com>

Michael Steinfeld wrote:

> Should I be using mod_python.publisher? or the above? I am confused.
> Please enlighten me.

Publisher is different than PSP. With Publisher, you assemble the page 
as a string, then return it from your function (in general). PSP is more 
like PHP, where you insert code into a page, and it gets processed when 
it is encountered. The approaches are quite different.
From sean at barriescene.com  Fri Jan 20 19:00:42 2006
From: sean at barriescene.com (Sean Jamieson)
Date: Fri Jan 20 19:00:51 2006
Subject: [mod_python] PYC download prompt (resolved)
In-Reply-To: <43D14DEC.7070509@jgassociates.ca>
References: <1137709660.29214@dscpl.user.openhosting.com>	<43D11D9A.60601@barriescene.com>
	<43D125AF.3080300@jgassociates.ca>	<43D129B2.1000906@barriescene.com>	<43D12C6B.5040108@jgassociates.ca>
	<43D138CC.7090701@barriescene.com>
	<43D13E42.8060401@jgassociates.ca>
	<43D14317.3050105@barriescene.com>
	<43D14DEC.7070509@jgassociates.ca>
Message-ID: <43D179AA.2030301@barriescene.com>

Jim Gallacher wrote:

> Sean Jamieson wrote:
>
>> Jim Gallacher wrote:
>>
>>> Sean Jamieson wrote:
>>>
>>>> apache2/error.log is showing more than a few segfaults...
>>>
>>>
>>>
>>>
>>> Segfaults! Now we are getting somewhere. There are likely some 
>>> subtle differences in the python libraries and apache modules being 
>>> used on the server and laptop. The usual culprits libexpat and mysql 
>>> clientlib used by php, but other libs can cause problems too. These 
>>> links may help you sort it out:
>>>
>>> http://www.dscpl.com.au/articles/modpython-006.html
>>> http://www.modpython.org/FAQ/faqw.py?req=all#2.13
>>>
>>> Jim
>>
>>
>>
>> I made the segfault stop, but I'm not sure why exactly...
>> to start at the beginning, there was another weirdness going on with 
>> mod_python, that was not a big deal, and I assumed to be "just how it 
>> works":
>> if my project is in a subdirectory under the document root, I'd have 
>> to do my imports from the document root.
>> i.e.
>> DocumentRoot /var/www
>> Project Root /var/www/project
>> /var/www/project/index.py:
>>    import project.package.module
>> this seems strange as I sholud only have to do
>>    import package.module
>> with out having to include the directory that index.py actually 
>> resides in...
>> Now, keeping that in mind, I uploaded the source to my dev server, 
>> and to stop the segfaults I simply changes the imports to the second 
>> (expected) from, excluding the 'project' directory from the import path.
>> *inhale*
>>
>> I don't know if that really fixed anything, or just caused some other 
>> error to be happening that prevents the whatever code is segfaulting 
>> from actually being run.
>> But, in either case, I get no error or output or log messages telling 
>> me useful. All I do get is:
>> [notice] mod_python: (Re)importing module 'index' with path set to 
>> '['/.....']'
>> and once in a while this is above it:
>> [notice] mod_python: (Re)importing module 'mod_python.publisher'
>
>
> Publisher has it's own import and reload mechanism. Using a python 
> import statement for modules that may also be imported by 
> mod_python.publisher may give interesting results. If your 
> project.package.module does not contain functions that are published 
> directly I would suggest moving it completely out of your DocumentRoot 
> and put it somewhere on your python path, or use the apache PythonPath 
> directive to add it to the path. eg.
>
>   PythonPath "['/home/sean/website-modules/',] + sys.path"
>
> This import issue is not likely related to the segfaults however.
>
>> OTOH, that link you gave me about PHP's mysql libs conflicting with 
>> mod_python and MySQLdb might be the very thing causing problems, but 
>> BOTH my laptop and my dev server have php4.4.0 installed... and both 
>> are from ubuntu's apt (infact, I haven't custom compiled anything on 
>> either machine since I built them, all are package managed, and 
>> recently updated)
>
>
> A few weeks ago I ran apt-get update for python related packages on 
> one of my debian machines and immediately started getting apache 
> segfaults. Turned out that php4-mysql was using libmysqlclient.so.10 
> and the new python was using libmysqlclient.so.12. Updating php4-mysql 
> brought the 2 libs in line and the segfault went away. I don't think 
> this sort of problem is easily solved by any package manager, so it's 
> something to keep in mind when doing updates.
>
> Jim
>
> PS. It's a good idea to keep discussions on list.

OK, so after many hours of hair pulling, I finally figured out the 
problem *is* with PHP's mysql library.

Disabling PHP entirely allowed my python code, which uses MySQLdb, to work.

Tomorrow I'm going to figure out how to make PHP and MySQLdb play 
nicely, taking your comment above into consideration.

Thanks for all the help.

Sean
From jpg at jgassociates.ca  Fri Jan 20 19:21:40 2006
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Fri Jan 20 19:18:46 2006
Subject: [mod_python] PYC download prompt (resolved)
In-Reply-To: <43D179AA.2030301@barriescene.com>
References: <1137709660.29214@dscpl.user.openhosting.com>	<43D11D9A.60601@barriescene.com>	<43D125AF.3080300@jgassociates.ca>	<43D129B2.1000906@barriescene.com>	<43D12C6B.5040108@jgassociates.ca>	<43D138CC.7090701@barriescene.com>	<43D13E42.8060401@jgassociates.ca>	<43D14317.3050105@barriescene.com>	<43D14DEC.7070509@jgassociates.ca>
	<43D179AA.2030301@barriescene.com>
Message-ID: <43D17E94.7090207@jgassociates.ca>

Sean Jamieson wrote:
> Jim Gallacher wrote:
> 
>> Sean Jamieson wrote:
>>
>>> Jim Gallacher wrote:
>>>
>>>> Sean Jamieson wrote:
>>>>
>>>>> apache2/error.log is showing more than a few segfaults...
>>>>
>>>>
>>>>
>>>>
>>>>
>>>> Segfaults! Now we are getting somewhere. There are likely some 
>>>> subtle differences in the python libraries and apache modules being 
>>>> used on the server and laptop. The usual culprits libexpat and mysql 
>>>> clientlib used by php, but other libs can cause problems too. These 
>>>> links may help you sort it out:
>>>>
>>>> http://www.dscpl.com.au/articles/modpython-006.html
>>>> http://www.modpython.org/FAQ/faqw.py?req=all#2.13
>>>>
>>>> Jim
>>>
>>>
>>>
>>>
>>> I made the segfault stop, but I'm not sure why exactly...
>>> to start at the beginning, there was another weirdness going on with 
>>> mod_python, that was not a big deal, and I assumed to be "just how it 
>>> works":
>>> if my project is in a subdirectory under the document root, I'd have 
>>> to do my imports from the document root.
>>> i.e.
>>> DocumentRoot /var/www
>>> Project Root /var/www/project
>>> /var/www/project/index.py:
>>>    import project.package.module
>>> this seems strange as I sholud only have to do
>>>    import package.module
>>> with out having to include the directory that index.py actually 
>>> resides in...
>>> Now, keeping that in mind, I uploaded the source to my dev server, 
>>> and to stop the segfaults I simply changes the imports to the second 
>>> (expected) from, excluding the 'project' directory from the import path.
>>> *inhale*
>>>
>>> I don't know if that really fixed anything, or just caused some other 
>>> error to be happening that prevents the whatever code is segfaulting 
>>> from actually being run.
>>> But, in either case, I get no error or output or log messages telling 
>>> me useful. All I do get is:
>>> [notice] mod_python: (Re)importing module 'index' with path set to 
>>> '['/.....']'
>>> and once in a while this is above it:
>>> [notice] mod_python: (Re)importing module 'mod_python.publisher'
>>
>>
>>
>> Publisher has it's own import and reload mechanism. Using a python 
>> import statement for modules that may also be imported by 
>> mod_python.publisher may give interesting results. If your 
>> project.package.module does not contain functions that are published 
>> directly I would suggest moving it completely out of your DocumentRoot 
>> and put it somewhere on your python path, or use the apache PythonPath 
>> directive to add it to the path. eg.
>>
>>   PythonPath "['/home/sean/website-modules/',] + sys.path"
>>
>> This import issue is not likely related to the segfaults however.
>>
>>> OTOH, that link you gave me about PHP's mysql libs conflicting with 
>>> mod_python and MySQLdb might be the very thing causing problems, but 
>>> BOTH my laptop and my dev server have php4.4.0 installed... and both 
>>> are from ubuntu's apt (infact, I haven't custom compiled anything on 
>>> either machine since I built them, all are package managed, and 
>>> recently updated)
>>
>>
>>
>> A few weeks ago I ran apt-get update for python related packages on 
>> one of my debian machines and immediately started getting apache 
>> segfaults. Turned out that php4-mysql was using libmysqlclient.so.10 
>> and the new python was using libmysqlclient.so.12. Updating php4-mysql 
>> brought the 2 libs in line and the segfault went away. I don't think 
>> this sort of problem is easily solved by any package manager, so it's 
>> something to keep in mind when doing updates.
>>
>> Jim
>>
>> PS. It's a good idea to keep discussions on list.
> 
> 
> OK, so after many hours of hair pulling, I finally figured out the 
> problem *is* with PHP's mysql library.
> 
> Disabling PHP entirely allowed my python code, which uses MySQLdb, to work.
> 
> Tomorrow I'm going to figure out how to make PHP and MySQLdb play 
> nicely, taking your comment above into consideration.

FYI, here's a starting point:

$ ldd /usr/lib/python2.4/site-packages/_mysql.so |grep mysql
$ ldd /usr/lib/php4/20050606/mysql.so |grep mysql

(The php mysql.so file may be in a different location on Ubuntu).

Jim

From gnupun at yahoo.com  Sat Jan 21 05:04:32 2006
From: gnupun at yahoo.com (gnupun xd)
Date: Sat Jan 21 05:04:35 2006
Subject: [mod_python] Mysql 5.0 license
Message-ID: <20060121100432.23307.qmail@web36215.mail.mud.yahoo.com>

Hi,

Is it legal to for non-GPL website code to use PyMySql
for MySql 4.1 or 5.0 connectivity?

Python MySqlDb lists itself as GPL on their website:
http://sourceforge.net/projects/mysql-python/

On the other hand MySql has Python on their "FLOSS
license-exception" list:
http://dev.mysql.com/doc/refman/5.1/en/mysql-floss-license-exception.html

Does this mean a MySql GPL client library can be used
without converting the library-calling code to GPL?

Thanks in advance.

__________________________________________________
Do You Yahoo!?
Tired of spam?  Yahoo! Mail has the best spam protection around 
http://mail.yahoo.com 
From grahamd at dscpl.com.au  Sat Jan 21 05:41:17 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Sat Jan 21 05:41:33 2006
Subject: [mod_python] Mysql 5.0 license
In-Reply-To: <20060121100432.23307.qmail@web36215.mail.mud.yahoo.com>
References: <20060121100432.23307.qmail@web36215.mail.mud.yahoo.com>
Message-ID: <2143E501-3835-4C38-9933-B13E01496810@dscpl.com.au>


On 21/01/2006, at 9:04 PM, gnupun xd wrote:

> Hi,
>
> Is it legal to for non-GPL website code to use PyMySql
> for MySql 4.1 or 5.0 connectivity?
>
> Python MySqlDb lists itself as GPL on their website:
> http://sourceforge.net/projects/mysql-python/
>
> On the other hand MySql has Python on their "FLOSS
> license-exception" list:
> http://dev.mysql.com/doc/refman/5.1/en/mysql-floss-license- 
> exception.html
>
> Does this mean a MySql GPL client library can be used
> without converting the library-calling code to GPL?

This sort of question would be better asked on comp.lang.python  
newsgroup.

   http://groups.google.com/group/comp.lang.python

Graham
From gnupun at yahoo.com  Sat Jan 21 15:54:19 2006
From: gnupun at yahoo.com (gnupun xd)
Date: Sat Jan 21 15:54:23 2006
Subject: [SPAM] Re: [mod_python] Mysql 5.0 license
In-Reply-To: <2143E501-3835-4C38-9933-B13E01496810@dscpl.com.au>
Message-ID: <20060121205419.63353.qmail@web36209.mail.mud.yahoo.com>

Don't modpython users use MySql or some other RDBMS? I
just want to know if a mod_python website can use
MySql 5.0 while keeping the website code
closed-source.

--- Graham Dumpleton <grahamd@dscpl.com.au> wrote:

> 
> This sort of question would be better asked on
> comp.lang.python  
> newsgroup.
> 
>    http://groups.google.com/group/comp.lang.python
> 
> Graham
> 


__________________________________________________
Do You Yahoo!?
Tired of spam?  Yahoo! Mail has the best spam protection around 
http://mail.yahoo.com 
From list at joreybump.com  Sat Jan 21 16:36:47 2006
From: list at joreybump.com (Jorey Bump)
Date: Sat Jan 21 16:37:00 2006
Subject: [SPAM] Re: [mod_python] Mysql 5.0 license
In-Reply-To: <20060121205419.63353.qmail@web36209.mail.mud.yahoo.com>
References: <20060121205419.63353.qmail@web36209.mail.mud.yahoo.com>
Message-ID: <43D2A96F.3070705@joreybump.com>

gnupun xd wrote:
> Don't modpython users use MySql or some other RDBMS? I
> just want to know if a mod_python website can use
> MySql 5.0 while keeping the website code
> closed-source.

It depends. It's not a question that can be answered easily, and it's 
certainly not on-topic here. Keep in mind that *using* licensed code on 
a web site is completely different than *distributing* licensed code. In 
many cases, you have no obligation to reveal the source for code you are 
not distributing.

A license can contain almost any kind of restriction, however. Without 
more details, only you are in the position to determine if you're 
violating any licenses. But you'll need to find a more appropriate 
forum, where you're likely to get better advice.


From nogradi at gmail.com  Sun Jan 22 11:04:05 2006
From: nogradi at gmail.com (Daniel Nogradi)
Date: Sun Jan 22 11:04:10 2006
Subject: [mod_python] apache segfault with mod_python + pysqlite2
In-Reply-To: <5f56302b0601220802oe373ab0k45ecc5e9934cc6f4@mail.gmail.com>
References: <5f56302b0601220802oe373ab0k45ecc5e9934cc6f4@mail.gmail.com>
Message-ID: <5f56302b0601220804w574ecccal894704f12d17a91f@mail.gmail.com>

(I sent this to the pysqlite mail list as well)

I have a problem with using pysqlite2 with mod_python (publisher handler).
Whenever I use a method from pysqlite2 apache segfaults. However, mod_python
in itself works perfectly well and executes any python code as it should
(except for pysqlite2 code) and pysqlite2 in itself works also perfectly
well unless I use it in combination with mod_python. That is, if
sqlite-code.py contains any pysqlite2 code, then running it from the command
line by 'python sqlite-code.py' produces no errors and does what it supposed
to do.

The only problem is when sqlite-code.py is accessed through a browser, in
this case apache segfaults and the error_log says:

[Sun Jan 22 15:17:29 2006] [notice] child pid 3012 exit signal Segmentation
fault (11)

Merely importing the pysqlite2 module makes no harm, if
sqlite-code.pycontains only:

from pysqlite2 import dbapi2 as sqlite
def test( req ):
    return "hello"

then there will be no segfault and the URL
http://server/python/sqlite-code/test will nicely output "hello". But if it
contains the following:

from pysqlite2 import dbapi2 as sqlite
def test( req ):
    con = sqlite.connect( "some.db" )
    con.close()
    return "hello"

then the segfault occurs. Writing permissions for ' some.db' can not be a
problem, every path was chmoded to 777 and I also tried to connect to
:memory: with the same result.

Some info on my settings:

apache directives:

<Directory /var/www/html/python>
    SetHandler python-program
    PythonHandler mod_python.publisher
    PythonDebug On
</Directory>

versions:

python 2.3.4-11 (Fedora Core 3 binary rpm package)
mod_python 3.1.3-5 (Fedora Core 3 binary rpm package)
httpd 2.0.52-3 (Fedora Core 3 binary rpm package)
sqlite 3.2.8 (compiled from source)
pysqlite 2.1.0 (compiled from source)

And SELinux is disabled.

Anyone has experienced this before? Also if you run apache + mod_python +
pysqlite2 and everything works, please let me know your version numbers, I
would then try to up/downgrade to that.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20060122/6c156d7a/attachment.html
From jpg at jgassociates.ca  Sun Jan 22 11:55:00 2006
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Sun Jan 22 11:54:34 2006
Subject: [mod_python] apache segfault with mod_python + pysqlite2
In-Reply-To: <5f56302b0601220804w574ecccal894704f12d17a91f@mail.gmail.com>
References: <5f56302b0601220802oe373ab0k45ecc5e9934cc6f4@mail.gmail.com>
	<5f56302b0601220804w574ecccal894704f12d17a91f@mail.gmail.com>
Message-ID: <43D3B8E4.7050603@jgassociates.ca>

Daniel Nogradi wrote:
> (I sent this to the pysqlite mail list as well)
> 
> I have a problem with using pysqlite2 with mod_python (publisher handler).
> Whenever I use a method from pysqlite2 apache segfaults. However, mod_python
> in itself works perfectly well and executes any python code as it should
> (except for pysqlite2 code) and pysqlite2 in itself works also perfectly
> well unless I use it in combination with mod_python. That is, if
> sqlite-code.py contains any pysqlite2 code, then running it from the command
> line by 'python sqlite-code.py' produces no errors and does what it supposed
> to do.
> 
> The only problem is when sqlite-code.py is accessed through a browser, in
> this case apache segfaults and the error_log says:
> 
> [Sun Jan 22 15:17:29 2006] [notice] child pid 3012 exit signal Segmentation
> fault (11)
> 
> Merely importing the pysqlite2 module makes no harm, if
> sqlite-code.pycontains only:
> 
> from pysqlite2 import dbapi2 as sqlite
> def test( req ):
>     return "hello"
> 
> then there will be no segfault and the URL
> http://server/python/sqlite-code/test will nicely output "hello". But if it
> contains the following:
> 
> from pysqlite2 import dbapi2 as sqlite
> def test( req ):
>     con = sqlite.connect( "some.db" )
>     con.close()
>     return "hello"
> 
> then the segfault occurs. Writing permissions for ' some.db' can not be a
> problem, every path was chmoded to 777 and I also tried to connect to
> :memory: with the same result.
> 
> Some info on my settings:
> 
> apache directives:
> 
> <Directory /var/www/html/python>
>     SetHandler python-program
>     PythonHandler mod_python.publisher
>     PythonDebug On
> </Directory>
> 
> versions:
> 
> python 2.3.4-11 (Fedora Core 3 binary rpm package)
> mod_python 3.1.3-5 (Fedora Core 3 binary rpm package)
> httpd 2.0.52-3 (Fedora Core 3 binary rpm package)
> sqlite 3.2.8 (compiled from source)
> pysqlite 2.1.0 (compiled from source)
> 
> And SELinux is disabled.
> 
> Anyone has experienced this before? Also if you run apache + mod_python +
> pysqlite2 and everything works, please let me know your version numbers, I
> would then try to up/downgrade to that.
> 

We often see this sort of segfault when 2 Apache modules are using 
different library version. The usual culprit is php-mysql and the python 
MySQLdb module. Any chance you are using php-sqlite? If so compare the 
lib versions of it your pysqlite module.

Jim
From nogradi at gmail.com  Sun Jan 22 13:52:53 2006
From: nogradi at gmail.com (Daniel Nogradi)
Date: Sun Jan 22 13:52:58 2006
Subject: [mod_python] apache segfault with mod_python + pysqlite2
Message-ID: <5f56302b0601221052y6a210a28ge3ec0d3c20859960@mail.gmail.com>

> We often see this sort of segfault when 2 Apache modules are using
> different library version. The usual culprit is php-mysql and the python
> MySQLdb module. Any chance you are using php-sqlite? If so compare the
> lib versions of it your pysqlite module.


Thanks for the tip, I'll check that.

In the meantime I have ran gdb on the core
dump of apache and it seems that there is a bug in pysqlite. Earlier
versions (2.0.x) work okay, but 2.1.x not, so it's neither a mod_python
nor an apache issue. So I won't bother the list with further developments
on this topic :))
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20060122/1b215d43/attachment.html
From dan.eloff at gmail.com  Sun Jan 22 19:32:58 2006
From: dan.eloff at gmail.com (Dan Eloff)
Date: Sun Jan 22 19:33:04 2006
Subject: [mod_python] SetHandler trick to have pretty url's
In-Reply-To: <20060110065205.60534.qmail@web34811.mail.mud.yahoo.com>
References: <20060110065205.60534.qmail@web34811.mail.mud.yahoo.com>
Message-ID: <4817b6fc0601221632g1f19068bs189aff51cc64e885@mail.gmail.com>

Actually I found this doesn't work well for me. I use a similar setup
with a config file that maps uris to python modules (initially I used
an automatic system like the publisher does, but I find this isn't
flexible enough), but FilesMatch works at the filesystem level. I want
to let apache handle all urls with a file extension, and mod_python to
handle any without a file extension.

So after playing around with it a bit, I settled on:

# don't invoke our python handler if the file has an extension, it
doesn't handle any addresses like that
<LocationMatch "^[^.]*$">
	SetHandler mod_python
	PythonHandler PyServer
	PythonDebug On
</LocationMatch>

I thought I might need a complex regular expression like yours, but my
tests show the above will still match a url with a . in the query
string, while denying any with a . before the ?

It's interesting to find someone else with a similar setup.

-Dan

On 1/9/06, courtney ludwin <courtneyludwin@yahoo.com> wrote:
> I was looking for a way to pretty up my mod_python
> url's the other day and I figured out a trick that
> works w/ the 'FilesMatch' directive in httpd.conf, I
> figure I'd share with the list....
>
>  <FilesMatch "(^[^\.]*$|^[^\?]*[\?]+[^$]+$)">
>     SetHandler python-program
>     PythonHandler common.dispatch.dispatcher
>     PythonDebug On
>   </FilesMatch>
>
> This match expression says anything without a file
> extension should be handled by dispatcher.py otherwise
> apache should handle it normally.  I wrote the
> dispatcher use a config file to map url's to
> mod_python handlers.
>
> Followed up a quick example in my blog:
> http://2centspoorer.blogspot.com/2006/01/creating-your-own-modpython-request.html
>
> Hope you find it useful.
>
> Thanks,
> Courtney
>
>
>
> __________________________________________
> Yahoo! DSL ? Something to write home about.
> Just $16.99/mo. or less.
> dsl.yahoo.com
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>

From dualcyclone at gmail.com  Mon Jan 23 11:24:57 2006
From: dualcyclone at gmail.com (tony sarendal)
Date: Mon Jan 23 11:25:04 2006
Subject: [mod_python] openbsd mod_python
In-Reply-To: <43CFCDD1.9060304@joreybump.com>
References: <3d5db09e0601190908h4c84cd0i14148ce9bce6dad4@mail.gmail.com>
	<43CFCDD1.9060304@joreybump.com>
Message-ID: <ad7542dc0601230824y270be59en@mail.gmail.com>

> It's also nice to hear from an OpenBSD user, but since that platform is
> heavily tweaked, it's useful to test installation on another platform
> for comparison, to flag OpenBSD-specific issues.


Regarding openbsd and mod_python, are there any specific issues
anyone here has seen with that combo ?

OpenBSD/apache2 required some tweaking with Semaphores to run ok,
and I have so far avoided writing anything with Threading, as it gave
me problems just runnning normal python stuff on openbsd.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20060123/30633854/attachment.html
From grahamd at dscpl.com.au  Mon Jan 23 15:09:19 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Mon Jan 23 15:09:33 2006
Subject: [mod_python] openbsd mod_python
In-Reply-To: <ad7542dc0601230824y270be59en@mail.gmail.com>
References: <3d5db09e0601190908h4c84cd0i14148ce9bce6dad4@mail.gmail.com>
	<43CFCDD1.9060304@joreybump.com>
	<ad7542dc0601230824y270be59en@mail.gmail.com>
Message-ID: <38599560328c61b06400592bf89e4201@dscpl.com.au>


On 24/01/2006, at 3:24 AM, tony sarendal wrote:

>
> ?
>> It's also nice to hear from an OpenBSD user, but since that platform 
>> is
>> heavily tweaked, it's useful to test installation on another platform
>> for comparison, to flag OpenBSD-specific issues.?
> Regarding openbsd and mod_python, are there any specific issues
> anyone here has seen with that combo ?
> ?
> OpenBSD/apache2 required some tweaking with Semaphores to run ok,
> and I have so far avoided writing anything with Threading, as it gave
> me problems just runnning normal python stuff on openbsd.

Which version of mod_python are you using? If using mod_python 3.1.4
or earlier, you really need to upgrade and try out 3.2.6. As it
addresses many issues across various platforms.

   http://www.modpython.org/dist/


Graham



From pjs at packet-addiction.org  Mon Jan 23 15:19:00 2006
From: pjs at packet-addiction.org (Peter Sanchez)
Date: Mon Jan 23 15:17:32 2006
Subject: [mod_python] 3.2.5b - Questions
Message-ID: <3436D1FE-E8D2-4F52-8694-9D7E2783A7E5@packet-addiction.org>

First, I upgraded from 3.2.2b to 3.2.5b last night, and immediately  
started getting the following:

[Sun Jan 22 21:33:53 2006] [error] make_obcallback: could not import  
mod_python.apache.\n
Traceback (most recent call last):
   File "/usr/local/lib/python2.4/site-packages/mod_python/ 
apache.py", line 765, in ?
     exists_config_define = _apache.exists_config_define
AttributeError: 'module' object has no attribute 'exists_config_define'

So I edited apache.py and commented out that line, as I didn't see it  
referenced anywhere else in the source. Seems to be fine so far, I  
hope I am not gonna be needing that :) Any ideas on this one?

Second, I switched our website, finally, to the new back end using  
mod_python late last night. One thing I hadn't thought of though, was  
all the subdirectories using mod_python as the default handler as  
well (for images, etc.) So I ended up having to do the following to  
my config (in a panic heh)


     <Directory /home/ahcabron/public_html>
         Options FollowSymLinks
         AllowOverride All
         Options -MultiViews
         SetHandler python-program
         PythonHandler mod_python.publisher
         PythonAutoReload Off
         #PythonDebug On
     </Directory>

     <Location /main>
         SetHandler default-handler
     </Location>

     <Location /albums>
         SetHandler default-handler
     </Location>

     <Location /stats>
         SetHandler default-handler
     </Location>


Is there a better way to do this other than a bunch of <Location>  
directives?

Thanks!

Peter
From grahamd at dscpl.com.au  Mon Jan 23 17:02:37 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Mon Jan 23 17:02:41 2006
Subject: [mod_python] 3.2.5b - Questions
Message-ID: <1138053757.15200@dscpl.user.openhosting.com>

Peter Sanchez wrote ..
> First, I upgraded from 3.2.2b to 3.2.5b last night, and immediately  
> started getting the following:
> 
> [Sun Jan 22 21:33:53 2006] [error] make_obcallback: could not import  
> mod_python.apache.\n
> Traceback (most recent call last):
>    File "/usr/local/lib/python2.4/site-packages/mod_python/ 
> apache.py", line 765, in ?
>      exists_config_define = _apache.exists_config_define
> AttributeError: 'module' object has no attribute 'exists_config_define'
> 
> So I edited apache.py and commented out that line, as I didn't see it 
> referenced anywhere else in the source. Seems to be fine so far, I  
> hope I am not gonna be needing that :) Any ideas on this one?

My guess is that you did an:

  apachectl restart

rather than:

  apachectl stop
  apachectl start

The old _apache module was still loaded into the parent Apache process
and when it forked to create the child processes, the newer Python code
couldn't find the function in _apache module it was expecting.

When upgrading mod_python it is always a good idea to properly stop
and start Apache. If you did, then check that the mod_python.so
module in the Apache modules directory is actually the newer one.

> Second, I switched our website, finally, to the new back end using  
> mod_python late last night. One thing I hadn't thought of though, was 
> all the subdirectories using mod_python as the default handler as  
> well (for images, etc.) So I ended up having to do the following to  
> my config (in a panic heh)
> 
> 
>      <Directory /home/ahcabron/public_html>
>          Options FollowSymLinks
>          AllowOverride All
>          Options -MultiViews
>          SetHandler python-program
>          PythonHandler mod_python.publisher
>          PythonAutoReload Off

PythonAutoReload option is actually broken in 3.2.5b. Finally fixed in
3.2.6. It looks like it was broken for some time.

>          #PythonDebug On
>      </Directory>
> 
>      <Location /main>
>          SetHandler default-handler
>      </Location>
> 
>      <Location /albums>
>          SetHandler default-handler
>      </Location>
> 
>      <Location /stats>
>          SetHandler default-handler
>      </Location>
> 
> 
> Is there a better way to do this other than a bunch of <Location>  
> directives?

Only by using a bunch of Directory directives instead. :-)

If you are not using extensions for URLs mapping to the
mod_python.publisher code, you could also use some of the tricks
discussed recently of disabling mod_python for any URL which
uses an extension in it or vice versa. See:

  http://www.modpython.org/pipermail/mod_python/2006-January/019918.html
  http://www.modpython.org/pipermail/mod_python/2006-January/020064.html

Look back and forth for issues discussed related to doing this.

Graham
  
From python_eager at yahoo.com  Mon Jan 23 23:37:14 2006
From: python_eager at yahoo.com (python eager)
Date: Mon Jan 23 23:37:19 2006
Subject: [mod_python] reg editor
Message-ID: <20060124043714.97159.qmail@web36413.mail.mud.yahoo.com>

Hi,
    Which editor is best to write python and psp program. please give me suggestion and give the website name where we can download that editor. 
   
  Please give the solution for this!
   
  regards
  Python Eager
   

		
---------------------------------
Yahoo! Photos
 Ring in the New Year with Photo Calendars. Add photos, events, holidays, whatever.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20060123/045790f5/attachment.html
From grahamd at dscpl.com.au  Mon Jan 23 23:39:48 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Mon Jan 23 23:39:50 2006
Subject: [mod_python] openbsd mod_python
Message-ID: <1138077588.4648@dscpl.user.openhosting.com>

Michael Steinfeld wrote ..
> On 1/23/06, Graham Dumpleton <grahamd@dscpl.com.au> wrote:
> > On 24/01/2006, at 3:24 AM, tony sarendal wrote:
> > >> It's also nice to hear from an OpenBSD user, but since that platform
> > >> is
> > >> heavily tweaked, it's useful to test installation on another platform
> > >> for comparison, to flag OpenBSD-specific issues.
> > > Regarding openbsd and mod_python, are there any specific issues
> > > anyone here has seen with that combo ?
> > >
> > > OpenBSD/apache2 required some tweaking with Semaphores to run ok,
> > > and I have so far avoided writing anything with Threading, as it gave
> > > me problems just runnning normal python stuff on openbsd.
> >
> > Which version of mod_python are you using? If using mod_python 3.1.4
> > or earlier, you really need to upgrade and try out 3.2.6. As it
> > addresses many issues across various platforms.
> >
> >    http://www.modpython.org/dist/
>
> first: OpenBSD uses httpd 1.3.6 so mod_python 3.2x wouldnt work
> 
> second: i tried all other config possibilities ... including httpd
> 2.0x and mod_python 3.2 as well as the latest mod_python beta... all
> attempts returned the errors I posted abovel

Michael, that latest response of mine was in relation to issues posted
by Tony Sarendal not your original post.

In respect of your original problems, the last question I asked of you but which
was not answered, was for you to clarify which operating system you are really
using. Your subject line mentioned OpenBSD and you referred to OpenBSD
yet the version string information you posted at one point suggested you were
actually running Apple Mac OS X on a G5.

Thus, please indicate whether you are using a stock OpenBSD, Apple retail
version of Mac OS X or Open Source Darwin.

Anyway, so far from the mail trail the following seems to have transpired.

1. You tried using Apache 2.2 with mod_python 3.1.4. You were told to use
Apache 2.0 instead as 2.2 is not supported.

2. You then jumped in and posted that you were using G5 and gave version
string:

  Python 2.4.1 (#1, Sep 4 2005, 01:46:49) [GCC 4.0.0 (Apple Computer,
  Inc. build 5026)]
  ('Darwin', 'g5', '8.4.0', 'Darwin Kernel Version 8.4.0: Tue Jan 3
  18:22:10 PST 2006; root:xnu-792.6.56.obj~1/RELEASE_PPC', 'Power
  Macintosh')

3. You then posted same problem as 1 but using Apache 2.0.

4. I asked for qualification on what platform you were using and if you were
using Mac OS X suggested one possible issue. See:

  http://www.modpython.org/pipermail/mod_python/2006-January/020028.html

As yet you have not responded directly to query about platform, nor
indicated specifically whether the suggestion worked or didn't.

Without knowing eactly which platform you are using, cannot give
suggestions of what the issue may be or how to debug the problem.

BTW, please keep discussion on mod_python mailing list.

Graham

From grahamd at dscpl.com.au  Mon Jan 23 23:58:32 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Mon Jan 23 23:58:34 2006
Subject: [mod_python] reg editor
Message-ID: <1138078712.16355@dscpl.user.openhosting.com>

python eager wrote ..
> Hi,
>     Which editor is best to write python and psp program. please give me
> suggestion and give the website name where we can download that editor.
>    
>   Please give the solution for this!

Am sure people will express personal opinions, personally I use "vi", but
as to choice, using Google to search for "Python source code editor"
would be a good place to start digging if you haven't done so already.

One good link this yields is a list on the actual Python site.

  http://wiki.python.org/moin/PythonEditors

Then there are all the others in Google.

  http://www.google.com/search?client=safari&rls=en&q=Python+source+code+editor&ie=UTF-8&oe=UTF-8

Not sure if there is any editor which specifically understands PSP.

Ultimately it is probably going to come down to personal preference
and you really need to just try some. Did once see a cute demo though
of the editor within PythonCard which looked interesting. It is more
focused on GUI development so possibly not appropriate. But then,
maybe I was confused as to what was what, and what I was really
seeing and thought was cute was PyCrust embedded in PythonCard.

Graham
From dualcyclone at gmail.com  Tue Jan 24 03:16:35 2006
From: dualcyclone at gmail.com (tony sarendal)
Date: Tue Jan 24 03:16:39 2006
Subject: [mod_python] openbsd mod_python
In-Reply-To: <ad7542dc0601240014t18488fj@mail.gmail.com>
References: <1138077588.4648@dscpl.user.openhosting.com>
	<ad7542dc0601240014t18488fj@mail.gmail.com>
Message-ID: <ad7542dc0601240016x3ba1ae6s@mail.gmail.com>

Michael, that latest response of mine was in relation to issues posted
> > by Tony Sarendal not your original post.
>
>
> Sorry about adding to the confusion.
> It was just nice seeing someone using openbsd+mod_python like I currently
> do.
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20060124/65b8892e/attachment.html
From davidf at sjsoft.com  Tue Jan 24 13:17:44 2006
From: davidf at sjsoft.com (David Fraser)
Date: Tue Jan 24 13:17:46 2006
Subject: [mod_python] mod_python on Mobile phone - Nokia / Symbian S60
	article
Message-ID: <43D66F48.5050906@sjsoft.com>

Hi all

This article is really interesting:

http://research.nokia.com/research/software/mobile-web-server/index.html

They seem to have ported Apache and mod_python to the Symbian 
platform... Has there been anything about this on the lists or did I 
miss it?

David
From nicolas.lehuen at gmail.com  Tue Jan 24 14:49:13 2006
From: nicolas.lehuen at gmail.com (Nicolas Lehuen)
Date: Tue Jan 24 14:49:18 2006
Subject: [mod_python] mod_python on Mobile phone - Nokia / Symbian S60
	article
In-Reply-To: <43D66F48.5050906@sjsoft.com>
References: <43D66F48.5050906@sjsoft.com>
Message-ID: <c298f2d70601241149p34e9a30dn@mail.gmail.com>

Incredible ! That would be nice to have a but of information about
this, like the version they used and any caveat they noticed. This
could be a great piece of news to generate buzz around mod_python,
something that could be announced with the latest 3.2 release ;).

Regards,
Nicolas

2006/1/24, David Fraser <davidf@sjsoft.com>:
> Hi all
>
> This article is really interesting:
>
> http://research.nokia.com/research/software/mobile-web-server/index.html
>
> They seem to have ported Apache and mod_python to the Symbian
> platform... Has there been anything about this on the lists or did I
> miss it?
>
> David
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>

From nicolas.lehuen at gmail.com  Tue Jan 24 14:50:00 2006
From: nicolas.lehuen at gmail.com (Nicolas Lehuen)
Date: Tue Jan 24 14:50:05 2006
Subject: [mod_python] mod_python on Mobile phone - Nokia / Symbian S60
	article
In-Reply-To: <c298f2d70601241149p34e9a30dn@mail.gmail.com>
References: <43D66F48.5050906@sjsoft.com>
	<c298f2d70601241149p34e9a30dn@mail.gmail.com>
Message-ID: <c298f2d70601241150v5eadfd6ej@mail.gmail.com>

I'm contacting Jonathan Wikman through the link available on the site.

2006/1/24, Nicolas Lehuen <nicolas.lehuen@gmail.com>:
> Incredible ! That would be nice to have a but of information about
> this, like the version they used and any caveat they noticed. This
> could be a great piece of news to generate buzz around mod_python,
> something that could be announced with the latest 3.2 release ;).
>
> Regards,
> Nicolas
>
> 2006/1/24, David Fraser <davidf@sjsoft.com>:
> > Hi all
> >
> > This article is really interesting:
> >
> > http://research.nokia.com/research/software/mobile-web-server/index.html
> >
> > They seem to have ported Apache and mod_python to the Symbian
> > platform... Has there been anything about this on the lists or did I
> > miss it?
> >
> > David
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://mailman.modpython.org/mailman/listinfo/mod_python
> >
>

From sean at barriescene.com  Tue Jan 24 16:56:11 2006
From: sean at barriescene.com (Sean Jamieson)
Date: Tue Jan 24 16:56:18 2006
Subject: [mod_python] mod_python.util Supplement function: refresh
Message-ID: <43D6A27B.9040301@barriescene.com>

I've written a supplemental function for the mod_python.util module, 
similar to mod_python.util.redirect, this is a helper function that sets 
the Refresh header.

Personally I use Refresh atleast as much Location (redirct), if not more.

So here it is, in all it's simplicity:

def refresh(req, time, location=None):
    """refresh( req, seconds, location=None ) -> None

    A convenience function to provide refresh/redirection via the HTTP 
Refresh header
    """
    if req.sent_bodyct:
        raise IOError, "Cannot send refresh header after headers have 
already been sent."
    req.err_headers_out["Refresh"] = str(seconds) # seconds is usually 
given as an integer
    if location:
        req.err_headers_out["Refresh"] += ';url=' + location
From grahamd at dscpl.com.au  Tue Jan 24 17:10:34 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Tue Jan 24 17:10:42 2006
Subject: [mod_python] mod_python.util Supplement function: refresh
Message-ID: <1138140634.22403@dscpl.user.openhosting.com>

Sean Jamieson wrote ..
> I've written a supplemental function for the mod_python.util module, 
> similar to mod_python.util.redirect, this is a helper function that sets
> the Refresh header.
> 
> Personally I use Refresh atleast as much Location (redirct), if not more.
> 
> So here it is, in all it's simplicity:
> 
> def refresh(req, time, location=None):
>     """refresh( req, seconds, location=None ) -> None
> 
>     A convenience function to provide refresh/redirection via the HTTP
> Refresh header
>     """
>     if req.sent_bodyct:
>         raise IOError, "Cannot send refresh header after headers have 
> already been sent."
>     req.err_headers_out["Refresh"] = str(seconds) # seconds is usually
> given as an integer
>     if location:
>         req.err_headers_out["Refresh"] += ';url=' + location

If you want to ensure this gets considered at some point, log it as a
new feature/wish at:

  http://issues.apache.org/jira/browse/MODPYTHON

Requests like this only posted to the mailing list inevitably get lost
over time.

Graham
From jamesp at westcoastaerospace.com  Tue Jan 24 17:51:47 2006
From: jamesp at westcoastaerospace.com (James Paige)
Date: Tue Jan 24 17:50:55 2006
Subject: [mod_python] mod_python executing old versions of my code
Message-ID: <43D6AF83.8020701@westcoastaerospace.com>

I'm new to mod_python... so maybe I have missed something fundamental 
here, but mod_python seems to be keeping several copies of my old code 
in memory, so when I make changes and reload the page, sometimes I get 
my changes, and sometimes I get a seemingly-random version of the code 
that I have already changed.

Here is a simple test-case I set up.

Here is my .htaccess file:

-------------------------
SetHandler python-program
PythonHandler main
PythonDebug On
-------------------------

(I am using version 2.7.10 as shipped in Debian stable's 
libapache-mod-python package, which is why I am using "python-program")

Here is my main.py

-----------------------------
from mod_python import apache
import testmodule

def handler(req):
     req.write("Hello World!")
     testmodule.foo(req)
     return apache.OK
-----------------------------

and here is the imported testmodule.py

--------------------------------
def foo(req):
    req.write('three blind mice')
--------------------------------

The first time I load this test in my web browser, I see the expected 
result:

   Hello World!three blind mice

I edit testmodule.py and change the string to something else:

--------------------------------------
def foo(req):
    req.write('mary had a little lamb')
--------------------------------------

I then reload my web browser. Sometimes this results in "Hello 
World!mary had a little lamb", and sometimes it reuslts in "Hello 
World!three blind mice"

I edit the string again, and hit reload again. Maybe I get the new 
string.... or maybe I get one of the strings I used previously. I keep 
making changes to testmodule.py and I keep reloading the results, and 
the results are almost always wrong.

I know this is not a browser cache problem. I have cleared/disabled my 
web-browser's cache.

I read about "Multiple Interpreters" in the documentation, and have 
tried to force my code to run in a single interpreter by adding:

PythonInterpreter "test_interpreter"

to my .htaccess file, but that makes no difference.

This problem only occurs in the included module. I can edit main.py and 
my changes are always applied. I notice in the apache logs that 
everytime I reload the page I see:

   [notice] mod_python: (Re)importing main from None

But I can find no way to force testmodule to be re-imported. What am I 
doing wrong?

---
James Paige

From grahamd at dscpl.com.au  Tue Jan 24 18:15:08 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Tue Jan 24 18:15:10 2006
Subject: [mod_python] mod_python executing old versions of my code
Message-ID: <1138144508.30648@dscpl.user.openhosting.com>

What you are seeing is normal behaviour for mod_python for the way your
code is set up. It is one of a number of cases which highlight the
shortcomings of the module importing and automatic module reloading
system of mod_python. You can read more about some of the problems
with module importing here:

  http://www.dscpl.com.au/articles/modpython-003.html

More information interspersed below.

James Paige wrote ..
> I'm new to mod_python... so maybe I have missed something fundamental 
> here, but mod_python seems to be keeping several copies of my old code
> in memory, so when I make changes and reload the page, sometimes I get
> my changes, and sometimes I get a seemingly-random version of the code
> that I have already changed.
> 
> Here is a simple test-case I set up.
> 
> Here is my .htaccess file:
> 
> -------------------------
> SetHandler python-program
> PythonHandler main
> PythonDebug On
> -------------------------
> 
> (I am using version 2.7.10 as shipped in Debian stable's 
> libapache-mod-python package, which is why I am using "python-program")
> 
> Here is my main.py
> 
> -----------------------------
> from mod_python import apache
> import testmodule
> 
> def handler(req):
>      req.write("Hello World!")
>      testmodule.foo(req)
>      return apache.OK
> -----------------------------
> 
> and here is the imported testmodule.py
> 
> --------------------------------
> def foo(req):
>     req.write('three blind mice')
> --------------------------------
> 
> The first time I load this test in my web browser, I see the expected 
> result:
> 
>    Hello World!three blind mice
> 
> I edit testmodule.py and change the string to something else:
> 
> --------------------------------------
> def foo(req):
>     req.write('mary had a little lamb')
> --------------------------------------
> 
> I then reload my web browser. Sometimes this results in "Hello 
> World!mary had a little lamb", and sometimes it reuslts in "Hello 
> World!three blind mice"

When you see what you expect, it is because the request was handled by a
different Apache child process which had never previously loaded your
code. Since it is the first time it has needed to load it, it will
obviously get the most recent version.

When you don't see what you expect, it is because the request was
handled by the the existing Apache child process which had already
loaded the code.

> I edit the string again, and hit reload again. Maybe I get the new 
> string.... or maybe I get one of the strings I used previously. I keep
> making changes to testmodule.py and I keep reloading the results, and 
> the results are almost always wrong.
> 
> I know this is not a browser cache problem. I have cleared/disabled my
> web-browser's cache.
> 
> I read about "Multiple Interpreters" in the documentation, and have 
> tried to force my code to run in a single interpreter by adding:
> 
> PythonInterpreter "test_interpreter"
> 
> to my .htaccess file, but that makes no difference.
> 
> This problem only occurs in the included module. I can edit main.py and
> my changes are always applied. I notice in the apache logs that 
> everytime I reload the page I see:
> 
>    [notice] mod_python: (Re)importing main from None

The automatic module reloading only applies to the top most module,
ie., main.py, and not to anything imported using "import".

> But I can find no way to force testmodule to be re-imported. What am I
> doing wrong?

You are not doing anything wrong, the current system simply doesn't
work very well.

The best you can get is to use:

  from mod_python import apache
  import os

  __here__ = os.path.dirname(__file__)
  
  def handler(req):
       req.write("Hello World!")
       testmodule = apache.import_module("testmodule,path=[__here__])
       testmodule.foo(req)
       return apache.OK

This uses apache.import_module() on each request to import the module.
In practice though, if the file has not changed it just uses what is already
in the cache. If it has changed, you should then see the change.

You can't use apache.import_module() at global scope in the module and
get the same effect as that only gets executed when main.py is imported.
Thus you don't get the check for changes to testmodule.py on every
request.

I have a completely rewritten module importing system for mod_python
which addresses nearly all the issues it has. I will be making it available for
trialing after mod_python 3.2.6 is officially released. It will require though
having 3.2.6, which means it will be useless to you with 2.7.11.

Whether this new module importing system gets adopted is another
matter entirely though. Some have argued in the past that the current
arrangement is adequate even though it has known problems. ;-(

Graham
From grahamd at dscpl.com.au  Tue Jan 24 18:49:40 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Tue Jan 24 18:49:45 2006
Subject: [mod_python] mod_python executing old versions of my code
Message-ID: <1138146580.20848@dscpl.user.openhosting.com>

=?ISO-8859-2?Q?Martin_MOKREJ=A9?= wrote ..
> 
> 
> Graham Dumpleton wrote:
> 
> >>But I can find no way to force testmodule to be re-imported. What am
> I
> >>doing wrong?
> > 
> > 
> > You are not doing anything wrong, the current system simply doesn't
> > work very well.
> > 
> > The best you can get is to use:
> > 
> >   from mod_python import apache
> >   import os
> > 
> >   __here__ = os.path.dirname(__file__)
> >   
> >   def handler(req):
> >        req.write("Hello World!")
> >        testmodule = apache.import_module("testmodule,path=[__here__])
> >        testmodule.foo(req)
> >        return apache.OK
> > 
> > This uses apache.import_module() on each request to import the module.
> > In practice though, if the file has not changed it just uses what is
> already
> > in the cache. If it has changed, you should then see the change.
> > 
> > You can't use apache.import_module() at global scope in the module and
> > get the same effect as that only gets executed when main.py is imported.
> > Thus you don't get the check for changes to testmodule.py on every
> > request.
> > 
> > I have a completely rewritten module importing system for mod_python
> > which addresses nearly all the issues it has. I will be making it available
> for
> > trialing after mod_python 3.2.6 is officially released. It will require
> though
> > having 3.2.6, which means it will be useless to you with 2.7.11.
> 
> I still see problems with module import using 3.2.6 on linux, compiled
> today.
> I am using typically something like:
> 
> try:
>     from mod_python import apache
> 
>     _directory = os.path.dirname(__file__)
>     for _my_modulename in ['web_settings', 'web_header', 'web_menu', 'web_text_frame',
> 'web_footer', 'sql_io', 'helper_functions', 'globals']:
>         __dict__[_my_modulename] = apache.import_module(_my_modulename,
> log=1, path=[_directory])
> except: # without raise
>     import web_settings
>     import web_header
>     import web_menu
>     import web_text_frame # calls mysql_python driver
>     import web_footer
>     import sql_io
>     import helper_functions
>     import iresite_globals
> 
> 
> So, should I wait or adjust my code?

What sort of problems?

Note though that the more major problems with apache.import_module()
aren't fixed in 3.2.6.

You should find that mod_python.publisher may work a bit better in 3.2.6
as it uses a separate module importer. If you use apache.import_module()
inside of mod_python.publisher code, you could end up with a whole new
bunch of problems if a module is imported by both mod_python.publisher
and apache.import_module(). Specifically that there will be two distinct
copies of the module. I pointed out the problems that the changes to the
mod_python.publisher module importer would cause in this situation, but
the changes were still made. I would have preferred to have seen the use
of apache.import_module() by mod_python.publisher be left alone until
apache.import_module() was fixed. Ie., better known problems than a whole
class of new ones. :-(

> > Whether this new module importing system gets adopted is another
> > matter entirely though. Some have argued in the past that the current
> > arrangement is adequate even though it has known problems. ;-(
> 
> No, the apache stop/start sucks, the restart approach doesn't work as the
> init.d scripts on gentoo
> fail to wait for apache to shutdown completely ... they start to startup
> somehow immediately,
> recognize apache is still up, die but leave the lockfiles in. I have to
> start apache in
> several start/start attempts to get it started actually.

Apache child processes not terminating promptly may be because of:

  http://issues.apache.org/jira/browse/MODPYTHON-109

this is not addressed in 3.2.6 anf needs a bit more research first to see
if the simple solution will not cause other issues. At this stage the only
known issue is that not calling Py_Finalize() will mean that code registered
using Python wrapper for atexit() will not be called. Have to check properly
yet though whether code registered with apache.register_cleanup() and
req.server.register_cleanup() will still be executed.

Graham
From jamesp at westcoastaerospace.com  Tue Jan 24 19:12:45 2006
From: jamesp at westcoastaerospace.com (James Paige)
Date: Tue Jan 24 19:11:54 2006
Subject: [mod_python] mod_python executing old versions of my code
In-Reply-To: <1138144508.30648@dscpl.user.openhosting.com>
References: <1138144508.30648@dscpl.user.openhosting.com>
Message-ID: <43D6C27D.8000801@westcoastaerospace.com>

Wow, thank you Graham! That is a lot of good information. I think the 
workaround you offered will serve my purposes for now, and I do 
certainly hope that your proposed changes go into a future version of 
mod_python.

I have a hard time imagining how anyone could possibly argue that the 
current behavior is non-broken.

---
James Paige

Graham Dumpleton wrote:
> What you are seeing is normal behaviour for mod_python for the way your
> code is set up. It is one of a number of cases which highlight the
> shortcomings of the module importing and automatic module reloading
> system of mod_python. You can read more about some of the problems
> with module importing here:
> 
>   http://www.dscpl.com.au/articles/modpython-003.html
> 
> More information interspersed below.
> 
> James Paige wrote ..
>> I'm new to mod_python... so maybe I have missed something fundamental 
>> here, but mod_python seems to be keeping several copies of my old code
>> in memory, so when I make changes and reload the page, sometimes I get
>> my changes, and sometimes I get a seemingly-random version of the code
>> that I have already changed.
>>
>> Here is a simple test-case I set up.
>>
>> Here is my .htaccess file:
>>
>> -------------------------
>> SetHandler python-program
>> PythonHandler main
>> PythonDebug On
>> -------------------------
>>
>> (I am using version 2.7.10 as shipped in Debian stable's 
>> libapache-mod-python package, which is why I am using "python-program")
>>
>> Here is my main.py
>>
>> -----------------------------
>> from mod_python import apache
>> import testmodule
>>
>> def handler(req):
>>      req.write("Hello World!")
>>      testmodule.foo(req)
>>      return apache.OK
>> -----------------------------
>>
>> and here is the imported testmodule.py
>>
>> --------------------------------
>> def foo(req):
>>     req.write('three blind mice')
>> --------------------------------
>>
>> The first time I load this test in my web browser, I see the expected 
>> result:
>>
>>    Hello World!three blind mice
>>
>> I edit testmodule.py and change the string to something else:
>>
>> --------------------------------------
>> def foo(req):
>>     req.write('mary had a little lamb')
>> --------------------------------------
>>
>> I then reload my web browser. Sometimes this results in "Hello 
>> World!mary had a little lamb", and sometimes it reuslts in "Hello 
>> World!three blind mice"
> 
> When you see what you expect, it is because the request was handled by a
> different Apache child process which had never previously loaded your
> code. Since it is the first time it has needed to load it, it will
> obviously get the most recent version.
> 
> When you don't see what you expect, it is because the request was
> handled by the the existing Apache child process which had already
> loaded the code.
> 
>> I edit the string again, and hit reload again. Maybe I get the new 
>> string.... or maybe I get one of the strings I used previously. I keep
>> making changes to testmodule.py and I keep reloading the results, and 
>> the results are almost always wrong.
>>
>> I know this is not a browser cache problem. I have cleared/disabled my
>> web-browser's cache.
>>
>> I read about "Multiple Interpreters" in the documentation, and have 
>> tried to force my code to run in a single interpreter by adding:
>>
>> PythonInterpreter "test_interpreter"
>>
>> to my .htaccess file, but that makes no difference.
>>
>> This problem only occurs in the included module. I can edit main.py and
>> my changes are always applied. I notice in the apache logs that 
>> everytime I reload the page I see:
>>
>>    [notice] mod_python: (Re)importing main from None
> 
> The automatic module reloading only applies to the top most module,
> ie., main.py, and not to anything imported using "import".
> 
>> But I can find no way to force testmodule to be re-imported. What am I
>> doing wrong?
> 
> You are not doing anything wrong, the current system simply doesn't
> work very well.
> 
> The best you can get is to use:
> 
>   from mod_python import apache
>   import os
> 
>   __here__ = os.path.dirname(__file__)
>   
>   def handler(req):
>        req.write("Hello World!")
>        testmodule = apache.import_module("testmodule,path=[__here__])
>        testmodule.foo(req)
>        return apache.OK
> 
> This uses apache.import_module() on each request to import the module.
> In practice though, if the file has not changed it just uses what is already
> in the cache. If it has changed, you should then see the change.
> 
> You can't use apache.import_module() at global scope in the module and
> get the same effect as that only gets executed when main.py is imported.
> Thus you don't get the check for changes to testmodule.py on every
> request.
> 
> I have a completely rewritten module importing system for mod_python
> which addresses nearly all the issues it has. I will be making it available for
> trialing after mod_python 3.2.6 is officially released. It will require though
> having 3.2.6, which means it will be useless to you with 2.7.11.
> 
> Whether this new module importing system gets adopted is another
> matter entirely though. Some have argued in the past that the current
> arrangement is adequate even though it has known problems. ;-(
> 
> Graham
> 

From nogradi at gmail.com  Tue Jan 24 20:18:35 2006
From: nogradi at gmail.com (Daniel Nogradi)
Date: Tue Jan 24 20:18:39 2006
Subject: [mod_python] mod_python executing old versions of my code
In-Reply-To: <5f56302b0601241715v13c1d3e7n7af3039697649242@mail.gmail.com>
References: <5f56302b0601241715v13c1d3e7n7af3039697649242@mail.gmail.com>
Message-ID: <5f56302b0601241718s4d19023wf792da0eea8e65dc@mail.gmail.com>

> I'm new to mod_python... so maybe I have missed something fundamental
> here, but mod_python seems to be keeping several copies of my old code
> in memory, so when I make changes and reload the page, sometimes I get
>
> my changes, and sometimes I get a seemingly-random version of the code
> that I have already changed.
>
>
You can also try setting the MaxRequestsPerChild apache directive to 1, it
worked for me very well. Initially I had the same problem like you, but with

MaxRequestsPerChild 1

in the apache config file the problem is gone because every child that loads
your code dies after the request, so it doesn't stay anywhere.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20060125/0efed454/attachment.html
From sean at barriescene.com  Wed Jan 25 12:31:28 2006
From: sean at barriescene.com (Sean Jamieson)
Date: Wed Jan 25 12:31:34 2006
Subject: [mod_python] mod_python.util Supplement function: refresh
In-Reply-To: <1138140634.22403@dscpl.user.openhosting.com>
References: <1138140634.22403@dscpl.user.openhosting.com>
Message-ID: <43D7B5F0.2060302@barriescene.com>

Graham Dumpleton wrote:

>Sean Jamieson wrote ..
>  
>
>>I've written a supplemental function for the mod_python.util module, 
>>similar to mod_python.util.redirect, this is a helper function that sets
>>the Refresh header.
>>
>>Personally I use Refresh atleast as much Location (redirct), if not more.
>>
>>So here it is, in all it's simplicity:
>>
>>def refresh(req, time, location=None):
>>    """refresh( req, seconds, location=None ) -> None
>>
>>    A convenience function to provide refresh/redirection via the HTTP
>>Refresh header
>>    """
>>    if req.sent_bodyct:
>>        raise IOError, "Cannot send refresh header after headers have 
>>already been sent."
>>    req.err_headers_out["Refresh"] = str(seconds) # seconds is usually
>>given as an integer
>>    if location:
>>        req.err_headers_out["Refresh"] += ';url=' + location
>>    
>>
>
>If you want to ensure this gets considered at some point, log it as a
>new feature/wish at:
>
>  http://issues.apache.org/jira/browse/MODPYTHON
>
>Requests like this only posted to the mailing list inevitably get lost
>over time.
>
>Graham
>  
>
Thank you, Graham

Sean
From jamesp at westcoastaerospace.com  Wed Jan 25 16:10:16 2006
From: jamesp at westcoastaerospace.com (James Paige)
Date: Wed Jan 25 16:09:16 2006
Subject: [mod_python] mod_python executing old versions of my code
In-Reply-To: <5f56302b0601241718s4d19023wf792da0eea8e65dc@mail.gmail.com>
References: <5f56302b0601241715v13c1d3e7n7af3039697649242@mail.gmail.com>
	<5f56302b0601241718s4d19023wf792da0eea8e65dc@mail.gmail.com>
Message-ID: <43D7E938.70400@westcoastaerospace.com>

Daniel Nogradi wrote:
>> I'm new to mod_python... so maybe I have missed something fundamental
>> here, but mod_python seems to be keeping several copies of my old code
>> in memory, so when I make changes and reload the page, sometimes I get
>>
>> my changes, and sometimes I get a seemingly-random version of the code
>> that I have already changed.
>>
>>
> You can also try setting the MaxRequestsPerChild apache directive to 1, it
> worked for me very well. Initially I had the same problem like you, but with
> 
> MaxRequestsPerChild 1
> 
> in the apache config file the problem is gone because every child that loads
> your code dies after the request, so it doesn't stay anywhere.

That sounds like it would be an excellent workaround if I was using a
dedicated server that ran nothing but mod_python, but for a shared
server-- especially one on which I might not necessarily have root
access at all, that will not work.

---
James Paige

From mmokrejs at ribosome.natur.cuni.cz  Wed Jan 25 16:51:17 2006
From: mmokrejs at ribosome.natur.cuni.cz (=?ISO-8859-2?Q?Martin_MOKREJ=A9?=)
Date: Wed Jan 25 16:51:20 2006
Subject: [mod_python] mod_python executing old versions of my code
In-Reply-To: <1138146580.20848@dscpl.user.openhosting.com>
References: <1138146580.20848@dscpl.user.openhosting.com>
Message-ID: <43D7F2D5.2010305@ribosome.natur.cuni.cz>

Hi Graham,
  my answer goes now through the list, so others can learn also on
my issue ...

Graham Dumpleton wrote:
> Martin MOKREJS wrote ..
>>Graham Dumpleton wrote:
>>>Someone on the mod_python list wrote:
>>>>But I can find no way to force testmodule to be re-imported. What am
>>I doing wrong?
>>>
>>>You are not doing anything wrong, the current system simply doesn't
>>>work very well.
>>>
>>>The best you can get is to use:
>>>
>>>  from mod_python import apache
>>>  import os
>>>
>>>  __here__ = os.path.dirname(__file__)
>>>  
>>>  def handler(req):
>>>       req.write("Hello World!")
>>>       testmodule = apache.import_module("testmodule,path=[__here__])
>>>       testmodule.foo(req)
>>>       return apache.OK
>>>
>>>This uses apache.import_module() on each request to import the module.
>>>In practice though, if the file has not changed it just uses what is
>>>already in the cache. If it has changed, you should then see the change.
>>>
>>>You can't use apache.import_module() at global scope in the module and
>>>get the same effect as that only gets executed when main.py is imported.
>>>Thus you don't get the check for changes to testmodule.py on every
>>>request.
>>>
>>>I have a completely rewritten module importing system for mod_python
>>>which addresses nearly all the issues it has. I will be making it available
>>>for trialing after mod_python 3.2.6 is officially released. It will require
>>>though having 3.2.6, which means it will be useless to you with 2.7.11.
>>
>>I still see problems with module import using 3.2.6 on linux, compiled
>>today. I am using typically something like:
>>
>>try:
>>    from mod_python import apache
>>
>>    _directory = os.path.dirname(__file__)
>>    for _my_modulename in ['web_settings', 'web_header', 'web_menu', 'web_text_frame',
>>                           'web_footer', 'sql_io', 'helper_functions', 'globals']:
>>        __dict__[_my_modulename] = apache.import_module(_my_modulename,
>>                                                        log=1, path=[_directory])
>>except: # without raise
>>    import web_settings
>>    import web_header
>>    import web_menu
>>    import web_text_frame # calls mysql_python driver
>>    import web_footer
>>    import sql_io
>>    import helper_functions
>>    import globals
>>
>>
>>So, should I wait or adjust my code?
> 
> 
> What sort of problems?

For example, when changing a variable in the top-level of imported globals file,
the change of the value is not reflected by apache until I restart it.


> Note though that the more major problems with apache.import_module()
> aren't fixed in 3.2.6.

I see. Thanks! I know that would duplicate the JIRA bug-tracking system a bit,
but maybe a brief overview of the hottest bugs should be mentione din the README
or better, BUGS file. I think there was already a discussion on this once. ;)


> You should find that mod_python.publisher may work a bit better in 3.2.6
> as it uses a separate module importer. If you use apache.import_module()
> inside of mod_python.publisher code, you could end up with a whole new

I think I do use mod_python publisher. ;)

# main.py with the above try/except wrapped import stuff, those therein imported
#         modules use the same try/except logic
#
def index(req):
   ... # does some stuff
    return _some_string


> bunch of problems if a module is imported by both mod_python.publisher
> and apache.import_module(). Specifically that there will be two distinct
> copies of the module. I pointed out the problems that the changes to the
> mod_python.publisher module importer would cause in this situation, but
> the changes were still made. I would have preferred to have seen the use
> of apache.import_module() by mod_python.publisher be left alone until
> apache.import_module() was fixed. Ie., better known problems than a whole
> class of new ones. :-(

OK, I used to have simple:

import foo
import bar

but some months ago I was advised to use the apache.import_module approach
when running under mod_python and the usual imports keep just for direct python
execution. Should I revert back (and rip away the try/excpet stuff)?
No problem, but maybe time to keep in the README section with recommended
examples for this and that version or apache2, mod_python, etc. :(


>>>Whether this new module importing system gets adopted is another
>>>matter entirely though. Some have argued in the past that the current
>>>arrangement is adequate even though it has known problems. ;-(
>>
>>No, the apache stop/start sucks, the restart approach doesn't work as the
>>init.d scripts on gentoo fail to wait for apache to shutdown completely ...
>>they start to startup somehow immediately, recognize apache is still up,
>>die but leave the lockfiles in. I have to start apache in several
>>start/start attempts to get it started actually.
> 
> 
> Apache child processes not terminating promptly may be because of:
> 
>   http://issues.apache.org/jira/browse/MODPYTHON-109
> 
> this is not addressed in 3.2.6 anf needs a bit more research first to see
> if the simple solution will not cause other issues. At this stage the only
> known issue is that not calling Py_Finalize() will mean that code registered
> using Python wrapper for atexit() will not be called. Have to check properly
> yet though whether code registered with apache.register_cleanup() and
> req.server.register_cleanup() will still be executed.

Well, if I can adjust my code to have the automatic reloading working again,
I don't care much about the apache issue. ;)

Thank you for all your effort.

martin
From jure at dijaski.net  Wed Jan 25 17:19:36 2006
From: jure at dijaski.net (Jure Vrscaj)
Date: Wed Jan 25 17:20:00 2006
Subject: [mod_python] Different scripts with same names and sys.path
	confusion
In-Reply-To: <c298f2d70601201013u7142fb73i@mail.gmail.com>
References: <43D12347.7010400@dijaski.net>
	<c298f2d70601201013u7142fb73i@mail.gmail.com>
Message-ID: <43D7F978.8060501@dijaski.net>

Hi,

I was getting ready to change the whole source to not use publisher... 
but then I set the PythonInterpreter for each of the two copies, as you 
suggested, and now it seems to work. Thanks for the advice.

regards,
jure

P.S.: I'm sending this again, the first time it was directed to Nicolas, 
not mod_python mailinglist, I didn't check where I was replying to.

Nicolas Lehuen wrote:

>Hi Jure,
>
>This is a very well know bug of mod_python.publisher that has been
>fixed in the 3.2 version (whose final release should be made really
>really soon now).
>
>As a work around you can try to define two different PythonInterpreter
>names for each application (for example in a .htaccess file at the
>root of each application). This way your two applications will run
>into different Python interpreters and you should see your problem
>disappear.
>
>Regards,
>Nicolas
>
>2006/1/20, Jure Vrscaj <jure@dijaski.net>:
>  
>
>>Hello,
>>
>>I'm working on a web-based gui for some application in mod_python, using
>>publisher as a request handler. The project was going on ok, until I
>>made a copy of the application, so that one copy could be used for
>>testing/development and the other for real usage. But, as soon as two
>>copies existed on the same server, one being requested after another, I
>>noticed some strange effects:
>>
>>At first, every now and then, I got a "404 Not Found" error when
>>requesting one of the two copies. I traced the error which was raised in
>>apache.py, the reason being that the module's directory I was trying to
>>access wasn't in the path(which is calculated from request url). I
>>commented out the check, and tried again. Now the error was gone, but
>>another issue arised: when requesting for example the development page,
>>which has the title set to "Test", instead of seeing the correct title,
>>I got (seemingly randomly) titles from both the test site and the real one.
>>
>>I figured that wrong modules are being used/imported and made the script
>>output sys.path. The path contained both: root folder of the testing
>>site and next to it root folder of the real site, which was probably the
>>reason why the titles were unstable. I tried setting PythonPath, with no
>>effect.
>>
>>My system specs are:
>>- redhat linux
>>- httpd-2.0.46-54.ent (apache2.0)
>>- python-2.2.3-6.1
>>- mod_python-3.0.3-5.ent
>>- handler: mod_python.publisher
>>
>>I would use Vampire, but couldn't get it to work on python2.2.
>>
>>Any suggestions on how to overcome this problem really appreciated, I
>>don't mind if each module is reloaded for every request, as long as it's
>>the right module. (the application is using classic python import
>>command for module importing)
>>
>>regards,
>>jure
>>_______________________________________________
>>Mod_python mailing list
>>Mod_python@modpython.org
>>http://mailman.modpython.org/mailman/listinfo/mod_python
>>
>>    
>>

From jure at dijaski.net  Wed Jan 25 17:22:44 2006
From: jure at dijaski.net (Jure Vrscaj)
Date: Wed Jan 25 17:23:01 2006
Subject: [mod_python] Different scripts with same names and sys.path
	confusion
In-Reply-To: <FCA4B1B5-6C09-4C1A-B2C2-E447F3FEC41C@dscpl.com.au>
References: <43D12347.7010400@dijaski.net>
	<FCA4B1B5-6C09-4C1A-B2C2-E447F3FEC41C@dscpl.com.au>
Message-ID: <43D7FA34.9000307@dijaski.net>

Graham Dumpleton wrote:

>
> On 21/01/2006, at 4:52 AM, Jure Vrscaj wrote:
>
>> My system specs are:
>> - redhat linux
>> - httpd-2.0.46-54.ent (apache2.0)
>> - python-2.2.3-6.1
>> - mod_python-3.0.3-5.ent
>> - handler: mod_python.publisher
>>
>> I would use Vampire, but couldn't get it to work on python2.2.
>
>
> Nicolas pointed out that mod_python 3.2 will solve the problem you  
> are having with
> mod_python.publisher. Be aware though that mod_python 3.2 requires  
> you to have
> at least Python 2.3 or some things will not work. Vampire similarly  
> has a requirement
> for Python 2.3 (although I didn't think it did), so either way you  
> would have to upgrade.
>
> Thus the only workable solution if you have to use Python 2.2, is the  
> PythonInterpreter
> directive that Nicolas also pointed out.
>
> Graham

Thank you for additional information. I'm stuck with python2.2, so I 
guess this is the one solution.

regards,
jure
From grahamd at dscpl.com.au  Wed Jan 25 19:21:18 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Wed Jan 25 19:21:31 2006
Subject: [mod_python] mod_python executing old versions of my code
In-Reply-To: <43D7F2D5.2010305@ribosome.natur.cuni.cz>
References: <1138146580.20848@dscpl.user.openhosting.com>
	<43D7F2D5.2010305@ribosome.natur.cuni.cz>
Message-ID: <0102BE96-D21A-427B-9114-377BD49938F1@dscpl.com.au>


On 26/01/2006, at 8:51 AM, Martin MOKREJ? wrote:

>> What sort of problems?
>
> For example, when changing a variable in the top-level of imported  
> globals file,
> the change of the value is not reflected by apache until I restart it.
>
>
>> Note though that the more major problems with apache.import_module()
>> aren't fixed in 3.2.6.
>
> I see. Thanks! I know that would duplicate the JIRA bug-tracking  
> system a bit,
> but maybe a brief overview of the hottest bugs should be mentione  
> din the README
> or better, BUGS file. I think there was already a discussion on  
> this once. ;)

I'm in a rush somewhere, so no time to comment on specific issues in  
your
email. As a starter though, suggest you read:

   http://www.dscpl.com.au/articles/modpython-003.html

The "globals" issue you speak of is basically ISSUE 8 in that document.

More later.

Graham
From nlv11281 at natlab.research.philips.com  Thu Jan 26 01:40:50 2006
From: nlv11281 at natlab.research.philips.com (Mike Looijmans)
Date: Thu Jan 26 01:41:15 2006
Subject: [mod_python] mod_python executing old versions of my code
In-Reply-To: <43D7E938.70400@westcoastaerospace.com>
References: <5f56302b0601241715v13c1d3e7n7af3039697649242@mail.gmail.com>	<5f56302b0601241718s4d19023wf792da0eea8e65dc@mail.gmail.com>
	<43D7E938.70400@westcoastaerospace.com>
Message-ID: <43D86EF2.5070005@natlab.research.philips.com>

When faced with the reload problem a few years ago, I created a special 
"reload" request. The request would list all the .py[oc] files in the 
script folder, and tries to unload or reload() each of them.

As a result, the "main" modules as well as dependent modules will have 
been reloaded or removed (At least, the ones that came from my project - 
it would not make sense to unload modules like 'os').

So just sending "http://myhost/pu/reload" to the server would cause the 
next request to get all new scripts.

I even used this on the production server after uploading updates.

--
Mike Looijmans
Philips Natlab / Topic Automation


James Paige wrote:
> Daniel Nogradi wrote:
> 
>>> I'm new to mod_python... so maybe I have missed something fundamental
>>> here, but mod_python seems to be keeping several copies of my old code
>>> in memory, so when I make changes and reload the page, sometimes I get
>>>
>>> my changes, and sometimes I get a seemingly-random version of the code
>>> that I have already changed.
>>>
>>>
>> You can also try setting the MaxRequestsPerChild apache directive to 
>> 1, it
>> worked for me very well. Initially I had the same problem like you, 
>> but with
>>
>> MaxRequestsPerChild 1
>>
>> in the apache config file the problem is gone because every child that 
>> loads
>> your code dies after the request, so it doesn't stay anywhere.
> 
> 
> That sounds like it would be an excellent workaround if I was using a
> dedicated server that ran nothing but mod_python, but for a shared
> server-- especially one on which I might not necessarily have root
> access at all, that will not work.
> 
> ---
> James Paige
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
> 

From grahamd at dscpl.com.au  Thu Jan 26 02:00:01 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Thu Jan 26 02:00:14 2006
Subject: [mod_python] mod_python executing old versions of my code
In-Reply-To: <43D86EF2.5070005@natlab.research.philips.com>
References: <5f56302b0601241715v13c1d3e7n7af3039697649242@mail.gmail.com>	<5f56302b0601241718s4d19023wf792da0eea8e65dc@mail.gmail.com>
	<43D7E938.70400@westcoastaerospace.com>
	<43D86EF2.5070005@natlab.research.philips.com>
Message-ID: <0f7d95fa1fb04c4919699f5bf303da01@dscpl.com.au>

On 26/01/2006, at 5:40 PM, Mike Looijmans wrote:

> When faced with the reload problem a few years ago, I created a 
> special "reload" request. The request would list all the .py[oc] files 
> in the script folder, and tries to unload or reload() each of them.

Will not work for mod_python.publisher in mod_python 3.2 and possibly
not at all in future versions of mod_python, but for mod_python <= 
3.1.4,
it is better to iterate over modules in sys.modules and if they contain
the attribute "__mtime__" set it to 0. By doing this, it will cause the
mod_python importer to reload it automatically the next time it is 
accessed.
By doing it this way, you don't expose yourself to issues that might 
arise
from mixing "apache.import_module()" and "reload()".

> As a result, the "main" modules as well as dependent modules will have 
> been reloaded or removed (At least, the ones that came from my project 
> - it would not make sense to unload modules like 'os').

Other projects should really be run in the context of a different 
interpreter
by specifying PythonInterpreter. On that basis, you would have to be 
selective
if above method used.

> So just sending "http://myhost/pu/reload" to the server would cause 
> the next request to get all new scripts.

This is only guaranteed to work if you are using mod_python on Win32 
platform.
It most definitely will not work with "prefork" on UNIX and usually not 
on
"worker" on UNIX. The reason the latter will not work reliably is that 
there
can be multiple Apache child processes and your request will only hit 
one of
those child processes. You would have to hit reload many times and even 
then
you wouldn't know for sure it had been done in all of the children.

> I even used this on the production server after uploading updates.
>
> --
> Mike Looijmans
> Philips Natlab / Topic Automation
>
>
> James Paige wrote:
>> Daniel Nogradi wrote:
>>>> I'm new to mod_python... so maybe I have missed something 
>>>> fundamental
>>>> here, but mod_python seems to be keeping several copies of my old 
>>>> code
>>>> in memory, so when I make changes and reload the page, sometimes I 
>>>> get
>>>>
>>>> my changes, and sometimes I get a seemingly-random version of the 
>>>> code
>>>> that I have already changed.
>>>>
>>>>
>>> You can also try setting the MaxRequestsPerChild apache directive to 
>>> 1, it
>>> worked for me very well. Initially I had the same problem like you, 
>>> but with
>>>
>>> MaxRequestsPerChild 1
>>>
>>> in the apache config file the problem is gone because every child 
>>> that loads
>>> your code dies after the request, so it doesn't stay anywhere.
>> That sounds like it would be an excellent workaround if I was using a
>> dedicated server that ran nothing but mod_python, but for a shared
>> server-- especially one on which I might not necessarily have root
>> access at all, that will not work.
>> ---
>> James Paige
>> _______________________________________________
>> Mod_python mailing list
>> Mod_python@modpython.org
>> http://mailman.modpython.org/mailman/listinfo/mod_python
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python

From grahamd at dscpl.com.au  Thu Jan 26 02:10:00 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Thu Jan 26 02:10:13 2006
Subject: [mod_python] mod_python executing old versions of my code
In-Reply-To: <0f7d95fa1fb04c4919699f5bf303da01@dscpl.com.au>
References: <5f56302b0601241715v13c1d3e7n7af3039697649242@mail.gmail.com>	<5f56302b0601241718s4d19023wf792da0eea8e65dc@mail.gmail.com>
	<43D7E938.70400@westcoastaerospace.com>
	<43D86EF2.5070005@natlab.research.philips.com>
	<0f7d95fa1fb04c4919699f5bf303da01@dscpl.com.au>
Message-ID: <d3e095e914a906f952d4abb556e8ed72@dscpl.com.au>


On 26/01/2006, at 6:00 PM, Graham Dumpleton wrote:
>> As a result, the "main" modules as well as dependent modules will 
>> have been reloaded or removed (At least, the ones that came from my 
>> project - it would not make sense to unload modules like 'os').
>
> Other projects should really be run in the context of a different 
> interpreter
> by specifying PythonInterpreter. On that basis, you would have to be 
> selective
> if above method used.

Whoops. Should have read:

   On that basis, you would NOT have to be selective if above method 
used.

Graham

From nlv11281 at natlab.research.philips.com  Thu Jan 26 02:50:04 2006
From: nlv11281 at natlab.research.philips.com (Mike Looijmans)
Date: Thu Jan 26 02:50:12 2006
Subject: [mod_python] mod_python executing old versions of my code
In-Reply-To: <0f7d95fa1fb04c4919699f5bf303da01@dscpl.com.au>
References: <5f56302b0601241715v13c1d3e7n7af3039697649242@mail.gmail.com>	<5f56302b0601241718s4d19023wf792da0eea8e65dc@mail.gmail.com>
	<43D7E938.70400@westcoastaerospace.com>
	<43D86EF2.5070005@natlab.research.philips.com>
	<0f7d95fa1fb04c4919699f5bf303da01@dscpl.com.au>
Message-ID: <43D87F2C.7070603@natlab.research.philips.com>

Graham Dumpleton wrote:
> On 26/01/2006, at 5:40 PM, Mike Looijmans wrote:
> 
>> When faced with the reload problem a few years ago, I created a 
>> special "reload" request. The request would list all the .py[oc] files 
>> in the script folder, and tries to unload or reload() each of them.
> 
> Will not work for mod_python.publisher in mod_python 3.2 and possibly
> not at all in future versions of mod_python, but for mod_python <= 3.1.4,
> it is better to iterate over modules in sys.modules and if they contain
> the attribute "__mtime__" set it to 0. By doing this, it will cause the
> mod_python importer to reload it automatically the next time it is 
> accessed.
> By doing it this way, you don't expose yourself to issues that might arise
> from mixing "apache.import_module()" and "reload()".

I was not mixing - I was using "import" exclusively. I also wasn't using 
publisher, but I wrote my own. (this was about 4 years ago)

"My" publisher could detect changes in the handlers, but not in the 
sub-modules they imported. 90% of code changes only affected the UI 
parts which were in the headers.

The fix was there to get changes in the library modules to become 
effective, without having to log in on the apache machine.


>> As a result, the "main" modules as well as dependent modules will have 
>> been reloaded or removed (At least, the ones that came from my project 
>> - it would not make sense to unload modules like 'os').
> 
> Other projects should really be run in the context of a different 
> interpreter
> by specifying PythonInterpreter. On that basis, you would have to be 
> selective
> if above method used.

There were no other projects on that server...

>> So just sending "http://myhost/pu/reload" to the server would cause 
>> the next request to get all new scripts.
> 
> This is only guaranteed to work if you are using mod_python on Win32 
> platform.
> It most definitely will not work with "prefork" on UNIX and usually not on
> "worker" on UNIX. The reason the latter will not work reliably is that 
> there
> can be multiple Apache child processes and your request will only hit 
> one of
> those child processes. You would have to hit reload many times and even 
> then
> you wouldn't know for sure it had been done in all of the children.

True.
I was using Apache 2.0.something and Solaris 2.6 at the time (had to 
compile everything, no binary distributions), but I already forced 
apache to use a single-process multi-threading worker. Benchmarks showed 
no real difference with the prefork mpm. The machine was seriously 
limited by memory, and the childs would take up >12 MB of memory each, 
most of which could be shared. Putting it into threading mode solved the 
memory hogging, and also had advantages in caching stuff in simple 
dictionaries in memory. I also did DB connection pooling, but after 
implementing and doing some benchmarks, there was no real performance 
advantage in doing it on the MySQL database, which is amazingly fast in 
setting up connections.

Getting this to work on a prefork system is indeed quite a challenge...

But at the time, it was a much better option than restarting an Apache 
server process when hundreds of machines are using it...

--
Mike Looijmans
Philips Natlab / Topic Automation

From dan.eloff at gmail.com  Thu Jan 26 13:08:14 2006
From: dan.eloff at gmail.com (Dan Eloff)
Date: Thu Jan 26 13:08:19 2006
Subject: [mod_python] Syntax error in generated psp code
Message-ID: <4817b6fc0601261008x39212e6axbc8e0ad556541e9a@mail.gmail.com>

Could someone please tell me why this:

<% for href, text in vars.main_menu: %>
	<li><a href="<%=href%>"><%=text%></a></li>
<% # End of menu loop			
%>

Is turuend into:
for href, text in vars.main_menu: ;req.write(""" ....

With that extra ; right after the loop? It creates a syntax error.

How might I write my psp so as to avoid that?

Thanks,
-Dan

From grahamd at dscpl.com.au  Thu Jan 26 14:59:34 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Thu Jan 26 14:59:47 2006
Subject: [mod_python] Syntax error in generated psp code
In-Reply-To: <4817b6fc0601261008x39212e6axbc8e0ad556541e9a@mail.gmail.com>
References: <4817b6fc0601261008x39212e6axbc8e0ad556541e9a@mail.gmail.com>
Message-ID: <b62b922173bccb58d43538c1b9085747@dscpl.com.au>


On 27/01/2006, at 5:08 AM, Dan Eloff wrote:

> Could someone please tell me why this:
>
> <% for href, text in vars.main_menu: %>
> 	<li><a href="<%=href%>"><%=text%></a></li>
> <% # End of menu loop			
> %>
>
> Is turuend into:
> for href, text in vars.main_menu: ;req.write(""" ....
>
> With that extra ; right after the loop? It creates a syntax error.
>
> How might I write my psp so as to avoid that?

 From memory, try:

<%
for href, text in vars.main_menu:
     # fake indent
%>
	<li><a href="<%=href%>"><%=text%></a></li>
<%
# end of loop			
%>

If you aren't going to use a tab stop (8 spaces) of indent, you have to
provide additional hinting. Blocks of code is also better off not having
the <% %> on same lines as code.

Graham

From dworley at communityconnect.com  Thu Jan 26 15:13:19 2006
From: dworley at communityconnect.com (David Worley)
Date: Thu Jan 26 15:13:23 2006
Subject: [mod_python] Simple Issue, Baffling
Message-ID: <EE702CA684057843958BF6CE882E910101CF90BB@cci019.hq.communityconnect.com>

Hello, all. I'm new to mod_python and somewhat new to server side
programming.

I've read the documentation, and I can't seem to find out something
relatively simple.

I'm writing a CSS preprocessor. It's meant to grab a request for a .css
file, process another file and return the result to the browser. The
issue I have is that I can't get the handler to return content the
browser actually uses.

To clarify, I'm running Apache 2.0, Python 2.4 on Windows XP.

So with the following httpd.conf entry:

<Directory /some/file/system/directory>
	AddHandler python-program .sss
	PythonHandler switch
	PythonDebug On
</Directory>

And the following Python code, in switch.py:

from mod_python import apache

def handler(req):
	req.content_type = "text/css"
	req.write("""\
body { background-color: red; }""")
	return apache.OK

This works. It works great. When I request
http://localhost/some/file/system/directory/style.css, I get the body
declaration above. BUT the browser doesn't use it!

I have the same problem when declaring req.content_type = "text/html":
the code is returned properly, but it isn't rendered as HTML. It's just
text, as far as the browser is concerned.

Please let me know if I've totally missed something simple in the
documentation, or misunderstood the handlers, or whatever it is I've
done wrong.

Thanks!

===============================
David Worley
Senior Front End Developer
dworley@communityconnect.com
=============================== 

From dan.eloff at gmail.com  Thu Jan 26 15:31:22 2006
From: dan.eloff at gmail.com (Dan Eloff)
Date: Thu Jan 26 15:31:25 2006
Subject: [mod_python] Syntax error in generated psp code
In-Reply-To: <b62b922173bccb58d43538c1b9085747@dscpl.com.au>
References: <4817b6fc0601261008x39212e6axbc8e0ad556541e9a@mail.gmail.com>
	<b62b922173bccb58d43538c1b9085747@dscpl.com.au>
Message-ID: <4817b6fc0601261231o6e5adfa8v5c999d519fcc3865@mail.gmail.com>

That makes sense. I still am having a syntax error, but a different one now,
it's complaining about the for loop.

15.             """,0);             <% 16.             for href, text in
vars.main_menu:             for href, text in vars.main_menu: 17.
                # Begin menu loop                 # Begin menu loop 18.
                        req.write("""             %> 19.
            <li><a href=\"""",0); req.write(str(href),0); req.write
("""\">""",0); req.write(str(text),0); req.write("""</a></li>
            <li><a href="<%=href%>"><%=text%></a></li> 20.
            """,0);             <% 21.             # End of menu loop
            # End of menu loop 22.                         req.write("""
            %>
What am I doing wrong this time?

Thanks,
-Dan

On 1/26/06, Graham Dumpleton <grahamd@dscpl.com.au> wrote:
>
> On 27/01/2006, at 5:08 AM, Dan Eloff wrote:
>
> > Could someone please tell me why this:
> >
> > <% for href, text in vars.main_menu: %>
> >       <li><a href="<%=href%>"><%=text%></a></li>
> > <% # End of menu loop
> > %>
> >
> > Is turuend into:
> > for href, text in vars.main_menu: ;req.write(""" ....
> >
> > With that extra ; right after the loop? It creates a syntax error.
> >
> > How might I write my psp so as to avoid that?
>
>  From memory, try:
>
> <%
> for href, text in vars.main_menu:
>      # fake indent
> %>
>         <li><a href="<%=href%>"><%=text%></a></li>
> <%
> # end of loop
> %>
>
> If you aren't going to use a tab stop (8 spaces) of indent, you have to
> provide additional hinting. Blocks of code is also better off not having
> the <% %> on same lines as code.
>
> Graham
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20060126/0a5d7ec3/attachment.html
From dan.eloff at gmail.com  Thu Jan 26 15:48:24 2006
From: dan.eloff at gmail.com (Dan Eloff)
Date: Thu Jan 26 15:48:29 2006
Subject: [mod_python] Syntax error in generated psp code
In-Reply-To: <4817b6fc0601261231o6e5adfa8v5c999d519fcc3865@mail.gmail.com>
References: <4817b6fc0601261008x39212e6axbc8e0ad556541e9a@mail.gmail.com>
	<b62b922173bccb58d43538c1b9085747@dscpl.com.au>
	<4817b6fc0601261231o6e5adfa8v5c999d519fcc3865@mail.gmail.com>
Message-ID: <4817b6fc0601261248x48fe5d75m7bcadc2ef8c882ad@mail.gmail.com>

I figured it out. If I unindent the psp tags all the way to the left margin
it works. It looks a little ugly in the source, but if it works, hey, I
won't knock it.

-Dan

On 1/26/06, Dan Eloff <dan.eloff@gmail.com> wrote:
>
> That makes sense. I still am having a syntax error, but a different one
> now, it's complaining about the for loop.
>
> 15.             """,0);              <% 16.             for href, text in
> vars.main_menu:             for href, text in vars.main_menu: 17.
>                 # Begin menu loop                 # Begin menu loop 18.
>                         req.write("""             %> 19.
>             <li><a href=\"""",0); req.write(str(href),0); req.write
> ("""\">""",0); req.write(str(text),0);  req.write("""</a></li>
>             <li><a href="<%=href%>"><%=text%></a></li> 20.
>             """,0);             <% 21.             # End of menu loop
>             # End of menu loop 22.                         req.write("""
>             %>
> What am I doing wrong this time?
>
> Thanks,
> -Dan
>
> On 1/26/06, Graham Dumpleton <grahamd@dscpl.com.au> wrote:
> >
> > On 27/01/2006, at 5:08 AM, Dan Eloff wrote:
> >
> > > Could someone please tell me why this:
> > >
> > > <% for href, text in vars.main_menu: %>
> > >       <li><a href="<%=href%>"><%=text%></a></li>
> > > <% # End of menu loop
> > > %>
> > >
> > > Is turuend into:
> > > for href, text in vars.main_menu: ;req.write(""" ....
> > >
> > > With that extra ; right after the loop? It creates a syntax error.
> > >
> > > How might I write my psp so as to avoid that?
> >
> >  From memory, try:
> >
> > <%
> > for href, text in vars.main_menu:
> >      # fake indent
> > %>
> >         <li><a href="<%=href%>"><%=text%></a></li>
> > <%
> > # end of loop
> > %>
> >
> > If you aren't going to use a tab stop (8 spaces) of indent, you have to
> > provide additional hinting. Blocks of code is also better off not having
> > the <% %> on same lines as code.
> >
> > Graham
> >
> >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20060126/e148360c/attachment.html
From jpg at jgassociates.ca  Thu Jan 26 16:14:58 2006
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Thu Jan 26 16:12:23 2006
Subject: [mod_python] Simple Issue, Baffling
In-Reply-To: <EE702CA684057843958BF6CE882E910101CF90BB@cci019.hq.communityconnect.com>
References: <EE702CA684057843958BF6CE882E910101CF90BB@cci019.hq.communityconnect.com>
Message-ID: <43D93BD2.4020205@jgassociates.ca>

David Worley wrote:
> Hello, all. I'm new to mod_python and somewhat new to server side
> programming.
> 
> I've read the documentation, and I can't seem to find out something
> relatively simple.
> 
> I'm writing a CSS preprocessor. It's meant to grab a request for a .css
> file, process another file and return the result to the browser. The
> issue I have is that I can't get the handler to return content the
> browser actually uses.
> 
> To clarify, I'm running Apache 2.0, Python 2.4 on Windows XP.
> 
> So with the following httpd.conf entry:
> 
> <Directory /some/file/system/directory>
> 	AddHandler python-program .sss
> 	PythonHandler switch
> 	PythonDebug On
> </Directory>
> 
> And the following Python code, in switch.py:
> 
> from mod_python import apache
> 
> def handler(req):
> 	req.content_type = "text/css"
> 	req.write("""\
> body { background-color: red; }""")
> 	return apache.OK
> 
> This works. It works great. When I request
> http://localhost/some/file/system/directory/style.css, I get the body
> declaration above. BUT the browser doesn't use it!

Maybe I don't understand the question but why would it? The browser only 
uses the stylesheet to render the page when it's specified in an html 
<style> tag.

> I have the same problem when declaring req.content_type = "text/html":
> the code is returned properly, but it isn't rendered as HTML. It's just
> text, as far as the browser is concerned.

You got me there, unless you are saying you are getting the python code 
as opposed to the html you send with req.write. Are you writing valid 
html? Any chance there is a typo in req.content_type = 'text/html'? Are 
you using a different handler for generating the html?

It would help if you can clarify your problem a little.

Jim



From dworley at communityconnect.com  Thu Jan 26 16:19:18 2006
From: dworley at communityconnect.com (David Worley)
Date: Thu Jan 26 16:19:21 2006
Subject: [mod_python] Simple Issue, Baffling
Message-ID: <EE702CA684057843958BF6CE882E910101CF90E9@cci019.hq.communityconnect.com>

To clarify further:

http://localhost/some/file/system/directory/style.css is only ever
called from an HTML file, via a <link> tag. The HTML is valid. The HTML
page is NOT generated by mod_python. It's just a plain HTML file in the
folder. I created it just for testing dynamically created CSS files.

The separate issue of "text/html" content is, indeed, handled by another
handler. The two are unrelated. When text/css content wouldn't work, I
tried something simpler: plain HTML return content.

Simply put, req.write(xxx) returns content that my browser does not make
use of, whether CSS or HTML, despite the explicit declaration of
req.content_type. The browser just thinks it's text.

It may be more accurate to say that the server never returns HTML or
CSS, rather than saying that the browser never renders the file
returned.

===============================
David Worley
Senior Front End Developer
dworley@communityconnect.com
=============================== 

-----Original Message-----
From: Jim Gallacher [mailto:jpg@jgassociates.ca] 
Sent: Thursday, January 26, 2006 4:15 PM
To: David Worley
Cc: mod_python@modpython.org
Subject: Re: [mod_python] Simple Issue, Baffling

David Worley wrote:
> Hello, all. I'm new to mod_python and somewhat new to server side
> programming.
> 
> I've read the documentation, and I can't seem to find out something
> relatively simple.
> 
> I'm writing a CSS preprocessor. It's meant to grab a request for a
.css
> file, process another file and return the result to the browser. The
> issue I have is that I can't get the handler to return content the
> browser actually uses.
> 
> To clarify, I'm running Apache 2.0, Python 2.4 on Windows XP.
> 
> So with the following httpd.conf entry:
> 
> <Directory /some/file/system/directory>
> 	AddHandler python-program .sss
> 	PythonHandler switch
> 	PythonDebug On
> </Directory>
> 
> And the following Python code, in switch.py:
> 
> from mod_python import apache
> 
> def handler(req):
> 	req.content_type = "text/css"
> 	req.write("""\
> body { background-color: red; }""")
> 	return apache.OK
> 
> This works. It works great. When I request
> http://localhost/some/file/system/directory/style.css, I get the body
> declaration above. BUT the browser doesn't use it!

Maybe I don't understand the question but why would it? The browser only

uses the stylesheet to render the page when it's specified in an html 
<style> tag.

> I have the same problem when declaring req.content_type = "text/html":
> the code is returned properly, but it isn't rendered as HTML. It's
just
> text, as far as the browser is concerned.

You got me there, unless you are saying you are getting the python code 
as opposed to the html you send with req.write. Are you writing valid 
html? Any chance there is a typo in req.content_type = 'text/html'? Are 
you using a different handler for generating the html?

It would help if you can clarify your problem a little.

Jim




From waitman at waitman.net  Thu Jan 26 16:23:14 2006
From: waitman at waitman.net (Waitman Gobble)
Date: Thu Jan 26 16:23:24 2006
Subject: [mod_python] Simple Issue, Baffling
In-Reply-To: <43D93BD2.4020205@jgassociates.ca>
References: <EE702CA684057843958BF6CE882E910101CF90BB@cci019.hq.communityconnect.com>
	<43D93BD2.4020205@jgassociates.ca>
Message-ID: <43D93DC2.50309@waitman.net>

Sorry to jump in the middle of the conversation, but is

AddHandler python-program .sss

supposed to be

AddHandler python-program .css

???

Take care,

Waitman





Jim Gallacher wrote:
> David Worley wrote:
>> I'm writing a CSS preprocessor. It's meant to grab a request for a .css
>>
>> So with the following httpd.conf entry:
>>
>> <Directory /some/file/system/directory>
>>     AddHandler python-program .sss
>>     PythonHandler switch
>>     PythonDebug On
>> </Directory>

From dworley at communityconnect.com  Thu Jan 26 16:27:10 2006
From: dworley at communityconnect.com (David Worley)
Date: Thu Jan 26 16:27:12 2006
Subject: [mod_python] Simple Issue, Baffling
Message-ID: <EE702CA684057843958BF6CE882E910101CF90ED@cci019.hq.communityconnect.com>

Yeah, typo. Thanks for pointing that out.

The preprocessor is going to get a request for a .css file, find a .sss
file, process it, and return it as CSS.

It's correct in the actual program.

Believe me, I've combed over everything small like that. I wouldn't have
written without doing so. It seems like I've missed something in my
understanding of the req object, or the content_type property, or in the
way that AddHandler works.

Any ideas?

===============================
David Worley
Senior Front End Developer
dworley@communityconnect.com
=============================== 

-----Original Message-----
From: Waitman Gobble [mailto:waitman@waitman.net] 
Sent: Thursday, January 26, 2006 4:23 PM
To: Jim Gallacher
Cc: David Worley; mod_python@modpython.org
Subject: Re: [mod_python] Simple Issue, Baffling

Sorry to jump in the middle of the conversation, but is

AddHandler python-program .sss

supposed to be

AddHandler python-program .css

???

Take care,

Waitman





Jim Gallacher wrote:
> David Worley wrote:
>> I'm writing a CSS preprocessor. It's meant to grab a request for a
.css
>>
>> So with the following httpd.conf entry:
>>
>> <Directory /some/file/system/directory>
>>     AddHandler python-program .sss
>>     PythonHandler switch
>>     PythonDebug On
>> </Directory>


From waitman at waitman.net  Thu Jan 26 16:34:28 2006
From: waitman at waitman.net (Waitman Gobble)
Date: Thu Jan 26 16:34:31 2006
Subject: [mod_python] Simple Issue, Baffling
In-Reply-To: <EE702CA684057843958BF6CE882E910101CF90ED@cci019.hq.communityconnect.com>
References: <EE702CA684057843958BF6CE882E910101CF90ED@cci019.hq.communityconnect.com>
Message-ID: <43D94064.2020705@waitman.net>


Did you try making a "head" or "get" request and watch the headers. I
agree it seems that the thing is returning content-type text/plain.

Since you are on a winders machine, you might not have an easy way to do
a HEAD request. But maybe you do.

JUST IN CASE, you can use telnet like this:

I normally use the HEAD command on a *nix machine. If you don't have
access to such a thing, you can do it from the command prompt on your
windows machine.

Start -> Run
type in "cmd" and press "OK"
a black console window (*should*) appear.

you should see something like this:

Microsoft Windows XP [Version 5.1.2600]
(C) Copyright 1985-2001 Microsoft Corp.

C:\Documents and Settings\YOU-USER>

at the prompt, type in the following:

telnet example.com 80

The screen may go blank, with a cursor at the top. you may have to type
in the dark, without getting an echo. I think on older versions it
didn't use to do this, but my memory may be froggy.

type in the following:

HEAD http://example.com/doesnotexist HTTP/1.0

and press <Enter> twice.

The response should appear.

HTTP/1.1 200 OK
Connection: close
Date: Fri, 20 Jan 2006 18:30:48 GMT
Server: Microsoft-IIS/6.0
X-Powered-By: ASP.NET
X-AspNet-Version: 1.1.4322
Cache-Control: private
Content-Type: text/html; charset=utf-8



Connection to host lost.




or i did a little checker for another group last week.

here is a little HEAD and GET checker. 5 minute version,
source below.

That way you don't have to do the goofy telnet stuff. :-)


(in bcb 6.0 with indy)

http://www.nodemap.com/more/gethead.exe

# md5sum gethead.exe
dc05e2e3c9f73f801f5da92dd9a47885  gethead.exe


//---------------------------------------------------------------------------

#include <vcl.h>
#pragma hdrstop

#include "Unit1.h"
//---------------------------------------------------------------------------
#pragma package(smart_init)
#pragma resource "*.dfm"
TForm1 *Form1;
//---------------------------------------------------------------------------
__fastcall TForm1::TForm1(TComponent* Owner)
        : TForm(Owner)
{
Memo1->Lines->Clear();

}
//---------------------------------------------------------------------------

void __fastcall TForm1::Button1Click(TObject *Sender)
{

        Memo1->Lines->Add("");
        if (CheckBox1->Checked) {
                Memo1->Lines->Add("Attention: Following Redirects");
                IdHTTP1->HandleRedirects=true;
        } else {
                Memo1->Lines->Add("Attention: Not Following
Redirects");
                IdHTTP1->HandleRedirects=false;
        }

        Memo1->Lines->Add("HEAD "+Edit1->Text+" on port "+Edit2->Text);
        IdHTTP1->Port=Edit2->Text.ToInt();
        try {
                IdHTTP1->Head(Edit1->Text);
        }
        catch (...)
        {
                //
        }
        Memo1->Lines->Add(IdHTTP1->Response->ResponseText);
        Memo1->Lines->Add(IdHTTP1->Response->RawHeaders->Text);

}
//---------------------------------------------------------------------------

void __fastcall TForm1::Button2Click(TObject *Sender)
{
        Memo1->Lines->Add("");
        if (CheckBox1->Checked) {
                Memo1->Lines->Add("Attention: Following Redirects");
                IdHTTP1->HandleRedirects=true;
        } else {
                Memo1->Lines->Add("Attention: Not Following
Redirects");
                IdHTTP1->HandleRedirects=false;
        }

        Memo1->Lines->Add("GET "+Edit1->Text+" on port "+Edit2->Text);
        IdHTTP1->Port=Edit2->Text.ToInt();
        try {
                IdHTTP1->Get(Edit1->Text);
        }
        catch (...)
        {
                //
        }
        Memo1->Lines->Add(IdHTTP1->Response->ResponseText);
        Memo1->Lines->Add(IdHTTP1->Response->RawHeaders->Text);

}
//---------------------------------------------------------------------------
void __fastcall TForm1::Button3Click(TObject *Sender)
{
Memo1->Lines->Clear();
}
//---------------------------------------------------------------------------


Header file

//---------------------------------------------------------------------------

#ifndef Unit1H
#define Unit1H
//---------------------------------------------------------------------------
#include <Classes.hpp>
#include <Controls.hpp>
#include <StdCtrls.hpp>
#include <Forms.hpp>
#include <IdBaseComponent.hpp>
#include <IdComponent.hpp>
#include <IdHTTP.hpp>
#include <IdTCPClient.hpp>
#include <IdTCPConnection.hpp>
//---------------------------------------------------------------------------
class TForm1 : public TForm
{
__published:	// IDE-managed Components
        TMemo *Memo1;
        TEdit *Edit1;
        TButton *Button1;
        TButton *Button2;
        TIdHTTP *IdHTTP1;
        TEdit *Edit2;
        TLabel *Label1;
        TLabel *Label2;
        TCheckBox *CheckBox1;
        TButton *Button3;
        TLabel *Label3;
        TLabel *Label4;
        void __fastcall Button1Click(TObject *Sender);
        void __fastcall Button2Click(TObject *Sender);
        void __fastcall Button3Click(TObject *Sender);
private:	// User declarations
public:		// User declarations
        __fastcall TForm1(TComponent* Owner);
};
//---------------------------------------------------------------------------
extern PACKAGE TForm1 *Form1;
//---------------------------------------------------------------------------
#endif


Waitman


David Worley wrote:
> Yeah, typo. Thanks for pointing that out.

From estrand at isomedia.com  Thu Jan 26 16:41:34 2006
From: estrand at isomedia.com (Eric Strand)
Date: Thu Jan 26 16:41:43 2006
Subject: [mod_python] Simple Issue, Baffling
In-Reply-To: <EE702CA684057843958BF6CE882E910101CF90ED@cci019.hq.communityconnect.com>
References: <EE702CA684057843958BF6CE882E910101CF90ED@cci019.hq.communityconnect.com>
Message-ID: <43D9420E.7020907@isomedia.com>


Might it have to do with browser caching?  In the past I've encounter 
similar frustration, and realized the browser was being too helpful.



David Worley wrote:
> Yeah, typo. Thanks for pointing that out.
> 
> The preprocessor is going to get a request for a .css file, find a .sss
> file, process it, and return it as CSS.
> 
> It's correct in the actual program.
> 
> Believe me, I've combed over everything small like that. I wouldn't have
> written without doing so. It seems like I've missed something in my
> understanding of the req object, or the content_type property, or in the
> way that AddHandler works.
> 
> Any ideas?
> 
> ===============================
> David Worley
> Senior Front End Developer
> dworley@communityconnect.com
> =============================== 
> 
> -----Original Message-----
> From: Waitman Gobble [mailto:waitman@waitman.net] 
> Sent: Thursday, January 26, 2006 4:23 PM
> To: Jim Gallacher
> Cc: David Worley; mod_python@modpython.org
> Subject: Re: [mod_python] Simple Issue, Baffling
> 
> Sorry to jump in the middle of the conversation, but is
> 
> AddHandler python-program .sss
> 
> supposed to be
> 
> AddHandler python-program .css
> 
> ???
> 
> Take care,
> 
> Waitman
> 
> 
> 
> 
> 
> Jim Gallacher wrote:
> 
>>David Worley wrote:
>>
>>>I'm writing a CSS preprocessor. It's meant to grab a request for a
> 
> .css
> 
>>>So with the following httpd.conf entry:
>>>
>>><Directory /some/file/system/directory>
>>>    AddHandler python-program .sss
>>>    PythonHandler switch
>>>    PythonDebug On
>>></Directory>
> 
> 
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
> 
From dworley at communityconnect.com  Thu Jan 26 16:45:48 2006
From: dworley at communityconnect.com (David Worley)
Date: Thu Jan 26 16:45:51 2006
Subject: [mod_python] Simple Issue, Baffling
Message-ID: <EE702CA684057843958BF6CE882E910101CF90F7@cci019.hq.communityconnect.com>

I have Firefox set to have no cache. Despite that, I still Shift+Refresh
when I'm testing a new app.

It's not that it's holding on to an old request, it's more that the
server never returned content the browser recognized as CSS, or HTML.

Thanks for the suggestion, though!

===============================
David Worley
Senior Front End Developer
dworley@communityconnect.com
=============================== 

-----Original Message-----
From: mod_python-bounces@modpython.org
[mailto:mod_python-bounces@modpython.org] On Behalf Of Eric Strand
Sent: Thursday, January 26, 2006 4:42 PM
To: mod_python@modpython.org
Subject: Re: [mod_python] Simple Issue, Baffling


Might it have to do with browser caching?  In the past I've encounter 
similar frustration, and realized the browser was being too helpful.



David Worley wrote:
> Yeah, typo. Thanks for pointing that out.
> 
> The preprocessor is going to get a request for a .css file, find a
.sss
> file, process it, and return it as CSS.
> 
> It's correct in the actual program.
> 
> Believe me, I've combed over everything small like that. I wouldn't
have
> written without doing so. It seems like I've missed something in my
> understanding of the req object, or the content_type property, or in
the
> way that AddHandler works.
> 
> Any ideas?
> 
> ===============================
> David Worley
> Senior Front End Developer
> dworley@communityconnect.com
> =============================== 
> 
> -----Original Message-----
> From: Waitman Gobble [mailto:waitman@waitman.net] 
> Sent: Thursday, January 26, 2006 4:23 PM
> To: Jim Gallacher
> Cc: David Worley; mod_python@modpython.org
> Subject: Re: [mod_python] Simple Issue, Baffling
> 
> Sorry to jump in the middle of the conversation, but is
> 
> AddHandler python-program .sss
> 
> supposed to be
> 
> AddHandler python-program .css
> 
> ???
> 
> Take care,
> 
> Waitman
> 
> 
> 
> 
> 
> Jim Gallacher wrote:
> 
>>David Worley wrote:
>>
>>>I'm writing a CSS preprocessor. It's meant to grab a request for a
> 
> .css
> 
>>>So with the following httpd.conf entry:
>>>
>>><Directory /some/file/system/directory>
>>>    AddHandler python-program .sss
>>>    PythonHandler switch
>>>    PythonDebug On
>>></Directory>
> 
> 
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
> 
_______________________________________________
Mod_python mailing list
Mod_python@modpython.org
http://mailman.modpython.org/mailman/listinfo/mod_python

From jpg at jgassociates.ca  Thu Jan 26 16:51:02 2006
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Thu Jan 26 16:48:11 2006
Subject: [mod_python] Simple Issue, Baffling
In-Reply-To: <EE702CA684057843958BF6CE882E910101CF90E9@cci019.hq.communityconnect.com>
References: <EE702CA684057843958BF6CE882E910101CF90E9@cci019.hq.communityconnect.com>
Message-ID: <43D94446.20100@jgassociates.ca>

David Worley wrote:
> To clarify further:
> 
> http://localhost/some/file/system/directory/style.css is only ever
> called from an HTML file, via a <link> tag. 

I figured you knew that, but one never knows. ;)

> The HTML is valid. The HTML
> page is NOT generated by mod_python. It's just a plain HTML file in the
> folder. I created it just for testing dynamically created CSS files.
> 
> The separate issue of "text/html" content is, indeed, handled by another
> handler. The two are unrelated. When text/css content wouldn't work, I
> tried something simpler: plain HTML return content.
> 
> Simply put, req.write(xxx) returns content that my browser does not make
> use of, whether CSS or HTML, despite the explicit declaration of
> req.content_type. The browser just thinks it's text.
> 
> It may be more accurate to say that the server never returns HTML or
> CSS, rather than saying that the browser never renders the file
> returned.


Is your handler as simple as you indicated or is there other stuff going 
on? Any chance you are calling req.write *before* setting 
req.content_type? The first call to req.write triggers the sending of 
the response headers, which contains the Content-Type header. Once 
you've starting calling req.write changing req.content_type will have no 
effect. (Hmm, I wonder if we should actually raise an exception... )

I find that tools like wget or netcat are helpful for this sort of thing 
since you can dump the response headers as well as the page content. If 
you don't have ready access to these programs I'm sure you could know 
somthing together from the standard python lib. Sometimes the simplest 
problems have the simplest solutions.

Jim

> ===============================
> David Worley
> Senior Front End Developer
> dworley@communityconnect.com
> =============================== 
> 
> -----Original Message-----
> From: Jim Gallacher [mailto:jpg@jgassociates.ca] 
> Sent: Thursday, January 26, 2006 4:15 PM
> To: David Worley
> Cc: mod_python@modpython.org
> Subject: Re: [mod_python] Simple Issue, Baffling
> 
> David Worley wrote:
> 
>>Hello, all. I'm new to mod_python and somewhat new to server side
>>programming.
>>
>>I've read the documentation, and I can't seem to find out something
>>relatively simple.
>>
>>I'm writing a CSS preprocessor. It's meant to grab a request for a
> 
> .css
> 
>>file, process another file and return the result to the browser. The
>>issue I have is that I can't get the handler to return content the
>>browser actually uses.
>>
>>To clarify, I'm running Apache 2.0, Python 2.4 on Windows XP.
>>
>>So with the following httpd.conf entry:
>>
>><Directory /some/file/system/directory>
>>	AddHandler python-program .sss
>>	PythonHandler switch
>>	PythonDebug On
>></Directory>
>>
>>And the following Python code, in switch.py:
>>
>>from mod_python import apache
>>
>>def handler(req):
>>	req.content_type = "text/css"
>>	req.write("""\
>>body { background-color: red; }""")
>>	return apache.OK
>>
>>This works. It works great. When I request
>>http://localhost/some/file/system/directory/style.css, I get the body
>>declaration above. BUT the browser doesn't use it!
> 
> 
> Maybe I don't understand the question but why would it? The browser only
> 
> uses the stylesheet to render the page when it's specified in an html 
> <style> tag.
> 
> 
>>I have the same problem when declaring req.content_type = "text/html":
>>the code is returned properly, but it isn't rendered as HTML. It's
> 
> just
> 
>>text, as far as the browser is concerned.
> 
> 
> You got me there, unless you are saying you are getting the python code 
> as opposed to the html you send with req.write. Are you writing valid 
> html? Any chance there is a typo in req.content_type = 'text/html'? Are 
> you using a different handler for generating the html?
> 
> It would help if you can clarify your problem a little.
> 
> Jim
> 
> 
> 
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
> 

From jim at qlf.com  Thu Jan 26 16:55:59 2006
From: jim at qlf.com (Jim Steil)
Date: Thu Jan 26 16:56:27 2006
Subject: [mod_python] Simple Issue, Baffling
In-Reply-To: <43D94446.20100@jgassociates.ca>
References: <EE702CA684057843958BF6CE882E910101CF90E9@cci019.hq.communityconnect.com>
	<43D94446.20100@jgassociates.ca>
Message-ID: <43D9456F.8050107@qlf.com>

I have what I think is a similar problem.  My app works just fine with 
IE, but when I try to get at it with FireFox, I see my HTML source 
instead of my app.  I'm really new to all this, so it may not be 
related.  But, I'm watching for a resolution as I'm hoping it will clue 
me in to what I'm doing wrong as well.  It happens to me with Firefox 1.5.

    -Jim

Jim Gallacher wrote:
> David Worley wrote:
>> To clarify further:
>>
>> http://localhost/some/file/system/directory/style.css is only ever
>> called from an HTML file, via a <link> tag. 
>
> I figured you knew that, but one never knows. ;)
>
>> The HTML is valid. The HTML
>> page is NOT generated by mod_python. It's just a plain HTML file in the
>> folder. I created it just for testing dynamically created CSS files.
>>
>> The separate issue of "text/html" content is, indeed, handled by another
>> handler. The two are unrelated. When text/css content wouldn't work, I
>> tried something simpler: plain HTML return content.
>>
>> Simply put, req.write(xxx) returns content that my browser does not make
>> use of, whether CSS or HTML, despite the explicit declaration of
>> req.content_type. The browser just thinks it's text.
>>
>> It may be more accurate to say that the server never returns HTML or
>> CSS, rather than saying that the browser never renders the file
>> returned.
>
>
> Is your handler as simple as you indicated or is there other stuff 
> going on? Any chance you are calling req.write *before* setting 
> req.content_type? The first call to req.write triggers the sending of 
> the response headers, which contains the Content-Type header. Once 
> you've starting calling req.write changing req.content_type will have 
> no effect. (Hmm, I wonder if we should actually raise an exception... )
>
> I find that tools like wget or netcat are helpful for this sort of 
> thing since you can dump the response headers as well as the page 
> content. If you don't have ready access to these programs I'm sure you 
> could know somthing together from the standard python lib. Sometimes 
> the simplest problems have the simplest solutions.
>
> Jim
>
>> ===============================
>> David Worley
>> Senior Front End Developer
>> dworley@communityconnect.com
>> ===============================
>> -----Original Message-----
>> From: Jim Gallacher [mailto:jpg@jgassociates.ca] Sent: Thursday, 
>> January 26, 2006 4:15 PM
>> To: David Worley
>> Cc: mod_python@modpython.org
>> Subject: Re: [mod_python] Simple Issue, Baffling
>>
>> David Worley wrote:
>>
>>> Hello, all. I'm new to mod_python and somewhat new to server side
>>> programming.
>>>
>>> I've read the documentation, and I can't seem to find out something
>>> relatively simple.
>>>
>>> I'm writing a CSS preprocessor. It's meant to grab a request for a
>>
>> .css
>>
>>> file, process another file and return the result to the browser. The
>>> issue I have is that I can't get the handler to return content the
>>> browser actually uses.
>>>
>>> To clarify, I'm running Apache 2.0, Python 2.4 on Windows XP.
>>>
>>> So with the following httpd.conf entry:
>>>
>>> <Directory /some/file/system/directory>
>>>     AddHandler python-program .sss
>>>     PythonHandler switch
>>>     PythonDebug On
>>> </Directory>
>>>
>>> And the following Python code, in switch.py:
>>>
>>> from mod_python import apache
>>>
>>> def handler(req):
>>>     req.content_type = "text/css"
>>>     req.write("""\
>>> body { background-color: red; }""")
>>>     return apache.OK
>>>
>>> This works. It works great. When I request
>>> http://localhost/some/file/system/directory/style.css, I get the body
>>> declaration above. BUT the browser doesn't use it!
>>
>>
>> Maybe I don't understand the question but why would it? The browser only
>>
>> uses the stylesheet to render the page when it's specified in an html 
>> <style> tag.
>>
>>
>>> I have the same problem when declaring req.content_type = "text/html":
>>> the code is returned properly, but it isn't rendered as HTML. It's
>>
>> just
>>
>>> text, as far as the browser is concerned.
>>
>>
>> You got me there, unless you are saying you are getting the python 
>> code as opposed to the html you send with req.write. Are you writing 
>> valid html? Any chance there is a typo in req.content_type = 
>> 'text/html'? Are you using a different handler for generating the html?
>>
>> It would help if you can clarify your problem a little.
>>
>> Jim
>>
>>
>>
>>
>> _______________________________________________
>> Mod_python mailing list
>> Mod_python@modpython.org
>> http://mailman.modpython.org/mailman/listinfo/mod_python
>>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python

-- 
Jim Steil
IT Manager
Quality Liquid Feeds
(608) 935-2345
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20060126/77d8cfc8/attachment.html
From dworley at communityconnect.com  Thu Jan 26 16:57:41 2006
From: dworley at communityconnect.com (David Worley)
Date: Thu Jan 26 16:57:43 2006
Subject: [mod_python] Simple Issue, Baffling
Message-ID: <EE702CA684057843958BF6CE882E910101CF90FC@cci019.hq.communityconnect.com>

When I run telnet, the content type is reported as text/html.

I telnetted to http://localhost/test/simple.css

Yet I've set the content_type as I said, "text/css".

Note that simple.css DOES NOT EXIST. I'm trusting to python for the file
to be dynamically created and returned to the server.

===============================
David Worley
Senior Front End Developer
dworley@communityconnect.com
=============================== 

-----Original Message-----
From: Waitman Gobble [mailto:waitman@waitman.net] 
Sent: Thursday, January 26, 2006 4:34 PM
To: David Worley
Cc: Jim Gallacher; mod_python@modpython.org
Subject: Re: [mod_python] Simple Issue, Baffling


Did you try making a "head" or "get" request and watch the headers. I
agree it seems that the thing is returning content-type text/plain.

Since you are on a winders machine, you might not have an easy way to do
a HEAD request. But maybe you do.

JUST IN CASE, you can use telnet like this:

I normally use the HEAD command on a *nix machine. If you don't have
access to such a thing, you can do it from the command prompt on your
windows machine.

Start -> Run
type in "cmd" and press "OK"
a black console window (*should*) appear.

you should see something like this:

Microsoft Windows XP [Version 5.1.2600]
(C) Copyright 1985-2001 Microsoft Corp.

C:\Documents and Settings\YOU-USER>

at the prompt, type in the following:

telnet example.com 80

The screen may go blank, with a cursor at the top. you may have to type
in the dark, without getting an echo. I think on older versions it
didn't use to do this, but my memory may be froggy.

type in the following:

HEAD http://example.com/doesnotexist HTTP/1.0

and press <Enter> twice.

The response should appear.

HTTP/1.1 200 OK
Connection: close
Date: Fri, 20 Jan 2006 18:30:48 GMT
Server: Microsoft-IIS/6.0
X-Powered-By: ASP.NET
X-AspNet-Version: 1.1.4322
Cache-Control: private
Content-Type: text/html; charset=utf-8



Connection to host lost.




or i did a little checker for another group last week.

here is a little HEAD and GET checker. 5 minute version,
source below.

That way you don't have to do the goofy telnet stuff. :-)


(in bcb 6.0 with indy)

http://www.nodemap.com/more/gethead.exe

# md5sum gethead.exe
dc05e2e3c9f73f801f5da92dd9a47885  gethead.exe


//----------------------------------------------------------------------
-----

#include <vcl.h>
#pragma hdrstop

#include "Unit1.h"
//----------------------------------------------------------------------
-----
#pragma package(smart_init)
#pragma resource "*.dfm"
TForm1 *Form1;
//----------------------------------------------------------------------
-----
__fastcall TForm1::TForm1(TComponent* Owner)
        : TForm(Owner)
{
Memo1->Lines->Clear();

}
//----------------------------------------------------------------------
-----

void __fastcall TForm1::Button1Click(TObject *Sender)
{

        Memo1->Lines->Add("");
        if (CheckBox1->Checked) {
                Memo1->Lines->Add("Attention: Following Redirects");
                IdHTTP1->HandleRedirects=true;
        } else {
                Memo1->Lines->Add("Attention: Not Following
Redirects");
                IdHTTP1->HandleRedirects=false;
        }

        Memo1->Lines->Add("HEAD "+Edit1->Text+" on port "+Edit2->Text);
        IdHTTP1->Port=Edit2->Text.ToInt();
        try {
                IdHTTP1->Head(Edit1->Text);
        }
        catch (...)
        {
                //
        }
        Memo1->Lines->Add(IdHTTP1->Response->ResponseText);
        Memo1->Lines->Add(IdHTTP1->Response->RawHeaders->Text);

}
//----------------------------------------------------------------------
-----

void __fastcall TForm1::Button2Click(TObject *Sender)
{
        Memo1->Lines->Add("");
        if (CheckBox1->Checked) {
                Memo1->Lines->Add("Attention: Following Redirects");
                IdHTTP1->HandleRedirects=true;
        } else {
                Memo1->Lines->Add("Attention: Not Following
Redirects");
                IdHTTP1->HandleRedirects=false;
        }

        Memo1->Lines->Add("GET "+Edit1->Text+" on port "+Edit2->Text);
        IdHTTP1->Port=Edit2->Text.ToInt();
        try {
                IdHTTP1->Get(Edit1->Text);
        }
        catch (...)
        {
                //
        }
        Memo1->Lines->Add(IdHTTP1->Response->ResponseText);
        Memo1->Lines->Add(IdHTTP1->Response->RawHeaders->Text);

}
//----------------------------------------------------------------------
-----
void __fastcall TForm1::Button3Click(TObject *Sender)
{
Memo1->Lines->Clear();
}
//----------------------------------------------------------------------
-----


Header file

//----------------------------------------------------------------------
-----

#ifndef Unit1H
#define Unit1H
//----------------------------------------------------------------------
-----
#include <Classes.hpp>
#include <Controls.hpp>
#include <StdCtrls.hpp>
#include <Forms.hpp>
#include <IdBaseComponent.hpp>
#include <IdComponent.hpp>
#include <IdHTTP.hpp>
#include <IdTCPClient.hpp>
#include <IdTCPConnection.hpp>
//----------------------------------------------------------------------
-----
class TForm1 : public TForm
{
__published:	// IDE-managed Components
        TMemo *Memo1;
        TEdit *Edit1;
        TButton *Button1;
        TButton *Button2;
        TIdHTTP *IdHTTP1;
        TEdit *Edit2;
        TLabel *Label1;
        TLabel *Label2;
        TCheckBox *CheckBox1;
        TButton *Button3;
        TLabel *Label3;
        TLabel *Label4;
        void __fastcall Button1Click(TObject *Sender);
        void __fastcall Button2Click(TObject *Sender);
        void __fastcall Button3Click(TObject *Sender);
private:	// User declarations
public:		// User declarations
        __fastcall TForm1(TComponent* Owner);
};
//----------------------------------------------------------------------
-----
extern PACKAGE TForm1 *Form1;
//----------------------------------------------------------------------
-----
#endif


Waitman


David Worley wrote:
> Yeah, typo. Thanks for pointing that out.


From dworley at communityconnect.com  Thu Jan 26 17:00:13 2006
From: dworley at communityconnect.com (David Worley)
Date: Thu Jan 26 17:00:16 2006
Subject: [mod_python] Simple Issue, Baffling
Message-ID: <EE702CA684057843958BF6CE882E910101CF90FD@cci019.hq.communityconnect.com>

Mine is the same cross browser. I've tested in Firefox 1.5, MSIE 6.0,
and Opera (vWhoCaresItsOpera.0).

I'm surprised yours is browser-dependant.

===============================
David Worley
Senior Front End Developer
dworley@communityconnect.com
=============================== 

-----Original Message-----
From: mod_python-bounces@modpython.org
[mailto:mod_python-bounces@modpython.org] On Behalf Of Jim Steil
Sent: Thursday, January 26, 2006 4:56 PM
To: mod_python@modpython.org
Subject: Re: [mod_python] Simple Issue, Baffling

I have what I think is a similar problem.  My app works just fine with
IE, but when I try to get at it with FireFox, I see my HTML source
instead of my app.  I'm really new to all this, so it may not be
related.  But, I'm watching for a resolution as I'm hoping it will clue
me in to what I'm doing wrong as well.  It happens to me with Firefox
1.5.

    -Jim

Jim Gallacher wrote: 

	David Worley wrote: 
	

		To clarify further: 
		
		http://localhost/some/file/system/directory/style.css is
only ever 
		called from an HTML file, via a <link> tag. 


	I figured you knew that, but one never knows. ;) 
	
	

		The HTML is valid. The HTML 
		page is NOT generated by mod_python. It's just a plain
HTML file in the 
		folder. I created it just for testing dynamically
created CSS files. 
		
		The separate issue of "text/html" content is, indeed,
handled by another 
		handler. The two are unrelated. When text/css content
wouldn't work, I 
		tried something simpler: plain HTML return content. 
		
		Simply put, req.write(xxx) returns content that my
browser does not make 
		use of, whether CSS or HTML, despite the explicit
declaration of 
		req.content_type. The browser just thinks it's text. 
		
		It may be more accurate to say that the server never
returns HTML or 
		CSS, rather than saying that the browser never renders
the file 
		returned. 
		



	Is your handler as simple as you indicated or is there other
stuff going on? Any chance you are calling req.write *before* setting
req.content_type? The first call to req.write triggers the sending of
the response headers, which contains the Content-Type header. Once
you've starting calling req.write changing req.content_type will have no
effect. (Hmm, I wonder if we should actually raise an exception... ) 
	
	I find that tools like wget or netcat are helpful for this sort
of thing since you can dump the response headers as well as the page
content. If you don't have ready access to these programs I'm sure you
could know somthing together from the standard python lib. Sometimes the
simplest problems have the simplest solutions. 
	
	Jim 
	
	

		=============================== 
		David Worley 
		Senior Front End Developer 
		dworley@communityconnect.com 
		=============================== 
		-----Original Message----- 
		From: Jim Gallacher [mailto:jpg@jgassociates.ca] Sent:
Thursday, January 26, 2006 4:15 PM 
		To: David Worley 
		Cc: mod_python@modpython.org 
		Subject: Re: [mod_python] Simple Issue, Baffling 
		
		David Worley wrote: 
		
		

			Hello, all. I'm new to mod_python and somewhat
new to server side 
			programming. 
			
			I've read the documentation, and I can't seem to
find out something 
			relatively simple. 
			
			I'm writing a CSS preprocessor. It's meant to
grab a request for a 
			


		.css 
		
		

			file, process another file and return the result
to the browser. The 
			issue I have is that I can't get the handler to
return content the 
			browser actually uses. 
			
			To clarify, I'm running Apache 2.0, Python 2.4
on Windows XP. 
			
			So with the following httpd.conf entry: 
			
			<Directory /some/file/system/directory> 
			    AddHandler python-program .sss 
			    PythonHandler switch 
			    PythonDebug On 
			</Directory> 
			
			And the following Python code, in switch.py: 
			
			from mod_python import apache 
			
			def handler(req): 
			    req.content_type = "text/css" 
			    req.write("""\ 
			body { background-color: red; }""") 
			    return apache.OK 
			
			This works. It works great. When I request 
	
http://localhost/some/file/system/directory/style.css, I get the body 
			declaration above. BUT the browser doesn't use
it! 
			



		Maybe I don't understand the question but why would it?
The browser only 
		
		uses the stylesheet to render the page when it's
specified in an html <style> tag. 
		
		
		

			I have the same problem when declaring
req.content_type = "text/html": 
			the code is returned properly, but it isn't
rendered as HTML. It's 
			


		just 
		
		

			text, as far as the browser is concerned. 
			



		You got me there, unless you are saying you are getting
the python code as opposed to the html you send with req.write. Are you
writing valid html? Any chance there is a typo in req.content_type =
'text/html'? Are you using a different handler for generating the html? 
		
		It would help if you can clarify your problem a little. 
		
		Jim 
		
		
		
		
		_______________________________________________ 
		Mod_python mailing list 
		Mod_python@modpython.org 
		http://mailman.modpython.org/mailman/listinfo/mod_python

		
		


	_______________________________________________ 
	Mod_python mailing list 
	Mod_python@modpython.org 
	http://mailman.modpython.org/mailman/listinfo/mod_python 
	


-- 
Jim Steil
IT Manager
Quality Liquid Feeds
(608) 935-2345

From waitman at waitman.net  Thu Jan 26 17:03:31 2006
From: waitman at waitman.net (Waitman Gobble)
Date: Thu Jan 26 17:03:36 2006
Subject: [mod_python] Simple Issue, Baffling
In-Reply-To: <EE702CA684057843958BF6CE882E910101CF90F7@cci019.hq.communityconnect.com>
References: <EE702CA684057843958BF6CE882E910101CF90F7@cci019.hq.communityconnect.com>
Message-ID: <43D94733.6040702@waitman.net>



It works ok for me on apache/linux, but my config is a little different


httpd.conf


        RewriteEngine on
        RewriteCond %{REQUEST_URI} ^/xcss/(.*)$
        RewriteRule ^/xcss/(.*)$ /css.py?r=$1


            SetHandler mod_python
            PythonHandler mod_python.publisher
            PythonDebug Off
            PythonLogHandler log::logger




http://pyblog.com/test.htm

<html>
<head>
<link rel="stylesheet" href="/xcss/css.css" type="text/css">
</head>

<body>
<h1>FOO</h1>
</body>

</html>






http://pyblog.com/xcss/foo.css

body { background-color: yellow; }






http://pyblog.com/css.py


from mod_python import apache
import cgi

def index(req):

    req.content_type = "text/css"
    req.send_http_header()
    req.did_success=True
    content="body { background-color: yellow; }"
    return (content)



Waitman




David Worley wrote:
> I have Firefox set to have no cache. Despite that, I still Shift+Refresh
> when I'm testing a new app.
> 
> It's not that it's holding on to an old request, it's more that the
> server never returned content the browser recognized as CSS, or HTML.
> 
> Thanks for the suggestion, though!
> 
> ===============================
> David Worley
> Senior Front End Developer
> dworley@communityconnect.com
> =============================== 
> 
> -----Original Message-----
> From: mod_python-bounces@modpython.org
> [mailto:mod_python-bounces@modpython.org] On Behalf Of Eric Strand
> Sent: Thursday, January 26, 2006 4:42 PM
> To: mod_python@modpython.org
> Subject: Re: [mod_python] Simple Issue, Baffling
> 
> 
> Might it have to do with browser caching?  In the past I've encounter 
> similar frustration, and realized the browser was being too helpful.
> 
> 
> 
> David Worley wrote:
>> Yeah, typo. Thanks for pointing that out.
>>
>> The preprocessor is going to get a request for a .css file, find a
> .sss
>> file, process it, and return it as CSS.
>>
>> It's correct in the actual program.
>>
>> Believe me, I've combed over everything small like that. I wouldn't
> have
>> written without doing so. It seems like I've missed something in my
>> understanding of the req object, or the content_type property, or in
> the
>> way that AddHandler works.
>>
>> Any ideas?
>>
>> ===============================
>> David Worley
>> Senior Front End Developer
>> dworley@communityconnect.com
>> =============================== 
>>
>> -----Original Message-----
>> From: Waitman Gobble [mailto:waitman@waitman.net] 
>> Sent: Thursday, January 26, 2006 4:23 PM
>> To: Jim Gallacher
>> Cc: David Worley; mod_python@modpython.org
>> Subject: Re: [mod_python] Simple Issue, Baffling
>>
>> Sorry to jump in the middle of the conversation, but is
>>
>> AddHandler python-program .sss
>>
>> supposed to be
>>
>> AddHandler python-program .css
>>
>> ???
>>
>> Take care,
>>
>> Waitman
>>
>>
>>
>>
>>
>> Jim Gallacher wrote:
>>
>>> David Worley wrote:
>>>
>>>> I'm writing a CSS preprocessor. It's meant to grab a request for a
>> .css
>>
>>>> So with the following httpd.conf entry:
>>>>
>>>> <Directory /some/file/system/directory>
>>>>    AddHandler python-program .sss
>>>>    PythonHandler switch
>>>>    PythonDebug On
>>>> </Directory>
>>
>>
>> _______________________________________________
>> Mod_python mailing list
>> Mod_python@modpython.org
>> http://mailman.modpython.org/mailman/listinfo/mod_python
>>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
From estrand at isomedia.com  Thu Jan 26 17:06:02 2006
From: estrand at isomedia.com (Eric Strand)
Date: Thu Jan 26 17:06:07 2006
Subject: [mod_python] Simple Issue, Baffling
In-Reply-To: <EE702CA684057843958BF6CE882E910101CF90E9@cci019.hq.communityconnect.com>
References: <EE702CA684057843958BF6CE882E910101CF90E9@cci019.hq.communityconnect.com>
Message-ID: <43D947CA.3080302@isomedia.com>


By using "text/html", the browser will treat it as HTML, but since you 
have no HTML tags in the file being returned (it's just CSS styles), it 
will appear as text.  There is nothing unusual there.

The fact that the CSS file is not being used when inside a <link> tag 
may indicated that the path in the link tag does not have the correct 
path to the CSS file.  (You probably have double checked this, but I 
point it out just offer up a suggestion that hasn't been explicitly 
dismissed.)

If you don't already use it, you might find the "live headers" firefox 
plugin useful to see what the browser is up to:

http://livehttpheaders.mozdev.org/

--Eric


David Worley wrote:
> To clarify further:
> 
> http://localhost/some/file/system/directory/style.css is only ever
> called from an HTML file, via a <link> tag. The HTML is valid. The HTML
> page is NOT generated by mod_python. It's just a plain HTML file in the
> folder. I created it just for testing dynamically created CSS files.
> 
> The separate issue of "text/html" content is, indeed, handled by another
> handler. The two are unrelated. When text/css content wouldn't work, I
> tried something simpler: plain HTML return content.
> 
> Simply put, req.write(xxx) returns content that my browser does not make
> use of, whether CSS or HTML, despite the explicit declaration of
> req.content_type. The browser just thinks it's text.
> 
> It may be more accurate to say that the server never returns HTML or
> CSS, rather than saying that the browser never renders the file
> returned.
> 
> ===============================
> David Worley
> Senior Front End Developer
> dworley@communityconnect.com
> =============================== 
> 
> -----Original Message-----
> From: Jim Gallacher [mailto:jpg@jgassociates.ca] 
> Sent: Thursday, January 26, 2006 4:15 PM
> To: David Worley
> Cc: mod_python@modpython.org
> Subject: Re: [mod_python] Simple Issue, Baffling
> 
> David Worley wrote:
> 
>>Hello, all. I'm new to mod_python and somewhat new to server side
>>programming.
>>
>>I've read the documentation, and I can't seem to find out something
>>relatively simple.
>>
>>I'm writing a CSS preprocessor. It's meant to grab a request for a
> 
> .css
> 
>>file, process another file and return the result to the browser. The
>>issue I have is that I can't get the handler to return content the
>>browser actually uses.
>>
>>To clarify, I'm running Apache 2.0, Python 2.4 on Windows XP.
>>
>>So with the following httpd.conf entry:
>>
>><Directory /some/file/system/directory>
>>	AddHandler python-program .sss
>>	PythonHandler switch
>>	PythonDebug On
>></Directory>
>>
>>And the following Python code, in switch.py:
>>
>>from mod_python import apache
>>
>>def handler(req):
>>	req.content_type = "text/css"
>>	req.write("""\
>>body { background-color: red; }""")
>>	return apache.OK
>>
>>This works. It works great. When I request
>>http://localhost/some/file/system/directory/style.css, I get the body
>>declaration above. BUT the browser doesn't use it!
> 
> 
> Maybe I don't understand the question but why would it? The browser only
> 
> uses the stylesheet to render the page when it's specified in an html 
> <style> tag.
> 
> 
>>I have the same problem when declaring req.content_type = "text/html":
>>the code is returned properly, but it isn't rendered as HTML. It's
> 
> just
> 
>>text, as far as the browser is concerned.
> 
> 
> You got me there, unless you are saying you are getting the python code 
> as opposed to the html you send with req.write. Are you writing valid 
> html? Any chance there is a typo in req.content_type = 'text/html'? Are 
> you using a different handler for generating the html?
> 
> It would help if you can clarify your problem a little.
> 
> Jim
> 
> 
> 
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
> 
From list at joreybump.com  Thu Jan 26 17:06:32 2006
From: list at joreybump.com (Jorey Bump)
Date: Thu Jan 26 17:06:40 2006
Subject: [mod_python] Simple Issue, Baffling
In-Reply-To: <EE702CA684057843958BF6CE882E910101CF90F7@cci019.hq.communityconnect.com>
References: <EE702CA684057843958BF6CE882E910101CF90F7@cci019.hq.communityconnect.com>
Message-ID: <43D947E8.30208@joreybump.com>

David Worley wrote:
> I have Firefox set to have no cache. Despite that, I still Shift+Refresh
> when I'm testing a new app.

Since you're using Firefox, install the Live HTTP headers plugin:

  http://livehttpheaders.mozdev.org/

It's extremely useful for troubleshooting exactly this kind of problem, 
because it allows you to see all the information in both the client and 
server headers, including Content-Type and caching information.



From jpg at jgassociates.ca  Thu Jan 26 17:11:04 2006
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Thu Jan 26 17:08:10 2006
Subject: [mod_python] Simple Issue, Baffling
In-Reply-To: <EE702CA684057843958BF6CE882E910101CF90F7@cci019.hq.communityconnect.com>
References: <EE702CA684057843958BF6CE882E910101CF90F7@cci019.hq.communityconnect.com>
Message-ID: <43D948F8.5020502@jgassociates.ca>

David Worley wrote:
> I have Firefox set to have no cache. Despite that, I still Shift+Refresh
> when I'm testing a new app.
> 
> It's not that it's holding on to an old request, it's more that the
> server never returned content the browser recognized as CSS, or HTML.
> 
> Thanks for the suggestion, though!


You might find the LiveHTTPheaders extension for Firefox handy for 
examining the server response. http://livehttpheaders.mozdev.org/

I have it installed but I never think to use it. I'm too much in the 
habit of reaching for wget.

Jim


> ===============================
> David Worley
> Senior Front End Developer
> dworley@communityconnect.com
> =============================== 
> 
> -----Original Message-----
> From: mod_python-bounces@modpython.org
> [mailto:mod_python-bounces@modpython.org] On Behalf Of Eric Strand
> Sent: Thursday, January 26, 2006 4:42 PM
> To: mod_python@modpython.org
> Subject: Re: [mod_python] Simple Issue, Baffling
> 
> 
> Might it have to do with browser caching?  In the past I've encounter 
> similar frustration, and realized the browser was being too helpful.
> 
> 
> 
> David Worley wrote:
> 
>>Yeah, typo. Thanks for pointing that out.
>>
>>The preprocessor is going to get a request for a .css file, find a
> 
> .sss
> 
>>file, process it, and return it as CSS.
>>
>>It's correct in the actual program.
>>
>>Believe me, I've combed over everything small like that. I wouldn't
> 
> have
> 
>>written without doing so. It seems like I've missed something in my
>>understanding of the req object, or the content_type property, or in
> 
> the
> 
>>way that AddHandler works.
>>
>>Any ideas?
>>
>>===============================
>>David Worley
>>Senior Front End Developer
>>dworley@communityconnect.com
>>=============================== 
>>
>>-----Original Message-----
>>From: Waitman Gobble [mailto:waitman@waitman.net] 
>>Sent: Thursday, January 26, 2006 4:23 PM
>>To: Jim Gallacher
>>Cc: David Worley; mod_python@modpython.org
>>Subject: Re: [mod_python] Simple Issue, Baffling
>>
>>Sorry to jump in the middle of the conversation, but is
>>
>>AddHandler python-program .sss
>>
>>supposed to be
>>
>>AddHandler python-program .css
>>
>>???
>>
>>Take care,
>>
>>Waitman
>>
>>
>>
>>
>>
>>Jim Gallacher wrote:
>>
>>
>>>David Worley wrote:
>>>
>>>
>>>>I'm writing a CSS preprocessor. It's meant to grab a request for a
>>
>>.css
>>
>>
>>>>So with the following httpd.conf entry:
>>>>
>>>><Directory /some/file/system/directory>
>>>>   AddHandler python-program .sss
>>>>   PythonHandler switch
>>>>   PythonDebug On
>>>></Directory>
>>
>>
>>
>>_______________________________________________
>>Mod_python mailing list
>>Mod_python@modpython.org
>>http://mailman.modpython.org/mailman/listinfo/mod_python
>>
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
> 

From jim at qlf.com  Thu Jan 26 17:09:37 2006
From: jim at qlf.com (Jim Steil)
Date: Thu Jan 26 17:10:04 2006
Subject: [mod_python] Simple Issue, Baffling
In-Reply-To: <EE702CA684057843958BF6CE882E910101CF90FD@cci019.hq.communityconnect.com>
References: <EE702CA684057843958BF6CE882E910101CF90FD@cci019.hq.communityconnect.com>
Message-ID: <43D948A1.5000109@qlf.com>

David:  Sorry about the blank reply.  Hands are too fast for my head today.

I just haven't looked into the problem because I'm the only FireFox user 
around here.  Since no one is complaining, I can't justify spending too 
much time on it.

    -Jim

David Worley wrote:
> Mine is the same cross browser. I've tested in Firefox 1.5, MSIE 6.0,
> and Opera (vWhoCaresItsOpera.0).
>
> I'm surprised yours is browser-dependant.
>
> ===============================
> David Worley
> Senior Front End Developer
> dworley@communityconnect.com
> =============================== 
>
> -----Original Message-----
> From: mod_python-bounces@modpython.org
> [mailto:mod_python-bounces@modpython.org] On Behalf Of Jim Steil
> Sent: Thursday, January 26, 2006 4:56 PM
> To: mod_python@modpython.org
> Subject: Re: [mod_python] Simple Issue, Baffling
>
> I have what I think is a similar problem.  My app works just fine with
> IE, but when I try to get at it with FireFox, I see my HTML source
> instead of my app.  I'm really new to all this, so it may not be
> related.  But, I'm watching for a resolution as I'm hoping it will clue
> me in to what I'm doing wrong as well.  It happens to me with Firefox
> 1.5.
>
>     -Jim
>
> Jim Gallacher wrote: 
>
> 	David Worley wrote: 
> 	
>
> 		To clarify further: 
> 		
> 		http://localhost/some/file/system/directory/style.css is
> only ever 
> 		called from an HTML file, via a <link> tag. 
>
>
> 	I figured you knew that, but one never knows. ;) 
> 	
> 	
>
> 		The HTML is valid. The HTML 
> 		page is NOT generated by mod_python. It's just a plain
> HTML file in the 
> 		folder. I created it just for testing dynamically
> created CSS files. 
> 		
> 		The separate issue of "text/html" content is, indeed,
> handled by another 
> 		handler. The two are unrelated. When text/css content
> wouldn't work, I 
> 		tried something simpler: plain HTML return content. 
> 		
> 		Simply put, req.write(xxx) returns content that my
> browser does not make 
> 		use of, whether CSS or HTML, despite the explicit
> declaration of 
> 		req.content_type. The browser just thinks it's text. 
> 		
> 		It may be more accurate to say that the server never
> returns HTML or 
> 		CSS, rather than saying that the browser never renders
> the file 
> 		returned. 
> 		
>
>
>
> 	Is your handler as simple as you indicated or is there other
> stuff going on? Any chance you are calling req.write *before* setting
> req.content_type? The first call to req.write triggers the sending of
> the response headers, which contains the Content-Type header. Once
> you've starting calling req.write changing req.content_type will have no
> effect. (Hmm, I wonder if we should actually raise an exception... ) 
> 	
> 	I find that tools like wget or netcat are helpful for this sort
> of thing since you can dump the response headers as well as the page
> content. If you don't have ready access to these programs I'm sure you
> could know somthing together from the standard python lib. Sometimes the
> simplest problems have the simplest solutions. 
> 	
> 	Jim 
> 	
> 	
>
> 		=============================== 
> 		David Worley 
> 		Senior Front End Developer 
> 		dworley@communityconnect.com 
> 		=============================== 
> 		-----Original Message----- 
> 		From: Jim Gallacher [mailto:jpg@jgassociates.ca] Sent:
> Thursday, January 26, 2006 4:15 PM 
> 		To: David Worley 
> 		Cc: mod_python@modpython.org 
> 		Subject: Re: [mod_python] Simple Issue, Baffling 
> 		
> 		David Worley wrote: 
> 		
> 		
>
> 			Hello, all. I'm new to mod_python and somewhat
> new to server side 
> 			programming. 
> 			
> 			I've read the documentation, and I can't seem to
> find out something 
> 			relatively simple. 
> 			
> 			I'm writing a CSS preprocessor. It's meant to
> grab a request for a 
> 			
>
>
> 		.css 
> 		
> 		
>
> 			file, process another file and return the result
> to the browser. The 
> 			issue I have is that I can't get the handler to
> return content the 
> 			browser actually uses. 
> 			
> 			To clarify, I'm running Apache 2.0, Python 2.4
> on Windows XP. 
> 			
> 			So with the following httpd.conf entry: 
> 			
> 			<Directory /some/file/system/directory> 
> 			    AddHandler python-program .sss 
> 			    PythonHandler switch 
> 			    PythonDebug On 
> 			</Directory> 
> 			
> 			And the following Python code, in switch.py: 
> 			
> 			from mod_python import apache 
> 			
> 			def handler(req): 
> 			    req.content_type = "text/css" 
> 			    req.write("""\ 
> 			body { background-color: red; }""") 
> 			    return apache.OK 
> 			
> 			This works. It works great. When I request 
> 	
> http://localhost/some/file/system/directory/style.css, I get the body 
> 			declaration above. BUT the browser doesn't use
> it! 
> 			
>
>
>
> 		Maybe I don't understand the question but why would it?
> The browser only 
> 		
> 		uses the stylesheet to render the page when it's
> specified in an html <style> tag. 
> 		
> 		
> 		
>
> 			I have the same problem when declaring
> req.content_type = "text/html": 
> 			the code is returned properly, but it isn't
> rendered as HTML. It's 
> 			
>
>
> 		just 
> 		
> 		
>
> 			text, as far as the browser is concerned. 
> 			
>
>
>
> 		You got me there, unless you are saying you are getting
> the python code as opposed to the html you send with req.write. Are you
> writing valid html? Any chance there is a typo in req.content_type =
> 'text/html'? Are you using a different handler for generating the html? 
> 		
> 		It would help if you can clarify your problem a little. 
> 		
> 		Jim 
> 		
> 		
> 		
> 		
> 		_______________________________________________ 
> 		Mod_python mailing list 
> 		Mod_python@modpython.org 
> 		http://mailman.modpython.org/mailman/listinfo/mod_python
>
> 		
> 		
>
>
> 	_______________________________________________ 
> 	Mod_python mailing list 
> 	Mod_python@modpython.org 
> 	http://mailman.modpython.org/mailman/listinfo/mod_python 
> 	
>
>
>   

-- 
Jim Steil
IT Manager
Quality Liquid Feeds
(608) 935-2345
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20060126/162d7b23/attachment.html
From dworley at communityconnect.com  Thu Jan 26 17:12:16 2006
From: dworley at communityconnect.com (David Worley)
Date: Thu Jan 26 17:12:18 2006
Subject: [mod_python] Simple Issue, SOLVED
Message-ID: <EE702CA684057843958BF6CE882E910101CF9106@cci019.hq.communityconnect.com>

UPDATE:

This is due to me being mentally challenged.

Seriously, I think I was dropped on my head as a baby.

The HTML file's link tag's rel attribute had an extra symbol.

<link rel:="stylesheet" type="text/css" href="main.css" />

The file works fine now. Remember when I said I checked all the little
things before writing? I guess I assumed I knew HTML well enough to
spell my attributes correctly...

Thank you all for your help. Next time I write I promise it will either
be to help someone else, or that I will have checked my spelling!!!

===============================
David Worley
Senior Front End Developer
dworley@communityconnect.com
=============================== 

From waitman at waitman.net  Thu Jan 26 17:13:07 2006
From: waitman at waitman.net (Waitman Gobble)
Date: Thu Jan 26 17:13:13 2006
Subject: [mod_python] Simple Issue, Baffling
In-Reply-To: <43D94733.6040702@waitman.net>
References: <EE702CA684057843958BF6CE882E910101CF90F7@cci019.hq.communityconnect.com>
	<43D94733.6040702@waitman.net>
Message-ID: <43D94973.60602@waitman.net>

oh. i DO NOT have an "xcss" folder, nor do i have an "/xcss/css.css"
file. it is going through mod_python


# HEAD http://pyblog.com/xcss/foo.css
200 OK
Connection: close
Date: Thu, 26 Jan 2006 22:00:01 GMT
Server: Apache
Content-Type: text/css
Client-Date: Thu, 26 Jan 2006 22:00:02 GMT
Client-Peer: 66.139.75.176:80
Client-Response-Num: 1


# HEAD http://pyblog.com/xcss
404 Not Found
Connection: close
Date: Thu, 26 Jan 2006 22:12:35 GMT
Server: Apache
Content-Type: text/html; charset=iso-8859-1
Client-Date: Thu, 26 Jan 2006 22:12:35 GMT
Client-Peer: 66.139.75.176:80
Client-Response-Num: 1

Best

Waitman



Waitman Gobble wrote:
> 
> It works ok for me on apache/linux, but my config is a little different
> 
> 

From list at joreybump.com  Thu Jan 26 17:13:18 2006
From: list at joreybump.com (Jorey Bump)
Date: Thu Jan 26 17:13:24 2006
Subject: [mod_python] Simple Issue, Baffling
In-Reply-To: <43D9456F.8050107@qlf.com>
References: <EE702CA684057843958BF6CE882E910101CF90E9@cci019.hq.communityconnect.com>	<43D94446.20100@jgassociates.ca>
	<43D9456F.8050107@qlf.com>
Message-ID: <43D9497E.3030006@joreybump.com>

Jim Steil wrote:
> I have what I think is a similar problem.  My app works just fine with 
> IE, but when I try to get at it with FireFox, I see my HTML source 
> instead of my app.  I'm really new to all this, so it may not be 
> related.  But, I'm watching for a resolution as I'm hoping it will clue 
> me in to what I'm doing wrong as well.  It happens to me with Firefox 1.5.

Have you tried to validate your page at the W3C?

  http://validator.w3.org/

I've seen IE render HTML that was placed entirely in an img alt 
attribute. Clearly, this is wrong. A little validation can go a long way 
towards pointing out simple HTML coding errors and improving cross 
browser reliability. Be grateful that Firefox will indicate problems.

As for the original issue, there is also a CSS validator:

  http://jigsaw.w3.org/css-validator/

This is a must for troubleshooting stylesheet problems.

From dworley at communityconnect.com  Thu Jan 26 17:15:25 2006
From: dworley at communityconnect.com (David Worley)
Date: Thu Jan 26 17:15:28 2006
Subject: [mod_python] Simple Issue, Baffling
Message-ID: <EE702CA684057843958BF6CE882E910101CF910C@cci019.hq.communityconnect.com>

Eric,

It was, indeed, something small and stupid. I guess I didn't check
thoroughly enough!

Thanks, so much, though for this FF extension: I've been looking for
something like this!

===============================
David Worley
Senior Front End Developer
dworley@communityconnect.com
=============================== 

-----Original Message-----
From: mod_python-bounces@modpython.org
[mailto:mod_python-bounces@modpython.org] On Behalf Of Eric Strand
Sent: Thursday, January 26, 2006 5:06 PM
To: mod_python@modpython.org
Subject: Re: [mod_python] Simple Issue, Baffling


By using "text/html", the browser will treat it as HTML, but since you 
have no HTML tags in the file being returned (it's just CSS styles), it 
will appear as text.  There is nothing unusual there.

The fact that the CSS file is not being used when inside a <link> tag 
may indicated that the path in the link tag does not have the correct 
path to the CSS file.  (You probably have double checked this, but I 
point it out just offer up a suggestion that hasn't been explicitly 
dismissed.)

If you don't already use it, you might find the "live headers" firefox 
plugin useful to see what the browser is up to:

http://livehttpheaders.mozdev.org/

--Eric


David Worley wrote:
> To clarify further:
> 
> http://localhost/some/file/system/directory/style.css is only ever
> called from an HTML file, via a <link> tag. The HTML is valid. The
HTML
> page is NOT generated by mod_python. It's just a plain HTML file in
the
> folder. I created it just for testing dynamically created CSS files.
> 
> The separate issue of "text/html" content is, indeed, handled by
another
> handler. The two are unrelated. When text/css content wouldn't work, I
> tried something simpler: plain HTML return content.
> 
> Simply put, req.write(xxx) returns content that my browser does not
make
> use of, whether CSS or HTML, despite the explicit declaration of
> req.content_type. The browser just thinks it's text.
> 
> It may be more accurate to say that the server never returns HTML or
> CSS, rather than saying that the browser never renders the file
> returned.
> 
> ===============================
> David Worley
> Senior Front End Developer
> dworley@communityconnect.com
> =============================== 
> 
> -----Original Message-----
> From: Jim Gallacher [mailto:jpg@jgassociates.ca] 
> Sent: Thursday, January 26, 2006 4:15 PM
> To: David Worley
> Cc: mod_python@modpython.org
> Subject: Re: [mod_python] Simple Issue, Baffling
> 
> David Worley wrote:
> 
>>Hello, all. I'm new to mod_python and somewhat new to server side
>>programming.
>>
>>I've read the documentation, and I can't seem to find out something
>>relatively simple.
>>
>>I'm writing a CSS preprocessor. It's meant to grab a request for a
> 
> .css
> 
>>file, process another file and return the result to the browser. The
>>issue I have is that I can't get the handler to return content the
>>browser actually uses.
>>
>>To clarify, I'm running Apache 2.0, Python 2.4 on Windows XP.
>>
>>So with the following httpd.conf entry:
>>
>><Directory /some/file/system/directory>
>>	AddHandler python-program .sss
>>	PythonHandler switch
>>	PythonDebug On
>></Directory>
>>
>>And the following Python code, in switch.py:
>>
>>from mod_python import apache
>>
>>def handler(req):
>>	req.content_type = "text/css"
>>	req.write("""\
>>body { background-color: red; }""")
>>	return apache.OK
>>
>>This works. It works great. When I request
>>http://localhost/some/file/system/directory/style.css, I get the body
>>declaration above. BUT the browser doesn't use it!
> 
> 
> Maybe I don't understand the question but why would it? The browser
only
> 
> uses the stylesheet to render the page when it's specified in an html 
> <style> tag.
> 
> 
>>I have the same problem when declaring req.content_type = "text/html":
>>the code is returned properly, but it isn't rendered as HTML. It's
> 
> just
> 
>>text, as far as the browser is concerned.
> 
> 
> You got me there, unless you are saying you are getting the python
code 
> as opposed to the html you send with req.write. Are you writing valid 
> html? Any chance there is a typo in req.content_type = 'text/html'?
Are 
> you using a different handler for generating the html?
> 
> It would help if you can clarify your problem a little.
> 
> Jim
> 
> 
> 
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
> 
_______________________________________________
Mod_python mailing list
Mod_python@modpython.org
http://mailman.modpython.org/mailman/listinfo/mod_python

From jpg at jgassociates.ca  Thu Jan 26 17:34:35 2006
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Thu Jan 26 17:31:32 2006
Subject: [mod_python] Simple Issue, Baffling
In-Reply-To: <43D9497E.3030006@joreybump.com>
References: <EE702CA684057843958BF6CE882E910101CF90E9@cci019.hq.communityconnect.com>	<43D94446.20100@jgassociates.ca>	<43D9456F.8050107@qlf.com>
	<43D9497E.3030006@joreybump.com>
Message-ID: <43D94E7B.2080709@jgassociates.ca>

Jorey Bump wrote:
> Jim Steil wrote:
> 
>> I have what I think is a similar problem.  My app works just fine with 
>> IE, but when I try to get at it with FireFox, I see my HTML source 
>> instead of my app.  I'm really new to all this, so it may not be 
>> related.  But, I'm watching for a resolution as I'm hoping it will 
>> clue me in to what I'm doing wrong as well.  It happens to me with 
>> Firefox 1.5.
> 
> 
> Have you tried to validate your page at the W3C?
> 
>  http://validator.w3.org/
> 
> I've seen IE render HTML that was placed entirely in an img alt 
> attribute. Clearly, this is wrong. A little validation can go a long way 
> towards pointing out simple HTML coding errors and improving cross 
> browser reliability. Be grateful that Firefox will indicate problems.

And if IRC, when the Content-Type response header is missing IE may make 
a guess based on the file extension, whereas Firefox treats it as 
binary/octet and pops up a save-as / file-open dialog.

Jim

From jpg at jgassociates.ca  Thu Jan 26 17:46:20 2006
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Thu Jan 26 17:43:15 2006
Subject: [mod_python] Simple Issue, SOLVED
In-Reply-To: <EE702CA684057843958BF6CE882E910101CF9106@cci019.hq.communityconnect.com>
References: <EE702CA684057843958BF6CE882E910101CF9106@cci019.hq.communityconnect.com>
Message-ID: <43D9513C.8000009@jgassociates.ca>

David Worley wrote:
> UPDATE:
> 
> This is due to me being mentally challenged.
> 
> Seriously, I think I was dropped on my head as a baby.

That's so weird. So was I.

> The HTML file's link tag's rel attribute had an extra symbol.
> 
> <link rel:="stylesheet" type="text/css" href="main.css" />
> 
> The file works fine now. Remember when I said I checked all the little
> things before writing? I guess I assumed I knew HTML well enough to
> spell my attributes correctly...

Yep. I spent an hour this morning trying to fix a chunk of html being 
generated by a python script that absolutely, positively should have 
worked. All the name attributes in my input tags had a '>' character 
appended but I just couldn't see it. Sixty freaking minutes to find it, 
2 keystrokes to fix it. Stupid typos.

Jim

From pjs at packet-addiction.org  Thu Jan 26 18:14:03 2006
From: pjs at packet-addiction.org (Peter Sanchez)
Date: Thu Jan 26 18:12:31 2006
Subject: [mod_python] mod_python executing old versions of my code
In-Reply-To: <43D87F2C.7070603@natlab.research.philips.com>
References: <5f56302b0601241715v13c1d3e7n7af3039697649242@mail.gmail.com>	<5f56302b0601241718s4d19023wf792da0eea8e65dc@mail.gmail.com>
	<43D7E938.70400@westcoastaerospace.com>
	<43D86EF2.5070005@natlab.research.philips.com>
	<0f7d95fa1fb04c4919699f5bf303da01@dscpl.com.au>
	<43D87F2C.7070603@natlab.research.philips.com>
Message-ID: <EDED69E2-F224-4027-9F1C-481D4F98A9B9@packet-addiction.org>

I have been a little slow on this thread. This is something I had  
planned on emailing the list about myself.

I have a page hosted using mod_python.publisher (mod_python version  
3.2.5b) The page returns results from a PSP formatted template  
system. On a lot of pages I use a variable named "info_msg"

Say I login to an account, info_msg is set to 'You have logged in.'  
Go to a new page, info_msg isn't used, but the template page does  
reference it (in case it was used) and you see 'You have logged in' I  
have been trying to figure it out, but no such luck. I just found  
this thread :)

As for the "MaxRequestsPerChild 1" work around. How big of a  
performance hit does this give? Seems like it would slow things down  
a bit. The site I run is pretty busy.

When will 3.2.6 be available?

Thanks,

Peter

On Jan 25, 2006, at 11:50 PM, Mike Looijmans wrote:

> Graham Dumpleton wrote:
>> On 26/01/2006, at 5:40 PM, Mike Looijmans wrote:
>>> When faced with the reload problem a few years ago, I created a  
>>> special "reload" request. The request would list all the .py[oc]  
>>> files in the script folder, and tries to unload or reload() each  
>>> of them.
>> Will not work for mod_python.publisher in mod_python 3.2 and possibly
>> not at all in future versions of mod_python, but for mod_python <=  
>> 3.1.4,
>> it is better to iterate over modules in sys.modules and if they  
>> contain
>> the attribute "__mtime__" set it to 0. By doing this, it will  
>> cause the
>> mod_python importer to reload it automatically the next time it is  
>> accessed.
>> By doing it this way, you don't expose yourself to issues that  
>> might arise
>> from mixing "apache.import_module()" and "reload()".
>
> I was not mixing - I was using "import" exclusively. I also wasn't  
> using publisher, but I wrote my own. (this was about 4 years ago)
>
> "My" publisher could detect changes in the handlers, but not in the  
> sub-modules they imported. 90% of code changes only affected the UI  
> parts which were in the headers.
>
> The fix was there to get changes in the library modules to become  
> effective, without having to log in on the apache machine.
>
>
>>> As a result, the "main" modules as well as dependent modules will  
>>> have been reloaded or removed (At least, the ones that came from  
>>> my project - it would not make sense to unload modules like 'os').
>> Other projects should really be run in the context of a different  
>> interpreter
>> by specifying PythonInterpreter. On that basis, you would have to  
>> be selective
>> if above method used.
>
> There were no other projects on that server...
>
>>> So just sending "http://myhost/pu/reload" to the server would  
>>> cause the next request to get all new scripts.
>> This is only guaranteed to work if you are using mod_python on  
>> Win32 platform.
>> It most definitely will not work with "prefork" on UNIX and  
>> usually not on
>> "worker" on UNIX. The reason the latter will not work reliably is  
>> that there
>> can be multiple Apache child processes and your request will only  
>> hit one of
>> those child processes. You would have to hit reload many times and  
>> even then
>> you wouldn't know for sure it had been done in all of the children.
>
> True.
> I was using Apache 2.0.something and Solaris 2.6 at the time (had  
> to compile everything, no binary distributions), but I already  
> forced apache to use a single-process multi-threading worker.  
> Benchmarks showed no real difference with the prefork mpm. The  
> machine was seriously limited by memory, and the childs would take  
> up >12 MB of memory each, most of which could be shared. Putting it  
> into threading mode solved the memory hogging, and also had  
> advantages in caching stuff in simple dictionaries in memory. I  
> also did DB connection pooling, but after implementing and doing  
> some benchmarks, there was no real performance advantage in doing  
> it on the MySQL database, which is amazingly fast in setting up  
> connections.
>
> Getting this to work on a prefork system is indeed quite a  
> challenge...
>
> But at the time, it was a much better option than restarting an  
> Apache server process when hundreds of machines are using it...
>
> --
> Mike Looijmans
> Philips Natlab / Topic Automation
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python

From luismg at gmx.net  Thu Jan 26 18:33:58 2006
From: luismg at gmx.net (Luis M. Gonzalez)
Date: Thu Jan 26 18:33:59 2006
Subject: [mod_python] String format in "LIKE" clause
Message-ID: <000601c622d0$fcf93410$f8dbebc9@luis>

Hi folks,

I know this is not specific for mod_python, but perhaps someone could give me a hint with this problem:

I have a method that accepts a parameter, and then performs an SQL query withe a LIKE clause as follows:

def query(req, company):        
    import MySQLdb
    db = MySQLdb.connect(host="localhost", user="root", passwd="", db="vic")
    cursor = db.cursor()
    cursor.execute(" select * from customers where company like '%s' "  %company )
    ...

The problem is that I want the query to accept partial company names, as well as the full ones.
For example, lets say that there's a company called "ACME INDUSTRIES LTDA" and I just input "INDUSTRIES".

In SQL, using something like "%industries%" in the like clause would be ok.
The problem is that Python also uses the percent sign (%) for string formatting, and I don't know how to write a LIKE clause that accepts a string parameter.

I tried this:
("select * from customers where company like %s%"  %company ) # doesn't work
("select * from customers where company like '%(%s)%"  %company  # doesn't work either

The question is: 
How should a include the parameter into de LIKE clause in order to accept only a part of the full company name and return the matching results?

I hope I made myself clear...(sorry for my english)

Thanks in advance!
Luis
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20060126/cd4caa45/attachment-0001.html
From grahamd at dscpl.com.au  Thu Jan 26 18:46:05 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Thu Jan 26 18:46:10 2006
Subject: [mod_python] String format in "LIKE" clause
Message-ID: <1138319165.31440@dscpl.user.openhosting.com>

Luis M. Gonzalez wrote ..
> I tried this:
> ("select * from customers where company like %s%"  %company ) # doesn't
> work
> ("select * from customers where company like '%(%s)%"  %company  # doesn't
> work either
> 
> The question is: 
> How should a include the parameter into de LIKE clause in order to accept
> only a part of the full company name and return the matching results?

Double up the"%" to get an actual percentage passed through.

  ("select * from customers where company like %s%%"  %company )

At least that would be the problem if it is simply using "%" operator on
string:

>>> "select * from customers where company like %s%" % "ME"
Traceback (most recent call last):
  File "<stdin>", line 1, in ?
ValueError: incomplete format

>>> "select * from customers where company like %s%%"  % "ME"          
'select * from customers where company like ME%'

Graham
From jpg at jgassociates.ca  Thu Jan 26 19:36:07 2006
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Thu Jan 26 19:32:31 2006
Subject: [mod_python] mod_python executing old versions of my code
In-Reply-To: <EDED69E2-F224-4027-9F1C-481D4F98A9B9@packet-addiction.org>
References: <5f56302b0601241715v13c1d3e7n7af3039697649242@mail.gmail.com>	<5f56302b0601241718s4d19023wf792da0eea8e65dc@mail.gmail.com>	<43D7E938.70400@westcoastaerospace.com>	<43D86EF2.5070005@natlab.research.philips.com>	<0f7d95fa1fb04c4919699f5bf303da01@dscpl.com.au>	<43D87F2C.7070603@natlab.research.philips.com>
	<EDED69E2-F224-4027-9F1C-481D4F98A9B9@packet-addiction.org>
Message-ID: <43D96AF7.2080208@jgassociates.ca>

Peter Sanchez wrote:
> I have been a little slow on this thread. This is something I had  
> planned on emailing the list about myself.
> 
> I have a page hosted using mod_python.publisher (mod_python version  
> 3.2.5b) The page returns results from a PSP formatted template  system. 
> On a lot of pages I use a variable named "info_msg"
> 
> Say I login to an account, info_msg is set to 'You have logged in.'  Go 
> to a new page, info_msg isn't used, but the template page does  
> reference it (in case it was used) and you see 'You have logged in' I  
> have been trying to figure it out, but no such luck. I just found  this 
> thread :)

 From what you are describing here I don't think this is a module reload 
problem. How are you passing info_msg between your requests? In the 
apache preform-mpm and worker-mpm models there will be a python 
interpreter for each apache child process. Each interpeter gets it's own 
copy of the module data. The value for a module variable set in a 
request in one child will only be visible to subsequent requests handled 
by that same child. If you want to share some data between different 
requests you'll need to use sessions, cookies, dump it into a database, 
or some other persistent store.

> As for the "MaxRequestsPerChild 1" work around. How big of a  
> performance hit does this give? Seems like it would slow things down  a 
> bit. 

Wrong. It'll slow it down *alot*. This trick should really only be used 
on a development machine. Consider the following results for a random 
bit of mod_python code on my machine.

Using ab -n 1000 and the following apache config:
StartServers         5
MinSpareServers      5
MaxSpareServers      10
MaxClients          50


For MaxRequestsPerChild 0
-------------------------
Concurrency Level:      1
Time taken for tests:   4.593905 seconds
Complete requests:      1000
Requests per second:    217.68 [#/sec] (mean)
Time per request:       4.594 [ms] (mean)
Transfer rate:          1061.84 [Kbytes/sec] received


For MaxRequestsPerChild 1
-------------------------
Concurrency Level:      1
Time taken for tests:   378.930349 seconds
Complete requests:      1000
Requests per second:    2.64 [#/sec] (mean)
Time per request:       378.930 [ms] (mean)
Transfer rate:          12.87 [Kbytes/sec] received

Ouch. Performance drops by a factor of 100 for MaxRequestsPerChild == 1. 
You could set StartServers to compensate, but it's not a general solution.

> When will 3.2.6 be available?

Unofficially, now. ;) Officially... well, we are likely going to have 
that discussion on the python-dev list in the next day or so.

Jim

From luismg at gmx.net  Thu Jan 26 19:34:07 2006
From: luismg at gmx.net (Luis M. Gonzalez)
Date: Thu Jan 26 19:34:08 2006
Subject: [mod_python] String format in "LIKE" clause
Message-ID: <005a01c622d9$6428a230$f8dbebc9@luis>

Thanks Graham, but no, this is not what I want to do...
I'll try to explain it better:

Lets say that I want to return a list of companies whose names include the 
word "Co" ("Co" is pased as a parameter to the query), so I can get:

Acme Corporation Ltd.
Barnes Corp.  Inc.
Corporative Management S.A.
Fresh Corpse Foods, Ltd.
etc, etc...

So, how should I include this parameter into the LIKE clause.
I guess it should be enclosed between "%" and "%", but what should I put in 
between?





----- Original Message ----- 
From: "Graham Dumpleton" <grahamd@dscpl.com.au>
To: "Luis M. Gonzalez" <luismg@gmx.net>
Cc: <mod_python@modpython.org>
Sent: Thursday, January 26, 2006 8:46 PM
Subject: Re: [mod_python] String format in "LIKE" clause


> Luis M. Gonzalez wrote ..
>> I tried this:
>> ("select * from customers where company like %s%"  %company ) # doesn't
>> work
>> ("select * from customers where company like '%(%s)%"  %company  # 
>> doesn't
>> work either
>>
>> The question is:
>> How should a include the parameter into de LIKE clause in order to accept
>> only a part of the full company name and return the matching results?
>
> Double up the"%" to get an actual percentage passed through.
>
>  ("select * from customers where company like %s%%"  %company )
>
> At least that would be the problem if it is simply using "%" operator on
> string:
>
>>>> "select * from customers where company like %s%" % "ME"
> Traceback (most recent call last):
>  File "<stdin>", line 1, in ?
> ValueError: incomplete format
>
>>>> "select * from customers where company like %s%%"  % "ME"
> 'select * from customers where company like ME%'
>
> Graham
> 
Thanks Graham, but no, this is not what I want to do...
I'll try to explain it better:

Lets say that I want to return a list of companies whose names include the 
word "Co" ("Co" is pased as a parameter to the query), so I can get:

Acme Corporation Ltd.
Barnes Corp.  Inc.
Corporative Management S.A.
Fresh Corpse Foods, Ltd.
etc, etc...

So, how should I include this parameter into the LIKE clause.
I guess it should be enclosed between "%" and "%", but what should I put in 
between?





----- Original Message ----- 
From: "Graham Dumpleton" <grahamd@dscpl.com.au>
To: "Luis M. Gonzalez" <luismg@gmx.net>
Cc: <mod_python@modpython.org>
Sent: Thursday, January 26, 2006 8:46 PM
Subject: Re: [mod_python] String format in "LIKE" clause


> Luis M. Gonzalez wrote ..
>> I tried this:
>> ("select * from customers where company like %s%"  %company ) # doesn't
>> work
>> ("select * from customers where company like '%(%s)%"  %company  # 
>> doesn't
>> work either
>>
>> The question is:
>> How should a include the parameter into de LIKE clause in order to accept
>> only a part of the full company name and return the matching results?
>
> Double up the"%" to get an actual percentage passed through.
>
>  ("select * from customers where company like %s%%"  %company )
>
> At least that would be the problem if it is simply using "%" operator on
> string:
>
>>>> "select * from customers where company like %s%" % "ME"
> Traceback (most recent call last):
>  File "<stdin>", line 1, in ?
> ValueError: incomplete format
>
>>>> "select * from customers where company like %s%%"  % "ME"
> 'select * from customers where company like ME%'
>
> Graham
> 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20060126/a90694bd/attachment.html
From pjs at packet-addiction.org  Thu Jan 26 19:44:32 2006
From: pjs at packet-addiction.org (Peter Sanchez)
Date: Thu Jan 26 19:42:55 2006
Subject: [mod_python] mod_python executing old versions of my code
In-Reply-To: <43D96AF7.2080208@jgassociates.ca>
References: <5f56302b0601241715v13c1d3e7n7af3039697649242@mail.gmail.com>	<5f56302b0601241718s4d19023wf792da0eea8e65dc@mail.gmail.com>	<43D7E938.70400@westcoastaerospace.com>	<43D86EF2.5070005@natlab.research.philips.com>	<0f7d95fa1fb04c4919699f5bf303da01@dscpl.com.au>	<43D87F2C.7070603@natlab.research.philips.com>
	<EDED69E2-F224-4027-9F1C-481D4F98A9B9@packet-addiction.org>
	<43D96AF7.2080208@jgassociates.ca>
Message-ID: <25DD6FB7-BF79-459A-B4C7-9C082809D987@packet-addiction.org>

On Jan 26, 2006, at 4:36 PM, Jim Gallacher wrote:

> Peter Sanchez wrote:
>> I have been a little slow on this thread. This is something I had   
>> planned on emailing the list about myself.
>> I have a page hosted using mod_python.publisher (mod_python  
>> version  3.2.5b) The page returns results from a PSP formatted  
>> template  system. On a lot of pages I use a variable named "info_msg"
>> Say I login to an account, info_msg is set to 'You have logged  
>> in.'  Go to a new page, info_msg isn't used, but the template page  
>> does  reference it (in case it was used) and you see 'You have  
>> logged in' I  have been trying to figure it out, but no such luck.  
>> I just found  this thread :)
>
> From what you are describing here I don't think this is a module  
> reload problem. How are you passing info_msg between your requests?  
> In the apache preform-mpm and worker-mpm models there will be a  
> python interpreter for each apache child process. Each interpeter  
> gets it's own copy of the module data. The value for a module  
> variable set in a request in one child will only be visible to  
> subsequent requests handled by that same child. If you want to  
> share some data between different requests you'll need to use  
> sessions, cookies, dump it into a database, or some other  
> persistent store.

OK, here is the layout.

acvars.py contains a dictionary named "ns" that is used for PSP  
template page data. The ns dictionary contains an entry for  
'info_msg' ( ns = {'info_msg':  '&nbsp;'} )

Now, index.py has

from acvars import *

When a function has completed, and warrants some sort of user update,  
the index.py function will do:

ns['info_msg'] = 'Some updating message for the users benefit'

ns is then passed to the PSP engine to format the HTML and the result  
is printed to the user.

This is the same thing for all functions in the index.py script  
(which is the front end)

Should I not be using from ... import * ?


>
>> As for the "MaxRequestsPerChild 1" work around. How big of a   
>> performance hit does this give? Seems like it would slow things  
>> down  a bit.
>
> Wrong. It'll slow it down *alot*. This trick should really only be  
> used on a development machine. Consider the following results for a  
> random bit of mod_python code on my machine.
>
> Using ab -n 1000 and the following apache config:
> StartServers         5
> MinSpareServers      5
> MaxSpareServers      10
> MaxClients          50
>
>
> For MaxRequestsPerChild 0
> -------------------------
> Concurrency Level:      1
> Time taken for tests:   4.593905 seconds
> Complete requests:      1000
> Requests per second:    217.68 [#/sec] (mean)
> Time per request:       4.594 [ms] (mean)
> Transfer rate:          1061.84 [Kbytes/sec] received
>
>
> For MaxRequestsPerChild 1
> -------------------------
> Concurrency Level:      1
> Time taken for tests:   378.930349 seconds
> Complete requests:      1000
> Requests per second:    2.64 [#/sec] (mean)
> Time per request:       378.930 [ms] (mean)
> Transfer rate:          12.87 [Kbytes/sec] received
>
> Ouch. Performance drops by a factor of 100 for MaxRequestsPerChild  
> == 1. You could set StartServers to compensate, but it's not a  
> general solution.

I figured it would be horrible to performance. I guess I was under  
stating ;)

>
>> When will 3.2.6 be available?
>
> Unofficially, now. ;) Officially... well, we are likely going to  
> have that discussion on the python-dev list in the next day or so.
>
> Jim

Thanks!

Peter

From grahamd at dscpl.com.au  Thu Jan 26 19:47:54 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Thu Jan 26 19:47:58 2006
Subject: [mod_python] String format in "LIKE" clause
Message-ID: <1138322874.6251@dscpl.user.openhosting.com>

Luis M. Gonzalez wrote ..
> Thanks Graham, but no, this is not what I want to do...
> I'll try to explain it better:
> 
> Lets say that I want to return a list of companies whose names include
> the 
> word "Co" ("Co" is pased as a parameter to the query), so I can get:
> 
> Acme Corporation Ltd.
> Barnes Corp.  Inc.
> Corporative Management S.A.
> Fresh Corpse Foods, Ltd.
> etc, etc...
> 
> So, how should I include this parameter into the LIKE clause.
> I guess it should be enclosed between "%" and "%", but what should I put
> in 
> between?

Ultimately you use the substring of string you are looking for.

Quoting from a Google search, as that way it looks authoritative:

  The LIKE pattern matching operator can also be used in the conditional selection
  of the where clause. Like is a very powerful operator that allows you to select
  only rows that are "like" what you specify. The percent sign "%" can be used as
  a wild card to match any possible character that might appear before or after the
  characters specified. For example:

  select first, last, city
     from empinfo
     where first LIKE 'Er%';
 
What you were doing is basically correct, although you were missing single quotes.

The real issue as I pointed out was that because you were using '%' operator to
compose the string, you need to have "%%" in the string where you want a real '%'.

Adding the missing quotes:

  "select * from customers where company like '%%%s%%'"  % "Co"

Which yields an actual SQL string of:

  "select * from customers where company like '%Co%'"

BTW, if the substring you want to search for is coming from a web page or other
user input this could be dangerous. For example, they could include a single quote
in the substring for searching and stuff it all up. Thus, you need to perform
appropriate escaping to avoid such problems.

Graham

> ----- Original Message ----- 
> From: "Graham Dumpleton" <grahamd@dscpl.com.au>
> To: "Luis M. Gonzalez" <luismg@gmx.net>
> Cc: <mod_python@modpython.org>
> Sent: Thursday, January 26, 2006 8:46 PM
> Subject: Re: [mod_python] String format in "LIKE" clause
> 
> 
> > Luis M. Gonzalez wrote ..
> >> I tried this:
> >> ("select * from customers where company like %s%"  %company ) # doesn't
> >> work
> >> ("select * from customers where company like '%(%s)%"  %company  # 
> >> doesn't
> >> work either
> >>
> >> The question is:
> >> How should a include the parameter into de LIKE clause in order to accept
> >> only a part of the full company name and return the matching results?
> >
> > Double up the"%" to get an actual percentage passed through.
> >
> >  ("select * from customers where company like %s%%"  %company )
> >
> > At least that would be the problem if it is simply using "%" operator
> on
> > string:
> >
> >>>> "select * from customers where company like %s%" % "ME"
> > Traceback (most recent call last):
> >  File "<stdin>", line 1, in ?
> > ValueError: incomplete format
> >
> >>>> "select * from customers where company like %s%%"  % "ME"
> > 'select * from customers where company like ME%'
> >
> > Graham
> > 
From luismg at gmx.net  Thu Jan 26 20:02:07 2006
From: luismg at gmx.net (Luis M. Gonzalez)
Date: Thu Jan 26 20:02:06 2006
Subject: [mod_python] String format in "LIKE" clause ( SOLVED! )
References: <1138322874.6251@dscpl.user.openhosting.com>
Message-ID: <008a01c622dd$4d5ee7e0$f8dbebc9@luis>

Thank you Graham!!
That works now! Adding double percent signs instead of single ones solved 
the problem.

Thanks again and best regards,
Luis



----- Original Message ----- 
From: "Graham Dumpleton" <grahamd@dscpl.com.au>
To: "Luis M. Gonzalez" <luismg@gmx.net>
Cc: <mod_python@modpython.org>
Sent: Thursday, January 26, 2006 9:47 PM
Subject: Re: [mod_python] String format in "LIKE" clause


> Luis M. Gonzalez wrote ..
>> Thanks Graham, but no, this is not what I want to do...
>> I'll try to explain it better:
>>
>> Lets say that I want to return a list of companies whose names include
>> the
>> word "Co" ("Co" is pased as a parameter to the query), so I can get:
>>
>> Acme Corporation Ltd.
>> Barnes Corp.  Inc.
>> Corporative Management S.A.
>> Fresh Corpse Foods, Ltd.
>> etc, etc...
>>
>> So, how should I include this parameter into the LIKE clause.
>> I guess it should be enclosed between "%" and "%", but what should I put
>> in
>> between?
>
> Ultimately you use the substring of string you are looking for.
>
> Quoting from a Google search, as that way it looks authoritative:
>
>  The LIKE pattern matching operator can also be used in the conditional 
> selection
>  of the where clause. Like is a very powerful operator that allows you to 
> select
>  only rows that are "like" what you specify. The percent sign "%" can be 
> used as
>  a wild card to match any possible character that might appear before or 
> after the
>  characters specified. For example:
>
>  select first, last, city
>     from empinfo
>     where first LIKE 'Er%';
>
> What you were doing is basically correct, although you were missing single 
> quotes.
>
> The real issue as I pointed out was that because you were using '%' 
> operator to
> compose the string, you need to have "%%" in the string where you want a 
> real '%'.
>
> Adding the missing quotes:
>
>  "select * from customers where company like '%%%s%%'"  % "Co"
>
> Which yields an actual SQL string of:
>
>  "select * from customers where company like '%Co%'"
>
> BTW, if the substring you want to search for is coming from a web page or 
> other
> user input this could be dangerous. For example, they could include a 
> single quote
> in the substring for searching and stuff it all up. Thus, you need to 
> perform
> appropriate escaping to avoid such problems.
>
> Graham
>
>> ----- Original Message ----- 
>> From: "Graham Dumpleton" <grahamd@dscpl.com.au>
>> To: "Luis M. Gonzalez" <luismg@gmx.net>
>> Cc: <mod_python@modpython.org>
>> Sent: Thursday, January 26, 2006 8:46 PM
>> Subject: Re: [mod_python] String format in "LIKE" clause
>>
>>
>> > Luis M. Gonzalez wrote ..
>> >> I tried this:
>> >> ("select * from customers where company like %s%"  %company ) # 
>> >> doesn't
>> >> work
>> >> ("select * from customers where company like '%(%s)%"  %company  #
>> >> doesn't
>> >> work either
>> >>
>> >> The question is:
>> >> How should a include the parameter into de LIKE clause in order to 
>> >> accept
>> >> only a part of the full company name and return the matching results?
>> >
>> > Double up the"%" to get an actual percentage passed through.
>> >
>> >  ("select * from customers where company like %s%%"  %company )
>> >
>> > At least that would be the problem if it is simply using "%" operator
>> on
>> > string:
>> >
>> >>>> "select * from customers where company like %s%" % "ME"
>> > Traceback (most recent call last):
>> >  File "<stdin>", line 1, in ?
>> > ValueError: incomplete format
>> >
>> >>>> "select * from customers where company like %s%%"  % "ME"
>> > 'select * from customers where company like ME%'
>> >
>> > Graham
>> >
> 

From jpg at jgassociates.ca  Thu Jan 26 20:08:32 2006
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Thu Jan 26 20:04:46 2006
Subject: [mod_python] mod_python executing old versions of my code
In-Reply-To: <25DD6FB7-BF79-459A-B4C7-9C082809D987@packet-addiction.org>
References: <5f56302b0601241715v13c1d3e7n7af3039697649242@mail.gmail.com>	<5f56302b0601241718s4d19023wf792da0eea8e65dc@mail.gmail.com>	<43D7E938.70400@westcoastaerospace.com>	<43D86EF2.5070005@natlab.research.philips.com>	<0f7d95fa1fb04c4919699f5bf303da01@dscpl.com.au>	<43D87F2C.7070603@natlab.research.philips.com>	<EDED69E2-F224-4027-9F1C-481D4F98A9B9@packet-addiction.org>	<43D96AF7.2080208@jgassociates.ca>
	<25DD6FB7-BF79-459A-B4C7-9C082809D987@packet-addiction.org>
Message-ID: <43D97290.6030404@jgassociates.ca>

Peter Sanchez wrote:
> On Jan 26, 2006, at 4:36 PM, Jim Gallacher wrote:
> 
>> Peter Sanchez wrote:
>>
>>> I have been a little slow on this thread. This is something I had   
>>> planned on emailing the list about myself.
>>> I have a page hosted using mod_python.publisher (mod_python  version  
>>> 3.2.5b) The page returns results from a PSP formatted  template  
>>> system. On a lot of pages I use a variable named "info_msg"
>>> Say I login to an account, info_msg is set to 'You have logged  in.'  
>>> Go to a new page, info_msg isn't used, but the template page  does  
>>> reference it (in case it was used) and you see 'You have  logged in' 
>>> I  have been trying to figure it out, but no such luck.  I just 
>>> found  this thread :)
>>
>>
>> From what you are describing here I don't think this is a module  
>> reload problem. How are you passing info_msg between your requests?  
>> In the apache preform-mpm and worker-mpm models there will be a  
>> python interpreter for each apache child process. Each interpeter  
>> gets it's own copy of the module data. The value for a module  
>> variable set in a request in one child will only be visible to  
>> subsequent requests handled by that same child. If you want to  share 
>> some data between different requests you'll need to use  sessions, 
>> cookies, dump it into a database, or some other  persistent store.
> 
> 
> OK, here is the layout.
> 
> acvars.py contains a dictionary named "ns" that is used for PSP  
> template page data. The ns dictionary contains an entry for  'info_msg' 
> ( ns = {'info_msg':  '&nbsp;'} )
> 
> Now, index.py has
> 
> from acvars import *
> 
> When a function has completed, and warrants some sort of user update,  
> the index.py function will do:
> 
> ns['info_msg'] = 'Some updating message for the users benefit'
> 
> ns is then passed to the PSP engine to format the HTML and the result  
> is printed to the user.
> 
> This is the same thing for all functions in the index.py script  (which 
> is the front end)
> 
> Should I not be using from ... import * ?

It's not so much that you shouldn't use import, it's just that each 
intepreter will get it's own copy of of your ns dictionary. You have to 
get into a different mindset when working with the apache prefork. 
Pretend that each apache child is a completely independent application 
and you'll get some insight into what's going on. The way you are doing 
things will work in threaded-mpm but it's a non-starter for prefork or 
worker. It's also a useful for pulling static data, such as 
configuration data, into you application.

The problems with old versions of code seeming to persist are related to 
changes to apache modules on disk, which is a different issue to what 
you are seeing.

Jim
From grahamd at dscpl.com.au  Thu Jan 26 20:13:21 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Thu Jan 26 20:13:26 2006
Subject: [mod_python] mod_python executing old versions of my code
Message-ID: <1138324401.23432@dscpl.user.openhosting.com>

Jim Gallacher wrote ..
> It's not so much that you shouldn't use import, it's just that each 
> intepreter will get it's own copy of of your ns dictionary. You have to
> get into a different mindset when working with the apache prefork. 
> Pretend that each apache child is a completely independent application
> and you'll get some insight into what's going on. The way you are doing
> things will work in threaded-mpm but it's a non-starter for prefork or
> worker. It's also a useful for pulling static data, such as 
> configuration data, into you application.

To help you understand what Jim is talking about, read this:

  http://www.dscpl.com.au/articles/modpython-004.html

Graham
From sean at barriescene.com  Thu Jan 26 22:55:48 2006
From: sean at barriescene.com (Sean Jamieson)
Date: Thu Jan 26 22:55:54 2006
Subject: [mod_python] String format in "LIKE" clause
In-Reply-To: <1138322874.6251@dscpl.user.openhosting.com>
References: <1138322874.6251@dscpl.user.openhosting.com>
Message-ID: <43D999C4.4090701@barriescene.com>

Two things:
1) you can escape your user input with: db.escape( company )
2) you can use MySQL's INSTR() function instead of LIKE, not requiring 
special formatting

examples:
cursor.execute( "SELECT * FROM table WHERE column LIKE '%%%s%%'" % 
db.escape( value ) )
    In this example your value us escaped, and safe. In this case you 
can't use the second argument to execute, which automatically escapes 
and wraps the value in single quotes for you.

or

cursor.execute( "SELECT * FROM table WHERE INSTR(column, %s)", (value,) )
    In this example, you dont need to worry about the fact that quotes 
are wrapped by execute, as you dont need to wrap your value with %, you 
also dont need to worry about the less than readable '%%%s%%'

Sean

Graham Dumpleton wrote:

>Luis M. Gonzalez wrote ..
>  
>
>>Thanks Graham, but no, this is not what I want to do...
>>I'll try to explain it better:
>>
>>Lets say that I want to return a list of companies whose names include
>>the 
>>word "Co" ("Co" is pased as a parameter to the query), so I can get:
>>
>>Acme Corporation Ltd.
>>Barnes Corp.  Inc.
>>Corporative Management S.A.
>>Fresh Corpse Foods, Ltd.
>>etc, etc...
>>
>>So, how should I include this parameter into the LIKE clause.
>>I guess it should be enclosed between "%" and "%", but what should I put
>>in 
>>between?
>>    
>>
>
>Ultimately you use the substring of string you are looking for.
>
>Quoting from a Google search, as that way it looks authoritative:
>
>  The LIKE pattern matching operator can also be used in the conditional selection
>  of the where clause. Like is a very powerful operator that allows you to select
>  only rows that are "like" what you specify. The percent sign "%" can be used as
>  a wild card to match any possible character that might appear before or after the
>  characters specified. For example:
>
>  select first, last, city
>     from empinfo
>     where first LIKE 'Er%';
> 
>What you were doing is basically correct, although you were missing single quotes.
>
>The real issue as I pointed out was that because you were using '%' operator to
>compose the string, you need to have "%%" in the string where you want a real '%'.
>
>Adding the missing quotes:
>
>  "select * from customers where company like '%%%s%%'"  % "Co"
>
>Which yields an actual SQL string of:
>
>  "select * from customers where company like '%Co%'"
>
>BTW, if the substring you want to search for is coming from a web page or other
>user input this could be dangerous. For example, they could include a single quote
>in the substring for searching and stuff it all up. Thus, you need to perform
>appropriate escaping to avoid such problems.
>
>Graham
>
>  
>
>>----- Original Message ----- 
>>From: "Graham Dumpleton" <grahamd@dscpl.com.au>
>>To: "Luis M. Gonzalez" <luismg@gmx.net>
>>Cc: <mod_python@modpython.org>
>>Sent: Thursday, January 26, 2006 8:46 PM
>>Subject: Re: [mod_python] String format in "LIKE" clause
>>
>>
>>    
>>
>>>Luis M. Gonzalez wrote ..
>>>      
>>>
>>>>I tried this:
>>>>("select * from customers where company like %s%"  %company ) # doesn't
>>>>work
>>>>("select * from customers where company like '%(%s)%"  %company  # 
>>>>doesn't
>>>>work either
>>>>
>>>>The question is:
>>>>How should a include the parameter into de LIKE clause in order to accept
>>>>only a part of the full company name and return the matching results?
>>>>        
>>>>
>>>Double up the"%" to get an actual percentage passed through.
>>>
>>> ("select * from customers where company like %s%%"  %company )
>>>
>>>At least that would be the problem if it is simply using "%" operator
>>>      
>>>
>>on
>>    
>>
>>>string:
>>>
>>>      
>>>
>>>>>>"select * from customers where company like %s%" % "ME"
>>>>>>            
>>>>>>
>>>Traceback (most recent call last):
>>> File "<stdin>", line 1, in ?
>>>ValueError: incomplete format
>>>
>>>      
>>>
>>>>>>"select * from customers where company like %s%%"  % "ME"
>>>>>>            
>>>>>>
>>>'select * from customers where company like ME%'
>>>
>>>Graham
>>>
>>>      
>>>
>_______________________________________________
>Mod_python mailing list
>Mod_python@modpython.org
>http://mailman.modpython.org/mailman/listinfo/mod_python
>
>
>  
>

From wouter at squirrel-systems.com  Fri Jan 27 01:38:50 2006
From: wouter at squirrel-systems.com (Wouter van Marle)
Date: Fri Jan 27 01:38:56 2006
Subject: [mod_python] Cookie problems
Message-ID: <1138343930.21701.62.camel@pistachio.squirrel>

Hi All,

I'm fiddling around with cookies, and after wondering why I always lost
my settings information I did some testing, and ran into what seems a
very very strict limit in cookie length. The code here is based on the
examples of the web pages. From the documentation I find that there is
no strict limit on the size of the value in the cookies, the only limit
I found mentioned in the archives is a 4k http header limit from Apache.
I'd assume I'm way below that.

Test 1 works correctly.

Test 2, with a slightly larger data for the cookie, fails. It is for
some reason not recognised as a valid MarshalCookie! The value used in
this case (the rest of the code being identical):
value = {'egg': 32,
         'color': 'white',
         'foo': 'bar',
         'foobar': 5}

Here the code of Test 1 (maybe with some extra line breaks due to e-mail
formatting):

from mod_python import Cookie, apache
import time

def handler(req):

    req.content_type = "text/html; charset=utf-8"

    cookies = Cookie.get_cookies(req, Cookie.MarshalCookie,
                                    secret='secret007')
    
    if cookies.has_key('spam'):
        spamcookie = cookies['spam']

        req.write('Great, a spam cookie was found: %s\n' \
                                      % str(spamcookie))
        if type(spamcookie) is Cookie.MarshalCookie:
            req.write('Here is what it looks like decoded: %s=%s\n'
                      % (spamcookie.name, spamcookie.value))
        else:
            req.write('WARNING: The cookie found is not a \
                       MarshalCookie, it may have been tapered with!')

    else:

        value = {'egg': 32,
                 'color': 'white',
                 'foo': 'bar'}
        
        Cookie.add_cookie(req, Cookie.MarshalCookie('spam', value, 'secret007'))
        req.write('Spam cookie not found, but we just set one!\n')

    return



From nlv11281 at natlab.research.philips.com  Fri Jan 27 02:09:10 2006
From: nlv11281 at natlab.research.philips.com (Mike Looijmans)
Date: Fri Jan 27 02:09:17 2006
Subject: [mod_python] String format in "LIKE" clause
In-Reply-To: <1138322874.6251@dscpl.user.openhosting.com>
References: <1138322874.6251@dscpl.user.openhosting.com>
Message-ID: <43D9C716.10202@natlab.research.philips.com>

> BTW, if the substring you want to search for is coming from a web page or other
> user input this could be dangerous. For example, they could include a single quote
> in the substring for searching and stuff it all up. Thus, you need to perform
> appropriate escaping to avoid such problems.

I always take the approach that no matter how smart I am in escaping the 
user's gibberish, there will always be someone smarter than me who 
figures out how to break it. So what I do in cases like you describe:

paramlist = ('%' + company + '%',)
cursor.execute("SELECT * FROM company WHERE name LIKE %s", paramlist)

(note that there are no quotes...)

Passing user input as query parameters is, as far as I am concerned, the 
_only_ safe way of passing user input to the database engine. Even if 
you have a 'perfect' escaping function, one day they'll take your code 
and run it on an other DBMS on which the escape function is broken.

I typically instruct users to use the more obvious "*" and "?" 
wildcards, and replace them as needed (for simplicity, I omit escaping 
the % and _ characters in the user's input):

if ("*" in company) or ("?" in company):
	company = company.replace("*", "%").replace("?", "_")
else:
	company = company + "%"

--
Mike.

From jcigar at ulb.ac.be  Fri Jan 27 02:43:16 2006
From: jcigar at ulb.ac.be (Julien Cigar)
Date: Fri Jan 27 02:43:10 2006
Subject: [mod_python] String format in "LIKE" clause ( SOLVED! )
In-Reply-To: <008a01c622dd$4d5ee7e0$f8dbebc9@luis>
References: <1138322874.6251@dscpl.user.openhosting.com>
	<008a01c622dd$4d5ee7e0$f8dbebc9@luis>
Message-ID: <43D9CF14.6040803@ulb.ac.be>

Please note that it's not the right way to do it. You should never never 
use "your_query %s" % (something,). With this kind of syntax you're 
vulnerable to SQL injection and other things.
I don't know for MysqlDB, but with Postgresql and psycopg the right way 
to do this is :
cursor.execute('INSERT INTO tables(foo, bar) VALUES (%s, %s)', (col1, 
col2)). With this syntax the driver will quote the problematic strings 
before sending them to the database.
It should be the same with mysqldb (see: 
http://www.python.org/peps/pep-0249.html)

Luis M. Gonzalez wrote:

> Thank you Graham!!
> That works now! Adding double percent signs instead of single ones 
> solved the problem.
>
> Thanks again and best regards,
> Luis
>
>
>
> ----- Original Message ----- From: "Graham Dumpleton" 
> <grahamd@dscpl.com.au>
> To: "Luis M. Gonzalez" <luismg@gmx.net>
> Cc: <mod_python@modpython.org>
> Sent: Thursday, January 26, 2006 9:47 PM
> Subject: Re: [mod_python] String format in "LIKE" clause
>
>
>> Luis M. Gonzalez wrote ..
>>
>>> Thanks Graham, but no, this is not what I want to do...
>>> I'll try to explain it better:
>>>
>>> Lets say that I want to return a list of companies whose names include
>>> the
>>> word "Co" ("Co" is pased as a parameter to the query), so I can get:
>>>
>>> Acme Corporation Ltd.
>>> Barnes Corp.  Inc.
>>> Corporative Management S.A.
>>> Fresh Corpse Foods, Ltd.
>>> etc, etc...
>>>
>>> So, how should I include this parameter into the LIKE clause.
>>> I guess it should be enclosed between "%" and "%", but what should I 
>>> put
>>> in
>>> between?
>>
>>
>> Ultimately you use the substring of string you are looking for.
>>
>> Quoting from a Google search, as that way it looks authoritative:
>>
>>  The LIKE pattern matching operator can also be used in the 
>> conditional selection
>>  of the where clause. Like is a very powerful operator that allows 
>> you to select
>>  only rows that are "like" what you specify. The percent sign "%" can 
>> be used as
>>  a wild card to match any possible character that might appear before 
>> or after the
>>  characters specified. For example:
>>
>>  select first, last, city
>>     from empinfo
>>     where first LIKE 'Er%';
>>
>> What you were doing is basically correct, although you were missing 
>> single quotes.
>>
>> The real issue as I pointed out was that because you were using '%' 
>> operator to
>> compose the string, you need to have "%%" in the string where you 
>> want a real '%'.
>>
>> Adding the missing quotes:
>>
>>  "select * from customers where company like '%%%s%%'"  % "Co"
>>
>> Which yields an actual SQL string of:
>>
>>  "select * from customers where company like '%Co%'"
>>
>> BTW, if the substring you want to search for is coming from a web 
>> page or other
>> user input this could be dangerous. For example, they could include a 
>> single quote
>> in the substring for searching and stuff it all up. Thus, you need to 
>> perform
>> appropriate escaping to avoid such problems.
>>
>> Graham
>>
>>> ----- Original Message ----- From: "Graham Dumpleton" 
>>> <grahamd@dscpl.com.au>
>>> To: "Luis M. Gonzalez" <luismg@gmx.net>
>>> Cc: <mod_python@modpython.org>
>>> Sent: Thursday, January 26, 2006 8:46 PM
>>> Subject: Re: [mod_python] String format in "LIKE" clause
>>>
>>>
>>> > Luis M. Gonzalez wrote ..
>>> >> I tried this:
>>> >> ("select * from customers where company like %s%"  %company ) # 
>>> >> doesn't
>>> >> work
>>> >> ("select * from customers where company like '%(%s)%"  %company  #
>>> >> doesn't
>>> >> work either
>>> >>
>>> >> The question is:
>>> >> How should a include the parameter into de LIKE clause in order 
>>> to >> accept
>>> >> only a part of the full company name and return the matching 
>>> results?
>>> >
>>> > Double up the"%" to get an actual percentage passed through.
>>> >
>>> >  ("select * from customers where company like %s%%"  %company )
>>> >
>>> > At least that would be the problem if it is simply using "%" operator
>>> on
>>> > string:
>>> >
>>> >>>> "select * from customers where company like %s%" % "ME"
>>> > Traceback (most recent call last):
>>> >  File "<stdin>", line 1, in ?
>>> > ValueError: incomplete format
>>> >
>>> >>>> "select * from customers where company like %s%%"  % "ME"
>>> > 'select * from customers where company like ME%'
>>> >
>>> > Graham
>>> >
>>
>>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>


-- 
Julien Cigar
Belgian Biodiversity Platform
http://www.biodiversity.be
Universit? Libre de Bruxelles
Campus de la Plaine CP 257
B?timent NO, Bureau 4 N4 115C (Niveau 4)
Boulevard du Triomphe, entr?e ULB 2
B-1050 Bruxelles
Work: jcigar@ulb.ac.be
Personal: mage@mordor.ath.cx

From nogradi at gmail.com  Fri Jan 27 04:55:34 2006
From: nogradi at gmail.com (Daniel Nogradi)
Date: Fri Jan 27 04:55:45 2006
Subject: [mod_python] mod_python executing old versions of my code
Message-ID: <5f56302b0601270155l13cd1bb9t9cedc1af8c406b5c@mail.gmail.com>

>* As for the "MaxRequestsPerChild 1" work around. How big of a
*>* performance hit does this give? Seems like it would slow things down  a
*>* bit.

As someone already noted, performance goes down a lot. I use this
method only on a server which is for development only,
but in such situation this is the best workaround I found for the
infamous reload problem.
*
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20060127/3098469b/attachment-0001.html
From jpg at jgassociates.ca  Fri Jan 27 10:34:24 2006
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Fri Jan 27 10:34:04 2006
Subject: [mod_python] Cookie problems
In-Reply-To: <1138343930.21701.62.camel@pistachio.squirrel>
References: <1138343930.21701.62.camel@pistachio.squirrel>
Message-ID: <43DA3D80.3000102@jgassociates.ca>

Wouter van Marle wrote:
> Hi All,
> 
> I'm fiddling around with cookies, and after wondering why I always lost
> my settings information I did some testing, and ran into what seems a
> very very strict limit in cookie length. The code here is based on the
> examples of the web pages. From the documentation I find that there is
> no strict limit on the size of the value in the cookies, the only limit
> I found mentioned in the archives is a 4k http header limit from Apache.
> I'd assume I'm way below that.
> 
> Test 1 works correctly.
> 
> Test 2, with a slightly larger data for the cookie, fails. It is for
> some reason not recognised as a valid MarshalCookie! The value used in
> this case (the rest of the code being identical):
> value = {'egg': 32,
>          'color': 'white',
>          'foo': 'bar',
>          'foobar': 5}
> 
> Here the code of Test 1 (maybe with some extra line breaks due to e-mail
> formatting):
> 
> from mod_python import Cookie, apache
> import time
> 
> def handler(req):
> 
>     req.content_type = "text/html; charset=utf-8"
> 
>     cookies = Cookie.get_cookies(req, Cookie.MarshalCookie,
>                                     secret='secret007')
>     
>     if cookies.has_key('spam'):
>         spamcookie = cookies['spam']
> 
>         req.write('Great, a spam cookie was found: %s\n' \
>                                       % str(spamcookie))
>         if type(spamcookie) is Cookie.MarshalCookie:
>             req.write('Here is what it looks like decoded: %s=%s\n'
>                       % (spamcookie.name, spamcookie.value))
>         else:
>             req.write('WARNING: The cookie found is not a \
>                        MarshalCookie, it may have been tapered with!')
> 
>     else:
> 
>         value = {'egg': 32,
>                  'color': 'white',
>                  'foo': 'bar'}
>         
>         Cookie.add_cookie(req, Cookie.MarshalCookie('spam', value, 'secret007'))
>         req.write('Spam cookie not found, but we just set one!\n')
> 
>     return


I tried your 2 test cases and they both work just fine. Are you saying 
that test case 2 as shown above fails, or is the value for test case 2 
actually much larger? How does it fail: Not a marshal cookie, or not found?

Using value = {'test': 'a' * size}, I found that Firefox was not setting 
the cookie for size > 3029, and so was not sending it to the server on 
subsequent requests. The header was sent however from the server 
however, so it looks like you face 2 possible limits: the max that 
apache will send and the max that a browser will receive. (A quick check 
  with IE 6 reveals that it is most likely a browser limit. The cookie 
setting works for size > 3500. I didn't test beyond that, but I'm sure 
there must be some limit'). FYI for size = 3029 the header length = 
4097, while size = 3030 gives a header length of 4101.

Perhaps you could expand a little on the exact failure you are seeing.

Jim
From wouter at squirrel-systems.com  Fri Jan 27 11:26:18 2006
From: wouter at squirrel-systems.com (Wouter van Marle)
Date: Fri Jan 27 11:26:31 2006
Subject: [mod_python] Cookie problems
In-Reply-To: <43DA3D80.3000102@jgassociates.ca>
References: <1138343930.21701.62.camel@pistachio.squirrel>
	<43DA3D80.3000102@jgassociates.ca>
Message-ID: <1138379179.7411.17.camel@cm222-167-159-88.hkcable.com.hk>

On Fri, 2006-01-27 at 10:34 -0500, Jim Gallacher wrote:

> Wouter van Marle wrote:
> > Hi All,
> > 
> > I'm fiddling around with cookies, and after wondering why I always lost
> > my settings information I did some testing, and ran into what seems a
> > very very strict limit in cookie length. The code here is based on the
> > examples of the web pages. From the documentation I find that there is
> > no strict limit on the size of the value in the cookies, the only limit
> > I found mentioned in the archives is a 4k http header limit from Apache.
> > I'd assume I'm way below that.
> > 
> > Test 1 works correctly.
> > 
> > Test 2, with a slightly larger data for the cookie, fails. It is for
> > some reason not recognised as a valid MarshalCookie! The value used in
> > this case (the rest of the code being identical):
> > value = {'egg': 32,
> >          'color': 'white',
> >          'foo': 'bar',
> >          'foobar': 5}
> > 
> > Here the code of Test 1 (maybe with some extra line breaks due to e-mail
> > formatting):
> > 
> > from mod_python import Cookie, apache
> > import time
> > 
> > def handler(req):
> > 
> >     req.content_type = "text/html; charset=utf-8"
> > 
> >     cookies = Cookie.get_cookies(req, Cookie.MarshalCookie,
> >                                     secret='secret007')
> >     
> >     if cookies.has_key('spam'):
> >         spamcookie = cookies['spam']
> > 
> >         req.write('Great, a spam cookie was found: %s\n' \
> >                                       % str(spamcookie))
> >         if type(spamcookie) is Cookie.MarshalCookie:
> >             req.write('Here is what it looks like decoded: %s=%s\n'
> >                       % (spamcookie.name, spamcookie.value))
> >         else:
> >             req.write('WARNING: The cookie found is not a \
> >                        MarshalCookie, it may have been tapered with!')
> > 
> >     else:
> > 
> >         value = {'egg': 32,
> >                  'color': 'white',
> >                  'foo': 'bar'}
> >         
> >         Cookie.add_cookie(req, Cookie.MarshalCookie('spam', value, 'secret007'))
> >         req.write('Spam cookie not found, but we just set one!\n')
> > 
> >     return
> 
> 
> I tried your 2 test cases and they both work just fine. Are you saying 
> that test case 2 as shown above fails, or is the value for test case 2 
> actually much larger? How does it fail: Not a marshal cookie, or not found?


The output as given in the browser is the line 'WARNING: The cookie
found is not a MarshalCookie, it may have been tapered with!' . 
Attempting to decode the cookie gives garbage.

I'm using Mozilla 1.7.6, Apache Server version:
Apache-AdvancedExtranetServer/2.0.53, mod_python 3.1.4.4mdk.

The problem appears to be the same on my debian server (I don't want to
use it for the above tests; but I found the problem with disappearing
and unreadable cookies there first). A related problem with the
(apparently too long) cookies is that both the path= and expires=
parameters are being ignored when setting the cookie.


> Using value = {'test': 'a' * size}, I found that Firefox was not setting 
> the cookie for size > 3029, and so was not sending it to the server on 
> subsequent requests.


Mmmm well I'm testing it with the variables as given above, that failed.
I just found that using {'a': 'a'*44} is the maximum I can get through.
Much smaller than on your side, very strange.

How to easily get the  complete header length, by the way?

Wouter.


>  The header was sent however from the server 
> however, so it looks like you face 2 possible limits: the max that 
> apache will send and the max that a browser will receive. (A quick check 
>   with IE 6 reveals that it is most likely a browser limit. The cookie 
> setting works for size > 3500. I didn't test beyond that, but I'm sure 
> there must be some limit'). FYI for size = 3029 the header length = 
> 4097, while size = 3030 gives a header length of 4101.
> 
> Perhaps you could expand a little on the exact failure you are seeing.
> 
> Jim
> 
> 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20060128/3f4a6561/attachment.html
From jpg at jgassociates.ca  Fri Jan 27 12:09:47 2006
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Fri Jan 27 12:09:04 2006
Subject: [mod_python] Cookie problems
In-Reply-To: <1138379179.7411.17.camel@cm222-167-159-88.hkcable.com.hk>
References: <1138343930.21701.62.camel@pistachio.squirrel>	<43DA3D80.3000102@jgassociates.ca>
	<1138379179.7411.17.camel@cm222-167-159-88.hkcable.com.hk>
Message-ID: <43DA53DB.3060605@jgassociates.ca>

Wouter van Marle wrote:
> On Fri, 2006-01-27 at 10:34 -0500, Jim Gallacher wrote:
> 
> 
>>Wouter van Marle wrote:
>>
>>>Hi All,
>>>
>>>I'm fiddling around with cookies, and after wondering why I always lost
>>>my settings information I did some testing, and ran into what seems a
>>>very very strict limit in cookie length. The code here is based on the
>>>examples of the web pages. From the documentation I find that there is
>>>no strict limit on the size of the value in the cookies, the only limit
>>>I found mentioned in the archives is a 4k http header limit from Apache.
>>>I'd assume I'm way below that.
>>>
>>>Test 1 works correctly.
>>>
>>>Test 2, with a slightly larger data for the cookie, fails. It is for
>>>some reason not recognised as a valid MarshalCookie! The value used in
>>>this case (the rest of the code being identical):
>>>value = {'egg': 32,
>>>         'color': 'white',
>>>         'foo': 'bar',
>>>         'foobar': 5}
>>>
>>>Here the code of Test 1 (maybe with some extra line breaks due to e-mail
>>>formatting):
>>>
>>>from mod_python import Cookie, apache
>>>import time
>>>
>>>def handler(req):
>>>
>>>    req.content_type = "text/html; charset=utf-8"
>>>
>>>    cookies = Cookie.get_cookies(req, Cookie.MarshalCookie,
>>>                                    secret='secret007')
>>>    
>>>    if cookies.has_key('spam'):
>>>        spamcookie = cookies['spam']
>>>
>>>        req.write('Great, a spam cookie was found: %s\n' \
>>>                                      % str(spamcookie))
>>>        if type(spamcookie) is Cookie.MarshalCookie:
>>>            req.write('Here is what it looks like decoded: %s=%s\n'
>>>                      % (spamcookie.name, spamcookie.value))
>>>        else:
>>>            req.write('WARNING: The cookie found is not a \
>>>                       MarshalCookie, it may have been tapered with!')
>>>
>>>    else:
>>>
>>>        value = {'egg': 32,
>>>                 'color': 'white',
>>>                 'foo': 'bar'}
>>>        
>>>        Cookie.add_cookie(req, Cookie.MarshalCookie('spam', value, 'secret007'))
>>>        req.write('Spam cookie not found, but we just set one!\n')
>>>
>>>    return
>>
>>
>>I tried your 2 test cases and they both work just fine. Are you saying 
>>that test case 2 as shown above fails, or is the value for test case 2 
>>actually much larger? How does it fail: Not a marshal cookie, or not found?
> 
> 
> 
> The output as given in the browser is the line 'WARNING: The cookie
> found is not a MarshalCookie, it may have been tapered with!' . 
> Attempting to decode the cookie gives garbage.

This certainly suggests that the output header is getting truncated. The 
browser is not returning the complete cookie.

> I'm using Mozilla 1.7.6, Apache Server version:
> Apache-AdvancedExtranetServer/2.0.53, mod_python 3.1.4.4mdk.
> 
> The problem appears to be the same on my debian server (I don't want to
> use it for the above tests; but I found the problem with disappearing
> and unreadable cookies there first). A related problem with the
> (apparently too long) cookies is that both the path= and expires=
> parameters are being ignored when setting the cookie.

They are on the Set-Cookie header line following the cookie value, so if 
the header is getting trimmed somewhere it's not a suprise that they are 
messed up or missing as well.

> 
>>Using value = {'test': 'a' * size}, I found that Firefox was not setting 
>>the cookie for size > 3029, and so was not sending it to the server on 
>>subsequent requests.
> 
> 
> 
> Mmmm well I'm testing it with the variables as given above, that failed.
> I just found that using {'a': 'a'*44} is the maximum I can get through.
> Much smaller than on your side, very strange.

Very strange indeed. There is nothing in Cookie.py that would truncate 
the value that is used for the Set-Cookie header so I don't see how that 
could be a problem. What happens if you try setting some other response 
header such as content_type with a long value? You can use 
httpLiveHeaders or wget to see what the server sends.

> How to easily get the  complete header length, by the way?
> 

wget -S http://localhost/cookietest.py 2>&1 | grep Set-Cookie | cut -f 2 
-d ":" |tr -d " " |wc

Jim

> Wouter.
> 
> 
> 
>> The header was sent however from the server 
>>however, so it looks like you face 2 possible limits: the max that 
>>apache will send and the max that a browser will receive. (A quick check 
>>  with IE 6 reveals that it is most likely a browser limit. The cookie 
>>setting works for size > 3500. I didn't test beyond that, but I'm sure 
>>there must be some limit'). FYI for size = 3029 the header length = 
>>4097, while size = 3030 gives a header length of 4101.
>>
>>Perhaps you could expand a little on the exact failure you are seeing.
>>
>>Jim
>>
>>
> 
> 
> 
> ------------------------------------------------------------------------
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python

From sean at barriescene.com  Fri Jan 27 12:59:58 2006
From: sean at barriescene.com (Sean Jamieson)
Date: Fri Jan 27 13:00:05 2006
Subject: [mod_python] Cookie problems
In-Reply-To: <1138343930.21701.62.camel@pistachio.squirrel>
References: <1138343930.21701.62.camel@pistachio.squirrel>
Message-ID: <43DA5F9E.8020006@barriescene.com>

First, there cookies are supposed to be limited to 1 or 2KB MAX, this 
limit is enfoced by the browser, and therefore very subjective. You 
should not expect to be able to set more than 2kb for the entire set of 
cookies. If you are able to see more, then its the browser being 
non-standard :-)

Sean

Wouter van Marle wrote:

>Hi All,
>
>I'm fiddling around with cookies, and after wondering why I always lost
>my settings information I did some testing, and ran into what seems a
>very very strict limit in cookie length. The code here is based on the
>examples of the web pages. From the documentation I find that there is
>no strict limit on the size of the value in the cookies, the only limit
>I found mentioned in the archives is a 4k http header limit from Apache.
>I'd assume I'm way below that.
>
>Test 1 works correctly.
>
>Test 2, with a slightly larger data for the cookie, fails. It is for
>some reason not recognised as a valid MarshalCookie! The value used in
>this case (the rest of the code being identical):
>value = {'egg': 32,
>         'color': 'white',
>         'foo': 'bar',
>         'foobar': 5}
>
>Here the code of Test 1 (maybe with some extra line breaks due to e-mail
>formatting):
>
>from mod_python import Cookie, apache
>import time
>
>def handler(req):
>
>    req.content_type = "text/html; charset=utf-8"
>
>    cookies = Cookie.get_cookies(req, Cookie.MarshalCookie,
>                                    secret='secret007')
>    
>    if cookies.has_key('spam'):
>        spamcookie = cookies['spam']
>
>        req.write('Great, a spam cookie was found: %s\n' \
>                                      % str(spamcookie))
>        if type(spamcookie) is Cookie.MarshalCookie:
>            req.write('Here is what it looks like decoded: %s=%s\n'
>                      % (spamcookie.name, spamcookie.value))
>        else:
>            req.write('WARNING: The cookie found is not a \
>                       MarshalCookie, it may have been tapered with!')
>
>    else:
>
>        value = {'egg': 32,
>                 'color': 'white',
>                 'foo': 'bar'}
>        
>        Cookie.add_cookie(req, Cookie.MarshalCookie('spam', value, 'secret007'))
>        req.write('Spam cookie not found, but we just set one!\n')
>
>    return
>
>
>
>_______________________________________________
>Mod_python mailing list
>Mod_python@modpython.org
>http://mailman.modpython.org/mailman/listinfo/mod_python
>
>
>  
>

From sean at barriescene.com  Fri Jan 27 14:53:27 2006
From: sean at barriescene.com (Sean Jamieson)
Date: Fri Jan 27 14:53:32 2006
Subject: [mod_python] Current Working Directory not set?
Message-ID: <43DA7A37.5050500@barriescene.com>

Hello everybody,
I don't know if there's already been a discussion about this, it seems 
like a small but obvious issue.

The current working directory does not apear to be set when a 
mod_python.publisher script runs; or rather it's set to "/" which is not 
useful. This becomes quite a pain, as I'm forced to do many things to 
work around it.
i.e.
1) I've started using kid templates, and I have to use:
     Template( file=req.document_root().'template.kid', ... )
or
    Template( 
file=req.document_root().'project_dir/templates/template.kid', ... )
rather then the more natural:
    Template( file='templates/template.kid )
this should find the 'templates' directory in the same directory as the 
running script

2) I have to fully qualify imports from the document root, as the 
document root is added to sys.modules, but the current directory is not. 
So, if I'm in a subdirectory under the document root I have to do:
    import project_dir.subpackage.module
when the current directory is 'project_dir'. This is silly, I should be 
able to import something in, or under, the current working directory:
    import subpackage.module
I would have to do some hack involving seperating the dirname of 
__file__ and adding it to sys.modules

Sean



From deron.meranda at gmail.com  Fri Jan 27 15:34:42 2006
From: deron.meranda at gmail.com (Deron Meranda)
Date: Fri Jan 27 15:34:47 2006
Subject: [mod_python] Current Working Directory not set?
In-Reply-To: <43DA7A37.5050500@barriescene.com>
References: <43DA7A37.5050500@barriescene.com>
Message-ID: <5c06fa770601271234t60e6d14s3579960884c68941@mail.gmail.com>

There are two problems with having the working directory set like you want

1. URLs don't have to map to actual directories (and many mod_python
users depend on this)

2. The working directory is a process attribute.  Changing it would
cause all kinds of problems in a multithreaded environment (depending
on your Apache MPM)

Generally, you should either set your PythonPath, or expect to deal
with absolute pathnames or other such games.

You may also want to look at the mod_python import_module() function,
which lets you specify a path.  Also the request member req.filename
may be useful to you was well.
--
Deron Meranda

From sean at barriescene.com  Fri Jan 27 16:01:22 2006
From: sean at barriescene.com (Sean Jamieson)
Date: Fri Jan 27 16:01:27 2006
Subject: [mod_python] Current Working Directory not set?
In-Reply-To: <5c06fa770601271234t60e6d14s3579960884c68941@mail.gmail.com>
References: <43DA7A37.5050500@barriescene.com>
	<5c06fa770601271234t60e6d14s3579960884c68941@mail.gmail.com>
Message-ID: <43DA8A22.1060909@barriescene.com>

Thanks for the quick response Deron.

Disreguarding the apache issue, what would be the problem with the 
working directory being set for publisher scripts? personally I'd expect 
to be able to refernce files relative to the script's directory.
I understand that for generaic handlers this wouldn't quite make sense; 
but for publisher and PSP (I don't know if its an issue for PSP, as I 
don't use it), it makes sense to me.

Any clarifiction would be appreciated.

Sean

Deron Meranda wrote:

>There are two problems with having the working directory set like you want
>
>1. URLs don't have to map to actual directories (and many mod_python
>users depend on this)
>
>2. The working directory is a process attribute.  Changing it would
>cause all kinds of problems in a multithreaded environment (depending
>on your Apache MPM)
>
>Generally, you should either set your PythonPath, or expect to deal
>with absolute pathnames or other such games.
>
>You may also want to look at the mod_python import_module() function,
>which lets you specify a path.  Also the request member req.filename
>may be useful to you was well.
>--
>Deron Meranda
>  
>
From sean at barriescene.com  Fri Jan 27 16:04:17 2006
From: sean at barriescene.com (Sean Jamieson)
Date: Fri Jan 27 16:04:23 2006
Subject: [mod_python] Current Working Directory not set?
In-Reply-To: <43DA7A37.5050500@barriescene.com>
References: <43DA7A37.5050500@barriescene.com>
Message-ID: <43DA8AD1.6090704@barriescene.com>

I just noticed a mistake in my comment below, I was referencing 
sys.modules, where I ment sys.path.

Sean

Sean Jamieson wrote:

> Hello everybody,
> I don't know if there's already been a discussion about this, it seems 
> like a small but obvious issue.
>
> The current working directory does not apear to be set when a 
> mod_python.publisher script runs; or rather it's set to "/" which is 
> not useful. This becomes quite a pain, as I'm forced to do many things 
> to work around it.
> i.e.
> 1) I've started using kid templates, and I have to use:
>     Template( file=req.document_root().'template.kid', ... )
> or
>    Template( 
> file=req.document_root().'project_dir/templates/template.kid', ... )
> rather then the more natural:
>    Template( file='templates/template.kid )
> this should find the 'templates' directory in the same directory as 
> the running script
>
> 2) I have to fully qualify imports from the document root, as the 
> document root is added to sys.modules, but the current directory is 
> not. So, if I'm in a subdirectory under the document root I have to do:
>    import project_dir.subpackage.module
> when the current directory is 'project_dir'. This is silly, I should 
> be able to import something in, or under, the current working directory:
>    import subpackage.module
> I would have to do some hack involving seperating the dirname of 
> __file__ and adding it to sys.modules
>
> Sean
>
>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
>

From grahamd at dscpl.com.au  Fri Jan 27 16:04:14 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Fri Jan 27 16:04:28 2006
Subject: [mod_python] Current Working Directory not set?
In-Reply-To: <43DA7A37.5050500@barriescene.com>
References: <43DA7A37.5050500@barriescene.com>
Message-ID: <9dc573c399ce80c60a509e49a652f997@dscpl.com.au>


On 28/01/2006, at 6:53 AM, Sean Jamieson wrote:

> Hello everybody,
> I don't know if there's already been a discussion about this, it seems 
> like a small but obvious issue.

Many times. ;-)

> The current working directory does not apear to be set when a 
> mod_python.publisher script runs; or rather it's set to "/" which is 
> not useful. This becomes quite a pain, as I'm forced to do many things 
> to work around it.

As someone else said, working directory can't be changed because of 
multithreading
abilities of mod_python.

> i.e.
> 1) I've started using kid templates, and I have to use:
>     Template( file=req.document_root().'template.kid', ... )
> or
>    Template( 
> file=req.document_root().'project_dir/templates/template.kid', ... )
> rather then the more natural:
>    Template( file='templates/template.kid )
> this should find the 'templates' directory in the same directory as 
> the running script

Don't use req.document_root(). Instead, in that specific Python code 
file,
include at global scope:

   import os
   __here__ = os.path.dirname(__file__)
   __templates__ = os.path.join(__here__,"templates")

That will give you the directory that file is located in, in a handy 
variable
which you can then use.

     Template( file=os.path.join(__templates__,"template.kid") )

This is only useful though if all your publisher handlers are in the 
one directory.
If you have stuff spread over subdirectories, you start having to use 
relative
paths as appropriate in subdirectory handler files.

   import os
   __here__ = os.path.dirname(__file__)
   __templates__ = os.path.join(__here__,"..","templates")

Thus, you may be better off doing something like:

   def _templates(req,path):
     return os.path.join(req.hlist.directory,"templates",path)

   ...

     Template( file=_template("template.kid") )

The req.hlist.directory variable will be set to the directory for which 
PythonHandler
is specified, thus giving you a root anchor point which you can use to 
describe all
paths relative to. Doing this means you have more flexibility as far as 
moving code
files around between directories without having to modify code.

The other reference point you might use is:

   def _templates(req,path):
     directory = os.path.dirname(req.filename)
     return os.path.join(directory,path)

   ...

     Template( file=_template("templates/template.kid") )

The req.filename object is similar to using __file__ for most cases, 
but getting the
information from the request object instead.

You might even create your own derived class from Kid's Template class 
so you can
pass it a 'req' object and relative template file path and have that 
derived class
constructor do the calculation of where the file is relative to 
PythonHandler root
or req.filename.

In other words, to be more transparent, the template system would need 
to know about
the environment it is used in.

> 2) I have to fully qualify imports from the document root, as the 
> document root is added to sys.modules, but the current directory is 
> not. So, if I'm in a subdirectory under the document root I have to 
> do:
>    import project_dir.subpackage.module
> when the current directory is 'project_dir'. This is silly, I should 
> be able to import something in, or under, the current working 
> directory:
>    import subpackage.module

If these packages contain reusable code used across various pages and 
don't have
actual code in them for generating pages, it is not a good idea to put 
them under
your document root. This is because with the right URL they may be able 
to be
invoked by a remote user because of publishers automatic mapping. Thus 
you need to
be very careful.

If they do contain code for generating pages, you should not be using 
"import"
to access them as at the same time they could be getting loaded by 
publisher using
a different module loading system which will cause various problems.

As suggested by someone else, look at using "apache.import_module()".

> I would have to do some hack involving seperating the dirname of 
> __file__ and adding it to sys.modules

I think you must have meant into sys.path. Same above, Modifying 
sys.path directly
in mod_python is not usually a good idea either. The use of 
PythonHandler will
automatically put that root directory in sys.path for you without 
having to resort
to using PythonPath. This all assumes you have already set PythonPath 
explicitly
and aren't using Location directive instead of Directory directive to 
specify context
in which mod_python is used.

Graham

From grahamd at dscpl.com.au  Fri Jan 27 16:10:30 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Fri Jan 27 16:10:46 2006
Subject: [mod_python] Current Working Directory not set?
In-Reply-To: <43DA8A22.1060909@barriescene.com>
References: <43DA7A37.5050500@barriescene.com>
	<5c06fa770601271234t60e6d14s3579960884c68941@mail.gmail.com>
	<43DA8A22.1060909@barriescene.com>
Message-ID: <3ec037a68a145a697aad395cbe2ff581@dscpl.com.au>


On 28/01/2006, at 8:01 AM, Sean Jamieson wrote:

> Thanks for the quick response Deron.
>
> Disreguarding the apache issue, what would be the problem with the 
> working directory being set for publisher scripts? personally I'd 
> expect to be able to refernce files relative to the script's 
> directory.
> I understand that for generaic handlers this wouldn't quite make 
> sense; but for publisher and PSP (I don't know if its an issue for 
> PSP, as I don't use it), it makes sense to me.
>
> Any clarifiction would be appreciated.

You can't change the working directory full stop, even with publisher.

In a multithread MPM (default on Win32, optional on UNIX), distinct 
requests
arriving at the same time are handled in different threads. If each 
thread
needed to change the working directory they would interfere with each 
other
and could change the working directory when the other thread is 
expecting it
to be some other value. The only way around this is to acquire a thread 
lock
for the whole time of handling a request, which means that all requests 
are
serialised, which is going to slow your web server done in terms of how 
many
requests it can handle.

BTW, no major web framework (Python or otherwise) that I know of 
changes the
current working directory to specific values just for the period of a 
single
request. I know that CGI does and thus mod_python cgihandler does, but 
it
uses the lock above as described, which has the problems as described. 
The
CGI case shouldn't be used as a guide of what is good though.

Graham

> Deron Meranda wrote:
>
>> There are two problems with having the working directory set like you 
>> want
>>
>> 1. URLs don't have to map to actual directories (and many mod_python
>> users depend on this)
>>
>> 2. The working directory is a process attribute.  Changing it would
>> cause all kinds of problems in a multithreaded environment (depending
>> on your Apache MPM)
>>
>> Generally, you should either set your PythonPath, or expect to deal
>> with absolute pathnames or other such games.
>>
>> You may also want to look at the mod_python import_module() function,
>> which lets you specify a path.  Also the request member req.filename
>> may be useful to you was well.
>> --
>> Deron Meranda
>>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python

From grahamd at dscpl.com.au  Fri Jan 27 16:13:17 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Fri Jan 27 16:13:26 2006
Subject: [mod_python] Current Working Directory not set?
In-Reply-To: <9dc573c399ce80c60a509e49a652f997@dscpl.com.au>
References: <43DA7A37.5050500@barriescene.com>
	<9dc573c399ce80c60a509e49a652f997@dscpl.com.au>
Message-ID: <5c1d54ceebe78071c85ef7568a233cdc@dscpl.com.au>


On 28/01/2006, at 8:04 AM, Graham Dumpleton wrote:
>> I would have to do some hack involving seperating the dirname of 
>> __file__ and adding it to sys.modules
>
> I think you must have meant into sys.path. Same above, Modifying 
> sys.path directly
> in mod_python is not usually a good idea either. The use of 
> PythonHandler will
> automatically put that root directory in sys.path for you without 
> having to resort
> to using PythonPath. This all assumes you have already set PythonPath 
> explicitly
> and aren't using Location directive instead of Directory directive to 
> specify context
> in which mod_python is used.

I did it again. :-(

That should have read:

   This all assumes you have already NOT set PythonPath explicitly
   and aren't using Location directive instead of Directory directive to 
specify context
   in which mod_python is used.

Graham

From sean at barriescene.com  Fri Jan 27 17:41:15 2006
From: sean at barriescene.com (Sean Jamieson)
Date: Fri Jan 27 17:41:22 2006
Subject: [mod_python] Current Working Directory not set?
In-Reply-To: <9dc573c399ce80c60a509e49a652f997@dscpl.com.au>
References: <43DA7A37.5050500@barriescene.com>
	<9dc573c399ce80c60a509e49a652f997@dscpl.com.au>
Message-ID: <43DAA18B.2000207@barriescene.com>

Thanks for all the options Graham.

I've come up with the following code template, if anyone see anything 
obviously wrong/bad please let me know:
import os
import sys
from mod_python import apache, util
from kid import Template

# this file's current directory
__dir__ = os.path.dirname( __file__ )

# set the templates path under this file's directory
__templates__ = os.path.join( __dir__, "templates" )

def index( req ): _page='index'
    req.content_type = 'text/html'
    ## function body ##
    return Template( file=os.path.join( __templates__, '%s_%s.kid' % 
(__name__, _page) ), **vars() )


I'm expecting someone might say something about my use of **vars().
The overall result of my return Template(..) statement is that it will 
match [script's dir]/templates/[script name]_[function name].kid

Comments?

Sean

Graham Dumpleton wrote:

>
> On 28/01/2006, at 6:53 AM, Sean Jamieson wrote:
>
>> Hello everybody,
>> I don't know if there's already been a discussion about this, it 
>> seems like a small but obvious issue.
>
>
> Many times. ;-)
>
>> The current working directory does not apear to be set when a 
>> mod_python.publisher script runs; or rather it's set to "/" which is 
>> not useful. This becomes quite a pain, as I'm forced to do many 
>> things to work around it.
>
>
> As someone else said, working directory can't be changed because of 
> multithreading
> abilities of mod_python.
>
>> i.e.
>> 1) I've started using kid templates, and I have to use:
>>     Template( file=req.document_root().'template.kid', ... )
>> or
>>    Template( 
>> file=req.document_root().'project_dir/templates/template.kid', ... )
>> rather then the more natural:
>>    Template( file='templates/template.kid )
>> this should find the 'templates' directory in the same directory as 
>> the running script
>
>
> Don't use req.document_root(). Instead, in that specific Python code 
> file,
> include at global scope:
>
>   import os
>   __here__ = os.path.dirname(__file__)
>   __templates__ = os.path.join(__here__,"templates")
>
> That will give you the directory that file is located in, in a handy 
> variable
> which you can then use.
>
>     Template( file=os.path.join(__templates__,"template.kid") )
>
> This is only useful though if all your publisher handlers are in the 
> one directory.
> If you have stuff spread over subdirectories, you start having to use 
> relative
> paths as appropriate in subdirectory handler files.
>
>   import os
>   __here__ = os.path.dirname(__file__)
>   __templates__ = os.path.join(__here__,"..","templates")
>
> Thus, you may be better off doing something like:
>
>   def _templates(req,path):
>     return os.path.join(req.hlist.directory,"templates",path)
>
>   ...
>
>     Template( file=_template("template.kid") )
>
> The req.hlist.directory variable will be set to the directory for 
> which PythonHandler
> is specified, thus giving you a root anchor point which you can use to 
> describe all
> paths relative to. Doing this means you have more flexibility as far 
> as moving code
> files around between directories without having to modify code.
>
> The other reference point you might use is:
>
>   def _templates(req,path):
>     directory = os.path.dirname(req.filename)
>     return os.path.join(directory,path)
>
>   ...
>
>     Template( file=_template("templates/template.kid") )
>
> The req.filename object is similar to using __file__ for most cases, 
> but getting the
> information from the request object instead.
>
> You might even create your own derived class from Kid's Template class 
> so you can
> pass it a 'req' object and relative template file path and have that 
> derived class
> constructor do the calculation of where the file is relative to 
> PythonHandler root
> or req.filename.
>
> In other words, to be more transparent, the template system would need 
> to know about
> the environment it is used in.
>
>> 2) I have to fully qualify imports from the document root, as the 
>> document root is added to sys.modules, but the current directory is 
>> not. So, if I'm in a subdirectory under the document root I have to do:
>>    import project_dir.subpackage.module
>> when the current directory is 'project_dir'. This is silly, I should 
>> be able to import something in, or under, the current working directory:
>>    import subpackage.module
>
>
> If these packages contain reusable code used across various pages and 
> don't have
> actual code in them for generating pages, it is not a good idea to put 
> them under
> your document root. This is because with the right URL they may be 
> able to be
> invoked by a remote user because of publishers automatic mapping. Thus 
> you need to
> be very careful.
>
> If they do contain code for generating pages, you should not be using 
> "import"
> to access them as at the same time they could be getting loaded by 
> publisher using
> a different module loading system which will cause various problems.
>
> As suggested by someone else, look at using "apache.import_module()".
>
>> I would have to do some hack involving seperating the dirname of 
>> __file__ and adding it to sys.modules
>
>
> I think you must have meant into sys.path. Same above, Modifying 
> sys.path directly
> in mod_python is not usually a good idea either. The use of 
> PythonHandler will
> automatically put that root directory in sys.path for you without 
> having to resort
> to using PythonPath. This all assumes you have already set PythonPath 
> explicitly
> and aren't using Location directive instead of Directory directive to 
> specify context
> in which mod_python is used.
>
> Graham
>
>
>

From sean at barriescene.com  Fri Jan 27 17:48:13 2006
From: sean at barriescene.com (Sean Jamieson)
Date: Fri Jan 27 17:48:17 2006
Subject: [mod_python] Current Working Directory not set?
In-Reply-To: <43DAA18B.2000207@barriescene.com>
References: <43DA7A37.5050500@barriescene.com>	<9dc573c399ce80c60a509e49a652f997@dscpl.com.au>
	<43DAA18B.2000207@barriescene.com>
Message-ID: <43DAA32D.9090001@barriescene.com>

...and I completely forgot about decorators, I'm going to come up with 
something later, to make this more sane using a decorator.


Sean Jamieson wrote:

> Thanks for all the options Graham.
>
> I've come up with the following code template, if anyone see anything 
> obviously wrong/bad please let me know:
> import os
> import sys
> from mod_python import apache, util
> from kid import Template
>
> # this file's current directory
> __dir__ = os.path.dirname( __file__ )
>
> # set the templates path under this file's directory
> __templates__ = os.path.join( __dir__, "templates" )
>
> def index( req ): _page='index'
>    req.content_type = 'text/html'
>    ## function body ##
>    return Template( file=os.path.join( __templates__, '%s_%s.kid' % 
> (__name__, _page) ), **vars() )
>
>
> I'm expecting someone might say something about my use of **vars().
> The overall result of my return Template(..) statement is that it will 
> match [script's dir]/templates/[script name]_[function name].kid
>
> Comments?
>
> Sean
>
> Graham Dumpleton wrote:
>
>>
>> On 28/01/2006, at 6:53 AM, Sean Jamieson wrote:
>>
>>> Hello everybody,
>>> I don't know if there's already been a discussion about this, it 
>>> seems like a small but obvious issue.
>>
>>
>>
>> Many times. ;-)
>>
>>> The current working directory does not apear to be set when a 
>>> mod_python.publisher script runs; or rather it's set to "/" which is 
>>> not useful. This becomes quite a pain, as I'm forced to do many 
>>> things to work around it.
>>
>>
>>
>> As someone else said, working directory can't be changed because of 
>> multithreading
>> abilities of mod_python.
>>
>>> i.e.
>>> 1) I've started using kid templates, and I have to use:
>>>     Template( file=req.document_root().'template.kid', ... )
>>> or
>>>    Template( 
>>> file=req.document_root().'project_dir/templates/template.kid', ... )
>>> rather then the more natural:
>>>    Template( file='templates/template.kid )
>>> this should find the 'templates' directory in the same directory as 
>>> the running script
>>
>>
>>
>> Don't use req.document_root(). Instead, in that specific Python code 
>> file,
>> include at global scope:
>>
>>   import os
>>   __here__ = os.path.dirname(__file__)
>>   __templates__ = os.path.join(__here__,"templates")
>>
>> That will give you the directory that file is located in, in a handy 
>> variable
>> which you can then use.
>>
>>     Template( file=os.path.join(__templates__,"template.kid") )
>>
>> This is only useful though if all your publisher handlers are in the 
>> one directory.
>> If you have stuff spread over subdirectories, you start having to use 
>> relative
>> paths as appropriate in subdirectory handler files.
>>
>>   import os
>>   __here__ = os.path.dirname(__file__)
>>   __templates__ = os.path.join(__here__,"..","templates")
>>
>> Thus, you may be better off doing something like:
>>
>>   def _templates(req,path):
>>     return os.path.join(req.hlist.directory,"templates",path)
>>
>>   ...
>>
>>     Template( file=_template("template.kid") )
>>
>> The req.hlist.directory variable will be set to the directory for 
>> which PythonHandler
>> is specified, thus giving you a root anchor point which you can use 
>> to describe all
>> paths relative to. Doing this means you have more flexibility as far 
>> as moving code
>> files around between directories without having to modify code.
>>
>> The other reference point you might use is:
>>
>>   def _templates(req,path):
>>     directory = os.path.dirname(req.filename)
>>     return os.path.join(directory,path)
>>
>>   ...
>>
>>     Template( file=_template("templates/template.kid") )
>>
>> The req.filename object is similar to using __file__ for most cases, 
>> but getting the
>> information from the request object instead.
>>
>> You might even create your own derived class from Kid's Template 
>> class so you can
>> pass it a 'req' object and relative template file path and have that 
>> derived class
>> constructor do the calculation of where the file is relative to 
>> PythonHandler root
>> or req.filename.
>>
>> In other words, to be more transparent, the template system would 
>> need to know about
>> the environment it is used in.
>>
>>> 2) I have to fully qualify imports from the document root, as the 
>>> document root is added to sys.modules, but the current directory is 
>>> not. So, if I'm in a subdirectory under the document root I have to do:
>>>    import project_dir.subpackage.module
>>> when the current directory is 'project_dir'. This is silly, I should 
>>> be able to import something in, or under, the current working 
>>> directory:
>>>    import subpackage.module
>>
>>
>>
>> If these packages contain reusable code used across various pages and 
>> don't have
>> actual code in them for generating pages, it is not a good idea to 
>> put them under
>> your document root. This is because with the right URL they may be 
>> able to be
>> invoked by a remote user because of publishers automatic mapping. 
>> Thus you need to
>> be very careful.
>>
>> If they do contain code for generating pages, you should not be using 
>> "import"
>> to access them as at the same time they could be getting loaded by 
>> publisher using
>> a different module loading system which will cause various problems.
>>
>> As suggested by someone else, look at using "apache.import_module()".
>>
>>> I would have to do some hack involving seperating the dirname of 
>>> __file__ and adding it to sys.modules
>>
>>
>>
>> I think you must have meant into sys.path. Same above, Modifying 
>> sys.path directly
>> in mod_python is not usually a good idea either. The use of 
>> PythonHandler will
>> automatically put that root directory in sys.path for you without 
>> having to resort
>> to using PythonPath. This all assumes you have already set PythonPath 
>> explicitly
>> and aren't using Location directive instead of Directory directive to 
>> specify context
>> in which mod_python is used.
>>
>> Graham
>>
>>
>>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
>

From sean at barriescene.com  Fri Jan 27 20:42:26 2006
From: sean at barriescene.com (Sean Jamieson)
Date: Fri Jan 27 20:42:31 2006
Subject: [mod_python] kid template decorator [prev: Current Working Directory
	not set?]
In-Reply-To: <43DAA32D.9090001@barriescene.com>
References: <43DA7A37.5050500@barriescene.com>	<9dc573c399ce80c60a509e49a652f997@dscpl.com.au>	<43DAA18B.2000207@barriescene.com>
	<43DAA32D.9090001@barriescene.com>
Message-ID: <43DACC02.7040508@barriescene.com>

OK, so here is my decorator solution:

# @template decorator
def template( relpath = 'templates', template=None, abspath=None ):
    def decor( func ):
        if abspath:
            path = abspath
        else:
            path = os.path.join( os.path.dirname( __file__ ), relpath )
        if template:
            path = os.path.join( path, template )
        else:
            path = os.path.join( path, '%s_%s.kid' % 
(func.__module__.split('.')[-1], func.func_name) )
        def template_wrapper( *args, **kwargs ):
            kwargs['req'].content_type = 'text/html'
            values = func( *args, **kwargs )
            return Template( file=path, **values )
        # just so debug output makes sense
        template_wrapper.func_name = '%s(%s)' % ( 
template_wrapper.func_name, func.func_name )
        return template_wrapper
    return decor

@template()
def index( req ):
    title = 'some title'
    message = 'Keep it simple, stupid.'
    return vars()

... or something like that...

Comments?

Sean

Sean Jamieson wrote:

> ...and I completely forgot about decorators, I'm going to come up with 
> something later, to make this more sane using a decorator.
>
>
> Sean Jamieson wrote:
>
>> Thanks for all the options Graham.
>>
>> I've come up with the following code template, if anyone see anything 
>> obviously wrong/bad please let me know:
>> import os
>> import sys
>> from mod_python import apache, util
>> from kid import Template
>>
>> # this file's current directory
>> __dir__ = os.path.dirname( __file__ )
>>
>> # set the templates path under this file's directory
>> __templates__ = os.path.join( __dir__, "templates" )
>>
>> def index( req ): _page='index'
>>    req.content_type = 'text/html'
>>    ## function body ##
>>    return Template( file=os.path.join( __templates__, '%s_%s.kid' % 
>> (__name__, _page) ), **vars() )
>>
>>
>> I'm expecting someone might say something about my use of **vars().
>> The overall result of my return Template(..) statement is that it 
>> will match [script's dir]/templates/[script name]_[function name].kid
>>
>> Comments?
>>
>> Sean
>>
>> Graham Dumpleton wrote:
>>
>>>
>>> On 28/01/2006, at 6:53 AM, Sean Jamieson wrote:
>>>
>>>> Hello everybody,
>>>> I don't know if there's already been a discussion about this, it 
>>>> seems like a small but obvious issue.
>>>
>>>
>>>
>>>
>>> Many times. ;-)
>>>
>>>> The current working directory does not apear to be set when a 
>>>> mod_python.publisher script runs; or rather it's set to "/" which 
>>>> is not useful. This becomes quite a pain, as I'm forced to do many 
>>>> things to work around it.
>>>
>>>
>>>
>>>
>>> As someone else said, working directory can't be changed because of 
>>> multithreading
>>> abilities of mod_python.
>>>
>>>> i.e.
>>>> 1) I've started using kid templates, and I have to use:
>>>>     Template( file=req.document_root().'template.kid', ... )
>>>> or
>>>>    Template( 
>>>> file=req.document_root().'project_dir/templates/template.kid', ... )
>>>> rather then the more natural:
>>>>    Template( file='templates/template.kid )
>>>> this should find the 'templates' directory in the same directory as 
>>>> the running script
>>>
>>>
>>>
>>>
>>> Don't use req.document_root(). Instead, in that specific Python code 
>>> file,
>>> include at global scope:
>>>
>>>   import os
>>>   __here__ = os.path.dirname(__file__)
>>>   __templates__ = os.path.join(__here__,"templates")
>>>
>>> That will give you the directory that file is located in, in a handy 
>>> variable
>>> which you can then use.
>>>
>>>     Template( file=os.path.join(__templates__,"template.kid") )
>>>
>>> This is only useful though if all your publisher handlers are in the 
>>> one directory.
>>> If you have stuff spread over subdirectories, you start having to 
>>> use relative
>>> paths as appropriate in subdirectory handler files.
>>>
>>>   import os
>>>   __here__ = os.path.dirname(__file__)
>>>   __templates__ = os.path.join(__here__,"..","templates")
>>>
>>> Thus, you may be better off doing something like:
>>>
>>>   def _templates(req,path):
>>>     return os.path.join(req.hlist.directory,"templates",path)
>>>
>>>   ...
>>>
>>>     Template( file=_template("template.kid") )
>>>
>>> The req.hlist.directory variable will be set to the directory for 
>>> which PythonHandler
>>> is specified, thus giving you a root anchor point which you can use 
>>> to describe all
>>> paths relative to. Doing this means you have more flexibility as far 
>>> as moving code
>>> files around between directories without having to modify code.
>>>
>>> The other reference point you might use is:
>>>
>>>   def _templates(req,path):
>>>     directory = os.path.dirname(req.filename)
>>>     return os.path.join(directory,path)
>>>
>>>   ...
>>>
>>>     Template( file=_template("templates/template.kid") )
>>>
>>> The req.filename object is similar to using __file__ for most cases, 
>>> but getting the
>>> information from the request object instead.
>>>
>>> You might even create your own derived class from Kid's Template 
>>> class so you can
>>> pass it a 'req' object and relative template file path and have that 
>>> derived class
>>> constructor do the calculation of where the file is relative to 
>>> PythonHandler root
>>> or req.filename.
>>>
>>> In other words, to be more transparent, the template system would 
>>> need to know about
>>> the environment it is used in.
>>>
>>>> 2) I have to fully qualify imports from the document root, as the 
>>>> document root is added to sys.modules, but the current directory is 
>>>> not. So, if I'm in a subdirectory under the document root I have to 
>>>> do:
>>>>    import project_dir.subpackage.module
>>>> when the current directory is 'project_dir'. This is silly, I 
>>>> should be able to import something in, or under, the current 
>>>> working directory:
>>>>    import subpackage.module
>>>
>>>
>>>
>>>
>>> If these packages contain reusable code used across various pages 
>>> and don't have
>>> actual code in them for generating pages, it is not a good idea to 
>>> put them under
>>> your document root. This is because with the right URL they may be 
>>> able to be
>>> invoked by a remote user because of publishers automatic mapping. 
>>> Thus you need to
>>> be very careful.
>>>
>>> If they do contain code for generating pages, you should not be 
>>> using "import"
>>> to access them as at the same time they could be getting loaded by 
>>> publisher using
>>> a different module loading system which will cause various problems.
>>>
>>> As suggested by someone else, look at using "apache.import_module()".
>>>
>>>> I would have to do some hack involving seperating the dirname of 
>>>> __file__ and adding it to sys.modules
>>>
>>>
>>>
>>>
>>> I think you must have meant into sys.path. Same above, Modifying 
>>> sys.path directly
>>> in mod_python is not usually a good idea either. The use of 
>>> PythonHandler will
>>> automatically put that root directory in sys.path for you without 
>>> having to resort
>>> to using PythonPath. This all assumes you have already set 
>>> PythonPath explicitly
>>> and aren't using Location directive instead of Directory directive 
>>> to specify context
>>> in which mod_python is used.
>>>
>>> Graham
>>>
>>>
>>>
>>
>> _______________________________________________
>> Mod_python mailing list
>> Mod_python@modpython.org
>> http://mailman.modpython.org/mailman/listinfo/mod_python
>>
>>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
>

From wouter at squirrel-systems.com  Fri Jan 27 21:53:31 2006
From: wouter at squirrel-systems.com (Wouter van Marle)
Date: Fri Jan 27 21:53:41 2006
Subject: [mod_python] Cookie problems
In-Reply-To: <43DA53DB.3060605@jgassociates.ca>
References: <1138343930.21701.62.camel@pistachio.squirrel>
	<43DA3D80.3000102@jgassociates.ca>
	<1138379179.7411.17.camel@cm222-167-159-88.hkcable.com.hk>
	<43DA53DB.3060605@jgassociates.ca>
Message-ID: <1138416811.7411.21.camel@cm222-167-159-88.hkcable.com.hk>

On Fri, 2006-01-27 at 12:09 -0500, Jim Gallacher wrote:

> > Mmmm well I'm testing it with the variables as given above, that
> failed.
> > I just found that using {'a': 'a'*44} is the maximum I can get
> through.
> > Much smaller than on your side, very strange.
> 
> Very strange indeed. There is nothing in Cookie.py that would
> truncate 
> the value that is used for the Set-Cookie header so I don't see how
> that 
> could be a problem. What happens if you try setting some other
> response 
> header such as content_type with a long value? You can use 
> httpLiveHeaders or wget to see what the server sends.


I have httpLiveheaders installed; the problem appears to be on the
sending side already. The set-cookie is equal to the cookie returned.

Wouter.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20060128/fca58c9c/attachment-0001.html
From wouter at squirrel-systems.com  Fri Jan 27 21:55:24 2006
From: wouter at squirrel-systems.com (Wouter van Marle)
Date: Fri Jan 27 21:55:27 2006
Subject: [mod_python] Cookie problems
In-Reply-To: <43DA5F9E.8020006@barriescene.com>
References: <1138343930.21701.62.camel@pistachio.squirrel>
	<43DA5F9E.8020006@barriescene.com>
Message-ID: <1138416924.7411.24.camel@cm222-167-159-88.hkcable.com.hk>

On Fri, 2006-01-27 at 12:59 -0500, Sean Jamieson wrote:

> First, there cookies are supposed to be limited to 1 or 2KB MAX, this 
> limit is enfoced by the browser, and therefore very subjective. You 
> should not expect to be able to set more than 2kb for the entire set
> of 
> cookies. If you are able to see more, then its the browser being 
> non-standard :-)


Sounds like a troll... but I'll bite.
1) the cookie I sent consists of three small values. A couple dozen
bytes at most.
2) I'm using Mozilla. I'm not worried about being non-standard in that.
Same problem I've encountered with Safari.

Wouter.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20060128/58c96ef5/attachment.html
From nicolas.lehuen at gmail.com  Sat Jan 28 04:50:41 2006
From: nicolas.lehuen at gmail.com (Nicolas Lehuen)
Date: Sat Jan 28 04:50:45 2006
Subject: [mod_python] kid template decorator [prev: Current Working
	Directory not set?]
In-Reply-To: <c298f2d70601280150o3a4004b1i@mail.gmail.com>
References: <43DA7A37.5050500@barriescene.com>
	<9dc573c399ce80c60a509e49a652f997@dscpl.com.au>
	<43DAA18B.2000207@barriescene.com> <43DAA32D.9090001@barriescene.com>
	<43DACC02.7040508@barriescene.com>
	<c298f2d70601280150o3a4004b1i@mail.gmail.com>
Message-ID: <c298f2d70601280150j58153b9fq@mail.gmail.com>

Hi,

I'm using something similar with a custom-made templating system
(which looks a bit like Velocity).

I have used req.filename rather than __file__ to get the path of the
file requested, because the decorator function is stored in a separate
library module, which means that __file__ always return the path to
the library module and not the path to the published module.

One could also use stack inspection to get the proper path but
req.filename is quite reliable as far as the publisher is concerned.

Just a small detail : you can test whether a path is absolute or
relative thanks to os.path.isabs, so you can only provide one path
parameter and let Python decide of its relativeness.

Regards,
Nicolas

2006/1/28, Sean Jamieson <sean@barriescene.com>:
> OK, so here is my decorator solution:
>
> # @template decorator
> def template( relpath = 'templates', template=None, abspath=None ):
>     def decor( func ):
>         if abspath:
>             path = abspath
>         else:
>             path = os.path.join( os.path.dirname( __file__ ), relpath )
>         if template:
>             path = os.path.join( path, template )
>         else:
>             path = os.path.join( path, '%s_%s.kid' %
> (func.__module__.split('.')[-1], func.func_name) )
>         def template_wrapper( *args, **kwargs ):
>             kwargs['req'].content_type = 'text/html'
>             values = func( *args, **kwargs )
>             return Template( file=path, **values )
>         # just so debug output makes sense
>         template_wrapper.func_name = '%s(%s)' % (
> template_wrapper.func_name, func.func_name )
>         return template_wrapper
>     return decor
>
> @template()
> def index( req ):
>     title = 'some title'
>     message = 'Keep it simple, stupid.'
>     return vars()
>
> ... or something like that...
>
> Comments?
>
> Sean

From nicolas.lehuen at gmail.com  Sat Jan 28 04:57:53 2006
From: nicolas.lehuen at gmail.com (Nicolas Lehuen)
Date: Sat Jan 28 04:57:56 2006
Subject: [mod_python] kid template decorator [prev: Current Working
	Directory not set?]
In-Reply-To: <c298f2d70601280150j58153b9fq@mail.gmail.com>
References: <43DA7A37.5050500@barriescene.com>
	<9dc573c399ce80c60a509e49a652f997@dscpl.com.au>
	<43DAA18B.2000207@barriescene.com> <43DAA32D.9090001@barriescene.com>
	<43DACC02.7040508@barriescene.com>
	<c298f2d70601280150o3a4004b1i@mail.gmail.com>
	<c298f2d70601280150j58153b9fq@mail.gmail.com>
Message-ID: <c298f2d70601280157jb853a20n@mail.gmail.com>

One last thing my decorator does is set the content-type header based
on the template name. My templates are all named whatever.tmpl.txt or
whatever.tmpl.html, so that :

1) The templates can reside in the same directory as the controllers
and still be denied access thanks to a regexp-based FilesMatch rule in
the .htaccess file.
2) The fact that controllers and decorators reside in the same
directory simplifies path management (I don't give any relative path
to find the template). Granted, it can be a bit of a mess for
application with a great number of templates, so in that case I have a
dedicated templates directory.
2) The decorator can set the content-type based on the extension of
the template, thanks to the standard mimetypes.guess_type function.

Regards,
Nicolas

2006/1/28, Nicolas Lehuen <nicolas.lehuen@gmail.com>:
> Hi,
>
> I'm using something similar with a custom-made templating system
> (which looks a bit like Velocity).
>
> I have used req.filename rather than __file__ to get the path of the
> file requested, because the decorator function is stored in a separate
> library module, which means that __file__ always return the path to
> the library module and not the path to the published module.
>
> One could also use stack inspection to get the proper path but
> req.filename is quite reliable as far as the publisher is concerned.
>
> Just a small detail : you can test whether a path is absolute or
> relative thanks to os.path.isabs, so you can only provide one path
> parameter and let Python decide of its relativeness.
>
> Regards,
> Nicolas
>
> 2006/1/28, Sean Jamieson <sean@barriescene.com>:
> > OK, so here is my decorator solution:
> >
> > # @template decorator
> > def template( relpath = 'templates', template=None, abspath=None ):
> >     def decor( func ):
> >         if abspath:
> >             path = abspath
> >         else:
> >             path = os.path.join( os.path.dirname( __file__ ), relpath )
> >         if template:
> >             path = os.path.join( path, template )
> >         else:
> >             path = os.path.join( path, '%s_%s.kid' %
> > (func.__module__.split('.')[-1], func.func_name) )
> >         def template_wrapper( *args, **kwargs ):
> >             kwargs['req'].content_type = 'text/html'
> >             values = func( *args, **kwargs )
> >             return Template( file=path, **values )
> >         # just so debug output makes sense
> >         template_wrapper.func_name = '%s(%s)' % (
> > template_wrapper.func_name, func.func_name )
> >         return template_wrapper
> >     return decor
> >
> > @template()
> > def index( req ):
> >     title = 'some title'
> >     message = 'Keep it simple, stupid.'
> >     return vars()
> >
> > ... or something like that...
> >
> > Comments?
> >
> > Sean
>

From dworley at communityconnect.com  Sat Jan 28 15:36:16 2006
From: dworley at communityconnect.com (David Worley)
Date: Sat Jan 28 15:36:20 2006
Subject: [mod_python] string manipulation
Message-ID: <EE702CA684057843958BF6CE882E9101EFE841@cci019.hq.communityconnect.com>

OK, I'm stumped.

I'm trying to find newline characters (\n, specifically) that are NOT in comments.

So, for example (where "<-" = a newline character):
==========================================
1: <-
2: /*<-
3: ----------------------<-
4:     comment<-
5: ----------------------<-
6: */<-
7: <-
8: CODE CODE CODE<-
9: <-
==========================================

I want to return the newline characters at lines 1, 6, 7, 8, and 9 but NOT the others.

I've tried using regular expressions but I dislike them because they aren't immediately readable (and also I don't bloody understand the things). I'm not opposed to using them, though, if they provide a solution to this problem!

Thanks in advance for any suggestions anyone can provide.

- Dave

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20060128/0fdeaa27/attachment.html
From nicolas.lehuen at gmail.com  Sat Jan 28 15:43:45 2006
From: nicolas.lehuen at gmail.com (Nicolas Lehuen)
Date: Sat Jan 28 15:43:49 2006
Subject: [mod_python] string manipulation
In-Reply-To: <EE702CA684057843958BF6CE882E9101EFE841@cci019.hq.communityconnect.com>
References: <EE702CA684057843958BF6CE882E9101EFE841@cci019.hq.communityconnect.com>
Message-ID: <c298f2d70601281243hbcb9bfdj@mail.gmail.com>

Hi David,

That is the kind of question you can ask on comp.lang.python and get a
dozen different answers in a matter of minutes.

Not sure it belongs here, though.

Regards,
Nicolas

2006/1/28, David Worley <dworley@communityconnect.com>:
>
>
> OK, I'm stumped.
>
>  I'm trying to find newline characters (\n, specifically) that are NOT in
> comments.
>
>  So, for example (where "<-" = a newline character):
>  ==========================================
>  1: <-
>  2: /*<-
>  3: ----------------------<-
>  4:     comment<-
>  5: ----------------------<-
>  6: */<-
>  7: <-
>  8: CODE CODE CODE<-
>  9: <-
>  ==========================================
>
>  I want to return the newline characters at lines 1, 6, 7, 8, and 9 but NOT
> the others.
>
>  I've tried using regular expressions but I dislike them because they aren't
> immediately readable (and also I don't bloody understand the things). I'm
> not opposed to using them, though, if they provide a solution to this
> problem!
>
>  Thanks in advance for any suggestions anyone can provide.
>
>  - Dave
>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
>
>

From sean at barriescene.com  Sat Jan 28 17:13:27 2006
From: sean at barriescene.com (Sean Jamieson)
Date: Sat Jan 28 17:13:37 2006
Subject: [mod_python] kid template decorator [prev: Current Working
	Directory not set?]
In-Reply-To: <c298f2d70601280157jb853a20n@mail.gmail.com>
References: <43DA7A37.5050500@barriescene.com>	
	<9dc573c399ce80c60a509e49a652f997@dscpl.com.au>	
	<43DAA18B.2000207@barriescene.com>
	<43DAA32D.9090001@barriescene.com>	
	<43DACC02.7040508@barriescene.com>	
	<c298f2d70601280150o3a4004b1i@mail.gmail.com>	
	<c298f2d70601280150j58153b9fq@mail.gmail.com>
	<c298f2d70601280157jb853a20n@mail.gmail.com>
Message-ID: <43DBEC87.30603@barriescene.com>

OK, taking your suggestions into account, here is my current version:

import os
from kid import Template
# @template decorator
def template( path = 'templates', template=None, ctype='text/html' ):
    def decor( func, path=path ):
        if not os.path.isabs( path ):
            path = os.path.join( os.path.dirname( 
func.func_globals['__file__'] ), path )
        if template:
            path = os.path.join( path, template )
        else:
            path = os.path.join( path, '%s_%s.kid' % 
(func.__module__.split('.')[-1], func.func_name) )
        def template_wrapper( *args, **kwargs ):
            kwargs['req'].content_type = ctype
            values = func( *args, **kwargs )
            return Template( file=path, **values )
        # copy func's attributes
        template_wrapper.func_name = '%s(%s)' % ( 
template_wrapper.func_name, func.func_name )
        template_wrapper.func_dict = func.func_dict
        template_wrapper.func_doc = func.func_doc
        return template_wrapper
    return decor

I also switch from the __*__ variables to func_*

Sean

Nicolas Lehuen wrote:

>One last thing my decorator does is set the content-type header based
>on the template name. My templates are all named whatever.tmpl.txt or
>whatever.tmpl.html, so that :
>
>1) The templates can reside in the same directory as the controllers
>and still be denied access thanks to a regexp-based FilesMatch rule in
>the .htaccess file.
>2) The fact that controllers and decorators reside in the same
>directory simplifies path management (I don't give any relative path
>to find the template). Granted, it can be a bit of a mess for
>application with a great number of templates, so in that case I have a
>dedicated templates directory.
>2) The decorator can set the content-type based on the extension of
>the template, thanks to the standard mimetypes.guess_type function.
>
>Regards,
>Nicolas
>
>2006/1/28, Nicolas Lehuen <nicolas.lehuen@gmail.com>:
>  
>
>>Hi,
>>
>>I'm using something similar with a custom-made templating system
>>(which looks a bit like Velocity).
>>
>>I have used req.filename rather than __file__ to get the path of the
>>file requested, because the decorator function is stored in a separate
>>library module, which means that __file__ always return the path to
>>the library module and not the path to the published module.
>>
>>One could also use stack inspection to get the proper path but
>>req.filename is quite reliable as far as the publisher is concerned.
>>
>>Just a small detail : you can test whether a path is absolute or
>>relative thanks to os.path.isabs, so you can only provide one path
>>parameter and let Python decide of its relativeness.
>>
>>Regards,
>>Nicolas
>>
>>2006/1/28, Sean Jamieson <sean@barriescene.com>:
>>    
>>
>>>OK, so here is my decorator solution:
>>>
>>># @template decorator
>>>def template( relpath = 'templates', template=None, abspath=None ):
>>>    def decor( func ):
>>>        if abspath:
>>>            path = abspath
>>>        else:
>>>            path = os.path.join( os.path.dirname( __file__ ), relpath )
>>>        if template:
>>>            path = os.path.join( path, template )
>>>        else:
>>>            path = os.path.join( path, '%s_%s.kid' %
>>>(func.__module__.split('.')[-1], func.func_name) )
>>>        def template_wrapper( *args, **kwargs ):
>>>            kwargs['req'].content_type = 'text/html'
>>>            values = func( *args, **kwargs )
>>>            return Template( file=path, **values )
>>>        # just so debug output makes sense
>>>        template_wrapper.func_name = '%s(%s)' % (
>>>template_wrapper.func_name, func.func_name )
>>>        return template_wrapper
>>>    return decor
>>>
>>>@template()
>>>def index( req ):
>>>    title = 'some title'
>>>    message = 'Keep it simple, stupid.'
>>>    return vars()
>>>
>>>... or something like that...
>>>
>>>Comments?
>>>
>>>Sean
>>>      
>>>
From nicolas.lehuen at gmail.com  Sat Jan 28 17:15:51 2006
From: nicolas.lehuen at gmail.com (Nicolas Lehuen)
Date: Sat Jan 28 17:15:55 2006
Subject: [mod_python] kid template decorator [prev: Current Working
	Directory not set?]
In-Reply-To: <43DBEC87.30603@barriescene.com>
References: <43DA7A37.5050500@barriescene.com>
	<9dc573c399ce80c60a509e49a652f997@dscpl.com.au>
	<43DAA18B.2000207@barriescene.com> <43DAA32D.9090001@barriescene.com>
	<43DACC02.7040508@barriescene.com>
	<c298f2d70601280150o3a4004b1i@mail.gmail.com>
	<c298f2d70601280150j58153b9fq@mail.gmail.com>
	<c298f2d70601280157jb853a20n@mail.gmail.com>
	<43DBEC87.30603@barriescene.com>
Message-ID: <c298f2d70601281415h13ff857ey@mail.gmail.com>

Hi,

I haven't thought about func_globals['__file__']... Nice one !

Regards,
Nicolas

2006/1/28, Sean Jamieson <sean@barriescene.com>:
> OK, taking your suggestions into account, here is my current version:
>
> import os
> from kid import Template
> # @template decorator
> def template( path = 'templates', template=None, ctype='text/html' ):
>     def decor( func, path=path ):
>         if not os.path.isabs( path ):
>             path = os.path.join( os.path.dirname(
> func.func_globals['__file__'] ), path )
>         if template:
>             path = os.path.join( path, template )
>         else:
>             path = os.path.join( path, '%s_%s.kid' %
> (func.__module__.split('.')[-1], func.func_name) )
>         def template_wrapper( *args, **kwargs ):
>             kwargs['req'].content_type = ctype
>             values = func( *args, **kwargs )
>             return Template( file=path, **values )
>         # copy func's attributes
>         template_wrapper.func_name = '%s(%s)' % (
> template_wrapper.func_name, func.func_name )
>         template_wrapper.func_dict = func.func_dict
>         template_wrapper.func_doc = func.func_doc
>         return template_wrapper
>     return decor
>
> I also switch from the __*__ variables to func_*
>
> Sean
>
> Nicolas Lehuen wrote:
>
> >One last thing my decorator does is set the content-type header based
> >on the template name. My templates are all named whatever.tmpl.txt or
> >whatever.tmpl.html, so that :
> >
> >1) The templates can reside in the same directory as the controllers
> >and still be denied access thanks to a regexp-based FilesMatch rule in
> >the .htaccess file.
> >2) The fact that controllers and decorators reside in the same
> >directory simplifies path management (I don't give any relative path
> >to find the template). Granted, it can be a bit of a mess for
> >application with a great number of templates, so in that case I have a
> >dedicated templates directory.
> >2) The decorator can set the content-type based on the extension of
> >the template, thanks to the standard mimetypes.guess_type function.
> >
> >Regards,
> >Nicolas
> >
> >2006/1/28, Nicolas Lehuen <nicolas.lehuen@gmail.com>:
> >
> >
> >>Hi,
> >>
> >>I'm using something similar with a custom-made templating system
> >>(which looks a bit like Velocity).
> >>
> >>I have used req.filename rather than __file__ to get the path of the
> >>file requested, because the decorator function is stored in a separate
> >>library module, which means that __file__ always return the path to
> >>the library module and not the path to the published module.
> >>
> >>One could also use stack inspection to get the proper path but
> >>req.filename is quite reliable as far as the publisher is concerned.
> >>
> >>Just a small detail : you can test whether a path is absolute or
> >>relative thanks to os.path.isabs, so you can only provide one path
> >>parameter and let Python decide of its relativeness.
> >>
> >>Regards,
> >>Nicolas
> >>
> >>2006/1/28, Sean Jamieson <sean@barriescene.com>:
> >>
> >>
> >>>OK, so here is my decorator solution:
> >>>
> >>># @template decorator
> >>>def template( relpath = 'templates', template=None, abspath=None ):
> >>>    def decor( func ):
> >>>        if abspath:
> >>>            path = abspath
> >>>        else:
> >>>            path = os.path.join( os.path.dirname( __file__ ), relpath )
> >>>        if template:
> >>>            path = os.path.join( path, template )
> >>>        else:
> >>>            path = os.path.join( path, '%s_%s.kid' %
> >>>(func.__module__.split('.')[-1], func.func_name) )
> >>>        def template_wrapper( *args, **kwargs ):
> >>>            kwargs['req'].content_type = 'text/html'
> >>>            values = func( *args, **kwargs )
> >>>            return Template( file=path, **values )
> >>>        # just so debug output makes sense
> >>>        template_wrapper.func_name = '%s(%s)' % (
> >>>template_wrapper.func_name, func.func_name )
> >>>        return template_wrapper
> >>>    return decor
> >>>
> >>>@template()
> >>>def index( req ):
> >>>    title = 'some title'
> >>>    message = 'Keep it simple, stupid.'
> >>>    return vars()
> >>>
> >>>... or something like that...
> >>>
> >>>Comments?
> >>>
> >>>Sean
> >>>
> >>>
>

From scarfboy at gmail.com  Sun Jan 29 16:47:25 2006
From: scarfboy at gmail.com (Bart)
Date: Sun Jan 29 16:47:30 2006
Subject: [mod_python] Various simple questions. I hope.
Message-ID: <b71082d80601291347g1d9963b4x52c2f80990be922d@mail.gmail.com>

Hey all.

Question. When I write:
    def requesthandler(req):
        req.content_type = "text/plain"
        req.write("Hello World!")
        return apache.OK
...it returns "Hello World!0", so that style will
corrupt particularly my non-HTML data, so I don't
use it. Thing is, it's copy-pasted from 3.1(.3)
documentation and I have 3.1.4 (-r1, in gentoo).

So is this a difference between using AddHandler
python-program and AddHandler mod_python?
Or do the docs accidentally describe 3.2 or and old
version?   (I use:
  AddHandler mod_python .py
  PythonHandler mod_python.publisher
  PythonDebug On
Is this unusual?)

It also leaves me a little baffled on what I should
return from a handler function. My code works,
I just don't know whether it should be written
the way it is.

People discuss apache.OK, and the difference
between it and apache.DONE and such, so I'm
guessing this is current code - but apparently
it works differently under publisher. Or my version.


It also left me confused about how to handle
success and errors.

It seems like you're suppose to return simple ones
and raise things on specific errors when you want
apache to use its error pages - but apparently
you set req.status for other cses yet, because where
does this leave things like the 304?
I use  req.status=apache.HTTP_NOT_MODIFIED
elsewhere to handle my manual ETags on
dynamically served images. Despite me just having
read that setting req.status doesn't actually do
anything, my header snooper tells me it does in
fact work. Reading somewhere else says it works,
is the way it should work, and should probably be
followed by a return apache.DONE.
But since that doesn't seem to apply to me, what
do I do? How do I get these apache.THINGS, since
they seem to be the way thing work for other people?

Am I just missing something obvious?


Also, because of the empty-string problem,
I had to return something (I chose a space) instead of
nothing, which I'm not sure is entirely up to HTTP specs
since the RFC tells me "The 304 response MUST NOT
contain a message-body"
What's the better way of doing this?

("empty-string problem": Returning an empty string after
  writing no data leads to borking out with 500/Internal Server
  Error, and a "funtion x returned no data" error in the logs.
  I'm guessing this is accepted, or at least expected behaviour,
  though I'd prefer if that only happened on return None
  (and implicitly on a lack of a return), but not on return "")


So I suppose my real question is "Is there a nice overview
of the varying behaviour under different versions and different
PyhonHandlers, particularly the current?" Should I not be
using the publisher, since it seems to contradict the docs?


*If* I'm going to have to know a few innards to use mod_python
so be it, but right now I have a fragile environment with
no simple way of telling what'll work without testing it.

And I don't like to bug you guys too much with this sort
of "huh, what? wah!", y'know :)


Thanks for your time,
--Bart Alewijnse

From grahamd at dscpl.com.au  Sun Jan 29 17:27:12 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Sun Jan 29 17:27:16 2006
Subject: [mod_python] Various simple questions. I hope.
Message-ID: <1138573632.11048@dscpl.user.openhosting.com>

Bart wrote ..
> Hey all.
> 
> Question. When I write:
>     def requesthandler(req):
>         req.content_type = "text/plain"
>         req.write("Hello World!")
>         return apache.OK
> ...it returns "Hello World!0", so that style will
> corrupt particularly my non-HTML data, so I don't
> use it. Thing is, it's copy-pasted from 3.1(.3)
> documentation and I have 3.1.4 (-r1, in gentoo).
> 
> So is this a difference between using AddHandler
> python-program and AddHandler mod_python?
> Or do the docs accidentally describe 3.2 or and old
> version?   (I use:
>   AddHandler mod_python .py
>   PythonHandler mod_python.publisher
>   PythonDebug On
> Is this unusual?)

Using PythonHandler to specify your own handler code is different
to specifying that mod_python.publisher be used. You are programming
in the style expected where you specify your own handler code but
are using mod_python.publisher as the dispatcher and thus why the
example you copied isn't yielding the expected results.

If using mod_python.publisher, you would write the above example as:

    def requesthandler(req):
        req.content_type = "text/plain"
        return "Hello World!"

Ie., the content of the page is returned as the result. You can still use
req.write(), but whatever is returned from the function will also be
appended and why you see the extra "0" at the end. That is the value
of apache.OK converted to a string.

> It also leaves me a little baffled on what I should
> return from a handler function. My code works,
> I just don't know whether it should be written
> the way it is.
> 
> People discuss apache.OK, and the difference
> between it and apache.DONE and such, so I'm
> guessing this is current code - but apparently
> it works differently under publisher. Or my version.

If using mod_python.publisher you can largely ignore the apache.OK
and apache.DONE return statuses. Ie,. the main distinction is that for
your own handler you use req.write() and return statuses where as
if using mod_python.publisher the result of the function is the content
and you use exceptions to indicate status.

> It also left me confused about how to handle
> success and errors.
> 
> It seems like you're suppose to return simple ones
> and raise things on specific errors when you want
> apache to use its error pages

You can say:

  raise apache.HTTP_SERVER_RETURN, apache.HTTP_NOT_FOUND

when using either your own explicit handler or when using
mod_python.publisher to indicate a specific status.

If using your own explicitly handler you can also do:

  return apache.HTTP_NOT_FOUND

In both cases, Apache will construct any page to go along with that
specific error response.

> but apparently
> you set req.status for other cses yet, because where
> does this leave things like the 304?
> I use  req.status=apache.HTTP_NOT_MODIFIED
> elsewhere to handle my manual ETags on
> dynamically served images. Despite me just having
> read that setting req.status doesn't actually do
> anything, my header snooper tells me it does in
> fact work. Reading somewhere else says it works,
> is the way it should work, and should probably be
> followed by a return apache.DONE.
> But since that doesn't seem to apply to me, what
> do I do? How do I get these apache.THINGS, since
> they seem to be the way thing work for other people?

If you want to override what page is sent back by Apache with a
specific error response, you would typically use something like:

  req.status = apache.HTTP_NOT_FOUND
  req.content_type = 'text/html'
  req.write('<html>...</html>')
  raise apache.HTTP_SERVER_RETURN, apache.DONE

or if using your own explicit handler, you could also say:

  req.status = apache.HTTP_NOT_FOUND
  req.content_type = 'text/html'
  req.write('<html>...</html>')
  return apache.DONE

The value apache.DONE is used instead of apache.OK as apache.DONE
tells Apache that you have constructed the complete response and that
it shouldn't go adding any page of its own for that status type.

> Am I just missing something obvious?

You are simple mixing two different dispatch mechanisms together and
the requirements it places on you as to how to write your published
functions.

> Also, because of the empty-string problem,
> I had to return something (I chose a space) instead of
> nothing, which I'm not sure is entirely up to HTTP specs
> since the RFC tells me "The 304 response MUST NOT
> contain a message-body"
> What's the better way of doing this?
> 
> ("empty-string problem": Returning an empty string after
>   writing no data leads to borking out with 500/Internal Server
>   Error, and a "funtion x returned no data" error in the logs.
>   I'm guessing this is accepted, or at least expected behaviour,
>   though I'd prefer if that only happened on return None
>   (and implicitly on a lack of a return), but not on return "")

Fixed in mod_python 3.2.6. In mod_python.publisher in 3.2.6 it
will allow you return "" or None to represent nothing and it will
not raise a 500 error. If you do return these and there was no prior
output written, it will though log a warning message to the Apache
logs.
 
> So I suppose my real question is "Is there a nice overview
> of the varying behaviour under different versions and different
> PyhonHandlers, particularly the current?" Should I not be
> using the publisher, since it seems to contradict the docs?

It doesn't contradict the docs, as I said, you are mixing two different
ways of using mod_python together. You just need to read the
correct part of the docs.

> *If* I'm going to have to know a few innards to use mod_python
> so be it, but right now I have a fragile environment with
> no simple way of telling what'll work without testing it.
> 
> And I don't like to bug you guys too much with this sort
> of "huh, what? wah!", y'know :)

We don't generally mind being bugged, especially like in your case
where it is obvious that you have done some homework to at least
try and understand the issue before posting. It is those where
it is obvious that they have not tried to work the problem out themselves
where it can get annoying after a while, especially where it is also a
bit off topic for the list. ;-)

Anyway, hope the above comments help.

Graham
From smilelover at centrum.cz  Mon Jan 30 16:16:31 2006
From: smilelover at centrum.cz (.: smilelover :.)
Date: Mon Jan 30 16:16:39 2006
Subject: [mod_python] Python Server Pages debugging security
Message-ID: <op.s37mptx52xehyp@localhost.localdomain>

Hi guys,
you're probably through with this, but I'd like to ask (google didn't tell  
me anything).

How can I prevent people from viewing my PSP source via appending an  
underscore to the filename? (you know what I mean...I write index.psp_  
instead of index.psp and get the two-column output with PSP and Python  
source).
Is is possible to do it with some Apache directive?

Thanx for advice!
Dan

From grahamd at dscpl.com.au  Mon Jan 30 16:22:03 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Mon Jan 30 16:22:10 2006
Subject: [mod_python] Python Server Pages debugging security
Message-ID: <1138656123.6476@dscpl.user.openhosting.com>

.: smilelover :. wrote ..
> Hi guys,
> you're probably through with this, but I'd like to ask (google didn't tell
> me anything).
> 
> How can I prevent people from viewing my PSP source via appending an  
> underscore to the filename? (you know what I mean...I write index.psp_
> instead of index.psp and get the two-column output with PSP and Python
> source).
> Is is possible to do it with some Apache directive?

Two options:

  PythonDebug Off

If you need mod_python debugging on for other reasons, you could
instead just block all requests to .psp_ files.

  <Files *.psp_>
  deny from all
  </Files>

Graham
From smilelover at centrum.cz  Mon Jan 30 17:15:45 2006
From: smilelover at centrum.cz (.: smilelover :.)
Date: Mon Jan 30 17:15:51 2006
Subject: [mod_python] importing modules in PSP
Message-ID: <op.s37pgjjt2xehyp@localhost.localdomain>

Hi, another question ;)
in classic CGI I can import a .py file that lies in the same directory as  
an ordinary module. e.g. if I have files index.py and foo.py, I can put  
"import foo" in index.py and it works.
Nevertheless, in PSP it doesn't work :( when I write:

<%
import time

if form.has_key('name'):
    greet = 'Hello, %s!' % form['name'].capitalize()
else:
    greet = 'Hello there!!!'

....


it works, because the time module is in the python path. But when I do:

<%
import foo

...

where foo.py is a file placed in the same dir as the psp file, I get  
"ImportError: No module named foo" error.

Is it so that in plain PSP I can use only <%@ include file='filename'>  
directive and when I want to make use of regular importing, I better use  
templating principle where I create regular .py files and do importing?

Dan

From grahamd at dscpl.com.au  Mon Jan 30 17:34:04 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Mon Jan 30 17:34:10 2006
Subject: [mod_python] importing modules in PSP
Message-ID: <1138660444.20812@dscpl.user.openhosting.com>

.: smilelover :. wrote ..
> Hi, another question ;)
> in classic CGI I can import a .py file that lies in the same directory
> as  
> an ordinary module. e.g. if I have files index.py and foo.py, I can put
> "import foo" in index.py and it works.
> Nevertheless, in PSP it doesn't work :( 

Where within your Apache configuration did you include
"PythonHandler mod_python.psp"? Have you overriden the
PythonPath setting for mod_python?

Provided that the PythonHandler directive was defined within
the context of a Directory directive or in a .htaccess file and
you did not override PythonPath directive, then the directory
that the PythonHandler directive was specified for, should
have been automatically added to sys.path. When this occurs,
if your "foo.py" is in that PythonHandler directory, your
"import" should have found the module.

If you use Location directive, put PythonHandler directive
for .psp files at global context, or override PythonPath, then
this is not going to work.

Either way, you might simply be better of using something
like:

  import os
  from mod_python import apache
  directory = os.path.dirname(req.filename)
  foo = apache.import_module("foo",path=[directory])

Ie., in place of saying "import foo". Using the longer approach
you can say exactly where the "foo" module is located that you
want to import and it does not matter that the directory is not
in sys.path.

Graham
From tkruthoff at gmail.com  Tue Jan 31 02:36:34 2006
From: tkruthoff at gmail.com (Troy Kruthoff)
Date: Tue Jan 31 02:36:37 2006
Subject: [mod_python] VirtualDocumentRoot, PythonPath and Subinterpreters
Message-ID: <5ef0bc720601302336q5e42f693l34d5e91917663951@mail.gmail.com>

How does one go about getting mod_python to know the DocumentRoot when
using the apache VirtualDocumentRoot directive?  Below is a my vhost
conf showing what I am trying to accomplish (I'm trying to get the
PythonPath to match the VirtualDocumentRoot:

<VirtualHost *:80>
    ServerAdmin webmas...@dummy-host.example.com
    UseCanonicalName Off
    VirtualDocumentRoot /www/vhosts/%0

    DirectoryIndex index.py
    PythonPath "sys.path+['/www/vhosts/%0']"
    AddHandler mod_python .py
    PythonHandler index
    PythonDebug On
    ServerName *.example.com
    ErrorLog logs/dummy-host.example.com-error_log
    CustomLog logs/dummy-host.example.com-access_log common
</VirtualHost>


This type of setup makes it viable to run thousands of vhosts from a
single httpd.conf file, and allows the addition and deletion of vhosts
without restarting apache.  This brings me to another point.  If we
are planning to use the worker MPM, a sub-interpreter will be created
for each vhost.  I'm assuming if we can get VirtualDocumentRoot to
work, that the same will apply.  Does anyone know:

1)  How many sub-interpreters is too much?
2)  Is there a way to monitor sub-interpreters and kill stale ones?

Thanks,

Troy

From python_eager at yahoo.com  Tue Jan 31 02:45:08 2006
From: python_eager at yahoo.com (python eager)
Date: Tue Jan 31 02:45:12 2006
Subject: [mod_python] reg table row
Message-ID: <20060131074508.42366.qmail@web36415.mail.mud.yahoo.com>

Hi, 
    i am printing datas in table  format.In this totally 8 rows are there. it  print 8 row values, but display is single row. It won't create new row. How to add new table row in between coding.
   
   <%
                value = req.field("vall")
                for n in range(len(value)):
                   res.write("<td>")
                   res.write("%s" % value[n])
                   res.write("</td>")
              
     %>
   
  Please help me
   
  regards
  Python

		
---------------------------------
Do you Yahoo!?
 With a free 1 GB, there's more in store with Yahoo! Mail.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20060130/000fccab/attachment.html
From trepca at gmail.com  Tue Jan 31 03:48:55 2006
From: trepca at gmail.com (Sebastjan Trepca)
Date: Tue Jan 31 03:48:59 2006
Subject: [mod_python] reg table row
In-Reply-To: <20060131074508.42366.qmail@web36415.mail.mud.yahoo.com>
References: <20060131074508.42366.qmail@web36415.mail.mud.yahoo.com>
Message-ID: <cd329af80601310048tc3d1617p54daec195ec3f179@mail.gmail.com>

What is that "res" variable? Did you mean "req"?

Sebastjan

On 1/31/06, python eager <python_eager@yahoo.com> wrote:
> Hi,
>   i am printing datas in table  format.In this totally 8 rows are there. it
> print 8 row values, but display is single row. It won't create new row. How
> to add new table row in between coding.
>
>  <%
>                 value = req.field("vall")
>                 for n in range(len(value)):
>                    res.write("<td>")
>                    res.write("%s" % value[n])
>                    res.write("</td>")
>
>      %>
>
> Please help me
>
> regards
> Python
>
>  ________________________________
> Do you Yahoo!?
>  With a free 1 GB, there's more in store with Yahoo! Mail.
>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
>
>

From grahamd at dscpl.com.au  Tue Jan 31 04:41:26 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Tue Jan 31 04:41:57 2006
Subject: [mod_python] reg table row
In-Reply-To: <20060131074508.42366.qmail@web36415.mail.mud.yahoo.com>
References: <20060131074508.42366.qmail@web36415.mail.mud.yahoo.com>
Message-ID: <72B9EEF6-7537-4020-8B85-27042B62CC6B@dscpl.com.au>


On 31/01/2006, at 6:45 PM, python eager wrote:

> Hi,
>   i am printing datas in table  format.In this totally 8 rows are  
> there. it  print 8 row values, but display is single row. It won't  
> create new row. How to add new table row in between coding.
>
>  <%
>                 value = req.field("vall")
>                 for n in range(len(value)):
>                    res.write("<td>")
>                    res.write("%s" % value[n])
>                    res.write("</td>")
>
>      %>
>
> Please help me

This is a HTML formatting issue. A quick Google search on terms "HTML  
TABLE TUTORIAL"
yields lots of results. Suggest you try reading some of them. You  
might start with:

   http://www.w3schools.com/html/html_tables.asp

but Google has lots of others. Once you understand what the HTML  
should look like, then
work out how to make your code generate it.

Graham
From grahamd at dscpl.com.au  Tue Jan 31 05:11:48 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Tue Jan 31 05:11:56 2006
Subject: [mod_python] VirtualDocumentRoot, PythonPath and Subinterpreters
In-Reply-To: <5ef0bc720601302336q5e42f693l34d5e91917663951@mail.gmail.com>
References: <5ef0bc720601302336q5e42f693l34d5e91917663951@mail.gmail.com>
Message-ID: <73D344FB-F45A-4491-BBC3-C4D5B64A7F92@dscpl.com.au>


On 31/01/2006, at 6:36 PM, Troy Kruthoff wrote:

> How does one go about getting mod_python to know the DocumentRoot when
> using the apache VirtualDocumentRoot directive?  Below is a my vhost
> conf showing what I am trying to accomplish (I'm trying to get the
> PythonPath to match the VirtualDocumentRoot:
>
> <VirtualHost *:80>
>     ServerAdmin webmas...@dummy-host.example.com
>     UseCanonicalName Off
>     VirtualDocumentRoot /www/vhosts/%0
>
>     DirectoryIndex index.py
>     PythonPath "sys.path+['/www/vhosts/%0']"
>     AddHandler mod_python .py
>     PythonHandler index
>     PythonDebug On
>     ServerName *.example.com
>     ErrorLog logs/dummy-host.example.com-error_log
>     CustomLog logs/dummy-host.example.com-access_log common
> </VirtualHost>

I'll have to read properly what you are writing about and think about  
it,
but not sure there is a real clean way in current mod_python versions
of handling this. There has been requests for something that would
allow wildcarding on PythonPath previously, see:

   https://issues.apache.org/jira/browse/MODPYTHON-63

but I don't believe the suggested changes were practical given current
issues with the module importing system.

It is possible that with changes I will be proposing to the module  
importing
system and how updates to PythonPath are managed and/or avoided,
that this may be more practical to do.

> This type of setup makes it viable to run thousands of vhosts from a
> single httpd.conf file, and allows the addition and deletion of vhosts
> without restarting apache.  This brings me to another point.  If we
> are planning to use the worker MPM, a sub-interpreter will be created
> for each vhost.  I'm assuming if we can get VirtualDocumentRoot to
> work, that the same will apply.  Does anyone know:
>
> 1)  How many sub-interpreters is too much?

Good question. Anyone got an answer to this based on actual usage?
I would image that more than a small number may blow out process
sizes too much.

> 2)  Is there a way to monitor sub-interpreters and kill stale ones?

No. Only way is to do an "apachectl graceful" restart to kill off child
processes and start new ones to replace them.

Graham

From martin at highwaytohell.net  Tue Jan 31 16:21:00 2006
From: martin at highwaytohell.net (martin@highwaytohell.net)
Date: Tue Jan 31 16:30:00 2006
Subject: [mod_python] undefined symbol: apr_table_compress ??
Message-ID: <2512.83.250.136.53.1138742460.squirrel@newsquirrel.sajthotellet.com>

I've downloaded mod_python 3.2.5b (Beta) and compiled it using

./configure --with-apxs=/usr/sbin/apxs --with-python=/usr/local/bin/python2.3
make
make install

just as the documentation says. But when I add LoadModule... to my
httpd.conf and restart Apache 2.0.46 I get the error message

Cannot load /etc/httpd/modules/mod_python.so into server:
/etc/httpd/modules/mod_python.so: undefined symbol: apr_table_compress

any ideas on how to fix this??

Regards
Martin
