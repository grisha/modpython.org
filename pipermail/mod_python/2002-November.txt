From jfk at metation.com  Fri Nov  1 09:20:16 2002
From: jfk at metation.com (Jørgen Frøjk Kjærsgaard)
Date: Fri Jan  9 21:47:05 2004
Subject: [mod_python] Lifecycle of mod_python instances
In-Reply-To: <BB355965-ED1C-11D6-9578-00039300D690@memora.com>
References: <BB355965-ED1C-11D6-9578-00039300D690@memora.com>
Message-ID: <20021101072016.M33334@metation.com>

On Thu, 31 Oct 2002 17:04:30 -0500, Antonio L Rodriguez wrote
> Forgive me if this is more of an apache process question, but I 
> couldn't find it covered clearly in the docs.
> 
> When apache boots up (on *NIX) its starts a bunch of children 
> processes. Does each child have its own separate image of mod_python 
> execution space that is totally separate from the other images?

Correct. Apache 1.3 starts a process per simultaneous request it can handle.
Apache 2.0 is capable of running in threaded mode where the threads share
memory and thus can have global shared variables. I have no experience with
2.0 so far, though. See the documentation for Apache, in particular
http://httpd.apache.org/docs/mod/core.html#maxclients for 1.3 and
http://httpd.apache.org/docs-2.0/mod/mpm_common.html#maxclients for 2.0.

> That is, if I define a global var to measure hit counts in a script 
> and then I see this var dance up and down as each of the child 
> processes handles the request, do I infer correctly that there are 
> separate python interpreters living inside of each child process?

Exactly. You never know which process the next request will hit.

> If this is so, I'd be curious how people do global data structures 
> in this model, i.e. a database connection pool.

Truely global data with Apache 1.3 requires some kind of shared memory, which
isn't supported by mod_python. I use one database connection per child. This
works well, but of cause, if you configure your Apache to run with a lot of
idle children, you'll have a lot of idle connections. If your database system
has a limit as to how many simultaneous connections it can handle, be sure you
don't hit that limit. Raise it or limit the number of Apache processes.

/jfk

--
J?rgen Fr?jk Kj?rsgaard
Metation ApS - the system integrators
Kystvejen 29 - DK 8000 ?rhus C - www.metation.com

From conrad at hep.caltech.edu  Fri Nov  1 14:39:55 2002
From: conrad at hep.caltech.edu (Conrad Steenberg)
Date: Fri Jan  9 21:47:05 2004
Subject: [mod_python] Lifecycle of mod_python instances
In-Reply-To: <20021101072016.M33334@metation.com>
References: <BB355965-ED1C-11D6-9578-00039300D690@memora.com> 
	<20021101072016.M33334@metation.com>
Message-ID: <1036190396.1708.335.camel@heppc22.hep.caltech.edu>

Hi

Just my 2c: 

Using Berkeley DB works great for small things like counters and other
small pieces of persistent data. It is already installed on most
systems, so all you need is the Python binding from
http://pybsddb.sourceforge.net/

You can open a connection to the DB and store it as a global variable in
your mod_python script when the script is imported - i.e. not within the
handler. You can use e.g. cookies to identify connections.

HTH

COnrad

On Thu, 2002-10-31 at 23:20, J?rgen Fr?jk Kj?rsgaard wrote:
> On Thu, 31 Oct 2002 17:04:30 -0500, Antonio L Rodriguez wrote
> > Forgive me if this is more of an apache process question, but I 
> > couldn't find it covered clearly in the docs.
> > 
> > When apache boots up (on *NIX) its starts a bunch of children 
> > processes. Does each child have its own separate image of mod_python 
> > execution space that is totally separate from the other images?
> 
> Correct. Apache 1.3 starts a process per simultaneous request it can handle.
> Apache 2.0 is capable of running in threaded mode where the threads share
> memory and thus can have global shared variables. I have no experience with
> 2.0 so far, though. See the documentation for Apache, in particular
> http://httpd.apache.org/docs/mod/core.html#maxclients for 1.3 and
> http://httpd.apache.org/docs-2.0/mod/mpm_common.html#maxclients for 2.0.
> 
> > That is, if I define a global var to measure hit counts in a script 
> > and then I see this var dance up and down as each of the child 
> > processes handles the request, do I infer correctly that there are 
> > separate python interpreters living inside of each child process?
> 
> Exactly. You never know which process the next request will hit.
> 
> > If this is so, I'd be curious how people do global data structures 
> > in this model, i.e. a database connection pool.
> 
> Truely global data with Apache 1.3 requires some kind of shared memory, which
> isn't supported by mod_python. I use one database connection per child. This
> works well, but of cause, if you configure your Apache to run with a lot of
> idle children, you'll have a lot of idle connections. If your database system
> has a limit as to how many simultaneous connections it can handle, be sure you
> don't hit that limit. Raise it or limit the number of Apache processes.
> 
> /jfk
> 
> --
> J?rgen Fr?jk Kj?rsgaard
> Metation ApS - the system integrators
> Kystvejen 29 - DK 8000 ?rhus C - www.metation.com
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
-- 
*-----------------------------------------*
| Conrad Steenberg                        |
| Caltech, Mail Code 356-48               |
| Pasadena, CA, 91125                     |
| e-mail: conrad@hep.caltech.edu          |
| Tel: (626) 395-8758                     |
*-----------------------------------------*



From john at journyx.com  Sat Nov  2 14:43:24 2002
From: john at journyx.com (John Maddalozzo)
Date: Fri Jan  9 21:47:06 2004
Subject: [mod_python] mod_python on AIX
Message-ID: <Pine.LNX.4.21.0211021439420.7229-100000@dev1.int.journyx.com>

Has anyone been successful at building mod_python support on AIX? It
worked at one time but now on Apache 1.3.27, Python 2.1 and the
latest mod_python I have been unable to get it to run without
httpd core dumping when handling a request (running the mptest.py
program). Python/http calls out to load the stropmodule which gets loaded
as a shared library and then stop calls back to Py_InitModule4().
But it looks like it is trying to jump to an address in the shared
library instead of resolving Py_InitModule4 in libpython2.1.a.
I've had the same problem on both AIX 4.3.3 and 5.1.

If you've been successful at getting mod_python working with any
combination of software on AIX I'd sure like to find out what the trick
is. 

Thanks, John



From Morten.Tryfoss at 1880nummeropplysning.no  Tue Nov  5 19:24:05 2002
From: Morten.Tryfoss at 1880nummeropplysning.no (Morten Tryfoss)
Date: Fri Jan  9 21:47:06 2004
Subject: [mod_python] Problem with mod_python3.0(beta4), python 2.2.1 and apache 2.0.43
Message-ID: <07411F6A634E5445AEF010C58590F2FB665A3A@exchangeone.kristiansand.viadial.no>

I start my server up, and everything works ok. But after av while(when the number of clients raise) some of the apache childs segfaults. Users who are running on their persistent connections may still use the server, but new connections are dropped. Any thoughts of what may be wrong?

Currently I'm running apache 1.3.x, but some part of my scripts performs poorly. Running them on apache 2.0 improved a lot (as long as the server didn't crash).


Morten Tryfoss


From Morten.Tryfoss at 1880nummeropplysning.no  Tue Nov  5 19:48:36 2002
From: Morten.Tryfoss at 1880nummeropplysning.no (Morten Tryfoss)
Date: Fri Jan  9 21:47:06 2004
Subject: SV: [mod_python] Problem with mod_python3.0(beta4), python 2.2.1and apache 2.0.43
Message-ID: <07411F6A634E5445AEF010C58590F2FB63655D@exchangeone.kristiansand.viadial.no>

SuSE Linux 8.0 (2.4.18)

Morten

-----Opprinnelig melding-----
Fra: Gregory (Grisha) Trubetskoy [mailto:grisha@modpython.org]
Sendt: 5. november 2002 19:49
Til: Morten Tryfoss
Emne: Re: [mod_python] Problem with mod_python3.0(beta4), python
2.2.1and apache 2.0.43



Morten - what's your operating system?

On Tue, 5 Nov 2002, Morten Tryfoss wrote:

>
> I start my server up, and everything works ok. But after av while(when
> the number of clients raise) some of the apache childs segfaults. Users
> who are running on their persistent connections may still use the
> server, but new connections are dropped. Any thoughts of what may be
> wrong?
>
> Currently I'm running apache 1.3.x, but some part of my scripts performs
> poorly. Running them on apache 2.0 improved a lot (as long as the server
> didn't crash).
>
>
> Morten Tryfoss
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
>



From grisha at modpython.org  Tue Nov  5 14:19:35 2002
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:47:06 2004
Subject: SV: [mod_python] Problem with mod_python3.0(beta4), python
 2.2.1and apache 2.0.43
In-Reply-To: <07411F6A634E5445AEF010C58590F2FB63655D@exchangeone.kristiansand.viadial.no>
Message-ID: <20021105141658.M32052-100000@eden.ispol.com>

The first thing I would try is upgrading to Python 2.2.2. If that doesn't
solve it, then you need to try to figure out a way to replicate this
issue, which is easier said than done. So far I haven't had any segfault
reports for BETA4, so I have no other info to relate this to.

Grisha

On Tue, 5 Nov 2002, Morten Tryfoss wrote:

> SuSE Linux 8.0 (2.4.18)
>
> Morten
>
> -----Opprinnelig melding-----
> Fra: Gregory (Grisha) Trubetskoy [mailto:grisha@modpython.org]
> Sendt: 5. november 2002 19:49
> Til: Morten Tryfoss
> Emne: Re: [mod_python] Problem with mod_python3.0(beta4), python
> 2.2.1and apache 2.0.43
>
>
>
> Morten - what's your operating system?
>
> On Tue, 5 Nov 2002, Morten Tryfoss wrote:
>
> >
> > I start my server up, and everything works ok. But after av while(when
> > the number of clients raise) some of the apache childs segfaults. Users
> > who are running on their persistent connections may still use the
> > server, but new connections are dropped. Any thoughts of what may be
> > wrong?
> >
> > Currently I'm running apache 1.3.x, but some part of my scripts performs
> > poorly. Running them on apache 2.0 improved a lot (as long as the server
> > didn't crash).
> >
> >
> > Morten Tryfoss
> >
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://www.modpython.org/mailman/listinfo/mod_python
> >
>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
>


From Morten.Tryfoss at 1880nummeropplysning.no  Tue Nov  5 20:58:51 2002
From: Morten.Tryfoss at 1880nummeropplysning.no (Morten Tryfoss)
Date: Fri Jan  9 21:47:06 2004
Subject: SV: SV: [mod_python] Problem with mod_python3.0(beta4), python2.2.1and apache 2.0.43
Message-ID: <07411F6A634E5445AEF010C58590F2FB63655E@exchangeone.kristiansand.viadial.no>

Now I've tried to upgrade Python, and it still segfaults.

Here's some lines from apache's error_log:

[Tue Nov 05 20:51:21 2002] [notice] child pid 29905 exit signal Segmentation fault (11)
[Tue Nov 05 20:51:56 2002] [info] (104)Connection reset by peer: core_output_filter: writing data to the network
[Tue Nov 05 20:51:56 2002] [info] (32)Broken pipe: core_output_filter: writing data to the network
[Tue Nov 05 20:53:08 2002] [notice] child pid 29995 exit signal Segmentation fault (11)
[Tue Nov 05 20:56:24 2002] [info] (104)Connection reset by peer: core_output_filter: writing data to the network
[Tue Nov 05 20:56:24 2002] [info] (32)Broken pipe: core_output_filter: writing data to the network

Is it possible that the scripts are the reason for this? (It worked fine on earlier versions of apache/mod_python).



Morten

-----Opprinnelig melding-----
Fra: Gregory (Grisha) Trubetskoy [mailto:grisha@modpython.org]
Sendt: 5. november 2002 20:20
Til: Morten Tryfoss
Kopi: mod_python@modpython.org
Emne: Re: SV: [mod_python] Problem with mod_python3.0(beta4),
python2.2.1and apache 2.0.43



The first thing I would try is upgrading to Python 2.2.2. If that doesn't
solve it, then you need to try to figure out a way to replicate this
issue, which is easier said than done. So far I haven't had any segfault
reports for BETA4, so I have no other info to relate this to.

Grisha

On Tue, 5 Nov 2002, Morten Tryfoss wrote:

> SuSE Linux 8.0 (2.4.18)
>
> Morten
>
> -----Opprinnelig melding-----
> Fra: Gregory (Grisha) Trubetskoy [mailto:grisha@modpython.org]
> Sendt: 5. november 2002 19:49
> Til: Morten Tryfoss
> Emne: Re: [mod_python] Problem with mod_python3.0(beta4), python
> 2.2.1and apache 2.0.43
>
>
>
> Morten - what's your operating system?
>
> On Tue, 5 Nov 2002, Morten Tryfoss wrote:
>
> >
> > I start my server up, and everything works ok. But after av while(when
> > the number of clients raise) some of the apache childs segfaults. Users
> > who are running on their persistent connections may still use the
> > server, but new connections are dropped. Any thoughts of what may be
> > wrong?
> >
> > Currently I'm running apache 1.3.x, but some part of my scripts performs
> > poorly. Running them on apache 2.0 improved a lot (as long as the server
> > didn't crash).
> >
> >
> > Morten Tryfoss
> >
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://www.modpython.org/mailman/listinfo/mod_python
> >
>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
>



From glunsford at monbar.com  Wed Nov  6 14:22:42 2002
From: glunsford at monbar.com (George Lunsford)
Date: Fri Jan  9 21:47:06 2004
Subject: [mod_python] mod_python & apache config issues
Message-ID: <52E5514ECBC5D611B3E100D0B7B84F5A24CE85@EXCHMAIL>

For the past few days I've been experimenting with installing mod_python
2.7.8 on an Apache 1.3.22 server that was from the standard Caldera
OpenLinux 3.1.1 install.  First, I installed the Python interpreter v 2.1.3,
then I tried installing mod_python, and I ran into the whole threading
issue.  I recompiled Python 2.1.3 without threads, and put it in
/usr/local/web/.  I ran into the EAPI error, and added the OPT=-DEAPI into
the src/Makefile.  
 
Now whenever I run apache, if I do strace httpd -X, it looks like it's using
my threaded version of Python (in /usr/local/bin, there's a symlink in
/usr/bin/ to it).  I'll try and paste what I think are the relevant lines
below:
 
stat64("/usr/local/sbin/python", 0xbfffe2ac) = -1 ENOENT (No such file or
directory)
stat64("/sbin/python", 0xbfffe2ac)      = -1 ENOENT (No such file or
directory)
stat64("/usr/sbin/python", 0xbfffe2ac)  = -1 ENOENT (No such file or
directory)
stat64("/bin/python", 0xbfffe2ac)       = -1 ENOENT (No such file or
directory)
stat64("/usr/bin/python", {st_mode=S_IFREG|0755, st_size=1469444, ...}) = 0
readlink("/usr/bin/python", "/usr/local/bin/python", 1024) = 21
readlink("/usr/local/bin/python", 0xbfffe434, 1024) = -1 EINVAL (Invalid
argument)
stat64("/usr/local/bin/Modules/Setup", 0xbfffe26c) = -1 ENOENT (No such file
or directory)
stat64("/usr/local/bin/lib/python2.1/os.py", 0xbfffe24c) = -1 ENOENT (No
such file or directory)
stat64("/usr/local/bin/lib/python2.1/os.pyc", 0xbfffe23c) = -1 ENOENT (No
such file or directory)
stat64("/usr/local/lib/python2.1/os.py", {st_mode=S_IFREG|0644,
st_size=17401, ...}) = 0
 
Apache would run, but at the first connection (even just to get the root
index file of a directory, it would segfault.  It doesn't appear to be doing
that anymore, however... now it exits with this error eventually (without
needing to connect to the server):
 
[Wed Nov  6 14:37:58 2002] [crit] (98)Address already in use: make_sock:
could not bind to port 80
 
I was wondering if anyone could give me any advice/help with this issue.
Thanks in advance.
 
George Lunsford
 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mailman.modpython.org/pipermail/mod_python/attachments/20021106/34dbf358/attachment.htm
From conrad at hep.caltech.edu  Fri Nov  8 11:24:56 2002
From: conrad at hep.caltech.edu (Conrad Steenberg)
Date: Fri Jan  9 21:47:06 2004
Subject: [mod_python] Interest in sendfile from mod_python?
Message-ID: <1036783496.6448.491.camel@heppc22.hep.caltech.edu>

Hi

My mod_python application regularly needs to send data from files. This
could be either entire files or parts of files.

The Linux and FreeBSD (I think) sendfile calls make this very easy and
efficient in Apache itself, but there is no way to control this from
within mod_python as far as I can see.

My solution was to build a Python sendfile module (using code from the
Medusa server, under the Python license), and create a patch for
mod_python to get the request file-descriptor to pass to the sendfile
call.

So the question is, is anybody else interested in this? Either for me to
contribute the mod_python patch and sendfile package, or for integration
of these two parts into mod_pyhton itself?

Just thought I'd ask :-)

Conrad

Ps. and if using sendfile from mod_python was doable already please feel
free to tell me how ;-)

-- 
*-----------------------------------------*
| Conrad Steenberg                        |
| Caltech, Mail Code 356-48               |
| Pasadena, CA, 91125                     |
| e-mail: conrad@hep.caltech.edu          |
| Tel: (626) 395-8758                     |
*-----------------------------------------*


From jwyant at sfbcic.com  Fri Nov  8 14:16:01 2002
From: jwyant at sfbcic.com (Wyant, Jaime)
Date: Fri Jan  9 21:47:06 2004
Subject: [mod_python] Grabbing the callback object
Message-ID: <654DAEACA633D511B5F500902784B052188EAA@MS-EXCHANGE>

Hi all!

Is there any way to grab the Callback object?  I really want to override the
"ReportError" method and generate a more meaningful error message with
pretty graphics.

Better yet, is there a way to catch unhandled exceptions and display a
custom error message? 

thanks!

jaime wyant (jwyant@sfbcic . com)
MS Farm Bureau
(601) 977 - 4291



From conrad at hep.caltech.edu  Fri Nov  8 13:31:49 2002
From: conrad at hep.caltech.edu (Conrad Steenberg)
Date: Fri Jan  9 21:47:06 2004
Subject: [mod_python] Grabbing the callback object
In-Reply-To: <654DAEACA633D511B5F500902784B052188EAA@MS-EXCHANGE>
References: <654DAEACA633D511B5F500902784B052188EAA@MS-EXCHANGE>
Message-ID: <1036791109.6448.635.camel@heppc22.hep.caltech.edu>

Hi Jaime

You can write your own error message to the client, and return
apache.DONE to stop Apache from any further processing.

E.g.

def handler(req):
  try:
    <Do some processing>
  except:
    <Write error message, including headers>
    return apache.DONE

  return apache.OK


Cheers!

Conrad

On Fri, 2002-11-08 at 12:16, Wyant, Jaime wrote:
> Hi all!
> 
> Is there any way to grab the Callback object?  I really want to override the
> "ReportError" method and generate a more meaningful error message with
> pretty graphics.
> 
> Better yet, is there a way to catch unhandled exceptions and display a
> custom error message? 
> 
> thanks!
> 
> jaime wyant (jwyant@sfbcic . com)
> MS Farm Bureau
> (601) 977 - 4291
> 
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
-- 
*-----------------------------------------*
| Conrad Steenberg                        |
| Caltech, Mail Code 356-48               |
| Pasadena, CA, 91125                     |
| e-mail: conrad@hep.caltech.edu          |
| Tel: (626) 395-8758                     |
*-----------------------------------------*


From jwyant at sfbcic.com  Fri Nov  8 16:06:58 2002
From: jwyant at sfbcic.com (Wyant, Jaime)
Date: Fri Jan  9 21:47:06 2004
Subject: [mod_python] Grabbing the callback object
Message-ID: <654DAEACA633D511B5F500902784B052188EAD@MS-EXCHANGE>


>>>-----Original Message-----
>>>From: Conrad Steenberg [mailto:conrad@hep.caltech.edu]
>>>Sent: Friday, November 08, 2002 3:32 PM
>>>To: Wyant, Jaime
>>>Cc: 'mod_python@modpython.org'
>>>Subject: Re: [mod_python] Grabbing the callback object
>>>
>>>
>>>Hi Jaime
>>>
>>>You can write your own error message to the client, and return
>>>apache.DONE to stop Apache from any further processing.
>>>
>>>E.g.
>>>
>>>def handler(req):
>>>  try:
>>>    <Do some processing>
>>>  except:
>>>    <Write error message, including headers>
>>>    return apache.DONE
>>>
>>>  return apache.OK
>>>
>>>
>>>Cheers!
>>>
>>>Conrad
>>>

Thanks!  I thought about doing it that way.  Take a peek at a snippet of my
error log:


[Tue Nov  5 07:36:13 2002] [error] PythonHandler mod_python.publisher:
File "/
usr/local/lib/python2.2/site-packages/mod_python/publisher.py", line 88, in
hand
ler
    if func_path[-1] == ".":
[Tue Nov  5 07:36:13 2002] [error] PythonHandler mod_python.publisher:
IndexErro
r: string index out of range
[Tue Nov  5 08:09:44 2002] [error] PythonHandler mod_python.publisher:
Traceback
 (most recent call last):

I'm getting an IndexError in the publisher module.  I have already modified
that module a little bit already and would rather not change it any more.

No, my changes aren't causing the IndexError :).  I simply modified the
handler to "raise apache.SERVER_RETURN, apache.HTTP_NOT_FOUND" when an
ImportError occurred.  This stopped "mostly correct" paths from returning an
"Internal Server Error Message".  I can elaborate if you are curious.

Maybe I could create a wrapper handler for the publisher handler?

# my wrapper

import mod_python.publisher

def handler( req ):
  try:
    return mod_python.publisher.handler( req )    
  except Exception:
    req.write( create_cool_html_error_report() )
    return apache.OK


Thanks!
jaime

>>>On Fri, 2002-11-08 at 12:16, Wyant, Jaime wrote:
>>>> Hi all!
>>>> 
>>>> Is there any way to grab the Callback object?  I really 
>>>want to override the
>>>> "ReportError" method and generate a more meaningful error 
>>>message with
>>>> pretty graphics.
>>>> 
>>>> Better yet, is there a way to catch unhandled exceptions 
>>>and display a
>>>> custom error message? 
>>>> 
>>>> thanks!
>>>> 
>>>> jaime wyant (jwyant@sfbcic . com)
>>>> MS Farm Bureau
>>>> (601) 977 - 4291
>>>> 
>>>> 
>>>> _______________________________________________
>>>> Mod_python mailing list
>>>> Mod_python@modpython.org
>>>> http://www.modpython.org/mailman/listinfo/mod_python
>>>-- 
>>>*-----------------------------------------*
>>>| Conrad Steenberg                        |
>>>| Caltech, Mail Code 356-48               |
>>>| Pasadena, CA, 91125                     |
>>>| e-mail: conrad@hep.caltech.edu          |
>>>| Tel: (626) 395-8758                     |
>>>*-----------------------------------------*
>>>
>>>_______________________________________________
>>>Mod_python mailing list
>>>Mod_python@modpython.org
>>>http://www.modpython.org/mailman/listinfo/mod_python
>>>

From conrad at hep.caltech.edu  Fri Nov  8 14:20:56 2002
From: conrad at hep.caltech.edu (Conrad Steenberg)
Date: Fri Jan  9 21:47:06 2004
Subject: [mod_python] Grabbing the callback object
In-Reply-To: <654DAEACA633D511B5F500902784B052188EAD@MS-EXCHANGE>
References: <654DAEACA633D511B5F500902784B052188EAD@MS-EXCHANGE>
Message-ID: <1036794056.6446.695.camel@heppc22.hep.caltech.edu>

On Fri, 2002-11-08 at 14:06, Wyant, Jaime wrote:
> 
> Maybe I could create a wrapper handler for the publisher handler?
> 
> # my wrapper
> 
> import mod_python.publisher
> 
> def handler( req ):
>   try:
>     return mod_python.publisher.handler( req )    
>   except Exception:
>     req.write( create_cool_html_error_report() )
>     return apache.OK
> 

Yes, for the publisher handler, that sounds rather more sensible. 

Cheers!

Conrad

> 
> >>>On Fri, 2002-11-08 at 12:16, Wyant, Jaime wrote:
> >>>> Hi all!
> >>>> 
> >>>> Is there any way to grab the Callback object?  I really 
> >>>want to override the
> >>>> "ReportError" method and generate a more meaningful error 
> >>>message with
> >>>> pretty graphics.
> >>>> 
> >>>> Better yet, is there a way to catch unhandled exceptions 
> >>>and display a
> >>>> custom error message? 
> >>>> 
> >>>> thanks!
> >>>> 
> >>>> jaime wyant (jwyant@sfbcic . com)
> >>>> MS Farm Bureau
> >>>> (601) 977 - 4291
> >>>> 
> >>>> 



From conrad at hep.caltech.edu  Sat Nov  9 14:17:02 2002
From: conrad at hep.caltech.edu (Conrad Steenberg)
Date: Fri Jan  9 21:47:06 2004
Subject: [mod_python] Interest in sendfile from mod_python?
In-Reply-To: <20021109052035.GZ4761@netvista.mikebell.org>
References: <1036783496.6448.491.camel@heppc22.hep.caltech.edu> 
	<20021109052035.GZ4761@netvista.mikebell.org>
Message-ID: <1036880222.1221.5.camel@192.168.1.100>

Hi Mike

Have a look at sendfilemodule.c in
http://cvs.sourceforge.net/cgi-bin/viewcvs.cgi/clarens/clarens/sendfile/

The patch for mod_python to get the filedescriptor to write to is below.

Cheers!

Conrad

On Fri, 2002-11-08 at 21:20, mike@mikebell.org wrote:
> On Fri, Nov 08, 2002 at 11:24:56AM -0800, Conrad Steenberg wrote:
> > So the question is, is anybody else interested in this? Either for me to
> > contribute the mod_python patch and sendfile package, or for integration
> > of these two parts into mod_pyhton itself?
> 
> I would absolutely be interested. Zero-copy from mod_python, yay. I have
> in fact thought about this in the past but never got around to doing
> anything about it.
--- src/requestobject.c.orig    Tue Jun  4 15:52:45 2002
+++ src/requestobject.c Tue Jun  4 11:15:49 2002
@@ -781,6 +781,27 @@

 }

+/**
+ ** request.get_fd(request self)
+ **
+ *      Returns the file descriptor to write output to
+ */
+
+static PyObject * req_fd(requestobject *self, PyObject *args)
+{
+    PyObject *fd;
+    long thefd;
+    thefd=(long)self->request_rec->connection->client->fd;
+    fd = PyInt_FromLong(thefd);
+    if (!fd) {
+       PyErr_SetString(PyExc_IOError, "Could not determine file descriptor.");
+       return NULL;
+    }
+
static PyMethodDef requestobjectmethods[] = {
     {"add_common_vars",      (PyCFunction) req_add_common_vars,      METH_VARA
     {"add_handler",          (PyCFunction) req_add_handler,          METH_VARA
@@ -797,6 +818,7 @@
     {"register_cleanup",     (PyCFunction) req_register_cleanup,     METH_VARA
     {"send_http_header",     (PyCFunction) req_send_http_header,     METH_VARA
     {"write",                (PyCFunction) req_write,                METH_VARA
+    {"get_fd",               (PyCFunction) req_fd,                   METH_VARA
     { NULL, NULL } /* sentinel */
 };




From conrad at hep.caltech.edu  Sat Nov  9 14:37:02 2002
From: conrad at hep.caltech.edu (Conrad Steenberg)
Date: Fri Jan  9 21:47:06 2004
Subject: [mod_python] Interest in sendfile from mod_python?
In-Reply-To: <1036880222.1221.5.camel@192.168.1.100>
References: <1036783496.6448.491.camel@heppc22.hep.caltech.edu> 
	<20021109052035.GZ4761@netvista.mikebell.org> 
	<1036880222.1221.5.camel@192.168.1.100>
Message-ID: <1036881423.1188.21.camel@192.168.1.100>

Aarghh, take 2 on the patch:

--- src/requestobject.c.orig    Tue Jun  4 15:52:45 2002
+++ src/requestobject.c Tue Jun  4 11:15:49 2002
@@ -781,6 +781,27 @@

 }

+/**
+ ** request.get_fd(request self)
+ **
+ *      Returns the file descriptor to write output to
+ */
+
+static PyObject * req_fd(requestobject *self, PyObject *args)
+{
+    PyObject *fd;
+    long thefd;
+    thefd=(long)self->request_rec->connection->client->fd;
+    fd = PyInt_FromLong(thefd);
+    if (!fd) {
+       PyErr_SetString(PyExc_IOError, "Could not determine file descriptor.");
+       return NULL;
+    }
+
+
+    return fd;
+}
+
+
 static PyMethodDef requestobjectmethods[] = {
     {"add_common_vars",      (PyCFunction) req_add_common_vars,      METH_VARARGS},
     {"add_handler",          (PyCFunction) req_add_handler,          METH_VARARGS},
@@ -797,6 +818,7 @@
     {"register_cleanup",     (PyCFunction) req_register_cleanup,     METH_VARARGS},
     {"send_http_header",     (PyCFunction) req_send_http_header,     METH_VARARGS},
     {"write",                (PyCFunction) req_write,                METH_VARARGS},
+    {"get_fd",               (PyCFunction) req_fd,                   METH_VARARGS},
     { NULL, NULL } /* sentinel */
 };



On Sat, 2002-11-09 at 14:17, Conrad Steenberg wrote:
> Hi Mike
> 
> Have a look at sendfilemodule.c in
> http://cvs.sourceforge.net/cgi-bin/viewcvs.cgi/clarens/clarens/sendfile/
> 
> The patch for mod_python to get the filedescriptor to write to is below.
> 
> Cheers!
> 
> Conrad
> 
> On Fri, 2002-11-08 at 21:20, mike@mikebell.org wrote:
> > On Fri, Nov 08, 2002 at 11:24:56AM -0800, Conrad Steenberg wrote:
> > > So the question is, is anybody else interested in this? Either for me to
> > > contribute the mod_python patch and sendfile package, or for integration
> > > of these two parts into mod_pyhton itself?
> > 
> > I would absolutely be interested. Zero-copy from mod_python, yay. I have
> > in fact thought about this in the past but never got around to doing
> > anything about it.
> --- src/requestobject.c.orig    Tue Jun  4 15:52:45 2002
> +++ src/requestobject.c Tue Jun  4 11:15:49 2002
> @@ -781,6 +781,27 @@
> 
>  }
> 
> +/**
> + ** request.get_fd(request self)
> + **
> + *      Returns the file descriptor to write output to
> + */
> +
> +static PyObject * req_fd(requestobject *self, PyObject *args)
> +{
> +    PyObject *fd;
> +    long thefd;
> +    thefd=(long)self->request_rec->connection->client->fd;
> +    fd = PyInt_FromLong(thefd);
> +    if (!fd) {
> +       PyErr_SetString(PyExc_IOError, "Could not determine file descriptor.");
> +       return NULL;
> +    }
> +
> static PyMethodDef requestobjectmethods[] = {
>      {"add_common_vars",      (PyCFunction) req_add_common_vars,      METH_VARA
>      {"add_handler",          (PyCFunction) req_add_handler,          METH_VARA
> @@ -797,6 +818,7 @@
>      {"register_cleanup",     (PyCFunction) req_register_cleanup,     METH_VARA
>      {"send_http_header",     (PyCFunction) req_send_http_header,     METH_VARA
>      {"write",                (PyCFunction) req_write,                METH_VARA
> +    {"get_fd",               (PyCFunction) req_fd,                   METH_VARA
>      { NULL, NULL } /* sentinel */
>  };
> 
> 
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python



From laurie at tratt.net  Sun Nov 10 17:51:00 2002
From: laurie at tratt.net (Laurence Tratt)
Date: Fri Jan  9 21:47:06 2004
Subject: [mod_python] mod_python and OpenBSD
Message-ID: <20021110175100.A31721@purcell.dcs.kcl.ac.uk>

Hi all,

Has anyone managed to build mod_python-3.0.0-BETA4 under OpenBSD? I'm
running OpenBSD 3.2-current, have got Apache 2.0.43 but haven't actually
managed to build mp yet, and would be very interested to hear if anyone's
got this combination to play ball yet.

The problem I have is that mod_python.so itself isn't ever getting built.
Virtually every other filename extension after "mod_python." exists, but not
"so": the most likely culprit is libtool, a favoured target of bile in the
OpenBSD community, but I'm no expert on it (nor on the particular variant
that Apache ships in build/). The eventual result of not building the lib is
a dangling sym link from src/ to lib/ just to make things fun! If anybody's
interested in having a look at this, I can hook them up with an account on
an OpenBSD machine.


Whilst I'm here, I might as well tell you guys what I actually want mp to
do. If it's a Really Bad Idea, please feel free to tell me :) Essentially, I
want to have a filter which takes pages in a sort-of psuedo HTML format, and
then munges them into a full page before sending them on. I've prototyped it
in Apache 1.3 as a handler/cgi-script thing, and it works fine except that
you're limited by the fact that you can't post-process data from other
sources (eg I will probably need to munge PHP output too). So filters in
Apache 2.0 look like the way to go, and obviously I want it to run
efficiently hence my interest in mod_python. From what I can tell, at the
moment mp's filter support can't handle fiddling with HTTP headers which I
will need to do (my filter also having to deal with setting cookies), but
I'm unclear as to whether that's a fundamental problem, or whether it just
hasn't been coded up yet.

Thanks in advance for any help,


Laurie

From agenkin-lst-mod_python at thpoon.com  Sun Nov 10 12:52:44 2002
From: agenkin-lst-mod_python at thpoon.com (Arcady Genkin)
Date: Fri Jan  9 21:47:06 2004
Subject: [mod_python] online docs for mp version 3?
Message-ID: <86bs4xjor7.fsf@tea.thpoon.com>

Is there a copy of documentation for version 3.0 of mod_python online
somewhere?

Thanks.
-- 
Arcady Genkin

guilt is the cause of more disauders
than history's most obscene marorders                       (E.E. Cummings)

From agenkin-lst-mod_python at thpoon.com  Sun Nov 10 13:06:56 2002
From: agenkin-lst-mod_python at thpoon.com (Arcady Genkin)
Date: Fri Jan  9 21:47:06 2004
Subject: [mod_python] Default function for Publisher
Message-ID: <867kfljo3j.fsf@tea.thpoon.com>

I spent a few hours trying to figure out how to make the url
"http://foo" respond with a python handler in index.py.  In the end I
came up with the following:

   RewriteEngine on
   RewriteRule ^/*$ /index.py/main

which seems to work, but is a hack.  In the list archives I saw a few
threads that proposed introducing a default handler function for the
Publisher, but the impression I got was that the functionality still
is not implemented.

As a new user of mod_python, I'd like to pitch in that default
Publisher function would save me a lot of trouble and time, which I'd
rather have spent getting to know mod_python than learning how
mod_rewrite works.  It would be much cleaner to write:

  DirectoryIndex index.py
  PyPublisherDefaultFunction main

or some such.
-- 
Arcady Genkin

guilt is the cause of more disauders
than history's most obscene marorders                       (E.E. Cummings)

From agenkin-lst-mod_python at thpoon.com  Sun Nov 10 13:25:45 2002
From: agenkin-lst-mod_python at thpoon.com (Arcady Genkin)
Date: Fri Jan  9 21:47:06 2004
Subject: [mod_python] Apache children crashing with mod_python 3.0 beta4
Message-ID: <863cq9jn86.fsf@tea.thpoon.com>

I'm trying out mod_python-3 beta 4 on FreeBSD 4.7.  Python is version
2.2.2 compiled from ports without threading support.  Apache is 2.0.43
compiled from ports with threads enabled, running with default
configuration (apart from mod_python customizations); mod_python is
the only non-stock module loaded into it.

Even though mod_python seems to be working fine, I am seeing the
following in the apache's error logs:

Fatal Python error: PyThreadState_Delete: tstate is still current
Fatal Python error: PyThreadState_Delete: tstate is still current
Fatal Python error: PyThreadState_Delete: tstate is still current
Fatal Python error: PyThreadState_Delete: tstate is still current
[Sun Nov 10 12:29:32 2002] [notice] child pid 27272 exit signal Abort trap (6)
[Sun Nov 10 12:29:32 2002] [notice] child pid 27267 exit signal Abort trap (6)
[Sun Nov 10 12:29:32 2002] [notice] child pid 27266 exit signal Abort trap (6)
[Sun Nov 10 12:29:32 2002] [notice] child pid 27265 exit signal Abort trap (6)

How likely is this due to a misconfiguration?  Any pointers?

Many thanks,
-- 
Arcady Genkin

guilt is the cause of more disauders
than history's most obscene marorders                       (E.E. Cummings)

From agenkin-lst-mod_python at thpoon.com  Sun Nov 10 13:28:43 2002
From: agenkin-lst-mod_python at thpoon.com (Arcady Genkin)
Date: Fri Jan  9 21:47:06 2004
Subject: [mod_python] online docs for mp version 3?
References: <86bs4xjor7.fsf@tea.thpoon.com>
Message-ID: <86vg35i8is.fsf@tea.thpoon.com>

Arcady Genkin <agenkin-lst-mod_python@thpoon.com> writes:

> Is there a copy of documentation for version 3.0 of mod_python online
> somewhere?

Never mind.  I now see that the distribution tarball includes
generated HTML documenation (I thought that only the LaTeX sources
were included).  Sorry for the noise.
-- 
Arcady Genkin

guilt is the cause of more disauders
than history's most obscene marorders                       (E.E. Cummings)

From grisha at modpython.org  Sun Nov 10 14:30:19 2002
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:47:06 2004
Subject: [mod_python] Default function for Publisher
In-Reply-To: <867kfljo3j.fsf@tea.thpoon.com>
Message-ID: <20021110142943.T3802-100000@eden.ispol.com>

in MP 3.0 it defaults "index"

Grisha

On Sun, 10 Nov 2002, Arcady Genkin wrote:

> I spent a few hours trying to figure out how to make the url
> "http://foo" respond with a python handler in index.py.  In the end I
> came up with the following:
>
>    RewriteEngine on
>    RewriteRule ^/*$ /index.py/main
>
> which seems to work, but is a hack.  In the list archives I saw a few
> threads that proposed introducing a default handler function for the
> Publisher, but the impression I got was that the functionality still
> is not implemented.
>
> As a new user of mod_python, I'd like to pitch in that default
> Publisher function would save me a lot of trouble and time, which I'd
> rather have spent getting to know mod_python than learning how
> mod_rewrite works.  It would be much cleaner to write:
>
>   DirectoryIndex index.py
>   PyPublisherDefaultFunction main
>
> or some such.
> --
> Arcady Genkin
>
> guilt is the cause of more disauders
> than history's most obscene marorders                       (E.E. Cummings)
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
>


From grisha at modpython.org  Sun Nov 10 14:33:11 2002
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:47:06 2004
Subject: [mod_python] Apache children crashing with mod_python 3.0 beta4
In-Reply-To: <863cq9jn86.fsf@tea.thpoon.com>
Message-ID: <20021110143055.H3802-100000@eden.ispol.com>

See the README file. On FreeBSD you need to have threads enabled in both
Python and Apache. The default Python port will have threads enabled, and
to make Apache thread-enabled, you need --enable-threads in the Makefile.

On Sun, 10 Nov 2002, Arcady Genkin wrote:

> I'm trying out mod_python-3 beta 4 on FreeBSD 4.7.  Python is version
> 2.2.2 compiled from ports without threading support.  Apache is 2.0.43
> compiled from ports with threads enabled, running with default
> configuration (apart from mod_python customizations); mod_python is
> the only non-stock module loaded into it.
>
> Even though mod_python seems to be working fine, I am seeing the
> following in the apache's error logs:
>
> Fatal Python error: PyThreadState_Delete: tstate is still current
> Fatal Python error: PyThreadState_Delete: tstate is still current
> Fatal Python error: PyThreadState_Delete: tstate is still current
> Fatal Python error: PyThreadState_Delete: tstate is still current
> [Sun Nov 10 12:29:32 2002] [notice] child pid 27272 exit signal Abort trap (6)
> [Sun Nov 10 12:29:32 2002] [notice] child pid 27267 exit signal Abort trap (6)
> [Sun Nov 10 12:29:32 2002] [notice] child pid 27266 exit signal Abort trap (6)
> [Sun Nov 10 12:29:32 2002] [notice] child pid 27265 exit signal Abort trap (6)
>
> How likely is this due to a misconfiguration?  Any pointers?
>
> Many thanks,
> --
> Arcady Genkin
>
> guilt is the cause of more disauders
> than history's most obscene marorders                       (E.E. Cummings)
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
>


From agenkin-lst-mod_python at thpoon.com  Sun Nov 10 16:12:59 2002
From: agenkin-lst-mod_python at thpoon.com (Arcady Genkin)
Date: Fri Jan  9 21:47:06 2004
Subject: [mod_python] Apache children crashing with mod_python 3.0 beta4
In-Reply-To: <20021110143055.H3802-100000@eden.ispol.com> ("Gregory's
 message of "Sun, 10 Nov 2002 14:33:11 -0500 (EST)")
References: <20021110143055.H3802-100000@eden.ispol.com>
Message-ID: <uoof8x5dt0.fsf@bashful.cdf.toronto.edu>

"Gregory (Grisha) Trubetskoy" <grisha@modpython.org> writes:

> See the README file. On FreeBSD you need to have threads enabled in both
> Python and Apache. 

The README file only tells to compile Apache with threads, which I
read and did.  Perhaps you need to add the bit about Python with
threads enabled.

Thanks for your reply!
-- 
Arcady Genkin : CDF Systems Administrator
http://www.cdf.toronto.edu/~agenkin/contact.html

guilt is the cause of more disauders
than history's most obscene marorders (E.E. Cummings)

From agenkin-lst-mod_python at thpoon.com  Sun Nov 10 16:36:38 2002
From: agenkin-lst-mod_python at thpoon.com (Arcady Genkin)
Date: Fri Jan  9 21:47:06 2004
Subject: [mod_python] Default function for Publisher in 3.0
In-Reply-To: <20021110142943.T3802-100000@eden.ispol.com> ("Gregory's
 message of "Sun, 10 Nov 2002 14:30:19 -0500 (EST)")
References: <20021110142943.T3802-100000@eden.ispol.com>
Message-ID: <uoheep5cpl.fsf@bashful.cdf.toronto.edu>

"Gregory (Grisha) Trubetskoy" <grisha@modpython.org> writes:

> in MP 3.0 it defaults "index"

Great!  However, this does not seem to work with
"DirectoryIndex index.py".
I get the following when accessing the url http://myhost/ :

,----
| Mod_python error: "PythonHandler mod_python.publisher"
| 
| Traceback (most recent call last):
| 
|   File "/usr/local/lib/python2.2/site-packages/mod_python/apache.py",
|   line 335, in HandlerDispatch
|     result = object(req)
| 
|   File "/usr/local/lib/python2.2/site-packages/mod_python/publisher.py",
|   line 86, in handler
|     func_path = req.path_info[1:] # skip first /
| 
| TypeError: unsubscriptable object
`----

Accessing http://myhost/index.py works fine.
-- 
Arcady Genkin : CDF Systems Administrator
http://www.cdf.toronto.edu/~agenkin/contact.html

guilt is the cause of more disauders
than history's most obscene marorders (E.E. Cummings)

From agenkin-lst-mod_python at thpoon.com  Sun Nov 10 16:42:55 2002
From: agenkin-lst-mod_python at thpoon.com (Arcady Genkin)
Date: Fri Jan  9 21:47:06 2004
Subject: [mod_python] Documentation bug for 3.0
Message-ID: <uod6pd5cf4.fsf@bashful.cdf.toronto.edu>

In the html documentation, distributed with the 3.0 tarball, Section
6.1.1 (introduction to publisher handler) suggests the following
configuration in httpd.conf:

<Directory /some/path}
    SetHandler python-program 
    PythonHandler mod_python.publisher
</Directory>

But this results in a syntax error:

   AddHandler requires at least two arguments, a handler name followed
   by one or more file extensions

Seems that ".py" is missing at the end of SetHandler directive.
-- 
Arcady Genkin : CDF Systems Administrator
http://www.cdf.toronto.edu/~agenkin/contact.html

guilt is the cause of more disauders
than history's most obscene marorders (E.E. Cummings)

From agenkin-lst-mod_python at thpoon.com  Sun Nov 10 16:56:52 2002
From: agenkin-lst-mod_python at thpoon.com (Arcady Genkin)
Date: Fri Jan  9 21:47:06 2004
Subject: [mod_python] Documentation bug for 3.0
In-Reply-To: <uod6pd5cf4.fsf@bashful.cdf.toronto.edu> (Arcady Genkin's
 message of "Sun, 10 Nov 2002 16:42:55 -0500")
References: <uod6pd5cf4.fsf@bashful.cdf.toronto.edu>
Message-ID: <uo7kfl5brv.fsf@bashful.cdf.toronto.edu>

Errm...  I must get the pointy hat of the day for being so
inattentive.  Of course, the docs say "SetHandler", while I have
"AddHandler" in the config file.

Many appologies.

Arcady Genkin <agenkin-lst-mod_python@thpoon.com> writes:

> In the html documentation, distributed with the 3.0 tarball, Section
> 6.1.1 (introduction to publisher handler) suggests the following
> configuration in httpd.conf:
>
> <Directory /some/path}
>     SetHandler python-program 
>     PythonHandler mod_python.publisher
> </Directory>
>
> But this results in a syntax error:
>
>    AddHandler requires at least two arguments, a handler name followed
>    by one or more file extensions
>
> Seems that ".py" is missing at the end of SetHandler directive.

-- 
Arcady Genkin : CDF Systems Administrator
http://www.cdf.toronto.edu/~agenkin/contact.html

guilt is the cause of more disauders
than history's most obscene marorders (E.E. Cummings)

From agenkin-lst-mod_python at thpoon.com  Sun Nov 10 17:11:26 2002
From: agenkin-lst-mod_python at thpoon.com (Arcady Genkin)
Date: Fri Jan  9 21:47:06 2004
Subject: [mod_python] Default function for Publisher in 3.0
References: <20021110142943.T3802-100000@eden.ispol.com>
	<uoheep5cpl.fsf@bashful.cdf.toronto.edu>
Message-ID: <uowunl3wj5.fsf@bashful.cdf.toronto.edu>

Arcady Genkin <agenkin-lst-mod_python@thpoon.com> writes:

> this does not seem to work with "DirectoryIndex index.py".

An update: I had a problem with configuration (using AddHandler
directive instead of the SetHandler, as recommended in the docs).
However, still can't use index.py implicitely.  Now the backtrace
looks this way:

,----
| Mod_python error: "PythonHandler mod_python.publisher"
| 
| Traceback (most recent call last):
| 
|   File "/usr/local/lib/python2.2/site-packages/mod_python/apache.py",
|   line 335, in HandlerDispatch
|     result = object(req)
| 
|   File "/usr/local/lib/python2.2/site-packages/mod_python/publisher.py",
|   line 145, in handler
|     module = apache.import_module(module_name, req.get_config(), [path])
| 
|   File "/usr/local/lib/python2.2/site-packages/mod_python/apache.py",
|   line 499, in import_module
|     f, p, d = imp.find_module(parts[i], path)
| 
| ImportError: No module named 
`----

The httpd.conf contains the following configuration:

,----
| <Directory "/var/www/data">
|    PythonDebug On
|    SetHandler python-program
|    PythonHandler mod_python.publisher
|    DirectoryIndex index.py
| </Directory>
`----

Something tells me that I am still doing something wrong.  I tried
setting DIrectoryIndex to "index" instead of "index.py", but this
still did not work.  Any ideas?

Many thanks,
-- 
Arcady Genkin : CDF Systems Administrator
http://www.cdf.toronto.edu/~agenkin/contact.html

guilt is the cause of more disauders
than history's most obscene marorders (E.E. Cummings)

From gstein at lyra.org  Sun Nov 10 17:05:40 2002
From: gstein at lyra.org (Greg Stein)
Date: Fri Jan  9 21:47:06 2004
Subject: [mod_python] Interest in sendfile from mod_python?
In-Reply-To: <1036783496.6448.491.camel@heppc22.hep.caltech.edu>; from conrad@hep.caltech.edu on Fri, Nov 08, 2002 at 11:24:56AM -0800
References: <1036783496.6448.491.camel@heppc22.hep.caltech.edu>
Message-ID: <20021110170540.C4640@lyra.org>

On Fri, Nov 08, 2002 at 11:24:56AM -0800, Conrad Steenberg wrote:
>...
> The Linux and FreeBSD (I think) sendfile calls make this very easy and
> efficient in Apache itself, but there is no way to control this from
> within mod_python as far as I can see.

In Apache 2.0, the Python code needs to construct a FILE bucket and shove
that into the output filter stack. Assuming that it doesn't get processed by
mod_includes or somesuch on the way through the filters, then it will hit
the network output filter and be sendfile'd.

> My solution was to build a Python sendfile module (using code from the
> Medusa server, under the Python license), and create a patch for
> mod_python to get the request file-descriptor to pass to the sendfile
> call.

The file descriptor is private info. Modules should never access it.


All that said: I'm not sure if mod_python allows you to construct buckets
right now. Grisha could answer that in a jiffy...

Cheers,
-g

-- 
Greg Stein, http://www.lyra.org/

From gstein at lyra.org  Sun Nov 10 17:07:39 2002
From: gstein at lyra.org (Greg Stein)
Date: Fri Jan  9 21:47:06 2004
Subject: [mod_python] Apache children crashing with mod_python 3.0 beta4
In-Reply-To: <20021110143055.H3802-100000@eden.ispol.com>; from grisha@modpython.org on Sun, Nov 10, 2002 at 02:33:11PM -0500
References: <863cq9jn86.fsf@tea.thpoon.com> <20021110143055.H3802-100000@eden.ispol.com>
Message-ID: <20021110170739.D4640@lyra.org>

Also make sure that Apache is configured to use the "prefork" MPM. The
thread-based MPMs don't work in FreeBSD because of its broken sendfile
implementation (it breaks in threaded environments; this has been fixed in
very recent BSDs... not sure which).

Cheers,
-g

On Sun, Nov 10, 2002 at 02:33:11PM -0500, Gregory (Grisha) Trubetskoy wrote:
> 
> See the README file. On FreeBSD you need to have threads enabled in both
> Python and Apache. The default Python port will have threads enabled, and
> to make Apache thread-enabled, you need --enable-threads in the Makefile.
> 
> On Sun, 10 Nov 2002, Arcady Genkin wrote:
> 
> > I'm trying out mod_python-3 beta 4 on FreeBSD 4.7.  Python is version
> > 2.2.2 compiled from ports without threading support.  Apache is 2.0.43
> > compiled from ports with threads enabled, running with default
> > configuration (apart from mod_python customizations); mod_python is
> > the only non-stock module loaded into it.
> >
> > Even though mod_python seems to be working fine, I am seeing the
> > following in the apache's error logs:
> >
> > Fatal Python error: PyThreadState_Delete: tstate is still current
> > Fatal Python error: PyThreadState_Delete: tstate is still current
> > Fatal Python error: PyThreadState_Delete: tstate is still current
> > Fatal Python error: PyThreadState_Delete: tstate is still current
> > [Sun Nov 10 12:29:32 2002] [notice] child pid 27272 exit signal Abort trap (6)
> > [Sun Nov 10 12:29:32 2002] [notice] child pid 27267 exit signal Abort trap (6)
> > [Sun Nov 10 12:29:32 2002] [notice] child pid 27266 exit signal Abort trap (6)
> > [Sun Nov 10 12:29:32 2002] [notice] child pid 27265 exit signal Abort trap (6)
> >
> > How likely is this due to a misconfiguration?  Any pointers?
> >
> > Many thanks,
> > --
> > Arcady Genkin
> >
> > guilt is the cause of more disauders
> > than history's most obscene marorders                       (E.E. Cummings)
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://www.modpython.org/mailman/listinfo/mod_python
> >
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python

-- 
Greg Stein, http://www.lyra.org/

From neel at mediapulse.com  Mon Nov 11 13:15:19 2002
From: neel at mediapulse.com (Michael C. Neel)
Date: Fri Jan  9 21:47:06 2004
Subject: [mod_python] Default function for Publisher in 3.0
Message-ID: <C0FC22C08B82074A88B50061764157772C647F@johnson.mediapulse.net>

This is an untested guess, but I think apache needs to see "index.py" in
the document root before it will send the client a redirect to
spam.com/index.py - try doing a touch index.py in the doc root and see
what happens...

Mike

> -----Original Message-----
> From: Arcady Genkin [mailto:agenkin-lst-mod_python@thpoon.com] 
> Sent: Sunday, November 10, 2002 5:11 PM
> To: mod_python@modpython.org
> Subject: Re: [mod_python] Default function for Publisher in 3.0
> 
> 
> Arcady Genkin <agenkin-lst-mod_python@thpoon.com> writes:
> 
> > this does not seem to work with "DirectoryIndex index.py".
> 
> An update: I had a problem with configuration (using AddHandler
> directive instead of the SetHandler, as recommended in the docs).
> However, still can't use index.py implicitely.  Now the backtrace
> looks this way:
> 
> ,----
> | Mod_python error: "PythonHandler mod_python.publisher"
> | 
> | Traceback (most recent call last):
> | 
> |   File 
> "/usr/local/lib/python2.2/site-packages/mod_python/apache.py",
> |   line 335, in HandlerDispatch
> |     result = object(req)
> | 
> |   File 
> "/usr/local/lib/python2.2/site-packages/mod_python/publisher.py",
> |   line 145, in handler
> |     module = apache.import_module(module_name, 
> req.get_config(), [path])
> | 
> |   File 
> "/usr/local/lib/python2.2/site-packages/mod_python/apache.py",
> |   line 499, in import_module
> |     f, p, d = imp.find_module(parts[i], path)
> | 
> | ImportError: No module named 
> `----
> 
> The httpd.conf contains the following configuration:
> 
> ,----
> | <Directory "/var/www/data">
> |    PythonDebug On
> |    SetHandler python-program
> |    PythonHandler mod_python.publisher
> |    DirectoryIndex index.py
> | </Directory>
> `----
> 
> Something tells me that I am still doing something wrong.  I tried
> setting DIrectoryIndex to "index" instead of "index.py", but this
> still did not work.  Any ideas?
> 
> Many thanks,
> -- 
> Arcady Genkin : CDF Systems Administrator
> http://www.cdf.toronto.edu/~agenkin/contact.html
> 
> guilt is the cause of more disauders
> than history's most obscene marorders (E.E. Cummings)
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 


From jgramlich at piocon.com  Mon Nov 11 12:32:27 2002
From: jgramlich at piocon.com (Joshua Gramlich)
Date: Fri Jan  9 21:47:07 2004
Subject: [mod_python] Installation Issues - Apache2 Python2.2 RedHat
Message-ID: <021b01c289b0$b01c76a0$cb3ac341@ginworks.com>

Howdy.  I've looked through the archives and couldn't find anything in particularly specific to my issue, so here goes:

I'm trying to install mod_python with thread support (no reason, just because).  I made the jump up to Apache2, and it is working fine.  I've also got Python 2.2.1 installed.  I'm using RedHat 7.2 as my platform, and python2 is installed via source RPM(./configure'd, make'd, and make install'd).  Apache, I compiled from source.

When I configure mod python I do so like this:

./configure --with-apxs=/usr/local/apache/bin/apxs --with-python=/usr/src/redhat/SOURCES/Python-2.2.1

...and I get the following (partial):

hecking for Apache include directory... -I/usr/local/httpd-2.0.43/include
checking for --with-apache... no
configure: warning: **** No apache sources specified, static compilation will not be available.
configure: warning: **** You can use --with-apache to specify where your Apache sources are.
checking for --with-python... /usr/src/redhat/SOURCES/Python-2.2.1
checking for python... (cached) /usr/bin/python
checking Python version... 1.5
checking whether Python is compiled with thread support... yes

  ****** WARNING ******
  Python is compiled with thread support. Apache 1.3 does not use threads.
  On some systems this will cause problems during compilation, on others
  it may result in unpredictable behaviour of your Apache server. Yet on
  others it will work just fine. The recommended approach is to compile
  Python without thread support in a separate location and specify it with
  --with-python option to this ./configure script.

checking Python install prefix... /usr
checking what libraries Python was linked with... grep: /usr/src/redhat/SOURCES/Python-2.2.1/Modules/Makefile: No such file or directory
grep: /usr/src/redhat/SOURCES/Python-2.2.1/Modules/Makefile: No such file or directory
/usr/src/redhat/SOURCES/Python-2.2.1/libpython1.5.a
checking linker flags used to link Python...  -Xlinker -export-dynamic



...So anyways, I keep seeing "checking Python version...1.5" and I'm wondering if this is a problem.  Reason being, when I type "make dso" after configuring mod_python, I get this:

make dso
make[1]: Entering directory `/usr/src/mod_python-2.7.8/src'
gcc  -I/usr/src/mod_python-2.7.8/src/include -I/usr/local/httpd-2.0.43/include -I/usr/src/redhat/SOURCES/Python-2.2.1 -I/usr/src/redhat/SOURCES/Python-2.2.1/Include    -c -o mod_python.o mod_python.c
In file included from mod_python.c:54:
/usr/src/mod_python-2.7.8/src/include/mod_python.h:93: parse error before `*'
/usr/src/mod_python-2.7.8/src/include/mod_python.h:93: warning: data definition has no type or storage class
/usr/src/mod_python-2.7.8/src/include/mod_python.h:96: parse error before `python_module'
/usr/src/mod_python-2.7.8/src/include/mod_python.h:96: warning: data definition has no type or storage class
In file included from /usr/src/mod_python-2.7.8/src/include/mod_python.h:99,
                 from mod_python.c:54:
/usr/src/mod_python-2.7.8/src/include/util.h:57: parse error before `*'
In file included from /usr/src/mod_python-2.7.8/src/include/mod_python.h:100,
                 from mod_python.c:54:
/usr/src/mod_python-2.7.8/src/include/tableobject.h:69blablahblahblah....



Anyone have any ideas as to why this isn't working?


Josh
Chicago, IL
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mailman.modpython.org/pipermail/mod_python/attachments/20021111/3e9b4dca/attachment.htm
From agenkin-lst-mod_python at thpoon.com  Mon Nov 11 14:04:59 2002
From: agenkin-lst-mod_python at thpoon.com (Arcady Genkin)
Date: Fri Jan  9 21:47:07 2004
Subject: [mod_python] Default function for Publisher in 3.0
In-Reply-To: <C0FC22C08B82074A88B50061764157772C647F@johnson.mediapulse.net> ("Michael
 C. Neel"'s message of "Mon, 11 Nov 2002 13:15:19 -0500")
References: <C0FC22C08B82074A88B50061764157772C647F@johnson.mediapulse.net>
Message-ID: <uo7kfk3p2c.fsf@bashful.cdf.toronto.edu>

"Michael C. Neel" <neel@mediapulse.com> writes:

> This is an untested guess, but I think apache needs to see "index.py" in
> the document root before it will send the client a redirect to
> spam.com/index.py - try doing a touch index.py in the doc root and see
> what happens...

The document root is '/var/www/data', and I do have a script
'/var/www/data/index.py', which, in turn, has an 'index' function.
Connecting to http://spam.com/index/index and http://spam.com/index
works fine (i.e. the default function is working properly), but for
http://spam.com/ I get the backtrace, included in my previous message.

Any more ideas?
-- 
Arcady Genkin : CDF Systems Administrator
http://www.cdf.toronto.edu/~agenkin/contact.html

guilt is the cause of more disauders
than history's most obscene marorders (E.E. Cummings)

From grisha at apache.org  Mon Nov 11 15:04:58 2002
From: grisha at apache.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:47:07 2004
Subject: [mod_python] Default function for Publisher in 3.0
In-Reply-To: <C0FC22C08B82074A88B50061764157772C647F@johnson.mediapulse.net>
Message-ID: <20021111143821.W17409-100000@eden.ispol.com>

I looked at the mod_dir.c code, it looks like if you use SetHandler,
DirectoryIndex has no effect, but if you use AddHandler, DirectoryIndex
does apply, but the problem is that req.path_info in this case ends up
bing None (or NULL) as opposed to a blank string, thus the
"Unsubscriptable Object" error.

To get around this, try this patch:

--- publishre.py.old    Mon Nov 11 14:51:44 2002
+++ publisher.py        Mon Nov 11 14:50:13 2002
@@ -83,10 +83,12 @@
     if req.method not in ["GET", "POST"]:
         raise apache.SERVER_RETURN, apache.HTTP_METHOD_NOT_ALLOWED

-    func_path = req.path_info[1:] # skip first /
-    func_path = func_path.replace("/", ".")
-    if func_path[-1:] == ".":
-        func_path = func_path[:-1]
+    func_path = ""
+    if req.path_info:
+        func_path = req.path_info[1:] # skip first /
+        func_path = func_path.replace("/", ".")
+        if func_path[-1:] == ".":
+            func_path = func_path[:-1]

     # default to 'index' if no path_info was given
     if not func_path:


An imperfection with using AddHandler is that you end up with the ".py" in
your URL's.

To be able to use the best of both worlds, i.e. SetHandler and a default
module, the Publisher needs to provide its own default (since
DirectoryIndex has no effect). Here is another patch for this. Most likely
these will be in the release version (perhaps slightly modified). This
will tell the publisher to default to "index.py" is no file is specified.

--- publishre.py.old    Mon Nov 11 14:51:44 2002
+++ publisher.py        Mon Nov 11 14:50:13 2002
@@ -126,6 +128,9 @@

     ## import the script
     path, module_name =  os.path.split(req.filename)
+    if not module_name:
+        module_name = "index"

     # get rid of the suffix
     #   explanation: Suffixes that will get stripped off


Grisha

On Mon, 11 Nov 2002, Michael C. Neel wrote:

> This is an untested guess, but I think apache needs to see "index.py" in
> the document root before it will send the client a redirect to
> spam.com/index.py - try doing a touch index.py in the doc root and see
> what happens...
>
> Mike
>
> > -----Original Message-----
> > From: Arcady Genkin [mailto:agenkin-lst-mod_python@thpoon.com]
> > Sent: Sunday, November 10, 2002 5:11 PM
> > To: mod_python@modpython.org
> > Subject: Re: [mod_python] Default function for Publisher in 3.0
> >
> >
> > Arcady Genkin <agenkin-lst-mod_python@thpoon.com> writes:
> >
> > > this does not seem to work with "DirectoryIndex index.py".
> >
> > An update: I had a problem with configuration (using AddHandler
> > directive instead of the SetHandler, as recommended in the docs).
> > However, still can't use index.py implicitely.  Now the backtrace
> > looks this way:
> >
> > ,----
> > | Mod_python error: "PythonHandler mod_python.publisher"
> > |
> > | Traceback (most recent call last):
> > |
> > |   File
> > "/usr/local/lib/python2.2/site-packages/mod_python/apache.py",
> > |   line 335, in HandlerDispatch
> > |     result = object(req)
> > |
> > |   File
> > "/usr/local/lib/python2.2/site-packages/mod_python/publisher.py",
> > |   line 145, in handler
> > |     module = apache.import_module(module_name,
> > req.get_config(), [path])
> > |
> > |   File
> > "/usr/local/lib/python2.2/site-packages/mod_python/apache.py",
> > |   line 499, in import_module
> > |     f, p, d = imp.find_module(parts[i], path)
> > |
> > | ImportError: No module named
> > `----
> >
> > The httpd.conf contains the following configuration:
> >
> > ,----
> > | <Directory "/var/www/data">
> > |    PythonDebug On
> > |    SetHandler python-program
> > |    PythonHandler mod_python.publisher
> > |    DirectoryIndex index.py
> > | </Directory>
> > `----
> >
> > Something tells me that I am still doing something wrong.  I tried
> > setting DIrectoryIndex to "index" instead of "index.py", but this
> > still did not work.  Any ideas?
> >
> > Many thanks,
> > --
> > Arcady Genkin : CDF Systems Administrator
> > http://www.cdf.toronto.edu/~agenkin/contact.html
> >
> > guilt is the cause of more disauders
> > than history's most obscene marorders (E.E. Cummings)
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://www.modpython.org/mailman/listinfo/mod_python
> >
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
>



From grisha at modpython.org  Mon Nov 11 16:51:14 2002
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:47:07 2004
Subject: [mod_python] Installation Issues - Apache2 Python2.2 RedHat
In-Reply-To: <021b01c289b0$b01c76a0$cb3ac341@ginworks.com>
Message-ID: <20021111164814.J22386-100000@eden.ispol.com>

Josh -

If you're using Apache 2, you need mod_python version 3.0, currently in
beta. Mod_python 2.7.8 won't work with apache 2.

But with respect to your specific question - rm config.cache and re-run
configure. (It will report the Python version correctly, but you're still
going to have the above-mentioned apache2 problem).

Grisha

On Mon, 11 Nov 2002, Joshua Gramlich wrote:

> Howdy.  I've looked through the archives and couldn't find anything in particularly specific to my issue, so here goes:
>
> I'm trying to install mod_python with thread support (no reason, just because).  I made the jump up to Apache2, and it is working fine.  I've also got Python 2.2.1 installed.  I'm using RedHat 7.2 as my platform, and python2 is installed via source RPM(./configure'd, make'd, and make install'd).  Apache, I compiled from source.
>
> When I configure mod python I do so like this:
>
> ./configure --with-apxs=/usr/local/apache/bin/apxs --with-python=/usr/src/redhat/SOURCES/Python-2.2.1
>
> ...and I get the following (partial):
>
> hecking for Apache include directory... -I/usr/local/httpd-2.0.43/include
> checking for --with-apache... no
> configure: warning: **** No apache sources specified, static compilation will not be available.
> configure: warning: **** You can use --with-apache to specify where your Apache sources are.
> checking for --with-python... /usr/src/redhat/SOURCES/Python-2.2.1
> checking for python... (cached) /usr/bin/python
> checking Python version... 1.5
> checking whether Python is compiled with thread support... yes
>
>   ****** WARNING ******
>   Python is compiled with thread support. Apache 1.3 does not use threads.
>   On some systems this will cause problems during compilation, on others
>   it may result in unpredictable behaviour of your Apache server. Yet on
>   others it will work just fine. The recommended approach is to compile
>   Python without thread support in a separate location and specify it with
>   --with-python option to this ./configure script.
>
> checking Python install prefix... /usr
> checking what libraries Python was linked with... grep: /usr/src/redhat/SOURCES/Python-2.2.1/Modules/Makefile: No such file or directory
> grep: /usr/src/redhat/SOURCES/Python-2.2.1/Modules/Makefile: No such file or directory
> /usr/src/redhat/SOURCES/Python-2.2.1/libpython1.5.a
> checking linker flags used to link Python...  -Xlinker -export-dynamic
>
>
>
> ...So anyways, I keep seeing "checking Python version...1.5" and I'm wondering if this is a problem.  Reason being, when I type "make dso" after configuring mod_python, I get this:
>
> make dso
> make[1]: Entering directory `/usr/src/mod_python-2.7.8/src'
> gcc  -I/usr/src/mod_python-2.7.8/src/include -I/usr/local/httpd-2.0.43/include -I/usr/src/redhat/SOURCES/Python-2.2.1 -I/usr/src/redhat/SOURCES/Python-2.2.1/Include    -c -o mod_python.o mod_python.c
> In file included from mod_python.c:54:
> /usr/src/mod_python-2.7.8/src/include/mod_python.h:93: parse error before `*'
> /usr/src/mod_python-2.7.8/src/include/mod_python.h:93: warning: data definition has no type or storage class
> /usr/src/mod_python-2.7.8/src/include/mod_python.h:96: parse error before `python_module'
> /usr/src/mod_python-2.7.8/src/include/mod_python.h:96: warning: data definition has no type or storage class
> In file included from /usr/src/mod_python-2.7.8/src/include/mod_python.h:99,
>                  from mod_python.c:54:
> /usr/src/mod_python-2.7.8/src/include/util.h:57: parse error before `*'
> In file included from /usr/src/mod_python-2.7.8/src/include/mod_python.h:100,
>                  from mod_python.c:54:
> /usr/src/mod_python-2.7.8/src/include/tableobject.h:69blablahblahblah....
>
>
>
> Anyone have any ideas as to why this isn't working?
>
>
> Josh
> Chicago, IL


From jgramlich at piocon.com  Mon Nov 11 15:55:52 2002
From: jgramlich at piocon.com (Joshua Gramlich)
Date: Fri Jan  9 21:47:07 2004
Subject: [mod_python] Installation Issues - Apache2 Python2.2 RedHat
References: <20021111164814.J22386-100000@eden.ispol.com>
Message-ID: <024d01c289cd$1cf27d30$cb3ac341@ginworks.com>

I've gone and switched back to apache 1.3 for the time being.  If I get that
to work(which it looks like I will), I'll prolly consider using mod_python 3
instead, as I'm having to retool the python installs on my machine and it's
a major pain.  Plus, for whatever reason, and perhaps it just boils down to
esthetics, I'd rather have thread support built in...

Thanks,
Josh


----- Original Message -----
From: "Gregory (Grisha) Trubetskoy" <grisha@modpython.org>
To: "Joshua Gramlich" <jgramlich@piocon.com>
Cc: <mod_python@modpython.org>
Sent: Monday, November 11, 2002 3:51 PM
Subject: Re: [mod_python] Installation Issues - Apache2 Python2.2 RedHat


>
> Josh -
>
> If you're using Apache 2, you need mod_python version 3.0, currently in
> beta. Mod_python 2.7.8 won't work with apache 2.
>
> But with respect to your specific question - rm config.cache and re-run
> configure. (It will report the Python version correctly, but you're still
> going to have the above-mentioned apache2 problem).
>
> Grisha
>
> On Mon, 11 Nov 2002, Joshua Gramlich wrote:
>
> > Howdy.  I've looked through the archives and couldn't find anything in
particularly specific to my issue, so here goes:
> >
> > I'm trying to install mod_python with thread support (no reason, just
because).  I made the jump up to Apache2, and it is working fine.  I've also
got Python 2.2.1 installed.  I'm using RedHat 7.2 as my platform, and
python2 is installed via source RPM(./configure'd, make'd, and make
install'd).  Apache, I compiled from source.
> >
> > When I configure mod python I do so like this:
> >
> >
./configure --with-apxs=/usr/local/apache/bin/apxs --with-python=/usr/src/re
dhat/SOURCES/Python-2.2.1
> >
> > ...and I get the following (partial):
> >
> > hecking for Apache include
directory... -I/usr/local/httpd-2.0.43/include
> > checking for --with-apache... no
> > configure: warning: **** No apache sources specified, static compilation
will not be available.
> > configure: warning: **** You can use --with-apache to specify where your
Apache sources are.
> > checking for --with-python... /usr/src/redhat/SOURCES/Python-2.2.1
> > checking for python... (cached) /usr/bin/python
> > checking Python version... 1.5
> > checking whether Python is compiled with thread support... yes
> >
> >   ****** WARNING ******
> >   Python is compiled with thread support. Apache 1.3 does not use
threads.
> >   On some systems this will cause problems during compilation, on others
> >   it may result in unpredictable behaviour of your Apache server. Yet on
> >   others it will work just fine. The recommended approach is to compile
> >   Python without thread support in a separate location and specify it
with
> >   --with-python option to this ./configure script.
> >
> > checking Python install prefix... /usr
> > checking what libraries Python was linked with... grep:
/usr/src/redhat/SOURCES/Python-2.2.1/Modules/Makefile: No such file or
directory
> > grep: /usr/src/redhat/SOURCES/Python-2.2.1/Modules/Makefile: No such
file or directory
> > /usr/src/redhat/SOURCES/Python-2.2.1/libpython1.5.a
> > checking linker flags used to link Python...  -Xlinker -export-dynamic
> >
> >
> >
> > ...So anyways, I keep seeing "checking Python version...1.5" and I'm
wondering if this is a problem.  Reason being, when I type "make dso" after
configuring mod_python, I get this:
> >
> > make dso
> > make[1]: Entering directory `/usr/src/mod_python-2.7.8/src'
> >
gcc  -I/usr/src/mod_python-2.7.8/src/include -I/usr/local/httpd-2.0.43/inclu
de -I/usr/src/redhat/SOURCES/Python-2.2.1 -I/usr/src/redhat/SOURCES/Python-2
.2.1/Include    -c -o mod_python.o mod_python.c
> > In file included from mod_python.c:54:
> > /usr/src/mod_python-2.7.8/src/include/mod_python.h:93: parse error
before `*'
> > /usr/src/mod_python-2.7.8/src/include/mod_python.h:93: warning: data
definition has no type or storage class
> > /usr/src/mod_python-2.7.8/src/include/mod_python.h:96: parse error
before `python_module'
> > /usr/src/mod_python-2.7.8/src/include/mod_python.h:96: warning: data
definition has no type or storage class
> > In file included from
/usr/src/mod_python-2.7.8/src/include/mod_python.h:99,
> >                  from mod_python.c:54:
> > /usr/src/mod_python-2.7.8/src/include/util.h:57: parse error before `*'
> > In file included from
/usr/src/mod_python-2.7.8/src/include/mod_python.h:100,
> >                  from mod_python.c:54:
> >
/usr/src/mod_python-2.7.8/src/include/tableobject.h:69blablahblahblah....
> >
> >
> >
> > Anyone have any ideas as to why this isn't working?
> >
> >
> > Josh
> > Chicago, IL
>


From mark at camazotz.com  Mon Nov 11 17:47:38 2002
From: mark at camazotz.com (Mark Smith)
Date: Fri Jan  9 21:47:07 2004
Subject: [mod_python] building mod_python 3.0 on OS X
Message-ID: <93ECDF38-F5C7-11D6-9A20-00039364CE50@camazotz.com>

I'm trying to build mod_python 3.0b4 on OS X 10.2.  I've built Apache2
and it seems to work fine.  I've configured the mod_python build using
'--with-apxs' pointing to the version of apxs in the Apache2 bin 
directory.
The mod_python make finishes without errors, but when it's done,
src/mod_python.so is a soft link to src/.libs/mod_python.so, which
doesn't exist.  Any ideas on what (probably obvious) step I'm missing?

thanks,
Mark


From nathanr at nathanr.net  Tue Nov 12 13:15:02 2002
From: nathanr at nathanr.net (Nathan Robertson)
Date: Fri Jan  9 21:47:07 2004
Subject: [mod_python] 3.0.0 beta 4 - compile on Mac OS X
Message-ID: <3DD06426.6@nathanr.net>

Hi,

I've been fighting mod_python 3.0.0 beta 4 on Mac OS X 10.2.2 this 
morning. Compiling against apache 2.0.43, python 2.2.1. The filesystem 
is UFS, not HFS+.

Apache is configured as such:
./configure --with-mpm=threadpool --enable-so 
--prefix=/Volumes/UFS/local/httpd-2.0.43

and mod_python:
./configure --with-apxs=/Volumes/UFS/local/httpd-2.0.43/bin/apxs

make runs fine, make install breaks. Looked into it, and apxs doesn't 
create src/.libs/mod_python.so, only mod_python.lai (and the .la symlink 
to it). I tested this under Linux/PPC and Linux/i386 and both of them 
create the .so fine.

Has anyone else tried a similar setup on Mac OS X? Any successes?

Nathan.


From laurie at tratt.net  Tue Nov 12 09:19:40 2002
From: laurie at tratt.net (Laurence Tratt)
Date: Fri Jan  9 21:47:07 2004
Subject: [mod_python] 3.0.0 beta 4 - compile on Mac OS X
In-Reply-To: <3DD06426.6@nathanr.net>; from nathanr@nathanr.net on Tue, Nov 12, 2002 at 01:15:02PM +1100
References: <3DD06426.6@nathanr.net>
Message-ID: <20021112091940.B32177@purcell.dcs.kcl.ac.uk>

On Tue, Nov 12, 2002 at 01:15:02PM +1100, Nathan Robertson wrote:

[Apache and MacOS X]
> make runs fine, make install breaks. Looked into it, and apxs doesn't
> create src/.libs/mod_python.so, only mod_python.lai (and the .la symlink
> to it). I tested this under Linux/PPC and Linux/i386 and both of them
> create the .so fine.
>
> Has anyone else tried a similar setup on Mac OS X? Any successes?

Exactly the same thing happens under OpenBSD - I presume that part of our
shared BSD heritage is causing us problems. Interestingly, mod_python works
(well, builds) under FreeBSD; I have no idea about NetBSD though.

Best wishes,


Laurie

From nathanr at nathanr.net  Tue Nov 12 22:50:13 2002
From: nathanr at nathanr.net (Nathan Robertson)
Date: Fri Jan  9 21:47:07 2004
Subject: [mod_python] 3.0.0 beta 4 - compile on Mac OS X
References: <3DD06426.6@nathanr.net> <20021112091940.B32177@purcell.dcs.kcl.ac.uk>
Message-ID: <3DD0EAF5.8000007@nathanr.net>

Laurence Tratt wrote:
> On Tue, Nov 12, 2002 at 01:15:02PM +1100, Nathan Robertson wrote:
> 
> [Apache and MacOS X]
> 
>>make runs fine, make install breaks. Looked into it, and apxs doesn't
>>create src/.libs/mod_python.so, only mod_python.lai (and the .la symlink
>>to it). I tested this under Linux/PPC and Linux/i386 and both of them
>>create the .so fine.
>>
>>Has anyone else tried a similar setup on Mac OS X? Any successes?
> 
> Exactly the same thing happens under OpenBSD - I presume that part of our
> shared BSD heritage is causing us problems. Interestingly, mod_python works
> (well, builds) under FreeBSD; I have no idea about NetBSD though.

Yeah - I noted the FreeBSD note in the README, and did what it said, but 
that didn't make any difference.

Interesting that you got that on OpenBSD though. Plain wierd actually. 
Is that OpenBSD/i386 or on another platform (ppc?).

This could yet be an Apache bug in apxs, I guess. I haven't tried 
compiling any other modules against it.

Nathan.


From laurie at tratt.net  Tue Nov 12 11:51:18 2002
From: laurie at tratt.net (Laurence Tratt)
Date: Fri Jan  9 21:47:07 2004
Subject: [mod_python] 3.0.0 beta 4 - compile on Mac OS X
In-Reply-To: <3DD0EAF5.8000007@nathanr.net>; from nathanr@nathanr.net on Tue, Nov 12, 2002 at 10:50:13PM +1100
References: <3DD06426.6@nathanr.net> <20021112091940.B32177@purcell.dcs.kcl.ac.uk> <3DD0EAF5.8000007@nathanr.net>
Message-ID: <20021112115118.Q31512@purcell.dcs.kcl.ac.uk>

On Tue, Nov 12, 2002 at 10:50:13PM +1100, Nathan Robertson wrote:

[Apache and MacOS X]
>>> make runs fine, make install breaks. Looked into it, and apxs doesn't
>>> create src/.libs/mod_python.so, only mod_python.lai (and the .la symlink
>>> to it). I tested this under Linux/PPC and Linux/i386 and both of them
>>> create the .so fine.
>>>
>>> Has anyone else tried a similar setup on Mac OS X? Any successes?
>> Exactly the same thing happens under OpenBSD - I presume that part of our
>> shared BSD heritage is causing us problems. Interestingly, mod_python
>> works (well, builds) under FreeBSD; I have no idea about NetBSD though.
> Yeah - I noted the FreeBSD note in the README, and did what it said, but
> that didn't make any difference.
>
> Interesting that you got that on OpenBSD though. Plain wierd actually.
> Is that OpenBSD/i386 or on another platform (ppc?).

OpenBSD-current/i386.

> This could yet be an Apache bug in apxs, I guess. I haven't tried
> compiling any other modules against it.

I suspect it's either apxs (of which I know very little) or libtool (where
what I know I dislike). But that doesn't help me much as I am unable in a
short time scale to fix or coerce either of them :)

Best wishes,


Laurie

From jgramlich at piocon.com  Tue Nov 12 10:21:32 2002
From: jgramlich at piocon.com (Joshua Gramlich)
Date: Fri Jan  9 21:47:07 2004
Subject: [mod_python] mod_python tutorial issues
References: <20021111164814.J22386-100000@eden.ispol.com>
Message-ID: <02c401c28a67$92e1eea0$cb3ac341@ginworks.com>

Okay, my environment:

redhat linux 7.2
mod_python == most recent beta 4 of version 3 (compiled as dso)
apache == 2.0.43
python == 2.2.1 threads enabled...

Now, I'm going through the tutorial, and the little "hello world" program
seems to work just fine.  It's when I get to the authentication piece that
it messes up.  Here's the file I'm trying to "run":

################## myscript.py ##################################
from mod_python import apache

def authenhandler(req):
    pw = req.get_basic_auth_pw()
    user = req.connection.user
    if user == "spam" and pw == "eggs":
        return apache.OK
    else:
        return apache.HTTP_UNAUTHORIZED

def handler(pik):
    pik.content_type = "text/plain"
    pik.send_http_header()
    pik.write("Hello cruel World!")
    pik.write("Eat my shirt...")
    return apache.OK

#######################################################

...and the following is the error_log entry of apache when running:



[Tue Nov 12 10:03:51 2002] [notice] Graceful restart requested, doing
restart
[Tue Nov 12 10:03:57 2002] [notice] Apache/2.0.43 (Unix)
mod_python/3.0-BETA4 Python/2.2.1 configured -- resuming normal operations
[Tue Nov 12 10:05:12 2002] [error] [client 65.195.58.203]
PythonAuthenHandler myscript: Traceback (most recent call last):
[Tue Nov 12 10:05:12 2002] [error] [client 65.195.58.203]
PythonAuthenHandler myscript:   File
"/usr/lib/python2.2/site-packages/mod_python/apache.py", line 335, in
HandlerDispatch
    result = object(req)
[Tue Nov 12 10:05:12 2002] [error] [client 65.195.58.203]
PythonAuthenHandler myscript:   File
"/var/www/webroot/modpythontest/myscript.py", line 7, in authenhandler
    user = req.connection.user
[Tue Nov 12 10:05:12 2002] [error] [client 65.195.58.203]
PythonAuthenHandler myscript: AttributeError: user


Other behavior:
...when trying to access the "myscript.py" file, the internet explorer
authentication popup box appears...asking for username and password.
Whatever you enter for username and password does not matter, and every time
you hit the "OK" button, I get the Internal Server Error (see above) page
from IE.  If I hit "Cancel" instead, I get the "You must be authorized
blahblahblah...", so it looks as though the Apache portion is working...


Josh
Chicago, IL


From grisha at modpython.org  Tue Nov 12 11:56:50 2002
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:47:07 2004
Subject: [mod_python] mod_python tutorial issues
In-Reply-To: <02c401c28a67$92e1eea0$cb3ac341@ginworks.com>
Message-ID: <20021112115519.R33105-100000@eden.ispol.com>

You've mod_python 3.0, but are using the tutorial for 2.x, that's not
going to work :)

In MP 3.0 it's req.user rather than req.connection.user. Also, you don't
need send_http_header() anymore, it's a noop in MP 3.0.

Grisha

On Tue, 12 Nov 2002, Joshua Gramlich wrote:

> Okay, my environment:
>
> redhat linux 7.2
> mod_python == most recent beta 4 of version 3 (compiled as dso)
> apache == 2.0.43
> python == 2.2.1 threads enabled...
>
> Now, I'm going through the tutorial, and the little "hello world" program
> seems to work just fine.  It's when I get to the authentication piece that
> it messes up.  Here's the file I'm trying to "run":
>
> ################## myscript.py ##################################
> from mod_python import apache
>
> def authenhandler(req):
>     pw = req.get_basic_auth_pw()
>     user = req.connection.user
>     if user == "spam" and pw == "eggs":
>         return apache.OK
>     else:
>         return apache.HTTP_UNAUTHORIZED
>
> def handler(pik):
>     pik.content_type = "text/plain"
>     pik.send_http_header()
>     pik.write("Hello cruel World!")
>     pik.write("Eat my shirt...")
>     return apache.OK
>
> #######################################################
>
> ...and the following is the error_log entry of apache when running:
>
>
>
> [Tue Nov 12 10:03:51 2002] [notice] Graceful restart requested, doing
> restart
> [Tue Nov 12 10:03:57 2002] [notice] Apache/2.0.43 (Unix)
> mod_python/3.0-BETA4 Python/2.2.1 configured -- resuming normal operations
> [Tue Nov 12 10:05:12 2002] [error] [client 65.195.58.203]
> PythonAuthenHandler myscript: Traceback (most recent call last):
> [Tue Nov 12 10:05:12 2002] [error] [client 65.195.58.203]
> PythonAuthenHandler myscript:   File
> "/usr/lib/python2.2/site-packages/mod_python/apache.py", line 335, in
> HandlerDispatch
>     result = object(req)
> [Tue Nov 12 10:05:12 2002] [error] [client 65.195.58.203]
> PythonAuthenHandler myscript:   File
> "/var/www/webroot/modpythontest/myscript.py", line 7, in authenhandler
>     user = req.connection.user
> [Tue Nov 12 10:05:12 2002] [error] [client 65.195.58.203]
> PythonAuthenHandler myscript: AttributeError: user
>
>
> Other behavior:
> ...when trying to access the "myscript.py" file, the internet explorer
> authentication popup box appears...asking for username and password.
> Whatever you enter for username and password does not matter, and every time
> you hit the "OK" button, I get the Internal Server Error (see above) page
> from IE.  If I hit "Cancel" instead, I get the "You must be authorized
> blahblahblah...", so it looks as though the Apache portion is working...
>
>
> Josh
> Chicago, IL
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
>


From jgramlich at piocon.com  Tue Nov 12 10:59:33 2002
From: jgramlich at piocon.com (Joshua Gramlich)
Date: Fri Jan  9 21:47:07 2004
Subject: [mod_python] mod_python tutorial issues
References: <20021112115519.R33105-100000@eden.ispol.com>
Message-ID: <02e801c28a6c$e0015540$cb3ac341@ginworks.com>

Well, that is helpful.  Am I to assume that I should really be using the
docs that came with modpython3 rather than www.modpython.org?  Boy, am I
lazy....


Josh



----- Original Message -----
From: "Gregory (Grisha) Trubetskoy" <grisha@modpython.org>
To: "Joshua Gramlich" <jgramlich@piocon.com>
Cc: <mod_python@modpython.org>
Sent: Tuesday, November 12, 2002 10:56 AM
Subject: Re: [mod_python] mod_python tutorial issues


>
> You've mod_python 3.0, but are using the tutorial for 2.x, that's not
> going to work :)
>
> In MP 3.0 it's req.user rather than req.connection.user. Also, you don't
> need send_http_header() anymore, it's a noop in MP 3.0.
>
> Grisha
>
> On Tue, 12 Nov 2002, Joshua Gramlich wrote:
>
> > Okay, my environment:
> >
> > redhat linux 7.2
> > mod_python == most recent beta 4 of version 3 (compiled as dso)
> > apache == 2.0.43
> > python == 2.2.1 threads enabled...
> >
> > Now, I'm going through the tutorial, and the little "hello world"
program
> > seems to work just fine.  It's when I get to the authentication piece
that
> > it messes up.  Here's the file I'm trying to "run":
> >
> > ################## myscript.py ##################################
> > from mod_python import apache
> >
> > def authenhandler(req):
> >     pw = req.get_basic_auth_pw()
> >     user = req.connection.user
> >     if user == "spam" and pw == "eggs":
> >         return apache.OK
> >     else:
> >         return apache.HTTP_UNAUTHORIZED
> >
> > def handler(pik):
> >     pik.content_type = "text/plain"
> >     pik.send_http_header()
> >     pik.write("Hello cruel World!")
> >     pik.write("Eat my shirt...")
> >     return apache.OK
> >
> > #######################################################
> >
> > ...and the following is the error_log entry of apache when running:
> >
> >
> >
> > [Tue Nov 12 10:03:51 2002] [notice] Graceful restart requested, doing
> > restart
> > [Tue Nov 12 10:03:57 2002] [notice] Apache/2.0.43 (Unix)
> > mod_python/3.0-BETA4 Python/2.2.1 configured -- resuming normal
operations
> > [Tue Nov 12 10:05:12 2002] [error] [client 65.195.58.203]
> > PythonAuthenHandler myscript: Traceback (most recent call last):
> > [Tue Nov 12 10:05:12 2002] [error] [client 65.195.58.203]
> > PythonAuthenHandler myscript:   File
> > "/usr/lib/python2.2/site-packages/mod_python/apache.py", line 335, in
> > HandlerDispatch
> >     result = object(req)
> > [Tue Nov 12 10:05:12 2002] [error] [client 65.195.58.203]
> > PythonAuthenHandler myscript:   File
> > "/var/www/webroot/modpythontest/myscript.py", line 7, in authenhandler
> >     user = req.connection.user
> > [Tue Nov 12 10:05:12 2002] [error] [client 65.195.58.203]
> > PythonAuthenHandler myscript: AttributeError: user
> >
> >
> > Other behavior:
> > ...when trying to access the "myscript.py" file, the internet explorer
> > authentication popup box appears...asking for username and password.
> > Whatever you enter for username and password does not matter, and every
time
> > you hit the "OK" button, I get the Internal Server Error (see above)
page
> > from IE.  If I hit "Cancel" instead, I get the "You must be authorized
> > blahblahblah...", so it looks as though the Apache portion is working...
> >
> >
> > Josh
> > Chicago, IL
> >
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://www.modpython.org/mailman/listinfo/mod_python
> >
>


From grisha at modpython.org  Tue Nov 12 12:00:53 2002
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:47:07 2004
Subject: [mod_python] 3.0.0 beta 4 - compile on Mac OS X
In-Reply-To: <20021112091940.B32177@purcell.dcs.kcl.ac.uk>
Message-ID: <20021112115805.K33105-100000@eden.ispol.com>

This may be a problem with Apache 2.0.43 which has a slightly screwed up
distribution file which comes with an outdated libtool.

I don't know if it will help or not, but try running ./buildconf in Apache
source tree before running ./configure.

Grisha

On Tue, 12 Nov 2002, Laurence Tratt wrote:

> On Tue, Nov 12, 2002 at 01:15:02PM +1100, Nathan Robertson wrote:
>
> [Apache and MacOS X]
> > make runs fine, make install breaks. Looked into it, and apxs doesn't
> > create src/.libs/mod_python.so, only mod_python.lai (and the .la symlink
> > to it). I tested this under Linux/PPC and Linux/i386 and both of them
> > create the .so fine.
> >
> > Has anyone else tried a similar setup on Mac OS X? Any successes?
>
> Exactly the same thing happens under OpenBSD - I presume that part of our
> shared BSD heritage is causing us problems. Interestingly, mod_python works
> (well, builds) under FreeBSD; I have no idea about NetBSD though.
>
> Best wishes,
>
>
> Laurie
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
>


From laurie at tratt.net  Tue Nov 12 23:56:52 2002
From: laurie at tratt.net (Laurence Tratt)
Date: Fri Jan  9 21:47:07 2004
Subject: [mod_python] 3.0.0 beta 4 - compile on Mac OS X
In-Reply-To: <20021112115805.K33105-100000@eden.ispol.com>; from grisha@modpython.org on Tue, Nov 12, 2002 at 12:00:53PM -0500
References: <20021112091940.B32177@purcell.dcs.kcl.ac.uk> <20021112115805.K33105-100000@eden.ispol.com>
Message-ID: <20021112235651.B2626@purcell.dcs.kcl.ac.uk>

On Tue, Nov 12, 2002 at 12:00:53PM -0500, Gregory (Grisha) Trubetskoy wrote:

> This may be a problem with Apache 2.0.43 which has a slightly screwed up
> distribution file which comes with an outdated libtool.
>
> I don't know if it will help or not, but try running ./buildconf in Apache
> source tree before running ./configure.

I haven't had a chance to interpret this yet but doing this gives me a
different error, which does at look least a little more likely to be
resolveable:

"""
/usr/local/apache2/build/libtool --silent --mode=link gcc -o mod_python.la
-I/usr/local/src/mod_python-3.0.0-BETA4/src/include
-I/usr/local/apache2/include -I/usr/local/include/python2.2  -rpath
/usr/local/apache2/modules -module -avoid-version  hlistobject.lo hlist.lo
filterobject.lo connobject.lo serverobject.lo util.lo tableobject.lo
requestobject.lo _apachemodule.lo mod_python.lo
-L/usr/ports/lang/python/2.2/w-python-2.2.1/Python-2.2.1 -lm
/usr/local/lib/python2.2/config/libpython2.2.a -pthread -lutil -lm
libtool: link: cannot build libtool library `mod_python.la' from non-libtool
objects: /usr/local/lib/python2.2/config/libpython2.2.a
apxs:Error: Command failed with rc=65536
"""

Now whether that's a MacOS X|OpenBSD thing that Python didn't use libtool
to build I don't currently know, but I'll try and look into it over the
next couple of days. If anyone has any clues, of course they'd be more than
welcome!

Best wishes,


Laurie

From gbenson at redhat.com  Wed Nov 13 10:22:35 2002
From: gbenson at redhat.com (Gary Benson)
Date: Fri Jan  9 21:47:07 2004
Subject: [mod_python] Apache 1.3, mod_python, and threads
Message-ID: <20021113102233.GA21664@redhat.com>

I'm pretty sure that this is the case, but could someone confirm that
it is _not_ possible to build mod_python-2.7.8 for Apache 1.3 against
Python 2.2 unless Python is built without threads.  Also, assuming
that is true, does anyone know why this is the case (apart from
'because python dies in apache startup' ;))

Thanks in advance,
Gary

[ gbenson@redhat.com ][ GnuPG 85A8F78B ][ http://inauspicious.org/ ]

From nathanr at nathanr.net  Wed Nov 13 21:41:10 2002
From: nathanr at nathanr.net (Nathan Robertson)
Date: Fri Jan  9 21:47:07 2004
Subject: [mod_python] 3.0.0 beta 4 - compile on Mac OS X
References: <20021112091940.B32177@purcell.dcs.kcl.ac.uk> <20021112115805.K33105-100000@eden.ispol.com> <20021112235651.B2626@purcell.dcs.kcl.ac.uk>
Message-ID: <3DD22C46.6000302@nathanr.net>

MacOS X gives exactly the same error message as that when making mod_python.

Nathan

Laurence Tratt wrote:
> On Tue, Nov 12, 2002 at 12:00:53PM -0500, Gregory (Grisha) Trubetskoy wrote:
> 
> 
>>This may be a problem with Apache 2.0.43 which has a slightly screwed up
>>distribution file which comes with an outdated libtool.
>>
>>I don't know if it will help or not, but try running ./buildconf in Apache
>>source tree before running ./configure.
> 
> 
> I haven't had a chance to interpret this yet but doing this gives me a
> different error, which does at look least a little more likely to be
> resolveable:
> 
> """
> /usr/local/apache2/build/libtool --silent --mode=link gcc -o mod_python.la
> -I/usr/local/src/mod_python-3.0.0-BETA4/src/include
> -I/usr/local/apache2/include -I/usr/local/include/python2.2  -rpath
> /usr/local/apache2/modules -module -avoid-version  hlistobject.lo hlist.lo
> filterobject.lo connobject.lo serverobject.lo util.lo tableobject.lo
> requestobject.lo _apachemodule.lo mod_python.lo
> -L/usr/ports/lang/python/2.2/w-python-2.2.1/Python-2.2.1 -lm
> /usr/local/lib/python2.2/config/libpython2.2.a -pthread -lutil -lm
> libtool: link: cannot build libtool library `mod_python.la' from non-libtool
> objects: /usr/local/lib/python2.2/config/libpython2.2.a
> apxs:Error: Command failed with rc=65536
> """
> 
> Now whether that's a MacOS X|OpenBSD thing that Python didn't use libtool
> to build I don't currently know, but I'll try and look into it over the
> next couple of days. If anyone has any clues, of course they'd be more than
> welcome!
> 
> Best wishes,
> 
> 
> Laurie
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 
> 




From gbenson at redhat.com  Wed Nov 13 10:49:08 2002
From: gbenson at redhat.com (Gary Benson)
Date: Fri Jan  9 21:47:07 2004
Subject: [mod_python] Apache 1.3, mod_python, and threads
In-Reply-To: <200211131224.19230.mateusz@ant.gliwice.pl>
References: <20021113102233.GA21664@redhat.com> <200211131224.19230.mateusz@ant.gliwice.pl>
Message-ID: <20021113104908.GB21664@redhat.com>

On Wed, Nov 13, 2002 at 12:24:19PM +0100, Mateusz Korniak wrote:
> On Wednesday 13 November 2002 11:22, Gary Benson wrote:
> > I'm pretty sure that this is the case, but could someone confirm that
> > it is _not_ possible to build mod_python-2.7.8 for Apache 1.3 against
> > Python 2.2 unless Python is built without threads.
> 
> I might missed start of thread, but

Nope, that message is the only one in it 

> I pretty sure _I'm_ _able_ to build, and extensively use mod_python
> with both python 2.2.1 and 2.2.2, and both compiled with threads.

This is with Apache 1.3?  I have Apache 1.3.23, Python 2.2 and
mod_python 2.7.8.  If I build Python with threads then Apache dies on
startup with the malformed error message "alize: can't make modules
dictionary"

Maybe the problem is Python 2.2 as opposed to 2.2.1/2.2.2.  I'll try
with one of those.

Cheers,
Gary

[ gbenson@redhat.com ][ GnuPG 85A8F78B ][ http://inauspicious.org/ ]

From mateusz at ant.gliwice.pl  Wed Nov 13 13:22:38 2002
From: mateusz at ant.gliwice.pl (Mateusz Korniak)
Date: Fri Jan  9 21:47:07 2004
Subject: [mod_python] Apache 1.3, mod_python, and threads
In-Reply-To: <20021113104908.GB21664@redhat.com>
References: <20021113102233.GA21664@redhat.com> <200211131224.19230.mateusz@ant.gliwice.pl> <20021113104908.GB21664@redhat.com>
Message-ID: <200211131322.38756.mateusz@ant.gliwice.pl>

On Wednesday 13 November 2002 11:49, Gary Benson wrote:

> > I pretty sure _I'm_ _able_ to build, and extensively use mod_python
> > with both python 2.2.1 and 2.2.2, and both compiled with threads.
>
> This is with Apache 1.3?  I have Apache 1.3.23, Python 2.2 and
> mod_python 2.7.8.  If I build Python with threads then Apache dies on
> startup with the malformed error message "alize: can't make modules
> dictionary"

[matkor@appserver ~]$ rpm -q apache
apache-1.3.27-3
[matkor@appserver ~]$ rpm -q apache-mod_python
apache-mod_python-2.7.8-6
[matkor@appserver ~]$ rpm -q python
python-2.2.2-1

( All specs used to build those rpms are on http://www.pld.org.pl/devel/cvs/ 
there should be alse src rpms ...)

[matkor@appserver ~]$ python
Python 2.2.2 (#1, Nov  9 2002, 21:07:57)
[GCC 2.95.4 20010319 (prerelease)] on linux2
Type "help", "copyright", "credits" or "license" for more information.
>>> import thread
>>>

> Maybe the problem is Python 2.2 as opposed to 2.2.1/2.2.2.  I'll try
> with one of those.

I had only problems with mod_python itself but only  when I tried use 
mod_python dynlinked .. but symptoms ware different - segfault on first use 
of mod_python.


-- 
Mateusz Korniak



From antonio at memora.com  Wed Nov 13 07:40:54 2002
From: antonio at memora.com (Antonio L Rodriguez)
Date: Fri Jan  9 21:47:07 2004
Subject: [mod_python] Apache 1.3, mod_python, and threads
In-Reply-To: <20021113102233.GA21664@redhat.com>
Message-ID: <2658F540-F705-11D6-A9E6-00039300D690@memora.com>

I've built it wit threads on debian 3.0/Intel  (apache 1.3.26) no 
problem.

I'm not sure its advised however, though as you've probably seen in the 
docs. My approach has been that so long as I stay away from thread 
usage in the scripts I should be ok but I haven't verified this too 
seriously.

AR

On Wednesday, November 13, 2002, at 05:22 AM, Gary Benson wrote:

> I'm pretty sure that this is the case, but could someone confirm that
> it is _not_ possible to build mod_python-2.7.8 for Apache 1.3 against
> Python 2.2 unless Python is built without threads.  Also, assuming
> that is true, does anyone know why this is the case (apart from
> 'because python dies in apache startup' ;))
>
> Thanks in advance,
> Gary
>
> [ gbenson@redhat.com ][ GnuPG 85A8F78B ][ http://inauspicious.org/ ]
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
>


From antonio at memora.com  Wed Nov 13 09:15:19 2002
From: antonio at memora.com (Antonio L Rodriguez)
Date: Fri Jan  9 21:47:07 2004
Subject: [mod_python] Funky publisher behavior under apache 1.3
Message-ID: <56B386A8-F712-11D6-A9E6-00039300D690@memora.com>

Hey all,

I've been playing around with the publisher but have been having some 
issues. First, I get this in my apache logs all the time:

[Wed Nov 13 08:49:01 2002] [notice] mod_python: (Re)importing 
mod_python.publisher from None


This happens even when the underlying files do not change (either the 
script or the publisher.py file ).

Second, I'm getting erratic behavior where the publisher will find a 
function one time and then generate a 404 a couple of requests later 
for no apparent reason.

I am using python 2.2.2 with threads but this hasn't been a problem in 
the past and I'm not actually using the threading libs. in my script.

Anyone run into this type of behavior with publisher.py?

Thanks

AR


From gbenson at redhat.com  Wed Nov 13 14:45:45 2002
From: gbenson at redhat.com (Gary Benson)
Date: Fri Jan  9 21:47:07 2004
Subject: [mod_python] Apache 1.3, mod_python, and threads
In-Reply-To: <20021113104908.GB21664@redhat.com>
References: <20021113102233.GA21664@redhat.com> <200211131224.19230.mateusz@ant.gliwice.pl> <20021113104908.GB21664@redhat.com>
Message-ID: <20021113144543.GC21664@redhat.com>

On Wed, Nov 13, 2002 at 10:49:08AM +0000, Gary Benson wrote:
> On Wed, Nov 13, 2002 at 12:24:19PM +0100, Mateusz Korniak wrote:
> > I pretty sure _I'm_ _able_ to build, and extensively use mod_python
> > with both python 2.2.1 and 2.2.2, and both compiled with threads.
> 
> This is with Apache 1.3?  I have Apache 1.3.23, Python 2.2 and
> mod_python 2.7.8.  If I build Python with threads then Apache dies on
> startup with the malformed error message "alize: can't make modules
> dictionary"
> 
> Maybe the problem is Python 2.2 as opposed to 2.2.1/2.2.2.  I'll try
> with one of those.

I upgraded from 2.2 to 2.2.1 and the problem went away; thanks guys!

Gary

[ gbenson@redhat.com ][ GnuPG 85A8F78B ][ http://inauspicious.org/ ]

From vmanera at manord.com  Wed Nov 13 15:52:10 2002
From: vmanera at manord.com (Manera, Villiam)
Date: Fri Jan  9 21:47:07 2004
Subject: R: [mod_python] Funky publisher behavior under apache 1.3
Message-ID: <52DC70C1C1575C418CB033523A29CF140E0527@exchange2000.manord.com>

I've submitted the same problem the 17 October, and is still a problem:
From: Manera, Villiam <vmanera@manord.com>
To: 'mod_python@modpython.org' <mod_python@modpython.org>
Date: 17 October 2002 19:13
Subject: [mod_python] strange behavior of mod-python


>
>I'm currently use mod-python 2.7.6 on apache 1.3.26 - windows 2000 with
>python 2.2
>apache config:
>.....
>    ScriptAlias /comm/ "E:/script/cgi/comm/"
>    ScriptAlias /tecnico/ "E:/script/cgi/tecnico/"
>....
><Directory "E:/script/cgi/comm">
>        Order Deny,Allow
>        Deny from all
>        Allow from .....
>       ...
>    AddHandler python-program .py
>    PythonHandler mod_python.publisher
> PythonPath "sys.path+['c:/program
>files/python22/lib/site-packages/mdnlib', 'c:/program
>files/python22/lib/site-packages/HTMLgen','E:/script/cgi/comm']"
>    PythonDebug on
>    </Directory>
>
>----------------------------------------------------
>all work fine, but sometimes (today 4 time) when a url is typed:
>http://sviluppo.manord.com/comm/comm_ocordiu0.py/main?....
>
>I have this behavior from apache:
>HTTP 404 - File non trovato (not found)
>Internet Explorer
>but the program is still in place, and the only way to force apache to
found
>the program is restart the apache services,
>or make a copy of comm_ocordiu0 in comm_ocordiu1 and then call this one,
>but....
>
>
>
>this is not a real problem in developement web server, but  today it
>happened 4 time, in production is happened 2 time in one month,
>and I become in panic.
>
>Any advice here would be greatly appreciated.
>
>Villiam

-----Messaggio originale-----
Da: Antonio L Rodriguez [mailto:antonio@memora.com]
Inviato: mercoled? 13 novembre 2002 15.15
A: mod_python@modpython.org
Oggetto: [mod_python] Funky publisher behavior under apache 1.3


Hey all,

I've been playing around with the publisher but have been having some 
issues. First, I get this in my apache logs all the time:

[Wed Nov 13 08:49:01 2002] [notice] mod_python: (Re)importing 
mod_python.publisher from None


This happens even when the underlying files do not change (either the 
script or the publisher.py file ).

Second, I'm getting erratic behavior where the publisher will find a 
function one time and then generate a 404 a couple of requests later 
for no apparent reason.

I am using python 2.2.2 with threads but this hasn't been a problem in 
the past and I'm not actually using the threading libs. in my script.

Anyone run into this type of behavior with publisher.py?

Thanks

AR

_______________________________________________
Mod_python mailing list
Mod_python@modpython.org
http://www.modpython.org/mailman/listinfo/mod_python


From jquinte at fadu.uba.ar  Wed Nov 13 13:21:01 2002
From: jquinte at fadu.uba.ar (Javier Quinteros)
Date: Fri Jan  9 21:47:07 2004
Subject: [mod_python] =?iso-8859-1?Q?Comp=EClation?= error in Solaris 8...
Message-ID: <3DD27BED.CF84CFA2@fadu.uba.ar>

Hi !!!
I've seen a problem like this posted before but there was no
satisfactory answer.

I'm using Solaris 8, Apache 1.3.26, Python 2.2.1 and ModPython 2.7.8.

This are the steps I execute:
* ./configure --with-apache=/usr/...........
* make static
* make install

Then I move to the apache source directory and:

* ./configure (as specified in modpython instructions)
* make

Then I get an error telling me that there are "Undefined Symbols" (about
40). All of them are Python Symbols (PySequence, etc.).

The only answer I've found in the archives is from a Brasilian guy
telling that the libmodpython.a has to be compiled with the -fpic flag
when using gcc.

Please, I need a solution ASAP.

Thanks in advance.

Javier Quinteros
Universidad de Buenos Aires



From jwyant at sfbcic.com  Wed Nov 13 12:46:03 2002
From: jwyant at sfbcic.com (Wyant, Jaime)
Date: Fri Jan  9 21:47:07 2004
Subject: [mod_python] Write errors (client closed connection)
Message-ID: <654DAEACA633D511B5F500902784B052188EE1@MS-EXCHANGE>

What usually causes a webbrowser to close a connection?  I assume the user
"closes" their browser which closes the connection.

I usually get this exception:

IOError: Write failed, client closed connection. 

Can anyone elaborate?

Thanks!
jaime wyant (jwyant@sfbcic . com)
MS Farm Bureau
(601) 977 - 4291



From grisha at modpython.org  Wed Nov 13 15:10:53 2002
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:47:07 2004
Subject: [mod_python] Write errors (client closed connection)
In-Reply-To: <654DAEACA633D511B5F500902784B052188EE1@MS-EXCHANGE>
Message-ID: <20021113151011.P48789-100000@eden.ispol.com>

I think this will happen if they click the "stop" button also.

On Wed, 13 Nov 2002, Wyant, Jaime wrote:

> What usually causes a webbrowser to close a connection?  I assume the user
> "closes" their browser which closes the connection.
>
> I usually get this exception:
>
> IOError: Write failed, client closed connection.
>
> Can anyone elaborate?
>
> Thanks!
> jaime wyant (jwyant@sfbcic . com)
> MS Farm Bureau
> (601) 977 - 4291
>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
>


From agenkin-lst-mod_python at thpoon.com  Thu Nov 14 15:32:28 2002
From: agenkin-lst-mod_python at thpoon.com (Arcady Genkin)
Date: Fri Jan  9 21:47:07 2004
Subject: [mod_python] SetHandler and a subdirectory with static contents (images)
Message-ID: <uoel9nc2oz.fsf@bashful.cdf.toronto.edu>

I cannot send image files when using the Publisher handler: apache
tries to run them as Python programs. ;^)  I tried setting to handler
for the images directory to the default, but it didn't work.  With
Apache 2.0.43 and mod_python-3.0B4, I have the following config:

,----[ httpd.conf ]
| <Directory "/var/www/data">
|    PythonDebug On
|    SetHandler python-program
|    PythonHandler mod_python.publisher
| </Directory>
| 
| <Directory "/var/www/data/images">
|   SetHandler default-handler
| </Directory>
`----

Since /var/www/data is the DocumentRoot, I cannot place the images in
a directory outside of it...

What am I doing wrong?
-- 
Arcady Genkin

guilt is the cause of more disauders
than history's most obscene marorders (E.E. Cummings)

From vmilitaru at sympatico.ca  Thu Nov 14 21:00:38 2002
From: vmilitaru at sympatico.ca (vio)
Date: Fri Jan  9 21:47:07 2004
Subject: [mod_python] SetHandler and a subdirectory with static contents 
 (images)
References: <uoel9nc2oz.fsf@bashful.cdf.toronto.edu>
Message-ID: <3DD45546.DA2BB937@sympatico.ca>

Looks like you forgot to include the python suffix, which restricts what
file types are to be handled by mod_python.publisher. Try it like this:

<IfModule mod_python.c>
<Directory /var/www/data>
    AddHandler python-program .py
    PythonHandler mod_python.publisher
    PythonDebug On
</Directory>
</IfModule>

Cheer,
Vio


Arcady Genkin wrote:

> I cannot send image files when using the Publisher handler: apache
> tries to run them as Python programs. ;^)  I tried setting to handler
> for the images directory to the default, but it didn't work.  With
> Apache 2.0.43 and mod_python-3.0B4, I have the following config:
>
> ,----[ httpd.conf ]
> | <Directory "/var/www/data">
> |    PythonDebug On
> |    SetHandler python-program
> |    PythonHandler mod_python.publisher
> | </Directory>
> |
> | <Directory "/var/www/data/images">
> |   SetHandler default-handler
> | </Directory>
> `----
>
> Since /var/www/data is the DocumentRoot, I cannot place the images in
> a directory outside of it...
>
> What am I doing wrong?
> --
> Arcady Genkin
>
> guilt is the cause of more disauders
> than history's most obscene marorders (E.E. Cummings)
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python


From Antonio at Memora.com  Thu Nov 14 21:21:43 2002
From: Antonio at Memora.com (Antonio Rodriguez)
Date: Fri Jan  9 21:47:07 2004
Subject: [mod_python] The story with python compiled with threads
References: <uoel9nc2oz.fsf@bashful.cdf.toronto.edu> <3DD45546.DA2BB937@sympatico.ca>
Message-ID: <000d01c28c4d$bdc48aa0$6b01a8c0@borg>

To those wiser in mod_python,

So the README says to definitely *NOT* use mod_python with python compiled
with threads in apache 1.3, but I bet that many people do anyway. What is
the story with what can go wrong? That is, I've heard of the apache
processes dying from the start and obviously using threads in your scripts
probably isn't cool, but what if mod_python seems to run ok most of the
time.

The basic question is this: what can happen if we use mod_python with python
with threads support in terms of partial failure?


Thanks

Antonio




From jack_diederich at email.com  Thu Nov 14 18:08:37 2002
From: jack_diederich at email.com (Jack Diederich)
Date: Fri Jan  9 21:47:08 2004
Subject: [mod_python] Write errors (client closed connection)
Message-ID: <20021114230837.8439.qmail@email.com>

This is also why apache recomends you run a proxy server in front of
your dynamic perl/python/whatever server.  The proxy server gets the client
close, but the mod_python server runs the process to completion.  If
you depend on something running all the way through without errors
(your code is bug free, right?) then you should really have a proxy
server in between you and the big bad world.

-jack

----- Original Message -----
From: "Gregory (Grisha) Trubetskoy" <grisha@modpython.org>
> 
> I think this will happen if they click the "stop" button also.
> 

-- 
_______________________________________________
Sign-up for your own FREE Personalized E-mail at Mail.com
http://www.mail.com/?sr=signup

Single & ready to mingle? lavalife.com:  Where singles click. Free to Search!
http://www.lavalife.com/wp.epl?a=2716


From gstein at lyra.org  Thu Nov 14 13:51:38 2002
From: gstein at lyra.org (Greg Stein)
Date: Fri Jan  9 21:47:08 2004
Subject: [mod_python] Write errors (client closed connection)
In-Reply-To: <20021113151011.P48789-100000@eden.ispol.com>; from grisha@modpython.org on Wed, Nov 13, 2002 at 03:10:53PM -0500
References: <654DAEACA633D511B5F500902784B052188EE1@MS-EXCHANGE> <20021113151011.P48789-100000@eden.ispol.com>
Message-ID: <20021114135138.K13799@lyra.org>

Yup, definitely. The client closes their side, but the server won't notice
that until it tries to write to the socket. Normally, this raises SIGPIPE,
but it appears somebody has caught/ignored that, so you just get the error.

Cheers,
-g

On Wed, Nov 13, 2002 at 03:10:53PM -0500, Gregory (Grisha) Trubetskoy wrote:
> 
> I think this will happen if they click the "stop" button also.
> 
> On Wed, 13 Nov 2002, Wyant, Jaime wrote:
> 
> > What usually causes a webbrowser to close a connection?  I assume the user
> > "closes" their browser which closes the connection.
> >
> > I usually get this exception:
> >
> > IOError: Write failed, client closed connection.
> >
> > Can anyone elaborate?
> >
> > Thanks!
> > jaime wyant (jwyant@sfbcic . com)
> > MS Farm Bureau
> > (601) 977 - 4291
> >
> >
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://www.modpython.org/mailman/listinfo/mod_python
> >
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python

-- 
Greg Stein, http://www.lyra.org/

From sandor.kopanyi at mailbox.hu  Fri Nov 15 16:27:21 2002
From: sandor.kopanyi at mailbox.hu (sandor.kopanyi@mailbox.hu)
Date: Fri Jan  9 21:47:08 2004
Subject: [mod_python] permanent db connection (more than in FAQ 3.3)
Message-ID: <20021115152721.7694.qmail@web2.mailbox.hu>

Hi,

In the mod_python FAQ 3.3 there is a good example of a 'permanent'
database
connection. This works fine, the connection is reused, as long as the
request
is handled in the same child process (apache child process). But a new
child
process gets a new interpreter => new connection is created. At least
that's
what I guess.

I've tried the Python*Interp* directives, but the connection is
re-created
regardless of those directives. Am I doing something wrong?

E.g. when setting PythonInterpeter to something (e.g. blabla), the
connection
is recreated again and again.

Any ideeas?

I'm using apache 1.3.23 with mod_python 2.7.6 on RedHat 7.3; the
application
is based on the publisher handler; the db connection code is almost
copy-paste from
the FAQ.

Best regards,
Sandor


________________________________________________
http://mailbox.hu - M?r SMS ?rtes?t?ssel is!



From mateusz at ant.gliwice.pl  Fri Nov 15 16:38:47 2002
From: mateusz at ant.gliwice.pl (Mateusz Korniak)
Date: Fri Jan  9 21:47:08 2004
Subject: [mod_python] permanent db connection (more than in FAQ 3.3)
In-Reply-To: <20021115152721.7694.qmail@web2.mailbox.hu>
References: <20021115152721.7694.qmail@web2.mailbox.hu>
Message-ID: <200211151638.47175.mateusz@ant.gliwice.pl>

On Friday 15 November 2002 16:27, sandor.kopanyi@mailbox.hu wrote:
> Hi,
>
> In the mod_python FAQ 3.3 there is a good example of a 'permanent'
> database
> connection. This works fine, the connection is reused, as long as the
> request
> is handled in the same child process (apache child process). But a new
> child
> process gets a new interpreter => new connection is created. At least
> that's
> what I guess.

Yes.
I keep one connection per each apache process.

-- 
Mateusz Korniak
"Black holes are where God divided by zero." - Steven Wright


From grisha at modpython.org  Fri Nov 15 11:25:41 2002
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:47:08 2004
Subject: [mod_python] permanent db connection (more than in FAQ 3.3)
In-Reply-To: <20021115152721.7694.qmail@web2.mailbox.hu>
Message-ID: <20021115112129.C74246-100000@eden.ispol.com>

There isn't much you can do about this - the connections are only reused
within the same process, a new process will create a new connection.

PythonInterpreter's scope does not extend beyond a process, i.e. a seprate
process is a separate process, a separate memory space, a different
interpreter, etc.

Hope this clarifies it a bit.

Grisha

On Fri, 15 Nov 2002 sandor.kopanyi@mailbox.hu wrote:

> Hi,
>
> In the mod_python FAQ 3.3 there is a good example of a 'permanent'
> database connection. This works fine, the connection is reused, as long
> as the request is handled in the same child process (apache child
> process). But a new child process gets a new interpreter => new
> connection is created. At least that's what I guess.
>
> I've tried the Python*Interp* directives, but the connection is
> re-created regardless of those directives. Am I doing something wrong?
>
> E.g. when setting PythonInterpeter to something (e.g. blabla), the
> connection is recreated again and again.
>
> Any ideeas?
>
> I'm using apache 1.3.23 with mod_python 2.7.6 on RedHat 7.3; the
> application is based on the publisher handler; the db connection code is
> almost copy-paste from the FAQ.
>
> Best regards,
> Sandor
>
>
> ________________________________________________
> http://mailbox.hu - M?r SMS ?rtes?t?ssel is!
>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
>


From agenkin-lst-mod_python at thpoon.com  Sat Nov 16 20:24:19 2002
From: agenkin-lst-mod_python at thpoon.com (Arcady Genkin)
Date: Fri Jan  9 21:47:08 2004
Subject: [mod_python] SetHandler and a subdirectory with static contents 
 (images)
In-Reply-To: <3DD45546.DA2BB937@sympatico.ca> (vio's message of "Thu, 14 Nov
 2002 21:00:38 -0500")
References: <uoel9nc2oz.fsf@bashful.cdf.toronto.edu>
	<3DD45546.DA2BB937@sympatico.ca>
Message-ID: <uowund3s58.fsf@bashful.cdf.toronto.edu>

vio <vmilitaru@sympatico.ca> writes:

> Looks like you forgot to include the python suffix, which restricts what
> file types are to be handled by mod_python.publisher. Try it like this:
>
> <IfModule mod_python.c>
> <Directory /var/www/data>
>     AddHandler python-program .py
>     PythonHandler mod_python.publisher
>     PythonDebug On
> </Directory>
> </IfModule>

Note that I am using the SetHandler directive (not AddHandler), which
does not require the file extension.  This is the recommended
configuration directive for 3.0, as per the docs.

Can anybody tell me how to work around this?

> Arcady Genkin wrote:
>
>> I cannot send image files when using the Publisher handler: apache
>> tries to run them as Python programs. ;^)  I tried setting to handler
>> for the images directory to the default, but it didn't work.  With
>> Apache 2.0.43 and mod_python-3.0B4, I have the following config:
>>
>> ,----[ httpd.conf ]
>> | <Directory "/var/www/data">
>> |    PythonDebug On
>> |    SetHandler python-program
>> |    PythonHandler mod_python.publisher
>> | </Directory>
>> |
>> | <Directory "/var/www/data/images">
>> |   SetHandler default-handler
>> | </Directory>
>> `----
>>
>> Since /var/www/data is the DocumentRoot, I cannot place the images in
>> a directory outside of it...
>>
>> What am I doing wrong?

-- 
Arcady Genkin : CDF Systems Administrator
http://www.cdf.toronto.edu/~agenkin/contact.html

guilt is the cause of more disauders
than history's most obscene marorders (E.E. Cummings)

From mateusz at ant.gliwice.pl  Mon Nov 18 11:45:52 2002
From: mateusz at ant.gliwice.pl (Mateusz Korniak)
Date: Fri Jan  9 21:47:08 2004
Subject: [mod_python] Using gzip module with mod_gzip enabled apache breaks things ?
Message-ID: <200211181145.52365.mateusz@ant.gliwice.pl>

Any idea why using mod_gzip in apache makes gziping by gzip module hang apache 
server process ?
Currently I'm able compress content using mod_python nor mod_gzip (for static 
content), but not _both_ . :/

TIA for any ideas comments...

-- 
Mateusz Korniak
"Black holes are where God divided by zero." - Steven Wright


From ps0 at igmp.com.ar  Mon Nov 18 17:26:11 2002
From: ps0 at igmp.com.ar (Hector A. Paterno)
Date: Fri Jan  9 21:47:08 2004
Subject: [mod_python] Authentication like php !
Message-ID: <20021118172611.A8069@igmp.com.ar>

Hi,

 Anyone has already do some type of authentication with mod_python
 using some type of cookies or sessions (like php does) ?
 
 I need this for a user/pass form in the main page ( I dont want the
 tipical Auth new window ( AuthHandler ).
 
 
 Tnks A lot !
 

-- 
Hector A. Paterno

From ps0 at igmp.com.ar  Tue Nov 19 12:07:20 2002
From: ps0 at igmp.com.ar (Hector A. Paterno)
Date: Fri Jan  9 21:47:08 2004
Subject: [mod_python] Authentication like php !
In-Reply-To: <OF3AFC019A.317D1A47-ON85256C75.00712D44-85256C75.00720302@ccity.com>; from Tony_Burger@circuitcity.com on Mon, Nov 18, 2002 at 03:44:42PM -0500
References: <OF3AFC019A.317D1A47-ON85256C75.00712D44-85256C75.00720302@ccity.com>
Message-ID: <20021119120720.C17664@igmp.com.ar>

On Mon, Nov 18, 2002 at 03:44:42PM -0500, Tony_Burger@circuitcity.com wrote:

Could you bring me the python version of the perl script ?

Tnks a lot.


> 
> Yes in fact, using mod_auth_mda.  I have converted the perl script using
> mod_python and setup cookie checking for the client.  It looks as though
> the module is still only available for Apache 1.3.xx.  Looks like the
> website has been enhanced since I viewed it last, should help with setup.
> There was a lot of talk on the message list about the bit-masking
> technique.
> 
> http://www.frogdot.org/mod_auth_mda/index.html
> 
> 

-- 
Hector A. Paterno

From mbp at samba.org  Tue Nov 19 16:36:58 2002
From: mbp at samba.org (Martin Pool)
Date: Fri Jan  9 21:47:08 2004
Subject: [mod_python] unicode() conversion troubles with mod_python 3 CVS 27.06.2002
In-Reply-To: <005b01c27aff$26914920$0bcbefc3@irkutsk.teleross.ru>
References: <005b01c27aff$26914920$0bcbefc3@irkutsk.teleross.ru>
Message-ID: <20021120003657.GD25174@toey.sourcefrog.net>

On 24 Oct 2002, Eugene Sizikov <eugene_beast@mail.ru> wrote:
> Hello all ppl!
> 
> I have troubles with unicode conversion with mod_python from RedHat 8.0
> distro. The errorlog is:
> 
> "
> Mod_python error: "PythonHandler mod_python.publisher"
> 
> Traceback (most recent call last):
> 
>   File "/usr/lib/python2.2/site-packages/mod_python/apache.py", line 285, in
> HandlerDispatch
>     result = object(req)
> 
>   File "/usr/lib/python2.2/site-packages/mod_python/publisher.py", line 175,
> in handler
>     result = apply(object, (), args)
> 
>   File "/var/www/html/teleross/user.py", line 137, in start
>     html = '%s [%s]<HR>' % (string_sql_to_html(user.fullname),
> Group(user.con, user.gid).fullname) + menu.to_html()
> 
>   File "/var/www/html/teleross/utils.py", line 4, in string_sql_to_html
>     return unicode(s, 'koi8-r')
> 
>   File
> "/usr/src/build/143041-i386/install/usr/lib/python2.2/encodings/__init__.py"
> , line 51, in search_function
> 
> RuntimeError: cannot unmarshal code objects in restricted execution mode
> "
> 
> So, when it has "unicode(s, 'koi8-r')" it crashes with that interesting
> message I can't understand.

I had a similar problem.  It seemed to me to be some kind of
interaction between encoders being imported by the C encode()
implementation and modules being imported by mod_python.
Unfortunately I could only look at it without our complicated build
environment so I can't say for sure.

A workaround turned out to be forcing the encoders to be loaded before
mod_python starts up.  You can do this by adding a line like this to
sitecustom.py:

  u'hello'.encode('koi8-r')

-- 
Martin

From pzb at datastacks.com  Fri Nov 22 16:02:24 2002
From: pzb at datastacks.com (Peter Bowen)
Date: Fri Jan  9 21:47:08 2004
Subject: [mod_python] Apache segfault when using PythonImport
Message-ID: <1037998943.8001.40.camel@10-0-0-234.boston.ximian.com>

Apache is segfaulting when I use the PythonImport directive.

I have seen it under two slightly different conditions:

A) Apache 1.3.23 (from Red Hat Linux 7.3 errata), Python 2.2.2 without
threads, and mod_python 2.7.8

In this case the backtrace shows that the segfault occurs in ap_palloc. 
The stack looks like ap_palloc -> ap_pstrdup -> ap_table_add ->
directive_PythonImport.

B) Apache 1.3.23 (as above) or Apache 1.3.27, Python 2.2.2 with threads,
and mod_python 2.7.8

Different backtrace.  Dies in pthread_mutex_lock, called from
PyEval_AcquireLock.

Has anyone had sucess with using PythonImport with python 2.2 on apache
1.3?

Thanks.
Peter


From jack_diederich at email.com  Fri Nov 22 17:46:48 2002
From: jack_diederich at email.com (Jack Diederich)
Date: Fri Jan  9 21:47:08 2004
Subject: [mod_python] Apache segfault when using PythonImport
Message-ID: <20021122224648.6502.qmail@email.com>

I can't say for cetain what the cause of the segfault is, but I've
posted a potential reason and patches to fix it more than once to this list.

The globals for python imports are not safe, and trivial to make so.  I know
3.x is the gold standard, but patching 2.x for stability shouldn't be out
of the question.

The calls he sites are a VERY good indicator that the global is the problem,
we should just register a cleanup hook to NULL it out and recreate it again if
init()s are called twice.

-jack
> ----- Original Message -----
> From: Peter Bowen <pzb@datastacks.com>
> Date: 22 Nov 2002 16:02:24 -0500 
> To: mod_python@modpython.org
> Subject: [mod_python] Apache segfault when using PythonImport
> 
> 
> > Apache is segfaulting when I use the PythonImport directive.
> > 
> > I have seen it under two slightly different conditions:
> > 
> > A) Apache 1.3.23 (from Red Hat Linux 7.3 errata), Python 2.2.2 without
> > threads, and mod_python 2.7.8
> > 
> > In this case the backtrace shows that the segfault occurs in ap_palloc. 
> > The stack looks like ap_palloc -> ap_pstrdup -> ap_table_add ->
> > directive_PythonImport.
> > 
> > B) Apache 1.3.23 (as above) or Apache 1.3.27, Python 2.2.2 with threads,
> > and mod_python 2.7.8
> > 
> > Different backtrace.  Dies in pthread_mutex_lock, called from
> > PyEval_AcquireLock.
> > 
> > Has anyone had sucess with using PythonImport with python 2.2 on apache
> > 1.3?
> > 
> > Thanks.
> > Peter
> > 
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://www.modpython.org/mailman/listinfo/mod_python
> > 
> > 
> 
> -- 
> _______________________________________________
> Sign-up for your own FREE Personalized E-mail at Mail.com
> http://www.mail.com/?sr=signup
> 
> One click access to the Top Search Engines
> http://www.exactsearchbar.com/mailcom
> 
> 

-- 
_______________________________________________
Sign-up for your own FREE Personalized E-mail at Mail.com
http://www.mail.com/?sr=signup

One click access to the Top Search Engines
http://www.exactsearchbar.com/mailcom


From post at nlhas.no  Sat Nov 23 12:54:36 2002
From: post at nlhas.no (NLH AS)
Date: Fri Jan  9 21:47:08 2004
Subject: [mod_python] Beginner documentation -- suggestion
Message-ID: <3.0.5.32.20021123125436.00b61960@nlhhost>

I've just installed mod_python and converted a cgi application. During this
process I've spent most of my time finding out what happens where -- the
actual conversion fell into place quickly when I understood the main
framework. Everything is in the documentation, but I'd have appreciated a
simple explanation along the lines of the following (which may well be
wrong!) somewhere in the tutorial. Perhaps something like this can be
worked into the next edition of the documentation?

pm


++++++ What happens where in a "out-of-the-box" Apache/mod_python setup:

At startup or at the first call to a mod_python handler Apache loads the
Python interpreter and the import modules at the top of the handler's
module file.

Each call to the handler is executed in an Apache child process with a
separate Python subinterpreter instance. It is not possible to share global
variables between Apache's child processes (so sharing a global database
connection is not possible for example), and there is no means of
predicting whether Apache will start a new process or re-use an existing
process for any given call to the handler. [>> pointer to information about
how Apache does this, how many child processes can be started, etc.?].

Global variables within the handler's module will be available to all calls
to the handler that are routed to the same Apache process. This could be
used to maintain and re-use a database connection per child process. 

Local variables within the handler are local to each call to the handler
[and are eventually garbage-collected in the normal way?].

Mod_python will check whether the top level python module (containing the
handler) has been changed and re-load if necessary. Imported modules are
not checked, and the only 100% certain way of ensuring that updated modules
are reloaded in all child processes is to stop and re-start Apache.

It is possible to tweak various aspects of this behaviour -- for example
Apache can be compiled to only ever start one child process (which would
enable global variables), but this would entail significantly poorer
performance.
+++++
   

From markusjais at yahoo.de  Mon Nov 25 00:30:50 2002
From: markusjais at yahoo.de (Markus Jais)
Date: Fri Jan  9 21:47:08 2004
Subject: [mod_python] beginners question
Message-ID: <1038180652.3173.2.camel@eagle>

Hello
I have just installed mod_python 2.7.8 for my
apache 1.3.23

I have python 2.2.2 (with threads) on a RedHat 7.3 system.

compilation was no problem but when I restart apache I get

Starting httpd: [Mon Nov 25 00:26:41 2002] [warn] Loaded DSO
modules/mod_python.so uses plain Apache 1.3 API, this module might crash
under EAPI! (please recompile it with -DEAPI)


what does this mean?? I found EAPI not mentioned in the sources.

markus




__________________________________________________________________

Gesendet von Yahoo! Mail - http://mail.yahoo.de
Möchten Sie mit einem Gruß antworten? http://grusskarten.yahoo.de

From jfk at metation.com  Mon Nov 25 13:06:36 2002
From: jfk at metation.com (Jørgen Frøjk Kjærsgaard)
Date: Fri Jan  9 21:47:08 2004
Subject: [mod_python] beginners question
In-Reply-To: <1038180652.3173.2.camel@eagle>
References: <1038180652.3173.2.camel@eagle>
Message-ID: <20021125110636.M72172@metation.com>

On 25 Nov 2002 00:30:50 +0100, Markus Jais wrote
> Hello
> I have just installed mod_python 2.7.8 for my
> apache 1.3.23
> 
> I have python 2.2.2 (with threads) on a RedHat 7.3 system.
> 
> compilation was no problem but when I restart apache I get
> 
> Starting httpd: [Mon Nov 25 00:26:41 2002] [warn] Loaded DSO
> modules/mod_python.so uses plain Apache 1.3 API, this module might crash
> under EAPI! (please recompile it with -DEAPI)
> 
> what does this mean?? I found EAPI not mentioned in the sources.

Apache 1.3 has two API versions. If you compile with the "-DEAPI" option given
to gcc, you get an EAPI version.

You may safely ignore the warning. mod_python works fine even when compiled
with plain API.

/jfk

--
J?rgen Fr?jk Kj?rsgaard
Metation ApS - the system integrators
Kystvejen 29 - DK 8000 ?rhus C - www.metation.com

From jquinte at fadu.uba.ar  Mon Nov 25 11:00:13 2002
From: jquinte at fadu.uba.ar (Javier Quinteros)
Date: Fri Jan  9 21:47:08 2004
Subject: [mod_python] Solaris 8...
Message-ID: <006301c2948a$fa13e240$3dd05c9d@sis.rec.uba.ar>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Hi, all of you !!!
Yes, it's me again. I'm still fighting with modpython and Solaris 8,
trying to make them both understand that they should work together...  
;-)
My question this time is TOO simple:

Has anyone been able to compile and install modpython in a Solaris 8 OS
???

Thanks in advance...
- ------------------------------
Javier Quinteros
jquinte@fadu.uba.ar
jquinte@dc.uba.ar
Universidad de Buenos Aires
- ------------------------------

-----BEGIN PGP SIGNATURE-----
Version: PGPfreeware 6.5.3 for non-commercial use <http://www.pgp.com>

iQA/AwUBPeIs63Qc0Z5RZeHIEQIIugCgg7DMEUW4+90brXKIjcQAhweTpFAAn0At
TuyWYxld3hvHQkvbEYcOk4yq
=vPKa
-----END PGP SIGNATURE-----



From agenkin-lst-mod_python at thpoon.com  Mon Nov 25 16:16:57 2002
From: agenkin-lst-mod_python at thpoon.com (Arcady Genkin)
Date: Fri Jan  9 21:47:08 2004
Subject: [mod_python] Solaris 8...
In-Reply-To: <006301c2948a$fa13e240$3dd05c9d@sis.rec.uba.ar> ("Javier
 Quinteros"'s message of "Mon, 25 Nov 2002 11:00:13 -0300")
References: <006301c2948a$fa13e240$3dd05c9d@sis.rec.uba.ar>
Message-ID: <uo4ra55oza.fsf@bashful.cdf.toronto.edu>

"Javier Quinteros" <jquinte@fadu.uba.ar> writes:

> Has anyone been able to compile and install modpython in a Solaris 8 OS

Yes, I have version 2.7.8 compiled, installed and working under
Solaris 8/Sparc with Apache 1.3.27.  I had to install Python with
threads turned off in a separate location; apart from that, everything
was quite easy.  Here are my install notes:

,----[ mod_python ]
|   - env PATH=/opt/python_threadless/bin:$PATH \
|         ./configure --with-apxs=/opt/apache/bin/apxs
|   - make
|   - make install
`----

Python 2.2.2 was installed with the following config options:
--prefix=/opt/python_threadless --without-threads .

I can't claim that this is the optimal configuration, but this seems
to have worked for me.

Hope this helps,
-- 
Arcady Genkin : CDF Systems Administrator
http://www.cdf.toronto.edu/~agenkin/contact.html

guilt is the cause of more disauders
than history's most obscene marorders (E.E. Cummings)

From markusjais at yahoo.de  Tue Nov 26 00:12:46 2002
From: markusjais at yahoo.de (Markus Jais)
Date: Fri Jan  9 21:47:08 2004
Subject: [mod_python] another beginners question: problem with <Location> directive
Message-ID: <1038265968.2605.3.camel@eagle>

hello
I have the example from the tutorial

from mod_python import apache

def handler(req):
    req.content_type = "text/html"
    req.send_http_header()
    req.write("Eagles are great")
    return apache.OK

and this setup

<Directory /var/www/html/python> 
  AddHandler python-program .py
  PythonHandler mptest 
  PythonDebug On 
</Directory>


this works fine.

but when I change the <Directory> directive to
----
<Location /python> 
  AddHandler python-program .py
  PythonHandler mptest 
  PythonDebug On 
</Location>
---
I get this error in my apache logfile:
[Tue Nov 26 00:07:18 2002] [notice] mod_python: (Re)importing mptest from None
[Tue Nov 26 00:07:18 2002] [error] PythonHandler mptest: Traceback (most recent call last):
[Tue Nov 26 00:07:18 2002] [error] PythonHandler mptest:   File "/usr/local/lib/python2.2/site-packages/mod_python/apache.py", line 181, in Dispatch
    module = import_module(module_name, _req)
[Tue Nov 26 00:07:18 2002] [error] PythonHandler mptest:   File "/usr/local/lib/python2.2/site-packages/mod_python/apache.py", line 332, in import_module
    f, p, d = imp.find_module(parts[i], path)
[Tue Nov 26 00:07:18 2002] [error] PythonHandler mptest: ImportError: No module named mptest


I am using python 2.2.2, modpython 2.7.8 and apache 1.3.23 (rpm version for redhat 7.3)

markus



__________________________________________________________________

Gesendet von Yahoo! Mail - http://mail.yahoo.de
Möchten Sie mit einem Gruß antworten? http://grusskarten.yahoo.de

From grisha at modpython.org  Wed Nov 27 18:55:46 2002
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:47:08 2004
Subject: [mod_python] another beginners question: problem with <Location>
 directive
In-Reply-To: <1038265968.2605.3.camel@eagle>
Message-ID: <20021127185210.U41427-100000@eden.ispol.com>

Mod_python adds the directory to sys.path for you, this is how Python
finds the script. But when you <Location> there is no way for mod_python
to know what to add to sys.path, so you have to do it explicitely, using
the PythonPath directive, try this:

<Location /python>
  AddHandler python-program .py
  PythonHandler mptest
  PythonPath "['/var/www/html/python']+sys.path"
  PythonDebug On
</Location>

Grisha

On 26 Nov 2002, Markus Jais wrote:

> hello
> I have the example from the tutorial
>
> from mod_python import apache
>
> def handler(req):
>     req.content_type = "text/html"
>     req.send_http_header()
>     req.write("Eagles are great")
>     return apache.OK
>
> and this setup
>
> <Directory /var/www/html/python>
>   AddHandler python-program .py
>   PythonHandler mptest
>   PythonDebug On
> </Directory>
>
>
> this works fine.
>
> but when I change the <Directory> directive to
> ----
> <Location /python>
>   AddHandler python-program .py
>   PythonHandler mptest
>   PythonDebug On
> </Location>
> ---
> I get this error in my apache logfile:
> [Tue Nov 26 00:07:18 2002] [notice] mod_python: (Re)importing mptest from None
> [Tue Nov 26 00:07:18 2002] [error] PythonHandler mptest: Traceback (most recent call last):
> [Tue Nov 26 00:07:18 2002] [error] PythonHandler mptest:   File "/usr/local/lib/python2.2/site-packages/mod_python/apache.py", line 181, in Dispatch
>     module = import_module(module_name, _req)
> [Tue Nov 26 00:07:18 2002] [error] PythonHandler mptest:   File "/usr/local/lib/python2.2/site-packages/mod_python/apache.py", line 332, in import_module
>     f, p, d = imp.find_module(parts[i], path)
> [Tue Nov 26 00:07:18 2002] [error] PythonHandler mptest: ImportError: No module named mptest
>
>
> I am using python 2.2.2, modpython 2.7.8 and apache 1.3.23 (rpm version for redhat 7.3)
>
> markus
>
>
>
> __________________________________________________________________
>
> Gesendet von Yahoo! Mail - http://mail.yahoo.de
> M?chten Sie mit einem Gru? antworten? http://grusskarten.yahoo.de
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
>


From Morten.Tryfoss at 1880nummeropplysning.no  Thu Nov 28 19:16:07 2002
From: Morten.Tryfoss at 1880nummeropplysning.no (Morten Tryfoss)
Date: Fri Jan  9 21:47:08 2004
Subject: SV: SV: SV: [mod_python] Problem with mod_python3.0(beta4),python2.2.1and apache 2.0.43
Message-ID: <07411F6A634E5445AEF010C58590F2FB636581@exchangeone.kristiansand.viadial.no>

This is the strace output from apache when it segfaults:

[pid  1577] <... accept resumed> {sin_family=AF_INET6, sin6_port=htons(3101), inet_pton(AF_INET6, "::ffff:62.73.255.77", &sin6_addr), sin6_flowinfo=0, sin6_scope_id=0}, [28]) = 8
[pid  1577] getsockname(8, {sin_family=AF_INET6, sin6_port=htons(80), inet_pton(AF_INET6, "::ffff:212.125.195.9", &sin6_addr), sin6_flowinfo=0, sin6_scope_id=0}, [28]) = 0
[pid  1577] fcntl64(8, F_GETFL)         = 0x2 (flags O_RDWR)
[pid  1577] fcntl64(8, F_SETFL, O_RDWR|O_NONBLOCK) = 0
[pid  1577] read(8, 0x81a0f50, 8000)    = -1 EAGAIN (Resource temporarily unavailable)
[pid  1577] poll([{fd=8, events=POLLIN, revents=POLLIN}], 1, 300000) = 1
[pid  1577] read(8, "GET / HTTP/1.1\r\nAccept: image/gi"..., 8000) = 288
[pid  1577] gettimeofday({1038506716, 88342}, NULL) = 0
[pid  1577] stat64("/usr/local/apache/htdocs/", {st_mode=S_IFDIR|0755, st_size=4096, ...}) = 0
[pid  1577] stat64("/usr/local/apache/htdocs/dses/login/login.py", {st_mode=S_IFREG|0444, st_size=4285, ...}) = 0
[pid  1577] stat64("/usr/local/apache/htdocs/dses/login/login.py", {st_mode=S_IFREG|0444, st_size=4285, ...}) = 0
[pid  1577] stat64("/usr/local/apache/htdocs/dses/login/login.py", {st_mode=S_IFREG|0444, st_size=4285, ...}) = 0
[pid  1577] stat64("/usr/local/apache/htdocs/dses/login/login.p", 0xbfffda6c) = -1 ENOENT (No such file or directory)
[pid  1577] --- SIGSEGV (Segmentation fault) ---
[pid  1574] <... select resumed> )      = ? ERESTARTNOHAND (To be restarted)
[pid  1574] --- SIGCHLD (Child exited) ---
[pid  1574] select(0, NULL, NULL, NULL, {0, 720000}) = 0 (Timeout)
[pid  1574] wait4(-1, [WIFSIGNALED(s) && WTERMSIG(s) == SIGSEGV], WNOHANG|WUNTRACED, NULL) = 1577
[pid  1574] gettimeofday({1038506716, 808246}, NULL) = 0
[pid  1574] write(7, "[Thu Nov 28 19:05:16 2002] [noti"..., 87) = 87

Any thoughts?

Morten

-----Opprinnelig melding-----
Fra: Gregory (Grisha) Trubetskoy [mailto:grisha@modpython.org]
Sendt: 5. november 2002 21:38
Til: Morten Tryfoss
Emne: Re: SV: SV: [mod_python] Problem with
mod_python3.0(beta4),python2.2.1and apache 2.0.43



It's impossible to tell what's going on based on these logs... What would
really help me track the problem down is knowing which line(s) of Python
code in your scripts cause this. You can try writing something to the logs
throughout the code to see where exactly it segfaults.

On Tue, 5 Nov 2002, Morten Tryfoss wrote:

> Now I've tried to upgrade Python, and it still segfaults.
>
> Here's some lines from apache's error_log:
>
> [Tue Nov 05 20:51:21 2002] [notice] child pid 29905 exit signal Segmentation fault (11)
> [Tue Nov 05 20:51:56 2002] [info] (104)Connection reset by peer: core_output_filter: writing data to the network
> [Tue Nov 05 20:51:56 2002] [info] (32)Broken pipe: core_output_filter: writing data to the network
> [Tue Nov 05 20:53:08 2002] [notice] child pid 29995 exit signal Segmentation fault (11)
> [Tue Nov 05 20:56:24 2002] [info] (104)Connection reset by peer: core_output_filter: writing data to the network
> [Tue Nov 05 20:56:24 2002] [info] (32)Broken pipe: core_output_filter: writing data to the network
>
> Is it possible that the scripts are the reason for this? (It worked fine on earlier versions of apache/mod_python).
>
>
>
> Morten
>
> -----Opprinnelig melding-----
> Fra: Gregory (Grisha) Trubetskoy [mailto:grisha@modpython.org]
> Sendt: 5. november 2002 20:20
> Til: Morten Tryfoss
> Kopi: mod_python@modpython.org
> Emne: Re: SV: [mod_python] Problem with mod_python3.0(beta4),
> python2.2.1and apache 2.0.43
>
>
>
> The first thing I would try is upgrading to Python 2.2.2. If that doesn't
> solve it, then you need to try to figure out a way to replicate this
> issue, which is easier said than done. So far I haven't had any segfault
> reports for BETA4, so I have no other info to relate this to.
>
> Grisha
>
> On Tue, 5 Nov 2002, Morten Tryfoss wrote:
>
> > SuSE Linux 8.0 (2.4.18)
> >
> > Morten
> >
> > -----Opprinnelig melding-----
> > Fra: Gregory (Grisha) Trubetskoy [mailto:grisha@modpython.org]
> > Sendt: 5. november 2002 19:49
> > Til: Morten Tryfoss
> > Emne: Re: [mod_python] Problem with mod_python3.0(beta4), python
> > 2.2.1and apache 2.0.43
> >
> >
> >
> > Morten - what's your operating system?
> >
> > On Tue, 5 Nov 2002, Morten Tryfoss wrote:
> >
> > >
> > > I start my server up, and everything works ok. But after av while(when
> > > the number of clients raise) some of the apache childs segfaults. Users
> > > who are running on their persistent connections may still use the
> > > server, but new connections are dropped. Any thoughts of what may be
> > > wrong?
> > >
> > > Currently I'm running apache 1.3.x, but some part of my scripts performs
> > > poorly. Running them on apache 2.0 improved a lot (as long as the server
> > > didn't crash).
> > >
> > >
> > > Morten Tryfoss
> > >
> > > _______________________________________________
> > > Mod_python mailing list
> > > Mod_python@modpython.org
> > > http://www.modpython.org/mailman/listinfo/mod_python
> > >
> >
> >
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://www.modpython.org/mailman/listinfo/mod_python
> >
>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
>



From francoislepoutre at compuserve.com  Fri Nov 29 10:38:12 2002
From: francoislepoutre at compuserve.com (francois lepoutre)
Date: Fri Jan  9 21:47:08 2004
Subject: [mod_python] some remarks, a few questions and
Message-ID: <001701c2978b$08c8f070$bd6e4351@mixio7jpsmlatx>

Hi all modpython users,

First modpython is plain great.We like some much
and even more so as an apache project :)

Thanks Grisha and all.

I just moved a couple of thousand lines of python from 
apache 1.3.27/modpython 2.7.4/python 2.1.1 (w2k) 
into apache 2.0.43/modpython 3.0.1/python 2.2.2 (w2k)

Some remarks:
1) INSTALLATION ON WIN32 WAS A SNAP, GREAT.
Automation has significantly improved for all components
Thanks to the apache and python communities 

2) The new install run exactly in the same way.
Perf and behaviour are nearly identical... that's both good 
(because every thing works ok) and mixed feeling 
(why change version). But we are not specifically 
looking for performance improvement anyway.

I hope that *nix apache users are feeling some perf 
improvements because of the new fork+thread model. 
Win32 runs the same. At least for us.

Now a few questions at this stage:
When running the old stuff (modpython 2.7) we maintained
two distinct series of modpython code:
- one plain simple set of routines for forking *nix (for a RH customers),
- win32-specific code with thread-mngt stuff (and connection pooling)
for various w2k set-ups.

We like the idea of a unified programming model a lot :)

With the new Apache2/modpython3 model can we expect :
- to run thread-enabled python on both environments (*nix and win32)?
- to run the same code (with thread-caring stuff) in both environment? 
- the thread-management routines to be of any use on *nix setups 
if they use a mixed "fork+thread" apache model?

Is this model fork+thread of any use or interest for modpython users?
I'm no python expert but have some doubt about the latest in view
of the way python runs its own threading stuff.

In the end a bug report (did i miss something on the apache 2 config.?).
The code below will work on 2.7.* and break on 3.0.1 (W2K).

from mod_python import apache

def handler(req):
    req.write("Your local address:%s %i" % \
    (req.connection.local_addr[0],req.connection.local_addr[1]))
     return apache.OK

Regards

Francois


From markusjais at yahoo.de  Tue Nov 26 00:19:02 2002
From: markusjais at yahoo.de (Markus Jais)
Date: Fri Jan  9 21:47:08 2004
Subject: [mod_python] software using mod_python ?
Message-ID: <1038266344.2698.0.camel@eagle>

hello
are there any open source python modules who are using
mod python ?
I would like to see some code with mod_python in action
to learn more about it.

markus



__________________________________________________________________

Gesendet von Yahoo! Mail - http://mail.yahoo.de
Yahoo! präsentiert als offizieller Sponsor das Fußball-Highlight des
Jahres: - http://www.FIFAworldcup.com

From mark_messer at calypso.com  Sat Nov 30 14:11:42 2002
From: mark_messer at calypso.com (Mark Messer)
Date: Fri Jan  9 21:47:08 2004
Subject: [mod_python] can't find mod_python.so
Message-ID: <00d701c298bd$772ffdf0$b27ba8c0@ZEUS>

I put mod_python.so into the modules directory, but I get an error when
starting Apache:

C:\tools\Apache2\bin>apache
Syntax error on line 173 of C:/tools/Apache2/conf/httpd.conf:
Cannot load C:/tools/Apache2/modules/mod_python.so into server: The
specified module could not be found.

I added this to the LoadModule section of httpd.conf:  LoadModule
python_module modules/mod_python.so

Here's the directory listing:
C:\tools\Apache2\modules>ls -al mod_p*
-rwxrwx---    1 Administ SYSTEM      40960 Oct  3 06:58 mod_proxy.so
-rwxrwx---    1 Administ SYSTEM      20480 Oct  3 06:58 mod_proxy_connect.so
-rwxrwx---    1 Administ SYSTEM      28672 Oct  3 06:58 mod_proxy_ftp.so
-rwxrwx---    1 Administ SYSTEM      24576 Oct  3 06:58 mod_proxy_http.so
-rwxrwx---    1 Administ SYSTEM      65536 Nov 26 17:49 mod_python.so

I am running mod_python 3.0.1, Python 2.2.2, Apache 2.0.43, Windows XP
Professional.   Tried changing perms and ownership to match what was there,
but that did not work.



From grisha at modpython.org  Sat Nov 30 23:06:10 2002
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:47:08 2004
Subject: [mod_python] can't find mod_python.so
In-Reply-To: <00d701c298bd$772ffdf0$b27ba8c0@ZEUS>
Message-ID: <20021130230513.T83360-100000@eden.ispol.com>

This is possibly because the mod_python.so that is out there is for Python
2.2.1. I don't have one for 2.2.2 compiled (yet).

Grisha

On Sat, 30 Nov 2002, Mark Messer wrote:

> I put mod_python.so into the modules directory, but I get an error when
> starting Apache:
>
> C:\tools\Apache2\bin>apache
> Syntax error on line 173 of C:/tools/Apache2/conf/httpd.conf:
> Cannot load C:/tools/Apache2/modules/mod_python.so into server: The
> specified module could not be found.
>
> I added this to the LoadModule section of httpd.conf:  LoadModule
> python_module modules/mod_python.so
>
> Here's the directory listing:
> C:\tools\Apache2\modules>ls -al mod_p*
> -rwxrwx---    1 Administ SYSTEM      40960 Oct  3 06:58 mod_proxy.so
> -rwxrwx---    1 Administ SYSTEM      20480 Oct  3 06:58 mod_proxy_connect.so
> -rwxrwx---    1 Administ SYSTEM      28672 Oct  3 06:58 mod_proxy_ftp.so
> -rwxrwx---    1 Administ SYSTEM      24576 Oct  3 06:58 mod_proxy_http.so
> -rwxrwx---    1 Administ SYSTEM      65536 Nov 26 17:49 mod_python.so
>
> I am running mod_python 3.0.1, Python 2.2.2, Apache 2.0.43, Windows XP
> Professional.   Tried changing perms and ownership to match what was there,
> but that did not work.
>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
>


From markusjais at yahoo.de  Tue Nov 26 21:29:38 2002
From: markusjais at yahoo.de (Markus Jais)
Date: Fri Jan  9 21:47:08 2004
Subject: [mod_python] another beginners question: problem with <Location> directive
Message-ID: <1038342581.1928.3.camel@eagle>

hello
I already sent this message yesterday but somehow it didn't reach
the list.


I have the example from the tutorial

from mod_python import apache

def handler(req):
    req.content_type = "text/html"
    req.send_http_header()
    req.write("Eagles are great")
    return apache.OK


and this setup

<Directory /var/www/html/python> 
  AddHandler python-program .py
  PythonHandler mptest 
  PythonDebug On 
</Directory>


this works fine.

but when I change the <Directory> directive to
----
<Location /python> 
  AddHandler python-program .py
  PythonHandler mptest 
  PythonDebug On 
</Location>
---
I get this error in my apache logfile:
[Tue Nov 26 00:07:18 2002] [notice] mod_python: (Re)importing mptest from None
[Tue Nov 26 00:07:18 2002] [error] PythonHandler mptest: Traceback (most recent call last):
[Tue Nov 26 00:07:18 2002] [error] PythonHandler mptest:   File "/usr/local/lib/python2.2/site-packages/mod_python/apache.py", line 181, in Dispatch
    module = import_module(module_name, _req)
[Tue Nov 26 00:07:18 2002] [error] PythonHandler mptest:   File "/usr/local/lib/python2.2/site-packages/mod_python/apache.py", line 332, in import_module
    f, p, d = imp.find_module(parts[i], path)
[Tue Nov 26 00:07:18 2002] [error] PythonHandler mptest: ImportError: No module named mptest


I am using python 2.2.2, modpython 2.7.8 and apache 1.3.23 (rpm version for redhat 7.3)

markus



__________________________________________________________________

Gesendet von Yahoo! Mail - http://mail.yahoo.de
Yahoo! präsentiert als offizieller Sponsor das Fußball-Highlight des
Jahres: - http://www.FIFAworldcup.com

From grisha at apache.org  Wed Nov 27 14:37:33 2002
From: grisha at apache.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:47:08 2004
Subject: [mod_python] ANNOUNCE: Mod_python 3.0.1
Message-ID: <20021127135855.Q36516-100000@eden.ispol.com>

The Apache Software Foundation and The Apache HTTP Server Project are
pleased to announce the release of mod_python 3.0.1.

Mod_python is an Apache HTTP Server module that embeds the Python
interpreter within the server. With mod_python you can write web-based
applications in Python that will run many times faster than traditional
CGI and will have access to advanced features such as ability to retain
database connections between requests, access to httpd internals and
provide content filter as well as connection handlers.

This is the first release of mod_python as a subproject of the Apache HTTP
Server Project, as well as a major milestone accomplishment finally
bringing compatibility with Apache 2.0.

This release increments the major version to 3. The major version
increment is to denote that this release is only compatible with Apache
httpd server 2.0 and Python 2.2 or later and is not fully backwards
compatible with previous versions of mod_python. For details on migrating
code from previous versions of mod_python, as well as a list of new
featurs, see the README file in the distribution.

Mod_python is available for download from:

http://www.apache.org/dist/httpd/modpython/

For more information about mod_python visit
http://www.modpython.org/

Enjoy, and Happy Thanksgiving to those in the US!

Grisha Trubetskoy



From Antonio at memora.com  Sun Nov 24 19:48:11 2002
From: Antonio at memora.com (Antonio Rodriguez)
Date: Fri Jan  9 21:47:08 2004
Subject: [mod_python] beginners question
References: <1038180652.3173.2.camel@eagle>
Message-ID: <001f01c29a3b$e92ddc40$6401a8c0@darwin>

Markus,

Go into the src directory of the dist and in the OPTIONS= line add -DEAPI.
apxs will do the right thing and you will stop getting that warning.

Heads up on having threads compiled in. I asked the list what the
ramifications of this were going to be (besides total crashes which don't
seem to happen if you don't explictly use threads) a few weeks ago but have
gotten no answers. I might recompile without threads.

Antonio

----- Original Message -----
From: "Markus Jais" <markusjais@yahoo.de>
To: <mod_python@modpython.org>
Sent: Sunday, November 24, 2002 6:30 PM
Subject: [mod_python] beginners question


Hello
I have just installed mod_python 2.7.8 for my
apache 1.3.23

I have python 2.2.2 (with threads) on a RedHat 7.3 system.

compilation was no problem but when I restart apache I get

Starting httpd: [Mon Nov 25 00:26:41 2002] [warn] Loaded DSO
modules/mod_python.so uses plain Apache 1.3 API, this module might crash
under EAPI! (please recompile it with -DEAPI)


what does this mean?? I found EAPI not mentioned in the sources.

markus




__________________________________________________________________

Gesendet von Yahoo! Mail - http://mail.yahoo.de
M?chten Sie mit einem Gru? antworten? http://grusskarten.yahoo.de
_______________________________________________
Mod_python mailing list
Mod_python@modpython.org
http://www.modpython.org/mailman/listinfo/mod_python




From jfk at metation.com  Fri Nov  1 09:20:16 2002
From: jfk at metation.com (Jørgen Frøjk Kjærsgaard)
Date: Fri Jan  9 21:53:12 2004
Subject: [mod_python] Lifecycle of mod_python instances
In-Reply-To: <BB355965-ED1C-11D6-9578-00039300D690@memora.com>
References: <BB355965-ED1C-11D6-9578-00039300D690@memora.com>
Message-ID: <20021101072016.M33334@metation.com>

On Thu, 31 Oct 2002 17:04:30 -0500, Antonio L Rodriguez wrote
> Forgive me if this is more of an apache process question, but I 
> couldn't find it covered clearly in the docs.
> 
> When apache boots up (on *NIX) its starts a bunch of children 
> processes. Does each child have its own separate image of mod_python 
> execution space that is totally separate from the other images?

Correct. Apache 1.3 starts a process per simultaneous request it can handle.
Apache 2.0 is capable of running in threaded mode where the threads share
memory and thus can have global shared variables. I have no experience with
2.0 so far, though. See the documentation for Apache, in particular
http://httpd.apache.org/docs/mod/core.html#maxclients for 1.3 and
http://httpd.apache.org/docs-2.0/mod/mpm_common.html#maxclients for 2.0.

> That is, if I define a global var to measure hit counts in a script 
> and then I see this var dance up and down as each of the child 
> processes handles the request, do I infer correctly that there are 
> separate python interpreters living inside of each child process?

Exactly. You never know which process the next request will hit.

> If this is so, I'd be curious how people do global data structures 
> in this model, i.e. a database connection pool.

Truely global data with Apache 1.3 requires some kind of shared memory, which
isn't supported by mod_python. I use one database connection per child. This
works well, but of cause, if you configure your Apache to run with a lot of
idle children, you'll have a lot of idle connections. If your database system
has a limit as to how many simultaneous connections it can handle, be sure you
don't hit that limit. Raise it or limit the number of Apache processes.

/jfk

--
J?rgen Fr?jk Kj?rsgaard
Metation ApS - the system integrators
Kystvejen 29 - DK 8000 ?rhus C - www.metation.com

From conrad at hep.caltech.edu  Fri Nov  1 14:39:55 2002
From: conrad at hep.caltech.edu (Conrad Steenberg)
Date: Fri Jan  9 21:53:13 2004
Subject: [mod_python] Lifecycle of mod_python instances
In-Reply-To: <20021101072016.M33334@metation.com>
References: <BB355965-ED1C-11D6-9578-00039300D690@memora.com> 
	<20021101072016.M33334@metation.com>
Message-ID: <1036190396.1708.335.camel@heppc22.hep.caltech.edu>

Hi

Just my 2c: 

Using Berkeley DB works great for small things like counters and other
small pieces of persistent data. It is already installed on most
systems, so all you need is the Python binding from
http://pybsddb.sourceforge.net/

You can open a connection to the DB and store it as a global variable in
your mod_python script when the script is imported - i.e. not within the
handler. You can use e.g. cookies to identify connections.

HTH

COnrad

On Thu, 2002-10-31 at 23:20, J?rgen Fr?jk Kj?rsgaard wrote:
> On Thu, 31 Oct 2002 17:04:30 -0500, Antonio L Rodriguez wrote
> > Forgive me if this is more of an apache process question, but I 
> > couldn't find it covered clearly in the docs.
> > 
> > When apache boots up (on *NIX) its starts a bunch of children 
> > processes. Does each child have its own separate image of mod_python 
> > execution space that is totally separate from the other images?
> 
> Correct. Apache 1.3 starts a process per simultaneous request it can handle.
> Apache 2.0 is capable of running in threaded mode where the threads share
> memory and thus can have global shared variables. I have no experience with
> 2.0 so far, though. See the documentation for Apache, in particular
> http://httpd.apache.org/docs/mod/core.html#maxclients for 1.3 and
> http://httpd.apache.org/docs-2.0/mod/mpm_common.html#maxclients for 2.0.
> 
> > That is, if I define a global var to measure hit counts in a script 
> > and then I see this var dance up and down as each of the child 
> > processes handles the request, do I infer correctly that there are 
> > separate python interpreters living inside of each child process?
> 
> Exactly. You never know which process the next request will hit.
> 
> > If this is so, I'd be curious how people do global data structures 
> > in this model, i.e. a database connection pool.
> 
> Truely global data with Apache 1.3 requires some kind of shared memory, which
> isn't supported by mod_python. I use one database connection per child. This
> works well, but of cause, if you configure your Apache to run with a lot of
> idle children, you'll have a lot of idle connections. If your database system
> has a limit as to how many simultaneous connections it can handle, be sure you
> don't hit that limit. Raise it or limit the number of Apache processes.
> 
> /jfk
> 
> --
> J?rgen Fr?jk Kj?rsgaard
> Metation ApS - the system integrators
> Kystvejen 29 - DK 8000 ?rhus C - www.metation.com
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
-- 
*-----------------------------------------*
| Conrad Steenberg                        |
| Caltech, Mail Code 356-48               |
| Pasadena, CA, 91125                     |
| e-mail: conrad@hep.caltech.edu          |
| Tel: (626) 395-8758                     |
*-----------------------------------------*



From john at journyx.com  Sat Nov  2 14:43:24 2002
From: john at journyx.com (John Maddalozzo)
Date: Fri Jan  9 21:53:13 2004
Subject: [mod_python] mod_python on AIX
Message-ID: <Pine.LNX.4.21.0211021439420.7229-100000@dev1.int.journyx.com>

Has anyone been successful at building mod_python support on AIX? It
worked at one time but now on Apache 1.3.27, Python 2.1 and the
latest mod_python I have been unable to get it to run without
httpd core dumping when handling a request (running the mptest.py
program). Python/http calls out to load the stropmodule which gets loaded
as a shared library and then stop calls back to Py_InitModule4().
But it looks like it is trying to jump to an address in the shared
library instead of resolving Py_InitModule4 in libpython2.1.a.
I've had the same problem on both AIX 4.3.3 and 5.1.

If you've been successful at getting mod_python working with any
combination of software on AIX I'd sure like to find out what the trick
is. 

Thanks, John



From Morten.Tryfoss at 1880nummeropplysning.no  Tue Nov  5 19:24:05 2002
From: Morten.Tryfoss at 1880nummeropplysning.no (Morten Tryfoss)
Date: Fri Jan  9 21:53:13 2004
Subject: [mod_python] Problem with mod_python3.0(beta4), python 2.2.1 and apache 2.0.43
Message-ID: <07411F6A634E5445AEF010C58590F2FB665A3A@exchangeone.kristiansand.viadial.no>

I start my server up, and everything works ok. But after av while(when the number of clients raise) some of the apache childs segfaults. Users who are running on their persistent connections may still use the server, but new connections are dropped. Any thoughts of what may be wrong?

Currently I'm running apache 1.3.x, but some part of my scripts performs poorly. Running them on apache 2.0 improved a lot (as long as the server didn't crash).


Morten Tryfoss


From Morten.Tryfoss at 1880nummeropplysning.no  Tue Nov  5 19:48:36 2002
From: Morten.Tryfoss at 1880nummeropplysning.no (Morten Tryfoss)
Date: Fri Jan  9 21:53:13 2004
Subject: SV: [mod_python] Problem with mod_python3.0(beta4), python 2.2.1and apache 2.0.43
Message-ID: <07411F6A634E5445AEF010C58590F2FB63655D@exchangeone.kristiansand.viadial.no>

SuSE Linux 8.0 (2.4.18)

Morten

-----Opprinnelig melding-----
Fra: Gregory (Grisha) Trubetskoy [mailto:grisha@modpython.org]
Sendt: 5. november 2002 19:49
Til: Morten Tryfoss
Emne: Re: [mod_python] Problem with mod_python3.0(beta4), python
2.2.1and apache 2.0.43



Morten - what's your operating system?

On Tue, 5 Nov 2002, Morten Tryfoss wrote:

>
> I start my server up, and everything works ok. But after av while(when
> the number of clients raise) some of the apache childs segfaults. Users
> who are running on their persistent connections may still use the
> server, but new connections are dropped. Any thoughts of what may be
> wrong?
>
> Currently I'm running apache 1.3.x, but some part of my scripts performs
> poorly. Running them on apache 2.0 improved a lot (as long as the server
> didn't crash).
>
>
> Morten Tryfoss
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
>



From grisha at modpython.org  Tue Nov  5 14:19:35 2002
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:53:13 2004
Subject: SV: [mod_python] Problem with mod_python3.0(beta4), python
 2.2.1and apache 2.0.43
In-Reply-To: <07411F6A634E5445AEF010C58590F2FB63655D@exchangeone.kristiansand.viadial.no>
Message-ID: <20021105141658.M32052-100000@eden.ispol.com>

The first thing I would try is upgrading to Python 2.2.2. If that doesn't
solve it, then you need to try to figure out a way to replicate this
issue, which is easier said than done. So far I haven't had any segfault
reports for BETA4, so I have no other info to relate this to.

Grisha

On Tue, 5 Nov 2002, Morten Tryfoss wrote:

> SuSE Linux 8.0 (2.4.18)
>
> Morten
>
> -----Opprinnelig melding-----
> Fra: Gregory (Grisha) Trubetskoy [mailto:grisha@modpython.org]
> Sendt: 5. november 2002 19:49
> Til: Morten Tryfoss
> Emne: Re: [mod_python] Problem with mod_python3.0(beta4), python
> 2.2.1and apache 2.0.43
>
>
>
> Morten - what's your operating system?
>
> On Tue, 5 Nov 2002, Morten Tryfoss wrote:
>
> >
> > I start my server up, and everything works ok. But after av while(when
> > the number of clients raise) some of the apache childs segfaults. Users
> > who are running on their persistent connections may still use the
> > server, but new connections are dropped. Any thoughts of what may be
> > wrong?
> >
> > Currently I'm running apache 1.3.x, but some part of my scripts performs
> > poorly. Running them on apache 2.0 improved a lot (as long as the server
> > didn't crash).
> >
> >
> > Morten Tryfoss
> >
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://www.modpython.org/mailman/listinfo/mod_python
> >
>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
>


From Morten.Tryfoss at 1880nummeropplysning.no  Tue Nov  5 20:58:51 2002
From: Morten.Tryfoss at 1880nummeropplysning.no (Morten Tryfoss)
Date: Fri Jan  9 21:53:13 2004
Subject: SV: SV: [mod_python] Problem with mod_python3.0(beta4), python2.2.1and apache 2.0.43
Message-ID: <07411F6A634E5445AEF010C58590F2FB63655E@exchangeone.kristiansand.viadial.no>

Now I've tried to upgrade Python, and it still segfaults.

Here's some lines from apache's error_log:

[Tue Nov 05 20:51:21 2002] [notice] child pid 29905 exit signal Segmentation fault (11)
[Tue Nov 05 20:51:56 2002] [info] (104)Connection reset by peer: core_output_filter: writing data to the network
[Tue Nov 05 20:51:56 2002] [info] (32)Broken pipe: core_output_filter: writing data to the network
[Tue Nov 05 20:53:08 2002] [notice] child pid 29995 exit signal Segmentation fault (11)
[Tue Nov 05 20:56:24 2002] [info] (104)Connection reset by peer: core_output_filter: writing data to the network
[Tue Nov 05 20:56:24 2002] [info] (32)Broken pipe: core_output_filter: writing data to the network

Is it possible that the scripts are the reason for this? (It worked fine on earlier versions of apache/mod_python).



Morten

-----Opprinnelig melding-----
Fra: Gregory (Grisha) Trubetskoy [mailto:grisha@modpython.org]
Sendt: 5. november 2002 20:20
Til: Morten Tryfoss
Kopi: mod_python@modpython.org
Emne: Re: SV: [mod_python] Problem with mod_python3.0(beta4),
python2.2.1and apache 2.0.43



The first thing I would try is upgrading to Python 2.2.2. If that doesn't
solve it, then you need to try to figure out a way to replicate this
issue, which is easier said than done. So far I haven't had any segfault
reports for BETA4, so I have no other info to relate this to.

Grisha

On Tue, 5 Nov 2002, Morten Tryfoss wrote:

> SuSE Linux 8.0 (2.4.18)
>
> Morten
>
> -----Opprinnelig melding-----
> Fra: Gregory (Grisha) Trubetskoy [mailto:grisha@modpython.org]
> Sendt: 5. november 2002 19:49
> Til: Morten Tryfoss
> Emne: Re: [mod_python] Problem with mod_python3.0(beta4), python
> 2.2.1and apache 2.0.43
>
>
>
> Morten - what's your operating system?
>
> On Tue, 5 Nov 2002, Morten Tryfoss wrote:
>
> >
> > I start my server up, and everything works ok. But after av while(when
> > the number of clients raise) some of the apache childs segfaults. Users
> > who are running on their persistent connections may still use the
> > server, but new connections are dropped. Any thoughts of what may be
> > wrong?
> >
> > Currently I'm running apache 1.3.x, but some part of my scripts performs
> > poorly. Running them on apache 2.0 improved a lot (as long as the server
> > didn't crash).
> >
> >
> > Morten Tryfoss
> >
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://www.modpython.org/mailman/listinfo/mod_python
> >
>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
>



From glunsford at monbar.com  Wed Nov  6 14:22:42 2002
From: glunsford at monbar.com (George Lunsford)
Date: Fri Jan  9 21:53:13 2004
Subject: [mod_python] mod_python & apache config issues
Message-ID: <52E5514ECBC5D611B3E100D0B7B84F5A24CE85@EXCHMAIL>

For the past few days I've been experimenting with installing mod_python
2.7.8 on an Apache 1.3.22 server that was from the standard Caldera
OpenLinux 3.1.1 install.  First, I installed the Python interpreter v 2.1.3,
then I tried installing mod_python, and I ran into the whole threading
issue.  I recompiled Python 2.1.3 without threads, and put it in
/usr/local/web/.  I ran into the EAPI error, and added the OPT=-DEAPI into
the src/Makefile.  
 
Now whenever I run apache, if I do strace httpd -X, it looks like it's using
my threaded version of Python (in /usr/local/bin, there's a symlink in
/usr/bin/ to it).  I'll try and paste what I think are the relevant lines
below:
 
stat64("/usr/local/sbin/python", 0xbfffe2ac) = -1 ENOENT (No such file or
directory)
stat64("/sbin/python", 0xbfffe2ac)      = -1 ENOENT (No such file or
directory)
stat64("/usr/sbin/python", 0xbfffe2ac)  = -1 ENOENT (No such file or
directory)
stat64("/bin/python", 0xbfffe2ac)       = -1 ENOENT (No such file or
directory)
stat64("/usr/bin/python", {st_mode=S_IFREG|0755, st_size=1469444, ...}) = 0
readlink("/usr/bin/python", "/usr/local/bin/python", 1024) = 21
readlink("/usr/local/bin/python", 0xbfffe434, 1024) = -1 EINVAL (Invalid
argument)
stat64("/usr/local/bin/Modules/Setup", 0xbfffe26c) = -1 ENOENT (No such file
or directory)
stat64("/usr/local/bin/lib/python2.1/os.py", 0xbfffe24c) = -1 ENOENT (No
such file or directory)
stat64("/usr/local/bin/lib/python2.1/os.pyc", 0xbfffe23c) = -1 ENOENT (No
such file or directory)
stat64("/usr/local/lib/python2.1/os.py", {st_mode=S_IFREG|0644,
st_size=17401, ...}) = 0
 
Apache would run, but at the first connection (even just to get the root
index file of a directory, it would segfault.  It doesn't appear to be doing
that anymore, however... now it exits with this error eventually (without
needing to connect to the server):
 
[Wed Nov  6 14:37:58 2002] [crit] (98)Address already in use: make_sock:
could not bind to port 80
 
I was wondering if anyone could give me any advice/help with this issue.
Thanks in advance.
 
George Lunsford
 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mailman.modpython.org/pipermail/mod_python/attachments/20021106/34dbf358/attachment-0001.htm
From conrad at hep.caltech.edu  Fri Nov  8 11:24:56 2002
From: conrad at hep.caltech.edu (Conrad Steenberg)
Date: Fri Jan  9 21:53:13 2004
Subject: [mod_python] Interest in sendfile from mod_python?
Message-ID: <1036783496.6448.491.camel@heppc22.hep.caltech.edu>

Hi

My mod_python application regularly needs to send data from files. This
could be either entire files or parts of files.

The Linux and FreeBSD (I think) sendfile calls make this very easy and
efficient in Apache itself, but there is no way to control this from
within mod_python as far as I can see.

My solution was to build a Python sendfile module (using code from the
Medusa server, under the Python license), and create a patch for
mod_python to get the request file-descriptor to pass to the sendfile
call.

So the question is, is anybody else interested in this? Either for me to
contribute the mod_python patch and sendfile package, or for integration
of these two parts into mod_pyhton itself?

Just thought I'd ask :-)

Conrad

Ps. and if using sendfile from mod_python was doable already please feel
free to tell me how ;-)

-- 
*-----------------------------------------*
| Conrad Steenberg                        |
| Caltech, Mail Code 356-48               |
| Pasadena, CA, 91125                     |
| e-mail: conrad@hep.caltech.edu          |
| Tel: (626) 395-8758                     |
*-----------------------------------------*


From jwyant at sfbcic.com  Fri Nov  8 14:16:01 2002
From: jwyant at sfbcic.com (Wyant, Jaime)
Date: Fri Jan  9 21:53:13 2004
Subject: [mod_python] Grabbing the callback object
Message-ID: <654DAEACA633D511B5F500902784B052188EAA@MS-EXCHANGE>

Hi all!

Is there any way to grab the Callback object?  I really want to override the
"ReportError" method and generate a more meaningful error message with
pretty graphics.

Better yet, is there a way to catch unhandled exceptions and display a
custom error message? 

thanks!

jaime wyant (jwyant@sfbcic . com)
MS Farm Bureau
(601) 977 - 4291



From conrad at hep.caltech.edu  Fri Nov  8 13:31:49 2002
From: conrad at hep.caltech.edu (Conrad Steenberg)
Date: Fri Jan  9 21:53:13 2004
Subject: [mod_python] Grabbing the callback object
In-Reply-To: <654DAEACA633D511B5F500902784B052188EAA@MS-EXCHANGE>
References: <654DAEACA633D511B5F500902784B052188EAA@MS-EXCHANGE>
Message-ID: <1036791109.6448.635.camel@heppc22.hep.caltech.edu>

Hi Jaime

You can write your own error message to the client, and return
apache.DONE to stop Apache from any further processing.

E.g.

def handler(req):
  try:
    <Do some processing>
  except:
    <Write error message, including headers>
    return apache.DONE

  return apache.OK


Cheers!

Conrad

On Fri, 2002-11-08 at 12:16, Wyant, Jaime wrote:
> Hi all!
> 
> Is there any way to grab the Callback object?  I really want to override the
> "ReportError" method and generate a more meaningful error message with
> pretty graphics.
> 
> Better yet, is there a way to catch unhandled exceptions and display a
> custom error message? 
> 
> thanks!
> 
> jaime wyant (jwyant@sfbcic . com)
> MS Farm Bureau
> (601) 977 - 4291
> 
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
-- 
*-----------------------------------------*
| Conrad Steenberg                        |
| Caltech, Mail Code 356-48               |
| Pasadena, CA, 91125                     |
| e-mail: conrad@hep.caltech.edu          |
| Tel: (626) 395-8758                     |
*-----------------------------------------*


From jwyant at sfbcic.com  Fri Nov  8 16:06:58 2002
From: jwyant at sfbcic.com (Wyant, Jaime)
Date: Fri Jan  9 21:53:13 2004
Subject: [mod_python] Grabbing the callback object
Message-ID: <654DAEACA633D511B5F500902784B052188EAD@MS-EXCHANGE>


>>>-----Original Message-----
>>>From: Conrad Steenberg [mailto:conrad@hep.caltech.edu]
>>>Sent: Friday, November 08, 2002 3:32 PM
>>>To: Wyant, Jaime
>>>Cc: 'mod_python@modpython.org'
>>>Subject: Re: [mod_python] Grabbing the callback object
>>>
>>>
>>>Hi Jaime
>>>
>>>You can write your own error message to the client, and return
>>>apache.DONE to stop Apache from any further processing.
>>>
>>>E.g.
>>>
>>>def handler(req):
>>>  try:
>>>    <Do some processing>
>>>  except:
>>>    <Write error message, including headers>
>>>    return apache.DONE
>>>
>>>  return apache.OK
>>>
>>>
>>>Cheers!
>>>
>>>Conrad
>>>

Thanks!  I thought about doing it that way.  Take a peek at a snippet of my
error log:


[Tue Nov  5 07:36:13 2002] [error] PythonHandler mod_python.publisher:
File "/
usr/local/lib/python2.2/site-packages/mod_python/publisher.py", line 88, in
hand
ler
    if func_path[-1] == ".":
[Tue Nov  5 07:36:13 2002] [error] PythonHandler mod_python.publisher:
IndexErro
r: string index out of range
[Tue Nov  5 08:09:44 2002] [error] PythonHandler mod_python.publisher:
Traceback
 (most recent call last):

I'm getting an IndexError in the publisher module.  I have already modified
that module a little bit already and would rather not change it any more.

No, my changes aren't causing the IndexError :).  I simply modified the
handler to "raise apache.SERVER_RETURN, apache.HTTP_NOT_FOUND" when an
ImportError occurred.  This stopped "mostly correct" paths from returning an
"Internal Server Error Message".  I can elaborate if you are curious.

Maybe I could create a wrapper handler for the publisher handler?

# my wrapper

import mod_python.publisher

def handler( req ):
  try:
    return mod_python.publisher.handler( req )    
  except Exception:
    req.write( create_cool_html_error_report() )
    return apache.OK


Thanks!
jaime

>>>On Fri, 2002-11-08 at 12:16, Wyant, Jaime wrote:
>>>> Hi all!
>>>> 
>>>> Is there any way to grab the Callback object?  I really 
>>>want to override the
>>>> "ReportError" method and generate a more meaningful error 
>>>message with
>>>> pretty graphics.
>>>> 
>>>> Better yet, is there a way to catch unhandled exceptions 
>>>and display a
>>>> custom error message? 
>>>> 
>>>> thanks!
>>>> 
>>>> jaime wyant (jwyant@sfbcic . com)
>>>> MS Farm Bureau
>>>> (601) 977 - 4291
>>>> 
>>>> 
>>>> _______________________________________________
>>>> Mod_python mailing list
>>>> Mod_python@modpython.org
>>>> http://www.modpython.org/mailman/listinfo/mod_python
>>>-- 
>>>*-----------------------------------------*
>>>| Conrad Steenberg                        |
>>>| Caltech, Mail Code 356-48               |
>>>| Pasadena, CA, 91125                     |
>>>| e-mail: conrad@hep.caltech.edu          |
>>>| Tel: (626) 395-8758                     |
>>>*-----------------------------------------*
>>>
>>>_______________________________________________
>>>Mod_python mailing list
>>>Mod_python@modpython.org
>>>http://www.modpython.org/mailman/listinfo/mod_python
>>>

From conrad at hep.caltech.edu  Fri Nov  8 14:20:56 2002
From: conrad at hep.caltech.edu (Conrad Steenberg)
Date: Fri Jan  9 21:53:13 2004
Subject: [mod_python] Grabbing the callback object
In-Reply-To: <654DAEACA633D511B5F500902784B052188EAD@MS-EXCHANGE>
References: <654DAEACA633D511B5F500902784B052188EAD@MS-EXCHANGE>
Message-ID: <1036794056.6446.695.camel@heppc22.hep.caltech.edu>

On Fri, 2002-11-08 at 14:06, Wyant, Jaime wrote:
> 
> Maybe I could create a wrapper handler for the publisher handler?
> 
> # my wrapper
> 
> import mod_python.publisher
> 
> def handler( req ):
>   try:
>     return mod_python.publisher.handler( req )    
>   except Exception:
>     req.write( create_cool_html_error_report() )
>     return apache.OK
> 

Yes, for the publisher handler, that sounds rather more sensible. 

Cheers!

Conrad

> 
> >>>On Fri, 2002-11-08 at 12:16, Wyant, Jaime wrote:
> >>>> Hi all!
> >>>> 
> >>>> Is there any way to grab the Callback object?  I really 
> >>>want to override the
> >>>> "ReportError" method and generate a more meaningful error 
> >>>message with
> >>>> pretty graphics.
> >>>> 
> >>>> Better yet, is there a way to catch unhandled exceptions 
> >>>and display a
> >>>> custom error message? 
> >>>> 
> >>>> thanks!
> >>>> 
> >>>> jaime wyant (jwyant@sfbcic . com)
> >>>> MS Farm Bureau
> >>>> (601) 977 - 4291
> >>>> 
> >>>> 



From conrad at hep.caltech.edu  Sat Nov  9 14:17:02 2002
From: conrad at hep.caltech.edu (Conrad Steenberg)
Date: Fri Jan  9 21:53:13 2004
Subject: [mod_python] Interest in sendfile from mod_python?
In-Reply-To: <20021109052035.GZ4761@netvista.mikebell.org>
References: <1036783496.6448.491.camel@heppc22.hep.caltech.edu> 
	<20021109052035.GZ4761@netvista.mikebell.org>
Message-ID: <1036880222.1221.5.camel@192.168.1.100>

Hi Mike

Have a look at sendfilemodule.c in
http://cvs.sourceforge.net/cgi-bin/viewcvs.cgi/clarens/clarens/sendfile/

The patch for mod_python to get the filedescriptor to write to is below.

Cheers!

Conrad

On Fri, 2002-11-08 at 21:20, mike@mikebell.org wrote:
> On Fri, Nov 08, 2002 at 11:24:56AM -0800, Conrad Steenberg wrote:
> > So the question is, is anybody else interested in this? Either for me to
> > contribute the mod_python patch and sendfile package, or for integration
> > of these two parts into mod_pyhton itself?
> 
> I would absolutely be interested. Zero-copy from mod_python, yay. I have
> in fact thought about this in the past but never got around to doing
> anything about it.
--- src/requestobject.c.orig    Tue Jun  4 15:52:45 2002
+++ src/requestobject.c Tue Jun  4 11:15:49 2002
@@ -781,6 +781,27 @@

 }

+/**
+ ** request.get_fd(request self)
+ **
+ *      Returns the file descriptor to write output to
+ */
+
+static PyObject * req_fd(requestobject *self, PyObject *args)
+{
+    PyObject *fd;
+    long thefd;
+    thefd=(long)self->request_rec->connection->client->fd;
+    fd = PyInt_FromLong(thefd);
+    if (!fd) {
+       PyErr_SetString(PyExc_IOError, "Could not determine file descriptor.");
+       return NULL;
+    }
+
static PyMethodDef requestobjectmethods[] = {
     {"add_common_vars",      (PyCFunction) req_add_common_vars,      METH_VARA
     {"add_handler",          (PyCFunction) req_add_handler,          METH_VARA
@@ -797,6 +818,7 @@
     {"register_cleanup",     (PyCFunction) req_register_cleanup,     METH_VARA
     {"send_http_header",     (PyCFunction) req_send_http_header,     METH_VARA
     {"write",                (PyCFunction) req_write,                METH_VARA
+    {"get_fd",               (PyCFunction) req_fd,                   METH_VARA
     { NULL, NULL } /* sentinel */
 };




From conrad at hep.caltech.edu  Sat Nov  9 14:37:02 2002
From: conrad at hep.caltech.edu (Conrad Steenberg)
Date: Fri Jan  9 21:53:13 2004
Subject: [mod_python] Interest in sendfile from mod_python?
In-Reply-To: <1036880222.1221.5.camel@192.168.1.100>
References: <1036783496.6448.491.camel@heppc22.hep.caltech.edu> 
	<20021109052035.GZ4761@netvista.mikebell.org> 
	<1036880222.1221.5.camel@192.168.1.100>
Message-ID: <1036881423.1188.21.camel@192.168.1.100>

Aarghh, take 2 on the patch:

--- src/requestobject.c.orig    Tue Jun  4 15:52:45 2002
+++ src/requestobject.c Tue Jun  4 11:15:49 2002
@@ -781,6 +781,27 @@

 }

+/**
+ ** request.get_fd(request self)
+ **
+ *      Returns the file descriptor to write output to
+ */
+
+static PyObject * req_fd(requestobject *self, PyObject *args)
+{
+    PyObject *fd;
+    long thefd;
+    thefd=(long)self->request_rec->connection->client->fd;
+    fd = PyInt_FromLong(thefd);
+    if (!fd) {
+       PyErr_SetString(PyExc_IOError, "Could not determine file descriptor.");
+       return NULL;
+    }
+
+
+    return fd;
+}
+
+
 static PyMethodDef requestobjectmethods[] = {
     {"add_common_vars",      (PyCFunction) req_add_common_vars,      METH_VARARGS},
     {"add_handler",          (PyCFunction) req_add_handler,          METH_VARARGS},
@@ -797,6 +818,7 @@
     {"register_cleanup",     (PyCFunction) req_register_cleanup,     METH_VARARGS},
     {"send_http_header",     (PyCFunction) req_send_http_header,     METH_VARARGS},
     {"write",                (PyCFunction) req_write,                METH_VARARGS},
+    {"get_fd",               (PyCFunction) req_fd,                   METH_VARARGS},
     { NULL, NULL } /* sentinel */
 };



On Sat, 2002-11-09 at 14:17, Conrad Steenberg wrote:
> Hi Mike
> 
> Have a look at sendfilemodule.c in
> http://cvs.sourceforge.net/cgi-bin/viewcvs.cgi/clarens/clarens/sendfile/
> 
> The patch for mod_python to get the filedescriptor to write to is below.
> 
> Cheers!
> 
> Conrad
> 
> On Fri, 2002-11-08 at 21:20, mike@mikebell.org wrote:
> > On Fri, Nov 08, 2002 at 11:24:56AM -0800, Conrad Steenberg wrote:
> > > So the question is, is anybody else interested in this? Either for me to
> > > contribute the mod_python patch and sendfile package, or for integration
> > > of these two parts into mod_pyhton itself?
> > 
> > I would absolutely be interested. Zero-copy from mod_python, yay. I have
> > in fact thought about this in the past but never got around to doing
> > anything about it.
> --- src/requestobject.c.orig    Tue Jun  4 15:52:45 2002
> +++ src/requestobject.c Tue Jun  4 11:15:49 2002
> @@ -781,6 +781,27 @@
> 
>  }
> 
> +/**
> + ** request.get_fd(request self)
> + **
> + *      Returns the file descriptor to write output to
> + */
> +
> +static PyObject * req_fd(requestobject *self, PyObject *args)
> +{
> +    PyObject *fd;
> +    long thefd;
> +    thefd=(long)self->request_rec->connection->client->fd;
> +    fd = PyInt_FromLong(thefd);
> +    if (!fd) {
> +       PyErr_SetString(PyExc_IOError, "Could not determine file descriptor.");
> +       return NULL;
> +    }
> +
> static PyMethodDef requestobjectmethods[] = {
>      {"add_common_vars",      (PyCFunction) req_add_common_vars,      METH_VARA
>      {"add_handler",          (PyCFunction) req_add_handler,          METH_VARA
> @@ -797,6 +818,7 @@
>      {"register_cleanup",     (PyCFunction) req_register_cleanup,     METH_VARA
>      {"send_http_header",     (PyCFunction) req_send_http_header,     METH_VARA
>      {"write",                (PyCFunction) req_write,                METH_VARA
> +    {"get_fd",               (PyCFunction) req_fd,                   METH_VARA
>      { NULL, NULL } /* sentinel */
>  };
> 
> 
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python



From laurie at tratt.net  Sun Nov 10 17:51:00 2002
From: laurie at tratt.net (Laurence Tratt)
Date: Fri Jan  9 21:53:13 2004
Subject: [mod_python] mod_python and OpenBSD
Message-ID: <20021110175100.A31721@purcell.dcs.kcl.ac.uk>

Hi all,

Has anyone managed to build mod_python-3.0.0-BETA4 under OpenBSD? I'm
running OpenBSD 3.2-current, have got Apache 2.0.43 but haven't actually
managed to build mp yet, and would be very interested to hear if anyone's
got this combination to play ball yet.

The problem I have is that mod_python.so itself isn't ever getting built.
Virtually every other filename extension after "mod_python." exists, but not
"so": the most likely culprit is libtool, a favoured target of bile in the
OpenBSD community, but I'm no expert on it (nor on the particular variant
that Apache ships in build/). The eventual result of not building the lib is
a dangling sym link from src/ to lib/ just to make things fun! If anybody's
interested in having a look at this, I can hook them up with an account on
an OpenBSD machine.


Whilst I'm here, I might as well tell you guys what I actually want mp to
do. If it's a Really Bad Idea, please feel free to tell me :) Essentially, I
want to have a filter which takes pages in a sort-of psuedo HTML format, and
then munges them into a full page before sending them on. I've prototyped it
in Apache 1.3 as a handler/cgi-script thing, and it works fine except that
you're limited by the fact that you can't post-process data from other
sources (eg I will probably need to munge PHP output too). So filters in
Apache 2.0 look like the way to go, and obviously I want it to run
efficiently hence my interest in mod_python. From what I can tell, at the
moment mp's filter support can't handle fiddling with HTTP headers which I
will need to do (my filter also having to deal with setting cookies), but
I'm unclear as to whether that's a fundamental problem, or whether it just
hasn't been coded up yet.

Thanks in advance for any help,


Laurie

From agenkin-lst-mod_python at thpoon.com  Sun Nov 10 12:52:44 2002
From: agenkin-lst-mod_python at thpoon.com (Arcady Genkin)
Date: Fri Jan  9 21:53:13 2004
Subject: [mod_python] online docs for mp version 3?
Message-ID: <86bs4xjor7.fsf@tea.thpoon.com>

Is there a copy of documentation for version 3.0 of mod_python online
somewhere?

Thanks.
-- 
Arcady Genkin

guilt is the cause of more disauders
than history's most obscene marorders                       (E.E. Cummings)

From agenkin-lst-mod_python at thpoon.com  Sun Nov 10 13:06:56 2002
From: agenkin-lst-mod_python at thpoon.com (Arcady Genkin)
Date: Fri Jan  9 21:53:13 2004
Subject: [mod_python] Default function for Publisher
Message-ID: <867kfljo3j.fsf@tea.thpoon.com>

I spent a few hours trying to figure out how to make the url
"http://foo" respond with a python handler in index.py.  In the end I
came up with the following:

   RewriteEngine on
   RewriteRule ^/*$ /index.py/main

which seems to work, but is a hack.  In the list archives I saw a few
threads that proposed introducing a default handler function for the
Publisher, but the impression I got was that the functionality still
is not implemented.

As a new user of mod_python, I'd like to pitch in that default
Publisher function would save me a lot of trouble and time, which I'd
rather have spent getting to know mod_python than learning how
mod_rewrite works.  It would be much cleaner to write:

  DirectoryIndex index.py
  PyPublisherDefaultFunction main

or some such.
-- 
Arcady Genkin

guilt is the cause of more disauders
than history's most obscene marorders                       (E.E. Cummings)

From agenkin-lst-mod_python at thpoon.com  Sun Nov 10 13:25:45 2002
From: agenkin-lst-mod_python at thpoon.com (Arcady Genkin)
Date: Fri Jan  9 21:53:13 2004
Subject: [mod_python] Apache children crashing with mod_python 3.0 beta4
Message-ID: <863cq9jn86.fsf@tea.thpoon.com>

I'm trying out mod_python-3 beta 4 on FreeBSD 4.7.  Python is version
2.2.2 compiled from ports without threading support.  Apache is 2.0.43
compiled from ports with threads enabled, running with default
configuration (apart from mod_python customizations); mod_python is
the only non-stock module loaded into it.

Even though mod_python seems to be working fine, I am seeing the
following in the apache's error logs:

Fatal Python error: PyThreadState_Delete: tstate is still current
Fatal Python error: PyThreadState_Delete: tstate is still current
Fatal Python error: PyThreadState_Delete: tstate is still current
Fatal Python error: PyThreadState_Delete: tstate is still current
[Sun Nov 10 12:29:32 2002] [notice] child pid 27272 exit signal Abort trap (6)
[Sun Nov 10 12:29:32 2002] [notice] child pid 27267 exit signal Abort trap (6)
[Sun Nov 10 12:29:32 2002] [notice] child pid 27266 exit signal Abort trap (6)
[Sun Nov 10 12:29:32 2002] [notice] child pid 27265 exit signal Abort trap (6)

How likely is this due to a misconfiguration?  Any pointers?

Many thanks,
-- 
Arcady Genkin

guilt is the cause of more disauders
than history's most obscene marorders                       (E.E. Cummings)

From agenkin-lst-mod_python at thpoon.com  Sun Nov 10 13:28:43 2002
From: agenkin-lst-mod_python at thpoon.com (Arcady Genkin)
Date: Fri Jan  9 21:53:13 2004
Subject: [mod_python] online docs for mp version 3?
References: <86bs4xjor7.fsf@tea.thpoon.com>
Message-ID: <86vg35i8is.fsf@tea.thpoon.com>

Arcady Genkin <agenkin-lst-mod_python@thpoon.com> writes:

> Is there a copy of documentation for version 3.0 of mod_python online
> somewhere?

Never mind.  I now see that the distribution tarball includes
generated HTML documenation (I thought that only the LaTeX sources
were included).  Sorry for the noise.
-- 
Arcady Genkin

guilt is the cause of more disauders
than history's most obscene marorders                       (E.E. Cummings)

From grisha at modpython.org  Sun Nov 10 14:30:19 2002
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:53:13 2004
Subject: [mod_python] Default function for Publisher
In-Reply-To: <867kfljo3j.fsf@tea.thpoon.com>
Message-ID: <20021110142943.T3802-100000@eden.ispol.com>

in MP 3.0 it defaults "index"

Grisha

On Sun, 10 Nov 2002, Arcady Genkin wrote:

> I spent a few hours trying to figure out how to make the url
> "http://foo" respond with a python handler in index.py.  In the end I
> came up with the following:
>
>    RewriteEngine on
>    RewriteRule ^/*$ /index.py/main
>
> which seems to work, but is a hack.  In the list archives I saw a few
> threads that proposed introducing a default handler function for the
> Publisher, but the impression I got was that the functionality still
> is not implemented.
>
> As a new user of mod_python, I'd like to pitch in that default
> Publisher function would save me a lot of trouble and time, which I'd
> rather have spent getting to know mod_python than learning how
> mod_rewrite works.  It would be much cleaner to write:
>
>   DirectoryIndex index.py
>   PyPublisherDefaultFunction main
>
> or some such.
> --
> Arcady Genkin
>
> guilt is the cause of more disauders
> than history's most obscene marorders                       (E.E. Cummings)
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
>


From grisha at modpython.org  Sun Nov 10 14:33:11 2002
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:53:13 2004
Subject: [mod_python] Apache children crashing with mod_python 3.0 beta4
In-Reply-To: <863cq9jn86.fsf@tea.thpoon.com>
Message-ID: <20021110143055.H3802-100000@eden.ispol.com>

See the README file. On FreeBSD you need to have threads enabled in both
Python and Apache. The default Python port will have threads enabled, and
to make Apache thread-enabled, you need --enable-threads in the Makefile.

On Sun, 10 Nov 2002, Arcady Genkin wrote:

> I'm trying out mod_python-3 beta 4 on FreeBSD 4.7.  Python is version
> 2.2.2 compiled from ports without threading support.  Apache is 2.0.43
> compiled from ports with threads enabled, running with default
> configuration (apart from mod_python customizations); mod_python is
> the only non-stock module loaded into it.
>
> Even though mod_python seems to be working fine, I am seeing the
> following in the apache's error logs:
>
> Fatal Python error: PyThreadState_Delete: tstate is still current
> Fatal Python error: PyThreadState_Delete: tstate is still current
> Fatal Python error: PyThreadState_Delete: tstate is still current
> Fatal Python error: PyThreadState_Delete: tstate is still current
> [Sun Nov 10 12:29:32 2002] [notice] child pid 27272 exit signal Abort trap (6)
> [Sun Nov 10 12:29:32 2002] [notice] child pid 27267 exit signal Abort trap (6)
> [Sun Nov 10 12:29:32 2002] [notice] child pid 27266 exit signal Abort trap (6)
> [Sun Nov 10 12:29:32 2002] [notice] child pid 27265 exit signal Abort trap (6)
>
> How likely is this due to a misconfiguration?  Any pointers?
>
> Many thanks,
> --
> Arcady Genkin
>
> guilt is the cause of more disauders
> than history's most obscene marorders                       (E.E. Cummings)
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
>


From agenkin-lst-mod_python at thpoon.com  Sun Nov 10 16:12:59 2002
From: agenkin-lst-mod_python at thpoon.com (Arcady Genkin)
Date: Fri Jan  9 21:53:13 2004
Subject: [mod_python] Apache children crashing with mod_python 3.0 beta4
In-Reply-To: <20021110143055.H3802-100000@eden.ispol.com> ("Gregory's
 message of "Sun, 10 Nov 2002 14:33:11 -0500 (EST)")
References: <20021110143055.H3802-100000@eden.ispol.com>
Message-ID: <uoof8x5dt0.fsf@bashful.cdf.toronto.edu>

"Gregory (Grisha) Trubetskoy" <grisha@modpython.org> writes:

> See the README file. On FreeBSD you need to have threads enabled in both
> Python and Apache. 

The README file only tells to compile Apache with threads, which I
read and did.  Perhaps you need to add the bit about Python with
threads enabled.

Thanks for your reply!
-- 
Arcady Genkin : CDF Systems Administrator
http://www.cdf.toronto.edu/~agenkin/contact.html

guilt is the cause of more disauders
than history's most obscene marorders (E.E. Cummings)

From agenkin-lst-mod_python at thpoon.com  Sun Nov 10 16:36:38 2002
From: agenkin-lst-mod_python at thpoon.com (Arcady Genkin)
Date: Fri Jan  9 21:53:13 2004
Subject: [mod_python] Default function for Publisher in 3.0
In-Reply-To: <20021110142943.T3802-100000@eden.ispol.com> ("Gregory's
 message of "Sun, 10 Nov 2002 14:30:19 -0500 (EST)")
References: <20021110142943.T3802-100000@eden.ispol.com>
Message-ID: <uoheep5cpl.fsf@bashful.cdf.toronto.edu>

"Gregory (Grisha) Trubetskoy" <grisha@modpython.org> writes:

> in MP 3.0 it defaults "index"

Great!  However, this does not seem to work with
"DirectoryIndex index.py".
I get the following when accessing the url http://myhost/ :

,----
| Mod_python error: "PythonHandler mod_python.publisher"
| 
| Traceback (most recent call last):
| 
|   File "/usr/local/lib/python2.2/site-packages/mod_python/apache.py",
|   line 335, in HandlerDispatch
|     result = object(req)
| 
|   File "/usr/local/lib/python2.2/site-packages/mod_python/publisher.py",
|   line 86, in handler
|     func_path = req.path_info[1:] # skip first /
| 
| TypeError: unsubscriptable object
`----

Accessing http://myhost/index.py works fine.
-- 
Arcady Genkin : CDF Systems Administrator
http://www.cdf.toronto.edu/~agenkin/contact.html

guilt is the cause of more disauders
than history's most obscene marorders (E.E. Cummings)

From agenkin-lst-mod_python at thpoon.com  Sun Nov 10 16:42:55 2002
From: agenkin-lst-mod_python at thpoon.com (Arcady Genkin)
Date: Fri Jan  9 21:53:13 2004
Subject: [mod_python] Documentation bug for 3.0
Message-ID: <uod6pd5cf4.fsf@bashful.cdf.toronto.edu>

In the html documentation, distributed with the 3.0 tarball, Section
6.1.1 (introduction to publisher handler) suggests the following
configuration in httpd.conf:

<Directory /some/path}
    SetHandler python-program 
    PythonHandler mod_python.publisher
</Directory>

But this results in a syntax error:

   AddHandler requires at least two arguments, a handler name followed
   by one or more file extensions

Seems that ".py" is missing at the end of SetHandler directive.
-- 
Arcady Genkin : CDF Systems Administrator
http://www.cdf.toronto.edu/~agenkin/contact.html

guilt is the cause of more disauders
than history's most obscene marorders (E.E. Cummings)

From agenkin-lst-mod_python at thpoon.com  Sun Nov 10 16:56:52 2002
From: agenkin-lst-mod_python at thpoon.com (Arcady Genkin)
Date: Fri Jan  9 21:53:13 2004
Subject: [mod_python] Documentation bug for 3.0
In-Reply-To: <uod6pd5cf4.fsf@bashful.cdf.toronto.edu> (Arcady Genkin's
 message of "Sun, 10 Nov 2002 16:42:55 -0500")
References: <uod6pd5cf4.fsf@bashful.cdf.toronto.edu>
Message-ID: <uo7kfl5brv.fsf@bashful.cdf.toronto.edu>

Errm...  I must get the pointy hat of the day for being so
inattentive.  Of course, the docs say "SetHandler", while I have
"AddHandler" in the config file.

Many appologies.

Arcady Genkin <agenkin-lst-mod_python@thpoon.com> writes:

> In the html documentation, distributed with the 3.0 tarball, Section
> 6.1.1 (introduction to publisher handler) suggests the following
> configuration in httpd.conf:
>
> <Directory /some/path}
>     SetHandler python-program 
>     PythonHandler mod_python.publisher
> </Directory>
>
> But this results in a syntax error:
>
>    AddHandler requires at least two arguments, a handler name followed
>    by one or more file extensions
>
> Seems that ".py" is missing at the end of SetHandler directive.

-- 
Arcady Genkin : CDF Systems Administrator
http://www.cdf.toronto.edu/~agenkin/contact.html

guilt is the cause of more disauders
than history's most obscene marorders (E.E. Cummings)

From agenkin-lst-mod_python at thpoon.com  Sun Nov 10 17:11:26 2002
From: agenkin-lst-mod_python at thpoon.com (Arcady Genkin)
Date: Fri Jan  9 21:53:13 2004
Subject: [mod_python] Default function for Publisher in 3.0
References: <20021110142943.T3802-100000@eden.ispol.com>
	<uoheep5cpl.fsf@bashful.cdf.toronto.edu>
Message-ID: <uowunl3wj5.fsf@bashful.cdf.toronto.edu>

Arcady Genkin <agenkin-lst-mod_python@thpoon.com> writes:

> this does not seem to work with "DirectoryIndex index.py".

An update: I had a problem with configuration (using AddHandler
directive instead of the SetHandler, as recommended in the docs).
However, still can't use index.py implicitely.  Now the backtrace
looks this way:

,----
| Mod_python error: "PythonHandler mod_python.publisher"
| 
| Traceback (most recent call last):
| 
|   File "/usr/local/lib/python2.2/site-packages/mod_python/apache.py",
|   line 335, in HandlerDispatch
|     result = object(req)
| 
|   File "/usr/local/lib/python2.2/site-packages/mod_python/publisher.py",
|   line 145, in handler
|     module = apache.import_module(module_name, req.get_config(), [path])
| 
|   File "/usr/local/lib/python2.2/site-packages/mod_python/apache.py",
|   line 499, in import_module
|     f, p, d = imp.find_module(parts[i], path)
| 
| ImportError: No module named 
`----

The httpd.conf contains the following configuration:

,----
| <Directory "/var/www/data">
|    PythonDebug On
|    SetHandler python-program
|    PythonHandler mod_python.publisher
|    DirectoryIndex index.py
| </Directory>
`----

Something tells me that I am still doing something wrong.  I tried
setting DIrectoryIndex to "index" instead of "index.py", but this
still did not work.  Any ideas?

Many thanks,
-- 
Arcady Genkin : CDF Systems Administrator
http://www.cdf.toronto.edu/~agenkin/contact.html

guilt is the cause of more disauders
than history's most obscene marorders (E.E. Cummings)

From gstein at lyra.org  Sun Nov 10 17:05:40 2002
From: gstein at lyra.org (Greg Stein)
Date: Fri Jan  9 21:53:13 2004
Subject: [mod_python] Interest in sendfile from mod_python?
In-Reply-To: <1036783496.6448.491.camel@heppc22.hep.caltech.edu>; from conrad@hep.caltech.edu on Fri, Nov 08, 2002 at 11:24:56AM -0800
References: <1036783496.6448.491.camel@heppc22.hep.caltech.edu>
Message-ID: <20021110170540.C4640@lyra.org>

On Fri, Nov 08, 2002 at 11:24:56AM -0800, Conrad Steenberg wrote:
>...
> The Linux and FreeBSD (I think) sendfile calls make this very easy and
> efficient in Apache itself, but there is no way to control this from
> within mod_python as far as I can see.

In Apache 2.0, the Python code needs to construct a FILE bucket and shove
that into the output filter stack. Assuming that it doesn't get processed by
mod_includes or somesuch on the way through the filters, then it will hit
the network output filter and be sendfile'd.

> My solution was to build a Python sendfile module (using code from the
> Medusa server, under the Python license), and create a patch for
> mod_python to get the request file-descriptor to pass to the sendfile
> call.

The file descriptor is private info. Modules should never access it.


All that said: I'm not sure if mod_python allows you to construct buckets
right now. Grisha could answer that in a jiffy...

Cheers,
-g

-- 
Greg Stein, http://www.lyra.org/

From gstein at lyra.org  Sun Nov 10 17:07:39 2002
From: gstein at lyra.org (Greg Stein)
Date: Fri Jan  9 21:53:13 2004
Subject: [mod_python] Apache children crashing with mod_python 3.0 beta4
In-Reply-To: <20021110143055.H3802-100000@eden.ispol.com>; from grisha@modpython.org on Sun, Nov 10, 2002 at 02:33:11PM -0500
References: <863cq9jn86.fsf@tea.thpoon.com> <20021110143055.H3802-100000@eden.ispol.com>
Message-ID: <20021110170739.D4640@lyra.org>

Also make sure that Apache is configured to use the "prefork" MPM. The
thread-based MPMs don't work in FreeBSD because of its broken sendfile
implementation (it breaks in threaded environments; this has been fixed in
very recent BSDs... not sure which).

Cheers,
-g

On Sun, Nov 10, 2002 at 02:33:11PM -0500, Gregory (Grisha) Trubetskoy wrote:
> 
> See the README file. On FreeBSD you need to have threads enabled in both
> Python and Apache. The default Python port will have threads enabled, and
> to make Apache thread-enabled, you need --enable-threads in the Makefile.
> 
> On Sun, 10 Nov 2002, Arcady Genkin wrote:
> 
> > I'm trying out mod_python-3 beta 4 on FreeBSD 4.7.  Python is version
> > 2.2.2 compiled from ports without threading support.  Apache is 2.0.43
> > compiled from ports with threads enabled, running with default
> > configuration (apart from mod_python customizations); mod_python is
> > the only non-stock module loaded into it.
> >
> > Even though mod_python seems to be working fine, I am seeing the
> > following in the apache's error logs:
> >
> > Fatal Python error: PyThreadState_Delete: tstate is still current
> > Fatal Python error: PyThreadState_Delete: tstate is still current
> > Fatal Python error: PyThreadState_Delete: tstate is still current
> > Fatal Python error: PyThreadState_Delete: tstate is still current
> > [Sun Nov 10 12:29:32 2002] [notice] child pid 27272 exit signal Abort trap (6)
> > [Sun Nov 10 12:29:32 2002] [notice] child pid 27267 exit signal Abort trap (6)
> > [Sun Nov 10 12:29:32 2002] [notice] child pid 27266 exit signal Abort trap (6)
> > [Sun Nov 10 12:29:32 2002] [notice] child pid 27265 exit signal Abort trap (6)
> >
> > How likely is this due to a misconfiguration?  Any pointers?
> >
> > Many thanks,
> > --
> > Arcady Genkin
> >
> > guilt is the cause of more disauders
> > than history's most obscene marorders                       (E.E. Cummings)
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://www.modpython.org/mailman/listinfo/mod_python
> >
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python

-- 
Greg Stein, http://www.lyra.org/

From neel at mediapulse.com  Mon Nov 11 13:15:19 2002
From: neel at mediapulse.com (Michael C. Neel)
Date: Fri Jan  9 21:53:14 2004
Subject: [mod_python] Default function for Publisher in 3.0
Message-ID: <C0FC22C08B82074A88B50061764157772C647F@johnson.mediapulse.net>

This is an untested guess, but I think apache needs to see "index.py" in
the document root before it will send the client a redirect to
spam.com/index.py - try doing a touch index.py in the doc root and see
what happens...

Mike

> -----Original Message-----
> From: Arcady Genkin [mailto:agenkin-lst-mod_python@thpoon.com] 
> Sent: Sunday, November 10, 2002 5:11 PM
> To: mod_python@modpython.org
> Subject: Re: [mod_python] Default function for Publisher in 3.0
> 
> 
> Arcady Genkin <agenkin-lst-mod_python@thpoon.com> writes:
> 
> > this does not seem to work with "DirectoryIndex index.py".
> 
> An update: I had a problem with configuration (using AddHandler
> directive instead of the SetHandler, as recommended in the docs).
> However, still can't use index.py implicitely.  Now the backtrace
> looks this way:
> 
> ,----
> | Mod_python error: "PythonHandler mod_python.publisher"
> | 
> | Traceback (most recent call last):
> | 
> |   File 
> "/usr/local/lib/python2.2/site-packages/mod_python/apache.py",
> |   line 335, in HandlerDispatch
> |     result = object(req)
> | 
> |   File 
> "/usr/local/lib/python2.2/site-packages/mod_python/publisher.py",
> |   line 145, in handler
> |     module = apache.import_module(module_name, 
> req.get_config(), [path])
> | 
> |   File 
> "/usr/local/lib/python2.2/site-packages/mod_python/apache.py",
> |   line 499, in import_module
> |     f, p, d = imp.find_module(parts[i], path)
> | 
> | ImportError: No module named 
> `----
> 
> The httpd.conf contains the following configuration:
> 
> ,----
> | <Directory "/var/www/data">
> |    PythonDebug On
> |    SetHandler python-program
> |    PythonHandler mod_python.publisher
> |    DirectoryIndex index.py
> | </Directory>
> `----
> 
> Something tells me that I am still doing something wrong.  I tried
> setting DIrectoryIndex to "index" instead of "index.py", but this
> still did not work.  Any ideas?
> 
> Many thanks,
> -- 
> Arcady Genkin : CDF Systems Administrator
> http://www.cdf.toronto.edu/~agenkin/contact.html
> 
> guilt is the cause of more disauders
> than history's most obscene marorders (E.E. Cummings)
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 


From jgramlich at piocon.com  Mon Nov 11 12:32:27 2002
From: jgramlich at piocon.com (Joshua Gramlich)
Date: Fri Jan  9 21:53:14 2004
Subject: [mod_python] Installation Issues - Apache2 Python2.2 RedHat
Message-ID: <021b01c289b0$b01c76a0$cb3ac341@ginworks.com>

Howdy.  I've looked through the archives and couldn't find anything in particularly specific to my issue, so here goes:

I'm trying to install mod_python with thread support (no reason, just because).  I made the jump up to Apache2, and it is working fine.  I've also got Python 2.2.1 installed.  I'm using RedHat 7.2 as my platform, and python2 is installed via source RPM(./configure'd, make'd, and make install'd).  Apache, I compiled from source.

When I configure mod python I do so like this:

./configure --with-apxs=/usr/local/apache/bin/apxs --with-python=/usr/src/redhat/SOURCES/Python-2.2.1

...and I get the following (partial):

hecking for Apache include directory... -I/usr/local/httpd-2.0.43/include
checking for --with-apache... no
configure: warning: **** No apache sources specified, static compilation will not be available.
configure: warning: **** You can use --with-apache to specify where your Apache sources are.
checking for --with-python... /usr/src/redhat/SOURCES/Python-2.2.1
checking for python... (cached) /usr/bin/python
checking Python version... 1.5
checking whether Python is compiled with thread support... yes

  ****** WARNING ******
  Python is compiled with thread support. Apache 1.3 does not use threads.
  On some systems this will cause problems during compilation, on others
  it may result in unpredictable behaviour of your Apache server. Yet on
  others it will work just fine. The recommended approach is to compile
  Python without thread support in a separate location and specify it with
  --with-python option to this ./configure script.

checking Python install prefix... /usr
checking what libraries Python was linked with... grep: /usr/src/redhat/SOURCES/Python-2.2.1/Modules/Makefile: No such file or directory
grep: /usr/src/redhat/SOURCES/Python-2.2.1/Modules/Makefile: No such file or directory
/usr/src/redhat/SOURCES/Python-2.2.1/libpython1.5.a
checking linker flags used to link Python...  -Xlinker -export-dynamic



...So anyways, I keep seeing "checking Python version...1.5" and I'm wondering if this is a problem.  Reason being, when I type "make dso" after configuring mod_python, I get this:

make dso
make[1]: Entering directory `/usr/src/mod_python-2.7.8/src'
gcc  -I/usr/src/mod_python-2.7.8/src/include -I/usr/local/httpd-2.0.43/include -I/usr/src/redhat/SOURCES/Python-2.2.1 -I/usr/src/redhat/SOURCES/Python-2.2.1/Include    -c -o mod_python.o mod_python.c
In file included from mod_python.c:54:
/usr/src/mod_python-2.7.8/src/include/mod_python.h:93: parse error before `*'
/usr/src/mod_python-2.7.8/src/include/mod_python.h:93: warning: data definition has no type or storage class
/usr/src/mod_python-2.7.8/src/include/mod_python.h:96: parse error before `python_module'
/usr/src/mod_python-2.7.8/src/include/mod_python.h:96: warning: data definition has no type or storage class
In file included from /usr/src/mod_python-2.7.8/src/include/mod_python.h:99,
                 from mod_python.c:54:
/usr/src/mod_python-2.7.8/src/include/util.h:57: parse error before `*'
In file included from /usr/src/mod_python-2.7.8/src/include/mod_python.h:100,
                 from mod_python.c:54:
/usr/src/mod_python-2.7.8/src/include/tableobject.h:69blablahblahblah....



Anyone have any ideas as to why this isn't working?


Josh
Chicago, IL
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mailman.modpython.org/pipermail/mod_python/attachments/20021111/3e9b4dca/attachment-0001.htm
From agenkin-lst-mod_python at thpoon.com  Mon Nov 11 14:04:59 2002
From: agenkin-lst-mod_python at thpoon.com (Arcady Genkin)
Date: Fri Jan  9 21:53:14 2004
Subject: [mod_python] Default function for Publisher in 3.0
In-Reply-To: <C0FC22C08B82074A88B50061764157772C647F@johnson.mediapulse.net> ("Michael
 C. Neel"'s message of "Mon, 11 Nov 2002 13:15:19 -0500")
References: <C0FC22C08B82074A88B50061764157772C647F@johnson.mediapulse.net>
Message-ID: <uo7kfk3p2c.fsf@bashful.cdf.toronto.edu>

"Michael C. Neel" <neel@mediapulse.com> writes:

> This is an untested guess, but I think apache needs to see "index.py" in
> the document root before it will send the client a redirect to
> spam.com/index.py - try doing a touch index.py in the doc root and see
> what happens...

The document root is '/var/www/data', and I do have a script
'/var/www/data/index.py', which, in turn, has an 'index' function.
Connecting to http://spam.com/index/index and http://spam.com/index
works fine (i.e. the default function is working properly), but for
http://spam.com/ I get the backtrace, included in my previous message.

Any more ideas?
-- 
Arcady Genkin : CDF Systems Administrator
http://www.cdf.toronto.edu/~agenkin/contact.html

guilt is the cause of more disauders
than history's most obscene marorders (E.E. Cummings)

From grisha at apache.org  Mon Nov 11 15:04:58 2002
From: grisha at apache.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:53:14 2004
Subject: [mod_python] Default function for Publisher in 3.0
In-Reply-To: <C0FC22C08B82074A88B50061764157772C647F@johnson.mediapulse.net>
Message-ID: <20021111143821.W17409-100000@eden.ispol.com>

I looked at the mod_dir.c code, it looks like if you use SetHandler,
DirectoryIndex has no effect, but if you use AddHandler, DirectoryIndex
does apply, but the problem is that req.path_info in this case ends up
bing None (or NULL) as opposed to a blank string, thus the
"Unsubscriptable Object" error.

To get around this, try this patch:

--- publishre.py.old    Mon Nov 11 14:51:44 2002
+++ publisher.py        Mon Nov 11 14:50:13 2002
@@ -83,10 +83,12 @@
     if req.method not in ["GET", "POST"]:
         raise apache.SERVER_RETURN, apache.HTTP_METHOD_NOT_ALLOWED

-    func_path = req.path_info[1:] # skip first /
-    func_path = func_path.replace("/", ".")
-    if func_path[-1:] == ".":
-        func_path = func_path[:-1]
+    func_path = ""
+    if req.path_info:
+        func_path = req.path_info[1:] # skip first /
+        func_path = func_path.replace("/", ".")
+        if func_path[-1:] == ".":
+            func_path = func_path[:-1]

     # default to 'index' if no path_info was given
     if not func_path:


An imperfection with using AddHandler is that you end up with the ".py" in
your URL's.

To be able to use the best of both worlds, i.e. SetHandler and a default
module, the Publisher needs to provide its own default (since
DirectoryIndex has no effect). Here is another patch for this. Most likely
these will be in the release version (perhaps slightly modified). This
will tell the publisher to default to "index.py" is no file is specified.

--- publishre.py.old    Mon Nov 11 14:51:44 2002
+++ publisher.py        Mon Nov 11 14:50:13 2002
@@ -126,6 +128,9 @@

     ## import the script
     path, module_name =  os.path.split(req.filename)
+    if not module_name:
+        module_name = "index"

     # get rid of the suffix
     #   explanation: Suffixes that will get stripped off


Grisha

On Mon, 11 Nov 2002, Michael C. Neel wrote:

> This is an untested guess, but I think apache needs to see "index.py" in
> the document root before it will send the client a redirect to
> spam.com/index.py - try doing a touch index.py in the doc root and see
> what happens...
>
> Mike
>
> > -----Original Message-----
> > From: Arcady Genkin [mailto:agenkin-lst-mod_python@thpoon.com]
> > Sent: Sunday, November 10, 2002 5:11 PM
> > To: mod_python@modpython.org
> > Subject: Re: [mod_python] Default function for Publisher in 3.0
> >
> >
> > Arcady Genkin <agenkin-lst-mod_python@thpoon.com> writes:
> >
> > > this does not seem to work with "DirectoryIndex index.py".
> >
> > An update: I had a problem with configuration (using AddHandler
> > directive instead of the SetHandler, as recommended in the docs).
> > However, still can't use index.py implicitely.  Now the backtrace
> > looks this way:
> >
> > ,----
> > | Mod_python error: "PythonHandler mod_python.publisher"
> > |
> > | Traceback (most recent call last):
> > |
> > |   File
> > "/usr/local/lib/python2.2/site-packages/mod_python/apache.py",
> > |   line 335, in HandlerDispatch
> > |     result = object(req)
> > |
> > |   File
> > "/usr/local/lib/python2.2/site-packages/mod_python/publisher.py",
> > |   line 145, in handler
> > |     module = apache.import_module(module_name,
> > req.get_config(), [path])
> > |
> > |   File
> > "/usr/local/lib/python2.2/site-packages/mod_python/apache.py",
> > |   line 499, in import_module
> > |     f, p, d = imp.find_module(parts[i], path)
> > |
> > | ImportError: No module named
> > `----
> >
> > The httpd.conf contains the following configuration:
> >
> > ,----
> > | <Directory "/var/www/data">
> > |    PythonDebug On
> > |    SetHandler python-program
> > |    PythonHandler mod_python.publisher
> > |    DirectoryIndex index.py
> > | </Directory>
> > `----
> >
> > Something tells me that I am still doing something wrong.  I tried
> > setting DIrectoryIndex to "index" instead of "index.py", but this
> > still did not work.  Any ideas?
> >
> > Many thanks,
> > --
> > Arcady Genkin : CDF Systems Administrator
> > http://www.cdf.toronto.edu/~agenkin/contact.html
> >
> > guilt is the cause of more disauders
> > than history's most obscene marorders (E.E. Cummings)
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://www.modpython.org/mailman/listinfo/mod_python
> >
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
>



From grisha at modpython.org  Mon Nov 11 16:51:14 2002
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:53:14 2004
Subject: [mod_python] Installation Issues - Apache2 Python2.2 RedHat
In-Reply-To: <021b01c289b0$b01c76a0$cb3ac341@ginworks.com>
Message-ID: <20021111164814.J22386-100000@eden.ispol.com>

Josh -

If you're using Apache 2, you need mod_python version 3.0, currently in
beta. Mod_python 2.7.8 won't work with apache 2.

But with respect to your specific question - rm config.cache and re-run
configure. (It will report the Python version correctly, but you're still
going to have the above-mentioned apache2 problem).

Grisha

On Mon, 11 Nov 2002, Joshua Gramlich wrote:

> Howdy.  I've looked through the archives and couldn't find anything in particularly specific to my issue, so here goes:
>
> I'm trying to install mod_python with thread support (no reason, just because).  I made the jump up to Apache2, and it is working fine.  I've also got Python 2.2.1 installed.  I'm using RedHat 7.2 as my platform, and python2 is installed via source RPM(./configure'd, make'd, and make install'd).  Apache, I compiled from source.
>
> When I configure mod python I do so like this:
>
> ./configure --with-apxs=/usr/local/apache/bin/apxs --with-python=/usr/src/redhat/SOURCES/Python-2.2.1
>
> ...and I get the following (partial):
>
> hecking for Apache include directory... -I/usr/local/httpd-2.0.43/include
> checking for --with-apache... no
> configure: warning: **** No apache sources specified, static compilation will not be available.
> configure: warning: **** You can use --with-apache to specify where your Apache sources are.
> checking for --with-python... /usr/src/redhat/SOURCES/Python-2.2.1
> checking for python... (cached) /usr/bin/python
> checking Python version... 1.5
> checking whether Python is compiled with thread support... yes
>
>   ****** WARNING ******
>   Python is compiled with thread support. Apache 1.3 does not use threads.
>   On some systems this will cause problems during compilation, on others
>   it may result in unpredictable behaviour of your Apache server. Yet on
>   others it will work just fine. The recommended approach is to compile
>   Python without thread support in a separate location and specify it with
>   --with-python option to this ./configure script.
>
> checking Python install prefix... /usr
> checking what libraries Python was linked with... grep: /usr/src/redhat/SOURCES/Python-2.2.1/Modules/Makefile: No such file or directory
> grep: /usr/src/redhat/SOURCES/Python-2.2.1/Modules/Makefile: No such file or directory
> /usr/src/redhat/SOURCES/Python-2.2.1/libpython1.5.a
> checking linker flags used to link Python...  -Xlinker -export-dynamic
>
>
>
> ...So anyways, I keep seeing "checking Python version...1.5" and I'm wondering if this is a problem.  Reason being, when I type "make dso" after configuring mod_python, I get this:
>
> make dso
> make[1]: Entering directory `/usr/src/mod_python-2.7.8/src'
> gcc  -I/usr/src/mod_python-2.7.8/src/include -I/usr/local/httpd-2.0.43/include -I/usr/src/redhat/SOURCES/Python-2.2.1 -I/usr/src/redhat/SOURCES/Python-2.2.1/Include    -c -o mod_python.o mod_python.c
> In file included from mod_python.c:54:
> /usr/src/mod_python-2.7.8/src/include/mod_python.h:93: parse error before `*'
> /usr/src/mod_python-2.7.8/src/include/mod_python.h:93: warning: data definition has no type or storage class
> /usr/src/mod_python-2.7.8/src/include/mod_python.h:96: parse error before `python_module'
> /usr/src/mod_python-2.7.8/src/include/mod_python.h:96: warning: data definition has no type or storage class
> In file included from /usr/src/mod_python-2.7.8/src/include/mod_python.h:99,
>                  from mod_python.c:54:
> /usr/src/mod_python-2.7.8/src/include/util.h:57: parse error before `*'
> In file included from /usr/src/mod_python-2.7.8/src/include/mod_python.h:100,
>                  from mod_python.c:54:
> /usr/src/mod_python-2.7.8/src/include/tableobject.h:69blablahblahblah....
>
>
>
> Anyone have any ideas as to why this isn't working?
>
>
> Josh
> Chicago, IL


From jgramlich at piocon.com  Mon Nov 11 15:55:52 2002
From: jgramlich at piocon.com (Joshua Gramlich)
Date: Fri Jan  9 21:53:14 2004
Subject: [mod_python] Installation Issues - Apache2 Python2.2 RedHat
References: <20021111164814.J22386-100000@eden.ispol.com>
Message-ID: <024d01c289cd$1cf27d30$cb3ac341@ginworks.com>

I've gone and switched back to apache 1.3 for the time being.  If I get that
to work(which it looks like I will), I'll prolly consider using mod_python 3
instead, as I'm having to retool the python installs on my machine and it's
a major pain.  Plus, for whatever reason, and perhaps it just boils down to
esthetics, I'd rather have thread support built in...

Thanks,
Josh


----- Original Message -----
From: "Gregory (Grisha) Trubetskoy" <grisha@modpython.org>
To: "Joshua Gramlich" <jgramlich@piocon.com>
Cc: <mod_python@modpython.org>
Sent: Monday, November 11, 2002 3:51 PM
Subject: Re: [mod_python] Installation Issues - Apache2 Python2.2 RedHat


>
> Josh -
>
> If you're using Apache 2, you need mod_python version 3.0, currently in
> beta. Mod_python 2.7.8 won't work with apache 2.
>
> But with respect to your specific question - rm config.cache and re-run
> configure. (It will report the Python version correctly, but you're still
> going to have the above-mentioned apache2 problem).
>
> Grisha
>
> On Mon, 11 Nov 2002, Joshua Gramlich wrote:
>
> > Howdy.  I've looked through the archives and couldn't find anything in
particularly specific to my issue, so here goes:
> >
> > I'm trying to install mod_python with thread support (no reason, just
because).  I made the jump up to Apache2, and it is working fine.  I've also
got Python 2.2.1 installed.  I'm using RedHat 7.2 as my platform, and
python2 is installed via source RPM(./configure'd, make'd, and make
install'd).  Apache, I compiled from source.
> >
> > When I configure mod python I do so like this:
> >
> >
./configure --with-apxs=/usr/local/apache/bin/apxs --with-python=/usr/src/re
dhat/SOURCES/Python-2.2.1
> >
> > ...and I get the following (partial):
> >
> > hecking for Apache include
directory... -I/usr/local/httpd-2.0.43/include
> > checking for --with-apache... no
> > configure: warning: **** No apache sources specified, static compilation
will not be available.
> > configure: warning: **** You can use --with-apache to specify where your
Apache sources are.
> > checking for --with-python... /usr/src/redhat/SOURCES/Python-2.2.1
> > checking for python... (cached) /usr/bin/python
> > checking Python version... 1.5
> > checking whether Python is compiled with thread support... yes
> >
> >   ****** WARNING ******
> >   Python is compiled with thread support. Apache 1.3 does not use
threads.
> >   On some systems this will cause problems during compilation, on others
> >   it may result in unpredictable behaviour of your Apache server. Yet on
> >   others it will work just fine. The recommended approach is to compile
> >   Python without thread support in a separate location and specify it
with
> >   --with-python option to this ./configure script.
> >
> > checking Python install prefix... /usr
> > checking what libraries Python was linked with... grep:
/usr/src/redhat/SOURCES/Python-2.2.1/Modules/Makefile: No such file or
directory
> > grep: /usr/src/redhat/SOURCES/Python-2.2.1/Modules/Makefile: No such
file or directory
> > /usr/src/redhat/SOURCES/Python-2.2.1/libpython1.5.a
> > checking linker flags used to link Python...  -Xlinker -export-dynamic
> >
> >
> >
> > ...So anyways, I keep seeing "checking Python version...1.5" and I'm
wondering if this is a problem.  Reason being, when I type "make dso" after
configuring mod_python, I get this:
> >
> > make dso
> > make[1]: Entering directory `/usr/src/mod_python-2.7.8/src'
> >
gcc  -I/usr/src/mod_python-2.7.8/src/include -I/usr/local/httpd-2.0.43/inclu
de -I/usr/src/redhat/SOURCES/Python-2.2.1 -I/usr/src/redhat/SOURCES/Python-2
.2.1/Include    -c -o mod_python.o mod_python.c
> > In file included from mod_python.c:54:
> > /usr/src/mod_python-2.7.8/src/include/mod_python.h:93: parse error
before `*'
> > /usr/src/mod_python-2.7.8/src/include/mod_python.h:93: warning: data
definition has no type or storage class
> > /usr/src/mod_python-2.7.8/src/include/mod_python.h:96: parse error
before `python_module'
> > /usr/src/mod_python-2.7.8/src/include/mod_python.h:96: warning: data
definition has no type or storage class
> > In file included from
/usr/src/mod_python-2.7.8/src/include/mod_python.h:99,
> >                  from mod_python.c:54:
> > /usr/src/mod_python-2.7.8/src/include/util.h:57: parse error before `*'
> > In file included from
/usr/src/mod_python-2.7.8/src/include/mod_python.h:100,
> >                  from mod_python.c:54:
> >
/usr/src/mod_python-2.7.8/src/include/tableobject.h:69blablahblahblah....
> >
> >
> >
> > Anyone have any ideas as to why this isn't working?
> >
> >
> > Josh
> > Chicago, IL
>


From mark at camazotz.com  Mon Nov 11 17:47:38 2002
From: mark at camazotz.com (Mark Smith)
Date: Fri Jan  9 21:53:14 2004
Subject: [mod_python] building mod_python 3.0 on OS X
Message-ID: <93ECDF38-F5C7-11D6-9A20-00039364CE50@camazotz.com>

I'm trying to build mod_python 3.0b4 on OS X 10.2.  I've built Apache2
and it seems to work fine.  I've configured the mod_python build using
'--with-apxs' pointing to the version of apxs in the Apache2 bin 
directory.
The mod_python make finishes without errors, but when it's done,
src/mod_python.so is a soft link to src/.libs/mod_python.so, which
doesn't exist.  Any ideas on what (probably obvious) step I'm missing?

thanks,
Mark


From nathanr at nathanr.net  Tue Nov 12 13:15:02 2002
From: nathanr at nathanr.net (Nathan Robertson)
Date: Fri Jan  9 21:53:14 2004
Subject: [mod_python] 3.0.0 beta 4 - compile on Mac OS X
Message-ID: <3DD06426.6@nathanr.net>

Hi,

I've been fighting mod_python 3.0.0 beta 4 on Mac OS X 10.2.2 this 
morning. Compiling against apache 2.0.43, python 2.2.1. The filesystem 
is UFS, not HFS+.

Apache is configured as such:
./configure --with-mpm=threadpool --enable-so 
--prefix=/Volumes/UFS/local/httpd-2.0.43

and mod_python:
./configure --with-apxs=/Volumes/UFS/local/httpd-2.0.43/bin/apxs

make runs fine, make install breaks. Looked into it, and apxs doesn't 
create src/.libs/mod_python.so, only mod_python.lai (and the .la symlink 
to it). I tested this under Linux/PPC and Linux/i386 and both of them 
create the .so fine.

Has anyone else tried a similar setup on Mac OS X? Any successes?

Nathan.


From laurie at tratt.net  Tue Nov 12 09:19:40 2002
From: laurie at tratt.net (Laurence Tratt)
Date: Fri Jan  9 21:53:14 2004
Subject: [mod_python] 3.0.0 beta 4 - compile on Mac OS X
In-Reply-To: <3DD06426.6@nathanr.net>; from nathanr@nathanr.net on Tue, Nov 12, 2002 at 01:15:02PM +1100
References: <3DD06426.6@nathanr.net>
Message-ID: <20021112091940.B32177@purcell.dcs.kcl.ac.uk>

On Tue, Nov 12, 2002 at 01:15:02PM +1100, Nathan Robertson wrote:

[Apache and MacOS X]
> make runs fine, make install breaks. Looked into it, and apxs doesn't
> create src/.libs/mod_python.so, only mod_python.lai (and the .la symlink
> to it). I tested this under Linux/PPC and Linux/i386 and both of them
> create the .so fine.
>
> Has anyone else tried a similar setup on Mac OS X? Any successes?

Exactly the same thing happens under OpenBSD - I presume that part of our
shared BSD heritage is causing us problems. Interestingly, mod_python works
(well, builds) under FreeBSD; I have no idea about NetBSD though.

Best wishes,


Laurie

From nathanr at nathanr.net  Tue Nov 12 22:50:13 2002
From: nathanr at nathanr.net (Nathan Robertson)
Date: Fri Jan  9 21:53:14 2004
Subject: [mod_python] 3.0.0 beta 4 - compile on Mac OS X
References: <3DD06426.6@nathanr.net> <20021112091940.B32177@purcell.dcs.kcl.ac.uk>
Message-ID: <3DD0EAF5.8000007@nathanr.net>

Laurence Tratt wrote:
> On Tue, Nov 12, 2002 at 01:15:02PM +1100, Nathan Robertson wrote:
> 
> [Apache and MacOS X]
> 
>>make runs fine, make install breaks. Looked into it, and apxs doesn't
>>create src/.libs/mod_python.so, only mod_python.lai (and the .la symlink
>>to it). I tested this under Linux/PPC and Linux/i386 and both of them
>>create the .so fine.
>>
>>Has anyone else tried a similar setup on Mac OS X? Any successes?
> 
> Exactly the same thing happens under OpenBSD - I presume that part of our
> shared BSD heritage is causing us problems. Interestingly, mod_python works
> (well, builds) under FreeBSD; I have no idea about NetBSD though.

Yeah - I noted the FreeBSD note in the README, and did what it said, but 
that didn't make any difference.

Interesting that you got that on OpenBSD though. Plain wierd actually. 
Is that OpenBSD/i386 or on another platform (ppc?).

This could yet be an Apache bug in apxs, I guess. I haven't tried 
compiling any other modules against it.

Nathan.


From laurie at tratt.net  Tue Nov 12 11:51:18 2002
From: laurie at tratt.net (Laurence Tratt)
Date: Fri Jan  9 21:53:14 2004
Subject: [mod_python] 3.0.0 beta 4 - compile on Mac OS X
In-Reply-To: <3DD0EAF5.8000007@nathanr.net>; from nathanr@nathanr.net on Tue, Nov 12, 2002 at 10:50:13PM +1100
References: <3DD06426.6@nathanr.net> <20021112091940.B32177@purcell.dcs.kcl.ac.uk> <3DD0EAF5.8000007@nathanr.net>
Message-ID: <20021112115118.Q31512@purcell.dcs.kcl.ac.uk>

On Tue, Nov 12, 2002 at 10:50:13PM +1100, Nathan Robertson wrote:

[Apache and MacOS X]
>>> make runs fine, make install breaks. Looked into it, and apxs doesn't
>>> create src/.libs/mod_python.so, only mod_python.lai (and the .la symlink
>>> to it). I tested this under Linux/PPC and Linux/i386 and both of them
>>> create the .so fine.
>>>
>>> Has anyone else tried a similar setup on Mac OS X? Any successes?
>> Exactly the same thing happens under OpenBSD - I presume that part of our
>> shared BSD heritage is causing us problems. Interestingly, mod_python
>> works (well, builds) under FreeBSD; I have no idea about NetBSD though.
> Yeah - I noted the FreeBSD note in the README, and did what it said, but
> that didn't make any difference.
>
> Interesting that you got that on OpenBSD though. Plain wierd actually.
> Is that OpenBSD/i386 or on another platform (ppc?).

OpenBSD-current/i386.

> This could yet be an Apache bug in apxs, I guess. I haven't tried
> compiling any other modules against it.

I suspect it's either apxs (of which I know very little) or libtool (where
what I know I dislike). But that doesn't help me much as I am unable in a
short time scale to fix or coerce either of them :)

Best wishes,


Laurie

From jgramlich at piocon.com  Tue Nov 12 10:21:32 2002
From: jgramlich at piocon.com (Joshua Gramlich)
Date: Fri Jan  9 21:53:14 2004
Subject: [mod_python] mod_python tutorial issues
References: <20021111164814.J22386-100000@eden.ispol.com>
Message-ID: <02c401c28a67$92e1eea0$cb3ac341@ginworks.com>

Okay, my environment:

redhat linux 7.2
mod_python == most recent beta 4 of version 3 (compiled as dso)
apache == 2.0.43
python == 2.2.1 threads enabled...

Now, I'm going through the tutorial, and the little "hello world" program
seems to work just fine.  It's when I get to the authentication piece that
it messes up.  Here's the file I'm trying to "run":

################## myscript.py ##################################
from mod_python import apache

def authenhandler(req):
    pw = req.get_basic_auth_pw()
    user = req.connection.user
    if user == "spam" and pw == "eggs":
        return apache.OK
    else:
        return apache.HTTP_UNAUTHORIZED

def handler(pik):
    pik.content_type = "text/plain"
    pik.send_http_header()
    pik.write("Hello cruel World!")
    pik.write("Eat my shirt...")
    return apache.OK

#######################################################

...and the following is the error_log entry of apache when running:



[Tue Nov 12 10:03:51 2002] [notice] Graceful restart requested, doing
restart
[Tue Nov 12 10:03:57 2002] [notice] Apache/2.0.43 (Unix)
mod_python/3.0-BETA4 Python/2.2.1 configured -- resuming normal operations
[Tue Nov 12 10:05:12 2002] [error] [client 65.195.58.203]
PythonAuthenHandler myscript: Traceback (most recent call last):
[Tue Nov 12 10:05:12 2002] [error] [client 65.195.58.203]
PythonAuthenHandler myscript:   File
"/usr/lib/python2.2/site-packages/mod_python/apache.py", line 335, in
HandlerDispatch
    result = object(req)
[Tue Nov 12 10:05:12 2002] [error] [client 65.195.58.203]
PythonAuthenHandler myscript:   File
"/var/www/webroot/modpythontest/myscript.py", line 7, in authenhandler
    user = req.connection.user
[Tue Nov 12 10:05:12 2002] [error] [client 65.195.58.203]
PythonAuthenHandler myscript: AttributeError: user


Other behavior:
...when trying to access the "myscript.py" file, the internet explorer
authentication popup box appears...asking for username and password.
Whatever you enter for username and password does not matter, and every time
you hit the "OK" button, I get the Internal Server Error (see above) page
from IE.  If I hit "Cancel" instead, I get the "You must be authorized
blahblahblah...", so it looks as though the Apache portion is working...


Josh
Chicago, IL


From grisha at modpython.org  Tue Nov 12 11:56:50 2002
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:53:14 2004
Subject: [mod_python] mod_python tutorial issues
In-Reply-To: <02c401c28a67$92e1eea0$cb3ac341@ginworks.com>
Message-ID: <20021112115519.R33105-100000@eden.ispol.com>

You've mod_python 3.0, but are using the tutorial for 2.x, that's not
going to work :)

In MP 3.0 it's req.user rather than req.connection.user. Also, you don't
need send_http_header() anymore, it's a noop in MP 3.0.

Grisha

On Tue, 12 Nov 2002, Joshua Gramlich wrote:

> Okay, my environment:
>
> redhat linux 7.2
> mod_python == most recent beta 4 of version 3 (compiled as dso)
> apache == 2.0.43
> python == 2.2.1 threads enabled...
>
> Now, I'm going through the tutorial, and the little "hello world" program
> seems to work just fine.  It's when I get to the authentication piece that
> it messes up.  Here's the file I'm trying to "run":
>
> ################## myscript.py ##################################
> from mod_python import apache
>
> def authenhandler(req):
>     pw = req.get_basic_auth_pw()
>     user = req.connection.user
>     if user == "spam" and pw == "eggs":
>         return apache.OK
>     else:
>         return apache.HTTP_UNAUTHORIZED
>
> def handler(pik):
>     pik.content_type = "text/plain"
>     pik.send_http_header()
>     pik.write("Hello cruel World!")
>     pik.write("Eat my shirt...")
>     return apache.OK
>
> #######################################################
>
> ...and the following is the error_log entry of apache when running:
>
>
>
> [Tue Nov 12 10:03:51 2002] [notice] Graceful restart requested, doing
> restart
> [Tue Nov 12 10:03:57 2002] [notice] Apache/2.0.43 (Unix)
> mod_python/3.0-BETA4 Python/2.2.1 configured -- resuming normal operations
> [Tue Nov 12 10:05:12 2002] [error] [client 65.195.58.203]
> PythonAuthenHandler myscript: Traceback (most recent call last):
> [Tue Nov 12 10:05:12 2002] [error] [client 65.195.58.203]
> PythonAuthenHandler myscript:   File
> "/usr/lib/python2.2/site-packages/mod_python/apache.py", line 335, in
> HandlerDispatch
>     result = object(req)
> [Tue Nov 12 10:05:12 2002] [error] [client 65.195.58.203]
> PythonAuthenHandler myscript:   File
> "/var/www/webroot/modpythontest/myscript.py", line 7, in authenhandler
>     user = req.connection.user
> [Tue Nov 12 10:05:12 2002] [error] [client 65.195.58.203]
> PythonAuthenHandler myscript: AttributeError: user
>
>
> Other behavior:
> ...when trying to access the "myscript.py" file, the internet explorer
> authentication popup box appears...asking for username and password.
> Whatever you enter for username and password does not matter, and every time
> you hit the "OK" button, I get the Internal Server Error (see above) page
> from IE.  If I hit "Cancel" instead, I get the "You must be authorized
> blahblahblah...", so it looks as though the Apache portion is working...
>
>
> Josh
> Chicago, IL
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
>


From jgramlich at piocon.com  Tue Nov 12 10:59:33 2002
From: jgramlich at piocon.com (Joshua Gramlich)
Date: Fri Jan  9 21:53:14 2004
Subject: [mod_python] mod_python tutorial issues
References: <20021112115519.R33105-100000@eden.ispol.com>
Message-ID: <02e801c28a6c$e0015540$cb3ac341@ginworks.com>

Well, that is helpful.  Am I to assume that I should really be using the
docs that came with modpython3 rather than www.modpython.org?  Boy, am I
lazy....


Josh



----- Original Message -----
From: "Gregory (Grisha) Trubetskoy" <grisha@modpython.org>
To: "Joshua Gramlich" <jgramlich@piocon.com>
Cc: <mod_python@modpython.org>
Sent: Tuesday, November 12, 2002 10:56 AM
Subject: Re: [mod_python] mod_python tutorial issues


>
> You've mod_python 3.0, but are using the tutorial for 2.x, that's not
> going to work :)
>
> In MP 3.0 it's req.user rather than req.connection.user. Also, you don't
> need send_http_header() anymore, it's a noop in MP 3.0.
>
> Grisha
>
> On Tue, 12 Nov 2002, Joshua Gramlich wrote:
>
> > Okay, my environment:
> >
> > redhat linux 7.2
> > mod_python == most recent beta 4 of version 3 (compiled as dso)
> > apache == 2.0.43
> > python == 2.2.1 threads enabled...
> >
> > Now, I'm going through the tutorial, and the little "hello world"
program
> > seems to work just fine.  It's when I get to the authentication piece
that
> > it messes up.  Here's the file I'm trying to "run":
> >
> > ################## myscript.py ##################################
> > from mod_python import apache
> >
> > def authenhandler(req):
> >     pw = req.get_basic_auth_pw()
> >     user = req.connection.user
> >     if user == "spam" and pw == "eggs":
> >         return apache.OK
> >     else:
> >         return apache.HTTP_UNAUTHORIZED
> >
> > def handler(pik):
> >     pik.content_type = "text/plain"
> >     pik.send_http_header()
> >     pik.write("Hello cruel World!")
> >     pik.write("Eat my shirt...")
> >     return apache.OK
> >
> > #######################################################
> >
> > ...and the following is the error_log entry of apache when running:
> >
> >
> >
> > [Tue Nov 12 10:03:51 2002] [notice] Graceful restart requested, doing
> > restart
> > [Tue Nov 12 10:03:57 2002] [notice] Apache/2.0.43 (Unix)
> > mod_python/3.0-BETA4 Python/2.2.1 configured -- resuming normal
operations
> > [Tue Nov 12 10:05:12 2002] [error] [client 65.195.58.203]
> > PythonAuthenHandler myscript: Traceback (most recent call last):
> > [Tue Nov 12 10:05:12 2002] [error] [client 65.195.58.203]
> > PythonAuthenHandler myscript:   File
> > "/usr/lib/python2.2/site-packages/mod_python/apache.py", line 335, in
> > HandlerDispatch
> >     result = object(req)
> > [Tue Nov 12 10:05:12 2002] [error] [client 65.195.58.203]
> > PythonAuthenHandler myscript:   File
> > "/var/www/webroot/modpythontest/myscript.py", line 7, in authenhandler
> >     user = req.connection.user
> > [Tue Nov 12 10:05:12 2002] [error] [client 65.195.58.203]
> > PythonAuthenHandler myscript: AttributeError: user
> >
> >
> > Other behavior:
> > ...when trying to access the "myscript.py" file, the internet explorer
> > authentication popup box appears...asking for username and password.
> > Whatever you enter for username and password does not matter, and every
time
> > you hit the "OK" button, I get the Internal Server Error (see above)
page
> > from IE.  If I hit "Cancel" instead, I get the "You must be authorized
> > blahblahblah...", so it looks as though the Apache portion is working...
> >
> >
> > Josh
> > Chicago, IL
> >
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://www.modpython.org/mailman/listinfo/mod_python
> >
>


From grisha at modpython.org  Tue Nov 12 12:00:53 2002
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:53:14 2004
Subject: [mod_python] 3.0.0 beta 4 - compile on Mac OS X
In-Reply-To: <20021112091940.B32177@purcell.dcs.kcl.ac.uk>
Message-ID: <20021112115805.K33105-100000@eden.ispol.com>

This may be a problem with Apache 2.0.43 which has a slightly screwed up
distribution file which comes with an outdated libtool.

I don't know if it will help or not, but try running ./buildconf in Apache
source tree before running ./configure.

Grisha

On Tue, 12 Nov 2002, Laurence Tratt wrote:

> On Tue, Nov 12, 2002 at 01:15:02PM +1100, Nathan Robertson wrote:
>
> [Apache and MacOS X]
> > make runs fine, make install breaks. Looked into it, and apxs doesn't
> > create src/.libs/mod_python.so, only mod_python.lai (and the .la symlink
> > to it). I tested this under Linux/PPC and Linux/i386 and both of them
> > create the .so fine.
> >
> > Has anyone else tried a similar setup on Mac OS X? Any successes?
>
> Exactly the same thing happens under OpenBSD - I presume that part of our
> shared BSD heritage is causing us problems. Interestingly, mod_python works
> (well, builds) under FreeBSD; I have no idea about NetBSD though.
>
> Best wishes,
>
>
> Laurie
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
>


From laurie at tratt.net  Tue Nov 12 23:56:52 2002
From: laurie at tratt.net (Laurence Tratt)
Date: Fri Jan  9 21:53:14 2004
Subject: [mod_python] 3.0.0 beta 4 - compile on Mac OS X
In-Reply-To: <20021112115805.K33105-100000@eden.ispol.com>; from grisha@modpython.org on Tue, Nov 12, 2002 at 12:00:53PM -0500
References: <20021112091940.B32177@purcell.dcs.kcl.ac.uk> <20021112115805.K33105-100000@eden.ispol.com>
Message-ID: <20021112235651.B2626@purcell.dcs.kcl.ac.uk>

On Tue, Nov 12, 2002 at 12:00:53PM -0500, Gregory (Grisha) Trubetskoy wrote:

> This may be a problem with Apache 2.0.43 which has a slightly screwed up
> distribution file which comes with an outdated libtool.
>
> I don't know if it will help or not, but try running ./buildconf in Apache
> source tree before running ./configure.

I haven't had a chance to interpret this yet but doing this gives me a
different error, which does at look least a little more likely to be
resolveable:

"""
/usr/local/apache2/build/libtool --silent --mode=link gcc -o mod_python.la
-I/usr/local/src/mod_python-3.0.0-BETA4/src/include
-I/usr/local/apache2/include -I/usr/local/include/python2.2  -rpath
/usr/local/apache2/modules -module -avoid-version  hlistobject.lo hlist.lo
filterobject.lo connobject.lo serverobject.lo util.lo tableobject.lo
requestobject.lo _apachemodule.lo mod_python.lo
-L/usr/ports/lang/python/2.2/w-python-2.2.1/Python-2.2.1 -lm
/usr/local/lib/python2.2/config/libpython2.2.a -pthread -lutil -lm
libtool: link: cannot build libtool library `mod_python.la' from non-libtool
objects: /usr/local/lib/python2.2/config/libpython2.2.a
apxs:Error: Command failed with rc=65536
"""

Now whether that's a MacOS X|OpenBSD thing that Python didn't use libtool
to build I don't currently know, but I'll try and look into it over the
next couple of days. If anyone has any clues, of course they'd be more than
welcome!

Best wishes,


Laurie

From gbenson at redhat.com  Wed Nov 13 10:22:35 2002
From: gbenson at redhat.com (Gary Benson)
Date: Fri Jan  9 21:53:14 2004
Subject: [mod_python] Apache 1.3, mod_python, and threads
Message-ID: <20021113102233.GA21664@redhat.com>

I'm pretty sure that this is the case, but could someone confirm that
it is _not_ possible to build mod_python-2.7.8 for Apache 1.3 against
Python 2.2 unless Python is built without threads.  Also, assuming
that is true, does anyone know why this is the case (apart from
'because python dies in apache startup' ;))

Thanks in advance,
Gary

[ gbenson@redhat.com ][ GnuPG 85A8F78B ][ http://inauspicious.org/ ]

From nathanr at nathanr.net  Wed Nov 13 21:41:10 2002
From: nathanr at nathanr.net (Nathan Robertson)
Date: Fri Jan  9 21:53:14 2004
Subject: [mod_python] 3.0.0 beta 4 - compile on Mac OS X
References: <20021112091940.B32177@purcell.dcs.kcl.ac.uk> <20021112115805.K33105-100000@eden.ispol.com> <20021112235651.B2626@purcell.dcs.kcl.ac.uk>
Message-ID: <3DD22C46.6000302@nathanr.net>

MacOS X gives exactly the same error message as that when making mod_python.

Nathan

Laurence Tratt wrote:
> On Tue, Nov 12, 2002 at 12:00:53PM -0500, Gregory (Grisha) Trubetskoy wrote:
> 
> 
>>This may be a problem with Apache 2.0.43 which has a slightly screwed up
>>distribution file which comes with an outdated libtool.
>>
>>I don't know if it will help or not, but try running ./buildconf in Apache
>>source tree before running ./configure.
> 
> 
> I haven't had a chance to interpret this yet but doing this gives me a
> different error, which does at look least a little more likely to be
> resolveable:
> 
> """
> /usr/local/apache2/build/libtool --silent --mode=link gcc -o mod_python.la
> -I/usr/local/src/mod_python-3.0.0-BETA4/src/include
> -I/usr/local/apache2/include -I/usr/local/include/python2.2  -rpath
> /usr/local/apache2/modules -module -avoid-version  hlistobject.lo hlist.lo
> filterobject.lo connobject.lo serverobject.lo util.lo tableobject.lo
> requestobject.lo _apachemodule.lo mod_python.lo
> -L/usr/ports/lang/python/2.2/w-python-2.2.1/Python-2.2.1 -lm
> /usr/local/lib/python2.2/config/libpython2.2.a -pthread -lutil -lm
> libtool: link: cannot build libtool library `mod_python.la' from non-libtool
> objects: /usr/local/lib/python2.2/config/libpython2.2.a
> apxs:Error: Command failed with rc=65536
> """
> 
> Now whether that's a MacOS X|OpenBSD thing that Python didn't use libtool
> to build I don't currently know, but I'll try and look into it over the
> next couple of days. If anyone has any clues, of course they'd be more than
> welcome!
> 
> Best wishes,
> 
> 
> Laurie
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 
> 




From gbenson at redhat.com  Wed Nov 13 10:49:08 2002
From: gbenson at redhat.com (Gary Benson)
Date: Fri Jan  9 21:53:14 2004
Subject: [mod_python] Apache 1.3, mod_python, and threads
In-Reply-To: <200211131224.19230.mateusz@ant.gliwice.pl>
References: <20021113102233.GA21664@redhat.com> <200211131224.19230.mateusz@ant.gliwice.pl>
Message-ID: <20021113104908.GB21664@redhat.com>

On Wed, Nov 13, 2002 at 12:24:19PM +0100, Mateusz Korniak wrote:
> On Wednesday 13 November 2002 11:22, Gary Benson wrote:
> > I'm pretty sure that this is the case, but could someone confirm that
> > it is _not_ possible to build mod_python-2.7.8 for Apache 1.3 against
> > Python 2.2 unless Python is built without threads.
> 
> I might missed start of thread, but

Nope, that message is the only one in it 

> I pretty sure _I'm_ _able_ to build, and extensively use mod_python
> with both python 2.2.1 and 2.2.2, and both compiled with threads.

This is with Apache 1.3?  I have Apache 1.3.23, Python 2.2 and
mod_python 2.7.8.  If I build Python with threads then Apache dies on
startup with the malformed error message "alize: can't make modules
dictionary"

Maybe the problem is Python 2.2 as opposed to 2.2.1/2.2.2.  I'll try
with one of those.

Cheers,
Gary

[ gbenson@redhat.com ][ GnuPG 85A8F78B ][ http://inauspicious.org/ ]

From mateusz at ant.gliwice.pl  Wed Nov 13 13:22:38 2002
From: mateusz at ant.gliwice.pl (Mateusz Korniak)
Date: Fri Jan  9 21:53:14 2004
Subject: [mod_python] Apache 1.3, mod_python, and threads
In-Reply-To: <20021113104908.GB21664@redhat.com>
References: <20021113102233.GA21664@redhat.com> <200211131224.19230.mateusz@ant.gliwice.pl> <20021113104908.GB21664@redhat.com>
Message-ID: <200211131322.38756.mateusz@ant.gliwice.pl>

On Wednesday 13 November 2002 11:49, Gary Benson wrote:

> > I pretty sure _I'm_ _able_ to build, and extensively use mod_python
> > with both python 2.2.1 and 2.2.2, and both compiled with threads.
>
> This is with Apache 1.3?  I have Apache 1.3.23, Python 2.2 and
> mod_python 2.7.8.  If I build Python with threads then Apache dies on
> startup with the malformed error message "alize: can't make modules
> dictionary"

[matkor@appserver ~]$ rpm -q apache
apache-1.3.27-3
[matkor@appserver ~]$ rpm -q apache-mod_python
apache-mod_python-2.7.8-6
[matkor@appserver ~]$ rpm -q python
python-2.2.2-1

( All specs used to build those rpms are on http://www.pld.org.pl/devel/cvs/ 
there should be alse src rpms ...)

[matkor@appserver ~]$ python
Python 2.2.2 (#1, Nov  9 2002, 21:07:57)
[GCC 2.95.4 20010319 (prerelease)] on linux2
Type "help", "copyright", "credits" or "license" for more information.
>>> import thread
>>>

> Maybe the problem is Python 2.2 as opposed to 2.2.1/2.2.2.  I'll try
> with one of those.

I had only problems with mod_python itself but only  when I tried use 
mod_python dynlinked .. but symptoms ware different - segfault on first use 
of mod_python.


-- 
Mateusz Korniak



From antonio at memora.com  Wed Nov 13 07:40:54 2002
From: antonio at memora.com (Antonio L Rodriguez)
Date: Fri Jan  9 21:53:14 2004
Subject: [mod_python] Apache 1.3, mod_python, and threads
In-Reply-To: <20021113102233.GA21664@redhat.com>
Message-ID: <2658F540-F705-11D6-A9E6-00039300D690@memora.com>

I've built it wit threads on debian 3.0/Intel  (apache 1.3.26) no 
problem.

I'm not sure its advised however, though as you've probably seen in the 
docs. My approach has been that so long as I stay away from thread 
usage in the scripts I should be ok but I haven't verified this too 
seriously.

AR

On Wednesday, November 13, 2002, at 05:22 AM, Gary Benson wrote:

> I'm pretty sure that this is the case, but could someone confirm that
> it is _not_ possible to build mod_python-2.7.8 for Apache 1.3 against
> Python 2.2 unless Python is built without threads.  Also, assuming
> that is true, does anyone know why this is the case (apart from
> 'because python dies in apache startup' ;))
>
> Thanks in advance,
> Gary
>
> [ gbenson@redhat.com ][ GnuPG 85A8F78B ][ http://inauspicious.org/ ]
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
>


From antonio at memora.com  Wed Nov 13 09:15:19 2002
From: antonio at memora.com (Antonio L Rodriguez)
Date: Fri Jan  9 21:53:14 2004
Subject: [mod_python] Funky publisher behavior under apache 1.3
Message-ID: <56B386A8-F712-11D6-A9E6-00039300D690@memora.com>

Hey all,

I've been playing around with the publisher but have been having some 
issues. First, I get this in my apache logs all the time:

[Wed Nov 13 08:49:01 2002] [notice] mod_python: (Re)importing 
mod_python.publisher from None


This happens even when the underlying files do not change (either the 
script or the publisher.py file ).

Second, I'm getting erratic behavior where the publisher will find a 
function one time and then generate a 404 a couple of requests later 
for no apparent reason.

I am using python 2.2.2 with threads but this hasn't been a problem in 
the past and I'm not actually using the threading libs. in my script.

Anyone run into this type of behavior with publisher.py?

Thanks

AR


From gbenson at redhat.com  Wed Nov 13 14:45:45 2002
From: gbenson at redhat.com (Gary Benson)
Date: Fri Jan  9 21:53:14 2004
Subject: [mod_python] Apache 1.3, mod_python, and threads
In-Reply-To: <20021113104908.GB21664@redhat.com>
References: <20021113102233.GA21664@redhat.com> <200211131224.19230.mateusz@ant.gliwice.pl> <20021113104908.GB21664@redhat.com>
Message-ID: <20021113144543.GC21664@redhat.com>

On Wed, Nov 13, 2002 at 10:49:08AM +0000, Gary Benson wrote:
> On Wed, Nov 13, 2002 at 12:24:19PM +0100, Mateusz Korniak wrote:
> > I pretty sure _I'm_ _able_ to build, and extensively use mod_python
> > with both python 2.2.1 and 2.2.2, and both compiled with threads.
> 
> This is with Apache 1.3?  I have Apache 1.3.23, Python 2.2 and
> mod_python 2.7.8.  If I build Python with threads then Apache dies on
> startup with the malformed error message "alize: can't make modules
> dictionary"
> 
> Maybe the problem is Python 2.2 as opposed to 2.2.1/2.2.2.  I'll try
> with one of those.

I upgraded from 2.2 to 2.2.1 and the problem went away; thanks guys!

Gary

[ gbenson@redhat.com ][ GnuPG 85A8F78B ][ http://inauspicious.org/ ]

From vmanera at manord.com  Wed Nov 13 15:52:10 2002
From: vmanera at manord.com (Manera, Villiam)
Date: Fri Jan  9 21:53:14 2004
Subject: R: [mod_python] Funky publisher behavior under apache 1.3
Message-ID: <52DC70C1C1575C418CB033523A29CF140E0527@exchange2000.manord.com>

I've submitted the same problem the 17 October, and is still a problem:
From: Manera, Villiam <vmanera@manord.com>
To: 'mod_python@modpython.org' <mod_python@modpython.org>
Date: 17 October 2002 19:13
Subject: [mod_python] strange behavior of mod-python


>
>I'm currently use mod-python 2.7.6 on apache 1.3.26 - windows 2000 with
>python 2.2
>apache config:
>.....
>    ScriptAlias /comm/ "E:/script/cgi/comm/"
>    ScriptAlias /tecnico/ "E:/script/cgi/tecnico/"
>....
><Directory "E:/script/cgi/comm">
>        Order Deny,Allow
>        Deny from all
>        Allow from .....
>       ...
>    AddHandler python-program .py
>    PythonHandler mod_python.publisher
> PythonPath "sys.path+['c:/program
>files/python22/lib/site-packages/mdnlib', 'c:/program
>files/python22/lib/site-packages/HTMLgen','E:/script/cgi/comm']"
>    PythonDebug on
>    </Directory>
>
>----------------------------------------------------
>all work fine, but sometimes (today 4 time) when a url is typed:
>http://sviluppo.manord.com/comm/comm_ocordiu0.py/main?....
>
>I have this behavior from apache:
>HTTP 404 - File non trovato (not found)
>Internet Explorer
>but the program is still in place, and the only way to force apache to
found
>the program is restart the apache services,
>or make a copy of comm_ocordiu0 in comm_ocordiu1 and then call this one,
>but....
>
>
>
>this is not a real problem in developement web server, but  today it
>happened 4 time, in production is happened 2 time in one month,
>and I become in panic.
>
>Any advice here would be greatly appreciated.
>
>Villiam

-----Messaggio originale-----
Da: Antonio L Rodriguez [mailto:antonio@memora.com]
Inviato: mercoled? 13 novembre 2002 15.15
A: mod_python@modpython.org
Oggetto: [mod_python] Funky publisher behavior under apache 1.3


Hey all,

I've been playing around with the publisher but have been having some 
issues. First, I get this in my apache logs all the time:

[Wed Nov 13 08:49:01 2002] [notice] mod_python: (Re)importing 
mod_python.publisher from None


This happens even when the underlying files do not change (either the 
script or the publisher.py file ).

Second, I'm getting erratic behavior where the publisher will find a 
function one time and then generate a 404 a couple of requests later 
for no apparent reason.

I am using python 2.2.2 with threads but this hasn't been a problem in 
the past and I'm not actually using the threading libs. in my script.

Anyone run into this type of behavior with publisher.py?

Thanks

AR

_______________________________________________
Mod_python mailing list
Mod_python@modpython.org
http://www.modpython.org/mailman/listinfo/mod_python


From jquinte at fadu.uba.ar  Wed Nov 13 13:21:01 2002
From: jquinte at fadu.uba.ar (Javier Quinteros)
Date: Fri Jan  9 21:53:14 2004
Subject: [mod_python] =?iso-8859-1?Q?Comp=EClation?= error in Solaris 8...
Message-ID: <3DD27BED.CF84CFA2@fadu.uba.ar>

Hi !!!
I've seen a problem like this posted before but there was no
satisfactory answer.

I'm using Solaris 8, Apache 1.3.26, Python 2.2.1 and ModPython 2.7.8.

This are the steps I execute:
* ./configure --with-apache=/usr/...........
* make static
* make install

Then I move to the apache source directory and:

* ./configure (as specified in modpython instructions)
* make

Then I get an error telling me that there are "Undefined Symbols" (about
40). All of them are Python Symbols (PySequence, etc.).

The only answer I've found in the archives is from a Brasilian guy
telling that the libmodpython.a has to be compiled with the -fpic flag
when using gcc.

Please, I need a solution ASAP.

Thanks in advance.

Javier Quinteros
Universidad de Buenos Aires



From jwyant at sfbcic.com  Wed Nov 13 12:46:03 2002
From: jwyant at sfbcic.com (Wyant, Jaime)
Date: Fri Jan  9 21:53:14 2004
Subject: [mod_python] Write errors (client closed connection)
Message-ID: <654DAEACA633D511B5F500902784B052188EE1@MS-EXCHANGE>

What usually causes a webbrowser to close a connection?  I assume the user
"closes" their browser which closes the connection.

I usually get this exception:

IOError: Write failed, client closed connection. 

Can anyone elaborate?

Thanks!
jaime wyant (jwyant@sfbcic . com)
MS Farm Bureau
(601) 977 - 4291



From grisha at modpython.org  Wed Nov 13 15:10:53 2002
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:53:14 2004
Subject: [mod_python] Write errors (client closed connection)
In-Reply-To: <654DAEACA633D511B5F500902784B052188EE1@MS-EXCHANGE>
Message-ID: <20021113151011.P48789-100000@eden.ispol.com>

I think this will happen if they click the "stop" button also.

On Wed, 13 Nov 2002, Wyant, Jaime wrote:

> What usually causes a webbrowser to close a connection?  I assume the user
> "closes" their browser which closes the connection.
>
> I usually get this exception:
>
> IOError: Write failed, client closed connection.
>
> Can anyone elaborate?
>
> Thanks!
> jaime wyant (jwyant@sfbcic . com)
> MS Farm Bureau
> (601) 977 - 4291
>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
>


From agenkin-lst-mod_python at thpoon.com  Thu Nov 14 15:32:28 2002
From: agenkin-lst-mod_python at thpoon.com (Arcady Genkin)
Date: Fri Jan  9 21:53:15 2004
Subject: [mod_python] SetHandler and a subdirectory with static contents (images)
Message-ID: <uoel9nc2oz.fsf@bashful.cdf.toronto.edu>

I cannot send image files when using the Publisher handler: apache
tries to run them as Python programs. ;^)  I tried setting to handler
for the images directory to the default, but it didn't work.  With
Apache 2.0.43 and mod_python-3.0B4, I have the following config:

,----[ httpd.conf ]
| <Directory "/var/www/data">
|    PythonDebug On
|    SetHandler python-program
|    PythonHandler mod_python.publisher
| </Directory>
| 
| <Directory "/var/www/data/images">
|   SetHandler default-handler
| </Directory>
`----

Since /var/www/data is the DocumentRoot, I cannot place the images in
a directory outside of it...

What am I doing wrong?
-- 
Arcady Genkin

guilt is the cause of more disauders
than history's most obscene marorders (E.E. Cummings)

From vmilitaru at sympatico.ca  Thu Nov 14 21:00:38 2002
From: vmilitaru at sympatico.ca (vio)
Date: Fri Jan  9 21:53:15 2004
Subject: [mod_python] SetHandler and a subdirectory with static contents 
 (images)
References: <uoel9nc2oz.fsf@bashful.cdf.toronto.edu>
Message-ID: <3DD45546.DA2BB937@sympatico.ca>

Looks like you forgot to include the python suffix, which restricts what
file types are to be handled by mod_python.publisher. Try it like this:

<IfModule mod_python.c>
<Directory /var/www/data>
    AddHandler python-program .py
    PythonHandler mod_python.publisher
    PythonDebug On
</Directory>
</IfModule>

Cheer,
Vio


Arcady Genkin wrote:

> I cannot send image files when using the Publisher handler: apache
> tries to run them as Python programs. ;^)  I tried setting to handler
> for the images directory to the default, but it didn't work.  With
> Apache 2.0.43 and mod_python-3.0B4, I have the following config:
>
> ,----[ httpd.conf ]
> | <Directory "/var/www/data">
> |    PythonDebug On
> |    SetHandler python-program
> |    PythonHandler mod_python.publisher
> | </Directory>
> |
> | <Directory "/var/www/data/images">
> |   SetHandler default-handler
> | </Directory>
> `----
>
> Since /var/www/data is the DocumentRoot, I cannot place the images in
> a directory outside of it...
>
> What am I doing wrong?
> --
> Arcady Genkin
>
> guilt is the cause of more disauders
> than history's most obscene marorders (E.E. Cummings)
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python


From Antonio at Memora.com  Thu Nov 14 21:21:43 2002
From: Antonio at Memora.com (Antonio Rodriguez)
Date: Fri Jan  9 21:53:15 2004
Subject: [mod_python] The story with python compiled with threads
References: <uoel9nc2oz.fsf@bashful.cdf.toronto.edu> <3DD45546.DA2BB937@sympatico.ca>
Message-ID: <000d01c28c4d$bdc48aa0$6b01a8c0@borg>

To those wiser in mod_python,

So the README says to definitely *NOT* use mod_python with python compiled
with threads in apache 1.3, but I bet that many people do anyway. What is
the story with what can go wrong? That is, I've heard of the apache
processes dying from the start and obviously using threads in your scripts
probably isn't cool, but what if mod_python seems to run ok most of the
time.

The basic question is this: what can happen if we use mod_python with python
with threads support in terms of partial failure?


Thanks

Antonio




From jack_diederich at email.com  Thu Nov 14 18:08:37 2002
From: jack_diederich at email.com (Jack Diederich)
Date: Fri Jan  9 21:53:15 2004
Subject: [mod_python] Write errors (client closed connection)
Message-ID: <20021114230837.8439.qmail@email.com>

This is also why apache recomends you run a proxy server in front of
your dynamic perl/python/whatever server.  The proxy server gets the client
close, but the mod_python server runs the process to completion.  If
you depend on something running all the way through without errors
(your code is bug free, right?) then you should really have a proxy
server in between you and the big bad world.

-jack

----- Original Message -----
From: "Gregory (Grisha) Trubetskoy" <grisha@modpython.org>
> 
> I think this will happen if they click the "stop" button also.
> 

-- 
_______________________________________________
Sign-up for your own FREE Personalized E-mail at Mail.com
http://www.mail.com/?sr=signup

Single & ready to mingle? lavalife.com:  Where singles click. Free to Search!
http://www.lavalife.com/wp.epl?a=2716


From gstein at lyra.org  Thu Nov 14 13:51:38 2002
From: gstein at lyra.org (Greg Stein)
Date: Fri Jan  9 21:53:15 2004
Subject: [mod_python] Write errors (client closed connection)
In-Reply-To: <20021113151011.P48789-100000@eden.ispol.com>; from grisha@modpython.org on Wed, Nov 13, 2002 at 03:10:53PM -0500
References: <654DAEACA633D511B5F500902784B052188EE1@MS-EXCHANGE> <20021113151011.P48789-100000@eden.ispol.com>
Message-ID: <20021114135138.K13799@lyra.org>

Yup, definitely. The client closes their side, but the server won't notice
that until it tries to write to the socket. Normally, this raises SIGPIPE,
but it appears somebody has caught/ignored that, so you just get the error.

Cheers,
-g

On Wed, Nov 13, 2002 at 03:10:53PM -0500, Gregory (Grisha) Trubetskoy wrote:
> 
> I think this will happen if they click the "stop" button also.
> 
> On Wed, 13 Nov 2002, Wyant, Jaime wrote:
> 
> > What usually causes a webbrowser to close a connection?  I assume the user
> > "closes" their browser which closes the connection.
> >
> > I usually get this exception:
> >
> > IOError: Write failed, client closed connection.
> >
> > Can anyone elaborate?
> >
> > Thanks!
> > jaime wyant (jwyant@sfbcic . com)
> > MS Farm Bureau
> > (601) 977 - 4291
> >
> >
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://www.modpython.org/mailman/listinfo/mod_python
> >
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python

-- 
Greg Stein, http://www.lyra.org/

From sandor.kopanyi at mailbox.hu  Fri Nov 15 16:27:21 2002
From: sandor.kopanyi at mailbox.hu (sandor.kopanyi@mailbox.hu)
Date: Fri Jan  9 21:53:15 2004
Subject: [mod_python] permanent db connection (more than in FAQ 3.3)
Message-ID: <20021115152721.7694.qmail@web2.mailbox.hu>

Hi,

In the mod_python FAQ 3.3 there is a good example of a 'permanent'
database
connection. This works fine, the connection is reused, as long as the
request
is handled in the same child process (apache child process). But a new
child
process gets a new interpreter => new connection is created. At least
that's
what I guess.

I've tried the Python*Interp* directives, but the connection is
re-created
regardless of those directives. Am I doing something wrong?

E.g. when setting PythonInterpeter to something (e.g. blabla), the
connection
is recreated again and again.

Any ideeas?

I'm using apache 1.3.23 with mod_python 2.7.6 on RedHat 7.3; the
application
is based on the publisher handler; the db connection code is almost
copy-paste from
the FAQ.

Best regards,
Sandor


________________________________________________
http://mailbox.hu - M?r SMS ?rtes?t?ssel is!



From mateusz at ant.gliwice.pl  Fri Nov 15 16:38:47 2002
From: mateusz at ant.gliwice.pl (Mateusz Korniak)
Date: Fri Jan  9 21:53:15 2004
Subject: [mod_python] permanent db connection (more than in FAQ 3.3)
In-Reply-To: <20021115152721.7694.qmail@web2.mailbox.hu>
References: <20021115152721.7694.qmail@web2.mailbox.hu>
Message-ID: <200211151638.47175.mateusz@ant.gliwice.pl>

On Friday 15 November 2002 16:27, sandor.kopanyi@mailbox.hu wrote:
> Hi,
>
> In the mod_python FAQ 3.3 there is a good example of a 'permanent'
> database
> connection. This works fine, the connection is reused, as long as the
> request
> is handled in the same child process (apache child process). But a new
> child
> process gets a new interpreter => new connection is created. At least
> that's
> what I guess.

Yes.
I keep one connection per each apache process.

-- 
Mateusz Korniak
"Black holes are where God divided by zero." - Steven Wright


From grisha at modpython.org  Fri Nov 15 11:25:41 2002
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:53:15 2004
Subject: [mod_python] permanent db connection (more than in FAQ 3.3)
In-Reply-To: <20021115152721.7694.qmail@web2.mailbox.hu>
Message-ID: <20021115112129.C74246-100000@eden.ispol.com>

There isn't much you can do about this - the connections are only reused
within the same process, a new process will create a new connection.

PythonInterpreter's scope does not extend beyond a process, i.e. a seprate
process is a separate process, a separate memory space, a different
interpreter, etc.

Hope this clarifies it a bit.

Grisha

On Fri, 15 Nov 2002 sandor.kopanyi@mailbox.hu wrote:

> Hi,
>
> In the mod_python FAQ 3.3 there is a good example of a 'permanent'
> database connection. This works fine, the connection is reused, as long
> as the request is handled in the same child process (apache child
> process). But a new child process gets a new interpreter => new
> connection is created. At least that's what I guess.
>
> I've tried the Python*Interp* directives, but the connection is
> re-created regardless of those directives. Am I doing something wrong?
>
> E.g. when setting PythonInterpeter to something (e.g. blabla), the
> connection is recreated again and again.
>
> Any ideeas?
>
> I'm using apache 1.3.23 with mod_python 2.7.6 on RedHat 7.3; the
> application is based on the publisher handler; the db connection code is
> almost copy-paste from the FAQ.
>
> Best regards,
> Sandor
>
>
> ________________________________________________
> http://mailbox.hu - M?r SMS ?rtes?t?ssel is!
>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
>


From agenkin-lst-mod_python at thpoon.com  Sat Nov 16 20:24:19 2002
From: agenkin-lst-mod_python at thpoon.com (Arcady Genkin)
Date: Fri Jan  9 21:53:15 2004
Subject: [mod_python] SetHandler and a subdirectory with static contents 
 (images)
In-Reply-To: <3DD45546.DA2BB937@sympatico.ca> (vio's message of "Thu, 14 Nov
 2002 21:00:38 -0500")
References: <uoel9nc2oz.fsf@bashful.cdf.toronto.edu>
	<3DD45546.DA2BB937@sympatico.ca>
Message-ID: <uowund3s58.fsf@bashful.cdf.toronto.edu>

vio <vmilitaru@sympatico.ca> writes:

> Looks like you forgot to include the python suffix, which restricts what
> file types are to be handled by mod_python.publisher. Try it like this:
>
> <IfModule mod_python.c>
> <Directory /var/www/data>
>     AddHandler python-program .py
>     PythonHandler mod_python.publisher
>     PythonDebug On
> </Directory>
> </IfModule>

Note that I am using the SetHandler directive (not AddHandler), which
does not require the file extension.  This is the recommended
configuration directive for 3.0, as per the docs.

Can anybody tell me how to work around this?

> Arcady Genkin wrote:
>
>> I cannot send image files when using the Publisher handler: apache
>> tries to run them as Python programs. ;^)  I tried setting to handler
>> for the images directory to the default, but it didn't work.  With
>> Apache 2.0.43 and mod_python-3.0B4, I have the following config:
>>
>> ,----[ httpd.conf ]
>> | <Directory "/var/www/data">
>> |    PythonDebug On
>> |    SetHandler python-program
>> |    PythonHandler mod_python.publisher
>> | </Directory>
>> |
>> | <Directory "/var/www/data/images">
>> |   SetHandler default-handler
>> | </Directory>
>> `----
>>
>> Since /var/www/data is the DocumentRoot, I cannot place the images in
>> a directory outside of it...
>>
>> What am I doing wrong?

-- 
Arcady Genkin : CDF Systems Administrator
http://www.cdf.toronto.edu/~agenkin/contact.html

guilt is the cause of more disauders
than history's most obscene marorders (E.E. Cummings)

From mateusz at ant.gliwice.pl  Mon Nov 18 11:45:52 2002
From: mateusz at ant.gliwice.pl (Mateusz Korniak)
Date: Fri Jan  9 21:53:15 2004
Subject: [mod_python] Using gzip module with mod_gzip enabled apache breaks things ?
Message-ID: <200211181145.52365.mateusz@ant.gliwice.pl>

Any idea why using mod_gzip in apache makes gziping by gzip module hang apache 
server process ?
Currently I'm able compress content using mod_python nor mod_gzip (for static 
content), but not _both_ . :/

TIA for any ideas comments...

-- 
Mateusz Korniak
"Black holes are where God divided by zero." - Steven Wright


From ps0 at igmp.com.ar  Mon Nov 18 17:26:11 2002
From: ps0 at igmp.com.ar (Hector A. Paterno)
Date: Fri Jan  9 21:53:15 2004
Subject: [mod_python] Authentication like php !
Message-ID: <20021118172611.A8069@igmp.com.ar>

Hi,

 Anyone has already do some type of authentication with mod_python
 using some type of cookies or sessions (like php does) ?
 
 I need this for a user/pass form in the main page ( I dont want the
 tipical Auth new window ( AuthHandler ).
 
 
 Tnks A lot !
 

-- 
Hector A. Paterno

From ps0 at igmp.com.ar  Tue Nov 19 12:07:20 2002
From: ps0 at igmp.com.ar (Hector A. Paterno)
Date: Fri Jan  9 21:53:15 2004
Subject: [mod_python] Authentication like php !
In-Reply-To: <OF3AFC019A.317D1A47-ON85256C75.00712D44-85256C75.00720302@ccity.com>; from Tony_Burger@circuitcity.com on Mon, Nov 18, 2002 at 03:44:42PM -0500
References: <OF3AFC019A.317D1A47-ON85256C75.00712D44-85256C75.00720302@ccity.com>
Message-ID: <20021119120720.C17664@igmp.com.ar>

On Mon, Nov 18, 2002 at 03:44:42PM -0500, Tony_Burger@circuitcity.com wrote:

Could you bring me the python version of the perl script ?

Tnks a lot.


> 
> Yes in fact, using mod_auth_mda.  I have converted the perl script using
> mod_python and setup cookie checking for the client.  It looks as though
> the module is still only available for Apache 1.3.xx.  Looks like the
> website has been enhanced since I viewed it last, should help with setup.
> There was a lot of talk on the message list about the bit-masking
> technique.
> 
> http://www.frogdot.org/mod_auth_mda/index.html
> 
> 

-- 
Hector A. Paterno

From mbp at samba.org  Tue Nov 19 16:36:58 2002
From: mbp at samba.org (Martin Pool)
Date: Fri Jan  9 21:53:15 2004
Subject: [mod_python] unicode() conversion troubles with mod_python 3 CVS 27.06.2002
In-Reply-To: <005b01c27aff$26914920$0bcbefc3@irkutsk.teleross.ru>
References: <005b01c27aff$26914920$0bcbefc3@irkutsk.teleross.ru>
Message-ID: <20021120003657.GD25174@toey.sourcefrog.net>

On 24 Oct 2002, Eugene Sizikov <eugene_beast@mail.ru> wrote:
> Hello all ppl!
> 
> I have troubles with unicode conversion with mod_python from RedHat 8.0
> distro. The errorlog is:
> 
> "
> Mod_python error: "PythonHandler mod_python.publisher"
> 
> Traceback (most recent call last):
> 
>   File "/usr/lib/python2.2/site-packages/mod_python/apache.py", line 285, in
> HandlerDispatch
>     result = object(req)
> 
>   File "/usr/lib/python2.2/site-packages/mod_python/publisher.py", line 175,
> in handler
>     result = apply(object, (), args)
> 
>   File "/var/www/html/teleross/user.py", line 137, in start
>     html = '%s [%s]<HR>' % (string_sql_to_html(user.fullname),
> Group(user.con, user.gid).fullname) + menu.to_html()
> 
>   File "/var/www/html/teleross/utils.py", line 4, in string_sql_to_html
>     return unicode(s, 'koi8-r')
> 
>   File
> "/usr/src/build/143041-i386/install/usr/lib/python2.2/encodings/__init__.py"
> , line 51, in search_function
> 
> RuntimeError: cannot unmarshal code objects in restricted execution mode
> "
> 
> So, when it has "unicode(s, 'koi8-r')" it crashes with that interesting
> message I can't understand.

I had a similar problem.  It seemed to me to be some kind of
interaction between encoders being imported by the C encode()
implementation and modules being imported by mod_python.
Unfortunately I could only look at it without our complicated build
environment so I can't say for sure.

A workaround turned out to be forcing the encoders to be loaded before
mod_python starts up.  You can do this by adding a line like this to
sitecustom.py:

  u'hello'.encode('koi8-r')

-- 
Martin

From pzb at datastacks.com  Fri Nov 22 16:02:24 2002
From: pzb at datastacks.com (Peter Bowen)
Date: Fri Jan  9 21:53:15 2004
Subject: [mod_python] Apache segfault when using PythonImport
Message-ID: <1037998943.8001.40.camel@10-0-0-234.boston.ximian.com>

Apache is segfaulting when I use the PythonImport directive.

I have seen it under two slightly different conditions:

A) Apache 1.3.23 (from Red Hat Linux 7.3 errata), Python 2.2.2 without
threads, and mod_python 2.7.8

In this case the backtrace shows that the segfault occurs in ap_palloc. 
The stack looks like ap_palloc -> ap_pstrdup -> ap_table_add ->
directive_PythonImport.

B) Apache 1.3.23 (as above) or Apache 1.3.27, Python 2.2.2 with threads,
and mod_python 2.7.8

Different backtrace.  Dies in pthread_mutex_lock, called from
PyEval_AcquireLock.

Has anyone had sucess with using PythonImport with python 2.2 on apache
1.3?

Thanks.
Peter


From jack_diederich at email.com  Fri Nov 22 17:46:48 2002
From: jack_diederich at email.com (Jack Diederich)
Date: Fri Jan  9 21:53:15 2004
Subject: [mod_python] Apache segfault when using PythonImport
Message-ID: <20021122224648.6502.qmail@email.com>

I can't say for cetain what the cause of the segfault is, but I've
posted a potential reason and patches to fix it more than once to this list.

The globals for python imports are not safe, and trivial to make so.  I know
3.x is the gold standard, but patching 2.x for stability shouldn't be out
of the question.

The calls he sites are a VERY good indicator that the global is the problem,
we should just register a cleanup hook to NULL it out and recreate it again if
init()s are called twice.

-jack
> ----- Original Message -----
> From: Peter Bowen <pzb@datastacks.com>
> Date: 22 Nov 2002 16:02:24 -0500 
> To: mod_python@modpython.org
> Subject: [mod_python] Apache segfault when using PythonImport
> 
> 
> > Apache is segfaulting when I use the PythonImport directive.
> > 
> > I have seen it under two slightly different conditions:
> > 
> > A) Apache 1.3.23 (from Red Hat Linux 7.3 errata), Python 2.2.2 without
> > threads, and mod_python 2.7.8
> > 
> > In this case the backtrace shows that the segfault occurs in ap_palloc. 
> > The stack looks like ap_palloc -> ap_pstrdup -> ap_table_add ->
> > directive_PythonImport.
> > 
> > B) Apache 1.3.23 (as above) or Apache 1.3.27, Python 2.2.2 with threads,
> > and mod_python 2.7.8
> > 
> > Different backtrace.  Dies in pthread_mutex_lock, called from
> > PyEval_AcquireLock.
> > 
> > Has anyone had sucess with using PythonImport with python 2.2 on apache
> > 1.3?
> > 
> > Thanks.
> > Peter
> > 
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://www.modpython.org/mailman/listinfo/mod_python
> > 
> > 
> 
> -- 
> _______________________________________________
> Sign-up for your own FREE Personalized E-mail at Mail.com
> http://www.mail.com/?sr=signup
> 
> One click access to the Top Search Engines
> http://www.exactsearchbar.com/mailcom
> 
> 

-- 
_______________________________________________
Sign-up for your own FREE Personalized E-mail at Mail.com
http://www.mail.com/?sr=signup

One click access to the Top Search Engines
http://www.exactsearchbar.com/mailcom


From post at nlhas.no  Sat Nov 23 12:54:36 2002
From: post at nlhas.no (NLH AS)
Date: Fri Jan  9 21:53:15 2004
Subject: [mod_python] Beginner documentation -- suggestion
Message-ID: <3.0.5.32.20021123125436.00b61960@nlhhost>

I've just installed mod_python and converted a cgi application. During this
process I've spent most of my time finding out what happens where -- the
actual conversion fell into place quickly when I understood the main
framework. Everything is in the documentation, but I'd have appreciated a
simple explanation along the lines of the following (which may well be
wrong!) somewhere in the tutorial. Perhaps something like this can be
worked into the next edition of the documentation?

pm


++++++ What happens where in a "out-of-the-box" Apache/mod_python setup:

At startup or at the first call to a mod_python handler Apache loads the
Python interpreter and the import modules at the top of the handler's
module file.

Each call to the handler is executed in an Apache child process with a
separate Python subinterpreter instance. It is not possible to share global
variables between Apache's child processes (so sharing a global database
connection is not possible for example), and there is no means of
predicting whether Apache will start a new process or re-use an existing
process for any given call to the handler. [>> pointer to information about
how Apache does this, how many child processes can be started, etc.?].

Global variables within the handler's module will be available to all calls
to the handler that are routed to the same Apache process. This could be
used to maintain and re-use a database connection per child process. 

Local variables within the handler are local to each call to the handler
[and are eventually garbage-collected in the normal way?].

Mod_python will check whether the top level python module (containing the
handler) has been changed and re-load if necessary. Imported modules are
not checked, and the only 100% certain way of ensuring that updated modules
are reloaded in all child processes is to stop and re-start Apache.

It is possible to tweak various aspects of this behaviour -- for example
Apache can be compiled to only ever start one child process (which would
enable global variables), but this would entail significantly poorer
performance.
+++++
   

From markusjais at yahoo.de  Mon Nov 25 00:30:50 2002
From: markusjais at yahoo.de (Markus Jais)
Date: Fri Jan  9 21:53:15 2004
Subject: [mod_python] beginners question
Message-ID: <1038180652.3173.2.camel@eagle>

Hello
I have just installed mod_python 2.7.8 for my
apache 1.3.23

I have python 2.2.2 (with threads) on a RedHat 7.3 system.

compilation was no problem but when I restart apache I get

Starting httpd: [Mon Nov 25 00:26:41 2002] [warn] Loaded DSO
modules/mod_python.so uses plain Apache 1.3 API, this module might crash
under EAPI! (please recompile it with -DEAPI)


what does this mean?? I found EAPI not mentioned in the sources.

markus




__________________________________________________________________

Gesendet von Yahoo! Mail - http://mail.yahoo.de
Möchten Sie mit einem Gruß antworten? http://grusskarten.yahoo.de

From jfk at metation.com  Mon Nov 25 13:06:36 2002
From: jfk at metation.com (Jørgen Frøjk Kjærsgaard)
Date: Fri Jan  9 21:53:15 2004
Subject: [mod_python] beginners question
In-Reply-To: <1038180652.3173.2.camel@eagle>
References: <1038180652.3173.2.camel@eagle>
Message-ID: <20021125110636.M72172@metation.com>

On 25 Nov 2002 00:30:50 +0100, Markus Jais wrote
> Hello
> I have just installed mod_python 2.7.8 for my
> apache 1.3.23
> 
> I have python 2.2.2 (with threads) on a RedHat 7.3 system.
> 
> compilation was no problem but when I restart apache I get
> 
> Starting httpd: [Mon Nov 25 00:26:41 2002] [warn] Loaded DSO
> modules/mod_python.so uses plain Apache 1.3 API, this module might crash
> under EAPI! (please recompile it with -DEAPI)
> 
> what does this mean?? I found EAPI not mentioned in the sources.

Apache 1.3 has two API versions. If you compile with the "-DEAPI" option given
to gcc, you get an EAPI version.

You may safely ignore the warning. mod_python works fine even when compiled
with plain API.

/jfk

--
J?rgen Fr?jk Kj?rsgaard
Metation ApS - the system integrators
Kystvejen 29 - DK 8000 ?rhus C - www.metation.com

From jquinte at fadu.uba.ar  Mon Nov 25 11:00:13 2002
From: jquinte at fadu.uba.ar (Javier Quinteros)
Date: Fri Jan  9 21:53:15 2004
Subject: [mod_python] Solaris 8...
Message-ID: <006301c2948a$fa13e240$3dd05c9d@sis.rec.uba.ar>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Hi, all of you !!!
Yes, it's me again. I'm still fighting with modpython and Solaris 8,
trying to make them both understand that they should work together...  
;-)
My question this time is TOO simple:

Has anyone been able to compile and install modpython in a Solaris 8 OS
???

Thanks in advance...
- ------------------------------
Javier Quinteros
jquinte@fadu.uba.ar
jquinte@dc.uba.ar
Universidad de Buenos Aires
- ------------------------------

-----BEGIN PGP SIGNATURE-----
Version: PGPfreeware 6.5.3 for non-commercial use <http://www.pgp.com>

iQA/AwUBPeIs63Qc0Z5RZeHIEQIIugCgg7DMEUW4+90brXKIjcQAhweTpFAAn0At
TuyWYxld3hvHQkvbEYcOk4yq
=vPKa
-----END PGP SIGNATURE-----



From agenkin-lst-mod_python at thpoon.com  Mon Nov 25 16:16:57 2002
From: agenkin-lst-mod_python at thpoon.com (Arcady Genkin)
Date: Fri Jan  9 21:53:15 2004
Subject: [mod_python] Solaris 8...
In-Reply-To: <006301c2948a$fa13e240$3dd05c9d@sis.rec.uba.ar> ("Javier
 Quinteros"'s message of "Mon, 25 Nov 2002 11:00:13 -0300")
References: <006301c2948a$fa13e240$3dd05c9d@sis.rec.uba.ar>
Message-ID: <uo4ra55oza.fsf@bashful.cdf.toronto.edu>

"Javier Quinteros" <jquinte@fadu.uba.ar> writes:

> Has anyone been able to compile and install modpython in a Solaris 8 OS

Yes, I have version 2.7.8 compiled, installed and working under
Solaris 8/Sparc with Apache 1.3.27.  I had to install Python with
threads turned off in a separate location; apart from that, everything
was quite easy.  Here are my install notes:

,----[ mod_python ]
|   - env PATH=/opt/python_threadless/bin:$PATH \
|         ./configure --with-apxs=/opt/apache/bin/apxs
|   - make
|   - make install
`----

Python 2.2.2 was installed with the following config options:
--prefix=/opt/python_threadless --without-threads .

I can't claim that this is the optimal configuration, but this seems
to have worked for me.

Hope this helps,
-- 
Arcady Genkin : CDF Systems Administrator
http://www.cdf.toronto.edu/~agenkin/contact.html

guilt is the cause of more disauders
than history's most obscene marorders (E.E. Cummings)

From markusjais at yahoo.de  Tue Nov 26 00:12:46 2002
From: markusjais at yahoo.de (Markus Jais)
Date: Fri Jan  9 21:53:15 2004
Subject: [mod_python] another beginners question: problem with <Location> directive
Message-ID: <1038265968.2605.3.camel@eagle>

hello
I have the example from the tutorial

from mod_python import apache

def handler(req):
    req.content_type = "text/html"
    req.send_http_header()
    req.write("Eagles are great")
    return apache.OK

and this setup

<Directory /var/www/html/python> 
  AddHandler python-program .py
  PythonHandler mptest 
  PythonDebug On 
</Directory>


this works fine.

but when I change the <Directory> directive to
----
<Location /python> 
  AddHandler python-program .py
  PythonHandler mptest 
  PythonDebug On 
</Location>
---
I get this error in my apache logfile:
[Tue Nov 26 00:07:18 2002] [notice] mod_python: (Re)importing mptest from None
[Tue Nov 26 00:07:18 2002] [error] PythonHandler mptest: Traceback (most recent call last):
[Tue Nov 26 00:07:18 2002] [error] PythonHandler mptest:   File "/usr/local/lib/python2.2/site-packages/mod_python/apache.py", line 181, in Dispatch
    module = import_module(module_name, _req)
[Tue Nov 26 00:07:18 2002] [error] PythonHandler mptest:   File "/usr/local/lib/python2.2/site-packages/mod_python/apache.py", line 332, in import_module
    f, p, d = imp.find_module(parts[i], path)
[Tue Nov 26 00:07:18 2002] [error] PythonHandler mptest: ImportError: No module named mptest


I am using python 2.2.2, modpython 2.7.8 and apache 1.3.23 (rpm version for redhat 7.3)

markus



__________________________________________________________________

Gesendet von Yahoo! Mail - http://mail.yahoo.de
Möchten Sie mit einem Gruß antworten? http://grusskarten.yahoo.de

From grisha at modpython.org  Wed Nov 27 18:55:46 2002
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:53:15 2004
Subject: [mod_python] another beginners question: problem with <Location>
 directive
In-Reply-To: <1038265968.2605.3.camel@eagle>
Message-ID: <20021127185210.U41427-100000@eden.ispol.com>

Mod_python adds the directory to sys.path for you, this is how Python
finds the script. But when you <Location> there is no way for mod_python
to know what to add to sys.path, so you have to do it explicitely, using
the PythonPath directive, try this:

<Location /python>
  AddHandler python-program .py
  PythonHandler mptest
  PythonPath "['/var/www/html/python']+sys.path"
  PythonDebug On
</Location>

Grisha

On 26 Nov 2002, Markus Jais wrote:

> hello
> I have the example from the tutorial
>
> from mod_python import apache
>
> def handler(req):
>     req.content_type = "text/html"
>     req.send_http_header()
>     req.write("Eagles are great")
>     return apache.OK
>
> and this setup
>
> <Directory /var/www/html/python>
>   AddHandler python-program .py
>   PythonHandler mptest
>   PythonDebug On
> </Directory>
>
>
> this works fine.
>
> but when I change the <Directory> directive to
> ----
> <Location /python>
>   AddHandler python-program .py
>   PythonHandler mptest
>   PythonDebug On
> </Location>
> ---
> I get this error in my apache logfile:
> [Tue Nov 26 00:07:18 2002] [notice] mod_python: (Re)importing mptest from None
> [Tue Nov 26 00:07:18 2002] [error] PythonHandler mptest: Traceback (most recent call last):
> [Tue Nov 26 00:07:18 2002] [error] PythonHandler mptest:   File "/usr/local/lib/python2.2/site-packages/mod_python/apache.py", line 181, in Dispatch
>     module = import_module(module_name, _req)
> [Tue Nov 26 00:07:18 2002] [error] PythonHandler mptest:   File "/usr/local/lib/python2.2/site-packages/mod_python/apache.py", line 332, in import_module
>     f, p, d = imp.find_module(parts[i], path)
> [Tue Nov 26 00:07:18 2002] [error] PythonHandler mptest: ImportError: No module named mptest
>
>
> I am using python 2.2.2, modpython 2.7.8 and apache 1.3.23 (rpm version for redhat 7.3)
>
> markus
>
>
>
> __________________________________________________________________
>
> Gesendet von Yahoo! Mail - http://mail.yahoo.de
> M?chten Sie mit einem Gru? antworten? http://grusskarten.yahoo.de
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
>


From Morten.Tryfoss at 1880nummeropplysning.no  Thu Nov 28 19:16:07 2002
From: Morten.Tryfoss at 1880nummeropplysning.no (Morten Tryfoss)
Date: Fri Jan  9 21:53:15 2004
Subject: SV: SV: SV: [mod_python] Problem with mod_python3.0(beta4),python2.2.1and apache 2.0.43
Message-ID: <07411F6A634E5445AEF010C58590F2FB636581@exchangeone.kristiansand.viadial.no>

This is the strace output from apache when it segfaults:

[pid  1577] <... accept resumed> {sin_family=AF_INET6, sin6_port=htons(3101), inet_pton(AF_INET6, "::ffff:62.73.255.77", &sin6_addr), sin6_flowinfo=0, sin6_scope_id=0}, [28]) = 8
[pid  1577] getsockname(8, {sin_family=AF_INET6, sin6_port=htons(80), inet_pton(AF_INET6, "::ffff:212.125.195.9", &sin6_addr), sin6_flowinfo=0, sin6_scope_id=0}, [28]) = 0
[pid  1577] fcntl64(8, F_GETFL)         = 0x2 (flags O_RDWR)
[pid  1577] fcntl64(8, F_SETFL, O_RDWR|O_NONBLOCK) = 0
[pid  1577] read(8, 0x81a0f50, 8000)    = -1 EAGAIN (Resource temporarily unavailable)
[pid  1577] poll([{fd=8, events=POLLIN, revents=POLLIN}], 1, 300000) = 1
[pid  1577] read(8, "GET / HTTP/1.1\r\nAccept: image/gi"..., 8000) = 288
[pid  1577] gettimeofday({1038506716, 88342}, NULL) = 0
[pid  1577] stat64("/usr/local/apache/htdocs/", {st_mode=S_IFDIR|0755, st_size=4096, ...}) = 0
[pid  1577] stat64("/usr/local/apache/htdocs/dses/login/login.py", {st_mode=S_IFREG|0444, st_size=4285, ...}) = 0
[pid  1577] stat64("/usr/local/apache/htdocs/dses/login/login.py", {st_mode=S_IFREG|0444, st_size=4285, ...}) = 0
[pid  1577] stat64("/usr/local/apache/htdocs/dses/login/login.py", {st_mode=S_IFREG|0444, st_size=4285, ...}) = 0
[pid  1577] stat64("/usr/local/apache/htdocs/dses/login/login.p", 0xbfffda6c) = -1 ENOENT (No such file or directory)
[pid  1577] --- SIGSEGV (Segmentation fault) ---
[pid  1574] <... select resumed> )      = ? ERESTARTNOHAND (To be restarted)
[pid  1574] --- SIGCHLD (Child exited) ---
[pid  1574] select(0, NULL, NULL, NULL, {0, 720000}) = 0 (Timeout)
[pid  1574] wait4(-1, [WIFSIGNALED(s) && WTERMSIG(s) == SIGSEGV], WNOHANG|WUNTRACED, NULL) = 1577
[pid  1574] gettimeofday({1038506716, 808246}, NULL) = 0
[pid  1574] write(7, "[Thu Nov 28 19:05:16 2002] [noti"..., 87) = 87

Any thoughts?

Morten

-----Opprinnelig melding-----
Fra: Gregory (Grisha) Trubetskoy [mailto:grisha@modpython.org]
Sendt: 5. november 2002 21:38
Til: Morten Tryfoss
Emne: Re: SV: SV: [mod_python] Problem with
mod_python3.0(beta4),python2.2.1and apache 2.0.43



It's impossible to tell what's going on based on these logs... What would
really help me track the problem down is knowing which line(s) of Python
code in your scripts cause this. You can try writing something to the logs
throughout the code to see where exactly it segfaults.

On Tue, 5 Nov 2002, Morten Tryfoss wrote:

> Now I've tried to upgrade Python, and it still segfaults.
>
> Here's some lines from apache's error_log:
>
> [Tue Nov 05 20:51:21 2002] [notice] child pid 29905 exit signal Segmentation fault (11)
> [Tue Nov 05 20:51:56 2002] [info] (104)Connection reset by peer: core_output_filter: writing data to the network
> [Tue Nov 05 20:51:56 2002] [info] (32)Broken pipe: core_output_filter: writing data to the network
> [Tue Nov 05 20:53:08 2002] [notice] child pid 29995 exit signal Segmentation fault (11)
> [Tue Nov 05 20:56:24 2002] [info] (104)Connection reset by peer: core_output_filter: writing data to the network
> [Tue Nov 05 20:56:24 2002] [info] (32)Broken pipe: core_output_filter: writing data to the network
>
> Is it possible that the scripts are the reason for this? (It worked fine on earlier versions of apache/mod_python).
>
>
>
> Morten
>
> -----Opprinnelig melding-----
> Fra: Gregory (Grisha) Trubetskoy [mailto:grisha@modpython.org]
> Sendt: 5. november 2002 20:20
> Til: Morten Tryfoss
> Kopi: mod_python@modpython.org
> Emne: Re: SV: [mod_python] Problem with mod_python3.0(beta4),
> python2.2.1and apache 2.0.43
>
>
>
> The first thing I would try is upgrading to Python 2.2.2. If that doesn't
> solve it, then you need to try to figure out a way to replicate this
> issue, which is easier said than done. So far I haven't had any segfault
> reports for BETA4, so I have no other info to relate this to.
>
> Grisha
>
> On Tue, 5 Nov 2002, Morten Tryfoss wrote:
>
> > SuSE Linux 8.0 (2.4.18)
> >
> > Morten
> >
> > -----Opprinnelig melding-----
> > Fra: Gregory (Grisha) Trubetskoy [mailto:grisha@modpython.org]
> > Sendt: 5. november 2002 19:49
> > Til: Morten Tryfoss
> > Emne: Re: [mod_python] Problem with mod_python3.0(beta4), python
> > 2.2.1and apache 2.0.43
> >
> >
> >
> > Morten - what's your operating system?
> >
> > On Tue, 5 Nov 2002, Morten Tryfoss wrote:
> >
> > >
> > > I start my server up, and everything works ok. But after av while(when
> > > the number of clients raise) some of the apache childs segfaults. Users
> > > who are running on their persistent connections may still use the
> > > server, but new connections are dropped. Any thoughts of what may be
> > > wrong?
> > >
> > > Currently I'm running apache 1.3.x, but some part of my scripts performs
> > > poorly. Running them on apache 2.0 improved a lot (as long as the server
> > > didn't crash).
> > >
> > >
> > > Morten Tryfoss
> > >
> > > _______________________________________________
> > > Mod_python mailing list
> > > Mod_python@modpython.org
> > > http://www.modpython.org/mailman/listinfo/mod_python
> > >
> >
> >
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://www.modpython.org/mailman/listinfo/mod_python
> >
>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
>



From francoislepoutre at compuserve.com  Fri Nov 29 10:38:12 2002
From: francoislepoutre at compuserve.com (francois lepoutre)
Date: Fri Jan  9 21:53:15 2004
Subject: [mod_python] some remarks, a few questions and
Message-ID: <001701c2978b$08c8f070$bd6e4351@mixio7jpsmlatx>

Hi all modpython users,

First modpython is plain great.We like some much
and even more so as an apache project :)

Thanks Grisha and all.

I just moved a couple of thousand lines of python from 
apache 1.3.27/modpython 2.7.4/python 2.1.1 (w2k) 
into apache 2.0.43/modpython 3.0.1/python 2.2.2 (w2k)

Some remarks:
1) INSTALLATION ON WIN32 WAS A SNAP, GREAT.
Automation has significantly improved for all components
Thanks to the apache and python communities 

2) The new install run exactly in the same way.
Perf and behaviour are nearly identical... that's both good 
(because every thing works ok) and mixed feeling 
(why change version). But we are not specifically 
looking for performance improvement anyway.

I hope that *nix apache users are feeling some perf 
improvements because of the new fork+thread model. 
Win32 runs the same. At least for us.

Now a few questions at this stage:
When running the old stuff (modpython 2.7) we maintained
two distinct series of modpython code:
- one plain simple set of routines for forking *nix (for a RH customers),
- win32-specific code with thread-mngt stuff (and connection pooling)
for various w2k set-ups.

We like the idea of a unified programming model a lot :)

With the new Apache2/modpython3 model can we expect :
- to run thread-enabled python on both environments (*nix and win32)?
- to run the same code (with thread-caring stuff) in both environment? 
- the thread-management routines to be of any use on *nix setups 
if they use a mixed "fork+thread" apache model?

Is this model fork+thread of any use or interest for modpython users?
I'm no python expert but have some doubt about the latest in view
of the way python runs its own threading stuff.

In the end a bug report (did i miss something on the apache 2 config.?).
The code below will work on 2.7.* and break on 3.0.1 (W2K).

from mod_python import apache

def handler(req):
    req.write("Your local address:%s %i" % \
    (req.connection.local_addr[0],req.connection.local_addr[1]))
     return apache.OK

Regards

Francois


From markusjais at yahoo.de  Tue Nov 26 00:19:02 2002
From: markusjais at yahoo.de (Markus Jais)
Date: Fri Jan  9 21:53:15 2004
Subject: [mod_python] software using mod_python ?
Message-ID: <1038266344.2698.0.camel@eagle>

hello
are there any open source python modules who are using
mod python ?
I would like to see some code with mod_python in action
to learn more about it.

markus



__________________________________________________________________

Gesendet von Yahoo! Mail - http://mail.yahoo.de
Yahoo! präsentiert als offizieller Sponsor das Fußball-Highlight des
Jahres: - http://www.FIFAworldcup.com

From mark_messer at calypso.com  Sat Nov 30 14:11:42 2002
From: mark_messer at calypso.com (Mark Messer)
Date: Fri Jan  9 21:53:15 2004
Subject: [mod_python] can't find mod_python.so
Message-ID: <00d701c298bd$772ffdf0$b27ba8c0@ZEUS>

I put mod_python.so into the modules directory, but I get an error when
starting Apache:

C:\tools\Apache2\bin>apache
Syntax error on line 173 of C:/tools/Apache2/conf/httpd.conf:
Cannot load C:/tools/Apache2/modules/mod_python.so into server: The
specified module could not be found.

I added this to the LoadModule section of httpd.conf:  LoadModule
python_module modules/mod_python.so

Here's the directory listing:
C:\tools\Apache2\modules>ls -al mod_p*
-rwxrwx---    1 Administ SYSTEM      40960 Oct  3 06:58 mod_proxy.so
-rwxrwx---    1 Administ SYSTEM      20480 Oct  3 06:58 mod_proxy_connect.so
-rwxrwx---    1 Administ SYSTEM      28672 Oct  3 06:58 mod_proxy_ftp.so
-rwxrwx---    1 Administ SYSTEM      24576 Oct  3 06:58 mod_proxy_http.so
-rwxrwx---    1 Administ SYSTEM      65536 Nov 26 17:49 mod_python.so

I am running mod_python 3.0.1, Python 2.2.2, Apache 2.0.43, Windows XP
Professional.   Tried changing perms and ownership to match what was there,
but that did not work.



From grisha at modpython.org  Sat Nov 30 23:06:10 2002
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:53:15 2004
Subject: [mod_python] can't find mod_python.so
In-Reply-To: <00d701c298bd$772ffdf0$b27ba8c0@ZEUS>
Message-ID: <20021130230513.T83360-100000@eden.ispol.com>

This is possibly because the mod_python.so that is out there is for Python
2.2.1. I don't have one for 2.2.2 compiled (yet).

Grisha

On Sat, 30 Nov 2002, Mark Messer wrote:

> I put mod_python.so into the modules directory, but I get an error when
> starting Apache:
>
> C:\tools\Apache2\bin>apache
> Syntax error on line 173 of C:/tools/Apache2/conf/httpd.conf:
> Cannot load C:/tools/Apache2/modules/mod_python.so into server: The
> specified module could not be found.
>
> I added this to the LoadModule section of httpd.conf:  LoadModule
> python_module modules/mod_python.so
>
> Here's the directory listing:
> C:\tools\Apache2\modules>ls -al mod_p*
> -rwxrwx---    1 Administ SYSTEM      40960 Oct  3 06:58 mod_proxy.so
> -rwxrwx---    1 Administ SYSTEM      20480 Oct  3 06:58 mod_proxy_connect.so
> -rwxrwx---    1 Administ SYSTEM      28672 Oct  3 06:58 mod_proxy_ftp.so
> -rwxrwx---    1 Administ SYSTEM      24576 Oct  3 06:58 mod_proxy_http.so
> -rwxrwx---    1 Administ SYSTEM      65536 Nov 26 17:49 mod_python.so
>
> I am running mod_python 3.0.1, Python 2.2.2, Apache 2.0.43, Windows XP
> Professional.   Tried changing perms and ownership to match what was there,
> but that did not work.
>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
>


From markusjais at yahoo.de  Tue Nov 26 21:29:38 2002
From: markusjais at yahoo.de (Markus Jais)
Date: Fri Jan  9 21:53:15 2004
Subject: [mod_python] another beginners question: problem with <Location> directive
Message-ID: <1038342581.1928.3.camel@eagle>

hello
I already sent this message yesterday but somehow it didn't reach
the list.


I have the example from the tutorial

from mod_python import apache

def handler(req):
    req.content_type = "text/html"
    req.send_http_header()
    req.write("Eagles are great")
    return apache.OK


and this setup

<Directory /var/www/html/python> 
  AddHandler python-program .py
  PythonHandler mptest 
  PythonDebug On 
</Directory>


this works fine.

but when I change the <Directory> directive to
----
<Location /python> 
  AddHandler python-program .py
  PythonHandler mptest 
  PythonDebug On 
</Location>
---
I get this error in my apache logfile:
[Tue Nov 26 00:07:18 2002] [notice] mod_python: (Re)importing mptest from None
[Tue Nov 26 00:07:18 2002] [error] PythonHandler mptest: Traceback (most recent call last):
[Tue Nov 26 00:07:18 2002] [error] PythonHandler mptest:   File "/usr/local/lib/python2.2/site-packages/mod_python/apache.py", line 181, in Dispatch
    module = import_module(module_name, _req)
[Tue Nov 26 00:07:18 2002] [error] PythonHandler mptest:   File "/usr/local/lib/python2.2/site-packages/mod_python/apache.py", line 332, in import_module
    f, p, d = imp.find_module(parts[i], path)
[Tue Nov 26 00:07:18 2002] [error] PythonHandler mptest: ImportError: No module named mptest


I am using python 2.2.2, modpython 2.7.8 and apache 1.3.23 (rpm version for redhat 7.3)

markus



__________________________________________________________________

Gesendet von Yahoo! Mail - http://mail.yahoo.de
Yahoo! präsentiert als offizieller Sponsor das Fußball-Highlight des
Jahres: - http://www.FIFAworldcup.com

From grisha at apache.org  Wed Nov 27 14:37:33 2002
From: grisha at apache.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:53:15 2004
Subject: [mod_python] ANNOUNCE: Mod_python 3.0.1
Message-ID: <20021127135855.Q36516-100000@eden.ispol.com>

The Apache Software Foundation and The Apache HTTP Server Project are
pleased to announce the release of mod_python 3.0.1.

Mod_python is an Apache HTTP Server module that embeds the Python
interpreter within the server. With mod_python you can write web-based
applications in Python that will run many times faster than traditional
CGI and will have access to advanced features such as ability to retain
database connections between requests, access to httpd internals and
provide content filter as well as connection handlers.

This is the first release of mod_python as a subproject of the Apache HTTP
Server Project, as well as a major milestone accomplishment finally
bringing compatibility with Apache 2.0.

This release increments the major version to 3. The major version
increment is to denote that this release is only compatible with Apache
httpd server 2.0 and Python 2.2 or later and is not fully backwards
compatible with previous versions of mod_python. For details on migrating
code from previous versions of mod_python, as well as a list of new
featurs, see the README file in the distribution.

Mod_python is available for download from:

http://www.apache.org/dist/httpd/modpython/

For more information about mod_python visit
http://www.modpython.org/

Enjoy, and Happy Thanksgiving to those in the US!

Grisha Trubetskoy



From Antonio at memora.com  Sun Nov 24 19:48:11 2002
From: Antonio at memora.com (Antonio Rodriguez)
Date: Fri Jan  9 21:53:15 2004
Subject: [mod_python] beginners question
References: <1038180652.3173.2.camel@eagle>
Message-ID: <001f01c29a3b$e92ddc40$6401a8c0@darwin>

Markus,

Go into the src directory of the dist and in the OPTIONS= line add -DEAPI.
apxs will do the right thing and you will stop getting that warning.

Heads up on having threads compiled in. I asked the list what the
ramifications of this were going to be (besides total crashes which don't
seem to happen if you don't explictly use threads) a few weeks ago but have
gotten no answers. I might recompile without threads.

Antonio

----- Original Message -----
From: "Markus Jais" <markusjais@yahoo.de>
To: <mod_python@modpython.org>
Sent: Sunday, November 24, 2002 6:30 PM
Subject: [mod_python] beginners question


Hello
I have just installed mod_python 2.7.8 for my
apache 1.3.23

I have python 2.2.2 (with threads) on a RedHat 7.3 system.

compilation was no problem but when I restart apache I get

Starting httpd: [Mon Nov 25 00:26:41 2002] [warn] Loaded DSO
modules/mod_python.so uses plain Apache 1.3 API, this module might crash
under EAPI! (please recompile it with -DEAPI)


what does this mean?? I found EAPI not mentioned in the sources.

markus




__________________________________________________________________

Gesendet von Yahoo! Mail - http://mail.yahoo.de
M?chten Sie mit einem Gru? antworten? http://grusskarten.yahoo.de
_______________________________________________
Mod_python mailing list
Mod_python@modpython.org
http://www.modpython.org/mailman/listinfo/mod_python




From jfk at metation.com  Fri Nov  1 09:20:16 2002
From: jfk at metation.com (Jørgen Frøjk Kjærsgaard)
Date: Fri Jan  9 21:59:44 2004
Subject: [mod_python] Lifecycle of mod_python instances
In-Reply-To: <BB355965-ED1C-11D6-9578-00039300D690@memora.com>
References: <BB355965-ED1C-11D6-9578-00039300D690@memora.com>
Message-ID: <20021101072016.M33334@metation.com>

On Thu, 31 Oct 2002 17:04:30 -0500, Antonio L Rodriguez wrote
> Forgive me if this is more of an apache process question, but I 
> couldn't find it covered clearly in the docs.
> 
> When apache boots up (on *NIX) its starts a bunch of children 
> processes. Does each child have its own separate image of mod_python 
> execution space that is totally separate from the other images?

Correct. Apache 1.3 starts a process per simultaneous request it can handle.
Apache 2.0 is capable of running in threaded mode where the threads share
memory and thus can have global shared variables. I have no experience with
2.0 so far, though. See the documentation for Apache, in particular
http://httpd.apache.org/docs/mod/core.html#maxclients for 1.3 and
http://httpd.apache.org/docs-2.0/mod/mpm_common.html#maxclients for 2.0.

> That is, if I define a global var to measure hit counts in a script 
> and then I see this var dance up and down as each of the child 
> processes handles the request, do I infer correctly that there are 
> separate python interpreters living inside of each child process?

Exactly. You never know which process the next request will hit.

> If this is so, I'd be curious how people do global data structures 
> in this model, i.e. a database connection pool.

Truely global data with Apache 1.3 requires some kind of shared memory, which
isn't supported by mod_python. I use one database connection per child. This
works well, but of cause, if you configure your Apache to run with a lot of
idle children, you'll have a lot of idle connections. If your database system
has a limit as to how many simultaneous connections it can handle, be sure you
don't hit that limit. Raise it or limit the number of Apache processes.

/jfk

--
J?rgen Fr?jk Kj?rsgaard
Metation ApS - the system integrators
Kystvejen 29 - DK 8000 ?rhus C - www.metation.com

From conrad at hep.caltech.edu  Fri Nov  1 14:39:55 2002
From: conrad at hep.caltech.edu (Conrad Steenberg)
Date: Fri Jan  9 21:59:44 2004
Subject: [mod_python] Lifecycle of mod_python instances
In-Reply-To: <20021101072016.M33334@metation.com>
References: <BB355965-ED1C-11D6-9578-00039300D690@memora.com> 
	<20021101072016.M33334@metation.com>
Message-ID: <1036190396.1708.335.camel@heppc22.hep.caltech.edu>

Hi

Just my 2c: 

Using Berkeley DB works great for small things like counters and other
small pieces of persistent data. It is already installed on most
systems, so all you need is the Python binding from
http://pybsddb.sourceforge.net/

You can open a connection to the DB and store it as a global variable in
your mod_python script when the script is imported - i.e. not within the
handler. You can use e.g. cookies to identify connections.

HTH

COnrad

On Thu, 2002-10-31 at 23:20, J?rgen Fr?jk Kj?rsgaard wrote:
> On Thu, 31 Oct 2002 17:04:30 -0500, Antonio L Rodriguez wrote
> > Forgive me if this is more of an apache process question, but I 
> > couldn't find it covered clearly in the docs.
> > 
> > When apache boots up (on *NIX) its starts a bunch of children 
> > processes. Does each child have its own separate image of mod_python 
> > execution space that is totally separate from the other images?
> 
> Correct. Apache 1.3 starts a process per simultaneous request it can handle.
> Apache 2.0 is capable of running in threaded mode where the threads share
> memory and thus can have global shared variables. I have no experience with
> 2.0 so far, though. See the documentation for Apache, in particular
> http://httpd.apache.org/docs/mod/core.html#maxclients for 1.3 and
> http://httpd.apache.org/docs-2.0/mod/mpm_common.html#maxclients for 2.0.
> 
> > That is, if I define a global var to measure hit counts in a script 
> > and then I see this var dance up and down as each of the child 
> > processes handles the request, do I infer correctly that there are 
> > separate python interpreters living inside of each child process?
> 
> Exactly. You never know which process the next request will hit.
> 
> > If this is so, I'd be curious how people do global data structures 
> > in this model, i.e. a database connection pool.
> 
> Truely global data with Apache 1.3 requires some kind of shared memory, which
> isn't supported by mod_python. I use one database connection per child. This
> works well, but of cause, if you configure your Apache to run with a lot of
> idle children, you'll have a lot of idle connections. If your database system
> has a limit as to how many simultaneous connections it can handle, be sure you
> don't hit that limit. Raise it or limit the number of Apache processes.
> 
> /jfk
> 
> --
> J?rgen Fr?jk Kj?rsgaard
> Metation ApS - the system integrators
> Kystvejen 29 - DK 8000 ?rhus C - www.metation.com
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
-- 
*-----------------------------------------*
| Conrad Steenberg                        |
| Caltech, Mail Code 356-48               |
| Pasadena, CA, 91125                     |
| e-mail: conrad@hep.caltech.edu          |
| Tel: (626) 395-8758                     |
*-----------------------------------------*



From john at journyx.com  Sat Nov  2 14:43:24 2002
From: john at journyx.com (John Maddalozzo)
Date: Fri Jan  9 21:59:44 2004
Subject: [mod_python] mod_python on AIX
Message-ID: <Pine.LNX.4.21.0211021439420.7229-100000@dev1.int.journyx.com>

Has anyone been successful at building mod_python support on AIX? It
worked at one time but now on Apache 1.3.27, Python 2.1 and the
latest mod_python I have been unable to get it to run without
httpd core dumping when handling a request (running the mptest.py
program). Python/http calls out to load the stropmodule which gets loaded
as a shared library and then stop calls back to Py_InitModule4().
But it looks like it is trying to jump to an address in the shared
library instead of resolving Py_InitModule4 in libpython2.1.a.
I've had the same problem on both AIX 4.3.3 and 5.1.

If you've been successful at getting mod_python working with any
combination of software on AIX I'd sure like to find out what the trick
is. 

Thanks, John



From Morten.Tryfoss at 1880nummeropplysning.no  Tue Nov  5 19:24:05 2002
From: Morten.Tryfoss at 1880nummeropplysning.no (Morten Tryfoss)
Date: Fri Jan  9 21:59:44 2004
Subject: [mod_python] Problem with mod_python3.0(beta4), python 2.2.1 and apache 2.0.43
Message-ID: <07411F6A634E5445AEF010C58590F2FB665A3A@exchangeone.kristiansand.viadial.no>

I start my server up, and everything works ok. But after av while(when the number of clients raise) some of the apache childs segfaults. Users who are running on their persistent connections may still use the server, but new connections are dropped. Any thoughts of what may be wrong?

Currently I'm running apache 1.3.x, but some part of my scripts performs poorly. Running them on apache 2.0 improved a lot (as long as the server didn't crash).


Morten Tryfoss


From Morten.Tryfoss at 1880nummeropplysning.no  Tue Nov  5 19:48:36 2002
From: Morten.Tryfoss at 1880nummeropplysning.no (Morten Tryfoss)
Date: Fri Jan  9 21:59:44 2004
Subject: SV: [mod_python] Problem with mod_python3.0(beta4), python 2.2.1and apache 2.0.43
Message-ID: <07411F6A634E5445AEF010C58590F2FB63655D@exchangeone.kristiansand.viadial.no>

SuSE Linux 8.0 (2.4.18)

Morten

-----Opprinnelig melding-----
Fra: Gregory (Grisha) Trubetskoy [mailto:grisha@modpython.org]
Sendt: 5. november 2002 19:49
Til: Morten Tryfoss
Emne: Re: [mod_python] Problem with mod_python3.0(beta4), python
2.2.1and apache 2.0.43



Morten - what's your operating system?

On Tue, 5 Nov 2002, Morten Tryfoss wrote:

>
> I start my server up, and everything works ok. But after av while(when
> the number of clients raise) some of the apache childs segfaults. Users
> who are running on their persistent connections may still use the
> server, but new connections are dropped. Any thoughts of what may be
> wrong?
>
> Currently I'm running apache 1.3.x, but some part of my scripts performs
> poorly. Running them on apache 2.0 improved a lot (as long as the server
> didn't crash).
>
>
> Morten Tryfoss
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
>



From grisha at modpython.org  Tue Nov  5 14:19:35 2002
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:59:44 2004
Subject: SV: [mod_python] Problem with mod_python3.0(beta4), python
 2.2.1and apache 2.0.43
In-Reply-To: <07411F6A634E5445AEF010C58590F2FB63655D@exchangeone.kristiansand.viadial.no>
Message-ID: <20021105141658.M32052-100000@eden.ispol.com>

The first thing I would try is upgrading to Python 2.2.2. If that doesn't
solve it, then you need to try to figure out a way to replicate this
issue, which is easier said than done. So far I haven't had any segfault
reports for BETA4, so I have no other info to relate this to.

Grisha

On Tue, 5 Nov 2002, Morten Tryfoss wrote:

> SuSE Linux 8.0 (2.4.18)
>
> Morten
>
> -----Opprinnelig melding-----
> Fra: Gregory (Grisha) Trubetskoy [mailto:grisha@modpython.org]
> Sendt: 5. november 2002 19:49
> Til: Morten Tryfoss
> Emne: Re: [mod_python] Problem with mod_python3.0(beta4), python
> 2.2.1and apache 2.0.43
>
>
>
> Morten - what's your operating system?
>
> On Tue, 5 Nov 2002, Morten Tryfoss wrote:
>
> >
> > I start my server up, and everything works ok. But after av while(when
> > the number of clients raise) some of the apache childs segfaults. Users
> > who are running on their persistent connections may still use the
> > server, but new connections are dropped. Any thoughts of what may be
> > wrong?
> >
> > Currently I'm running apache 1.3.x, but some part of my scripts performs
> > poorly. Running them on apache 2.0 improved a lot (as long as the server
> > didn't crash).
> >
> >
> > Morten Tryfoss
> >
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://www.modpython.org/mailman/listinfo/mod_python
> >
>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
>


From Morten.Tryfoss at 1880nummeropplysning.no  Tue Nov  5 20:58:51 2002
From: Morten.Tryfoss at 1880nummeropplysning.no (Morten Tryfoss)
Date: Fri Jan  9 21:59:44 2004
Subject: SV: SV: [mod_python] Problem with mod_python3.0(beta4), python2.2.1and apache 2.0.43
Message-ID: <07411F6A634E5445AEF010C58590F2FB63655E@exchangeone.kristiansand.viadial.no>

Now I've tried to upgrade Python, and it still segfaults.

Here's some lines from apache's error_log:

[Tue Nov 05 20:51:21 2002] [notice] child pid 29905 exit signal Segmentation fault (11)
[Tue Nov 05 20:51:56 2002] [info] (104)Connection reset by peer: core_output_filter: writing data to the network
[Tue Nov 05 20:51:56 2002] [info] (32)Broken pipe: core_output_filter: writing data to the network
[Tue Nov 05 20:53:08 2002] [notice] child pid 29995 exit signal Segmentation fault (11)
[Tue Nov 05 20:56:24 2002] [info] (104)Connection reset by peer: core_output_filter: writing data to the network
[Tue Nov 05 20:56:24 2002] [info] (32)Broken pipe: core_output_filter: writing data to the network

Is it possible that the scripts are the reason for this? (It worked fine on earlier versions of apache/mod_python).



Morten

-----Opprinnelig melding-----
Fra: Gregory (Grisha) Trubetskoy [mailto:grisha@modpython.org]
Sendt: 5. november 2002 20:20
Til: Morten Tryfoss
Kopi: mod_python@modpython.org
Emne: Re: SV: [mod_python] Problem with mod_python3.0(beta4),
python2.2.1and apache 2.0.43



The first thing I would try is upgrading to Python 2.2.2. If that doesn't
solve it, then you need to try to figure out a way to replicate this
issue, which is easier said than done. So far I haven't had any segfault
reports for BETA4, so I have no other info to relate this to.

Grisha

On Tue, 5 Nov 2002, Morten Tryfoss wrote:

> SuSE Linux 8.0 (2.4.18)
>
> Morten
>
> -----Opprinnelig melding-----
> Fra: Gregory (Grisha) Trubetskoy [mailto:grisha@modpython.org]
> Sendt: 5. november 2002 19:49
> Til: Morten Tryfoss
> Emne: Re: [mod_python] Problem with mod_python3.0(beta4), python
> 2.2.1and apache 2.0.43
>
>
>
> Morten - what's your operating system?
>
> On Tue, 5 Nov 2002, Morten Tryfoss wrote:
>
> >
> > I start my server up, and everything works ok. But after av while(when
> > the number of clients raise) some of the apache childs segfaults. Users
> > who are running on their persistent connections may still use the
> > server, but new connections are dropped. Any thoughts of what may be
> > wrong?
> >
> > Currently I'm running apache 1.3.x, but some part of my scripts performs
> > poorly. Running them on apache 2.0 improved a lot (as long as the server
> > didn't crash).
> >
> >
> > Morten Tryfoss
> >
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://www.modpython.org/mailman/listinfo/mod_python
> >
>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
>



From glunsford at monbar.com  Wed Nov  6 14:22:42 2002
From: glunsford at monbar.com (George Lunsford)
Date: Fri Jan  9 21:59:44 2004
Subject: [mod_python] mod_python & apache config issues
Message-ID: <52E5514ECBC5D611B3E100D0B7B84F5A24CE85@EXCHMAIL>

For the past few days I've been experimenting with installing mod_python
2.7.8 on an Apache 1.3.22 server that was from the standard Caldera
OpenLinux 3.1.1 install.  First, I installed the Python interpreter v 2.1.3,
then I tried installing mod_python, and I ran into the whole threading
issue.  I recompiled Python 2.1.3 without threads, and put it in
/usr/local/web/.  I ran into the EAPI error, and added the OPT=-DEAPI into
the src/Makefile.  
 
Now whenever I run apache, if I do strace httpd -X, it looks like it's using
my threaded version of Python (in /usr/local/bin, there's a symlink in
/usr/bin/ to it).  I'll try and paste what I think are the relevant lines
below:
 
stat64("/usr/local/sbin/python", 0xbfffe2ac) = -1 ENOENT (No such file or
directory)
stat64("/sbin/python", 0xbfffe2ac)      = -1 ENOENT (No such file or
directory)
stat64("/usr/sbin/python", 0xbfffe2ac)  = -1 ENOENT (No such file or
directory)
stat64("/bin/python", 0xbfffe2ac)       = -1 ENOENT (No such file or
directory)
stat64("/usr/bin/python", {st_mode=S_IFREG|0755, st_size=1469444, ...}) = 0
readlink("/usr/bin/python", "/usr/local/bin/python", 1024) = 21
readlink("/usr/local/bin/python", 0xbfffe434, 1024) = -1 EINVAL (Invalid
argument)
stat64("/usr/local/bin/Modules/Setup", 0xbfffe26c) = -1 ENOENT (No such file
or directory)
stat64("/usr/local/bin/lib/python2.1/os.py", 0xbfffe24c) = -1 ENOENT (No
such file or directory)
stat64("/usr/local/bin/lib/python2.1/os.pyc", 0xbfffe23c) = -1 ENOENT (No
such file or directory)
stat64("/usr/local/lib/python2.1/os.py", {st_mode=S_IFREG|0644,
st_size=17401, ...}) = 0
 
Apache would run, but at the first connection (even just to get the root
index file of a directory, it would segfault.  It doesn't appear to be doing
that anymore, however... now it exits with this error eventually (without
needing to connect to the server):
 
[Wed Nov  6 14:37:58 2002] [crit] (98)Address already in use: make_sock:
could not bind to port 80
 
I was wondering if anyone could give me any advice/help with this issue.
Thanks in advance.
 
George Lunsford
 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mailman.modpython.org/pipermail/mod_python/attachments/20021106/34dbf358/attachment-0002.htm
From conrad at hep.caltech.edu  Fri Nov  8 11:24:56 2002
From: conrad at hep.caltech.edu (Conrad Steenberg)
Date: Fri Jan  9 21:59:44 2004
Subject: [mod_python] Interest in sendfile from mod_python?
Message-ID: <1036783496.6448.491.camel@heppc22.hep.caltech.edu>

Hi

My mod_python application regularly needs to send data from files. This
could be either entire files or parts of files.

The Linux and FreeBSD (I think) sendfile calls make this very easy and
efficient in Apache itself, but there is no way to control this from
within mod_python as far as I can see.

My solution was to build a Python sendfile module (using code from the
Medusa server, under the Python license), and create a patch for
mod_python to get the request file-descriptor to pass to the sendfile
call.

So the question is, is anybody else interested in this? Either for me to
contribute the mod_python patch and sendfile package, or for integration
of these two parts into mod_pyhton itself?

Just thought I'd ask :-)

Conrad

Ps. and if using sendfile from mod_python was doable already please feel
free to tell me how ;-)

-- 
*-----------------------------------------*
| Conrad Steenberg                        |
| Caltech, Mail Code 356-48               |
| Pasadena, CA, 91125                     |
| e-mail: conrad@hep.caltech.edu          |
| Tel: (626) 395-8758                     |
*-----------------------------------------*


From jwyant at sfbcic.com  Fri Nov  8 14:16:01 2002
From: jwyant at sfbcic.com (Wyant, Jaime)
Date: Fri Jan  9 21:59:44 2004
Subject: [mod_python] Grabbing the callback object
Message-ID: <654DAEACA633D511B5F500902784B052188EAA@MS-EXCHANGE>

Hi all!

Is there any way to grab the Callback object?  I really want to override the
"ReportError" method and generate a more meaningful error message with
pretty graphics.

Better yet, is there a way to catch unhandled exceptions and display a
custom error message? 

thanks!

jaime wyant (jwyant@sfbcic . com)
MS Farm Bureau
(601) 977 - 4291



From conrad at hep.caltech.edu  Fri Nov  8 13:31:49 2002
From: conrad at hep.caltech.edu (Conrad Steenberg)
Date: Fri Jan  9 21:59:44 2004
Subject: [mod_python] Grabbing the callback object
In-Reply-To: <654DAEACA633D511B5F500902784B052188EAA@MS-EXCHANGE>
References: <654DAEACA633D511B5F500902784B052188EAA@MS-EXCHANGE>
Message-ID: <1036791109.6448.635.camel@heppc22.hep.caltech.edu>

Hi Jaime

You can write your own error message to the client, and return
apache.DONE to stop Apache from any further processing.

E.g.

def handler(req):
  try:
    <Do some processing>
  except:
    <Write error message, including headers>
    return apache.DONE

  return apache.OK


Cheers!

Conrad

On Fri, 2002-11-08 at 12:16, Wyant, Jaime wrote:
> Hi all!
> 
> Is there any way to grab the Callback object?  I really want to override the
> "ReportError" method and generate a more meaningful error message with
> pretty graphics.
> 
> Better yet, is there a way to catch unhandled exceptions and display a
> custom error message? 
> 
> thanks!
> 
> jaime wyant (jwyant@sfbcic . com)
> MS Farm Bureau
> (601) 977 - 4291
> 
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
-- 
*-----------------------------------------*
| Conrad Steenberg                        |
| Caltech, Mail Code 356-48               |
| Pasadena, CA, 91125                     |
| e-mail: conrad@hep.caltech.edu          |
| Tel: (626) 395-8758                     |
*-----------------------------------------*


From jwyant at sfbcic.com  Fri Nov  8 16:06:58 2002
From: jwyant at sfbcic.com (Wyant, Jaime)
Date: Fri Jan  9 21:59:44 2004
Subject: [mod_python] Grabbing the callback object
Message-ID: <654DAEACA633D511B5F500902784B052188EAD@MS-EXCHANGE>


>>>-----Original Message-----
>>>From: Conrad Steenberg [mailto:conrad@hep.caltech.edu]
>>>Sent: Friday, November 08, 2002 3:32 PM
>>>To: Wyant, Jaime
>>>Cc: 'mod_python@modpython.org'
>>>Subject: Re: [mod_python] Grabbing the callback object
>>>
>>>
>>>Hi Jaime
>>>
>>>You can write your own error message to the client, and return
>>>apache.DONE to stop Apache from any further processing.
>>>
>>>E.g.
>>>
>>>def handler(req):
>>>  try:
>>>    <Do some processing>
>>>  except:
>>>    <Write error message, including headers>
>>>    return apache.DONE
>>>
>>>  return apache.OK
>>>
>>>
>>>Cheers!
>>>
>>>Conrad
>>>

Thanks!  I thought about doing it that way.  Take a peek at a snippet of my
error log:


[Tue Nov  5 07:36:13 2002] [error] PythonHandler mod_python.publisher:
File "/
usr/local/lib/python2.2/site-packages/mod_python/publisher.py", line 88, in
hand
ler
    if func_path[-1] == ".":
[Tue Nov  5 07:36:13 2002] [error] PythonHandler mod_python.publisher:
IndexErro
r: string index out of range
[Tue Nov  5 08:09:44 2002] [error] PythonHandler mod_python.publisher:
Traceback
 (most recent call last):

I'm getting an IndexError in the publisher module.  I have already modified
that module a little bit already and would rather not change it any more.

No, my changes aren't causing the IndexError :).  I simply modified the
handler to "raise apache.SERVER_RETURN, apache.HTTP_NOT_FOUND" when an
ImportError occurred.  This stopped "mostly correct" paths from returning an
"Internal Server Error Message".  I can elaborate if you are curious.

Maybe I could create a wrapper handler for the publisher handler?

# my wrapper

import mod_python.publisher

def handler( req ):
  try:
    return mod_python.publisher.handler( req )    
  except Exception:
    req.write( create_cool_html_error_report() )
    return apache.OK


Thanks!
jaime

>>>On Fri, 2002-11-08 at 12:16, Wyant, Jaime wrote:
>>>> Hi all!
>>>> 
>>>> Is there any way to grab the Callback object?  I really 
>>>want to override the
>>>> "ReportError" method and generate a more meaningful error 
>>>message with
>>>> pretty graphics.
>>>> 
>>>> Better yet, is there a way to catch unhandled exceptions 
>>>and display a
>>>> custom error message? 
>>>> 
>>>> thanks!
>>>> 
>>>> jaime wyant (jwyant@sfbcic . com)
>>>> MS Farm Bureau
>>>> (601) 977 - 4291
>>>> 
>>>> 
>>>> _______________________________________________
>>>> Mod_python mailing list
>>>> Mod_python@modpython.org
>>>> http://www.modpython.org/mailman/listinfo/mod_python
>>>-- 
>>>*-----------------------------------------*
>>>| Conrad Steenberg                        |
>>>| Caltech, Mail Code 356-48               |
>>>| Pasadena, CA, 91125                     |
>>>| e-mail: conrad@hep.caltech.edu          |
>>>| Tel: (626) 395-8758                     |
>>>*-----------------------------------------*
>>>
>>>_______________________________________________
>>>Mod_python mailing list
>>>Mod_python@modpython.org
>>>http://www.modpython.org/mailman/listinfo/mod_python
>>>

From conrad at hep.caltech.edu  Fri Nov  8 14:20:56 2002
From: conrad at hep.caltech.edu (Conrad Steenberg)
Date: Fri Jan  9 21:59:44 2004
Subject: [mod_python] Grabbing the callback object
In-Reply-To: <654DAEACA633D511B5F500902784B052188EAD@MS-EXCHANGE>
References: <654DAEACA633D511B5F500902784B052188EAD@MS-EXCHANGE>
Message-ID: <1036794056.6446.695.camel@heppc22.hep.caltech.edu>

On Fri, 2002-11-08 at 14:06, Wyant, Jaime wrote:
> 
> Maybe I could create a wrapper handler for the publisher handler?
> 
> # my wrapper
> 
> import mod_python.publisher
> 
> def handler( req ):
>   try:
>     return mod_python.publisher.handler( req )    
>   except Exception:
>     req.write( create_cool_html_error_report() )
>     return apache.OK
> 

Yes, for the publisher handler, that sounds rather more sensible. 

Cheers!

Conrad

> 
> >>>On Fri, 2002-11-08 at 12:16, Wyant, Jaime wrote:
> >>>> Hi all!
> >>>> 
> >>>> Is there any way to grab the Callback object?  I really 
> >>>want to override the
> >>>> "ReportError" method and generate a more meaningful error 
> >>>message with
> >>>> pretty graphics.
> >>>> 
> >>>> Better yet, is there a way to catch unhandled exceptions 
> >>>and display a
> >>>> custom error message? 
> >>>> 
> >>>> thanks!
> >>>> 
> >>>> jaime wyant (jwyant@sfbcic . com)
> >>>> MS Farm Bureau
> >>>> (601) 977 - 4291
> >>>> 
> >>>> 



From conrad at hep.caltech.edu  Sat Nov  9 14:17:02 2002
From: conrad at hep.caltech.edu (Conrad Steenberg)
Date: Fri Jan  9 21:59:44 2004
Subject: [mod_python] Interest in sendfile from mod_python?
In-Reply-To: <20021109052035.GZ4761@netvista.mikebell.org>
References: <1036783496.6448.491.camel@heppc22.hep.caltech.edu> 
	<20021109052035.GZ4761@netvista.mikebell.org>
Message-ID: <1036880222.1221.5.camel@192.168.1.100>

Hi Mike

Have a look at sendfilemodule.c in
http://cvs.sourceforge.net/cgi-bin/viewcvs.cgi/clarens/clarens/sendfile/

The patch for mod_python to get the filedescriptor to write to is below.

Cheers!

Conrad

On Fri, 2002-11-08 at 21:20, mike@mikebell.org wrote:
> On Fri, Nov 08, 2002 at 11:24:56AM -0800, Conrad Steenberg wrote:
> > So the question is, is anybody else interested in this? Either for me to
> > contribute the mod_python patch and sendfile package, or for integration
> > of these two parts into mod_pyhton itself?
> 
> I would absolutely be interested. Zero-copy from mod_python, yay. I have
> in fact thought about this in the past but never got around to doing
> anything about it.
--- src/requestobject.c.orig    Tue Jun  4 15:52:45 2002
+++ src/requestobject.c Tue Jun  4 11:15:49 2002
@@ -781,6 +781,27 @@

 }

+/**
+ ** request.get_fd(request self)
+ **
+ *      Returns the file descriptor to write output to
+ */
+
+static PyObject * req_fd(requestobject *self, PyObject *args)
+{
+    PyObject *fd;
+    long thefd;
+    thefd=(long)self->request_rec->connection->client->fd;
+    fd = PyInt_FromLong(thefd);
+    if (!fd) {
+       PyErr_SetString(PyExc_IOError, "Could not determine file descriptor.");
+       return NULL;
+    }
+
static PyMethodDef requestobjectmethods[] = {
     {"add_common_vars",      (PyCFunction) req_add_common_vars,      METH_VARA
     {"add_handler",          (PyCFunction) req_add_handler,          METH_VARA
@@ -797,6 +818,7 @@
     {"register_cleanup",     (PyCFunction) req_register_cleanup,     METH_VARA
     {"send_http_header",     (PyCFunction) req_send_http_header,     METH_VARA
     {"write",                (PyCFunction) req_write,                METH_VARA
+    {"get_fd",               (PyCFunction) req_fd,                   METH_VARA
     { NULL, NULL } /* sentinel */
 };




From conrad at hep.caltech.edu  Sat Nov  9 14:37:02 2002
From: conrad at hep.caltech.edu (Conrad Steenberg)
Date: Fri Jan  9 21:59:44 2004
Subject: [mod_python] Interest in sendfile from mod_python?
In-Reply-To: <1036880222.1221.5.camel@192.168.1.100>
References: <1036783496.6448.491.camel@heppc22.hep.caltech.edu> 
	<20021109052035.GZ4761@netvista.mikebell.org> 
	<1036880222.1221.5.camel@192.168.1.100>
Message-ID: <1036881423.1188.21.camel@192.168.1.100>

Aarghh, take 2 on the patch:

--- src/requestobject.c.orig    Tue Jun  4 15:52:45 2002
+++ src/requestobject.c Tue Jun  4 11:15:49 2002
@@ -781,6 +781,27 @@

 }

+/**
+ ** request.get_fd(request self)
+ **
+ *      Returns the file descriptor to write output to
+ */
+
+static PyObject * req_fd(requestobject *self, PyObject *args)
+{
+    PyObject *fd;
+    long thefd;
+    thefd=(long)self->request_rec->connection->client->fd;
+    fd = PyInt_FromLong(thefd);
+    if (!fd) {
+       PyErr_SetString(PyExc_IOError, "Could not determine file descriptor.");
+       return NULL;
+    }
+
+
+    return fd;
+}
+
+
 static PyMethodDef requestobjectmethods[] = {
     {"add_common_vars",      (PyCFunction) req_add_common_vars,      METH_VARARGS},
     {"add_handler",          (PyCFunction) req_add_handler,          METH_VARARGS},
@@ -797,6 +818,7 @@
     {"register_cleanup",     (PyCFunction) req_register_cleanup,     METH_VARARGS},
     {"send_http_header",     (PyCFunction) req_send_http_header,     METH_VARARGS},
     {"write",                (PyCFunction) req_write,                METH_VARARGS},
+    {"get_fd",               (PyCFunction) req_fd,                   METH_VARARGS},
     { NULL, NULL } /* sentinel */
 };



On Sat, 2002-11-09 at 14:17, Conrad Steenberg wrote:
> Hi Mike
> 
> Have a look at sendfilemodule.c in
> http://cvs.sourceforge.net/cgi-bin/viewcvs.cgi/clarens/clarens/sendfile/
> 
> The patch for mod_python to get the filedescriptor to write to is below.
> 
> Cheers!
> 
> Conrad
> 
> On Fri, 2002-11-08 at 21:20, mike@mikebell.org wrote:
> > On Fri, Nov 08, 2002 at 11:24:56AM -0800, Conrad Steenberg wrote:
> > > So the question is, is anybody else interested in this? Either for me to
> > > contribute the mod_python patch and sendfile package, or for integration
> > > of these two parts into mod_pyhton itself?
> > 
> > I would absolutely be interested. Zero-copy from mod_python, yay. I have
> > in fact thought about this in the past but never got around to doing
> > anything about it.
> --- src/requestobject.c.orig    Tue Jun  4 15:52:45 2002
> +++ src/requestobject.c Tue Jun  4 11:15:49 2002
> @@ -781,6 +781,27 @@
> 
>  }
> 
> +/**
> + ** request.get_fd(request self)
> + **
> + *      Returns the file descriptor to write output to
> + */
> +
> +static PyObject * req_fd(requestobject *self, PyObject *args)
> +{
> +    PyObject *fd;
> +    long thefd;
> +    thefd=(long)self->request_rec->connection->client->fd;
> +    fd = PyInt_FromLong(thefd);
> +    if (!fd) {
> +       PyErr_SetString(PyExc_IOError, "Could not determine file descriptor.");
> +       return NULL;
> +    }
> +
> static PyMethodDef requestobjectmethods[] = {
>      {"add_common_vars",      (PyCFunction) req_add_common_vars,      METH_VARA
>      {"add_handler",          (PyCFunction) req_add_handler,          METH_VARA
> @@ -797,6 +818,7 @@
>      {"register_cleanup",     (PyCFunction) req_register_cleanup,     METH_VARA
>      {"send_http_header",     (PyCFunction) req_send_http_header,     METH_VARA
>      {"write",                (PyCFunction) req_write,                METH_VARA
> +    {"get_fd",               (PyCFunction) req_fd,                   METH_VARA
>      { NULL, NULL } /* sentinel */
>  };
> 
> 
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python



From laurie at tratt.net  Sun Nov 10 17:51:00 2002
From: laurie at tratt.net (Laurence Tratt)
Date: Fri Jan  9 21:59:44 2004
Subject: [mod_python] mod_python and OpenBSD
Message-ID: <20021110175100.A31721@purcell.dcs.kcl.ac.uk>

Hi all,

Has anyone managed to build mod_python-3.0.0-BETA4 under OpenBSD? I'm
running OpenBSD 3.2-current, have got Apache 2.0.43 but haven't actually
managed to build mp yet, and would be very interested to hear if anyone's
got this combination to play ball yet.

The problem I have is that mod_python.so itself isn't ever getting built.
Virtually every other filename extension after "mod_python." exists, but not
"so": the most likely culprit is libtool, a favoured target of bile in the
OpenBSD community, but I'm no expert on it (nor on the particular variant
that Apache ships in build/). The eventual result of not building the lib is
a dangling sym link from src/ to lib/ just to make things fun! If anybody's
interested in having a look at this, I can hook them up with an account on
an OpenBSD machine.


Whilst I'm here, I might as well tell you guys what I actually want mp to
do. If it's a Really Bad Idea, please feel free to tell me :) Essentially, I
want to have a filter which takes pages in a sort-of psuedo HTML format, and
then munges them into a full page before sending them on. I've prototyped it
in Apache 1.3 as a handler/cgi-script thing, and it works fine except that
you're limited by the fact that you can't post-process data from other
sources (eg I will probably need to munge PHP output too). So filters in
Apache 2.0 look like the way to go, and obviously I want it to run
efficiently hence my interest in mod_python. From what I can tell, at the
moment mp's filter support can't handle fiddling with HTTP headers which I
will need to do (my filter also having to deal with setting cookies), but
I'm unclear as to whether that's a fundamental problem, or whether it just
hasn't been coded up yet.

Thanks in advance for any help,


Laurie

From agenkin-lst-mod_python at thpoon.com  Sun Nov 10 12:52:44 2002
From: agenkin-lst-mod_python at thpoon.com (Arcady Genkin)
Date: Fri Jan  9 21:59:44 2004
Subject: [mod_python] online docs for mp version 3?
Message-ID: <86bs4xjor7.fsf@tea.thpoon.com>

Is there a copy of documentation for version 3.0 of mod_python online
somewhere?

Thanks.
-- 
Arcady Genkin

guilt is the cause of more disauders
than history's most obscene marorders                       (E.E. Cummings)

From agenkin-lst-mod_python at thpoon.com  Sun Nov 10 13:06:56 2002
From: agenkin-lst-mod_python at thpoon.com (Arcady Genkin)
Date: Fri Jan  9 21:59:44 2004
Subject: [mod_python] Default function for Publisher
Message-ID: <867kfljo3j.fsf@tea.thpoon.com>

I spent a few hours trying to figure out how to make the url
"http://foo" respond with a python handler in index.py.  In the end I
came up with the following:

   RewriteEngine on
   RewriteRule ^/*$ /index.py/main

which seems to work, but is a hack.  In the list archives I saw a few
threads that proposed introducing a default handler function for the
Publisher, but the impression I got was that the functionality still
is not implemented.

As a new user of mod_python, I'd like to pitch in that default
Publisher function would save me a lot of trouble and time, which I'd
rather have spent getting to know mod_python than learning how
mod_rewrite works.  It would be much cleaner to write:

  DirectoryIndex index.py
  PyPublisherDefaultFunction main

or some such.
-- 
Arcady Genkin

guilt is the cause of more disauders
than history's most obscene marorders                       (E.E. Cummings)

From agenkin-lst-mod_python at thpoon.com  Sun Nov 10 13:25:45 2002
From: agenkin-lst-mod_python at thpoon.com (Arcady Genkin)
Date: Fri Jan  9 21:59:44 2004
Subject: [mod_python] Apache children crashing with mod_python 3.0 beta4
Message-ID: <863cq9jn86.fsf@tea.thpoon.com>

I'm trying out mod_python-3 beta 4 on FreeBSD 4.7.  Python is version
2.2.2 compiled from ports without threading support.  Apache is 2.0.43
compiled from ports with threads enabled, running with default
configuration (apart from mod_python customizations); mod_python is
the only non-stock module loaded into it.

Even though mod_python seems to be working fine, I am seeing the
following in the apache's error logs:

Fatal Python error: PyThreadState_Delete: tstate is still current
Fatal Python error: PyThreadState_Delete: tstate is still current
Fatal Python error: PyThreadState_Delete: tstate is still current
Fatal Python error: PyThreadState_Delete: tstate is still current
[Sun Nov 10 12:29:32 2002] [notice] child pid 27272 exit signal Abort trap (6)
[Sun Nov 10 12:29:32 2002] [notice] child pid 27267 exit signal Abort trap (6)
[Sun Nov 10 12:29:32 2002] [notice] child pid 27266 exit signal Abort trap (6)
[Sun Nov 10 12:29:32 2002] [notice] child pid 27265 exit signal Abort trap (6)

How likely is this due to a misconfiguration?  Any pointers?

Many thanks,
-- 
Arcady Genkin

guilt is the cause of more disauders
than history's most obscene marorders                       (E.E. Cummings)

From agenkin-lst-mod_python at thpoon.com  Sun Nov 10 13:28:43 2002
From: agenkin-lst-mod_python at thpoon.com (Arcady Genkin)
Date: Fri Jan  9 21:59:44 2004
Subject: [mod_python] online docs for mp version 3?
References: <86bs4xjor7.fsf@tea.thpoon.com>
Message-ID: <86vg35i8is.fsf@tea.thpoon.com>

Arcady Genkin <agenkin-lst-mod_python@thpoon.com> writes:

> Is there a copy of documentation for version 3.0 of mod_python online
> somewhere?

Never mind.  I now see that the distribution tarball includes
generated HTML documenation (I thought that only the LaTeX sources
were included).  Sorry for the noise.
-- 
Arcady Genkin

guilt is the cause of more disauders
than history's most obscene marorders                       (E.E. Cummings)

From grisha at modpython.org  Sun Nov 10 14:30:19 2002
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:59:44 2004
Subject: [mod_python] Default function for Publisher
In-Reply-To: <867kfljo3j.fsf@tea.thpoon.com>
Message-ID: <20021110142943.T3802-100000@eden.ispol.com>

in MP 3.0 it defaults "index"

Grisha

On Sun, 10 Nov 2002, Arcady Genkin wrote:

> I spent a few hours trying to figure out how to make the url
> "http://foo" respond with a python handler in index.py.  In the end I
> came up with the following:
>
>    RewriteEngine on
>    RewriteRule ^/*$ /index.py/main
>
> which seems to work, but is a hack.  In the list archives I saw a few
> threads that proposed introducing a default handler function for the
> Publisher, but the impression I got was that the functionality still
> is not implemented.
>
> As a new user of mod_python, I'd like to pitch in that default
> Publisher function would save me a lot of trouble and time, which I'd
> rather have spent getting to know mod_python than learning how
> mod_rewrite works.  It would be much cleaner to write:
>
>   DirectoryIndex index.py
>   PyPublisherDefaultFunction main
>
> or some such.
> --
> Arcady Genkin
>
> guilt is the cause of more disauders
> than history's most obscene marorders                       (E.E. Cummings)
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
>


From grisha at modpython.org  Sun Nov 10 14:33:11 2002
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:59:44 2004
Subject: [mod_python] Apache children crashing with mod_python 3.0 beta4
In-Reply-To: <863cq9jn86.fsf@tea.thpoon.com>
Message-ID: <20021110143055.H3802-100000@eden.ispol.com>

See the README file. On FreeBSD you need to have threads enabled in both
Python and Apache. The default Python port will have threads enabled, and
to make Apache thread-enabled, you need --enable-threads in the Makefile.

On Sun, 10 Nov 2002, Arcady Genkin wrote:

> I'm trying out mod_python-3 beta 4 on FreeBSD 4.7.  Python is version
> 2.2.2 compiled from ports without threading support.  Apache is 2.0.43
> compiled from ports with threads enabled, running with default
> configuration (apart from mod_python customizations); mod_python is
> the only non-stock module loaded into it.
>
> Even though mod_python seems to be working fine, I am seeing the
> following in the apache's error logs:
>
> Fatal Python error: PyThreadState_Delete: tstate is still current
> Fatal Python error: PyThreadState_Delete: tstate is still current
> Fatal Python error: PyThreadState_Delete: tstate is still current
> Fatal Python error: PyThreadState_Delete: tstate is still current
> [Sun Nov 10 12:29:32 2002] [notice] child pid 27272 exit signal Abort trap (6)
> [Sun Nov 10 12:29:32 2002] [notice] child pid 27267 exit signal Abort trap (6)
> [Sun Nov 10 12:29:32 2002] [notice] child pid 27266 exit signal Abort trap (6)
> [Sun Nov 10 12:29:32 2002] [notice] child pid 27265 exit signal Abort trap (6)
>
> How likely is this due to a misconfiguration?  Any pointers?
>
> Many thanks,
> --
> Arcady Genkin
>
> guilt is the cause of more disauders
> than history's most obscene marorders                       (E.E. Cummings)
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
>


From agenkin-lst-mod_python at thpoon.com  Sun Nov 10 16:12:59 2002
From: agenkin-lst-mod_python at thpoon.com (Arcady Genkin)
Date: Fri Jan  9 21:59:44 2004
Subject: [mod_python] Apache children crashing with mod_python 3.0 beta4
In-Reply-To: <20021110143055.H3802-100000@eden.ispol.com> ("Gregory's
 message of "Sun, 10 Nov 2002 14:33:11 -0500 (EST)")
References: <20021110143055.H3802-100000@eden.ispol.com>
Message-ID: <uoof8x5dt0.fsf@bashful.cdf.toronto.edu>

"Gregory (Grisha) Trubetskoy" <grisha@modpython.org> writes:

> See the README file. On FreeBSD you need to have threads enabled in both
> Python and Apache. 

The README file only tells to compile Apache with threads, which I
read and did.  Perhaps you need to add the bit about Python with
threads enabled.

Thanks for your reply!
-- 
Arcady Genkin : CDF Systems Administrator
http://www.cdf.toronto.edu/~agenkin/contact.html

guilt is the cause of more disauders
than history's most obscene marorders (E.E. Cummings)

From agenkin-lst-mod_python at thpoon.com  Sun Nov 10 16:36:38 2002
From: agenkin-lst-mod_python at thpoon.com (Arcady Genkin)
Date: Fri Jan  9 21:59:44 2004
Subject: [mod_python] Default function for Publisher in 3.0
In-Reply-To: <20021110142943.T3802-100000@eden.ispol.com> ("Gregory's
 message of "Sun, 10 Nov 2002 14:30:19 -0500 (EST)")
References: <20021110142943.T3802-100000@eden.ispol.com>
Message-ID: <uoheep5cpl.fsf@bashful.cdf.toronto.edu>

"Gregory (Grisha) Trubetskoy" <grisha@modpython.org> writes:

> in MP 3.0 it defaults "index"

Great!  However, this does not seem to work with
"DirectoryIndex index.py".
I get the following when accessing the url http://myhost/ :

,----
| Mod_python error: "PythonHandler mod_python.publisher"
| 
| Traceback (most recent call last):
| 
|   File "/usr/local/lib/python2.2/site-packages/mod_python/apache.py",
|   line 335, in HandlerDispatch
|     result = object(req)
| 
|   File "/usr/local/lib/python2.2/site-packages/mod_python/publisher.py",
|   line 86, in handler
|     func_path = req.path_info[1:] # skip first /
| 
| TypeError: unsubscriptable object
`----

Accessing http://myhost/index.py works fine.
-- 
Arcady Genkin : CDF Systems Administrator
http://www.cdf.toronto.edu/~agenkin/contact.html

guilt is the cause of more disauders
than history's most obscene marorders (E.E. Cummings)

From agenkin-lst-mod_python at thpoon.com  Sun Nov 10 16:42:55 2002
From: agenkin-lst-mod_python at thpoon.com (Arcady Genkin)
Date: Fri Jan  9 21:59:44 2004
Subject: [mod_python] Documentation bug for 3.0
Message-ID: <uod6pd5cf4.fsf@bashful.cdf.toronto.edu>

In the html documentation, distributed with the 3.0 tarball, Section
6.1.1 (introduction to publisher handler) suggests the following
configuration in httpd.conf:

<Directory /some/path}
    SetHandler python-program 
    PythonHandler mod_python.publisher
</Directory>

But this results in a syntax error:

   AddHandler requires at least two arguments, a handler name followed
   by one or more file extensions

Seems that ".py" is missing at the end of SetHandler directive.
-- 
Arcady Genkin : CDF Systems Administrator
http://www.cdf.toronto.edu/~agenkin/contact.html

guilt is the cause of more disauders
than history's most obscene marorders (E.E. Cummings)

From agenkin-lst-mod_python at thpoon.com  Sun Nov 10 16:56:52 2002
From: agenkin-lst-mod_python at thpoon.com (Arcady Genkin)
Date: Fri Jan  9 21:59:44 2004
Subject: [mod_python] Documentation bug for 3.0
In-Reply-To: <uod6pd5cf4.fsf@bashful.cdf.toronto.edu> (Arcady Genkin's
 message of "Sun, 10 Nov 2002 16:42:55 -0500")
References: <uod6pd5cf4.fsf@bashful.cdf.toronto.edu>
Message-ID: <uo7kfl5brv.fsf@bashful.cdf.toronto.edu>

Errm...  I must get the pointy hat of the day for being so
inattentive.  Of course, the docs say "SetHandler", while I have
"AddHandler" in the config file.

Many appologies.

Arcady Genkin <agenkin-lst-mod_python@thpoon.com> writes:

> In the html documentation, distributed with the 3.0 tarball, Section
> 6.1.1 (introduction to publisher handler) suggests the following
> configuration in httpd.conf:
>
> <Directory /some/path}
>     SetHandler python-program 
>     PythonHandler mod_python.publisher
> </Directory>
>
> But this results in a syntax error:
>
>    AddHandler requires at least two arguments, a handler name followed
>    by one or more file extensions
>
> Seems that ".py" is missing at the end of SetHandler directive.

-- 
Arcady Genkin : CDF Systems Administrator
http://www.cdf.toronto.edu/~agenkin/contact.html

guilt is the cause of more disauders
than history's most obscene marorders (E.E. Cummings)

From agenkin-lst-mod_python at thpoon.com  Sun Nov 10 17:11:26 2002
From: agenkin-lst-mod_python at thpoon.com (Arcady Genkin)
Date: Fri Jan  9 21:59:45 2004
Subject: [mod_python] Default function for Publisher in 3.0
References: <20021110142943.T3802-100000@eden.ispol.com>
	<uoheep5cpl.fsf@bashful.cdf.toronto.edu>
Message-ID: <uowunl3wj5.fsf@bashful.cdf.toronto.edu>

Arcady Genkin <agenkin-lst-mod_python@thpoon.com> writes:

> this does not seem to work with "DirectoryIndex index.py".

An update: I had a problem with configuration (using AddHandler
directive instead of the SetHandler, as recommended in the docs).
However, still can't use index.py implicitely.  Now the backtrace
looks this way:

,----
| Mod_python error: "PythonHandler mod_python.publisher"
| 
| Traceback (most recent call last):
| 
|   File "/usr/local/lib/python2.2/site-packages/mod_python/apache.py",
|   line 335, in HandlerDispatch
|     result = object(req)
| 
|   File "/usr/local/lib/python2.2/site-packages/mod_python/publisher.py",
|   line 145, in handler
|     module = apache.import_module(module_name, req.get_config(), [path])
| 
|   File "/usr/local/lib/python2.2/site-packages/mod_python/apache.py",
|   line 499, in import_module
|     f, p, d = imp.find_module(parts[i], path)
| 
| ImportError: No module named 
`----

The httpd.conf contains the following configuration:

,----
| <Directory "/var/www/data">
|    PythonDebug On
|    SetHandler python-program
|    PythonHandler mod_python.publisher
|    DirectoryIndex index.py
| </Directory>
`----

Something tells me that I am still doing something wrong.  I tried
setting DIrectoryIndex to "index" instead of "index.py", but this
still did not work.  Any ideas?

Many thanks,
-- 
Arcady Genkin : CDF Systems Administrator
http://www.cdf.toronto.edu/~agenkin/contact.html

guilt is the cause of more disauders
than history's most obscene marorders (E.E. Cummings)

From gstein at lyra.org  Sun Nov 10 17:05:40 2002
From: gstein at lyra.org (Greg Stein)
Date: Fri Jan  9 21:59:45 2004
Subject: [mod_python] Interest in sendfile from mod_python?
In-Reply-To: <1036783496.6448.491.camel@heppc22.hep.caltech.edu>; from conrad@hep.caltech.edu on Fri, Nov 08, 2002 at 11:24:56AM -0800
References: <1036783496.6448.491.camel@heppc22.hep.caltech.edu>
Message-ID: <20021110170540.C4640@lyra.org>

On Fri, Nov 08, 2002 at 11:24:56AM -0800, Conrad Steenberg wrote:
>...
> The Linux and FreeBSD (I think) sendfile calls make this very easy and
> efficient in Apache itself, but there is no way to control this from
> within mod_python as far as I can see.

In Apache 2.0, the Python code needs to construct a FILE bucket and shove
that into the output filter stack. Assuming that it doesn't get processed by
mod_includes or somesuch on the way through the filters, then it will hit
the network output filter and be sendfile'd.

> My solution was to build a Python sendfile module (using code from the
> Medusa server, under the Python license), and create a patch for
> mod_python to get the request file-descriptor to pass to the sendfile
> call.

The file descriptor is private info. Modules should never access it.


All that said: I'm not sure if mod_python allows you to construct buckets
right now. Grisha could answer that in a jiffy...

Cheers,
-g

-- 
Greg Stein, http://www.lyra.org/

From gstein at lyra.org  Sun Nov 10 17:07:39 2002
From: gstein at lyra.org (Greg Stein)
Date: Fri Jan  9 21:59:45 2004
Subject: [mod_python] Apache children crashing with mod_python 3.0 beta4
In-Reply-To: <20021110143055.H3802-100000@eden.ispol.com>; from grisha@modpython.org on Sun, Nov 10, 2002 at 02:33:11PM -0500
References: <863cq9jn86.fsf@tea.thpoon.com> <20021110143055.H3802-100000@eden.ispol.com>
Message-ID: <20021110170739.D4640@lyra.org>

Also make sure that Apache is configured to use the "prefork" MPM. The
thread-based MPMs don't work in FreeBSD because of its broken sendfile
implementation (it breaks in threaded environments; this has been fixed in
very recent BSDs... not sure which).

Cheers,
-g

On Sun, Nov 10, 2002 at 02:33:11PM -0500, Gregory (Grisha) Trubetskoy wrote:
> 
> See the README file. On FreeBSD you need to have threads enabled in both
> Python and Apache. The default Python port will have threads enabled, and
> to make Apache thread-enabled, you need --enable-threads in the Makefile.
> 
> On Sun, 10 Nov 2002, Arcady Genkin wrote:
> 
> > I'm trying out mod_python-3 beta 4 on FreeBSD 4.7.  Python is version
> > 2.2.2 compiled from ports without threading support.  Apache is 2.0.43
> > compiled from ports with threads enabled, running with default
> > configuration (apart from mod_python customizations); mod_python is
> > the only non-stock module loaded into it.
> >
> > Even though mod_python seems to be working fine, I am seeing the
> > following in the apache's error logs:
> >
> > Fatal Python error: PyThreadState_Delete: tstate is still current
> > Fatal Python error: PyThreadState_Delete: tstate is still current
> > Fatal Python error: PyThreadState_Delete: tstate is still current
> > Fatal Python error: PyThreadState_Delete: tstate is still current
> > [Sun Nov 10 12:29:32 2002] [notice] child pid 27272 exit signal Abort trap (6)
> > [Sun Nov 10 12:29:32 2002] [notice] child pid 27267 exit signal Abort trap (6)
> > [Sun Nov 10 12:29:32 2002] [notice] child pid 27266 exit signal Abort trap (6)
> > [Sun Nov 10 12:29:32 2002] [notice] child pid 27265 exit signal Abort trap (6)
> >
> > How likely is this due to a misconfiguration?  Any pointers?
> >
> > Many thanks,
> > --
> > Arcady Genkin
> >
> > guilt is the cause of more disauders
> > than history's most obscene marorders                       (E.E. Cummings)
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://www.modpython.org/mailman/listinfo/mod_python
> >
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python

-- 
Greg Stein, http://www.lyra.org/

From neel at mediapulse.com  Mon Nov 11 13:15:19 2002
From: neel at mediapulse.com (Michael C. Neel)
Date: Fri Jan  9 21:59:45 2004
Subject: [mod_python] Default function for Publisher in 3.0
Message-ID: <C0FC22C08B82074A88B50061764157772C647F@johnson.mediapulse.net>

This is an untested guess, but I think apache needs to see "index.py" in
the document root before it will send the client a redirect to
spam.com/index.py - try doing a touch index.py in the doc root and see
what happens...

Mike

> -----Original Message-----
> From: Arcady Genkin [mailto:agenkin-lst-mod_python@thpoon.com] 
> Sent: Sunday, November 10, 2002 5:11 PM
> To: mod_python@modpython.org
> Subject: Re: [mod_python] Default function for Publisher in 3.0
> 
> 
> Arcady Genkin <agenkin-lst-mod_python@thpoon.com> writes:
> 
> > this does not seem to work with "DirectoryIndex index.py".
> 
> An update: I had a problem with configuration (using AddHandler
> directive instead of the SetHandler, as recommended in the docs).
> However, still can't use index.py implicitely.  Now the backtrace
> looks this way:
> 
> ,----
> | Mod_python error: "PythonHandler mod_python.publisher"
> | 
> | Traceback (most recent call last):
> | 
> |   File 
> "/usr/local/lib/python2.2/site-packages/mod_python/apache.py",
> |   line 335, in HandlerDispatch
> |     result = object(req)
> | 
> |   File 
> "/usr/local/lib/python2.2/site-packages/mod_python/publisher.py",
> |   line 145, in handler
> |     module = apache.import_module(module_name, 
> req.get_config(), [path])
> | 
> |   File 
> "/usr/local/lib/python2.2/site-packages/mod_python/apache.py",
> |   line 499, in import_module
> |     f, p, d = imp.find_module(parts[i], path)
> | 
> | ImportError: No module named 
> `----
> 
> The httpd.conf contains the following configuration:
> 
> ,----
> | <Directory "/var/www/data">
> |    PythonDebug On
> |    SetHandler python-program
> |    PythonHandler mod_python.publisher
> |    DirectoryIndex index.py
> | </Directory>
> `----
> 
> Something tells me that I am still doing something wrong.  I tried
> setting DIrectoryIndex to "index" instead of "index.py", but this
> still did not work.  Any ideas?
> 
> Many thanks,
> -- 
> Arcady Genkin : CDF Systems Administrator
> http://www.cdf.toronto.edu/~agenkin/contact.html
> 
> guilt is the cause of more disauders
> than history's most obscene marorders (E.E. Cummings)
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 


From jgramlich at piocon.com  Mon Nov 11 12:32:27 2002
From: jgramlich at piocon.com (Joshua Gramlich)
Date: Fri Jan  9 21:59:45 2004
Subject: [mod_python] Installation Issues - Apache2 Python2.2 RedHat
Message-ID: <021b01c289b0$b01c76a0$cb3ac341@ginworks.com>

Howdy.  I've looked through the archives and couldn't find anything in particularly specific to my issue, so here goes:

I'm trying to install mod_python with thread support (no reason, just because).  I made the jump up to Apache2, and it is working fine.  I've also got Python 2.2.1 installed.  I'm using RedHat 7.2 as my platform, and python2 is installed via source RPM(./configure'd, make'd, and make install'd).  Apache, I compiled from source.

When I configure mod python I do so like this:

./configure --with-apxs=/usr/local/apache/bin/apxs --with-python=/usr/src/redhat/SOURCES/Python-2.2.1

...and I get the following (partial):

hecking for Apache include directory... -I/usr/local/httpd-2.0.43/include
checking for --with-apache... no
configure: warning: **** No apache sources specified, static compilation will not be available.
configure: warning: **** You can use --with-apache to specify where your Apache sources are.
checking for --with-python... /usr/src/redhat/SOURCES/Python-2.2.1
checking for python... (cached) /usr/bin/python
checking Python version... 1.5
checking whether Python is compiled with thread support... yes

  ****** WARNING ******
  Python is compiled with thread support. Apache 1.3 does not use threads.
  On some systems this will cause problems during compilation, on others
  it may result in unpredictable behaviour of your Apache server. Yet on
  others it will work just fine. The recommended approach is to compile
  Python without thread support in a separate location and specify it with
  --with-python option to this ./configure script.

checking Python install prefix... /usr
checking what libraries Python was linked with... grep: /usr/src/redhat/SOURCES/Python-2.2.1/Modules/Makefile: No such file or directory
grep: /usr/src/redhat/SOURCES/Python-2.2.1/Modules/Makefile: No such file or directory
/usr/src/redhat/SOURCES/Python-2.2.1/libpython1.5.a
checking linker flags used to link Python...  -Xlinker -export-dynamic



...So anyways, I keep seeing "checking Python version...1.5" and I'm wondering if this is a problem.  Reason being, when I type "make dso" after configuring mod_python, I get this:

make dso
make[1]: Entering directory `/usr/src/mod_python-2.7.8/src'
gcc  -I/usr/src/mod_python-2.7.8/src/include -I/usr/local/httpd-2.0.43/include -I/usr/src/redhat/SOURCES/Python-2.2.1 -I/usr/src/redhat/SOURCES/Python-2.2.1/Include    -c -o mod_python.o mod_python.c
In file included from mod_python.c:54:
/usr/src/mod_python-2.7.8/src/include/mod_python.h:93: parse error before `*'
/usr/src/mod_python-2.7.8/src/include/mod_python.h:93: warning: data definition has no type or storage class
/usr/src/mod_python-2.7.8/src/include/mod_python.h:96: parse error before `python_module'
/usr/src/mod_python-2.7.8/src/include/mod_python.h:96: warning: data definition has no type or storage class
In file included from /usr/src/mod_python-2.7.8/src/include/mod_python.h:99,
                 from mod_python.c:54:
/usr/src/mod_python-2.7.8/src/include/util.h:57: parse error before `*'
In file included from /usr/src/mod_python-2.7.8/src/include/mod_python.h:100,
                 from mod_python.c:54:
/usr/src/mod_python-2.7.8/src/include/tableobject.h:69blablahblahblah....



Anyone have any ideas as to why this isn't working?


Josh
Chicago, IL
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mailman.modpython.org/pipermail/mod_python/attachments/20021111/3e9b4dca/attachment-0002.htm
From agenkin-lst-mod_python at thpoon.com  Mon Nov 11 14:04:59 2002
From: agenkin-lst-mod_python at thpoon.com (Arcady Genkin)
Date: Fri Jan  9 21:59:45 2004
Subject: [mod_python] Default function for Publisher in 3.0
In-Reply-To: <C0FC22C08B82074A88B50061764157772C647F@johnson.mediapulse.net> ("Michael
 C. Neel"'s message of "Mon, 11 Nov 2002 13:15:19 -0500")
References: <C0FC22C08B82074A88B50061764157772C647F@johnson.mediapulse.net>
Message-ID: <uo7kfk3p2c.fsf@bashful.cdf.toronto.edu>

"Michael C. Neel" <neel@mediapulse.com> writes:

> This is an untested guess, but I think apache needs to see "index.py" in
> the document root before it will send the client a redirect to
> spam.com/index.py - try doing a touch index.py in the doc root and see
> what happens...

The document root is '/var/www/data', and I do have a script
'/var/www/data/index.py', which, in turn, has an 'index' function.
Connecting to http://spam.com/index/index and http://spam.com/index
works fine (i.e. the default function is working properly), but for
http://spam.com/ I get the backtrace, included in my previous message.

Any more ideas?
-- 
Arcady Genkin : CDF Systems Administrator
http://www.cdf.toronto.edu/~agenkin/contact.html

guilt is the cause of more disauders
than history's most obscene marorders (E.E. Cummings)

From grisha at apache.org  Mon Nov 11 15:04:58 2002
From: grisha at apache.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:59:45 2004
Subject: [mod_python] Default function for Publisher in 3.0
In-Reply-To: <C0FC22C08B82074A88B50061764157772C647F@johnson.mediapulse.net>
Message-ID: <20021111143821.W17409-100000@eden.ispol.com>

I looked at the mod_dir.c code, it looks like if you use SetHandler,
DirectoryIndex has no effect, but if you use AddHandler, DirectoryIndex
does apply, but the problem is that req.path_info in this case ends up
bing None (or NULL) as opposed to a blank string, thus the
"Unsubscriptable Object" error.

To get around this, try this patch:

--- publishre.py.old    Mon Nov 11 14:51:44 2002
+++ publisher.py        Mon Nov 11 14:50:13 2002
@@ -83,10 +83,12 @@
     if req.method not in ["GET", "POST"]:
         raise apache.SERVER_RETURN, apache.HTTP_METHOD_NOT_ALLOWED

-    func_path = req.path_info[1:] # skip first /
-    func_path = func_path.replace("/", ".")
-    if func_path[-1:] == ".":
-        func_path = func_path[:-1]
+    func_path = ""
+    if req.path_info:
+        func_path = req.path_info[1:] # skip first /
+        func_path = func_path.replace("/", ".")
+        if func_path[-1:] == ".":
+            func_path = func_path[:-1]

     # default to 'index' if no path_info was given
     if not func_path:


An imperfection with using AddHandler is that you end up with the ".py" in
your URL's.

To be able to use the best of both worlds, i.e. SetHandler and a default
module, the Publisher needs to provide its own default (since
DirectoryIndex has no effect). Here is another patch for this. Most likely
these will be in the release version (perhaps slightly modified). This
will tell the publisher to default to "index.py" is no file is specified.

--- publishre.py.old    Mon Nov 11 14:51:44 2002
+++ publisher.py        Mon Nov 11 14:50:13 2002
@@ -126,6 +128,9 @@

     ## import the script
     path, module_name =  os.path.split(req.filename)
+    if not module_name:
+        module_name = "index"

     # get rid of the suffix
     #   explanation: Suffixes that will get stripped off


Grisha

On Mon, 11 Nov 2002, Michael C. Neel wrote:

> This is an untested guess, but I think apache needs to see "index.py" in
> the document root before it will send the client a redirect to
> spam.com/index.py - try doing a touch index.py in the doc root and see
> what happens...
>
> Mike
>
> > -----Original Message-----
> > From: Arcady Genkin [mailto:agenkin-lst-mod_python@thpoon.com]
> > Sent: Sunday, November 10, 2002 5:11 PM
> > To: mod_python@modpython.org
> > Subject: Re: [mod_python] Default function for Publisher in 3.0
> >
> >
> > Arcady Genkin <agenkin-lst-mod_python@thpoon.com> writes:
> >
> > > this does not seem to work with "DirectoryIndex index.py".
> >
> > An update: I had a problem with configuration (using AddHandler
> > directive instead of the SetHandler, as recommended in the docs).
> > However, still can't use index.py implicitely.  Now the backtrace
> > looks this way:
> >
> > ,----
> > | Mod_python error: "PythonHandler mod_python.publisher"
> > |
> > | Traceback (most recent call last):
> > |
> > |   File
> > "/usr/local/lib/python2.2/site-packages/mod_python/apache.py",
> > |   line 335, in HandlerDispatch
> > |     result = object(req)
> > |
> > |   File
> > "/usr/local/lib/python2.2/site-packages/mod_python/publisher.py",
> > |   line 145, in handler
> > |     module = apache.import_module(module_name,
> > req.get_config(), [path])
> > |
> > |   File
> > "/usr/local/lib/python2.2/site-packages/mod_python/apache.py",
> > |   line 499, in import_module
> > |     f, p, d = imp.find_module(parts[i], path)
> > |
> > | ImportError: No module named
> > `----
> >
> > The httpd.conf contains the following configuration:
> >
> > ,----
> > | <Directory "/var/www/data">
> > |    PythonDebug On
> > |    SetHandler python-program
> > |    PythonHandler mod_python.publisher
> > |    DirectoryIndex index.py
> > | </Directory>
> > `----
> >
> > Something tells me that I am still doing something wrong.  I tried
> > setting DIrectoryIndex to "index" instead of "index.py", but this
> > still did not work.  Any ideas?
> >
> > Many thanks,
> > --
> > Arcady Genkin : CDF Systems Administrator
> > http://www.cdf.toronto.edu/~agenkin/contact.html
> >
> > guilt is the cause of more disauders
> > than history's most obscene marorders (E.E. Cummings)
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://www.modpython.org/mailman/listinfo/mod_python
> >
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
>



From grisha at modpython.org  Mon Nov 11 16:51:14 2002
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:59:45 2004
Subject: [mod_python] Installation Issues - Apache2 Python2.2 RedHat
In-Reply-To: <021b01c289b0$b01c76a0$cb3ac341@ginworks.com>
Message-ID: <20021111164814.J22386-100000@eden.ispol.com>

Josh -

If you're using Apache 2, you need mod_python version 3.0, currently in
beta. Mod_python 2.7.8 won't work with apache 2.

But with respect to your specific question - rm config.cache and re-run
configure. (It will report the Python version correctly, but you're still
going to have the above-mentioned apache2 problem).

Grisha

On Mon, 11 Nov 2002, Joshua Gramlich wrote:

> Howdy.  I've looked through the archives and couldn't find anything in particularly specific to my issue, so here goes:
>
> I'm trying to install mod_python with thread support (no reason, just because).  I made the jump up to Apache2, and it is working fine.  I've also got Python 2.2.1 installed.  I'm using RedHat 7.2 as my platform, and python2 is installed via source RPM(./configure'd, make'd, and make install'd).  Apache, I compiled from source.
>
> When I configure mod python I do so like this:
>
> ./configure --with-apxs=/usr/local/apache/bin/apxs --with-python=/usr/src/redhat/SOURCES/Python-2.2.1
>
> ...and I get the following (partial):
>
> hecking for Apache include directory... -I/usr/local/httpd-2.0.43/include
> checking for --with-apache... no
> configure: warning: **** No apache sources specified, static compilation will not be available.
> configure: warning: **** You can use --with-apache to specify where your Apache sources are.
> checking for --with-python... /usr/src/redhat/SOURCES/Python-2.2.1
> checking for python... (cached) /usr/bin/python
> checking Python version... 1.5
> checking whether Python is compiled with thread support... yes
>
>   ****** WARNING ******
>   Python is compiled with thread support. Apache 1.3 does not use threads.
>   On some systems this will cause problems during compilation, on others
>   it may result in unpredictable behaviour of your Apache server. Yet on
>   others it will work just fine. The recommended approach is to compile
>   Python without thread support in a separate location and specify it with
>   --with-python option to this ./configure script.
>
> checking Python install prefix... /usr
> checking what libraries Python was linked with... grep: /usr/src/redhat/SOURCES/Python-2.2.1/Modules/Makefile: No such file or directory
> grep: /usr/src/redhat/SOURCES/Python-2.2.1/Modules/Makefile: No such file or directory
> /usr/src/redhat/SOURCES/Python-2.2.1/libpython1.5.a
> checking linker flags used to link Python...  -Xlinker -export-dynamic
>
>
>
> ...So anyways, I keep seeing "checking Python version...1.5" and I'm wondering if this is a problem.  Reason being, when I type "make dso" after configuring mod_python, I get this:
>
> make dso
> make[1]: Entering directory `/usr/src/mod_python-2.7.8/src'
> gcc  -I/usr/src/mod_python-2.7.8/src/include -I/usr/local/httpd-2.0.43/include -I/usr/src/redhat/SOURCES/Python-2.2.1 -I/usr/src/redhat/SOURCES/Python-2.2.1/Include    -c -o mod_python.o mod_python.c
> In file included from mod_python.c:54:
> /usr/src/mod_python-2.7.8/src/include/mod_python.h:93: parse error before `*'
> /usr/src/mod_python-2.7.8/src/include/mod_python.h:93: warning: data definition has no type or storage class
> /usr/src/mod_python-2.7.8/src/include/mod_python.h:96: parse error before `python_module'
> /usr/src/mod_python-2.7.8/src/include/mod_python.h:96: warning: data definition has no type or storage class
> In file included from /usr/src/mod_python-2.7.8/src/include/mod_python.h:99,
>                  from mod_python.c:54:
> /usr/src/mod_python-2.7.8/src/include/util.h:57: parse error before `*'
> In file included from /usr/src/mod_python-2.7.8/src/include/mod_python.h:100,
>                  from mod_python.c:54:
> /usr/src/mod_python-2.7.8/src/include/tableobject.h:69blablahblahblah....
>
>
>
> Anyone have any ideas as to why this isn't working?
>
>
> Josh
> Chicago, IL


From jgramlich at piocon.com  Mon Nov 11 15:55:52 2002
From: jgramlich at piocon.com (Joshua Gramlich)
Date: Fri Jan  9 21:59:45 2004
Subject: [mod_python] Installation Issues - Apache2 Python2.2 RedHat
References: <20021111164814.J22386-100000@eden.ispol.com>
Message-ID: <024d01c289cd$1cf27d30$cb3ac341@ginworks.com>

I've gone and switched back to apache 1.3 for the time being.  If I get that
to work(which it looks like I will), I'll prolly consider using mod_python 3
instead, as I'm having to retool the python installs on my machine and it's
a major pain.  Plus, for whatever reason, and perhaps it just boils down to
esthetics, I'd rather have thread support built in...

Thanks,
Josh


----- Original Message -----
From: "Gregory (Grisha) Trubetskoy" <grisha@modpython.org>
To: "Joshua Gramlich" <jgramlich@piocon.com>
Cc: <mod_python@modpython.org>
Sent: Monday, November 11, 2002 3:51 PM
Subject: Re: [mod_python] Installation Issues - Apache2 Python2.2 RedHat


>
> Josh -
>
> If you're using Apache 2, you need mod_python version 3.0, currently in
> beta. Mod_python 2.7.8 won't work with apache 2.
>
> But with respect to your specific question - rm config.cache and re-run
> configure. (It will report the Python version correctly, but you're still
> going to have the above-mentioned apache2 problem).
>
> Grisha
>
> On Mon, 11 Nov 2002, Joshua Gramlich wrote:
>
> > Howdy.  I've looked through the archives and couldn't find anything in
particularly specific to my issue, so here goes:
> >
> > I'm trying to install mod_python with thread support (no reason, just
because).  I made the jump up to Apache2, and it is working fine.  I've also
got Python 2.2.1 installed.  I'm using RedHat 7.2 as my platform, and
python2 is installed via source RPM(./configure'd, make'd, and make
install'd).  Apache, I compiled from source.
> >
> > When I configure mod python I do so like this:
> >
> >
./configure --with-apxs=/usr/local/apache/bin/apxs --with-python=/usr/src/re
dhat/SOURCES/Python-2.2.1
> >
> > ...and I get the following (partial):
> >
> > hecking for Apache include
directory... -I/usr/local/httpd-2.0.43/include
> > checking for --with-apache... no
> > configure: warning: **** No apache sources specified, static compilation
will not be available.
> > configure: warning: **** You can use --with-apache to specify where your
Apache sources are.
> > checking for --with-python... /usr/src/redhat/SOURCES/Python-2.2.1
> > checking for python... (cached) /usr/bin/python
> > checking Python version... 1.5
> > checking whether Python is compiled with thread support... yes
> >
> >   ****** WARNING ******
> >   Python is compiled with thread support. Apache 1.3 does not use
threads.
> >   On some systems this will cause problems during compilation, on others
> >   it may result in unpredictable behaviour of your Apache server. Yet on
> >   others it will work just fine. The recommended approach is to compile
> >   Python without thread support in a separate location and specify it
with
> >   --with-python option to this ./configure script.
> >
> > checking Python install prefix... /usr
> > checking what libraries Python was linked with... grep:
/usr/src/redhat/SOURCES/Python-2.2.1/Modules/Makefile: No such file or
directory
> > grep: /usr/src/redhat/SOURCES/Python-2.2.1/Modules/Makefile: No such
file or directory
> > /usr/src/redhat/SOURCES/Python-2.2.1/libpython1.5.a
> > checking linker flags used to link Python...  -Xlinker -export-dynamic
> >
> >
> >
> > ...So anyways, I keep seeing "checking Python version...1.5" and I'm
wondering if this is a problem.  Reason being, when I type "make dso" after
configuring mod_python, I get this:
> >
> > make dso
> > make[1]: Entering directory `/usr/src/mod_python-2.7.8/src'
> >
gcc  -I/usr/src/mod_python-2.7.8/src/include -I/usr/local/httpd-2.0.43/inclu
de -I/usr/src/redhat/SOURCES/Python-2.2.1 -I/usr/src/redhat/SOURCES/Python-2
.2.1/Include    -c -o mod_python.o mod_python.c
> > In file included from mod_python.c:54:
> > /usr/src/mod_python-2.7.8/src/include/mod_python.h:93: parse error
before `*'
> > /usr/src/mod_python-2.7.8/src/include/mod_python.h:93: warning: data
definition has no type or storage class
> > /usr/src/mod_python-2.7.8/src/include/mod_python.h:96: parse error
before `python_module'
> > /usr/src/mod_python-2.7.8/src/include/mod_python.h:96: warning: data
definition has no type or storage class
> > In file included from
/usr/src/mod_python-2.7.8/src/include/mod_python.h:99,
> >                  from mod_python.c:54:
> > /usr/src/mod_python-2.7.8/src/include/util.h:57: parse error before `*'
> > In file included from
/usr/src/mod_python-2.7.8/src/include/mod_python.h:100,
> >                  from mod_python.c:54:
> >
/usr/src/mod_python-2.7.8/src/include/tableobject.h:69blablahblahblah....
> >
> >
> >
> > Anyone have any ideas as to why this isn't working?
> >
> >
> > Josh
> > Chicago, IL
>


From mark at camazotz.com  Mon Nov 11 17:47:38 2002
From: mark at camazotz.com (Mark Smith)
Date: Fri Jan  9 21:59:45 2004
Subject: [mod_python] building mod_python 3.0 on OS X
Message-ID: <93ECDF38-F5C7-11D6-9A20-00039364CE50@camazotz.com>

I'm trying to build mod_python 3.0b4 on OS X 10.2.  I've built Apache2
and it seems to work fine.  I've configured the mod_python build using
'--with-apxs' pointing to the version of apxs in the Apache2 bin 
directory.
The mod_python make finishes without errors, but when it's done,
src/mod_python.so is a soft link to src/.libs/mod_python.so, which
doesn't exist.  Any ideas on what (probably obvious) step I'm missing?

thanks,
Mark


From nathanr at nathanr.net  Tue Nov 12 13:15:02 2002
From: nathanr at nathanr.net (Nathan Robertson)
Date: Fri Jan  9 21:59:45 2004
Subject: [mod_python] 3.0.0 beta 4 - compile on Mac OS X
Message-ID: <3DD06426.6@nathanr.net>

Hi,

I've been fighting mod_python 3.0.0 beta 4 on Mac OS X 10.2.2 this 
morning. Compiling against apache 2.0.43, python 2.2.1. The filesystem 
is UFS, not HFS+.

Apache is configured as such:
./configure --with-mpm=threadpool --enable-so 
--prefix=/Volumes/UFS/local/httpd-2.0.43

and mod_python:
./configure --with-apxs=/Volumes/UFS/local/httpd-2.0.43/bin/apxs

make runs fine, make install breaks. Looked into it, and apxs doesn't 
create src/.libs/mod_python.so, only mod_python.lai (and the .la symlink 
to it). I tested this under Linux/PPC and Linux/i386 and both of them 
create the .so fine.

Has anyone else tried a similar setup on Mac OS X? Any successes?

Nathan.


From laurie at tratt.net  Tue Nov 12 09:19:40 2002
From: laurie at tratt.net (Laurence Tratt)
Date: Fri Jan  9 21:59:45 2004
Subject: [mod_python] 3.0.0 beta 4 - compile on Mac OS X
In-Reply-To: <3DD06426.6@nathanr.net>; from nathanr@nathanr.net on Tue, Nov 12, 2002 at 01:15:02PM +1100
References: <3DD06426.6@nathanr.net>
Message-ID: <20021112091940.B32177@purcell.dcs.kcl.ac.uk>

On Tue, Nov 12, 2002 at 01:15:02PM +1100, Nathan Robertson wrote:

[Apache and MacOS X]
> make runs fine, make install breaks. Looked into it, and apxs doesn't
> create src/.libs/mod_python.so, only mod_python.lai (and the .la symlink
> to it). I tested this under Linux/PPC and Linux/i386 and both of them
> create the .so fine.
>
> Has anyone else tried a similar setup on Mac OS X? Any successes?

Exactly the same thing happens under OpenBSD - I presume that part of our
shared BSD heritage is causing us problems. Interestingly, mod_python works
(well, builds) under FreeBSD; I have no idea about NetBSD though.

Best wishes,


Laurie

From nathanr at nathanr.net  Tue Nov 12 22:50:13 2002
From: nathanr at nathanr.net (Nathan Robertson)
Date: Fri Jan  9 21:59:45 2004
Subject: [mod_python] 3.0.0 beta 4 - compile on Mac OS X
References: <3DD06426.6@nathanr.net> <20021112091940.B32177@purcell.dcs.kcl.ac.uk>
Message-ID: <3DD0EAF5.8000007@nathanr.net>

Laurence Tratt wrote:
> On Tue, Nov 12, 2002 at 01:15:02PM +1100, Nathan Robertson wrote:
> 
> [Apache and MacOS X]
> 
>>make runs fine, make install breaks. Looked into it, and apxs doesn't
>>create src/.libs/mod_python.so, only mod_python.lai (and the .la symlink
>>to it). I tested this under Linux/PPC and Linux/i386 and both of them
>>create the .so fine.
>>
>>Has anyone else tried a similar setup on Mac OS X? Any successes?
> 
> Exactly the same thing happens under OpenBSD - I presume that part of our
> shared BSD heritage is causing us problems. Interestingly, mod_python works
> (well, builds) under FreeBSD; I have no idea about NetBSD though.

Yeah - I noted the FreeBSD note in the README, and did what it said, but 
that didn't make any difference.

Interesting that you got that on OpenBSD though. Plain wierd actually. 
Is that OpenBSD/i386 or on another platform (ppc?).

This could yet be an Apache bug in apxs, I guess. I haven't tried 
compiling any other modules against it.

Nathan.


From laurie at tratt.net  Tue Nov 12 11:51:18 2002
From: laurie at tratt.net (Laurence Tratt)
Date: Fri Jan  9 21:59:45 2004
Subject: [mod_python] 3.0.0 beta 4 - compile on Mac OS X
In-Reply-To: <3DD0EAF5.8000007@nathanr.net>; from nathanr@nathanr.net on Tue, Nov 12, 2002 at 10:50:13PM +1100
References: <3DD06426.6@nathanr.net> <20021112091940.B32177@purcell.dcs.kcl.ac.uk> <3DD0EAF5.8000007@nathanr.net>
Message-ID: <20021112115118.Q31512@purcell.dcs.kcl.ac.uk>

On Tue, Nov 12, 2002 at 10:50:13PM +1100, Nathan Robertson wrote:

[Apache and MacOS X]
>>> make runs fine, make install breaks. Looked into it, and apxs doesn't
>>> create src/.libs/mod_python.so, only mod_python.lai (and the .la symlink
>>> to it). I tested this under Linux/PPC and Linux/i386 and both of them
>>> create the .so fine.
>>>
>>> Has anyone else tried a similar setup on Mac OS X? Any successes?
>> Exactly the same thing happens under OpenBSD - I presume that part of our
>> shared BSD heritage is causing us problems. Interestingly, mod_python
>> works (well, builds) under FreeBSD; I have no idea about NetBSD though.
> Yeah - I noted the FreeBSD note in the README, and did what it said, but
> that didn't make any difference.
>
> Interesting that you got that on OpenBSD though. Plain wierd actually.
> Is that OpenBSD/i386 or on another platform (ppc?).

OpenBSD-current/i386.

> This could yet be an Apache bug in apxs, I guess. I haven't tried
> compiling any other modules against it.

I suspect it's either apxs (of which I know very little) or libtool (where
what I know I dislike). But that doesn't help me much as I am unable in a
short time scale to fix or coerce either of them :)

Best wishes,


Laurie

From jgramlich at piocon.com  Tue Nov 12 10:21:32 2002
From: jgramlich at piocon.com (Joshua Gramlich)
Date: Fri Jan  9 21:59:45 2004
Subject: [mod_python] mod_python tutorial issues
References: <20021111164814.J22386-100000@eden.ispol.com>
Message-ID: <02c401c28a67$92e1eea0$cb3ac341@ginworks.com>

Okay, my environment:

redhat linux 7.2
mod_python == most recent beta 4 of version 3 (compiled as dso)
apache == 2.0.43
python == 2.2.1 threads enabled...

Now, I'm going through the tutorial, and the little "hello world" program
seems to work just fine.  It's when I get to the authentication piece that
it messes up.  Here's the file I'm trying to "run":

################## myscript.py ##################################
from mod_python import apache

def authenhandler(req):
    pw = req.get_basic_auth_pw()
    user = req.connection.user
    if user == "spam" and pw == "eggs":
        return apache.OK
    else:
        return apache.HTTP_UNAUTHORIZED

def handler(pik):
    pik.content_type = "text/plain"
    pik.send_http_header()
    pik.write("Hello cruel World!")
    pik.write("Eat my shirt...")
    return apache.OK

#######################################################

...and the following is the error_log entry of apache when running:



[Tue Nov 12 10:03:51 2002] [notice] Graceful restart requested, doing
restart
[Tue Nov 12 10:03:57 2002] [notice] Apache/2.0.43 (Unix)
mod_python/3.0-BETA4 Python/2.2.1 configured -- resuming normal operations
[Tue Nov 12 10:05:12 2002] [error] [client 65.195.58.203]
PythonAuthenHandler myscript: Traceback (most recent call last):
[Tue Nov 12 10:05:12 2002] [error] [client 65.195.58.203]
PythonAuthenHandler myscript:   File
"/usr/lib/python2.2/site-packages/mod_python/apache.py", line 335, in
HandlerDispatch
    result = object(req)
[Tue Nov 12 10:05:12 2002] [error] [client 65.195.58.203]
PythonAuthenHandler myscript:   File
"/var/www/webroot/modpythontest/myscript.py", line 7, in authenhandler
    user = req.connection.user
[Tue Nov 12 10:05:12 2002] [error] [client 65.195.58.203]
PythonAuthenHandler myscript: AttributeError: user


Other behavior:
...when trying to access the "myscript.py" file, the internet explorer
authentication popup box appears...asking for username and password.
Whatever you enter for username and password does not matter, and every time
you hit the "OK" button, I get the Internal Server Error (see above) page
from IE.  If I hit "Cancel" instead, I get the "You must be authorized
blahblahblah...", so it looks as though the Apache portion is working...


Josh
Chicago, IL


From grisha at modpython.org  Tue Nov 12 11:56:50 2002
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:59:45 2004
Subject: [mod_python] mod_python tutorial issues
In-Reply-To: <02c401c28a67$92e1eea0$cb3ac341@ginworks.com>
Message-ID: <20021112115519.R33105-100000@eden.ispol.com>

You've mod_python 3.0, but are using the tutorial for 2.x, that's not
going to work :)

In MP 3.0 it's req.user rather than req.connection.user. Also, you don't
need send_http_header() anymore, it's a noop in MP 3.0.

Grisha

On Tue, 12 Nov 2002, Joshua Gramlich wrote:

> Okay, my environment:
>
> redhat linux 7.2
> mod_python == most recent beta 4 of version 3 (compiled as dso)
> apache == 2.0.43
> python == 2.2.1 threads enabled...
>
> Now, I'm going through the tutorial, and the little "hello world" program
> seems to work just fine.  It's when I get to the authentication piece that
> it messes up.  Here's the file I'm trying to "run":
>
> ################## myscript.py ##################################
> from mod_python import apache
>
> def authenhandler(req):
>     pw = req.get_basic_auth_pw()
>     user = req.connection.user
>     if user == "spam" and pw == "eggs":
>         return apache.OK
>     else:
>         return apache.HTTP_UNAUTHORIZED
>
> def handler(pik):
>     pik.content_type = "text/plain"
>     pik.send_http_header()
>     pik.write("Hello cruel World!")
>     pik.write("Eat my shirt...")
>     return apache.OK
>
> #######################################################
>
> ...and the following is the error_log entry of apache when running:
>
>
>
> [Tue Nov 12 10:03:51 2002] [notice] Graceful restart requested, doing
> restart
> [Tue Nov 12 10:03:57 2002] [notice] Apache/2.0.43 (Unix)
> mod_python/3.0-BETA4 Python/2.2.1 configured -- resuming normal operations
> [Tue Nov 12 10:05:12 2002] [error] [client 65.195.58.203]
> PythonAuthenHandler myscript: Traceback (most recent call last):
> [Tue Nov 12 10:05:12 2002] [error] [client 65.195.58.203]
> PythonAuthenHandler myscript:   File
> "/usr/lib/python2.2/site-packages/mod_python/apache.py", line 335, in
> HandlerDispatch
>     result = object(req)
> [Tue Nov 12 10:05:12 2002] [error] [client 65.195.58.203]
> PythonAuthenHandler myscript:   File
> "/var/www/webroot/modpythontest/myscript.py", line 7, in authenhandler
>     user = req.connection.user
> [Tue Nov 12 10:05:12 2002] [error] [client 65.195.58.203]
> PythonAuthenHandler myscript: AttributeError: user
>
>
> Other behavior:
> ...when trying to access the "myscript.py" file, the internet explorer
> authentication popup box appears...asking for username and password.
> Whatever you enter for username and password does not matter, and every time
> you hit the "OK" button, I get the Internal Server Error (see above) page
> from IE.  If I hit "Cancel" instead, I get the "You must be authorized
> blahblahblah...", so it looks as though the Apache portion is working...
>
>
> Josh
> Chicago, IL
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
>


From jgramlich at piocon.com  Tue Nov 12 10:59:33 2002
From: jgramlich at piocon.com (Joshua Gramlich)
Date: Fri Jan  9 21:59:45 2004
Subject: [mod_python] mod_python tutorial issues
References: <20021112115519.R33105-100000@eden.ispol.com>
Message-ID: <02e801c28a6c$e0015540$cb3ac341@ginworks.com>

Well, that is helpful.  Am I to assume that I should really be using the
docs that came with modpython3 rather than www.modpython.org?  Boy, am I
lazy....


Josh



----- Original Message -----
From: "Gregory (Grisha) Trubetskoy" <grisha@modpython.org>
To: "Joshua Gramlich" <jgramlich@piocon.com>
Cc: <mod_python@modpython.org>
Sent: Tuesday, November 12, 2002 10:56 AM
Subject: Re: [mod_python] mod_python tutorial issues


>
> You've mod_python 3.0, but are using the tutorial for 2.x, that's not
> going to work :)
>
> In MP 3.0 it's req.user rather than req.connection.user. Also, you don't
> need send_http_header() anymore, it's a noop in MP 3.0.
>
> Grisha
>
> On Tue, 12 Nov 2002, Joshua Gramlich wrote:
>
> > Okay, my environment:
> >
> > redhat linux 7.2
> > mod_python == most recent beta 4 of version 3 (compiled as dso)
> > apache == 2.0.43
> > python == 2.2.1 threads enabled...
> >
> > Now, I'm going through the tutorial, and the little "hello world"
program
> > seems to work just fine.  It's when I get to the authentication piece
that
> > it messes up.  Here's the file I'm trying to "run":
> >
> > ################## myscript.py ##################################
> > from mod_python import apache
> >
> > def authenhandler(req):
> >     pw = req.get_basic_auth_pw()
> >     user = req.connection.user
> >     if user == "spam" and pw == "eggs":
> >         return apache.OK
> >     else:
> >         return apache.HTTP_UNAUTHORIZED
> >
> > def handler(pik):
> >     pik.content_type = "text/plain"
> >     pik.send_http_header()
> >     pik.write("Hello cruel World!")
> >     pik.write("Eat my shirt...")
> >     return apache.OK
> >
> > #######################################################
> >
> > ...and the following is the error_log entry of apache when running:
> >
> >
> >
> > [Tue Nov 12 10:03:51 2002] [notice] Graceful restart requested, doing
> > restart
> > [Tue Nov 12 10:03:57 2002] [notice] Apache/2.0.43 (Unix)
> > mod_python/3.0-BETA4 Python/2.2.1 configured -- resuming normal
operations
> > [Tue Nov 12 10:05:12 2002] [error] [client 65.195.58.203]
> > PythonAuthenHandler myscript: Traceback (most recent call last):
> > [Tue Nov 12 10:05:12 2002] [error] [client 65.195.58.203]
> > PythonAuthenHandler myscript:   File
> > "/usr/lib/python2.2/site-packages/mod_python/apache.py", line 335, in
> > HandlerDispatch
> >     result = object(req)
> > [Tue Nov 12 10:05:12 2002] [error] [client 65.195.58.203]
> > PythonAuthenHandler myscript:   File
> > "/var/www/webroot/modpythontest/myscript.py", line 7, in authenhandler
> >     user = req.connection.user
> > [Tue Nov 12 10:05:12 2002] [error] [client 65.195.58.203]
> > PythonAuthenHandler myscript: AttributeError: user
> >
> >
> > Other behavior:
> > ...when trying to access the "myscript.py" file, the internet explorer
> > authentication popup box appears...asking for username and password.
> > Whatever you enter for username and password does not matter, and every
time
> > you hit the "OK" button, I get the Internal Server Error (see above)
page
> > from IE.  If I hit "Cancel" instead, I get the "You must be authorized
> > blahblahblah...", so it looks as though the Apache portion is working...
> >
> >
> > Josh
> > Chicago, IL
> >
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://www.modpython.org/mailman/listinfo/mod_python
> >
>


From grisha at modpython.org  Tue Nov 12 12:00:53 2002
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:59:45 2004
Subject: [mod_python] 3.0.0 beta 4 - compile on Mac OS X
In-Reply-To: <20021112091940.B32177@purcell.dcs.kcl.ac.uk>
Message-ID: <20021112115805.K33105-100000@eden.ispol.com>

This may be a problem with Apache 2.0.43 which has a slightly screwed up
distribution file which comes with an outdated libtool.

I don't know if it will help or not, but try running ./buildconf in Apache
source tree before running ./configure.

Grisha

On Tue, 12 Nov 2002, Laurence Tratt wrote:

> On Tue, Nov 12, 2002 at 01:15:02PM +1100, Nathan Robertson wrote:
>
> [Apache and MacOS X]
> > make runs fine, make install breaks. Looked into it, and apxs doesn't
> > create src/.libs/mod_python.so, only mod_python.lai (and the .la symlink
> > to it). I tested this under Linux/PPC and Linux/i386 and both of them
> > create the .so fine.
> >
> > Has anyone else tried a similar setup on Mac OS X? Any successes?
>
> Exactly the same thing happens under OpenBSD - I presume that part of our
> shared BSD heritage is causing us problems. Interestingly, mod_python works
> (well, builds) under FreeBSD; I have no idea about NetBSD though.
>
> Best wishes,
>
>
> Laurie
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
>


From laurie at tratt.net  Tue Nov 12 23:56:52 2002
From: laurie at tratt.net (Laurence Tratt)
Date: Fri Jan  9 21:59:45 2004
Subject: [mod_python] 3.0.0 beta 4 - compile on Mac OS X
In-Reply-To: <20021112115805.K33105-100000@eden.ispol.com>; from grisha@modpython.org on Tue, Nov 12, 2002 at 12:00:53PM -0500
References: <20021112091940.B32177@purcell.dcs.kcl.ac.uk> <20021112115805.K33105-100000@eden.ispol.com>
Message-ID: <20021112235651.B2626@purcell.dcs.kcl.ac.uk>

On Tue, Nov 12, 2002 at 12:00:53PM -0500, Gregory (Grisha) Trubetskoy wrote:

> This may be a problem with Apache 2.0.43 which has a slightly screwed up
> distribution file which comes with an outdated libtool.
>
> I don't know if it will help or not, but try running ./buildconf in Apache
> source tree before running ./configure.

I haven't had a chance to interpret this yet but doing this gives me a
different error, which does at look least a little more likely to be
resolveable:

"""
/usr/local/apache2/build/libtool --silent --mode=link gcc -o mod_python.la
-I/usr/local/src/mod_python-3.0.0-BETA4/src/include
-I/usr/local/apache2/include -I/usr/local/include/python2.2  -rpath
/usr/local/apache2/modules -module -avoid-version  hlistobject.lo hlist.lo
filterobject.lo connobject.lo serverobject.lo util.lo tableobject.lo
requestobject.lo _apachemodule.lo mod_python.lo
-L/usr/ports/lang/python/2.2/w-python-2.2.1/Python-2.2.1 -lm
/usr/local/lib/python2.2/config/libpython2.2.a -pthread -lutil -lm
libtool: link: cannot build libtool library `mod_python.la' from non-libtool
objects: /usr/local/lib/python2.2/config/libpython2.2.a
apxs:Error: Command failed with rc=65536
"""

Now whether that's a MacOS X|OpenBSD thing that Python didn't use libtool
to build I don't currently know, but I'll try and look into it over the
next couple of days. If anyone has any clues, of course they'd be more than
welcome!

Best wishes,


Laurie

From gbenson at redhat.com  Wed Nov 13 10:22:35 2002
From: gbenson at redhat.com (Gary Benson)
Date: Fri Jan  9 21:59:45 2004
Subject: [mod_python] Apache 1.3, mod_python, and threads
Message-ID: <20021113102233.GA21664@redhat.com>

I'm pretty sure that this is the case, but could someone confirm that
it is _not_ possible to build mod_python-2.7.8 for Apache 1.3 against
Python 2.2 unless Python is built without threads.  Also, assuming
that is true, does anyone know why this is the case (apart from
'because python dies in apache startup' ;))

Thanks in advance,
Gary

[ gbenson@redhat.com ][ GnuPG 85A8F78B ][ http://inauspicious.org/ ]

From nathanr at nathanr.net  Wed Nov 13 21:41:10 2002
From: nathanr at nathanr.net (Nathan Robertson)
Date: Fri Jan  9 21:59:45 2004
Subject: [mod_python] 3.0.0 beta 4 - compile on Mac OS X
References: <20021112091940.B32177@purcell.dcs.kcl.ac.uk> <20021112115805.K33105-100000@eden.ispol.com> <20021112235651.B2626@purcell.dcs.kcl.ac.uk>
Message-ID: <3DD22C46.6000302@nathanr.net>

MacOS X gives exactly the same error message as that when making mod_python.

Nathan

Laurence Tratt wrote:
> On Tue, Nov 12, 2002 at 12:00:53PM -0500, Gregory (Grisha) Trubetskoy wrote:
> 
> 
>>This may be a problem with Apache 2.0.43 which has a slightly screwed up
>>distribution file which comes with an outdated libtool.
>>
>>I don't know if it will help or not, but try running ./buildconf in Apache
>>source tree before running ./configure.
> 
> 
> I haven't had a chance to interpret this yet but doing this gives me a
> different error, which does at look least a little more likely to be
> resolveable:
> 
> """
> /usr/local/apache2/build/libtool --silent --mode=link gcc -o mod_python.la
> -I/usr/local/src/mod_python-3.0.0-BETA4/src/include
> -I/usr/local/apache2/include -I/usr/local/include/python2.2  -rpath
> /usr/local/apache2/modules -module -avoid-version  hlistobject.lo hlist.lo
> filterobject.lo connobject.lo serverobject.lo util.lo tableobject.lo
> requestobject.lo _apachemodule.lo mod_python.lo
> -L/usr/ports/lang/python/2.2/w-python-2.2.1/Python-2.2.1 -lm
> /usr/local/lib/python2.2/config/libpython2.2.a -pthread -lutil -lm
> libtool: link: cannot build libtool library `mod_python.la' from non-libtool
> objects: /usr/local/lib/python2.2/config/libpython2.2.a
> apxs:Error: Command failed with rc=65536
> """
> 
> Now whether that's a MacOS X|OpenBSD thing that Python didn't use libtool
> to build I don't currently know, but I'll try and look into it over the
> next couple of days. If anyone has any clues, of course they'd be more than
> welcome!
> 
> Best wishes,
> 
> 
> Laurie
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 
> 




From gbenson at redhat.com  Wed Nov 13 10:49:08 2002
From: gbenson at redhat.com (Gary Benson)
Date: Fri Jan  9 21:59:45 2004
Subject: [mod_python] Apache 1.3, mod_python, and threads
In-Reply-To: <200211131224.19230.mateusz@ant.gliwice.pl>
References: <20021113102233.GA21664@redhat.com> <200211131224.19230.mateusz@ant.gliwice.pl>
Message-ID: <20021113104908.GB21664@redhat.com>

On Wed, Nov 13, 2002 at 12:24:19PM +0100, Mateusz Korniak wrote:
> On Wednesday 13 November 2002 11:22, Gary Benson wrote:
> > I'm pretty sure that this is the case, but could someone confirm that
> > it is _not_ possible to build mod_python-2.7.8 for Apache 1.3 against
> > Python 2.2 unless Python is built without threads.
> 
> I might missed start of thread, but

Nope, that message is the only one in it 

> I pretty sure _I'm_ _able_ to build, and extensively use mod_python
> with both python 2.2.1 and 2.2.2, and both compiled with threads.

This is with Apache 1.3?  I have Apache 1.3.23, Python 2.2 and
mod_python 2.7.8.  If I build Python with threads then Apache dies on
startup with the malformed error message "alize: can't make modules
dictionary"

Maybe the problem is Python 2.2 as opposed to 2.2.1/2.2.2.  I'll try
with one of those.

Cheers,
Gary

[ gbenson@redhat.com ][ GnuPG 85A8F78B ][ http://inauspicious.org/ ]

From mateusz at ant.gliwice.pl  Wed Nov 13 13:22:38 2002
From: mateusz at ant.gliwice.pl (Mateusz Korniak)
Date: Fri Jan  9 21:59:45 2004
Subject: [mod_python] Apache 1.3, mod_python, and threads
In-Reply-To: <20021113104908.GB21664@redhat.com>
References: <20021113102233.GA21664@redhat.com> <200211131224.19230.mateusz@ant.gliwice.pl> <20021113104908.GB21664@redhat.com>
Message-ID: <200211131322.38756.mateusz@ant.gliwice.pl>

On Wednesday 13 November 2002 11:49, Gary Benson wrote:

> > I pretty sure _I'm_ _able_ to build, and extensively use mod_python
> > with both python 2.2.1 and 2.2.2, and both compiled with threads.
>
> This is with Apache 1.3?  I have Apache 1.3.23, Python 2.2 and
> mod_python 2.7.8.  If I build Python with threads then Apache dies on
> startup with the malformed error message "alize: can't make modules
> dictionary"

[matkor@appserver ~]$ rpm -q apache
apache-1.3.27-3
[matkor@appserver ~]$ rpm -q apache-mod_python
apache-mod_python-2.7.8-6
[matkor@appserver ~]$ rpm -q python
python-2.2.2-1

( All specs used to build those rpms are on http://www.pld.org.pl/devel/cvs/ 
there should be alse src rpms ...)

[matkor@appserver ~]$ python
Python 2.2.2 (#1, Nov  9 2002, 21:07:57)
[GCC 2.95.4 20010319 (prerelease)] on linux2
Type "help", "copyright", "credits" or "license" for more information.
>>> import thread
>>>

> Maybe the problem is Python 2.2 as opposed to 2.2.1/2.2.2.  I'll try
> with one of those.

I had only problems with mod_python itself but only  when I tried use 
mod_python dynlinked .. but symptoms ware different - segfault on first use 
of mod_python.


-- 
Mateusz Korniak



From antonio at memora.com  Wed Nov 13 07:40:54 2002
From: antonio at memora.com (Antonio L Rodriguez)
Date: Fri Jan  9 21:59:45 2004
Subject: [mod_python] Apache 1.3, mod_python, and threads
In-Reply-To: <20021113102233.GA21664@redhat.com>
Message-ID: <2658F540-F705-11D6-A9E6-00039300D690@memora.com>

I've built it wit threads on debian 3.0/Intel  (apache 1.3.26) no 
problem.

I'm not sure its advised however, though as you've probably seen in the 
docs. My approach has been that so long as I stay away from thread 
usage in the scripts I should be ok but I haven't verified this too 
seriously.

AR

On Wednesday, November 13, 2002, at 05:22 AM, Gary Benson wrote:

> I'm pretty sure that this is the case, but could someone confirm that
> it is _not_ possible to build mod_python-2.7.8 for Apache 1.3 against
> Python 2.2 unless Python is built without threads.  Also, assuming
> that is true, does anyone know why this is the case (apart from
> 'because python dies in apache startup' ;))
>
> Thanks in advance,
> Gary
>
> [ gbenson@redhat.com ][ GnuPG 85A8F78B ][ http://inauspicious.org/ ]
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
>


From antonio at memora.com  Wed Nov 13 09:15:19 2002
From: antonio at memora.com (Antonio L Rodriguez)
Date: Fri Jan  9 21:59:45 2004
Subject: [mod_python] Funky publisher behavior under apache 1.3
Message-ID: <56B386A8-F712-11D6-A9E6-00039300D690@memora.com>

Hey all,

I've been playing around with the publisher but have been having some 
issues. First, I get this in my apache logs all the time:

[Wed Nov 13 08:49:01 2002] [notice] mod_python: (Re)importing 
mod_python.publisher from None


This happens even when the underlying files do not change (either the 
script or the publisher.py file ).

Second, I'm getting erratic behavior where the publisher will find a 
function one time and then generate a 404 a couple of requests later 
for no apparent reason.

I am using python 2.2.2 with threads but this hasn't been a problem in 
the past and I'm not actually using the threading libs. in my script.

Anyone run into this type of behavior with publisher.py?

Thanks

AR


From gbenson at redhat.com  Wed Nov 13 14:45:45 2002
From: gbenson at redhat.com (Gary Benson)
Date: Fri Jan  9 21:59:45 2004
Subject: [mod_python] Apache 1.3, mod_python, and threads
In-Reply-To: <20021113104908.GB21664@redhat.com>
References: <20021113102233.GA21664@redhat.com> <200211131224.19230.mateusz@ant.gliwice.pl> <20021113104908.GB21664@redhat.com>
Message-ID: <20021113144543.GC21664@redhat.com>

On Wed, Nov 13, 2002 at 10:49:08AM +0000, Gary Benson wrote:
> On Wed, Nov 13, 2002 at 12:24:19PM +0100, Mateusz Korniak wrote:
> > I pretty sure _I'm_ _able_ to build, and extensively use mod_python
> > with both python 2.2.1 and 2.2.2, and both compiled with threads.
> 
> This is with Apache 1.3?  I have Apache 1.3.23, Python 2.2 and
> mod_python 2.7.8.  If I build Python with threads then Apache dies on
> startup with the malformed error message "alize: can't make modules
> dictionary"
> 
> Maybe the problem is Python 2.2 as opposed to 2.2.1/2.2.2.  I'll try
> with one of those.

I upgraded from 2.2 to 2.2.1 and the problem went away; thanks guys!

Gary

[ gbenson@redhat.com ][ GnuPG 85A8F78B ][ http://inauspicious.org/ ]

From vmanera at manord.com  Wed Nov 13 15:52:10 2002
From: vmanera at manord.com (Manera, Villiam)
Date: Fri Jan  9 21:59:45 2004
Subject: R: [mod_python] Funky publisher behavior under apache 1.3
Message-ID: <52DC70C1C1575C418CB033523A29CF140E0527@exchange2000.manord.com>

I've submitted the same problem the 17 October, and is still a problem:
From: Manera, Villiam <vmanera@manord.com>
To: 'mod_python@modpython.org' <mod_python@modpython.org>
Date: 17 October 2002 19:13
Subject: [mod_python] strange behavior of mod-python


>
>I'm currently use mod-python 2.7.6 on apache 1.3.26 - windows 2000 with
>python 2.2
>apache config:
>.....
>    ScriptAlias /comm/ "E:/script/cgi/comm/"
>    ScriptAlias /tecnico/ "E:/script/cgi/tecnico/"
>....
><Directory "E:/script/cgi/comm">
>        Order Deny,Allow
>        Deny from all
>        Allow from .....
>       ...
>    AddHandler python-program .py
>    PythonHandler mod_python.publisher
> PythonPath "sys.path+['c:/program
>files/python22/lib/site-packages/mdnlib', 'c:/program
>files/python22/lib/site-packages/HTMLgen','E:/script/cgi/comm']"
>    PythonDebug on
>    </Directory>
>
>----------------------------------------------------
>all work fine, but sometimes (today 4 time) when a url is typed:
>http://sviluppo.manord.com/comm/comm_ocordiu0.py/main?....
>
>I have this behavior from apache:
>HTTP 404 - File non trovato (not found)
>Internet Explorer
>but the program is still in place, and the only way to force apache to
found
>the program is restart the apache services,
>or make a copy of comm_ocordiu0 in comm_ocordiu1 and then call this one,
>but....
>
>
>
>this is not a real problem in developement web server, but  today it
>happened 4 time, in production is happened 2 time in one month,
>and I become in panic.
>
>Any advice here would be greatly appreciated.
>
>Villiam

-----Messaggio originale-----
Da: Antonio L Rodriguez [mailto:antonio@memora.com]
Inviato: mercoled? 13 novembre 2002 15.15
A: mod_python@modpython.org
Oggetto: [mod_python] Funky publisher behavior under apache 1.3


Hey all,

I've been playing around with the publisher but have been having some 
issues. First, I get this in my apache logs all the time:

[Wed Nov 13 08:49:01 2002] [notice] mod_python: (Re)importing 
mod_python.publisher from None


This happens even when the underlying files do not change (either the 
script or the publisher.py file ).

Second, I'm getting erratic behavior where the publisher will find a 
function one time and then generate a 404 a couple of requests later 
for no apparent reason.

I am using python 2.2.2 with threads but this hasn't been a problem in 
the past and I'm not actually using the threading libs. in my script.

Anyone run into this type of behavior with publisher.py?

Thanks

AR

_______________________________________________
Mod_python mailing list
Mod_python@modpython.org
http://www.modpython.org/mailman/listinfo/mod_python


From jquinte at fadu.uba.ar  Wed Nov 13 13:21:01 2002
From: jquinte at fadu.uba.ar (Javier Quinteros)
Date: Fri Jan  9 21:59:46 2004
Subject: [mod_python] =?iso-8859-1?Q?Comp=EClation?= error in Solaris 8...
Message-ID: <3DD27BED.CF84CFA2@fadu.uba.ar>

Hi !!!
I've seen a problem like this posted before but there was no
satisfactory answer.

I'm using Solaris 8, Apache 1.3.26, Python 2.2.1 and ModPython 2.7.8.

This are the steps I execute:
* ./configure --with-apache=/usr/...........
* make static
* make install

Then I move to the apache source directory and:

* ./configure (as specified in modpython instructions)
* make

Then I get an error telling me that there are "Undefined Symbols" (about
40). All of them are Python Symbols (PySequence, etc.).

The only answer I've found in the archives is from a Brasilian guy
telling that the libmodpython.a has to be compiled with the -fpic flag
when using gcc.

Please, I need a solution ASAP.

Thanks in advance.

Javier Quinteros
Universidad de Buenos Aires



From jwyant at sfbcic.com  Wed Nov 13 12:46:03 2002
From: jwyant at sfbcic.com (Wyant, Jaime)
Date: Fri Jan  9 21:59:46 2004
Subject: [mod_python] Write errors (client closed connection)
Message-ID: <654DAEACA633D511B5F500902784B052188EE1@MS-EXCHANGE>

What usually causes a webbrowser to close a connection?  I assume the user
"closes" their browser which closes the connection.

I usually get this exception:

IOError: Write failed, client closed connection. 

Can anyone elaborate?

Thanks!
jaime wyant (jwyant@sfbcic . com)
MS Farm Bureau
(601) 977 - 4291



From grisha at modpython.org  Wed Nov 13 15:10:53 2002
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:59:46 2004
Subject: [mod_python] Write errors (client closed connection)
In-Reply-To: <654DAEACA633D511B5F500902784B052188EE1@MS-EXCHANGE>
Message-ID: <20021113151011.P48789-100000@eden.ispol.com>

I think this will happen if they click the "stop" button also.

On Wed, 13 Nov 2002, Wyant, Jaime wrote:

> What usually causes a webbrowser to close a connection?  I assume the user
> "closes" their browser which closes the connection.
>
> I usually get this exception:
>
> IOError: Write failed, client closed connection.
>
> Can anyone elaborate?
>
> Thanks!
> jaime wyant (jwyant@sfbcic . com)
> MS Farm Bureau
> (601) 977 - 4291
>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
>


From agenkin-lst-mod_python at thpoon.com  Thu Nov 14 15:32:28 2002
From: agenkin-lst-mod_python at thpoon.com (Arcady Genkin)
Date: Fri Jan  9 21:59:46 2004
Subject: [mod_python] SetHandler and a subdirectory with static contents (images)
Message-ID: <uoel9nc2oz.fsf@bashful.cdf.toronto.edu>

I cannot send image files when using the Publisher handler: apache
tries to run them as Python programs. ;^)  I tried setting to handler
for the images directory to the default, but it didn't work.  With
Apache 2.0.43 and mod_python-3.0B4, I have the following config:

,----[ httpd.conf ]
| <Directory "/var/www/data">
|    PythonDebug On
|    SetHandler python-program
|    PythonHandler mod_python.publisher
| </Directory>
| 
| <Directory "/var/www/data/images">
|   SetHandler default-handler
| </Directory>
`----

Since /var/www/data is the DocumentRoot, I cannot place the images in
a directory outside of it...

What am I doing wrong?
-- 
Arcady Genkin

guilt is the cause of more disauders
than history's most obscene marorders (E.E. Cummings)

From vmilitaru at sympatico.ca  Thu Nov 14 21:00:38 2002
From: vmilitaru at sympatico.ca (vio)
Date: Fri Jan  9 21:59:46 2004
Subject: [mod_python] SetHandler and a subdirectory with static contents 
 (images)
References: <uoel9nc2oz.fsf@bashful.cdf.toronto.edu>
Message-ID: <3DD45546.DA2BB937@sympatico.ca>

Looks like you forgot to include the python suffix, which restricts what
file types are to be handled by mod_python.publisher. Try it like this:

<IfModule mod_python.c>
<Directory /var/www/data>
    AddHandler python-program .py
    PythonHandler mod_python.publisher
    PythonDebug On
</Directory>
</IfModule>

Cheer,
Vio


Arcady Genkin wrote:

> I cannot send image files when using the Publisher handler: apache
> tries to run them as Python programs. ;^)  I tried setting to handler
> for the images directory to the default, but it didn't work.  With
> Apache 2.0.43 and mod_python-3.0B4, I have the following config:
>
> ,----[ httpd.conf ]
> | <Directory "/var/www/data">
> |    PythonDebug On
> |    SetHandler python-program
> |    PythonHandler mod_python.publisher
> | </Directory>
> |
> | <Directory "/var/www/data/images">
> |   SetHandler default-handler
> | </Directory>
> `----
>
> Since /var/www/data is the DocumentRoot, I cannot place the images in
> a directory outside of it...
>
> What am I doing wrong?
> --
> Arcady Genkin
>
> guilt is the cause of more disauders
> than history's most obscene marorders (E.E. Cummings)
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python


From Antonio at Memora.com  Thu Nov 14 21:21:43 2002
From: Antonio at Memora.com (Antonio Rodriguez)
Date: Fri Jan  9 21:59:46 2004
Subject: [mod_python] The story with python compiled with threads
References: <uoel9nc2oz.fsf@bashful.cdf.toronto.edu> <3DD45546.DA2BB937@sympatico.ca>
Message-ID: <000d01c28c4d$bdc48aa0$6b01a8c0@borg>

To those wiser in mod_python,

So the README says to definitely *NOT* use mod_python with python compiled
with threads in apache 1.3, but I bet that many people do anyway. What is
the story with what can go wrong? That is, I've heard of the apache
processes dying from the start and obviously using threads in your scripts
probably isn't cool, but what if mod_python seems to run ok most of the
time.

The basic question is this: what can happen if we use mod_python with python
with threads support in terms of partial failure?


Thanks

Antonio




From jack_diederich at email.com  Thu Nov 14 18:08:37 2002
From: jack_diederich at email.com (Jack Diederich)
Date: Fri Jan  9 21:59:46 2004
Subject: [mod_python] Write errors (client closed connection)
Message-ID: <20021114230837.8439.qmail@email.com>

This is also why apache recomends you run a proxy server in front of
your dynamic perl/python/whatever server.  The proxy server gets the client
close, but the mod_python server runs the process to completion.  If
you depend on something running all the way through without errors
(your code is bug free, right?) then you should really have a proxy
server in between you and the big bad world.

-jack

----- Original Message -----
From: "Gregory (Grisha) Trubetskoy" <grisha@modpython.org>
> 
> I think this will happen if they click the "stop" button also.
> 

-- 
_______________________________________________
Sign-up for your own FREE Personalized E-mail at Mail.com
http://www.mail.com/?sr=signup

Single & ready to mingle? lavalife.com:  Where singles click. Free to Search!
http://www.lavalife.com/wp.epl?a=2716


From gstein at lyra.org  Thu Nov 14 13:51:38 2002
From: gstein at lyra.org (Greg Stein)
Date: Fri Jan  9 21:59:46 2004
Subject: [mod_python] Write errors (client closed connection)
In-Reply-To: <20021113151011.P48789-100000@eden.ispol.com>; from grisha@modpython.org on Wed, Nov 13, 2002 at 03:10:53PM -0500
References: <654DAEACA633D511B5F500902784B052188EE1@MS-EXCHANGE> <20021113151011.P48789-100000@eden.ispol.com>
Message-ID: <20021114135138.K13799@lyra.org>

Yup, definitely. The client closes their side, but the server won't notice
that until it tries to write to the socket. Normally, this raises SIGPIPE,
but it appears somebody has caught/ignored that, so you just get the error.

Cheers,
-g

On Wed, Nov 13, 2002 at 03:10:53PM -0500, Gregory (Grisha) Trubetskoy wrote:
> 
> I think this will happen if they click the "stop" button also.
> 
> On Wed, 13 Nov 2002, Wyant, Jaime wrote:
> 
> > What usually causes a webbrowser to close a connection?  I assume the user
> > "closes" their browser which closes the connection.
> >
> > I usually get this exception:
> >
> > IOError: Write failed, client closed connection.
> >
> > Can anyone elaborate?
> >
> > Thanks!
> > jaime wyant (jwyant@sfbcic . com)
> > MS Farm Bureau
> > (601) 977 - 4291
> >
> >
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://www.modpython.org/mailman/listinfo/mod_python
> >
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python

-- 
Greg Stein, http://www.lyra.org/

From sandor.kopanyi at mailbox.hu  Fri Nov 15 16:27:21 2002
From: sandor.kopanyi at mailbox.hu (sandor.kopanyi@mailbox.hu)
Date: Fri Jan  9 21:59:46 2004
Subject: [mod_python] permanent db connection (more than in FAQ 3.3)
Message-ID: <20021115152721.7694.qmail@web2.mailbox.hu>

Hi,

In the mod_python FAQ 3.3 there is a good example of a 'permanent'
database
connection. This works fine, the connection is reused, as long as the
request
is handled in the same child process (apache child process). But a new
child
process gets a new interpreter => new connection is created. At least
that's
what I guess.

I've tried the Python*Interp* directives, but the connection is
re-created
regardless of those directives. Am I doing something wrong?

E.g. when setting PythonInterpeter to something (e.g. blabla), the
connection
is recreated again and again.

Any ideeas?

I'm using apache 1.3.23 with mod_python 2.7.6 on RedHat 7.3; the
application
is based on the publisher handler; the db connection code is almost
copy-paste from
the FAQ.

Best regards,
Sandor


________________________________________________
http://mailbox.hu - M?r SMS ?rtes?t?ssel is!



From mateusz at ant.gliwice.pl  Fri Nov 15 16:38:47 2002
From: mateusz at ant.gliwice.pl (Mateusz Korniak)
Date: Fri Jan  9 21:59:46 2004
Subject: [mod_python] permanent db connection (more than in FAQ 3.3)
In-Reply-To: <20021115152721.7694.qmail@web2.mailbox.hu>
References: <20021115152721.7694.qmail@web2.mailbox.hu>
Message-ID: <200211151638.47175.mateusz@ant.gliwice.pl>

On Friday 15 November 2002 16:27, sandor.kopanyi@mailbox.hu wrote:
> Hi,
>
> In the mod_python FAQ 3.3 there is a good example of a 'permanent'
> database
> connection. This works fine, the connection is reused, as long as the
> request
> is handled in the same child process (apache child process). But a new
> child
> process gets a new interpreter => new connection is created. At least
> that's
> what I guess.

Yes.
I keep one connection per each apache process.

-- 
Mateusz Korniak
"Black holes are where God divided by zero." - Steven Wright


From grisha at modpython.org  Fri Nov 15 11:25:41 2002
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:59:46 2004
Subject: [mod_python] permanent db connection (more than in FAQ 3.3)
In-Reply-To: <20021115152721.7694.qmail@web2.mailbox.hu>
Message-ID: <20021115112129.C74246-100000@eden.ispol.com>

There isn't much you can do about this - the connections are only reused
within the same process, a new process will create a new connection.

PythonInterpreter's scope does not extend beyond a process, i.e. a seprate
process is a separate process, a separate memory space, a different
interpreter, etc.

Hope this clarifies it a bit.

Grisha

On Fri, 15 Nov 2002 sandor.kopanyi@mailbox.hu wrote:

> Hi,
>
> In the mod_python FAQ 3.3 there is a good example of a 'permanent'
> database connection. This works fine, the connection is reused, as long
> as the request is handled in the same child process (apache child
> process). But a new child process gets a new interpreter => new
> connection is created. At least that's what I guess.
>
> I've tried the Python*Interp* directives, but the connection is
> re-created regardless of those directives. Am I doing something wrong?
>
> E.g. when setting PythonInterpeter to something (e.g. blabla), the
> connection is recreated again and again.
>
> Any ideeas?
>
> I'm using apache 1.3.23 with mod_python 2.7.6 on RedHat 7.3; the
> application is based on the publisher handler; the db connection code is
> almost copy-paste from the FAQ.
>
> Best regards,
> Sandor
>
>
> ________________________________________________
> http://mailbox.hu - M?r SMS ?rtes?t?ssel is!
>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
>


From agenkin-lst-mod_python at thpoon.com  Sat Nov 16 20:24:19 2002
From: agenkin-lst-mod_python at thpoon.com (Arcady Genkin)
Date: Fri Jan  9 21:59:46 2004
Subject: [mod_python] SetHandler and a subdirectory with static contents 
 (images)
In-Reply-To: <3DD45546.DA2BB937@sympatico.ca> (vio's message of "Thu, 14 Nov
 2002 21:00:38 -0500")
References: <uoel9nc2oz.fsf@bashful.cdf.toronto.edu>
	<3DD45546.DA2BB937@sympatico.ca>
Message-ID: <uowund3s58.fsf@bashful.cdf.toronto.edu>

vio <vmilitaru@sympatico.ca> writes:

> Looks like you forgot to include the python suffix, which restricts what
> file types are to be handled by mod_python.publisher. Try it like this:
>
> <IfModule mod_python.c>
> <Directory /var/www/data>
>     AddHandler python-program .py
>     PythonHandler mod_python.publisher
>     PythonDebug On
> </Directory>
> </IfModule>

Note that I am using the SetHandler directive (not AddHandler), which
does not require the file extension.  This is the recommended
configuration directive for 3.0, as per the docs.

Can anybody tell me how to work around this?

> Arcady Genkin wrote:
>
>> I cannot send image files when using the Publisher handler: apache
>> tries to run them as Python programs. ;^)  I tried setting to handler
>> for the images directory to the default, but it didn't work.  With
>> Apache 2.0.43 and mod_python-3.0B4, I have the following config:
>>
>> ,----[ httpd.conf ]
>> | <Directory "/var/www/data">
>> |    PythonDebug On
>> |    SetHandler python-program
>> |    PythonHandler mod_python.publisher
>> | </Directory>
>> |
>> | <Directory "/var/www/data/images">
>> |   SetHandler default-handler
>> | </Directory>
>> `----
>>
>> Since /var/www/data is the DocumentRoot, I cannot place the images in
>> a directory outside of it...
>>
>> What am I doing wrong?

-- 
Arcady Genkin : CDF Systems Administrator
http://www.cdf.toronto.edu/~agenkin/contact.html

guilt is the cause of more disauders
than history's most obscene marorders (E.E. Cummings)

From mateusz at ant.gliwice.pl  Mon Nov 18 11:45:52 2002
From: mateusz at ant.gliwice.pl (Mateusz Korniak)
Date: Fri Jan  9 21:59:46 2004
Subject: [mod_python] Using gzip module with mod_gzip enabled apache breaks things ?
Message-ID: <200211181145.52365.mateusz@ant.gliwice.pl>

Any idea why using mod_gzip in apache makes gziping by gzip module hang apache 
server process ?
Currently I'm able compress content using mod_python nor mod_gzip (for static 
content), but not _both_ . :/

TIA for any ideas comments...

-- 
Mateusz Korniak
"Black holes are where God divided by zero." - Steven Wright


From ps0 at igmp.com.ar  Mon Nov 18 17:26:11 2002
From: ps0 at igmp.com.ar (Hector A. Paterno)
Date: Fri Jan  9 21:59:46 2004
Subject: [mod_python] Authentication like php !
Message-ID: <20021118172611.A8069@igmp.com.ar>

Hi,

 Anyone has already do some type of authentication with mod_python
 using some type of cookies or sessions (like php does) ?
 
 I need this for a user/pass form in the main page ( I dont want the
 tipical Auth new window ( AuthHandler ).
 
 
 Tnks A lot !
 

-- 
Hector A. Paterno

From ps0 at igmp.com.ar  Tue Nov 19 12:07:20 2002
From: ps0 at igmp.com.ar (Hector A. Paterno)
Date: Fri Jan  9 21:59:46 2004
Subject: [mod_python] Authentication like php !
In-Reply-To: <OF3AFC019A.317D1A47-ON85256C75.00712D44-85256C75.00720302@ccity.com>; from Tony_Burger@circuitcity.com on Mon, Nov 18, 2002 at 03:44:42PM -0500
References: <OF3AFC019A.317D1A47-ON85256C75.00712D44-85256C75.00720302@ccity.com>
Message-ID: <20021119120720.C17664@igmp.com.ar>

On Mon, Nov 18, 2002 at 03:44:42PM -0500, Tony_Burger@circuitcity.com wrote:

Could you bring me the python version of the perl script ?

Tnks a lot.


> 
> Yes in fact, using mod_auth_mda.  I have converted the perl script using
> mod_python and setup cookie checking for the client.  It looks as though
> the module is still only available for Apache 1.3.xx.  Looks like the
> website has been enhanced since I viewed it last, should help with setup.
> There was a lot of talk on the message list about the bit-masking
> technique.
> 
> http://www.frogdot.org/mod_auth_mda/index.html
> 
> 

-- 
Hector A. Paterno

From mbp at samba.org  Tue Nov 19 16:36:58 2002
From: mbp at samba.org (Martin Pool)
Date: Fri Jan  9 21:59:46 2004
Subject: [mod_python] unicode() conversion troubles with mod_python 3 CVS 27.06.2002
In-Reply-To: <005b01c27aff$26914920$0bcbefc3@irkutsk.teleross.ru>
References: <005b01c27aff$26914920$0bcbefc3@irkutsk.teleross.ru>
Message-ID: <20021120003657.GD25174@toey.sourcefrog.net>

On 24 Oct 2002, Eugene Sizikov <eugene_beast@mail.ru> wrote:
> Hello all ppl!
> 
> I have troubles with unicode conversion with mod_python from RedHat 8.0
> distro. The errorlog is:
> 
> "
> Mod_python error: "PythonHandler mod_python.publisher"
> 
> Traceback (most recent call last):
> 
>   File "/usr/lib/python2.2/site-packages/mod_python/apache.py", line 285, in
> HandlerDispatch
>     result = object(req)
> 
>   File "/usr/lib/python2.2/site-packages/mod_python/publisher.py", line 175,
> in handler
>     result = apply(object, (), args)
> 
>   File "/var/www/html/teleross/user.py", line 137, in start
>     html = '%s [%s]<HR>' % (string_sql_to_html(user.fullname),
> Group(user.con, user.gid).fullname) + menu.to_html()
> 
>   File "/var/www/html/teleross/utils.py", line 4, in string_sql_to_html
>     return unicode(s, 'koi8-r')
> 
>   File
> "/usr/src/build/143041-i386/install/usr/lib/python2.2/encodings/__init__.py"
> , line 51, in search_function
> 
> RuntimeError: cannot unmarshal code objects in restricted execution mode
> "
> 
> So, when it has "unicode(s, 'koi8-r')" it crashes with that interesting
> message I can't understand.

I had a similar problem.  It seemed to me to be some kind of
interaction between encoders being imported by the C encode()
implementation and modules being imported by mod_python.
Unfortunately I could only look at it without our complicated build
environment so I can't say for sure.

A workaround turned out to be forcing the encoders to be loaded before
mod_python starts up.  You can do this by adding a line like this to
sitecustom.py:

  u'hello'.encode('koi8-r')

-- 
Martin

From pzb at datastacks.com  Fri Nov 22 16:02:24 2002
From: pzb at datastacks.com (Peter Bowen)
Date: Fri Jan  9 21:59:46 2004
Subject: [mod_python] Apache segfault when using PythonImport
Message-ID: <1037998943.8001.40.camel@10-0-0-234.boston.ximian.com>

Apache is segfaulting when I use the PythonImport directive.

I have seen it under two slightly different conditions:

A) Apache 1.3.23 (from Red Hat Linux 7.3 errata), Python 2.2.2 without
threads, and mod_python 2.7.8

In this case the backtrace shows that the segfault occurs in ap_palloc. 
The stack looks like ap_palloc -> ap_pstrdup -> ap_table_add ->
directive_PythonImport.

B) Apache 1.3.23 (as above) or Apache 1.3.27, Python 2.2.2 with threads,
and mod_python 2.7.8

Different backtrace.  Dies in pthread_mutex_lock, called from
PyEval_AcquireLock.

Has anyone had sucess with using PythonImport with python 2.2 on apache
1.3?

Thanks.
Peter


From jack_diederich at email.com  Fri Nov 22 17:46:48 2002
From: jack_diederich at email.com (Jack Diederich)
Date: Fri Jan  9 21:59:46 2004
Subject: [mod_python] Apache segfault when using PythonImport
Message-ID: <20021122224648.6502.qmail@email.com>

I can't say for cetain what the cause of the segfault is, but I've
posted a potential reason and patches to fix it more than once to this list.

The globals for python imports are not safe, and trivial to make so.  I know
3.x is the gold standard, but patching 2.x for stability shouldn't be out
of the question.

The calls he sites are a VERY good indicator that the global is the problem,
we should just register a cleanup hook to NULL it out and recreate it again if
init()s are called twice.

-jack
> ----- Original Message -----
> From: Peter Bowen <pzb@datastacks.com>
> Date: 22 Nov 2002 16:02:24 -0500 
> To: mod_python@modpython.org
> Subject: [mod_python] Apache segfault when using PythonImport
> 
> 
> > Apache is segfaulting when I use the PythonImport directive.
> > 
> > I have seen it under two slightly different conditions:
> > 
> > A) Apache 1.3.23 (from Red Hat Linux 7.3 errata), Python 2.2.2 without
> > threads, and mod_python 2.7.8
> > 
> > In this case the backtrace shows that the segfault occurs in ap_palloc. 
> > The stack looks like ap_palloc -> ap_pstrdup -> ap_table_add ->
> > directive_PythonImport.
> > 
> > B) Apache 1.3.23 (as above) or Apache 1.3.27, Python 2.2.2 with threads,
> > and mod_python 2.7.8
> > 
> > Different backtrace.  Dies in pthread_mutex_lock, called from
> > PyEval_AcquireLock.
> > 
> > Has anyone had sucess with using PythonImport with python 2.2 on apache
> > 1.3?
> > 
> > Thanks.
> > Peter
> > 
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://www.modpython.org/mailman/listinfo/mod_python
> > 
> > 
> 
> -- 
> _______________________________________________
> Sign-up for your own FREE Personalized E-mail at Mail.com
> http://www.mail.com/?sr=signup
> 
> One click access to the Top Search Engines
> http://www.exactsearchbar.com/mailcom
> 
> 

-- 
_______________________________________________
Sign-up for your own FREE Personalized E-mail at Mail.com
http://www.mail.com/?sr=signup

One click access to the Top Search Engines
http://www.exactsearchbar.com/mailcom


From post at nlhas.no  Sat Nov 23 12:54:36 2002
From: post at nlhas.no (NLH AS)
Date: Fri Jan  9 21:59:46 2004
Subject: [mod_python] Beginner documentation -- suggestion
Message-ID: <3.0.5.32.20021123125436.00b61960@nlhhost>

I've just installed mod_python and converted a cgi application. During this
process I've spent most of my time finding out what happens where -- the
actual conversion fell into place quickly when I understood the main
framework. Everything is in the documentation, but I'd have appreciated a
simple explanation along the lines of the following (which may well be
wrong!) somewhere in the tutorial. Perhaps something like this can be
worked into the next edition of the documentation?

pm


++++++ What happens where in a "out-of-the-box" Apache/mod_python setup:

At startup or at the first call to a mod_python handler Apache loads the
Python interpreter and the import modules at the top of the handler's
module file.

Each call to the handler is executed in an Apache child process with a
separate Python subinterpreter instance. It is not possible to share global
variables between Apache's child processes (so sharing a global database
connection is not possible for example), and there is no means of
predicting whether Apache will start a new process or re-use an existing
process for any given call to the handler. [>> pointer to information about
how Apache does this, how many child processes can be started, etc.?].

Global variables within the handler's module will be available to all calls
to the handler that are routed to the same Apache process. This could be
used to maintain and re-use a database connection per child process. 

Local variables within the handler are local to each call to the handler
[and are eventually garbage-collected in the normal way?].

Mod_python will check whether the top level python module (containing the
handler) has been changed and re-load if necessary. Imported modules are
not checked, and the only 100% certain way of ensuring that updated modules
are reloaded in all child processes is to stop and re-start Apache.

It is possible to tweak various aspects of this behaviour -- for example
Apache can be compiled to only ever start one child process (which would
enable global variables), but this would entail significantly poorer
performance.
+++++
   

From markusjais at yahoo.de  Mon Nov 25 00:30:50 2002
From: markusjais at yahoo.de (Markus Jais)
Date: Fri Jan  9 21:59:46 2004
Subject: [mod_python] beginners question
Message-ID: <1038180652.3173.2.camel@eagle>

Hello
I have just installed mod_python 2.7.8 for my
apache 1.3.23

I have python 2.2.2 (with threads) on a RedHat 7.3 system.

compilation was no problem but when I restart apache I get

Starting httpd: [Mon Nov 25 00:26:41 2002] [warn] Loaded DSO
modules/mod_python.so uses plain Apache 1.3 API, this module might crash
under EAPI! (please recompile it with -DEAPI)


what does this mean?? I found EAPI not mentioned in the sources.

markus




__________________________________________________________________

Gesendet von Yahoo! Mail - http://mail.yahoo.de
Möchten Sie mit einem Gruß antworten? http://grusskarten.yahoo.de

From jfk at metation.com  Mon Nov 25 13:06:36 2002
From: jfk at metation.com (Jørgen Frøjk Kjærsgaard)
Date: Fri Jan  9 21:59:46 2004
Subject: [mod_python] beginners question
In-Reply-To: <1038180652.3173.2.camel@eagle>
References: <1038180652.3173.2.camel@eagle>
Message-ID: <20021125110636.M72172@metation.com>

On 25 Nov 2002 00:30:50 +0100, Markus Jais wrote
> Hello
> I have just installed mod_python 2.7.8 for my
> apache 1.3.23
> 
> I have python 2.2.2 (with threads) on a RedHat 7.3 system.
> 
> compilation was no problem but when I restart apache I get
> 
> Starting httpd: [Mon Nov 25 00:26:41 2002] [warn] Loaded DSO
> modules/mod_python.so uses plain Apache 1.3 API, this module might crash
> under EAPI! (please recompile it with -DEAPI)
> 
> what does this mean?? I found EAPI not mentioned in the sources.

Apache 1.3 has two API versions. If you compile with the "-DEAPI" option given
to gcc, you get an EAPI version.

You may safely ignore the warning. mod_python works fine even when compiled
with plain API.

/jfk

--
J?rgen Fr?jk Kj?rsgaard
Metation ApS - the system integrators
Kystvejen 29 - DK 8000 ?rhus C - www.metation.com

From jquinte at fadu.uba.ar  Mon Nov 25 11:00:13 2002
From: jquinte at fadu.uba.ar (Javier Quinteros)
Date: Fri Jan  9 21:59:46 2004
Subject: [mod_python] Solaris 8...
Message-ID: <006301c2948a$fa13e240$3dd05c9d@sis.rec.uba.ar>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Hi, all of you !!!
Yes, it's me again. I'm still fighting with modpython and Solaris 8,
trying to make them both understand that they should work together...  
;-)
My question this time is TOO simple:

Has anyone been able to compile and install modpython in a Solaris 8 OS
???

Thanks in advance...
- ------------------------------
Javier Quinteros
jquinte@fadu.uba.ar
jquinte@dc.uba.ar
Universidad de Buenos Aires
- ------------------------------

-----BEGIN PGP SIGNATURE-----
Version: PGPfreeware 6.5.3 for non-commercial use <http://www.pgp.com>

iQA/AwUBPeIs63Qc0Z5RZeHIEQIIugCgg7DMEUW4+90brXKIjcQAhweTpFAAn0At
TuyWYxld3hvHQkvbEYcOk4yq
=vPKa
-----END PGP SIGNATURE-----



From agenkin-lst-mod_python at thpoon.com  Mon Nov 25 16:16:57 2002
From: agenkin-lst-mod_python at thpoon.com (Arcady Genkin)
Date: Fri Jan  9 21:59:46 2004
Subject: [mod_python] Solaris 8...
In-Reply-To: <006301c2948a$fa13e240$3dd05c9d@sis.rec.uba.ar> ("Javier
 Quinteros"'s message of "Mon, 25 Nov 2002 11:00:13 -0300")
References: <006301c2948a$fa13e240$3dd05c9d@sis.rec.uba.ar>
Message-ID: <uo4ra55oza.fsf@bashful.cdf.toronto.edu>

"Javier Quinteros" <jquinte@fadu.uba.ar> writes:

> Has anyone been able to compile and install modpython in a Solaris 8 OS

Yes, I have version 2.7.8 compiled, installed and working under
Solaris 8/Sparc with Apache 1.3.27.  I had to install Python with
threads turned off in a separate location; apart from that, everything
was quite easy.  Here are my install notes:

,----[ mod_python ]
|   - env PATH=/opt/python_threadless/bin:$PATH \
|         ./configure --with-apxs=/opt/apache/bin/apxs
|   - make
|   - make install
`----

Python 2.2.2 was installed with the following config options:
--prefix=/opt/python_threadless --without-threads .

I can't claim that this is the optimal configuration, but this seems
to have worked for me.

Hope this helps,
-- 
Arcady Genkin : CDF Systems Administrator
http://www.cdf.toronto.edu/~agenkin/contact.html

guilt is the cause of more disauders
than history's most obscene marorders (E.E. Cummings)

From markusjais at yahoo.de  Tue Nov 26 00:12:46 2002
From: markusjais at yahoo.de (Markus Jais)
Date: Fri Jan  9 21:59:46 2004
Subject: [mod_python] another beginners question: problem with <Location> directive
Message-ID: <1038265968.2605.3.camel@eagle>

hello
I have the example from the tutorial

from mod_python import apache

def handler(req):
    req.content_type = "text/html"
    req.send_http_header()
    req.write("Eagles are great")
    return apache.OK

and this setup

<Directory /var/www/html/python> 
  AddHandler python-program .py
  PythonHandler mptest 
  PythonDebug On 
</Directory>


this works fine.

but when I change the <Directory> directive to
----
<Location /python> 
  AddHandler python-program .py
  PythonHandler mptest 
  PythonDebug On 
</Location>
---
I get this error in my apache logfile:
[Tue Nov 26 00:07:18 2002] [notice] mod_python: (Re)importing mptest from None
[Tue Nov 26 00:07:18 2002] [error] PythonHandler mptest: Traceback (most recent call last):
[Tue Nov 26 00:07:18 2002] [error] PythonHandler mptest:   File "/usr/local/lib/python2.2/site-packages/mod_python/apache.py", line 181, in Dispatch
    module = import_module(module_name, _req)
[Tue Nov 26 00:07:18 2002] [error] PythonHandler mptest:   File "/usr/local/lib/python2.2/site-packages/mod_python/apache.py", line 332, in import_module
    f, p, d = imp.find_module(parts[i], path)
[Tue Nov 26 00:07:18 2002] [error] PythonHandler mptest: ImportError: No module named mptest


I am using python 2.2.2, modpython 2.7.8 and apache 1.3.23 (rpm version for redhat 7.3)

markus



__________________________________________________________________

Gesendet von Yahoo! Mail - http://mail.yahoo.de
Möchten Sie mit einem Gruß antworten? http://grusskarten.yahoo.de

From grisha at modpython.org  Wed Nov 27 18:55:46 2002
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:59:46 2004
Subject: [mod_python] another beginners question: problem with <Location>
 directive
In-Reply-To: <1038265968.2605.3.camel@eagle>
Message-ID: <20021127185210.U41427-100000@eden.ispol.com>

Mod_python adds the directory to sys.path for you, this is how Python
finds the script. But when you <Location> there is no way for mod_python
to know what to add to sys.path, so you have to do it explicitely, using
the PythonPath directive, try this:

<Location /python>
  AddHandler python-program .py
  PythonHandler mptest
  PythonPath "['/var/www/html/python']+sys.path"
  PythonDebug On
</Location>

Grisha

On 26 Nov 2002, Markus Jais wrote:

> hello
> I have the example from the tutorial
>
> from mod_python import apache
>
> def handler(req):
>     req.content_type = "text/html"
>     req.send_http_header()
>     req.write("Eagles are great")
>     return apache.OK
>
> and this setup
>
> <Directory /var/www/html/python>
>   AddHandler python-program .py
>   PythonHandler mptest
>   PythonDebug On
> </Directory>
>
>
> this works fine.
>
> but when I change the <Directory> directive to
> ----
> <Location /python>
>   AddHandler python-program .py
>   PythonHandler mptest
>   PythonDebug On
> </Location>
> ---
> I get this error in my apache logfile:
> [Tue Nov 26 00:07:18 2002] [notice] mod_python: (Re)importing mptest from None
> [Tue Nov 26 00:07:18 2002] [error] PythonHandler mptest: Traceback (most recent call last):
> [Tue Nov 26 00:07:18 2002] [error] PythonHandler mptest:   File "/usr/local/lib/python2.2/site-packages/mod_python/apache.py", line 181, in Dispatch
>     module = import_module(module_name, _req)
> [Tue Nov 26 00:07:18 2002] [error] PythonHandler mptest:   File "/usr/local/lib/python2.2/site-packages/mod_python/apache.py", line 332, in import_module
>     f, p, d = imp.find_module(parts[i], path)
> [Tue Nov 26 00:07:18 2002] [error] PythonHandler mptest: ImportError: No module named mptest
>
>
> I am using python 2.2.2, modpython 2.7.8 and apache 1.3.23 (rpm version for redhat 7.3)
>
> markus
>
>
>
> __________________________________________________________________
>
> Gesendet von Yahoo! Mail - http://mail.yahoo.de
> M?chten Sie mit einem Gru? antworten? http://grusskarten.yahoo.de
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
>


From Morten.Tryfoss at 1880nummeropplysning.no  Thu Nov 28 19:16:07 2002
From: Morten.Tryfoss at 1880nummeropplysning.no (Morten Tryfoss)
Date: Fri Jan  9 21:59:46 2004
Subject: SV: SV: SV: [mod_python] Problem with mod_python3.0(beta4),python2.2.1and apache 2.0.43
Message-ID: <07411F6A634E5445AEF010C58590F2FB636581@exchangeone.kristiansand.viadial.no>

This is the strace output from apache when it segfaults:

[pid  1577] <... accept resumed> {sin_family=AF_INET6, sin6_port=htons(3101), inet_pton(AF_INET6, "::ffff:62.73.255.77", &sin6_addr), sin6_flowinfo=0, sin6_scope_id=0}, [28]) = 8
[pid  1577] getsockname(8, {sin_family=AF_INET6, sin6_port=htons(80), inet_pton(AF_INET6, "::ffff:212.125.195.9", &sin6_addr), sin6_flowinfo=0, sin6_scope_id=0}, [28]) = 0
[pid  1577] fcntl64(8, F_GETFL)         = 0x2 (flags O_RDWR)
[pid  1577] fcntl64(8, F_SETFL, O_RDWR|O_NONBLOCK) = 0
[pid  1577] read(8, 0x81a0f50, 8000)    = -1 EAGAIN (Resource temporarily unavailable)
[pid  1577] poll([{fd=8, events=POLLIN, revents=POLLIN}], 1, 300000) = 1
[pid  1577] read(8, "GET / HTTP/1.1\r\nAccept: image/gi"..., 8000) = 288
[pid  1577] gettimeofday({1038506716, 88342}, NULL) = 0
[pid  1577] stat64("/usr/local/apache/htdocs/", {st_mode=S_IFDIR|0755, st_size=4096, ...}) = 0
[pid  1577] stat64("/usr/local/apache/htdocs/dses/login/login.py", {st_mode=S_IFREG|0444, st_size=4285, ...}) = 0
[pid  1577] stat64("/usr/local/apache/htdocs/dses/login/login.py", {st_mode=S_IFREG|0444, st_size=4285, ...}) = 0
[pid  1577] stat64("/usr/local/apache/htdocs/dses/login/login.py", {st_mode=S_IFREG|0444, st_size=4285, ...}) = 0
[pid  1577] stat64("/usr/local/apache/htdocs/dses/login/login.p", 0xbfffda6c) = -1 ENOENT (No such file or directory)
[pid  1577] --- SIGSEGV (Segmentation fault) ---
[pid  1574] <... select resumed> )      = ? ERESTARTNOHAND (To be restarted)
[pid  1574] --- SIGCHLD (Child exited) ---
[pid  1574] select(0, NULL, NULL, NULL, {0, 720000}) = 0 (Timeout)
[pid  1574] wait4(-1, [WIFSIGNALED(s) && WTERMSIG(s) == SIGSEGV], WNOHANG|WUNTRACED, NULL) = 1577
[pid  1574] gettimeofday({1038506716, 808246}, NULL) = 0
[pid  1574] write(7, "[Thu Nov 28 19:05:16 2002] [noti"..., 87) = 87

Any thoughts?

Morten

-----Opprinnelig melding-----
Fra: Gregory (Grisha) Trubetskoy [mailto:grisha@modpython.org]
Sendt: 5. november 2002 21:38
Til: Morten Tryfoss
Emne: Re: SV: SV: [mod_python] Problem with
mod_python3.0(beta4),python2.2.1and apache 2.0.43



It's impossible to tell what's going on based on these logs... What would
really help me track the problem down is knowing which line(s) of Python
code in your scripts cause this. You can try writing something to the logs
throughout the code to see where exactly it segfaults.

On Tue, 5 Nov 2002, Morten Tryfoss wrote:

> Now I've tried to upgrade Python, and it still segfaults.
>
> Here's some lines from apache's error_log:
>
> [Tue Nov 05 20:51:21 2002] [notice] child pid 29905 exit signal Segmentation fault (11)
> [Tue Nov 05 20:51:56 2002] [info] (104)Connection reset by peer: core_output_filter: writing data to the network
> [Tue Nov 05 20:51:56 2002] [info] (32)Broken pipe: core_output_filter: writing data to the network
> [Tue Nov 05 20:53:08 2002] [notice] child pid 29995 exit signal Segmentation fault (11)
> [Tue Nov 05 20:56:24 2002] [info] (104)Connection reset by peer: core_output_filter: writing data to the network
> [Tue Nov 05 20:56:24 2002] [info] (32)Broken pipe: core_output_filter: writing data to the network
>
> Is it possible that the scripts are the reason for this? (It worked fine on earlier versions of apache/mod_python).
>
>
>
> Morten
>
> -----Opprinnelig melding-----
> Fra: Gregory (Grisha) Trubetskoy [mailto:grisha@modpython.org]
> Sendt: 5. november 2002 20:20
> Til: Morten Tryfoss
> Kopi: mod_python@modpython.org
> Emne: Re: SV: [mod_python] Problem with mod_python3.0(beta4),
> python2.2.1and apache 2.0.43
>
>
>
> The first thing I would try is upgrading to Python 2.2.2. If that doesn't
> solve it, then you need to try to figure out a way to replicate this
> issue, which is easier said than done. So far I haven't had any segfault
> reports for BETA4, so I have no other info to relate this to.
>
> Grisha
>
> On Tue, 5 Nov 2002, Morten Tryfoss wrote:
>
> > SuSE Linux 8.0 (2.4.18)
> >
> > Morten
> >
> > -----Opprinnelig melding-----
> > Fra: Gregory (Grisha) Trubetskoy [mailto:grisha@modpython.org]
> > Sendt: 5. november 2002 19:49
> > Til: Morten Tryfoss
> > Emne: Re: [mod_python] Problem with mod_python3.0(beta4), python
> > 2.2.1and apache 2.0.43
> >
> >
> >
> > Morten - what's your operating system?
> >
> > On Tue, 5 Nov 2002, Morten Tryfoss wrote:
> >
> > >
> > > I start my server up, and everything works ok. But after av while(when
> > > the number of clients raise) some of the apache childs segfaults. Users
> > > who are running on their persistent connections may still use the
> > > server, but new connections are dropped. Any thoughts of what may be
> > > wrong?
> > >
> > > Currently I'm running apache 1.3.x, but some part of my scripts performs
> > > poorly. Running them on apache 2.0 improved a lot (as long as the server
> > > didn't crash).
> > >
> > >
> > > Morten Tryfoss
> > >
> > > _______________________________________________
> > > Mod_python mailing list
> > > Mod_python@modpython.org
> > > http://www.modpython.org/mailman/listinfo/mod_python
> > >
> >
> >
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://www.modpython.org/mailman/listinfo/mod_python
> >
>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
>



From francoislepoutre at compuserve.com  Fri Nov 29 10:38:12 2002
From: francoislepoutre at compuserve.com (francois lepoutre)
Date: Fri Jan  9 21:59:46 2004
Subject: [mod_python] some remarks, a few questions and
Message-ID: <001701c2978b$08c8f070$bd6e4351@mixio7jpsmlatx>

Hi all modpython users,

First modpython is plain great.We like some much
and even more so as an apache project :)

Thanks Grisha and all.

I just moved a couple of thousand lines of python from 
apache 1.3.27/modpython 2.7.4/python 2.1.1 (w2k) 
into apache 2.0.43/modpython 3.0.1/python 2.2.2 (w2k)

Some remarks:
1) INSTALLATION ON WIN32 WAS A SNAP, GREAT.
Automation has significantly improved for all components
Thanks to the apache and python communities 

2) The new install run exactly in the same way.
Perf and behaviour are nearly identical... that's both good 
(because every thing works ok) and mixed feeling 
(why change version). But we are not specifically 
looking for performance improvement anyway.

I hope that *nix apache users are feeling some perf 
improvements because of the new fork+thread model. 
Win32 runs the same. At least for us.

Now a few questions at this stage:
When running the old stuff (modpython 2.7) we maintained
two distinct series of modpython code:
- one plain simple set of routines for forking *nix (for a RH customers),
- win32-specific code with thread-mngt stuff (and connection pooling)
for various w2k set-ups.

We like the idea of a unified programming model a lot :)

With the new Apache2/modpython3 model can we expect :
- to run thread-enabled python on both environments (*nix and win32)?
- to run the same code (with thread-caring stuff) in both environment? 
- the thread-management routines to be of any use on *nix setups 
if they use a mixed "fork+thread" apache model?

Is this model fork+thread of any use or interest for modpython users?
I'm no python expert but have some doubt about the latest in view
of the way python runs its own threading stuff.

In the end a bug report (did i miss something on the apache 2 config.?).
The code below will work on 2.7.* and break on 3.0.1 (W2K).

from mod_python import apache

def handler(req):
    req.write("Your local address:%s %i" % \
    (req.connection.local_addr[0],req.connection.local_addr[1]))
     return apache.OK

Regards

Francois


From markusjais at yahoo.de  Tue Nov 26 00:19:02 2002
From: markusjais at yahoo.de (Markus Jais)
Date: Fri Jan  9 21:59:46 2004
Subject: [mod_python] software using mod_python ?
Message-ID: <1038266344.2698.0.camel@eagle>

hello
are there any open source python modules who are using
mod python ?
I would like to see some code with mod_python in action
to learn more about it.

markus



__________________________________________________________________

Gesendet von Yahoo! Mail - http://mail.yahoo.de
Yahoo! präsentiert als offizieller Sponsor das Fußball-Highlight des
Jahres: - http://www.FIFAworldcup.com

From mark_messer at calypso.com  Sat Nov 30 14:11:42 2002
From: mark_messer at calypso.com (Mark Messer)
Date: Fri Jan  9 21:59:46 2004
Subject: [mod_python] can't find mod_python.so
Message-ID: <00d701c298bd$772ffdf0$b27ba8c0@ZEUS>

I put mod_python.so into the modules directory, but I get an error when
starting Apache:

C:\tools\Apache2\bin>apache
Syntax error on line 173 of C:/tools/Apache2/conf/httpd.conf:
Cannot load C:/tools/Apache2/modules/mod_python.so into server: The
specified module could not be found.

I added this to the LoadModule section of httpd.conf:  LoadModule
python_module modules/mod_python.so

Here's the directory listing:
C:\tools\Apache2\modules>ls -al mod_p*
-rwxrwx---    1 Administ SYSTEM      40960 Oct  3 06:58 mod_proxy.so
-rwxrwx---    1 Administ SYSTEM      20480 Oct  3 06:58 mod_proxy_connect.so
-rwxrwx---    1 Administ SYSTEM      28672 Oct  3 06:58 mod_proxy_ftp.so
-rwxrwx---    1 Administ SYSTEM      24576 Oct  3 06:58 mod_proxy_http.so
-rwxrwx---    1 Administ SYSTEM      65536 Nov 26 17:49 mod_python.so

I am running mod_python 3.0.1, Python 2.2.2, Apache 2.0.43, Windows XP
Professional.   Tried changing perms and ownership to match what was there,
but that did not work.



From grisha at modpython.org  Sat Nov 30 23:06:10 2002
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:59:46 2004
Subject: [mod_python] can't find mod_python.so
In-Reply-To: <00d701c298bd$772ffdf0$b27ba8c0@ZEUS>
Message-ID: <20021130230513.T83360-100000@eden.ispol.com>

This is possibly because the mod_python.so that is out there is for Python
2.2.1. I don't have one for 2.2.2 compiled (yet).

Grisha

On Sat, 30 Nov 2002, Mark Messer wrote:

> I put mod_python.so into the modules directory, but I get an error when
> starting Apache:
>
> C:\tools\Apache2\bin>apache
> Syntax error on line 173 of C:/tools/Apache2/conf/httpd.conf:
> Cannot load C:/tools/Apache2/modules/mod_python.so into server: The
> specified module could not be found.
>
> I added this to the LoadModule section of httpd.conf:  LoadModule
> python_module modules/mod_python.so
>
> Here's the directory listing:
> C:\tools\Apache2\modules>ls -al mod_p*
> -rwxrwx---    1 Administ SYSTEM      40960 Oct  3 06:58 mod_proxy.so
> -rwxrwx---    1 Administ SYSTEM      20480 Oct  3 06:58 mod_proxy_connect.so
> -rwxrwx---    1 Administ SYSTEM      28672 Oct  3 06:58 mod_proxy_ftp.so
> -rwxrwx---    1 Administ SYSTEM      24576 Oct  3 06:58 mod_proxy_http.so
> -rwxrwx---    1 Administ SYSTEM      65536 Nov 26 17:49 mod_python.so
>
> I am running mod_python 3.0.1, Python 2.2.2, Apache 2.0.43, Windows XP
> Professional.   Tried changing perms and ownership to match what was there,
> but that did not work.
>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
>


From markusjais at yahoo.de  Tue Nov 26 21:29:38 2002
From: markusjais at yahoo.de (Markus Jais)
Date: Fri Jan  9 21:59:46 2004
Subject: [mod_python] another beginners question: problem with <Location> directive
Message-ID: <1038342581.1928.3.camel@eagle>

hello
I already sent this message yesterday but somehow it didn't reach
the list.


I have the example from the tutorial

from mod_python import apache

def handler(req):
    req.content_type = "text/html"
    req.send_http_header()
    req.write("Eagles are great")
    return apache.OK


and this setup

<Directory /var/www/html/python> 
  AddHandler python-program .py
  PythonHandler mptest 
  PythonDebug On 
</Directory>


this works fine.

but when I change the <Directory> directive to
----
<Location /python> 
  AddHandler python-program .py
  PythonHandler mptest 
  PythonDebug On 
</Location>
---
I get this error in my apache logfile:
[Tue Nov 26 00:07:18 2002] [notice] mod_python: (Re)importing mptest from None
[Tue Nov 26 00:07:18 2002] [error] PythonHandler mptest: Traceback (most recent call last):
[Tue Nov 26 00:07:18 2002] [error] PythonHandler mptest:   File "/usr/local/lib/python2.2/site-packages/mod_python/apache.py", line 181, in Dispatch
    module = import_module(module_name, _req)
[Tue Nov 26 00:07:18 2002] [error] PythonHandler mptest:   File "/usr/local/lib/python2.2/site-packages/mod_python/apache.py", line 332, in import_module
    f, p, d = imp.find_module(parts[i], path)
[Tue Nov 26 00:07:18 2002] [error] PythonHandler mptest: ImportError: No module named mptest


I am using python 2.2.2, modpython 2.7.8 and apache 1.3.23 (rpm version for redhat 7.3)

markus



__________________________________________________________________

Gesendet von Yahoo! Mail - http://mail.yahoo.de
Yahoo! präsentiert als offizieller Sponsor das Fußball-Highlight des
Jahres: - http://www.FIFAworldcup.com

From grisha at apache.org  Wed Nov 27 14:37:33 2002
From: grisha at apache.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:59:46 2004
Subject: [mod_python] ANNOUNCE: Mod_python 3.0.1
Message-ID: <20021127135855.Q36516-100000@eden.ispol.com>

The Apache Software Foundation and The Apache HTTP Server Project are
pleased to announce the release of mod_python 3.0.1.

Mod_python is an Apache HTTP Server module that embeds the Python
interpreter within the server. With mod_python you can write web-based
applications in Python that will run many times faster than traditional
CGI and will have access to advanced features such as ability to retain
database connections between requests, access to httpd internals and
provide content filter as well as connection handlers.

This is the first release of mod_python as a subproject of the Apache HTTP
Server Project, as well as a major milestone accomplishment finally
bringing compatibility with Apache 2.0.

This release increments the major version to 3. The major version
increment is to denote that this release is only compatible with Apache
httpd server 2.0 and Python 2.2 or later and is not fully backwards
compatible with previous versions of mod_python. For details on migrating
code from previous versions of mod_python, as well as a list of new
featurs, see the README file in the distribution.

Mod_python is available for download from:

http://www.apache.org/dist/httpd/modpython/

For more information about mod_python visit
http://www.modpython.org/

Enjoy, and Happy Thanksgiving to those in the US!

Grisha Trubetskoy



From Antonio at memora.com  Sun Nov 24 19:48:11 2002
From: Antonio at memora.com (Antonio Rodriguez)
Date: Fri Jan  9 21:59:46 2004
Subject: [mod_python] beginners question
References: <1038180652.3173.2.camel@eagle>
Message-ID: <001f01c29a3b$e92ddc40$6401a8c0@darwin>

Markus,

Go into the src directory of the dist and in the OPTIONS= line add -DEAPI.
apxs will do the right thing and you will stop getting that warning.

Heads up on having threads compiled in. I asked the list what the
ramifications of this were going to be (besides total crashes which don't
seem to happen if you don't explictly use threads) a few weeks ago but have
gotten no answers. I might recompile without threads.

Antonio

----- Original Message -----
From: "Markus Jais" <markusjais@yahoo.de>
To: <mod_python@modpython.org>
Sent: Sunday, November 24, 2002 6:30 PM
Subject: [mod_python] beginners question


Hello
I have just installed mod_python 2.7.8 for my
apache 1.3.23

I have python 2.2.2 (with threads) on a RedHat 7.3 system.

compilation was no problem but when I restart apache I get

Starting httpd: [Mon Nov 25 00:26:41 2002] [warn] Loaded DSO
modules/mod_python.so uses plain Apache 1.3 API, this module might crash
under EAPI! (please recompile it with -DEAPI)


what does this mean?? I found EAPI not mentioned in the sources.

markus




__________________________________________________________________

Gesendet von Yahoo! Mail - http://mail.yahoo.de
M?chten Sie mit einem Gru? antworten? http://grusskarten.yahoo.de
_______________________________________________
Mod_python mailing list
Mod_python@modpython.org
http://www.modpython.org/mailman/listinfo/mod_python




From jfk at metation.com  Fri Nov  1 09:20:16 2002
From: jfk at metation.com (Jørgen Frøjk Kjærsgaard)
Date: Fri Jan  9 22:03:33 2004
Subject: [mod_python] Lifecycle of mod_python instances
In-Reply-To: <BB355965-ED1C-11D6-9578-00039300D690@memora.com>
References: <BB355965-ED1C-11D6-9578-00039300D690@memora.com>
Message-ID: <20021101072016.M33334@metation.com>

On Thu, 31 Oct 2002 17:04:30 -0500, Antonio L Rodriguez wrote
> Forgive me if this is more of an apache process question, but I 
> couldn't find it covered clearly in the docs.
> 
> When apache boots up (on *NIX) its starts a bunch of children 
> processes. Does each child have its own separate image of mod_python 
> execution space that is totally separate from the other images?

Correct. Apache 1.3 starts a process per simultaneous request it can handle.
Apache 2.0 is capable of running in threaded mode where the threads share
memory and thus can have global shared variables. I have no experience with
2.0 so far, though. See the documentation for Apache, in particular
http://httpd.apache.org/docs/mod/core.html#maxclients for 1.3 and
http://httpd.apache.org/docs-2.0/mod/mpm_common.html#maxclients for 2.0.

> That is, if I define a global var to measure hit counts in a script 
> and then I see this var dance up and down as each of the child 
> processes handles the request, do I infer correctly that there are 
> separate python interpreters living inside of each child process?

Exactly. You never know which process the next request will hit.

> If this is so, I'd be curious how people do global data structures 
> in this model, i.e. a database connection pool.

Truely global data with Apache 1.3 requires some kind of shared memory, which
isn't supported by mod_python. I use one database connection per child. This
works well, but of cause, if you configure your Apache to run with a lot of
idle children, you'll have a lot of idle connections. If your database system
has a limit as to how many simultaneous connections it can handle, be sure you
don't hit that limit. Raise it or limit the number of Apache processes.

/jfk

--
J?rgen Fr?jk Kj?rsgaard
Metation ApS - the system integrators
Kystvejen 29 - DK 8000 ?rhus C - www.metation.com

From conrad at hep.caltech.edu  Fri Nov  1 14:39:55 2002
From: conrad at hep.caltech.edu (Conrad Steenberg)
Date: Fri Jan  9 22:03:34 2004
Subject: [mod_python] Lifecycle of mod_python instances
In-Reply-To: <20021101072016.M33334@metation.com>
References: <BB355965-ED1C-11D6-9578-00039300D690@memora.com> 
	<20021101072016.M33334@metation.com>
Message-ID: <1036190396.1708.335.camel@heppc22.hep.caltech.edu>

Hi

Just my 2c: 

Using Berkeley DB works great for small things like counters and other
small pieces of persistent data. It is already installed on most
systems, so all you need is the Python binding from
http://pybsddb.sourceforge.net/

You can open a connection to the DB and store it as a global variable in
your mod_python script when the script is imported - i.e. not within the
handler. You can use e.g. cookies to identify connections.

HTH

COnrad

On Thu, 2002-10-31 at 23:20, J?rgen Fr?jk Kj?rsgaard wrote:
> On Thu, 31 Oct 2002 17:04:30 -0500, Antonio L Rodriguez wrote
> > Forgive me if this is more of an apache process question, but I 
> > couldn't find it covered clearly in the docs.
> > 
> > When apache boots up (on *NIX) its starts a bunch of children 
> > processes. Does each child have its own separate image of mod_python 
> > execution space that is totally separate from the other images?
> 
> Correct. Apache 1.3 starts a process per simultaneous request it can handle.
> Apache 2.0 is capable of running in threaded mode where the threads share
> memory and thus can have global shared variables. I have no experience with
> 2.0 so far, though. See the documentation for Apache, in particular
> http://httpd.apache.org/docs/mod/core.html#maxclients for 1.3 and
> http://httpd.apache.org/docs-2.0/mod/mpm_common.html#maxclients for 2.0.
> 
> > That is, if I define a global var to measure hit counts in a script 
> > and then I see this var dance up and down as each of the child 
> > processes handles the request, do I infer correctly that there are 
> > separate python interpreters living inside of each child process?
> 
> Exactly. You never know which process the next request will hit.
> 
> > If this is so, I'd be curious how people do global data structures 
> > in this model, i.e. a database connection pool.
> 
> Truely global data with Apache 1.3 requires some kind of shared memory, which
> isn't supported by mod_python. I use one database connection per child. This
> works well, but of cause, if you configure your Apache to run with a lot of
> idle children, you'll have a lot of idle connections. If your database system
> has a limit as to how many simultaneous connections it can handle, be sure you
> don't hit that limit. Raise it or limit the number of Apache processes.
> 
> /jfk
> 
> --
> J?rgen Fr?jk Kj?rsgaard
> Metation ApS - the system integrators
> Kystvejen 29 - DK 8000 ?rhus C - www.metation.com
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
-- 
*-----------------------------------------*
| Conrad Steenberg                        |
| Caltech, Mail Code 356-48               |
| Pasadena, CA, 91125                     |
| e-mail: conrad@hep.caltech.edu          |
| Tel: (626) 395-8758                     |
*-----------------------------------------*



From john at journyx.com  Sat Nov  2 14:43:24 2002
From: john at journyx.com (John Maddalozzo)
Date: Fri Jan  9 22:03:34 2004
Subject: [mod_python] mod_python on AIX
Message-ID: <Pine.LNX.4.21.0211021439420.7229-100000@dev1.int.journyx.com>

Has anyone been successful at building mod_python support on AIX? It
worked at one time but now on Apache 1.3.27, Python 2.1 and the
latest mod_python I have been unable to get it to run without
httpd core dumping when handling a request (running the mptest.py
program). Python/http calls out to load the stropmodule which gets loaded
as a shared library and then stop calls back to Py_InitModule4().
But it looks like it is trying to jump to an address in the shared
library instead of resolving Py_InitModule4 in libpython2.1.a.
I've had the same problem on both AIX 4.3.3 and 5.1.

If you've been successful at getting mod_python working with any
combination of software on AIX I'd sure like to find out what the trick
is. 

Thanks, John



From Morten.Tryfoss at 1880nummeropplysning.no  Tue Nov  5 19:24:05 2002
From: Morten.Tryfoss at 1880nummeropplysning.no (Morten Tryfoss)
Date: Fri Jan  9 22:03:34 2004
Subject: [mod_python] Problem with mod_python3.0(beta4), python 2.2.1 and apache 2.0.43
Message-ID: <07411F6A634E5445AEF010C58590F2FB665A3A@exchangeone.kristiansand.viadial.no>

I start my server up, and everything works ok. But after av while(when the number of clients raise) some of the apache childs segfaults. Users who are running on their persistent connections may still use the server, but new connections are dropped. Any thoughts of what may be wrong?

Currently I'm running apache 1.3.x, but some part of my scripts performs poorly. Running them on apache 2.0 improved a lot (as long as the server didn't crash).


Morten Tryfoss


From Morten.Tryfoss at 1880nummeropplysning.no  Tue Nov  5 19:48:36 2002
From: Morten.Tryfoss at 1880nummeropplysning.no (Morten Tryfoss)
Date: Fri Jan  9 22:03:34 2004
Subject: SV: [mod_python] Problem with mod_python3.0(beta4), python 2.2.1and apache 2.0.43
Message-ID: <07411F6A634E5445AEF010C58590F2FB63655D@exchangeone.kristiansand.viadial.no>

SuSE Linux 8.0 (2.4.18)

Morten

-----Opprinnelig melding-----
Fra: Gregory (Grisha) Trubetskoy [mailto:grisha@modpython.org]
Sendt: 5. november 2002 19:49
Til: Morten Tryfoss
Emne: Re: [mod_python] Problem with mod_python3.0(beta4), python
2.2.1and apache 2.0.43



Morten - what's your operating system?

On Tue, 5 Nov 2002, Morten Tryfoss wrote:

>
> I start my server up, and everything works ok. But after av while(when
> the number of clients raise) some of the apache childs segfaults. Users
> who are running on their persistent connections may still use the
> server, but new connections are dropped. Any thoughts of what may be
> wrong?
>
> Currently I'm running apache 1.3.x, but some part of my scripts performs
> poorly. Running them on apache 2.0 improved a lot (as long as the server
> didn't crash).
>
>
> Morten Tryfoss
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
>



From grisha at modpython.org  Tue Nov  5 14:19:35 2002
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 22:03:34 2004
Subject: SV: [mod_python] Problem with mod_python3.0(beta4), python
 2.2.1and apache 2.0.43
In-Reply-To: <07411F6A634E5445AEF010C58590F2FB63655D@exchangeone.kristiansand.viadial.no>
Message-ID: <20021105141658.M32052-100000@eden.ispol.com>

The first thing I would try is upgrading to Python 2.2.2. If that doesn't
solve it, then you need to try to figure out a way to replicate this
issue, which is easier said than done. So far I haven't had any segfault
reports for BETA4, so I have no other info to relate this to.

Grisha

On Tue, 5 Nov 2002, Morten Tryfoss wrote:

> SuSE Linux 8.0 (2.4.18)
>
> Morten
>
> -----Opprinnelig melding-----
> Fra: Gregory (Grisha) Trubetskoy [mailto:grisha@modpython.org]
> Sendt: 5. november 2002 19:49
> Til: Morten Tryfoss
> Emne: Re: [mod_python] Problem with mod_python3.0(beta4), python
> 2.2.1and apache 2.0.43
>
>
>
> Morten - what's your operating system?
>
> On Tue, 5 Nov 2002, Morten Tryfoss wrote:
>
> >
> > I start my server up, and everything works ok. But after av while(when
> > the number of clients raise) some of the apache childs segfaults. Users
> > who are running on their persistent connections may still use the
> > server, but new connections are dropped. Any thoughts of what may be
> > wrong?
> >
> > Currently I'm running apache 1.3.x, but some part of my scripts performs
> > poorly. Running them on apache 2.0 improved a lot (as long as the server
> > didn't crash).
> >
> >
> > Morten Tryfoss
> >
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://www.modpython.org/mailman/listinfo/mod_python
> >
>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
>


From Morten.Tryfoss at 1880nummeropplysning.no  Tue Nov  5 20:58:51 2002
From: Morten.Tryfoss at 1880nummeropplysning.no (Morten Tryfoss)
Date: Fri Jan  9 22:03:34 2004
Subject: SV: SV: [mod_python] Problem with mod_python3.0(beta4), python2.2.1and apache 2.0.43
Message-ID: <07411F6A634E5445AEF010C58590F2FB63655E@exchangeone.kristiansand.viadial.no>

Now I've tried to upgrade Python, and it still segfaults.

Here's some lines from apache's error_log:

[Tue Nov 05 20:51:21 2002] [notice] child pid 29905 exit signal Segmentation fault (11)
[Tue Nov 05 20:51:56 2002] [info] (104)Connection reset by peer: core_output_filter: writing data to the network
[Tue Nov 05 20:51:56 2002] [info] (32)Broken pipe: core_output_filter: writing data to the network
[Tue Nov 05 20:53:08 2002] [notice] child pid 29995 exit signal Segmentation fault (11)
[Tue Nov 05 20:56:24 2002] [info] (104)Connection reset by peer: core_output_filter: writing data to the network
[Tue Nov 05 20:56:24 2002] [info] (32)Broken pipe: core_output_filter: writing data to the network

Is it possible that the scripts are the reason for this? (It worked fine on earlier versions of apache/mod_python).



Morten

-----Opprinnelig melding-----
Fra: Gregory (Grisha) Trubetskoy [mailto:grisha@modpython.org]
Sendt: 5. november 2002 20:20
Til: Morten Tryfoss
Kopi: mod_python@modpython.org
Emne: Re: SV: [mod_python] Problem with mod_python3.0(beta4),
python2.2.1and apache 2.0.43



The first thing I would try is upgrading to Python 2.2.2. If that doesn't
solve it, then you need to try to figure out a way to replicate this
issue, which is easier said than done. So far I haven't had any segfault
reports for BETA4, so I have no other info to relate this to.

Grisha

On Tue, 5 Nov 2002, Morten Tryfoss wrote:

> SuSE Linux 8.0 (2.4.18)
>
> Morten
>
> -----Opprinnelig melding-----
> Fra: Gregory (Grisha) Trubetskoy [mailto:grisha@modpython.org]
> Sendt: 5. november 2002 19:49
> Til: Morten Tryfoss
> Emne: Re: [mod_python] Problem with mod_python3.0(beta4), python
> 2.2.1and apache 2.0.43
>
>
>
> Morten - what's your operating system?
>
> On Tue, 5 Nov 2002, Morten Tryfoss wrote:
>
> >
> > I start my server up, and everything works ok. But after av while(when
> > the number of clients raise) some of the apache childs segfaults. Users
> > who are running on their persistent connections may still use the
> > server, but new connections are dropped. Any thoughts of what may be
> > wrong?
> >
> > Currently I'm running apache 1.3.x, but some part of my scripts performs
> > poorly. Running them on apache 2.0 improved a lot (as long as the server
> > didn't crash).
> >
> >
> > Morten Tryfoss
> >
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://www.modpython.org/mailman/listinfo/mod_python
> >
>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
>



From glunsford at monbar.com  Wed Nov  6 14:22:42 2002
From: glunsford at monbar.com (George Lunsford)
Date: Fri Jan  9 22:03:34 2004
Subject: [mod_python] mod_python & apache config issues
Message-ID: <52E5514ECBC5D611B3E100D0B7B84F5A24CE85@EXCHMAIL>

For the past few days I've been experimenting with installing mod_python
2.7.8 on an Apache 1.3.22 server that was from the standard Caldera
OpenLinux 3.1.1 install.  First, I installed the Python interpreter v 2.1.3,
then I tried installing mod_python, and I ran into the whole threading
issue.  I recompiled Python 2.1.3 without threads, and put it in
/usr/local/web/.  I ran into the EAPI error, and added the OPT=-DEAPI into
the src/Makefile.  
 
Now whenever I run apache, if I do strace httpd -X, it looks like it's using
my threaded version of Python (in /usr/local/bin, there's a symlink in
/usr/bin/ to it).  I'll try and paste what I think are the relevant lines
below:
 
stat64("/usr/local/sbin/python", 0xbfffe2ac) = -1 ENOENT (No such file or
directory)
stat64("/sbin/python", 0xbfffe2ac)      = -1 ENOENT (No such file or
directory)
stat64("/usr/sbin/python", 0xbfffe2ac)  = -1 ENOENT (No such file or
directory)
stat64("/bin/python", 0xbfffe2ac)       = -1 ENOENT (No such file or
directory)
stat64("/usr/bin/python", {st_mode=S_IFREG|0755, st_size=1469444, ...}) = 0
readlink("/usr/bin/python", "/usr/local/bin/python", 1024) = 21
readlink("/usr/local/bin/python", 0xbfffe434, 1024) = -1 EINVAL (Invalid
argument)
stat64("/usr/local/bin/Modules/Setup", 0xbfffe26c) = -1 ENOENT (No such file
or directory)
stat64("/usr/local/bin/lib/python2.1/os.py", 0xbfffe24c) = -1 ENOENT (No
such file or directory)
stat64("/usr/local/bin/lib/python2.1/os.pyc", 0xbfffe23c) = -1 ENOENT (No
such file or directory)
stat64("/usr/local/lib/python2.1/os.py", {st_mode=S_IFREG|0644,
st_size=17401, ...}) = 0
 
Apache would run, but at the first connection (even just to get the root
index file of a directory, it would segfault.  It doesn't appear to be doing
that anymore, however... now it exits with this error eventually (without
needing to connect to the server):
 
[Wed Nov  6 14:37:58 2002] [crit] (98)Address already in use: make_sock:
could not bind to port 80
 
I was wondering if anyone could give me any advice/help with this issue.
Thanks in advance.
 
George Lunsford
 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mailman.modpython.org/pipermail/mod_python/attachments/20021106/34dbf358/attachment-0003.htm
From conrad at hep.caltech.edu  Fri Nov  8 11:24:56 2002
From: conrad at hep.caltech.edu (Conrad Steenberg)
Date: Fri Jan  9 22:03:34 2004
Subject: [mod_python] Interest in sendfile from mod_python?
Message-ID: <1036783496.6448.491.camel@heppc22.hep.caltech.edu>

Hi

My mod_python application regularly needs to send data from files. This
could be either entire files or parts of files.

The Linux and FreeBSD (I think) sendfile calls make this very easy and
efficient in Apache itself, but there is no way to control this from
within mod_python as far as I can see.

My solution was to build a Python sendfile module (using code from the
Medusa server, under the Python license), and create a patch for
mod_python to get the request file-descriptor to pass to the sendfile
call.

So the question is, is anybody else interested in this? Either for me to
contribute the mod_python patch and sendfile package, or for integration
of these two parts into mod_pyhton itself?

Just thought I'd ask :-)

Conrad

Ps. and if using sendfile from mod_python was doable already please feel
free to tell me how ;-)

-- 
*-----------------------------------------*
| Conrad Steenberg                        |
| Caltech, Mail Code 356-48               |
| Pasadena, CA, 91125                     |
| e-mail: conrad@hep.caltech.edu          |
| Tel: (626) 395-8758                     |
*-----------------------------------------*


From jwyant at sfbcic.com  Fri Nov  8 14:16:01 2002
From: jwyant at sfbcic.com (Wyant, Jaime)
Date: Fri Jan  9 22:03:34 2004
Subject: [mod_python] Grabbing the callback object
Message-ID: <654DAEACA633D511B5F500902784B052188EAA@MS-EXCHANGE>

Hi all!

Is there any way to grab the Callback object?  I really want to override the
"ReportError" method and generate a more meaningful error message with
pretty graphics.

Better yet, is there a way to catch unhandled exceptions and display a
custom error message? 

thanks!

jaime wyant (jwyant@sfbcic . com)
MS Farm Bureau
(601) 977 - 4291



From conrad at hep.caltech.edu  Fri Nov  8 13:31:49 2002
From: conrad at hep.caltech.edu (Conrad Steenberg)
Date: Fri Jan  9 22:03:34 2004
Subject: [mod_python] Grabbing the callback object
In-Reply-To: <654DAEACA633D511B5F500902784B052188EAA@MS-EXCHANGE>
References: <654DAEACA633D511B5F500902784B052188EAA@MS-EXCHANGE>
Message-ID: <1036791109.6448.635.camel@heppc22.hep.caltech.edu>

Hi Jaime

You can write your own error message to the client, and return
apache.DONE to stop Apache from any further processing.

E.g.

def handler(req):
  try:
    <Do some processing>
  except:
    <Write error message, including headers>
    return apache.DONE

  return apache.OK


Cheers!

Conrad

On Fri, 2002-11-08 at 12:16, Wyant, Jaime wrote:
> Hi all!
> 
> Is there any way to grab the Callback object?  I really want to override the
> "ReportError" method and generate a more meaningful error message with
> pretty graphics.
> 
> Better yet, is there a way to catch unhandled exceptions and display a
> custom error message? 
> 
> thanks!
> 
> jaime wyant (jwyant@sfbcic . com)
> MS Farm Bureau
> (601) 977 - 4291
> 
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
-- 
*-----------------------------------------*
| Conrad Steenberg                        |
| Caltech, Mail Code 356-48               |
| Pasadena, CA, 91125                     |
| e-mail: conrad@hep.caltech.edu          |
| Tel: (626) 395-8758                     |
*-----------------------------------------*


From jwyant at sfbcic.com  Fri Nov  8 16:06:58 2002
From: jwyant at sfbcic.com (Wyant, Jaime)
Date: Fri Jan  9 22:03:34 2004
Subject: [mod_python] Grabbing the callback object
Message-ID: <654DAEACA633D511B5F500902784B052188EAD@MS-EXCHANGE>


>>>-----Original Message-----
>>>From: Conrad Steenberg [mailto:conrad@hep.caltech.edu]
>>>Sent: Friday, November 08, 2002 3:32 PM
>>>To: Wyant, Jaime
>>>Cc: 'mod_python@modpython.org'
>>>Subject: Re: [mod_python] Grabbing the callback object
>>>
>>>
>>>Hi Jaime
>>>
>>>You can write your own error message to the client, and return
>>>apache.DONE to stop Apache from any further processing.
>>>
>>>E.g.
>>>
>>>def handler(req):
>>>  try:
>>>    <Do some processing>
>>>  except:
>>>    <Write error message, including headers>
>>>    return apache.DONE
>>>
>>>  return apache.OK
>>>
>>>
>>>Cheers!
>>>
>>>Conrad
>>>

Thanks!  I thought about doing it that way.  Take a peek at a snippet of my
error log:


[Tue Nov  5 07:36:13 2002] [error] PythonHandler mod_python.publisher:
File "/
usr/local/lib/python2.2/site-packages/mod_python/publisher.py", line 88, in
hand
ler
    if func_path[-1] == ".":
[Tue Nov  5 07:36:13 2002] [error] PythonHandler mod_python.publisher:
IndexErro
r: string index out of range
[Tue Nov  5 08:09:44 2002] [error] PythonHandler mod_python.publisher:
Traceback
 (most recent call last):

I'm getting an IndexError in the publisher module.  I have already modified
that module a little bit already and would rather not change it any more.

No, my changes aren't causing the IndexError :).  I simply modified the
handler to "raise apache.SERVER_RETURN, apache.HTTP_NOT_FOUND" when an
ImportError occurred.  This stopped "mostly correct" paths from returning an
"Internal Server Error Message".  I can elaborate if you are curious.

Maybe I could create a wrapper handler for the publisher handler?

# my wrapper

import mod_python.publisher

def handler( req ):
  try:
    return mod_python.publisher.handler( req )    
  except Exception:
    req.write( create_cool_html_error_report() )
    return apache.OK


Thanks!
jaime

>>>On Fri, 2002-11-08 at 12:16, Wyant, Jaime wrote:
>>>> Hi all!
>>>> 
>>>> Is there any way to grab the Callback object?  I really 
>>>want to override the
>>>> "ReportError" method and generate a more meaningful error 
>>>message with
>>>> pretty graphics.
>>>> 
>>>> Better yet, is there a way to catch unhandled exceptions 
>>>and display a
>>>> custom error message? 
>>>> 
>>>> thanks!
>>>> 
>>>> jaime wyant (jwyant@sfbcic . com)
>>>> MS Farm Bureau
>>>> (601) 977 - 4291
>>>> 
>>>> 
>>>> _______________________________________________
>>>> Mod_python mailing list
>>>> Mod_python@modpython.org
>>>> http://www.modpython.org/mailman/listinfo/mod_python
>>>-- 
>>>*-----------------------------------------*
>>>| Conrad Steenberg                        |
>>>| Caltech, Mail Code 356-48               |
>>>| Pasadena, CA, 91125                     |
>>>| e-mail: conrad@hep.caltech.edu          |
>>>| Tel: (626) 395-8758                     |
>>>*-----------------------------------------*
>>>
>>>_______________________________________________
>>>Mod_python mailing list
>>>Mod_python@modpython.org
>>>http://www.modpython.org/mailman/listinfo/mod_python
>>>

From conrad at hep.caltech.edu  Fri Nov  8 14:20:56 2002
From: conrad at hep.caltech.edu (Conrad Steenberg)
Date: Fri Jan  9 22:03:34 2004
Subject: [mod_python] Grabbing the callback object
In-Reply-To: <654DAEACA633D511B5F500902784B052188EAD@MS-EXCHANGE>
References: <654DAEACA633D511B5F500902784B052188EAD@MS-EXCHANGE>
Message-ID: <1036794056.6446.695.camel@heppc22.hep.caltech.edu>

On Fri, 2002-11-08 at 14:06, Wyant, Jaime wrote:
> 
> Maybe I could create a wrapper handler for the publisher handler?
> 
> # my wrapper
> 
> import mod_python.publisher
> 
> def handler( req ):
>   try:
>     return mod_python.publisher.handler( req )    
>   except Exception:
>     req.write( create_cool_html_error_report() )
>     return apache.OK
> 

Yes, for the publisher handler, that sounds rather more sensible. 

Cheers!

Conrad

> 
> >>>On Fri, 2002-11-08 at 12:16, Wyant, Jaime wrote:
> >>>> Hi all!
> >>>> 
> >>>> Is there any way to grab the Callback object?  I really 
> >>>want to override the
> >>>> "ReportError" method and generate a more meaningful error 
> >>>message with
> >>>> pretty graphics.
> >>>> 
> >>>> Better yet, is there a way to catch unhandled exceptions 
> >>>and display a
> >>>> custom error message? 
> >>>> 
> >>>> thanks!
> >>>> 
> >>>> jaime wyant (jwyant@sfbcic . com)
> >>>> MS Farm Bureau
> >>>> (601) 977 - 4291
> >>>> 
> >>>> 



From conrad at hep.caltech.edu  Sat Nov  9 14:17:02 2002
From: conrad at hep.caltech.edu (Conrad Steenberg)
Date: Fri Jan  9 22:03:34 2004
Subject: [mod_python] Interest in sendfile from mod_python?
In-Reply-To: <20021109052035.GZ4761@netvista.mikebell.org>
References: <1036783496.6448.491.camel@heppc22.hep.caltech.edu> 
	<20021109052035.GZ4761@netvista.mikebell.org>
Message-ID: <1036880222.1221.5.camel@192.168.1.100>

Hi Mike

Have a look at sendfilemodule.c in
http://cvs.sourceforge.net/cgi-bin/viewcvs.cgi/clarens/clarens/sendfile/

The patch for mod_python to get the filedescriptor to write to is below.

Cheers!

Conrad

On Fri, 2002-11-08 at 21:20, mike@mikebell.org wrote:
> On Fri, Nov 08, 2002 at 11:24:56AM -0800, Conrad Steenberg wrote:
> > So the question is, is anybody else interested in this? Either for me to
> > contribute the mod_python patch and sendfile package, or for integration
> > of these two parts into mod_pyhton itself?
> 
> I would absolutely be interested. Zero-copy from mod_python, yay. I have
> in fact thought about this in the past but never got around to doing
> anything about it.
--- src/requestobject.c.orig    Tue Jun  4 15:52:45 2002
+++ src/requestobject.c Tue Jun  4 11:15:49 2002
@@ -781,6 +781,27 @@

 }

+/**
+ ** request.get_fd(request self)
+ **
+ *      Returns the file descriptor to write output to
+ */
+
+static PyObject * req_fd(requestobject *self, PyObject *args)
+{
+    PyObject *fd;
+    long thefd;
+    thefd=(long)self->request_rec->connection->client->fd;
+    fd = PyInt_FromLong(thefd);
+    if (!fd) {
+       PyErr_SetString(PyExc_IOError, "Could not determine file descriptor.");
+       return NULL;
+    }
+
static PyMethodDef requestobjectmethods[] = {
     {"add_common_vars",      (PyCFunction) req_add_common_vars,      METH_VARA
     {"add_handler",          (PyCFunction) req_add_handler,          METH_VARA
@@ -797,6 +818,7 @@
     {"register_cleanup",     (PyCFunction) req_register_cleanup,     METH_VARA
     {"send_http_header",     (PyCFunction) req_send_http_header,     METH_VARA
     {"write",                (PyCFunction) req_write,                METH_VARA
+    {"get_fd",               (PyCFunction) req_fd,                   METH_VARA
     { NULL, NULL } /* sentinel */
 };




From conrad at hep.caltech.edu  Sat Nov  9 14:37:02 2002
From: conrad at hep.caltech.edu (Conrad Steenberg)
Date: Fri Jan  9 22:03:34 2004
Subject: [mod_python] Interest in sendfile from mod_python?
In-Reply-To: <1036880222.1221.5.camel@192.168.1.100>
References: <1036783496.6448.491.camel@heppc22.hep.caltech.edu> 
	<20021109052035.GZ4761@netvista.mikebell.org> 
	<1036880222.1221.5.camel@192.168.1.100>
Message-ID: <1036881423.1188.21.camel@192.168.1.100>

Aarghh, take 2 on the patch:

--- src/requestobject.c.orig    Tue Jun  4 15:52:45 2002
+++ src/requestobject.c Tue Jun  4 11:15:49 2002
@@ -781,6 +781,27 @@

 }

+/**
+ ** request.get_fd(request self)
+ **
+ *      Returns the file descriptor to write output to
+ */
+
+static PyObject * req_fd(requestobject *self, PyObject *args)
+{
+    PyObject *fd;
+    long thefd;
+    thefd=(long)self->request_rec->connection->client->fd;
+    fd = PyInt_FromLong(thefd);
+    if (!fd) {
+       PyErr_SetString(PyExc_IOError, "Could not determine file descriptor.");
+       return NULL;
+    }
+
+
+    return fd;
+}
+
+
 static PyMethodDef requestobjectmethods[] = {
     {"add_common_vars",      (PyCFunction) req_add_common_vars,      METH_VARARGS},
     {"add_handler",          (PyCFunction) req_add_handler,          METH_VARARGS},
@@ -797,6 +818,7 @@
     {"register_cleanup",     (PyCFunction) req_register_cleanup,     METH_VARARGS},
     {"send_http_header",     (PyCFunction) req_send_http_header,     METH_VARARGS},
     {"write",                (PyCFunction) req_write,                METH_VARARGS},
+    {"get_fd",               (PyCFunction) req_fd,                   METH_VARARGS},
     { NULL, NULL } /* sentinel */
 };



On Sat, 2002-11-09 at 14:17, Conrad Steenberg wrote:
> Hi Mike
> 
> Have a look at sendfilemodule.c in
> http://cvs.sourceforge.net/cgi-bin/viewcvs.cgi/clarens/clarens/sendfile/
> 
> The patch for mod_python to get the filedescriptor to write to is below.
> 
> Cheers!
> 
> Conrad
> 
> On Fri, 2002-11-08 at 21:20, mike@mikebell.org wrote:
> > On Fri, Nov 08, 2002 at 11:24:56AM -0800, Conrad Steenberg wrote:
> > > So the question is, is anybody else interested in this? Either for me to
> > > contribute the mod_python patch and sendfile package, or for integration
> > > of these two parts into mod_pyhton itself?
> > 
> > I would absolutely be interested. Zero-copy from mod_python, yay. I have
> > in fact thought about this in the past but never got around to doing
> > anything about it.
> --- src/requestobject.c.orig    Tue Jun  4 15:52:45 2002
> +++ src/requestobject.c Tue Jun  4 11:15:49 2002
> @@ -781,6 +781,27 @@
> 
>  }
> 
> +/**
> + ** request.get_fd(request self)
> + **
> + *      Returns the file descriptor to write output to
> + */
> +
> +static PyObject * req_fd(requestobject *self, PyObject *args)
> +{
> +    PyObject *fd;
> +    long thefd;
> +    thefd=(long)self->request_rec->connection->client->fd;
> +    fd = PyInt_FromLong(thefd);
> +    if (!fd) {
> +       PyErr_SetString(PyExc_IOError, "Could not determine file descriptor.");
> +       return NULL;
> +    }
> +
> static PyMethodDef requestobjectmethods[] = {
>      {"add_common_vars",      (PyCFunction) req_add_common_vars,      METH_VARA
>      {"add_handler",          (PyCFunction) req_add_handler,          METH_VARA
> @@ -797,6 +818,7 @@
>      {"register_cleanup",     (PyCFunction) req_register_cleanup,     METH_VARA
>      {"send_http_header",     (PyCFunction) req_send_http_header,     METH_VARA
>      {"write",                (PyCFunction) req_write,                METH_VARA
> +    {"get_fd",               (PyCFunction) req_fd,                   METH_VARA
>      { NULL, NULL } /* sentinel */
>  };
> 
> 
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python



From laurie at tratt.net  Sun Nov 10 17:51:00 2002
From: laurie at tratt.net (Laurence Tratt)
Date: Fri Jan  9 22:03:34 2004
Subject: [mod_python] mod_python and OpenBSD
Message-ID: <20021110175100.A31721@purcell.dcs.kcl.ac.uk>

Hi all,

Has anyone managed to build mod_python-3.0.0-BETA4 under OpenBSD? I'm
running OpenBSD 3.2-current, have got Apache 2.0.43 but haven't actually
managed to build mp yet, and would be very interested to hear if anyone's
got this combination to play ball yet.

The problem I have is that mod_python.so itself isn't ever getting built.
Virtually every other filename extension after "mod_python." exists, but not
"so": the most likely culprit is libtool, a favoured target of bile in the
OpenBSD community, but I'm no expert on it (nor on the particular variant
that Apache ships in build/). The eventual result of not building the lib is
a dangling sym link from src/ to lib/ just to make things fun! If anybody's
interested in having a look at this, I can hook them up with an account on
an OpenBSD machine.


Whilst I'm here, I might as well tell you guys what I actually want mp to
do. If it's a Really Bad Idea, please feel free to tell me :) Essentially, I
want to have a filter which takes pages in a sort-of psuedo HTML format, and
then munges them into a full page before sending them on. I've prototyped it
in Apache 1.3 as a handler/cgi-script thing, and it works fine except that
you're limited by the fact that you can't post-process data from other
sources (eg I will probably need to munge PHP output too). So filters in
Apache 2.0 look like the way to go, and obviously I want it to run
efficiently hence my interest in mod_python. From what I can tell, at the
moment mp's filter support can't handle fiddling with HTTP headers which I
will need to do (my filter also having to deal with setting cookies), but
I'm unclear as to whether that's a fundamental problem, or whether it just
hasn't been coded up yet.

Thanks in advance for any help,


Laurie

From agenkin-lst-mod_python at thpoon.com  Sun Nov 10 12:52:44 2002
From: agenkin-lst-mod_python at thpoon.com (Arcady Genkin)
Date: Fri Jan  9 22:03:34 2004
Subject: [mod_python] online docs for mp version 3?
Message-ID: <86bs4xjor7.fsf@tea.thpoon.com>

Is there a copy of documentation for version 3.0 of mod_python online
somewhere?

Thanks.
-- 
Arcady Genkin

guilt is the cause of more disauders
than history's most obscene marorders                       (E.E. Cummings)

From agenkin-lst-mod_python at thpoon.com  Sun Nov 10 13:06:56 2002
From: agenkin-lst-mod_python at thpoon.com (Arcady Genkin)
Date: Fri Jan  9 22:03:34 2004
Subject: [mod_python] Default function for Publisher
Message-ID: <867kfljo3j.fsf@tea.thpoon.com>

I spent a few hours trying to figure out how to make the url
"http://foo" respond with a python handler in index.py.  In the end I
came up with the following:

   RewriteEngine on
   RewriteRule ^/*$ /index.py/main

which seems to work, but is a hack.  In the list archives I saw a few
threads that proposed introducing a default handler function for the
Publisher, but the impression I got was that the functionality still
is not implemented.

As a new user of mod_python, I'd like to pitch in that default
Publisher function would save me a lot of trouble and time, which I'd
rather have spent getting to know mod_python than learning how
mod_rewrite works.  It would be much cleaner to write:

  DirectoryIndex index.py
  PyPublisherDefaultFunction main

or some such.
-- 
Arcady Genkin

guilt is the cause of more disauders
than history's most obscene marorders                       (E.E. Cummings)

From agenkin-lst-mod_python at thpoon.com  Sun Nov 10 13:25:45 2002
From: agenkin-lst-mod_python at thpoon.com (Arcady Genkin)
Date: Fri Jan  9 22:03:34 2004
Subject: [mod_python] Apache children crashing with mod_python 3.0 beta4
Message-ID: <863cq9jn86.fsf@tea.thpoon.com>

I'm trying out mod_python-3 beta 4 on FreeBSD 4.7.  Python is version
2.2.2 compiled from ports without threading support.  Apache is 2.0.43
compiled from ports with threads enabled, running with default
configuration (apart from mod_python customizations); mod_python is
the only non-stock module loaded into it.

Even though mod_python seems to be working fine, I am seeing the
following in the apache's error logs:

Fatal Python error: PyThreadState_Delete: tstate is still current
Fatal Python error: PyThreadState_Delete: tstate is still current
Fatal Python error: PyThreadState_Delete: tstate is still current
Fatal Python error: PyThreadState_Delete: tstate is still current
[Sun Nov 10 12:29:32 2002] [notice] child pid 27272 exit signal Abort trap (6)
[Sun Nov 10 12:29:32 2002] [notice] child pid 27267 exit signal Abort trap (6)
[Sun Nov 10 12:29:32 2002] [notice] child pid 27266 exit signal Abort trap (6)
[Sun Nov 10 12:29:32 2002] [notice] child pid 27265 exit signal Abort trap (6)

How likely is this due to a misconfiguration?  Any pointers?

Many thanks,
-- 
Arcady Genkin

guilt is the cause of more disauders
than history's most obscene marorders                       (E.E. Cummings)

From agenkin-lst-mod_python at thpoon.com  Sun Nov 10 13:28:43 2002
From: agenkin-lst-mod_python at thpoon.com (Arcady Genkin)
Date: Fri Jan  9 22:03:34 2004
Subject: [mod_python] online docs for mp version 3?
References: <86bs4xjor7.fsf@tea.thpoon.com>
Message-ID: <86vg35i8is.fsf@tea.thpoon.com>

Arcady Genkin <agenkin-lst-mod_python@thpoon.com> writes:

> Is there a copy of documentation for version 3.0 of mod_python online
> somewhere?

Never mind.  I now see that the distribution tarball includes
generated HTML documenation (I thought that only the LaTeX sources
were included).  Sorry for the noise.
-- 
Arcady Genkin

guilt is the cause of more disauders
than history's most obscene marorders                       (E.E. Cummings)

From grisha at modpython.org  Sun Nov 10 14:30:19 2002
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 22:03:34 2004
Subject: [mod_python] Default function for Publisher
In-Reply-To: <867kfljo3j.fsf@tea.thpoon.com>
Message-ID: <20021110142943.T3802-100000@eden.ispol.com>

in MP 3.0 it defaults "index"

Grisha

On Sun, 10 Nov 2002, Arcady Genkin wrote:

> I spent a few hours trying to figure out how to make the url
> "http://foo" respond with a python handler in index.py.  In the end I
> came up with the following:
>
>    RewriteEngine on
>    RewriteRule ^/*$ /index.py/main
>
> which seems to work, but is a hack.  In the list archives I saw a few
> threads that proposed introducing a default handler function for the
> Publisher, but the impression I got was that the functionality still
> is not implemented.
>
> As a new user of mod_python, I'd like to pitch in that default
> Publisher function would save me a lot of trouble and time, which I'd
> rather have spent getting to know mod_python than learning how
> mod_rewrite works.  It would be much cleaner to write:
>
>   DirectoryIndex index.py
>   PyPublisherDefaultFunction main
>
> or some such.
> --
> Arcady Genkin
>
> guilt is the cause of more disauders
> than history's most obscene marorders                       (E.E. Cummings)
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
>


From grisha at modpython.org  Sun Nov 10 14:33:11 2002
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 22:03:34 2004
Subject: [mod_python] Apache children crashing with mod_python 3.0 beta4
In-Reply-To: <863cq9jn86.fsf@tea.thpoon.com>
Message-ID: <20021110143055.H3802-100000@eden.ispol.com>

See the README file. On FreeBSD you need to have threads enabled in both
Python and Apache. The default Python port will have threads enabled, and
to make Apache thread-enabled, you need --enable-threads in the Makefile.

On Sun, 10 Nov 2002, Arcady Genkin wrote:

> I'm trying out mod_python-3 beta 4 on FreeBSD 4.7.  Python is version
> 2.2.2 compiled from ports without threading support.  Apache is 2.0.43
> compiled from ports with threads enabled, running with default
> configuration (apart from mod_python customizations); mod_python is
> the only non-stock module loaded into it.
>
> Even though mod_python seems to be working fine, I am seeing the
> following in the apache's error logs:
>
> Fatal Python error: PyThreadState_Delete: tstate is still current
> Fatal Python error: PyThreadState_Delete: tstate is still current
> Fatal Python error: PyThreadState_Delete: tstate is still current
> Fatal Python error: PyThreadState_Delete: tstate is still current
> [Sun Nov 10 12:29:32 2002] [notice] child pid 27272 exit signal Abort trap (6)
> [Sun Nov 10 12:29:32 2002] [notice] child pid 27267 exit signal Abort trap (6)
> [Sun Nov 10 12:29:32 2002] [notice] child pid 27266 exit signal Abort trap (6)
> [Sun Nov 10 12:29:32 2002] [notice] child pid 27265 exit signal Abort trap (6)
>
> How likely is this due to a misconfiguration?  Any pointers?
>
> Many thanks,
> --
> Arcady Genkin
>
> guilt is the cause of more disauders
> than history's most obscene marorders                       (E.E. Cummings)
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
>


From agenkin-lst-mod_python at thpoon.com  Sun Nov 10 16:12:59 2002
From: agenkin-lst-mod_python at thpoon.com (Arcady Genkin)
Date: Fri Jan  9 22:03:34 2004
Subject: [mod_python] Apache children crashing with mod_python 3.0 beta4
In-Reply-To: <20021110143055.H3802-100000@eden.ispol.com> ("Gregory's
 message of "Sun, 10 Nov 2002 14:33:11 -0500 (EST)")
References: <20021110143055.H3802-100000@eden.ispol.com>
Message-ID: <uoof8x5dt0.fsf@bashful.cdf.toronto.edu>

"Gregory (Grisha) Trubetskoy" <grisha@modpython.org> writes:

> See the README file. On FreeBSD you need to have threads enabled in both
> Python and Apache. 

The README file only tells to compile Apache with threads, which I
read and did.  Perhaps you need to add the bit about Python with
threads enabled.

Thanks for your reply!
-- 
Arcady Genkin : CDF Systems Administrator
http://www.cdf.toronto.edu/~agenkin/contact.html

guilt is the cause of more disauders
than history's most obscene marorders (E.E. Cummings)

From agenkin-lst-mod_python at thpoon.com  Sun Nov 10 16:36:38 2002
From: agenkin-lst-mod_python at thpoon.com (Arcady Genkin)
Date: Fri Jan  9 22:03:34 2004
Subject: [mod_python] Default function for Publisher in 3.0
In-Reply-To: <20021110142943.T3802-100000@eden.ispol.com> ("Gregory's
 message of "Sun, 10 Nov 2002 14:30:19 -0500 (EST)")
References: <20021110142943.T3802-100000@eden.ispol.com>
Message-ID: <uoheep5cpl.fsf@bashful.cdf.toronto.edu>

"Gregory (Grisha) Trubetskoy" <grisha@modpython.org> writes:

> in MP 3.0 it defaults "index"

Great!  However, this does not seem to work with
"DirectoryIndex index.py".
I get the following when accessing the url http://myhost/ :

,----
| Mod_python error: "PythonHandler mod_python.publisher"
| 
| Traceback (most recent call last):
| 
|   File "/usr/local/lib/python2.2/site-packages/mod_python/apache.py",
|   line 335, in HandlerDispatch
|     result = object(req)
| 
|   File "/usr/local/lib/python2.2/site-packages/mod_python/publisher.py",
|   line 86, in handler
|     func_path = req.path_info[1:] # skip first /
| 
| TypeError: unsubscriptable object
`----

Accessing http://myhost/index.py works fine.
-- 
Arcady Genkin : CDF Systems Administrator
http://www.cdf.toronto.edu/~agenkin/contact.html

guilt is the cause of more disauders
than history's most obscene marorders (E.E. Cummings)

From agenkin-lst-mod_python at thpoon.com  Sun Nov 10 16:42:55 2002
From: agenkin-lst-mod_python at thpoon.com (Arcady Genkin)
Date: Fri Jan  9 22:03:34 2004
Subject: [mod_python] Documentation bug for 3.0
Message-ID: <uod6pd5cf4.fsf@bashful.cdf.toronto.edu>

In the html documentation, distributed with the 3.0 tarball, Section
6.1.1 (introduction to publisher handler) suggests the following
configuration in httpd.conf:

<Directory /some/path}
    SetHandler python-program 
    PythonHandler mod_python.publisher
</Directory>

But this results in a syntax error:

   AddHandler requires at least two arguments, a handler name followed
   by one or more file extensions

Seems that ".py" is missing at the end of SetHandler directive.
-- 
Arcady Genkin : CDF Systems Administrator
http://www.cdf.toronto.edu/~agenkin/contact.html

guilt is the cause of more disauders
than history's most obscene marorders (E.E. Cummings)

From agenkin-lst-mod_python at thpoon.com  Sun Nov 10 16:56:52 2002
From: agenkin-lst-mod_python at thpoon.com (Arcady Genkin)
Date: Fri Jan  9 22:03:34 2004
Subject: [mod_python] Documentation bug for 3.0
In-Reply-To: <uod6pd5cf4.fsf@bashful.cdf.toronto.edu> (Arcady Genkin's
 message of "Sun, 10 Nov 2002 16:42:55 -0500")
References: <uod6pd5cf4.fsf@bashful.cdf.toronto.edu>
Message-ID: <uo7kfl5brv.fsf@bashful.cdf.toronto.edu>

Errm...  I must get the pointy hat of the day for being so
inattentive.  Of course, the docs say "SetHandler", while I have
"AddHandler" in the config file.

Many appologies.

Arcady Genkin <agenkin-lst-mod_python@thpoon.com> writes:

> In the html documentation, distributed with the 3.0 tarball, Section
> 6.1.1 (introduction to publisher handler) suggests the following
> configuration in httpd.conf:
>
> <Directory /some/path}
>     SetHandler python-program 
>     PythonHandler mod_python.publisher
> </Directory>
>
> But this results in a syntax error:
>
>    AddHandler requires at least two arguments, a handler name followed
>    by one or more file extensions
>
> Seems that ".py" is missing at the end of SetHandler directive.

-- 
Arcady Genkin : CDF Systems Administrator
http://www.cdf.toronto.edu/~agenkin/contact.html

guilt is the cause of more disauders
than history's most obscene marorders (E.E. Cummings)

From agenkin-lst-mod_python at thpoon.com  Sun Nov 10 17:11:26 2002
From: agenkin-lst-mod_python at thpoon.com (Arcady Genkin)
Date: Fri Jan  9 22:03:34 2004
Subject: [mod_python] Default function for Publisher in 3.0
References: <20021110142943.T3802-100000@eden.ispol.com>
	<uoheep5cpl.fsf@bashful.cdf.toronto.edu>
Message-ID: <uowunl3wj5.fsf@bashful.cdf.toronto.edu>

Arcady Genkin <agenkin-lst-mod_python@thpoon.com> writes:

> this does not seem to work with "DirectoryIndex index.py".

An update: I had a problem with configuration (using AddHandler
directive instead of the SetHandler, as recommended in the docs).
However, still can't use index.py implicitely.  Now the backtrace
looks this way:

,----
| Mod_python error: "PythonHandler mod_python.publisher"
| 
| Traceback (most recent call last):
| 
|   File "/usr/local/lib/python2.2/site-packages/mod_python/apache.py",
|   line 335, in HandlerDispatch
|     result = object(req)
| 
|   File "/usr/local/lib/python2.2/site-packages/mod_python/publisher.py",
|   line 145, in handler
|     module = apache.import_module(module_name, req.get_config(), [path])
| 
|   File "/usr/local/lib/python2.2/site-packages/mod_python/apache.py",
|   line 499, in import_module
|     f, p, d = imp.find_module(parts[i], path)
| 
| ImportError: No module named 
`----

The httpd.conf contains the following configuration:

,----
| <Directory "/var/www/data">
|    PythonDebug On
|    SetHandler python-program
|    PythonHandler mod_python.publisher
|    DirectoryIndex index.py
| </Directory>
`----

Something tells me that I am still doing something wrong.  I tried
setting DIrectoryIndex to "index" instead of "index.py", but this
still did not work.  Any ideas?

Many thanks,
-- 
Arcady Genkin : CDF Systems Administrator
http://www.cdf.toronto.edu/~agenkin/contact.html

guilt is the cause of more disauders
than history's most obscene marorders (E.E. Cummings)

From gstein at lyra.org  Sun Nov 10 17:05:40 2002
From: gstein at lyra.org (Greg Stein)
Date: Fri Jan  9 22:03:34 2004
Subject: [mod_python] Interest in sendfile from mod_python?
In-Reply-To: <1036783496.6448.491.camel@heppc22.hep.caltech.edu>; from conrad@hep.caltech.edu on Fri, Nov 08, 2002 at 11:24:56AM -0800
References: <1036783496.6448.491.camel@heppc22.hep.caltech.edu>
Message-ID: <20021110170540.C4640@lyra.org>

On Fri, Nov 08, 2002 at 11:24:56AM -0800, Conrad Steenberg wrote:
>...
> The Linux and FreeBSD (I think) sendfile calls make this very easy and
> efficient in Apache itself, but there is no way to control this from
> within mod_python as far as I can see.

In Apache 2.0, the Python code needs to construct a FILE bucket and shove
that into the output filter stack. Assuming that it doesn't get processed by
mod_includes or somesuch on the way through the filters, then it will hit
the network output filter and be sendfile'd.

> My solution was to build a Python sendfile module (using code from the
> Medusa server, under the Python license), and create a patch for
> mod_python to get the request file-descriptor to pass to the sendfile
> call.

The file descriptor is private info. Modules should never access it.


All that said: I'm not sure if mod_python allows you to construct buckets
right now. Grisha could answer that in a jiffy...

Cheers,
-g

-- 
Greg Stein, http://www.lyra.org/

From gstein at lyra.org  Sun Nov 10 17:07:39 2002
From: gstein at lyra.org (Greg Stein)
Date: Fri Jan  9 22:03:34 2004
Subject: [mod_python] Apache children crashing with mod_python 3.0 beta4
In-Reply-To: <20021110143055.H3802-100000@eden.ispol.com>; from grisha@modpython.org on Sun, Nov 10, 2002 at 02:33:11PM -0500
References: <863cq9jn86.fsf@tea.thpoon.com> <20021110143055.H3802-100000@eden.ispol.com>
Message-ID: <20021110170739.D4640@lyra.org>

Also make sure that Apache is configured to use the "prefork" MPM. The
thread-based MPMs don't work in FreeBSD because of its broken sendfile
implementation (it breaks in threaded environments; this has been fixed in
very recent BSDs... not sure which).

Cheers,
-g

On Sun, Nov 10, 2002 at 02:33:11PM -0500, Gregory (Grisha) Trubetskoy wrote:
> 
> See the README file. On FreeBSD you need to have threads enabled in both
> Python and Apache. The default Python port will have threads enabled, and
> to make Apache thread-enabled, you need --enable-threads in the Makefile.
> 
> On Sun, 10 Nov 2002, Arcady Genkin wrote:
> 
> > I'm trying out mod_python-3 beta 4 on FreeBSD 4.7.  Python is version
> > 2.2.2 compiled from ports without threading support.  Apache is 2.0.43
> > compiled from ports with threads enabled, running with default
> > configuration (apart from mod_python customizations); mod_python is
> > the only non-stock module loaded into it.
> >
> > Even though mod_python seems to be working fine, I am seeing the
> > following in the apache's error logs:
> >
> > Fatal Python error: PyThreadState_Delete: tstate is still current
> > Fatal Python error: PyThreadState_Delete: tstate is still current
> > Fatal Python error: PyThreadState_Delete: tstate is still current
> > Fatal Python error: PyThreadState_Delete: tstate is still current
> > [Sun Nov 10 12:29:32 2002] [notice] child pid 27272 exit signal Abort trap (6)
> > [Sun Nov 10 12:29:32 2002] [notice] child pid 27267 exit signal Abort trap (6)
> > [Sun Nov 10 12:29:32 2002] [notice] child pid 27266 exit signal Abort trap (6)
> > [Sun Nov 10 12:29:32 2002] [notice] child pid 27265 exit signal Abort trap (6)
> >
> > How likely is this due to a misconfiguration?  Any pointers?
> >
> > Many thanks,
> > --
> > Arcady Genkin
> >
> > guilt is the cause of more disauders
> > than history's most obscene marorders                       (E.E. Cummings)
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://www.modpython.org/mailman/listinfo/mod_python
> >
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python

-- 
Greg Stein, http://www.lyra.org/

From neel at mediapulse.com  Mon Nov 11 13:15:19 2002
From: neel at mediapulse.com (Michael C. Neel)
Date: Fri Jan  9 22:03:34 2004
Subject: [mod_python] Default function for Publisher in 3.0
Message-ID: <C0FC22C08B82074A88B50061764157772C647F@johnson.mediapulse.net>

This is an untested guess, but I think apache needs to see "index.py" in
the document root before it will send the client a redirect to
spam.com/index.py - try doing a touch index.py in the doc root and see
what happens...

Mike

> -----Original Message-----
> From: Arcady Genkin [mailto:agenkin-lst-mod_python@thpoon.com] 
> Sent: Sunday, November 10, 2002 5:11 PM
> To: mod_python@modpython.org
> Subject: Re: [mod_python] Default function for Publisher in 3.0
> 
> 
> Arcady Genkin <agenkin-lst-mod_python@thpoon.com> writes:
> 
> > this does not seem to work with "DirectoryIndex index.py".
> 
> An update: I had a problem with configuration (using AddHandler
> directive instead of the SetHandler, as recommended in the docs).
> However, still can't use index.py implicitely.  Now the backtrace
> looks this way:
> 
> ,----
> | Mod_python error: "PythonHandler mod_python.publisher"
> | 
> | Traceback (most recent call last):
> | 
> |   File 
> "/usr/local/lib/python2.2/site-packages/mod_python/apache.py",
> |   line 335, in HandlerDispatch
> |     result = object(req)
> | 
> |   File 
> "/usr/local/lib/python2.2/site-packages/mod_python/publisher.py",
> |   line 145, in handler
> |     module = apache.import_module(module_name, 
> req.get_config(), [path])
> | 
> |   File 
> "/usr/local/lib/python2.2/site-packages/mod_python/apache.py",
> |   line 499, in import_module
> |     f, p, d = imp.find_module(parts[i], path)
> | 
> | ImportError: No module named 
> `----
> 
> The httpd.conf contains the following configuration:
> 
> ,----
> | <Directory "/var/www/data">
> |    PythonDebug On
> |    SetHandler python-program
> |    PythonHandler mod_python.publisher
> |    DirectoryIndex index.py
> | </Directory>
> `----
> 
> Something tells me that I am still doing something wrong.  I tried
> setting DIrectoryIndex to "index" instead of "index.py", but this
> still did not work.  Any ideas?
> 
> Many thanks,
> -- 
> Arcady Genkin : CDF Systems Administrator
> http://www.cdf.toronto.edu/~agenkin/contact.html
> 
> guilt is the cause of more disauders
> than history's most obscene marorders (E.E. Cummings)
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 


From jgramlich at piocon.com  Mon Nov 11 12:32:27 2002
From: jgramlich at piocon.com (Joshua Gramlich)
Date: Fri Jan  9 22:03:35 2004
Subject: [mod_python] Installation Issues - Apache2 Python2.2 RedHat
Message-ID: <021b01c289b0$b01c76a0$cb3ac341@ginworks.com>

Howdy.  I've looked through the archives and couldn't find anything in particularly specific to my issue, so here goes:

I'm trying to install mod_python with thread support (no reason, just because).  I made the jump up to Apache2, and it is working fine.  I've also got Python 2.2.1 installed.  I'm using RedHat 7.2 as my platform, and python2 is installed via source RPM(./configure'd, make'd, and make install'd).  Apache, I compiled from source.

When I configure mod python I do so like this:

./configure --with-apxs=/usr/local/apache/bin/apxs --with-python=/usr/src/redhat/SOURCES/Python-2.2.1

...and I get the following (partial):

hecking for Apache include directory... -I/usr/local/httpd-2.0.43/include
checking for --with-apache... no
configure: warning: **** No apache sources specified, static compilation will not be available.
configure: warning: **** You can use --with-apache to specify where your Apache sources are.
checking for --with-python... /usr/src/redhat/SOURCES/Python-2.2.1
checking for python... (cached) /usr/bin/python
checking Python version... 1.5
checking whether Python is compiled with thread support... yes

  ****** WARNING ******
  Python is compiled with thread support. Apache 1.3 does not use threads.
  On some systems this will cause problems during compilation, on others
  it may result in unpredictable behaviour of your Apache server. Yet on
  others it will work just fine. The recommended approach is to compile
  Python without thread support in a separate location and specify it with
  --with-python option to this ./configure script.

checking Python install prefix... /usr
checking what libraries Python was linked with... grep: /usr/src/redhat/SOURCES/Python-2.2.1/Modules/Makefile: No such file or directory
grep: /usr/src/redhat/SOURCES/Python-2.2.1/Modules/Makefile: No such file or directory
/usr/src/redhat/SOURCES/Python-2.2.1/libpython1.5.a
checking linker flags used to link Python...  -Xlinker -export-dynamic



...So anyways, I keep seeing "checking Python version...1.5" and I'm wondering if this is a problem.  Reason being, when I type "make dso" after configuring mod_python, I get this:

make dso
make[1]: Entering directory `/usr/src/mod_python-2.7.8/src'
gcc  -I/usr/src/mod_python-2.7.8/src/include -I/usr/local/httpd-2.0.43/include -I/usr/src/redhat/SOURCES/Python-2.2.1 -I/usr/src/redhat/SOURCES/Python-2.2.1/Include    -c -o mod_python.o mod_python.c
In file included from mod_python.c:54:
/usr/src/mod_python-2.7.8/src/include/mod_python.h:93: parse error before `*'
/usr/src/mod_python-2.7.8/src/include/mod_python.h:93: warning: data definition has no type or storage class
/usr/src/mod_python-2.7.8/src/include/mod_python.h:96: parse error before `python_module'
/usr/src/mod_python-2.7.8/src/include/mod_python.h:96: warning: data definition has no type or storage class
In file included from /usr/src/mod_python-2.7.8/src/include/mod_python.h:99,
                 from mod_python.c:54:
/usr/src/mod_python-2.7.8/src/include/util.h:57: parse error before `*'
In file included from /usr/src/mod_python-2.7.8/src/include/mod_python.h:100,
                 from mod_python.c:54:
/usr/src/mod_python-2.7.8/src/include/tableobject.h:69blablahblahblah....



Anyone have any ideas as to why this isn't working?


Josh
Chicago, IL
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mailman.modpython.org/pipermail/mod_python/attachments/20021111/3e9b4dca/attachment-0003.htm
From agenkin-lst-mod_python at thpoon.com  Mon Nov 11 14:04:59 2002
From: agenkin-lst-mod_python at thpoon.com (Arcady Genkin)
Date: Fri Jan  9 22:03:35 2004
Subject: [mod_python] Default function for Publisher in 3.0
In-Reply-To: <C0FC22C08B82074A88B50061764157772C647F@johnson.mediapulse.net> ("Michael
 C. Neel"'s message of "Mon, 11 Nov 2002 13:15:19 -0500")
References: <C0FC22C08B82074A88B50061764157772C647F@johnson.mediapulse.net>
Message-ID: <uo7kfk3p2c.fsf@bashful.cdf.toronto.edu>

"Michael C. Neel" <neel@mediapulse.com> writes:

> This is an untested guess, but I think apache needs to see "index.py" in
> the document root before it will send the client a redirect to
> spam.com/index.py - try doing a touch index.py in the doc root and see
> what happens...

The document root is '/var/www/data', and I do have a script
'/var/www/data/index.py', which, in turn, has an 'index' function.
Connecting to http://spam.com/index/index and http://spam.com/index
works fine (i.e. the default function is working properly), but for
http://spam.com/ I get the backtrace, included in my previous message.

Any more ideas?
-- 
Arcady Genkin : CDF Systems Administrator
http://www.cdf.toronto.edu/~agenkin/contact.html

guilt is the cause of more disauders
than history's most obscene marorders (E.E. Cummings)

From grisha at apache.org  Mon Nov 11 15:04:58 2002
From: grisha at apache.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 22:03:35 2004
Subject: [mod_python] Default function for Publisher in 3.0
In-Reply-To: <C0FC22C08B82074A88B50061764157772C647F@johnson.mediapulse.net>
Message-ID: <20021111143821.W17409-100000@eden.ispol.com>

I looked at the mod_dir.c code, it looks like if you use SetHandler,
DirectoryIndex has no effect, but if you use AddHandler, DirectoryIndex
does apply, but the problem is that req.path_info in this case ends up
bing None (or NULL) as opposed to a blank string, thus the
"Unsubscriptable Object" error.

To get around this, try this patch:

--- publishre.py.old    Mon Nov 11 14:51:44 2002
+++ publisher.py        Mon Nov 11 14:50:13 2002
@@ -83,10 +83,12 @@
     if req.method not in ["GET", "POST"]:
         raise apache.SERVER_RETURN, apache.HTTP_METHOD_NOT_ALLOWED

-    func_path = req.path_info[1:] # skip first /
-    func_path = func_path.replace("/", ".")
-    if func_path[-1:] == ".":
-        func_path = func_path[:-1]
+    func_path = ""
+    if req.path_info:
+        func_path = req.path_info[1:] # skip first /
+        func_path = func_path.replace("/", ".")
+        if func_path[-1:] == ".":
+            func_path = func_path[:-1]

     # default to 'index' if no path_info was given
     if not func_path:


An imperfection with using AddHandler is that you end up with the ".py" in
your URL's.

To be able to use the best of both worlds, i.e. SetHandler and a default
module, the Publisher needs to provide its own default (since
DirectoryIndex has no effect). Here is another patch for this. Most likely
these will be in the release version (perhaps slightly modified). This
will tell the publisher to default to "index.py" is no file is specified.

--- publishre.py.old    Mon Nov 11 14:51:44 2002
+++ publisher.py        Mon Nov 11 14:50:13 2002
@@ -126,6 +128,9 @@

     ## import the script
     path, module_name =  os.path.split(req.filename)
+    if not module_name:
+        module_name = "index"

     # get rid of the suffix
     #   explanation: Suffixes that will get stripped off


Grisha

On Mon, 11 Nov 2002, Michael C. Neel wrote:

> This is an untested guess, but I think apache needs to see "index.py" in
> the document root before it will send the client a redirect to
> spam.com/index.py - try doing a touch index.py in the doc root and see
> what happens...
>
> Mike
>
> > -----Original Message-----
> > From: Arcady Genkin [mailto:agenkin-lst-mod_python@thpoon.com]
> > Sent: Sunday, November 10, 2002 5:11 PM
> > To: mod_python@modpython.org
> > Subject: Re: [mod_python] Default function for Publisher in 3.0
> >
> >
> > Arcady Genkin <agenkin-lst-mod_python@thpoon.com> writes:
> >
> > > this does not seem to work with "DirectoryIndex index.py".
> >
> > An update: I had a problem with configuration (using AddHandler
> > directive instead of the SetHandler, as recommended in the docs).
> > However, still can't use index.py implicitely.  Now the backtrace
> > looks this way:
> >
> > ,----
> > | Mod_python error: "PythonHandler mod_python.publisher"
> > |
> > | Traceback (most recent call last):
> > |
> > |   File
> > "/usr/local/lib/python2.2/site-packages/mod_python/apache.py",
> > |   line 335, in HandlerDispatch
> > |     result = object(req)
> > |
> > |   File
> > "/usr/local/lib/python2.2/site-packages/mod_python/publisher.py",
> > |   line 145, in handler
> > |     module = apache.import_module(module_name,
> > req.get_config(), [path])
> > |
> > |   File
> > "/usr/local/lib/python2.2/site-packages/mod_python/apache.py",
> > |   line 499, in import_module
> > |     f, p, d = imp.find_module(parts[i], path)
> > |
> > | ImportError: No module named
> > `----
> >
> > The httpd.conf contains the following configuration:
> >
> > ,----
> > | <Directory "/var/www/data">
> > |    PythonDebug On
> > |    SetHandler python-program
> > |    PythonHandler mod_python.publisher
> > |    DirectoryIndex index.py
> > | </Directory>
> > `----
> >
> > Something tells me that I am still doing something wrong.  I tried
> > setting DIrectoryIndex to "index" instead of "index.py", but this
> > still did not work.  Any ideas?
> >
> > Many thanks,
> > --
> > Arcady Genkin : CDF Systems Administrator
> > http://www.cdf.toronto.edu/~agenkin/contact.html
> >
> > guilt is the cause of more disauders
> > than history's most obscene marorders (E.E. Cummings)
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://www.modpython.org/mailman/listinfo/mod_python
> >
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
>



From grisha at modpython.org  Mon Nov 11 16:51:14 2002
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 22:03:35 2004
Subject: [mod_python] Installation Issues - Apache2 Python2.2 RedHat
In-Reply-To: <021b01c289b0$b01c76a0$cb3ac341@ginworks.com>
Message-ID: <20021111164814.J22386-100000@eden.ispol.com>

Josh -

If you're using Apache 2, you need mod_python version 3.0, currently in
beta. Mod_python 2.7.8 won't work with apache 2.

But with respect to your specific question - rm config.cache and re-run
configure. (It will report the Python version correctly, but you're still
going to have the above-mentioned apache2 problem).

Grisha

On Mon, 11 Nov 2002, Joshua Gramlich wrote:

> Howdy.  I've looked through the archives and couldn't find anything in particularly specific to my issue, so here goes:
>
> I'm trying to install mod_python with thread support (no reason, just because).  I made the jump up to Apache2, and it is working fine.  I've also got Python 2.2.1 installed.  I'm using RedHat 7.2 as my platform, and python2 is installed via source RPM(./configure'd, make'd, and make install'd).  Apache, I compiled from source.
>
> When I configure mod python I do so like this:
>
> ./configure --with-apxs=/usr/local/apache/bin/apxs --with-python=/usr/src/redhat/SOURCES/Python-2.2.1
>
> ...and I get the following (partial):
>
> hecking for Apache include directory... -I/usr/local/httpd-2.0.43/include
> checking for --with-apache... no
> configure: warning: **** No apache sources specified, static compilation will not be available.
> configure: warning: **** You can use --with-apache to specify where your Apache sources are.
> checking for --with-python... /usr/src/redhat/SOURCES/Python-2.2.1
> checking for python... (cached) /usr/bin/python
> checking Python version... 1.5
> checking whether Python is compiled with thread support... yes
>
>   ****** WARNING ******
>   Python is compiled with thread support. Apache 1.3 does not use threads.
>   On some systems this will cause problems during compilation, on others
>   it may result in unpredictable behaviour of your Apache server. Yet on
>   others it will work just fine. The recommended approach is to compile
>   Python without thread support in a separate location and specify it with
>   --with-python option to this ./configure script.
>
> checking Python install prefix... /usr
> checking what libraries Python was linked with... grep: /usr/src/redhat/SOURCES/Python-2.2.1/Modules/Makefile: No such file or directory
> grep: /usr/src/redhat/SOURCES/Python-2.2.1/Modules/Makefile: No such file or directory
> /usr/src/redhat/SOURCES/Python-2.2.1/libpython1.5.a
> checking linker flags used to link Python...  -Xlinker -export-dynamic
>
>
>
> ...So anyways, I keep seeing "checking Python version...1.5" and I'm wondering if this is a problem.  Reason being, when I type "make dso" after configuring mod_python, I get this:
>
> make dso
> make[1]: Entering directory `/usr/src/mod_python-2.7.8/src'
> gcc  -I/usr/src/mod_python-2.7.8/src/include -I/usr/local/httpd-2.0.43/include -I/usr/src/redhat/SOURCES/Python-2.2.1 -I/usr/src/redhat/SOURCES/Python-2.2.1/Include    -c -o mod_python.o mod_python.c
> In file included from mod_python.c:54:
> /usr/src/mod_python-2.7.8/src/include/mod_python.h:93: parse error before `*'
> /usr/src/mod_python-2.7.8/src/include/mod_python.h:93: warning: data definition has no type or storage class
> /usr/src/mod_python-2.7.8/src/include/mod_python.h:96: parse error before `python_module'
> /usr/src/mod_python-2.7.8/src/include/mod_python.h:96: warning: data definition has no type or storage class
> In file included from /usr/src/mod_python-2.7.8/src/include/mod_python.h:99,
>                  from mod_python.c:54:
> /usr/src/mod_python-2.7.8/src/include/util.h:57: parse error before `*'
> In file included from /usr/src/mod_python-2.7.8/src/include/mod_python.h:100,
>                  from mod_python.c:54:
> /usr/src/mod_python-2.7.8/src/include/tableobject.h:69blablahblahblah....
>
>
>
> Anyone have any ideas as to why this isn't working?
>
>
> Josh
> Chicago, IL


From jgramlich at piocon.com  Mon Nov 11 15:55:52 2002
From: jgramlich at piocon.com (Joshua Gramlich)
Date: Fri Jan  9 22:03:35 2004
Subject: [mod_python] Installation Issues - Apache2 Python2.2 RedHat
References: <20021111164814.J22386-100000@eden.ispol.com>
Message-ID: <024d01c289cd$1cf27d30$cb3ac341@ginworks.com>

I've gone and switched back to apache 1.3 for the time being.  If I get that
to work(which it looks like I will), I'll prolly consider using mod_python 3
instead, as I'm having to retool the python installs on my machine and it's
a major pain.  Plus, for whatever reason, and perhaps it just boils down to
esthetics, I'd rather have thread support built in...

Thanks,
Josh


----- Original Message -----
From: "Gregory (Grisha) Trubetskoy" <grisha@modpython.org>
To: "Joshua Gramlich" <jgramlich@piocon.com>
Cc: <mod_python@modpython.org>
Sent: Monday, November 11, 2002 3:51 PM
Subject: Re: [mod_python] Installation Issues - Apache2 Python2.2 RedHat


>
> Josh -
>
> If you're using Apache 2, you need mod_python version 3.0, currently in
> beta. Mod_python 2.7.8 won't work with apache 2.
>
> But with respect to your specific question - rm config.cache and re-run
> configure. (It will report the Python version correctly, but you're still
> going to have the above-mentioned apache2 problem).
>
> Grisha
>
> On Mon, 11 Nov 2002, Joshua Gramlich wrote:
>
> > Howdy.  I've looked through the archives and couldn't find anything in
particularly specific to my issue, so here goes:
> >
> > I'm trying to install mod_python with thread support (no reason, just
because).  I made the jump up to Apache2, and it is working fine.  I've also
got Python 2.2.1 installed.  I'm using RedHat 7.2 as my platform, and
python2 is installed via source RPM(./configure'd, make'd, and make
install'd).  Apache, I compiled from source.
> >
> > When I configure mod python I do so like this:
> >
> >
./configure --with-apxs=/usr/local/apache/bin/apxs --with-python=/usr/src/re
dhat/SOURCES/Python-2.2.1
> >
> > ...and I get the following (partial):
> >
> > hecking for Apache include
directory... -I/usr/local/httpd-2.0.43/include
> > checking for --with-apache... no
> > configure: warning: **** No apache sources specified, static compilation
will not be available.
> > configure: warning: **** You can use --with-apache to specify where your
Apache sources are.
> > checking for --with-python... /usr/src/redhat/SOURCES/Python-2.2.1
> > checking for python... (cached) /usr/bin/python
> > checking Python version... 1.5
> > checking whether Python is compiled with thread support... yes
> >
> >   ****** WARNING ******
> >   Python is compiled with thread support. Apache 1.3 does not use
threads.
> >   On some systems this will cause problems during compilation, on others
> >   it may result in unpredictable behaviour of your Apache server. Yet on
> >   others it will work just fine. The recommended approach is to compile
> >   Python without thread support in a separate location and specify it
with
> >   --with-python option to this ./configure script.
> >
> > checking Python install prefix... /usr
> > checking what libraries Python was linked with... grep:
/usr/src/redhat/SOURCES/Python-2.2.1/Modules/Makefile: No such file or
directory
> > grep: /usr/src/redhat/SOURCES/Python-2.2.1/Modules/Makefile: No such
file or directory
> > /usr/src/redhat/SOURCES/Python-2.2.1/libpython1.5.a
> > checking linker flags used to link Python...  -Xlinker -export-dynamic
> >
> >
> >
> > ...So anyways, I keep seeing "checking Python version...1.5" and I'm
wondering if this is a problem.  Reason being, when I type "make dso" after
configuring mod_python, I get this:
> >
> > make dso
> > make[1]: Entering directory `/usr/src/mod_python-2.7.8/src'
> >
gcc  -I/usr/src/mod_python-2.7.8/src/include -I/usr/local/httpd-2.0.43/inclu
de -I/usr/src/redhat/SOURCES/Python-2.2.1 -I/usr/src/redhat/SOURCES/Python-2
.2.1/Include    -c -o mod_python.o mod_python.c
> > In file included from mod_python.c:54:
> > /usr/src/mod_python-2.7.8/src/include/mod_python.h:93: parse error
before `*'
> > /usr/src/mod_python-2.7.8/src/include/mod_python.h:93: warning: data
definition has no type or storage class
> > /usr/src/mod_python-2.7.8/src/include/mod_python.h:96: parse error
before `python_module'
> > /usr/src/mod_python-2.7.8/src/include/mod_python.h:96: warning: data
definition has no type or storage class
> > In file included from
/usr/src/mod_python-2.7.8/src/include/mod_python.h:99,
> >                  from mod_python.c:54:
> > /usr/src/mod_python-2.7.8/src/include/util.h:57: parse error before `*'
> > In file included from
/usr/src/mod_python-2.7.8/src/include/mod_python.h:100,
> >                  from mod_python.c:54:
> >
/usr/src/mod_python-2.7.8/src/include/tableobject.h:69blablahblahblah....
> >
> >
> >
> > Anyone have any ideas as to why this isn't working?
> >
> >
> > Josh
> > Chicago, IL
>


From mark at camazotz.com  Mon Nov 11 17:47:38 2002
From: mark at camazotz.com (Mark Smith)
Date: Fri Jan  9 22:03:35 2004
Subject: [mod_python] building mod_python 3.0 on OS X
Message-ID: <93ECDF38-F5C7-11D6-9A20-00039364CE50@camazotz.com>

I'm trying to build mod_python 3.0b4 on OS X 10.2.  I've built Apache2
and it seems to work fine.  I've configured the mod_python build using
'--with-apxs' pointing to the version of apxs in the Apache2 bin 
directory.
The mod_python make finishes without errors, but when it's done,
src/mod_python.so is a soft link to src/.libs/mod_python.so, which
doesn't exist.  Any ideas on what (probably obvious) step I'm missing?

thanks,
Mark


From nathanr at nathanr.net  Tue Nov 12 13:15:02 2002
From: nathanr at nathanr.net (Nathan Robertson)
Date: Fri Jan  9 22:03:35 2004
Subject: [mod_python] 3.0.0 beta 4 - compile on Mac OS X
Message-ID: <3DD06426.6@nathanr.net>

Hi,

I've been fighting mod_python 3.0.0 beta 4 on Mac OS X 10.2.2 this 
morning. Compiling against apache 2.0.43, python 2.2.1. The filesystem 
is UFS, not HFS+.

Apache is configured as such:
./configure --with-mpm=threadpool --enable-so 
--prefix=/Volumes/UFS/local/httpd-2.0.43

and mod_python:
./configure --with-apxs=/Volumes/UFS/local/httpd-2.0.43/bin/apxs

make runs fine, make install breaks. Looked into it, and apxs doesn't 
create src/.libs/mod_python.so, only mod_python.lai (and the .la symlink 
to it). I tested this under Linux/PPC and Linux/i386 and both of them 
create the .so fine.

Has anyone else tried a similar setup on Mac OS X? Any successes?

Nathan.


From laurie at tratt.net  Tue Nov 12 09:19:40 2002
From: laurie at tratt.net (Laurence Tratt)
Date: Fri Jan  9 22:03:35 2004
Subject: [mod_python] 3.0.0 beta 4 - compile on Mac OS X
In-Reply-To: <3DD06426.6@nathanr.net>; from nathanr@nathanr.net on Tue, Nov 12, 2002 at 01:15:02PM +1100
References: <3DD06426.6@nathanr.net>
Message-ID: <20021112091940.B32177@purcell.dcs.kcl.ac.uk>

On Tue, Nov 12, 2002 at 01:15:02PM +1100, Nathan Robertson wrote:

[Apache and MacOS X]
> make runs fine, make install breaks. Looked into it, and apxs doesn't
> create src/.libs/mod_python.so, only mod_python.lai (and the .la symlink
> to it). I tested this under Linux/PPC and Linux/i386 and both of them
> create the .so fine.
>
> Has anyone else tried a similar setup on Mac OS X? Any successes?

Exactly the same thing happens under OpenBSD - I presume that part of our
shared BSD heritage is causing us problems. Interestingly, mod_python works
(well, builds) under FreeBSD; I have no idea about NetBSD though.

Best wishes,


Laurie

From nathanr at nathanr.net  Tue Nov 12 22:50:13 2002
From: nathanr at nathanr.net (Nathan Robertson)
Date: Fri Jan  9 22:03:35 2004
Subject: [mod_python] 3.0.0 beta 4 - compile on Mac OS X
References: <3DD06426.6@nathanr.net> <20021112091940.B32177@purcell.dcs.kcl.ac.uk>
Message-ID: <3DD0EAF5.8000007@nathanr.net>

Laurence Tratt wrote:
> On Tue, Nov 12, 2002 at 01:15:02PM +1100, Nathan Robertson wrote:
> 
> [Apache and MacOS X]
> 
>>make runs fine, make install breaks. Looked into it, and apxs doesn't
>>create src/.libs/mod_python.so, only mod_python.lai (and the .la symlink
>>to it). I tested this under Linux/PPC and Linux/i386 and both of them
>>create the .so fine.
>>
>>Has anyone else tried a similar setup on Mac OS X? Any successes?
> 
> Exactly the same thing happens under OpenBSD - I presume that part of our
> shared BSD heritage is causing us problems. Interestingly, mod_python works
> (well, builds) under FreeBSD; I have no idea about NetBSD though.

Yeah - I noted the FreeBSD note in the README, and did what it said, but 
that didn't make any difference.

Interesting that you got that on OpenBSD though. Plain wierd actually. 
Is that OpenBSD/i386 or on another platform (ppc?).

This could yet be an Apache bug in apxs, I guess. I haven't tried 
compiling any other modules against it.

Nathan.


From laurie at tratt.net  Tue Nov 12 11:51:18 2002
From: laurie at tratt.net (Laurence Tratt)
Date: Fri Jan  9 22:03:35 2004
Subject: [mod_python] 3.0.0 beta 4 - compile on Mac OS X
In-Reply-To: <3DD0EAF5.8000007@nathanr.net>; from nathanr@nathanr.net on Tue, Nov 12, 2002 at 10:50:13PM +1100
References: <3DD06426.6@nathanr.net> <20021112091940.B32177@purcell.dcs.kcl.ac.uk> <3DD0EAF5.8000007@nathanr.net>
Message-ID: <20021112115118.Q31512@purcell.dcs.kcl.ac.uk>

On Tue, Nov 12, 2002 at 10:50:13PM +1100, Nathan Robertson wrote:

[Apache and MacOS X]
>>> make runs fine, make install breaks. Looked into it, and apxs doesn't
>>> create src/.libs/mod_python.so, only mod_python.lai (and the .la symlink
>>> to it). I tested this under Linux/PPC and Linux/i386 and both of them
>>> create the .so fine.
>>>
>>> Has anyone else tried a similar setup on Mac OS X? Any successes?
>> Exactly the same thing happens under OpenBSD - I presume that part of our
>> shared BSD heritage is causing us problems. Interestingly, mod_python
>> works (well, builds) under FreeBSD; I have no idea about NetBSD though.
> Yeah - I noted the FreeBSD note in the README, and did what it said, but
> that didn't make any difference.
>
> Interesting that you got that on OpenBSD though. Plain wierd actually.
> Is that OpenBSD/i386 or on another platform (ppc?).

OpenBSD-current/i386.

> This could yet be an Apache bug in apxs, I guess. I haven't tried
> compiling any other modules against it.

I suspect it's either apxs (of which I know very little) or libtool (where
what I know I dislike). But that doesn't help me much as I am unable in a
short time scale to fix or coerce either of them :)

Best wishes,


Laurie

From jgramlich at piocon.com  Tue Nov 12 10:21:32 2002
From: jgramlich at piocon.com (Joshua Gramlich)
Date: Fri Jan  9 22:03:35 2004
Subject: [mod_python] mod_python tutorial issues
References: <20021111164814.J22386-100000@eden.ispol.com>
Message-ID: <02c401c28a67$92e1eea0$cb3ac341@ginworks.com>

Okay, my environment:

redhat linux 7.2
mod_python == most recent beta 4 of version 3 (compiled as dso)
apache == 2.0.43
python == 2.2.1 threads enabled...

Now, I'm going through the tutorial, and the little "hello world" program
seems to work just fine.  It's when I get to the authentication piece that
it messes up.  Here's the file I'm trying to "run":

################## myscript.py ##################################
from mod_python import apache

def authenhandler(req):
    pw = req.get_basic_auth_pw()
    user = req.connection.user
    if user == "spam" and pw == "eggs":
        return apache.OK
    else:
        return apache.HTTP_UNAUTHORIZED

def handler(pik):
    pik.content_type = "text/plain"
    pik.send_http_header()
    pik.write("Hello cruel World!")
    pik.write("Eat my shirt...")
    return apache.OK

#######################################################

...and the following is the error_log entry of apache when running:



[Tue Nov 12 10:03:51 2002] [notice] Graceful restart requested, doing
restart
[Tue Nov 12 10:03:57 2002] [notice] Apache/2.0.43 (Unix)
mod_python/3.0-BETA4 Python/2.2.1 configured -- resuming normal operations
[Tue Nov 12 10:05:12 2002] [error] [client 65.195.58.203]
PythonAuthenHandler myscript: Traceback (most recent call last):
[Tue Nov 12 10:05:12 2002] [error] [client 65.195.58.203]
PythonAuthenHandler myscript:   File
"/usr/lib/python2.2/site-packages/mod_python/apache.py", line 335, in
HandlerDispatch
    result = object(req)
[Tue Nov 12 10:05:12 2002] [error] [client 65.195.58.203]
PythonAuthenHandler myscript:   File
"/var/www/webroot/modpythontest/myscript.py", line 7, in authenhandler
    user = req.connection.user
[Tue Nov 12 10:05:12 2002] [error] [client 65.195.58.203]
PythonAuthenHandler myscript: AttributeError: user


Other behavior:
...when trying to access the "myscript.py" file, the internet explorer
authentication popup box appears...asking for username and password.
Whatever you enter for username and password does not matter, and every time
you hit the "OK" button, I get the Internal Server Error (see above) page
from IE.  If I hit "Cancel" instead, I get the "You must be authorized
blahblahblah...", so it looks as though the Apache portion is working...


Josh
Chicago, IL


From grisha at modpython.org  Tue Nov 12 11:56:50 2002
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 22:03:35 2004
Subject: [mod_python] mod_python tutorial issues
In-Reply-To: <02c401c28a67$92e1eea0$cb3ac341@ginworks.com>
Message-ID: <20021112115519.R33105-100000@eden.ispol.com>

You've mod_python 3.0, but are using the tutorial for 2.x, that's not
going to work :)

In MP 3.0 it's req.user rather than req.connection.user. Also, you don't
need send_http_header() anymore, it's a noop in MP 3.0.

Grisha

On Tue, 12 Nov 2002, Joshua Gramlich wrote:

> Okay, my environment:
>
> redhat linux 7.2
> mod_python == most recent beta 4 of version 3 (compiled as dso)
> apache == 2.0.43
> python == 2.2.1 threads enabled...
>
> Now, I'm going through the tutorial, and the little "hello world" program
> seems to work just fine.  It's when I get to the authentication piece that
> it messes up.  Here's the file I'm trying to "run":
>
> ################## myscript.py ##################################
> from mod_python import apache
>
> def authenhandler(req):
>     pw = req.get_basic_auth_pw()
>     user = req.connection.user
>     if user == "spam" and pw == "eggs":
>         return apache.OK
>     else:
>         return apache.HTTP_UNAUTHORIZED
>
> def handler(pik):
>     pik.content_type = "text/plain"
>     pik.send_http_header()
>     pik.write("Hello cruel World!")
>     pik.write("Eat my shirt...")
>     return apache.OK
>
> #######################################################
>
> ...and the following is the error_log entry of apache when running:
>
>
>
> [Tue Nov 12 10:03:51 2002] [notice] Graceful restart requested, doing
> restart
> [Tue Nov 12 10:03:57 2002] [notice] Apache/2.0.43 (Unix)
> mod_python/3.0-BETA4 Python/2.2.1 configured -- resuming normal operations
> [Tue Nov 12 10:05:12 2002] [error] [client 65.195.58.203]
> PythonAuthenHandler myscript: Traceback (most recent call last):
> [Tue Nov 12 10:05:12 2002] [error] [client 65.195.58.203]
> PythonAuthenHandler myscript:   File
> "/usr/lib/python2.2/site-packages/mod_python/apache.py", line 335, in
> HandlerDispatch
>     result = object(req)
> [Tue Nov 12 10:05:12 2002] [error] [client 65.195.58.203]
> PythonAuthenHandler myscript:   File
> "/var/www/webroot/modpythontest/myscript.py", line 7, in authenhandler
>     user = req.connection.user
> [Tue Nov 12 10:05:12 2002] [error] [client 65.195.58.203]
> PythonAuthenHandler myscript: AttributeError: user
>
>
> Other behavior:
> ...when trying to access the "myscript.py" file, the internet explorer
> authentication popup box appears...asking for username and password.
> Whatever you enter for username and password does not matter, and every time
> you hit the "OK" button, I get the Internal Server Error (see above) page
> from IE.  If I hit "Cancel" instead, I get the "You must be authorized
> blahblahblah...", so it looks as though the Apache portion is working...
>
>
> Josh
> Chicago, IL
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
>


From jgramlich at piocon.com  Tue Nov 12 10:59:33 2002
From: jgramlich at piocon.com (Joshua Gramlich)
Date: Fri Jan  9 22:03:35 2004
Subject: [mod_python] mod_python tutorial issues
References: <20021112115519.R33105-100000@eden.ispol.com>
Message-ID: <02e801c28a6c$e0015540$cb3ac341@ginworks.com>

Well, that is helpful.  Am I to assume that I should really be using the
docs that came with modpython3 rather than www.modpython.org?  Boy, am I
lazy....


Josh



----- Original Message -----
From: "Gregory (Grisha) Trubetskoy" <grisha@modpython.org>
To: "Joshua Gramlich" <jgramlich@piocon.com>
Cc: <mod_python@modpython.org>
Sent: Tuesday, November 12, 2002 10:56 AM
Subject: Re: [mod_python] mod_python tutorial issues


>
> You've mod_python 3.0, but are using the tutorial for 2.x, that's not
> going to work :)
>
> In MP 3.0 it's req.user rather than req.connection.user. Also, you don't
> need send_http_header() anymore, it's a noop in MP 3.0.
>
> Grisha
>
> On Tue, 12 Nov 2002, Joshua Gramlich wrote:
>
> > Okay, my environment:
> >
> > redhat linux 7.2
> > mod_python == most recent beta 4 of version 3 (compiled as dso)
> > apache == 2.0.43
> > python == 2.2.1 threads enabled...
> >
> > Now, I'm going through the tutorial, and the little "hello world"
program
> > seems to work just fine.  It's when I get to the authentication piece
that
> > it messes up.  Here's the file I'm trying to "run":
> >
> > ################## myscript.py ##################################
> > from mod_python import apache
> >
> > def authenhandler(req):
> >     pw = req.get_basic_auth_pw()
> >     user = req.connection.user
> >     if user == "spam" and pw == "eggs":
> >         return apache.OK
> >     else:
> >         return apache.HTTP_UNAUTHORIZED
> >
> > def handler(pik):
> >     pik.content_type = "text/plain"
> >     pik.send_http_header()
> >     pik.write("Hello cruel World!")
> >     pik.write("Eat my shirt...")
> >     return apache.OK
> >
> > #######################################################
> >
> > ...and the following is the error_log entry of apache when running:
> >
> >
> >
> > [Tue Nov 12 10:03:51 2002] [notice] Graceful restart requested, doing
> > restart
> > [Tue Nov 12 10:03:57 2002] [notice] Apache/2.0.43 (Unix)
> > mod_python/3.0-BETA4 Python/2.2.1 configured -- resuming normal
operations
> > [Tue Nov 12 10:05:12 2002] [error] [client 65.195.58.203]
> > PythonAuthenHandler myscript: Traceback (most recent call last):
> > [Tue Nov 12 10:05:12 2002] [error] [client 65.195.58.203]
> > PythonAuthenHandler myscript:   File
> > "/usr/lib/python2.2/site-packages/mod_python/apache.py", line 335, in
> > HandlerDispatch
> >     result = object(req)
> > [Tue Nov 12 10:05:12 2002] [error] [client 65.195.58.203]
> > PythonAuthenHandler myscript:   File
> > "/var/www/webroot/modpythontest/myscript.py", line 7, in authenhandler
> >     user = req.connection.user
> > [Tue Nov 12 10:05:12 2002] [error] [client 65.195.58.203]
> > PythonAuthenHandler myscript: AttributeError: user
> >
> >
> > Other behavior:
> > ...when trying to access the "myscript.py" file, the internet explorer
> > authentication popup box appears...asking for username and password.
> > Whatever you enter for username and password does not matter, and every
time
> > you hit the "OK" button, I get the Internal Server Error (see above)
page
> > from IE.  If I hit "Cancel" instead, I get the "You must be authorized
> > blahblahblah...", so it looks as though the Apache portion is working...
> >
> >
> > Josh
> > Chicago, IL
> >
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://www.modpython.org/mailman/listinfo/mod_python
> >
>


From grisha at modpython.org  Tue Nov 12 12:00:53 2002
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 22:03:35 2004
Subject: [mod_python] 3.0.0 beta 4 - compile on Mac OS X
In-Reply-To: <20021112091940.B32177@purcell.dcs.kcl.ac.uk>
Message-ID: <20021112115805.K33105-100000@eden.ispol.com>

This may be a problem with Apache 2.0.43 which has a slightly screwed up
distribution file which comes with an outdated libtool.

I don't know if it will help or not, but try running ./buildconf in Apache
source tree before running ./configure.

Grisha

On Tue, 12 Nov 2002, Laurence Tratt wrote:

> On Tue, Nov 12, 2002 at 01:15:02PM +1100, Nathan Robertson wrote:
>
> [Apache and MacOS X]
> > make runs fine, make install breaks. Looked into it, and apxs doesn't
> > create src/.libs/mod_python.so, only mod_python.lai (and the .la symlink
> > to it). I tested this under Linux/PPC and Linux/i386 and both of them
> > create the .so fine.
> >
> > Has anyone else tried a similar setup on Mac OS X? Any successes?
>
> Exactly the same thing happens under OpenBSD - I presume that part of our
> shared BSD heritage is causing us problems. Interestingly, mod_python works
> (well, builds) under FreeBSD; I have no idea about NetBSD though.
>
> Best wishes,
>
>
> Laurie
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
>


From laurie at tratt.net  Tue Nov 12 23:56:52 2002
From: laurie at tratt.net (Laurence Tratt)
Date: Fri Jan  9 22:03:35 2004
Subject: [mod_python] 3.0.0 beta 4 - compile on Mac OS X
In-Reply-To: <20021112115805.K33105-100000@eden.ispol.com>; from grisha@modpython.org on Tue, Nov 12, 2002 at 12:00:53PM -0500
References: <20021112091940.B32177@purcell.dcs.kcl.ac.uk> <20021112115805.K33105-100000@eden.ispol.com>
Message-ID: <20021112235651.B2626@purcell.dcs.kcl.ac.uk>

On Tue, Nov 12, 2002 at 12:00:53PM -0500, Gregory (Grisha) Trubetskoy wrote:

> This may be a problem with Apache 2.0.43 which has a slightly screwed up
> distribution file which comes with an outdated libtool.
>
> I don't know if it will help or not, but try running ./buildconf in Apache
> source tree before running ./configure.

I haven't had a chance to interpret this yet but doing this gives me a
different error, which does at look least a little more likely to be
resolveable:

"""
/usr/local/apache2/build/libtool --silent --mode=link gcc -o mod_python.la
-I/usr/local/src/mod_python-3.0.0-BETA4/src/include
-I/usr/local/apache2/include -I/usr/local/include/python2.2  -rpath
/usr/local/apache2/modules -module -avoid-version  hlistobject.lo hlist.lo
filterobject.lo connobject.lo serverobject.lo util.lo tableobject.lo
requestobject.lo _apachemodule.lo mod_python.lo
-L/usr/ports/lang/python/2.2/w-python-2.2.1/Python-2.2.1 -lm
/usr/local/lib/python2.2/config/libpython2.2.a -pthread -lutil -lm
libtool: link: cannot build libtool library `mod_python.la' from non-libtool
objects: /usr/local/lib/python2.2/config/libpython2.2.a
apxs:Error: Command failed with rc=65536
"""

Now whether that's a MacOS X|OpenBSD thing that Python didn't use libtool
to build I don't currently know, but I'll try and look into it over the
next couple of days. If anyone has any clues, of course they'd be more than
welcome!

Best wishes,


Laurie

From gbenson at redhat.com  Wed Nov 13 10:22:35 2002
From: gbenson at redhat.com (Gary Benson)
Date: Fri Jan  9 22:03:35 2004
Subject: [mod_python] Apache 1.3, mod_python, and threads
Message-ID: <20021113102233.GA21664@redhat.com>

I'm pretty sure that this is the case, but could someone confirm that
it is _not_ possible to build mod_python-2.7.8 for Apache 1.3 against
Python 2.2 unless Python is built without threads.  Also, assuming
that is true, does anyone know why this is the case (apart from
'because python dies in apache startup' ;))

Thanks in advance,
Gary

[ gbenson@redhat.com ][ GnuPG 85A8F78B ][ http://inauspicious.org/ ]

From nathanr at nathanr.net  Wed Nov 13 21:41:10 2002
From: nathanr at nathanr.net (Nathan Robertson)
Date: Fri Jan  9 22:03:35 2004
Subject: [mod_python] 3.0.0 beta 4 - compile on Mac OS X
References: <20021112091940.B32177@purcell.dcs.kcl.ac.uk> <20021112115805.K33105-100000@eden.ispol.com> <20021112235651.B2626@purcell.dcs.kcl.ac.uk>
Message-ID: <3DD22C46.6000302@nathanr.net>

MacOS X gives exactly the same error message as that when making mod_python.

Nathan

Laurence Tratt wrote:
> On Tue, Nov 12, 2002 at 12:00:53PM -0500, Gregory (Grisha) Trubetskoy wrote:
> 
> 
>>This may be a problem with Apache 2.0.43 which has a slightly screwed up
>>distribution file which comes with an outdated libtool.
>>
>>I don't know if it will help or not, but try running ./buildconf in Apache
>>source tree before running ./configure.
> 
> 
> I haven't had a chance to interpret this yet but doing this gives me a
> different error, which does at look least a little more likely to be
> resolveable:
> 
> """
> /usr/local/apache2/build/libtool --silent --mode=link gcc -o mod_python.la
> -I/usr/local/src/mod_python-3.0.0-BETA4/src/include
> -I/usr/local/apache2/include -I/usr/local/include/python2.2  -rpath
> /usr/local/apache2/modules -module -avoid-version  hlistobject.lo hlist.lo
> filterobject.lo connobject.lo serverobject.lo util.lo tableobject.lo
> requestobject.lo _apachemodule.lo mod_python.lo
> -L/usr/ports/lang/python/2.2/w-python-2.2.1/Python-2.2.1 -lm
> /usr/local/lib/python2.2/config/libpython2.2.a -pthread -lutil -lm
> libtool: link: cannot build libtool library `mod_python.la' from non-libtool
> objects: /usr/local/lib/python2.2/config/libpython2.2.a
> apxs:Error: Command failed with rc=65536
> """
> 
> Now whether that's a MacOS X|OpenBSD thing that Python didn't use libtool
> to build I don't currently know, but I'll try and look into it over the
> next couple of days. If anyone has any clues, of course they'd be more than
> welcome!
> 
> Best wishes,
> 
> 
> Laurie
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 
> 




From gbenson at redhat.com  Wed Nov 13 10:49:08 2002
From: gbenson at redhat.com (Gary Benson)
Date: Fri Jan  9 22:03:35 2004
Subject: [mod_python] Apache 1.3, mod_python, and threads
In-Reply-To: <200211131224.19230.mateusz@ant.gliwice.pl>
References: <20021113102233.GA21664@redhat.com> <200211131224.19230.mateusz@ant.gliwice.pl>
Message-ID: <20021113104908.GB21664@redhat.com>

On Wed, Nov 13, 2002 at 12:24:19PM +0100, Mateusz Korniak wrote:
> On Wednesday 13 November 2002 11:22, Gary Benson wrote:
> > I'm pretty sure that this is the case, but could someone confirm that
> > it is _not_ possible to build mod_python-2.7.8 for Apache 1.3 against
> > Python 2.2 unless Python is built without threads.
> 
> I might missed start of thread, but

Nope, that message is the only one in it 

> I pretty sure _I'm_ _able_ to build, and extensively use mod_python
> with both python 2.2.1 and 2.2.2, and both compiled with threads.

This is with Apache 1.3?  I have Apache 1.3.23, Python 2.2 and
mod_python 2.7.8.  If I build Python with threads then Apache dies on
startup with the malformed error message "alize: can't make modules
dictionary"

Maybe the problem is Python 2.2 as opposed to 2.2.1/2.2.2.  I'll try
with one of those.

Cheers,
Gary

[ gbenson@redhat.com ][ GnuPG 85A8F78B ][ http://inauspicious.org/ ]

From mateusz at ant.gliwice.pl  Wed Nov 13 13:22:38 2002
From: mateusz at ant.gliwice.pl (Mateusz Korniak)
Date: Fri Jan  9 22:03:35 2004
Subject: [mod_python] Apache 1.3, mod_python, and threads
In-Reply-To: <20021113104908.GB21664@redhat.com>
References: <20021113102233.GA21664@redhat.com> <200211131224.19230.mateusz@ant.gliwice.pl> <20021113104908.GB21664@redhat.com>
Message-ID: <200211131322.38756.mateusz@ant.gliwice.pl>

On Wednesday 13 November 2002 11:49, Gary Benson wrote:

> > I pretty sure _I'm_ _able_ to build, and extensively use mod_python
> > with both python 2.2.1 and 2.2.2, and both compiled with threads.
>
> This is with Apache 1.3?  I have Apache 1.3.23, Python 2.2 and
> mod_python 2.7.8.  If I build Python with threads then Apache dies on
> startup with the malformed error message "alize: can't make modules
> dictionary"

[matkor@appserver ~]$ rpm -q apache
apache-1.3.27-3
[matkor@appserver ~]$ rpm -q apache-mod_python
apache-mod_python-2.7.8-6
[matkor@appserver ~]$ rpm -q python
python-2.2.2-1

( All specs used to build those rpms are on http://www.pld.org.pl/devel/cvs/ 
there should be alse src rpms ...)

[matkor@appserver ~]$ python
Python 2.2.2 (#1, Nov  9 2002, 21:07:57)
[GCC 2.95.4 20010319 (prerelease)] on linux2
Type "help", "copyright", "credits" or "license" for more information.
>>> import thread
>>>

> Maybe the problem is Python 2.2 as opposed to 2.2.1/2.2.2.  I'll try
> with one of those.

I had only problems with mod_python itself but only  when I tried use 
mod_python dynlinked .. but symptoms ware different - segfault on first use 
of mod_python.


-- 
Mateusz Korniak



From antonio at memora.com  Wed Nov 13 07:40:54 2002
From: antonio at memora.com (Antonio L Rodriguez)
Date: Fri Jan  9 22:03:35 2004
Subject: [mod_python] Apache 1.3, mod_python, and threads
In-Reply-To: <20021113102233.GA21664@redhat.com>
Message-ID: <2658F540-F705-11D6-A9E6-00039300D690@memora.com>

I've built it wit threads on debian 3.0/Intel  (apache 1.3.26) no 
problem.

I'm not sure its advised however, though as you've probably seen in the 
docs. My approach has been that so long as I stay away from thread 
usage in the scripts I should be ok but I haven't verified this too 
seriously.

AR

On Wednesday, November 13, 2002, at 05:22 AM, Gary Benson wrote:

> I'm pretty sure that this is the case, but could someone confirm that
> it is _not_ possible to build mod_python-2.7.8 for Apache 1.3 against
> Python 2.2 unless Python is built without threads.  Also, assuming
> that is true, does anyone know why this is the case (apart from
> 'because python dies in apache startup' ;))
>
> Thanks in advance,
> Gary
>
> [ gbenson@redhat.com ][ GnuPG 85A8F78B ][ http://inauspicious.org/ ]
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
>


From antonio at memora.com  Wed Nov 13 09:15:19 2002
From: antonio at memora.com (Antonio L Rodriguez)
Date: Fri Jan  9 22:03:35 2004
Subject: [mod_python] Funky publisher behavior under apache 1.3
Message-ID: <56B386A8-F712-11D6-A9E6-00039300D690@memora.com>

Hey all,

I've been playing around with the publisher but have been having some 
issues. First, I get this in my apache logs all the time:

[Wed Nov 13 08:49:01 2002] [notice] mod_python: (Re)importing 
mod_python.publisher from None


This happens even when the underlying files do not change (either the 
script or the publisher.py file ).

Second, I'm getting erratic behavior where the publisher will find a 
function one time and then generate a 404 a couple of requests later 
for no apparent reason.

I am using python 2.2.2 with threads but this hasn't been a problem in 
the past and I'm not actually using the threading libs. in my script.

Anyone run into this type of behavior with publisher.py?

Thanks

AR


From gbenson at redhat.com  Wed Nov 13 14:45:45 2002
From: gbenson at redhat.com (Gary Benson)
Date: Fri Jan  9 22:03:35 2004
Subject: [mod_python] Apache 1.3, mod_python, and threads
In-Reply-To: <20021113104908.GB21664@redhat.com>
References: <20021113102233.GA21664@redhat.com> <200211131224.19230.mateusz@ant.gliwice.pl> <20021113104908.GB21664@redhat.com>
Message-ID: <20021113144543.GC21664@redhat.com>

On Wed, Nov 13, 2002 at 10:49:08AM +0000, Gary Benson wrote:
> On Wed, Nov 13, 2002 at 12:24:19PM +0100, Mateusz Korniak wrote:
> > I pretty sure _I'm_ _able_ to build, and extensively use mod_python
> > with both python 2.2.1 and 2.2.2, and both compiled with threads.
> 
> This is with Apache 1.3?  I have Apache 1.3.23, Python 2.2 and
> mod_python 2.7.8.  If I build Python with threads then Apache dies on
> startup with the malformed error message "alize: can't make modules
> dictionary"
> 
> Maybe the problem is Python 2.2 as opposed to 2.2.1/2.2.2.  I'll try
> with one of those.

I upgraded from 2.2 to 2.2.1 and the problem went away; thanks guys!

Gary

[ gbenson@redhat.com ][ GnuPG 85A8F78B ][ http://inauspicious.org/ ]

From vmanera at manord.com  Wed Nov 13 15:52:10 2002
From: vmanera at manord.com (Manera, Villiam)
Date: Fri Jan  9 22:03:35 2004
Subject: R: [mod_python] Funky publisher behavior under apache 1.3
Message-ID: <52DC70C1C1575C418CB033523A29CF140E0527@exchange2000.manord.com>

I've submitted the same problem the 17 October, and is still a problem:
From: Manera, Villiam <vmanera@manord.com>
To: 'mod_python@modpython.org' <mod_python@modpython.org>
Date: 17 October 2002 19:13
Subject: [mod_python] strange behavior of mod-python


>
>I'm currently use mod-python 2.7.6 on apache 1.3.26 - windows 2000 with
>python 2.2
>apache config:
>.....
>    ScriptAlias /comm/ "E:/script/cgi/comm/"
>    ScriptAlias /tecnico/ "E:/script/cgi/tecnico/"
>....
><Directory "E:/script/cgi/comm">
>        Order Deny,Allow
>        Deny from all
>        Allow from .....
>       ...
>    AddHandler python-program .py
>    PythonHandler mod_python.publisher
> PythonPath "sys.path+['c:/program
>files/python22/lib/site-packages/mdnlib', 'c:/program
>files/python22/lib/site-packages/HTMLgen','E:/script/cgi/comm']"
>    PythonDebug on
>    </Directory>
>
>----------------------------------------------------
>all work fine, but sometimes (today 4 time) when a url is typed:
>http://sviluppo.manord.com/comm/comm_ocordiu0.py/main?....
>
>I have this behavior from apache:
>HTTP 404 - File non trovato (not found)
>Internet Explorer
>but the program is still in place, and the only way to force apache to
found
>the program is restart the apache services,
>or make a copy of comm_ocordiu0 in comm_ocordiu1 and then call this one,
>but....
>
>
>
>this is not a real problem in developement web server, but  today it
>happened 4 time, in production is happened 2 time in one month,
>and I become in panic.
>
>Any advice here would be greatly appreciated.
>
>Villiam

-----Messaggio originale-----
Da: Antonio L Rodriguez [mailto:antonio@memora.com]
Inviato: mercoled? 13 novembre 2002 15.15
A: mod_python@modpython.org
Oggetto: [mod_python] Funky publisher behavior under apache 1.3


Hey all,

I've been playing around with the publisher but have been having some 
issues. First, I get this in my apache logs all the time:

[Wed Nov 13 08:49:01 2002] [notice] mod_python: (Re)importing 
mod_python.publisher from None


This happens even when the underlying files do not change (either the 
script or the publisher.py file ).

Second, I'm getting erratic behavior where the publisher will find a 
function one time and then generate a 404 a couple of requests later 
for no apparent reason.

I am using python 2.2.2 with threads but this hasn't been a problem in 
the past and I'm not actually using the threading libs. in my script.

Anyone run into this type of behavior with publisher.py?

Thanks

AR

_______________________________________________
Mod_python mailing list
Mod_python@modpython.org
http://www.modpython.org/mailman/listinfo/mod_python


From jquinte at fadu.uba.ar  Wed Nov 13 13:21:01 2002
From: jquinte at fadu.uba.ar (Javier Quinteros)
Date: Fri Jan  9 22:03:35 2004
Subject: [mod_python] =?iso-8859-1?Q?Comp=EClation?= error in Solaris 8...
Message-ID: <3DD27BED.CF84CFA2@fadu.uba.ar>

Hi !!!
I've seen a problem like this posted before but there was no
satisfactory answer.

I'm using Solaris 8, Apache 1.3.26, Python 2.2.1 and ModPython 2.7.8.

This are the steps I execute:
* ./configure --with-apache=/usr/...........
* make static
* make install

Then I move to the apache source directory and:

* ./configure (as specified in modpython instructions)
* make

Then I get an error telling me that there are "Undefined Symbols" (about
40). All of them are Python Symbols (PySequence, etc.).

The only answer I've found in the archives is from a Brasilian guy
telling that the libmodpython.a has to be compiled with the -fpic flag
when using gcc.

Please, I need a solution ASAP.

Thanks in advance.

Javier Quinteros
Universidad de Buenos Aires



From jwyant at sfbcic.com  Wed Nov 13 12:46:03 2002
From: jwyant at sfbcic.com (Wyant, Jaime)
Date: Fri Jan  9 22:03:35 2004
Subject: [mod_python] Write errors (client closed connection)
Message-ID: <654DAEACA633D511B5F500902784B052188EE1@MS-EXCHANGE>

What usually causes a webbrowser to close a connection?  I assume the user
"closes" their browser which closes the connection.

I usually get this exception:

IOError: Write failed, client closed connection. 

Can anyone elaborate?

Thanks!
jaime wyant (jwyant@sfbcic . com)
MS Farm Bureau
(601) 977 - 4291



From grisha at modpython.org  Wed Nov 13 15:10:53 2002
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 22:03:35 2004
Subject: [mod_python] Write errors (client closed connection)
In-Reply-To: <654DAEACA633D511B5F500902784B052188EE1@MS-EXCHANGE>
Message-ID: <20021113151011.P48789-100000@eden.ispol.com>

I think this will happen if they click the "stop" button also.

On Wed, 13 Nov 2002, Wyant, Jaime wrote:

> What usually causes a webbrowser to close a connection?  I assume the user
> "closes" their browser which closes the connection.
>
> I usually get this exception:
>
> IOError: Write failed, client closed connection.
>
> Can anyone elaborate?
>
> Thanks!
> jaime wyant (jwyant@sfbcic . com)
> MS Farm Bureau
> (601) 977 - 4291
>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
>


From agenkin-lst-mod_python at thpoon.com  Thu Nov 14 15:32:28 2002
From: agenkin-lst-mod_python at thpoon.com (Arcady Genkin)
Date: Fri Jan  9 22:03:35 2004
Subject: [mod_python] SetHandler and a subdirectory with static contents (images)
Message-ID: <uoel9nc2oz.fsf@bashful.cdf.toronto.edu>

I cannot send image files when using the Publisher handler: apache
tries to run them as Python programs. ;^)  I tried setting to handler
for the images directory to the default, but it didn't work.  With
Apache 2.0.43 and mod_python-3.0B4, I have the following config:

,----[ httpd.conf ]
| <Directory "/var/www/data">
|    PythonDebug On
|    SetHandler python-program
|    PythonHandler mod_python.publisher
| </Directory>
| 
| <Directory "/var/www/data/images">
|   SetHandler default-handler
| </Directory>
`----

Since /var/www/data is the DocumentRoot, I cannot place the images in
a directory outside of it...

What am I doing wrong?
-- 
Arcady Genkin

guilt is the cause of more disauders
than history's most obscene marorders (E.E. Cummings)

From vmilitaru at sympatico.ca  Thu Nov 14 21:00:38 2002
From: vmilitaru at sympatico.ca (vio)
Date: Fri Jan  9 22:03:35 2004
Subject: [mod_python] SetHandler and a subdirectory with static contents 
 (images)
References: <uoel9nc2oz.fsf@bashful.cdf.toronto.edu>
Message-ID: <3DD45546.DA2BB937@sympatico.ca>

Looks like you forgot to include the python suffix, which restricts what
file types are to be handled by mod_python.publisher. Try it like this:

<IfModule mod_python.c>
<Directory /var/www/data>
    AddHandler python-program .py
    PythonHandler mod_python.publisher
    PythonDebug On
</Directory>
</IfModule>

Cheer,
Vio


Arcady Genkin wrote:

> I cannot send image files when using the Publisher handler: apache
> tries to run them as Python programs. ;^)  I tried setting to handler
> for the images directory to the default, but it didn't work.  With
> Apache 2.0.43 and mod_python-3.0B4, I have the following config:
>
> ,----[ httpd.conf ]
> | <Directory "/var/www/data">
> |    PythonDebug On
> |    SetHandler python-program
> |    PythonHandler mod_python.publisher
> | </Directory>
> |
> | <Directory "/var/www/data/images">
> |   SetHandler default-handler
> | </Directory>
> `----
>
> Since /var/www/data is the DocumentRoot, I cannot place the images in
> a directory outside of it...
>
> What am I doing wrong?
> --
> Arcady Genkin
>
> guilt is the cause of more disauders
> than history's most obscene marorders (E.E. Cummings)
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python


From Antonio at Memora.com  Thu Nov 14 21:21:43 2002
From: Antonio at Memora.com (Antonio Rodriguez)
Date: Fri Jan  9 22:03:35 2004
Subject: [mod_python] The story with python compiled with threads
References: <uoel9nc2oz.fsf@bashful.cdf.toronto.edu> <3DD45546.DA2BB937@sympatico.ca>
Message-ID: <000d01c28c4d$bdc48aa0$6b01a8c0@borg>

To those wiser in mod_python,

So the README says to definitely *NOT* use mod_python with python compiled
with threads in apache 1.3, but I bet that many people do anyway. What is
the story with what can go wrong? That is, I've heard of the apache
processes dying from the start and obviously using threads in your scripts
probably isn't cool, but what if mod_python seems to run ok most of the
time.

The basic question is this: what can happen if we use mod_python with python
with threads support in terms of partial failure?


Thanks

Antonio




From jack_diederich at email.com  Thu Nov 14 18:08:37 2002
From: jack_diederich at email.com (Jack Diederich)
Date: Fri Jan  9 22:03:36 2004
Subject: [mod_python] Write errors (client closed connection)
Message-ID: <20021114230837.8439.qmail@email.com>

This is also why apache recomends you run a proxy server in front of
your dynamic perl/python/whatever server.  The proxy server gets the client
close, but the mod_python server runs the process to completion.  If
you depend on something running all the way through without errors
(your code is bug free, right?) then you should really have a proxy
server in between you and the big bad world.

-jack

----- Original Message -----
From: "Gregory (Grisha) Trubetskoy" <grisha@modpython.org>
> 
> I think this will happen if they click the "stop" button also.
> 

-- 
_______________________________________________
Sign-up for your own FREE Personalized E-mail at Mail.com
http://www.mail.com/?sr=signup

Single & ready to mingle? lavalife.com:  Where singles click. Free to Search!
http://www.lavalife.com/wp.epl?a=2716


From gstein at lyra.org  Thu Nov 14 13:51:38 2002
From: gstein at lyra.org (Greg Stein)
Date: Fri Jan  9 22:03:36 2004
Subject: [mod_python] Write errors (client closed connection)
In-Reply-To: <20021113151011.P48789-100000@eden.ispol.com>; from grisha@modpython.org on Wed, Nov 13, 2002 at 03:10:53PM -0500
References: <654DAEACA633D511B5F500902784B052188EE1@MS-EXCHANGE> <20021113151011.P48789-100000@eden.ispol.com>
Message-ID: <20021114135138.K13799@lyra.org>

Yup, definitely. The client closes their side, but the server won't notice
that until it tries to write to the socket. Normally, this raises SIGPIPE,
but it appears somebody has caught/ignored that, so you just get the error.

Cheers,
-g

On Wed, Nov 13, 2002 at 03:10:53PM -0500, Gregory (Grisha) Trubetskoy wrote:
> 
> I think this will happen if they click the "stop" button also.
> 
> On Wed, 13 Nov 2002, Wyant, Jaime wrote:
> 
> > What usually causes a webbrowser to close a connection?  I assume the user
> > "closes" their browser which closes the connection.
> >
> > I usually get this exception:
> >
> > IOError: Write failed, client closed connection.
> >
> > Can anyone elaborate?
> >
> > Thanks!
> > jaime wyant (jwyant@sfbcic . com)
> > MS Farm Bureau
> > (601) 977 - 4291
> >
> >
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://www.modpython.org/mailman/listinfo/mod_python
> >
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python

-- 
Greg Stein, http://www.lyra.org/

From sandor.kopanyi at mailbox.hu  Fri Nov 15 16:27:21 2002
From: sandor.kopanyi at mailbox.hu (sandor.kopanyi@mailbox.hu)
Date: Fri Jan  9 22:03:36 2004
Subject: [mod_python] permanent db connection (more than in FAQ 3.3)
Message-ID: <20021115152721.7694.qmail@web2.mailbox.hu>

Hi,

In the mod_python FAQ 3.3 there is a good example of a 'permanent'
database
connection. This works fine, the connection is reused, as long as the
request
is handled in the same child process (apache child process). But a new
child
process gets a new interpreter => new connection is created. At least
that's
what I guess.

I've tried the Python*Interp* directives, but the connection is
re-created
regardless of those directives. Am I doing something wrong?

E.g. when setting PythonInterpeter to something (e.g. blabla), the
connection
is recreated again and again.

Any ideeas?

I'm using apache 1.3.23 with mod_python 2.7.6 on RedHat 7.3; the
application
is based on the publisher handler; the db connection code is almost
copy-paste from
the FAQ.

Best regards,
Sandor


________________________________________________
http://mailbox.hu - M?r SMS ?rtes?t?ssel is!



From mateusz at ant.gliwice.pl  Fri Nov 15 16:38:47 2002
From: mateusz at ant.gliwice.pl (Mateusz Korniak)
Date: Fri Jan  9 22:03:36 2004
Subject: [mod_python] permanent db connection (more than in FAQ 3.3)
In-Reply-To: <20021115152721.7694.qmail@web2.mailbox.hu>
References: <20021115152721.7694.qmail@web2.mailbox.hu>
Message-ID: <200211151638.47175.mateusz@ant.gliwice.pl>

On Friday 15 November 2002 16:27, sandor.kopanyi@mailbox.hu wrote:
> Hi,
>
> In the mod_python FAQ 3.3 there is a good example of a 'permanent'
> database
> connection. This works fine, the connection is reused, as long as the
> request
> is handled in the same child process (apache child process). But a new
> child
> process gets a new interpreter => new connection is created. At least
> that's
> what I guess.

Yes.
I keep one connection per each apache process.

-- 
Mateusz Korniak
"Black holes are where God divided by zero." - Steven Wright


From grisha at modpython.org  Fri Nov 15 11:25:41 2002
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 22:03:36 2004
Subject: [mod_python] permanent db connection (more than in FAQ 3.3)
In-Reply-To: <20021115152721.7694.qmail@web2.mailbox.hu>
Message-ID: <20021115112129.C74246-100000@eden.ispol.com>

There isn't much you can do about this - the connections are only reused
within the same process, a new process will create a new connection.

PythonInterpreter's scope does not extend beyond a process, i.e. a seprate
process is a separate process, a separate memory space, a different
interpreter, etc.

Hope this clarifies it a bit.

Grisha

On Fri, 15 Nov 2002 sandor.kopanyi@mailbox.hu wrote:

> Hi,
>
> In the mod_python FAQ 3.3 there is a good example of a 'permanent'
> database connection. This works fine, the connection is reused, as long
> as the request is handled in the same child process (apache child
> process). But a new child process gets a new interpreter => new
> connection is created. At least that's what I guess.
>
> I've tried the Python*Interp* directives, but the connection is
> re-created regardless of those directives. Am I doing something wrong?
>
> E.g. when setting PythonInterpeter to something (e.g. blabla), the
> connection is recreated again and again.
>
> Any ideeas?
>
> I'm using apache 1.3.23 with mod_python 2.7.6 on RedHat 7.3; the
> application is based on the publisher handler; the db connection code is
> almost copy-paste from the FAQ.
>
> Best regards,
> Sandor
>
>
> ________________________________________________
> http://mailbox.hu - M?r SMS ?rtes?t?ssel is!
>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
>


From agenkin-lst-mod_python at thpoon.com  Sat Nov 16 20:24:19 2002
From: agenkin-lst-mod_python at thpoon.com (Arcady Genkin)
Date: Fri Jan  9 22:03:36 2004
Subject: [mod_python] SetHandler and a subdirectory with static contents 
 (images)
In-Reply-To: <3DD45546.DA2BB937@sympatico.ca> (vio's message of "Thu, 14 Nov
 2002 21:00:38 -0500")
References: <uoel9nc2oz.fsf@bashful.cdf.toronto.edu>
	<3DD45546.DA2BB937@sympatico.ca>
Message-ID: <uowund3s58.fsf@bashful.cdf.toronto.edu>

vio <vmilitaru@sympatico.ca> writes:

> Looks like you forgot to include the python suffix, which restricts what
> file types are to be handled by mod_python.publisher. Try it like this:
>
> <IfModule mod_python.c>
> <Directory /var/www/data>
>     AddHandler python-program .py
>     PythonHandler mod_python.publisher
>     PythonDebug On
> </Directory>
> </IfModule>

Note that I am using the SetHandler directive (not AddHandler), which
does not require the file extension.  This is the recommended
configuration directive for 3.0, as per the docs.

Can anybody tell me how to work around this?

> Arcady Genkin wrote:
>
>> I cannot send image files when using the Publisher handler: apache
>> tries to run them as Python programs. ;^)  I tried setting to handler
>> for the images directory to the default, but it didn't work.  With
>> Apache 2.0.43 and mod_python-3.0B4, I have the following config:
>>
>> ,----[ httpd.conf ]
>> | <Directory "/var/www/data">
>> |    PythonDebug On
>> |    SetHandler python-program
>> |    PythonHandler mod_python.publisher
>> | </Directory>
>> |
>> | <Directory "/var/www/data/images">
>> |   SetHandler default-handler
>> | </Directory>
>> `----
>>
>> Since /var/www/data is the DocumentRoot, I cannot place the images in
>> a directory outside of it...
>>
>> What am I doing wrong?

-- 
Arcady Genkin : CDF Systems Administrator
http://www.cdf.toronto.edu/~agenkin/contact.html

guilt is the cause of more disauders
than history's most obscene marorders (E.E. Cummings)

From mateusz at ant.gliwice.pl  Mon Nov 18 11:45:52 2002
From: mateusz at ant.gliwice.pl (Mateusz Korniak)
Date: Fri Jan  9 22:03:36 2004
Subject: [mod_python] Using gzip module with mod_gzip enabled apache breaks things ?
Message-ID: <200211181145.52365.mateusz@ant.gliwice.pl>

Any idea why using mod_gzip in apache makes gziping by gzip module hang apache 
server process ?
Currently I'm able compress content using mod_python nor mod_gzip (for static 
content), but not _both_ . :/

TIA for any ideas comments...

-- 
Mateusz Korniak
"Black holes are where God divided by zero." - Steven Wright


From ps0 at igmp.com.ar  Mon Nov 18 17:26:11 2002
From: ps0 at igmp.com.ar (Hector A. Paterno)
Date: Fri Jan  9 22:03:36 2004
Subject: [mod_python] Authentication like php !
Message-ID: <20021118172611.A8069@igmp.com.ar>

Hi,

 Anyone has already do some type of authentication with mod_python
 using some type of cookies or sessions (like php does) ?
 
 I need this for a user/pass form in the main page ( I dont want the
 tipical Auth new window ( AuthHandler ).
 
 
 Tnks A lot !
 

-- 
Hector A. Paterno

From ps0 at igmp.com.ar  Tue Nov 19 12:07:20 2002
From: ps0 at igmp.com.ar (Hector A. Paterno)
Date: Fri Jan  9 22:03:36 2004
Subject: [mod_python] Authentication like php !
In-Reply-To: <OF3AFC019A.317D1A47-ON85256C75.00712D44-85256C75.00720302@ccity.com>; from Tony_Burger@circuitcity.com on Mon, Nov 18, 2002 at 03:44:42PM -0500
References: <OF3AFC019A.317D1A47-ON85256C75.00712D44-85256C75.00720302@ccity.com>
Message-ID: <20021119120720.C17664@igmp.com.ar>

On Mon, Nov 18, 2002 at 03:44:42PM -0500, Tony_Burger@circuitcity.com wrote:

Could you bring me the python version of the perl script ?

Tnks a lot.


> 
> Yes in fact, using mod_auth_mda.  I have converted the perl script using
> mod_python and setup cookie checking for the client.  It looks as though
> the module is still only available for Apache 1.3.xx.  Looks like the
> website has been enhanced since I viewed it last, should help with setup.
> There was a lot of talk on the message list about the bit-masking
> technique.
> 
> http://www.frogdot.org/mod_auth_mda/index.html
> 
> 

-- 
Hector A. Paterno

From mbp at samba.org  Tue Nov 19 16:36:58 2002
From: mbp at samba.org (Martin Pool)
Date: Fri Jan  9 22:03:36 2004
Subject: [mod_python] unicode() conversion troubles with mod_python 3 CVS 27.06.2002
In-Reply-To: <005b01c27aff$26914920$0bcbefc3@irkutsk.teleross.ru>
References: <005b01c27aff$26914920$0bcbefc3@irkutsk.teleross.ru>
Message-ID: <20021120003657.GD25174@toey.sourcefrog.net>

On 24 Oct 2002, Eugene Sizikov <eugene_beast@mail.ru> wrote:
> Hello all ppl!
> 
> I have troubles with unicode conversion with mod_python from RedHat 8.0
> distro. The errorlog is:
> 
> "
> Mod_python error: "PythonHandler mod_python.publisher"
> 
> Traceback (most recent call last):
> 
>   File "/usr/lib/python2.2/site-packages/mod_python/apache.py", line 285, in
> HandlerDispatch
>     result = object(req)
> 
>   File "/usr/lib/python2.2/site-packages/mod_python/publisher.py", line 175,
> in handler
>     result = apply(object, (), args)
> 
>   File "/var/www/html/teleross/user.py", line 137, in start
>     html = '%s [%s]<HR>' % (string_sql_to_html(user.fullname),
> Group(user.con, user.gid).fullname) + menu.to_html()
> 
>   File "/var/www/html/teleross/utils.py", line 4, in string_sql_to_html
>     return unicode(s, 'koi8-r')
> 
>   File
> "/usr/src/build/143041-i386/install/usr/lib/python2.2/encodings/__init__.py"
> , line 51, in search_function
> 
> RuntimeError: cannot unmarshal code objects in restricted execution mode
> "
> 
> So, when it has "unicode(s, 'koi8-r')" it crashes with that interesting
> message I can't understand.

I had a similar problem.  It seemed to me to be some kind of
interaction between encoders being imported by the C encode()
implementation and modules being imported by mod_python.
Unfortunately I could only look at it without our complicated build
environment so I can't say for sure.

A workaround turned out to be forcing the encoders to be loaded before
mod_python starts up.  You can do this by adding a line like this to
sitecustom.py:

  u'hello'.encode('koi8-r')

-- 
Martin

From pzb at datastacks.com  Fri Nov 22 16:02:24 2002
From: pzb at datastacks.com (Peter Bowen)
Date: Fri Jan  9 22:03:36 2004
Subject: [mod_python] Apache segfault when using PythonImport
Message-ID: <1037998943.8001.40.camel@10-0-0-234.boston.ximian.com>

Apache is segfaulting when I use the PythonImport directive.

I have seen it under two slightly different conditions:

A) Apache 1.3.23 (from Red Hat Linux 7.3 errata), Python 2.2.2 without
threads, and mod_python 2.7.8

In this case the backtrace shows that the segfault occurs in ap_palloc. 
The stack looks like ap_palloc -> ap_pstrdup -> ap_table_add ->
directive_PythonImport.

B) Apache 1.3.23 (as above) or Apache 1.3.27, Python 2.2.2 with threads,
and mod_python 2.7.8

Different backtrace.  Dies in pthread_mutex_lock, called from
PyEval_AcquireLock.

Has anyone had sucess with using PythonImport with python 2.2 on apache
1.3?

Thanks.
Peter


From jack_diederich at email.com  Fri Nov 22 17:46:48 2002
From: jack_diederich at email.com (Jack Diederich)
Date: Fri Jan  9 22:03:36 2004
Subject: [mod_python] Apache segfault when using PythonImport
Message-ID: <20021122224648.6502.qmail@email.com>

I can't say for cetain what the cause of the segfault is, but I've
posted a potential reason and patches to fix it more than once to this list.

The globals for python imports are not safe, and trivial to make so.  I know
3.x is the gold standard, but patching 2.x for stability shouldn't be out
of the question.

The calls he sites are a VERY good indicator that the global is the problem,
we should just register a cleanup hook to NULL it out and recreate it again if
init()s are called twice.

-jack
> ----- Original Message -----
> From: Peter Bowen <pzb@datastacks.com>
> Date: 22 Nov 2002 16:02:24 -0500 
> To: mod_python@modpython.org
> Subject: [mod_python] Apache segfault when using PythonImport
> 
> 
> > Apache is segfaulting when I use the PythonImport directive.
> > 
> > I have seen it under two slightly different conditions:
> > 
> > A) Apache 1.3.23 (from Red Hat Linux 7.3 errata), Python 2.2.2 without
> > threads, and mod_python 2.7.8
> > 
> > In this case the backtrace shows that the segfault occurs in ap_palloc. 
> > The stack looks like ap_palloc -> ap_pstrdup -> ap_table_add ->
> > directive_PythonImport.
> > 
> > B) Apache 1.3.23 (as above) or Apache 1.3.27, Python 2.2.2 with threads,
> > and mod_python 2.7.8
> > 
> > Different backtrace.  Dies in pthread_mutex_lock, called from
> > PyEval_AcquireLock.
> > 
> > Has anyone had sucess with using PythonImport with python 2.2 on apache
> > 1.3?
> > 
> > Thanks.
> > Peter
> > 
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://www.modpython.org/mailman/listinfo/mod_python
> > 
> > 
> 
> -- 
> _______________________________________________
> Sign-up for your own FREE Personalized E-mail at Mail.com
> http://www.mail.com/?sr=signup
> 
> One click access to the Top Search Engines
> http://www.exactsearchbar.com/mailcom
> 
> 

-- 
_______________________________________________
Sign-up for your own FREE Personalized E-mail at Mail.com
http://www.mail.com/?sr=signup

One click access to the Top Search Engines
http://www.exactsearchbar.com/mailcom


From post at nlhas.no  Sat Nov 23 12:54:36 2002
From: post at nlhas.no (NLH AS)
Date: Fri Jan  9 22:03:36 2004
Subject: [mod_python] Beginner documentation -- suggestion
Message-ID: <3.0.5.32.20021123125436.00b61960@nlhhost>

I've just installed mod_python and converted a cgi application. During this
process I've spent most of my time finding out what happens where -- the
actual conversion fell into place quickly when I understood the main
framework. Everything is in the documentation, but I'd have appreciated a
simple explanation along the lines of the following (which may well be
wrong!) somewhere in the tutorial. Perhaps something like this can be
worked into the next edition of the documentation?

pm


++++++ What happens where in a "out-of-the-box" Apache/mod_python setup:

At startup or at the first call to a mod_python handler Apache loads the
Python interpreter and the import modules at the top of the handler's
module file.

Each call to the handler is executed in an Apache child process with a
separate Python subinterpreter instance. It is not possible to share global
variables between Apache's child processes (so sharing a global database
connection is not possible for example), and there is no means of
predicting whether Apache will start a new process or re-use an existing
process for any given call to the handler. [>> pointer to information about
how Apache does this, how many child processes can be started, etc.?].

Global variables within the handler's module will be available to all calls
to the handler that are routed to the same Apache process. This could be
used to maintain and re-use a database connection per child process. 

Local variables within the handler are local to each call to the handler
[and are eventually garbage-collected in the normal way?].

Mod_python will check whether the top level python module (containing the
handler) has been changed and re-load if necessary. Imported modules are
not checked, and the only 100% certain way of ensuring that updated modules
are reloaded in all child processes is to stop and re-start Apache.

It is possible to tweak various aspects of this behaviour -- for example
Apache can be compiled to only ever start one child process (which would
enable global variables), but this would entail significantly poorer
performance.
+++++
   

From markusjais at yahoo.de  Mon Nov 25 00:30:50 2002
From: markusjais at yahoo.de (Markus Jais)
Date: Fri Jan  9 22:03:36 2004
Subject: [mod_python] beginners question
Message-ID: <1038180652.3173.2.camel@eagle>

Hello
I have just installed mod_python 2.7.8 for my
apache 1.3.23

I have python 2.2.2 (with threads) on a RedHat 7.3 system.

compilation was no problem but when I restart apache I get

Starting httpd: [Mon Nov 25 00:26:41 2002] [warn] Loaded DSO
modules/mod_python.so uses plain Apache 1.3 API, this module might crash
under EAPI! (please recompile it with -DEAPI)


what does this mean?? I found EAPI not mentioned in the sources.

markus




__________________________________________________________________

Gesendet von Yahoo! Mail - http://mail.yahoo.de
Möchten Sie mit einem Gruß antworten? http://grusskarten.yahoo.de

From jfk at metation.com  Mon Nov 25 13:06:36 2002
From: jfk at metation.com (Jørgen Frøjk Kjærsgaard)
Date: Fri Jan  9 22:03:36 2004
Subject: [mod_python] beginners question
In-Reply-To: <1038180652.3173.2.camel@eagle>
References: <1038180652.3173.2.camel@eagle>
Message-ID: <20021125110636.M72172@metation.com>

On 25 Nov 2002 00:30:50 +0100, Markus Jais wrote
> Hello
> I have just installed mod_python 2.7.8 for my
> apache 1.3.23
> 
> I have python 2.2.2 (with threads) on a RedHat 7.3 system.
> 
> compilation was no problem but when I restart apache I get
> 
> Starting httpd: [Mon Nov 25 00:26:41 2002] [warn] Loaded DSO
> modules/mod_python.so uses plain Apache 1.3 API, this module might crash
> under EAPI! (please recompile it with -DEAPI)
> 
> what does this mean?? I found EAPI not mentioned in the sources.

Apache 1.3 has two API versions. If you compile with the "-DEAPI" option given
to gcc, you get an EAPI version.

You may safely ignore the warning. mod_python works fine even when compiled
with plain API.

/jfk

--
J?rgen Fr?jk Kj?rsgaard
Metation ApS - the system integrators
Kystvejen 29 - DK 8000 ?rhus C - www.metation.com

From jquinte at fadu.uba.ar  Mon Nov 25 11:00:13 2002
From: jquinte at fadu.uba.ar (Javier Quinteros)
Date: Fri Jan  9 22:03:36 2004
Subject: [mod_python] Solaris 8...
Message-ID: <006301c2948a$fa13e240$3dd05c9d@sis.rec.uba.ar>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Hi, all of you !!!
Yes, it's me again. I'm still fighting with modpython and Solaris 8,
trying to make them both understand that they should work together...  
;-)
My question this time is TOO simple:

Has anyone been able to compile and install modpython in a Solaris 8 OS
???

Thanks in advance...
- ------------------------------
Javier Quinteros
jquinte@fadu.uba.ar
jquinte@dc.uba.ar
Universidad de Buenos Aires
- ------------------------------

-----BEGIN PGP SIGNATURE-----
Version: PGPfreeware 6.5.3 for non-commercial use <http://www.pgp.com>

iQA/AwUBPeIs63Qc0Z5RZeHIEQIIugCgg7DMEUW4+90brXKIjcQAhweTpFAAn0At
TuyWYxld3hvHQkvbEYcOk4yq
=vPKa
-----END PGP SIGNATURE-----



From agenkin-lst-mod_python at thpoon.com  Mon Nov 25 16:16:57 2002
From: agenkin-lst-mod_python at thpoon.com (Arcady Genkin)
Date: Fri Jan  9 22:03:36 2004
Subject: [mod_python] Solaris 8...
In-Reply-To: <006301c2948a$fa13e240$3dd05c9d@sis.rec.uba.ar> ("Javier
 Quinteros"'s message of "Mon, 25 Nov 2002 11:00:13 -0300")
References: <006301c2948a$fa13e240$3dd05c9d@sis.rec.uba.ar>
Message-ID: <uo4ra55oza.fsf@bashful.cdf.toronto.edu>

"Javier Quinteros" <jquinte@fadu.uba.ar> writes:

> Has anyone been able to compile and install modpython in a Solaris 8 OS

Yes, I have version 2.7.8 compiled, installed and working under
Solaris 8/Sparc with Apache 1.3.27.  I had to install Python with
threads turned off in a separate location; apart from that, everything
was quite easy.  Here are my install notes:

,----[ mod_python ]
|   - env PATH=/opt/python_threadless/bin:$PATH \
|         ./configure --with-apxs=/opt/apache/bin/apxs
|   - make
|   - make install
`----

Python 2.2.2 was installed with the following config options:
--prefix=/opt/python_threadless --without-threads .

I can't claim that this is the optimal configuration, but this seems
to have worked for me.

Hope this helps,
-- 
Arcady Genkin : CDF Systems Administrator
http://www.cdf.toronto.edu/~agenkin/contact.html

guilt is the cause of more disauders
than history's most obscene marorders (E.E. Cummings)

From markusjais at yahoo.de  Tue Nov 26 00:12:46 2002
From: markusjais at yahoo.de (Markus Jais)
Date: Fri Jan  9 22:03:36 2004
Subject: [mod_python] another beginners question: problem with <Location> directive
Message-ID: <1038265968.2605.3.camel@eagle>

hello
I have the example from the tutorial

from mod_python import apache

def handler(req):
    req.content_type = "text/html"
    req.send_http_header()
    req.write("Eagles are great")
    return apache.OK

and this setup

<Directory /var/www/html/python> 
  AddHandler python-program .py
  PythonHandler mptest 
  PythonDebug On 
</Directory>


this works fine.

but when I change the <Directory> directive to
----
<Location /python> 
  AddHandler python-program .py
  PythonHandler mptest 
  PythonDebug On 
</Location>
---
I get this error in my apache logfile:
[Tue Nov 26 00:07:18 2002] [notice] mod_python: (Re)importing mptest from None
[Tue Nov 26 00:07:18 2002] [error] PythonHandler mptest: Traceback (most recent call last):
[Tue Nov 26 00:07:18 2002] [error] PythonHandler mptest:   File "/usr/local/lib/python2.2/site-packages/mod_python/apache.py", line 181, in Dispatch
    module = import_module(module_name, _req)
[Tue Nov 26 00:07:18 2002] [error] PythonHandler mptest:   File "/usr/local/lib/python2.2/site-packages/mod_python/apache.py", line 332, in import_module
    f, p, d = imp.find_module(parts[i], path)
[Tue Nov 26 00:07:18 2002] [error] PythonHandler mptest: ImportError: No module named mptest


I am using python 2.2.2, modpython 2.7.8 and apache 1.3.23 (rpm version for redhat 7.3)

markus



__________________________________________________________________

Gesendet von Yahoo! Mail - http://mail.yahoo.de
Möchten Sie mit einem Gruß antworten? http://grusskarten.yahoo.de

From grisha at modpython.org  Wed Nov 27 18:55:46 2002
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 22:03:36 2004
Subject: [mod_python] another beginners question: problem with <Location>
 directive
In-Reply-To: <1038265968.2605.3.camel@eagle>
Message-ID: <20021127185210.U41427-100000@eden.ispol.com>

Mod_python adds the directory to sys.path for you, this is how Python
finds the script. But when you <Location> there is no way for mod_python
to know what to add to sys.path, so you have to do it explicitely, using
the PythonPath directive, try this:

<Location /python>
  AddHandler python-program .py
  PythonHandler mptest
  PythonPath "['/var/www/html/python']+sys.path"
  PythonDebug On
</Location>

Grisha

On 26 Nov 2002, Markus Jais wrote:

> hello
> I have the example from the tutorial
>
> from mod_python import apache
>
> def handler(req):
>     req.content_type = "text/html"
>     req.send_http_header()
>     req.write("Eagles are great")
>     return apache.OK
>
> and this setup
>
> <Directory /var/www/html/python>
>   AddHandler python-program .py
>   PythonHandler mptest
>   PythonDebug On
> </Directory>
>
>
> this works fine.
>
> but when I change the <Directory> directive to
> ----
> <Location /python>
>   AddHandler python-program .py
>   PythonHandler mptest
>   PythonDebug On
> </Location>
> ---
> I get this error in my apache logfile:
> [Tue Nov 26 00:07:18 2002] [notice] mod_python: (Re)importing mptest from None
> [Tue Nov 26 00:07:18 2002] [error] PythonHandler mptest: Traceback (most recent call last):
> [Tue Nov 26 00:07:18 2002] [error] PythonHandler mptest:   File "/usr/local/lib/python2.2/site-packages/mod_python/apache.py", line 181, in Dispatch
>     module = import_module(module_name, _req)
> [Tue Nov 26 00:07:18 2002] [error] PythonHandler mptest:   File "/usr/local/lib/python2.2/site-packages/mod_python/apache.py", line 332, in import_module
>     f, p, d = imp.find_module(parts[i], path)
> [Tue Nov 26 00:07:18 2002] [error] PythonHandler mptest: ImportError: No module named mptest
>
>
> I am using python 2.2.2, modpython 2.7.8 and apache 1.3.23 (rpm version for redhat 7.3)
>
> markus
>
>
>
> __________________________________________________________________
>
> Gesendet von Yahoo! Mail - http://mail.yahoo.de
> M?chten Sie mit einem Gru? antworten? http://grusskarten.yahoo.de
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
>


From Morten.Tryfoss at 1880nummeropplysning.no  Thu Nov 28 19:16:07 2002
From: Morten.Tryfoss at 1880nummeropplysning.no (Morten Tryfoss)
Date: Fri Jan  9 22:03:36 2004
Subject: SV: SV: SV: [mod_python] Problem with mod_python3.0(beta4),python2.2.1and apache 2.0.43
Message-ID: <07411F6A634E5445AEF010C58590F2FB636581@exchangeone.kristiansand.viadial.no>

This is the strace output from apache when it segfaults:

[pid  1577] <... accept resumed> {sin_family=AF_INET6, sin6_port=htons(3101), inet_pton(AF_INET6, "::ffff:62.73.255.77", &sin6_addr), sin6_flowinfo=0, sin6_scope_id=0}, [28]) = 8
[pid  1577] getsockname(8, {sin_family=AF_INET6, sin6_port=htons(80), inet_pton(AF_INET6, "::ffff:212.125.195.9", &sin6_addr), sin6_flowinfo=0, sin6_scope_id=0}, [28]) = 0
[pid  1577] fcntl64(8, F_GETFL)         = 0x2 (flags O_RDWR)
[pid  1577] fcntl64(8, F_SETFL, O_RDWR|O_NONBLOCK) = 0
[pid  1577] read(8, 0x81a0f50, 8000)    = -1 EAGAIN (Resource temporarily unavailable)
[pid  1577] poll([{fd=8, events=POLLIN, revents=POLLIN}], 1, 300000) = 1
[pid  1577] read(8, "GET / HTTP/1.1\r\nAccept: image/gi"..., 8000) = 288
[pid  1577] gettimeofday({1038506716, 88342}, NULL) = 0
[pid  1577] stat64("/usr/local/apache/htdocs/", {st_mode=S_IFDIR|0755, st_size=4096, ...}) = 0
[pid  1577] stat64("/usr/local/apache/htdocs/dses/login/login.py", {st_mode=S_IFREG|0444, st_size=4285, ...}) = 0
[pid  1577] stat64("/usr/local/apache/htdocs/dses/login/login.py", {st_mode=S_IFREG|0444, st_size=4285, ...}) = 0
[pid  1577] stat64("/usr/local/apache/htdocs/dses/login/login.py", {st_mode=S_IFREG|0444, st_size=4285, ...}) = 0
[pid  1577] stat64("/usr/local/apache/htdocs/dses/login/login.p", 0xbfffda6c) = -1 ENOENT (No such file or directory)
[pid  1577] --- SIGSEGV (Segmentation fault) ---
[pid  1574] <... select resumed> )      = ? ERESTARTNOHAND (To be restarted)
[pid  1574] --- SIGCHLD (Child exited) ---
[pid  1574] select(0, NULL, NULL, NULL, {0, 720000}) = 0 (Timeout)
[pid  1574] wait4(-1, [WIFSIGNALED(s) && WTERMSIG(s) == SIGSEGV], WNOHANG|WUNTRACED, NULL) = 1577
[pid  1574] gettimeofday({1038506716, 808246}, NULL) = 0
[pid  1574] write(7, "[Thu Nov 28 19:05:16 2002] [noti"..., 87) = 87

Any thoughts?

Morten

-----Opprinnelig melding-----
Fra: Gregory (Grisha) Trubetskoy [mailto:grisha@modpython.org]
Sendt: 5. november 2002 21:38
Til: Morten Tryfoss
Emne: Re: SV: SV: [mod_python] Problem with
mod_python3.0(beta4),python2.2.1and apache 2.0.43



It's impossible to tell what's going on based on these logs... What would
really help me track the problem down is knowing which line(s) of Python
code in your scripts cause this. You can try writing something to the logs
throughout the code to see where exactly it segfaults.

On Tue, 5 Nov 2002, Morten Tryfoss wrote:

> Now I've tried to upgrade Python, and it still segfaults.
>
> Here's some lines from apache's error_log:
>
> [Tue Nov 05 20:51:21 2002] [notice] child pid 29905 exit signal Segmentation fault (11)
> [Tue Nov 05 20:51:56 2002] [info] (104)Connection reset by peer: core_output_filter: writing data to the network
> [Tue Nov 05 20:51:56 2002] [info] (32)Broken pipe: core_output_filter: writing data to the network
> [Tue Nov 05 20:53:08 2002] [notice] child pid 29995 exit signal Segmentation fault (11)
> [Tue Nov 05 20:56:24 2002] [info] (104)Connection reset by peer: core_output_filter: writing data to the network
> [Tue Nov 05 20:56:24 2002] [info] (32)Broken pipe: core_output_filter: writing data to the network
>
> Is it possible that the scripts are the reason for this? (It worked fine on earlier versions of apache/mod_python).
>
>
>
> Morten
>
> -----Opprinnelig melding-----
> Fra: Gregory (Grisha) Trubetskoy [mailto:grisha@modpython.org]
> Sendt: 5. november 2002 20:20
> Til: Morten Tryfoss
> Kopi: mod_python@modpython.org
> Emne: Re: SV: [mod_python] Problem with mod_python3.0(beta4),
> python2.2.1and apache 2.0.43
>
>
>
> The first thing I would try is upgrading to Python 2.2.2. If that doesn't
> solve it, then you need to try to figure out a way to replicate this
> issue, which is easier said than done. So far I haven't had any segfault
> reports for BETA4, so I have no other info to relate this to.
>
> Grisha
>
> On Tue, 5 Nov 2002, Morten Tryfoss wrote:
>
> > SuSE Linux 8.0 (2.4.18)
> >
> > Morten
> >
> > -----Opprinnelig melding-----
> > Fra: Gregory (Grisha) Trubetskoy [mailto:grisha@modpython.org]
> > Sendt: 5. november 2002 19:49
> > Til: Morten Tryfoss
> > Emne: Re: [mod_python] Problem with mod_python3.0(beta4), python
> > 2.2.1and apache 2.0.43
> >
> >
> >
> > Morten - what's your operating system?
> >
> > On Tue, 5 Nov 2002, Morten Tryfoss wrote:
> >
> > >
> > > I start my server up, and everything works ok. But after av while(when
> > > the number of clients raise) some of the apache childs segfaults. Users
> > > who are running on their persistent connections may still use the
> > > server, but new connections are dropped. Any thoughts of what may be
> > > wrong?
> > >
> > > Currently I'm running apache 1.3.x, but some part of my scripts performs
> > > poorly. Running them on apache 2.0 improved a lot (as long as the server
> > > didn't crash).
> > >
> > >
> > > Morten Tryfoss
> > >
> > > _______________________________________________
> > > Mod_python mailing list
> > > Mod_python@modpython.org
> > > http://www.modpython.org/mailman/listinfo/mod_python
> > >
> >
> >
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://www.modpython.org/mailman/listinfo/mod_python
> >
>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
>



From francoislepoutre at compuserve.com  Fri Nov 29 10:38:12 2002
From: francoislepoutre at compuserve.com (francois lepoutre)
Date: Fri Jan  9 22:03:36 2004
Subject: [mod_python] some remarks, a few questions and
Message-ID: <001701c2978b$08c8f070$bd6e4351@mixio7jpsmlatx>

Hi all modpython users,

First modpython is plain great.We like some much
and even more so as an apache project :)

Thanks Grisha and all.

I just moved a couple of thousand lines of python from 
apache 1.3.27/modpython 2.7.4/python 2.1.1 (w2k) 
into apache 2.0.43/modpython 3.0.1/python 2.2.2 (w2k)

Some remarks:
1) INSTALLATION ON WIN32 WAS A SNAP, GREAT.
Automation has significantly improved for all components
Thanks to the apache and python communities 

2) The new install run exactly in the same way.
Perf and behaviour are nearly identical... that's both good 
(because every thing works ok) and mixed feeling 
(why change version). But we are not specifically 
looking for performance improvement anyway.

I hope that *nix apache users are feeling some perf 
improvements because of the new fork+thread model. 
Win32 runs the same. At least for us.

Now a few questions at this stage:
When running the old stuff (modpython 2.7) we maintained
two distinct series of modpython code:
- one plain simple set of routines for forking *nix (for a RH customers),
- win32-specific code with thread-mngt stuff (and connection pooling)
for various w2k set-ups.

We like the idea of a unified programming model a lot :)

With the new Apache2/modpython3 model can we expect :
- to run thread-enabled python on both environments (*nix and win32)?
- to run the same code (with thread-caring stuff) in both environment? 
- the thread-management routines to be of any use on *nix setups 
if they use a mixed "fork+thread" apache model?

Is this model fork+thread of any use or interest for modpython users?
I'm no python expert but have some doubt about the latest in view
of the way python runs its own threading stuff.

In the end a bug report (did i miss something on the apache 2 config.?).
The code below will work on 2.7.* and break on 3.0.1 (W2K).

from mod_python import apache

def handler(req):
    req.write("Your local address:%s %i" % \
    (req.connection.local_addr[0],req.connection.local_addr[1]))
     return apache.OK

Regards

Francois


From markusjais at yahoo.de  Tue Nov 26 00:19:02 2002
From: markusjais at yahoo.de (Markus Jais)
Date: Fri Jan  9 22:03:36 2004
Subject: [mod_python] software using mod_python ?
Message-ID: <1038266344.2698.0.camel@eagle>

hello
are there any open source python modules who are using
mod python ?
I would like to see some code with mod_python in action
to learn more about it.

markus



__________________________________________________________________

Gesendet von Yahoo! Mail - http://mail.yahoo.de
Yahoo! präsentiert als offizieller Sponsor das Fußball-Highlight des
Jahres: - http://www.FIFAworldcup.com

From mark_messer at calypso.com  Sat Nov 30 14:11:42 2002
From: mark_messer at calypso.com (Mark Messer)
Date: Fri Jan  9 22:03:36 2004
Subject: [mod_python] can't find mod_python.so
Message-ID: <00d701c298bd$772ffdf0$b27ba8c0@ZEUS>

I put mod_python.so into the modules directory, but I get an error when
starting Apache:

C:\tools\Apache2\bin>apache
Syntax error on line 173 of C:/tools/Apache2/conf/httpd.conf:
Cannot load C:/tools/Apache2/modules/mod_python.so into server: The
specified module could not be found.

I added this to the LoadModule section of httpd.conf:  LoadModule
python_module modules/mod_python.so

Here's the directory listing:
C:\tools\Apache2\modules>ls -al mod_p*
-rwxrwx---    1 Administ SYSTEM      40960 Oct  3 06:58 mod_proxy.so
-rwxrwx---    1 Administ SYSTEM      20480 Oct  3 06:58 mod_proxy_connect.so
-rwxrwx---    1 Administ SYSTEM      28672 Oct  3 06:58 mod_proxy_ftp.so
-rwxrwx---    1 Administ SYSTEM      24576 Oct  3 06:58 mod_proxy_http.so
-rwxrwx---    1 Administ SYSTEM      65536 Nov 26 17:49 mod_python.so

I am running mod_python 3.0.1, Python 2.2.2, Apache 2.0.43, Windows XP
Professional.   Tried changing perms and ownership to match what was there,
but that did not work.



From grisha at modpython.org  Sat Nov 30 23:06:10 2002
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 22:03:36 2004
Subject: [mod_python] can't find mod_python.so
In-Reply-To: <00d701c298bd$772ffdf0$b27ba8c0@ZEUS>
Message-ID: <20021130230513.T83360-100000@eden.ispol.com>

This is possibly because the mod_python.so that is out there is for Python
2.2.1. I don't have one for 2.2.2 compiled (yet).

Grisha

On Sat, 30 Nov 2002, Mark Messer wrote:

> I put mod_python.so into the modules directory, but I get an error when
> starting Apache:
>
> C:\tools\Apache2\bin>apache
> Syntax error on line 173 of C:/tools/Apache2/conf/httpd.conf:
> Cannot load C:/tools/Apache2/modules/mod_python.so into server: The
> specified module could not be found.
>
> I added this to the LoadModule section of httpd.conf:  LoadModule
> python_module modules/mod_python.so
>
> Here's the directory listing:
> C:\tools\Apache2\modules>ls -al mod_p*
> -rwxrwx---    1 Administ SYSTEM      40960 Oct  3 06:58 mod_proxy.so
> -rwxrwx---    1 Administ SYSTEM      20480 Oct  3 06:58 mod_proxy_connect.so
> -rwxrwx---    1 Administ SYSTEM      28672 Oct  3 06:58 mod_proxy_ftp.so
> -rwxrwx---    1 Administ SYSTEM      24576 Oct  3 06:58 mod_proxy_http.so
> -rwxrwx---    1 Administ SYSTEM      65536 Nov 26 17:49 mod_python.so
>
> I am running mod_python 3.0.1, Python 2.2.2, Apache 2.0.43, Windows XP
> Professional.   Tried changing perms and ownership to match what was there,
> but that did not work.
>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
>


From markusjais at yahoo.de  Tue Nov 26 21:29:38 2002
From: markusjais at yahoo.de (Markus Jais)
Date: Fri Jan  9 22:03:36 2004
Subject: [mod_python] another beginners question: problem with <Location> directive
Message-ID: <1038342581.1928.3.camel@eagle>

hello
I already sent this message yesterday but somehow it didn't reach
the list.


I have the example from the tutorial

from mod_python import apache

def handler(req):
    req.content_type = "text/html"
    req.send_http_header()
    req.write("Eagles are great")
    return apache.OK


and this setup

<Directory /var/www/html/python> 
  AddHandler python-program .py
  PythonHandler mptest 
  PythonDebug On 
</Directory>


this works fine.

but when I change the <Directory> directive to
----
<Location /python> 
  AddHandler python-program .py
  PythonHandler mptest 
  PythonDebug On 
</Location>
---
I get this error in my apache logfile:
[Tue Nov 26 00:07:18 2002] [notice] mod_python: (Re)importing mptest from None
[Tue Nov 26 00:07:18 2002] [error] PythonHandler mptest: Traceback (most recent call last):
[Tue Nov 26 00:07:18 2002] [error] PythonHandler mptest:   File "/usr/local/lib/python2.2/site-packages/mod_python/apache.py", line 181, in Dispatch
    module = import_module(module_name, _req)
[Tue Nov 26 00:07:18 2002] [error] PythonHandler mptest:   File "/usr/local/lib/python2.2/site-packages/mod_python/apache.py", line 332, in import_module
    f, p, d = imp.find_module(parts[i], path)
[Tue Nov 26 00:07:18 2002] [error] PythonHandler mptest: ImportError: No module named mptest


I am using python 2.2.2, modpython 2.7.8 and apache 1.3.23 (rpm version for redhat 7.3)

markus



__________________________________________________________________

Gesendet von Yahoo! Mail - http://mail.yahoo.de
Yahoo! präsentiert als offizieller Sponsor das Fußball-Highlight des
Jahres: - http://www.FIFAworldcup.com

From grisha at apache.org  Wed Nov 27 14:37:33 2002
From: grisha at apache.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 22:03:36 2004
Subject: [mod_python] ANNOUNCE: Mod_python 3.0.1
Message-ID: <20021127135855.Q36516-100000@eden.ispol.com>

The Apache Software Foundation and The Apache HTTP Server Project are
pleased to announce the release of mod_python 3.0.1.

Mod_python is an Apache HTTP Server module that embeds the Python
interpreter within the server. With mod_python you can write web-based
applications in Python that will run many times faster than traditional
CGI and will have access to advanced features such as ability to retain
database connections between requests, access to httpd internals and
provide content filter as well as connection handlers.

This is the first release of mod_python as a subproject of the Apache HTTP
Server Project, as well as a major milestone accomplishment finally
bringing compatibility with Apache 2.0.

This release increments the major version to 3. The major version
increment is to denote that this release is only compatible with Apache
httpd server 2.0 and Python 2.2 or later and is not fully backwards
compatible with previous versions of mod_python. For details on migrating
code from previous versions of mod_python, as well as a list of new
featurs, see the README file in the distribution.

Mod_python is available for download from:

http://www.apache.org/dist/httpd/modpython/

For more information about mod_python visit
http://www.modpython.org/

Enjoy, and Happy Thanksgiving to those in the US!

Grisha Trubetskoy



From Antonio at memora.com  Sun Nov 24 19:48:11 2002
From: Antonio at memora.com (Antonio Rodriguez)
Date: Fri Jan  9 22:03:36 2004
Subject: [mod_python] beginners question
References: <1038180652.3173.2.camel@eagle>
Message-ID: <001f01c29a3b$e92ddc40$6401a8c0@darwin>

Markus,

Go into the src directory of the dist and in the OPTIONS= line add -DEAPI.
apxs will do the right thing and you will stop getting that warning.

Heads up on having threads compiled in. I asked the list what the
ramifications of this were going to be (besides total crashes which don't
seem to happen if you don't explictly use threads) a few weeks ago but have
gotten no answers. I might recompile without threads.

Antonio

----- Original Message -----
From: "Markus Jais" <markusjais@yahoo.de>
To: <mod_python@modpython.org>
Sent: Sunday, November 24, 2002 6:30 PM
Subject: [mod_python] beginners question


Hello
I have just installed mod_python 2.7.8 for my
apache 1.3.23

I have python 2.2.2 (with threads) on a RedHat 7.3 system.

compilation was no problem but when I restart apache I get

Starting httpd: [Mon Nov 25 00:26:41 2002] [warn] Loaded DSO
modules/mod_python.so uses plain Apache 1.3 API, this module might crash
under EAPI! (please recompile it with -DEAPI)


what does this mean?? I found EAPI not mentioned in the sources.

markus




__________________________________________________________________

Gesendet von Yahoo! Mail - http://mail.yahoo.de
M?chten Sie mit einem Gru? antworten? http://grusskarten.yahoo.de
_______________________________________________
Mod_python mailing list
Mod_python@modpython.org
http://www.modpython.org/mailman/listinfo/mod_python




