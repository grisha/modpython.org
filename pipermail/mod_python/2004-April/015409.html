<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] import_module
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20import_module&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="015456.html">
   <LINK REL="Next"  HREF="015410.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] import_module</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Kamil Niechajewicz</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20import_module&In-Reply-To="
       TITLE="[mod_python] import_module">kamil at nvstudio.pl
       </A><BR>
    <I>Wed Apr 14 15:29:58 EST 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="015456.html">[mod_python] web frameworks
</A></li>
        <LI>Next message: <A HREF="015410.html">[mod_python] import_module
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15409">[ date ]</a>
              <a href="thread.html#15409">[ thread ]</a>
              <a href="subject.html#15409">[ subject ]</a>
              <a href="author.html#15409">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
Okay, I quite see the problem with importing wrong modules, where
there are two or more dirs with modules named the same (like just
simple index.py which is default module for Publisher)

The problem is there is no namespace for different 'modules' - 
here I mean directories. I will provide a sample app for easier
explanation:

/app_root
   index.py          - <A HREF="http://localhost/">http://localhost/</A>  = main page
   admin/
       index.py      - <A HREF="http://localhost/admin">http://localhost/admin</A>      = admin panel
       tree.py       - <A HREF="http://localhost/admin/tree">http://localhost/admin/tree</A> = show tree of objects

We put a single Apache directive:

&lt;Directory /app_root&gt;
	SetHandler mod_python.publisher
	... other statements here, I will ommit them because everyone
        probably knows what goes into such declaration
&lt;/Directory&gt;

Now the test:

1. We enter site at url <A HREF="http://localhost/">http://localhost/</A>  -&gt; page shows correctly content
generated by /app_root/index.py. The module index.py is loaded.

2. We enter site at url <A HREF="http://localhost/admin">http://localhost/admin</A>  -&gt; page shows correctly 
content generated by /app_root/admin/index.py 

3. We enter site at url <A HREF="http://localhost/">http://localhost/</A> again -&gt; page shows content of
/app_root/admin/index.py, because reimporting module 'index' does not
occur - module_import checks that module is loaded, checks its mtime and
decides not to reimport it, so we end with 'index' module from a wrong
'package'.

4. We can reload this page a few times - it still shows wrong content,
because module is not reloaded, but after some time it reloads it and
again shows what should be shown.

There is an ad hoc solution - just force import_module() to reimport
modules every time, but it is not very efficient ;) 

The best solution would be changing Publisher (or maybe even apache.py)
to somehow recognize 'packages' - in the above sample our packages 
could be named 'default' (for /app_root/*) and 'admin' (for /app_root/admin).
This would lead to modules named default.index and admin.index, so there
will be no place for mistake because we will have usunual namespace for
every directory.

Actually it works strange, because it only recognizes 'modules' from
the path in url, like 'some/package/index' is module 'index' for it,
and 'some/other/package/index' is also 'index'. sys.path has something
to do here, but anyway, it should be like some.package.index and 
some.other.package.index when importing them by Publisher, because 
only that will help to recognize proper modules with the same name
in the module list.

Am I right?

/Kamil


</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="015456.html">[mod_python] web frameworks
</A></li>
	<LI>Next message: <A HREF="015410.html">[mod_python] import_module
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15409">[ date ]</a>
              <a href="thread.html#15409">[ thread ]</a>
              <a href="subject.html#15409">[ subject ]</a>
              <a href="author.html#15409">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="DISABLEhttp://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
