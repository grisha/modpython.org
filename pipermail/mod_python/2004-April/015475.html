<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] restricted mode in server cleanup callback?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20restricted%20mode%20in%20server%20cleanup%20callback%3F&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="015479.html">
   <LINK REL="Next"  HREF="015476.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] restricted mode in server cleanup callback?</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>St&#233;phane Bidoul</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20restricted%20mode%20in%20server%20cleanup%20callback%3F&In-Reply-To="
       TITLE="[mod_python] restricted mode in server cleanup callback?">stephane.bidoul at softwareag.com
       </A><BR>
    <I>Mon Apr 26 16:35:28 EST 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="015479.html">[mod_python] 
	Urllib2 called from mod_pyton is 10x slower then called from python
</A></li>
        <LI>Next message: <A HREF="015476.html">[mod_python] restricted mode in server cleanup callback?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15475">[ date ]</a>
              <a href="thread.html#15475">[ thread ]</a>
              <a href="subject.html#15475">[ subject ]</a>
              <a href="author.html#15475">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

I'm having problems with server cleanup callbacks
(on windows, with apache 2.0.49 and mod_python 3.1.3):

For instance, with

def endChild(data):
    f = file(&quot;test.log&quot;,&quot;a&quot;)
    try:
       print &gt;&gt; f, &quot;endChild&quot;, data
    finally:
       f.close()

firstTime = 1

def handler(req):
    if firstTime:
        global firstTime
        req.server.register_cleanup(req,endChild,(&quot;endChild data&quot;,)
        firstTime = 0

Sometimes, the endChild function runs normally,
but sometimes, I get this in apache error.log:

[notice] Child 1284: Exit event signaled. Child process is ending.
[notice] Child 1284: Released the start mutex
[notice] Child 1284: Waiting for 250 worker threads to exit.
[notice] Child 1284: All worker threads have exited.
[error] python_cleanup: Error calling cleanup object &lt;function endChild at
0x005FFC30&gt;
[error]     exceptions.IOError: file() constructor not accessible in
restricted mode
[notice] Child 1284: Child process is exiting
[notice] Parent: Child process exited successfully.

Why is python thinking it is in restricted mode?
I'm prepared to launch my debugger, but I've no clue
where to search first, so any hint is most welcome.

Thanks in advance.

-sbi

</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="015479.html">[mod_python] 
	Urllib2 called from mod_pyton is 10x slower then called from python
</A></li>
	<LI>Next message: <A HREF="015476.html">[mod_python] restricted mode in server cleanup callback?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15475">[ date ]</a>
              <a href="thread.html#15475">[ thread ]</a>
              <a href="subject.html#15475">[ subject ]</a>
              <a href="author.html#15475">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="DISABLEhttp://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
