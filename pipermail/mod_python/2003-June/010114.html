<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] mod_python weirdness, maybe related to importing?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20mod_python%20weirdness%2C%20maybe%20related%20to%20importing%3F&In-Reply-To=20030610081422.GC28085%40tummy.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010113.html">
   <LINK REL="Next"  HREF="010115.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
<table border=0 width="100%"><tr><td valign="top">
   <H1>[mod_python] mod_python weirdness, maybe related to importing?</H1>
    <B>David Fraser</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20mod_python%20weirdness%2C%20maybe%20related%20to%20importing%3F&In-Reply-To=20030610081422.GC28085%40tummy.com"
       TITLE="[mod_python] mod_python weirdness, maybe related to importing?">davidf at sjsoft.com
       </A><BR>
    <I>Tue Jun 10 12:46:41 EST 2003</I>
    <P><UL>
        <LI>Previous message: <A HREF="010113.html">[mod_python] mod_python weirdness, maybe related to importing?
</A></li>
        <LI>Next message: <A HREF="010115.html">[mod_python] mod_python weirdness, maybe related to importing?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10114">[ date ]</a>
              <a href="thread.html#10114">[ thread ]</a>
              <a href="subject.html#10114">[ subject ]</a>
              <a href="author.html#10114">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Sean Reifschneider wrote:

&gt;<i>On Tue, Jun 10, 2003 at 09:12:46AM +0200, David Fraser wrote:
</I>&gt;<i>  
</I>&gt;<i>
</I>&gt;&gt;<i>Do you mean you're using this import mechanism when you have the problem 
</I>&gt;&gt;<i>with jotweb.input.Request below?
</I>&gt;&gt;<i>    
</I>&gt;&gt;<i>
</I>&gt;<i>I mean that the imp module call is loading a module which then does an
</I>&gt;<i>&quot;import jotweb.input&quot;.  If in the jotweb I don't have the __init__.py
</I>&gt;<i>import all sub-packages or sub-modules, I will get an AttributeError
</I>&gt;<i>such as:
</I>&gt;<i>
</I>&gt;<i>  AttributeError: 'module' object has no attribute 'input'
</I>&gt;<i>  
</I>&gt;<i>
</I>&gt;&gt;&gt;<i> import Request
</I>&gt;&gt;&gt;<i>      
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i>Have you tried using __all__ = [Request, ...] in __init__.py ?
</I>&gt;&gt;<i>    
</I>&gt;&gt;<i>
</I>&gt;<i>I believe I did try that at one point, but it's my understanding that
</I>&gt;<i>setting &quot;__all__&quot; only has an impact if you do &quot;from jotweb import *&quot;,
</I>&gt;<i>which I don't do anywhere.  Also, as I said before, I can import the
</I>&gt;<i>code fine outside of mod_python.  &quot;python -c 'import jotweb.input'&quot;, for
</I>&gt;<i>example...
</I>&gt;<i>  
</I>&gt;<i>
</I>&gt;&gt;<i>mod_python does have some import hooks to handle things specially, but 
</I>&gt;&gt;<i>I'm not an expect here, someone else will have to comment...
</I>&gt;&gt;<i>    
</I>&gt;&gt;<i>
</I>&gt;<i>I wonder if I'm running into something there.  I've tried simplifying it
</I>&gt;<i>to:
</I>&gt;<i>
</I>&gt;<i>   include current directory in path
</I>&gt;<i>   module = __import__(basename, globals(), locals(), [])
</I>&gt;<i>   return sys.path to old layout
</I>&gt;<i>
</I>&gt;<i>that doesn't really seem to help the problem with imports though...
</I>&gt;<i>  
</I>&gt;<i>
</I>Hmmm ... sorry, no further ideas here...

&gt;&gt;<i>How do you pass the request object into processLogin (it doesn't seem to 
</I>&gt;&gt;<i>be part of the call)?
</I>&gt;&gt;<i>It seems like you may be trying to use an old request object or something...
</I>&gt;&gt;<i>    
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i>The request object is stored into a module, where other parts of my
</I>&gt;<i>system will pick it up when they need either the headers or the request.
</I>&gt;<i>  
</I>&gt;<i>
</I>Might need to be careful of thread safety etc here...

&gt;<i>I've verified that the id() of the header_out object is the same in the
</I>&gt;<i>higher-level and lower-level code.  I'm not calling request.write()
</I>&gt;<i>anywhere except at the end of my top-level code, nor am I doing a print
</I>&gt;<i>anywhere.  I guess it might be a problem with SimpleTAL?  It's not going
</I>&gt;<i>to access the Apache request object, but maybe it's doing a print?
</I>&gt;<i>
</I>I don't know much about SimpleTAL, but from what you've described, 
that's where you need to investigate ...
Try wrapping the req object in another one which logs any calls to 
req.write and then pass that through to SimpleTAL?

&gt;&gt;<i>No. But it is a bit more complex running a python interpreter inside 
</I>&gt;&gt;<i>Apache than standalone.
</I>&gt;&gt;<i>    
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i>Sure, I understand that, and I'm ok with it being more complicated.  I'm
</I>&gt;<i>just not happy about running into sporadic problems where sometimes
</I>&gt;<i>things work, sometimes they don't.
</I>&gt;<i>
</I>&gt;<i>For example, *ANY* time I submit a request for a URL via a telnet
</I>&gt;<i>connection, I get the headers back:
</I>&gt;<i>
</I>&gt;<i>   guin:jafo$ telnet 127.0.0.1 80
</I>&gt;<i>   Trying 127.0.0.1...
</I>&gt;<i>   Connected to 127.0.0.1.
</I>&gt;<i>   Escape character is '^]'.
</I>&gt;<i>   GET <A HREF="http://127.0.0.1/jotweb/sessionex.html?Username=jafo&amp;Password=abc123&amp;loginbutton=1">http://127.0.0.1/jotweb/sessionex.html?Username=jafo&amp;Password=abc123&amp;loginbutton=1</A> HTTP/1.0
</I>&gt;<i>
</I>&gt;<i>   HTTP/1.0 200 OK
</I>&gt;<i>   Date: Tue, 10 Jun 2003 08:10:44 GMT
</I>&gt;<i>   Server: Apache/2.0.40 (Red Hat Linux)
</I>&gt;<i>   Set-cookie: sessionid=20d315c26c8c395e61730ceb27d0faa98fd; Comment=&quot;User Login Cookie&quot;; Path=/; Version=1;
</I>&gt;<i>   Cache-control: max-age=0
</I>&gt;<i>   Expires: Thu, 01 Dec 1994 16:00:00 GMT
</I>&gt;<i>   Content-Length: 405
</I>&gt;<i>   Connection: close
</I>&gt;<i>   Content-Type: text/html; charset=ISO-8859-1
</I>&gt;<i>
</I>&gt;<i>   [...]
</I>&gt;<i>
</I>&gt;<i>If I paste the URL:
</I>&gt;<i>
</I>&gt;<i>   <A HREF="http://127.0.0.1/jotweb/sessionex.html?Username=jafo&amp;Password=abc123&amp;loginbutton=1">http://127.0.0.1/jotweb/sessionex.html?Username=jafo&amp;Password=abc123&amp;loginbutton=1</A>
</I>&gt;<i>
</I>&gt;<i>into Konqueror, the headers I'm getting back are:
</I>&gt;<i>
</I>&gt;<i>   Date: Tue, 10 Jun 2003 08:10:44 GMT
</I>&gt;<i>   Server: Apache/2.0.40 (Red Hat Linux)
</I>&gt;<i>   Connection: close
</I>&gt;<i>   Content-Type: text/html; charset=ISO-8859-1
</I>&gt;<i>
</I>&gt;<i>(according to Konqueror).  I've tried Mozilla and galeon as well, all
</I>&gt;<i>with similar results.  Yes, I have cookies enabled from localhost.  If I
</I>&gt;<i>put the headers_out.add() at the top of my handler, it showes up in
</I>&gt;<i>Konqueror's &quot;View Page Info&quot; output...
</I>&gt;<i>
</I>Yikes ... bizarre ... no ideas other than setting up something that 
watches the actual socket through which the message goes, to see what 
the difference is

Hope somebody else can help...
David

</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="010113.html">[mod_python] mod_python weirdness, maybe related to importing?
</A></li>
	<LI>Next message: <A HREF="010115.html">[mod_python] mod_python weirdness, maybe related to importing?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10114">[ date ]</a>
              <a href="thread.html#10114">[ thread ]</a>
              <a href="subject.html#10114">[ subject ]</a>
              <a href="author.html#10114">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
