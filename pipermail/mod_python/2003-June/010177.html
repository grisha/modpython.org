<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] global persistence
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20global%20persistence&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010174.html">
   <LINK REL="Next"  HREF="010182.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
<table border=0 width="100%"><tr><td valign="top">
   <H1>[mod_python] global persistence</H1>
    <B>1 1</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20global%20persistence&In-Reply-To="
       TITLE="[mod_python] global persistence">mod_py at ua.fm
       </A><BR>
    <I>Tue Jun 24 11:11:09 EST 2003</I>
    <P><UL>
        <LI>Previous message: <A HREF="010174.html">[mod_python] Re: mod_python on Windows 
</A></li>
        <LI>Next message: <A HREF="010182.html">[mod_python] global persistence
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10177">[ date ]</a>
              <a href="thread.html#10177">[ thread ]</a>
              <a href="subject.html#10177">[ subject ]</a>
              <a href="author.html#10177">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Greetings to all,

I'm using Apache 1.3.24 + mod_py 2.7.8.

The idea is to make mod_py have global variables that 
will be accessible from any request untill apache restarts.

I added another dictionary to mod_python.c next to 

	static PyObject * interpreters = NULL;
like:
	PyObject * python_globals = NULL;
	
I initialize it on apache start in
	void python_init(server_rec *s, pool *p)	
like:
	if (!python_globals)
	{
		python_globals = PyDict_New();
		ap_log_error(APLOG_MARK, APLOG_NOERRNO|APLOG_ERR, s,
			 &quot;python_init: Initializing globals dict&quot;);
	}
	
and logging shows it really initializes once per apache start.

then I just trying to use it via req object (maybe not the best way but 
fastest to me)
I define it as attribute '__globals__' of req object 
so it's accessible as req.__globals__
module requestobject.c
procedure 
static PyObject * request_getattr(requestobject *self, char *name)

like:
	else if (strcmp(name, &quot;__globals__&quot;) == 0)
	{
		Py_INCREF(python_globals);
		return (PyObject *) python_globals;
	}

works fine with single apache child process.
means I can set 
	req.__globals__[key] = anyobject
and read it in next page hit
	anyobject = req.__globals__[key]
	
but when I start to use few such apache processes (access it from diff ip) I 
have strange situation.

req.__globals__ has same physical address like 0x810108c but different 
content.

Even dumping that 'python_globals' dictionary in requestobject.c shows 
different content of PyDict object.

It looks like each apache child process has own address space and same address 
points 
to physically different memory.

Any suggestion has can I fix that?

Thanx,
Anatoly Artamonov
----

-&gt; CTAPT -&gt; <A HREF="http://start.alkar.net">http://start.alkar.net</A> 
</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="010174.html">[mod_python] Re: mod_python on Windows 
</A></li>
	<LI>Next message: <A HREF="010182.html">[mod_python] global persistence
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10177">[ date ]</a>
              <a href="thread.html#10177">[ thread ]</a>
              <a href="subject.html#10177">[ subject ]</a>
              <a href="author.html#10177">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
