From patfitz at gmail.com  Mon Aug  1 13:36:51 2005
From: patfitz at gmail.com (Patrick Fitzsimmons)
Date: Mon Aug  1 13:36:54 2005
Subject: [mod_python] making mod_python handle every file request
Message-ID: <76d1249d05080110363a6740e1@mail.gmail.com>

How do I make mod_python handle every request, regardless of the extension?  

My current .htaccess file is:

    AddHandler mod_python .adp .psp
    PythonHandler dispatch

I want mod_python to handle any file, whether it be .doc, .jpg, .zip, etc.

I tried doing: AddHandler mod_python .adp *.*    but that didn't work.

Anybody know?  I guess I could set up a mod_rewrite rule, but there
must be a really simple way that I'm just missing.

Thanks for any help.

-Patrick

From sanders at apache.org  Mon Aug  1 13:45:04 2005
From: sanders at apache.org (Scott Sanders)
Date: Mon Aug  1 13:45:04 2005
Subject: [mod_python] making mod_python handle every file request
In-Reply-To: <76d1249d05080110363a6740e1@mail.gmail.com>
References: <76d1249d05080110363a6740e1@mail.gmail.com>
Message-ID: <33621C01-CF2C-4EE4-9129-3AE00F6B7949@apache.org>

Do a SetHandler:

Instead of :
> AddHandler mod_python .adp .psp
use:
    SetHandler mod_python

That will handle EVERY single request through mod_python

Scott Sanders

On Aug 1, 2005, at 10:36 AM, Patrick Fitzsimmons wrote:

> How do I make mod_python handle every request, regardless of the  
> extension?
>
> My current .htaccess file is:
>
>     AddHandler mod_python .adp .psp
>     PythonHandler dispatch
>
> I want mod_python to handle any file, whether it  
> be .doc, .jpg, .zip, etc.
>
> I tried doing: AddHandler mod_python .adp *.*    but that didn't work.
>
> Anybody know?  I guess I could set up a mod_rewrite rule, but there
> must be a really simple way that I'm just missing.
>
From dpopowich at comcast.net  Mon Aug  1 13:51:12 2005
From: dpopowich at comcast.net (Daniel Popowich)
Date: Mon Aug  1 13:51:22 2005
Subject: [mod_python] making mod_python handle every file request
In-Reply-To: <76d1249d05080110363a6740e1@mail.gmail.com>
References: <76d1249d05080110363a6740e1@mail.gmail.com>
Message-ID: <17134.24848.708406.211871@greenmonster.local>


Use SetHandler:

    <Directory  /some/dir>
        SetHandler mod_python
        PythonHandler YOUR-HANDLER
    </Directory>

Then all files under /some/dir will be handled by your mod_python
handler, YOUR-HANDLER.

Daniel Popowich
-----------------------------------------------
http://home.comcast.net/~d.popowich/mpservlets/
    

Patrick Fitzsimmons writes:
> How do I make mod_python handle every request, regardless of the extension?  
> 
> My current .htaccess file is:
> 
>     AddHandler mod_python .adp .psp
>     PythonHandler dispatch
> 
> I want mod_python to handle any file, whether it be .doc, .jpg, .zip, etc.
> 
> I tried doing: AddHandler mod_python .adp *.*    but that didn't work.
> 
> Anybody know?  I guess I could set up a mod_rewrite rule, but there
> must be a really simple way that I'm just missing.
> 
> Thanks for any help.
> 
> -Patrick
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
From paulhaerle at gmx.at  Mon Aug  1 14:48:37 2005
From: paulhaerle at gmx.at (Paul Anselm =?ISO-8859-1?Q?H=E4rle?=)
Date: Mon Aug  1 14:48:54 2005
Subject: [mod_python] making mod_python.publisher handle every file request
Message-ID: <1122922117.10158.2.camel@watermelon>

>Use SetHandler:
>
>    <Directory  /some/dir>
>        SetHandler mod_python
>        PythonHandler YOUR-HANDLER
>    </Directory>
Is it possible to do the same thing with mod_python.publisher? because
my <Directory> looks like this at the moment:
    <Directory /var/www/asc/>
        Options Indexes
        AddHandler python-program .py
        PythonHandler mod_python.publisher
        AllowOverride FileInfo
        Order allow,deny
        Allow from all
    </Directory>


From mhellwig at xs4all.nl  Mon Aug  1 15:12:21 2005
From: mhellwig at xs4all.nl (Martin P. Hellwig)
Date: Mon Aug  1 15:12:40 2005
Subject: [mod_python] making mod_python.publisher handle every file request
In-Reply-To: <1122922117.10158.2.camel@watermelon>
References: <1122922117.10158.2.camel@watermelon>
Message-ID: <42EE7415.9090704@xs4all.nl>

Paul Anselm H?rle wrote:

>>Use SetHandler:
>>
>>   <Directory  /some/dir>
>>       SetHandler mod_python
>>       PythonHandler YOUR-HANDLER
>>   </Directory>
>>    
>>
>Is it possible to do the same thing with mod_python.publisher? because
>my <Directory> looks like this at the moment:
>    <Directory /var/www/asc/>
>        Options Indexes
>        AddHandler python-program .py
>        PythonHandler mod_python.publisher
>        AllowOverride FileInfo
>        Order allow,deny
>        Allow from all
>    </Directory>
>
>
>  
>
I can't think of any reason why not, but have you tried it and it didn't 
work?

-- 
mph
From paulhaerle at gmx.at  Mon Aug  1 15:29:37 2005
From: paulhaerle at gmx.at (Paul Anselm =?ISO-8859-1?Q?H=E4rle?=)
Date: Mon Aug  1 15:29:42 2005
Subject: [mod_python] making mod_python.publisher handle every file request
In-Reply-To: <42EE7415.9090704@xs4all.nl>
References: <1122922117.10158.2.camel@watermelon> <42EE7415.9090704@xs4all.nl>
Message-ID: <1122924577.10379.1.camel@watermelon>

> I can't think of any reason why not, but have you tried it and it didn't 
> work?
> 
Aehm..no. What should i've tried?

From mhellwig at xs4all.nl  Mon Aug  1 15:39:22 2005
From: mhellwig at xs4all.nl (Martin P. Hellwig)
Date: Mon Aug  1 15:39:41 2005
Subject: [mod_python] making mod_python.publisher handle every file	request
In-Reply-To: <1122924577.10379.1.camel@watermelon>
References: <1122922117.10158.2.camel@watermelon>	 <42EE7415.9090704@xs4all.nl>
	<1122924577.10379.1.camel@watermelon>
Message-ID: <42EE7A6A.6030407@xs4all.nl>

Paul Anselm H?rle wrote:

>>I can't think of any reason why not, but have you tried it and it didn't 
>>work?
>>
>>    
>>
>Aehm..no. What should i've tried?
>
>  
>
change:

AddHandler python-program .py

with:

SetHandler python-program

for example :-)

-- 
mph


From grahamd at dscpl.com.au  Mon Aug  1 18:12:42 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Mon Aug  1 18:13:07 2005
Subject: [mod_python] making mod_python.publisher handle every file request
In-Reply-To: <42EE7415.9090704@xs4all.nl>
References: <1122922117.10158.2.camel@watermelon> <42EE7415.9090704@xs4all.nl>
Message-ID: <aff4e80c981060c0e9d2a9006120ce97@dscpl.com.au>


On 02/08/2005, at 5:12 AM, Martin P. Hellwig wrote:

> Paul Anselm H?rle wrote:
>
>>> Use SetHandler:
>>>
>>>   <Directory  /some/dir>
>>>       SetHandler mod_python
>>>       PythonHandler YOUR-HANDLER
>>>   </Directory>
>>>
>> Is it possible to do the same thing with mod_python.publisher? because
>> my <Directory> looks like this at the moment:
>>    <Directory /var/www/asc/>
>>        Options Indexes
>>        AddHandler python-program .py
>>        PythonHandler mod_python.publisher
>>        AllowOverride FileInfo
>>        Order allow,deny
>>        Allow from all
>>    </Directory>
>>
>>
>>
> I can't think of any reason why not, but have you tried it and it 
> didn't work?

Just be aware that the special interpretation of URLs that publisher
does means that there will be certain restrictions on how you could
feasibly name files.

The main one is that each component of the URL must be able to map to a
Python module name, function name, variable name etc. Therefore each
component of the URL must be a valid Python identifier name. You
therefore couldn't embed '-' in a name, or having leading numeric
digits.

You also can't have a '.' in a name except where it matches against the
initial Python module that publisher loads. This extension will be
discarded and so if you have two files with the same basename and
different extensions, they wouldn't be automatically mapped to different
functions.

Publisher also doesn't allow components to have a leading underscore,
interpreting this as access to a protected object.

What problems you are going to encounter is going to depend a bit on
what you are trying to do. Do the files you want to reference actually
exist, but you want control for returning them to be managed by a
publisher function, or are all files virtual?

There may be better options depending on what you are doing.

Graham

From cy.khormaee at hp.com  Wed Aug  3 14:09:14 2005
From: cy.khormaee at hp.com (Khormaee, Cy)
Date: Wed Aug  3 14:09:22 2005
Subject: [mod_python] parameters
Message-ID: <51E9B8FBB414C44A9A2CB19A5F4F5DD90422CD41@cacexc03.americas.cpqcorp.net>

Hey all,

I was curious if there is a way to create a parameter which will accept an arbitrary number of keyword arguments in python.  

Currently, im trying to make a procedure to accept output from a form which has a variable number of submission fields.  The HTML form only outputs keyword arguments (as far as I know) so i cant use an arbitary argument list.

Any help would be greatly appreciated.

From christopher.jackson at gmail.com  Wed Aug  3 16:30:16 2005
From: christopher.jackson at gmail.com (Chris Jackson)
Date: Wed Aug  3 16:30:20 2005
Subject: [mod_python] parameters
In-Reply-To: <51E9B8FBB414C44A9A2CB19A5F4F5DD90422CD41@cacexc03.americas.cpqcorp.net>
References: <51E9B8FBB414C44A9A2CB19A5F4F5DD90422CD41@cacexc03.americas.cpqcorp.net>
Message-ID: <4d11484d0508031330139f6bf9@mail.gmail.com>

def myFunc(arg, *args, **kwargs):
...

-- arg is one argument
-- *args accept any number of excess positional arguments
-- **kwargs accepts any excess keyword-bound arguments stored as a dictionary

I hope this helps.

~= Chris =~

On 8/3/05, Khormaee, Cy <cy.khormaee@hp.com> wrote:
> Hey all,
> 
> I was curious if there is a way to create a parameter which will accept an arbitrary number of keyword arguments in python.
> 
> Currently, im trying to make a procedure to accept output from a form which has a variable number of submission fields.  The HTML form only outputs keyword arguments (as far as I know) so i cant use an arbitary argument list.
> 
> Any help would be greatly appreciated.
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>

From gwidion at mpc.com.br  Wed Aug  3 17:02:30 2005
From: gwidion at mpc.com.br (Joao S. O. Bueno Calligaris)
Date: Wed Aug  3 17:04:49 2005
Subject: [mod_python] parameters
In-Reply-To: <51E9B8FBB414C44A9A2CB19A5F4F5DD90422CD41@cacexc03.americas.cpqcorp.net>
References: <51E9B8FBB414C44A9A2CB19A5F4F5DD90422CD41@cacexc03.americas.cpqcorp.net>
Message-ID: <200508031802.30297.gwidion@mpc.com.br>

On Wednesday 03 August 2005 15:09, Khormaee, Cy wrote:
> Hey all,
>
> I was curious if there is a way to create a parameter which will
> accept an arbitrary number of keyword arguments in python.
>
> Currently, im trying to make a procedure to accept output from a
> form which has a variable number of submission fields.  The HTML
> form only outputs keyword arguments (as far as I know) so i cant
> use an arbitary argument list.
>

Hi,
 yes there is.

Just declare your fucntion like this:

def my_function (**args)  :
   
The argument preceeded by two * in the declaration becomes a 
dictionary containing all named parameters passed in.

For unnamed parameters, a single * will receive variable lenght t\uple 
of parameters.

Regards,
	JS
	-><-



> Any help would be greatly appreciated.
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
From grahamd at dscpl.com.au  Wed Aug  3 18:04:16 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Wed Aug  3 18:04:51 2005
Subject: [mod_python] parameters
In-Reply-To: <4d11484d0508031330139f6bf9@mail.gmail.com>
References: <51E9B8FBB414C44A9A2CB19A5F4F5DD90422CD41@cacexc03.americas.cpqcorp.net>
	<4d11484d0508031330139f6bf9@mail.gmail.com>
Message-ID: <73b7232828976b696895e22bd97b7f77@dscpl.com.au>

A clarification.

If we are talking about this in the context of mod_python, the
ability to have form arguments automatically translated to
function parameters only works when mod_python.publisher is
used. Further, only "kwargs" is applicable as there isn't any
way in mod_python.publisher that form arguments can be mapped
to an "args" parameter as shown.

Graham

On 04/08/2005, at 6:30 AM, Chris Jackson wrote:

> def myFunc(arg, *args, **kwargs):
> ...
>
> -- arg is one argument
> -- *args accept any number of excess positional arguments
> -- **kwargs accepts any excess keyword-bound arguments stored as a 
> dictionary
>
> I hope this helps.
>
> ~= Chris =~
>
> On 8/3/05, Khormaee, Cy <cy.khormaee@hp.com> wrote:
>> Hey all,
>>
>> I was curious if there is a way to create a parameter which will 
>> accept an arbitrary number of keyword arguments in python.
>>
>> Currently, im trying to make a procedure to accept output from a form 
>> which has a variable number of submission fields.  The HTML form only 
>> outputs keyword arguments (as far as I know) so i cant use an 
>> arbitary argument list.
>>
>> Any help would be greatly appreciated.
>>
>> _______________________________________________
>> Mod_python mailing list
>> Mod_python@modpython.org
>> http://mailman.modpython.org/mailman/listinfo/mod_python
>>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python

From scott_list at mischko.com  Fri Aug  5 16:24:55 2005
From: scott_list at mischko.com (Scott Chapman)
Date: Fri Aug  5 16:25:04 2005
Subject: [mod_python] How to make mod_python know when Apache is
	shutdown/restarted?
Message-ID: <42F3CB17.7000103@mischko.com>

I need to make mod_python close the database connection nicely when 
Apache is shutdown or restarted.  How do I get this info into 
mod_python's world?

TIA,
Scott
From scott_list at mischko.com  Fri Aug  5 17:52:03 2005
From: scott_list at mischko.com (Scott Chapman)
Date: Fri Aug  5 17:52:09 2005
Subject: [mod_python] How to make mod_python know when Apache
	is	shutdown/restarted?
In-Reply-To: <42F3CB17.7000103@mischko.com>
References: <42F3CB17.7000103@mischko.com>
Message-ID: <42F3DF83.2070307@mischko.com>

Scott Chapman wrote:
> I need to make mod_python close the database connection nicely when 
> Apache is shutdown or restarted.  How do I get this info into 
> mod_python's world?

I found the Server's "register cleanup(request, callable[, data ])" method.

When do I call it?

It seems it should be done once per Apache child process, not with every 
request.  I don't see a way to run something only when mod_python is 
instantiated initially.

I'm using mpservlets in case that makes any difference (I doubt it).

Thanks!
Scott
From grahamd at dscpl.com.au  Fri Aug  5 18:39:13 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Fri Aug  5 18:39:31 2005
Subject: [mod_python] How to make mod_python know when Apache
	is	shutdown/restarted?
In-Reply-To: <42F3DF83.2070307@mischko.com>
References: <42F3CB17.7000103@mischko.com> <42F3DF83.2070307@mischko.com>
Message-ID: <ad1fb5906c8748847ef9d824c8e22520@dscpl.com.au>


On 06/08/2005, at 7:52 AM, Scott Chapman wrote:

> Scott Chapman wrote:
>> I need to make mod_python close the database connection nicely when 
>> Apache is shutdown or restarted.  How do I get this info into 
>> mod_python's world?
>
> I found the Server's "register cleanup(request, callable[, data ])" 
> method.
>
> When do I call it?
>
> It seems it should be done once per Apache child process, not with 
> every request.

Since to get the server object you need a request object, the only
option is to call it as a side effect of a request. To avoid calling it
more than once, you simply need to keep a global data flag some where
which you can set the first time you register the cleanup handler
thereby avoiding calling it again. If using a multithreaded MPM, just
make sure you thread protect access to the flag and registration of the
cleanup handler so you don't get race conditions.

Note that the consequence of this is you can't really create a database
connection using PythonImport but have to wait until the first time it
is required by any request. If you did do it from PythonImport, and
Apache was shutdown before a request was handled that needed the
database connection, you wouldn't get your cleanup handler called as it
wouldn't have been registered yet.

> I don't see a way to run something only when mod_python is 
> instantiated initially.

Correct, see:

   http://issues.apache.org/jira/browse/MODPYTHON-37

I still believe it would be possible to implement such a feature, and
previously described how I felt it could be done, but it has low
priority in the scheme of things.

Graham

From scott_list at mischko.com  Fri Aug  5 20:06:24 2005
From: scott_list at mischko.com (Scott Chapman)
Date: Fri Aug  5 20:06:32 2005
Subject: [mod_python] How to make mod_python know when Apache
	is	shutdown/restarted?
In-Reply-To: <ad1fb5906c8748847ef9d824c8e22520@dscpl.com.au>
References: <42F3CB17.7000103@mischko.com> <42F3DF83.2070307@mischko.com>
	<ad1fb5906c8748847ef9d824c8e22520@dscpl.com.au>
Message-ID: <42F3FF00.5040309@mischko.com>

Graham Dumpleton wrote:
> 
  > Since to get the server object you need a request object, the only
> option is to call it as a side effect of a request. To avoid calling it
> more than once, you simply need to keep a global data flag some where
> which you can set the first time you register the cleanup handler
> thereby avoiding calling it again. 

Is there any way to store something global in memory on a per-child 
basis, rather than in a session (which goes out to a dbm file)?

Scottb
From grahamd at dscpl.com.au  Fri Aug  5 20:13:08 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Fri Aug  5 20:13:19 2005
Subject: [mod_python] How to make mod_python know when Apache
	is	shutdown/restarted?
In-Reply-To: <42F3FF00.5040309@mischko.com>
References: <42F3CB17.7000103@mischko.com> <42F3DF83.2070307@mischko.com>
	<ad1fb5906c8748847ef9d824c8e22520@dscpl.com.au>
	<42F3FF00.5040309@mischko.com>
Message-ID: <a414a00b6fe8b7893f4beb0fecbe5554@dscpl.com.au>


On 06/08/2005, at 10:06 AM, Scott Chapman wrote:

> Graham Dumpleton wrote:
>  > Since to get the server object you need a request object, the only
>> option is to call it as a side effect of a request. To avoid calling 
>> it
>> more than once, you simply need to keep a global data flag some where
>> which you can set the first time you register the cleanup handler
>> thereby avoiding calling it again.
>
> Is there any way to store something global in memory on a per-child 
> basis, rather than in a session (which goes out to a dbm file)?

You could still use a module imported using PythonImport for that 
purpose.

What you probably want to do is used PythonImport like you were before 
but
don't have it trigger the connection to the database system. When a call
comes into access the database via that module later on, use your flag
stored as global data in that module or in your database connection 
object
to check at that point. If first time, connect to database and register
cleanup handler.

BTW, almost have a working version of apache.register_cleanup() going 
anyway
if you want to try it when I am done. Means modify mod_python source 
though.

Graham

From scott_list at mischko.com  Fri Aug  5 20:26:49 2005
From: scott_list at mischko.com (Scott Chapman)
Date: Fri Aug  5 20:26:58 2005
Subject: [mod_python] How to make mod_python know when Apache
	is	shutdown/restarted?
In-Reply-To: <a414a00b6fe8b7893f4beb0fecbe5554@dscpl.com.au>
References: <42F3CB17.7000103@mischko.com> <42F3DF83.2070307@mischko.com>
	<ad1fb5906c8748847ef9d824c8e22520@dscpl.com.au>
	<42F3FF00.5040309@mischko.com>
	<a414a00b6fe8b7893f4beb0fecbe5554@dscpl.com.au>
Message-ID: <42F403C9.1030406@mischko.com>

Graham Dumpleton wrote:

> BTW, almost have a working version of apache.register_cleanup() going 
> anyway
> if you want to try it when I am done. Means modify mod_python source 
> though.

I'd be glad to.  Let me know when you're ready. I'm running:
Apache/2.0.53 (Unix) mod_ssl/2.0.53 OpenSSL/0.9.7d mod_python/3.1.4 
Python/2.4.1c2

and:

Apache/2.0.54 (Unix) mod_python/3.1.4 Python/2.4.1

Thanks!
Scott
From grahamd at dscpl.com.au  Fri Aug  5 20:44:32 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Fri Aug  5 20:44:53 2005
Subject: [mod_python] How to make mod_python know when Apache
	is	shutdown/restarted?
In-Reply-To: <42F403C9.1030406@mischko.com>
References: <42F3CB17.7000103@mischko.com> <42F3DF83.2070307@mischko.com>
	<ad1fb5906c8748847ef9d824c8e22520@dscpl.com.au>
	<42F3FF00.5040309@mischko.com>
	<a414a00b6fe8b7893f4beb0fecbe5554@dscpl.com.au>
	<42F403C9.1030406@mischko.com>
Message-ID: <5fe6708d3976bedd2ffa0977a7821cf3@dscpl.com.au>


On 06/08/2005, at 10:26 AM, Scott Chapman wrote:

> Graham Dumpleton wrote:
>
>> BTW, almost have a working version of apache.register_cleanup() going 
>> anyway
>> if you want to try it when I am done. Means modify mod_python source 
>> though.
>
> I'd be glad to.  Let me know when you're ready. I'm running:
> Apache/2.0.53 (Unix) mod_ssl/2.0.53 OpenSSL/0.9.7d mod_python/3.1.4 
> Python/2.4.1c2
>
> and:
>
> Apache/2.0.54 (Unix) mod_python/3.1.4 Python/2.4.1

I have added diff as attachment to:

   http://issues.apache.org/jira/browse/MODPYTHON-37

The diff is against the latest version of mod_python source code
from subversion repository.

In a real hurry at the moment to get out the door and go somewhere.
As such, although I tested it working from global code executed
from a handler module import, didn't yet check it for PythonImport.
Wouldn't expect there to be a problem though.

Grisha, Nicolas, Jim. Would be appreciated if you have a glance over
the code and see if you have problems with the way I did this. Had
to change prototype of make_obcallback() in mod_python.c and init()
function in the Python "apache" module.

Graham


From scott_list at mischko.com  Fri Aug  5 23:47:15 2005
From: scott_list at mischko.com (Scott Chapman)
Date: Fri Aug  5 23:47:22 2005
Subject: [mod_python] How to make mod_python know when Apache
	is	shutdown/restarted?
In-Reply-To: <5fe6708d3976bedd2ffa0977a7821cf3@dscpl.com.au>
References: <42F3CB17.7000103@mischko.com> <42F3DF83.2070307@mischko.com>
	<ad1fb5906c8748847ef9d824c8e22520@dscpl.com.au>
	<42F3FF00.5040309@mischko.com>
	<a414a00b6fe8b7893f4beb0fecbe5554@dscpl.com.au>
	<42F403C9.1030406@mischko.com>
	<5fe6708d3976bedd2ffa0977a7821cf3@dscpl.com.au>
Message-ID: <42F432C3.4010206@mischko.com>

Graham Dumpleton wrote:
> 
> On 06/08/2005, at 10:26 AM, Scott Chapman wrote:
> 
>> Graham Dumpleton wrote:
>>
>>> BTW, almost have a working version of apache.register_cleanup() going 
>>> anyway
>>> if you want to try it when I am done. Means modify mod_python source 
>>> though.

I downloaded svn, patched it and compiled it.  Got a lot of warnings 
about things being redefined but it's running fine so far.  I need to 
know what all parameters apache.register_cleanup() is expecting.

Scott
From grahamd at dscpl.com.au  Sat Aug  6 00:13:06 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Sat Aug  6 00:13:19 2005
Subject: [mod_python] How to make mod_python know when Apache
	is	shutdown/restarted?
In-Reply-To: <42F432C3.4010206@mischko.com>
References: <42F3CB17.7000103@mischko.com> <42F3DF83.2070307@mischko.com>
	<ad1fb5906c8748847ef9d824c8e22520@dscpl.com.au>
	<42F3FF00.5040309@mischko.com>
	<a414a00b6fe8b7893f4beb0fecbe5554@dscpl.com.au>
	<42F403C9.1030406@mischko.com>
	<5fe6708d3976bedd2ffa0977a7821cf3@dscpl.com.au>
	<42F432C3.4010206@mischko.com>
Message-ID: <5d13b5d6ef6e63044b55659de61f5689@dscpl.com.au>


On 06/08/2005, at 1:47 PM, Scott Chapman wrote:

> Graham Dumpleton wrote:
>> On 06/08/2005, at 10:26 AM, Scott Chapman wrote:
>>> Graham Dumpleton wrote:
>>>
>>>> BTW, almost have a working version of apache.register_cleanup() 
>>>> going anyway
>>>> if you want to try it when I am done. Means modify mod_python 
>>>> source though.
>
> I downloaded svn, patched it and compiled it.  Got a lot of warnings 
> about things being redefined but it's running fine so far.  I need to 
> know what all parameters apache.register_cleanup() is expecting.

Just like you had called req.register_cleanup() except that cleanup
handler is called on server shutdown like req.server.register_cleanup().

  register_cleanup(callable[, data])

    Registers a cleanup. Argument callable can be any callable object, 
the
    optional argument data can be any object (default is  None). At 
Apache
    child process termination, callable will be called with one 
argument, data.

    If errors are encountered during cleanup processing, they should be 
in
    error log.

Note that I have actually made a minor mistake in the code. In 
apache.py,
the prototype should be:

   def register_cleanup(handler,data=None):
       _apache.register_cleanup(_interpreter,_server,handler,data)

I used "args=()" which isn't technically correct but only in as much as
I used "()" instead of "None". I was thinking you could supply a tuple 
of
arguments whereas you can actually only supply a single argument. What I
did wouldn't have stopped it working though.

Anyway, you should be able to do:

   def shutdown1():
       apache.log_error("shutdown1")

   apache.register_cleanup(shutdown1)

   def shutdown2(data):
       apache.log_error("shutdown2 %r"%data)

   apache.register_cleanup(shutdown2,"data")


Graham

From grahamd at dscpl.com.au  Sat Aug  6 05:51:48 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Sat Aug  6 05:52:00 2005
Subject: [mod_python] How to make mod_python know when Apache
	is	shutdown/restarted?
In-Reply-To: <42F432C3.4010206@mischko.com>
References: <42F3CB17.7000103@mischko.com> <42F3DF83.2070307@mischko.com>
	<ad1fb5906c8748847ef9d824c8e22520@dscpl.com.au>
	<42F3FF00.5040309@mischko.com>
	<a414a00b6fe8b7893f4beb0fecbe5554@dscpl.com.au>
	<42F403C9.1030406@mischko.com>
	<5fe6708d3976bedd2ffa0977a7821cf3@dscpl.com.au>
	<42F432C3.4010206@mischko.com>
Message-ID: <f37fbc1f42aae099d9c46644e382b141@dscpl.com.au>


On 06/08/2005, at 1:47 PM, Scott Chapman wrote:

> Graham Dumpleton wrote:
>> On 06/08/2005, at 10:26 AM, Scott Chapman wrote:
>>> Graham Dumpleton wrote:
>>>
>>>> BTW, almost have a working version of apache.register_cleanup() 
>>>> going anyway
>>>> if you want to try it when I am done. Means modify mod_python 
>>>> source though.
>
> I downloaded svn, patched it and compiled it.  Got a lot of warnings 
> about things being redefined but it's running fine so far.

In case you aren't on the developers list for mod_python, Nicolas has
already pushed the patches I proposed back into the subversion source
code repository.

Anyway, please let us know how this feature works out and whether it
achieves what you wanted.

Graham

From vavarachen at gmail.com  Tue Aug  9 17:24:38 2005
From: vavarachen at gmail.com (Vijay Avarachen)
Date: Tue Aug  9 17:24:43 2005
Subject: [mod_python] Newbie question: Apache config
Message-ID: <576c9ac4050809142411ea02a5@mail.gmail.com>

Hello,
I am really confused with the way mod_python works. Unfortunately all the 
examples of apache configuration for mod_python I have seen are not very 
good, either that or its supposed to be extremely simple and I am not 
getting it. I have few python scripts that I'd like to run using mod_python, 
but I can't get them to work using PythonHandler mod_python.publisher.

Here is what I have in my conf.d/python.conf :
<Directory "/home/user/public_html/python">
 AddHandler mod_python .py
 PythonHandler mod_python.publisher
 PythonDebug on
</Directory>

This does not work for the mptest example from the mod_python documentation. 
I don't understand why it does not work. However changing the line to
PythonHandler
mptest it works. I can't imagine having to list out each and every python 
script I plan to run after PythonHandler. I know there has to be a better 
way. 

Also I am a bit confused between psp and a python script. The only 
difference as far as I can tell is, psp uses html with embedded python code, 
and a python script basically prints the html code. What other options do I 
have other than mod_python.publisher. Dropping do a python shell and 
importing mod_python doesn't give me any useful info. Doing a 
dir(mod_python) gives me:
>>> dir(mod_python)
['__all__', '__builtins__', '__doc__', '__file__', '__name__', '__path__']

Thanks,
Vijay Avarachen

-- 
"Knowledge is the only wealth that grows as you spend it, and diminishes as 
you save it."
-- ancient Sanskrit saying
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20050809/38751c92/attachment.html
From grahamd at dscpl.com.au  Tue Aug  9 18:38:13 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Tue Aug  9 18:38:28 2005
Subject: [mod_python] Newbie question: Apache config
In-Reply-To: <576c9ac4050809142411ea02a5@mail.gmail.com>
References: <576c9ac4050809142411ea02a5@mail.gmail.com>
Message-ID: <3d277546decb50e69d67d557783dffd2@dscpl.com.au>


On 10/08/2005, at 7:24 AM, Vijay Avarachen wrote:

> Hello,
>  ???? I am really confused with the way mod_python works.? 
> Unfortunately all the examples of apache configuration for mod_python 
> I have seen are not very good, either that or its supposed to be 
> extremely simple and I am not getting it.?

At least for the "mptest.py" example, did you find and read:

   http://www.dscpl.com.au/articles/modpython-001.html

If you did know of this one and thought it wasn't adequate, please
contribute any feedback so it can be made better.

> I have few python scripts that I'd like to run using mod_python, but I 
> can't get them to work using PythonHandler mod_python.publisher.
>
>  Here is what I have in my conf.d/python.conf :
> <Directory "/home/user/public_html/python">
> ??????? AddHandler mod_python .py
> ??????? PythonHandler mod_python.publisher
> ??????? PythonDebug on
> </Directory>
>
>  This does not work for the mptest example from the mod_python 
> documentation.? I don't understand why it does not work.? However 
> changing the line to PythonHandler mptest it works.? I can't imagine 
> having to list out each and every python script I plan to run after 
> PythonHandler.? I know there has to be a better way.?

That configuration will not work properly with mptest.py example code as
the internal way that a Python code file is setup and how your handlers
are defined is somewhat different between mod_python.publisher and a
basic content handler. In mod_python.publisher, it also interprets the
URL in a special way to map requests against the contents of your code
file.

If you did manage to work out the correct URL such that mptest.py did
generate something under mod_python.publisher, you would have found it
probably added the string "0" onto the end of the output wrongly, or the
details of a 500 error generated by Apache may have been appended to the
output in the worst case.

The URL that may have worked for mptest.py under mod_python.publisher
is:

   /~user/python/mptest.py/handler

You should do some more reading into the differences between a basic
content handler and a mod_python.publisher published object and how URL
mapping works in mod_python.publisher.

If all you are after is a way of having different basic content handlers
in distinct files and having the URLs map to each appropriately, you
might also consider looking at Vampire, as it provides this sort of
functionality for mod_python.

   http://www.dscpl.com.au/projects/vampire

Graham

From jg.lists at sympatico.ca  Wed Aug 10 09:04:04 2005
From: jg.lists at sympatico.ca (Jim Gallacher)
Date: Wed Aug 10 09:02:52 2005
Subject: [mod_python] mod_python package maintainers - are you out there?
In-Reply-To: <c298f2d705081005434ea5f4d5@mail.gmail.com>
References: <0f012a11a376049f45b87146af556a44@dscpl.com.au>	
	<20050810120128.GA5863@verkkotelakka.net>	
	<7e72b03ad817e1d98eb5b0bb1fefb8e4@dscpl.com.au>	
	<20050810121920.GB5863@verkkotelakka.net>	
	<c298f2d7050810054021182d61@mail.gmail.com>
	<c298f2d705081005434ea5f4d5@mail.gmail.com>
Message-ID: <42F9FB44.7080607@sympatico.ca>

Nicolas Lehuen wrote:
> Another remark : has anyone suscribed to redhat, debian etc. mailing 
> list to watch for such patches ? 

Not me.

> I don't understand why those guys 
> aren't posting their patches on the mod_python mailing list.

I was wondering the same thing. What would be better for us, subscribing 
to a bunch of mailing lists or contacting the maintainers directly and 
telling them we are interested in having them forward their bug reports 
and patches (and then hoping they do)? Having some contact with them 
directly is probably a good idea anyway. Subscribing to a bunch of 
mailing lists could result in a lot of uninteresting mail. ;)

But first let's have a show of hands. How many people monitoring either 
of the mod_python or python-dev mailing lists are package maintainers 
for a distribution?

Regards,
Jim

From mhellwig at xs4all.nl  Wed Aug 10 09:16:22 2005
From: mhellwig at xs4all.nl (Martin P. Hellwig)
Date: Wed Aug 10 09:16:40 2005
Subject: [mod_python] A PSP templating example with XML and XSLT
Message-ID: <42F9FE26.1090306@xs4all.nl>

Hello all,

I only recently picked up python (as my first realer programming 
language) and made a test page with mod_python using  a own written 
simple handler, psp templating with xml and xslt.
There is a link to a page (right top corner) where  I describe how I've 
done it plus all the source and directories. Maybe this is interesting 
for people who like to have a more or less working example of a 
mod_python site.

See it at, http://xinagnet.xs4all.nl/browser_info

If you have feedback on grammar, clearnes or coding please do tell me 
(this list will do fine), thanks!

-- 
mph
From tony at dorintony.com  Wed Aug 10 17:50:36 2005
From: tony at dorintony.com (Tony Burger)
Date: Wed Aug 10 17:50:42 2005
Subject: [mod_python] [SPAM] mod_python and protected realms
Message-ID: <42FA76AC.9090008@dorintony.com>

Got an odd thing happening and I can't figure out whats going on.  I'm 
running mod_python 3.1.4 on Apache 2. I've got the following setup in my 
httpd.conf:

AddHandler python-program .py
PythonHandler mod_python.publisher

<Directory "/home/somepath/protected">
     AuthName "some realm"
     AuthType Digest
     AuthDigestFile /path to realm file
     AuthDigestDomain /
     Require user someuser
     Order allow,deny
     allow from all
</Directory>

When I request a file from the protected realm it forces me to login 
which works as it should. Once I'm logged in to the realm, I try and run 
a python script but I keep getting "400 Bad Request" responses as if it 
can't find the script.  The python script directory exists in a 
subdirectory under the realm such as "/home/somepath/protected/scripts". 
  Now here's the wierd part.  As soon as I comment out the realm related 
info, the python script works fine.  Has anyone seen this before and/or 
could anyone provide some insight?  Thanks!
From grahamd at dscpl.com.au  Wed Aug 10 18:10:40 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Wed Aug 10 18:10:51 2005
Subject: [mod_python] mod_python and protected realms
In-Reply-To: <42FA76AC.9090008@dorintony.com>
References: <42FA76AC.9090008@dorintony.com>
Message-ID: <ae017d9343429047bfe485ea538c205b@dscpl.com.au>

Known issue, see:

   http://issues.apache.org/jira/browse/MODPYTHON-47

There is no way of using digest authentication in conjunction
with mod_python.publisher at the moment.

Graham

On 11/08/2005, at 7:50 AM, Tony Burger wrote:

> Got an odd thing happening and I can't figure out whats going on.  I'm 
> running mod_python 3.1.4 on Apache 2. I've got the following setup in 
> my httpd.conf:
>
> AddHandler python-program .py
> PythonHandler mod_python.publisher
>
> <Directory "/home/somepath/protected">
>     AuthName "some realm"
>     AuthType Digest
>     AuthDigestFile /path to realm file
>     AuthDigestDomain /
>     Require user someuser
>     Order allow,deny
>     allow from all
> </Directory>
>
> When I request a file from the protected realm it forces me to login 
> which works as it should. Once I'm logged in to the realm, I try and 
> run a python script but I keep getting "400 Bad Request" responses as 
> if it can't find the script.  The python script directory exists in a 
> subdirectory under the realm such as 
> "/home/somepath/protected/scripts".  Now here's the wierd part.  As 
> soon as I comment out the realm related info, the python script works 
> fine.  Has anyone seen this before and/or could anyone provide some 
> insight?  Thanks!
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python

From grahamd at dscpl.com.au  Wed Aug 10 18:44:48 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Wed Aug 10 18:44:56 2005
Subject: [mod_python] A PSP templating example with XML and XSLT
In-Reply-To: <42F9FE26.1090306@xs4all.nl>
References: <42F9FE26.1090306@xs4all.nl>
Message-ID: <3281f0a21a5630a73e7248936507ccd2@dscpl.com.au>

You might try it on a range of browsers. Doesn't work properly with 
Safari
under Mac OS Panther. Doesn't seem to detect it as XML and thus simply
strips out all the markup and displays the bits left over as a big mess.
All I did was follow the link below, so don't think I am doing anything
wrong.

On 10/08/2005, at 11:16 PM, Martin P. Hellwig wrote:

> Hello all,
>
> I only recently picked up python (as my first realer programming 
> language) and made a test page with mod_python using  a own written 
> simple handler, psp templating with xml and xslt.
> There is a link to a page (right top corner) where  I describe how 
> I've done it plus all the source and directories. Maybe this is 
> interesting for people who like to have a more or less working example 
> of a mod_python site.
>
> See it at, http://xinagnet.xs4all.nl/browser_info
>
> If you have feedback on grammar, clearnes or coding please do tell me 
> (this list will do fine), thanks!
>
> -- 
> mph
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python

From jg.lists at sympatico.ca  Wed Aug 10 19:13:37 2005
From: jg.lists at sympatico.ca (Jim Gallacher)
Date: Wed Aug 10 19:12:24 2005
Subject: [mod_python] A PSP templating example with XML and XSLT
In-Reply-To: <3281f0a21a5630a73e7248936507ccd2@dscpl.com.au>
References: <42F9FE26.1090306@xs4all.nl>
	<3281f0a21a5630a73e7248936507ccd2@dscpl.com.au>
Message-ID: <42FA8A21.7040602@sympatico.ca>

Graham Dumpleton wrote:
> You might try it on a range of browsers. Doesn't work properly with Safari
> under Mac OS Panther. Doesn't seem to detect it as XML and thus simply
> strips out all the markup and displays the bits left over as a big mess.
> All I did was follow the link below, so don't think I am doing anything
> wrong.

Works fine with Firefox but not Konqueror (both on Debian unstable). Not 
a suprise that Konq shows the same as behaviour as Safari since they are 
kissing cousins.

Jim


> On 10/08/2005, at 11:16 PM, Martin P. Hellwig wrote:
> 
>> Hello all,
>>
>> I only recently picked up python (as my first realer programming 
>> language) and made a test page with mod_python using  a own written 
>> simple handler, psp templating with xml and xslt.
>> There is a link to a page (right top corner) where  I describe how 
>> I've done it plus all the source and directories. Maybe this is 
>> interesting for people who like to have a more or less working example 
>> of a mod_python site.
>>
>> See it at, http://xinagnet.xs4all.nl/browser_info
>>
>> If you have feedback on grammar, clearnes or coding please do tell me 
>> (this list will do fine), thanks!
>>
>> -- 
>> mph
>> _______________________________________________
>> Mod_python mailing list
>> Mod_python@modpython.org
>> http://mailman.modpython.org/mailman/listinfo/mod_python
> 
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
> 

From administrator at leebrown.org  Wed Aug 10 22:53:21 2005
From: administrator at leebrown.org (Lee Brown)
Date: Wed Aug 10 22:53:37 2005
Subject: [mod_python] A PSP templating example with XML and XSLT
In-Reply-To: <3281f0a21a5630a73e7248936507ccd2@dscpl.com.au>
Message-ID: <ACFA8C097B8A@underdog>

Greetings!

Here is the problem:

<?xml-stylesheet type="text/xsl"
href="/static/._stylesheet/example/browser_info.xsl"?>

Some browsers (like IE6) recognize "text/xsl". Some browsers (like Opera)
recognize "application/xml".  Mozilla and Firefox recognize both types.  I
suspect that if you changed "text/xsl" to "application/xml" it would work on
Opera, Konqueror, and Safari.

In general, the acceptable MIME type for xslt stylesheets is inconsistent
across browser platforms at this time.  I have found that the only
consistent, fully cross-platform solution to delivering xml-based content is
to do a server-side xslt transformation of the xml into xhtml.

Apropos to mod_python and the 'list, there are several solutions available
for performing xslt transformations within a mod_python handler.  Pyana
provides a python class wrapper for the Apache Xalan-C xslt processor, there
is a python wrapper for libxslt floating around somewhere (seen it but never
tried it), and there is a pure-python xslt processor available in
FourThought's 4Suite.  I found Pyana to be fast and stable; you can find it
on Source Forge.

(Side Note: Oddly enough, the fastest xslt processor I've tried is the
Microsoft MSXML COM object.  You'd think that all of the PyWin32 COM
overhead would really slow things down, but it doesn't seem to.  Of course,
this knowledge is of little use unless you happen to be running Apache 2.0
under WinXP.)

Best Regards,
Lee E. Brown
(administrator@leebrown.org)

-----Original Message-----
From: mod_python-bounces@modpython.org
[mailto:mod_python-bounces@modpython.org] On Behalf Of Graham Dumpleton
Sent: Wednesday, August 10, 2005 6:45 PM
To: Martin P. Hellwig
Cc: mod_python@modpython.org
Subject: Re: [mod_python] A PSP templating example with XML and XSLT

You might try it on a range of browsers. Doesn't work properly with Safari
under Mac OS Panther. Doesn't seem to detect it as XML and thus simply
strips out all the markup and displays the bits left over as a big mess.
All I did was follow the link below, so don't think I am doing anything
wrong.

On 10/08/2005, at 11:16 PM, Martin P. Hellwig wrote:

> Hello all,
>
> I only recently picked up python (as my first realer programming
> language) and made a test page with mod_python using  a own written 
> simple handler, psp templating with xml and xslt.
> There is a link to a page (right top corner) where  I describe how 
> I've done it plus all the source and directories. Maybe this is 
> interesting for people who like to have a more or less working example 
> of a mod_python site.
>
> See it at, http://xinagnet.xs4all.nl/browser_info
>
> If you have feedback on grammar, clearnes or coding please do tell me 
> (this list will do fine), thanks!
>
> --
> mph
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python

_______________________________________________
Mod_python mailing list
Mod_python@modpython.org
http://mailman.modpython.org/mailman/listinfo/mod_python

From miked at dewhirst.com.au  Wed Aug 10 23:00:45 2005
From: miked at dewhirst.com.au (Mike Dewhirst)
Date: Wed Aug 10 23:25:37 2005
Subject: [mod_python] scoping question
Message-ID: <42FABF5D.1030607@dewhirst.com.au>

I have been trying unsuccessfully to get mod_python happening and wonder 
if it is even possible given the scope / constraints in my system.

In a nutshell I cannot get Apache to load mod_python without segfaults. 
(see error_log excerpt below)

If there is a kind person who could look at this and let me know whether 
it is worthwhile pushing on I would appreciate it. These are the bits 
and pieces already installed and what I want to do ...

1.   SuSE 9.1 Linux on a Pentium 3 with 256Mb RAM and ample disk space.
2.   Apache 2.0.53-5.1 (prefork) (i586)
3.   Apache mod_python 3.1.3-37.6
4.   Apache subversion-server 1.1.3-7.1 (some bdb and some fsfs)
5.   Firebird SS 1.5.2.4731 (i686) (NPTL version)
6.   Python interpreter 2.3.3-88.9
7.   Subversion-python 1.1.3-7.1 (not using this)
8.   Samba-python 3.0.9-2.6 (dunno why - but it is installed)

Subversion is working and Apache serves its standard hello world page. 
The box is on a LAN behind NAT and accessed also externally for 
Subversion purposes. I just changed Firebird to the NPTL version so I 
wouldn't have to use KD_ASSUME_KERNEL=2.2.5 environment variable which 
was interfering with Berkeley DB being used by Subversion. Out of that 
mess I changed two repositories from Berkeley to FSFS (plain text file 
database) I have not yet change the other repositories. Everything is 
very lightly loaded. I am the heaviest user and there are only two 
others at the moment.

What I want to do is use Firebird as a backend database for some Python 
web development. At the moment I'm forced to do the dev on a Windows box 
but I want it served by the above Linux box.

Any ideas?

Thanks

Mike

<below>
# notice a clean shutdown during which python is appended to the module list
[Wed Aug 10 18:08:22 2005] [notice] caught SIGTERM, shutting down
#
# this is the startup with python in
[Wed Aug 10 18:09:58 2005] [notice] mod_python: Creating 32 session 
mutexes based on 150 max processes and 0 max threads.
[Wed Aug 10 18:10:00 2005] [notice] Apache/2.0.53 (Linux/SUSE) 
configured -- resuming normal operations
#
# can't remember exactly what I did in this three minutes but it was 
most likely that I attempted to access subversion and failed
[Wed Aug 10 18:13:02 2005] [notice] child pid 4487 exit signal 
Segmentation fault (11)
#
# another shut-down to remove python
[Wed Aug 10 18:15:45 2005] [warn] child process 4488 still did not exit, 
sending a SIGTERM
[Wed Aug 10 18:15:45 2005] [warn] child process 4489 still did not exit, 
sending a SIGTERM
[Wed Aug 10 18:15:45 2005] [warn] child process 4490 still did not exit, 
sending a SIGTERM
[Wed Aug 10 18:15:45 2005] [warn] child process 4491 still did not exit, 
sending a SIGTERM
[Wed Aug 10 18:15:45 2005] [warn] child process 5107 still did not exit, 
sending a SIGTERM
[Wed Aug 10 18:15:45 2005] [warn] child process 4488 still did not exit, 
sending a SIGTERM
[Wed Aug 10 18:15:45 2005] [warn] child process 4489 still did not exit, 
sending a SIGTERM
[Wed Aug 10 18:15:45 2005] [warn] child process 4490 still did not exit, 
sending a SIGTERM
[Wed Aug 10 18:15:45 2005] [warn] child process 4491 still did not exit, 
sending a SIGTERM
[Wed Aug 10 18:15:45 2005] [warn] child process 5107 still did not exit, 
sending a SIGTERM
[Wed Aug 10 18:15:46 2005] [warn] child process 4488 still did not exit, 
sending a SIGTERM
[Wed Aug 10 18:15:46 2005] [warn] child process 4489 still did not exit, 
sending a SIGTERM
[Wed Aug 10 18:15:46 2005] [warn] child process 4490 still did not exit, 
sending a SIGTERM
[Wed Aug 10 18:15:46 2005] [warn] child process 4491 still did not exit, 
sending a SIGTERM
[Wed Aug 10 18:15:46 2005] [warn] child process 5107 still did not exit, 
sending a SIGTERM
[Wed Aug 10 18:15:50 2005] [notice] caught SIGTERM, shutting down
#
# no python and subversion working fine
[Wed Aug 10 18:17:24 2005] [notice] Apache/2.0.53 (Linux/SUSE) 
configured -- resuming normal operations

</below>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20050811/79a20d9d/attachment.html
From grahamd at dscpl.com.au  Wed Aug 10 23:57:17 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Wed Aug 10 23:57:24 2005
Subject: [mod_python] scoping question
Message-ID: <1123732637.1848@dscpl.user.openhosting.com>

Mike Dewhirst wrote ..
> I have been trying unsuccessfully to get mod_python happening and wonder
> if it is even possible given the scope / constraints in my system.
> 
> In a nutshell I cannot get Apache to load mod_python without segfaults.
> (see error_log excerpt below)
> 
> If there is a kind person who could look at this and let me know whether
> it is worthwhile pushing on I would appreciate it. 

What mod_python are you trying to use to test it out? Are you trying to
follow the simple mptest.py example, or have you gone direct to trying
to use some complicated example which loads in all manner of extra
Python modules?

A few things to try are as follows.

1. Use procedure documented at:

  http://www.dscpl.com.au/articles/modpython-001.html

Let us know how far you get with this or whether it dies from the outset.

2. Grab latest version of mod_python from subversion repository. It includes
fixes for a few obscure problems that might conceivably cause core dumps.

  https://svn.apache.org/repos/asf/httpd/mod_python/trunk/

It also includes some better logging whereby some problems are now logged
whereas they weren't before and thus you had no idea what was going on.

3. Do you have multiple versions of Python installed on your system and
there is any chance mod_python is loading stuff from wrong version?

4. What version of expat package do you have installed? Some version can
cause core dumps. See:

  http://www.modpython.org/pipermail/mod_python/2004-December/017023.html

5. Having different packages using different versions of shared libraries can
also be a problem. This can occur with expat, but also Berkley DB shared libraries.
For examples, see:

  http://www.modpython.org/FAQ/faqw.py?req=show&file=faq02.013.htp

About all I can think of for now.

Graham
From grahamd at dscpl.com.au  Thu Aug 11 00:09:17 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Thu Aug 11 00:09:47 2005
Subject: [mod_python] scoping question
Message-ID: <1123733357.10501@dscpl.user.openhosting.com>

Graham Dumpleton wrote ..

> What mod_python are you trying to use to test it out? 

Just to clarify, I am not meaning which version, which you obviously
pointed out. What I mean to say was "What mod_python test example
code are you using to test it out?". :-)
From miked at dewhirst.com.au  Thu Aug 11 01:59:14 2005
From: miked at dewhirst.com.au (Mike Dewhirst)
Date: Thu Aug 11 01:59:28 2005
Subject: [mod_python] scoping question
In-Reply-To: <1123733357.10501@dscpl.user.openhosting.com>
References: <1123733357.10501@dscpl.user.openhosting.com>
Message-ID: <42FAE932.9000201@dewhirst.com.au>

Graham Dumpleton wrote:
> Graham Dumpleton wrote ..
> 
> 
>>What mod_python are you trying to use to test it out? 

Graham

I'm not trying anything out just yet - my problem seems to be that 
Subversion (Berkeley DB) and mod_python are incompatible in Apache. I 
know this is not a problem with mod_python because I have mod_python and 
Apache working very well in a Windows box.

The errors at the bottom of the excerpt of previous email arose when 
trying to access a subversion repository after adding mod_python to the 
list of modules Apache loads. Like this ...

# starting Apache for the first time with mod_python
[Wed Aug 10 18:09:58 2005] [notice] mod_python: Creating 32 session 
mutexes based on 150 max processes and 0 max threads.
#
# 2 seconds later Apache is up and runnning with mod_python
[Wed Aug 10 18:10:00 2005] [notice] Apache/2.0.53 (Linux/SUSE) 
configured -- resuming normal operations
#
# 3 minutes later Apache segfaults when I try to access a repositoory
[Wed Aug 10 18:13:02 2005] [notice] child pid 4487 exit signal 
Segmentation fault (11)

... then after shutting it down and removing mod_python ...

[Wed Aug 10 18:17:24 2005] [notice] Apache/2.0.53 (Linux/SUSE) 
configured -- resuming normal operations
# no errors

BTW here is my list of modules in Apache ...

# 05410 added dav, dav_svn, authz_svn
# 05724 removed last module in list - php4
# 05724 apppended then removed python - stops subversion
# APACHE_MODULES="access actions alias auth auth_dbm
# autoindex cgi dav dav_svn authz_svn dir env expires
# include log_config mime negotiation setenvif ssl userdir"
#
# 05810 try it with "fairly minimal" plus 05410
APACHE_MODULES="access alias auth autoindex dav dav_svn authz_svn dir 
log_config mime setenvif"

Thanks for looking at this Graham

Mike




> 
> 
> Just to clarify, I am not meaning which version, which you obviously
> pointed out. What I mean to say was "What mod_python test example
> code are you using to test it out?". :-)
> 
> 

From manuzhai at gmail.com  Thu Aug 11 06:47:01 2005
From: manuzhai at gmail.com (Manuzhai)
Date: Thu Aug 11 06:47:05 2005
Subject: [mod_python] Python 2.3 -> Python 2.4
Message-ID: <7eafad620508110347337b78b2@mail.gmail.com>

Hi there,

This morning, I got fed up with having to install modules in two
different site-packages dirs, so I wanted to switch over mod_python to
the installed python 2.4 instead of it using the older python 2.3 I
also have hanging around. In order to do this (I am on Gentoo) I just
re-emerged mod_python (3.1.3), then restarted apache2. Somewhat
surprisingly, I am now getting a 500 Internal Server Error (this is
with PythonDebug On) for anything having to do with mod_python (I
tried the example from the docs). Looking in the error_logs gives me
this:

[Thu Aug 11 10:44:30 2005] [error] make_obcallback: could not import
mod_python.apache.\n
ImportError: No module named mod_python.apache
ImportError: No module named mod_python.apache
ImportError: No module named mod_python.apache
[Thu Aug 11 10:44:30 2005] [error] make_obcallback: could not import
mod_python.apache.\n
ImportError: No module named mod_python.apache
[Thu Aug 11 10:44:30 2005] [error] make_obcallback: could not import
mod_python.apache.\n
[Thu Aug 11 10:44:30 2005] [error] make_obcallback: could not import
mod_python.apache.\n

But, I made sure the mod_python dir (with apache.py[co]) is in both
/usr/lib/python2.3/site-packages and /usr/lib/python2.4/site-packages
(where it should check).

Any tips on what to try next?

Regards,

Manuzhai

From azaroth at liverpool.ac.uk  Thu Aug 11 07:31:26 2005
From: azaroth at liverpool.ac.uk (Robert Sanderson)
Date: Thu Aug 11 07:31:48 2005
Subject: [mod_python] Python 2.3 -> Python 2.4
In-Reply-To: <7eafad620508110347337b78b2@mail.gmail.com>
References: <7eafad620508110347337b78b2@mail.gmail.com>
Message-ID: <Pine.GSO.4.58.0508111230000.4769@uxa.liv.ac.uk>


>This morning, I got fed up with having to install modules in two
>different site-packages dirs, so I wanted to switch over mod_python to
>the installed python 2.4 instead of it using the older python 2.3 I
>also have hanging around.
 ^^^^^^^^^^^^^^^^^^^^^^^^

Don't do that.  mod_python is easily confused as to which python to use.

Remove the older version and it should start working again.

Rob
From km at mrna.tn.nic.in  Thu Aug 11 09:29:26 2005
From: km at mrna.tn.nic.in (km)
Date: Thu Aug 11 09:24:31 2005
Subject: [mod_python] combine psp with publisher woes
Message-ID: <20050811132926.GA8596@mrna.tn.nic.in>


Hi all,
i have tried  the classic example which separates template from logic.
i am using mod_python 3.14 with apache 2.0.54

# template ->  hello.template
<html>
<h1><%= greet %></h2>
</html>

# script hello2.py 
from mod_python import apache, psp
def handler(req):
    tmpl = psp.PSP(req, filename='./hello.template')
    tmpl.run(vars = {'greet': 'world'})
    return  apache.OK
i have placed both hello2.py and hello.template in  /usr/local/apache2/htdocs/test1 dir.

my httpd.config is :

<Directory /usr/local/apache2/htdocs/test1>
SetHandler  mod_python
PythonHandler mod_python.publisher
PythonDebug On
</Directory>

when i run the script hello2.py apache bounces back with error "The requested url /test1/hello2.py was not found on the server "
i intrigued into server error logs but it said "[notice] mod_python (Re) importing module hello2 with path set to '['/usr/local/apache/htdocs/test1']'"
well, it looks like the path is correctly set but somethings wrong .. 

 i have also run this url "http://myhost/test1/hello2.py/handler" on browser but it gave me plain html from hello.template with 'greet' value set to world.

any ideas whats going wrong ? 

regards,
KM


From huzaifa at hostway.com  Thu Aug 11 14:04:39 2005
From: huzaifa at hostway.com (Huzaifa Tapal)
Date: Thu Aug 11 14:04:47 2005
Subject: [mod_python] kernel panic - Attempting to free lock with active
	waiting queue
Message-ID: <42FB9337.1050602@hostway.com>

Hello All,

I was wondering if any of you have run into any kernel panics running 
apache2 w/ mod_python 3.13 (patches applied) on kernel 2.6.12.4?  Under 
heavy load testing of approximately 520 concurrent users the server 
crashed with the message:

Kernel panic - Attempting to free lock with active waiting queue

We previously had a stock debian kernel version 2.6.08 and we had 
noticed that under a load of 36 concurrent users, sporadically, the 
server would crash immediately as the load test was started.  In the 
current case, after upgrading the kernel, the server did not crash until 
it reached the peak of 550 concurrent users.  I am currently running the 
load test again after rebootin the server and the server is handling 
requests even at 559 concurrent users so the panic is sporadic.

Anybody have any ideas?  Anybody seen anything like this before?

Hozi

From jg.lists at sympatico.ca  Thu Aug 11 14:27:46 2005
From: jg.lists at sympatico.ca (Jim Gallacher)
Date: Thu Aug 11 14:26:34 2005
Subject: [mod_python] kernel panic - Attempting to free lock with active
	waiting queue
In-Reply-To: <42FB9337.1050602@hostway.com>
References: <42FB9337.1050602@hostway.com>
Message-ID: <42FB98A2.7070501@sympatico.ca>

Huzaifa Tapal wrote:
> Hello All,
> 
> I was wondering if any of you have run into any kernel panics running 
> apache2 w/ mod_python 3.13 (patches applied) on kernel 2.6.12.4?  Under 
> heavy load testing of approximately 520 concurrent users the server 
> crashed with the message:
> 
> Kernel panic - Attempting to free lock with active waiting queue
> 
> We previously had a stock debian kernel version 2.6.08 and we had 
> noticed that under a load of 36 concurrent users, sporadically, the 
> server would crash immediately as the load test was started.  In the 
> current case, after upgrading the kernel, the server did not crash until 
> it reached the peak of 550 concurrent users.  I am currently running the 
> load test again after rebootin the server and the server is handling 
> requests even at 559 concurrent users so the panic is sporadic.
> 
> Anybody have any ideas?  Anybody seen anything like this before?

Only what google tells me. Any chance you are serving content from nfs?

Jim

From grahamd at dscpl.com.au  Thu Aug 11 17:39:09 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Thu Aug 11 17:39:38 2005
Subject: [mod_python] combine psp with publisher woes
In-Reply-To: <20050811132926.GA8596@mrna.tn.nic.in>
References: <20050811132926.GA8596@mrna.tn.nic.in>
Message-ID: <f45d1d47f8ee379d66ce808907ad111f@dscpl.com.au>


On 11/08/2005, at 11:29 PM, km wrote:

>
> Hi all,
> i have tried  the classic example which separates template from logic.
> i am using mod_python 3.14 with apache 2.0.54
>
> # template ->  hello.template
> <html>
> <h1><%= greet %></h2>
> </html>
>
> # script hello2.py
> from mod_python import apache, psp
> def handler(req):
>     tmpl = psp.PSP(req, filename='./hello.template')
>     tmpl.run(vars = {'greet': 'world'})
>     return  apache.OK
> i have placed both hello2.py and hello.template in  
> /usr/local/apache2/htdocs/test1 dir.

The above is not quite written in style required by publisher.
A publisher function to be able to automatically determine
content type needs content to be the return value of the function.
Here the PSP object writes directly to the req object. Thus use:

from mod_python import apache, psp
def handler(req):
     req.content_type = 'text/html'
     tmpl = psp.PSP(req, filename='./hello.template')
     tmpl.run(vars = {'greet': 'world'})
     return " "

and the URL:

   http://myhost/test1/hello2.py/handler

And yes I do mean to return a string containing one space. This is to
stop publisher return a 500 error if None is returned. Don't think this
problem is in latest 3.2 code though. Returning None is okay provided
there has been content previously written to req object in 3.2.

Graham

From grahamd at dscpl.com.au  Thu Aug 11 18:21:03 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Thu Aug 11 18:21:15 2005
Subject: [mod_python] combine psp with publisher woes
In-Reply-To: <f45d1d47f8ee379d66ce808907ad111f@dscpl.com.au>
References: <20050811132926.GA8596@mrna.tn.nic.in>
	<f45d1d47f8ee379d66ce808907ad111f@dscpl.com.au>
Message-ID: <657ce192cd774a7f918b20d4bf586fef@dscpl.com.au>


On 12/08/2005, at 7:39 AM, Graham Dumpleton wrote:

>
> On 11/08/2005, at 11:29 PM, km wrote:
>
>>
>> Hi all,
>> i have tried  the classic example which separates template from logic.
>> i am using mod_python 3.14 with apache 2.0.54
>>
>> # template ->  hello.template
>> <html>
>> <h1><%= greet %></h2>
>> </html>
>>
>> # script hello2.py
>> from mod_python import apache, psp
>> def handler(req):
>>     tmpl = psp.PSP(req, filename='./hello.template')
>>     tmpl.run(vars = {'greet': 'world'})
>>     return  apache.OK
>> i have placed both hello2.py and hello.template in  
>> /usr/local/apache2/htdocs/test1 dir.
>
> The above is not quite written in style required by publisher.
> A publisher function to be able to automatically determine
> content type needs content to be the return value of the function.
> Here the PSP object writes directly to the req object. Thus use:
>
> from mod_python import apache, psp
> def handler(req):
>     req.content_type = 'text/html'
>     tmpl = psp.PSP(req, filename='./hello.template')
>     tmpl.run(vars = {'greet': 'world'})
>     return " "

BTW, for determining name of template you should use something
like:

   import os
   template = os.path.splitext(__file__)[0] + '.template'

   from mod_python import apache, psp
   def handler(req):
       req.content_type = 'text/html'
       tmpl = psp.PSP(req, filename=template)
       tmpl.run(vars = {'greet': 'world'})
       return " "

Accept that you may have put "./hello.template" for illustrative
purposes only, but thought I would mention this anyway so no one
else is confused when looking at this in the mailing list archive.

:-)

Graham

From grahamd at dscpl.com.au  Fri Aug 12 01:43:21 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Fri Aug 12 01:43:24 2005
Subject: [mod_python] mod_python.publisher and MultiViews
Message-ID: <1123825401.18494@dscpl.user.openhosting.com>

Anyone who reads my followups to questions asked here would
know I tend to recommend that one avoid the use of the MultiViews
option. This is especially the case if you are using SetHandler to
create a handler which handles all requests in a directory.

All the same, use of MultiViews is still popular with people using
AddHandler and mod_python.publisher so they can avoid having to use
".py" in the URL. The best configuration that one can use is:

  AddHandler mod_python .py
  PythonHandler mod_python.publisher
  PythonDebug On

  Options +MultiViews
  MultiviewsMatch Handlers

This would then allow one to use:

  /some/path/page

instead of:

  /some/path/page.py

This though still has problems where you have non ".py" files in the
same directory which share the same basename as a ".py" file but a
different extension.

For example, if you have a file "page.psp" in the same directory, all
still works okay for the above URL.

If however you add a file "page.html" or "page.txt" into the directory,
preference is given first to the ".html" file, next the ".txt".

In other words, the a handler for a specific extension has a lower
precedence than a physical ".html" or ".txt" file, yet the handler gets
precedence over a file type with an extension.

Why this occurs is all tied up with the weighting preference for different
file types as specified by the browser. For example:

  Accept: text/html; q=1.0, text/*; q=0.8

Plus I assume some parts of the Apache configuration itself.

The problem with this is that if the ".html" file is actually mean't to be
an input to some processing done by the handler, a request is going to
pick up the raw unprocessed ".html" file instead of running it through
the handler.

Such are some of the issues with using MultiViews. The simple fix is
to not use MultiViews and use ".py" extensions in the URLs, which is
what I suggest, and all the problems go away.

I would rather like to understand how one could configure Apache to
redefine the precedence order to always ensure the handler gets
precedence. Does this make sense? Is it possible?

Note, I don't actually use mod_python.publisher myself. I am purely
trying to understand this better so I might perhaps be able to give out
better answers to people when they ask about these issues.

Graham


From grahamd at dscpl.com.au  Fri Aug 12 02:56:36 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Fri Aug 12 02:56:45 2005
Subject: [mod_python] mod_python.publisher and MultiViews
Message-ID: <1123829795.1145@dscpl.user.openhosting.com>

Yipee, found the required magic. Instead of:

>   AddHandler mod_python .py
>   PythonHandler mod_python.publisher
>   PythonDebug On
> 
>   Options +MultiViews
>   MultiviewsMatch Handlers

Extend it to use:

  AddHandler mod_python .py
  PythonHandler mod_python.publisher
  PythonDebug On

  Options +MultiViews
  MultiviewsMatch Handlers

  AddType text/html;qs=1.0 .py
  AddType text/html;qs=0.9 .html
  AddType text/plain;qs=0.8 .txt

Ie., one can use AddType to indicate that ".py" file is "text/html" and
then overridde the quality factor multiplier for other extension types
that you might have in the directory which share a common basename.
This will therefore give you more control over the content negotiation
process and allows you to direct a request for a resource without an
extension to the handler, in preference to a static file being served up.

Hope this is of use to others.

Enough of this Friday afternoon diversion. :-)

Graham
From manuzhai at gmail.com  Fri Aug 12 07:35:36 2005
From: manuzhai at gmail.com (Manuzhai)
Date: Fri Aug 12 07:35:42 2005
Subject: [mod_python] Python 2.3 -> Python 2.4
In-Reply-To: <Pine.GSO.4.58.0508111230000.4769@uxa.liv.ac.uk>
References: <7eafad620508110347337b78b2@mail.gmail.com>
	<Pine.GSO.4.58.0508111230000.4769@uxa.liv.ac.uk>
Message-ID: <7eafad6205081204355ffa0970@mail.gmail.com>

> Don't do that.  mod_python is easily confused as to which python to use.
> 
> Remove the older version and it should start working again.

Unfortunately, that doesn't help. I've removed Python 2.3, and it
still gives the same error.

Any other ideas? This really sucks.

Regards,

Manuzhai

From jg.lists at sympatico.ca  Fri Aug 12 09:40:02 2005
From: jg.lists at sympatico.ca (Jim Gallacher)
Date: Fri Aug 12 09:37:08 2005
Subject: [mod_python] Python 2.3 -> Python 2.4
In-Reply-To: <7eafad6205081204355ffa0970@mail.gmail.com>
References: <7eafad620508110347337b78b2@mail.gmail.com>	<Pine.GSO.4.58.0508111230000.4769@uxa.liv.ac.uk>
	<7eafad6205081204355ffa0970@mail.gmail.com>
Message-ID: <42FCA6B2.70604@sympatico.ca>

Manuzhai wrote:
>>Don't do that.  mod_python is easily confused as to which python to use.
>>
>>Remove the older version and it should start working again.
> 
> 
> Unfortunately, that doesn't help. I've removed Python 2.3, and it
> still gives the same error.
> 
> Any other ideas? This really sucks.
> 

I gather that Gentoo allows you to tweak the way things are compiled by 
the emerge process. You want the equivalent of:

$  ./configure --with-apxs=`which apxs` --with-python=/usr/bin/python2.4
$  make
$  make install

This works on my Debian system  (except that apxs is apxs2 for apache2) 
with both python 2.3 and 2.4 installed. The default /usr/bin/python is 2.3.

Jim
From news4mat at gmx.de  Fri Aug 12 11:30:31 2005
From: news4mat at gmx.de (M. R.)
Date: Fri Aug 12 11:17:37 2005
Subject: [mod_python] tutorials on mod_python
Message-ID: <200508121730.31510.news4mat@gmx.de>

Hi, 

I'm quite new to python and absolutely to mod_python.
I've already read the tutorial on the mod_python site.
Does anyone know some more tutorials with topics like database connectivity 
and file uploading, etc, ... ?

That would be great.

Thank you, 

Matthias
From jwm-modpython at sentinelchicken.net  Fri Aug 12 11:43:47 2005
From: jwm-modpython at sentinelchicken.net (Jason Morgan)
Date: Fri Aug 12 11:47:52 2005
Subject: [mod_python] tutorials on mod_python
In-Reply-To: <200508121730.31510.news4mat@gmx.de>
References: <200508121730.31510.news4mat@gmx.de>
Message-ID: <20050812154347.GA2815@sentinelchicken.net>

On Fri, Aug 12, 2005 at 05:30:31PM +0200, M. R. wrote:
> Hi, 
> 
> I'm quite new to python and absolutely to mod_python.
> I've already read the tutorial on the mod_python site.
> Does anyone know some more tutorials with topics like database connectivity 
> and file uploading, etc, ... ?
> 
> That would be great.
> 

I would take a look at the docs regarding the various web-related 
modules available on the python site. The cgi modules is especially 
helpful and will help you with mod_python.

http://python.org/doc/2.4.1/lib/module-cgi.html

For database access, what database system are you using? For MySQL, see 
the MySQLdb module. But the API is similar for other database modules.

http://python.org/topics/database/

In general, the python.org site will be your best resource.

Cheers,
Jason
From huzaifa at hostway.com  Fri Aug 12 17:47:12 2005
From: huzaifa at hostway.com (Huzaifa Tapal)
Date: Fri Aug 12 17:47:24 2005
Subject: [mod_python] kernel panic - Attempting to free lock with active
	waiting queue
In-Reply-To: <42FB98A2.7070501@sympatico.ca>
References: <42FB9337.1050602@hostway.com> <42FB98A2.7070501@sympatico.ca>
Message-ID: <42FD18E0.5060400@hostway.com>

No, no content was being served from ns, however, our sys dev team here 
did some investigation and here is what the found:

in mod_python.c for the  apr_status_t init_mutexes() method which I 
believe gets called for the Memory Session management, apache's 
apr_global_mutex_create() locking mechanism is being used to lock a file 
on the filesystem in cases of a mulit-process and multi-threaded apache 
configuration to share the session between different child processes.  
Apache's  apr_status_t init_mutexes() method is covered with flock() the 
handling of which in the debian kernel 2.6.12.4 has a bug under severe 
cases.

In our testing, under a very, very heavy load of over 800 concurrent 
connections using a jython-based tool called grinder, a race condiditon 
is happening at which point the kernel is panicking.  The solution to 
this problem as we see it is to either change apache's  apr_status_t 
init_mutexes() method ot use fnctl lock instead of flocks, or run apache 
with only one process at all times.

In the meantime, we are going to still moderately load test our cluster 
through out the weekend and see if we can replicate the panic under a 
moderate load but a long duration of time.

Hozi

Jim Gallacher wrote:

> Huzaifa Tapal wrote:
>
>> Hello All,
>>
>> I was wondering if any of you have run into any kernel panics running 
>> apache2 w/ mod_python 3.13 (patches applied) on kernel 2.6.12.4?  
>> Under heavy load testing of approximately 520 concurrent users the 
>> server crashed with the message:
>>
>> Kernel panic - Attempting to free lock with active waiting queue
>>
>> We previously had a stock debian kernel version 2.6.08 and we had 
>> noticed that under a load of 36 concurrent users, sporadically, the 
>> server would crash immediately as the load test was started.  In the 
>> current case, after upgrading the kernel, the server did not crash 
>> until it reached the peak of 550 concurrent users.  I am currently 
>> running the load test again after rebootin the server and the server 
>> is handling requests even at 559 concurrent users so the panic is 
>> sporadic.
>>
>> Anybody have any ideas?  Anybody seen anything like this before?
>
>
> Only what google tells me. Any chance you are serving content from nfs?
>
> Jim
>
>

From mhellwig at xs4all.nl  Sat Aug 13 07:17:06 2005
From: mhellwig at xs4all.nl (Martin P. Hellwig)
Date: Sat Aug 13 07:19:02 2005
Subject: [mod_python] A PSP templating example with XML and XSLT
In-Reply-To: <ACFA8C097B8A@underdog>
References: <ACFA8C097B8A@underdog>
Message-ID: <42FDD6B2.4070308@xs4all.nl>

Hi all,

Lee Brown wrote:

>Greetings!
>
>Here is the problem:
>
><?xml-stylesheet type="text/xsl"
>href="/static/._stylesheet/example/browser_info.xsl"?>
>
>Some browsers (like IE6) recognize "text/xsl". Some browsers (like Opera)
>recognize "application/xml".  Mozilla and Firefox recognize both types.  I
>suspect that if you changed "text/xsl" to "application/xml" it would work on
>Opera, Konqueror, and Safari.
>  
>
I took a look at it but it seems that (for now) khtml & opera do not 
support xsl transformation, no matter what I put in the headers.
I primarily test it with gecko based browsers ( firefox & mozilla) and 
IE, both work. I could built in legacy support but I am not going to do 
that, those lazy browser-bastards should do the transformation :-).
I'm only partial kidding, my primary focus for this test is to use the 
technique in the network I administrate so I can be bold and say that I 
only support xsl compliant browsers.
And to be honest as long as the technique I use are w3c recommend and 
Firefox renders the page adequate, I'm not going to put in more effort, 
xsl for crying out loud is a standard since November 1999 that is almost 
_6_ years ago.
However it works on the browser with the biggest market share and on a 
cross-platform browser, that's not too bad.

Thanks again for taking the effort to look at it and reply! I really do 
appreciate it allot!

-- 
mph

From news4mat at gmx.de  Sat Aug 13 09:45:23 2005
From: news4mat at gmx.de (M. R.)
Date: Sat Aug 13 09:31:39 2005
Subject: [mod_python] tutorials on mod_python
In-Reply-To: <20050812154347.GA2815@sentinelchicken.net>
References: <200508121730.31510.news4mat@gmx.de>
	<20050812154347.GA2815@sentinelchicken.net>
Message-ID: <200508131545.23404.news4mat@gmx.de>

Thank you for your suggestion.
The python site is indeed very helpful.

Matthias.




Am Freitag, 12. August 2005 17:43 schrieb Jason Morgan:
> On Fri, Aug 12, 2005 at 05:30:31PM +0200, M. R. wrote:
> > Hi,
> >
> > I'm quite new to python and absolutely to mod_python.
> > I've already read the tutorial on the mod_python site.
> > Does anyone know some more tutorials with topics like database
> > connectivity and file uploading, etc, ... ?
> >
> > That would be great.
>
> I would take a look at the docs regarding the various web-related
> modules available on the python site. The cgi modules is especially
> helpful and will help you with mod_python.
>
> http://python.org/doc/2.4.1/lib/module-cgi.html
>
> For database access, what database system are you using? For MySQL, see
> the MySQLdb module. But the API is similar for other database modules.
>
> http://python.org/topics/database/
>
> In general, the python.org site will be your best resource.
>
> Cheers,
> Jason
From jg.lists at sympatico.ca  Sat Aug 13 11:05:02 2005
From: jg.lists at sympatico.ca (Jim Gallacher)
Date: Sat Aug 13 10:57:09 2005
Subject: [mod_python] kernel panic - Attempting to free lock with active
	waiting queue
In-Reply-To: <42FD18E0.5060400@hostway.com>
References: <42FB9337.1050602@hostway.com> <42FB98A2.7070501@sympatico.ca>
	<42FD18E0.5060400@hostway.com>
Message-ID: <42FE0C1E.7040507@sympatico.ca>

Huzaifa Tapal wrote:
> No, no content was being served from ns, however, our sys dev team here 
> did some investigation and here is what the found:
> 
> in mod_python.c for the  apr_status_t init_mutexes() method which I 
> believe gets called for the Memory Session management, apache's 
> apr_global_mutex_create() locking mechanism is being used to lock a file 
> on the filesystem in cases of a mulit-process and multi-threaded apache 
> configuration to share the session between different child processes.  
> Apache's  apr_status_t init_mutexes() method is covered with flock() the 
> handling of which in the debian kernel 2.6.12.4 has a bug under severe 
> cases.
> 
> In our testing, under a very, very heavy load of over 800 concurrent 
> connections using a jython-based tool called grinder, a race condiditon 
> is happening at which point the kernel is panicking.  The solution to 
> this problem as we see it is to either change apache's  apr_status_t 
> init_mutexes() method ot use fnctl lock instead of flocks, or run apache 
> with only one process at all times.
> 
> In the meantime, we are going to still moderately load test our cluster 
> through out the weekend and see if we can replicate the panic under a 
> moderate load but a long duration of time.

Are you using sessions in your test handler? If so I've got some ideas I 
can share, but I don't want to confuse the issue if you are not actually 
using sessions.

The short answer is that init_mutexes() does indeed allocate mutexes for 
session locking support.

Jim
From jgentil at sebistar.net  Mon Aug 15 11:19:16 2005
From: jgentil at sebistar.net (Jon-Pierre Gentil)
Date: Mon Aug 15 11:19:46 2005
Subject: [mod_python] A PSP templating example with XML and XSLT
In-Reply-To: <42FDD6B2.4070308@xs4all.nl>
References: <ACFA8C097B8A@underdog> <42FDD6B2.4070308@xs4all.nl>
Message-ID: <200508151019.22933.jgentil@sebistar.net>

On Saturday 13 August 2005 06:17 am, Martin P. Hellwig wrote:

> >Some browsers (like IE6) recognize "text/xsl". Some browsers (like
> > Opera) recognize "application/xml".  Mozilla and Firefox recognize
> > both types.  I suspect that if you changed "text/xsl" to
> > "application/xml" it would work on Opera, Konqueror, and Safari.
>
> I took a look at it but it seems that (for now) khtml & opera do not
> support xsl transformation, no matter what I put in the headers.

I use a similar architecture as you, but I always output HTML in the end, 
using libxslt to render the output as the very last stage.  Perhaps that 
would help you?  It's a bit more server-side intensive but allows for 
clients to be more diverse.  A nice side-effect is that it always 
produces valid HTML :-)

-- 
_________________________________________________________

  Jon-Pierre Gentil               PGP: 0x7E1CBA17
  jabber: jgentil@sebistar.net    web: www.sebistar.net
  "If you think education is expensive, try ignorance."
_________________________________________________________ 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 827 bytes
Desc: not available
Url : http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20050815/894b722e/attachment.bin
From huzaifa at hostway.com  Mon Aug 15 12:21:40 2005
From: huzaifa at hostway.com (Huzaifa Tapal)
Date: Mon Aug 15 12:21:47 2005
Subject: [mod_python] kernel panic - Attempting to free lock with active
	waiting queue
In-Reply-To: <42FE0C1E.7040507@sympatico.ca>
References: <42FB9337.1050602@hostway.com> <42FB98A2.7070501@sympatico.ca>
	<42FD18E0.5060400@hostway.com> <42FE0C1E.7040507@sympatico.ca>
Message-ID: <4300C114.8040301@hostway.com>

I am not using mod_python Session management in my handler. 

Huzaifa

Jim Gallacher wrote:

> Huzaifa Tapal wrote:
>
>> No, no content was being served from ns, however, our sys dev team 
>> here did some investigation and here is what the found:
>>
>> in mod_python.c for the  apr_status_t init_mutexes() method which I 
>> believe gets called for the Memory Session management, apache's 
>> apr_global_mutex_create() locking mechanism is being used to lock a 
>> file on the filesystem in cases of a mulit-process and multi-threaded 
>> apache configuration to share the session between different child 
>> processes.  Apache's  apr_status_t init_mutexes() method is covered 
>> with flock() the handling of which in the debian kernel 2.6.12.4 has 
>> a bug under severe cases.
>>
>> In our testing, under a very, very heavy load of over 800 concurrent 
>> connections using a jython-based tool called grinder, a race 
>> condiditon is happening at which point the kernel is panicking.  The 
>> solution to this problem as we see it is to either change apache's  
>> apr_status_t init_mutexes() method ot use fnctl lock instead of 
>> flocks, or run apache with only one process at all times.
>>
>> In the meantime, we are going to still moderately load test our 
>> cluster through out the weekend and see if we can replicate the panic 
>> under a moderate load but a long duration of time.
>
>
> Are you using sessions in your test handler? If so I've got some ideas 
> I can share, but I don't want to confuse the issue if you are not 
> actually using sessions.
>
> The short answer is that init_mutexes() does indeed allocate mutexes 
> for session locking support.
>
> Jim
>
>

From jg.lists at sympatico.ca  Mon Aug 15 17:55:10 2005
From: jg.lists at sympatico.ca (Jim Gallacher)
Date: Mon Aug 15 17:53:48 2005
Subject: [mod_python] kernel panic - Attempting to free lock with active
	waiting queue
In-Reply-To: <4300C114.8040301@hostway.com>
References: <42FB9337.1050602@hostway.com>
	<42FB98A2.7070501@sympatico.ca>	<42FD18E0.5060400@hostway.com>
	<42FE0C1E.7040507@sympatico.ca> <4300C114.8040301@hostway.com>
Message-ID: <43010F3E.7090603@sympatico.ca>

Huzaifa Tapal wrote:
> I am not using mod_python Session management in my handler.
> Huzaifa

I don't think that your problems are related to init_mutexes then. The 
mutexes are used for 3 things: locking session objects, locking the dbm
file used for storing session data (in the case of DbmSession), and 
locking the dbm file used as the psp cache. Oh, I guess I didn't ask you 
that: are you using psp?

I may be wrong, but I don't see how just initializing the mutexes at 
mod_python startup could be exercising the bug in the 2.6.12 kernel. You 
could always try compiling with MAX_LOCKS=2 (defined in 
src/include/mod_python.h) and see what happens, but I would be suprised 
if it made a difference. Heck you could even try MAX_LOCKS=0, but I'm 
not sure what might happen there. I'm pretty sure if you do call 
_apache._global_lock() with MAX_LOCKS=0 you'll seg fault as I don't 
thing we check to see if glb->nlocks==0. Please note that in version 3.2 
you will be able to specify MAX_LOCKS using configure 
--with-max-locks=<some integer>.

Jim



> Jim Gallacher wrote:
> 
>> Huzaifa Tapal wrote:
>>
>>> No, no content was being served from ns, however, our sys dev team 
>>> here did some investigation and here is what the found:
>>>
>>> in mod_python.c for the  apr_status_t init_mutexes() method which I 
>>> believe gets called for the Memory Session management, apache's 
>>> apr_global_mutex_create() locking mechanism is being used to lock a 
>>> file on the filesystem in cases of a mulit-process and multi-threaded 
>>> apache configuration to share the session between different child 
>>> processes.  Apache's  apr_status_t init_mutexes() method is covered 
>>> with flock() the handling of which in the debian kernel 2.6.12.4 has 
>>> a bug under severe cases.
>>>
>>> In our testing, under a very, very heavy load of over 800 concurrent 
>>> connections using a jython-based tool called grinder, a race 
>>> condiditon is happening at which point the kernel is panicking.  The 
>>> solution to this problem as we see it is to either change apache's  
>>> apr_status_t init_mutexes() method ot use fnctl lock instead of 
>>> flocks, or run apache with only one process at all times.
>>>
>>> In the meantime, we are going to still moderately load test our 
>>> cluster through out the weekend and see if we can replicate the panic 
>>> under a moderate load but a long duration of time.
>>
>>
>>
>> Are you using sessions in your test handler? If so I've got some ideas 
>> I can share, but I don't want to confuse the issue if you are not 
>> actually using sessions.
>>
>> The short answer is that init_mutexes() does indeed allocate mutexes 
>> for session locking support.
>>
>> Jim
>>
>>
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
> 

From manjeet at infogridpacific.com  Tue Aug 16 06:23:39 2005
From: manjeet at infogridpacific.com (Manjeet Chaudhary)
Date: Tue Aug 16 06:24:28 2005
Subject: [mod_python] Problem in executing java program using mod_python.
Message-ID: <4301BEAB.8030501@infogridpacific.com>

Hello All

I am using mod_python and Lucene for searching of Arabic Text from an 
Index created using Lucene+Java.
I am facing some problems in running "java" command using mod_python.

1.   I am trying to run java program using "os.system" command.
    Check = os.system("java ..........")

2.   The command returns me a value of 256.
    i.e Check = 256

3.   I am not able to figure it out why that java program is not being 
executed properly.

4.   For the java program i have set the classpath and compiling and 
running that program using the classpath.

    export CLASSPATH = 
/home/ajinkyan/cgi-bin/infoviewer/Jar_Files/lucene-1.4.3.jar 
:/home/ajinkyan/cgi-bin/infoviewer/Jar_Files/PDFBox-0.6.7a.jar 
:/home/ajinkyan/cgi-bin/infoviewer/Jar_Files/log4j-1.2.8.jar 
:/home/ajinkyan/cgi-bin/infoviewer/Jar_Files/tm-extractors-0.4.jar 
:/home/ajinkyan/cgi-bin/infoviewer/Jar_Files/ArabicAnalyzer-1.0b.jar 
:/home/ajinkyan/cgi-bin/infoviewer/Jar_Files/commons-collections-3.1.jar

    javac -classpath $CLASSPATH:. SearchFiles.java

    java -classpath $ClASSPATH:. SearchFiles

5.   SearchFiles program is running properly if i run it from shell.

So please help me and tell where i am going wrong.
I have attached the copy of code at the end .

Thank you
Manjeet Chaudhary



#!/usr/bin/env python
"""
#-------------------------------------------------------------------------------------------------------
#Name:       ar_search.py
#Version:    1.0
#Purpose:    Searching for Infoviewer
#Author:     Alok Khandelwal
#Created:    10-08-2005
#Licence:    Infogrid Pacific EULA
#--------------------------------------------------------------------------------------------------------
#Revision History
#--------------------------------------------------------------------------------------------------------

#----------------Different modules required are imported 
here-------------------
"""
import cgitb,cgi,sys
cgitb.enable()
import os
from os.path import join, abspath
from mod_python import apache,util,Session
"""
#----------------End of importing 
modules----------------------------------------


def search(req):

    """This part takes Arabic keyword from req variable and write that 
keyword into a temp file. This temp file will be opened by java program 
and that program will take that value and search for the variable in the 
index file.
Java program will store the result in results.txt file"""

    The_Form = util.FieldStorage(req)
    for name in The_Form.keys():
        #--------Checking for the selected Fields and turning those flag 
on--------
        if name == 'search_contents':
            value=The_Form[name]
            value.encode('utf-8')
            f=open("/home/ajinkyan/cgi-bin/infoviewer/temp.txt","w")
            f.write(value)
            f.close()

            try:
                command = "export 
CLASSPATH=/home/ajinkyan/cgi-bin/infoviewer/Jar_Files/lucene-1.4.3.jar:/home/ajinkyan/cgi-bin/infoviewer/Jar_Files/PDFBox-0.6.7a.jar:/home/ajinkyan/cgi-bin/infoviewer/Jar_Files/log4j-1.2.8.jar:/home/ajinkyan/cgi-bin/infoviewer/Jar_Files/tm-extractors-0.4.jar:/home/ajinkyan/cgi-bin/infoviewer/Jar_Files/ArabicAnalyzer-1.0b.jar:/home/ajinkyan/cgi-bin/infoviewer/Jar_Files/commons-collections-3.1.jar"
                import os
                os.system(command)
                command = "java -classpath 
$CLASSPATH:/home/ajinkyan/cgi-bin/infoviewer SearchFiles"
                check=os.system(command)
                req.write("\ncheck = " + str(check))
                f  = open(  
"/home/ajinkyan/cgi-bin/infoviewer/results.txt","r")
                result=f.read()
                req.write(result)
            except:

                req.write("\n")
                req.write(str(sys.exc_type))
                req.write("\n")
                req.write(str(sys.exc_value))



____________________________________________________________________________________________________________________________

# After executing the os.system command the value returned in check is 
maximum times 256 or some thing near 32000 .

# Java program is running independently without any errors. Only when it 
is called using os.system it doesn't run .

# The Java program is as follows

___________________________________________________________________________________________________________________________


/**
* @Name   : SearchFiles.java
* @Version: 1.0
* @Author : Alok Khandelwal
* @Created: 2 August 2005
* @Purpose: Searching in index for arabic contents
* @Copyright:(c)2004 by Infogrid Pacific Pte. Ltd.
* @Licenece :Infogrid Pacific Eula
*/




import org.apache.lucene.search.Searcher;
import org.apache.lucene.search.IndexSearcher;
import org.apache.lucene.search.Query;
import org.apache.lucene.search.Hits;
import org.apache.lucene.queryParser.QueryParser;
import gpl.pierrick.brihaye.aramorph.lucene.ArabicStemAnalyzer;
import java.io.*;
import org.apache.lucene.document.Document;
class SearchFiles
{
    public static void main(String[] args)
    {
        try
        {
            FileInputStream fis = new FileInputStream(new File ( 
"/home/ajinkyan/cgi-bin/infoviewer/temp.txt"));
            BufferedReader in = new BufferedReader(new 
InputStreamReader(fis,"UTF8"));
            char [] buf = new char[80];
            int numRead;
            numRead=in.read(buf,0,80);
            String field="\"";
            for(int k=0;k<numRead;k++)
            {
                field=field+buf[k];
            }
            field=field+"\"";
            FileOutputStream fos = new FileOutputStream(new File ( 
"/home/ajinkyan/cgi-bin/infoviewer/results.txt"));
            BufferedWriter out = new BufferedWriter(new 
OutputStreamWriter(fos,"UTF8"));
            Searcher searcher = new 
IndexSearcher("/home/ajinkyan/cgi-bin/infoviewer/index_arabic");
            try
            {
                    Query query = QueryParser.parse(field, "contents", 
new ArabicStemAnalyzer());
                    Hits hits = searcher.search(query);
                    String output="Total match document = \n";
                    for(int j=0;j<hits.length();j++)
                    {
                        Document doc = hits.doc(j);
                    //    System.out.print(hits.score(j)+"  ");
                        output = output +"\n"+ doc.get("filename");
                    }
                    out.write(output);
                    out.write("\n");
            }
            catch(Exception e)
            {
                out.write("Parser Error");
                out.write("\n");

            }
            searcher.close();
            out.close();
        }
        catch (Exception e)
        {
            String s= " caught a " + e.getClass() +
             "\n with message: " + e.getMessage();
        }
    }//end of main
}//end of SerchFiles
From manjeet at infogridpacific.com  Tue Aug 16 06:24:02 2005
From: manjeet at infogridpacific.com (Manjeet Chaudhary)
Date: Tue Aug 16 06:24:35 2005
Subject: [mod_python] Segmentation fault with mod_python and DBXML
Message-ID: <4301BEC2.5030802@infogridpacific.com>

Hello All,

Sorry if the mail got duplicated.
I am developing a web based application; based on Apache, mod_python, 
dbxml and python programming; When i try to import dbxml module( to 
perform various dbxml operations ) from mod-python handler and give a 
url request to mod-python handler i am getting an error of Segmentation 
Fault in apache error log .
I am using following versions of software
1) dbxml -  2.1.8
2) python - 2.3.4
3) mod-python - 1.3.4
4) apache 2.0.52
5) Kernel version-2.6.9-5.0.5-EL

I think the error occurs at the time when i am creating the XmlManager 
instance in dbxml module.
I am using Publisher Handler of mod-python.

Apache error log (/var/log/httpd/error_log)

[Tue Aug 16 10:17:43 2005] [notice] mod_python: (Re)importing module 
'mod_python.publisher'
[Tue Aug 16 10:17:43 2005] [notice] mod_python: (Re)importing module 'x' 
with path set to '['/var/www/cgi-bin/sw']'
[Tue Aug 16 10:17:44 2005] [notice] child pid 3238 exit signal 
Segmentation fault (11)

Please let me know is there any solution to this problem .
It is very urgent.
Thanks in advance.
Regards,

Manjeet Chaudhary
From grahamd at dscpl.com.au  Tue Aug 16 06:38:43 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Tue Aug 16 06:39:09 2005
Subject: [mod_python] Segmentation fault with mod_python and DBXML
In-Reply-To: <4301BEC2.5030802@infogridpacific.com>
References: <4301BEC2.5030802@infogridpacific.com>
Message-ID: <4780d21c16890ae865494ebcd42eb65b@dscpl.com.au>

Python has a version of expat builtin to it. The version of this
most likely differs to a version of expat used as a shared library
by some other module linked into Apache.

Work out what version of expat library is installed on your system,
you may have to update it.

    
http://www.modpython.org/pipermail/mod_python/2004-December/017023.html

These mismatches in shared library versions required by different
modules can occur in other situations as well. See:

    
http://www.modpython.org/FAQ/faqw.py? 
query=expat&querytype=simple&casefold=yes&req=search

On 16/08/2005, at 8:24 PM, Manjeet Chaudhary wrote:

> Hello All,
>
> Sorry if the mail got duplicated.
> I am developing a web based application; based on Apache, mod_python,  
> dbxml and python programming; When i try to import dbxml module( to  
> perform various dbxml operations ) from mod-python handler and give a  
> url request to mod-python handler i am getting an error of  
> Segmentation Fault in apache error log .
> I am using following versions of software
> 1) dbxml -  2.1.8
> 2) python - 2.3.4
> 3) mod-python - 1.3.4
> 4) apache 2.0.52
> 5) Kernel version-2.6.9-5.0.5-EL
>
> I think the error occurs at the time when i am creating the XmlManager  
> instance in dbxml module.
> I am using Publisher Handler of mod-python.
>
> Apache error log (/var/log/httpd/error_log)
>
> [Tue Aug 16 10:17:43 2005] [notice] mod_python: (Re)importing module  
> 'mod_python.publisher'
> [Tue Aug 16 10:17:43 2005] [notice] mod_python: (Re)importing module  
> 'x' with path set to '['/var/www/cgi-bin/sw']'
> [Tue Aug 16 10:17:44 2005] [notice] child pid 3238 exit signal  
> Segmentation fault (11)
>
> Please let me know is there any solution to this problem .
> It is very urgent.
> Thanks in advance.
> Regards,
>
> Manjeet Chaudhary
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python

From grahamd at dscpl.com.au  Tue Aug 16 06:45:32 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Tue Aug 16 06:46:23 2005
Subject: [mod_python] Problem in executing java program using mod_python.
In-Reply-To: <4301BEAB.8030501@infogridpacific.com>
References: <4301BEAB.8030501@infogridpacific.com>
Message-ID: <f8f6e901e39923aa90ec1b0bdc1df37d@dscpl.com.au>


On 16/08/2005, at 8:23 PM, Manjeet Chaudhary wrote:
>                command = "export  
> CLASSPATH=/home/ajinkyan/cgi-bin/infoviewer/Jar_Files/lucene 
> -1.4.3.jar:/home/ajinkyan/cgi-bin/infoviewer/Jar_Files/PDFBox 
> -0.6.7a.jar:/home/ajinkyan/cgi-bin/infoviewer/Jar_Files/log4j 
> -1.2.8.jar:/home/ajinkyan/cgi-bin/infoviewer/Jar_Files/tm-extractors 
> -0.4.jar:/home/ajinkyan/cgi-bin/infoviewer/Jar_Files/ArabicAnalyzer 
> -1.0b.jar:/home/ajinkyan/cgi-bin/infoviewer/Jar_Files/commons- 
> collections-3.1.jar"
>                import os
>                os.system(command)
>                command = "java -classpath  
> $CLASSPATH:/home/ajinkyan/cgi-bin/infoviewer SearchFiles"
>                check=os.system(command)

That will not work.

The shell invoked by each call of os.system() is independent. Exporting
environment variables in one os.system() call does not make them
visible in a subsequence os.system() call.

Try the following instead:

                command =  
"CLASSPATH=/home/ajinkyan/cgi-bin/infoviewer/Jar_Files/lucene 
-1.4.3.jar:/home/ajinkyan/cgi-bin/infoviewer/Jar_Files/PDFBox 
-0.6.7a.jar:/home/ajinkyan/cgi-bin/infoviewer/Jar_Files/log4j 
-1.2.8.jar:/home/ajinkyan/cgi-bin/infoviewer/Jar_Files/tm-extractors 
-0.4.jar:/home/ajinkyan/cgi-bin/infoviewer/Jar_Files/ArabicAnalyzer 
-1.0b.jar:/home/ajinkyan/cgi-bin/infoviewer/Jar_Files/commons- 
collections-3.1.jar java -classpath  
$CLASSPATH:/home/ajinkyan/cgi-bin/infoviewer SearchFiles"
                check=os.system(command)

Or better still:

                 
os.putenv("CLASSPATH","/home/ajinkyan/cgi-bin/infoviewer/Jar_Files/ 
lucene-1.4.3.jar:/home/ajinkyan/cgi-bin/infoviewer/Jar_Files/PDFBox 
-0.6.7a.jar:/home/ajinkyan/cgi-bin/infoviewer/Jar_Files/log4j 
-1.2.8.jar:/home/ajinkyan/cgi-bin/infoviewer/Jar_Files/tm-extractors 
-0.4.jar:/home/ajinkyan/cgi-bin/infoviewer/Jar_Files/ArabicAnalyzer 
-1.0b.jar:/home/ajinkyan/cgi-bin/infoviewer/Jar_Files/commons- 
collections-3.1.jar")
                command = "java -classpath  
$CLASSPATH:/home/ajinkyan/cgi-bin/infoviewer SearchFiles"
                check=os.system(command)

Note that the current working directory of the process when os.system()  
is
run is probably "/" and the PATH will not necessarily be useful. You may
therefore have to give the explicit path to the "java" program.

Graham

From jcigar at ulb.ac.be  Tue Aug 16 07:11:48 2005
From: jcigar at ulb.ac.be (Julien)
Date: Tue Aug 16 07:11:28 2005
Subject: [mod_python] Problem in executing java program using mod_python.
In-Reply-To: <4301BEAB.8030501@infogridpacific.com>
References: <4301BEAB.8030501@infogridpacific.com>
Message-ID: <1124190708.24469.0.camel@horologium>

Why not using PyLucene ? http://pylucene.osafoundation.org/

It's a SWIG python port of Java Lucene, and it works perfeclty with
mod_python (we use it every day here at work)

On Tue, 2005-08-16 at 15:53 +0530, Manjeet Chaudhary wrote:
> Hello All
> 
> I am using mod_python and Lucene for searching of Arabic Text from an 
> Index created using Lucene+Java.
> I am facing some problems in running "java" command using mod_python.
> 
> 1.   I am trying to run java program using "os.system" command.
>     Check = os.system("java ..........")
> 
> 2.   The command returns me a value of 256.
>     i.e Check = 256
> 
> 3.   I am not able to figure it out why that java program is not being 
> executed properly.
> 
> 4.   For the java program i have set the classpath and compiling and 
> running that program using the classpath.
> 
>     export CLASSPATH = 
> /home/ajinkyan/cgi-bin/infoviewer/Jar_Files/lucene-1.4.3.jar 
> :/home/ajinkyan/cgi-bin/infoviewer/Jar_Files/PDFBox-0.6.7a.jar 
> :/home/ajinkyan/cgi-bin/infoviewer/Jar_Files/log4j-1.2.8.jar 
> :/home/ajinkyan/cgi-bin/infoviewer/Jar_Files/tm-extractors-0.4.jar 
> :/home/ajinkyan/cgi-bin/infoviewer/Jar_Files/ArabicAnalyzer-1.0b.jar 
> :/home/ajinkyan/cgi-bin/infoviewer/Jar_Files/commons-collections-3.1.jar
> 
>     javac -classpath $CLASSPATH:. SearchFiles.java
> 
>     java -classpath $ClASSPATH:. SearchFiles
> 
> 5.   SearchFiles program is running properly if i run it from shell.
> 
> So please help me and tell where i am going wrong.
> I have attached the copy of code at the end .
> 
> Thank you
> Manjeet Chaudhary
> 
> 
> 
> #!/usr/bin/env python
> """
> #-------------------------------------------------------------------------------------------------------
> #Name:       ar_search.py
> #Version:    1.0
> #Purpose:    Searching for Infoviewer
> #Author:     Alok Khandelwal
> #Created:    10-08-2005
> #Licence:    Infogrid Pacific EULA
> #--------------------------------------------------------------------------------------------------------
> #Revision History
> #--------------------------------------------------------------------------------------------------------
> 
> #----------------Different modules required are imported 
> here-------------------
> """
> import cgitb,cgi,sys
> cgitb.enable()
> import os
> from os.path import join, abspath
> from mod_python import apache,util,Session
> """
> #----------------End of importing 
> modules----------------------------------------
> 
> 
> def search(req):
> 
>     """This part takes Arabic keyword from req variable and write that 
> keyword into a temp file. This temp file will be opened by java program 
> and that program will take that value and search for the variable in the 
> index file.
> Java program will store the result in results.txt file"""
> 
>     The_Form = util.FieldStorage(req)
>     for name in The_Form.keys():
>         #--------Checking for the selected Fields and turning those flag 
> on--------
>         if name == 'search_contents':
>             value=The_Form[name]
>             value.encode('utf-8')
>             f=open("/home/ajinkyan/cgi-bin/infoviewer/temp.txt","w")
>             f.write(value)
>             f.close()
> 
>             try:
>                 command = "export 
> CLASSPATH=/home/ajinkyan/cgi-bin/infoviewer/Jar_Files/lucene-1.4.3.jar:/home/ajinkyan/cgi-bin/infoviewer/Jar_Files/PDFBox-0.6.7a.jar:/home/ajinkyan/cgi-bin/infoviewer/Jar_Files/log4j-1.2.8.jar:/home/ajinkyan/cgi-bin/infoviewer/Jar_Files/tm-extractors-0.4.jar:/home/ajinkyan/cgi-bin/infoviewer/Jar_Files/ArabicAnalyzer-1.0b.jar:/home/ajinkyan/cgi-bin/infoviewer/Jar_Files/commons-collections-3.1.jar"
>                 import os
>                 os.system(command)
>                 command = "java -classpath 
> $CLASSPATH:/home/ajinkyan/cgi-bin/infoviewer SearchFiles"
>                 check=os.system(command)
>                 req.write("\ncheck = " + str(check))
>                 f  = open(  
> "/home/ajinkyan/cgi-bin/infoviewer/results.txt","r")
>                 result=f.read()
>                 req.write(result)
>             except:
> 
>                 req.write("\n")
>                 req.write(str(sys.exc_type))
>                 req.write("\n")
>                 req.write(str(sys.exc_value))
> 
> 
> 
> ____________________________________________________________________________________________________________________________
> 
> # After executing the os.system command the value returned in check is 
> maximum times 256 or some thing near 32000 .
> 
> # Java program is running independently without any errors. Only when it 
> is called using os.system it doesn't run .
> 
> # The Java program is as follows
> 
> ___________________________________________________________________________________________________________________________
> 
> 
> /**
> * @Name   : SearchFiles.java
> * @Version: 1.0
> * @Author : Alok Khandelwal
> * @Created: 2 August 2005
> * @Purpose: Searching in index for arabic contents
> * @Copyright:(c)2004 by Infogrid Pacific Pte. Ltd.
> * @Licenece :Infogrid Pacific Eula
> */
> 
> 
> 
> 
> import org.apache.lucene.search.Searcher;
> import org.apache.lucene.search.IndexSearcher;
> import org.apache.lucene.search.Query;
> import org.apache.lucene.search.Hits;
> import org.apache.lucene.queryParser.QueryParser;
> import gpl.pierrick.brihaye.aramorph.lucene.ArabicStemAnalyzer;
> import java.io.*;
> import org.apache.lucene.document.Document;
> class SearchFiles
> {
>     public static void main(String[] args)
>     {
>         try
>         {
>             FileInputStream fis = new FileInputStream(new File ( 
> "/home/ajinkyan/cgi-bin/infoviewer/temp.txt"));
>             BufferedReader in = new BufferedReader(new 
> InputStreamReader(fis,"UTF8"));
>             char [] buf = new char[80];
>             int numRead;
>             numRead=in.read(buf,0,80);
>             String field="\"";
>             for(int k=0;k<numRead;k++)
>             {
>                 field=field+buf[k];
>             }
>             field=field+"\"";
>             FileOutputStream fos = new FileOutputStream(new File ( 
> "/home/ajinkyan/cgi-bin/infoviewer/results.txt"));
>             BufferedWriter out = new BufferedWriter(new 
> OutputStreamWriter(fos,"UTF8"));
>             Searcher searcher = new 
> IndexSearcher("/home/ajinkyan/cgi-bin/infoviewer/index_arabic");
>             try
>             {
>                     Query query = QueryParser.parse(field, "contents", 
> new ArabicStemAnalyzer());
>                     Hits hits = searcher.search(query);
>                     String output="Total match document = \n";
>                     for(int j=0;j<hits.length();j++)
>                     {
>                         Document doc = hits.doc(j);
>                     //    System.out.print(hits.score(j)+"  ");
>                         output = output +"\n"+ doc.get("filename");
>                     }
>                     out.write(output);
>                     out.write("\n");
>             }
>             catch(Exception e)
>             {
>                 out.write("Parser Error");
>                 out.write("\n");
> 
>             }
>             searcher.close();
>             out.close();
>         }
>         catch (Exception e)
>         {
>             String s= " caught a " + e.getClass() +
>              "\n with message: " + e.getMessage();
>         }
>     }//end of main
> }//end of SerchFiles
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
> 
-- 
Julien Cigar (jcigar@ulb.ac.be)
Belgian Biodiversity Information Facility
Universit? Libre de Bruxelles
Campus de la Plaine CP 257
B?timent NO, Bureau 4 N4 115C (Niveau 4)
Boulevard du Triomphe, entr?e ULB 2
B-1050 Bruxelles
http://www.bebif.be

From jcigar at ulb.ac.be  Tue Aug 16 07:14:23 2005
From: jcigar at ulb.ac.be (Julien)
Date: Tue Aug 16 07:14:05 2005
Subject: [mod_python] Segmentation fault with mod_python and DBXML
In-Reply-To: <4301BEC2.5030802@infogridpacific.com>
References: <4301BEC2.5030802@infogridpacific.com>
Message-ID: <1124190863.24469.3.camel@horologium>

Maybe a library has problem with threads ... 
try running apache in prefork mode (in place of threads) to see if it
resolve the problem ...

On Tue, 2005-08-16 at 15:54 +0530, Manjeet Chaudhary wrote:
> Hello All,
> 
> Sorry if the mail got duplicated.
> I am developing a web based application; based on Apache, mod_python, 
> dbxml and python programming; When i try to import dbxml module( to 
> perform various dbxml operations ) from mod-python handler and give a 
> url request to mod-python handler i am getting an error of Segmentation 
> Fault in apache error log .
> I am using following versions of software
> 1) dbxml -  2.1.8
> 2) python - 2.3.4
> 3) mod-python - 1.3.4
> 4) apache 2.0.52
> 5) Kernel version-2.6.9-5.0.5-EL
> 
> I think the error occurs at the time when i am creating the XmlManager 
> instance in dbxml module.
> I am using Publisher Handler of mod-python.
> 
> Apache error log (/var/log/httpd/error_log)
> 
> [Tue Aug 16 10:17:43 2005] [notice] mod_python: (Re)importing module 
> 'mod_python.publisher'
> [Tue Aug 16 10:17:43 2005] [notice] mod_python: (Re)importing module 'x' 
> with path set to '['/var/www/cgi-bin/sw']'
> [Tue Aug 16 10:17:44 2005] [notice] child pid 3238 exit signal 
> Segmentation fault (11)
> 
> Please let me know is there any solution to this problem .
> It is very urgent.
> Thanks in advance.
> Regards,
> 
> Manjeet Chaudhary
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
> 
-- 
Julien Cigar (jcigar@ulb.ac.be)
Belgian Biodiversity Information Facility
Universit? Libre de Bruxelles
Campus de la Plaine CP 257
B?timent NO, Bureau 4 N4 115C (Niveau 4)
Boulevard du Triomphe, entr?e ULB 2
B-1050 Bruxelles
http://www.bebif.be

From davidf at sjsoft.com  Tue Aug 16 08:39:58 2005
From: davidf at sjsoft.com (David Fraser)
Date: Tue Aug 16 08:40:16 2005
Subject: [mod_python] Problem in executing java program using mod_python.
In-Reply-To: <1124190708.24469.0.camel@horologium>
References: <4301BEAB.8030501@infogridpacific.com>
	<1124190708.24469.0.camel@horologium>
Message-ID: <4301DE9E.3020401@sjsoft.com>

We use PyLucene too and its fantastic, but just be aware that if you run 
Apache in multi-threaded mode (e.g. under Windows) there are conflicts 
with the gcj threading (for which there are also workarounds, mainly 
running a separate process for PyLucene)

Julien wrote:

>Why not using PyLucene ? http://pylucene.osafoundation.org/
>
>It's a SWIG python port of Java Lucene, and it works perfeclty with
>mod_python (we use it every day here at work)
>
>On Tue, 2005-08-16 at 15:53 +0530, Manjeet Chaudhary wrote:
>  
>
>>Hello All
>>
>>I am using mod_python and Lucene for searching of Arabic Text from an 
>>Index created using Lucene+Java.
>>I am facing some problems in running "java" command using mod_python.
>>
>>1.   I am trying to run java program using "os.system" command.
>>    Check = os.system("java ..........")
>>
>>2.   The command returns me a value of 256.
>>    i.e Check = 256
>>
>>3.   I am not able to figure it out why that java program is not being 
>>executed properly.
>>
>>4.   For the java program i have set the classpath and compiling and 
>>running that program using the classpath.
>>
>>    export CLASSPATH = 
>>/home/ajinkyan/cgi-bin/infoviewer/Jar_Files/lucene-1.4.3.jar 
>>:/home/ajinkyan/cgi-bin/infoviewer/Jar_Files/PDFBox-0.6.7a.jar 
>>:/home/ajinkyan/cgi-bin/infoviewer/Jar_Files/log4j-1.2.8.jar 
>>:/home/ajinkyan/cgi-bin/infoviewer/Jar_Files/tm-extractors-0.4.jar 
>>:/home/ajinkyan/cgi-bin/infoviewer/Jar_Files/ArabicAnalyzer-1.0b.jar 
>>:/home/ajinkyan/cgi-bin/infoviewer/Jar_Files/commons-collections-3.1.jar
>>
>>    javac -classpath $CLASSPATH:. SearchFiles.java
>>
>>    java -classpath $ClASSPATH:. SearchFiles
>>
>>5.   SearchFiles program is running properly if i run it from shell.
>>
>>So please help me and tell where i am going wrong.
>>I have attached the copy of code at the end .
>>
>>Thank you
>>Manjeet Chaudhary
>>
>>
>>
>>#!/usr/bin/env python
>>"""
>>#-------------------------------------------------------------------------------------------------------
>>#Name:       ar_search.py
>>#Version:    1.0
>>#Purpose:    Searching for Infoviewer
>>#Author:     Alok Khandelwal
>>#Created:    10-08-2005
>>#Licence:    Infogrid Pacific EULA
>>#--------------------------------------------------------------------------------------------------------
>>#Revision History
>>#--------------------------------------------------------------------------------------------------------
>>
>>#----------------Different modules required are imported 
>>here-------------------
>>"""
>>import cgitb,cgi,sys
>>cgitb.enable()
>>import os
>>from os.path import join, abspath
>>from mod_python import apache,util,Session
>>"""
>>#----------------End of importing 
>>modules----------------------------------------
>>
>>
>>def search(req):
>>
>>    """This part takes Arabic keyword from req variable and write that 
>>keyword into a temp file. This temp file will be opened by java program 
>>and that program will take that value and search for the variable in the 
>>index file.
>>Java program will store the result in results.txt file"""
>>
>>    The_Form = util.FieldStorage(req)
>>    for name in The_Form.keys():
>>        #--------Checking for the selected Fields and turning those flag 
>>on--------
>>        if name == 'search_contents':
>>            value=The_Form[name]
>>            value.encode('utf-8')
>>            f=open("/home/ajinkyan/cgi-bin/infoviewer/temp.txt","w")
>>            f.write(value)
>>            f.close()
>>
>>            try:
>>                command = "export 
>>CLASSPATH=/home/ajinkyan/cgi-bin/infoviewer/Jar_Files/lucene-1.4.3.jar:/home/ajinkyan/cgi-bin/infoviewer/Jar_Files/PDFBox-0.6.7a.jar:/home/ajinkyan/cgi-bin/infoviewer/Jar_Files/log4j-1.2.8.jar:/home/ajinkyan/cgi-bin/infoviewer/Jar_Files/tm-extractors-0.4.jar:/home/ajinkyan/cgi-bin/infoviewer/Jar_Files/ArabicAnalyzer-1.0b.jar:/home/ajinkyan/cgi-bin/infoviewer/Jar_Files/commons-collections-3.1.jar"
>>                import os
>>                os.system(command)
>>                command = "java -classpath 
>>$CLASSPATH:/home/ajinkyan/cgi-bin/infoviewer SearchFiles"
>>                check=os.system(command)
>>                req.write("\ncheck = " + str(check))
>>                f  = open(  
>>"/home/ajinkyan/cgi-bin/infoviewer/results.txt","r")
>>                result=f.read()
>>                req.write(result)
>>            except:
>>
>>                req.write("\n")
>>                req.write(str(sys.exc_type))
>>                req.write("\n")
>>                req.write(str(sys.exc_value))
>>
>>
>>
>>____________________________________________________________________________________________________________________________
>>
>># After executing the os.system command the value returned in check is 
>>maximum times 256 or some thing near 32000 .
>>
>># Java program is running independently without any errors. Only when it 
>>is called using os.system it doesn't run .
>>
>># The Java program is as follows
>>
>>___________________________________________________________________________________________________________________________
>>
>>
>>/**
>>* @Name   : SearchFiles.java
>>* @Version: 1.0
>>* @Author : Alok Khandelwal
>>* @Created: 2 August 2005
>>* @Purpose: Searching in index for arabic contents
>>* @Copyright:(c)2004 by Infogrid Pacific Pte. Ltd.
>>* @Licenece :Infogrid Pacific Eula
>>*/
>>
>>
>>
>>
>>import org.apache.lucene.search.Searcher;
>>import org.apache.lucene.search.IndexSearcher;
>>import org.apache.lucene.search.Query;
>>import org.apache.lucene.search.Hits;
>>import org.apache.lucene.queryParser.QueryParser;
>>import gpl.pierrick.brihaye.aramorph.lucene.ArabicStemAnalyzer;
>>import java.io.*;
>>import org.apache.lucene.document.Document;
>>class SearchFiles
>>{
>>    public static void main(String[] args)
>>    {
>>        try
>>        {
>>            FileInputStream fis = new FileInputStream(new File ( 
>>"/home/ajinkyan/cgi-bin/infoviewer/temp.txt"));
>>            BufferedReader in = new BufferedReader(new 
>>InputStreamReader(fis,"UTF8"));
>>            char [] buf = new char[80];
>>            int numRead;
>>            numRead=in.read(buf,0,80);
>>            String field="\"";
>>            for(int k=0;k<numRead;k++)
>>            {
>>                field=field+buf[k];
>>            }
>>            field=field+"\"";
>>            FileOutputStream fos = new FileOutputStream(new File ( 
>>"/home/ajinkyan/cgi-bin/infoviewer/results.txt"));
>>            BufferedWriter out = new BufferedWriter(new 
>>OutputStreamWriter(fos,"UTF8"));
>>            Searcher searcher = new 
>>IndexSearcher("/home/ajinkyan/cgi-bin/infoviewer/index_arabic");
>>            try
>>            {
>>                    Query query = QueryParser.parse(field, "contents", 
>>new ArabicStemAnalyzer());
>>                    Hits hits = searcher.search(query);
>>                    String output="Total match document = \n";
>>                    for(int j=0;j<hits.length();j++)
>>                    {
>>                        Document doc = hits.doc(j);
>>                    //    System.out.print(hits.score(j)+"  ");
>>                        output = output +"\n"+ doc.get("filename");
>>                    }
>>                    out.write(output);
>>                    out.write("\n");
>>            }
>>            catch(Exception e)
>>            {
>>                out.write("Parser Error");
>>                out.write("\n");
>>
>>            }
>>            searcher.close();
>>            out.close();
>>        }
>>        catch (Exception e)
>>        {
>>            String s= " caught a " + e.getClass() +
>>             "\n with message: " + e.getMessage();
>>        }
>>    }//end of main
>>}//end of SerchFiles
>>_______________________________________________
>>Mod_python mailing list
>>Mod_python@modpython.org
>>http://mailman.modpython.org/mailman/listinfo/mod_python
>>
>>    
>>

From mithrandir1984cz at centrum.cz  Tue Aug 16 09:29:35 2005
From: mithrandir1984cz at centrum.cz (Michal Koudelka)
Date: Tue Aug 16 09:29:45 2005
Subject: [mod_python] (no subject)
Message-ID: <200508161529.13005@centrum.cz>

Hi,

I like the way how I can create authorization handler in python so I tryed to authorize user for ftp server on apache (mod_ftpd). Simple username-password authorization works fine. But... when I connect to ftp server and send LIST command, I saw

-rw-r--r--      ftp      ftp         222 srp 16 13:00 authtest.py

Do you have idea how to hide this script? E. g. put them to different dictionary... how to configure httpd.conf then?

Thank for your help

Michael Koudelka

From manjeet at infogridpacific.com  Tue Aug 16 09:47:38 2005
From: manjeet at infogridpacific.com (Manjeet Chaudhary)
Date: Tue Aug 16 09:47:57 2005
Subject: [mod_python] Segmentation fault with mod_python and DBXML
In-Reply-To: <4780d21c16890ae865494ebcd42eb65b@dscpl.com.au>
References: <4301BEC2.5030802@infogridpacific.com>
	<4780d21c16890ae865494ebcd42eb65b@dscpl.com.au>
Message-ID: <4301EE7A.1090606@infogridpacific.com>

Hello Graham

Graham Dumpleton wrote:

> Python has a version of expat builtin to it. The version of this
> most likely differs to a version of expat used as a shared library
> by some other module linked into Apache.
>
> Work out what version of expat library is installed on your system,
> you may have to update it.
>
>    
> http://www.modpython.org/pipermail/mod_python/2004-December/017023.html 

I upgraded "expat-1.95.7-4" to "expat-1.95.8-4" as well as to 
"expat-1.95.8-6". But the problem is still there.

> These mismatches in shared library versions required by different
> modules can occur in other situations as well. See:
>
>    
> http://www.modpython.org/FAQ/faqw.py?query=expat&querytype=simple&casefold=yes&req=search 
>

Is there any problem using mod_python and dbxml together.

> On 16/08/2005, at 8:24 PM, Manjeet Chaudhary wrote:
>
>> Hello All,
>>
>> Sorry if the mail got duplicated.
>> I am developing a web based application; based on Apache, 
>> mod_python,  dbxml and python programming; When i try to import dbxml 
>> module( to  perform various dbxml operations ) from mod-python 
>> handler and give a  url request to mod-python handler i am getting an 
>> error of  Segmentation Fault in apache error log .
>> I am using following versions of software
>> 1) dbxml -  2.1.8
>> 2) python - 2.3.4
>> 3) mod-python - 1.3.4
>> 4) apache 2.0.52
>> 5) Kernel version-2.6.9-5.0.5-EL
>>
>> I think the error occurs at the time when i am creating the 
>> XmlManager  instance in dbxml module.
>> I am using Publisher Handler of mod-python.
>>
>> Apache error log (/var/log/httpd/error_log)
>>
>> [Tue Aug 16 10:17:43 2005] [notice] mod_python: (Re)importing module  
>> 'mod_python.publisher'
>> [Tue Aug 16 10:17:43 2005] [notice] mod_python: (Re)importing module  
>> 'x' with path set to '['/var/www/cgi-bin/sw']'
>> [Tue Aug 16 10:17:44 2005] [notice] child pid 3238 exit signal  
>> Segmentation fault (11)
>>
>> Please let me know is there any solution to this problem .
>> It is very urgent.
>> Thanks in advance.
>> Regards,
>>
>> Manjeet Chaudhary
>> _______________________________________________
>> Mod_python mailing list
>> Mod_python@modpython.org
>> http://mailman.modpython.org/mailman/listinfo/mod_python
>
>
>
>
>
>
From conrad at hep.caltech.edu  Tue Aug 16 11:40:27 2005
From: conrad at hep.caltech.edu (Conrad Steenberg)
Date: Tue Aug 16 11:40:33 2005
Subject: [mod_python] Problem in executing java program using mod_python.
In-Reply-To: <4301DE9E.3020401@sjsoft.com>
References: <4301BEAB.8030501@infogridpacific.com>
	<1124190708.24469.0.camel@horologium>  <4301DE9E.3020401@sjsoft.com>
Message-ID: <1124206827.17908.11.camel@localhost.localdomain>

Hi David

You might also want to check out Xapian at http://www.xapian.org
"""
Xapian is an Open Source Probabilistic Information Retrieval library,
released under the GPL. It's written in C++, with bindings to allow use
from other languages (Perl, Python, PHP, Java, and TCL are currently
supported; Guile and C# are being worked on).
"""

Calling Java code from Python just seems rather offensive to the
minimalist beauty I associate with Python ;-)

Cheers

Conrad

On Tue, 2005-08-16 at 14:39 +0200, David Fraser wrote:
> We use PyLucene too and its fantastic, but just be aware that if you run 
> Apache in multi-threaded mode (e.g. under Windows) there are conflicts 
> with the gcj threading (for which there are also workarounds, mainly 
> running a separate process for PyLucene)
> 
> Julien wrote:
> 
> >Why not using PyLucene ? http://pylucene.osafoundation.org/
> >
> >It's a SWIG python port of Java Lucene, and it works perfeclty with
> >mod_python (we use it every day here at work)
> >
> >On Tue, 2005-08-16 at 15:53 +0530, Manjeet Chaudhary wrote:
> >  
> >
> >>Hello All
> >>
> >>I am using mod_python and Lucene for searching of Arabic Text from an 
> >>Index created using Lucene+Java.
> >>I am facing some problems in running "java" command using mod_python.
> >>
> >>1.   I am trying to run java program using "os.system" command.
> >>    Check = os.system("java ..........")
> >>
> >>2.   The command returns me a value of 256.
> >>    i.e Check = 256
> >>
> >>3.   I am not able to figure it out why that java program is not being 
> >>executed properly.
> >>
> >>4.   For the java program i have set the classpath and compiling and 
> >>running that program using the classpath.
> >>
> >>    export CLASSPATH = 
> >>/home/ajinkyan/cgi-bin/infoviewer/Jar_Files/lucene-1.4.3.jar 
> >>:/home/ajinkyan/cgi-bin/infoviewer/Jar_Files/PDFBox-0.6.7a.jar 
> >>:/home/ajinkyan/cgi-bin/infoviewer/Jar_Files/log4j-1.2.8.jar 
> >>:/home/ajinkyan/cgi-bin/infoviewer/Jar_Files/tm-extractors-0.4.jar 
> >>:/home/ajinkyan/cgi-bin/infoviewer/Jar_Files/ArabicAnalyzer-1.0b.jar 
> >>:/home/ajinkyan/cgi-bin/infoviewer/Jar_Files/commons-collections-3.1.jar
> >>
> >>    javac -classpath $CLASSPATH:. SearchFiles.java
> >>
> >>    java -classpath $ClASSPATH:. SearchFiles
> >>
> >>5.   SearchFiles program is running properly if i run it from shell.
> >>
> >>So please help me and tell where i am going wrong.
> >>I have attached the copy of code at the end .
> >>
> >>Thank you
> >>Manjeet Chaudhary
> >>
> >>
> >>
> >>#!/usr/bin/env python
> >>"""
> >>#-------------------------------------------------------------------------------------------------------
> >>#Name:       ar_search.py
> >>#Version:    1.0
> >>#Purpose:    Searching for Infoviewer
> >>#Author:     Alok Khandelwal
> >>#Created:    10-08-2005
> >>#Licence:    Infogrid Pacific EULA
> >>#--------------------------------------------------------------------------------------------------------
> >>#Revision History
> >>#--------------------------------------------------------------------------------------------------------
> >>
> >>#----------------Different modules required are imported 
> >>here-------------------
> >>"""
> >>import cgitb,cgi,sys
> >>cgitb.enable()
> >>import os
> >>from os.path import join, abspath
> >>from mod_python import apache,util,Session
> >>"""
> >>#----------------End of importing 
> >>modules----------------------------------------
> >>
> >>
> >>def search(req):
> >>
> >>    """This part takes Arabic keyword from req variable and write that 
> >>keyword into a temp file. This temp file will be opened by java program 
> >>and that program will take that value and search for the variable in the 
> >>index file.
> >>Java program will store the result in results.txt file"""
> >>
> >>    The_Form = util.FieldStorage(req)
> >>    for name in The_Form.keys():
> >>        #--------Checking for the selected Fields and turning those flag 
> >>on--------
> >>        if name == 'search_contents':
> >>            value=The_Form[name]
> >>            value.encode('utf-8')
> >>            f=open("/home/ajinkyan/cgi-bin/infoviewer/temp.txt","w")
> >>            f.write(value)
> >>            f.close()
> >>
> >>            try:
> >>                command = "export 
> >>CLASSPATH=/home/ajinkyan/cgi-bin/infoviewer/Jar_Files/lucene-1.4.3.jar:/home/ajinkyan/cgi-bin/infoviewer/Jar_Files/PDFBox-0.6.7a.jar:/home/ajinkyan/cgi-bin/infoviewer/Jar_Files/log4j-1.2.8.jar:/home/ajinkyan/cgi-bin/infoviewer/Jar_Files/tm-extractors-0.4.jar:/home/ajinkyan/cgi-bin/infoviewer/Jar_Files/ArabicAnalyzer-1.0b.jar:/home/ajinkyan/cgi-bin/infoviewer/Jar_Files/commons-collections-3.1.jar"
> >>                import os
> >>                os.system(command)
> >>                command = "java -classpath 
> >>$CLASSPATH:/home/ajinkyan/cgi-bin/infoviewer SearchFiles"
> >>                check=os.system(command)
> >>                req.write("\ncheck = " + str(check))
> >>                f  = open(  
> >>"/home/ajinkyan/cgi-bin/infoviewer/results.txt","r")
> >>                result=f.read()
> >>                req.write(result)
> >>            except:
> >>
> >>                req.write("\n")
> >>                req.write(str(sys.exc_type))
> >>                req.write("\n")
> >>                req.write(str(sys.exc_value))
> >>
> >>
> >>
> >>____________________________________________________________________________________________________________________________
> >>
> >># After executing the os.system command the value returned in check is 
> >>maximum times 256 or some thing near 32000 .
> >>
> >># Java program is running independently without any errors. Only when it 
> >>is called using os.system it doesn't run .
> >>
> >># The Java program is as follows
> >>
> >>___________________________________________________________________________________________________________________________
> >>
> >>
> >>/**
> >>* @Name   : SearchFiles.java
> >>* @Version: 1.0
> >>* @Author : Alok Khandelwal
> >>* @Created: 2 August 2005
> >>* @Purpose: Searching in index for arabic contents
> >>* @Copyright:(c)2004 by Infogrid Pacific Pte. Ltd.
> >>* @Licenece :Infogrid Pacific Eula
> >>*/
> >>
> >>
> >>
> >>
> >>import org.apache.lucene.search.Searcher;
> >>import org.apache.lucene.search.IndexSearcher;
> >>import org.apache.lucene.search.Query;
> >>import org.apache.lucene.search.Hits;
> >>import org.apache.lucene.queryParser.QueryParser;
> >>import gpl.pierrick.brihaye.aramorph.lucene.ArabicStemAnalyzer;
> >>import java.io.*;
> >>import org.apache.lucene.document.Document;
> >>class SearchFiles
> >>{
> >>    public static void main(String[] args)
> >>    {
> >>        try
> >>        {
> >>            FileInputStream fis = new FileInputStream(new File ( 
> >>"/home/ajinkyan/cgi-bin/infoviewer/temp.txt"));
> >>            BufferedReader in = new BufferedReader(new 
> >>InputStreamReader(fis,"UTF8"));
> >>            char [] buf = new char[80];
> >>            int numRead;
> >>            numRead=in.read(buf,0,80);
> >>            String field="\"";
> >>            for(int k=0;k<numRead;k++)
> >>            {
> >>                field=field+buf[k];
> >>            }
> >>            field=field+"\"";
> >>            FileOutputStream fos = new FileOutputStream(new File ( 
> >>"/home/ajinkyan/cgi-bin/infoviewer/results.txt"));
> >>            BufferedWriter out = new BufferedWriter(new 
> >>OutputStreamWriter(fos,"UTF8"));
> >>            Searcher searcher = new 
> >>IndexSearcher("/home/ajinkyan/cgi-bin/infoviewer/index_arabic");
> >>            try
> >>            {
> >>                    Query query = QueryParser.parse(field, "contents", 
> >>new ArabicStemAnalyzer());
> >>                    Hits hits = searcher.search(query);
> >>                    String output="Total match document = \n";
> >>                    for(int j=0;j<hits.length();j++)
> >>                    {
> >>                        Document doc = hits.doc(j);
> >>                    //    System.out.print(hits.score(j)+"  ");
> >>                        output = output +"\n"+ doc.get("filename");
> >>                    }
> >>                    out.write(output);
> >>                    out.write("\n");
> >>            }
> >>            catch(Exception e)
> >>            {
> >>                out.write("Parser Error");
> >>                out.write("\n");
> >>
> >>            }
> >>            searcher.close();
> >>            out.close();
> >>        }
> >>        catch (Exception e)
> >>        {
> >>            String s= " caught a " + e.getClass() +
> >>             "\n with message: " + e.getMessage();
> >>        }
> >>    }//end of main
> >>}//end of SerchFiles
> >>_______________________________________________
> >>Mod_python mailing list
> >>Mod_python@modpython.org
> >>http://mailman.modpython.org/mailman/listinfo/mod_python
> >>
> >>    
> >>
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
-- 
Conrad Steenberg <conrad@hep.caltech.edu>
California Institute of technology
-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/x-pkcs7-signature
Size: 2531 bytes
Desc: not available
Url : http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20050816/6c1adeb0/smime-0001.bin
From conrad at hep.caltech.edu  Tue Aug 16 11:46:32 2005
From: conrad at hep.caltech.edu (Conrad Steenberg)
Date: Tue Aug 16 11:46:39 2005
Subject: [mod_python] Segmentation fault with mod_python and DBXML
In-Reply-To: <1124190863.24469.3.camel@horologium>
References: <4301BEC2.5030802@infogridpacific.com>
	<1124190863.24469.3.camel@horologium>
Message-ID: <1124207192.17908.18.camel@localhost.localdomain>

Hi Manjeet

You must use exactly the same libraries in Python and Apache for your
application to work. Apart from expat that was already pointed out, a
common culprit is also Berkeley DB, because it's used very widely.

Do an 'ldd /usr/sbin/httpd', or whatever your Apache executable is, to
find out what libraries it's linked to. Then do the same for your Python
binary, and maybe the dbxml Python module as well.

Cheers

Conrad

On Tue, 2005-08-16 at 13:14 +0200, Julien wrote:
> Maybe a library has problem with threads ... 
> try running apache in prefork mode (in place of threads) to see if it
> resolve the problem ...
> 
> On Tue, 2005-08-16 at 15:54 +0530, Manjeet Chaudhary wrote:
> > Hello All,
> > 
> > Sorry if the mail got duplicated.
> > I am developing a web based application; based on Apache, mod_python, 
> > dbxml and python programming; When i try to import dbxml module( to 
> > perform various dbxml operations ) from mod-python handler and give a 
> > url request to mod-python handler i am getting an error of Segmentation 
> > Fault in apache error log .
> > I am using following versions of software
> > 1) dbxml -  2.1.8
> > 2) python - 2.3.4
> > 3) mod-python - 1.3.4
> > 4) apache 2.0.52
> > 5) Kernel version-2.6.9-5.0.5-EL
> > 
> > I think the error occurs at the time when i am creating the XmlManager 
> > instance in dbxml module.
> > I am using Publisher Handler of mod-python.
> > 
> > Apache error log (/var/log/httpd/error_log)
> > 
> > [Tue Aug 16 10:17:43 2005] [notice] mod_python: (Re)importing module 
> > 'mod_python.publisher'
> > [Tue Aug 16 10:17:43 2005] [notice] mod_python: (Re)importing module 'x' 
> > with path set to '['/var/www/cgi-bin/sw']'
> > [Tue Aug 16 10:17:44 2005] [notice] child pid 3238 exit signal 
> > Segmentation fault (11)
> > 
> > Please let me know is there any solution to this problem .
> > It is very urgent.
> > Thanks in advance.
> > Regards,
> > 
> > Manjeet Chaudhary
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://mailman.modpython.org/mailman/listinfo/mod_python
> > 
-- 
Conrad Steenberg <conrad@hep.caltech.edu>
California Institute of technology
-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/x-pkcs7-signature
Size: 2531 bytes
Desc: not available
Url : http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20050816/d3bd924e/smime.bin
From scott_list at mischko.com  Tue Aug 16 19:48:22 2005
From: scott_list at mischko.com (Scott Chapman)
Date: Tue Aug 16 19:48:31 2005
Subject: [mod_python] How to get mod_python user to show up in access.log?
Message-ID: <43027B46.1090508@mischko.com>

> 69.59.200.242 - - [16/Aug/2005:12:20:51 -0700] "POST /login HTTP/1.1" 302 51
> 69.59.200.242 - - [16/Aug/2005:12:20:51 -0700] "GET / HTTP/1.1" 200 8587

The above two lines are in my access.log file.  After the user 
successfully logs in, I'd like his userID toshow up here in place of one 
of the dashes.  Can that be done?  I'm using a custom login page, not 
the generic version provided by web browsers.

Scott
From listspam at flowtheory.net  Wed Aug 17 01:08:40 2005
From: listspam at flowtheory.net (Joshua Ginsberg)
Date: Wed Aug 17 01:08:45 2005
Subject: [SPAM] Re: [mod_python] How to get mod_python user to show up in
	access.log?
In-Reply-To: <43027B46.1090508@mischko.com>
References: <43027B46.1090508@mischko.com>
Message-ID: <b5291043d103145abb7d9ae218f54992@flowtheory.net>

Just a though -- haven't tested it -- but when your /login script runs, 
can it redirect to http://username@www.foobar.com/ instead of 
http://www.foobar.com/, thus providing an HTTP username?

-jag

On Aug 16, 2005, at 5:48 PM, Scott Chapman wrote:

>> 69.59.200.242 - - [16/Aug/2005:12:20:51 -0700] "POST /login HTTP/1.1" 
>> 302 51
>> 69.59.200.242 - - [16/Aug/2005:12:20:51 -0700] "GET / HTTP/1.1" 200 
>> 8587
>
> The above two lines are in my access.log file.  After the user 
> successfully logs in, I'd like his userID toshow up here in place of 
> one of the dashes.  Can that be done?  I'm using a custom login page, 
> not the generic version provided by web browsers.
>
> Scott
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>

From grahamd at dscpl.com.au  Wed Aug 17 01:38:26 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Wed Aug 17 01:38:40 2005
Subject: [SPAM] Re: [mod_python] How to get mod_python user to show up in
	access.log?
Message-ID: <1124257106.32284@dscpl.user.openhosting.com>

Joshua Ginsberg wrote ..
> Just a though -- haven't tested it -- but when your /login script runs,
> can it redirect to http://username@www.foobar.com/ instead of 
> http://www.foobar.com/, thus providing an HTTP username?
> 
> -jag
> 
> On Aug 16, 2005, at 5:48 PM, Scott Chapman wrote:
> 
> >> 69.59.200.242 - - [16/Aug/2005:12:20:51 -0700] "POST /login HTTP/1.1"
> >> 302 51
> >> 69.59.200.242 - - [16/Aug/2005:12:20:51 -0700] "GET / HTTP/1.1" 200
> >> 8587
> >
> > The above two lines are in my access.log file.  After the user 
> > successfully logs in, I'd like his userID toshow up here in place of
> > one of the dashes.  Can that be done?  I'm using a custom login page,
> > not the generic version provided by web browsers.

Easier than that, assign the username to "req.user" in your handler once
you have done the authentication.

  def handler(req):
    req.content_type = "text/plain"
    req.send_http_header()
    req.write("mptest.py\n")
    req.user = "hello" 
    return apache.OK

Yields:

  127.0.0.1 - hello [17/Aug/2005:15:35:42 +1000] "GET /~grahamd/handler/mptest.py HTTP/1.1" 200 142

Graham
From manjeet at infogridpacific.com  Wed Aug 17 07:09:40 2005
From: manjeet at infogridpacific.com (Manjeet Chaudhary)
Date: Wed Aug 17 07:11:40 2005
Subject: [mod_python] Problem in executing java program using mod_python.
In-Reply-To: <4301DE9E.3020401@sjsoft.com>
References: <4301BEAB.8030501@infogridpacific.com>
	<1124190708.24469.0.camel@horologium> <4301DE9E.3020401@sjsoft.com>
Message-ID: <43031AF4.5060804@infogridpacific.com>

We are working for indexing and searching of Arabic text.

Brief about our application is :

1.   It's a web based indexing and searching application.
2.   It should index the Arabic/English text
3.   Searching Arabic/English text.

PyLucene is best for Indexing using Python. But there is no Arabic 
Analyzer available for Python.
Aramorph is a Java based Arabic Analyzer. How can i use 
ArabicAnalyzer.jar for my case using Python and Mod_Python.

I want to pull Java Lucene into Python: PyLucene.I have an 
"ArabicAnalyzer.jar" file in Java and i want to use in Python.I have 
gone through a documentation of how to convert Java into Python using 
"gcj" and "swig" , but i am confused about how to go about.

So please help me and tell me the exact procedure to follow to pull that 
jar file in python.

Thank you
M Chaudhary


David Fraser wrote:

> We use PyLucene too and its fantastic, but just be aware that if you 
> run Apache in multi-threaded mode (e.g. under Windows) there are 
> conflicts with the gcj threading (for which there are also 
> workarounds, mainly running a separate process for PyLucene)
>
> Julien wrote:
>
>> Why not using PyLucene ? http://pylucene.osafoundation.org/
>>
>> It's a SWIG python port of Java Lucene, and it works perfeclty with
>> mod_python (we use it every day here at work)
>>
>> On Tue, 2005-08-16 at 15:53 +0530, Manjeet Chaudhary wrote:
>>  
>>
>>> Hello All
>>>
>>> I am using mod_python and Lucene for searching of Arabic Text from 
>>> an Index created using Lucene+Java.
>>> I am facing some problems in running "java" command using mod_python.
>>>
>>> 1.   I am trying to run java program using "os.system" command.
>>>    Check = os.system("java ..........")
>>>
>>> 2.   The command returns me a value of 256.
>>>    i.e Check = 256
>>>
>>> 3.   I am not able to figure it out why that java program is not 
>>> being executed properly.
>>>
>>> 4.   For the java program i have set the classpath and compiling and 
>>> running that program using the classpath.
>>>
>>>    export CLASSPATH = 
>>> /home/ajinkyan/cgi-bin/infoviewer/Jar_Files/lucene-1.4.3.jar 
>>> :/home/ajinkyan/cgi-bin/infoviewer/Jar_Files/PDFBox-0.6.7a.jar 
>>> :/home/ajinkyan/cgi-bin/infoviewer/Jar_Files/log4j-1.2.8.jar 
>>> :/home/ajinkyan/cgi-bin/infoviewer/Jar_Files/tm-extractors-0.4.jar 
>>> :/home/ajinkyan/cgi-bin/infoviewer/Jar_Files/ArabicAnalyzer-1.0b.jar 
>>> :/home/ajinkyan/cgi-bin/infoviewer/Jar_Files/commons-collections-3.1.jar 
>>>
>>>
>>>    javac -classpath $CLASSPATH:. SearchFiles.java
>>>
>>>    java -classpath $ClASSPATH:. SearchFiles
>>>
>>> 5.   SearchFiles program is running properly if i run it from shell.
>>>
>>> So please help me and tell where i am going wrong.
>>> I have attached the copy of code at the end .
>>>
>>> Thank you
>>> Manjeet Chaudhary
>>>
>>>
>>>
>>> #!/usr/bin/env python
>>> """
>>> #------------------------------------------------------------------------------------------------------- 
>>>
>>> #Name:       ar_search.py
>>> #Version:    1.0
>>> #Purpose:    Searching for Infoviewer
>>> #Author:     Alok Khandelwal
>>> #Created:    10-08-2005
>>> #Licence:    Infogrid Pacific EULA
>>> #-------------------------------------------------------------------------------------------------------- 
>>>
>>> #Revision History
>>> #-------------------------------------------------------------------------------------------------------- 
>>>
>>>
>>> #----------------Different modules required are imported 
>>> here-------------------
>>> """
>>> import cgitb,cgi,sys
>>> cgitb.enable()
>>> import os
>>> from os.path import join, abspath
>>> from mod_python import apache,util,Session
>>> """
>>> #----------------End of importing 
>>> modules----------------------------------------
>>>
>>>
>>> def search(req):
>>>
>>>    """This part takes Arabic keyword from req variable and write 
>>> that keyword into a temp file. This temp file will be opened by java 
>>> program and that program will take that value and search for the 
>>> variable in the index file.
>>> Java program will store the result in results.txt file"""
>>>
>>>    The_Form = util.FieldStorage(req)
>>>    for name in The_Form.keys():
>>>        #--------Checking for the selected Fields and turning those 
>>> flag on--------
>>>        if name == 'search_contents':
>>>            value=The_Form[name]
>>>            value.encode('utf-8')
>>>            f=open("/home/ajinkyan/cgi-bin/infoviewer/temp.txt","w")
>>>            f.write(value)
>>>            f.close()
>>>
>>>            try:
>>>                command = "export 
>>> CLASSPATH=/home/ajinkyan/cgi-bin/infoviewer/Jar_Files/lucene-1.4.3.jar:/home/ajinkyan/cgi-bin/infoviewer/Jar_Files/PDFBox-0.6.7a.jar:/home/ajinkyan/cgi-bin/infoviewer/Jar_Files/log4j-1.2.8.jar:/home/ajinkyan/cgi-bin/infoviewer/Jar_Files/tm-extractors-0.4.jar:/home/ajinkyan/cgi-bin/infoviewer/Jar_Files/ArabicAnalyzer-1.0b.jar:/home/ajinkyan/cgi-bin/infoviewer/Jar_Files/commons-collections-3.1.jar" 
>>>
>>>                import os
>>>                os.system(command)
>>>                command = "java -classpath 
>>> $CLASSPATH:/home/ajinkyan/cgi-bin/infoviewer SearchFiles"
>>>                check=os.system(command)
>>>                req.write("\ncheck = " + str(check))
>>>                f  = open(  
>>> "/home/ajinkyan/cgi-bin/infoviewer/results.txt","r")
>>>                result=f.read()
>>>                req.write(result)
>>>            except:
>>>
>>>                req.write("\n")
>>>                req.write(str(sys.exc_type))
>>>                req.write("\n")
>>>                req.write(str(sys.exc_value))
>>>
>>>
>>>
>>> ____________________________________________________________________________________________________________________________ 
>>>
>>>
>>> # After executing the os.system command the value returned in check 
>>> is maximum times 256 or some thing near 32000 .
>>>
>>> # Java program is running independently without any errors. Only 
>>> when it is called using os.system it doesn't run .
>>>
>>> # The Java program is as follows
>>>
>>> ___________________________________________________________________________________________________________________________ 
>>>
>>>
>>>
>>> /**
>>> * @Name   : SearchFiles.java
>>> * @Version: 1.0
>>> * @Author : Alok Khandelwal
>>> * @Created: 2 August 2005
>>> * @Purpose: Searching in index for arabic contents
>>> * @Copyright:(c)2004 by Infogrid Pacific Pte. Ltd.
>>> * @Licenece :Infogrid Pacific Eula
>>> */
>>>
>>>
>>>
>>>
>>> import org.apache.lucene.search.Searcher;
>>> import org.apache.lucene.search.IndexSearcher;
>>> import org.apache.lucene.search.Query;
>>> import org.apache.lucene.search.Hits;
>>> import org.apache.lucene.queryParser.QueryParser;
>>> import gpl.pierrick.brihaye.aramorph.lucene.ArabicStemAnalyzer;
>>> import java.io.*;
>>> import org.apache.lucene.document.Document;
>>> class SearchFiles
>>> {
>>>    public static void main(String[] args)
>>>    {
>>>        try
>>>        {
>>>            FileInputStream fis = new FileInputStream(new File ( 
>>> "/home/ajinkyan/cgi-bin/infoviewer/temp.txt"));
>>>            BufferedReader in = new BufferedReader(new 
>>> InputStreamReader(fis,"UTF8"));
>>>            char [] buf = new char[80];
>>>            int numRead;
>>>            numRead=in.read(buf,0,80);
>>>            String field="\"";
>>>            for(int k=0;k<numRead;k++)
>>>            {
>>>                field=field+buf[k];
>>>            }
>>>            field=field+"\"";
>>>            FileOutputStream fos = new FileOutputStream(new File ( 
>>> "/home/ajinkyan/cgi-bin/infoviewer/results.txt"));
>>>            BufferedWriter out = new BufferedWriter(new 
>>> OutputStreamWriter(fos,"UTF8"));
>>>            Searcher searcher = new 
>>> IndexSearcher("/home/ajinkyan/cgi-bin/infoviewer/index_arabic");
>>>            try
>>>            {
>>>                    Query query = QueryParser.parse(field, 
>>> "contents", new ArabicStemAnalyzer());
>>>                    Hits hits = searcher.search(query);
>>>                    String output="Total match document = \n";
>>>                    for(int j=0;j<hits.length();j++)
>>>                    {
>>>                        Document doc = hits.doc(j);
>>>                    //    System.out.print(hits.score(j)+"  ");
>>>                        output = output +"\n"+ doc.get("filename");
>>>                    }
>>>                    out.write(output);
>>>                    out.write("\n");
>>>            }
>>>            catch(Exception e)
>>>            {
>>>                out.write("Parser Error");
>>>                out.write("\n");
>>>
>>>            }
>>>            searcher.close();
>>>            out.close();
>>>        }
>>>        catch (Exception e)
>>>        {
>>>            String s= " caught a " + e.getClass() +
>>>             "\n with message: " + e.getMessage();
>>>        }
>>>    }//end of main
>>> }//end of SerchFiles
>>> _______________________________________________
>>> Mod_python mailing list
>>> Mod_python@modpython.org
>>> http://mailman.modpython.org/mailman/listinfo/mod_python
>>>
>>>   
>>
>
>
>
>
>
From jgentil at sebistar.net  Wed Aug 17 10:54:47 2005
From: jgentil at sebistar.net (Jon-Pierre Gentil)
Date: Wed Aug 17 10:55:19 2005
Subject: [mod_python] Problem in executing java program using mod_python.
In-Reply-To: <43031AF4.5060804@infogridpacific.com>
References: <4301BEAB.8030501@infogridpacific.com>
	<4301DE9E.3020401@sjsoft.com>
	<43031AF4.5060804@infogridpacific.com>
Message-ID: <200508170954.58044.jgentil@sebistar.net>

On Wednesday 17 August 2005 06:09 am, Manjeet Chaudhary wrote:

> I want to pull Java Lucene into Python: PyLucene.I have an
> "ArabicAnalyzer.jar" file in Java and i want to use in Python.I have
> gone through a documentation of how to convert Java into Python using
> "gcj" and "swig" , but i am confused about how to go about.

This would be the perfect reason to have mod_jython.   :-)

But otherwise, the only way I can think of to integrate it without 
seriously hacking something up is to create a XMLRPC wrapper service in 
Java and have it running on the machine with the web server, and do 
XMLRPC calls to it.


-- 
_________________________________________________________

  Jon-Pierre Gentil               PGP: 0x7E1CBA17
  jabber: jgentil@sebistar.net    web: www.sebistar.net
  "If you think education is expensive, try ignorance."
_________________________________________________________ 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 827 bytes
Desc: not available
Url : http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20050817/6db10709/attachment.bin
From davidf at sjsoft.com  Wed Aug 17 11:04:59 2005
From: davidf at sjsoft.com (David Fraser)
Date: Wed Aug 17 11:05:16 2005
Subject: [mod_python] Problem in executing java program using mod_python.
In-Reply-To: <43031AF4.5060804@infogridpacific.com>
References: <4301BEAB.8030501@infogridpacific.com>	<1124190708.24469.0.camel@horologium>
	<4301DE9E.3020401@sjsoft.com>
	<43031AF4.5060804@infogridpacific.com>
Message-ID: <4303521B.8090204@sjsoft.com>

I see you've also asked this on pylucene-dev - Andi Vadja's answer there 
is good, and that's probably the best case to continue the discussion... 
(I'm on that list too)

Manjeet Chaudhary wrote:

> We are working for indexing and searching of Arabic text.
>
> Brief about our application is :
>
> 1.   It's a web based indexing and searching application.
> 2.   It should index the Arabic/English text
> 3.   Searching Arabic/English text.
>
> PyLucene is best for Indexing using Python. But there is no Arabic 
> Analyzer available for Python.
> Aramorph is a Java based Arabic Analyzer. How can i use 
> ArabicAnalyzer.jar for my case using Python and Mod_Python.
>
> I want to pull Java Lucene into Python: PyLucene.I have an 
> "ArabicAnalyzer.jar" file in Java and i want to use in Python.I have 
> gone through a documentation of how to convert Java into Python using 
> "gcj" and "swig" , but i am confused about how to go about.
>
> So please help me and tell me the exact procedure to follow to pull 
> that jar file in python.
>
> Thank you
> M Chaudhary
>
>
> David Fraser wrote:
>
>> We use PyLucene too and its fantastic, but just be aware that if you 
>> run Apache in multi-threaded mode (e.g. under Windows) there are 
>> conflicts with the gcj threading (for which there are also 
>> workarounds, mainly running a separate process for PyLucene)
>>
>> Julien wrote:
>>
>>> Why not using PyLucene ? http://pylucene.osafoundation.org/
>>>
>>> It's a SWIG python port of Java Lucene, and it works perfeclty with
>>> mod_python (we use it every day here at work)
>>>
>>> On Tue, 2005-08-16 at 15:53 +0530, Manjeet Chaudhary wrote:
>>>  
>>>
>>>> Hello All
>>>>
>>>> I am using mod_python and Lucene for searching of Arabic Text from 
>>>> an Index created using Lucene+Java.
>>>> I am facing some problems in running "java" command using mod_python.
>>>>
>>>> 1.   I am trying to run java program using "os.system" command.
>>>>    Check = os.system("java ..........")
>>>>
>>>> 2.   The command returns me a value of 256.
>>>>    i.e Check = 256
>>>>
>>>> 3.   I am not able to figure it out why that java program is not 
>>>> being executed properly.
>>>>
>>>> 4.   For the java program i have set the classpath and compiling 
>>>> and running that program using the classpath.
>>>>
>>>>    export CLASSPATH = 
>>>> /home/ajinkyan/cgi-bin/infoviewer/Jar_Files/lucene-1.4.3.jar 
>>>> :/home/ajinkyan/cgi-bin/infoviewer/Jar_Files/PDFBox-0.6.7a.jar 
>>>> :/home/ajinkyan/cgi-bin/infoviewer/Jar_Files/log4j-1.2.8.jar 
>>>> :/home/ajinkyan/cgi-bin/infoviewer/Jar_Files/tm-extractors-0.4.jar 
>>>> :/home/ajinkyan/cgi-bin/infoviewer/Jar_Files/ArabicAnalyzer-1.0b.jar 
>>>> :/home/ajinkyan/cgi-bin/infoviewer/Jar_Files/commons-collections-3.1.jar 
>>>>
>>>>
>>>>    javac -classpath $CLASSPATH:. SearchFiles.java
>>>>
>>>>    java -classpath $ClASSPATH:. SearchFiles
>>>>
>>>> 5.   SearchFiles program is running properly if i run it from shell.
>>>>
>>>> So please help me and tell where i am going wrong.
>>>> I have attached the copy of code at the end .
>>>>
>>>> Thank you
>>>> Manjeet Chaudhary
>>>>
>>>>
>>>>
>>>> #!/usr/bin/env python
>>>> """
>>>> #------------------------------------------------------------------------------------------------------- 
>>>>
>>>> #Name:       ar_search.py
>>>> #Version:    1.0
>>>> #Purpose:    Searching for Infoviewer
>>>> #Author:     Alok Khandelwal
>>>> #Created:    10-08-2005
>>>> #Licence:    Infogrid Pacific EULA
>>>> #-------------------------------------------------------------------------------------------------------- 
>>>>
>>>> #Revision History
>>>> #-------------------------------------------------------------------------------------------------------- 
>>>>
>>>>
>>>> #----------------Different modules required are imported 
>>>> here-------------------
>>>> """
>>>> import cgitb,cgi,sys
>>>> cgitb.enable()
>>>> import os
>>>> from os.path import join, abspath
>>>> from mod_python import apache,util,Session
>>>> """
>>>> #----------------End of importing 
>>>> modules----------------------------------------
>>>>
>>>>
>>>> def search(req):
>>>>
>>>>    """This part takes Arabic keyword from req variable and write 
>>>> that keyword into a temp file. This temp file will be opened by 
>>>> java program and that program will take that value and search for 
>>>> the variable in the index file.
>>>> Java program will store the result in results.txt file"""
>>>>
>>>>    The_Form = util.FieldStorage(req)
>>>>    for name in The_Form.keys():
>>>>        #--------Checking for the selected Fields and turning those 
>>>> flag on--------
>>>>        if name == 'search_contents':
>>>>            value=The_Form[name]
>>>>            value.encode('utf-8')
>>>>            f=open("/home/ajinkyan/cgi-bin/infoviewer/temp.txt","w")
>>>>            f.write(value)
>>>>            f.close()
>>>>
>>>>            try:
>>>>                command = "export 
>>>> CLASSPATH=/home/ajinkyan/cgi-bin/infoviewer/Jar_Files/lucene-1.4.3.jar:/home/ajinkyan/cgi-bin/infoviewer/Jar_Files/PDFBox-0.6.7a.jar:/home/ajinkyan/cgi-bin/infoviewer/Jar_Files/log4j-1.2.8.jar:/home/ajinkyan/cgi-bin/infoviewer/Jar_Files/tm-extractors-0.4.jar:/home/ajinkyan/cgi-bin/infoviewer/Jar_Files/ArabicAnalyzer-1.0b.jar:/home/ajinkyan/cgi-bin/infoviewer/Jar_Files/commons-collections-3.1.jar" 
>>>>
>>>>                import os
>>>>                os.system(command)
>>>>                command = "java -classpath 
>>>> $CLASSPATH:/home/ajinkyan/cgi-bin/infoviewer SearchFiles"
>>>>                check=os.system(command)
>>>>                req.write("\ncheck = " + str(check))
>>>>                f  = open(  
>>>> "/home/ajinkyan/cgi-bin/infoviewer/results.txt","r")
>>>>                result=f.read()
>>>>                req.write(result)
>>>>            except:
>>>>
>>>>                req.write("\n")
>>>>                req.write(str(sys.exc_type))
>>>>                req.write("\n")
>>>>                req.write(str(sys.exc_value))
>>>>
>>>>
>>>>
>>>> ____________________________________________________________________________________________________________________________ 
>>>>
>>>>
>>>> # After executing the os.system command the value returned in check 
>>>> is maximum times 256 or some thing near 32000 .
>>>>
>>>> # Java program is running independently without any errors. Only 
>>>> when it is called using os.system it doesn't run .
>>>>
>>>> # The Java program is as follows
>>>>
>>>> ___________________________________________________________________________________________________________________________ 
>>>>
>>>>
>>>>
>>>> /**
>>>> * @Name   : SearchFiles.java
>>>> * @Version: 1.0
>>>> * @Author : Alok Khandelwal
>>>> * @Created: 2 August 2005
>>>> * @Purpose: Searching in index for arabic contents
>>>> * @Copyright:(c)2004 by Infogrid Pacific Pte. Ltd.
>>>> * @Licenece :Infogrid Pacific Eula
>>>> */
>>>>
>>>>
>>>>
>>>>
>>>> import org.apache.lucene.search.Searcher;
>>>> import org.apache.lucene.search.IndexSearcher;
>>>> import org.apache.lucene.search.Query;
>>>> import org.apache.lucene.search.Hits;
>>>> import org.apache.lucene.queryParser.QueryParser;
>>>> import gpl.pierrick.brihaye.aramorph.lucene.ArabicStemAnalyzer;
>>>> import java.io.*;
>>>> import org.apache.lucene.document.Document;
>>>> class SearchFiles
>>>> {
>>>>    public static void main(String[] args)
>>>>    {
>>>>        try
>>>>        {
>>>>            FileInputStream fis = new FileInputStream(new File ( 
>>>> "/home/ajinkyan/cgi-bin/infoviewer/temp.txt"));
>>>>            BufferedReader in = new BufferedReader(new 
>>>> InputStreamReader(fis,"UTF8"));
>>>>            char [] buf = new char[80];
>>>>            int numRead;
>>>>            numRead=in.read(buf,0,80);
>>>>            String field="\"";
>>>>            for(int k=0;k<numRead;k++)
>>>>            {
>>>>                field=field+buf[k];
>>>>            }
>>>>            field=field+"\"";
>>>>            FileOutputStream fos = new FileOutputStream(new File ( 
>>>> "/home/ajinkyan/cgi-bin/infoviewer/results.txt"));
>>>>            BufferedWriter out = new BufferedWriter(new 
>>>> OutputStreamWriter(fos,"UTF8"));
>>>>            Searcher searcher = new 
>>>> IndexSearcher("/home/ajinkyan/cgi-bin/infoviewer/index_arabic");
>>>>            try
>>>>            {
>>>>                    Query query = QueryParser.parse(field, 
>>>> "contents", new ArabicStemAnalyzer());
>>>>                    Hits hits = searcher.search(query);
>>>>                    String output="Total match document = \n";
>>>>                    for(int j=0;j<hits.length();j++)
>>>>                    {
>>>>                        Document doc = hits.doc(j);
>>>>                    //    System.out.print(hits.score(j)+"  ");
>>>>                        output = output +"\n"+ doc.get("filename");
>>>>                    }
>>>>                    out.write(output);
>>>>                    out.write("\n");
>>>>            }
>>>>            catch(Exception e)
>>>>            {
>>>>                out.write("Parser Error");
>>>>                out.write("\n");
>>>>
>>>>            }
>>>>            searcher.close();
>>>>            out.close();
>>>>        }
>>>>        catch (Exception e)
>>>>        {
>>>>            String s= " caught a " + e.getClass() +
>>>>             "\n with message: " + e.getMessage();
>>>>        }
>>>>    }//end of main
>>>> }//end of SerchFiles 
>>>

From davidf at sjsoft.com  Wed Aug 17 11:07:44 2005
From: davidf at sjsoft.com (David Fraser)
Date: Wed Aug 17 11:08:01 2005
Subject: [mod_python] Problem in executing java program using	mod_python.
In-Reply-To: <1124206827.17908.11.camel@localhost.localdomain>
References: <4301BEAB.8030501@infogridpacific.com>	
	<1124190708.24469.0.camel@horologium> <4301DE9E.3020401@sjsoft.com>
	<1124206827.17908.11.camel@localhost.localdomain>
Message-ID: <430352C0.2010704@sjsoft.com>

Hi Conrad

Thanks for the pointer, I'll have a look... Unfortunately I can't use 
GPL code for this particular application but it certainly looks like a 
great project
Actually the architecture is fairly similar to PyLucene, since it 
doesn't use a Java interpreter but rather compiles the Java code using 
gcj and then wraps that using SWIG - basically equivalent to compiling 
C++ code and wrapping that with SWIG.

Cheers
David

Conrad Steenberg wrote:

>Hi David
>
>You might also want to check out Xapian at http://www.xapian.org
>"""
>Xapian is an Open Source Probabilistic Information Retrieval library,
>released under the GPL. It's written in C++, with bindings to allow use
>from other languages (Perl, Python, PHP, Java, and TCL are currently
>supported; Guile and C# are being worked on).
>"""
>
>Calling Java code from Python just seems rather offensive to the
>minimalist beauty I associate with Python ;-)
>
>Cheers
>
>Conrad
>
>On Tue, 2005-08-16 at 14:39 +0200, David Fraser wrote:
>  
>
>>We use PyLucene too and its fantastic, but just be aware that if you run 
>>Apache in multi-threaded mode (e.g. under Windows) there are conflicts 
>>with the gcj threading (for which there are also workarounds, mainly 
>>running a separate process for PyLucene)
>>
>>Julien wrote:
>>
>>    
>>
>>>Why not using PyLucene ? http://pylucene.osafoundation.org/
>>>
>>>It's a SWIG python port of Java Lucene, and it works perfeclty with
>>>mod_python (we use it every day here at work)
>>>
>>>On Tue, 2005-08-16 at 15:53 +0530, Manjeet Chaudhary wrote:
>>> 
>>>
>>>      
>>>
>>>>Hello All
>>>>
>>>>I am using mod_python and Lucene for searching of Arabic Text from an 
>>>>Index created using Lucene+Java.
>>>>I am facing some problems in running "java" command using mod_python.
>>>>
>>>>1.   I am trying to run java program using "os.system" command.
>>>>   Check = os.system("java ..........")
>>>>
>>>>2.   The command returns me a value of 256.
>>>>   i.e Check = 256
>>>>
>>>>3.   I am not able to figure it out why that java program is not being 
>>>>executed properly.
>>>>
>>>>4.   For the java program i have set the classpath and compiling and 
>>>>running that program using the classpath.
>>>>
>>>>   export CLASSPATH = 
>>>>/home/ajinkyan/cgi-bin/infoviewer/Jar_Files/lucene-1.4.3.jar 
>>>>:/home/ajinkyan/cgi-bin/infoviewer/Jar_Files/PDFBox-0.6.7a.jar 
>>>>:/home/ajinkyan/cgi-bin/infoviewer/Jar_Files/log4j-1.2.8.jar 
>>>>:/home/ajinkyan/cgi-bin/infoviewer/Jar_Files/tm-extractors-0.4.jar 
>>>>:/home/ajinkyan/cgi-bin/infoviewer/Jar_Files/ArabicAnalyzer-1.0b.jar 
>>>>:/home/ajinkyan/cgi-bin/infoviewer/Jar_Files/commons-collections-3.1.jar
>>>>
>>>>   javac -classpath $CLASSPATH:. SearchFiles.java
>>>>
>>>>   java -classpath $ClASSPATH:. SearchFiles
>>>>
>>>>5.   SearchFiles program is running properly if i run it from shell.
>>>>
>>>>So please help me and tell where i am going wrong.
>>>>I have attached the copy of code at the end .
>>>>
>>>>Thank you
>>>>Manjeet Chaudhary
>>>>
>>>>
>>>>
>>>>#!/usr/bin/env python
>>>>"""
>>>>#-------------------------------------------------------------------------------------------------------
>>>>#Name:       ar_search.py
>>>>#Version:    1.0
>>>>#Purpose:    Searching for Infoviewer
>>>>#Author:     Alok Khandelwal
>>>>#Created:    10-08-2005
>>>>#Licence:    Infogrid Pacific EULA
>>>>#--------------------------------------------------------------------------------------------------------
>>>>#Revision History
>>>>#--------------------------------------------------------------------------------------------------------
>>>>
>>>>#----------------Different modules required are imported 
>>>>here-------------------
>>>>"""
>>>>import cgitb,cgi,sys
>>>>cgitb.enable()
>>>>import os
>>>>        
>>>>
>>>>from os.path import join, abspath
>>>>from mod_python import apache,util,Session
>>>      
>>>
>>>>"""
>>>>#----------------End of importing 
>>>>modules----------------------------------------
>>>>
>>>>
>>>>def search(req):
>>>>
>>>>   """This part takes Arabic keyword from req variable and write that 
>>>>keyword into a temp file. This temp file will be opened by java program 
>>>>and that program will take that value and search for the variable in the 
>>>>index file.
>>>>Java program will store the result in results.txt file"""
>>>>
>>>>   The_Form = util.FieldStorage(req)
>>>>   for name in The_Form.keys():
>>>>       #--------Checking for the selected Fields and turning those flag 
>>>>on--------
>>>>       if name == 'search_contents':
>>>>           value=The_Form[name]
>>>>           value.encode('utf-8')
>>>>           f=open("/home/ajinkyan/cgi-bin/infoviewer/temp.txt","w")
>>>>           f.write(value)
>>>>           f.close()
>>>>
>>>>           try:
>>>>               command = "export 
>>>>CLASSPATH=/home/ajinkyan/cgi-bin/infoviewer/Jar_Files/lucene-1.4.3.jar:/home/ajinkyan/cgi-bin/infoviewer/Jar_Files/PDFBox-0.6.7a.jar:/home/ajinkyan/cgi-bin/infoviewer/Jar_Files/log4j-1.2.8.jar:/home/ajinkyan/cgi-bin/infoviewer/Jar_Files/tm-extractors-0.4.jar:/home/ajinkyan/cgi-bin/infoviewer/Jar_Files/ArabicAnalyzer-1.0b.jar:/home/ajinkyan/cgi-bin/infoviewer/Jar_Files/commons-collections-3.1.jar"
>>>>               import os
>>>>               os.system(command)
>>>>               command = "java -classpath 
>>>>$CLASSPATH:/home/ajinkyan/cgi-bin/infoviewer SearchFiles"
>>>>               check=os.system(command)
>>>>               req.write("\ncheck = " + str(check))
>>>>               f  = open(  
>>>>"/home/ajinkyan/cgi-bin/infoviewer/results.txt","r")
>>>>               result=f.read()
>>>>               req.write(result)
>>>>           except:
>>>>
>>>>               req.write("\n")
>>>>               req.write(str(sys.exc_type))
>>>>               req.write("\n")
>>>>               req.write(str(sys.exc_value))
>>>>
>>>>
>>>>
>>>>____________________________________________________________________________________________________________________________
>>>>
>>>># After executing the os.system command the value returned in check is 
>>>>maximum times 256 or some thing near 32000 .
>>>>
>>>># Java program is running independently without any errors. Only when it 
>>>>is called using os.system it doesn't run .
>>>>
>>>># The Java program is as follows
>>>>
>>>>___________________________________________________________________________________________________________________________
>>>>
>>>>
>>>>/**
>>>>* @Name   : SearchFiles.java
>>>>* @Version: 1.0
>>>>* @Author : Alok Khandelwal
>>>>* @Created: 2 August 2005
>>>>* @Purpose: Searching in index for arabic contents
>>>>* @Copyright:(c)2004 by Infogrid Pacific Pte. Ltd.
>>>>* @Licenece :Infogrid Pacific Eula
>>>>*/
>>>>
>>>>
>>>>
>>>>
>>>>import org.apache.lucene.search.Searcher;
>>>>import org.apache.lucene.search.IndexSearcher;
>>>>import org.apache.lucene.search.Query;
>>>>import org.apache.lucene.search.Hits;
>>>>import org.apache.lucene.queryParser.QueryParser;
>>>>import gpl.pierrick.brihaye.aramorph.lucene.ArabicStemAnalyzer;
>>>>import java.io.*;
>>>>import org.apache.lucene.document.Document;
>>>>class SearchFiles
>>>>{
>>>>   public static void main(String[] args)
>>>>   {
>>>>       try
>>>>       {
>>>>           FileInputStream fis = new FileInputStream(new File ( 
>>>>"/home/ajinkyan/cgi-bin/infoviewer/temp.txt"));
>>>>           BufferedReader in = new BufferedReader(new 
>>>>InputStreamReader(fis,"UTF8"));
>>>>           char [] buf = new char[80];
>>>>           int numRead;
>>>>           numRead=in.read(buf,0,80);
>>>>           String field="\"";
>>>>           for(int k=0;k<numRead;k++)
>>>>           {
>>>>               field=field+buf[k];
>>>>           }
>>>>           field=field+"\"";
>>>>           FileOutputStream fos = new FileOutputStream(new File ( 
>>>>"/home/ajinkyan/cgi-bin/infoviewer/results.txt"));
>>>>           BufferedWriter out = new BufferedWriter(new 
>>>>OutputStreamWriter(fos,"UTF8"));
>>>>           Searcher searcher = new 
>>>>IndexSearcher("/home/ajinkyan/cgi-bin/infoviewer/index_arabic");
>>>>           try
>>>>           {
>>>>                   Query query = QueryParser.parse(field, "contents", 
>>>>new ArabicStemAnalyzer());
>>>>                   Hits hits = searcher.search(query);
>>>>                   String output="Total match document = \n";
>>>>                   for(int j=0;j<hits.length();j++)
>>>>                   {
>>>>                       Document doc = hits.doc(j);
>>>>                   //    System.out.print(hits.score(j)+"  ");
>>>>                       output = output +"\n"+ doc.get("filename");
>>>>                   }
>>>>                   out.write(output);
>>>>                   out.write("\n");
>>>>           }
>>>>           catch(Exception e)
>>>>           {
>>>>               out.write("Parser Error");
>>>>               out.write("\n");
>>>>
>>>>           }
>>>>           searcher.close();
>>>>           out.close();
>>>>       }
>>>>       catch (Exception e)
>>>>       {
>>>>           String s= " caught a " + e.getClass() +
>>>>            "\n with message: " + e.getMessage();
>>>>       }
>>>>   }//end of main
>>>>}//end of SerchFiles
>>>>_______________________________________________
>>>>Mod_python mailing list
>>>>Mod_python@modpython.org
>>>>http://mailman.modpython.org/mailman/listinfo/mod_python
>>>>
>>>>   
>>>>
>>>>        
>>>>
>>_______________________________________________
>>Mod_python mailing list
>>Mod_python@modpython.org
>>http://mailman.modpython.org/mailman/listinfo/mod_python
>>    
>>

From davidf at sjsoft.com  Wed Aug 17 11:51:17 2005
From: davidf at sjsoft.com (David Fraser)
Date: Wed Aug 17 11:51:40 2005
Subject: [mod_python] Problem in executing java program using mod_python.
In-Reply-To: <200508170954.58044.jgentil@sebistar.net>
References: <4301BEAB.8030501@infogridpacific.com>	<4301DE9E.3020401@sjsoft.com>	<43031AF4.5060804@infogridpacific.com>
	<200508170954.58044.jgentil@sebistar.net>
Message-ID: <43035CF5.5070401@sjsoft.com>

Jon-Pierre Gentil wrote:

>On Wednesday 17 August 2005 06:09 am, Manjeet Chaudhary wrote:
>
>  
>
>>I want to pull Java Lucene into Python: PyLucene.I have an
>>"ArabicAnalyzer.jar" file in Java and i want to use in Python.I have
>>gone through a documentation of how to convert Java into Python using
>>"gcj" and "swig" , but i am confused about how to go about.
>>    
>>
>
>This would be the perfect reason to have mod_jython.   :-)
>
>But otherwise, the only way I can think of to integrate it without 
>seriously hacking something up is to create a XMLRPC wrapper service in 
>Java and have it running on the machine with the web server, and do 
>XMLRPC calls to it.
>  
>
Have a look at how PyLucene works: it's Java code compiled with gcj and 
wrapped with Swig, so there's no jython or Java interpreter.
Andi Vadja's answer on pylucene-dev (see below) is basically that the 
same could be done to other Java code...
Andi Vajda wrote:

> It shouldn't be too hard to create a custom build with the arabic 
> analyzer.
> Take a look at PyLucene's Makefile around line 426. If this analyzer 
> is similar in structure to the other ones, you can add its files to 
> the $(ANALYZERS_JAR) file and follow the same pattern in PyLucene.i as 
> for the other analyzer APIs declared in there.
> If this is too complicated and the LICENSE for your analyzer allows 
> it, ie, it is compatible with PyLucene's LICENSE (see LICENSE file) I 
> can include it in the next release of PyLucene which should happen 
> shortly after Java Lucene 1.9 is released.
>
> Concerning mod_python use, see the pylucene-dev list archives 
> regarding threading issues.
>
> Andi.. 


From igp-dev at infogridpacific.com  Thu Aug 18 01:01:11 2005
From: igp-dev at infogridpacific.com (IGP)
Date: Thu Aug 18 01:02:15 2005
Subject: [mod_python] Performance Problem
Message-ID: <43041617.10100@infogridpacific.com>

I am accessing dbxml via my mod-python handler.
The dbxml manager instance is created  , the container is opened and the 
required operation
is performed(querying , geting a document ) for each client request . 
This is affecting the
performance . Is there any way to enhance the performance ? I mean that 
the XmlManager instance
will be created only once , the container will be opened and the stored 
in memory , so that the
response time will decrease .
I am using following versions of software
1) dbxml -  2.1.8
2) python - 2.3.4
3) mod-python - 1.3.4
4) apache 2.0.52
5) Kernel version-2.6.9-5.0.5-EL

Please do reply if you know the solution .
Thanks in Advance,
Regards,
Ajinkya

From igp-dev at infogridpacific.com  Thu Aug 18 01:02:45 2005
From: igp-dev at infogridpacific.com (IGP)
Date: Thu Aug 18 01:02:46 2005
Subject: [mod_python] Load Testing Tools 
Message-ID: <43041675.5040006@infogridpacific.com>

Hello friends,
I am working on developing a website using dbxml , mod-python , pxtl and 
python programming.
I want to do load testing for it.
Can you suggest any testing tool to do it ?
I want to check the no. of requests served (concurrent ), memory usage , 
etc. of the apache server


 I am using following versions of software

1) dbxml -  2.1.8
2) python - 2.3.4
3) mod-python - 1.3.4
4) apache 2.0.52
5) Kernel version-2.6.9-5.0.5-EL
6) Operating System - CentOS 4.0
7) CPU - P4 2.26GHZ
8) Ram Size - 1 GB RAM
9) Swap Memory -1 GB
10) PXTL 1.4

Please do reply if you know any tool.

Thanks in Advance,
Regards,
Ajinkya

From igp-dev at infogridpacific.com  Thu Aug 18 01:06:01 2005
From: igp-dev at infogridpacific.com (IGP)
Date: Thu Aug 18 01:06:08 2005
Subject: [mod_python] PXTL processing performance issue
Message-ID: <43041739.4000206@infogridpacific.com>

Hello friends,
I am working on developing a website using dbxml , mod-python , pxtl and 
python programming.

I am using PXTL template processing language with mod-python
I want to know are there any known issues regarding performance .
I am using following versions of software

1) dbxml -  2.1.8
2) python - 2.3.4
3) mod-python - 1.3.4
4) apache 2.0.52
5) Kernel version-2.6.9-5.0.5-EL
6) Operating System - CentOS 4.0
7) CPU - P4 2.26GHZ
8) Ram Size - 1 GB RAM
9) Swap Memory -1 GB
10) PXTL 1.4

Also, i process the .px file in my mod-python handler as follows
def handler(req):
....
....
....
import pxtl
pxtl.processFile(x.px ,writer = req )

Please let me know .
Thanks in Advance
Regards ,
Ajinkya

From grahamd at dscpl.com.au  Thu Aug 18 01:24:36 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Thu Aug 18 01:24:43 2005
Subject: [mod_python] Load Testing Tools 
Message-ID: <1124342676.17953@dscpl.user.openhosting.com>

IGP wrote ..
> Hello friends,
> I am working on developing a website using dbxml , mod-python , pxtl and
> python programming.
> I want to do load testing for it.
> Can you suggest any testing tool to do it ?
> I want to check the no. of requests served (concurrent ), memory usage
> , 
> etc. of the apache server
> 
> 
>  I am using following versions of software
> 
> 1) dbxml -  2.1.8
> 2) python - 2.3.4
> 3) mod-python - 1.3.4
> 4) apache 2.0.52
> 5) Kernel version-2.6.9-5.0.5-EL
> 6) Operating System - CentOS 4.0
> 7) CPU - P4 2.26GHZ
> 8) Ram Size - 1 GB RAM
> 9) Swap Memory -1 GB
> 10) PXTL 1.4
> 
> Please do reply if you know any tool.

You can start with "ab". This tool is provided with Apache and can be used
to do some simple load testing. BTW, you keep stating version 1.3.4 of
mod_python. Are you really sure about that?

Usage: ab [options] [http://]hostname[:port]/path
Options are:
    -n requests     Number of requests to perform
    -c concurrency  Number of multiple requests to make
    -t timelimit    Seconds to max. wait for responses
    -p postfile     File containg data to POST
    -T content-type Content-type header for POSTing
    -v verbosity    How much troubleshooting info to print
    -w              Print out results in HTML tables
    -i              Use HEAD instead of GET
    -x attributes   String to insert as table attributes
    -y attributes   String to insert as tr attributes
    -z attributes   String to insert as td or th attributes
    -C attribute    Add cookie, eg. 'Apache=1234' (repeatable)
    -H attribute    Add Arbitrary header line, eg. 'Accept-Encoding: zop'
                    Inserted after all normal header lines. (repeatable)
    -A attribute    Add Basic WWW Authentication, the attributes
                    are a colon separated username and password.
    -P attribute    Add Basic Proxy Authentication, the attributes
                    are a colon separated username and password.
    -X proxy:port   Proxyserver and port number to use
    -V              Print version number and exit
    -k              Use HTTP KeepAlive feature
    -d              Do not show percentiles served table.
    -S              Do not show confidence estimators and warnings.
    -g filename     Output collected data to gnuplot format file.
    -e filename     Output CSV file with percentages served
    -h              Display usage information (this message)

From igp-dev at infogridpacific.com  Thu Aug 18 01:26:50 2005
From: igp-dev at infogridpacific.com (IGP)
Date: Thu Aug 18 01:26:51 2005
Subject: [mod_python] Importing a module
Message-ID: <43041C1A.7060806@infogridpacific.com>

Hello friends,

Does importing a module inside a mod-python handler affect the performance ?
I am using Publisher Handler of mod-python .
Please reply .
Thanks in Advance,
Ajinkya
From igp-dev at infogridpacific.com  Thu Aug 18 01:39:35 2005
From: igp-dev at infogridpacific.com (IGP)
Date: Thu Aug 18 01:39:35 2005
Subject: [mod_python] Global Variables
Message-ID: <43041F17.1090107@infogridpacific.com>

Does using global variables in mod-python handler affect the performance ?
I am using Publisher handler as follows :-
....
x #global variable
y  #global variable
....
def func1(req):
    .....
    .....
    use x and y
    .....
    .....

def func2(req):

    .....
    use x and y
    .....

please do reply
Thanks in advance ,
Regards ,
Ajinkya
From grahamd at dscpl.com.au  Thu Aug 18 01:46:17 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Thu Aug 18 01:46:23 2005
Subject: [mod_python] Load Testing Tools
Message-ID: <1124343977.557@dscpl.user.openhosting.com>

IGP wrote ..
> Graham Dumpleton wrote:
> >You can start with "ab". This tool is provided with Apache and can be
> used
> >to do some simple load testing. BTW, you keep stating version 1.3.4 of
> >mod_python. Are you really sure about that?
> >
> >Usage: ab [options] [http://]hostname[:port]/path
> >Options are:
> >    -n requests     Number of requests to perform
> >    -c concurrency  Number of multiple requests to make
> >    -t timelimit    Seconds to max. wait for responses
> >    -p postfile     File containg data to POST
> >    -T content-type Content-type header for POSTing
> >    -v verbosity    How much troubleshooting info to print
> >    -w              Print out results in HTML tables
> >    -i              Use HEAD instead of GET
> >    -x attributes   String to insert as table attributes
> >    -y attributes   String to insert as tr attributes
> >    -z attributes   String to insert as td or th attributes
> >    -C attribute    Add cookie, eg. 'Apache=1234' (repeatable)
> >    -H attribute    Add Arbitrary header line, eg. 'Accept-Encoding: zop'
> >                    Inserted after all normal header lines. (repeatable)
> >    -A attribute    Add Basic WWW Authentication, the attributes
> >                    are a colon separated username and password.
> >    -P attribute    Add Basic Proxy Authentication, the attributes
> >                    are a colon separated username and password.
> >    -X proxy:port   Proxyserver and port number to use
> >    -V              Print version number and exit
> >    -k              Use HTTP KeepAlive feature
> >    -d              Do not show percentiles served table.
> >    -S              Do not show confidence estimators and warnings.
> >    -g filename     Output collected data to gnuplot format file.
> >    -e filename     Output CSV file with percentages served
> >    -h              Display usage information (this message)
> >
> >
> Sorry,
> I am using mod-python version 3.1.4
> If i want to make 100 concurrent requests to a particular host how do i
> make it using ab tool
> is it > ab -n 100 -c 100 host
> or just >  ab -c 100 host

I would suggest you try reading the manual page for "ab". It will explain
the options in more detail.

The first of the above will cause 100 concurrent requests. In the second,
although you specify 100 concurrent, it will only do one request in total
because you didn't specify a number.

BTW, you might want to be careful about bombarding the list with multiple
emails on slightly different variations of the same topic. Do this and you
are less likely to get a useful response than if you had clearly explained
it all in one email.

Graham
From grahamd at dscpl.com.au  Thu Aug 18 06:08:18 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Thu Aug 18 06:09:12 2005
Subject: [mod_python] Performance Problem
In-Reply-To: <43041617.10100@infogridpacific.com>
References: <43041617.10100@infogridpacific.com>
Message-ID: <9d60173a2abaa58020a697dce9e4143e@dscpl.com.au>

Combined responses for some of your questions spread over multiple 
emails.

> Does using global variables in mod-python handler affect the 
> performance ?

No.

This is because the variable is still local to the module as it exists
within a specific interpreter. A global variable is NOT shared between
processes or multiple interpreters within the same process. I make this
point as based on past questions, some have had the misconception that
they are.

> Does importing a module inside a mod-python handler affect the 
> performance ?

Presuming that you are using "import" statement, not that you would 
notice.

Any overhead is the same as if you had done the same thing in a regular
Python script. This would amount to a check of sys.modules on subsequent
requests, ie., dictionary lookup, to see that the module had already 
been
loaded. The module is not loaded more than once.

I can't comment on performance issues related to the specific packages
you are using.

Graham

From jcigar at ulb.ac.be  Thu Aug 18 07:25:02 2005
From: jcigar at ulb.ac.be (Julien)
Date: Thu Aug 18 07:24:51 2005
Subject: [mod_python] Performance Problem
In-Reply-To: <43041617.10100@infogridpacific.com>
References: <43041617.10100@infogridpacific.com>
Message-ID: <1124364302.709.6.camel@horologium>

I don't think it's possible (not sure) because mod_python starts many
python instances, so mod_python cannot keep python objects ...

you could use cPicklet to serialize / deserialize (depends on usage ...)

On Thu, 2005-08-18 at 10:31 +0530, IGP wrote:
> I am accessing dbxml via my mod-python handler.
> The dbxml manager instance is created  , the container is opened and the 
> required operation
> is performed(querying , geting a document ) for each client request . 
> This is affecting the
> performance . Is there any way to enhance the performance ? I mean that 
> the XmlManager instance
> will be created only once , the container will be opened and the stored 
> in memory , so that the
> response time will decrease .
> I am using following versions of software
> 1) dbxml -  2.1.8
> 2) python - 2.3.4
> 3) mod-python - 1.3.4
> 4) apache 2.0.52
> 5) Kernel version-2.6.9-5.0.5-EL
> 
> Please do reply if you know the solution .
> Thanks in Advance,
> Regards,
> Ajinkya
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
> 
-- 
Julien Cigar (jcigar@ulb.ac.be)
Belgian Biodiversity Information Facility
Universit? Libre de Bruxelles
Campus de la Plaine CP 257
B?timent NO, Bureau 4 N4 115C (Niveau 4)
Boulevard du Triomphe, entr?e ULB 2
B-1050 Bruxelles
http://www.bebif.be

From sorr at rightnow.com  Thu Aug 18 10:15:01 2005
From: sorr at rightnow.com (Orr, Steve)
Date: Thu Aug 18 10:15:08 2005
Subject: [mod_python] Performance Problem
Message-ID: <E418CEC8B5FB3E48B30FA22F092886E7F3AF86@RNT-BOZ-0201.corp.rightnow.com>

I can't see that mod_python would be the problem. For a given request,
what percentage of the overall response time is involved with database
access versus code execution? You need to know that. I'd first try
tuning the code before doing any web stuff. Especially tune the database
queries and the network access to the database before going through the
web server. Then setup database connection pooling so each page request
reuses a connection instead of establishing a new connection with each
page turn. Can you do some kind of session management to avoid repop'ing
"the container" with each page turn?

Using ab I did some bench marking a year ago and with an old, cheap Dell
2GHz PC with 512M RAM as the web server I was able to get 750 page turns
per second. The database was Oracle and I used the connection pooling
feature that comes with cx_Oracle on the OCI. (A persistent connection
can be established for each Apache process so this isn't really
necessary.) I also reused cursors to avoid the parsing overhead.
(Besides doing web development I'm a DBA dweeb.) Without mod_python and
connection pooling it got as slow as 11 requests per second. Of course
my benchmarking was doing simple stuff but I was satisfied that
Apache/mod_python would perform well and I wouldn't have to go down a
"Twisted" path. Don't know anything about dbxml but you should address
the architecture/code first. If performance is really a big issue then
consider load balanced web servers and a good disk array setup on the db
server. 


Steve Orr


-----Original Message-----
From: mod_python-bounces@modpython.org
[mailto:mod_python-bounces@modpython.org] On Behalf Of IGP
Sent: Wednesday, August 17, 2005 11:01 PM
To: xml@sleepycat.com; mod_python@modpython.org
Subject: [mod_python] Performance Problem

I am accessing dbxml via my mod-python handler.
The dbxml manager instance is created  , the container is opened and the

required operation
is performed(querying , geting a document ) for each client request . 
This is affecting the
performance . Is there any way to enhance the performance ? I mean that 
the XmlManager instance
will be created only once , the container will be opened and the stored 
in memory , so that the
response time will decrease .
I am using following versions of software
1) dbxml -  2.1.8
2) python - 2.3.4
3) mod-python - 1.3.4
4) apache 2.0.52
5) Kernel version-2.6.9-5.0.5-EL

Please do reply if you know the solution .
Thanks in Advance,
Regards,
Ajinkya

_______________________________________________
Mod_python mailing list
Mod_python@modpython.org
http://mailman.modpython.org/mailman/listinfo/mod_python


From grahamd at dscpl.com.au  Thu Aug 18 18:18:44 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Thu Aug 18 18:19:11 2005
Subject: [mod_python] Performance Problem
Message-ID: <1124403524.30907@dscpl.user.openhosting.com>

Julien wrote ..
> I don't think it's possible (not sure) because mod_python starts many
> python instances, so mod_python cannot keep python objects ...

This is not strictly true.

For any particular Python interpreter, that is generally 1 per process,
the modules once loaded into the interpreter will remain loaded. The
value of any global data within a specific module is thus retained
between requests which hit that specific interpreter.

Obviously, different interpreters will have their own copy of the data
value, but at least for the one interpreter, successive requests can
make use of any cached data. As mentioned by Mike, this cached
data could be a database connection pool.

Graham
From rambiusparkisanius at gmail.com  Fri Aug 19 16:12:32 2005
From: rambiusparkisanius at gmail.com (Ivan Ivanov)
Date: Fri Aug 19 16:12:35 2005
Subject: [mod_python] PythonConnectionHandler help
Message-ID: <89ce7f7405081913124f0d3a1b@mail.gmail.com>

Dear Colleagues,

I downloaded mod_python two days ago and I successfully built in,
installed it on my Apache instance and tested it. I also tried all of
the examples given in [1]. I have only one question regarding
PythonConnectionHandler[2]. When I add PythonConnectionHandler in my
httpd.conf I receive a syntax error when starting apache:

C:\Program Files\ApacheGroup\Apache2\bin>Apache.exe -t
Syntax error on line 297 of C:/Program
Files/ApacheGroup/Apache2/conf/httpd.conf:
PythonConnectionHandler not allowed here

Here is the relevent part of my httpd.conf:

<Directory "C:/Program Files/ApacheGroup/Apache2/htdocs/test">
    AddHandler mod_python .py
    PythonConnectionHandler echo
</Directory>

I tried this also on Linux (Fedora Core 2) with the same result. Could
you please point me what I am doing wrong.

Regards
Ivan

[1]http://modpython.org/live/current/doc-html/
[2]http://modpython.org/live/current/doc-html/pyapi-conn.html

From trepca at gmail.com  Sat Aug 20 04:44:07 2005
From: trepca at gmail.com (Sebastjan Trepca)
Date: Sat Aug 20 04:44:25 2005
Subject: [mod_python] Performance Problem
In-Reply-To: <200508191600.j7JG05Hp023090@modpython.org>
References: <200508191600.j7JG05Hp023090@modpython.org>
Message-ID: <cd329af805082001442ad78501@mail.gmail.com>

> From: "Graham Dumpleton" <grahamd@dscpl.com.au>
> To: Julien <jcigar@ulb.ac.be>
> Date: Thu, 18 Aug 2005 18:18:44 -0400
> Subject: Re: [mod_python] Performance Problem
> Julien wrote ..
> > I don't think it's possible (not sure) because mod_python starts many
> > python instances, so mod_python cannot keep python objects ...
> 
> This is not strictly true.
> 
> For any particular Python interpreter, that is generally 1 per process,
> the modules once loaded into the interpreter will remain loaded. The
> value of any global data within a specific module is thus retained
> between requests which hit that specific interpreter.
> 
> Obviously, different interpreters will have their own copy of the data
> value, but at least for the one interpreter, successive requests can
> make use of any cached data. As mentioned by Mike, this cached
> data could be a database connection pool.
> 
> Graham

I use only one interpreter using PythonInterprete option so different
processes have same globals. Are there any performance issues with
this?

Sebastjan

From grahamd at dscpl.com.au  Sat Aug 20 05:16:06 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Sat Aug 20 05:16:12 2005
Subject: [mod_python] Performance Problem
Message-ID: <1124529366.18499@dscpl.user.openhosting.com>

Sebastjan Trepca wrote ..
> > From: "Graham Dumpleton" <grahamd@dscpl.com.au>
> > To: Julien <jcigar@ulb.ac.be>
> > Date: Thu, 18 Aug 2005 18:18:44 -0400
> > Subject: Re: [mod_python] Performance Problem
> > Julien wrote ..
> > > I don't think it's possible (not sure) because mod_python starts many
> > > python instances, so mod_python cannot keep python objects ...
> > 
> > This is not strictly true.
> > 
> > For any particular Python interpreter, that is generally 1 per process,
> > the modules once loaded into the interpreter will remain loaded. The
> > value of any global data within a specific module is thus retained
> > between requests which hit that specific interpreter.
> > 
> > Obviously, different interpreters will have their own copy of the data
> > value, but at least for the one interpreter, successive requests can
> > make use of any cached data. As mentioned by Mike, this cached
> > data could be a database connection pool.
> > 
> > Graham
> 
> I use only one interpreter using PythonInterprete option so different
> processes have same globals. Are there any performance issues with
> this?

It doesn't matter if you name the interpreter using PythonInterpreter,
each process will still has a unique instance of the interpreter with
that name, each with its own unique copies of the globals. Different
processes can never reference the same globals. Changing a global in
one process will not cause a global of the same name in a module to
be changed in other processes.

The only time a request handler will see a change made to a global by
a different request hander is when the two requests were against the
same interpreter within the same process. 

Thus a global data value accessed in a module is exactly the same as if
you were running a Python script from the command line, there is no
additional overhead and no performance issues to worry about.

If you want to have some special data value which can be accessed by
multiple Apache child processes, with each being able to change the
data and the change being reflected in all, then you would need to use
something like shared memory. This would involve some extra overhead,
but it requires you to explicitly code your system to use shared memory
and dea with all the locking and contention issues, it isn't how
mod_python works normally.

Use of shared memory is an advanced topic and I wouldn't recommend
you contemplate it until you understood quiet well how mod_python
works.

Graham


From trepca at gmail.com  Sat Aug 20 05:43:04 2005
From: trepca at gmail.com (Sebastjan Trepca)
Date: Sat Aug 20 05:43:08 2005
Subject: [mod_python] Performance Problem
In-Reply-To: <1124529366.18499@dscpl.user.openhosting.com>
References: <1124529366.18499@dscpl.user.openhosting.com>
Message-ID: <cd329af805082002431a82181f@mail.gmail.com>

Thanks for reply, I read the docs again and got this on the
PythonInterpreter directive:

"This directive can be used to force execution that would normally
occur in different subinterpreters to run in the same one. When
specified in the DocumentRoot, it forces the whole server to run in
one subinterpreter."

What does "forces whole server to run in one subinterpreter" then mean?

Sebastjan

On 20/08/05, Graham Dumpleton <grahamd@dscpl.com.au> wrote:
> Sebastjan Trepca wrote ..
> > > From: "Graham Dumpleton" <grahamd@dscpl.com.au>
> > > To: Julien <jcigar@ulb.ac.be>
> > > Date: Thu, 18 Aug 2005 18:18:44 -0400
> > > Subject: Re: [mod_python] Performance Problem
> > > Julien wrote ..
> > > > I don't think it's possible (not sure) because mod_python starts many
> > > > python instances, so mod_python cannot keep python objects ...
> > >
> > > This is not strictly true.
> > >
> > > For any particular Python interpreter, that is generally 1 per process,
> > > the modules once loaded into the interpreter will remain loaded. The
> > > value of any global data within a specific module is thus retained
> > > between requests which hit that specific interpreter.
> > >
> > > Obviously, different interpreters will have their own copy of the data
> > > value, but at least for the one interpreter, successive requests can
> > > make use of any cached data. As mentioned by Mike, this cached
> > > data could be a database connection pool.
> > >
> > > Graham
> >
> > I use only one interpreter using PythonInterprete option so different
> > processes have same globals. Are there any performance issues with
> > this?
> 
> It doesn't matter if you name the interpreter using PythonInterpreter,
> each process will still has a unique instance of the interpreter with
> that name, each with its own unique copies of the globals. Different
> processes can never reference the same globals. Changing a global in
> one process will not cause a global of the same name in a module to
> be changed in other processes.
> 
> The only time a request handler will see a change made to a global by
> a different request hander is when the two requests were against the
> same interpreter within the same process.
> 
> Thus a global data value accessed in a module is exactly the same as if
> you were running a Python script from the command line, there is no
> additional overhead and no performance issues to worry about.
> 
> If you want to have some special data value which can be accessed by
> multiple Apache child processes, with each being able to change the
> data and the change being reflected in all, then you would need to use
> something like shared memory. This would involve some extra overhead,
> but it requires you to explicitly code your system to use shared memory
> and dea with all the locking and contention issues, it isn't how
> mod_python works normally.
> 
> Use of shared memory is an advanced topic and I wouldn't recommend
> you contemplate it until you understood quiet well how mod_python
> works.
> 
> Graham
> 
> 
>

From trepca at gmail.com  Sat Aug 20 06:02:28 2005
From: trepca at gmail.com (Sebastjan Trepca)
Date: Sat Aug 20 06:02:31 2005
Subject: [mod_python] Performance Problem
In-Reply-To: <cd329af805082002431a82181f@mail.gmail.com>
References: <1124529366.18499@dscpl.user.openhosting.com>
	<cd329af805082002431a82181f@mail.gmail.com>
Message-ID: <cd329af80508200302eabe676@mail.gmail.com>

Ah, sorry about that question. As I understand it means that you
basicaly can set the intepreter that gets copied to all processes that
are spawned, else blank interpreter is used. If your globals doesn't
change this would be quite useful then, da? But not quite for caching.
I'll probably use the combination of mod_python with
MemCache(http://www.danga.com/memcached/). Anyone tried that?

Thanks, Sebastjan

On 20/08/05, Sebastjan Trepca <trepca@gmail.com> wrote:
> Thanks for reply, I read the docs again and got this on the
> PythonInterpreter directive:
> 
> "This directive can be used to force execution that would normally
> occur in different subinterpreters to run in the same one. When
> specified in the DocumentRoot, it forces the whole server to run in
> one subinterpreter."
> 
> What does "forces whole server to run in one subinterpreter" then mean?
> 
> Sebastjan
> 
> On 20/08/05, Graham Dumpleton <grahamd@dscpl.com.au> wrote:
> > Sebastjan Trepca wrote ..
> > > > From: "Graham Dumpleton" <grahamd@dscpl.com.au>
> > > > To: Julien <jcigar@ulb.ac.be>
> > > > Date: Thu, 18 Aug 2005 18:18:44 -0400
> > > > Subject: Re: [mod_python] Performance Problem
> > > > Julien wrote ..
> > > > > I don't think it's possible (not sure) because mod_python starts many
> > > > > python instances, so mod_python cannot keep python objects ...
> > > >
> > > > This is not strictly true.
> > > >
> > > > For any particular Python interpreter, that is generally 1 per process,
> > > > the modules once loaded into the interpreter will remain loaded. The
> > > > value of any global data within a specific module is thus retained
> > > > between requests which hit that specific interpreter.
> > > >
> > > > Obviously, different interpreters will have their own copy of the data
> > > > value, but at least for the one interpreter, successive requests can
> > > > make use of any cached data. As mentioned by Mike, this cached
> > > > data could be a database connection pool.
> > > >
> > > > Graham
> > >
> > > I use only one interpreter using PythonInterprete option so different
> > > processes have same globals. Are there any performance issues with
> > > this?
> >
> > It doesn't matter if you name the interpreter using PythonInterpreter,
> > each process will still has a unique instance of the interpreter with
> > that name, each with its own unique copies of the globals. Different
> > processes can never reference the same globals. Changing a global in
> > one process will not cause a global of the same name in a module to
> > be changed in other processes.
> >
> > The only time a request handler will see a change made to a global by
> > a different request hander is when the two requests were against the
> > same interpreter within the same process.
> >
> > Thus a global data value accessed in a module is exactly the same as if
> > you were running a Python script from the command line, there is no
> > additional overhead and no performance issues to worry about.
> >
> > If you want to have some special data value which can be accessed by
> > multiple Apache child processes, with each being able to change the
> > data and the change being reflected in all, then you would need to use
> > something like shared memory. This would involve some extra overhead,
> > but it requires you to explicitly code your system to use shared memory
> > and dea with all the locking and contention issues, it isn't how
> > mod_python works normally.
> >
> > Use of shared memory is an advanced topic and I wouldn't recommend
> > you contemplate it until you understood quiet well how mod_python
> > works.
> >
> > Graham
> >
> >
> >
>

From grahamd at dscpl.com.au  Sat Aug 20 06:05:46 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Sat Aug 20 06:05:56 2005
Subject: [mod_python] Performance Problem
Message-ID: <1124532346.18091@dscpl.user.openhosting.com>

Sebastjan Trepca wrote ..
> Thanks for reply, I read the docs again and got this on the
> PythonInterpreter directive:
> 
> "This directive can be used to force execution that would normally
> occur in different subinterpreters to run in the same one. When
> specified in the DocumentRoot, it forces the whole server to run in
> one subinterpreter."
> 
> What does "forces whole server to run in one subinterpreter" then mean?

In general it means that within a specific Apache child subprocess, that
no matter what the URL, or the virtual host they are directed to, all
the requests will be handled by Python code executing within one Python
interpreter instance. Note that I said "within a specific Apache child
subprocess". You can't change the fact that on UNIX, each subprocess has
its own memory and thus even if there are interpreters with the same
name in each, they have distinct copies of data.

For most installations of Apache/mod_python this would be the case
anyway regardless of whether you set PythonInterpreter. This is because
mod_python creates a default interpreter instance with name
corresponding to the virtual host name, ie. the name of the web site.
Since most sites go by one name, there will thus only be one interpreter,
unless specific action is taken by setting PythonInterpreter,
PythonInterpPerDirective, or PythonInterpPerDirectory to create
additional interpreters for some subset of the URL namespace.

The purpose of PythonInterpreter is thus for where a server might host
multiple virtual hosts and instead of requests for each virtual host being
handled in separate interpreters, you want to force them all to be handled
in the same interpreter.

In summary, it doesn't at all cause different Apache child subprocesses
to somehow magically start sharing data.

Graham
From grahamd at dscpl.com.au  Sat Aug 20 06:19:46 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Sat Aug 20 06:19:54 2005
Subject: [mod_python] Performance Problem
Message-ID: <1124533186.27444@dscpl.user.openhosting.com>

Sebastjan Trepca wrote ..
> Ah, sorry about that question. As I understand it means that you
> basicaly can set the intepreter that gets copied to all processes that
> are spawned, else blank interpreter is used. If your globals doesn't
> change this would be quite useful then, da? But not quite for caching.

Sorry, still not quite right. Interpreters are not copied from anywhere.
Each interpreter is always effectively blank when first created. They
are created fresh direct within the child subprocess, they aren't copied
from the main Apache process. Upon being created an interpreter is
loaded with any builtin Python modules and then the mod_python
"_apache" and "apache" modules, but that is it. Only other modules
which might be loaded at startup are those specified using the
PythonImport directive. Subsequently for the specific request, the
module for a handler might then also be loaded etc.

There is nothing magic about differently named interpreters, whether
they be explicitly named or the default ones based on virtual host name,
they are just a way of maintaining some seperation between web
applications so they don't interfere with each other by clobbering
each others data and/or modules.

Graham
From trepca at gmail.com  Sat Aug 20 06:44:48 2005
From: trepca at gmail.com (Sebastjan Trepca)
Date: Sat Aug 20 06:45:03 2005
Subject: [mod_python] Performance Problem
In-Reply-To: <1124533186.27444@dscpl.user.openhosting.com>
References: <1124533186.27444@dscpl.user.openhosting.com>
Message-ID: <cd329af8050820034472891d69@mail.gmail.com>

I see. Maybe this should be added to the docs so it will be more
clearer of what "in one subintepreter" mean.
Anyway, thank you very much for your patience and explanations :)

Sebastjan

On 20/08/05, Graham Dumpleton <grahamd@dscpl.com.au> wrote:
> Sebastjan Trepca wrote ..
> > Ah, sorry about that question. As I understand it means that you
> > basicaly can set the intepreter that gets copied to all processes that
> > are spawned, else blank interpreter is used. If your globals doesn't
> > change this would be quite useful then, da? But not quite for caching.
> 
> Sorry, still not quite right. Interpreters are not copied from anywhere.
> Each interpreter is always effectively blank when first created. They
> are created fresh direct within the child subprocess, they aren't copied
> from the main Apache process. Upon being created an interpreter is
> loaded with any builtin Python modules and then the mod_python
> "_apache" and "apache" modules, but that is it. Only other modules
> which might be loaded at startup are those specified using the
> PythonImport directive. Subsequently for the specific request, the
> module for a handler might then also be loaded etc.
> 
> There is nothing magic about differently named interpreters, whether
> they be explicitly named or the default ones based on virtual host name,
> they are just a way of maintaining some seperation between web
> applications so they don't interfere with each other by clobbering
> each others data and/or modules.
> 
> Graham
>

From andrewjwilkinson at gmail.com  Sun Aug 21 10:43:57 2005
From: andrewjwilkinson at gmail.com (Andrew Wilkinson)
Date: Sun Aug 21 10:44:02 2005
Subject: [mod_python] Null bytes in parse_qs1 when using XmlHttpRequest
Message-ID: <71ff0e50050821074346dc4fcc@mail.gmail.com>

Hi,

I'm developing a website that uses the XmlHttpRequest and mod_python,
and it works great on both Firefox and Opera however when it comes to
Konqueror (3.4.2) I get the exception given below. I've checked the
url I'm passing to the xmlhttprequest object
(http://localhost/gigs/xml.py?action=suggest&type=ALL&name=Fra) and
it's fine, when I take that an use it as a normal url it works as
expected.

I'm not sure if this is a bug in mod_python, Konqueror, or I've done
something wrong.

Thanks in advance for any help,
Regards,
Andrew Wilkinson


Mod_python error: "PythonHandler handler"

Traceback (most recent call last):

  File "/usr/lib/python2.4/site-packages/mod_python/apache.py", line
299, in HandlerDispatch
    result = object(req)

  File "/home/andrew/programming/ukgigs/handler.py", line 26, in handler
    fs = util.FieldStorage(req)

  File "/usr/lib/python2.4/site-packages/mod_python/util.py", line
114, in __init__
    pairs = parse_qsl(req.read(clen), keep_blank_values)

TypeError: argument 1 must be string without null bytes, not str

From arnaudsj at mac.com  Mon Aug 22 09:30:33 2005
From: arnaudsj at mac.com (=?ISO-8859-1?Q?S=E9bastien_Arnaud?=)
Date: Mon Aug 22 09:30:23 2005
Subject: [mod_python] Issues in apache MPM mode
Message-ID: <BAYC1-PASMTP041D5EEAD0FEBE59FF952EA5B60@cez.ice>

Hi,

I have developed over time a small web application framework over  
mod_python, in order to help me write applications quickly and  
cleanly. I do intend to release it open source once I clean it up a  
little bit.

I wrote it with in mind targeting apache MPM (worker threaded), which  
seemed to me the best mode in apache to lead to high performance.  
Unfortunately, I am discovering that modules are getting reimported  
over and over in this mode, and this is causing apache processes/ 
threads to eventually exit with a segmentation fault :(
FYI the web application framework is Web Object Oriented (meaning  
that you map a python class to a url and view), and each page class  
is registered has a child of main site class, which is then assigned  
into a site pool. This leads to quite some memory utilization, but is  
VERY fast in terms of execution.

I saw that Graham had wrote a few patches to avoid those problems. Is  
there any hope to see those checked in mod_python source code any  
time soon? For the long term, can we expect to have a flawless  
mod_python behavior in threaded mode? or do we have to be like the  
mod_php folks and target only apache PREFORK mode?

I just need to know so that I can rewrite/adapt my framework if MPM  
is not going to be fixed for a while.

Thanks!

S?bastien




From jgentil at sebistar.net  Mon Aug 22 13:03:16 2005
From: jgentil at sebistar.net (Jon-Pierre Gentil)
Date: Mon Aug 22 13:03:39 2005
Subject: [mod_python] Issues in apache MPM mode
In-Reply-To: <BAYC1-PASMTP041D5EEAD0FEBE59FF952EA5B60@cez.ice>
References: <BAYC1-PASMTP041D5EEAD0FEBE59FF952EA5B60@cez.ice>
Message-ID: <200508221203.22232.jgentil@sebistar.net>

On Monday 22 August 2005 08:30 am, S?bastien Arnaud wrote:

> I wrote it with in mind targeting apache MPM (worker threaded), which
> seemed to me the best mode in apache to lead to high performance.
> Unfortunately, I am discovering that modules are getting reimported
> over and over in this mode, and this is causing apache processes/
> threads to eventually exit with a segmentation fault :(

I'm pretty sure that mod_python only works with the prefork version of 
Apache.


-- 
_________________________________________________________

  Jon-Pierre Gentil               PGP: 0x7E1CBA17
  jabber: jgentil@sebistar.net    web: www.sebistar.net
  "If you think education is expensive, try ignorance."
_________________________________________________________ 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 835 bytes
Desc: not available
Url : http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20050822/037521c7/attachment.bin
From narzola at seattleschools.org  Mon Aug 22 13:32:38 2005
From: narzola at seattleschools.org (Arzola, Nelson)
Date: Mon Aug 22 13:32:43 2005
Subject: [mod_python] Issues in apache MPM mode
Message-ID: <2F411EE71FA13140B4E830DCC8E74A3315EB7707@snocex01.seattleschools.org>

I've been running mod_python under both a threaded and pre-fork version of apache for about 4 months now.  I had a an extremely difficult time getting mod_python and ZSI to work together without getting a segfault.

My suggestion is that if you don't already know how, learn to use the ldd command.  Then run ldd against your "httpd" executable, the "python" executable, all of the apache modules and all of the python modules.  Make sure that there are no requests for the same library from two different directories.

On Solaris 10, you will need to make extensive use of the LDFLAGS="-R/some/lib/dir" in order to keep from getting the "wrong" libraries.  This is because Solaris 10 provides older versions of the libraries that you are likely to want to use in /usr/sfw/lib.  Since many programs also supply their own libraries, the situation is ripe for problems.

Don't bother with development until you are sure you have the library issue under control.


-----Original Message-----
From: mod_python-bounces@modpython.org [mailto:mod_python-bounces@modpython.org] On Behalf Of Jon-Pierre Gentil
Sent: Monday, August 22, 2005 10:03 AM
To: mod_python@modpython.org
Subject: Re: [mod_python] Issues in apache MPM mode

On Monday 22 August 2005 08:30 am, S?bastien Arnaud wrote:

> I wrote it with in mind targeting apache MPM (worker threaded), which
> seemed to me the best mode in apache to lead to high performance.
> Unfortunately, I am discovering that modules are getting reimported
> over and over in this mode, and this is causing apache processes/
> threads to eventually exit with a segmentation fault :(

I'm pretty sure that mod_python only works with the prefork version of 
Apache.


-- 
_________________________________________________________

  Jon-Pierre Gentil               PGP: 0x7E1CBA17
  jabber: jgentil@sebistar.net    web: www.sebistar.net
  "If you think education is expensive, try ignorance."
_________________________________________________________ 


From narzola at seattleschools.org  Mon Aug 22 13:36:54 2005
From: narzola at seattleschools.org (Arzola, Nelson)
Date: Mon Aug 22 13:36:56 2005
Subject: [mod_python] Issues in apache MPM mode
Message-ID: <2F411EE71FA13140B4E830DCC8E74A3315EB7708@snocex01.seattleschools.org>

My understanding is that mod_python actually starts a unique interpreter for each thread.  If you read the message in your log file carefully, it says "(Re)Importing".  You can verify that this is the case by starting the httpd process with -X flag (one process, one thread, do not detach from console).  You should only see one "(Re)Importing" message.


-----Original Message-----
From: mod_python-bounces@modpython.org [mailto:mod_python-bounces@modpython.org] On Behalf Of S?bastien Arnaud
Sent: Monday, August 22, 2005 6:31 AM
To: mod_python@modpython.org
Subject: [mod_python] Issues in apache MPM mode

Hi,

I have developed over time a small web application framework over  
mod_python, in order to help me write applications quickly and  
cleanly. I do intend to release it open source once I clean it up a  
little bit.

I wrote it with in mind targeting apache MPM (worker threaded), which  
seemed to me the best mode in apache to lead to high performance.  
Unfortunately, I am discovering that modules are getting reimported  
over and over in this mode, and this is causing apache processes/ 
threads to eventually exit with a segmentation fault :(
FYI the web application framework is Web Object Oriented (meaning  
that you map a python class to a url and view), and each page class  
is registered has a child of main site class, which is then assigned  
into a site pool. This leads to quite some memory utilization, but is  
VERY fast in terms of execution.

I saw that Graham had wrote a few patches to avoid those problems. Is  
there any hope to see those checked in mod_python source code any  
time soon? For the long term, can we expect to have a flawless  
mod_python behavior in threaded mode? or do we have to be like the  
mod_php folks and target only apache PREFORK mode?

I just need to know so that I can rewrite/adapt my framework if MPM  
is not going to be fixed for a while.

Thanks!

S?bastien




_______________________________________________
Mod_python mailing list
Mod_python@modpython.org
http://mailman.modpython.org/mailman/listinfo/mod_python


From nicolas.lehuen at gmail.com  Mon Aug 22 16:17:31 2005
From: nicolas.lehuen at gmail.com (Nicolas Lehuen)
Date: Mon Aug 22 16:18:08 2005
Subject: [mod_python] Issues in apache MPM mode
In-Reply-To: <BAYC1-PASMTP041D5EEAD0FEBE59FF952EA5B60@cez.ice>
References: <BAYC1-PASMTP041D5EEAD0FEBE59FF952EA5B60@cez.ice>
Message-ID: <c298f2d70508221317673604f2@mail.gmail.com>

Hi S?bastien,

What version of mod_python are you using ? I suppose you're using the
3.1.4and so, yes, there are a few bugs related to multi-threading and
module
reloadings. A lot of work has been done on mod_python since the
3.1.4release, but until now we haven't managed to make any release, so
the
bugfixes were only available to those who were adventurous enough to use the 
latest Subversion version. Anyway, a new 3.2.0-BETA version is currently 
being prepared and will be available soon (we are making sure that no 
show-stopping bugs are present in the beta version), so hopefully, you'll be 
able to use a better version in a few days.

FYI, you can access the bug tracking system here :
http://issues.apache.org/jira/browse/MODPYTHON

Here is the list of bug fixes / improvement that are currently included in 
the upcoming 3.2.0-BETA version :
http://issues.apache.org/jira/secure/ReleaseNote.jspa?version=11060&styleName=Html&projectId=10640&Create=Create

If you want to get the latest development version of mod_python, give your 
Subversion client this URL :
https://svn.apache.org/repos/asf/httpd/mod_python/trunk

AFAIK the CVS repository mentioned in the homepage is no longer used. It may 
be synchronized with the Subversion repository, but the reference repository 
is now under Subversion.

Regards,
Nicolas

2005/8/22, S?bastien Arnaud <arnaudsj@mac.com>:
> 
> Hi,
> 
> I have developed over time a small web application framework over
> mod_python, in order to help me write applications quickly and
> cleanly. I do intend to release it open source once I clean it up a
> little bit. 
> 
> I wrote it with in mind targeting apache MPM (worker threaded), which
> seemed to me the best mode in apache to lead to high performance.
> Unfortunately, I am discovering that modules are getting reimported
> over and over in this mode, and this is causing apache processes/
> threads to eventually exit with a segmentation fault :(
> FYI the web application framework is Web Object Oriented (meaning
> that you map a python class to a url and view), and each page class 
> is registered has a child of main site class, which is then assigned
> into a site pool. This leads to quite some memory utilization, but is
> VERY fast in terms of execution.
> 
> I saw that Graham had wrote a few patches to avoid those problems. Is 
> there any hope to see those checked in mod_python source code any
> time soon? For the long term, can we expect to have a flawless
> mod_python behavior in threaded mode? or do we have to be like the
> mod_php folks and target only apache PREFORK mode? 
> 
> I just need to know so that I can rewrite/adapt my framework if MPM
> is not going to be fixed for a while.
> 
> Thanks!
> 
> S?bastien
> 
> 
> 
> 
> _______________________________________________
> Mod_python mailing list 
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20050822/f0e6d1ab/attachment.html
From grahamd at dscpl.com.au  Mon Aug 22 18:08:31 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Mon Aug 22 18:08:40 2005
Subject: [mod_python] Issues in apache MPM mode
In-Reply-To: <200508221203.22232.jgentil@sebistar.net>
References: <BAYC1-PASMTP041D5EEAD0FEBE59FF952EA5B60@cez.ice>
	<200508221203.22232.jgentil@sebistar.net>
Message-ID: <cda8e8808257186127e8c291b76c2f7a@dscpl.com.au>


On 23/08/2005, at 3:03 AM, Jon-Pierre Gentil wrote:

> On Monday 22 August 2005 08:30 am, S?bastien Arnaud wrote:
>
>> I wrote it with in mind targeting apache MPM (worker threaded), which
>> seemed to me the best mode in apache to lead to high performance.
>> Unfortunately, I am discovering that modules are getting reimported
>> over and over in this mode, and this is causing apache processes/
>> threads to eventually exit with a segmentation fault :(
>
> I'm pretty sure that mod_python only works with the prefork version of
> Apache.

Win32 platform doesn't use prefork, it only uses a single process
with multithreaded MPM and that works okay, better if you have the
patches which were mentioned though.

Thus, at least with mod_python 3.X and Apache 2, you aren't restricted
to just prefork mode. If using mod_python 2.7.X and Apache 1.3 then
it would be a different matter, as that version of Apache only supports
prefork.

Graham


From grahamd at dscpl.com.au  Mon Aug 22 18:47:33 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Mon Aug 22 18:47:43 2005
Subject: [mod_python] Issues in apache MPM mode
In-Reply-To: <2F411EE71FA13140B4E830DCC8E74A3315EB7708@snocex01.seattleschools.org>
References: <2F411EE71FA13140B4E830DCC8E74A3315EB7708@snocex01.seattleschools.org>
Message-ID: <9f38b2af62b6b0979f6264284666c165@dscpl.com.au>


On 23/08/2005, at 3:36 AM, Arzola, Nelson wrote:

> My understanding is that mod_python actually starts a unique 
> interpreter for each thread.

When using a multithreaded MPM, the creation of the threads in the
thread pool is handled by Apache and not mod_python/Python. There is no
association of specific threads to specific interpreters within a child
process. Regardless of which thread it is, when mod_python is handed a
request by Apache for processing, it will invoke the handler in whatever
interpreter is appropriate for the URL.

This means that if two requests come in for the same URL at the same
time, then both threads will be routed through to the same handler in
the same interpreter. In other words, there can be more than one thread
executing within the context of a specific interpreter at any one time.
They may be executing the same handler or different handlers.

Upon a subsequent request, these same threads may execute against a
different interpreter if the URL mapped to a part of the URL namespace
managed under the context of a distinct interpreter.

> If you read the message in your log file carefully, it says 
> "(Re)Importing".  You can verify that this is the case by starting the 
> httpd process with -X flag (one process, one thread, do not detach 
> from console).  You should only see one "(Re)Importing" message.

Don't read too much into these messages. All this message is saying is
that a specific module has been loaded for the first time, or if the
automatic reloading option is turned on and the code file changed, that
it is being reloaded.

Unfortunately it doesn't distinguish between these two different cases.
It would be nice if it said "Importing" on the first load and
"Reimporting" on the subsequent reload as it would make things clearer.
It would certainly make it easier to detect when the multithreaded bug
related to interpreter creation and module loading has occurred as more
people might then realise there was a problem due to seeing multiple
"Importing" messages at the same time for the same module in the same
interpreter and search out the fix for the bug rather than just assuming
that mod_python doesn't work or is too hard to get working. :-(

Graham

From igp-dev at infogridpacific.com  Tue Aug 23 02:12:56 2005
From: igp-dev at infogridpacific.com (M Chaudhary)
Date: Tue Aug 23 02:13:46 2005
Subject: [mod_python] Performance Problem
In-Reply-To: <E418CEC8B5FB3E48B30FA22F092886E7F3AF86@RNT-BOZ-0201.corp.rightnow.com>
References: <E418CEC8B5FB3E48B30FA22F092886E7F3AF86@RNT-BOZ-0201.corp.rightnow.com>
Message-ID: <430ABE68.2000407@infogridpacific.com>

Hello Orr, Steve ,
        As you told i tested my application using "ab" tool for three 
cases (each for single request and 5 concurrent requests ):-
and the results were as follows (the following log was generated from my 
mod-python handler itself using time.time() method ) ----
Attached is the test module . Please check it and view the following 
results.
#---------------------------------------------------------------------------------------------------
# Test 1 -- dbxml :- get a document and write it to browser
#---------------------------------------------------------------------------------------------------
0.00605797767639 # single request
0.0058479309082
0.00573110580444
0.148849010468
0.00549292564392
0.00417685508728 # 5 concurrent requests
0.00559282302856
0.00551891326904
0.00600981712341
0.00549983978271
#---------------------------------------------------------------------------------------------------
# Test 2 -- pxtl :- pxtl process a File and write it to browser
#---------------------------------------------------------------------------------------------------
1.65334200859 # single request
0.25177192688
0.261835098267
0.294239997864
0.000832080841064
0.428733825684 # 5 concurrent requests
0.440675020218
0.269226074219
0.237013816833
0.13219499588
#---------------------------------------------------------------------------------------------------
# Test 3 -- pxtl  and dbxml :- get a document from dbxml container ,pxtl 
process it and write it to browser
#---------------------------------------------------------------------------------------------------
3.01918792725 # single request
13.4880371094
14.6321718693
15.9680738449   # 5 concurrent requests
16.1954669952
0.010479927063
17.400357008
12.5239679813
11.8724710941
10.8379950523
#---------------------------------------------------------------------------------------------------

As you can see the first problem is that when i test it for 5 concurrent 
request i get 9 entries in my log file
each in each case.
And the second but most annoying problem is for Test 3 ( for both pxtl 
and dbxml ) it takes more than 10 seconds
to satisfy each request .
Even i tested my application on Upgraded Kernel (2.6.9-11.EL).
Should i use any other Linux distribution.
Can you tell me what the problem may be ? And what should i do ?

Regards,
Ajinkya N


Orr, Steve wrote:

>I can't see that mod_python would be the problem. For a given request,
>what percentage of the overall response time is involved with database
>access versus code execution? You need to know that. I'd first try
>tuning the code before doing any web stuff. Especially tune the database
>queries and the network access to the database before going through the
>web server. Then setup database connection pooling so each page request
>reuses a connection instead of establishing a new connection with each
>page turn. Can you do some kind of session management to avoid repop'ing
>"the container" with each page turn?
>
>Using ab I did some bench marking a year ago and with an old, cheap Dell
>2GHz PC with 512M RAM as the web server I was able to get 750 page turns
>per second. The database was Oracle and I used the connection pooling
>feature that comes with cx_Oracle on the OCI. (A persistent connection
>can be established for each Apache process so this isn't really
>necessary.) I also reused cursors to avoid the parsing overhead.
>(Besides doing web development I'm a DBA dweeb.) Without mod_python and
>connection pooling it got as slow as 11 requests per second. Of course
>my benchmarking was doing simple stuff but I was satisfied that
>Apache/mod_python would perform well and I wouldn't have to go down a
>"Twisted" path. Don't know anything about dbxml but you should address
>the architecture/code first. If performance is really a big issue then
>consider load balanced web servers and a good disk array setup on the db
>server. 
>
>
>Steve Orr
>
>
>-----Original Message-----
>From: mod_python-bounces@modpython.org
>[mailto:mod_python-bounces@modpython.org] On Behalf Of IGP
>Sent: Wednesday, August 17, 2005 11:01 PM
>To: xml@sleepycat.com; mod_python@modpython.org
>Subject: [mod_python] Performance Problem
>
>I am accessing dbxml via my mod-python handler.
>The dbxml manager instance is created  , the container is opened and the
>
>required operation
>is performed(querying , geting a document ) for each client request . 
>This is affecting the
>performance . Is there any way to enhance the performance ? I mean that 
>the XmlManager instance
>will be created only once , the container will be opened and the stored 
>in memory , so that the
>response time will decrease .
>I am using following versions of software
>1) dbxml -  2.1.8
>2) python - 2.3.4
>3) mod-python - 1.3.4
>4) apache 2.0.52
>5) Kernel version-2.6.9-5.0.5-EL
>
>Please do reply if you know the solution .
>Thanks in Advance,
>Regards,
>Ajinkya
>
>_______________________________________________
>Mod_python mailing list
>Mod_python@modpython.org
>http://mailman.modpython.org/mailman/listinfo/mod_python
>
>
>_______________________________________________
>Mod_python mailing list
>Mod_python@modpython.org
>http://mailman.modpython.org/mailman/listinfo/mod_python
>
>
>
>
>  
>
-------------- next part --------------
from mod_python import apache,util
import time
import pxtl # PXTL module
import dbxml_access # module for dbxml operations
reload(dbxml_access)
import config # configuration file
reload(config)
db_path = config.db_path # take database path location
connect = dbxml_access.DBXML_ACCESS() # create database access object
#--------------------------------------------------------------------------------------------------------
def test1(req):
    """
        This function returns the document from the dbxml container to the browser
    """
    try:
    	stime = time.time()
	document_id = 'none'
	The_Form = util.FieldStorage(req)
	for name in The_Form.keys():
			if name == 'document_id':
				document_id = The_Form[name].value # get the document_id requested from the database
			else:
				pass
	content = connect.get_document(document_id,db_path)  # get the document from the dbxml container
        req.content_type = "text/xml"
	req.write(content)
	etime = time.time()
	fp = open(config.log_path + 'test1.txt','a')
	fp.write('\n' + str(etime-stime))
	fp.close()
    except:
        req.write('Error Occured ')
#----------------------------------------------------------------------------------------------------
def test2(req):
    """
        This function just pxtl processes a file and writes it to browser
	The file should already exist
    """
    try:
        stime = time.time()
	document_id = 'none'
	The_Form = util.FieldStorage(req)
	for name in The_Form.keys():
			if name == 'document_id':
				document_id = The_Form[name].value # get the document_id requested from the database
			else:
				pass
	document_file_name = config.file_path + document_id + ".px"
	req.content_type = "text/xml"
	stime = time.time()
	pxtl.processFile(document_file_name,writer=req) # PXTL processing
	etime = time.time()
	fp = open(config.log_path + 'test2.txt','a')
	fp.write('\n' + str(etime-stime))
	fp.close()
    except:
        req.write('Error Occured ')
#----------------------------------------------------------------------------------------------------
def test3(req):
    """This function gets the document from the dbxml container , pxtl processes it and writes it to browser
    """
    try:
        stime = time.time()
	document_id = 'none'
	The_Form = util.FieldStorage(req)
	for name in The_Form.keys():
			if name == 'document_id':
				document_id = The_Form[name].value # get the document_id requested from the database
			else:
        			pass
	content = connect.get_document(document_id,db_path)# get the document from the dbxml container
	document_file_name = config.file_path + document_id + ".px"
	fp = open(document_file_name,"w")
	fp.write(content)
	fp.close()
	req.content_type = "text/xml"
	pxtl.processFile(document_file_name,writer=req)# PXTL processing
	fp.close()
	etime = time.time()
	fp = open(config.log_path + 'test3.txt','a')
	fp.write('\n' + str(etime-stime))
	fp.close()
    except:
        req.write('Error Occured ')
#----------------------------------------------------------------------------------------------------
From arnaudsj at mac.com  Tue Aug 23 08:23:09 2005
From: arnaudsj at mac.com (=?ISO-8859-1?Q?S=E9bastien_Arnaud?=)
Date: Tue Aug 23 08:23:00 2005
Subject: [mod_python] Issues in apache MPM mode
In-Reply-To: <c298f2d70508221317673604f2@mail.gmail.com>
References: <BAYC1-PASMTP041D5EEAD0FEBE59FF952EA5B60@cez.ice>
	<c298f2d70508221317673604f2@mail.gmail.com>
Message-ID: <BAYC1-PASMTP0200D1B199A25DD78F99B7A5A90@cez.ice>

Hi Nicolas,

Thank you for the heads up! Can't wait to test 3.2 !

I doubled checked and the production server I was testing on was  
running 3.1.3, so I went ahead and recompiled apache (2.0.54) and  
upgraded to 3.1.4. I will see if this makes a difference. If it does  
not then I will give a shot to compiling it from SVN.

Thanks Graham for the clarifications on the MPM. I will see if I can  
manage to get the proper behavior on the patched version of mod_python.

Thanks!

S?bastien



On Aug 22, 2005, at 4:17 PM, Nicolas Lehuen wrote:

> Hi S?bastien,
>
> What version of mod_python are you using ? I suppose you're using the
> 3.1.4and so, yes, there are a few bugs related to multi-threading and
> module
> reloadings. A lot of work has been done on mod_python since the
> 3.1.4release, but until now we haven't managed to make any release, so
> the
> bugfixes were only available to those who were adventurous enough  
> to use the
> latest Subversion version. Anyway, a new 3.2.0-BETA version is  
> currently
> being prepared and will be available soon (we are making sure that no
> show-stopping bugs are present in the beta version), so hopefully,  
> you'll be
> able to use a better version in a few days.
>
> FYI, you can access the bug tracking system here :
> http://issues.apache.org/jira/browse/MODPYTHON
>
> Here is the list of bug fixes / improvement that are currently  
> included in
> the upcoming 3.2.0-BETA version :
> http://issues.apache.org/jira/secure/ReleaseNote.jspa? 
> version=11060&styleName=Html&projectId=10640&Create=Create
>
> If you want to get the latest development version of mod_python,  
> give your
> Subversion client this URL :
> https://svn.apache.org/repos/asf/httpd/mod_python/trunk
>
> AFAIK the CVS repository mentioned in the homepage is no longer  
> used. It may
> be synchronized with the Subversion repository, but the reference  
> repository
> is now under Subversion.
>
> Regards,
> Nicolas
>
> 2005/8/22, S?bastien Arnaud <arnaudsj@mac.com>:
>
>>
>> Hi,
>>
>> I have developed over time a small web application framework over
>> mod_python, in order to help me write applications quickly and
>> cleanly. I do intend to release it open source once I clean it up a
>> little bit.
>>
>> I wrote it with in mind targeting apache MPM (worker threaded), which
>> seemed to me the best mode in apache to lead to high performance.
>> Unfortunately, I am discovering that modules are getting reimported
>> over and over in this mode, and this is causing apache processes/
>> threads to eventually exit with a segmentation fault :(
>> FYI the web application framework is Web Object Oriented (meaning
>> that you map a python class to a url and view), and each page class
>> is registered has a child of main site class, which is then assigned
>> into a site pool. This leads to quite some memory utilization, but is
>> VERY fast in terms of execution.
>>
>> I saw that Graham had wrote a few patches to avoid those problems. Is
>> there any hope to see those checked in mod_python source code any
>> time soon? For the long term, can we expect to have a flawless
>> mod_python behavior in threaded mode? or do we have to be like the
>> mod_php folks and target only apache PREFORK mode?
>>
>> I just need to know so that I can rewrite/adapt my framework if MPM
>> is not going to be fixed for a while.
>>
>> Thanks!
>>
>> S?bastien
>>
>>
>>
>>
>> _______________________________________________
>> Mod_python mailing list
>> Mod_python@modpython.org
>> http://mailman.modpython.org/mailman/listinfo/mod_python
>>
>


From grisha at modpython.org  Tue Aug 23 09:54:12 2005
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Tue Aug 23 09:54:31 2005
Subject: [mod_python] Issues in apache MPM mode
In-Reply-To: <BAYC1-PASMTP0200D1B199A25DD78F99B7A5A90@cez.ice>
References: <BAYC1-PASMTP041D5EEAD0FEBE59FF952EA5B60@cez.ice>
	<c298f2d70508221317673604f2@mail.gmail.com>
	<BAYC1-PASMTP0200D1B199A25DD78F99B7A5A90@cez.ice>
Message-ID: <20050823095324.U27607@grisha.dyndns.org>



On Tue, 23 Aug 2005, [ISO-8859-1] S?bastien Arnaud wrote:

> I doubled checked and the production server I was testing on was running 
> 3.1.3, so I went ahead and recompiled apache (2.0.54) and upgraded to 3.1.4.

Unfortunately, 3.1.4 is pretty much identical to 3.1.3 with the exception 
of a security fix.

Grisha
From Harold at giant-steps-networks.com  Tue Aug 23 12:56:18 2005
From: Harold at giant-steps-networks.com (Harold J. Ship)
Date: Tue Aug 23 11:56:43 2005
Subject: [mod_python] Apache doesn't start after new mod_python install
	(3.1.3)
Message-ID: <5B0ECC1928CB6C479A734A6BD6209EF0040C5D@exchange.Giant-Steps.local>


There is an old post with this title, however I couldn't find the solution.

We are trying to get Apache 2.0.54 or Apache 2.0.49 to run with mod-python version 3.1.3 and python 2.3 on arm-linux.

When we add the following line to httpd.conf, Apache won't start. Apache 2.0.49 won't start at all, and 2.0.54 sometimes yes, sometimes no with no apparent pattern. The line is:
LoadModule python_module modules/mod_python.so

In the error log file, we can see only one line: 
[Fri May 19 08:47:09 2000] [notice] mod_python: Creating 32 session mutexes based on 150 max processes and 0 max threads.

Thanks,

Harold Ship
Giant Steps Networks

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20050823/abd4b1ec/attachment.html
From zanesdad at bellsouth.net  Tue Aug 23 14:20:23 2005
From: zanesdad at bellsouth.net (Jeremy Jones)
Date: Tue Aug 23 14:29:25 2005
Subject: [mod_python] large file upload using mod_python
Message-ID: <430B68E7.7020108@bellsouth.net>

I am writing a little piece of code that will handle potentially large 
files, both for upload and download.  I tried the publisher handler, but 
it looks like the publisher handler reads in the whole request and then 
acts on it.  Since the file uploads (and downloads) may be really huge, 
I thought it would be best to get all the HTTP headers and then deal 
with the body of the POST.  Has anyone already done anything like this?  
It looks like I could create my own handler using a Connection object, 
but if someone's already done the work and released the code, no sense 
in reinventing fire.

Thanks,

Jeremy Jones
From sorr at rightnow.com  Tue Aug 23 14:40:28 2005
From: sorr at rightnow.com (Orr, Steve)
Date: Tue Aug 23 14:40:34 2005
Subject: [mod_python] Performance Problem
Message-ID: <E418CEC8B5FB3E48B30FA22F092886E701023A21@RNT-BOZ-0201.corp.rightnow.com>

Well obviously mod_python is performing well and I doubt anything
connected with Linux versions would account for that much difference so
the thing to focus on would be tuning dbxml or the code associated with
it. Don't you have a way to run/test chunks of code outside of a web
environment?

-----Original Message-----
From: M Chaudhary [mailto:igp-dev@infogridpacific.com] 
Sent: Tuesday, August 23, 2005 12:13 AM
To: mod_python@modpython.org
Cc: Orr, Steve; IGP; and@doxdesk.com; xml@sleepycat.com
Subject: Re: [mod_python] Performance Problem

Hello Orr, Steve ,
        As you told i tested my application using "ab" tool for three 
cases (each for single request and 5 concurrent requests ):-
and the results were as follows (the following log was generated from my

mod-python handler itself using time.time() method ) ----
Attached is the test module . Please check it and view the following 
results.
#-----------------------------------------------------------------------
----------------------------
# Test 1 -- dbxml :- get a document and write it to browser
#-----------------------------------------------------------------------
----------------------------
0.00605797767639 # single request
0.0058479309082
0.00573110580444
0.148849010468
0.00549292564392
0.00417685508728 # 5 concurrent requests
0.00559282302856
0.00551891326904
0.00600981712341
0.00549983978271
#-----------------------------------------------------------------------
----------------------------
# Test 2 -- pxtl :- pxtl process a File and write it to browser
#-----------------------------------------------------------------------
----------------------------
1.65334200859 # single request
0.25177192688
0.261835098267
0.294239997864
0.000832080841064
0.428733825684 # 5 concurrent requests
0.440675020218
0.269226074219
0.237013816833
0.13219499588
#-----------------------------------------------------------------------
----------------------------
# Test 3 -- pxtl  and dbxml :- get a document from dbxml container ,pxtl

process it and write it to browser
#-----------------------------------------------------------------------
----------------------------
3.01918792725 # single request
13.4880371094
14.6321718693
15.9680738449   # 5 concurrent requests
16.1954669952
0.010479927063
17.400357008
12.5239679813
11.8724710941
10.8379950523
#-----------------------------------------------------------------------
----------------------------

As you can see the first problem is that when i test it for 5 concurrent

request i get 9 entries in my log file
each in each case.
And the second but most annoying problem is for Test 3 ( for both pxtl 
and dbxml ) it takes more than 10 seconds
to satisfy each request .
Even i tested my application on Upgraded Kernel (2.6.9-11.EL).
Should i use any other Linux distribution.
Can you tell me what the problem may be ? And what should i do ?

Regards,
Ajinkya N


Orr, Steve wrote:

>I can't see that mod_python would be the problem. For a given request,
>what percentage of the overall response time is involved with database
>access versus code execution? You need to know that. I'd first try
>tuning the code before doing any web stuff. Especially tune the
database
>queries and the network access to the database before going through the
>web server. Then setup database connection pooling so each page request
>reuses a connection instead of establishing a new connection with each
>page turn. Can you do some kind of session management to avoid
repop'ing
>"the container" with each page turn?
>
>Using ab I did some bench marking a year ago and with an old, cheap
Dell
>2GHz PC with 512M RAM as the web server I was able to get 750 page
turns
>per second. The database was Oracle and I used the connection pooling
>feature that comes with cx_Oracle on the OCI. (A persistent connection
>can be established for each Apache process so this isn't really
>necessary.) I also reused cursors to avoid the parsing overhead.
>(Besides doing web development I'm a DBA dweeb.) Without mod_python and
>connection pooling it got as slow as 11 requests per second. Of course
>my benchmarking was doing simple stuff but I was satisfied that
>Apache/mod_python would perform well and I wouldn't have to go down a
>"Twisted" path. Don't know anything about dbxml but you should address
>the architecture/code first. If performance is really a big issue then
>consider load balanced web servers and a good disk array setup on the
db
>server. 
>
>
>Steve Orr
>
>
>-----Original Message-----
>From: mod_python-bounces@modpython.org
>[mailto:mod_python-bounces@modpython.org] On Behalf Of IGP
>Sent: Wednesday, August 17, 2005 11:01 PM
>To: xml@sleepycat.com; mod_python@modpython.org
>Subject: [mod_python] Performance Problem
>
>I am accessing dbxml via my mod-python handler.
>The dbxml manager instance is created  , the container is opened and
the
>
>required operation
>is performed(querying , geting a document ) for each client request . 
>This is affecting the
>performance . Is there any way to enhance the performance ? I mean that

>the XmlManager instance
>will be created only once , the container will be opened and the stored

>in memory , so that the
>response time will decrease .
>I am using following versions of software
>1) dbxml -  2.1.8
>2) python - 2.3.4
>3) mod-python - 1.3.4
>4) apache 2.0.52
>5) Kernel version-2.6.9-5.0.5-EL
>
>Please do reply if you know the solution .
>Thanks in Advance,
>Regards,
>Ajinkya
>
>_______________________________________________
>Mod_python mailing list
>Mod_python@modpython.org
>http://mailman.modpython.org/mailman/listinfo/mod_python
>
>
>_______________________________________________
>Mod_python mailing list
>Mod_python@modpython.org
>http://mailman.modpython.org/mailman/listinfo/mod_python
>
>
>
>
>  
>

From miked at dewhirst.com.au  Wed Aug 24 05:26:21 2005
From: miked at dewhirst.com.au (Mike Dewhirst)
Date: Wed Aug 24 05:26:47 2005
Subject: [mod_python] server misconfig error
Message-ID: <430C3D3D.8040603@dewhirst.com.au>

I have a problem which defeats me and would appreciate any assistance.

I'm just starting out with mod_python. I have two Apache servers on two 
WinXP machines. A desktop and a laptop. They are "identical" and one 
works while the other doesn't. Laptop Apache and mod_python works; the 
desktop don't.

I have checked for identical directory structures and installations of 
relevant software.

I'm using the same httpd.conf file for each. There must be something I'm 
missing.

Apache 2.0.50 and mod_python 3.1.3 and python 2.3.4 on both machines ...

The test I used to get started is ...

1. Straight HTML form (collect.html) which collects a few data items 
like this ...

<form name="frmCollect" method="post" action="/cgi-bin/collect.py"> etc

2. collect.py just builds a page from the collected data and prints it 
back to the browser to prove it all works. Nothing tricky and as I said 
above, my first attempt worked. The laptop's Apache server setup didn't 
miss a beat. It still works.

3. Time comes to replicate the setup using the desktop as a server and I 
promise I have taken two hours to do this - the browser on the laptop 
happily brings up desktop's collect.html but desktop's Apache barfs with 
the following ...

[Wed Aug 24 18:46:03 2005] [error] [client 192.168.0.38] (OS 3)The 
system cannot find the path specified.  : couldn't create child process: 
720003: collect.py, referer: http://192.168.0.22/collect.html
[Wed Aug 24 18:46:03 2005] [error] [client 192.168.0.38] (OS 3)The 
system cannot find the path specified.  : couldn't spawn child process: 
C:/apache/Apache2/htdocs/test/py/collect.py, referer: 
http://192.168.0.22/collect.html

laptop is 192.168.0.38 and I lied about identical httpd.conf files - I 
edited the server name on the desktop to reflect reality ie., 192.168.0.22

Here are some relevant portions of http.conf which are identical in both 
machines ...
#
DocumentRoot "C:/apache/Apache2/htdocs/test"
#
<Directory c:/apache/Apache2/htdocs/test/py>
    Options ExecCGI
    AllowOverride All
    AddHandler mod_python .py
    AddHandler cgi-script .py # PythonHandler *
    PythonDebug On
</Directory>
#
ScriptAlias /cgi-bin/ "C:/apache/Apache2/htdocs/test/py/"
<Directory "C:/apache/Apache2/htdocs/test/py">
    AllowOverride None
    Options None
    Order allow,deny
    Allow from all
</Directory>
#

Thanx

Mike

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20050824/5f7cac0f/attachment.html
From grahamd at dscpl.com.au  Wed Aug 24 05:41:43 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Wed Aug 24 05:41:53 2005
Subject: [mod_python] server misconfig error
In-Reply-To: <430C3D3D.8040603@dewhirst.com.au>
References: <430C3D3D.8040603@dewhirst.com.au>
Message-ID: <7e8611cabc92e1a7f0ef56c0dfc2b996@dscpl.com.au>

It looks like you are actually using a CGI script and aren't actually
using mod_python at all. The two AddHandler directives for the .py
extension are going to be in conflict. If you comment out

   AddHandler mod_python .py
   PythonDebug On

does your code still work on the box where it is working on so far?
This will confirm that mod_python isn't necessary for what you are
doing.

In other words, you don't need mod_python if all you want is a CGI
script that can be written using Python.

For an example of what a basic mod_python handler is actually about,
you might follow through the example in:

   http://www.dscpl.com.au/articles/modpython-001.html

Graham

On 24/08/2005, at 7:26 PM, Mike Dewhirst wrote:

> I have a problem which defeats me and would appreciate any assistance.
>
>  I'm just starting out with mod_python. I have two Apache servers on 
> two WinXP machines. A desktop and a laptop. They are "identical" and 
> one works while the other doesn't. Laptop Apache and mod_python works; 
> the desktop don't.
>
>  I have checked for identical directory structures and installations 
> of relevant software.
>
>  I'm using the same httpd.conf file for each. There must be something 
> I'm missing.
>
>  Apache 2.0.50 and mod_python 3.1.3 and python 2.3.4 on both machines 
> ...
>
>  The test I used to get started is ...
>
>  1. Straight HTML form (collect.html) which collects a few data items 
> like this ...
>
>  <form name="frmCollect" method="post" action="/cgi-bin/collect.py"> 
> etc
>
>  2. collect.py just builds a page from the collected data and prints 
> it back to the browser to prove it all works. Nothing tricky and as I 
> said above, my first attempt worked. The laptop's Apache server setup 
> didn't miss a beat. It still works.
>
>  3. Time comes to replicate the setup using the desktop as a server 
> and I promise I have taken two hours to do this - the browser on the 
> laptop happily brings up desktop's collect.html but desktop's Apache 
> barfs with the following ...
>
>  [Wed Aug 24 18:46:03 2005] [error] [client 192.168.0.38] (OS 3)The 
> system cannot find the path specified.? : couldn't create child 
> process: 720003: collect.py, referer: http://192.168.0.22/collect.html
>  [Wed Aug 24 18:46:03 2005] [error] [client 192.168.0.38] (OS 3)The 
> system cannot find the path specified.? : couldn't spawn child 
> process: C:/apache/Apache2/htdocs/test/py/collect.py, referer: 
> http://192.168.0.22/collect.html
>
>  laptop is 192.168.0.38 and I lied about identical httpd.conf files - 
> I edited the server name on the desktop to reflect reality ie., 
> 192.168.0.22
>
>  Here are some relevant portions of http.conf which are identical in 
> both machines ...
>  #
>  DocumentRoot "C:/apache/Apache2/htdocs/test"
>  #
>  <Directory c:/apache/Apache2/htdocs/test/py>
>  ??? Options ExecCGI
>  ??? AllowOverride All
>  ??? AddHandler mod_python .py
>  ??? AddHandler cgi-script .py # PythonHandler *
>  ??? PythonDebug On
>  </Directory>
>  #
>  ScriptAlias /cgi-bin/ "C:/apache/Apache2/htdocs/test/py/"
>  <Directory "C:/apache/Apache2/htdocs/test/py">
>  ??? AllowOverride None
>  ??? Options None
>  ??? Order allow,deny
>  ??? Allow from all
>  </Directory>
>  #
>
>  Thanx
>
>  Mike
>
>  _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python


From miked at dewhirst.com.au  Wed Aug 24 06:15:26 2005
From: miked at dewhirst.com.au (Mike Dewhirst)
Date: Wed Aug 24 06:15:41 2005
Subject: [mod_python] server misconfig error
In-Reply-To: <7e8611cabc92e1a7f0ef56c0dfc2b996@dscpl.com.au>
References: <430C3D3D.8040603@dewhirst.com.au>
	<7e8611cabc92e1a7f0ef56c0dfc2b996@dscpl.com.au>
Message-ID: <430C48BE.2090206@dewhirst.com.au>

Graham Dumpleton wrote:
> It looks like you are actually using a CGI script and aren't actually
> using mod_python at all. The two AddHandler directives for the .py
> extension are going to be in conflict. If you comment out
> 
>   AddHandler mod_python .py
>   PythonDebug On
> 
> does your code still work on the box where it is working on so far?

Yes it does !!

> This will confirm that mod_python isn't necessary for what you are
> doing.

OK - what I want to do is interface KinterbasDB and Firebird and I 
figured this might be a first (albeit parallel) step.

> In other words, you don't need mod_python if all you want is a CGI
> script that can be written using Python.
> 
> For an example of what a basic mod_python handler is actually about,
> you might follow through the example in:
> 
>   http://www.dscpl.com.au/articles/modpython-001.htm

Visiting as we speak - Thanks Graham

Regards

Mike

l
> 
> Graham
> 
> On 24/08/2005, at 7:26 PM, Mike Dewhirst wrote:
> 
>> I have a problem which defeats me and would appreciate any assistance.
>>
>>  I'm just starting out with mod_python. I have two Apache servers on 
>> two WinXP machines. A desktop and a laptop. They are "identical" and 
>> one works while the other doesn't. Laptop Apache and mod_python works; 
>> the desktop don't.
>>
>>  I have checked for identical directory structures and installations 
>> of relevant software.
>>
>>  I'm using the same httpd.conf file for each. There must be something 
>> I'm missing.
>>
>>  Apache 2.0.50 and mod_python 3.1.3 and python 2.3.4 on both machines ...
>>
>>  The test I used to get started is ...
>>
>>  1. Straight HTML form (collect.html) which collects a few data items 
>> like this ...
>>
>>  <form name="frmCollect" method="post" action="/cgi-bin/collect.py"> etc
>>
>>  2. collect.py just builds a page from the collected data and prints 
>> it back to the browser to prove it all works. Nothing tricky and as I 
>> said above, my first attempt worked. The laptop's Apache server setup 
>> didn't miss a beat. It still works.
>>
>>  3. Time comes to replicate the setup using the desktop as a server 
>> and I promise I have taken two hours to do this - the browser on the 
>> laptop happily brings up desktop's collect.html but desktop's Apache 
>> barfs with the following ...
>>
>>  [Wed Aug 24 18:46:03 2005] [error] [client 192.168.0.38] (OS 3)The 
>> system cannot find the path specified.  : couldn't create child 
>> process: 720003: collect.py, referer: http://192.168.0.22/collect.html
>>  [Wed Aug 24 18:46:03 2005] [error] [client 192.168.0.38] (OS 3)The 
>> system cannot find the path specified.  : couldn't spawn child 
>> process: C:/apache/Apache2/htdocs/test/py/collect.py, referer: 
>> http://192.168.0.22/collect.html
>>
>>  laptop is 192.168.0.38 and I lied about identical httpd.conf files - 
>> I edited the server name on the desktop to reflect reality ie., 
>> 192.168.0.22
>>
>>  Here are some relevant portions of http.conf which are identical in 
>> both machines ...
>>  #
>>  DocumentRoot "C:/apache/Apache2/htdocs/test"
>>  #
>>  <Directory c:/apache/Apache2/htdocs/test/py>
>>      Options ExecCGI
>>      AllowOverride All
>>      AddHandler mod_python .py
>>      AddHandler cgi-script .py # PythonHandler *
>>      PythonDebug On
>>  </Directory>
>>  #
>>  ScriptAlias /cgi-bin/ "C:/apache/Apache2/htdocs/test/py/"
>>  <Directory "C:/apache/Apache2/htdocs/test/py">
>>      AllowOverride None
>>      Options None
>>      Order allow,deny
>>      Allow from all
>>  </Directory>
>>  #
>>
>>  Thanx
>>
>>  Mike
>>
>>  _______________________________________________
>> Mod_python mailing list
>> Mod_python@modpython.org
>> http://mailman.modpython.org/mailman/listinfo/mod_python
> 
> 
> 
> 

From zanesdad at bellsouth.net  Wed Aug 24 12:11:36 2005
From: zanesdad at bellsouth.net (Jeremy Jones)
Date: Wed Aug 24 12:11:39 2005
Subject: [mod_python] large file upload using mod_python
In-Reply-To: <430B68E7.7020108@bellsouth.net>
References: <430B68E7.7020108@bellsouth.net>
Message-ID: <430C9C38.6010305@bellsouth.net>

Jeremy Jones wrote:

> I am writing a little piece of code that will handle potentially large 
> files, both for upload and download.  I tried the publisher handler, 
> but it looks like the publisher handler reads in the whole request and 
> then acts on it.  Since the file uploads (and downloads) may be really 
> huge, I thought it would be best to get all the HTTP headers and then 
> deal with the body of the POST.  Has anyone already done anything like 
> this?  It looks like I could create my own handler using a Connection 
> object, but if someone's already done the work and released the code, 
> no sense in reinventing fire.
>
> Thanks,
>
> Jeremy Jones
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
OK - I think I solved this and it was *really* easy.  I set this in my 
apache.conf:

<Directory /home/jmjones/public_html/file_upload>
        AddHandler mod_python .py
        PythonHandler upload
        PythonDebug On
</Directory>


And put this in a file called "upload.py" in my 
/home/jmjones/public_html/file_upload directory:

def handler(req):
    req.content_type = "text/plain"
    content_length = int(req.headers_in["Content-Length"])
    ret_str = ""
    outf = open("/tmp/upload_out.txt", "w")
    conn = req.connection
    i = 0
    ret_str += "\nbegin loop\n"
    while i < content_length:
        c = conn.read(1)
        if c == "":
            break
        ret_str += "%s %s\n" % (i, c)
        outf.write(c)
        outf.flush()
        i += 1
    ret_str += "end loop\n"
    outf.close()
    ret_str += "closed file\n"
    req.set_content_length(len(ret_str))
    req.write(ret_str)
    return apache.OK


I wrote a script to spoof a browser uploading a file, a portion of which 
it did at one byte per second.  I opened the file /tmp/upload_out.txt as 
it was reading it from the client and it was updating it as the client 
would write a byte, so this appears to be doing exactly what I wanted 
with not much code.

mod_python rocks!


Jeremy Jones
From JohnBlack at kashori.com  Wed Aug 24 22:08:55 2005
From: JohnBlack at kashori.com (John Black)
Date: Wed Aug 24 22:09:37 2005
Subject: [mod_python] mod_python.publisher - path traversal fails
Message-ID: <004d01c5a919$f46abe80$6401a8c0@kashori001>

I am working on a python application on a Red Hat Linux server running
Apache 2.0.48 with Python 2.2.3 and mod_python 3.1.4

I must not have something configured correctly and it seems to me that 
causes mod_python.publisher fails. If I do this:

http://domain.com/mytest.py

when I have configured:

<Directory /home/webadmin/domain.com/html>
    AddHandler mod_python .py
    PythonHandler mytest
    PythonDebug On
</Directory>

Then the default 'def handler(req):' works and prints "Hello World".


But if I try to do this:

http://domain.com/mytest.py

when I have configured:

<Directory /home/webadmin/domain.com/html>
    AddHandler mod_python .py
    PythonHandler mod_python.publisher
    PythonDebug On
</Directory>

Then I get a 404 error from Apache or a zero-byte return.


However, if I call this http://domain.com/mytes.py (deforming mytest to mytes) 
then I get this:
Mod_python error: "PythonHandler mod_python.publisher"

Traceback (most recent call last):

  File "/usr/lib/python2.2/site-packages/mod_python/apache.py", line 299, in HandlerDispatch
    result = object(req)

  File "/usr/lib/python2.2/site-packages/mod_python/publisher.py", line 98, in handler
    path=[path])

  File "/usr/lib/python2.2/site-packages/mod_python/apache.py", line 454, in import_module
    f, p, d = imp.find_module(parts[i], path)

ImportError: No module named mytesCheers,
John Black
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20050824/d2dfd951/attachment.html
From JohnBlack at kashori.com  Wed Aug 24 22:23:08 2005
From: JohnBlack at kashori.com (John Black)
Date: Wed Aug 24 22:23:19 2005
Subject: [mod_python] mod_python.publisher - path traversal fails
References: <004d01c5a919$f46abe80$6401a8c0@kashori001>
Message-ID: <006601c5a91b$f0bb8740$6401a8c0@kashori001>

Ok. Actually I was just trying to keep it simple. I 
realize that mod_python.publisher has a different 
way of handling calls than is used with def handler(req)
By the way, I have this code working on two other systems at 
home. The whole thing works perfectly. On my home system, 
when I use mod_python.publisher it is with a call like 

    http://domain.com/mytest.py/paramsTest

However, on the production server mentioned below, this 
does not work either. I still get the 404 error.

Cheers,
John
  Sent: Wednesday, August 24, 2005 10:08 PM


  I am working on a python application on a Red Hat Linux server running
  Apache 2.0.48 with Python 2.2.3 and mod_python 3.1.4

  I must not have something configured correctly and it seems to me that 
  causes mod_python.publisher fails. If I do this:

  http://domain.com/mytest.py

  when I have configured:

  <Directory /home/webadmin/domain.com/html>
      AddHandler mod_python .py
      PythonHandler mytest
      PythonDebug On
  </Directory>

  Then the default 'def handler(req):' works and prints "Hello World".


  But if I try to do this:

  http://domain.com/mytest.py

  when I have configured:

  <Directory /home/webadmin/domain.com/html>
      AddHandler mod_python .py
      PythonHandler mod_python.publisher
      PythonDebug On
  </Directory>

  Then I get a 404 error from Apache or a zero-byte return.


  However, if I call this http://domain.com/mytes.py (deforming mytest to mytes) 
  then I get this:
Mod_python error: "PythonHandler mod_python.publisher"

Traceback (most recent call last):

  File "/usr/lib/python2.2/site-packages/mod_python/apache.py", line 299, in HandlerDispatch
    result = object(req)

  File "/usr/lib/python2.2/site-packages/mod_python/publisher.py", line 98, in handler
    path=[path])

  File "/usr/lib/python2.2/site-packages/mod_python/apache.py", line 454, in import_module
    f, p, d = imp.find_module(parts[i], path)

ImportError: No module named mytesCheers,
  John Black



------------------------------------------------------------------------------


  _______________________________________________
  Mod_python mailing list
  Mod_python@modpython.org
  http://mailman.modpython.org/mailman/listinfo/mod_python
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20050824/d44cd63e/attachment.html
From igp-dev at infogridpacific.com  Thu Aug 25 01:51:19 2005
From: igp-dev at infogridpacific.com (M Chaudhary)
Date: Thu Aug 25 01:51:28 2005
Subject: [mod_python] Performance Problem
In-Reply-To: <E418CEC8B5FB3E48B30FA22F092886E701023A21@RNT-BOZ-0201.corp.rightnow.com>
References: <E418CEC8B5FB3E48B30FA22F092886E701023A21@RNT-BOZ-0201.corp.rightnow.com>
Message-ID: <430D5C57.2070709@infogridpacific.com>


Hello friends,

1) When I perform just file io it takes 0.00026 seconds.
        import time
        fp = open("xyz.html","r")
        s = fp.read()
        fp.close()
        stime = time.time()
        fp = open('xyz.px','w')
        fp.write(s)
        fp.close()
        etime = time.time()
        print etime-stime


2) When I perform just pxtl processing it takes 0.064 seconds.

        import time
        stime = time.time()
        import pxtl
        reload(pxtl)
        pxtl.processFile('xyz.px')
        etime = time.time()
        print etime-stime

3) When I perform pxtl processing along with file-io it takes 1.33 seconds.
        import time
        fp = open("xyz.html","r")
        s = fp.read()
        fp.close()
        stime = time.time()
        fp = open('xyz.px','w')
        fp.write(s)
        fp.close()
        import pxtl
        reload(pxtl)
        pxtl.processFile('xyz.px')
        etime = time.time()
        print etime-stime

As you can see there is a major difference in 1+2 and 3 .
Can you please tell me what the problem might be and what should i do ?
I am using PXTL for developing a website along with file io as PXTL does 
not support string processing .
Thanks in Advance.
Regards,
Ajinkya

Orr, Steve wrote:

>Well obviously mod_python is performing well and I doubt anything
>connected with Linux versions would account for that much difference so
>the thing to focus on would be tuning dbxml or the code associated with
>it. Don't you have a way to run/test chunks of code outside of a web
>environment?
>
>-----Original Message-----
>From: M Chaudhary [mailto:igp-dev@infogridpacific.com] 
>Sent: Tuesday, August 23, 2005 12:13 AM
>To: mod_python@modpython.org
>Cc: Orr, Steve; IGP; and@doxdesk.com; xml@sleepycat.com
>Subject: Re: [mod_python] Performance Problem
>
>Hello Orr, Steve ,
>        As you told i tested my application using "ab" tool for three 
>cases (each for single request and 5 concurrent requests ):-
>and the results were as follows (the following log was generated from my
>
>mod-python handler itself using time.time() method ) ----
>Attached is the test module . Please check it and view the following 
>results.
>#-----------------------------------------------------------------------
>----------------------------
># Test 1 -- dbxml :- get a document and write it to browser
>#-----------------------------------------------------------------------
>----------------------------
>0.00605797767639 # single request
>0.0058479309082
>0.00573110580444
>0.148849010468
>0.00549292564392
>0.00417685508728 # 5 concurrent requests
>0.00559282302856
>0.00551891326904
>0.00600981712341
>0.00549983978271
>#-----------------------------------------------------------------------
>----------------------------
># Test 2 -- pxtl :- pxtl process a File and write it to browser
>#-----------------------------------------------------------------------
>----------------------------
>1.65334200859 # single request
>0.25177192688
>0.261835098267
>0.294239997864
>0.000832080841064
>0.428733825684 # 5 concurrent requests
>0.440675020218
>0.269226074219
>0.237013816833
>0.13219499588
>#-----------------------------------------------------------------------
>----------------------------
># Test 3 -- pxtl  and dbxml :- get a document from dbxml container ,pxtl
>
>process it and write it to browser
>#-----------------------------------------------------------------------
>----------------------------
>3.01918792725 # single request
>13.4880371094
>14.6321718693
>15.9680738449   # 5 concurrent requests
>16.1954669952
>0.010479927063
>17.400357008
>12.5239679813
>11.8724710941
>10.8379950523
>#-----------------------------------------------------------------------
>----------------------------
>
>As you can see the first problem is that when i test it for 5 concurrent
>
>request i get 9 entries in my log file
>each in each case.
>And the second but most annoying problem is for Test 3 ( for both pxtl 
>and dbxml ) it takes more than 10 seconds
>to satisfy each request .
>Even i tested my application on Upgraded Kernel (2.6.9-11.EL).
>Should i use any other Linux distribution.
>Can you tell me what the problem may be ? And what should i do ?
>
>Regards,
>Ajinkya N
>
>
>Orr, Steve wrote:
>
>  
>
>>I can't see that mod_python would be the problem. For a given request,
>>what percentage of the overall response time is involved with database
>>access versus code execution? You need to know that. I'd first try
>>tuning the code before doing any web stuff. Especially tune the
>>    
>>
>database
>  
>
>>queries and the network access to the database before going through the
>>web server. Then setup database connection pooling so each page request
>>reuses a connection instead of establishing a new connection with each
>>page turn. Can you do some kind of session management to avoid
>>    
>>
>repop'ing
>  
>
>>"the container" with each page turn?
>>
>>Using ab I did some bench marking a year ago and with an old, cheap
>>    
>>
>Dell
>  
>
>>2GHz PC with 512M RAM as the web server I was able to get 750 page
>>    
>>
>turns
>  
>
>>per second. The database was Oracle and I used the connection pooling
>>feature that comes with cx_Oracle on the OCI. (A persistent connection
>>can be established for each Apache process so this isn't really
>>necessary.) I also reused cursors to avoid the parsing overhead.
>>(Besides doing web development I'm a DBA dweeb.) Without mod_python and
>>connection pooling it got as slow as 11 requests per second. Of course
>>my benchmarking was doing simple stuff but I was satisfied that
>>Apache/mod_python would perform well and I wouldn't have to go down a
>>"Twisted" path. Don't know anything about dbxml but you should address
>>the architecture/code first. If performance is really a big issue then
>>consider load balanced web servers and a good disk array setup on the
>>    
>>
>db
>  
>
>>server. 
>>
>>
>>Steve Orr
>>
>>
>>-----Original Message-----
>>From: mod_python-bounces@modpython.org
>>[mailto:mod_python-bounces@modpython.org] On Behalf Of IGP
>>Sent: Wednesday, August 17, 2005 11:01 PM
>>To: xml@sleepycat.com; mod_python@modpython.org
>>Subject: [mod_python] Performance Problem
>>
>>I am accessing dbxml via my mod-python handler.
>>The dbxml manager instance is created  , the container is opened and
>>    
>>
>the
>  
>
>>required operation
>>is performed(querying , geting a document ) for each client request . 
>>This is affecting the
>>performance . Is there any way to enhance the performance ? I mean that
>>    
>>
>
>  
>
>>the XmlManager instance
>>will be created only once , the container will be opened and the stored
>>    
>>
>
>  
>
>>in memory , so that the
>>response time will decrease .
>>I am using following versions of software
>>1) dbxml -  2.1.8
>>2) python - 2.3.4
>>3) mod-python - 1.3.4
>>4) apache 2.0.52
>>5) Kernel version-2.6.9-5.0.5-EL
>>
>>Please do reply if you know the solution .
>>Thanks in Advance,
>>Regards,
>>Ajinkya
>>
>>_______________________________________________
>>Mod_python mailing list
>>Mod_python@modpython.org
>>http://mailman.modpython.org/mailman/listinfo/mod_python
>>
>>
>>_______________________________________________
>>Mod_python mailing list
>>Mod_python@modpython.org
>>http://mailman.modpython.org/mailman/listinfo/mod_python
>>
>>
>>
>>
>> 
>>
>>    
>>
>
>_______________________________________________
>Mod_python mailing list
>Mod_python@modpython.org
>http://mailman.modpython.org/mailman/listinfo/mod_python
>
>
>
>
>  
>
From miked at dewhirst.com.au  Thu Aug 25 02:05:38 2005
From: miked at dewhirst.com.au (Mike Dewhirst)
Date: Thu Aug 25 02:05:52 2005
Subject: [mod_python] server misconfig error
In-Reply-To: <430C48BE.2090206@dewhirst.com.au>
References: <430C3D3D.8040603@dewhirst.com.au>
	<7e8611cabc92e1a7f0ef56c0dfc2b996@dscpl.com.au>
	<430C48BE.2090206@dewhirst.com.au>
Message-ID: <430D5FB2.7050701@dewhirst.com.au>

Mike Dewhirst wrote:

> Graham Dumpleton wrote:
>
>> It looks like you are actually using a CGI script and aren't actually
>> using mod_python at all. The two AddHandler directives for the .py
>> extension are going to be in conflict. If you comment out
>>
>>   AddHandler mod_python .py
>>   PythonDebug On
>>
>> does your code still work on the box where it is working on so far?
>
>
> Yes it does !!


Further to that ... not only was I labouring under that major 
misapprehension which you so gently pointed out, the reason one setup 
worked and the other didn't was the #! line at the top of the script. I 
have Python installed in different places on each machine. I decided to 
uninstall everything and start again on the failing machine but this 
time use Python 2.4 and Apache 2.0.54. As soon as I updated the #! line 
to the new python location it all started working.

I thought the the Apache error log indicating it couldn't find a file 
was referring to one of my python files.

Might remember that.

Thanks again

Mike

>
>> This will confirm that mod_python isn't necessary for what you are
>> doing.
>
>
> OK - what I want to do is interface KinterbasDB and Firebird and I 
> figured this might be a first (albeit parallel) step.
>
>> In other words, you don't need mod_python if all you want is a CGI
>> script that can be written using Python.
>>
>> For an example of what a basic mod_python handler is actually about,
>> you might follow through the example in:
>>
>>   http://www.dscpl.com.au/articles/modpython-001.htm
>
>
> Visiting as we speak - Thanks Graham
>
> Regards
>
> Mike

From grahamd at dscpl.com.au  Thu Aug 25 02:19:28 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Thu Aug 25 02:19:34 2005
Subject: [mod_python] Performance Problem
Message-ID: <1124950768.21296@dscpl.user.openhosting.com>

Why are you doing:

  reload(pxtl)

What is it about "import" that isn't enough?

M Chaudhary wrote ..
> 
> Hello friends,
> 
> 1) When I perform just file io it takes 0.00026 seconds.
>         import time
>         fp = open("xyz.html","r")
>         s = fp.read()
>         fp.close()
>         stime = time.time()
>         fp = open('xyz.px','w')
>         fp.write(s)
>         fp.close()
>         etime = time.time()
>         print etime-stime
> 
> 
> 2) When I perform just pxtl processing it takes 0.064 seconds.
> 
>         import time
>         stime = time.time()
>         import pxtl
>         reload(pxtl)
>         pxtl.processFile('xyz.px')
>         etime = time.time()
>         print etime-stime
> 
> 3) When I perform pxtl processing along with file-io it takes 1.33 seconds.
>         import time
>         fp = open("xyz.html","r")
>         s = fp.read()
>         fp.close()
>         stime = time.time()
>         fp = open('xyz.px','w')
>         fp.write(s)
>         fp.close()
>         import pxtl
>         reload(pxtl)
>         pxtl.processFile('xyz.px')
>         etime = time.time()
>         print etime-stime
> 
> As you can see there is a major difference in 1+2 and 3 .
> Can you please tell me what the problem might be and what should i do ?
> I am using PXTL for developing a website along with file io as PXTL does
> not support string processing .
> Thanks in Advance.
> Regards,
> Ajinkya
> 
> Orr, Steve wrote:
> 
> >Well obviously mod_python is performing well and I doubt anything
> >connected with Linux versions would account for that much difference so
> >the thing to focus on would be tuning dbxml or the code associated with
> >it. Don't you have a way to run/test chunks of code outside of a web
> >environment?
> >
> >-----Original Message-----
> >From: M Chaudhary [mailto:igp-dev@infogridpacific.com] 
> >Sent: Tuesday, August 23, 2005 12:13 AM
> >To: mod_python@modpython.org
> >Cc: Orr, Steve; IGP; and@doxdesk.com; xml@sleepycat.com
> >Subject: Re: [mod_python] Performance Problem
> >
> >Hello Orr, Steve ,
> >        As you told i tested my application using "ab" tool for three
> >cases (each for single request and 5 concurrent requests ):-
> >and the results were as follows (the following log was generated from
> my
> >
> >mod-python handler itself using time.time() method ) ----
> >Attached is the test module . Please check it and view the following 
> >results.
> >#-----------------------------------------------------------------------
> >----------------------------
> ># Test 1 -- dbxml :- get a document and write it to browser
> >#-----------------------------------------------------------------------
> >----------------------------
> >0.00605797767639 # single request
> >0.0058479309082
> >0.00573110580444
> >0.148849010468
> >0.00549292564392
> >0.00417685508728 # 5 concurrent requests
> >0.00559282302856
> >0.00551891326904
> >0.00600981712341
> >0.00549983978271
> >#-----------------------------------------------------------------------
> >----------------------------
> ># Test 2 -- pxtl :- pxtl process a File and write it to browser
> >#-----------------------------------------------------------------------
> >----------------------------
> >1.65334200859 # single request
> >0.25177192688
> >0.261835098267
> >0.294239997864
> >0.000832080841064
> >0.428733825684 # 5 concurrent requests
> >0.440675020218
> >0.269226074219
> >0.237013816833
> >0.13219499588
> >#-----------------------------------------------------------------------
> >----------------------------
> ># Test 3 -- pxtl  and dbxml :- get a document from dbxml container ,pxtl
> >
> >process it and write it to browser
> >#-----------------------------------------------------------------------
> >----------------------------
> >3.01918792725 # single request
> >13.4880371094
> >14.6321718693
> >15.9680738449   # 5 concurrent requests
> >16.1954669952
> >0.010479927063
> >17.400357008
> >12.5239679813
> >11.8724710941
> >10.8379950523
> >#-----------------------------------------------------------------------
> >----------------------------
> >
> >As you can see the first problem is that when i test it for 5 concurrent
> >
> >request i get 9 entries in my log file
> >each in each case.
> >And the second but most annoying problem is for Test 3 ( for both pxtl
> >and dbxml ) it takes more than 10 seconds
> >to satisfy each request .
> >Even i tested my application on Upgraded Kernel (2.6.9-11.EL).
> >Should i use any other Linux distribution.
> >Can you tell me what the problem may be ? And what should i do ?
> >
> >Regards,
> >Ajinkya N
> >
> >
> >Orr, Steve wrote:
> >
> >  
> >
> >>I can't see that mod_python would be the problem. For a given request,
> >>what percentage of the overall response time is involved with database
> >>access versus code execution? You need to know that. I'd first try
> >>tuning the code before doing any web stuff. Especially tune the
> >>    
> >>
> >database
> >  
> >
> >>queries and the network access to the database before going through the
> >>web server. Then setup database connection pooling so each page request
> >>reuses a connection instead of establishing a new connection with each
> >>page turn. Can you do some kind of session management to avoid
> >>    
> >>
> >repop'ing
> >  
> >
> >>"the container" with each page turn?
> >>
> >>Using ab I did some bench marking a year ago and with an old, cheap
> >>    
> >>
> >Dell
> >  
> >
> >>2GHz PC with 512M RAM as the web server I was able to get 750 page
> >>    
> >>
> >turns
> >  
> >
> >>per second. The database was Oracle and I used the connection pooling
> >>feature that comes with cx_Oracle on the OCI. (A persistent connection
> >>can be established for each Apache process so this isn't really
> >>necessary.) I also reused cursors to avoid the parsing overhead.
> >>(Besides doing web development I'm a DBA dweeb.) Without mod_python and
> >>connection pooling it got as slow as 11 requests per second. Of course
> >>my benchmarking was doing simple stuff but I was satisfied that
> >>Apache/mod_python would perform well and I wouldn't have to go down a
> >>"Twisted" path. Don't know anything about dbxml but you should address
> >>the architecture/code first. If performance is really a big issue then
> >>consider load balanced web servers and a good disk array setup on the
> >>    
> >>
> >db
> >  
> >
> >>server. 
> >>
> >>
> >>Steve Orr
> >>
> >>
> >>-----Original Message-----
> >>From: mod_python-bounces@modpython.org
> >>[mailto:mod_python-bounces@modpython.org] On Behalf Of IGP
> >>Sent: Wednesday, August 17, 2005 11:01 PM
> >>To: xml@sleepycat.com; mod_python@modpython.org
> >>Subject: [mod_python] Performance Problem
> >>
> >>I am accessing dbxml via my mod-python handler.
> >>The dbxml manager instance is created  , the container is opened and
> >>    
> >>
> >the
> >  
> >
> >>required operation
> >>is performed(querying , geting a document ) for each client request .
> >>This is affecting the
> >>performance . Is there any way to enhance the performance ? I mean that
> >>    
> >>
> >
> >  
> >
> >>the XmlManager instance
> >>will be created only once , the container will be opened and the stored
> >>    
> >>
> >
> >  
> >
> >>in memory , so that the
> >>response time will decrease .
> >>I am using following versions of software
> >>1) dbxml -  2.1.8
> >>2) python - 2.3.4
> >>3) mod-python - 1.3.4
> >>4) apache 2.0.52
> >>5) Kernel version-2.6.9-5.0.5-EL
> >>
> >>Please do reply if you know the solution .
> >>Thanks in Advance,
> >>Regards,
> >>Ajinkya
> >>
> >>_______________________________________________
> >>Mod_python mailing list
> >>Mod_python@modpython.org
> >>http://mailman.modpython.org/mailman/listinfo/mod_python
> >>
> >>
> >>_______________________________________________
> >>Mod_python mailing list
> >>Mod_python@modpython.org
> >>http://mailman.modpython.org/mailman/listinfo/mod_python
> >>
> >>
> >>
> >>
> >> 
> >>
> >>    
> >>
> >
> >_______________________________________________
> >Mod_python mailing list
> >Mod_python@modpython.org
> >http://mailman.modpython.org/mailman/listinfo/mod_python
> >
> >
> >
> >
> >  
> >
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
From igp-dev at infogridpacific.com  Thu Aug 25 02:31:09 2005
From: igp-dev at infogridpacific.com (M Chaudhary)
Date: Thu Aug 25 02:32:15 2005
Subject: [mod_python] Performance Problem
In-Reply-To: <1124950768.21296@dscpl.user.openhosting.com>
References: <1124950768.21296@dscpl.user.openhosting.com>
Message-ID: <430D65AD.1080405@infogridpacific.com>

Even if i remove    reload(pxtl)    ; there is no improvement.

Graham Dumpleton wrote:

>Why are you doing:
>
>  reload(pxtl)
>
>What is it about "import" that isn't enough?
>
>M Chaudhary wrote ..
>  
>
>>Hello friends,
>>
>>1) When I perform just file io it takes 0.00026 seconds.
>>        import time
>>        fp = open("xyz.html","r")
>>        s = fp.read()
>>        fp.close()
>>        stime = time.time()
>>        fp = open('xyz.px','w')
>>        fp.write(s)
>>        fp.close()
>>        etime = time.time()
>>        print etime-stime
>>
>>
>>2) When I perform just pxtl processing it takes 0.064 seconds.
>>
>>        import time
>>        stime = time.time()
>>        import pxtl
>>        reload(pxtl)
>>        pxtl.processFile('xyz.px')
>>        etime = time.time()
>>        print etime-stime
>>
>>3) When I perform pxtl processing along with file-io it takes 1.33 seconds.
>>        import time
>>        fp = open("xyz.html","r")
>>        s = fp.read()
>>        fp.close()
>>        stime = time.time()
>>        fp = open('xyz.px','w')
>>        fp.write(s)
>>        fp.close()
>>        import pxtl
>>        reload(pxtl)
>>        pxtl.processFile('xyz.px')
>>        etime = time.time()
>>        print etime-stime
>>
>>As you can see there is a major difference in 1+2 and 3 .
>>Can you please tell me what the problem might be and what should i do ?
>>I am using PXTL for developing a website along with file io as PXTL does
>>not support string processing .
>>Thanks in Advance.
>>Regards,
>>Ajinkya
>>
>>Orr, Steve wrote:
>>
>>    
>>
>>>Well obviously mod_python is performing well and I doubt anything
>>>connected with Linux versions would account for that much difference so
>>>the thing to focus on would be tuning dbxml or the code associated with
>>>it. Don't you have a way to run/test chunks of code outside of a web
>>>environment?
>>>
>>>-----Original Message-----
>>>From: M Chaudhary [mailto:igp-dev@infogridpacific.com] 
>>>Sent: Tuesday, August 23, 2005 12:13 AM
>>>To: mod_python@modpython.org
>>>Cc: Orr, Steve; IGP; and@doxdesk.com; xml@sleepycat.com
>>>Subject: Re: [mod_python] Performance Problem
>>>
>>>Hello Orr, Steve ,
>>>       As you told i tested my application using "ab" tool for three
>>>cases (each for single request and 5 concurrent requests ):-
>>>and the results were as follows (the following log was generated from
>>>      
>>>
>>my
>>    
>>
>>>mod-python handler itself using time.time() method ) ----
>>>Attached is the test module . Please check it and view the following 
>>>results.
>>>#-----------------------------------------------------------------------
>>>----------------------------
>>># Test 1 -- dbxml :- get a document and write it to browser
>>>#-----------------------------------------------------------------------
>>>----------------------------
>>>0.00605797767639 # single request
>>>0.0058479309082
>>>0.00573110580444
>>>0.148849010468
>>>0.00549292564392
>>>0.00417685508728 # 5 concurrent requests
>>>0.00559282302856
>>>0.00551891326904
>>>0.00600981712341
>>>0.00549983978271
>>>#-----------------------------------------------------------------------
>>>----------------------------
>>># Test 2 -- pxtl :- pxtl process a File and write it to browser
>>>#-----------------------------------------------------------------------
>>>----------------------------
>>>1.65334200859 # single request
>>>0.25177192688
>>>0.261835098267
>>>0.294239997864
>>>0.000832080841064
>>>0.428733825684 # 5 concurrent requests
>>>0.440675020218
>>>0.269226074219
>>>0.237013816833
>>>0.13219499588
>>>#-----------------------------------------------------------------------
>>>----------------------------
>>># Test 3 -- pxtl  and dbxml :- get a document from dbxml container ,pxtl
>>>
>>>process it and write it to browser
>>>#-----------------------------------------------------------------------
>>>----------------------------
>>>3.01918792725 # single request
>>>13.4880371094
>>>14.6321718693
>>>15.9680738449   # 5 concurrent requests
>>>16.1954669952
>>>0.010479927063
>>>17.400357008
>>>12.5239679813
>>>11.8724710941
>>>10.8379950523
>>>#-----------------------------------------------------------------------
>>>----------------------------
>>>
>>>As you can see the first problem is that when i test it for 5 concurrent
>>>
>>>request i get 9 entries in my log file
>>>each in each case.
>>>And the second but most annoying problem is for Test 3 ( for both pxtl
>>>and dbxml ) it takes more than 10 seconds
>>>to satisfy each request .
>>>Even i tested my application on Upgraded Kernel (2.6.9-11.EL).
>>>Should i use any other Linux distribution.
>>>Can you tell me what the problem may be ? And what should i do ?
>>>
>>>Regards,
>>>Ajinkya N
>>>
>>>
>>>Orr, Steve wrote:
>>>
>>> 
>>>
>>>      
>>>
>>>>I can't see that mod_python would be the problem. For a given request,
>>>>what percentage of the overall response time is involved with database
>>>>access versus code execution? You need to know that. I'd first try
>>>>tuning the code before doing any web stuff. Especially tune the
>>>>   
>>>>
>>>>        
>>>>
>>>database
>>> 
>>>
>>>      
>>>
>>>>queries and the network access to the database before going through the
>>>>web server. Then setup database connection pooling so each page request
>>>>reuses a connection instead of establishing a new connection with each
>>>>page turn. Can you do some kind of session management to avoid
>>>>   
>>>>
>>>>        
>>>>
>>>repop'ing
>>> 
>>>
>>>      
>>>
>>>>"the container" with each page turn?
>>>>
>>>>Using ab I did some bench marking a year ago and with an old, cheap
>>>>   
>>>>
>>>>        
>>>>
>>>Dell
>>> 
>>>
>>>      
>>>
>>>>2GHz PC with 512M RAM as the web server I was able to get 750 page
>>>>   
>>>>
>>>>        
>>>>
>>>turns
>>> 
>>>
>>>      
>>>
>>>>per second. The database was Oracle and I used the connection pooling
>>>>feature that comes with cx_Oracle on the OCI. (A persistent connection
>>>>can be established for each Apache process so this isn't really
>>>>necessary.) I also reused cursors to avoid the parsing overhead.
>>>>(Besides doing web development I'm a DBA dweeb.) Without mod_python and
>>>>connection pooling it got as slow as 11 requests per second. Of course
>>>>my benchmarking was doing simple stuff but I was satisfied that
>>>>Apache/mod_python would perform well and I wouldn't have to go down a
>>>>"Twisted" path. Don't know anything about dbxml but you should address
>>>>the architecture/code first. If performance is really a big issue then
>>>>consider load balanced web servers and a good disk array setup on the
>>>>   
>>>>
>>>>        
>>>>
>>>db
>>> 
>>>
>>>      
>>>
>>>>server. 
>>>>
>>>>
>>>>Steve Orr
>>>>
>>>>
>>>>-----Original Message-----
>>>>From: mod_python-bounces@modpython.org
>>>>[mailto:mod_python-bounces@modpython.org] On Behalf Of IGP
>>>>Sent: Wednesday, August 17, 2005 11:01 PM
>>>>To: xml@sleepycat.com; mod_python@modpython.org
>>>>Subject: [mod_python] Performance Problem
>>>>
>>>>I am accessing dbxml via my mod-python handler.
>>>>The dbxml manager instance is created  , the container is opened and
>>>>   
>>>>
>>>>        
>>>>
>>>the
>>> 
>>>
>>>      
>>>
>>>>required operation
>>>>is performed(querying , geting a document ) for each client request .
>>>>This is affecting the
>>>>performance . Is there any way to enhance the performance ? I mean that
>>>>   
>>>>
>>>>        
>>>>
>>> 
>>>
>>>      
>>>
>>>>the XmlManager instance
>>>>will be created only once , the container will be opened and the stored
>>>>   
>>>>
>>>>        
>>>>
>>> 
>>>
>>>      
>>>
>>>>in memory , so that the
>>>>response time will decrease .
>>>>I am using following versions of software
>>>>1) dbxml -  2.1.8
>>>>2) python - 2.3.4
>>>>3) mod-python - 1.3.4
>>>>4) apache 2.0.52
>>>>5) Kernel version-2.6.9-5.0.5-EL
>>>>
>>>>Please do reply if you know the solution .
>>>>Thanks in Advance,
>>>>Regards,
>>>>Ajinkya
>>>>
>>>>_______________________________________________
>>>>Mod_python mailing list
>>>>Mod_python@modpython.org
>>>>http://mailman.modpython.org/mailman/listinfo/mod_python
>>>>
>>>>
>>>>_______________________________________________
>>>>Mod_python mailing list
>>>>Mod_python@modpython.org
>>>>http://mailman.modpython.org/mailman/listinfo/mod_python
>>>>
>>>>
>>>>
>>>>
>>>>
>>>>
>>>>   
>>>>
>>>>        
>>>>
>>>_______________________________________________
>>>Mod_python mailing list
>>>Mod_python@modpython.org
>>>http://mailman.modpython.org/mailman/listinfo/mod_python
>>>
>>>
>>>
>>>
>>> 
>>>
>>>      
>>>
>>_______________________________________________
>>Mod_python mailing list
>>Mod_python@modpython.org
>>http://mailman.modpython.org/mailman/listinfo/mod_python
>>    
>>
>_______________________________________________
>Mod_python mailing list
>Mod_python@modpython.org
>http://mailman.modpython.org/mailman/listinfo/mod_python
>
>
>
>
>  
>
From labs at ixopusada.com  Thu Aug 25 07:21:16 2005
From: labs at ixopusada.com (IR labs)
Date: Thu Aug 25 07:24:35 2005
Subject: [mod_python] transhandler setup?
Message-ID: <1b86ca3d12073700e004dbf8c632e925@ixopusada.com>

Hi All, a mod_python newbie here.

I am trying to set up my server using mod_python's transhandler, but I 
can't figure out the right configuration. I am experimenting with the 
most crude and basic uri translation possible: every request should be 
redirected to main.py. But somehow apache doesn't want to do that. 
Right now it still displays static pages (.html files) with images, etc 
etc. (where I would think req.filename = 
'/var/www/mod_python_test/main.py' should prevent all of that.)

This is my setup:

from httpd.conf :
-----------------------------------------
...
<IfModule mod_python.c>
     AddHandler mod_python .py
     PythonPath "sys.path + ['/var/www/mod_python_test/']"
     PythonTransHandler translate

</IfModule>
...
-----------------------------------------

my script
/var/www/mod_python_test/translate.py :
-----------------------------------------
from mod_python import apache

def transhandler(req):
	req.filename = '/var/www/mod_python_test/main.py'
	return apache.OK
-----------------------------------------

using
FreeBSD 5.2.1
Apache 2.0.54
mod_python 3.1.4
Python 2.3.2


Note that my main.py does work through the .htaccess in 
/var/www/mod_python_test/
-----------------------------------------
AddHandler mod_python .py
PythonHandler main
PythonDebug On
-----------------------------------------

But it (main.py) should be called for all the url's requested (not just 
for /mod_python_test/whatever.py and friends.)
thx
dirk




-----------------------------
Dirk van Oosterbosch
de Wittenstraat 225
1052 AT Amsterdam
the Netherlands

http://labs.ixopusada.com
-----------------------------


From JohnBlack at kashori.com  Thu Aug 25 14:57:34 2005
From: JohnBlack at kashori.com (John Black)
Date: Thu Aug 25 14:57:48 2005
Subject: [mod_python] mod_python.publisher - path traversal fails
References: <004d01c5a919$f46abe80$6401a8c0@kashori001>
	<006601c5a91b$f0bb8740$6401a8c0@kashori001>
Message-ID: <001701c5a9a6$dc541390$6401a8c0@kashori001>

After much testing, I have determined that it has nothing to do 
with the path traversal of mod_python.publisher. That is working 
fine, as are paramter passing, etc.

I have nailed the problem down to a SQL statement. The strange 
thing is this. The table has 4 columns. If I select any 1 or 2 of 
those 4 columns, everything is fine. If, however, I select 3 or more, 
then I receive a 404 error. There is no exception, no error message. 
I surrounded it with a try: except: block and get nothing. 

When I run the same select statements directly from the python 
interpreter everything is fine. Also, on two other systems the entire
program works fine. However, they are using MySQLdb 1.20.

All of which leads me to wonder: is there an incompatibility between
MySQLdb 1.0.1 and mod_python 3.1.4? 

I had to use MySQLdb 1.0.1 because I am stuck with Python 2.2.3 
for now and MySQLdb 1.20 requires Python 2.3.4

cheers,
John
  ----- Original Message ----- 
  From: John Black 
  To: John Black ; mod_python@modpython.org 
  Sent: Wednesday, August 24, 2005 10:23 PM
  Subject: Re: [mod_python] mod_python.publisher - path traversal fails


  Ok. Actually I was just trying to keep it simple. I 
  realize that mod_python.publisher has a different 
  way of handling calls than is used with def handler(req)
  By the way, I have this code working on two other systems at 
  home. The whole thing works perfectly. On my home system, 
  when I use mod_python.publisher it is with a call like 

      http://domain.com/mytest.py/paramsTest

  However, on the production server mentioned below, this 
  does not work either. I still get the 404 error.

  Cheers,
  John
    Sent: Wednesday, August 24, 2005 10:08 PM


    I am working on a python application on a Red Hat Linux server running
    Apache 2.0.48 with Python 2.2.3 and mod_python 3.1.4

    I must not have something configured correctly and it seems to me that 
    causes mod_python.publisher fails. If I do this:

    http://domain.com/mytest.py

    when I have configured:

    <Directory /home/webadmin/domain.com/html>
        AddHandler mod_python .py
        PythonHandler mytest
        PythonDebug On
    </Directory>

    Then the default 'def handler(req):' works and prints "Hello World".


    But if I try to do this:

    http://domain.com/mytest.py

    when I have configured:

    <Directory /home/webadmin/domain.com/html>
        AddHandler mod_python .py
        PythonHandler mod_python.publisher
        PythonDebug On
    </Directory>

    Then I get a 404 error from Apache or a zero-byte return.


    However, if I call this http://domain.com/mytes.py (deforming mytest to mytes) 
    then I get this:
Mod_python error: "PythonHandler mod_python.publisher"

Traceback (most recent call last):

  File "/usr/lib/python2.2/site-packages/mod_python/apache.py", line 299, in HandlerDispatch
    result = object(req)

  File "/usr/lib/python2.2/site-packages/mod_python/publisher.py", line 98, in handler
    path=[path])

  File "/usr/lib/python2.2/site-packages/mod_python/apache.py", line 454, in import_module
    f, p, d = imp.find_module(parts[i], path)

ImportError: No module named mytesCheers,
    John Black



----------------------------------------------------------------------------


    _______________________________________________
    Mod_python mailing list
    Mod_python@modpython.org
    http://mailman.modpython.org/mailman/listinfo/mod_python
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20050825/63f03461/attachment.html
From JohnBlack at kashori.com  Thu Aug 25 15:24:05 2005
From: JohnBlack at kashori.com (John Black)
Date: Thu Aug 25 15:24:16 2005
Subject: [mod_python] mod_python.publisher - path traversal fails
References: <004d01c5a919$f46abe80$6401a8c0@kashori001>
	<006601c5a91b$f0bb8740$6401a8c0@kashori001>
	<001701c5a9a6$dc541390$6401a8c0@kashori001>
Message-ID: <002101c5a9aa$904b36f0$6401a8c0@kashori001>

And finally, with a little more searching, the answer:
http://www.modpython.org/FAQ/faqw.py?req=show&file=faq02.013.htp

Now everything works. The open source system is a miracle

Cheers,
John Black
  ----- Original Message ----- 
  From: John Black 
  To: John Black ; mod_python@modpython.org 
  Sent: Thursday, August 25, 2005 2:57 PM
  Subject: Re: [mod_python] mod_python.publisher - path traversal fails


  After much testing, I have determined that it has nothing to do 
  with the path traversal of mod_python.publisher. That is working 
  fine, as are paramter passing, etc.

  I have nailed the problem down to a SQL statement. The strange 
  thing is this. The table has 4 columns. If I select any 1 or 2 of 
  those 4 columns, everything is fine. If, however, I select 3 or more, 
  then I receive a 404 error. There is no exception, no error message. 
  I surrounded it with a try: except: block and get nothing. 

  When I run the same select statements directly from the python 
  interpreter everything is fine. Also, on two other systems the entire
  program works fine. However, they are using MySQLdb 1.20.

  All of which leads me to wonder: is there an incompatibility between
  MySQLdb 1.0.1 and mod_python 3.1.4? 

  I had to use MySQLdb 1.0.1 because I am stuck with Python 2.2.3 
  for now and MySQLdb 1.20 requires Python 2.3.4

  cheers,
  John
    ----- Original Message ----- 
    From: John Black 
    To: John Black ; mod_python@modpython.org 
    Sent: Wednesday, August 24, 2005 10:23 PM
    Subject: Re: [mod_python] mod_python.publisher - path traversal fails


    Ok. Actually I was just trying to keep it simple. I 
    realize that mod_python.publisher has a different 
    way of handling calls than is used with def handler(req)
    By the way, I have this code working on two other systems at 
    home. The whole thing works perfectly. On my home system, 
    when I use mod_python.publisher it is with a call like 

        http://domain.com/mytest.py/paramsTest

    However, on the production server mentioned below, this 
    does not work either. I still get the 404 error.

    Cheers,
    John
      Sent: Wednesday, August 24, 2005 10:08 PM


      I am working on a python application on a Red Hat Linux server running
      Apache 2.0.48 with Python 2.2.3 and mod_python 3.1.4

      I must not have something configured correctly and it seems to me that 
      causes mod_python.publisher fails. If I do this:

      http://domain.com/mytest.py

      when I have configured:

      <Directory /home/webadmin/domain.com/html>
          AddHandler mod_python .py
          PythonHandler mytest
          PythonDebug On
      </Directory>

      Then the default 'def handler(req):' works and prints "Hello World".


      But if I try to do this:

      http://domain.com/mytest.py

      when I have configured:

      <Directory /home/webadmin/domain.com/html>
          AddHandler mod_python .py
          PythonHandler mod_python.publisher
          PythonDebug On
      </Directory>

      Then I get a 404 error from Apache or a zero-byte return.


      However, if I call this http://domain.com/mytes.py (deforming mytest to mytes) 
      then I get this:
Mod_python error: "PythonHandler mod_python.publisher"

Traceback (most recent call last):

  File "/usr/lib/python2.2/site-packages/mod_python/apache.py", line 299, in HandlerDispatch
    result = object(req)

  File "/usr/lib/python2.2/site-packages/mod_python/publisher.py", line 98, in handler
    path=[path])

  File "/usr/lib/python2.2/site-packages/mod_python/apache.py", line 454, in import_module
    f, p, d = imp.find_module(parts[i], path)

ImportError: No module named mytesCheers,
      John Black



--------------------------------------------------------------------------


      _______________________________________________
      Mod_python mailing list
      Mod_python@modpython.org
      http://mailman.modpython.org/mailman/listinfo/mod_python
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20050825/317a3bf3/attachment-0001.html
From grahamd at dscpl.com.au  Thu Aug 25 16:58:15 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Thu Aug 25 16:58:35 2005
Subject: [mod_python] Performance Problem
In-Reply-To: <430D65AD.1080405@infogridpacific.com>
References: <1124950768.21296@dscpl.user.openhosting.com>
	<430D65AD.1080405@infogridpacific.com>
Message-ID: <0f8c3af2d4769a84841efad1f3779d70@dscpl.com.au>

Move the "import" statements outside of the timed area of code.

Some Python module imports could possibly take more than a
trivial amount of time. If the pxtl module import is one such
import, especially since you were using reload, you could have
been incurring this import cost on every time through the code.

Eliminate this possibility and then look at timing each individual
line of code to narrow it down further to the worst offender.

On 25/08/2005, at 4:31 PM, M Chaudhary wrote:

> Even if i remove    reload(pxtl)    ; there is no improvement.
>
> Graham Dumpleton wrote:
>
>> Why are you doing:
>>
>>  reload(pxtl)
>>
>> What is it about "import" that isn't enough?
>>
>> M Chaudhary wrote ..
>>
>>> Hello friends,
>>>
>>> 1) When I perform just file io it takes 0.00026 seconds.
>>>        import time
>>>        fp = open("xyz.html","r")
>>>        s = fp.read()
>>>        fp.close()
>>>        stime = time.time()
>>>        fp = open('xyz.px','w')
>>>        fp.write(s)
>>>        fp.close()
>>>        etime = time.time()
>>>        print etime-stime
>>>
>>>
>>> 2) When I perform just pxtl processing it takes 0.064 seconds.
>>>
>>>        import time
>>>        stime = time.time()
>>>        import pxtl
>>>        reload(pxtl)
>>>        pxtl.processFile('xyz.px')
>>>        etime = time.time()
>>>        print etime-stime
>>>
>>> 3) When I perform pxtl processing along with file-io it takes 1.33  
>>> seconds.
>>>        import time
>>>        fp = open("xyz.html","r")
>>>        s = fp.read()
>>>        fp.close()
>>>        stime = time.time()
>>>        fp = open('xyz.px','w')
>>>        fp.write(s)
>>>        fp.close()
>>>        import pxtl
>>>        reload(pxtl)
>>>        pxtl.processFile('xyz.px')
>>>        etime = time.time()
>>>        print etime-stime
>>>
>>> As you can see there is a major difference in 1+2 and 3 .
>>> Can you please tell me what the problem might be and what should i  
>>> do ?
>>> I am using PXTL for developing a website along with file io as PXTL  
>>> does
>>> not support string processing .
>>> Thanks in Advance.
>>> Regards,
>>> Ajinkya
>>>
>>> Orr, Steve wrote:
>>>
>>>
>>>> Well obviously mod_python is performing well and I doubt anything
>>>> connected with Linux versions would account for that much  
>>>> difference so
>>>> the thing to focus on would be tuning dbxml or the code associated  
>>>> with
>>>> it. Don't you have a way to run/test chunks of code outside of a web
>>>> environment?
>>>>
>>>> -----Original Message-----
>>>> From: M Chaudhary [mailto:igp-dev@infogridpacific.com] Sent:  
>>>> Tuesday, August 23, 2005 12:13 AM
>>>> To: mod_python@modpython.org
>>>> Cc: Orr, Steve; IGP; and@doxdesk.com; xml@sleepycat.com
>>>> Subject: Re: [mod_python] Performance Problem
>>>>
>>>> Hello Orr, Steve ,
>>>>       As you told i tested my application using "ab" tool for three
>>>> cases (each for single request and 5 concurrent requests ):-
>>>> and the results were as follows (the following log was generated  
>>>> from
>>>>
>>> my
>>>
>>>> mod-python handler itself using time.time() method ) ----
>>>> Attached is the test module . Please check it and view the  
>>>> following results.
>>>> #------------------------------------------------------------------- 
>>>> ----
>>>> ----------------------------
>>>> # Test 1 -- dbxml :- get a document and write it to browser
>>>> #------------------------------------------------------------------- 
>>>> ----
>>>> ----------------------------
>>>> 0.00605797767639 # single request
>>>> 0.0058479309082
>>>> 0.00573110580444
>>>> 0.148849010468
>>>> 0.00549292564392
>>>> 0.00417685508728 # 5 concurrent requests
>>>> 0.00559282302856
>>>> 0.00551891326904
>>>> 0.00600981712341
>>>> 0.00549983978271
>>>> #------------------------------------------------------------------- 
>>>> ----
>>>> ----------------------------
>>>> # Test 2 -- pxtl :- pxtl process a File and write it to browser
>>>> #------------------------------------------------------------------- 
>>>> ----
>>>> ----------------------------
>>>> 1.65334200859 # single request
>>>> 0.25177192688
>>>> 0.261835098267
>>>> 0.294239997864
>>>> 0.000832080841064
>>>> 0.428733825684 # 5 concurrent requests
>>>> 0.440675020218
>>>> 0.269226074219
>>>> 0.237013816833
>>>> 0.13219499588
>>>> #------------------------------------------------------------------- 
>>>> ----
>>>> ----------------------------
>>>> # Test 3 -- pxtl  and dbxml :- get a document from dbxml container  
>>>> ,pxtl
>>>>
>>>> process it and write it to browser
>>>> #------------------------------------------------------------------- 
>>>> ----
>>>> ----------------------------
>>>> 3.01918792725 # single request
>>>> 13.4880371094
>>>> 14.6321718693
>>>> 15.9680738449   # 5 concurrent requests
>>>> 16.1954669952
>>>> 0.010479927063
>>>> 17.400357008
>>>> 12.5239679813
>>>> 11.8724710941
>>>> 10.8379950523
>>>> #------------------------------------------------------------------- 
>>>> ----
>>>> ----------------------------
>>>>
>>>> As you can see the first problem is that when i test it for 5  
>>>> concurrent
>>>>
>>>> request i get 9 entries in my log file
>>>> each in each case.
>>>> And the second but most annoying problem is for Test 3 ( for both  
>>>> pxtl
>>>> and dbxml ) it takes more than 10 seconds
>>>> to satisfy each request .
>>>> Even i tested my application on Upgraded Kernel (2.6.9-11.EL).
>>>> Should i use any other Linux distribution.
>>>> Can you tell me what the problem may be ? And what should i do ?
>>>>
>>>> Regards,
>>>> Ajinkya N
>>>>
>>>>
>>>> Orr, Steve wrote:
>>>>
>>>>
>>>>
>>>>> I can't see that mod_python would be the problem. For a given  
>>>>> request,
>>>>> what percentage of the overall response time is involved with  
>>>>> database
>>>>> access versus code execution? You need to know that. I'd first try
>>>>> tuning the code before doing any web stuff. Especially tune the
>>>>>
>>>>>
>>>> database
>>>>
>>>>
>>>>> queries and the network access to the database before going  
>>>>> through the
>>>>> web server. Then setup database connection pooling so each page  
>>>>> request
>>>>> reuses a connection instead of establishing a new connection with  
>>>>> each
>>>>> page turn. Can you do some kind of session management to avoid
>>>>>
>>>>>
>>>> repop'ing
>>>>
>>>>
>>>>> "the container" with each page turn?
>>>>>
>>>>> Using ab I did some bench marking a year ago and with an old, cheap
>>>>>
>>>>>
>>>> Dell
>>>>
>>>>
>>>>> 2GHz PC with 512M RAM as the web server I was able to get 750 page
>>>>>
>>>>>
>>>> turns
>>>>
>>>>
>>>>> per second. The database was Oracle and I used the connection  
>>>>> pooling
>>>>> feature that comes with cx_Oracle on the OCI. (A persistent  
>>>>> connection
>>>>> can be established for each Apache process so this isn't really
>>>>> necessary.) I also reused cursors to avoid the parsing overhead.
>>>>> (Besides doing web development I'm a DBA dweeb.) Without  
>>>>> mod_python and
>>>>> connection pooling it got as slow as 11 requests per second. Of  
>>>>> course
>>>>> my benchmarking was doing simple stuff but I was satisfied that
>>>>> Apache/mod_python would perform well and I wouldn't have to go  
>>>>> down a
>>>>> "Twisted" path. Don't know anything about dbxml but you should  
>>>>> address
>>>>> the architecture/code first. If performance is really a big issue  
>>>>> then
>>>>> consider load balanced web servers and a good disk array setup on  
>>>>> the
>>>>>
>>>>>
>>>> db
>>>>
>>>>
>>>>> server.
>>>>>
>>>>> Steve Orr
>>>>>
>>>>>
>>>>> -----Original Message-----
>>>>> From: mod_python-bounces@modpython.org
>>>>> [mailto:mod_python-bounces@modpython.org] On Behalf Of IGP
>>>>> Sent: Wednesday, August 17, 2005 11:01 PM
>>>>> To: xml@sleepycat.com; mod_python@modpython.org
>>>>> Subject: [mod_python] Performance Problem
>>>>>
>>>>> I am accessing dbxml via my mod-python handler.
>>>>> The dbxml manager instance is created  , the container is opened  
>>>>> and
>>>>>
>>>>>
>>>> the
>>>>
>>>>
>>>>> required operation
>>>>> is performed(querying , geting a document ) for each client  
>>>>> request .
>>>>> This is affecting the
>>>>> performance . Is there any way to enhance the performance ? I mean  
>>>>> that
>>>>>
>>>>>
>>>>
>>>>
>>>>> the XmlManager instance
>>>>> will be created only once , the container will be opened and the  
>>>>> stored
>>>>>
>>>>>
>>>>
>>>>
>>>>> in memory , so that the
>>>>> response time will decrease .
>>>>> I am using following versions of software
>>>>> 1) dbxml -  2.1.8
>>>>> 2) python - 2.3.4
>>>>> 3) mod-python - 1.3.4
>>>>> 4) apache 2.0.52
>>>>> 5) Kernel version-2.6.9-5.0.5-EL
>>>>>
>>>>> Please do reply if you know the solution .
>>>>> Thanks in Advance,
>>>>> Regards,
>>>>> Ajinkya
>>>>>
>>>>> _______________________________________________
>>>>> Mod_python mailing list
>>>>> Mod_python@modpython.org
>>>>> http://mailman.modpython.org/mailman/listinfo/mod_python
>>>>>
>>>>>
>>>>> _______________________________________________
>>>>> Mod_python mailing list
>>>>> Mod_python@modpython.org
>>>>> http://mailman.modpython.org/mailman/listinfo/mod_python
>>>>>
>>>>>
>>>>>
>>>>>
>>>>>
>>>>>
>>>>>
>>>>>
>>>> _______________________________________________
>>>> Mod_python mailing list
>>>> Mod_python@modpython.org
>>>> http://mailman.modpython.org/mailman/listinfo/mod_python
>>>>
>>>>
>>>>
>>>>
>>>>
>>>>
>>> _______________________________________________
>>> Mod_python mailing list
>>> Mod_python@modpython.org
>>> http://mailman.modpython.org/mailman/listinfo/mod_python
>>>
>> _______________________________________________
>> Mod_python mailing list
>> Mod_python@modpython.org
>> http://mailman.modpython.org/mailman/listinfo/mod_python
>>
>>
>>
>>
>>

From grahamd at dscpl.com.au  Thu Aug 25 17:01:52 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Thu Aug 25 17:02:15 2005
Subject: [mod_python] transhandler setup?
In-Reply-To: <1b86ca3d12073700e004dbf8c632e925@ixopusada.com>
References: <1b86ca3d12073700e004dbf8c632e925@ixopusada.com>
Message-ID: <eb31d0b2cd237177c63ada0f30b354cd@dscpl.com.au>

If you want all requests falling under a directory to be handled by
mod_python use SetHandler and not AddHandler. Eg.

   <Directory /some/path>
   SetHandler mod_python
   PythonHandler main
   </Directory>

Read the documentation for further information of the difference.

On 25/08/2005, at 9:21 PM, IR labs wrote:

> Hi All, a mod_python newbie here.
>
> I am trying to set up my server using mod_python's transhandler, but I 
> can't figure out the right configuration. I am experimenting with the 
> most crude and basic uri translation possible: every request should be 
> redirected to main.py. But somehow apache doesn't want to do that. 
> Right now it still displays static pages (.html files) with images, 
> etc etc. (where I would think req.filename = 
> '/var/www/mod_python_test/main.py' should prevent all of that.)
>
> This is my setup:
>
> from httpd.conf :
> -----------------------------------------
> ...
> <IfModule mod_python.c>
>     AddHandler mod_python .py
>     PythonPath "sys.path + ['/var/www/mod_python_test/']"
>     PythonTransHandler translate
>
> </IfModule>
> ...
> -----------------------------------------
>
> my script
> /var/www/mod_python_test/translate.py :
> -----------------------------------------
> from mod_python import apache
>
> def transhandler(req):
> 	req.filename = '/var/www/mod_python_test/main.py'
> 	return apache.OK
> -----------------------------------------
>
> using
> FreeBSD 5.2.1
> Apache 2.0.54
> mod_python 3.1.4
> Python 2.3.2
>
>
> Note that my main.py does work through the .htaccess in 
> /var/www/mod_python_test/
> -----------------------------------------
> AddHandler mod_python .py
> PythonHandler main
> PythonDebug On
> -----------------------------------------
>
> But it (main.py) should be called for all the url's requested (not 
> just for /mod_python_test/whatever.py and friends.)
> thx
> dirk
>
>
>
>
> -----------------------------
> Dirk van Oosterbosch
> de Wittenstraat 225
> 1052 AT Amsterdam
> the Netherlands
>
> http://labs.ixopusada.com
> -----------------------------
>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python

From labs at ixopusada.com  Thu Aug 25 21:59:28 2005
From: labs at ixopusada.com (IR labs)
Date: Thu Aug 25 22:01:59 2005
Subject: [mod_python] transhandler setup?
In-Reply-To: <eb31d0b2cd237177c63ada0f30b354cd@dscpl.com.au>
References: <1b86ca3d12073700e004dbf8c632e925@ixopusada.com>
	<eb31d0b2cd237177c63ada0f30b354cd@dscpl.com.au>
Message-ID: <9f4b2d174dc1261861ce6513fb09a64e@ixopusada.com>

Sorry, I haven't been clear. I don't want so much to handle all 
requests under a directory. I like to handle all requests in general, 
and than first analyze the url. ((If the it is a certain file (.gif, 
.jpg, .css, .js) or a certain directory, apache should handle it 
further, i.e. just serve that file. If it is just a path or a .html, I 
want a python script to check wether the directory or file indeed exist 
or not. If the index.html or other .html file doesn't exist the main.py 
should take it over.))
So I wan't this analysis be done during the transHandler phase. But how 
do I make apache run my translate.py first? where do I put my config 
lines?
PythonPath "sys.path + ['/some/path']"
PythonTransHandler translate

thx
dirk

On 25-aug-05, at 23:01, Graham Dumpleton wrote:

> If you want all requests falling under a directory to be handled by
> mod_python use SetHandler and not AddHandler. Eg.
>
>   <Directory /some/path>
>   SetHandler mod_python
>   PythonHandler main
>   </Directory>
>
> Read the documentation for further information of the difference.
>
> On 25/08/2005, at 9:21 PM, IR labs wrote:
>
>> Hi All, a mod_python newbie here.
>>
>> I am trying to set up my server using mod_python's transhandler, but 
>> I can't figure out the right configuration. I am experimenting with 
>> the most crude and basic uri translation possible: every request 
>> should be redirected to main.py. But somehow apache doesn't want to 
>> do that. Right now it still displays static pages (.html files) with 
>> images, etc etc. (where I would think req.filename = 
>> '/var/www/mod_python_test/main.py' should prevent all of that.)
>>
>> This is my setup:
>>
>> from httpd.conf :
>> -----------------------------------------
>> ...
>> <IfModule mod_python.c>
>>     AddHandler mod_python .py
>>     PythonPath "sys.path + ['/var/www/mod_python_test/']"
>>     PythonTransHandler translate
>>
>> </IfModule>
>> ...
>> -----------------------------------------
>>
>> my script
>> /var/www/mod_python_test/translate.py :
>> -----------------------------------------
>> from mod_python import apache
>>
>> def transhandler(req):
>> 	req.filename = '/var/www/mod_python_test/main.py'
>> 	return apache.OK
>> -----------------------------------------
>>
>> using
>> FreeBSD 5.2.1
>> Apache 2.0.54
>> mod_python 3.1.4
>> Python 2.3.2
>>
>>
>> Note that my main.py does work through the .htaccess in 
>> /var/www/mod_python_test/
>> -----------------------------------------
>> AddHandler mod_python .py
>> PythonHandler main
>> PythonDebug On
>> -----------------------------------------
>>
>> But it (main.py) should be called for all the url's requested (not 
>> just for /mod_python_test/whatever.py and friends.)
>> thx
>> dirk
>>
>>
>>
>>
>> -----------------------------
>> Dirk van Oosterbosch
>> de Wittenstraat 225
>> 1052 AT Amsterdam
>> the Netherlands
>>
>> http://labs.ixopusada.com
>> -----------------------------
>>
>>
>> _______________________________________________
>> Mod_python mailing list
>> Mod_python@modpython.org
>> http://mailman.modpython.org/mailman/listinfo/mod_python
>
>
>

-----------------------------
Dirk van Oosterbosch
dirk@ixopusada.com
-----------------------------


From grahamd at dscpl.com.au  Thu Aug 25 22:19:42 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Thu Aug 25 22:21:56 2005
Subject: [mod_python] transhandler setup?
In-Reply-To: <bf10f5f08cc0a26fe706e91aa2557691@ixopusada.com>
References: <1b86ca3d12073700e004dbf8c632e925@ixopusada.com>
	<eb31d0b2cd237177c63ada0f30b354cd@dscpl.com.au>
	<bf10f5f08cc0a26fe706e91aa2557691@ixopusada.com>
Message-ID: <c81dfac26014a65427f09a833aaf43fa@dscpl.com.au>

If your content handler doesn't want to handle a request, have it return
apache.DECLINED and Apache will then serve up any static file that may
have been identified by the URL.

   def handler(req):
     extension = os.path.splitext(req.filename)[1]
     if extension == ".html":
       if not os.path.exists(req.filename):
         ...
       else:
         return apache.DECLINED
     else:
       return apache.DECLINED

That is at least one way of doing it, although this will disable
processing in some cases by other Apache modules such as PHP. You can
get around that by explicitly disabling use of mod_python for that
extension:

   <Directory /document/root>
   SetHandler mod_python
   PythonHandler main
   <Files *.php>
   SetHandler None
   </Files>
   </Directory>

Rather than using subtraction, you could instead be additive:

   <Directory /document/root>
   AddHandler mod_python .html
   PythonHandler main
   </Directory>

Thus, if you are only interested in intercepting .html files, only
have mod_python triggered for them.

In respect of transhandler(), all I can really comment on there is
that if setting PythonTransHandler, you do not need to use either
AddHandler or SetHandler. These latter directives only need to be
used if setting PythonHandler, ie., the content handler. As the
documentation points out, PythonTransHandler can only be used at
top level scope, ie., not with a Directory, Location or Files
directive or in a .htaccess file.

Graham

On 26/08/2005, at 11:57 AM, IR labs wrote:

> Sorry, I haven't been clear. I don't want so much to handle all 
> requests under a directory. I like to handle all requests in general, 
> and than first analyze the url. ((If the it is a certain file (.gif, 
> .jpg, .css, .js) or a certain directory, apache should handle it 
> further, i.e. just serve that file. If it is just a path or a .html, I 
> want a python script to check wether the directory or file indeed 
> exist or not. If the index.html or other .html file doesn't exist the 
> main.py should take it over.))
> So I wan't this analysis be done during the transHandler phase. But 
> how do I make apache run my translate.py first? where do I put my 
> config lines?
> PythonPath "sys.path + ['/some/path']"
> PythonTransHandler translate
>
> thx
> dirk
>
> On 25-aug-05, at 23:01, Graham Dumpleton wrote:
>
>> If you want all requests falling under a directory to be handled by
>> mod_python use SetHandler and not AddHandler. Eg.
>>
>>   <Directory /some/path>
>>   SetHandler mod_python
>>   PythonHandler main
>>   </Directory>
>>
>> Read the documentation for further information of the difference.
>>
>> On 25/08/2005, at 9:21 PM, IR labs wrote:
>>
>>> Hi All, a mod_python newbie here.
>>>
>>> I am trying to set up my server using mod_python's transhandler, but 
>>> I can't figure out the right configuration. I am experimenting with 
>>> the most crude and basic uri translation possible: every request 
>>> should be redirected to main.py. But somehow apache doesn't want to 
>>> do that. Right now it still displays static pages (.html files) with 
>>> images, etc etc. (where I would think req.filename = 
>>> '/var/www/mod_python_test/main.py' should prevent all of that.)
>>>
>>> This is my setup:
>>>
>>> from httpd.conf :
>>> -----------------------------------------
>>> ...
>>> <IfModule mod_python.c>
>>>     AddHandler mod_python .py
>>>     PythonPath "sys.path + ['/var/www/mod_python_test/']"
>>>     PythonTransHandler translate
>>>
>>> </IfModule>
>>> ...
>>> -----------------------------------------
>>>
>>> my script
>>> /var/www/mod_python_test/translate.py :
>>> -----------------------------------------
>>> from mod_python import apache
>>>
>>> def transhandler(req):
>>> 	req.filename = '/var/www/mod_python_test/main.py'
>>> 	return apache.OK
>>> -----------------------------------------
>>>
>>> using
>>> FreeBSD 5.2.1
>>> Apache 2.0.54
>>> mod_python 3.1.4
>>> Python 2.3.2
>>>
>>>
>>> Note that my main.py does work through the .htaccess in 
>>> /var/www/mod_python_test/
>>> -----------------------------------------
>>> AddHandler mod_python .py
>>> PythonHandler main
>>> PythonDebug On
>>> -----------------------------------------
>>>
>>> But it (main.py) should be called for all the url's requested (not 
>>> just for /mod_python_test/whatever.py and friends.)
>>> thx
>>> dirk
>>>
>>>
>>>
>>>
>>> -----------------------------
>>> Dirk van Oosterbosch
>>> de Wittenstraat 225
>>> 1052 AT Amsterdam
>>> the Netherlands
>>>
>>> http://labs.ixopusada.com
>>> -----------------------------
>>>
>>>
>>> _______________________________________________
>>> Mod_python mailing list
>>> Mod_python@modpython.org
>>> http://mailman.modpython.org/mailman/listinfo/mod_python
>>
>>
>>
>
> -----------------------------
> Dirk van Oosterbosch
> dirk@ixopusada.com
> -----------------------------
>

From cy.khormaee at hp.com  Fri Aug 26 12:31:48 2005
From: cy.khormaee at hp.com (Khormaee, Cy)
Date: Fri Aug 26 12:31:54 2005
Subject: [mod_python] process privileges
Message-ID: <51E9B8FBB414C44A9A2CB19A5F4F5DD90422CD71@cacexc03.americas.cpqcorp.net>

Hey all,

I'm currently trying to run pdflatex on a machine with RedHat Linux Corporate 3.0 by calling the os.system() command from mod python.  I am able to complete this operation from the command line python interpreter, but ill I get back when trying to run the command from apache/mod python all I receive is '256' and no changes are made to the file system.  All of the folders involved are set for full access(unix privilege 777).  My current guess is that this issue has something to do with apache's priority, but haven't been able to confirm this suspicion yet.  If you can provide any hints on how to debug this it would be much appreciated.

Thanks,
Cy

From jgentil at sebistar.net  Fri Aug 26 14:08:47 2005
From: jgentil at sebistar.net (Jon-Pierre Gentil)
Date: Fri Aug 26 14:09:26 2005
Subject: [mod_python] process privileges
In-Reply-To: <51E9B8FBB414C44A9A2CB19A5F4F5DD90422CD71@cacexc03.americas.cpqcorp.net>
References: <51E9B8FBB414C44A9A2CB19A5F4F5DD90422CD71@cacexc03.americas.cpqcorp.net>
Message-ID: <200508261308.53574.jgentil@sebistar.net>

On Friday 26 August 2005 11:31 am, Khormaee, Cy wrote:

> I'm currently trying to run pdflatex on a machine with RedHat Linux
> Corporate 3.0 by calling the os.system() command from mod python.  I am
> able to complete this operation from the command line python
> interpreter, but ill I get back when trying to run the command from
> apache/mod python all I receive is '256' and no changes are made to the
> file system.  All of the folders involved are set for full access(unix
> privilege 777).  My current guess is that this issue has something to
> do with apache's priority, but haven't been able to confirm this
> suspicion yet.  If you can provide any hints on how to debug this it
> would be much appreciated.

If you could show us some code it would help.  Having a different priority 
should not affect filesystem access, but running in apache is a lot 
different than running manually in the interpreter, since you would run 
as a completely different user and most likely not have a home directory.


-- 
_________________________________________________________

  Jon-Pierre Gentil               PGP: 0x7E1CBA17
  jabber: jgentil@sebistar.net    web: www.sebistar.net
  "If you think education is expensive, try ignorance."
_________________________________________________________ 
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 827 bytes
Desc: not available
Url : http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20050826/d621ac8c/attachment.bin
From eric at ericwalstad.com  Fri Aug 26 14:38:13 2005
From: eric at ericwalstad.com (Eric Walstad)
Date: Fri Aug 26 14:38:22 2005
Subject: [mod_python] process privileges
In-Reply-To: <200508261308.53574.jgentil@sebistar.net>
References: <51E9B8FBB414C44A9A2CB19A5F4F5DD90422CD71@cacexc03.americas.cpqcorp.net>
	<200508261308.53574.jgentil@sebistar.net>
Message-ID: <200508261138.13778.eric@ericwalstad.com>

On Friday 26 August 2005 11:08, Jon-Pierre Gentil wrote:
> On Friday 26 August 2005 11:31 am, Khormaee, Cy wrote:
> > I'm currently trying to run pdflatex on a machine with RedHat
> > Linux Corporate 3.0 by calling the os.system() command from mod
> > python.  I am able to complete this operation from the command
> > line python interpreter, but ill I get back when trying to run
> > the command from apache/mod python all I receive is '256' and no
> > changes are made to the file system.  All of the folders involved
> > are set for full access(unix privilege 777).  My current guess is
> > that this issue has something to do with apache's priority, but
> > haven't been able to confirm this suspicion yet.  If you can
> > provide any hints on how to debug this it would be much
> > appreciated.
>
> If you could show us some code it would help.  Having a different
> priority should not affect filesystem access, but running in apache
> is a lot different than running manually in the interpreter, since
> you would run as a completely different user and most likely not
> have a home directory.

I've had luck running a system process triggered with mod_python by:

 1.  setup the sudo file to allow the Apache process (user www-data on 
my debian box) to run a particular shell command.  Here a sample of 
my sudo file:

# User alias specification
User_Alias      APACHE = www-data
# Cmnd alias specification
Cmnd_Alias      MOD_PYTHON_BRANCH = /path/to/shell/script.sh
# User privilege specification
APACHE          LOCALHOST = NOPASSWD: MOD_PYTHON_BRANCH

 2.  Call the register_cleanup method of the mod_python request object 
to basically detach the system process (the shell script) from the 
mod_python request.  You may not need to do it this way, but I did 
because my shell script took a long time to complete and I didn't 
want the web user waiting for it to complete.

    req.register_cleanup(buildIt, working_dir)

def buildIt(working_dir):
    """The 'callable object' needed by req.register_cleanup.
    All this does is call the shell script.
    """
    r, shell_script_output = \
      commands.getstatusoutput(SHELL_SCRIPT_COMMAND % working_dir)

If you search the mod_python list archives for my email address and 
"register_cleanup" you will find more details.

I hope that helps.

Eric.
From scott_list at mischko.com  Fri Aug 26 23:19:40 2005
From: scott_list at mischko.com (Scott Chapman)
Date: Fri Aug 26 23:20:17 2005
Subject: [mod_python] Blank form values are not showing up in my
	mod_pyton/mpservlets environments
Message-ID: <430FDBCC.2070803@mischko.com>

Can anyone shed any light on why blank form elements are not showing up in 
mod_python?

TIA,
Scott
From grahamd at dscpl.com.au  Fri Aug 26 23:59:39 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Sat Aug 27 00:00:01 2005
Subject: [mod_python] Blank form values are not showing up in my
	mod_pyton/mpservlets environments
In-Reply-To: <430FDBCC.2070803@mischko.com>
References: <430FDBCC.2070803@mischko.com>
Message-ID: <25FFE189-DCAE-48DB-A6EE-E86EDB438925@dscpl.com.au>


On 27/08/2005, at 1:19 PM, Scott Chapman wrote:

> Can anyone shed any light on why blank form elements are not  
> showing up in mod_python?

Would this help:

   form = util.FieldStorage(req,keep_blank_values=1)

See documentation:

   http://www.modpython.org/live/current/doc-html/pyapi-util-fstor.html

Graham
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20050827/34d543fa/attachment.html
From scott_list at mischko.com  Sat Aug 27 00:39:21 2005
From: scott_list at mischko.com (Scott Chapman)
Date: Sat Aug 27 00:39:28 2005
Subject: [mod_python] Blank form values are not showing up in
	my	mod_pyton/mpservlets environments
In-Reply-To: <430FDBCC.2070803@mischko.com>
References: <430FDBCC.2070803@mischko.com>
Message-ID: <430FEE79.40803@mischko.com>

Scott Chapman wrote:
> Can anyone shed any light on why blank form elements are not showing up 
> in mod_python?

Never mind. I found the FieldStorage parameter that controls this.

Scott
From scott_list at mischko.com  Sat Aug 27 01:59:54 2005
From: scott_list at mischko.com (Scott Chapman)
Date: Sat Aug 27 02:00:04 2005
Subject: [mod_python] Blank form values are not showing up in my
	mod_pyton/mpservlets environments
In-Reply-To: <25FFE189-DCAE-48DB-A6EE-E86EDB438925@dscpl.com.au>
References: <430FDBCC.2070803@mischko.com>
	<25FFE189-DCAE-48DB-A6EE-E86EDB438925@dscpl.com.au>
Message-ID: <4310015A.40604@mischko.com>

Graham,
It appears that the keep_blank_values toggle does not turn on checkbox inputs 
that are empty?  It  retains intput text but so far not checkboxes. :(

Can you run a quick test of this and tell me if I'm going insane or not?

Save this locally then load it in your browser and submit it just like it is:

<html><head></head><body>
<form name="user_form" id="user_form" class="marginForm" method="GET" 
action="http://www.mischko.com/test">
   <fieldset>
     <legend>User Information</legend>

     <label id="l_job_title" for="job_title">Job Title</label>
     <input id="job_title" name="job_title" size="30" type="text" value=""/><br/>
     <label class="required" id="l_address1" for="address1">Address</label>
     <input id="address1" name="address1" size="30" type="text" value="leave the 
above blank"/><br/>
     <label id="l_address2" for="address2">&nbsp;</label>
     <input id="address2" name="address2" size="30" type="text" value="leave all 
checkboxes blank"/><br/>
   </fieldset>

   <fieldset class="radio">
     <legend>Products Offered</legend>

     <input id="products1" name="products" value="Seed" type="checkbox"/>
     <label id="l_products1" for="products1">Seed</label><br/>
     <input id="products2" name="products" value="Seed Mixes" type="checkbox"/>
     <label id="l_products2" for="products2">Seed Mixes</label><br/>
     <input id="products3" name="products" value="Certified Seed" type="checkbox"/>
     <label id="l_products3" for="products3">Certified Seed</label><br/>
     <input id="products4" name="products" value="Plants" type="checkbox"/>
     <label id="l_products4" for="products4">Plants</label><br/>
     <input id="products5" name="products" value="Equipment &amp; Supplies" 
type="checkbox"/>
     <label id="l_products5" for="products5">Equipment & Supplies</label><br/>
   </fieldset>

   <input id="submit_user_form" class="submit" value="Submit" type="submit"/><br/>
</form></body></html>

You'll see that products does not show up in the GET URL or the test page.
Scott

Graham Dumpleton wrote:
> 
> On 27/08/2005, at 1:19 PM, Scott Chapman wrote:
> 
>> Can anyone shed any light on why blank form elements are not showing 
>> up in mod_python?
> 
> 
> Would this help:
> 
>   form = util.FieldStorage(req,keep_blank_values=1)
> 
> See documentation:
> 
>    http://www.modpython.org/live/current/doc-html/pyapi-util-fstor.html
> 
> Graham

From grahamd at dscpl.com.au  Sat Aug 27 02:26:28 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Sat Aug 27 02:26:40 2005
Subject: [mod_python] Blank form values are not showing up in my
	mod_pyton/mpservlets environments
In-Reply-To: <4310015A.40604@mischko.com>
References: <430FDBCC.2070803@mischko.com>
	<25FFE189-DCAE-48DB-A6EE-E86EDB438925@dscpl.com.au>
	<4310015A.40604@mischko.com>
Message-ID: <2C85B397-D060-4CFA-A501-621921B9C4E7@dscpl.com.au>

You are probably correct. If I change the "action" to point at my own  
form input testing page:

   http://www.dscpl.com.au/projects/vampire/examples/templates/ 
form_values.html

and don't change anything, I get back:
   Form Values

   Name Value
   address1 leave the above blank
   address2 leave all checkboxes blank
   job_title

So yes, "products" doesn't display if there is nothing selected. This  
though appears to be
because the browser doesn't send it, not that mod_python ignores it.  
You can see this if
you use a GET request and set "action" to:

   http://www.dscpl.com.au/projects/vampire/examples/templates/ 
request_details.html

Note how "products" isn't even encoded into the URL.

Looks like your handler is going to have to explicitly handle that  
case. This would not
generally be a problem if using a scheme which mapped form arguments  
to actual
function arguments like in publisher or Vampire as you could specify  
a default value of
None for products and use that this pick up that it wasn't set at all.

Graham

On 27/08/2005, at 3:59 PM, Scott Chapman wrote:

> Graham,
> It appears that the keep_blank_values toggle does not turn on  
> checkbox inputs that are empty?  It  retains intput text but so far  
> not checkboxes. :(
>
> Can you run a quick test of this and tell me if I'm going insane or  
> not?
>
> Save this locally then load it in your browser and submit it just  
> like it is:
>
> <html><head></head><body>
> <form name="user_form" id="user_form" class="marginForm"  
> method="GET" action="http://www.mischko.com/test">
>   <fieldset>
>     <legend>User Information</legend>
>
>     <label id="l_job_title" for="job_title">Job Title</label>
>     <input id="job_title" name="job_title" size="30" type="text"  
> value=""/><br/>
>     <label class="required" id="l_address1" for="address1">Address</ 
> label>
>     <input id="address1" name="address1" size="30" type="text"  
> value="leave the above blank"/><br/>
>     <label id="l_address2" for="address2">&nbsp;</label>
>     <input id="address2" name="address2" size="30" type="text"  
> value="leave all checkboxes blank"/><br/>
>   </fieldset>
>
>   <fieldset class="radio">
>     <legend>Products Offered</legend>
>
>     <input id="products1" name="products" value="Seed"  
> type="checkbox"/>
>     <label id="l_products1" for="products1">Seed</label><br/>
>     <input id="products2" name="products" value="Seed Mixes"  
> type="checkbox"/>
>     <label id="l_products2" for="products2">Seed Mixes</label><br/>
>     <input id="products3" name="products" value="Certified Seed"  
> type="checkbox"/>
>     <label id="l_products3" for="products3">Certified Seed</ 
> label><br/>
>     <input id="products4" name="products" value="Plants"  
> type="checkbox"/>
>     <label id="l_products4" for="products4">Plants</label><br/>
>     <input id="products5" name="products" value="Equipment &amp;  
> Supplies" type="checkbox"/>
>     <label id="l_products5" for="products5">Equipment & Supplies</ 
> label><br/>
>   </fieldset>
>
>   <input id="submit_user_form" class="submit" value="Submit"  
> type="submit"/><br/>
> </form></body></html>
>
> You'll see that products does not show up in the GET URL or the  
> test page.
> Scott
>
> Graham Dumpleton wrote:
>
>> On 27/08/2005, at 1:19 PM, Scott Chapman wrote:
>>
>>> Can anyone shed any light on why blank form elements are not  
>>> showing up in mod_python?
>>>
>> Would this help:
>>   form = util.FieldStorage(req,keep_blank_values=1)
>> See documentation:
>>    http://www.modpython.org/live/current/doc-html/pyapi-util- 
>> fstor.html
>> Graham
>

From scott_list at mischko.com  Sat Aug 27 02:35:30 2005
From: scott_list at mischko.com (Scott Chapman)
Date: Sat Aug 27 02:35:37 2005
Subject: [mod_python] Blank form values are not showing up in
	my	mod_pyton/mpservlets environments
In-Reply-To: <4310015A.40604@mischko.com>
References: <430FDBCC.2070803@mischko.com>	<25FFE189-DCAE-48DB-A6EE-E86EDB438925@dscpl.com.au>
	<4310015A.40604@mischko.com>
Message-ID: <431009B2.6060208@mischko.com>

Scott Chapman wrote:
> Graham,
> It appears that the keep_blank_values toggle does not turn on checkbox 
> inputs that are empty?  It  retains intput text but so far not 
> checkboxes. :(

It turns out that checkboxes are not submitted with forms if the checkboxes are 
unchecked and this is standard behavior for web browsers.  This may be the 
_dumbest_ thing I've ever seen.  I haven't tested it with radio inputs but I 
have read that it may be the case there as well.

Happy trails,
Scott
From grahamd at dscpl.com.au  Sun Aug 28 05:00:23 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Sun Aug 28 05:00:49 2005
Subject: [mod_python] Re: mod_python problem under WinXP
In-Reply-To: <1377186184.20050828113421@flashmob.md>
References: <1377186184.20050828113421@flashmob.md>
Message-ID: <9ec5419f2d025e091e1649b757b30caa@dscpl.com.au>

If you have mod_python questions, there is a mailing list for this 
purpose.
I would rather they not be sent to me directly. :-(

See:

   http://mailman.modpython.org/mailman/listinfo/mod_python

for details of subscribing to the mailing list and where to post.

This email has been cc'd to the list and I provide a couple of
comments, but ....

On 28/08/2005, at 6:34 PM, Booboo wrote:

> Hello graham,
> I am sorry for bothering but i hava occured an error while running
> (installing actually) mod_pyhton under windows XP
>
> I am running
> apache_2.0.54-win32-x86
> python 2.3
> WinXP SP2
>
> the problem is - i install the mod_python binary file and it goes OK.
> I make appropriate changes in my httpd.conf file about LoadModule and
> also add
> <Directory "D/www/python">
>    SetHandler mod_python
>    AddHandler python-program .py
>    PythonHandler mptest
>    PythonDebug on
> </Directory>

If this is actually your config, you have a couple of problems. First is
the directory path is broken in that it is missing the colon from the
driver specifier and second you have both SetHandler and AddHandler 
defined
at the same time, which may cause issues. Try just:

<Directory "D:/www/python">
    AddHandler python-program .py
    PythonHandler mptest
    PythonDebug on
</Directory>

> strings... But i still see *.py scripts as plain text in my browser
>
> I saw few links where such problem was raised but i haven't found the
> solution
>
> the only thing that apache error log says is:
> [Sun Aug 28 11:33:13 2005] [error] [client 192.168.0.11] File does not 
> exist: D:/www/favicon.ico

Did you actually restart Apache to pick up the changed config. You 
should
at least see a mod_python startup message.

> if you have time - please respond

Try referring to and following through:

   http://www.dscpl.com.au/articles/modpython-001.html

Then get yourself subscribed to the mailing list and ask further 
questions
there. I don't use Win32 machines such as Windows XP and so if it comes 
down
to being a Win32 issue, I will not know the answer, but others probably 
will.

> -- 
> Best regards,
>  Alexey Buyakov                          mailto:booboo@flashmob.md

From booboo at flashmob.md  Sun Aug 28 05:10:57 2005
From: booboo at flashmob.md (Booboo)
Date: Sun Aug 28 05:10:58 2005
Subject: [mod_python] mod_python problem under WinXP
Message-ID: <759006204.20050828121057@flashmob.md>

Hellow everyone

I am sorry for bothering but i hava occured an error while running
(installing actually) mod_pyhton under windows XP

I am running
apache_2.0.54-win32-x86
python 2.3
WinXP SP2

the problem is - i install the mod_python binary file and it goes OK.
I make appropriate changes in my httpd.conf file about LoadModule and
also add
<Directory "D/www/python">
   SetHandler mod_python
   AddHandler python-program .py
   PythonHandler mptest
   PythonDebug on
</Directory>

strings... But i still see *.py scripts as plain text in my browser

I saw few links where such problem was raised but i haven't found the
solution

the only thing that apache error log says is:
[Sun Aug 28 11:33:13 2005] [error] [client 192.168.0.11] File does not exist: D:/www/favicon.ico

if you have time - please respond
  

-- 
Best regards,
 Alexey Buyakov                          mailto:booboo@flashmob.md

From grahamd at dscpl.com.au  Sun Aug 28 18:41:12 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Sun Aug 28 18:41:25 2005
Subject: [mod_python] Re: mod_python problem under WinXP
In-Reply-To: <93498996.20050828130328@flashmob.md>
References: <1377186184.20050828113421@flashmob.md>
	<9ec5419f2d025e091e1649b757b30caa@dscpl.com.au>
	<1492557909.20050828120440@flashmob.md>
	<b29a165fd964a24108391bb37b0761f4@dscpl.com.au>
	<93498996.20050828130328@flashmob.md>
Message-ID: <a15ab5ae006372d79e6c89c78160295a@dscpl.com.au>


> I am sorry for not removin set handler directive from config file. I
> placed it there accidentally. The normal lines are
> <Directory "D/www/python">
>    AddHandler python-program .py
>    PythonHandler mptest
>    PythonDebug on
> </Directory>
>
> And i did restart apache after making changes.

But was there a mod_python startup message in the Apache log file to
indicate that mod_python was in fact loaded?

I mentioned this last time and the document I linked to also talks
about it, but you didn't address my comment about it.

> As for win32 machines - i was forced to install the software and work
> on them. That was not my choice.
>
> As for directory path - it is all right. I inserted it from my
> DocumentRoot path and checked it.

If you are confident that that directory name will work, then use this:

   <Directory "D/www/python">
      deny from all
      AddHandler python-program .py
      PythonHandler mptest
      PythonDebug on
   </Directory>

If it is correct, any attempt to access a page in that directory should 
get
back a "Forbidden" error response. If you don't get this, then something
isn't right with the directory name or the position of the directive in
the Apache config file.

You might also do what the linked document suggests, which is not to use
the main Apache configuration file, but use a .htaccess file in the
directory to want the scripts to be in. Use of a .htaccess file is less
prone to problems with getting the path correct as you don't need to
specify it.

Graham

From selecter at gmail.com  Sun Aug 28 18:49:54 2005
From: selecter at gmail.com (Anton)
Date: Sun Aug 28 18:51:12 2005
Subject: [mod_python] My template script isn't working
Message-ID: <39f0215a0508281549366304a9@mail.gmail.com>

I am migrating from php to python. Simple script are attached with templates.

The problem is script isn't being processed by apache (It's not
AddHandler stuff). And I think something is segfaulting.

What is wrong with it?

Script works if I, for example, change QUOTE to QUOTE2 and error occurs:
NameError: name 'QUOTE' is not defined
-------------- next part --------------
A non-text attachment was scrubbed...
Name: index.py
Type: text/x-python
Size: 202 bytes
Desc: not available
Url : http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20050829/98788d89/index.py
-------------- next part --------------
A non-text attachment was scrubbed...
Name: style.css
Type: text/css
Size: 4503 bytes
Desc: not available
Url : http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20050829/98788d89/style.css
-------------- next part --------------
A non-text attachment was scrubbed...
Name: header.tmpl
Type: application/octet-stream
Size: 2441 bytes
Desc: not available
Url : http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20050829/98788d89/header.obj
-------------- next part --------------
A non-text attachment was scrubbed...
Name: index.tmpl
Type: application/octet-stream
Size: 3059 bytes
Desc: not available
Url : http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20050829/98788d89/index.obj
-------------- next part --------------
A non-text attachment was scrubbed...
Name: right.tmpl
Type: application/octet-stream
Size: 1299 bytes
Desc: not available
Url : http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20050829/98788d89/right.obj
From grahamd at dscpl.com.au  Sun Aug 28 19:05:17 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Sun Aug 28 19:05:25 2005
Subject: [mod_python] My template script isn't working
In-Reply-To: <39f0215a0508281549366304a9@mail.gmail.com>
References: <39f0215a0508281549366304a9@mail.gmail.com>
Message-ID: <5f6513040913d56812ee5aa0c1457c91@dscpl.com.au>


On 29/08/2005, at 8:49 AM, Anton wrote:

> I am migrating from php to python. Simple script are attached with  
> templates.
>
> The problem is script isn't being processed by apache (It's not
> AddHandler stuff). And I think something is segfaulting.
>
> What is wrong with it?
>
> Script works if I, for example, change QUOTE to QUOTE2 and error  
> occurs:
> NameError: name 'QUOTE' is not defined
> <index.py><style.css><header.tmpl><index.tmpl><right.tmpl>_____________ 
> _________________________________

In your code you have:

   from mod_python import apache,psp

   def index(req):
     quote = 'quote_of_the_day'
     tmpl = psp.PSP(req, filename='templates/index.tmpl')
     tmpl.run( vars={'QUOTES':quote} )
     return apache.OK

The current working directory will not be that of your script. For
starters, try instead:

   from mod_python import apache,psp

   import os

   __here__ = os.path.dirname(__file__)

   def index(req):
     quote = 'quote_of_the_day'
     tmpl = psp.PSP(req, filename=os.path.join(__here__,'index.tmpl'))
     tmpl.run( vars={'QUOTES':quote} )
     return apache.OK

From selecter at gmail.com  Sun Aug 28 19:13:03 2005
From: selecter at gmail.com (Anton)
Date: Sun Aug 28 19:13:07 2005
Subject: [mod_python] My template script isn't working
In-Reply-To: <5f6513040913d56812ee5aa0c1457c91@dscpl.com.au>
References: <39f0215a0508281549366304a9@mail.gmail.com>
	<5f6513040913d56812ee5aa0c1457c91@dscpl.com.au>
Message-ID: <39f0215a050828161335ec7e8@mail.gmail.com>

Actualy I keep *.tmpl in "templates" directory.
I turned apache debug logging on and got 1 'info':
[Mon Aug 29 02:09:58 2005] [info] (104)Connection reset by peer:
core_output_filter: writing data to the network

It explains my problem. But I don't know how it helps to solve my problem.

2005/8/29, Graham Dumpleton <grahamd@dscpl.com.au>:
> 
> On 29/08/2005, at 8:49 AM, Anton wrote:
> 
> > I am migrating from php to python. Simple script are attached with
> > templates.
> >
> > The problem is script isn't being processed by apache (It's not
> > AddHandler stuff). And I think something is segfaulting.
> >
> > What is wrong with it?
> >
> > Script works if I, for example, change QUOTE to QUOTE2 and error
> > occurs:
> > NameError: name 'QUOTE' is not defined
> > <index.py><style.css><header.tmpl><index.tmpl><right.tmpl>_____________
> > _________________________________
> 
> In your code you have:
> 
>    from mod_python import apache,psp
> 
>    def index(req):
>      quote = 'quote_of_the_day'
>      tmpl = psp.PSP(req, filename='templates/index.tmpl')
>      tmpl.run( vars={'QUOTES':quote} )
>      return apache.OK
> 
> The current working directory will not be that of your script. For
> starters, try instead:
> 
>    from mod_python import apache,psp
> 
>    import os
> 
>    __here__ = os.path.dirname(__file__)
> 
>    def index(req):
>      quote = 'quote_of_the_day'
>      tmpl = psp.PSP(req, filename=os.path.join(__here__,'index.tmpl'))
>      tmpl.run( vars={'QUOTES':quote} )
>      return apache.OK
> 
>

From jg.lists at sympatico.ca  Sun Aug 28 19:45:47 2005
From: jg.lists at sympatico.ca (Jim Gallacher)
Date: Sun Aug 28 19:44:23 2005
Subject: [mod_python] My template script isn't working
In-Reply-To: <5f6513040913d56812ee5aa0c1457c91@dscpl.com.au>
References: <39f0215a0508281549366304a9@mail.gmail.com>
	<5f6513040913d56812ee5aa0c1457c91@dscpl.com.au>
Message-ID: <43124CAB.1040706@sympatico.ca>

Graham Dumpleton wrote:
> 
> On 29/08/2005, at 8:49 AM, Anton wrote:
> 
>> I am migrating from php to python. Simple script are attached with  
>> templates.
>>
>> The problem is script isn't being processed by apache (It's not
>> AddHandler stuff). And I think something is segfaulting.
>>
>> What is wrong with it?
>>
>> Script works if I, for example, change QUOTE to QUOTE2 and error  occurs:
>> NameError: name 'QUOTE' is not defined
>> <index.py><style.css><header.tmpl><index.tmpl><right.tmpl>_____________ 
>> _________________________________
> 
> 
> In your code you have:
> 
>   from mod_python import apache,psp
> 
>   def index(req):
>     quote = 'quote_of_the_day'
>     tmpl = psp.PSP(req, filename='templates/index.tmpl')
>     tmpl.run( vars={'QUOTES':quote} )
>     return apache.OK
> 
> The current working directory will not be that of your script. For
> starters, try instead:
> 
>   from mod_python import apache,psp
> 
>   import os
> 
>   __here__ = os.path.dirname(__file__)
> 
>   def index(req):

       req.content_type = 'text/html'

>     quote = 'quote_of_the_day'
>     tmpl = psp.PSP(req, filename=os.path.join(__here__,'index.tmpl'))
>     tmpl.run( vars={'QUOTES':quote} )
>     return apache.OK

Using Graham's suggestion plus setting the content_type and changing 
QUOTES to QUOTE worked fine for me with your templates using mod_python 
3.2.1b and Firefox. I suggest try using the simplest possible template 
that works and build out from there to find the error.

Jim
From selecter at gmail.com  Sun Aug 28 20:13:47 2005
From: selecter at gmail.com (Anton)
Date: Sun Aug 28 20:13:51 2005
Subject: [mod_python] My template script isn't working
In-Reply-To: <43124CAB.1040706@sympatico.ca>
References: <39f0215a0508281549366304a9@mail.gmail.com>
	<5f6513040913d56812ee5aa0c1457c91@dscpl.com.au>
	<43124CAB.1040706@sympatico.ca>
Message-ID: <39f0215a05082817134ada5b9e@mail.gmail.com>

Ok. But it didn't work as well.

dummy.tmpl:
<html>
<%=QUOTE%>
</html>

index.py:
from mod_python import apache,psp
import os

def index(req):
	req.content_type = 'text/html'
	quote = 'quote_of_the_day'
	tmpl = psp.PSP(req, filename='templates/dummy.tmpl')
	tmpl.run( vars={'QUOTE':quote} )
	return apache.OK


I noticed strange behavior on step 3...
1. Page didn't load as expected

2. I changed 
tmpl.run( vars={'QUOTE':quote} )
to
tmpl.run( vars={'QUOTEeeee':quote} )

and I could see errors ending with: NameError: name 'QUOTE' is not defined

3. I reloaded page and saw the same thing + new string in the middle:
  File "/home/anton/homepage/py-homepage/index.py", line 8, in index
    tmpl.run( vars={'QUOTEeee':quote} )

4. Changed QUOTEeeee to QUOTE, reloaded page and it worked:

quote_of_the_day 0

Then I returned to step 2 and all went again.

I am running Debian sarge with:
python                              2.3.5-2
libapache2-mod-python2.3            3.1.3-3
apache2                             2.0.54-4
mozilla-firefox                     1.0.4-2sarge2

2005/8/29, Jim Gallacher <jg.lists@sympatico.ca>:
> Graham Dumpleton wrote:
> >
> > On 29/08/2005, at 8:49 AM, Anton wrote:
> >
> >> I am migrating from php to python. Simple script are attached with
> >> templates.
> >>
> >> The problem is script isn't being processed by apache (It's not
> >> AddHandler stuff). And I think something is segfaulting.
> >>
> >> What is wrong with it?
> >>
> >> Script works if I, for example, change QUOTE to QUOTE2 and error  occurs:
> >> NameError: name 'QUOTE' is not defined
> >> <index.py><style.css><header.tmpl><index.tmpl><right.tmpl>_____________
> >> _________________________________
> >
> >
> > In your code you have:
> >
> >   from mod_python import apache,psp
> >
> >   def index(req):
> >     quote = 'quote_of_the_day'
> >     tmpl = psp.PSP(req, filename='templates/index.tmpl')
> >     tmpl.run( vars={'QUOTES':quote} )
> >     return apache.OK
> >
> > The current working directory will not be that of your script. For
> > starters, try instead:
> >
> >   from mod_python import apache,psp
> >
> >   import os
> >
> >   __here__ = os.path.dirname(__file__)
> >
> >   def index(req):
> 
>        req.content_type = 'text/html'
> 
> >     quote = 'quote_of_the_day'
> >     tmpl = psp.PSP(req, filename=os.path.join(__here__,'index.tmpl'))
> >     tmpl.run( vars={'QUOTES':quote} )
> >     return apache.OK
> 
> Using Graham's suggestion plus setting the content_type and changing
> QUOTES to QUOTE worked fine for me with your templates using mod_python
> 3.2.1b and Firefox. I suggest try using the simplest possible template
> that works and build out from there to find the error.
> 
> Jim
>

From selecter at gmail.com  Sun Aug 28 20:22:46 2005
From: selecter at gmail.com (Anton)
Date: Sun Aug 28 20:22:50 2005
Subject: [mod_python] My template script isn't working
In-Reply-To: <39f0215a05082817134ada5b9e@mail.gmail.com>
References: <39f0215a0508281549366304a9@mail.gmail.com>
	<5f6513040913d56812ee5aa0c1457c91@dscpl.com.au>
	<43124CAB.1040706@sympatico.ca>
	<39f0215a05082817134ada5b9e@mail.gmail.com>
Message-ID: <39f0215a050828172251712f9a@mail.gmail.com>

I place this script in /home/anton/homepage/py-homepage

$ cat /etc/apache2/sites-enabled/000-default
NameVirtualHost localhost
<VirtualHost localhost>
        ServerAdmin selecter@gmail.com

        DocumentRoot /home/anton/homepage
        <Directory />
                Options FollowSymLinks
                AllowOverride None
        </Directory>
        <Directory /home/anton/homepage>
                AddHandler mod_python .py .spy .psp
                PythonHandler mod_python.publisher | .py
                PythonHandler spyce.run_spyceModpy::spyceMain | .spy
                PythonHandler mod_python.psp | .psp
                PythonDebug On
                Options Indexes FollowSymLinks MultiViews
                AllowOverride None
                Order allow,deny
                allow from all
        </Directory>

        ScriptAlias /cgi-bin/ /usr/lib/cgi-bin/
        <Directory "/usr/lib/cgi-bin">
                AllowOverride None
                Options ExecCGI -MultiViews +SymLinksIfOwnerMatch
                Order allow,deny
                Allow from all
        </Directory>

        ErrorLog /var/log/apache2/error.log

        # Possible values include: debug, info, notice, warn, error, crit,
        # alert, emerg.
        LogLevel debug

        CustomLog /var/log/apache2/access.log combined
        ServerSignature On

    Alias /doc/ "/usr/share/doc/"
    <Directory "/usr/share/doc/">
        Options Indexes MultiViews FollowSymLinks
        AllowOverride None
        Order deny,allow
        Deny from all
        Allow from 127.0.0.0/255.0.0.0 ::1/128
    </Directory>

</VirtualHost>

2005/8/29, Anton <selecter@gmail.com>:
> Ok. But it didn't work as well.
> 
> dummy.tmpl:
> <html>
> <%=QUOTE%>
> </html>
> 
> index.py:
> from mod_python import apache,psp
> import os
> 
> def index(req):
>         req.content_type = 'text/html'
>         quote = 'quote_of_the_day'
>         tmpl = psp.PSP(req, filename='templates/dummy.tmpl')
>         tmpl.run( vars={'QUOTE':quote} )
>         return apache.OK
> 
> 
> I noticed strange behavior on step 3...
> 1. Page didn't load as expected
> 
> 2. I changed
> tmpl.run( vars={'QUOTE':quote} )
> to
> tmpl.run( vars={'QUOTEeeee':quote} )
> 
> and I could see errors ending with: NameError: name 'QUOTE' is not defined
> 
> 3. I reloaded page and saw the same thing + new string in the middle:
>   File "/home/anton/homepage/py-homepage/index.py", line 8, in index
>     tmpl.run( vars={'QUOTEeee':quote} )
> 
> 4. Changed QUOTEeeee to QUOTE, reloaded page and it worked:
> 
> quote_of_the_day 0
> 
> Then I returned to step 2 and all went again.
> 
> I am running Debian sarge with:
> python                              2.3.5-2
> libapache2-mod-python2.3            3.1.3-3
> apache2                             2.0.54-4
> mozilla-firefox                     1.0.4-2sarge2
> 
> 2005/8/29, Jim Gallacher <jg.lists@sympatico.ca>:
> > Graham Dumpleton wrote:
> > >
> > > On 29/08/2005, at 8:49 AM, Anton wrote:
> > >
> > >> I am migrating from php to python. Simple script are attached with
> > >> templates.
> > >>
> > >> The problem is script isn't being processed by apache (It's not
> > >> AddHandler stuff). And I think something is segfaulting.
> > >>
> > >> What is wrong with it?
> > >>
> > >> Script works if I, for example, change QUOTE to QUOTE2 and error  occurs:
> > >> NameError: name 'QUOTE' is not defined
> > >> <index.py><style.css><header.tmpl><index.tmpl><right.tmpl>_____________
> > >> _________________________________
> > >
> > >
> > > In your code you have:
> > >
> > >   from mod_python import apache,psp
> > >
> > >   def index(req):
> > >     quote = 'quote_of_the_day'
> > >     tmpl = psp.PSP(req, filename='templates/index.tmpl')
> > >     tmpl.run( vars={'QUOTES':quote} )
> > >     return apache.OK
> > >
> > > The current working directory will not be that of your script. For
> > > starters, try instead:
> > >
> > >   from mod_python import apache,psp
> > >
> > >   import os
> > >
> > >   __here__ = os.path.dirname(__file__)
> > >
> > >   def index(req):
> >
> >        req.content_type = 'text/html'
> >
> > >     quote = 'quote_of_the_day'
> > >     tmpl = psp.PSP(req, filename=os.path.join(__here__,'index.tmpl'))
> > >     tmpl.run( vars={'QUOTES':quote} )
> > >     return apache.OK
> >
> > Using Graham's suggestion plus setting the content_type and changing
> > QUOTES to QUOTE worked fine for me with your templates using mod_python
> > 3.2.1b and Firefox. I suggest try using the simplest possible template
> > that works and build out from there to find the error.
> >
> > Jim
> >
>

From grahamd at dscpl.com.au  Sun Aug 28 20:28:34 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Sun Aug 28 20:28:38 2005
Subject: [mod_python] My template script isn't working
Message-ID: <1125275314.26718@dscpl.user.openhosting.com>

Where ever you keep your templates, you can't use a relative path to the
filename argument as the current working directory could be set to
anything. You therefore must use an absolute pathname meaning you either
have to hard code pathnames (bad), express them relative to a hard coded
pathname set as a PythonOption setting (not so bad), or express them
relative to the location of the script as determined from __file__.

Thus, even if that exact code you provided may work now, there is no
gaurantee that it would work under a different Apache setup where the
working directory of Apache is different.

Anton wrote ..
> Actualy I keep *.tmpl in "templates" directory.
> I turned apache debug logging on and got 1 'info':
> [Mon Aug 29 02:09:58 2005] [info] (104)Connection reset by peer:
> core_output_filter: writing data to the network
> 
> It explains my problem. But I don't know how it helps to solve my problem.
> 
> 2005/8/29, Graham Dumpleton <grahamd@dscpl.com.au>:
> > 
> > On 29/08/2005, at 8:49 AM, Anton wrote:
> > 
> > > I am migrating from php to python. Simple script are attached with
> > > templates.
> > >
> > > The problem is script isn't being processed by apache (It's not
> > > AddHandler stuff). And I think something is segfaulting.
> > >
> > > What is wrong with it?
> > >
> > > Script works if I, for example, change QUOTE to QUOTE2 and error
> > > occurs:
> > > NameError: name 'QUOTE' is not defined
> > > <index.py><style.css><header.tmpl><index.tmpl><right.tmpl>_____________
> > > _________________________________
> > 
> > In your code you have:
> > 
> >    from mod_python import apache,psp
> > 
> >    def index(req):
> >      quote = 'quote_of_the_day'
> >      tmpl = psp.PSP(req, filename='templates/index.tmpl')
> >      tmpl.run( vars={'QUOTES':quote} )
> >      return apache.OK
> > 
> > The current working directory will not be that of your script. For
> > starters, try instead:
> > 
> >    from mod_python import apache,psp
> > 
> >    import os
> > 
> >    __here__ = os.path.dirname(__file__)
> > 
> >    def index(req):
> >      quote = 'quote_of_the_day'
> >      tmpl = psp.PSP(req, filename=os.path.join(__here__,'index.tmpl'))
> >      tmpl.run( vars={'QUOTES':quote} )
> >      return apache.OK
> > 
> >
From grahamd at dscpl.com.au  Sun Aug 28 20:35:17 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Sun Aug 28 20:35:29 2005
Subject: [mod_python] My template script isn't working
Message-ID: <1125275717.30886@dscpl.user.openhosting.com>

Anton wrote ..
>         <Directory /home/anton/homepage>
>                 AddHandler mod_python .py .spy .psp
>                 PythonHandler mod_python.publisher | .py
>                 PythonHandler spyce.run_spyceModpy::spyceMain | .spy
>                 PythonHandler mod_python.psp | .psp
>                 PythonDebug On
>                 Options Indexes FollowSymLinks MultiViews
>                 AllowOverride None
>                 Order allow,deny
>                 allow from all
>         </Directory>
>
> ...
>
> > index.py:
> > from mod_python import apache,psp
> > import os
> > 
> > def index(req):
> >         req.content_type = 'text/html'
> >         quote = 'quote_of_the_day'
> >         tmpl = psp.PSP(req, filename='templates/dummy.tmpl')
> >         tmpl.run( vars={'QUOTE':quote} )
> >         return apache.OK

Something else to be careful of, there is a bug in mod_python (fixed in 3.2),
whereby:

  from mod_python import psp

will not always work if you also have:

  PythonHandler mod_python.psp | .psp

and a .psp file is accessed directly before the handler which tries to import the
psp module.

Use the following instead:

  psp = apache.import_module("mod_python.psp")

None of the things I have mentioned may be your real problem, but they
should at least make your code a bit more robust in the bigger scheme
of things.

Graham
From grahamd at dscpl.com.au  Mon Aug 29 01:20:22 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Mon Aug 29 01:20:51 2005
Subject: [mod_python] Re[2]: mod_python problem under WinXP
Message-ID: <1125292822.27613@dscpl.user.openhosting.com>

Booboo wrote ..
> > But was there a mod_python startup message in the Apache log file to
> > indicate that mod_python was in fact loaded?
> Hmm... apache starts clearly, i see no messages at all
> 
> > If you are confident that that directory name will work, then use this:
> 
> >    <Directory "D/www/python">
> >       deny from all
> >       AddHandler python-program .py
> >       PythonHandler mptest
> >       PythonDebug on
> >    </Directory>
> 
> I found an error there - forgot to put ":" in D:\ situation changed a
> bit and it writes me in the browser window the following (without deny
> from all of course):
> 
> Hello World!
> <pre>
> Mod_python error: "PythonHandler mptest"
> 
> Traceback (most recent call last):
> 
>   File "C:\PYTHON23\Lib\site-packages\mod_python\apache.py", line 299,
> in HandlerDispatch
>     result = object(req)
> 
>   File "D:/www/python/\mptest.py", line 5, in handler
>     return apache.OK
> 
> NameError: global name 'apache' is not defined
> 
> </pre>
> 
> So i suppose the problem is in the python itself and not in apache or
> .htaccess files. Any suggestions?

You are most likely missing the line "from mod_python import apache".
Use the mptest example exactly as written in the linked document I sent. Ie.,

  from mod_python import apache

  def handler(req):
      req.content_type = 'text/plain'
      req.send_http_header()
      req.write('mptest.py\n')
      return apache.OK

Graham
From selecter at gmail.com  Mon Aug 29 04:49:37 2005
From: selecter at gmail.com (Anton)
Date: Mon Aug 29 04:49:41 2005
Subject: [mod_python] My template script isn't working
In-Reply-To: <1125275717.30886@dscpl.user.openhosting.com>
References: <1125275717.30886@dscpl.user.openhosting.com>
Message-ID: <39f0215a05082901495c74913e@mail.gmail.com>

Thanks, Graham, for so detailed explanation. I think your suggestion
has just worked. I also had random errors like "psp cannot be
imported".

2005/8/29, Graham Dumpleton <grahamd@dscpl.com.au>:
> Anton wrote ..
> >         <Directory /home/anton/homepage>
> >                 AddHandler mod_python .py .spy .psp
> >                 PythonHandler mod_python.publisher | .py
> >                 PythonHandler spyce.run_spyceModpy::spyceMain | .spy
> >                 PythonHandler mod_python.psp | .psp
> >                 PythonDebug On
> >                 Options Indexes FollowSymLinks MultiViews
> >                 AllowOverride None
> >                 Order allow,deny
> >                 allow from all
> >         </Directory>
> >
> > ...
> >
> > > index.py:
> > > from mod_python import apache,psp
> > > import os
> > >
> > > def index(req):
> > >         req.content_type = 'text/html'
> > >         quote = 'quote_of_the_day'
> > >         tmpl = psp.PSP(req, filename='templates/dummy.tmpl')
> > >         tmpl.run( vars={'QUOTE':quote} )
> > >         return apache.OK
> 
> Something else to be careful of, there is a bug in mod_python (fixed in 3.2),
> whereby:
> 
>   from mod_python import psp
> 
> will not always work if you also have:
> 
>   PythonHandler mod_python.psp | .psp
> 
> and a .psp file is accessed directly before the handler which tries to import the
> psp module.
> 
> Use the following instead:
> 
>   psp = apache.import_module("mod_python.psp")
> 
> None of the things I have mentioned may be your real problem, but they
> should at least make your code a bit more robust in the bigger scheme
> of things.
> 
> Graham
>

From selecter at gmail.com  Mon Aug 29 06:10:37 2005
From: selecter at gmail.com (Anton)
Date: Mon Aug 29 06:10:43 2005
Subject: [mod_python] My template script isn't working
In-Reply-To: <39f0215a05082901495c74913e@mail.gmail.com>
References: <1125275717.30886@dscpl.user.openhosting.com>
	<39f0215a05082901495c74913e@mail.gmail.com>
Message-ID: <39f0215a05082903106d32ab0a@mail.gmail.com>

But cache problems still persist. For example, I change something in
file, reload page - see no changes. Reload, reload... Nothing!
Sometimes I see old code in errors.

Then I do /etc/init.d/apache2 restart
reload page in firefox (or konqueror), and see changes.

What would you suggest to do? Upgrade to latest mod_python?

From grahamd at dscpl.com.au  Mon Aug 29 06:20:50 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Mon Aug 29 06:20:48 2005
Subject: [mod_python] My template script isn't working
In-Reply-To: <39f0215a05082903106d32ab0a@mail.gmail.com>
References: <1125275717.30886@dscpl.user.openhosting.com>
	<39f0215a05082901495c74913e@mail.gmail.com>
	<39f0215a05082903106d32ab0a@mail.gmail.com>
Message-ID: <A9BC77A9-6794-4F97-BEC6-447CC17BEB7F@dscpl.com.au>


On 29/08/2005, at 8:10 PM, Anton wrote:

> But cache problems still persist. For example, I change something in
> file, reload page - see no changes. Reload, reload... Nothing!
> Sometimes I see old code in errors.
>
> Then I do /etc/init.d/apache2 restart
> reload page in firefox (or konqueror), and see changes.
>
> What would you suggest to do? Upgrade to latest mod_python?

There are known issues with module reloading in current versions of  
mod_python.
For some background information, read:

   http://www.dscpl.com.au/articles/modpython-002.html
   http://www.dscpl.com.au/articles/modpython-003.html

If you are using mod_python.publisher, some issues are avoided by  
using beta
version 3.2 of mod_python, but most of the issues aren't going to be  
resolved until
version 3.3 of mod_python.

If you can describe how your files are arranged, may be able to  
better explain
which particular problem you are having.

Graham

From selecter at gmail.com  Mon Aug 29 08:23:59 2005
From: selecter at gmail.com (Anton)
Date: Mon Aug 29 08:24:11 2005
Subject: [mod_python] My template script isn't working
In-Reply-To: <A9BC77A9-6794-4F97-BEC6-447CC17BEB7F@dscpl.com.au>
References: <1125275717.30886@dscpl.user.openhosting.com>
	<39f0215a05082901495c74913e@mail.gmail.com>
	<39f0215a05082903106d32ab0a@mail.gmail.com>
	<A9BC77A9-6794-4F97-BEC6-447CC17BEB7F@dscpl.com.au>
Message-ID: <39f0215a05082905236e978827@mail.gmail.com>

I have read your articles. Well written :)
I think I know exactly what particular problem I am having

As it is written here http://issues.apache.org/jira/browse/MODPYTHON-7:
"This means that if one restores an old version of a file from backup,
eg., by using "mv" command from another location, it will not reload
it and it is necessary to touch the file or restart Apache."

I upgraded to mod_python 3.2.0 but anyway bug still persists.
'if mtime != oldmtime' is in apache.py though

Here is how my files are arranged:
ftp://selecter.no-ip.org/py-homepage/

2005/8/29, Graham Dumpleton <grahamd@dscpl.com.au>:
> 
> On 29/08/2005, at 8:10 PM, Anton wrote:
> 
> > But cache problems still persist. For example, I change something in
> > file, reload page - see no changes. Reload, reload... Nothing!
> > Sometimes I see old code in errors.
> >
> > Then I do /etc/init.d/apache2 restart
> > reload page in firefox (or konqueror), and see changes.
> >
> > What would you suggest to do? Upgrade to latest mod_python?
> 
> There are known issues with module reloading in current versions of
> mod_python.
> For some background information, read:
> 
>    http://www.dscpl.com.au/articles/modpython-002.html
>    http://www.dscpl.com.au/articles/modpython-003.html
> 
> If you are using mod_python.publisher, some issues are avoided by
> using beta
> version 3.2 of mod_python, but most of the issues aren't going to be
> resolved until
> version 3.3 of mod_python.
> 
> If you can describe how your files are arranged, may be able to
> better explain
> which particular problem you are having.
> 
> Graham

From grahamd at dscpl.com.au  Mon Aug 29 08:37:39 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Mon Aug 29 08:37:46 2005
Subject: [mod_python] My template script isn't working
In-Reply-To: <39f0215a05082905236e978827@mail.gmail.com>
References: <1125275717.30886@dscpl.user.openhosting.com>
	<39f0215a05082901495c74913e@mail.gmail.com>
	<39f0215a05082903106d32ab0a@mail.gmail.com>
	<A9BC77A9-6794-4F97-BEC6-447CC17BEB7F@dscpl.com.au>
	<39f0215a05082905236e978827@mail.gmail.com>
Message-ID: <6F619DF0-CEC4-4668-BEB9-BE7753E93D22@dscpl.com.au>


On 29/08/2005, at 10:23 PM, Anton wrote:

> I have read your articles. Well written :)
> I think I know exactly what particular problem I am having
>
> As it is written here http://issues.apache.org/jira/browse/ 
> MODPYTHON-7:
> "This means that if one restores an old version of a file from backup,
> eg., by using "mv" command from another location, it will not reload
> it and it is necessary to touch the file or restart Apache."
>
> I upgraded to mod_python 3.2.0 but anyway bug still persists.
> 'if mtime != oldmtime' is in apache.py though
>
> Here is how my files are arranged:
> ftp://selecter.no-ip.org/py-homepage/

Have a play with this instead (untested):

   from mod_python import apache
   psp = apache.import_module("mod_python.psp")
   import os,sys

   __here__ = os.path.dirname(__file__)
   __include_dir = os.path.join(__here__,'include')

   def index(req):
       quote_of_the_day = apache.import_module 
('quote_of_the_day',log=1,path=[__include_dir])
       req.content_type = 'text/html'
       tmpl = psp.PSP(req, filename=os.path.join(__here__, 'templates/ 
index.tmpl'))
       tmpl.run( vars={'QUOTE':quote_of_the_day.today_quote()} )
       return

By using "import_module()" within the scope of the executing handler,  
a check
is made on each request as to whether the quote Python code file has  
changed
and it will be reloaded if necessary when it does.

Graham
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20050829/f4f4eb36/attachment.html
From selecter at gmail.com  Mon Aug 29 09:05:44 2005
From: selecter at gmail.com (Anton)
Date: Mon Aug 29 09:05:48 2005
Subject: [mod_python] My template script isn't working
In-Reply-To: <6F619DF0-CEC4-4668-BEB9-BE7753E93D22@dscpl.com.au>
References: <1125275717.30886@dscpl.user.openhosting.com>
	<39f0215a05082901495c74913e@mail.gmail.com>
	<39f0215a05082903106d32ab0a@mail.gmail.com>
	<A9BC77A9-6794-4F97-BEC6-447CC17BEB7F@dscpl.com.au>
	<39f0215a05082905236e978827@mail.gmail.com>
	<6F619DF0-CEC4-4668-BEB9-BE7753E93D22@dscpl.com.au>
Message-ID: <39f0215a05082906053b8ea7e7@mail.gmail.com>

IT WORKED!

[Mon Aug 29 16:00:48 2005] [notice] mod_python: (Re)importing module
'quote_of_the_day' with path set to
'['/home/anton/homepage/py-homepage/include']'

Thanks a lot! :)
At the same time I have discovered firefox' terrible memory leaks.
Maybe it somehow related to this bug.

2005/8/29, Graham Dumpleton <grahamd@dscpl.com.au>:
> 
> 
> On 29/08/2005, at 10:23 PM, Anton wrote:
> 
> I have read your articles. Well written :)
> I think I know exactly what particular problem I am having
> 
> As it is written here
> http://issues.apache.org/jira/browse/MODPYTHON-7:
> "This means that if one restores an old version of a file from backup,
> eg., by using "mv" command from another location, it will not reload
> it and it is necessary to touch the file or restart Apache."
> 
> I upgraded to mod_python 3.2.0 but anyway bug still persists.
> 'if mtime != oldmtime' is in apache.py though
> 
> Here is how my files are arranged:
> ftp://selecter.no-ip.org/py-homepage/
> Have a play with this instead (untested):
> 
>   from mod_python import apache
>   psp = apache.import_module("mod_python.psp")
>   import os,sys
> 
>   __here__ = os.path.dirname(__file__)
>   __include_dir = os.path.join(__here__,'include')
> 
>   def index(req):
>       quote_of_the_day =
> apache.import_module('quote_of_the_day',log=1,path=[__include_dir])
>       req.content_type = 'text/html'
>       tmpl = psp.PSP(req, filename=os.path.join(__here__,
> 'templates/index.tmpl'))
>       tmpl.run(
> vars={'QUOTE':quote_of_the_day.today_quote()} )
>       return
> 
> By using "import_module()" within the scope of the executing handler, a
> check
> is made on each request as to whether the quote Python code file has changed
> and it will be reloaded if necessary when it does.
> 
> Graham

From stian at soiland.no  Tue Aug 30 07:02:26 2005
From: stian at soiland.no (=?ISO-8859-1?Q?Stian_S=F8iland?=)
Date: Tue Aug 30 07:03:51 2005
Subject: [mod_python] Blank form values are not showing up in
	my	mod_pyton/mpservlets environments
In-Reply-To: <431009B2.6060208@mischko.com>
References: <430FDBCC.2070803@mischko.com>	<25FFE189-DCAE-48DB-A6EE-E86EDB438925@dscpl.com.au>
	<4310015A.40604@mischko.com> <431009B2.6060208@mischko.com>
Message-ID: <86D46A77-160F-4BAD-811E-CA578DA5FC47@soiland.no>


On 27. aug. 2005, at 07:35, Scott Chapman wrote:


> It turns out that checkboxes are not submitted with forms if the  
> checkboxes are unchecked and this is standard behavior for web  
> browsers.  This may be the _dumbest_ thing I've ever seen.  I  
> haven't tested it with radio inputs but I have read that it may be  
> the case there as well.
>

It's normal behavour for all controls that don't contain any value to  
not be sent, even input fields. So don't expect the browsers to send  
any blank values. Also note the difference from submitting by  
pressing Enter and clicking a submit button with a field name:

   <input type="submit" name="something" value="Submit me" />

The something-value will only be sent when the button is pushed, even  
if this is the only submit button in the form.

Standard trick in Publisher is to use default values for such  
parameters.

-- 
Stian S?iland               People who enjoy meetings should not
Birmingham, UK              be in charge of anything. [Sowell]
http://soiland.no/
                      =/\=




From labs at ixopusada.com  Tue Aug 30 15:44:15 2005
From: labs at ixopusada.com (IR labs)
Date: Tue Aug 30 15:47:14 2005
Subject: [mod_python] transhandler setup?
In-Reply-To: <c81dfac26014a65427f09a833aaf43fa@dscpl.com.au>
References: <1b86ca3d12073700e004dbf8c632e925@ixopusada.com>
	<eb31d0b2cd237177c63ada0f30b354cd@dscpl.com.au>
	<bf10f5f08cc0a26fe706e91aa2557691@ixopusada.com>
	<c81dfac26014a65427f09a833aaf43fa@dscpl.com.au>
Message-ID: <9ae79ec1086d0d39da556919bf7cfd05@ixopusada.com>

Sorry for a late reply.

I feel really silly for my problem, *really* silly. (almost too silly 
to let you all know ...)
After trying all different things in the httpd.conf and not seeing any 
noticeable result, I started thinking it could be having to do with 
apache not reading it after I issued "sudo apachectl restart". And then 
I realized that, after I upgraded to apache 2, to make mod_python work 
decently, I forgot to also change the path to /usr/local/apache2/bin in 
my .profile. DUH... So every time I tried to made a change to apache2's 
httpd.conf and "restarted" I restarted apache 1, ... well, zero points 
for dirk and no desert for a week. :-(

So I got everything working in the end.

But thanks for this solution to have everything (also the stuff we 
don't want to handle) handled by the handler in main.py.
My only remaining question now, would be what you recommend?
1. Don't use the transhandle phase, and have *all* requests handled by 
the main PythonHandler, including the ones it shouldn't handle ( 
apache.DECLINE)
or.
2. Use the TransHandler phase to discern between real physical present 
files (requests for .html, .css, .js etc. files) and virtual pages that 
should be handled by main.py

Thanks,
dirk

On 26-aug-05, at 04:19, Graham Dumpleton wrote:

> If your content handler doesn't want to handle a request, have it 
> return
> apache.DECLINED and Apache will then serve up any static file that may
> have been identified by the URL.
>
>   def handler(req):
>     extension = os.path.splitext(req.filename)[1]
>     if extension == ".html":
>       if not os.path.exists(req.filename):
>         ...
>       else:
>         return apache.DECLINED
>     else:
>       return apache.DECLINED
>
> That is at least one way of doing it, although this will disable
> processing in some cases by other Apache modules such as PHP. You can
> get around that by explicitly disabling use of mod_python for that
> extension:
>
>   <Directory /document/root>
>   SetHandler mod_python
>   PythonHandler main
>   <Files *.php>
>   SetHandler None
>   </Files>
>   </Directory>
>
> Rather than using subtraction, you could instead be additive:
>
>   <Directory /document/root>
>   AddHandler mod_python .html
>   PythonHandler main
>   </Directory>
>
> Thus, if you are only interested in intercepting .html files, only
> have mod_python triggered for them.
>
> In respect of transhandler(), all I can really comment on there is
> that if setting PythonTransHandler, you do not need to use either
> AddHandler or SetHandler. These latter directives only need to be
> used if setting PythonHandler, ie., the content handler. As the
> documentation points out, PythonTransHandler can only be used at
> top level scope, ie., not with a Directory, Location or Files
> directive or in a .htaccess file.
>
> Graham
>
> On 26/08/2005, at 11:57 AM, IR labs wrote:
>
>> Sorry, I haven't been clear. I don't want so much to handle all 
>> requests under a directory. I like to handle all requests in general, 
>> and than first analyze the url. ((If the it is a certain file (.gif, 
>> .jpg, .css, .js) or a certain directory, apache should handle it 
>> further, i.e. just serve that file. If it is just a path or a .html, 
>> I want a python script to check wether the directory or file indeed 
>> exist or not. If the index.html or other .html file doesn't exist the 
>> main.py should take it over.))
>> So I wan't this analysis be done during the transHandler phase. But 
>> how do I make apache run my translate.py first? where do I put my 
>> config lines?
>> PythonPath "sys.path + ['/some/path']"
>> PythonTransHandler translate
>>
>> thx
>> dirk
>

-----------------------------
Dirk van Oosterbosch
dirk@ixopusada.com
-----------------------------


From list at joreybump.com  Tue Aug 30 16:14:42 2005
From: list at joreybump.com (Jorey Bump)
Date: Tue Aug 30 16:14:49 2005
Subject: [mod_python] transhandler setup?
In-Reply-To: <9ae79ec1086d0d39da556919bf7cfd05@ixopusada.com>
References: <1b86ca3d12073700e004dbf8c632e925@ixopusada.com>	<eb31d0b2cd237177c63ada0f30b354cd@dscpl.com.au>	<bf10f5f08cc0a26fe706e91aa2557691@ixopusada.com>	<c81dfac26014a65427f09a833aaf43fa@dscpl.com.au>
	<9ae79ec1086d0d39da556919bf7cfd05@ixopusada.com>
Message-ID: <4314BE32.5050905@joreybump.com>

IR labs wrote:
> Sorry for a late reply.
> 
> I feel really silly for my problem, *really* silly. (almost too silly to 
> let you all know ...)
> After trying all different things in the httpd.conf and not seeing any 
> noticeable result, I started thinking it could be having to do with 
> apache not reading it after I issued "sudo apachectl restart". And then 
> I realized that, after I upgraded to apache 2, to make mod_python work 
> decently, I forgot to also change the path to /usr/local/apache2/bin in 
> my .profile. DUH... So every time I tried to made a change to apache2's 
> httpd.conf and "restarted" I restarted apache 1, ... well, zero points 
> for dirk and no desert for a week. :-(

It's an easy mistake to make, with a simple solution:

1. Always prepend root's $PATH with /usr/local/sbin:/usr/local/bin (and 
just /usr/local/bin for ordinary users). I typically make sure this is 
done globally in /etc/profile, which works for some shells, but others 
may require edits to other files. However you accomplish this, I 
consider it quite sane. For experimental installs of applications, use 
your own ~/bin and *append* that to your path.

2. Use an init script if your system supports it. You can either change 
the stock one or create a new one for your particular version. For 
example, on Slackware Linux, the startup script is /etc/rc.d/rc.httpd. 
Since I install my own apache 2.x without uninstalling Slack's 1.3x 
version, I create /etc/rc.d/rc.apache, and everything is harmonious.

From list at joreybump.com  Tue Aug 30 16:29:40 2005
From: list at joreybump.com (Jorey Bump)
Date: Tue Aug 30 16:29:47 2005
Subject: [mod_python] transhandler setup?
In-Reply-To: <4314BE32.5050905@joreybump.com>
References: <1b86ca3d12073700e004dbf8c632e925@ixopusada.com>	<eb31d0b2cd237177c63ada0f30b354cd@dscpl.com.au>	<bf10f5f08cc0a26fe706e91aa2557691@ixopusada.com>	<c81dfac26014a65427f09a833aaf43fa@dscpl.com.au>	<9ae79ec1086d0d39da556919bf7cfd05@ixopusada.com>
	<4314BE32.5050905@joreybump.com>
Message-ID: <4314C1B4.7030604@joreybump.com>

Jorey Bump wrote:
> IR labs wrote:
> 
>> Sorry for a late reply.
>>
>> I feel really silly for my problem, *really* silly. (almost too silly 
>> to let you all know ...)
>> After trying all different things in the httpd.conf and not seeing any 
>> noticeable result, I started thinking it could be having to do with 
>> apache not reading it after I issued "sudo apachectl restart". And 
>> then I realized that, after I upgraded to apache 2, to make mod_python 
>> work decently, I forgot to also change the path to 
>> /usr/local/apache2/bin in my .profile. DUH... So every time I tried to 
>> made a change to apache2's httpd.conf and "restarted" I restarted 
>> apache 1, ... well, zero points for dirk and no desert for a week. :-(
> 
> 
> It's an easy mistake to make, with a simple solution:
> 
> 1. Always prepend root's $PATH with /usr/local/sbin:/usr/local/bin (and 
> just /usr/local/bin for ordinary users). I typically make sure this is 
> done globally in /etc/profile, which works for some shells, but others 
> may require edits to other files. However you accomplish this, I 
> consider it quite sane. For experimental installs of applications, use 
> your own ~/bin and *append* that to your path.

Of course, that still doesn't help here, unless you create symlinks in 
/usr/local/[s]bin to the programs in /usr/local/apache2/bin or prepend 
it to your path. Double DUH... :P

From grahamd at dscpl.com.au  Tue Aug 30 18:49:03 2005
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Tue Aug 30 18:50:01 2005
Subject: [mod_python] transhandler setup?
In-Reply-To: <9ae79ec1086d0d39da556919bf7cfd05@ixopusada.com>
References: <1b86ca3d12073700e004dbf8c632e925@ixopusada.com>
	<eb31d0b2cd237177c63ada0f30b354cd@dscpl.com.au>
	<bf10f5f08cc0a26fe706e91aa2557691@ixopusada.com>
	<c81dfac26014a65427f09a833aaf43fa@dscpl.com.au>
	<9ae79ec1086d0d39da556919bf7cfd05@ixopusada.com>
Message-ID: <7d2dd37bf7033362941883d94d0d9fff@dscpl.com.au>


On 31/08/2005, at 5:44 AM, IR labs wrote:

> Sorry for a late reply.
>
> I feel really silly for my problem, *really* silly. (almost too silly 
> to let you all know ...)
> After trying all different things in the httpd.conf and not seeing any 
> noticeable result, I started thinking it could be having to do with 
> apache not reading it after I issued "sudo apachectl restart". And 
> then I realized that, after I upgraded to apache 2, to make mod_python 
> work decently, I forgot to also change the path to 
> /usr/local/apache2/bin in my .profile. DUH... So every time I tried to 
> made a change to apache2's httpd.conf and "restarted" I restarted 
> apache 1, ... well, zero points for dirk and no desert for a week. :-(
>
> So I got everything working in the end.
>
> But thanks for this solution to have everything (also the stuff we 
> don't want to handle) handled by the handler in main.py.
> My only remaining question now, would be what you recommend?
> 1. Don't use the transhandle phase, and have *all* requests handled by 
> the main PythonHandler, including the ones it shouldn't handle ( 
> apache.DECLINE)
> or.
> 2. Use the TransHandler phase to discern between real physical present 
> files (requests for .html, .css, .js etc. files) and virtual pages 
> that should be handled by main.py

It all depends on exactly what you want to do, as these probably aren't
the only alternatives. If you want a request against a directory to be
rerouted, look at the DirectoryIndex directive. If you want to reroute a
request against a non existent file based on a specific extension type,
you may also be able to use mod_rewrite. Finally, there is also the
ErrorDocument directive for non existent files as well. All of these
might feasibly be harnessed to provide part of the solution and using
Python to make the decision may be a more complicated choice than some
of Apache's core features designed for this sort of thing.

Graham

