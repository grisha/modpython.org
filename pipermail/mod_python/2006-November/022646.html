<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Why this code fails?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Why%20this%20code%20fails%3F&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022645.html">
   <LINK REL="Next"  HREF="022650.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Why this code fails?</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Why%20this%20code%20fails%3F&In-Reply-To="
       TITLE="[mod_python] Why this code fails?">grahamd at dscpl.com.au
       </A><BR>
    <I>Sun Nov 19 22:20:51 EST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="022645.html">[mod_python] Why this code fails?
</A></li>
        <LI>Next message: <A HREF="022650.html">[mod_python] Newbie ?s regarding sessions
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22646">[ date ]</a>
              <a href="thread.html#22646">[ thread ]</a>
              <a href="subject.html#22646">[ subject ]</a>
              <a href="author.html#22646">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>=?iso-8859-1?Q?Luis_M._Gonz=E1lez?= wrote ..
&gt;<i> Hello all,
</I>&gt;<i> 
</I>&gt;<i> I have this script, which works fine when tested with the interpreter,
</I>&gt;<i> but fails when used with mod_python:
</I>&gt;<i> 
</I>&gt;<i> # index.py
</I>&gt;<i> 
</I>&gt;<i> import sys, os
</I>&gt;<i> sys.path.append(os.getcwd() + '/templates')
</I>&gt;<i> sys.path.append(os.getcwd() + '/models')
</I>
You shouldn't modify sys.path from inside a handler code file as it can
cause lots of problems. Also, os.getcwd() is going to usually return '/'
and not the directory the file resides in. It is also not a good idea to be
placing modules required by your handlers within the document tree
like this because if you do not protect them properly from access in
the Apache configuration, users may be able to trigger code or access
data within the modules directly.

The better thing to do is to move those module directories somewhere
outside of the document tree and then use the PythonPath directive to
extend the value of sys.path with the directory you place the two module
directories in. 

Also note there are various problems with the module importer in
current versions of mod_python. See:

  <A HREF="http://www.dscpl.com.au/wiki/ModPython/Articles/ModuleImportingIsBroken">http://www.dscpl.com.au/wiki/ModPython/Articles/ModuleImportingIsBroken</A>

This could be resulting in you picking up a wrong version of a module
if the same module name is used in multiple places, or an old module
version cached in memory and not changes you may have made on disk
since it was loaded. You may as a result have to restart Apache if not
getting latest module changes. You may also need to use PythonInterpreter
to make sure distinct applications operate in their own interpreters to
avoid problems with similar module names being used.

Graham

&gt;<i> from models import *
</I>&gt;<i> 
</I>&gt;<i> result = Customers.select()
</I>&gt;<i> 
</I>&gt;<i> def index(req):
</I>&gt;<i>     req.content_type = 'text/html'
</I>&gt;<i>     for i in result:
</I>&gt;<i>         req.write(i.Company + '&lt;br&gt;')
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Explanation:
</I>&gt;<i> I have a main directory and two subdirectories: templates and models.
</I>&gt;<i> Inside the models folder I have a module called &quot;models.py&quot;, where I
</I>&gt;<i> imported an ORM and defined the db connection and models (included
</I>&gt;<i> &quot;Customers&quot;).
</I>&gt;<i> 
</I>&gt;<i> Although it works perfectly as a standalone app, it doesn't work with
</I>&gt;<i> mod_python.
</I>&gt;<i> The error message I get is:
</I>&gt;<i> 
</I>&gt;<i>              NameError: name 'Clientes' is not defined
</I>&gt;<i> 
</I>&gt;<i> I guess it has to do with the way mod_python handles the import of
</I>&gt;<i> modules, or perhaps with the way I modify the sys.path... but I can't
</I>&gt;<i> figure out the solution.
</I>&gt;<i> 
</I>&gt;<i> Any hint would be highly appreciated...
</I>&gt;<i> Thanks!
</I>&gt;<i> Luis
</I></PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="022645.html">[mod_python] Why this code fails?
</A></li>
	<LI>Next message: <A HREF="022650.html">[mod_python] Newbie ?s regarding sessions
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22646">[ date ]</a>
              <a href="thread.html#22646">[ thread ]</a>
              <a href="subject.html#22646">[ subject ]</a>
              <a href="author.html#22646">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
