<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] meets_conditions does not seem to work
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20meets_conditions%20does%20not%20seem%20to%20work&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022659.html">
   <LINK REL="Next"  HREF="022664.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] meets_conditions does not seem to work</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20meets_conditions%20does%20not%20seem%20to%20work&In-Reply-To="
       TITLE="[mod_python] meets_conditions does not seem to work">grahamd at dscpl.com.au
       </A><BR>
    <I>Wed Nov 22 01:37:41 EST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="022659.html">[mod_python] meets_conditions does not seem to work
</A></li>
        <LI>Next message: <A HREF="022664.html">[mod_python] meets_conditions does not seem to work
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22660">[ date ]</a>
              <a href="thread.html#22660">[ thread ]</a>
              <a href="subject.html#22660">[ subject ]</a>
              <a href="author.html#22660">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>sliderw hotmail wrote ..
&gt;<i> &gt;Graham Dumpleton wrote ..
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; What headers is your client sending which denote the condition that
</I>&gt;<i> has
</I>&gt;<i> &gt; &gt; to be
</I>&gt;<i> &gt; &gt; satisfied. Ie., what headers are in req.headers_in such as:
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;   If-Match
</I>&gt;<i> &gt; &gt;   If-Unmodified-Since
</I>&gt;<i> &gt; &gt;   If-None-Match
</I>&gt;<i> &gt; &gt;   Range
</I>&gt;<i> &gt; &gt;   If-Modified-Since
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; If your client isn't sending any conditions, how can there be anything
</I>&gt;<i> &gt; &gt; to
</I>&gt;<i> &gt; &gt; check.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; Another issues is perhaps that 'Last-Modified' header isn't even 
</I>&gt;<i> &gt;consulted
</I>&gt;<i> &gt; &gt; anyway. Instead it looks at req.mtime attribute for when resource was
</I>&gt;<i> &gt;last
</I>&gt;<i> &gt; &gt; modified. Getting this set to a sensible value in mod_python, because
</I>&gt;<i> &gt;output
</I>&gt;<i> &gt; &gt; is
</I>&gt;<i> &gt; &gt; generated dynamically, isn't that simple. In the version of mod_python
</I>&gt;<i> &gt; &gt; you are
</I>&gt;<i> &gt; &gt; using it probably isn't even possible as there is no way to update
</I>&gt;<i> &gt;req.mtime.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; In mod_python 3.3, req.mtime is still read only, but 
</I>&gt;<i> &gt;req.set_last_modified()
</I>&gt;<i> &gt; &gt; is
</I>&gt;<i> &gt; &gt; provided which allows req.mtime to be set from the mtime in req.finfo
</I>&gt;<i> &gt;with
</I>&gt;<i> &gt; &gt; req.finfo being able to be updated by setting it to result of calling
</I>&gt;<i> &gt;the
</I>&gt;<i> &gt; &gt; apache.stat() method with a file name. Problem is that in mod_python
</I>&gt;<i> the
</I>&gt;<i> &gt; &gt; mtime
</I>&gt;<i> &gt; &gt; may need to reflect changes across multiple files which comprise the
</I>&gt;<i> &gt;source
</I>&gt;<i> &gt; &gt; code used to fulfil a request. Thus, in some respects, req.mtime should
</I>&gt;<i> &gt; &gt; possibly
</I>&gt;<i> &gt; &gt; be directly modifiable to be of most use, but it isn't right now.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; Anyway, having said all that, what are you expecting to happen and
</I>&gt;<i> how
</I>&gt;<i> &gt; &gt; do you expect to be able to use req.meets_condition()?
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;Whoops. Forgot that in mod_python 3.3 there is req.update_mtime(), so
</I>&gt;<i> &gt;req.mtime can be updated, you just don't do it directly but through a
</I>&gt;<i> &gt;function.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;Graham
</I>&gt;<i> 
</I>&gt;<i> 304 Not Modified should be expected because my client sends:
</I>&gt;<i> 
</I>&gt;<i> If-Modified-Since: Wed, 22 Nov 2006 01:00:00 GMT
</I>&gt;<i> If-None-Match: &quot;12345&quot;
</I>&gt;<i> 
</I>&gt;<i> I also suspect that mtime is the issue. The value of req.mtime is 0.0 just
</I>&gt;<i> before the meets_conditions call. Although I'm not familiar with the 
</I>&gt;<i> internals of mod_python and Apache, I looked at Apache's 
</I>&gt;<i> ap_meets_conditions, which uses current time as mtime if req.mtime is 0.
</I>&gt;<i> 
</I>&gt;<i> So meets_conditions is unusable until 3.3? Hmm....
</I>
That is probably a reasonable assumption if the condition is based on a mtime
that you want to manipulate.

&gt;<i> BTW, when will 3.3 come out?
</I>
Hopefully a Christmas present for all. You can always check out current code
from subversion, or see:

  <A HREF="http://mail-archives.apache.org/mod_mbox/httpd-python-dev/200611.mbox/%3c45533499.5090600@jgassociates.ca%3e">http://mail-archives.apache.org/mod_mbox/httpd-python-dev/200611.mbox/%3c45533499.5090600@jgassociates.ca%3e</A>

Any delays at this point are my fault as lagging on some documentation and
also not happy with a couple of issues I thought had been resolved. Been hard to
find good blocks of time to work on it as having to take over extra projects in
my real job because of people leaving.

Graham
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="022659.html">[mod_python] meets_conditions does not seem to work
</A></li>
	<LI>Next message: <A HREF="022664.html">[mod_python] meets_conditions does not seem to work
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22660">[ date ]</a>
              <a href="thread.html#22660">[ thread ]</a>
              <a href="subject.html#22660">[ subject ]</a>
              <a href="author.html#22660">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
