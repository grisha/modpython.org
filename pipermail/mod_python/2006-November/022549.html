<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Trouble with multiple class objects in publishermodel
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Trouble%20with%20multiple%20class%20objects%20in%20publishermodel&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022548.html">
   <LINK REL="Next"  HREF="022551.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Trouble with multiple class objects in publishermodel</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Trouble%20with%20multiple%20class%20objects%20in%20publishermodel&In-Reply-To="
       TITLE="[mod_python] Trouble with multiple class objects in publishermodel">grahamd at dscpl.com.au
       </A><BR>
    <I>Wed Nov  8 17:49:55 EST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="022548.html">[mod_python] Re: mod_python, the ITK MPM and sessions
</A></li>
        <LI>Next message: <A HREF="022551.html">[mod_python] Trouble with multiple class objects in publishermodel
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22549">[ date ]</a>
              <a href="thread.html#22549">[ thread ]</a>
              <a href="subject.html#22549">[ subject ]</a>
              <a href="author.html#22549">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Martin Stoufer wrote ..
&gt;<i> 
</I>&gt;<i>    This is a bit to digest, thanks for being so thorough. In comment to your
</I>&gt;<i>    mentioned article, I could not rectify if the named args (host, sortBy,
</I>&gt;<i>    etc..) would be always required when passed to the __call__ function. Or is
</I>&gt;<i>    that just when you are dealing with a standalone method in your example?
</I>
The short of it, is that using publisher instead of:

&gt;<i> class Dom:
</I>&gt;<i>     def __call__(self, req):
</I>&gt;<i>         from DomProdLibOutput import Html
</I>&gt;<i>         self.form = req.form
</I>&gt;<i>         self.output = Html('modPython')
</I>&gt;<i>         self.host = self.form['host'].value
</I>&gt;<i>         self.sortBy = self.form['sortby'].value
</I>&gt;<i>         self.mode = self.form['mode'].value
</I>&gt;<i>         if self.form.has_key('term'):
</I>&gt;<i>            self.term=self.form['term'].value
</I>&gt;<i>         else:
</I>&gt;<i>            self.term = &quot;&quot;
</I>
you could have written:

  class Dom:
      def __call__(self, req, host, sortBy, mode, term=''):
          from DomProdLibOutput import Html
          self.host = host
          self.sortBy = sortyBy
          self.mode = mode
          self.term = term

If a form field is optional, give it a default value in the prototype. This might
be space if appropriate, or even None if you truly want to know if the field
was supplied.

Graham

&gt;<i> For starters, you are mixing up mod_python basic handlers and
</I>&gt;<i> mod_python.publisher published functions. They are not the same
</I>&gt;<i> thing. See my recent comment on mailing list about this:
</I>&gt;<i> 
</I>&gt;<i>   [1]<A HREF="http://www.modpython.org/pipermail/mod_python/2006-November/022529.html">http://www.modpython.org/pipermail/mod_python/2006-November/022529.html</A>
</I>&gt;<i> 
</I>&gt;<i> BTW, which version of mod_python are you using?
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i>    Apache 2.2.3/mod_python 3.2.10/Python 2.5
</I>&gt;<i> 
</I>&gt;<i> A few more things pointed out below.
</I>&gt;<i> 
</I>&gt;<i> Martin Stoufer wrote ..
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> I am moving a set of python classes out of the Apache CGI model and into
</I>&gt;<i> mod_python. There is both inheritance and composition going on among
</I>&gt;<i> these classes. A few factory classes as well. It seems that when it
</I>&gt;<i> comes time to pull the generated content from the hierarchy of classes,
</I>&gt;<i> the string object returned to the initial class end up 'None'.
</I>&gt;<i> 
</I>&gt;<i> I have stripped down my work as an example. If there is some larger
</I>&gt;<i> example of how this class structure should work, I would love to see it.
</I>&gt;<i> 
</I>&gt;<i> from mod_python import apache
</I>&gt;<i> 
</I>&gt;<i> class Dom:
</I>&gt;<i>     def __call__(self, req):
</I>&gt;<i>         from DomProdLibOutput import Html
</I>&gt;<i>         self.form = req.form
</I>&gt;<i>         self.output = Html('modPython')
</I>&gt;<i>         self.host = self.form['host'].value
</I>&gt;<i>         self.sortBy = self.form['sortby'].value
</I>&gt;<i>         self.mode = self.form['mode'].value
</I>&gt;<i>         if self.form.has_key('term'):
</I>&gt;<i>            self.term=self.form['term'].value
</I>&gt;<i>         else:
</I>&gt;<i>            self.term = &quot;&quot;
</I>&gt;<i>         req.content_type = &quot;text/html&quot;
</I>&gt;<i>         req.send_http_header()
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Only need to call req.send_http_header() if using mod_python 2.7.X.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i>         result = self.generate()
</I>&gt;<i>         req.write(result)
</I>&gt;<i>         return apache.OK
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> You shouldn't be returning an Apache status code like this when using
</I>&gt;<i> publisher. Status codes are for mod_python basic handlers, not publisher.
</I>&gt;<i> Publisher needs to return the content, or if you have used req.write()
</I>&gt;<i> it should return None (if mod_python 3.2 or later), or a string consisting
</I>&gt;<i> of a singe space (prior to mod_python 3.2, to get around bug).
</I>&gt;<i> 
</I>&gt;<i> Also, because publisher will automatically detect and set content type
</I>&gt;<i> to 'text/html' when appropriate if returning the content, you don't need
</I>&gt;<i> to
</I>&gt;<i> set it yourself. Thus you can just have:
</I>&gt;<i> 
</I>&gt;<i>         return self.generate()
</I>&gt;<i> 
</I>&gt;<i> and not worry about setting content, flush headers or explicitly
</I>&gt;<i> writing back content.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i>     def generate(self):
</I>&gt;<i>         result = self.output.generate()
</I>&gt;<i>         return result
</I>&gt;<i> 
</I>&gt;<i> dom = Dom()
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Although you have specified a __call__() method so URL can just be '/.../dom',
</I>&gt;<i> you are also exposing all the member data and member functions of your
</I>&gt;<i> object as well and they can be access directly, which is really bad for
</I>&gt;<i> this
</I>&gt;<i> example. To hide member functions and data you don't want automatically
</I>&gt;<i> accessible via a URL request, precede them with an underscore. Ie., use
</I>&gt;<i> _generate() not generate() and store data like self._form and not self.form.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> In the DomProdLibOutput file in the same dir:
</I>&gt;<i> 
</I>&gt;<i> class Html:
</I>&gt;<i>     def __init__(self, destination='screen'):
</I>&gt;<i>         self.output = HtmlOutputFactory(destination).getOutput()
</I>&gt;<i>         return
</I>&gt;<i> 
</I>&gt;<i>     def generate(self):
</I>&gt;<i>         #result = &quot;Foo in Html&quot;
</I>&gt;<i>         result = self.output.generate()
</I>&gt;<i>         return result
</I>&gt;<i> 
</I>&gt;<i> class HtmlModPython:
</I>&gt;<i>     def __init__(self):
</I>&gt;<i>         self.content = &quot;&quot;&quot;Empty content in HtmlModPython&quot;&quot;&quot;
</I>&gt;<i>         return
</I>&gt;<i> 
</I>&gt;<i>     def update(self, content):
</I>&gt;<i>         self.content += content
</I>&gt;<i>         return
</I>&gt;<i> 
</I>&gt;<i>     def generate(self):
</I>&gt;<i>         return &quot;Foo in HtmlModPython&quot;
</I>&gt;<i>         #return self.content
</I>&gt;<i> 
</I>&gt;<i> class HtmlOutputFactory:
</I>&gt;<i>     def __init__(self, destination):
</I>&gt;<i>         self.dest = destination
</I>&gt;<i>         return
</I>&gt;<i> 
</I>&gt;<i>     def getOutput(self):
</I>&gt;<i>         if self.dest == 'screen': return HtmlScreen()
</I>&gt;<i>         elif self.dest == 'modPython': return HtmlModPython()
</I>&gt;<i>         elif self.dest == 'file': return HtmlFile()
</I>&gt;<i>         else:
</I>&gt;<i>             raise InvalidHtmlOutputDest, \
</I>&gt;<i>         &quot;%s is not a supported output&quot; % self.dest
</I>&gt;<i>         return
</I>&gt;<i> 
</I>&gt;<i> As an interesting side note, if I have the generate() in Html return
</I>&gt;<i> just the string, things work fine. Its when I try and resolve the string
</I>&gt;<i> stored by the HtmlModPython class instance that the resulting string
</I>&gt;<i> comes back 'None' irregardless of what the deepest generate() returns.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Lost me there. I would very much suggest to track through what is
</I>&gt;<i> happening that you use req.log_error() to log progress messages to
</I>&gt;<i> the Apache error log file.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Do all these classes have to define __call__ as well?
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> The __call__() method is only required for the Dom instance if you want
</I>&gt;<i> URL to use the instance variable name only.
</I>&gt;<i> 
</I>&gt;<i> Graham
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> --
</I>&gt;<i> * Martin C. Stoufer              *
</I>&gt;<i> * DIDC/DSD/ITG                   *
</I>&gt;<i> * Lawrence Berkeley National Lab *
</I>&gt;<i> * MS 50B-2215 510-486-8662       *
</I></PRE>












<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="022548.html">[mod_python] Re: mod_python, the ITK MPM and sessions
</A></li>
	<LI>Next message: <A HREF="022551.html">[mod_python] Trouble with multiple class objects in publishermodel
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22549">[ date ]</a>
              <a href="thread.html#22549">[ thread ]</a>
              <a href="subject.html#22549">[ subject ]</a>
              <a href="author.html#22549">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
