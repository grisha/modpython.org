<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] best practices; was &quot;is mod_python borked?&quot;
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20best%20practices%3B%20was%20%22is%20mod_python%20borked%3F%22&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022516.html">
   <LINK REL="Next"  HREF="022471.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] best practices; was &quot;is mod_python borked?&quot;</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Sells, Fred</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20best%20practices%3B%20was%20%22is%20mod_python%20borked%3F%22&In-Reply-To="
       TITLE="[mod_python] best practices; was &quot;is mod_python borked?&quot;">fred at adventistcare.org
       </A><BR>
    <I>Fri Nov  3 09:31:47 EST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="022516.html">[mod_python] Interesting PSP error...
</A></li>
        <LI>Next message: <A HREF="022471.html">[mod_python] best practices; was &quot;is mod_python borked?&quot;
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22461">[ date ]</a>
              <a href="thread.html#22461">[ thread ]</a>
              <a href="subject.html#22461">[ subject ]</a>
              <a href="author.html#22461">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>The following is extracted from Graham's reply with questions of my own
added.  

Note that I use Apache 2.x and python 2.3 and mod_python 3.1.3 on linux.


&gt;<i>As long as you don't run up against the trailing slash and base url issues.
</I>;-)
I gues I haven't hit them, not sure what they are, are they documented
somewhere. Isn't there an Apache module that fixes this?



&gt;<i>Personally I don't like publisher as it is, but to fix it properly would
</I>most
&gt;<i>likely break a lot of existing user code.
</I>I have found that while the publisher code looks cool, it is an empty shell
around my backend, where each function just calls a method in my application
&quot;Controller&quot;.  I have to modify that &quot;shell&quot; and also my backend everytime I
add a feature/method to the backend, which is not &quot;DRY&quot;.  Graham, do you
have a &quot;best practices&quot; snippet of writing your own handler to function
similar to the url mapping of the publisher.  I see no reason to do more
than pass **kwargs, since that means there is no impact on the backend api
(but of course on the logic) if I add a parameter in the post.


&gt;<i>if you're using Session objects, Best practice is to use code like:
</I>
  if not hasattr(req, 'session'):
    req.session = Session.Session(req)

&gt;<i>Things can still get a bit tricky if you are using req.internal_redirect()
</I>&gt;<i>though. What you can do there depends on which version of mod_python you
</I>are
&gt;<i>using.
</I>This is really cool, I was afraid to mess with the request object, but from
this and other posts, it looks like that's a common practice. Is there a
place that documents the differences between 3.1 and 3.2 on the
internal_redirect()


&gt;<i>Anyway, important thing is that it sounds like you have at least not tried
</I>to
&gt;<i>do it in the PythonHandler phase like most do, which to my mind is the
</I>wrong
&gt;<i>way of going about it. It should be done in an earlier phase so that it can
</I>&gt;<i>cover non mod_python stuff as well, like you indicate your version does.
</I>

OOPS! :(   I did exactly that.  I had read the info in the manual about not
doing that, 
but then my brain got full.  my apache.conf file follows, can you suggest
changes.

-----------------------apache.conf------------------------------------------
---------------------------
PythonPath &quot;['.', '/home/acctools/accpython'] + sys.path&quot;
ScriptAlias /logic/ &quot;/var/www/modpy/logic/&quot;

&lt;Directory &quot;/var/www/modpy/logic&quot;&gt;  #publishers reside here, backend logic
on pythonpath per above
        SetHandler python-program
        PythonHandler  modpy.security mod_python.publisher
        PythonDebug On
&lt;/Directory&gt;

&lt;Directory &quot;/var/www/html/rds&quot;&gt;
        AddHandler mod_python .html
        PythonHandler  modpy.passthru #passthru calls the handler in
security, then writes the url
        PythonDebug On
&lt;/Directory&gt;
-------------------------------------------------------------



-----------------------security.py---------------------------
#note: I've edited this to reflect the earlier advice on sessions, but have
not tested yet
# in cleaning this up for public viewing, it may not compile.


def handler(req):
    if not hasattr(req, 'session'):
	  req.session = Session.Session(req)    
    uname = req.session.get(UNAME, None)
    if uname==None: 
        cookie = get_cookie(req, ACC_COOKIE)  #my simple function, std
mod_python cookie stuff
        if cookie == None:
            return util.redirect(req, MY_LOGIN_URL)
        else:
            uname = get_uname_from_corporate_server(cookie)
            if uname==None:        
                return util.redirect(req, MY_LOGIN_URL)
            elif uname[:5]==ERROR: 
                return apache.HTTP_FORBIDDEN
            else:
                req.session[UNAME] = uname
    return apache.OK
----------------------------------------------------------------------------
----

---------------------------------------------------------------------------
The information contained in this message may be privileged and / or
confidential and protected from disclosure. If the reader of this message is
not the intended recipient, you are hereby notified that any dissemination,
distribution or copying of this communication is strictly prohibited. If you
have received this communication in error, please notify the sender
immediately by replying to this message and deleting the material from any
computer.
---------------------------------------------------------------------------

</PRE>


















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="022516.html">[mod_python] Interesting PSP error...
</A></li>
	<LI>Next message: <A HREF="022471.html">[mod_python] best practices; was &quot;is mod_python borked?&quot;
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22461">[ date ]</a>
              <a href="thread.html#22461">[ thread ]</a>
              <a href="subject.html#22461">[ subject ]</a>
              <a href="author.html#22461">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
