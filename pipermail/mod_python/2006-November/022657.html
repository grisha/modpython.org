<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] meets_conditions does not seem to work
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20meets_conditions%20does%20not%20seem%20to%20work&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022656.html">
   <LINK REL="Next"  HREF="022658.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] meets_conditions does not seem to work</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20meets_conditions%20does%20not%20seem%20to%20work&In-Reply-To="
       TITLE="[mod_python] meets_conditions does not seem to work">grahamd at dscpl.com.au
       </A><BR>
    <I>Tue Nov 21 22:27:11 EST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="022656.html">[mod_python] meets_conditions does not seem to work
</A></li>
        <LI>Next message: <A HREF="022658.html">[mod_python] meets_conditions does not seem to work
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22657">[ date ]</a>
              <a href="thread.html#22657">[ thread ]</a>
              <a href="subject.html#22657">[ subject ]</a>
              <a href="author.html#22657">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>sliderw hotmail wrote ..
&gt;<i> I followed the documentation of meets_conditions and wrote the following
</I>&gt;<i> handler, but it doesn't work. 200 OK is always returned, never 304 Not
</I>&gt;<i> Modified.
</I>&gt;<i> 
</I>&gt;<i> def handler(req):
</I>&gt;<i>     req.headers_out['ETag'] = '&quot;12345&quot;'
</I>&gt;<i>     req.headers_out['Last-Modified'] = 'Wed, 22 Nov 2006 01:00:00 GMT'
</I>&gt;<i>     req.headers_out['Expires'] = 'Fri, 13 Feb 2009 01:00:00 GMT'
</I>&gt;<i> 
</I>&gt;<i>     status = req.meets_conditions()
</I>&gt;<i>     if status != apache.OK:
</I>&gt;<i>         return status
</I>&gt;<i> 
</I>&gt;<i>     req.set_content_length(5)
</I>&gt;<i>     req.write('hello')
</I>&gt;<i> 
</I>&gt;<i>     return apache.OK
</I>&gt;<i> 
</I>&gt;<i> Versions used: Apache 2.2.2, mod_python 3.2.8
</I>&gt;<i> 
</I>&gt;<i> Any idea?
</I>
What headers is your client sending which denote the condition that has to be
satisfied. Ie., what headers are in req.headers_in such as:

  If-Match
  If-Unmodified-Since
  If-None-Match
  Range
  If-Modified-Since

If your client isn't sending any conditions, how can there be anything to
check.

Another issues is perhaps that 'Last-Modified' header isn't even consulted
anyway. Instead it looks at req.mtime attribute for when resource was last
modified. Getting this set to a sensible value in mod_python, because output is
generated dynamically, isn't that simple. In the version of mod_python you are
using it probably isn't even possible as there is no way to update req.mtime.

In mod_python 3.3, req.mtime is still read only, but req.set_last_modified() is
provided which allows req.mtime to be set from the mtime in req.finfo with
req.finfo being able to be updated by setting it to result of calling the
apache.stat() method with a file name. Problem is that in mod_python the mtime
may need to reflect changes across multiple files which comprise the source
code used to fulfil a request. Thus, in some respects, req.mtime should possibly
be directly modifiable to be of most use, but it isn't right now.

Anyway, having said all that, what are you expecting to happen and how
do you expect to be able to use req.meets_condition()?

Graham
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="022656.html">[mod_python] meets_conditions does not seem to work
</A></li>
	<LI>Next message: <A HREF="022658.html">[mod_python] meets_conditions does not seem to work
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22657">[ date ]</a>
              <a href="thread.html#22657">[ thread ]</a>
              <a href="subject.html#22657">[ subject ]</a>
              <a href="author.html#22657">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="DISABLEhttp://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
