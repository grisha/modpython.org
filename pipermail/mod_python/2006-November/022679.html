<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] invalid pointer, child process dies,
	broken connections
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20invalid%20pointer%2C%20child%20process%20dies%2C%0A%09broken%20connections&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022681.html">
   <LINK REL="Next"  HREF="022682.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] invalid pointer, child process dies,
	broken connections</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20invalid%20pointer%2C%20child%20process%20dies%2C%0A%09broken%20connections&In-Reply-To="
       TITLE="[mod_python] invalid pointer, child process dies,
	broken connections">grahamd at dscpl.com.au
       </A><BR>
    <I>Thu Nov 23 16:08:57 EST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="022681.html">[mod_python] Changing server signature
</A></li>
        <LI>Next message: <A HREF="022682.html">[mod_python] invalid pointer, child process dies,
	broken connections
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22679">[ date ]</a>
              <a href="thread.html#22679">[ thread ]</a>
              <a href="subject.html#22679">[ subject ]</a>
              <a href="author.html#22679">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Only suggestions at this point are:

1. Use:

  PythonInterpreter main_interpreter

directive for the mod_python application in case some third party Python
module is doing strange stuff with threads but wasn't written to be able
to work properly where there are multiple Python interpreter instances.
By using that named interpreter it will force application to run within the
context of the very first interpreter created. This can help where a module
uses only the simplified GIL thread locking API.

Note that this only applies for mod_python 3.2.10 and later.

2. Read through:

  <A HREF="http://www.dscpl.com.au/wiki/ModPython/Articles/ExpatCausingApacheCrash">http://www.dscpl.com.au/wiki/ModPython/Articles/ExpatCausingApacheCrash</A>

and run some of the checks talked about there to make sure this isn't being
caused by some expat library mismatch.

3. Run Apache in single process mode and attach a debugger process to the
process serving the requests (you might see 2 process, you will have to work
out which is the correct one). Then when it crashes you might be able to get
a stack trace back which might help to identify in which component it is
crashing.

  /usr/local/apache-2.0/bin/httpd -X -DONE_PROCESS

In a separate window:

graham-dumpletons-powerbook-g4-15:~ grahamd$ ps ax | grep httpd
  267  p1  S+     0:00.10 /usr/local/apache-2.2/bin/httpd -X -DONE_PROCESS
  268  p1  S+     0:00.00 /usr/local/apache-2.2/bin/httpd -X -DONE_PROCESS
  270  p2  R+     0:00.00 grep httpd

Run debugger. Usually on lowest number pid.

graham-dumpletons-powerbook-g4-15:~ grahamd$ gdb /usr/local/apache-2.2/bin/httpd -p 267
GNU gdb 6.3.50-20050815 (Apple version gdb-477) (Sun Apr 30 20:06:22 GMT 2006)
Copyright 2004 Free Software Foundation, Inc.
GDB is free software, covered by the GNU General Public License, and you are
welcome to change it and/or distribute copies of it under certain conditions.
Type &quot;show copying&quot; to see the conditions.
There is absolutely no warranty for GDB.  Type &quot;show warranty&quot; for details.
This GDB was configured as &quot;powerpc-apple-darwin&quot;...Reading symbols for shared libraries ....... done

/Users/grahamd/267: No such file or directory.
Attaching to program: `/usr/local/apache-2.2/bin/httpd', process 267.
Reading symbols for shared libraries .+++...................... done
0x900c7060 in sigwait ()
(gdb) 

Should see sigwait() from memory.

Type 'cont' command to gdb and then start sending requests until it crashes.
Then use 'where' to get a stack trace.

4. It would also be a good idea to simply start paring back the code of your
application bit by bit until you can come up with the most minimal bit of code
which causes the crash. In doing this, don't treat modules as black boxes, you
need to delve done into them and look at what they do, going deeper and deeper
until you get to the bottom.

5. Try the dev snapshot of mod_python 3.3. There were various crashes fixed
in that version, but these were generally odd things which probably only I
would ever think to try.

  <A HREF="http://mail-archives.apache.org/mod_mbox/httpd-python-dev/200611.mbox/%3c45533499.5090600@jgassociates.ca%3e">http://mail-archives.apache.org/mod_mbox/httpd-python-dev/200611.mbox/%3c45533499.5090600@jgassociates.ca%3e</A>

6. Post just the part of your Apache configuration which relates to how you
trigger mod_python and in what context. From that I might see if you are
managing to hit any of the issues referred to in 5.

Graham

Richard Lewis wrote ..
&gt;<i> Hi there,
</I>&gt;<i> 
</I>&gt;<i> Debian unstable; apache: 2.2.3; modpython: 3.2.10; python: 2.4.4; lxml
</I>&gt;<i> 1.1.1: 
</I>&gt;<i> libxml: 2.6.16; libxslt: 1.1.8.
</I>&gt;<i> 
</I>&gt;<i> I posted on 2nd Nov about some invalid pointer errors in my Apache error
</I>&gt;<i> log. 
</I>&gt;<i> At the time I thought they were coming from MySQL and received some 
</I>&gt;<i> interesting replies regarding the incompatibility of the mysql client 
</I>&gt;<i> libraries compiled into various apache modules.
</I>&gt;<i> 
</I>&gt;<i> However, since then I've decided to cut MySQL out of my web application
</I>&gt;<i> and, 
</I>&gt;<i> instead of dynamically converting database records into XML, use 
</I>&gt;<i> filesystem-cached XML files which are generated periodically from the 
</I>&gt;<i> database by a separate process.
</I>&gt;<i> 
</I>&gt;<i> While there are a couple of other advantages to this approach, it hasn't
</I>&gt;<i> solved my initial problem! I still have numerous errors like this in my
</I>&gt;<i> Apache error log:
</I>&gt;<i> 
</I>&gt;<i> [Mon Nov 20 10:51:58 2006] [notice] child pid 7087 exit signal Aborted
</I>&gt;<i> (6)
</I>&gt;<i> *** glibc detected *** free(): invalid pointer: 0x0835ab26 ***
</I>&gt;<i> *** glibc detected *** free(): invalid pointer: 0x0835ab26 ***
</I>&gt;<i> *** glibc detected *** free(): invalid pointer: 0x0835ab26 ***
</I>&gt;<i> *** glibc detected *** free(): invalid pointer: 0x0835ab26 ***
</I>&gt;<i> [Mon Nov 20 10:54:28 2006] [notice] child pid 7088 exit signal Aborted
</I>&gt;<i> (6)
</I>&gt;<i> [Mon Nov 20 10:54:28 2006] [notice] child pid 7089 exit signal Aborted
</I>&gt;<i> (6)
</I>&gt;<i> [Mon Nov 20 10:54:28 2006] [notice] child pid 7098 exit signal Aborted
</I>&gt;<i> (6)
</I>&gt;<i> 
</I>&gt;<i> It seems to handle several requests and then you get an error message from
</I>&gt;<i> the 
</I>&gt;<i> client (browser) saying that &quot;the connection is broken&quot;. You can then retry
</I>&gt;<i> the request and it works after one or two attempts.
</I>&gt;<i> 
</I>&gt;<i> I /think/ there is no direct correlation between the invalid pointer errors
</I>&gt;<i> messages and the dropped connections; the times of the messages seem to
</I>&gt;<i> be 
</I>&gt;<i> pretty evenly distributed and don't all result in a broken connection.
</I>&gt;<i> 
</I>&gt;<i> Also, the memory addresses of the invalid pointers are often (but not always)
</I>&gt;<i> the same. While the child process ids are always different. What is the
</I>&gt;<i> child 
</I>&gt;<i> process? Is it python?
</I>&gt;<i> 
</I>&gt;<i> I've checked to make sure that I'm always returning the content length
</I>&gt;<i> and 
</I>&gt;<i> Apache status code; I'm pretty sure I am! My application is using a frameset
</I>&gt;<i> where the frame document and its four frames are all generated using 
</I>&gt;<i> mod_python. Is there anything special I should do to help mod_python with
</I>&gt;<i> this? (Like returning special Apache status codes?)
</I>&gt;<i> 
</I>&gt;<i> Apart from getting these errors, my code is pretty much ready to go live.
</I>&gt;<i> So 
</I>&gt;<i> it would be really great if anyone could help me sort out this problem!
</I>&gt;<i> 
</I>&gt;<i> Cheers,
</I>&gt;<i> Richard
</I>&gt;<i> -- 
</I>&gt;<i> -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
</I>&gt;<i> Richard Lewis
</I>&gt;<i> Sonic Arts Research Archive
</I>&gt;<i> <A HREF="http://www.sara.uea.ac.uk/">http://www.sara.uea.ac.uk/</A>
</I>&gt;<i> JID: <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">ironchicken at jabber.earth.li</A>
</I>&gt;<i> -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mod_python mailing list
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I></PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="022681.html">[mod_python] Changing server signature
</A></li>
	<LI>Next message: <A HREF="022682.html">[mod_python] invalid pointer, child process dies,
	broken connections
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22679">[ date ]</a>
              <a href="thread.html#22679">[ thread ]</a>
              <a href="subject.html#22679">[ subject ]</a>
              <a href="author.html#22679">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
