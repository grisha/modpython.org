<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Newbie Questions
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Newbie%20Questions&In-Reply-To=49298.83.103.96.60.1163408513.squirrel%40webmail.pharaondev.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022591.html">
   <LINK REL="Next"  HREF="022593.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Newbie Questions</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Newbie%20Questions&In-Reply-To=49298.83.103.96.60.1163408513.squirrel%40webmail.pharaondev.com"
       TITLE="[mod_python] Newbie Questions">grahamd at dscpl.com.au
       </A><BR>
    <I>Mon Nov 13 05:15:05 EST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="022591.html">[mod_python] Newbie Questions
</A></li>
        <LI>Next message: <A HREF="022593.html">[mod_python] Mod Python Programmers in Holland?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22592">[ date ]</a>
              <a href="thread.html#22592">[ thread ]</a>
              <a href="subject.html#22592">[ subject ]</a>
              <a href="author.html#22592">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On 13/11/2006, at 8:01 PM, <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">g.farina at pharaondev.com</A> wrote:

&gt;<i> Hi
</I>&gt;<i>
</I>&gt;<i> I just started to develop with modpython and I have some questions  
</I>&gt;<i> about
</I>&gt;<i> quite simple topics.
</I>
Not necessarily simple, as for some they open a can of worms. :-)

&gt;<i> First of all, correct me if I wrong, I read that modpython works as a
</I>&gt;<i> layer between Apache APIs and Python scripts: when apache needs an  
</I>&gt;<i> handler
</I>&gt;<i> for a particular operation, it asks modpython for this handler and
</I>&gt;<i> modpython returns it based on some configurations.
</I>&gt;<i> Is that right?
</I>
Not exactly. Apache doesn't strictly ask mod_python for a handler.
For certain Apache request handling phases, the Python*Handler
directives are used to register mod_python handlers. The registration
causes Apache to actually pass handling of the request through to
mod_python at that point and mod_python invokes the handler.
The handler can simply return a status value, or it could write actual
content back for the response via the request object.

In the case of the actual response handler phase, it is also necessary
to tell Apache that the mod_python handler should be used in that
case. This is traditionally done using the SetHandler/AddHandler
directives. See:

   <A HREF="https://www.dscpl.com.au/wiki/ModPython/Articles/">https://www.dscpl.com.au/wiki/ModPython/Articles/</A> 
SetHandlerVersusAddHandler

for more information.

&gt;<i> Based on this considerations, I have some questions:
</I>&gt;<i> 1 - There is a way to call some code only when modpython is called  
</I>&gt;<i> for the
</I>&gt;<i> first time ?
</I>
The PythonImport directive allows one to specify modules that should
be imported at the time that the Apache child process is first created
and prior to any actual request being processed by that process.

&gt;<i> I have to load a huge configuration file, and I'd like to do
</I>&gt;<i> it only once and share the loaded object with all the handlers.
</I>
It isn't that simple. If you do such a thing only at process start  
and as a
direct side effect of the import and the import fails but you always  
expect
it to work, the only way to recover is by restarting Apache.

In general it is still better to wait until the first request arrives  
and perform
the import at that point, but not as a side effect of the import, but by
calling a function which performs the load of any configuration data.
If a failure occurs, you can flag the loading of the configuration as  
having
failed in some way and thus retry it on subsequent requests in case the
failure was caused by a transient problem such as a database issue etc.

When mod_python 3.3 is available you will be able to mix the two
approaches by using a new ability in 3.3 to have a function optionally
called after PythonImport is used to import the module. This avoids  
issues
with failure during the actual import and more easily allows one to
recover from a failure.

You still have to be a bit careful where automatic reloading of modules
is enabled. This is because in current versions of mod_python data
can be overwritten and lost or simply lost on reloads. In mod_python 3.3
there is a proper way of maintaining data across reloads. This would
allow one to possibly avoid reloading the configuration if code files
giving access to it are changed.

&gt;<i> 2 - I have to implement a simple MVC framework that uses a mechaninc
</I>&gt;<i> similar to the Publisher handler. But I need to interact with the  
</I>&gt;<i> object
</I>&gt;<i> that will be published, capturing the data returned by some  
</I>&gt;<i> functions and
</I>&gt;<i> sharing singleton among them.
</I>
The simplest thing to do is to pass the mod_python request object  
between
functions. You can store references to other data in the request object.
If the object you put in the request object is a transient object it  
will be
automatically reclaimed when the request processing is finished.

&gt;<i> Previously I loaded the files using exec but
</I>&gt;<i> now I can't do that due to this reasons. Using import (or the imp  
</I>&gt;<i> module)
</I>
In mod_python, if you need to load modules from specific locations,
you should use apache.import_module(). See:

   <A HREF="https://www.dscpl.com.au/wiki/ModPython/Articles/">https://www.dscpl.com.au/wiki/ModPython/Articles/</A> 
BasicsOfModuleImporting

Module importing does have some problems with current versions of
mod_python though. See:

   <A HREF="https://www.dscpl.com.au/wiki/ModPython/Articles/">https://www.dscpl.com.au/wiki/ModPython/Articles/</A> 
ModuleImportingIsBroken

Module importing is fixed up in mod_python 3.3.

&gt;<i> is not the right way because I'd like the memory used by the  
</I>&gt;<i> controllers
</I>&gt;<i> to be freed when the execution stops. There is a way to do that ?
</I>
It depends on to what level you expect to be able to free memory. Python
will obviously free up some stuff for you automatically, but if you  
expect
to be able to unload a module then no. You will need to be more specific
about your expectations. See my above comment about using the request
object as the means to provide access to stuff that any code used to
service a request needs.

&gt;<i> 3 - Modpython starts a subinterpreter for every call to the handler ?
</I>
No, mod_python does not start a sub interpreter for every call. Once an
interpreter instance is created it is retained for the life of the  
Apache
child process. There can still be multiple interpreter instances in a
process. These might be assigned against different virtual hosts or  
parts
of the URL namespace. Situations in which distinct interpreters are
created are controlled by PythonInterpreter, PythonInterPer* directives.

For a bit more information on the process/interpreter model of Apache
and mod_python read:

   <A HREF="https://www.dscpl.com.au/wiki/ModPython/Articles/">https://www.dscpl.com.au/wiki/ModPython/Articles/</A> 
TheProcessInterpreterModel

Graham
</PRE>










<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="022591.html">[mod_python] Newbie Questions
</A></li>
	<LI>Next message: <A HREF="022593.html">[mod_python] Mod Python Programmers in Holland?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22592">[ date ]</a>
              <a href="thread.html#22592">[ thread ]</a>
              <a href="subject.html#22592">[ subject ]</a>
              <a href="author.html#22592">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
