<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Why this code fails?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Why%20this%20code%20fails%3F&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022650.html">
   <LINK REL="Next"  HREF="022653.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Why this code fails?</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Why%20this%20code%20fails%3F&In-Reply-To="
       TITLE="[mod_python] Why this code fails?">grahamd at dscpl.com.au
       </A><BR>
    <I>Mon Nov 20 17:21:05 EST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="022650.html">[mod_python] Newbie ?s regarding sessions
</A></li>
        <LI>Next message: <A HREF="022653.html">[mod_python] Newbie ?s regarding sessions
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22651">[ date ]</a>
              <a href="thread.html#22651">[ thread ]</a>
              <a href="subject.html#22651">[ subject ]</a>
              <a href="author.html#22651">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>=?iso-8859-1?Q?Luis_M._Gonz=E1lez?= wrote ..
&gt;<i> Thank you Graham!
</I>&gt;<i> I will follow your suggestions to se how it goes...
</I>&gt;<i> 
</I>&gt;<i> By the way, it's worth mentioning that, for the sake of simplicity, I also
</I>&gt;<i> tried placing my &quot;models.py&quot; module within the same directory of my 
</I>&gt;<i> &quot;index.py&quot; script, in order to use a simple import statement (without 
</I>&gt;<i> messing with sys.path and os) but the problem persists.
</I>&gt;<i> 
</I>&gt;<i> However, if I import my ORM into index.py and then I define my models there,
</I>&gt;<i> it works.
</I>&gt;<i> This is strange: why can I import the ORM script but not the models script?
</I>&gt;<i> Is this because of the problem with the module importer you talked about?
</I>
It may not find the 'models.py' file in the same directory as the 'index.py'
file for a number of reasons.

First is that PythonPath is specified for that context meaning that mod_python
isn't adding the handler root directory where index.py is into sys.path
automatically.

Second is that 'index.py' wasn't in the handler root directory but a subdirectory.

Third is that there is a 'models' module elsewhere and the order of sys.path
is such that it finds this other one instead of that in the same directory.

For the record, all three of these problems are fixed in mod_python 3.3
and will work as one would expect it to work for file based modules like
'models.py'.

Graham

&gt;<i> --- Original Message ----- 
</I>&gt;<i> From: &quot;Graham Dumpleton&quot; &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">grahamd at dscpl.com.au</A>&gt;
</I>&gt;<i> To: &quot;Luis M. Gonz&#225;lez&quot; &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">luismg at gmx.net</A>&gt;
</I>&gt;<i> Cc: &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">mod_python at modpython.org</A>&gt;
</I>&gt;<i> Sent: Monday, November 20, 2006 12:20 AM
</I>&gt;<i> Subject: Re: [mod_python] Why this code fails?
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> &gt; =?iso-8859-1?Q?Luis_M._Gonz=E1lez?= wrote ..
</I>&gt;<i> &gt;&gt; Hello all,
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; I have this script, which works fine when tested with the interpreter,
</I>&gt;<i> &gt;&gt; but fails when used with mod_python:
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; # index.py
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; import sys, os
</I>&gt;<i> &gt;&gt; sys.path.append(os.getcwd() + '/templates')
</I>&gt;<i> &gt;&gt; sys.path.append(os.getcwd() + '/models')
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; You shouldn't modify sys.path from inside a handler code file as it can
</I>&gt;<i> &gt; cause lots of problems. Also, os.getcwd() is going to usually return
</I>&gt;<i> '/'
</I>&gt;<i> &gt; and not the directory the file resides in. It is also not a good idea
</I>&gt;<i> to 
</I>&gt;<i> &gt; be
</I>&gt;<i> &gt; placing modules required by your handlers within the document tree
</I>&gt;<i> &gt; like this because if you do not protect them properly from access in
</I>&gt;<i> &gt; the Apache configuration, users may be able to trigger code or access
</I>&gt;<i> &gt; data within the modules directly.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; The better thing to do is to move those module directories somewhere
</I>&gt;<i> &gt; outside of the document tree and then use the PythonPath directive to
</I>&gt;<i> &gt; extend the value of sys.path with the directory you place the two module
</I>&gt;<i> &gt; directories in.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Also note there are various problems with the module importer in
</I>&gt;<i> &gt; current versions of mod_python. See:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;  <A HREF="http://www.dscpl.com.au/wiki/ModPython/Articles/ModuleImportingIsBroken">http://www.dscpl.com.au/wiki/ModPython/Articles/ModuleImportingIsBroken</A>
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; This could be resulting in you picking up a wrong version of a module
</I>&gt;<i> &gt; if the same module name is used in multiple places, or an old module
</I>&gt;<i> &gt; version cached in memory and not changes you may have made on disk
</I>&gt;<i> &gt; since it was loaded. You may as a result have to restart Apache if not
</I>&gt;<i> &gt; getting latest module changes. You may also need to use PythonInterpreter
</I>&gt;<i> &gt; to make sure distinct applications operate in their own interpreters
</I>&gt;<i> to
</I>&gt;<i> &gt; avoid problems with similar module names being used.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Graham
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;&gt; from models import *
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; result = Customers.select()
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; def index(req):
</I>&gt;<i> &gt;&gt;     req.content_type = 'text/html'
</I>&gt;<i> &gt;&gt;     for i in result:
</I>&gt;<i> &gt;&gt;         req.write(i.Company + '&lt;br&gt;')
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; Explanation:
</I>&gt;<i> &gt;&gt; I have a main directory and two subdirectories: templates and models.
</I>&gt;<i> &gt;&gt; Inside the models folder I have a module called &quot;models.py&quot;, where I
</I>&gt;<i> &gt;&gt; imported an ORM and defined the db connection and models (included
</I>&gt;<i> &gt;&gt; &quot;Customers&quot;).
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; Although it works perfectly as a standalone app, it doesn't work with
</I>&gt;<i> &gt;&gt; mod_python.
</I>&gt;<i> &gt;&gt; The error message I get is:
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;              NameError: name 'Clientes' is not defined
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; I guess it has to do with the way mod_python handles the import of
</I>&gt;<i> &gt;&gt; modules, or perhaps with the way I modify the sys.path... but I can't
</I>&gt;<i> &gt;&gt; figure out the solution.
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; Any hint would be highly appreciated...
</I>&gt;<i> &gt;&gt; Thanks!
</I>&gt;<i> &gt;&gt; Luis
</I>&gt;<i> &gt; 
</I></PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="022650.html">[mod_python] Newbie ?s regarding sessions
</A></li>
	<LI>Next message: <A HREF="022653.html">[mod_python] Newbie ?s regarding sessions
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22651">[ date ]</a>
              <a href="thread.html#22651">[ thread ]</a>
              <a href="subject.html#22651">[ subject ]</a>
              <a href="author.html#22651">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
