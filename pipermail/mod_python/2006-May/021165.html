<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Custom Login with redirection back to referer
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Custom%20Login%20with%20redirection%20back%20to%20referer&In-Reply-To=000e01c67b76%2418c419a0%246900a8c0%40MSASALESGES2">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021164.html">
   <LINK REL="Next"  HREF="021166.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Custom Login with redirection back to referer</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Deron Meranda</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Custom%20Login%20with%20redirection%20back%20to%20referer&In-Reply-To=000e01c67b76%2418c419a0%246900a8c0%40MSASALESGES2"
       TITLE="[mod_python] Custom Login with redirection back to referer">deron.meranda at gmail.com
       </A><BR>
    <I>Fri May 19 15:49:10 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="021164.html">[mod_python] Custom Login with redirection back to referer
</A></li>
        <LI>Next message: <A HREF="021166.html">[mod_python] Custom Login with redirection back to referer
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21165">[ date ]</a>
              <a href="thread.html#21165">[ thread ]</a>
              <a href="subject.html#21165">[ subject ]</a>
              <a href="author.html#21165">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 5/19/06, Geoff Skerrett &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">geoff at teammsa.com</A>&gt; wrote:
&gt;<i> I am hoping someone can get me back on track and point me in thr right
</I>&gt;<i> direction.
</I>&gt;<i>
</I>&gt;<i> I want to create a process where if the user requests a page they are not
</I>&gt;<i> authorized for then;
</I>&gt;<i> 1) a custom logon form is displayed
</I>&gt;<i> 2) the users submits and it is processed verifying against a database if the
</I>&gt;<i> user is valid
</I>&gt;<i> 3) as part of the processing a session is created
</I>&gt;<i> 4) the session stores the some data  (userid, name, lastip, etc)
</I>&gt;<i> 5) when complete the system redirects the user to the original page (ie the
</I>&gt;<i> referrer for the login)
</I>&gt;<i>
</I>&gt;<i> I have a test case working and using the util.redirect function.  Everything
</I>&gt;<i> works fine, but the referred page is processed, it gets a new session so the
</I>&gt;<i> variables I have stored during the login page process aren't available to
</I>&gt;<i> the refered page.
</I>&gt;<i>
</I>&gt;<i> What am I missing? What is the best strategy for storing the session
</I>&gt;<i> variables and dealing with this type of process ?
</I>
First of all, be cautious using redirection for that purpose.  Proxy
servers, caching, and the like may decide to just cache the
redirects too.  And then you'd have cross-user contamination.

A better approach that more closely follows the HTTP standard
semantics is to have your authentication handler cause an
HTTP 403 error when the user doesn't have permissions.
      m.abort(403)

Then Apache will display the standard 403 error handler page.
You should replace/modify that page to contain some text
that provides a link to the login page
     &lt;a href=&quot;/login&quot;&gt;Please login to view this page&lt;/a&gt;

Then your login page handler should capture the value of
the HTTP_REFERER (if any) and save it.  The referer in
this case will be the original URL which failed your access
control checks (not the 403 error page).  If you're putting
up an HTML login form, then stick the value of the
referer into a hidden &lt;input&gt; element, so you can preserve
it.  Note that you should handle the case where there is
no referer too.

After the user types in their login credentials and you
successfully process the login form and authenticate the user,
you can retrieve the value of the referer from the input field.
And if it exists do your redirect back to the original page.
Or you could display a &quot;welcome&quot; greeting page first, which
then contained a link to &quot;go back&quot; to the page you originally
tried to view.
-- 
Deron Meranda

</PRE>













<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="021164.html">[mod_python] Custom Login with redirection back to referer
</A></li>
	<LI>Next message: <A HREF="021166.html">[mod_python] Custom Login with redirection back to referer
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21165">[ date ]</a>
              <a href="thread.html#21165">[ thread ]</a>
              <a href="subject.html#21165">[ subject ]</a>
              <a href="author.html#21165">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="DISABLEhttp://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
