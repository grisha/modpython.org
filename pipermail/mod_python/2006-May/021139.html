<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Problem with html quoted/unquoted
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Problem%20with%20html%20quoted/unquoted&In-Reply-To=5c06fa770605170802j4cf0cfffg4bccb38c1bdb9cba%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021138.html">
   <LINK REL="Next"  HREF="021140.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Problem with html quoted/unquoted</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Wouter van Marle</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Problem%20with%20html%20quoted/unquoted&In-Reply-To=5c06fa770605170802j4cf0cfffg4bccb38c1bdb9cba%40mail.gmail.com"
       TITLE="[mod_python] Problem with html quoted/unquoted">wouter at squirrel-systems.com
       </A><BR>
    <I>Wed May 17 11:17:29 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="021138.html">[mod_python] Problem with html quoted/unquoted
</A></li>
        <LI>Next message: <A HREF="021140.html">[mod_python] Problem with html quoted/unquoted
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21139">[ date ]</a>
              <a href="thread.html#21139">[ thread ]</a>
              <a href="subject.html#21139">[ subject ]</a>
              <a href="author.html#21139">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Dear Deron,

Thank you for the comments. I understand your ideas; unfortunately it
does not solve my problem.

The info I get from another website, this origin gives me the info in
the ampersand form (that third party site is a Netscape server by the
way! Didn't know they are still in use, very remarkable). And I like
that.
The main reason to continue using that format is the &quot; (double-quotes)
and ' (single quotes). These characters are used in the data that I try
to store in the mysql base, and that fantastically messes up with the
queries....
imagine: s = &quot;this is 'a' string&quot;
then say query = &quot;&quot;&quot; SELECT * FROM base WHERE field = &quot;%s&quot;;&quot;&quot;&quot;% s

But what about when s can be 'this is &quot;a&quot; string'
or s = &quot;&quot;&quot;this is a 5&quot;, 'b' sized thing&quot;&quot;&quot;.

Now if I keep those &quot; and ' characters in ampersand quoted form, no
problem. And as a result I (have to - conversion issue; urllib.unquote()
is not selective) keep the rest of the strange characters (usually
umlauts and so) also in that form.

If there is no easier solution I'll have to just use urllib.unquote()
and code into utf-8 for storing, and then replace the &quot; characters again
with the quoted form. May be the best solution.

Wouter.


On Wed, 2006-05-17 at 11:02 -0400, Deron Meranda wrote:
&gt;<i> On 5/16/06, Wouter van Marle &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">wouter at squirrel-systems.com</A>&gt; wrote:
</I>&gt;<i> &gt; For html compatibility reasons, I store all the search data in the MySQL
</I>&gt;<i> &gt; database in html-quoted format. The term in question that I ran into is:
</I>&gt;<i> &gt; &quot;Jubil&#228;umsmodell&quot;, stored in the database as &quot;Jubil&amp;auml;umsmodell&quot;.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; The select in the html source, as presented to the browser, is fine (the
</I>&gt;<i> &gt; html line is abbreviated for here; it contains many more options):
</I>&gt;<i> &gt; &lt;select name=model&gt;
</I>&gt;<i> &gt;         &lt;option value=&quot;Jubil&amp;auml;umsmodell 40 Jahre&quot;&gt;Jubil&amp;auml;umsmodell 40
</I>&gt;<i> &gt; Jahre&lt;/option&gt;
</I>&gt;<i> &gt; &lt;/select&gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; It is rendered correctly of course by the browser.
</I>&gt;<i> &gt; Now when the user clicks go, and the POST is generated, the character is
</I>&gt;<i> &gt; sent back in what I guess is UTF-8 encoding
</I>&gt;<i> 
</I>&gt;<i> From my experience, browsers will POST in the same character set/
</I>&gt;<i> encoding as whatever the HTML page containing the &lt;form&gt; was
</I>&gt;<i> encoded in.  So if you output your HTML page in utf-8, then the POST
</I>&gt;<i> will also be UTF-8.
</I>&gt;<i> 
</I>&gt;<i> You can of course affect that somewhat if you explicitly output the
</I>&gt;<i> Accept-Encoding HTTP header, or the optional accept-charset
</I>&gt;<i> attribute of the &lt;form&gt; element.
</I>&gt;<i> 
</I>&gt;<i> Regardless though, you should use one of the above methods
</I>&gt;<i> rather than leaving it up to the browser.  My personal opinion
</I>&gt;<i> is to always use UTF-8 when communicating with browsers.
</I>&gt;<i> It is the best supported across all browsers, and will cause you
</I>&gt;<i> the least grief.
</I>&gt;<i> 
</I>&gt;<i> &gt; (I assume it's that, as that's my default encoding) (again only a snippet):
</I>&gt;<i> &gt; &amp;model=Jubil%C3%A4umsmodell+40+Jahre
</I>&gt;<i> 
</I>&gt;<i> Yes, [0xc3, 0xa4] is in fact the two-byte UTF-8 encoding of the
</I>&gt;<i> unicode character U+00E4 (the a-diaeresis).
</I>&gt;<i> 
</I>&gt;<i> &gt; So the end of the whole story, the actual question is now: how do I get
</I>&gt;<i> &gt; from this utf-8 encoding back to html quoted encoding, for searching in
</I>&gt;<i> &gt; the database?
</I>&gt;<i> 
</I>&gt;<i> What makes this more difficult is that you are using entity names rather
</I>&gt;<i> than character references.  For example, in HTML, all of these
</I>&gt;<i> &quot;escape&quot; strings can be used to reference the same character:
</I>&gt;<i> 
</I>&gt;<i>    &amp;auml;
</I>&gt;<i>    &amp;#228;
</I>&gt;<i>   &amp;#xe8;
</I>&gt;<i> 
</I>&gt;<i> The second decimal-numeric character reference is the most universal.
</I>&gt;<i> In fact it is what you must use if you ever want to use some other
</I>&gt;<i> XML-based languages rather than HTML.
</I>&gt;<i> 
</I>&gt;<i> Anyway, the first thing to do is to get the UTF-8 encoded string
</I>&gt;<i> turned back into a Python unicode string, such as
</I>&gt;<i> 
</I>&gt;<i>    s = s.decode('utf8')
</I>&gt;<i> 
</I>&gt;<i> Now that two-byte sequence has turned into a single unicode
</I>&gt;<i> character, \u00e8 (displayed as \xe8 when you print it).
</I>&gt;<i> 
</I>&gt;<i> Then you probably want to define a function which HTM-encodes
</I>&gt;<i> a Unicode string, turning all non-ASCII characters into references,
</I>&gt;<i> perhaps something like
</I>&gt;<i> 
</I>&gt;<i> def encodechar( c ):
</I>&gt;<i>     codepoint = ord(c)
</I>&gt;<i>     if codepoint &gt;= 128 or codepoint &lt; 32:
</I>&gt;<i>         return '&amp;#%d;' % codepoint
</I>&gt;<i>     else:
</I>&gt;<i>         return c
</I>&gt;<i> 
</I>&gt;<i> And HTML-encode your string like:
</I>&gt;<i> 
</I>&gt;<i>    encoded_s = ''.join( [encodechar(c) for c in s] )
</I>&gt;<i> 
</I>&gt;<i> If you are really tied to using entities rather than character references,
</I>&gt;<i> you may be able to do something like this instead:
</I>&gt;<i> 
</I>&gt;<i> import htmlentitydefs
</I>&gt;<i> 
</I>&gt;<i> def encodechar( c ):
</I>&gt;<i>     codepoint = ord(c)
</I>&gt;<i>     entityname = htmlentitydefs.codepoint2name.get( codepoint, None )
</I>&gt;<i>     if entityname:
</I>&gt;<i>         return '&amp;%s;' % entityname
</I>&gt;<i>     elif codepoint &gt;= 128 or codepoint &lt; 32:
</I>&gt;<i>         return '&amp;#%d;' % codepoint
</I>&gt;<i>     else:
</I>&gt;<i>         return c
</I>&gt;<i> 
</I>&gt;<i> Keep in mind though that not all browser versions understand
</I>&gt;<i> the complete list of HTML entity names.  That's why I would
</I>&gt;<i> strongly recommend against using entity names.
</I>&gt;<i> 
</I>&gt;<i> Also note that if you need apostrophes escaped too, you'll need to
</I>&gt;<i> put in another special case for that as the htmlentitydefs does
</I>&gt;<i> not have an entry for &quot;apos&quot; for some reason.
</I>&gt;<i> 
</I>&gt;<i> &gt; And no, I'm not going to put the info in the database in
</I>&gt;<i> &gt; utf-8, that must remain html quoted for many other locations where it
</I>&gt;<i> &gt; goes wrong otherwise.
</I>&gt;<i> 
</I>&gt;<i> Your choice.  Actually though, MySQL handles Unicode brilliantly,
</I>&gt;<i> and if you could ever convert to that you'll make things a lot
</I>&gt;<i> easier on yourself in the future.
</I>
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="021138.html">[mod_python] Problem with html quoted/unquoted
</A></li>
	<LI>Next message: <A HREF="021140.html">[mod_python] Problem with html quoted/unquoted
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21139">[ date ]</a>
              <a href="thread.html#21139">[ thread ]</a>
              <a href="subject.html#21139">[ subject ]</a>
              <a href="author.html#21139">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
