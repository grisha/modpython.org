<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Custom Login with redirection back to referer
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Custom%20Login%20with%20redirection%20back%20to%20referer&In-Reply-To=4F30B721-9CBB-49E2-A536-11F591AA560D%40dscpl.com.au">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021182.html">
   <LINK REL="Next"  HREF="021180.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Custom Login with redirection back to referer</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Jim Gallacher</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Custom%20Login%20with%20redirection%20back%20to%20referer&In-Reply-To=4F30B721-9CBB-49E2-A536-11F591AA560D%40dscpl.com.au"
       TITLE="[mod_python] Custom Login with redirection back to referer">jpg at jgassociates.ca
       </A><BR>
    <I>Sun May 21 10:17:52 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="021182.html">[mod_python] Custom Login with redirection back to referer
</A></li>
        <LI>Next message: <A HREF="021180.html">[mod_python] Custom Login with redirection back to referer
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21183">[ date ]</a>
              <a href="thread.html#21183">[ thread ]</a>
              <a href="subject.html#21183">[ subject ]</a>
              <a href="author.html#21183">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Graham Dumpleton wrote:
&gt;<i> 
</I>&gt;<i> On 21/05/2006, at 3:23 PM, Deron Meranda wrote:
</I>&gt;<i> 
</I>&gt;&gt;<i> On 5/20/06, Jim Gallacher &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">jpg at jgassociates.ca</A>&gt; wrote:
</I>&gt;&gt;&gt;<i> But I suspect if browser is too old to understand a 307 redirect, most
</I>&gt;&gt;&gt;<i> web pages that user visits are almost completely unreadable anyway. :)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I still remember coding up web pages for the old Mosaic
</I>&gt;&gt;<i> browser, so by this point what's old, new, or stone-age
</I>&gt;&gt;<i> is pretty much a blur ;)
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Not completely on topic, but since we are talking about 30x redirects, I
</I>&gt;&gt;&gt;<i> thought I'd mention that I've modified util.redirect to support any of
</I>&gt;&gt;&gt;<i> the 30x codes. It's a pretty simple change, where util.redirect becomes
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> def redirect(req, location, permanent=0, status=None, text=None)
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> If status is not None it overrides the permanent parameter. I want this
</I>&gt;&gt;&gt;<i> so I use util.redirect with a 303 HTTP_SEE_OTHER response after creating
</I>&gt;&gt;&gt;<i> a resource with a POST. (for the POST-REDIRECT-GET pattern used in
</I>&gt;&gt;&gt;<i> RESTful applications).
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> It's nice to get support for more the the response codes.  I think
</I>&gt;&gt;<i> it's interesting to see how designing RESTful makes one think
</I>&gt;&gt;<i> a lot more about the why and not just how of the HTTP protocol
</I>&gt;&gt;<i> details.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> As far as the redirect() function.  The only thing that bothers
</I>&gt;&gt;<i> me a bit is having two mutually-exclusive parameters.  But I'm
</I>&gt;&gt;<i> not sure how you'd fix that will maintaining backwards compatibility.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> But I have to admit I often do things the &quot;hard way&quot; out of
</I>&gt;&gt;<i> habit back from the days when I coded &quot;nph-&quot; style CGI scripts.
</I>&gt;&gt;<i> I tend not to use the redirect() helper function, and instead
</I>&gt;&gt;<i> do everyting at a lower level.  Some day I'll convert.
</I>&gt;<i> 
</I>&gt;<i> Personally I am probably -1 on overloading util.redirect() to do this. 
</I>&gt;<i> That function
</I>&gt;<i> isn't too complicated, but probably should be kept just for the simple 
</I>&gt;<i> cases. If
</I>&gt;<i> someone knows enough to use other cases, they are probably knowledgeable
</I>&gt;<i> enough to know how to do it properly themselves at the lower level.
</I>
One could argue, (and one will argue, since one wants to use other 30x 
codes but not maintain a separate function in one's own code ;) ), that 
util.redirect is actually broken as it only supports a subset of 30x 
responses. Perhaps it should have been call util.moved() or something.

I don't see adding a parameter to redirect() to support the other 30x 
codes as overloading. The intent of redirect has not changed, and we 
could check that the status is in valid range to enforce this. I do 
however acknowledge the concern about passing 2 mutually exclusive 
parameters but I don't see any other way to munge the code.

Here's what my new version looks like. Note that most of the changes 
consistent of head scratching comments. Actual code changes are only a 
couple of lines.

def redirect(req, location, permanent=0, status=None, text=None):
     &quot;&quot;&quot;
     A convenience function to provide redirection
     &quot;&quot;&quot;

     if req.sent_bodyct:
         raise IOError, &quot;Cannot redirect after headers have already been 
sent.&quot;

     req.err_headers_out[&quot;Location&quot;] = location

     if not status:
         if permanent:
             req.status = apache.HTTP_MOVED_PERMANENTLY
         else:
             req.status = apache.HTTP_MOVED_TEMPORARILY
     else:
         # TODO? should we verify that status is in 30x range?
         # TODO? RFC2616 has some special header requirements
         # for HTTP_NOT_MODIFIED 304 response. Should we raise an error
         # if these conditions are not met, or just assume the
         # caller knows what they are doing and have set the headers?
         # ie. Date, Etag, etc.
         # see <A HREF="http://rfc.net/rfc2616.html#s10.3.5">http://rfc.net/rfc2616.html#s10.3.5</A>
         req.status = status

     if req.status is not apache.HTTP_NOT_MODIFIED:
         # RFC-2161 says HTTP_NOT_MODIFIED (304)
         # response MUST NOT contain a message-body
         # Any others are ok
         # TODO according to RFC-2616 the reponse should not contain
         # a message body for HEAD method. Should we test here or just
         # depend on apache to truncate the body?
         # TODO we shouldn't write anything if the request is a
         # HEAD method. I believe apache will take care of this in
         # a later phase, so we won't worry about it here.

         if text is None:
             req.write('&lt;p&gt;The document has moved'
                      ' &lt;a href=&quot;%s&quot;&gt;here&lt;/a&gt;&lt;/p&gt;\n'
                      % location)
         else:
             req.write(text)

     raise apache.SERVER_RETURN, apache.DONE


Jim
</PRE>










<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="021182.html">[mod_python] Custom Login with redirection back to referer
</A></li>
	<LI>Next message: <A HREF="021180.html">[mod_python] Custom Login with redirection back to referer
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21183">[ date ]</a>
              <a href="thread.html#21183">[ thread ]</a>
              <a href="subject.html#21183">[ subject ]</a>
              <a href="author.html#21183">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
