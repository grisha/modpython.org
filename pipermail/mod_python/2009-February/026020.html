<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] problem with input filter and POST data (fileupload)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20problem%20with%20input%20filter%20and%20POST%20data%20%28fileupload%29&In-Reply-To=200902160227.02677.jerch%40rockborn.de">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026019.html">
   <LINK REL="Next"  HREF="026021.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] problem with input filter and POST data (fileupload)</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20problem%20with%20input%20filter%20and%20POST%20data%20%28fileupload%29&In-Reply-To=200902160227.02677.jerch%40rockborn.de"
       TITLE="[mod_python] problem with input filter and POST data (fileupload)">graham.dumpleton at gmail.com
       </A><BR>
    <I>Sun Feb 15 20:42:32 EST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="026019.html">[mod_python] problem with input filter and POST data (fileupload)
</A></li>
        <LI>Next message: <A HREF="026021.html">[mod_python] problem with input filter and POST data (fileupload)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26020">[ date ]</a>
              <a href="thread.html#26020">[ thread ]</a>
              <a href="subject.html#26020">[ subject ]</a>
              <a href="author.html#26020">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>2009/2/16 Joerg &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">jerch at rockborn.de</A>&gt;:
&gt;<i> hello,
</I>&gt;<i>
</I>&gt;<i> ive dumped a fileupload (original size = 231KB) with the following results:
</I>&gt;<i>
</I>&gt;<i> without filter:
</I>&gt;<i>        - req.read() --&gt; 231KB
</I>&gt;<i>        - req.readline() --&gt; 231KB
</I>&gt;<i>        - req.readline(64000) --&gt; 231KB
</I>&gt;<i>        - via util.py --&gt; 231KB
</I>&gt;<i>
</I>&gt;<i> with filter:
</I>&gt;<i>        - req.read() --&gt; 231KB
</I>&gt;<i>        - req.readline() --&gt; 231KB
</I>&gt;<i>        - req.readline(64000) --&gt; 64KB
</I>
What about:

  s = req.readline(64000)
  while not s:
    ...
    # log some debug ....
    s = req.readline(64000)

Does that result in all data being read, or is that what your test was doing?

Corresponding to this, log inside of the filter when the filter is
entered/exited and how much each read() request yields so can see in
what way blocks of data are being passed from ealier input filters.

Note that an input filter is called multiple times. It doesn't provide
all data in one execution. This is why I want to see the relationship
between each read from handler and what happens in the filter.

Graham

&gt;<i>        - via util.py --&gt; 64KB
</I>&gt;<i>
</I>&gt;<i> the filter:
</I>&gt;<i> def inputfilter(filter):
</I>&gt;<i>        s = filter.read()
</I>&gt;<i>        while s:
</I>&gt;<i>                filter.write(s)
</I>&gt;<i>                s = filter.read()
</I>&gt;<i>        if s is None:
</I>&gt;<i>                filter.close()
</I>&gt;<i>
</I>&gt;<i> somehow the the req.readline(size) method doesnt like input filters. since i
</I>&gt;<i> tested it with a binary file the file content would be in one line, but the
</I>&gt;<i> unread part of this line gets lost. weird thing, but all the other lines
</I>&gt;<i> after the file content (the closing boundery) gets lost, too.
</I>&gt;<i> this problem points definitely into the c-written part of mod_python, util.py
</I>&gt;<i> just inherits it from there.
</I>&gt;<i> any suggestions?
</I>&gt;<i>
</I>&gt;<i> jerch
</I>&gt;<i>
</I></PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="026019.html">[mod_python] problem with input filter and POST data (fileupload)
</A></li>
	<LI>Next message: <A HREF="026021.html">[mod_python] problem with input filter and POST data (fileupload)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26020">[ date ]</a>
              <a href="thread.html#26020">[ thread ]</a>
              <a href="subject.html#26020">[ subject ]</a>
              <a href="author.html#26020">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
