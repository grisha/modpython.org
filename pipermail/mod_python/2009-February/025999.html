<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] req.user always returns None
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20req.user%20always%20returns%20None&In-Reply-To=88e286470902091534n62a88acao31390ba7f330320%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025996.html">
   <LINK REL="Next"  HREF="026001.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] req.user always returns None</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Mitesh Shah</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20req.user%20always%20returns%20None&In-Reply-To=88e286470902091534n62a88acao31390ba7f330320%40mail.gmail.com"
       TITLE="[mod_python] req.user always returns None">mshah at harpercollege.edu
       </A><BR>
    <I>Mon Feb  9 20:11:42 EST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="025996.html">[mod_python] req.user always returns None
</A></li>
        <LI>Next message: <A HREF="026001.html">[mod_python] req.user always returns None
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25999">[ date ]</a>
              <a href="thread.html#25999">[ thread ]</a>
              <a href="subject.html#25999">[ subject ]</a>
              <a href="author.html#25999">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I will take a look at mod_wsgi.  Anyway, looking at the initial post I
realized that pw = req.get_basic_auth_pw() came AFTER req.user.  I don't
know how many times I had read that this was incorrect and STILL did
it!!  Anyway, I got it to work with that change.  But this was all just
for testing.  But now I realized that I may not be able to use this with
what I want to accomplish.

1) Use apache Authorization via .htaccess (which connects to Active
Directory) -- Working
2) After the user is authenticated I have a form (html) with two fields
that posts to a python script. -- partially working (cannot log
username)

The reason I looked into mod_python was that I am trying to pass the
user's name from the initial login to my python script.  Any ideas on
how I could do this? 

Thanks,
Mitesh

-----Original Message-----
From: Graham Dumpleton [mailto:<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">graham.dumpleton at gmail.com</A>] 
Sent: Monday, February 09, 2009 5:35 PM
To: Mitesh Shah
Cc: <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">mod_python at modpython.org</A>
Subject: Re: [mod_python] req.user always returns None

It is the authentication handlers responsibility, directly or
indirectly, to set req.user, it will not be set before the
authentication handler is called. Setting it is one of the things that
a correctly implement authentication handler should do.

For the way you are doing things, req.user will only be set after:

  pw = req.get_basic_auth_pw()

is called. Ie., done as a side effect of that call.

BTW, if you are new to mod_python, you might want to consider instead
using mod_wsgi, writing your application code as a WSGI application
and using mod_wsgi's much simpler to understand authentication
provider hooks where everything is done for you except for validating
the user credentials. For the latter see:

  <A HREF="http://code.google.com/p/modwsgi/wiki/AccessControlMechanisms">http://code.google.com/p/modwsgi/wiki/AccessControlMechanisms</A>

Graham

2009/2/10 Mitesh Shah &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">mshah at harpercollege.edu</A>&gt;:
&gt;<i> I am having some issues trying to req.user to return a username.  I am
</I>very
&gt;<i> new to python and mod_python.  I happened upon this thread:
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> <A HREF="http://osdir.com/ml/python.mod_python/2003-10/msg00092.html">http://osdir.com/ml/python.mod_python/2003-10/msg00092.html</A> regarding
</I>a
&gt;<i> similar issue.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Anyway, even when I ran the code posted by &quot;David Hancock&quot; in the post
</I>above
&gt;<i> I only got a &quot;None&quot; for the username in the error_log file.  I am
</I>sending
&gt;<i> this in the URL:
</I>&gt;<i>
</I>&gt;<i> &quot;<A HREF="http://localhost/python/mptest&quot;">http://localhost/python/mptest&quot;</A>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Here is the test setup as it applies to me(basically unchanged).
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> ******mptest.py*******
</I>&gt;<i>
</I>&gt;<i> from mod_python import apache
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> def handler(req):
</I>&gt;<i>
</I>&gt;<i>         req.content_type = 'text/plain'
</I>&gt;<i>
</I>&gt;<i>         req.send_http_header()
</I>&gt;<i>
</I>&gt;<i>         req.write(&quot;Hello, world!&quot;)
</I>&gt;<i>
</I>&gt;<i>         return apache.OK
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> def authenhandler(req):
</I>&gt;<i>
</I>&gt;<i>         user = req.user
</I>&gt;<i>
</I>&gt;<i>         pw = req.get_basic_auth_pw()
</I>&gt;<i>
</I>&gt;<i>         req.log_error(str(user) + ' ' + str(pw))
</I>&gt;<i>
</I>&gt;<i>         if user == &quot;fred&quot; and pw == &quot;secret&quot;:
</I>&gt;<i>
</I>&gt;<i>                 return apache.OK
</I>&gt;<i>
</I>&gt;<i>         else:
</I>&gt;<i>
</I>&gt;<i>                 return apache.HTTP_UNAUTHORIZED
</I>&gt;<i>
</I>&gt;<i> *******mptest.py******
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> *******httpd.conf******
</I>&gt;<i>
</I>&gt;<i> &lt;Directory &quot;/var/www/html/python&quot;&gt;
</I>&gt;<i>
</I>&gt;<i>     AddHandler python-program .py
</I>&gt;<i>
</I>&gt;<i>     PythonHandler mptest
</I>&gt;<i>
</I>&gt;<i>     PythonAuthenHandler mptest
</I>&gt;<i>
</I>&gt;<i>     AuthType Basic
</I>&gt;<i>
</I>&gt;<i>     AuthName &quot;mod_python restricted area&quot;
</I>&gt;<i>
</I>&gt;<i>     require valid-user
</I>&gt;<i>
</I>&gt;<i>     PythonDebug On
</I>&gt;<i>
</I>&gt;<i> &lt;/Directory&gt;
</I>&gt;<i>
</I>&gt;<i> ******httpd.conf*******
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> *******error_log*******
</I>&gt;<i>
</I>&gt;<i> [Mon Feb 09 17:10:04 2009] [error] [client 127.0.0.1] None secret
</I>&gt;<i>
</I>&gt;<i> *******error_log*******
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> After attempting to login I get a 401 page and then I am asked to
</I>login
&gt;<i> again.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Any help would be greatly appreciated!
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Thank you,
</I>&gt;<i>
</I>&gt;<i> Mitesh
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mod_python mailing list
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I>&gt;<i>
</I>&gt;<i>
</I>
</PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="025996.html">[mod_python] req.user always returns None
</A></li>
	<LI>Next message: <A HREF="026001.html">[mod_python] req.user always returns None
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25999">[ date ]</a>
              <a href="thread.html#25999">[ thread ]</a>
              <a href="subject.html#25999">[ subject ]</a>
              <a href="author.html#25999">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
