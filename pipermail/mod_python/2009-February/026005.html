<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] req.user always returns None
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20req.user%20always%20returns%20None&In-Reply-To=88e286470902091952q24a9933dvc248b8da65dfd7e9%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026004.html">
   <LINK REL="Next"  HREF="026006.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] req.user always returns None</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Mitesh Shah</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20req.user%20always%20returns%20None&In-Reply-To=88e286470902091952q24a9933dvc248b8da65dfd7e9%40mail.gmail.com"
       TITLE="[mod_python] req.user always returns None">mshah at harpercollege.edu
       </A><BR>
    <I>Mon Feb  9 23:06:07 EST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="026004.html">[mod_python] req.user always returns None
</A></li>
        <LI>Next message: <A HREF="026006.html">[mod_python] req.user always returns None
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26005">[ date ]</a>
              <a href="thread.html#26005">[ thread ]</a>
              <a href="subject.html#26005">[ subject ]</a>
              <a href="author.html#26005">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;<i>What is the original Apache configuration block you are using for
</I>&gt;<i>authentication and where is the CGI script located?
</I>
Here is the conf block for the html directory (authentication dir):

****http.conf****
&lt;Directory &quot;/var/www/html&quot;&gt;
	Options Indexes FollowSymLinks
	AllowOverride AuthConfig
	Order allow,deny
    	Allow from all
&lt;/Directory&gt;
****http.conf****

Now the actual .htaccess and html files are in /var/www/html/gapps.

My python CGI is in /var/www/cgi-bin.


-----Original Message-----
From: Graham Dumpleton [mailto:<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">graham.dumpleton at gmail.com</A>] 
Sent: Monday, February 09, 2009 9:52 PM
To: Mitesh Shah
Cc: <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">mod_python at modpython.org</A>
Subject: Re: [mod_python] req.user always returns None

2009/2/10 Mitesh Shah &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">mshah at harpercollege.edu</A>&gt;:
&gt;<i> Sorry for the confusion.  Well it was initially a CGI and then I
</I>learned
&gt;<i> about mod_python.  Right now I haven't made any changes to the CGI
</I>until
&gt;<i> I learn how mod_python works.  And all I need is the username and not
</I>&gt;<i> the full name.  When I tried -- os.environ[&quot;REMOTE_USER&quot;] -- it never
</I>&gt;<i> returned anything.  I think I'm just having a hard time understanding
</I>&gt;<i> the logistics of mod_python.
</I>
If you are using os.environ[&quot;REMOTE_USER&quot;] inside mod_python handler
it will not work. Only relevant to CGI scripts. Just making sure we
are talking about same thing here.

&gt;<i> I call an html and ask for authentication, this should set the cgi
</I>&gt;<i> variable but since my python CGI is calling python (#!/usr/bin/python)
</I>&gt;<i> separately, I don't think it can access the username from the initial
</I>&gt;<i> authentication.
</I>
If you mean that the first line of your CGI script has that line, then
that is normal and how UNIX knows what interpreter to run for the
contents of the script.

If REMOTE_USER environment variable is not set for CGI script, then AD
authentication handler is either not setting 'user' correctly, or the
CGI script isn't located in the same Directory/Location context for
which the authentication was enabled.

What is the original Apache configuration block you are using for
authentication and where is the CGI script located?

Graham

&gt;<i> Which brought me mod_python.  Every example I see they change Apache's
</I>&gt;<i> httpd.conf to point to the python script. And then this calls
</I>&gt;<i> req.get_basic_auth_pw() and req.user and I am able to see the
</I>username.
&gt;<i> Basically I want the user to authenticate and be presented the html
</I>form
&gt;<i> and then post to my CGI(or soon mod_python) and then the python script
</I>&gt;<i> would then grab the username via req.user.
</I>&gt;<i>
</I>&gt;<i> Thanks for you help so far.
</I>&gt;<i>
</I>&gt;<i> -Mitesh
</I>&gt;<i>
</I>&gt;<i> -----Original Message-----
</I>&gt;<i> From: Graham Dumpleton [mailto:<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">graham.dumpleton at gmail.com</A>]
</I>&gt;<i> Sent: Monday, February 09, 2009 7:21 PM
</I>&gt;<i> To: Mitesh Shah
</I>&gt;<i> Cc: <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">mod_python at modpython.org</A>
</I>&gt;<i> Subject: Re: [mod_python] req.user always returns None
</I>&gt;<i>
</I>&gt;<i> 2009/2/10 Mitesh Shah &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">mshah at harpercollege.edu</A>&gt;:
</I>&gt;&gt;<i> I will take a look at mod_wsgi.  Anyway, looking at the initial post
</I>I
&gt;&gt;<i> realized that pw = req.get_basic_auth_pw() came AFTER req.user.  I
</I>&gt;<i> don't
</I>&gt;&gt;<i> know how many times I had read that this was incorrect and STILL did
</I>&gt;&gt;<i> it!!  Anyway, I got it to work with that change.  But this was all
</I>&gt;<i> just
</I>&gt;&gt;<i> for testing.  But now I realized that I may not be able to use this
</I>&gt;<i> with
</I>&gt;&gt;<i> what I want to accomplish.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> 1) Use apache Authorization via .htaccess (which connects to Active
</I>&gt;&gt;<i> Directory) -- Working
</I>&gt;&gt;<i> 2) After the user is authenticated I have a form (html) with two
</I>&gt;<i> fields
</I>&gt;&gt;<i> that posts to a python script. -- partially working (cannot log
</I>&gt;&gt;<i> username)
</I>&gt;<i>
</I>&gt;<i> When you say script, what is it implemented as, CGI or mod_python?
</I>&gt;<i>
</I>&gt;<i> If CGI, then user should be available as REMOTE_USER environment
</I>&gt;<i> variable. If mod_python then as req.user.
</I>&gt;<i>
</I>&gt;<i> If these don't work then the AD module you are using for
</I>&gt;<i> authentication is broken in not setting 'user' in Apache request
</I>&gt;<i> structure properly.
</I>&gt;<i>
</I>&gt;&gt;<i> The reason I looked into mod_python was that I am trying to pass the
</I>&gt;&gt;<i> user's name from the initial login to my python script.  Any ideas on
</I>&gt;&gt;<i> how I could do this?
</I>&gt;<i>
</I>&gt;<i> Or are you after full name of user rather than a log in ID?
</I>&gt;<i>
</I>&gt;<i> Can you clarify a bit.
</I>&gt;<i>
</I>&gt;<i> Graham
</I>&gt;<i>
</I>&gt;&gt;<i> Thanks,
</I>&gt;&gt;<i> Mitesh
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> -----Original Message-----
</I>&gt;&gt;<i> From: Graham Dumpleton [mailto:<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">graham.dumpleton at gmail.com</A>]
</I>&gt;&gt;<i> Sent: Monday, February 09, 2009 5:35 PM
</I>&gt;&gt;<i> To: Mitesh Shah
</I>&gt;&gt;<i> Cc: <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">mod_python at modpython.org</A>
</I>&gt;&gt;<i> Subject: Re: [mod_python] req.user always returns None
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> It is the authentication handlers responsibility, directly or
</I>&gt;&gt;<i> indirectly, to set req.user, it will not be set before the
</I>&gt;&gt;<i> authentication handler is called. Setting it is one of the things
</I>that
&gt;&gt;<i> a correctly implement authentication handler should do.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> For the way you are doing things, req.user will only be set after:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>  pw = req.get_basic_auth_pw()
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> is called. Ie., done as a side effect of that call.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> BTW, if you are new to mod_python, you might want to consider instead
</I>&gt;&gt;<i> using mod_wsgi, writing your application code as a WSGI application
</I>&gt;&gt;<i> and using mod_wsgi's much simpler to understand authentication
</I>&gt;&gt;<i> provider hooks where everything is done for you except for validating
</I>&gt;&gt;<i> the user credentials. For the latter see:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>  <A HREF="http://code.google.com/p/modwsgi/wiki/AccessControlMechanisms">http://code.google.com/p/modwsgi/wiki/AccessControlMechanisms</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Graham
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> 2009/2/10 Mitesh Shah &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">mshah at harpercollege.edu</A>&gt;:
</I>&gt;&gt;&gt;<i> I am having some issues trying to req.user to return a username.  I
</I>&gt;<i> am
</I>&gt;&gt;<i> very
</I>&gt;&gt;&gt;<i> new to python and mod_python.  I happened upon this thread:
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> <A HREF="http://osdir.com/ml/python.mod_python/2003-10/msg00092.html">http://osdir.com/ml/python.mod_python/2003-10/msg00092.html</A>
</I>regarding
&gt;&gt;<i> a
</I>&gt;&gt;&gt;<i> similar issue.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Anyway, even when I ran the code posted by &quot;David Hancock&quot; in the
</I>&gt;<i> post
</I>&gt;&gt;<i> above
</I>&gt;&gt;&gt;<i> I only got a &quot;None&quot; for the username in the error_log file.  I am
</I>&gt;&gt;<i> sending
</I>&gt;&gt;&gt;<i> this in the URL:
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> &quot;<A HREF="http://localhost/python/mptest&quot;">http://localhost/python/mptest&quot;</A>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Here is the test setup as it applies to me(basically unchanged).
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> ******mptest.py*******
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> from mod_python import apache
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> def handler(req):
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>         req.content_type = 'text/plain'
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>         req.send_http_header()
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>         req.write(&quot;Hello, world!&quot;)
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>         return apache.OK
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> def authenhandler(req):
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>         user = req.user
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>         pw = req.get_basic_auth_pw()
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>         req.log_error(str(user) + ' ' + str(pw))
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>         if user == &quot;fred&quot; and pw == &quot;secret&quot;:
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>                 return apache.OK
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>         else:
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>                 return apache.HTTP_UNAUTHORIZED
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> *******mptest.py******
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> *******httpd.conf******
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> &lt;Directory &quot;/var/www/html/python&quot;&gt;
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>     AddHandler python-program .py
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>     PythonHandler mptest
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>     PythonAuthenHandler mptest
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>     AuthType Basic
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>     AuthName &quot;mod_python restricted area&quot;
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>     require valid-user
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>     PythonDebug On
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> &lt;/Directory&gt;
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> ******httpd.conf*******
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> *******error_log*******
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> [Mon Feb 09 17:10:04 2009] [error] [client 127.0.0.1] None secret
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> *******error_log*******
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> After attempting to login I get a 401 page and then I am asked to
</I>&gt;&gt;<i> login
</I>&gt;&gt;&gt;<i> again.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Any help would be greatly appreciated!
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Thank you,
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Mitesh
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;&gt;<i> Mod_python mailing list
</I>&gt;&gt;&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;&gt;&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>
</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="026004.html">[mod_python] req.user always returns None
</A></li>
	<LI>Next message: <A HREF="026006.html">[mod_python] req.user always returns None
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26005">[ date ]</a>
              <a href="thread.html#26005">[ thread ]</a>
              <a href="subject.html#26005">[ subject ]</a>
              <a href="author.html#26005">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="DISABLEhttp://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
