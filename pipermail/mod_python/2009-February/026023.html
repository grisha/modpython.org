<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] problem with input filter and POST data (fileupload)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20problem%20with%20input%20filter%20and%20POST%20data%20%28fileupload%29&In-Reply-To=200902160419.34534.jerch%40rockborn.de">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="026021.html">
   <LINK REL="Next"  HREF="026024.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] problem with input filter and POST data (fileupload)</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20problem%20with%20input%20filter%20and%20POST%20data%20%28fileupload%29&In-Reply-To=200902160419.34534.jerch%40rockborn.de"
       TITLE="[mod_python] problem with input filter and POST data (fileupload)">graham.dumpleton at gmail.com
       </A><BR>
    <I>Sun Feb 15 22:31:06 EST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="026021.html">[mod_python] problem with input filter and POST data (fileupload)
</A></li>
        <LI>Next message: <A HREF="026024.html">[mod_python] problem with input filter and POST data (fileupload)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26023">[ date ]</a>
              <a href="thread.html#26023">[ thread ]</a>
              <a href="subject.html#26023">[ subject ]</a>
              <a href="author.html#26023">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>2009/2/16 Joerg &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">jerch at rockborn.de</A>&gt;:
&gt;<i> Am Monday 16 February 2009 02:42:32 schrieben Sie:
</I>&gt;&gt;<i> 2009/2/16 Joerg &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">jerch at rockborn.de</A>&gt;:
</I>&gt;&gt;<i> &gt; hello,
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; ive dumped a fileupload (original size = 231KB) with the following
</I>&gt;&gt;<i> &gt; results:
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; without filter:
</I>&gt;&gt;<i> &gt;        - req.read() --&gt; 231KB
</I>&gt;&gt;<i> &gt;        - req.readline() --&gt; 231KB
</I>&gt;&gt;<i> &gt;        - req.readline(64000) --&gt; 231KB
</I>&gt;&gt;<i> &gt;        - via util.py --&gt; 231KB
</I>&gt;&gt;<i> &gt;
</I>&gt;&gt;<i> &gt; with filter:
</I>&gt;&gt;<i> &gt;        - req.read() --&gt; 231KB
</I>&gt;&gt;<i> &gt;        - req.readline() --&gt; 231KB
</I>&gt;&gt;<i> &gt;        - req.readline(64000) --&gt; 64KB
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> What about:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>   s = req.readline(64000)
</I>&gt;&gt;<i>   while not s:
</I>&gt;&gt;<i>     ...
</I>&gt;&gt;<i>     # log some debug ....
</I>&gt;&gt;<i>     s = req.readline(64000)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Does that result in all data being read, or is that what your test was
</I>&gt;&gt;<i> doing?
</I>&gt;<i>
</I>&gt;<i> hm, dont know wot u mean with the while not clause, the handler will loop here
</I>&gt;<i> for ever.
</I>
Yeah, me just getting my logic around the wrong way.

&gt;<i> ive inspected the data stream of a indexed textfile to get the break point.
</I>&gt;<i> wot ive found out:
</I>&gt;<i>
</I>&gt;<i> if u set the size of req.readline(size) pretty low the stream breaks after
</I>&gt;<i> 103888 Bytes. til there the readline works correct, it &quot;resumes&quot; the old line
</I>&gt;<i> data and so on. all data after 103888 is lost.
</I>&gt;<i> if u set the size greater than this border, only the first line read will
</I>&gt;<i> succeed. the other data is lost.
</I>&gt;<i> btw, this break point is in the middle of a filter call, not at the end (was
</I>&gt;<i> the 6th here with every call working on 1,4KB of stream data)
</I>&gt;<i>
</I>&gt;<i> since this weird behavior shows up only with a running filter (dont know, if
</I>&gt;<i> non python input filter are affected too), this is probably caused by some
</I>&gt;<i> code in the c part, which is only active with a filter before. also it might
</I>&gt;<i> be some buffer issue there, since the 103888 Byte border is reproducible.
</I>
Frankly I would not be surprised if how mod_python implements the
filters is broken.

My question at this point is, what are you trying to implement that
uses filters anyway. Writing filters in mod_python isn't actually a
wise thing as far as I am concerned as it is not going to be
particularly efficient. Much more sensible to write a proper Apache C
module to implement the filter.

The only serious use of mod_python filters I have seen is Tramline
(upload/download accelerator). They actually complain the mod_python
filters don't work properly as well and say a fix has to be made to
mod_python Python code. The fix itself they propose doesn't make any
sense, unless it is acting as a workaround for borked C code
underneath. The issue for that is at:

  <A HREF="http://issues.apache.org/jira/browse/MODPYTHON-76">http://issues.apache.org/jira/browse/MODPYTHON-76</A>

Anyway, if you are still having problems, not sure there is much more
I can do to help. I continue to only answer questions here, but I
don't actually use mod_python myself anymore nor even start it up to
try things out when people have issues and just rely on my memory of
what happens.

If you can track the problem down to a specific area of code with
small reproducable recipe to trigger, then log a bug report in the
issue tracker. It can go with all the other bugs that haven't been
fixed. :-)

Graham
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="026021.html">[mod_python] problem with input filter and POST data (fileupload)
</A></li>
	<LI>Next message: <A HREF="026024.html">[mod_python] problem with input filter and POST data (fileupload)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26023">[ date ]</a>
              <a href="thread.html#26023">[ thread ]</a>
              <a href="subject.html#26023">[ subject ]</a>
              <a href="author.html#26023">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
