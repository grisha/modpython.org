From nelson at crynwr.com  Mon Sep  1 16:16:16 2003
From: nelson at crynwr.com (Russell Nelson)
Date: Fri Jan  9 21:47:41 2004
Subject: [mod_python] How do I serve up .html files?
In-Reply-To: <20030825213605.O1138@onyx.ispol.com>
References: <16202.30596.238589.112878@desk.crynwr.com>
	<20030825213605.O1138@onyx.ispol.com>
Message-ID: <16211.43280.919607.942196@desk.crynwr.com>

Gregory (Grisha) Trubetskoy writes:
 > P.S. Glad to see you using mod_python!

Me too!  It's a lot faster than a CGI, which was interfering with the
experience.  http://pubsoft.org/ is entirely run by a python program.
I'm going to rewrite my blogging program so that it's dynamic as
well.  Right now it writes static pages (index, archive, and rss).

-- 
--My blog is at angry-economist.russnelson.com  | Free markets express in the
Crynwr sells support for free software  | PGPok | practical world our belief
521 Pleasant Valley Rd. | +1 315 268 1925 voice | that there is that of God
Potsdam, NY 13676-3213  | +1 315 268 9201 FAX   | in all people. -Chris V.
From gdamjan at mail.net.mk  Tue Sep  2 01:15:45 2003
From: gdamjan at mail.net.mk (Damjan)
Date: Fri Jan  9 21:47:41 2004
Subject: [mod_python] Getting the script name with publisher
Message-ID: <20030901231545.GC14389@legolas.on.net.mk>

I have this simple script (test.py) that handled by the publisher:

def index(req):
    script_name = req.subprocess_env['SCRIPT_NAME']
    req.content_type = 'text/html'
    req.send_http_header()
    buf = "Hello, I'm a script. You can call my other methods:"
    buf = buf + "<br>\n" + req.path_info + "<br>\n"
    buf = buf + '''Go <a href="%s/say">here</a>''' % script_name
    return buf
def say(req, what="NOTHING"):
    return "I am saying %s" % what

Now if this script is called as:
[1]  http://127.1/test.py        -> script_name = /test.py
[2]  http://127.1/test.py/       -> script_name = /test.py/
[3]  http://127.1/test.py/index  -> script_name = /test.py
[4]  http://127.1/test.py/index/ -> script_name = /test.py/index


Now obviosly my implementation of getting the script_name doesn't not 
always get the proper result (the proper result being [1] and [3]). 
What's the proper way to do it?? 
I guess the publisher should know the real script name since it had to
import the file...



-- 
Damjan Georgievski
jabberID: damjan@bagra.net.mk
From gdamjan at mail.net.mk  Tue Sep  2 01:50:41 2003
From: gdamjan at mail.net.mk (Damjan)
Date: Fri Jan  9 21:47:41 2004
Subject: [mod_python] Getting the script name with publisher
In-Reply-To: <20030901231545.GC14389@legolas.on.net.mk>
References: <20030901231545.GC14389@legolas.on.net.mk>
Message-ID: <20030901235041.GD14389@legolas.on.net.mk>

> I have this simple script (test.py) that handled by the publisher:

I forgot to mention the test I made were with:
mod_python 3.0.3/ Python 2.3/ Apache 2.0.47 on Slackware-9.0+


PS.
for some strange reason mod_python-3.1.0a would crash Apache on my computer:

mod_python: Creating 256 session mutexes based on 256 max processes and 0 max threads.
(28)No space left on device: mod_python: Failed to create global mutex 127 of 256 (/tmp/mpmtx27278127).
mod_python: We can probably continue, but with diminished ability to process session locks.
mod_python: Hint: On Linux, the problem may be the number of available semaphores, check 'sysctl kernel.sem'
pid file /var/run/httpd.pid overwritten -- Unclean shutdown of previous Apache run?
(28)No space left on device: Couldn't create accept lock

PS2. 
while writing this I solved the mod_python-3.1.0a issue with:

    echo "32000 512 512 512" > /proc/sys/kernel/sem
    
and I also found out that my script works as expected in 3.1.0a 
:)



-- 
Damjan Georgievski
jabberID: damjan@bagra.net.mk
From davis at guydavis.ca  Tue Sep  2 11:10:47 2003
From: davis at guydavis.ca (Guy Davis)
Date: Fri Jan  9 21:47:41 2004
Subject: [mod_python] 
	Safety of using __builtins__ for per-request information?
Message-ID: <3F54CF17.9000006@guydavis.ca>

Hi all,

I'm writing a custom handler using the mod_python.cgi_handler as a guide 
on Apache 1.3 with mod_python 2.7.  Unfortunately, our old CGI makes use 
of certain super-global variables that are not easily done away with.  
I've been able to get this to work by having the handler set the global 
vars into the __builtins__ dictionary.  Then various CGI scripts can 
pull them from __builtins__ when needed. I know using __builtins__ in 
this fashion is not recommended as it's a bit of a hack.

My question is whether storing per-request information in __builtins__ 
is risky due to concurrency reasons.   Put another way, is __builtins__ 
shared between concurrent requests?  For example, person A hits a page 
and the handler stores __builtins__['foo'] = 'bar'.  At nearly the same 
time person B hits a page and the handler stores __builtins__['foo'] = 
'bar2'.  After this occurs, the CGI for person A retrieves 
__builtins__['foo'].  Will the result always be 'bar' or will 'bar2' 
sometimes be returned depending on the timing?

Will the behaviour be any different under Apache 2 and mod_python 3?

Thanks in advance for any responses.

Guy Davis                 http://www.guydavis.ca



From grisha at modpython.org  Tue Sep  2 13:32:27 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:47:41 2004
Subject: [mod_python]  Safety of using __builtins__ for per-request
 information?
In-Reply-To: <3F54CF17.9000006@guydavis.ca>
References: <3F54CF17.9000006@guydavis.ca>
Message-ID: <20030902132450.E6308@onyx.ispol.com>



On Tue, 2 Sep 2003, Guy Davis wrote:

> My question is whether storing per-request information in __builtins__
> is risky due to concurrency reasons.   Put another way, is __builtins__
> shared between concurrent requests?  For example, person A hits a page
> and the handler stores __builtins__['foo'] = 'bar'.  At nearly the same
> time person B hits a page and the handler stores __builtins__['foo'] =
> 'bar2'.  After this occurs, the CGI for person A retrieves
> __builtins__['foo'].  Will the result always be 'bar' or will 'bar2'
> sometimes be returned depending on the timing?

Yes, __builtins__ is shared between requests and using it for per-request
information is not a good idea. You can probably get away with it since
Apache 1.3 isn't multithreaded (unless you're on Windows), but it's still
a bad idea, not only for reasons of concurrency, but also __builtins__
isn't the right place to store anything.

Your best bet is to use the request object itself:

req.foo = 'bar2'

> Will the behaviour be any different under Apache 2 and mod_python 3?

Yes, on apache 2 it is going to be a lot more likely to cause trouble :-)

Grisha
From davidf at sjsoft.com  Tue Sep  2 22:42:33 2003
From: davidf at sjsoft.com (David Fraser)
Date: Fri Jan  9 21:47:41 2004
Subject: [mod_python] Apache startup error using mod_python under Windows
 2000 (have msvcr70.dll)
In-Reply-To: <20030829121653.W53150@onyx.ispol.com>
References: 
	<OF369D809A.F682347B-ON85256D91.004FD7CA-85256D91.0050607E@EU.novartis.net>
	<20030829110249.R53150@onyx.ispol.com> <001201c36e46$1f72d010$0a00a8c0@laird>
	<3F4F7BF2.2090106@sjsoft.com> <20030829121653.W53150@onyx.ispol.com>
Message-ID: <3F5500B9.4020205@sjsoft.com>

Gregory (Grisha) Trubetskoy wrote:

>On Fri, 29 Aug 2003, David Fraser wrote:
>
>  
>
>>Python 2.3, and the easiest way to do that...
>>would be to have an installer for mod_python 3.1a for Python 2.2! Grisha?
>>    
>>
>
>Getting a version for Python 2.2 is tricky because the production
>of the installer requires 2.3, so what I had to do in the past is compile
>for 2.2, but then use 2.3 for the installer, so it's a bit of a pain.
>
>What we really need to do is figure out what is different between our
>systems.
>
>Just to summarise, is this correct? (I am only concerned with 3.1.0a here,
>NOT 3.0.3).
>
>"stock" means the binary from www.python.org, as opposed to Win32, Active
>or compiled. All Apache is the binary from www.apache.org.
>
>       |  mod_py  | Python    | Apache | Win. |
>-------------------------------------------------------
>Perry  |  3.1.0a  | stock 2.3 | 2.0.47 | ?    | OK
>Grisha |  3.1.0a  | stock 2.3 | 2.0.47 | 2000 | OK
>David  |  3.1.0a  | stock 2.3 | 2.0.47 | 2000 | NOT OK
>Laird  |  3.1.0a  | stock 2.3 | 2.0.47 | 2000 | NOT OK
>
>Grisha
>
>  
>
To confirm:
I'm working in Windows 2000
Tested stock Apache 2.0.47, stock Python 2.3, mod_python 3.1a, get error 
loading Module
I tried running FileMon from SysInternals to see if there was some 
dependency etc it was trying to load that was failing, but couldn't see 
anything.
It seems like it is loading the module, but not finding the Apache hooks 
inside it? (Just a guess)

David

From mike.looijmans at asml.com  Wed Sep  3 07:21:15 2003
From: mike.looijmans at asml.com (Mike Looijmans)
Date: Fri Jan  9 21:47:42 2004
Subject: [mod_python] Safety of using __builtins__ for per-request
	information?
Message-ID: <01c371db$322b9780$926a1e6e@wsasd464>

It's not risky in this particular case, but it isn't good practice either...

Using cgi_handler will effectively make your system single-threaded,
regardless of the Apache version used. cgi_handler already shares the
"sys.stdout" and sys.stderr globals, and uses a lock to prevent two requests
to interfere. So within the request, using globals is safe.
I wonder why you use __builtins__, why not just use globals in your own
module? Just create a globals.py or so and import that from each script.

I saw performance _degrade_ because of this when I moved from 'plain' CGI to
mod_python cgihandler (apache 2.0 with worker mpm). Some long requests would
stall the server completely. My solution was to replace all "print"
statements with "output.write(...)" calls, and use the Request object for
output in mod_python scripts and sys.stdout when the server is using plain
CGI. Basically, I turned it around and made a CGI interface that emulates
mod_python (cgihandler does the opposite). The overhead for emulating CGI in
mod_python is huge, while the overhead of emulating mod_python in CGI is
neglectable compared to the interpreter load-and-start.

Mike.


-----Original Message-----
From: Guy Davis <davis@guydavis.ca>
To: mod_python@modpython.org <mod_python@modpython.org>
Date: Tuesday, September 02, 2003 7:13 PM
Subject: [mod_python] Safety of using __builtins__ for per-request
information?


>Hi all,
>
>I'm writing a custom handler using the mod_python.cgi_handler as a guide
>on Apache 1.3 with mod_python 2.7.  Unfortunately, our old CGI makes use
>of certain super-global variables that are not easily done away with.
>I've been able to get this to work by having the handler set the global
>vars into the __builtins__ dictionary.  Then various CGI scripts can
>pull them from __builtins__ when needed. I know using __builtins__ in
>this fashion is not recommended as it's a bit of a hack.
>
>My question is whether storing per-request information in __builtins__
>is risky due to concurrency reasons.   Put another way, is __builtins__
>shared between concurrent requests?  For example, person A hits a page
>and the handler stores __builtins__['foo'] = 'bar'.  At nearly the same
>time person B hits a page and the handler stores __builtins__['foo'] =
>'bar2'.  After this occurs, the CGI for person A retrieves
>__builtins__['foo'].  Will the result always be 'bar' or will 'bar2'
>sometimes be returned depending on the timing?
>
>Will the behaviour be any different under Apache 2 and mod_python 3?
>
>Thanks in advance for any responses.
>
>Guy Davis                 http://www.guydavis.ca
>
>
>
>_______________________________________________
>Mod_python mailing list
>Mod_python@modpython.org
>http://mailman.modpython.org/mailman/listinfo/mod_python
>
>
>
>



-- 
The information contained in this communication and any attachments is confidential and may be privileged, and is for the sole use of the intended recipient(s). Any unauthorized review, use, disclosure or distribution is prohibited. If you are not the intended recipient, please notify the sender immediately by replying to this message and destroy all copies of this message and any attachments. ASML is neither liable for the proper and complete transmission of the information contained in this communication, nor for any delay in its receipt.


From marco.vezzoli at st.com  Wed Sep  3 08:17:18 2003
From: marco.vezzoli at st.com (Marco Vezzoli)
Date: Fri Jan  9 21:47:42 2004
Subject: [mod_python] relocation error with Apache 1.3 on solaris 8
Message-ID: <3F55876E.C9BD222F@st.com>

Hi all,
I'm evaluating mod_python for our intranet site; we are using

solaris 8
gcc 3.0.1
apache 1.3.19
python 2.1.1
mod_python 2.7.8 compiled with DSO 

Compilation and basic tests run good.
I use the mod_python.publisher module for deploy but some modules can't
be imported because there is some name resolution error (messages
follows).
I googled whitout success for this problem (many ask nobody answer).
Thanks in advance for any help.
		Marco


-----------------------------------
Mod_python error: "PythonHandler mod_python.publisher"

Traceback (most recent call last):

  File "/usr/local/lib/python2.1/site-packages/mod_python/apache.py",
line 193, in Dispatch
    result = object(req)

  File "/usr/local/lib/python2.1/site-packages/mod_python/publisher.py",
line 128, in handler
    module = apache.import_module(module_name, _req, [path])

  File "/usr/local/lib/python2.1/site-packages/mod_python/apache.py",
line 335, in import_module
    module = imp.load_module(mname, f, p, d)

  File "/hype/cgi-bin/PyDataAnalysis/EWSSearchProcess.py", line 7, in ?
    import EWS

  File "/hype/cgi-bin/PyDataAnalysis/EWS.py", line 1, in ?
    from psycopg import *

ImportError: ld.so.1: /HTTP-Server/build/apache/bin/httpd: fatal:
relocation error: file /usr/local/lib/libpq.so.2: symbol main:
referenced symbol not found
-----------------------------------

-- 
Marco Vezzoli	   tel. +39 039 603 6852
STMicroelectronics fax. +39 039 603 5055
From perry.tew at cibavision.novartis.com  Wed Sep  3 13:59:36 2003
From: perry.tew at cibavision.novartis.com (perry.tew@cibavision.novartis.com)
Date: Fri Jan  9 21:47:42 2004
Subject: [mod_python] 
	correction: cannot get mod_python3.1a to run against python2.3
Message-ID: <OF11E24A39.2345CE16-ON85256D96.0060276E-85256D96.0062D790@EU.novartis.net>

Grisha,
    Earlier in the thread talking about 3.1a, I reported that I was 
successfully running 3.1a against 2.3.   It appears I was wrong. 
During the install, mod_python found my python2.3 directory in the 
registry and placed its files there, but as I've started developing with 
mod_python, 
I realized it was using my old Python2.2 directories for the python path. 
After I uninstalled 2.2, it stopped working.  Strange. 

Let me ask you, how does the mod_python.so know 
which libraries to link to?  Any idea why it would find 
the 2.2 version and not 2.3?   I now receive the following 
message from apache:
Cannot load C:/perryapps/py/Apache2/modules/mod_python.so into server: The
specified module could not be found.

When I start up python with -, I receive the following output:
Python 2.3 (#46, Jul 29 2003, 18:54:32) [MSC v.1200 32 bin (Intel)] on 
win32

What python version did you build the windows version of 3.1a against?


I also see some comments about mcvcr70.dll in the cvs repository.  I don't 
have
this file in my system.  Then again, your comments in cvs state that it's 
not 
required. 

Is there any other information I can provide to help troubleshoot this for 
myself?
I wish apache would tell me why it can't load mod_python.so.  Is there an 
option
to force apache to devulge additional information?

Sorry for confusion, again, I'm new to all of this.

Perry Tew

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mailman.modpython.org/pipermail/mod_python/attachments/20030903/0dbe868f/attachment.htm
From ronwalf at wam.umd.edu  Wed Sep  3 14:25:38 2003
From: ronwalf at wam.umd.edu (Ron Alford)
Date: Fri Jan  9 21:47:42 2004
Subject: [mod_python] 
	Problem with using apache.import_module for importing scripts
Message-ID: <Pine.LNX.4.44.0309031422590.7361-100000@volus.net>

import_module has a tendency to throw 404s when you have multiple scripts 
of the same name in different directories.  Is there a known way of 
getting around this problem?

My own mod_python handler is effected, and I suspect publisher is, too.

-Ron

--
Ron Alford, KB0NUV
http://volus.net/~ronwalf


From ronwalf at wam.umd.edu  Wed Sep  3 14:34:22 2003
From: ronwalf at wam.umd.edu (Ron Alford)
Date: Fri Jan  9 21:47:42 2004
Subject: [mod_python]  Problem with using apache.import_module for
 importing scripts
In-Reply-To: <Pine.LNX.4.44.0309031422590.7361-100000@volus.net>
Message-ID: <Pine.LNX.4.44.0309031432450.7361-100000@volus.net>

On Wed, 3 Sep 2003, Ron Alford wrote:

> import_module has a tendency to throw 404s when you have multiple scripts 
> of the same name in different directories.  Is there a known way of 
> getting around this problem?
> 
> My own mod_python handler is effected, and I suspect publisher is, too.
> 

This is how I fixed it in apache.py:
...
if not file or (path and not os.path.dirname(file) in path):                    
    raise SERVER_RETURN, HTTP_NOT_FOUND   
if autoreload:
...

goes to 
...
if not file or (path and not os.path.dirname(file) in path):
    #raise SERVER_RETURN, HTTP_NOT_FOUND
    mtime, oldmtime = 0, -1
elif autoreload:
...

--
Ron Alford, KB0NUV
http://volus.net/~ronwalf


From grisha at modpython.org  Wed Sep  3 15:58:13 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:47:42 2004
Subject: [mod_python]  Problem with using apache.import_module for
 importing scripts
In-Reply-To: <Pine.LNX.4.44.0309031432450.7361-100000@volus.net>
References: <Pine.LNX.4.44.0309031432450.7361-100000@volus.net>
Message-ID: <20030903153559.W20438@onyx.ispol.com>


Thanks, that should work OK, and it's still secure because it doesn't
allow access to arbitrary imported modules.

But as a sidenote - you should consider naming your scripts differently
since you end up having to reload them every time the "other" script is
accessed. Also, you may sometimes find object from one script in the
namespace of the other (not sure if it's a Python bug or feature).

Grisha

On Wed, 3 Sep 2003, Ron Alford wrote:

> On Wed, 3 Sep 2003, Ron Alford wrote:
>
> > import_module has a tendency to throw 404s when you have multiple scripts
> > of the same name in different directories.  Is there a known way of
> > getting around this problem?
> >
> > My own mod_python handler is effected, and I suspect publisher is, too.
> >
>
> This is how I fixed it in apache.py:
> ...
> if not file or (path and not os.path.dirname(file) in path):
>     raise SERVER_RETURN, HTTP_NOT_FOUND
> if autoreload:
> ...
>
> goes to
> ...
> if not file or (path and not os.path.dirname(file) in path):
>     #raise SERVER_RETURN, HTTP_NOT_FOUND
>     mtime, oldmtime = 0, -1
> elif autoreload:
> ...
>
> --
> Ron Alford, KB0NUV
> http://volus.net/~ronwalf
>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From synec at viscous.org  Wed Sep  3 17:21:43 2003
From: synec at viscous.org (john spurling)
Date: Fri Jan  9 21:47:42 2004
Subject: [mod_python] relocation error with Apache 1.3 on solaris 8
In-Reply-To: <3F55876E.C9BD222F@st.com>
References: <3F55876E.C9BD222F@st.com>
Message-ID: <20030904002143.GF31952@c7c8.colobox.com>

On Wed, Sep 03, 2003 at 08:17:18AM +0200, Marco Vezzoli wrote:
> Hi all,
> I'm evaluating mod_python for our intranet site; we are using
> 
> solaris 8
> gcc 3.0.1
> apache 1.3.19
> python 2.1.1
> mod_python 2.7.8 compiled with DSO 
> 
> Compilation and basic tests run good.
> I use the mod_python.publisher module for deploy but some modules can't
> be imported because there is some name resolution error (messages
> follows).
> I googled whitout success for this problem (many ask nobody answer).
> Thanks in advance for any help.
> 		Marco

Marco,

this isn't a mod_python problem; it's a psycopg/postgresql problem. in
case you're not familiar, psycopg is a python module used to access a
postgresql database.

it looks to me like psycopg was linked against a different version of
libpq than the one that the runtime linker is using, but that's just a
guess.

you can find more information on psycopg on its website:
http://initd.org/software/psycopg

good luck,
john spurling


> -----------------------------------
> Mod_python error: "PythonHandler mod_python.publisher"
> 
> Traceback (most recent call last):
> 
>   File "/usr/local/lib/python2.1/site-packages/mod_python/apache.py",
> line 193, in Dispatch
>     result = object(req)
> 
>   File "/usr/local/lib/python2.1/site-packages/mod_python/publisher.py",
> line 128, in handler
>     module = apache.import_module(module_name, _req, [path])
> 
>   File "/usr/local/lib/python2.1/site-packages/mod_python/apache.py",
> line 335, in import_module
>     module = imp.load_module(mname, f, p, d)
> 
>   File "/hype/cgi-bin/PyDataAnalysis/EWSSearchProcess.py", line 7, in ?
>     import EWS
> 
>   File "/hype/cgi-bin/PyDataAnalysis/EWS.py", line 1, in ?
>     from psycopg import *
> 
> ImportError: ld.so.1: /HTTP-Server/build/apache/bin/httpd: fatal:
> relocation error: file /usr/local/lib/libpq.so.2: symbol main:
> referenced symbol not found
> -----------------------------------
> 
> -- 
> Marco Vezzoli	   tel. +39 039 603 6852
> STMicroelectronics fax. +39 039 603 5055
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: not available
Url : http://mailman.modpython.org/pipermail/mod_python/attachments/20030903/53baa3a5/attachment.bin
From davis at guydavis.ca  Wed Sep  3 21:18:38 2003
From: davis at guydavis.ca (Guy Davis)
Date: Fri Jan  9 21:47:42 2004
Subject: [mod_python] Code directory layout recommendations?
Message-ID: <1062645517.2832.16.camel@dhcp11.int.guydavis.ca>

Hi all, 

Thanks for the answers to my previous question.  I'm now looking into
reorganizing our current directory layout of Python code.  I was
wondering what your Python web apps use for directory structures?

One idea was to have a directory for "page" modules (generate HTML
mostly), another for library modules, and another for unit tests.

Another possibility is to have a directory per major functional area. 
For example:
	
   functionA/
	-->  functionA_page.py
        -->  functionA_lib1.py
        -->  functionA_lib2.py
        -->  functionA_test.py

   functionB/
        -->  etc...

Both of the examples above are of the CVS workspace.  I'm also debating
whether the actual deploy (web-accessible) directories will be a one to
one mapping of the CVS workspace dirs or whether I'll just dump all the
Python files into one deployment directory.  Python files will be
installed into the web dirs using 'make' on a developer's workstation.

Either approach above would require some tweaks to sys.path.  Is the
standard way to do this is to stick all the required imports into a
single file and then have all other Python modules import it (appending
a relative path like ../../ to sys.path as needed)?  Any other
approaches?

It would be great to hear how you choose to layout your web app
directories and how it has worked out for you.

Thanks.
 

From davidf at sjsoft.com  Thu Sep  4 07:16:56 2003
From: davidf at sjsoft.com (David Fraser)
Date: Fri Jan  9 21:47:42 2004
Subject: [mod_python] Code directory layout recommendations?
In-Reply-To: <1062645517.2832.16.camel@dhcp11.int.guydavis.ca>
References: <1062645517.2832.16.camel@dhcp11.int.guydavis.ca>
Message-ID: <3F56CAC8.5050501@sjsoft.com>

Guy Davis wrote:

>Hi all, 
>
>Thanks for the answers to my previous question.  I'm now looking into
>reorganizing our current directory layout of Python code.  I was
>wondering what your Python web apps use for directory structures?
>
>One idea was to have a directory for "page" modules (generate HTML
>mostly), another for library modules, and another for unit tests.
>
>Another possibility is to have a directory per major functional area. 
>For example:
>	
>   functionA/
>	-->  functionA_page.py
>        -->  functionA_lib1.py
>        -->  functionA_lib2.py
>        -->  functionA_test.py
>
>   functionB/
>        -->  etc...
>
>Both of the examples above are of the CVS workspace.  I'm also debating
>whether the actual deploy (web-accessible) directories will be a one to
>one mapping of the CVS workspace dirs or whether I'll just dump all the
>Python files into one deployment directory.  Python files will be
>installed into the web dirs using 'make' on a developer's workstation.
>
>Either approach above would require some tweaks to sys.path.  Is the
>standard way to do this is to stick all the required imports into a
>single file and then have all other Python modules import it (appending
>a relative path like ../../ to sys.path as needed)?  Any other
>approaches?
>
>It would be great to hear how you choose to layout your web app
>directories and how it has worked out for you.
>
>Thanks.
> 
>
If you're doing an almost-entirely mod-python based application like 
this (i.e. almost all your content is generated by mod_python rather 
than being static),
you may find it better to have one handler in the main directory and let 
it choose which module to pass the other requests to. Then your 
directory structure is defined in Python code rather than by the file 
system. That's what we do

David

From marco.vezzoli at st.com  Thu Sep  4 08:58:57 2003
From: marco.vezzoli at st.com (Marco Vezzoli)
Date: Fri Jan  9 21:47:42 2004
Subject: [mod_python] relocation error with Apache 1.3 on solaris 8
References: <3F55876E.C9BD222F@st.com>
	<20030904002143.GF31952@c7c8.colobox.com>
Message-ID: <3F56E2B1.1E102C94@st.com>

synec@viscous.org wrote:
> 
> On Wed, Sep 03, 2003 at 08:17:18AM +0200, Marco Vezzoli wrote:
> > Hi all,
> > I'm evaluating mod_python for our intranet site; we are using
> >
> > solaris 8
> > gcc 3.0.1
> > apache 1.3.19
> > python 2.1.1
> > mod_python 2.7.8 compiled with DSO
> >
> > Compilation and basic tests run good.
> > I use the mod_python.publisher module for deploy but some modules can't
> > be imported because there is some name resolution error (messages
> > follows).
> > I googled whitout success for this problem (many ask nobody answer).
> > Thanks in advance for any help.
> >               Marco
> 
> Marco,
> 
> this isn't a mod_python problem; it's a psycopg/postgresql problem. in
> case you're not familiar, psycopg is a python module used to access a
> postgresql database.
> 
> it looks to me like psycopg was linked against a different version of
> libpq than the one that the runtime linker is using, but that's just a
> guess.
> 
> you can find more information on psycopg on its website:
> http://initd.org/software/psycopg
> 
> good luck,
> john spurling
> 

Thank you for the answer; I did some other test and I verified that

-some other modules importing .so are working correctly e.g.
mx.DateTime, gadfly
-some don't e.g. cgi (fails to load libssl, messages below)
-another postgres driver fails with a similar error (messages below)
-pure python imports psycopg correctly (so I imagine it could be some
apache/mod_python linking problem)
-no other libpq nor libssl are in the LD_LIBRARY_PATH

I'm using gnu ld: does this cause some problem?
I've tried hacking my path so that it finds Sun's ld but errors are the
same.
Is it an apache config problem?
TIA for any help

	Marco

----error importing cgi----------------------------------
Mod_python error: "PythonHandler mod_python.publisher"

Traceback (most recent call last):

  File "/usr/local/lib/python2.1/site-packages/mod_python/apache.py",
line 193, in Dispatch
    result = object(req)

  File "/usr/local/lib/python2.1/site-packages/mod_python/publisher.py",
line 128, in handler
    module = apache.import_module(module_name, _req, [path])

  File "/usr/local/lib/python2.1/site-packages/mod_python/apache.py",
line 335, in import_module
    module = imp.load_module(mname, f, p, d)

  File "/hype/cgi-bin/PyDataAnalysis/test.py", line 2, in ?
    import cgi

  File "/usr/local/lib/python2.1/cgi.py", line 39, in ?
    import urllib

  File "/usr/local/lib/python2.1/urllib.py", line 26, in ?
    import socket

  File "/usr/local/lib/python2.1/socket.py", line 41, in ?
    from _socket import *

ImportError: ld.so.1: /HTTP-Server/build/apache/bin/httpd: fatal:
relocation error: file /usr/local/lib/libssl.so.0.9.6: symbol main:
referenced symbol not found
--------------------------------------
----error importing pg----------------------------------------
Mod_python error: "PythonHandler mod_python.publisher"

Traceback (most recent call last):

  File "/usr/local/lib/python2.1/site-packages/mod_python/apache.py",
line 193, in Dispatch
    result = object(req)

  File "/usr/local/lib/python2.1/site-packages/mod_python/publisher.py",
line 128, in handler
    module = apache.import_module(module_name, _req, [path])

  File "/usr/local/lib/python2.1/site-packages/mod_python/apache.py",
line 335, in import_module
    module = imp.load_module(mname, f, p, d)

  File "/hype/cgi-bin/PyDataAnalysis/test.py", line 3, in ?
    import pg

  File "/usr/local/lib/python2.1/pg.py", line 7, in ?
    from _pg import *

ImportError: ld.so.1: /HTTP-Server/build/apache/bin/httpd: fatal:
relocation error: file /usr/local/lib/libpq.so.2: symbol main:
referenced symbol not found

-- 
Marco Vezzoli	   tel. +39 039 603 6852
STMicroelectronics fax. +39 039 603 5055
From davidf at sjsoft.com  Thu Sep  4 10:28:06 2003
From: davidf at sjsoft.com (David Fraser)
Date: Fri Jan  9 21:47:42 2004
Subject: [mod_python] relocation error with Apache 1.3 on solaris 8
In-Reply-To: <3F56E2B1.1E102C94@st.com>
References: <3F55876E.C9BD222F@st.com>
	<20030904002143.GF31952@c7c8.colobox.com> <3F56E2B1.1E102C94@st.com>
Message-ID: <3F56F796.4040803@sjsoft.com>

Marco Vezzoli wrote:

>synec@viscous.org wrote:
>  
>
>>On Wed, Sep 03, 2003 at 08:17:18AM +0200, Marco Vezzoli wrote:
>>    
>>
>>>Hi all,
>>>I'm evaluating mod_python for our intranet site; we are using
>>>
>>>solaris 8
>>>gcc 3.0.1
>>>apache 1.3.19
>>>python 2.1.1
>>>mod_python 2.7.8 compiled with DSO
>>>
>>>Compilation and basic tests run good.
>>>I use the mod_python.publisher module for deploy but some modules can't
>>>be imported because there is some name resolution error (messages
>>>follows).
>>>I googled whitout success for this problem (many ask nobody answer).
>>>Thanks in advance for any help.
>>>              Marco
>>>      
>>>
>>Marco,
>>
>>this isn't a mod_python problem; it's a psycopg/postgresql problem. in
>>case you're not familiar, psycopg is a python module used to access a
>>postgresql database.
>>
>>it looks to me like psycopg was linked against a different version of
>>libpq than the one that the runtime linker is using, but that's just a
>>guess.
>>
>>you can find more information on psycopg on its website:
>>http://initd.org/software/psycopg
>>
>>good luck,
>>john spurling
>>
>>    
>>
>
>Thank you for the answer; I did some other test and I verified that
>
>-some other modules importing .so are working correctly e.g.
>mx.DateTime, gadfly
>-some don't e.g. cgi (fails to load libssl, messages below)
>-another postgres driver fails with a similar error (messages below)
>-pure python imports psycopg correctly (so I imagine it could be some
>apache/mod_python linking problem)
>-no other libpq nor libssl are in the LD_LIBRARY_PATH
>
>I'm using gnu ld: does this cause some problem?
>I've tried hacking my path so that it finds Sun's ld but errors are the
>same.
>Is it an apache config problem?
>TIA for any help
>
>	Marco
>  
>
Searching google for httpd fatal relocation error symbol not found libpq 
solaris yields some interesting results, so this seems like a more 
general problem.
e.g. http://www.geocrawler.com/mail/msg.php3?msg_id=7733831&list=10
and an interesting thread on other similar solaris problems
http://msgs.securepoint.com/cgi-bin/get/apache0203/222/1.html

David



From davis at guydavis.ca  Thu Sep  4 16:12:39 2003
From: davis at guydavis.ca (Guy Davis)
Date: Fri Jan  9 21:47:42 2004
Subject: [mod_python] How does mod_python handle concurrency?
Message-ID: <3F57B8D7.1070605@guydavis.ca>

We currently use time.strftime() in our CGI code after setting the TZ 
environment variable to the user's timezone.  Since I'm trying to move 
us away from the mod_python.cgi_handler to our own custom handler, in 
order to allow concurrent request handling, I was wondering how to get 
around the problem of having to update the TZ env var.

This dependency seems to be a problem for concurrent request 
processing.  Does anyone on this list have a trick for doing locale 
specific date formating while handling concurrent requests?

Also, does concurrent request processing in mod_python rely on a single 
Python process with multiple threads?  If so, are sys.exc_type and 
sys.exc_value shared between threads?  I'm on Apache 1.3 now but hope to 
move to Apache 2 soon.

Thanks,
Guy

From dustin at ywlcs.org  Thu Sep  4 18:40:27 2003
From: dustin at ywlcs.org (Dustin Mitchell)
Date: Fri Jan  9 21:47:42 2004
Subject: [mod_python] How does mod_python handle concurrency?
In-Reply-To: <3F57B8D7.1070605@guydavis.ca>
References: <3F57B8D7.1070605@guydavis.ca>
Message-ID: <20030904234027.GV17963@eleanor.internal.ywlcs.org>

On Thu, Sep 04, 2003 at 04:12:39PM -0600, Guy Davis wrote:
> We currently use time.strftime() in our CGI code after setting the TZ 
> environment variable to the user's timezone.  Since I'm trying to move 
> us away from the mod_python.cgi_handler to our own custom handler, in 
> order to allow concurrent request handling, I was wondering how to get 
> around the problem of having to update the TZ env var.

If you can look up the time zone offset, you can adjust the timezones
by simply adding the required number of seconds.  I know this isn't a
very good solution, but it's what I use for the small stuff I do.

I would be very interested in how you determine the user's locale?  Is
there any trick to interpreting request headers? Or is it a user
prefererence for your site?

> Also, does concurrent request processing in mod_python rely on a single 
> Python process with multiple threads?  If so, are sys.exc_type and 
> sys.exc_value shared between threads?  I'm on Apache 1.3 now but hope to 
> move to Apache 2 soon.

Yes, those values are explicitly shared between threads, which is the
reason for the creation of sys.exc_info().  See 

 http://www.python.org/doc/current/lib/module-sys.html

Dustin

-- 

  Dustin Mitchell
  dustin@ywlcs.org/djmitche@alumni.uchicago.edu
  http://people.cs.uchicago.edu/~dustin/
  PGP Key: http://people.cs.uchicago.edu/~dustin/pubkey.txt
From cs1spw at bath.ac.uk  Fri Sep  5 03:42:29 2003
From: cs1spw at bath.ac.uk (Simon Willison)
Date: Fri Jan  9 21:47:42 2004
Subject: [mod_python] Best practise for database connection pooling?
Message-ID: <3F57F815.8020300@bath.ac.uk>

We are looking to build a large content management system using 
mod_python and PostgreSQL. I'm interested in what is considered "best 
practise" for database connection pooling. So far, I've been playing 
with the idea of setting up a single database connection as a global 
variable at the start of each mod_python script - since scripts stay in 
memory between requests, this can be reused for requests without needing 
to reopen the connection. It also means that every httpd child process 
spun off by the server ends up with its own database connection.

The postgres server is running on the same machine as the web server, 
but we may move to separate servers for the two in the future. Am I on 
the right track, or is there a better way of managing database connnections?

Incidentally, the database connection module we are using is 
http://pypgsql.sourceforge.net/

Thanks,

Simon Willison

From marco.vezzoli at st.com  Fri Sep  5 08:11:35 2003
From: marco.vezzoli at st.com (Marco Vezzoli)
Date: Fri Jan  9 21:47:42 2004
Subject: [mod_python] relocation error with Apache 1.3 on solaris 8
References: <3F55876E.C9BD222F@st.com>
	<20030904002143.GF31952@c7c8.colobox.com> <3F56E2B1.1E102C94@st.com>
	<3F56F796.4040803@sjsoft.com>
Message-ID: <3F582917.216458B4@st.com>

> >
> Searching google for httpd fatal relocation error symbol not found libpq
> solaris yields some interesting results, so this seems like a more
> general problem.
> e.g. http://www.geocrawler.com/mail/msg.php3?msg_id=7733831&list=10
> and an interesting thread on other similar solaris problems
> http://msgs.securepoint.com/cgi-bin/get/apache0203/222/1.html
> 
> David

Thank you David for the pointers.
The second one suggests that careful linking options would prevent the
'main' symbol to be generated

>    I have seen a similar failure on AIX recently. It seems that 
>    php (and tcl, which was my case) use a somewhat different way to load 
>    the shared libs than PostgreSQL does.
>
>    While PostgreSQL does not care, they need a shared lib that was linked 
>    with a switch to specify no entry (like -bnoentry on AIX).
>    Maybe that has to do with our RTLD_LAZY ?

and using nm I've found that all mod_*.so libraries do not have any
'main' symbol but libpq.so does have one marked 'U'.
I'll look for more info about linker options.
	Marco
-- 
Marco Vezzoli	   tel. +39 039 603 6852
STMicroelectronics fax. +39 039 603 5055
From davidf at sjsoft.com  Fri Sep  5 09:39:24 2003
From: davidf at sjsoft.com (David Fraser)
Date: Fri Jan  9 21:47:42 2004
Subject: [mod_python] How does mod_python handle concurrency?
In-Reply-To: <20030904234027.GV17963@eleanor.internal.ywlcs.org>
References: <3F57B8D7.1070605@guydavis.ca>
	<20030904234027.GV17963@eleanor.internal.ywlcs.org>
Message-ID: <3F583DAC.5010905@sjsoft.com>

Dustin Mitchell wrote:

>On Thu, Sep 04, 2003 at 04:12:39PM -0600, Guy Davis wrote:
>  
>
>>We currently use time.strftime() in our CGI code after setting the TZ 
>>environment variable to the user's timezone.  Since I'm trying to move 
>>us away from the mod_python.cgi_handler to our own custom handler, in 
>>order to allow concurrent request handling, I was wondering how to get 
>>around the problem of having to update the TZ env var.
>>    
>>
>
>If you can look up the time zone offset, you can adjust the timezones
>by simply adding the required number of seconds.  I know this isn't a
>very good solution, but it's what I use for the small stuff I do.
>
>I would be very interested in how you determine the user's locale?  Is
>there any trick to interpreting request headers? Or is it a user
>prefererence for your site?
>  
>
This is not for the time zone, but we have enhanced the gettext module 
to be able to support multiple locales, and to localize strings per-session.
The user selects a language, the session object passes that to the 
localize function

David

From davidf at sjsoft.com  Fri Sep  5 09:53:31 2003
From: davidf at sjsoft.com (David Fraser)
Date: Fri Jan  9 21:47:42 2004
Subject: [mod_python] Best practise for database connection pooling?
In-Reply-To: <3F57F815.8020300@bath.ac.uk>
References: <3F57F815.8020300@bath.ac.uk>
Message-ID: <3F5840FB.5090006@sjsoft.com>

Simon Willison wrote:

> We are looking to build a large content management system using 
> mod_python and PostgreSQL. I'm interested in what is considered "best 
> practise" for database connection pooling. So far, I've been playing 
> with the idea of setting up a single database connection as a global 
> variable at the start of each mod_python script - since scripts stay 
> in memory between requests, this can be reused for requests without 
> needing to reopen the connection. It also means that every httpd child 
> process spun off by the server ends up with its own database connection.

We have a system where we use multiple different database connections 
for different applications running on the same server.
Each application object exists once per child, and has its own database 
connection.

> The postgres server is running on the same machine as the web server, 
> but we may move to separate servers for the two in the future. Am I on 
> the right track, or is there a better way of managing database 
> connnections?

You may want to look at http://sqlrelay.sourceforge.net/ - I haven't 
used it, but it seems useful particularly if you have separate servers.
For those not going and reading the page:
SQL Relay is a persistent database connection pooling, proxying and load 
balancing system for Unix and Linux supporting ODBC, Oracle, MySQL, 
mSQL, PostgreSQL, Sybase, MS SQL Server, IBM DB2, Interbase, Lago and 
SQLite with APIs for C, C++, Perl, Perl-DBD, Python, Python-DB, Zope, 
PHP, Ruby, Ruby-DBD, TCL and Java, command line clients, a GUI 
configuration tool and extensive documentation. The APIs support 
advanced database operations such as bind variables, multi-row fetches, 
client side result set caching and suspended transactions. It is ideal 
for speeding up database-driven web-based applications, accessing 
databases from unsupported platforms, migrating between databases, 
distributing access to replicated databases and throttling database access.

>
> Incidentally, the database connection module we are using is 
> http://pypgsql.sourceforge.net/

I've found PyGreSQL to be better...
http://www.druid.net/pygresql/
But you may find otherwise...

David

From gdamjan at mail.net.mk  Fri Sep  5 16:18:51 2003
From: gdamjan at mail.net.mk (Damjan)
Date: Fri Jan  9 21:47:42 2004
Subject: [mod_python] How does mod_python handle concurrency?
In-Reply-To: <3F57B8D7.1070605@guydavis.ca>
References: <3F57B8D7.1070605@guydavis.ca>
Message-ID: <20030905141851.GA8470@legolas.on.net.mk>

> We currently use time.strftime() in our CGI code after setting the TZ 
> environment variable to the user's timezone.  Since I'm trying to move 
> us away from the mod_python.cgi_handler to our own custom handler, in 
> order to allow concurrent request handling, I was wondering how to get 
> around the problem of having to update the TZ env var.

Setting environment variables in multithreaded/concurent programs 
is ugly.
I would suggest a different approach for your problem..
t = time.gmtime() # get the UTC time tupple
t = t[:-1] + (TZ,) # set the TZ field of the tupple
time.strftime(format,t) # get the strftime of that 


Also glibc as of 2.3 has a new multithreaded locale API, it doesn't 
depend on global variables. This would be great (and indead is designed
for) for multithreaded application servers like Apache.
Unfourtenatelly I don't know that python bindings for this API exists or
if at all anyone is working on this...

> This dependency seems to be a problem for concurrent request 
> processing.  Does anyone on this list have a trick for doing locale 
> specific date formating while handling concurrent requests?
> http://mailman.modpython.org/mailman/listinfo/mod_python

-- 
Damjan Georgievski
jabberID: damjan@bagra.net.mk
From conrad at hep.caltech.edu  Sat Sep  6 20:04:51 2003
From: conrad at hep.caltech.edu (Conrad Steenberg)
Date: Fri Jan  9 21:47:42 2004
Subject: [mod_python] ANNOUNCE: Mod_python 3.1.0 Alpha
In-Reply-To: <20030829171157.O56156@onyx.ispol.com>
References: <20030828210644.C43921@onyx.ispol.com>
	<20030829171157.O56156@onyx.ispol.com>
Message-ID: <1062903891.2713.33.camel@Presario>

Hi

Having played around with the new version and PSP, I have one question:
My application doesn't use the session infrastructure provided by PSP,
but 256 sessions (in shared memory) are created at startup anyway.

This prompts a change in the kernel semaphore settings on older linuxes
(redhat 7.3 specifically).  As this will likely trip up new sysadmins
that just want to try out the package, is there a way to reduce the
number of sessions (or space for these sessions) by using a directive?

If there isn't such a directive, is it possible to add one?

Cheers!

Conrad

On Fri, 2003-08-29 at 14:21, Gregory (Grisha) Trubetskoy wrote:
> On Fri, 29 Aug 2003, Conrad Steenberg wrote:
> 
> > Hi
> >
> > Tested here to be working under an OpenPKG-1.3 (ish) environment.
> >
> > Any pointers to higher level tools that works with the included version
> > of PSP (such as for constructing a news or blogging site)? There seems
> > to be at least two other projects also calling themselves PSP ;-)
> 
> There is even one called Perl Server Pages :-)
> 
> I doubt there are any tools, since our PSP is brand new. B
> 
> But it's rather simplistic. For everyone's info:
> 
> This describes the syntax:
> 
> http://www.modpython.org/live/mod_python-3.1.0a/doc-html/pyapi-psp.html
> 
> And this describes the psp handler (things like sessions, etc):
> 
> http://www.modpython.org/live/mod_python-3.1.0a/doc-html/pyapi-psp.html
> 
> Also, if you have any JSP experience, there was an e-mail on the dev list
> regarding how it corresponds to PSP, which I'll forward to this list
> (because I forgot where the dev list archives are).
> 
> Grisha
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
-- 
Conrad Steenberg <conrad@hep.caltech.edu>
From grisha at apache.org  Sun Sep  7 18:45:45 2003
From: grisha at apache.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:47:42 2004
Subject: [mod_python] ANNOUNCE: Mod_python 3.1.0 Alpha
In-Reply-To: <1062903891.2713.33.camel@Presario>
References: <20030828210644.C43921@onyx.ispol.com>
	<1062188981.14514.296.camel@heppc22>
	<1062903891.2713.33.camel@Presario>
Message-ID: <20030907180501.B83449@onyx.ispol.com>


On Sat, 6 Sep 2003, Conrad Steenberg wrote:

> This prompts a change in the kernel semaphore settings on older linuxes
> (redhat 7.3 specifically).

Well - I think this is really a redhat problem. I believe I even saw
something reporting it as a security problem - it is very easy for someone
to deprive an rh box of available semaphores. I wonder what the default is
on rh 8 and 9 (anyone?).

> As this will likely trip up new sysadmins that just want to try out the
> package,

It probably will :-(
But that's why there is a "Hint" in the error log for Linux users.

> is there a way to reduce the number of sessions (or space for
> these sessions) by using a directive?

Yes, there is a way - adjust MaxClients. Some MPM's (at least worker) will
alter MaxClients if the other directives do not add up to or exceed it, so
it's possible other values may need adjusting.

BTW, mod_python does NOT quit if it was able to allocate *some* locks, but
not *all*, it only writes a warning to the error log and proceeds. But
what craps out after that is mod_rewrite, which wants a global lock, but
mod_python has eaten them all. So perhaps I can adjust it so that if we
allocated *some* but not *all*, then to free one (or two?)  so that
mod_rewrite is happy.

(On the other hand doing this may seem like going too far to adress what
is really a lousy config default in the kernel....)

Grisha

>
> If there isn't such a directive, is it possible to add one?
>
> Cheers!
>
> Conrad
>
> On Fri, 2003-08-29 at 14:21, Gregory (Grisha) Trubetskoy wrote:
> > On Fri, 29 Aug 2003, Conrad Steenberg wrote:
> >
> > > Hi
> > >
> > > Tested here to be working under an OpenPKG-1.3 (ish) environment.
> > >
> > > Any pointers to higher level tools that works with the included version
> > > of PSP (such as for constructing a news or blogging site)? There seems
> > > to be at least two other projects also calling themselves PSP ;-)
> >
> > There is even one called Perl Server Pages :-)
> >
> > I doubt there are any tools, since our PSP is brand new. B
> >
> > But it's rather simplistic. For everyone's info:
> >
> > This describes the syntax:
> >
> > http://www.modpython.org/live/mod_python-3.1.0a/doc-html/pyapi-psp.html
> >
> > And this describes the psp handler (things like sessions, etc):
> >
> > http://www.modpython.org/live/mod_python-3.1.0a/doc-html/pyapi-psp.html
> >
> > Also, if you have any JSP experience, there was an e-mail on the dev list
> > regarding how it corresponds to PSP, which I'll forward to this list
> > (because I forgot where the dev list archives are).
> >
> > Grisha
> >
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://mailman.modpython.org/mailman/listinfo/mod_python
> --
> Conrad Steenberg <conrad@hep.caltech.edu>
>
From llsousa at ualg.pt  Mon Sep  8 11:48:53 2003
From: llsousa at ualg.pt (Luis Sousa)
Date: Fri Jan  9 21:47:42 2004
Subject: [mod_python] Some problems with mod_python.publisher
In-Reply-To: <20030615154824.64623.qmail@web40402.mail.yahoo.com>
References: <20030615154824.64623.qmail@web40402.mail.yahoo.com>
Message-ID: <3F5C5E95.5080603@ualg.pt>

Michel Thadeu wrote:

>Hi guys!
>
>I having trouble with mod_python.publisher, I using a apache 1.2.27 and
>the mod_python 2.7 (the standard version of debian testing).
>
>I have configured the apache like this:
>
>   <Directory /var/www/modpython>
>     AddHandler python-program .py
>     PythonHandler mod_python.publisher
>   </Directory>
>
>And have made a script named index.py with the next code:
>
>   from mod_python import apache
>   def executar(req):
>           req.content_type="text/html"
>           req.send_http_header()
>           req.write('<H1>Some test of executar!</H1>')
>           return apache.OK
>
The code here can be something like this:
s="<html><h1>hello world</h1></html>"
return s

When using mod_python.publisher you have to return a string
Luis Sousa

>
>But when I execute this script, using the next url...
>
>   http://localhost/modpython/index.py/executar
>
>The page is open, rendening html code, and all the things, but with a
>error message:
>
>   Some test of executar!
>   HTTP/1.1 200 OK Date: Tue, 17 Jun 2003 23:36:26 GMT Server: 
>   Apache/1.3.27 (Unix) Debian GNU/Linux mod_python/2.7.8 Python/2.2.2 
>   PHP/4.1.2 Connection: close Transfer-Encoding: chunked Content-Type:
>
>   text/html; charset=iso-8859-1
>   OK
>   The server encountered an internal error or misconfiguration and was
>
>   unable to complete your request.
>
>   Please contact the server administrator, webmaster@capsulecorp and 
>   inform them of the time the error occurred, and anything you might 
>   have done that may have caused the error.
>
>   More information about this error may be available in the server 
>   error log.
>
>But if I use PythonHanldler and name executar as handler, the error is
>not shown... I read the last lines of error.log of apache, but I don't
>found a critical error:
>
>   [Tue Jun 17 21:42:29 2003] [alert] apache: Could not determine the 
>   server's fully qualified domain name, using 127.0.0.1 for ServerName
>   [Tue Jun 17 21:42:30 2003] [notice] Apache/1.3.27 (Unix) Debian 
>   GNU/Linux mod_python/2.7.8 Python/2.2.2 PHP/4.1.2 configured -- 
>   resuming normal operations
>   [Tue Jun 17 21:42:30 2003] [notice] suEXEC mechanism enabled 
>   (wrapper: /usr/lib/apache/suexec)
>   [Tue Jun 17 21:42:30 2003] [notice] Accept mutex: sysvsem (Default: 
>   sysvsem)
>
>This is the last errors since the last restart of apache...
>
>Well, I don't know what error I made, can someone help me?
>
>thanks
>--
>Michel Thadeu Sabchuk
>Curitiba - Paran? - Brazil
>
>=====
>--
>Michel Thadeu Sabchuk
>Curitiba/PR
>
>_______________________________________________________________________
>Yahoo! Mail
>Mais espa?o, mais seguran?a e gratuito: caixa postal de 6MB, antiv?rus, prote??o contra spam.
>http://br.mail.yahoo.com/
>_______________________________________________
>Mod_python mailing list
>Mod_python@modpython.org
>http://mailman.modpython.org/mailman/listinfo/mod_python
>
>
>  
>


-- 
Luis Sousa
Especialista de Inform?tica
Gabinete de Gest?o de Informa??o, ext: 7837
Campus de Gambelas
Universidade do Algarve, tel: 289800900

-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/x-pkcs7-signature
Size: 3627 bytes
Desc: S/MIME Cryptographic Signature
Url : http://mailman.modpython.org/pipermail/mod_python/attachments/20030908/1f41dfc5/smime.bin
From llsousa at ualg.pt  Mon Sep  8 12:23:41 2003
From: llsousa at ualg.pt (Luis Sousa)
Date: Fri Jan  9 21:47:42 2004
Subject: [mod_python] 
	Handler publisher with multiple directories on the same tree
Message-ID: <3F5C66BD.8060402@ualg.pt>

Hello everybody.

I'm using Apache 1.3.26-0woody3 and mod_python 2.7.8-6, debian releases.
I have configured just one directory on my public_html and added some 
directives to httpd.conf file as follows:

<Directory /home/llsousa/public_html/gpessoal/trunk>
    AddHandler python-program .py
    PythonHandler mod_python.publisher
    PythonDebug On
    PythonPath "sys.path+['/home/llsousa/public_html/gpessoal/trunk']"
</Directory>

And everything worked ok.
So, I needed 2 more folders and I did the same for the rest, like this:

<Directory /home/llsousa/public_html/gpessoal/dev>
    AddHandler python-program .py
    PythonHandler mod_python.publisher
    PythonDebug On
    PythonPath "sys.path+['/home/llsousa/public_html/gpessoal/dev']"
</Directory>

<Directory /home/llsousa/public_html/gpessoal/bugs>
    AddHandler python-program .py
    PythonHandler mod_python.publisher
    PythonDebug On
    PythonPath "sys.path+['/home/llsousa/public_html/gpessoal/bugs']"
</Directory>

But I got a unpleasent surprise, that is, using browser, I access one of 
the projects subsection and everything is OK. After I got the page, I 
tried to access to another of the subsection and I got an 404, page not 
found. If I wait for a while (I don't know exactly, but something like 
one minute) and made reload on browser, I can now see this subsection.

Does anyone have any clue about this ? What am I doing wrong ?

Thanks in advance for your help,
Luis Sousa

-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/x-pkcs7-signature
Size: 3627 bytes
Desc: S/MIME Cryptographic Signature
Url : http://mailman.modpython.org/pipermail/mod_python/attachments/20030908/7509d5b4/smime.bin
From mike.looijmans at asml.com  Mon Sep  8 13:35:35 2003
From: mike.looijmans at asml.com (Mike Looijmans)
Date: Fri Jan  9 21:47:42 2004
Subject: [mod_python] Handler publisher with multiple directories on the
	same tree
Message-ID: <01c375fd$51705d80$926a1e6e@wsasd464>

My guess:

If you wait for about a minute, the server will drop the keepalive
connection and another child process will handle your request. The effect is
that you probably get a brand new environment. Probably if you repeat often
enough, it will break completely when all childs are "loaded".

The problem is probably that you have equal named scripts in each directory.
So if you have

/a/foo.py
/b/foo.py

The first call will fetch /a/foo.py, and when you want to load the 'b'
version, it will just return the 'a' version because a 'foo' script is
already imported, even if pythonpath no longer contains the /a/ directory.

Scripts must have unique names, even when in different directories.

A good workaround is to use the "PythonInterpreter" directive, set it to per
directory or specify a unique interpreter name for each directory.
Each interpreter will have its own modules, so the "already loaded" effect
won't bite you.
This does, however, consume more memory.

This is also great for testing, you can add a "test" directory with a
different interpreter and have an environment completely set apart with it
own set of scripts and data and so.

[snip]
>But I got a unpleasent surprise, that is, using browser, I access one of
>the projects subsection and everything is OK. After I got the page, I
>tried to access to another of the subsection and I got an 404, page not
>found. If I wait for a while (I don't know exactly, but something like
>one minute) and made reload on browser, I can now see this subsection.




-- 
The information contained in this communication and any attachments is confidential and may be privileged, and is for the sole use of the intended recipient(s). Any unauthorized review, use, disclosure or distribution is prohibited. If you are not the intended recipient, please notify the sender immediately by replying to this message and destroy all copies of this message and any attachments. ASML is neither liable for the proper and complete transmission of the information contained in this communication, nor for any delay in its receipt.


From neo at https.ru  Mon Sep  8 16:59:20 2003
From: neo at https.ru (Neo Eureka)
Date: Fri Jan  9 21:47:42 2004
Subject: [mod_python] Resource consumption
In-Reply-To: <20030907180501.B83449@onyx.ispol.com>
References: <20030828210644.C43921@onyx.ispol.com>
 <1062188981.14514.296.camel@heppc22> <1062903891.2713.33.camel@Presario>
 <20030907180501.B83449@onyx.ispol.com>
Message-ID: <11020798025.20030908165920@https.ru>


Hi all!

Grisha,

IIUC, shared memory and semaphores are allocated even if I don't use
sessions or PSP at all ? Is there a way to completely "switch off"
the features I do not (and will not) use ever ? It seems very strange
to me: features that I do not use still consume system resources and
cause problems with server startup (yes, I've got RedHat box).


> On Sat, 6 Sep 2003, Conrad Steenberg wrote:

>> This prompts a change in the kernel semaphore settings on older linuxes
>> (redhat 7.3 specifically).

> Well - I think this is really a redhat problem. I believe I even saw
> something reporting it as a security problem - it is very easy for someone
> to deprive an rh box of available semaphores. I wonder what the default is
> on rh 8 and 9 (anyone?).

>> As this will likely trip up new sysadmins that just want to try out the
>> package,

> It probably will :-(
> But that's why there is a "Hint" in the error log for Linux users.

>> is there a way to reduce the number of sessions (or space for
>> these sessions) by using a directive?

> Yes, there is a way - adjust MaxClients. Some MPM's (at least worker) will
> alter MaxClients if the other directives do not add up to or exceed it, so
> it's possible other values may need adjusting.

> BTW, mod_python does NOT quit if it was able to allocate *some* locks, but
> not *all*, it only writes a warning to the error log and proceeds. But
> what craps out after that is mod_rewrite, which wants a global lock, but
> mod_python has eaten them all. So perhaps I can adjust it so that if we
> allocated *some* but not *all*, then to free one (or two?)  so that
> mod_rewrite is happy.

> (On the other hand doing this may seem like going too far to adress what
> is really a lousy config default in the kernel....)

> Grisha


--- 
Neo Eureka / mailto:neo@https.ru

From llsousa at ualg.pt  Mon Sep  8 14:21:46 2003
From: llsousa at ualg.pt (Luis Sousa)
Date: Fri Jan  9 21:47:43 2004
Subject: [mod_python] Handler publisher with multiple directories on the
 same tree
In-Reply-To: <01c375fd$51705d80$926a1e6e@wsasd464>
References: <01c375fd$51705d80$926a1e6e@wsasd464>
Message-ID: <3F5C826A.80404@ualg.pt>

Skipped content of type multipart/alternative-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/x-pkcs7-signature
Size: 3627 bytes
Desc: S/MIME Cryptographic Signature
Url : http://mailman.modpython.org/pipermail/mod_python/attachments/20030908/79dd05a8/smime.bin
From mike.looijmans at asml.com  Mon Sep  8 15:40:26 2003
From: mike.looijmans at asml.com (Mike Looijmans)
Date: Fri Jan  9 21:47:43 2004
Subject: [mod_python] Handler publisher with multiple directories on
	thesame tree
Message-ID: <01c3760e$c26c4100$926a1e6e@wsasd464>

> When I'm developing I usually have a common problem that is when I
> change a class or some file, sometimes the interpreter remains in memory
> the old version and doesn't load the new one. Is there a way to solve
> this out ? Normally I use an non elegant way, I restart apache!

I use the "reload" built-in function. This loads an internal module from
disk.
My main handler checks if the path_info of the URL is "/request" and if so,
runs the following (you could use publisher to publish this interface as
well).
All "my" modules are named "ops_" something. You could also use the __file__
location as a filter.

def reloadmodules(req):
    '''Try to reload all ops_ modules. This is typically done after updating
    imported scripts, such as ops_cgisql.py. The main scripts will be
    reloaded automatically on demand, so that there is no need to send
    a reload after changing ops_webrellist.py or so.
    This also throws away old DB connections. If there are currently
    active connections, these are preserved.'''
    req.content_type='text/plain'
    # Reload python modules
    modules = sys.modules.keys()
    modules.sort()
    for module in modules:
        if module[:4] == 'ops_':
            try:
                req.write('Reloading: %s\n' % module)
                reload(sys.modules[module])
            except:
                req.write('%s: %s\n' % sys.exc_info()[:2])
    # throw away DB connection objects
    req.write('Destroy DB cached connections\n')
    _lock.acquire()
    try:
        dblist.clear()
    finally:
        _lock.release()
    req.write('Done\n')





-- 
The information contained in this communication and any attachments is confidential and may be privileged, and is for the sole use of the intended recipient(s). Any unauthorized review, use, disclosure or distribution is prohibited. If you are not the intended recipient, please notify the sender immediately by replying to this message and destroy all copies of this message and any attachments. ASML is neither liable for the proper and complete transmission of the information contained in this communication, nor for any delay in its receipt.


From grisha at modpython.org  Mon Sep  8 09:53:57 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:47:43 2004
Subject: [mod_python] Resource consumption
In-Reply-To: <11020798025.20030908165920@https.ru>
References: <20030828210644.C43921@onyx.ispol.com>
	<1062188981.14514.296.camel@heppc22>
	<20030907180501.B83449@onyx.ispol.com>
	<11020798025.20030908165920@https.ru>
Message-ID: <20030908092907.A93462@onyx.ispol.com>



On Mon, 8 Sep 2003, Neo Eureka wrote:

> IIUC, shared memory and semaphores are allocated even if I don't use
> sessions or PSP at all?

Yes (there is no shared memory used for sessions, only locks, which *may*
be semaphores or some other lock implementation, depending on your OS).

> Is there a way to completely "switch off" the features I do not (and
> will not) use ever ?

Not right now. I couldn't think of a way to do it that wouldn't be
confusing. Locks must be allocated at server startup so that children
have access to them. We could have a directive like "PythonSessionLocks
Off", IMHO that's on the ugly side.

Generally, I think keeping the number of Apache directive to a minimum is
a good idea.

> It seems very strange to me: features that I do not use still consume
> system resources

That's not unusual - as an example, every RH box will load all kinds of
modules (including mod_python), but few people ever use them all.

> and cause problems with server startup

This, I agree, *is* a problem, but I think I can work around it without
introducing new Apache directives.

Another point to consider is that on many other systems there will not be
a limit to the number of locks allocated, and there is no cost to
allocating a lock but never using it, so a directive like this wouldn't
make much sense.

Grisha

> (yes, I've got RedHat box).


>
>
> > On Sat, 6 Sep 2003, Conrad Steenberg wrote:
>
> >> This prompts a change in the kernel semaphore settings on older linuxes
> >> (redhat 7.3 specifically).
>
> > Well - I think this is really a redhat problem. I believe I even saw
> > something reporting it as a security problem - it is very easy for someone
> > to deprive an rh box of available semaphores. I wonder what the default is
> > on rh 8 and 9 (anyone?).
>
> >> As this will likely trip up new sysadmins that just want to try out the
> >> package,
>
> > It probably will :-(
> > But that's why there is a "Hint" in the error log for Linux users.
>
> >> is there a way to reduce the number of sessions (or space for
> >> these sessions) by using a directive?
>
> > Yes, there is a way - adjust MaxClients. Some MPM's (at least worker) will
> > alter MaxClients if the other directives do not add up to or exceed it, so
> > it's possible other values may need adjusting.
>
> > BTW, mod_python does NOT quit if it was able to allocate *some* locks, but
> > not *all*, it only writes a warning to the error log and proceeds. But
> > what craps out after that is mod_rewrite, which wants a global lock, but
> > mod_python has eaten them all. So perhaps I can adjust it so that if we
> > allocated *some* but not *all*, then to free one (or two?)  so that
> > mod_rewrite is happy.
>
> > (On the other hand doing this may seem like going too far to adress what
> > is really a lousy config default in the kernel....)
>
> > Grisha
>
>
> ---
> Neo Eureka / mailto:neo@https.ru
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From grickert at coldstorage.com  Mon Sep  8 17:18:13 2003
From: grickert at coldstorage.com (Gerrat Rickert)
Date: Fri Jan  9 21:47:43 2004
Subject: [mod_python] 
Message-ID: <DIEMKLHLKFCCPAEPDMHKIEFECEAA.grickert@coldstorage.com>



Gerrat Rickert
Systems Analyst
Conestoga Coldstorage


From grickert at coldstorage.com  Mon Sep  8 17:42:33 2003
From: grickert at coldstorage.com (Gerrat Rickert)
Date: Fri Jan  9 21:47:43 2004
Subject: [mod_python] 
	PythonHandler does not appear to append directory to import path
Message-ID: <DIEMKLHLKFCCPAEPDMHKCEFFCEAA.grickert@coldstorage.com>

I'm using mod_python 3.03, apache 2.047, and python 2.2.3 on a win2K machine
& am trying to use the publisher handler.  The problem is when I try to add
an additional handler via:

req.addhandler("PythonHandler", testModule, directory_to_append_to_sys_path)

The error I am getting is:

Mod_python error: "PythonHandler testModule"

Traceback (most recent call last):

  File "D:\Python22\lib\site-packages\mod_python\apache.py", line 340, in
HandlerDispatch
    module = import_module(module_name, config)

  File "D:\Python22\lib\site-packages\mod_python\apache.py", line 516, in
import_module
    f, p, d = imp.find_module(parts[i], path)

ImportError: No module named testModule



Looking through the HandlerDispatch function of apache.py, the relevant code
is:

if config.has_key("PythonPath"):
...
else:
    dir = hlist.directory
    if dir and (dir not in sys.path):
        sys.path[:0] = [dir]


This code doesn't appear to add my directory
(directory_to_append_to_sys_path) to the sys.path if I have "PythonPath" in
my httpd.conf file.  Importing my module fails because of this.  I'm not
sure if this is just a misunderstanding on my part or has already been
addressed (in which case I apologize for posting).  As far as I can see, the
"else" portion of this statement should be executed regardless of whether
PythonPath is in the config file or not.  Can anyone else confirm this?

Thanks,
Gerrat Rickert


From grisha at modpython.org  Tue Sep  9 10:41:55 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:47:43 2004
Subject: [mod_python]  PythonHandler does not appear to append directory
 to import path
In-Reply-To: <DIEMKLHLKFCCPAEPDMHKCEFFCEAA.grickert@coldstorage.com>
References: <DIEMKLHLKFCCPAEPDMHKCEFFCEAA.grickert@coldstorage.com>
Message-ID: <20030909103210.V9524@onyx.ispol.com>


Gerrat -

You're right, it doesn't add the directory to the path if PythonPath is
specified. The code that decides this has no way of knowing whether the
handler was specified via an Apache directive or req.add_handler(). It
just follows the rule that PythonPath overrides everything.

The rationale for this all-overriding behaviour of PythonPath is that you
can use it make sure that the directory where the handler is specified is
_not_ in sys.path. (Otherwise, if the directive directory was _always_
added, there would be no way to achieve this)

You can do two things:

1. Add directory_to_append_to_sys_path to PythonPath
2. Get rid of PythonPath. I see a lot of people using it where they really
don't need to. See if you _really_ need it.

What *I* need to do is adjust the documentation of add_handler() to
clarify that dir has no effect when PythonPath is specified.

Grisha

On Mon, 8 Sep 2003, Gerrat Rickert wrote:

> I'm using mod_python 3.03, apache 2.047, and python 2.2.3 on a win2K machine
> & am trying to use the publisher handler.  The problem is when I try to add
> an additional handler via:
>
> req.addhandler("PythonHandler", testModule, directory_to_append_to_sys_path)
>
> The error I am getting is:
>
> Mod_python error: "PythonHandler testModule"
>
> Traceback (most recent call last):
>
>   File "D:\Python22\lib\site-packages\mod_python\apache.py", line 340, in
> HandlerDispatch
>     module = import_module(module_name, config)
>
>   File "D:\Python22\lib\site-packages\mod_python\apache.py", line 516, in
> import_module
>     f, p, d = imp.find_module(parts[i], path)
>
> ImportError: No module named testModule
>
>
>
> Looking through the HandlerDispatch function of apache.py, the relevant code
> is:
>
> if config.has_key("PythonPath"):
> ...
> else:
>     dir = hlist.directory
>     if dir and (dir not in sys.path):
>         sys.path[:0] = [dir]
>
>
> This code doesn't appear to add my directory
> (directory_to_append_to_sys_path) to the sys.path if I have "PythonPath" in
> my httpd.conf file.  Importing my module fails because of this.  I'm not
> sure if this is just a misunderstanding on my part or has already been
> addressed (in which case I apologize for posting).  As far as I can see, the
> "else" portion of this statement should be executed regardless of whether
> PythonPath is in the config file or not.  Can anyone else confirm this?
>
> Thanks,
> Gerrat Rickert
>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From grickert at coldstorage.com  Tue Sep  9 11:43:15 2003
From: grickert at coldstorage.com (Gerrat Rickert)
Date: Fri Jan  9 21:47:43 2004
Subject: [mod_python]  PythonHandler does not appear to append directory
 to import path
Message-ID: <DIEMKLHLKFCCPAEPDMHKIEFHCEAA.grickert@coldstorage.com>

Grisha -

Thanks for your response - much appreciated.  I'm probably using PythonPath
where I don't need to.  I have some modules I'd like to share between
several web apps & I can just add their path to my PYTHONPATH environment
variable & remove the PythonPath directive.

Gerrat


From llsousa at ualg.pt  Tue Sep  9 17:19:00 2003
From: llsousa at ualg.pt (Luis Sousa)
Date: Fri Jan  9 21:47:43 2004
Subject: [mod_python] Handler publisher with multiple directories on
	thesame tree
In-Reply-To: <01c3760e$c26c4100$926a1e6e@wsasd464>
References: <01c3760e$c26c4100$926a1e6e@wsasd464>
Message-ID: <3F5DFD74.3030100@ualg.pt>

Skipped content of type multipart/alternative-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/x-pkcs7-signature
Size: 3627 bytes
Desc: S/MIME Cryptographic Signature
Url : http://mailman.modpython.org/pipermail/mod_python/attachments/20030909/bdba7319/smime.bin
From davidf at sjsoft.com  Tue Sep  9 18:56:34 2003
From: davidf at sjsoft.com (David Fraser)
Date: Fri Jan  9 21:47:43 2004
Subject: [mod_python]  PythonHandler does not appear to append directory
 to import path
In-Reply-To: <DIEMKLHLKFCCPAEPDMHKIEFHCEAA.grickert@coldstorage.com>
References: <DIEMKLHLKFCCPAEPDMHKIEFHCEAA.grickert@coldstorage.com>
Message-ID: <3F5E0642.9090702@sjsoft.com>

Gerrat Rickert wrote:

>Grisha -
>
>Thanks for your response - much appreciated.  I'm probably using PythonPath
>where I don't need to.  I have some modules I'd like to share between
>several web apps & I can just add their path to my PYTHONPATH environment
>variable & remove the PythonPath directive.
>
>Gerrat
>  
>
It might be helpful to look at putting these shared modules in a package 
that is either located under site-packages, or where the location is put 
in a .pth file under site-packages. Then you don't need to adjust any 
path things at all

David

From neel at mediapulse.com  Tue Sep  9 17:26:23 2003
From: neel at mediapulse.com (Michael C. Neel)
Date: Fri Jan  9 21:47:43 2004
Subject: [mod_python] Using dbpool in more than one place....
Message-ID: <C0FC22C08B82074A88B50061764157775CCB@johnson.mediapulse.net>

I'm currently trying to migrate an apache 1.3 / mod_python 2.7.8 site to
apache 2.x and mod_python 3.x.

I currently load two different mod_python modules for the site, one to
log hits to a database, the other to run site site pages.  I'm using
worker threads on apache, and trying to use dbpool to work around
MySQLdb's threading level 1.

The logging module connects to a remote 3.23.x Mysql box; the site
module connects to a local MySQL 4.x database.  If I disable one module,
the other (using dbpool) will run fine; it's when I try to run both I
get problems.  When I "import jon.dbpool as dbpool" on both, I get the
following errors in the global apache log:

Exception exceptions.RuntimeError: 'maximum recursion depth exceeded' in
<function _connection_notinuse at 0x41afbaac> ignored
Exception exceptions.TypeError: 'weak object has gone away' in <function
_connection_notinuse at 0x41afbaac> ignored

When I "import jon.dbpool as logger_dbpool" in the log module and
"import jon.dbpool as dbpool" in the site module I get the following
error in the sites log file:

Mod_python error: "PythonHandler www"

Traceback (most recent call last):

  File "/usr/local/lib/python2.3/site-packages/mod_python/apache.py",
line 338, in HandlerDispatch
    result = object(req)

  File "/home/sites/beta/modules/www.py", line 51, in handler
    c = db.cursor()

  File "/usr/local/lib/python2.3/site-packages/jon/dbpool.py", line 93,
in cursor
    return self._inner.cursor(*args, **kwargs)

  File "/usr/local/lib/python2.3/site-packages/jon/dbpool.py", line 129,
in cursor
    c = _Cursor(self, *args, **kwargs)

  File "/usr/local/lib/python2.3/site-packages/jon/dbpool.py", line 140,
in __init__
    self._outer = connection._outerref()

TypeError: 'NoneType' object is not callable


Is it possbile to use dbpool to connect to two different databases,
using two different mod_python modules?

Thanks,
Mike

From fumanchu at aminus.net  Tue Sep  9 16:59:06 2003
From: fumanchu at aminus.net (fumanchu)
Date: Fri Jan  9 21:47:43 2004
Subject: [mod_python] Using dbpool in more than one place....
In-Reply-To: <DE1CF2B4FEC4A342BF62B6B2B334601E43651A@opus.HQAMOR.amorhq.net>
Message-ID: <DE1CF2B4FEC4A342BF62B6B2B334601E42D20E@opus.HQAMOR.amorhq.net>

Quick response: the message:

Exception exceptions.RuntimeError: 'maximum recursion depth exceeded' in
<function _connection_notinuse at 0x41afbaac> ignored

is most likely due a namespace collision, where you think you're calling
one function and you're really calling another with the same name,
(usually the current function, although parallel recursion has been
known to occur). When using "as", try using unique new names, not
fragments of existing names. So try:

"import jon.dbpool as logger_dbpool" in the log module and
"import jon.dbpool as site_dbpool" in the site module.

Just a thought.


Robert Brewer
fumanchu@aminus.net

From mike.looijmans at asml.com  Wed Sep 10 07:15:45 2003
From: mike.looijmans at asml.com (Mike Looijmans)
Date: Fri Jan  9 21:47:43 2004
Subject: [mod_python] Handler publisher with multiple directories
	onthesame tree
Message-ID: <01c3775a$965dd680$926a1e6e@wsasd464>

>>My main handler checks if the path_info of the URL is "/request" and if 
>
>How do you check this ?


Uh, basically:

if req.path_info == '/reload':
    return reloadModules(req)

:-)



-- 
The information contained in this communication and any attachments is confidential and may be privileged, and is for the sole use of the intended recipient(s). Any unauthorized review, use, disclosure or distribution is prohibited. If you are not the intended recipient, please notify the sender immediately by replying to this message and destroy all copies of this message and any attachments. ASML is neither liable for the proper and complete transmission of the information contained in this communication, nor for any delay in its receipt.


From gdamjan at mail.net.mk  Wed Sep 10 15:55:38 2003
From: gdamjan at mail.net.mk (Damjan)
Date: Fri Jan  9 21:47:43 2004
Subject: [mod_python] ANNOUNCE: Mod_python 3.1.0 Alpha
In-Reply-To: <20030907180501.B83449@onyx.ispol.com>
References: <20030828210644.C43921@onyx.ispol.com>
	<1062188981.14514.296.camel@heppc22> <1062903891.2713.33.camel@Presario>
	<20030907180501.B83449@onyx.ispol.com>
Message-ID: <20030910135538.GC3575@legolas.on.net.mk>

> > This prompts a change in the kernel semaphore settings on older linuxes
> > (redhat 7.3 specifically).
> 
> Well - I think this is really a redhat problem. I believe I even saw
> something reporting it as a security problem - it is very easy for someone
> to deprive an rh box of available semaphores. I wonder what the default is
> on rh 8 and 9 (anyone?).

Well I have Slackware-9+, and the defaults are not changed from the
kernel defaults:
    damjan$ cat /proc/sys/kernel/sem
    250     32000   32      128

I'm using 
    echo "512     32000   32      512" > /proc/sys/kernel/sem
right now.


-- 
Damjan Georgievski
jabberID: damjan@bagra.net.mk
From pu at vo.lu  Thu Sep 11 23:41:22 2003
From: pu at vo.lu (Patrick Useldinger)
Date: Fri Jan  9 21:47:43 2004
Subject: [mod_python] mod_python 3.1
Message-ID: <oprvcui8zixiz7y9@smtp.vo.lu>

I have read in the mailing list archives that only mod_python 3.1 and 
higher will work with Python 2.3. Is this still correct? If so, when is 
version 3.1 sheduled?
-pu
From barry at python.org  Thu Sep 11 18:20:54 2003
From: barry at python.org (Barry Warsaw)
Date: Fri Jan  9 21:47:43 2004
Subject: [mod_python] mod_python 3.1
In-Reply-To: <oprvcui8zixiz7y9@smtp.vo.lu>
References: <oprvcui8zixiz7y9@smtp.vo.lu>
Message-ID: <1063318854.19907.15.camel@anthem>

On Thu, 2003-09-11 at 17:41, Patrick Useldinger wrote:
> I have read in the mailing list archives that only mod_python 3.1 and 
> higher will work with Python 2.3. Is this still correct? If so, when is 
> version 3.1 sheduled?

modpython 3.0.3 works fine with Python 2.3, but to build it you need to
hack src/include/mod_python.h.  There's a FAQ entry with the necessary
patch.

Maybe Grisha should release a 3.0.4 with just this one patch?

-Barry


From pu at vo.lu  Fri Sep 12 00:31:34 2003
From: pu at vo.lu (Patrick Useldinger)
Date: Fri Jan  9 21:47:43 2004
Subject: [mod_python] mod_python 3.1
In-Reply-To: <1063318854.19907.15.camel@anthem>
References: <oprvcui8zixiz7y9@smtp.vo.lu> <1063318854.19907.15.camel@anthem>
Message-ID: <oprvcwuwc2xiz7y9@smtp.vo.lu>

On 11 Sep 2003 18:20:54 -0400, Barry Warsaw <barry@python.org> wrote:

> modpython 3.0.3 works fine with Python 2.3, but to build it you need to
> hack src/include/mod_python.h.  There's a FAQ entry with the necessary
> patch.
>
> Maybe Grisha should release a 3.0.4 with just this one patch?

I have used the Windows binary version, as I have no C compiler. Releasing 
a binary version for Windows with this one change whould be great.
-PU
From barry at python.org  Thu Sep 11 19:41:19 2003
From: barry at python.org (Barry Warsaw)
Date: Fri Jan  9 21:47:43 2004
Subject: [mod_python] mod_python 3.1
In-Reply-To: <oprvcwuwc2xiz7y9@smtp.vo.lu>
References: <oprvcui8zixiz7y9@smtp.vo.lu> <1063318854.19907.15.camel@anthem>
	 <oprvcwuwc2xiz7y9@smtp.vo.lu>
Message-ID: <1063323679.19907.21.camel@anthem>

On Thu, 2003-09-11 at 18:31, Patrick Useldinger wrote:

> I have used the Windows binary version, as I have no C compiler. Releasing 
> a binary version for Windows with this one change whould be great.

I don't know anything about the Windows version, but AFAIK the only
problem with 3.0.3 and Python 2.3 is the definition of LONG_LONG that
got changed and that should only affect source builds.

-Barry


From grisha at modpython.org  Thu Sep 11 22:54:19 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:47:43 2004
Subject: [mod_python] mod_python 3.1
In-Reply-To: <1063318854.19907.15.camel@anthem>
References: <oprvcui8zixiz7y9@smtp.vo.lu> <1063318854.19907.15.camel@anthem>
Message-ID: <20030911224336.A81795@onyx.ispol.com>


On Thu, 11 Sep 2003, Barry Warsaw wrote:

> On Thu, 2003-09-11 at 17:41, Patrick Useldinger wrote:
> > I have read in the mailing list archives that only mod_python 3.1 and
> > higher will work with Python 2.3. Is this still correct? If so, when is
> > version 3.1 sheduled?
>
> modpython 3.0.3 works fine with Python 2.3, but to build it you need to
> hack src/include/mod_python.h.  There's a FAQ entry with the necessary
> patch.
>
> Maybe Grisha should release a 3.0.4 with just this one patch?

I'm not so sure that there aren't other bugs hiding in there.

Originally I wasn't planning on a 3.0.4 because 3.1 is going to be out
some time soon (whatever that means - we don't really have a schedule).
But we'll think about it. :-)

For right now my "official" take is that mod_python 3.0.3 was released
prior to Python 2.3 and so wasn't meant to be used with it.

Grisha
From partha at addlebrain.com  Thu Sep 11 21:11:27 2003
From: partha at addlebrain.com (Partha Aji)
Date: Fri Jan  9 21:47:43 2004
Subject: [mod_python] Can't load mod_python 3.03 in XP
Message-ID: <20030912041127.A4E1F3CEB@sitemail.everyone.net>

Here is  my configuration

Apache HTTP 2.0.47 - g:\apache\Apache2\
OS -> Win XP Home edition

Python Version ->2.3
TCL Version - > 8.4
Mod Python Version -> 3.0.3
Mod python installation file-> mod_python-3.0.3.win32.exe

I added the following line to httpd.conf 
LoadModule python_module modules/mod_python.so

(I have not been able to run the test yet..)

When I start apache I get the following error message
"
Syntax error on line 139 of G:/apache/Apache2/conf/httpd.conf:
Cannot load G:/apache/Apache2/modules/mod_python.so into server: The specified module could not be found.
Note the errors or messages above, and press the <ESC> key to exit.  25...
"

But when I take a peak at G:/apache/Apache2/modules/  directory I see the mod python file right there any ideas? Is mod python expected to run with python 2.3?
Should I compile mod python manually to fix this (I would rather not do so because I wouldn't know how to do it)? 
Any suggestions will be welcome.. Thanks

Partha


From benjamin-hepp at t-online.de  Fri Sep 12 08:28:38 2003
From: benjamin-hepp at t-online.de (Benjamin)
Date: Fri Jan  9 21:47:43 2004
Subject: [mod_python] Can't load mod_python 3.03 in XP
In-Reply-To: <20030912041127.A4E1F3CEB@sitemail.everyone.net>
Message-ID: <000201c378f7$1a0a3e40$0200a8c0@hebben>


> When I start apache I get the following error message
> "
> Syntax error on line 139 of G:/apache/Apache2/conf/httpd.conf:
> Cannot load G:/apache/Apache2/modules/mod_python.so into server:
> The specified module could not be found.
> Note the errors or messages above, and press the <ESC> key to exit.
25...
> "

As said before mod_python must be patched to work with python 2.3.
Or you just use python 2.2.

Benjamin

From andymorritt at rogers.com  Sat Sep 13 11:08:41 2003
From: andymorritt at rogers.com (Andrew)
Date: Fri Jan  9 21:47:43 2004
Subject: [mod_python] Mod Python 3 Error on Adding into Apache.
Message-ID: <3F6332F9.5050107@rogers.com>

I added mod Python into Apache 2 on Win2k with this line:

LoadModule python_module modules/mod_python.so

And when I try to restart the server it displays:

Syntax error on line 973 of D:/Program Files/Apache 
Group/Apache2/conf/httpd.con
f:
Cannot load D:/Program Files/Apache Group/Apache2/modules/mod_python.so 
into ser
ver: The specified module could not be found.

THe Wierd thing is, When I go to D:/Program Files/Apache 
Group/Apache2/modules/ in WIndows Explorer, I SEE the file mod_python.so.

And when I type into the Address bar D:/Program Files/Apache 
Group/Apache2/modules/mod_python.so, The File download comes up.

Also, I have Perl installed with LoadModule perl_module 
modules/mod_perl.so, so LoadMod. Works.

I googled the Archives for this, but could find nothing.

THanks in Advance
Andrew.

From stian at soiland.no  Sun Sep 14 23:56:03 2003
From: stian at soiland.no (Stian =?iso-8859-1?Q?S=F8iland?=)
Date: Fri Jan  9 21:47:43 2004
Subject: [mod_python] 
	Re: Handler publisher with multiple directories on the same tree
In-Reply-To: <3F5C826A.80404@ualg.pt>
References: <01c375fd$51705d80$926a1e6e@wsasd464> <3F5C826A.80404@ualg.pt>
Message-ID: <20030914215603.GD32114@itea.ntnu.no>

On 2003-09-08 15:21:46, Luis Sousa wrote:

> When I'm developing I usually have a common problem that is when I 
> change a class or some file, sometimes the interpreter remains in memory 
> the old version and doesn't load the new one. Is there a way to solve 
> this out ? Normally I use an non elegant way, I restart apache!

We all do the restart dance.. I even set up a port (1337) that restarted
apache on connections to it. 


-- 
Stian S?iland               Work toward win-win situation. Win-lose
Trondheim, Norway           is where you win and the other lose.
http://www.soiland.no/      Lose-lose and lose-win are left as an
                            exercise to the reader.  [Limoncelli/Hogan]

From stian at soiland.no  Sun Sep 14 23:58:27 2003
From: stian at soiland.no (Stian =?iso-8859-1?Q?S=F8iland?=)
Date: Fri Jan  9 21:47:43 2004
Subject: [mod_python] 
	Re: Handler publisher with multiple directories on 	thesame tree
In-Reply-To: <01c3760e$c26c4100$926a1e6e@wsasd464>
References: <01c3760e$c26c4100$926a1e6e@wsasd464>
Message-ID: <20030914215827.GE32114@itea.ntnu.no>

On 2003-09-08 15:40:26, Mike Looijmans wrote:

> My main handler checks if the path_info of the URL is "/request" and if so,
> runs the following (you could use publisher to publish this interface as
> well). All "my" modules are named "ops_" something. You could also use
> the __file__ location as a filter.

I tried that approach, but the problem is that modules must be reloaded
in "correct" order. For instance, a class in module A that subclasses
something from module B, will not work if A is reloaded before B.

(the A-class will be an instance of the OLD b-class)

The only thing that could work is to del the modules from sys.modules.
However, when I tried that, weird errors occured as if half the
mod_python request, sys, site, os etc. were removed.

Clearly some dirty C-pointer hangarounds or something..

-- 
Stian S?iland               Work toward win-win situation. Win-lose
Trondheim, Norway           is where you win and the other lose.
http://www.soiland.no/      Lose-lose and lose-win are left as an
                            exercise to the reader.  [Limoncelli/Hogan]

From grisha at modpython.org  Mon Sep 15 10:32:10 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:47:43 2004
Subject: [mod_python] Mod Python 3 Error on Adding into Apache.
In-Reply-To: <3F6332F9.5050107@rogers.com>
References: <3F6332F9.5050107@rogers.com>
Message-ID: <20030915102842.X28769@onyx.ispol.com>


This is typically a mismatch of mod_python.so and the version of Python
you have on your system.  For some reason windows says "module cannot be
found" whereas it really means "i had problems loading it".

The mod_python binary available from Apache sites should be compatible
with Python 2.2.x, but not 2.3.

Grisha

On Sat, 13 Sep 2003, Andrew wrote:

> I added mod Python into Apache 2 on Win2k with this line:
>
> LoadModule python_module modules/mod_python.so
>
> And when I try to restart the server it displays:
>
> Syntax error on line 973 of D:/Program Files/Apache
> Group/Apache2/conf/httpd.con
> f:
> Cannot load D:/Program Files/Apache Group/Apache2/modules/mod_python.so
> into ser
> ver: The specified module could not be found.
>
> THe Wierd thing is, When I go to D:/Program Files/Apache
> Group/Apache2/modules/ in WIndows Explorer, I SEE the file mod_python.so.
>
> And when I type into the Address bar D:/Program Files/Apache
> Group/Apache2/modules/mod_python.so, The File download comes up.
>
> Also, I have Perl installed with LoadModule perl_module
> modules/mod_perl.so, so LoadMod. Works.
>
> I googled the Archives for this, but could find nothing.
>
> THanks in Advance
> Andrew.
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From conrad at hep.caltech.edu  Tue Sep 16 19:31:24 2003
From: conrad at hep.caltech.edu (Conrad Steenberg)
Date: Fri Jan  9 21:47:43 2004
Subject: [mod_python] ANNOUNCE: Mod_python 3.1.0 Alpha
In-Reply-To: <20030910135538.GC3575@legolas.on.net.mk>
References: <20030828210644.C43921@onyx.ispol.com>
	<1062903891.2713.33.camel@Presario>
	<20030907180501.B83449@onyx.ispol.com>
	<20030910135538.GC3575@legolas.on.net.mk>
Message-ID: <1063733483.28941.53.camel@Presario>

Hi

Just to add a data point to the discussion: on redhat-7.3 the server
crashes if it cannot allocate enough semaphores. This is with
apache-2.0.47. And no, I can't change that because I'm not root on the
box :-(

Cheers

Conrad

On Wed, 2003-09-10 at 15:55, Damjan wrote:
> > > This prompts a change in the kernel semaphore settings on older linuxes
> > > (redhat 7.3 specifically).
> > 
> > Well - I think this is really a redhat problem. I believe I even saw
> > something reporting it as a security problem - it is very easy for someone
> > to deprive an rh box of available semaphores. I wonder what the default is
> > on rh 8 and 9 (anyone?).
> 
> Well I have Slackware-9+, and the defaults are not changed from the
> kernel defaults:
>     damjan$ cat /proc/sys/kernel/sem
>     250     32000   32      128
> 
> I'm using 
>     echo "512     32000   32      512" > /proc/sys/kernel/sem
> right now.
-- 
Conrad Steenberg <conrad@hep.caltech.edu>
-- 
Conrad Steenberg <conrad@hep.caltech.edu>
From greenbeard400 at yahoo.com  Wed Sep 17 21:42:47 2003
From: greenbeard400 at yahoo.com (Greenbeard)
Date: Fri Jan  9 21:47:43 2004
Subject: [mod_python] File upload
Message-ID: <20030918044247.89511.qmail@web21304.mail.yahoo.com>

Does anyone have a good file upload example?  

When I try something like: 

def upload(req, file):
    tempFile = file.read()
 
I get: AttributeError: File instance has no attribute
'read'

if I use:

    tempFile = req.form['file'] 
I get the file contents but I don't think this would
work well with large files (or would it?) 

Also, 
 
when I try to get attribues like file.type I get 

AttributeError: File instance has no attribute 'type'.
I do get the file.filename.   

So how can I tell if it should be a binary write etc.?

It looks like the publisher handler (which I am using)
returns a File object but I can not get it to act like
a file/StringIO object nor can I accesss the
attributes that are mentioned in the documentation.   


I am using W2k, Python 2.2  and Mod_py 3.0.3.  

Thanks for the help,

gb400



__________________________________
Do you Yahoo!?
Yahoo! SiteBuilder - Free, easy-to-use web site design software
http://sitebuilder.yahoo.com
From davidf at sjsoft.com  Thu Sep 18 09:47:24 2003
From: davidf at sjsoft.com (David Fraser)
Date: Fri Jan  9 21:47:43 2004
Subject: [mod_python] File upload
In-Reply-To: <20030918044247.89511.qmail@web21304.mail.yahoo.com>
References: <20030918044247.89511.qmail@web21304.mail.yahoo.com>
Message-ID: <3F69630C.2090403@sjsoft.com>

Greenbeard wrote:

>Does anyone have a good file upload example?  
>
>When I try something like: 
>
>def upload(req, file):
>    tempFile = file.read()
> 
>I get: AttributeError: File instance has no attribute
>'read'
>
>if I use:
>
>    tempFile = req.form['file'] 
>I get the file contents but I don't think this would
>work well with large files (or would it?) 
>
>Also, 
> 
>when I try to get attribues like file.type I get 
>
>AttributeError: File instance has no attribute 'type'.
>I do get the file.filename.   
>
>So how can I tell if it should be a binary write etc.?
>
>It looks like the publisher handler (which I am using)
>returns a File object but I can not get it to act like
>a file/StringIO object nor can I accesss the
>attributes that are mentioned in the documentation.   
>
>
>I am using W2k, Python 2.2  and Mod_py 3.0.3.  
>
>Thanks for the help,
>
>gb400
>
>
>
>__________________________________
>Do you Yahoo!?
>Yahoo! SiteBuilder - Free, easy-to-use web site design software
>http://sitebuilder.yahoo.com
>_______________________________________________
>Mod_python mailing list
>Mod_python@modpython.org
>http://mailman.modpython.org/mailman/listinfo/mod_python
>
>  
>
Don't know much about publisher, but a normal mod_python handler should 
be able to do something like this (totally untested code):

def handle(req):
  argdict = util.FieldStorage(req)
  for key in argdict.keys():
    value = argdict[key]
    if type(value) == types.InstanceType:
      if isinstance(value, util.StringField):
        # this is for a normal field...
        pass
      elif isinstance(value, util.Field):
        # this is for an attachment upload...
        filename = field.filename
        content_type = field.type
        # this will work by doing a read...
        contents = field.value
        # or you can do the read yourself:
        field.file.seek(0)
        contents = field.file.read()
        # reset the position so others can read it
        field.file.seek(0)



From mgomez at aditel.org  Thu Sep 18 10:04:57 2003
From: mgomez at aditel.org (Maria Gomez)
Date: Fri Jan  9 21:47:43 2004
Subject: [mod_python] File upload
In-Reply-To: <20030918044247.89511.qmail@web21304.mail.yahoo.com>
References: <20030918044247.89511.qmail@web21304.mail.yahoo.com>
Message-ID: <20030918080457.GA30620@aditel.org>

On Wed, Sep 17, 2003 at 09:42:47PM -0700, Greenbeard wrote:
> Does anyone have a good file upload example?  
> 
> When I try something like: 
> 
> def upload(req, file):
>     tempFile = file.read()
>  

   Hi,

   I use to do it as follows:

def CheckingUploadedFile(incoming):
    if incoming is None:
        return 0     # File is empty
    if type(incoming) is str:
        return 0     # File is a string
    return 1

def PrepareFile(file):
    """
        Copies uploaded file in a local directory (CACHE_DIR) and names
		it with its md5, whish is almost unique
    """
    aux = file.read()
    md5_n = "name_of_file"
    cache_file = "%s%s" % (cache_dir , md5_n)
    cache_fd = open(cache_file,'w')
    cache_fd.write(aux)
    cache_fd.close()
    return 1

def Upload(req,incoming):
    if CheckingUploadedFile(incoming):
        #Save file(incoming.file) in the proper directory
        PrepareFile(incoming.file)
		return 1
	else:
		print "There was an uploading error"


   To know more the updated structure of the file is:
['__del__', '__doc__', '__getattr__', '__init__', '__module__',
'__repr__', 'disposition', 'disposition_options', 'file', 'filename',
'headers', 'name', 'type', 'type_options']


    Cheers,

-- 
   Maria Gomez Marti - [octal]

=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*
   http://www.aditel.org/~mgomez
=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=* Linux, porque yo lo valgo 
From is83070 at cis.nctu.edu.tw  Thu Sep 18 17:21:01 2003
From: is83070 at cis.nctu.edu.tw (camge)
Date: Fri Jan  9 21:47:43 2004
Subject: [mod_python] [help]please give an input filter example ?
Message-ID: <007c01c37dc6$32d21050$db64a8c0@camgelo>

Hi ,

    I have written an output filter, and it works fine.
But I dont know how to write an input filter, there are not any examples.
I have tried to write an simple input filter according to an output filter.
But it always makes IE hang there.
If any one can give me an example about input filter?
Thanks a lot!

My environment:
  Apache/2.0.44 (Win32) 
  mod_ssl/2.0.44  
  OpenSSL/0.9.7 
  mod_python/3.0.3 
  Python/2.2.2 

Best regards,
camge
From is83070 at cis.nctu.edu.tw  Thu Sep 18 18:36:25 2003
From: is83070 at cis.nctu.edu.tw (camge)
Date: Fri Jan  9 21:47:43 2004
Subject: [mod_python] [help]please give an input filter example ?
References: <007c01c37dc6$32d21050$db64a8c0@camgelo>
	<3F69851B.3080703@sjsoft.com>
Message-ID: <009d01c37dd0$bc2c5f40$db64a8c0@camgelo>

Below is my simple input filter inputFilter.py:
-------------------------------------------------------------
def inputfilter(filter):
    f=open('filter.log','ab')#for debug
    data='start'
    while data!=None:
        try:
            data = filter.read()
            if data:
                filter.write(data)
                f.write(str(data))
        except Exception,e:
                f.write(str(e))
                data=None
     if data==None:
        filter.close()
     f.close()
----------------------------------------
httpd.conf:
----------------------------------------
<Location /test/>
     PythonInputFilter inputFilter MyInputFilter
     SetInputFilter MyInputFilter
</Location>


----- Original Message ----- 
From: "David Fraser" <davidf@sjsoft.com>
To: "camge" <is83070@cis.nctu.edu.tw>
Sent: Thursday, September 18, 2003 6:12 PM
Subject: Re: [mod_python] [help]please give an input filter example ?


> >camge wrote:
> >
> >Hi ,
> >
> >    I have written an output filter, and it works fine.
> >But I dont know how to write an input filter, there are not any examples.
> >I have tried to write an simple input filter according to an output
filter.
> >But it always makes IE hang there.
> >If any one can give me an example about input filter?
> >Thanks a lot!
> >
> >My environment:
> >  Apache/2.0.44 (Win32)
> >  mod_ssl/2.0.44
> >  OpenSSL/0.9.7
> >  mod_python/3.0.3
> >  Python/2.2.2
> >
> >Best regards,
> >camge
> >
> Why don't you send your example input filter that makes IE hang?
>
> Thanks
> David
>
>

From davidf at sjsoft.com  Thu Sep 18 13:05:19 2003
From: davidf at sjsoft.com (David Fraser)
Date: Fri Jan  9 21:47:43 2004
Subject: [mod_python] [help]please give an input filter example ?
In-Reply-To: <009d01c37dd0$bc2c5f40$db64a8c0@camgelo>
References: <007c01c37dc6$32d21050$db64a8c0@camgelo>
	<3F69851B.3080703@sjsoft.com> <009d01c37dd0$bc2c5f40$db64a8c0@camgelo>
Message-ID: <3F69916F.10406@sjsoft.com>

camge wrote:

>----- Original Message ----- 
>From: "David Fraser" <davidf@sjsoft.com>
>To: "camge" <is83070@cis.nctu.edu.tw>
>Sent: Thursday, September 18, 2003 6:12 PM
>Subject: Re: [mod_python] [help]please give an input filter example ?
>
>
>  
>
>>>camge wrote:
>>>
>>>Hi ,
>>>
>>>   I have written an output filter, and it works fine.
>>>But I dont know how to write an input filter, there are not any examples.
>>>I have tried to write an simple input filter according to an output
>>>      
>>>
>filter.
>  
>
>>>But it always makes IE hang there.
>>>If any one can give me an example about input filter?
>>>Thanks a lot!
>>>
>>>My environment:
>>> Apache/2.0.44 (Win32)
>>> mod_ssl/2.0.44
>>> OpenSSL/0.9.7
>>> mod_python/3.0.3
>>> Python/2.2.2
>>>
>>>Best regards,
>>>camge
>>>
>>>      
>>>
>>Why don't you send your example input filter that makes IE hang?
>>
>>Thanks
>>David
>>
>>
>>    
>>
>
>Below is my simple input filter inputFilter.py:
>-------------------------------------------------------------
>def inputfilter(filter):
>    f=open('filter.log','ab')#for debug
>    data='start'
>    while data!=None:
>        try:
>            data = filter.read()
>            if data:
>                filter.write(data)
>                f.write(str(data))
>        except Exception,e:
>                f.write(str(e))
>                data=None
>     if data==None:
>        filter.close()
>     f.close()
>----------------------------------------
>httpd.conf:
>----------------------------------------
><Location /test/>
>     PythonInputFilter inputFilter MyInputFilter
>     SetInputFilter MyInputFilter
></Location>
>
>
>  
>
Excuse me rearranging your post, bottom posting makes discussion easier...

I think the problem here is that you're doing filter.read() which will 
read until an end of file, which will never happen on an input filter.
You probably need a more intelligent way of working out when to stop 
reading, e.g. for HTTP, you could read a line at a time.
What are you wanting to use the input filter for?

David


From is83070 at cis.nctu.edu.tw  Thu Sep 18 21:32:47 2003
From: is83070 at cis.nctu.edu.tw (camge)
Date: Fri Jan  9 21:47:44 2004
Subject: [mod_python] [help]please give an input filter example ?
References: <007c01c37dc6$32d21050$db64a8c0@camgelo>
	<3F69851B.3080703@sjsoft.com> <009d01c37dd0$bc2c5f40$db64a8c0@camgelo>
	<3F69916F.10406@sjsoft.com>
Message-ID: <000e01c37de9$60cfd0f0$db64a8c0@camgelo>


----- Original Message ----- 
From: "David Fraser" <davidf@sjsoft.com>
To: "camge" <is83070@cis.nctu.edu.tw>
Cc: <mod_python@modpython.org>
Sent: Thursday, September 18, 2003 7:05 PM
Subject: Re: [mod_python] [help]please give an input filter example ?


> camge wrote:
>
> >----- Original Message ----- 
> >From: "David Fraser" <davidf@sjsoft.com>
> >To: "camge" <is83070@cis.nctu.edu.tw>
> >Sent: Thursday, September 18, 2003 6:12 PM
> >Subject: Re: [mod_python] [help]please give an input filter example ?
> >
> >
> >
> >
> >>>camge wrote:
> >>>
> >>>Hi ,
> >>>
> >>>   I have written an output filter, and it works fine.
> >>>But I dont know how to write an input filter, there are not any
examples.
> >>>I have tried to write an simple input filter according to an output
> >>>
> >>>
> >filter.
> >
> >
> >>>But it always makes IE hang there.
> >>>If any one can give me an example about input filter?
> >>>Thanks a lot!
> >>>
> >>>My environment:
> >>> Apache/2.0.44 (Win32)
> >>> mod_ssl/2.0.44
> >>> OpenSSL/0.9.7
> >>> mod_python/3.0.3
> >>> Python/2.2.2
> >>>
> >>>Best regards,
> >>>camge
> >>>
> >>>
> >>>
> >>Why don't you send your example input filter that makes IE hang?
> >>
> >>Thanks
> >>David
> >>
> >>
> >>
> >>
> >
> >Below is my simple input filter inputFilter.py:
> >-------------------------------------------------------------
> >def inputfilter(filter):
> >    f=open('filter.log','ab')#for debug
> >    data='start'
> >    while data!=None:
> >        try:
> >            data = filter.read()
> >            if data:
> >                filter.write(data)
> >                f.write(str(data))
> >        except Exception,e:
> >                f.write(str(e))
> >                data=None
> >     if data==None:
> >        filter.close()
> >     f.close()
> >----------------------------------------
> >httpd.conf:
> >----------------------------------------
> ><Location /test/>
> >     PythonInputFilter inputFilter MyInputFilter
> >     SetInputFilter MyInputFilter
> ></Location>
> >
> >
> >
> >
> Excuse me rearranging your post, bottom posting makes discussion easier...
>
> I think the problem here is that you're doing filter.read() which will
> read until an end of file, which will never happen on an input filter.
> You probably need a more intelligent way of working out when to stop
> reading, e.g. for HTTP, you could read a line at a time.
> What are you wanting to use the input filter for?
>
> David
>
>
>
Thanks for your fast response!
I have tried filter.readline(), but it still reads nothing.
I need input filter to convert character set of form data submitted by cell
phone browser.
For example, convert utf-8 to big5 or gb.
If I can do it in input filter, then I dont need to modify all of my pages.





From alentzos at cosmote.gr  Thu Sep 18 16:45:10 2003
From: alentzos at cosmote.gr (Lentzos Athanassios)
Date: Fri Jan  9 21:47:44 2004
Subject: [mod_python] Load python module problem
Message-ID: <4AEFA010DC6711478C8DA31039641A990142F7B9@AHRMAIL.cosmote.gr>



Hi

I have problem to load the mod_python( ver 3.0.3)  to apache (ver 2.0.47) I have done the configuration according to the instructions but i still
get the following error when i try to start apache server  < " Cannot load c:/program files/apache/apache2/modules/mod_python.so into server:The specified
module could not be found." > ,of course the file is there. /* I have installed Python 2.3  on my PC which runs NT os */  ....Please help!!


Lentzos  .P Athanassios (Greece, Athens)
E-mail	:   alentzos@cosmote.gr


-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mailman.modpython.org/pipermail/mod_python/attachments/20030918/007ef00b/attachment.htm
From idiot1 at netzero.net  Thu Sep 18 12:11:42 2003
From: idiot1 at netzero.net (Kirk Bailey)
Date: Fri Jan  9 21:47:44 2004
Subject: [mod_python] File upload
In-Reply-To: <3F69630C.2090403@sjsoft.com>
References: <20030918044247.89511.qmail@web21304.mail.yahoo.com>
	<3F69630C.2090403@sjsoft.com>
Message-ID: <3F69D93E.8060100@netzero.net>

My wiki, wikinehesa, has a upload in it. Try downloading it, and read the form 
in the footer of the page generated by wikinehesaed1.py, and read the script 
wikinehesaed2.py to see how the thing handles doing an upload.

http://www.tinylist.org/

scan down to the OTHER STUFF section and there is the download for wikinehesa. 
To play with it, up by the top near the hit counter is a link to a working 
install of the wiki.

David Fraser wrote:

> Greenbeard wrote:
> 
>> Does anyone have a good file upload example? 
>> When I try something like:
>> def upload(req, file):
>>    tempFile = file.read()
>>
>> I get: AttributeError: File instance has no attribute
>> 'read'
>>
>> if I use:
>>
>>    tempFile = req.form['file'] I get the file contents but I don't 
>> think this would
>> work well with large files (or would it?)
>> Also,
>> when I try to get attribues like file.type I get
>> AttributeError: File instance has no attribute 'type'.
>> I do get the file.filename.  
>> So how can I tell if it should be a binary write etc.?
>>
>> It looks like the publisher handler (which I am using)
>> returns a File object but I can not get it to act like
>> a file/StringIO object nor can I accesss the
>> attributes that are mentioned in the documentation.  
>>
>> I am using W2k, Python 2.2  and Mod_py 3.0.3. 
>> Thanks for the help,
>>
>> gb400
>>
>>
>>
>> __________________________________
>> Do you Yahoo!?
>> Yahoo! SiteBuilder - Free, easy-to-use web site design software
>> http://sitebuilder.yahoo.com
>> _______________________________________________
>> Mod_python mailing list
>> Mod_python@modpython.org
>> http://mailman.modpython.org/mailman/listinfo/mod_python
>>
>>  
>>
> Don't know much about publisher, but a normal mod_python handler should 
> be able to do something like this (totally untested code):
> 
> def handle(req):
>  argdict = util.FieldStorage(req)
>  for key in argdict.keys():
>    value = argdict[key]
>    if type(value) == types.InstanceType:
>      if isinstance(value, util.StringField):
>        # this is for a normal field...
>        pass
>      elif isinstance(value, util.Field):
>        # this is for an attachment upload...
>        filename = field.filename
>        content_type = field.type
>        # this will work by doing a read...
>        contents = field.value
>        # or you can do the read yourself:
>        field.file.seek(0)
>        contents = field.file.read()
>        # reset the position so others can read it
>        field.file.seek(0)
> 
> 
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
> 
> 

-- 

-- 

end

Cheers!
         Kirk D Bailey

  +                              think                                +
   http://www.howlermonkey.net  +-----+        http://www.tinylist.org
   http://www.listville.net     | BOX |  http://www.sacredelectron.org
   Thou art free"-ERIS          +-----+     'Got a light?'-Prometheus
  +                              kniht                                +

Fnord.

From grisha at modpython.org  Thu Sep 18 11:09:25 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:47:44 2004
Subject: [mod_python] File upload
In-Reply-To: <20030918044247.89511.qmail@web21304.mail.yahoo.com>
References: <20030918044247.89511.qmail@web21304.mail.yahoo.com>
Message-ID: <20030918110558.I77494@onyx.ispol.com>


On Wed, 17 Sep 2003, Greenbeard wrote:

> Does anyone have a good file upload example?
>
> When I try something like:
>
> def upload(req, file):
>     tempFile = file.read()

I think it should be file.file.read(). You also may want to make sure that
it's a file upload first - you can do this by testing for existance of a
filename attribute, e.g. hasattr(file, "filename), or, more accurately,
you can make sure it's an instance of util.Field:

	if isinstance(file, util.Field):
		data = file.file.read()
	else:
		return "This is not a file"

Grisha
From davidf at sjsoft.com  Thu Sep 18 18:02:34 2003
From: davidf at sjsoft.com (David Fraser)
Date: Fri Jan  9 21:47:44 2004
Subject: [mod_python] [help]please give an input filter example ?
In-Reply-To: <000e01c37de9$60cfd0f0$db64a8c0@camgelo>
References: <007c01c37dc6$32d21050$db64a8c0@camgelo>
	<3F69851B.3080703@sjsoft.com> <009d01c37dd0$bc2c5f40$db64a8c0@camgelo>
	<3F69916F.10406@sjsoft.com> <000e01c37de9$60cfd0f0$db64a8c0@camgelo>
Message-ID: <3F69D71A.8080005@sjsoft.com>

camge wrote:

>----- Original Message ----- 
>From: "David Fraser" <davidf@sjsoft.com>
>To: "camge" <is83070@cis.nctu.edu.tw>
>Cc: <mod_python@modpython.org>
>Sent: Thursday, September 18, 2003 7:05 PM
>Subject: Re: [mod_python] [help]please give an input filter example ?
>
>
>  
>
>>camge wrote:
>>
>>    
>>
>>>----- Original Message ----- 
>>>From: "David Fraser" <davidf@sjsoft.com>
>>>To: "camge" <is83070@cis.nctu.edu.tw>
>>>Sent: Thursday, September 18, 2003 6:12 PM
>>>Subject: Re: [mod_python] [help]please give an input filter example ?
>>>
>>>
>>>
>>>
>>>      
>>>
>>>>>camge wrote:
>>>>>
>>>>>Hi ,
>>>>>
>>>>>  I have written an output filter, and it works fine.
>>>>>But I dont know how to write an input filter, there are not any
>>>>>          
>>>>>
>examples.
>  
>
>>>>>I have tried to write an simple input filter according to an output
>>>>>
>>>>>
>>>>>          
>>>>>
>>>filter.
>>>
>>>
>>>      
>>>
>>>>>But it always makes IE hang there.
>>>>>If any one can give me an example about input filter?
>>>>>Thanks a lot!
>>>>>
>>>>>My environment:
>>>>>Apache/2.0.44 (Win32)
>>>>>mod_ssl/2.0.44
>>>>>OpenSSL/0.9.7
>>>>>mod_python/3.0.3
>>>>>Python/2.2.2
>>>>>
>>>>>Best regards,
>>>>>camge
>>>>>
>>>>>
>>>>>
>>>>>          
>>>>>
>>>>Why don't you send your example input filter that makes IE hang?
>>>>
>>>>Thanks
>>>>David
>>>>
>>>>
>>>>
>>>>
>>>>        
>>>>
>>>Below is my simple input filter inputFilter.py:
>>>-------------------------------------------------------------
>>>def inputfilter(filter):
>>>   f=open('filter.log','ab')#for debug
>>>   data='start'
>>>   while data!=None:
>>>       try:
>>>           data = filter.read()
>>>           if data:
>>>               filter.write(data)
>>>               f.write(str(data))
>>>       except Exception,e:
>>>               f.write(str(e))
>>>               data=None
>>>    if data==None:
>>>       filter.close()
>>>    f.close()
>>>----------------------------------------
>>>httpd.conf:
>>>----------------------------------------
>>><Location /test/>
>>>    PythonInputFilter inputFilter MyInputFilter
>>>    SetInputFilter MyInputFilter
>>></Location>
>>>
>>>
>>>
>>>
>>>      
>>>
>>Excuse me rearranging your post, bottom posting makes discussion easier...
>>
>>I think the problem here is that you're doing filter.read() which will
>>read until an end of file, which will never happen on an input filter.
>>You probably need a more intelligent way of working out when to stop
>>reading, e.g. for HTTP, you could read a line at a time.
>>What are you wanting to use the input filter for?
>>
>>David
>>
>>
>>
>>    
>>
>Thanks for your fast response!
>I have tried filter.readline(), but it still reads nothing.
>  
>
That's a pleasure. OK, I don't really know anything about input filters, 
I was just pretending... maybe some else can help

>I need input filter to convert character set of form data submitted by cell
>phone browser.
>For example, convert utf-8 to big5 or gb.
>If I can do it in input filter, then I dont need to modify all of my pages.
>  
>
Aha. What I would do is just put a function in a module that changes the 
encoding.
Get the arguments like you normally would, then just do a decode/encode.
Since that module can be accessed from anywhere, it will work just as well.
Also, it's less likely to cause bugs, and will probably be faster 
(you'll only making one jump into the Python interpreter and back)

Cheers
David


From sgillies at frii.com  Thu Sep 18 12:10:07 2003
From: sgillies at frii.com (Sean Gillies)
Date: Fri Jan  9 21:47:44 2004
Subject: [mod_python] 
	UnicodeEncodeError using mod_python-3.0.3 with Python 2.3
Message-ID: <55E7BB6E-EA03-11D7-9809-000393B98B56@frii.com>

Hi,

I'm running into problems with UnicodeEncodeErrors using  
mod_python-3.0.3 with
Python 2.3 on OS X.  Yes, I know I'm asking for trouble with this  
combination,
but I'm leery of replacing Apple's Python 2.2 (which doesn't work with  
mod_python).
All in all, my application is working, but will eventually (and  
unpredictably)
stop and raise this error:

Mod_python error: "PythonHandler mod_python.publisher"

Traceback (most recent call last):

   File  
"/Library/Frameworks/Python.framework/Versions/2.3/lib/python2.3/site- 
packages/mod_python/apache.py", line 332, in HandlerDispatch
     result = object(req)

   File  
"/Library/Frameworks/Python.framework/Versions/2.3/lib/python2.3/site- 
packages/mod_python/publisher.py", line 201, in handler
     result = str(result)

UnicodeEncodeError: 'ascii' codec can't encode character '\u3137' in  
position 412: ordinal not in range(128)

Anybody else using Python 2.3 who has seen this?  I really don't  
understand the error,
it's always '\u3137', and I'm _not_ (to my knowledge) using any unicode  
strings.  I am
using Zope's Page Templates, but I don't see where the page templates  
would be introducing
'\u3137' (the hangul letter tikeut?!).

My module is published with no problems on Linux (KRUD) with  
mod_python-3.0.1 and
Python 2.2.3, so I'm presently living with this problem on my notebook  
and counting
on its absence on the server.

Sean

--
Sean Gillies
sgillies at frii dot com
http://www.frii.com/~sgillies

From perry.tew at cibavision.novartis.com  Thu Sep 18 15:50:04 2003
From: perry.tew at cibavision.novartis.com (perry.tew@cibavision.novartis.com)
Date: Fri Jan  9 21:47:44 2004
Subject: [mod_python] 
	does a mod_python handler exist to generate charts/graphs? (png
	images)
Message-ID: <OF62DF2337.F24A4A42-ON85256DA5.006CA077-85256DA5.006CF44A@EU.novartis.net>

Hello everyone,
   I was about the go down the road of developing a handler to generate 
charts,
similar to the mod_perl Apache::GD::Graph.  I wanted to make sure 
something doesn't exist
before I reinvent the wheel.  Does anyone know of such a thing yet?  If 
so, would you please
provide a url?

Thanks,
Perry Tew
From davidf at sjsoft.com  Thu Sep 18 22:25:46 2003
From: davidf at sjsoft.com (David Fraser)
Date: Fri Jan  9 21:47:44 2004
Subject: [mod_python] 	UnicodeEncodeError using mod_python-3.0.3 with
	Python 2.3
In-Reply-To: <55E7BB6E-EA03-11D7-9809-000393B98B56@frii.com>
References: <55E7BB6E-EA03-11D7-9809-000393B98B56@frii.com>
Message-ID: <3F6A14CA.9030008@sjsoft.com>

Sean Gillies wrote:

> Hi,
>
> I'm running into problems with UnicodeEncodeErrors using  
> mod_python-3.0.3 with
> Python 2.3 on OS X.  Yes, I know I'm asking for trouble with this  
> combination,
> but I'm leery of replacing Apple's Python 2.2 (which doesn't work 
> with  mod_python).
> All in all, my application is working, but will eventually (and  
> unpredictably)
> stop and raise this error:
>
> Mod_python error: "PythonHandler mod_python.publisher"
>
> Traceback (most recent call last):
>
>   File  
> "/Library/Frameworks/Python.framework/Versions/2.3/lib/python2.3/site- 
> packages/mod_python/apache.py", line 332, in HandlerDispatch
>     result = object(req)
>
>   File  
> "/Library/Frameworks/Python.framework/Versions/2.3/lib/python2.3/site- 
> packages/mod_python/publisher.py", line 201, in handler
>     result = str(result)
>
> UnicodeEncodeError: 'ascii' codec can't encode character '\u3137' in  
> position 412: ordinal not in range(128)
>
> Anybody else using Python 2.3 who has seen this?  I really don't  
> understand the error,
> it's always '\u3137', and I'm _not_ (to my knowledge) using any 
> unicode  strings.  I am
> using Zope's Page Templates, but I don't see where the page templates  
> would be introducing
> '\u3137' (the hangul letter tikeut?!).
>
> My module is published with no problems on Linux (KRUD) with  
> mod_python-3.0.1 and
> Python 2.2.3, so I'm presently living with this problem on my 
> notebook  and counting
> on its absence on the server.
>
> Sean
>
> -- 

Try doing things like:
  if type(result) == unicode:
    result = result.encode('iso8859')
You can look up different encodings in the encodings module. The above 
works well for me...
I think you should be able to get the browser's desired encodings from 
the headers sent to the request.

Hope that helps
David


From davidf at sjsoft.com  Thu Sep 18 22:27:29 2003
From: davidf at sjsoft.com (David Fraser)
Date: Fri Jan  9 21:47:44 2004
Subject: [mod_python] 	does a mod_python handler exist to generate
	charts/graphs? (png	images)
In-Reply-To: <OF62DF2337.F24A4A42-ON85256DA5.006CA077-85256DA5.006CF44A@EU.novartis.net>
References: <OF62DF2337.F24A4A42-ON85256DA5.006CA077-85256DA5.006CF44A@EU.novartis.net>
Message-ID: <3F6A1531.5050609@sjsoft.com>

perry.tew@cibavision.novartis.com wrote:

>Hello everyone,
>   I was about the go down the road of developing a handler to generate 
>charts,
>similar to the mod_perl Apache::GD::Graph.  I wanted to make sure 
>something doesn't exist
>before I reinvent the wheel.  Does anyone know of such a thing yet?  If 
>so, would you please
>provide a url?
>
>Thanks,
>Perry Tew
>
There are several Python graphing packages which you could use towards 
this end, the question is how nicely will they plug into a web environment.
I am not aware of any that are set up to do this using mod_python.
I'm also busy looking at the problem, for an application we are 
currently converting to be web based, so discuss plans / things you find 
here and I will to and hopefully we can come up with a nice solution...

Thanks,
David


From perry.tew at cibavision.novartis.com  Thu Sep 18 16:38:09 2003
From: perry.tew at cibavision.novartis.com (perry.tew@cibavision.novartis.com)
Date: Fri Jan  9 21:47:44 2004
Subject: [mod_python] 	does a mod_python handler exist to generate
	charts/graphs? (png	images)
Message-ID: <OF3D2E11CE.51A41DD0-ON85256DA5.0070BC96-85256DA5.00715B65@EU.novartis.net>

David,
  Thanks for the information.  I was looking at using pygdchart2 from 
nullcube.  I was pleased with the interface they've written.  Have you any 
experience with them?  I figured it shouldn't be technically difficult to 
create an interface of parameters that mapped to chart settings.

The only concern I have so far is the method of outputting the chart once 
rendered.  The examples use the draw method:
"""
 chart.draw(filespec)
Draw the graph to the specified file. If the filespec argument is a 
string, it will be treated as the path to a file. Otherwise, filespec is 
assumed to be a Python file object.
"""

I'm new to mod_python, so I'm not sure how to pass the output stream of 
the request object to the draw() method.  If you know, I'm be grateful. If 
not, I'll work at it.  I haven't really dug yet.

btw,   I saw your post earlier about your wiki.  While cruising your site 
I found a MLM I was in need for.  Thanks!

Perry Tew



perry.tew@cibavision.novartis.com wrote:

>Hello everyone,
>   I was about the go down the road of developing a handler to generate 
>charts,
>similar to the mod_perl Apache::GD::Graph.  I wanted to make sure 
>something doesn't exist
>before I reinvent the wheel.  Does anyone know of such a thing yet?  If 
>so, would you please
>provide a url?
>
>Thanks,
>Perry Tew
>
There are several Python graphing packages which you could use towards 
this end, the question is how nicely will they plug into a web 
environment.
I am not aware of any that are set up to do this using mod_python.
I'm also busy looking at the problem, for an application we are 
currently converting to be web based, so discuss plans / things you find 
here and I will to and hopefully we can come up with a nice solution...

Thanks,
David





From davidf at sjsoft.com  Thu Sep 18 22:45:25 2003
From: davidf at sjsoft.com (David Fraser)
Date: Fri Jan  9 21:47:44 2004
Subject: [mod_python] 	does a mod_python handler exist to generate
	charts/graphs? (png	images)
In-Reply-To: <OF3D2E11CE.51A41DD0-ON85256DA5.0070BC96-85256DA5.00715B65@EU.novartis.net>
References: <OF3D2E11CE.51A41DD0-ON85256DA5.0070BC96-85256DA5.00715B65@EU.novartis.net>
Message-ID: <3F6A1965.2040506@sjsoft.com>

perry.tew@cibavision.novartis.com wrote:

>>perry.tew@cibavision.novartis.com wrote:
>>
>>>Hello everyone,
>>>  I was about the go down the road of developing a handler to generate 
>>>charts,
>>>similar to the mod_perl Apache::GD::Graph.  I wanted to make sure 
>>>something doesn't exist
>>>before I reinvent the wheel.  Does anyone know of such a thing yet?  If 
>>>so, would you please
>>>provide a url?
>>>
>>>Thanks,
>>>Perry Tew
>>
>> There are several Python graphing packages which you could use towards
>>
>>this end, the question is how nicely will they plug into a web 
>>environment.
>>I am not aware of any that are set up to do this using mod_python.
>>I'm also busy looking at the problem, for an application we are 
>>currently converting to be web based, so discuss plans / things you find 
>>here and I will to and hopefully we can come up with a nice solution...
>>
>>Thanks,
>>David
>>
>
>David,
>  Thanks for the information.  I was looking at using pygdchart2 from 
>nullcube.  I was pleased with the interface they've written.  Have you any 
>experience with them?  I figured it shouldn't be technically difficult to 
>create an interface of parameters that mapped to chart settings.
>  
>
I haven't had, but will look at it, do you have a URL?

>The only concern I have so far is the method of outputting the chart once 
>rendered.  The examples use the draw method:
>"""
> chart.draw(filespec)
>Draw the graph to the specified file. If the filespec argument is a 
>string, it will be treated as the path to a file. Otherwise, filespec is 
>assumed to be a Python file object.
>"""
>
>I'm new to mod_python, so I'm not sure how to pass the output stream of 
>the request object to the draw() method.  If you know, I'm be grateful. If 
>not, I'll work at it.  I haven't really dug yet.
>  
>
This kind of thing is pretty simple, you can either create a 
StringIO.StringIO object (standard Python) which is a pseudo-file that 
you can get the contents out of using a string, or you could try passing 
the request object (at the appropriate time) and see if it will work 
writing to that.
Another option (assuming the project is open source) is to alter the 
program to support returning the data in a string.
I got the reportlab guys to do this - their project is mainly focussed 
on Reports and PDF, but it also has charting capabilities I haven't 
investigated.
The other charting toolkit I am aware of is Chaco.

I think it would be good to investigate all of them and at least draw up 
a list of their strengths/weaknesses for use in a web server context, 
that might be helpful to other users. Would be good to have a list of 
requirements to evaluate these packages by e.g. how big the package is, 
able to produce different image formats, etc.

>btw,   I saw your post earlier about your wiki.  While cruising your site 
>I found a MLM I was in need for.  Thanks!
>  
>
Sure, but I think it was somebody else replying to my message, I don't 
have a wiki...

>Perry Tew
>  
>
David

PS hope you don't mind me rearranging your post, bottom-posting makes 
the flow easier to see.

From davidf at sjsoft.com  Thu Sep 18 22:49:35 2003
From: davidf at sjsoft.com (David Fraser)
Date: Fri Jan  9 21:47:44 2004
Subject: [mod_python]  does a mod_python handler exist to generate
	charts/graphs? (png images)
In-Reply-To: <Pine.LNX.4.44.0309181636440.1176-100000@q.cis.uoguelph.ca>
References: <Pine.LNX.4.44.0309181636440.1176-100000@q.cis.uoguelph.ca>
Message-ID: <3F6A1A5F.9000703@sjsoft.com>

Stefan C. Kremer wrote:

>You might want to check out:
>
>http://gnuplot-py.sourceforge.net/
>
>and consider interfacing it with mod_python.  I've used it with python and 
>been very happy (though I really like gnuplot to start with, so I'm 
>biased), but have not used it with mod_python.
>
>	Stefan
>  
>
Thanks Stefan, we'll add it to the list...
David

>On Thu, 18 Sep 2003, David Fraser wrote:
>
>  
>
>>perry.tew@cibavision.novartis.com wrote:
>>
>>    
>>
>>>Hello everyone,
>>>  I was about the go down the road of developing a handler to generate 
>>>charts,
>>>similar to the mod_perl Apache::GD::Graph.  I wanted to make sure 
>>>something doesn't exist
>>>before I reinvent the wheel.  Does anyone know of such a thing yet?  If 
>>>so, would you please
>>>provide a url?
>>>
>>>Thanks,
>>>Perry Tew
>>>
>>>      
>>>
>>There are several Python graphing packages which you could use towards 
>>this end, the question is how nicely will they plug into a web environment.
>>I am not aware of any that are set up to do this using mod_python.
>>I'm also busy looking at the problem, for an application we are 
>>currently converting to be web based, so discuss plans / things you find 
>>here and I will to and hopefully we can come up with a nice solution...
>>
>>Thanks,
>>David
>>
>>
>>_______________________________________________
>>Mod_python mailing list
>>Mod_python@modpython.org
>>http://mailman.modpython.org/mailman/listinfo/mod_python
>>
>>    
>>
>
>  
>


From sgillies at frii.com  Thu Sep 18 15:45:32 2003
From: sgillies at frii.com (Sean Gillies)
Date: Fri Jan  9 21:47:44 2004
Subject: [mod_python] 	UnicodeEncodeError using mod_python-3.0.3 with
	Python 2.3
In-Reply-To: <3F6A14CA.9030008@sjsoft.com>
Message-ID: <6D706C13-EA21-11D7-874F-000393B98B56@frii.com>

On Thursday, September 18, 2003, at 02:25  PM, David Fraser wrote:

> Sean Gillies wrote:
>
>> Hi,
>>
>> I'm running into problems with UnicodeEncodeErrors using   
>> mod_python-3.0.3 with
>> Python 2.3 on OS X.  Yes, I know I'm asking for trouble with this   
>> combination,
>> but I'm leery of replacing Apple's Python 2.2 (which doesn't work  
>> with  mod_python).
>> All in all, my application is working, but will eventually (and   
>> unpredictably)
>> stop and raise this error:
>>
>> Mod_python error: "PythonHandler mod_python.publisher"
>>
>> Traceback (most recent call last):
>>
>>   File   
>> "/Library/Frameworks/Python.framework/Versions/2.3/lib/python2.3/ 
>> site- packages/mod_python/apache.py", line 332, in HandlerDispatch
>>     result = object(req)
>>
>>   File   
>> "/Library/Frameworks/Python.framework/Versions/2.3/lib/python2.3/ 
>> site- packages/mod_python/publisher.py", line 201, in handler
>>     result = str(result)
>>
>> UnicodeEncodeError: 'ascii' codec can't encode character '\u3137' in   
>> position 412: ordinal not in range(128)
>>
>> Anybody else using Python 2.3 who has seen this?  I really don't   
>> understand the error,
>> it's always '\u3137', and I'm _not_ (to my knowledge) using any  
>> unicode  strings.  I am
>> using Zope's Page Templates, but I don't see where the page templates  
>>  would be introducing
>> '\u3137' (the hangul letter tikeut?!).
>>
>> My module is published with no problems on Linux (KRUD) with   
>> mod_python-3.0.1 and
>> Python 2.2.3, so I'm presently living with this problem on my  
>> notebook  and counting
>> on its absence on the server.
>>
>> Sean
>>
>> -- 
>
> Try doing things like:
>  if type(result) == unicode:
>    result = result.encode('iso8859')
> You can look up different encodings in the encodings module. The above  
> works well for me...
> I think you should be able to get the browser's desired encodings from  
> the headers sent to the request.
>
> Hope that helps
> David
>

David,

Thanks for the suggestion.  The Zope page template's __call__ method
does indeed return unicode and I've made your change to publisher.py.
Working good.  I also thought about catching the UnicodeEncodeError
like

     if result:
         try:
             result = str(result)
         except UnicodeEncodeError:
             result = str(result.encode('iso8859'))

since str(result) wasn't raising an error every time.

cheers,
Sean

--
Sean Gillies
sgillies at frii dot com
http://www.frii.com/~sgillies

From is83070 at cis.nctu.edu.tw  Fri Sep 19 11:09:14 2003
From: is83070 at cis.nctu.edu.tw (camge)
Date: Fri Jan  9 21:47:44 2004
Subject: [mod_python] [help]please give an input filter example ?
References: <007c01c37dc6$32d21050$db64a8c0@camgelo>
	<3F69851B.3080703@sjsoft.com> <009d01c37dd0$bc2c5f40$db64a8c0@camgelo>
	<3F69916F.10406@sjsoft.com> <000e01c37de9$60cfd0f0$db64a8c0@camgelo>
	<3F69D71A.8080005@sjsoft.com>
Message-ID: <002c01c37e5b$71210920$db64a8c0@camgelo>

> >I need input filter to convert character set of form data submitted by
cell
> >phone browser.
> >For example, convert utf-8 to big5 or gb.
> >If I can do it in input filter, then I dont need to modify all of my
pages.
> >
> >
> Aha. What I would do is just put a function in a module that changes the
> encoding.
> Get the arguments like you normally would, then just do a decode/encode.
> Since that module can be accessed from anywhere, it will work just as
well.
> Also, it's less likely to cause bugs, and will probably be faster
> (you'll only making one jump into the Python interpreter and back)
>
> Cheers
> David
>
Thanks for your suggestion!
But my web server serve not only wap browser but also Pocket IE and IE,
and they all use same module(for easy maintenance).
Adding this function in these modules will be a terrible thing,
because I dont need to convert character encoding for Pocket IE and IE.

If I can do it in input filter, I don't need to modify any things in
original module.

regards,
camge


From alentzos at cosmote.gr  Fri Sep 19 13:44:32 2003
From: alentzos at cosmote.gr (Lentzos Athanassios)
Date: Fri Jan  9 21:47:44 2004
Subject: =?iso-8859-7?Q?=D0=D1=3A_=5Bmod=5Fpython=5D_Load_python_module_problem?=
Message-ID: <4AEFA010DC6711478C8DA31039641A990149D2BD@AHRMAIL.cosmote.gr>

Skipped content of type multipart/alternative-------------- next part --------------
_______________________________________________
Mod_python mailing list
Mod_python@modpython.org
http://mailman.modpython.org/mailman/listinfo/mod_python
From perry.tew at cibavision.novartis.com  Fri Sep 19 09:59:35 2003
From: perry.tew at cibavision.novartis.com (perry.tew@cibavision.novartis.com)
Date: Fri Jan  9 21:47:44 2004
Subject: [mod_python] 	does a mod_python handler exist to generate
	charts/graphs? (png	images)
Message-ID: <OFACFE0A3B.CBD0AC18-ON85256DA6.004B1817-85256DA6.004CDDEC@EU.novartis.net>

David,
   Thanks for the input.  I'll add chaco and gnuplot.py to the list.  So 
far I have (in no order):

reportlab
pygdchart
chaco
gnuplot

I'll have to start investigating each of them.  chaco and gnuplot appear 
to have massive options and functionality.


In response to your earlier suggestions:
"""
This kind of thing is pretty simple, you can either create a 
StringIO.StringIO object (standard Python) which is a pseudo-file that 
you can get the contents out of using a string, or you could try passing 
the request object (at the appropriate time) and see if it will work 
writing to that.
Another option (assuming the project is open source) is to alter the 
program to support returning the data in a string.
I got the reportlab guys to do this - their project is mainly focussed 
on Reports and PDF, but it also has charting capabilities I haven't 
investigated.
"""

I tried to use the StringIO object from both StringIO and cStringIO.  The 
library didn't like
that at all.  I traced some of the pygdchart code.  It drops down into C 
and calls the following code (from _gdchartc.c)
( I stripped out some unnecessary lines):
PyObject *pfile, *labels, *data, *combodata;
FILE *fp;
...
if (!PyArg_ParseTuple(args, "iiO!iiOiOO", &width, &height, &PyFile_Type, 
&pfile, 
...
fp = PyFile_AsFile(pfile);

I so new to python it hurts, but I'm guessing that at this point in a C 
program, pfile has to be an
actual pointer to a file and not a file-like interface such as StringIO? 
Any experience with this?

As for having the author change the interface, I've already emailed them. 
Later on I found
the cStringIO functionality listed in a TODO file for the pygdchart 
library.  Guess I'm not the first...
I don't know how possible it would be to use cStringIO, since the FILE 
pointer is passed through a mess of C libraries

gdchart -> gd -> libjpeg

The functions all the way down to libjpeg are wanting a pointer to a FILE 
structure.   My other thought was
looking for a way to imitate the FILE pointer in memory and modifying the 
entry C code to return back the
in memory data as a binary stream.  I'll have to look into that as well. 
My C is pretty weak as well.  I'm
so thankful there's Google.

As a workaround, here's what I did (using os.tmpfile):

from mod_python import apache
from mod_python import util
import gdchart
import os

def handler(req):
        req.content_type = "image/png"

        chart = gdchart.Line3D()
        chart.width = 250
        chart.height = 250
        chart.xtitle = "xtitle goes here"
        chart.ytitle = "Percentage"
        chart.title = "Example Graph"
        chart.ext_color = [ "white", "yellow", "red", "blue", "green"]
        chart.setData([20, 100, 80, 30, 50],[10,150,20,25,65])
        chart.setLabels(["Mon", "Tue", "Wed", "Thu", "Fri"])
        chart.setLabels(["Mon", "Tue", "Wed", "Thu", "Fri"])

        f = os.tmpfile()
        chart.draw(f)
        f.seek(0)
        req.write(f.read())
        f.close()

        return apache.OK

It outputs a graph for me.    Here's another question that may be 
better suited for comp.lang.python, but do you know if
os.tmpfile() uses an in-memory representation of a file
or does it use a physical file that just remains anonymous?  I'm 
concerned about the wasteful loss of speed having to write to
disk and read it back.

Well, enough rambling.  Thanks for your time,
Perry Tew












David Fraser <davidf@sjsoft.com>
09/18/2003 04:45 PM

 
        To:     Perry Tew/CV/Novartis@PH
        cc:     mod_python@modpython.org
        Subject:        Re: [mod_python]        does a mod_python handler exist to generate 
charts/graphs? (png     images)


perry.tew@cibavision.novartis.com wrote:

>>perry.tew@cibavision.novartis.com wrote:
>>
>>>Hello everyone,
>>>  I was about the go down the road of developing a handler to generate 
>>>charts,
>>>similar to the mod_perl Apache::GD::Graph.  I wanted to make sure 
>>>something doesn't exist
>>>before I reinvent the wheel.  Does anyone know of such a thing yet?  If 

>>>so, would you please
>>>provide a url?
>>>
>>>Thanks,
>>>Perry Tew
>>
>> There are several Python graphing packages which you could use towards
>>
>>this end, the question is how nicely will they plug into a web 
>>environment.
>>I am not aware of any that are set up to do this using mod_python.
>>I'm also busy looking at the problem, for an application we are 
>>currently converting to be web based, so discuss plans / things you find 

>>here and I will to and hopefully we can come up with a nice solution...
>>
>>Thanks,
>>David
>>
>
>David,
>  Thanks for the information.  I was looking at using pygdchart2 from 
>nullcube.  I was pleased with the interface they've written.  Have you 
any 
>experience with them?  I figured it shouldn't be technically difficult to 

>create an interface of parameters that mapped to chart settings.
> 
>
I haven't had, but will look at it, do you have a URL?

>The only concern I have so far is the method of outputting the chart once 

>rendered.  The examples use the draw method:
>"""
> chart.draw(filespec)
>Draw the graph to the specified file. If the filespec argument is a 
>string, it will be treated as the path to a file. Otherwise, filespec is 
>assumed to be a Python file object.
>"""
>
>I'm new to mod_python, so I'm not sure how to pass the output stream of 
>the request object to the draw() method.  If you know, I'm be grateful. 
If 
>not, I'll work at it.  I haven't really dug yet.
> 
>
This kind of thing is pretty simple, you can either create a 
StringIO.StringIO object (standard Python) which is a pseudo-file that 
you can get the contents out of using a string, or you could try passing 
the request object (at the appropriate time) and see if it will work 
writing to that.
Another option (assuming the project is open source) is to alter the 
program to support returning the data in a string.
I got the reportlab guys to do this - their project is mainly focussed 
on Reports and PDF, but it also has charting capabilities I haven't 
investigated.
The other charting toolkit I am aware of is Chaco.

I think it would be good to investigate all of them and at least draw up 
a list of their strengths/weaknesses for use in a web server context, 
that might be helpful to other users. Would be good to have a list of 
requirements to evaluate these packages by e.g. how big the package is, 
able to produce different image formats, etc.

>btw,   I saw your post earlier about your wiki.  While cruising your site 

>I found a MLM I was in need for.  Thanks!
> 
>
Sure, but I think it was somebody else replying to my message, I don't 
have a wiki...

>Perry Tew
> 
>
David

PS hope you don't mind me rearranging your post, bottom-posting makes 
the flow easier to see.




From davidf at sjsoft.com  Fri Sep 19 16:18:16 2003
From: davidf at sjsoft.com (David Fraser)
Date: Fri Jan  9 21:47:44 2004
Subject: [mod_python] 	does a mod_python handler exist to generate
	charts/graphs? (png	images)
In-Reply-To: <OFACFE0A3B.CBD0AC18-ON85256DA6.004B1817-85256DA6.004CDDEC@EU.novartis.net>
References: <OFACFE0A3B.CBD0AC18-ON85256DA6.004B1817-85256DA6.004CDDEC@EU.novartis.net>
Message-ID: <3F6B1028.3040101@sjsoft.com>

perry.tew@cibavision.novartis.com wrote:

>David,
>   Thanks for the input.  I'll add chaco and gnuplot.py to the list.  So 
>far I have (in no order):
>
>reportlab
>pygdchart
>chaco
>gnuplot
>
>I'll have to start investigating each of them.  chaco and gnuplot appear 
>to have massive options and functionality.
>  
>
Great. I'm away for the next few days so it'll be interesting to see 
what you find.

>
>In response to your earlier suggestions:
>"""
>This kind of thing is pretty simple, you can either create a 
>StringIO.StringIO object (standard Python) which is a pseudo-file that 
>you can get the contents out of using a string, or you could try passing 
>the request object (at the appropriate time) and see if it will work 
>writing to that.
>Another option (assuming the project is open source) is to alter the 
>program to support returning the data in a string.
>I got the reportlab guys to do this - their project is mainly focussed 
>on Reports and PDF, but it also has charting capabilities I haven't 
>investigated.
>"""
>
>I tried to use the StringIO object from both StringIO and cStringIO.  The 
>library didn't like
>that at all.  I traced some of the pygdchart code.  It drops down into C 
>and calls the following code (from _gdchartc.c)
>( I stripped out some unnecessary lines):
>PyObject *pfile, *labels, *data, *combodata;
>FILE *fp;
>...
>if (!PyArg_ParseTuple(args, "iiO!iiOiOO", &width, &height, &PyFile_Type, 
>&pfile, 
>...
>fp = PyFile_AsFile(pfile);
>
>I so new to python it hurts, but I'm guessing that at this point in a C 
>program, pfile has to be an
>actual pointer to a file and not a file-like interface such as StringIO? 
>Any experience with this?
>
>As for having the author change the interface, I've already emailed them. 
>Later on I found
>the cStringIO functionality listed in a TODO file for the pygdchart 
>library.  Guess I'm not the first...
>I don't know how possible it would be to use cStringIO, since the FILE 
>pointer is passed through a mess of C libraries
>
>gdchart -> gd -> libjpeg
>
>The functions all the way down to libjpeg are wanting a pointer to a FILE 
>structure.   My other thought was
>looking for a way to imitate the FILE pointer in memory and modifying the 
>entry C code to return back the
>in memory data as a binary stream.  I'll have to look into that as well. 
>My C is pretty weak as well.  I'm
>so thankful there's Google.
>
>As a workaround, here's what I did (using os.tmpfile):
>
>from mod_python import apache
>from mod_python import util
>import gdchart
>import os
>
>def handler(req):
>        req.content_type = "image/png"
>
>        chart = gdchart.Line3D()
>        chart.width = 250
>        chart.height = 250
>        chart.xtitle = "xtitle goes here"
>        chart.ytitle = "Percentage"
>        chart.title = "Example Graph"
>        chart.ext_color = [ "white", "yellow", "red", "blue", "green"]
>        chart.setData([20, 100, 80, 30, 50],[10,150,20,25,65])
>        chart.setLabels(["Mon", "Tue", "Wed", "Thu", "Fri"])
>        chart.setLabels(["Mon", "Tue", "Wed", "Thu", "Fri"])
>
>        f = os.tmpfile()
>        chart.draw(f)
>        f.seek(0)
>        req.write(f.read())
>        f.close()
>
>        return apache.OK
>
>It outputs a graph for me.    Here's another question that may be 
>better suited for comp.lang.python, but do you know if
>os.tmpfile() uses an in-memory representation of a file
>or does it use a physical file that just remains anonymous?  I'm 
>concerned about the wasteful loss of speed having to write to
>disk and read it back.
>
>Well, enough rambling.  Thanks for your time,
>Perry Tew
>  
>
I'm pretty sure os.tmpfile() is a real file. It should probably be 
deleted afterwards.
Definitely the better option here is changing the library...
Thanks for the investigations
David


From alentzos at cosmote.gr  Fri Sep 19 17:20:43 2003
From: alentzos at cosmote.gr (Lentzos Athanassios)
Date: Fri Jan  9 21:47:44 2004
Subject: ??: [mod_python] Load python module problem
Message-ID: <4AEFA010DC6711478C8DA31039641A99014BBFA5@AHRMAIL.cosmote.gr>

First  i want to thank you  for the immediate response.
 
I did what you suggest me ( uninstall of python 2.3 and install of python 2.2.3 ver) but i still have
the same problem. I should notice that  i don't have administration authority to my workstation do you think
that maybe the cause of the problem.

-----?????? ??????-----
???: Benjamin [mailto:benjamin-hepp@t-online.de]
????????: ??????, 18 ??????????? 2003 6:41 ??
????: Lentzos Athanassios
????: Re: [mod_python] Load python module problem


>Hi 
>I have problem to load the mod_python( ver 3.0.3)? to apache (ver
2.0.47) I have done the >configuration according to the instructions but
i still
>get the following error when i try to start apache server? < " Cannot
load c:/program >files/apache/apache2/modules/mod_python.so into
server:The specified
>module could not be found." > ,of course the file is there. /* I have
installed Python >2.3? on my PC which runs NT os */? ....Please help!!
>
>Lentzos? .P Athanassios (Greece, Athens) 
>E-mail? :?? alentzos@cosmote.gr

mod_python doesn't work with Python 2.3.
Use Python 2.2.

Benjamin

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mailman.modpython.org/pipermail/mod_python/attachments/20030919/3935ae37/attachment.htm
From grisha at modpython.org  Mon Sep 22 10:13:56 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:47:44 2004
Subject: [mod_python]  does a mod_python handler exist to generate
 charts/graphs? (png images)
In-Reply-To: <OFACFE0A3B.CBD0AC18-ON85256DA6.004B1817-85256DA6.004CDDEC@EU.novartis.net>
References: <OFACFE0A3B.CBD0AC18-ON85256DA6.004B1817-85256DA6.004CDDEC@EU.novartis.net>
Message-ID: <20030922100713.X33862@onyx.ispol.com>



On Fri, 19 Sep 2003 perry.tew@cibavision.novartis.com wrote:

> I tried to use the StringIO object from both StringIO and cStringIO.
> The library didn't like that at all.  I traced some of the pygdchart
> code.  It drops down into C and calls the following code (from
> _gdchartc.c) ( I stripped out some unnecessary lines):
>
> PyObject *pfile, *labels, *data, *combodata;
> FILE *fp;
> ...
> if (!PyArg_ParseTuple(args, "iiO!iiOiOO", &width, &height, &PyFile_Type,
> &pfile,
> ...
> fp = PyFile_AsFile(pfile);

Since StringIO is not a file (i.e. it is not a Python object of type
"file", it is something else that acts like a file, but only within
Python), I think your only option is to write to a temporary file, then
pass that file in. Take a look at Python's tempfile module (if you haven't
already).

Grisha
From mike.looijmans at asml.com  Tue Sep 23 08:09:59 2003
From: mike.looijmans at asml.com (Mike Looijmans)
Date: Fri Jan  9 21:47:44 2004
Subject: [mod_python]  does a mod_python handler exist to
	generatecharts/graphs? (png images)
Message-ID: <01c38199$51459580$926a1e6e@wsasd464>

You could look into other stuff, which would be partially OS specific:

- Named pipe. Works on most Unixes and on Windows NT system. Write to
something that looks "filish" to most programs but ends up into your
program.
- Socket. Pass a (TCP) socket descriptor, with your Python program
listening, instead of a file handle to the other side.
- Memory files. Supported on some systems, a file that resides in memory.

Some of these will require a little C interfacing, but that's easy to figure
out.

Mike.

-----Original Message-----
>Since StringIO is not a file (i.e. it is not a Python object of type
>"file", it is something else that acts like a file, but only within
>Python), I think your only option is to write to a temporary file, then
>pass that file in. Take a look at Python's tempfile module (if you haven't
>already).




-- 
The information contained in this communication and any attachments is confidential and may be privileged, and is for the sole use of the intended recipient(s). Any unauthorized review, use, disclosure or distribution is prohibited. If you are not the intended recipient, please notify the sender immediately by replying to this message and destroy all copies of this message and any attachments. ASML is neither liable for the proper and complete transmission of the information contained in this communication, nor for any delay in its receipt.


From grisha at modpython.org  Tue Sep 23 10:35:19 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:47:44 2004
Subject: [mod_python] [help]please give an input filter example ?
In-Reply-To: <002c01c37e5b$71210920$db64a8c0@camgelo>
References: <007c01c37dc6$32d21050$db64a8c0@camgelo>
	<3F69851B.3080703@sjsoft.com>
	<009d01c37dd0$bc2c5f40$db64a8c0@camgelo> <3F69916F.10406@sjsoft.com>
	<3F69D71A.8080005@sjsoft.com>
	<002c01c37e5b$71210920$db64a8c0@camgelo>
Message-ID: <20030923102333.N24322@onyx.ispol.com>


I've looked at the input filter code, and I think that what's in 3.0.3 is
broken. If you get the latest CVS version, your input filter code would
look somethng like:

def inputfilter(filter):

	s = filter.read()

	if s:
		## do something with s here

		filter.write(s)
	else:
		filter.close()

	return apache.OK

Note that the filter will only see the body of the POST request, it will
not see the headers, in fact it won't even be called for GET requests.

Grisha

On Fri, 19 Sep 2003, camge wrote:

> > >I need input filter to convert character set of form data submitted by
> cell
> > >phone browser.
> > >For example, convert utf-8 to big5 or gb.
> > >If I can do it in input filter, then I dont need to modify all of my
> pages.
> > >
> > >
> > Aha. What I would do is just put a function in a module that changes the
> > encoding.
> > Get the arguments like you normally would, then just do a decode/encode.
> > Since that module can be accessed from anywhere, it will work just as
> well.
> > Also, it's less likely to cause bugs, and will probably be faster
> > (you'll only making one jump into the Python interpreter and back)
> >
> > Cheers
> > David
> >
> Thanks for your suggestion!
> But my web server serve not only wap browser but also Pocket IE and IE,
> and they all use same module(for easy maintenance).
> Adding this function in these modules will be a terrible thing,
> because I dont need to convert character encoding for Pocket IE and IE.
>
> If I can do it in input filter, I don't need to modify any things in
> original module.
>
> regards,
> camge
>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From is83070 at cis.nctu.edu.tw  Wed Sep 24 09:25:36 2003
From: is83070 at cis.nctu.edu.tw (camge)
Date: Fri Jan  9 21:47:44 2004
Subject: [mod_python] [help]please give an input filter example ?
References: <007c01c37dc6$32d21050$db64a8c0@camgelo>
	<3F69851B.3080703@sjsoft.com> <009d01c37dd0$bc2c5f40$db64a8c0@camgelo>
	<3F69916F.10406@sjsoft.com> <000e01c37de9$60cfd0f0$db64a8c0@camgelo>
	<3F69D71A.8080005@sjsoft.com> <002c01c37e5b$71210920$db64a8c0@camgelo>
	<20030923102333.N24322@onyx.ispol.com>
Message-ID: <001301c3823a$cc9b9c10$db64a8c0@camgelo>

Dear Grisha,

    Many Thanks for your help!
But I dont have compile environment.
What packages must install if My dev platform is windows and
runtime environment is Apache/2.0.44 (Win32) + Python/2.2.2  ?
I am a newbie on apache.

Best regards,
camge

----- Original Message ----- 
From: "Gregory (Grisha) Trubetskoy" <grisha@modpython.org>
To: "camge" <is83070@cis.nctu.edu.tw>
Cc: "David Fraser" <davidf@sjsoft.com>; <mod_python@modpython.org>
Sent: Tuesday, September 23, 2003 10:35 PM
Subject: Re: [mod_python] [help]please give an input filter example ?


>
> I've looked at the input filter code, and I think that what's in 3.0.3 is
> broken. If you get the latest CVS version, your input filter code would
> look somethng like:
>
> def inputfilter(filter):
>
> s = filter.read()
>
> if s:
> ## do something with s here
>
> filter.write(s)
> else:
> filter.close()
>
> return apache.OK
>
> Note that the filter will only see the body of the POST request, it will
> not see the headers, in fact it won't even be called for GET requests.
>
> Grisha
>
> On Fri, 19 Sep 2003, camge wrote:
>
> > > >I need input filter to convert character set of form data submitted
by
> > cell
> > > >phone browser.
> > > >For example, convert utf-8 to big5 or gb.
> > > >If I can do it in input filter, then I dont need to modify all of my
> > pages.
> > > >
> > > >
> > > Aha. What I would do is just put a function in a module that changes
the
> > > encoding.
> > > Get the arguments like you normally would, then just do a
decode/encode.
> > > Since that module can be accessed from anywhere, it will work just as
> > well.
> > > Also, it's less likely to cause bugs, and will probably be faster
> > > (you'll only making one jump into the Python interpreter and back)
> > >
> > > Cheers
> > > David
> > >
> > Thanks for your suggestion!
> > But my web server serve not only wap browser but also Pocket IE and IE,
> > and they all use same module(for easy maintenance).
> > Adding this function in these modules will be a terrible thing,
> > because I dont need to convert character encoding for Pocket IE and IE.
> >
> > If I can do it in input filter, I don't need to modify any things in
> > original module.
> >
> > regards,
> > camge
> >
> >
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://mailman.modpython.org/mailman/listinfo/mod_python
> >
>
>

From sgillies at frii.com  Wed Sep 24 10:20:27 2003
From: sgillies at frii.com (Sean Gillies)
Date: Fri Jan  9 21:47:45 2004
Subject: [mod_python] Use of global for application data?
Message-ID: <02128F25-EEAB-11D7-BC79-000393B98B56@frii.com>

Hi,

I've seen examples of how to create persistent database connections with
mod_python, but not enough examples of other application data.  In my
case the application data are large objects including page templates.  
Exists
a better way than binding values to names in the globals namespace?  
Maybe
I just have a hang-up about globals that I need to overcome.

Sean

--
Sean Gillies
sgillies at frii dot com
http://www.frii.com/~sgillies

From fumanchu at aminus.net  Wed Sep 24 11:31:27 2003
From: fumanchu at aminus.net (fumanchu)
Date: Fri Jan  9 21:47:45 2004
Subject: [mod_python] Use of global for application data?
In-Reply-To: <DE1CF2B4FEC4A342BF62B6B2B334601E4A9B08@opus.HQAMOR.amorhq.net>
Message-ID: <DE1CF2B4FEC4A342BF62B6B2B334601E02F6CC@opus.HQAMOR.amorhq.net>

> I've seen examples of how to create persistent database connections
with
> mod_python, but not enough examples of other application data.
> In my case the application data are large objects including page
templates.
> Exists a better way than binding values to names in the globals
namespace?

"THE globals namespace" sounds misleading to me, unless you're talking
about the __main__ module. Each module has its own global namespace.

> Maybe I just have a hang-up about globals that I need to overcome.

That would depend on what you mean by "a better way". What limitations
of module.attributes are you seeing? I'd be interested to hear more
about your design, including your goals for the page templates--are you
trying to cache them in RAM throughout the life of the application?


Robert Brewer
fumanchu@aminus.net

From sgillies at frii.com  Wed Sep 24 14:38:53 2003
From: sgillies at frii.com (Sean Gillies)
Date: Fri Jan  9 21:47:45 2004
Subject: [mod_python] Use of global for application data?
In-Reply-To: <DE1CF2B4FEC4A342BF62B6B2B334601E02F6CC@opus.HQAMOR.amorhq.net>
Message-ID: <1CCFD4F4-EECF-11D7-BC79-000393B98B56@frii.com>


On Wednesday, September 24, 2003, at 12:31  PM, fumanchu wrote:

>> I've seen examples of how to create persistent database connections
> with
>> mod_python, but not enough examples of other application data.
>> In my case the application data are large objects including page
> templates.
>> Exists a better way than binding values to names in the globals
> namespace?
>
> "THE globals namespace" sounds misleading to me, unless you're talking
> about the __main__ module. Each module has its own global namespace.
>
>> Maybe I just have a hang-up about globals that I need to overcome.
>
> That would depend on what you mean by "a better way". What limitations
> of module.attributes are you seeing? I'd be interested to hear more
> about your design, including your goals for the page templates--are you
> trying to cache them in RAM throughout the life of the application?
>
>
> Robert Brewer
> fumanchu@aminus.net
>

Robert, thanks for the reply.  I went back and re-read the relevant
sections of the Python Reference Manual.  I had misunderstood that
the persistent db connection example in the FAQ was referring to a
name in the __main__ module.

I am using Zope page templates as module attributes and when methods of
my module are called (using the publisher), merging them with data
from several contexts.  I caught and fixed a bug in my code which
was causing numerous (re)loads of the module, and am now having no
problems.

Sean

--
Sean Gillies
sgillies at frii dot com
http://www.frii.com/~sgillies

From luca.masini at t-online.de  Thu Sep 25 06:57:06 2003
From: luca.masini at t-online.de (Luca Masini)
Date: Fri Jan  9 21:47:45 2004
Subject: [mod_python] mod_python just dump the script
Message-ID: <oprv1hdgvfywthye@securesmtp.t-online.de>

Hi,

I installed mod_python on mandrake 9.1 but it only
dumps the script content instead of executing it.

I do as explained in the installation/testing documentation.

Here some snippets of my httpd.conf file:

  ...
  # <mod_python>
  LoadModule python_module /usr/lib/apache2-2.0.44/mod_python.so
  # </mod_python>
  ...
  # <mod_python>
  AddModule mod_python.c
  # </mod_python>
  ...
  # <mod_python>
  AddHandler python-program .py
  <Directory /var/www/html/test>
      PythonHandler mptest
      PythonDebug On
  </Directory>
  # </mod_python>

The test full path of the test program is
  /var/www/html/test/mptest.py

More or less half an year ago I had the same problem on
a Solaris machine but I can remember how it was solved.
:-(

thanks in advance.



From is83070 at cis.nctu.edu.tw  Thu Sep 25 16:21:25 2003
From: is83070 at cis.nctu.edu.tw (camge)
Date: Fri Jan  9 21:47:45 2004
Subject: [mod_python] [help]please give an input filter example ?
References: <007c01c37dc6$32d21050$db64a8c0@camgelo>
	<3F69851B.3080703@sjsoft.com> <009d01c37dd0$bc2c5f40$db64a8c0@camgelo>
	<3F69916F.10406@sjsoft.com> <000e01c37de9$60cfd0f0$db64a8c0@camgelo>
	<3F69D71A.8080005@sjsoft.com> <002c01c37e5b$71210920$db64a8c0@camgelo>
	<20030923102333.N24322@onyx.ispol.com>
Message-ID: <010201c3833e$0a7cfc00$db64a8c0@camgelo>

Hi Grisha,

    I have compiled the latest CVS version, and it works.
But I found another problem here.

>  postData = filter.read()
>  modify(postData)
>  filter.write(postData)

If postData's length is not changed, everything is fine. 
Otherwise IE will hand there.
I guess this is caused by HTTP header "Content-Length" .
Because we changed the request body, but didn't update the header.

regards,
camge

----- Original Message ----- 
From: "Gregory (Grisha) Trubetskoy" <grisha@modpython.org>
To: "camge" <is83070@cis.nctu.edu.tw>
Cc: "David Fraser" <davidf@sjsoft.com>; <mod_python@modpython.org>
Sent: Tuesday, September 23, 2003 10:35 PM
Subject: Re: [mod_python] [help]please give an input filter example ?


> 
> I've looked at the input filter code, and I think that what's in 3.0.3 is
> broken. If you get the latest CVS version, your input filter code would
> look somethng like:
> 
> def inputfilter(filter):
> 
> s = filter.read()
> 
> if s:
> ## do something with s here
> 
> filter.write(s)
> else:
> filter.close()
> 
> return apache.OK
> 
> Note that the filter will only see the body of the POST request, it will
> not see the headers, in fact it won't even be called for GET requests.
> 
> Grisha
> 

From grisha at modpython.org  Thu Sep 25 09:29:35 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:47:45 2004
Subject: [mod_python] [help]please give an input filter example ?
In-Reply-To: <010201c3833e$0a7cfc00$db64a8c0@camgelo>
References: <007c01c37dc6$32d21050$db64a8c0@camgelo>
	<3F69851B.3080703@sjsoft.com>
	<009d01c37dd0$bc2c5f40$db64a8c0@camgelo> <3F69916F.10406@sjsoft.com>
	<3F69D71A.8080005@sjsoft.com><20030923102333.N24322@onyx.ispol.com>
	<010201c3833e$0a7cfc00$db64a8c0@camgelo>
Message-ID: <20030925092737.H57967@onyx.ispol.com>


On Thu, 25 Sep 2003, camge wrote:

> Hi Grisha,
>
>     I have compiled the latest CVS version, and it works.
> But I found another problem here.
>
> >  postData = filter.read()
> >  modify(postData)
> >  filter.write(postData)
>
> If postData's length is not changed, everything is fine.
> Otherwise IE will hand there.
> I guess this is caused by HTTP header "Content-Length" .
> Because we changed the request body, but didn't update the header.

Most likely, but I don't think there is a way around that because the
header is sent before the body. Perhaps your filter can store something in
the request object to communicate to your handler that it needs to read
more data.

Grisha
From luca.masini at t-online.de  Thu Sep 25 21:09:12 2003
From: luca.masini at t-online.de (Luca Masini)
Date: Fri Jan  9 21:47:45 2004
Subject: [mod_python] undefined symbol: apr_bucket_type_flush
Message-ID: <oprv2ktmdkywthye@securesmtp.t-online.de>

Hi again,
  I installed mod_python on mandrake 9.1 but it only
dumps the script content instead of executing it.

Then I installed mod_php and I have seen that mod_python is
not loaded at all.

running

  httpd -t

I get the following messages:

  Syntax error on line 66 of /etc/httpd/conf/httpd.conf:
  Cannot load /usr/lib/apache2-2.0.44/mod_python.so into server
  /usr/lib/apache2-2.0.44/mod_python.so: undefined symbol: 
apr_bucket_type_flush

So the problem seems to be this undefined apr_bucket_type_flush.

I compiled the module using these commands

   ./configure --with-apxs=/usr/src/apache2-2.0.44/support/apxs
   make
   su
   make install

What's wrong ?

Thanks.
From grisha at modpython.org  Thu Sep 25 14:22:41 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:47:45 2004
Subject: [mod_python] undefined symbol: apr_bucket_type_flush
In-Reply-To: <oprv2ktmdkywthye@securesmtp.t-online.de>
References: <oprv2ktmdkywthye@securesmtp.t-online.de>
Message-ID: <20030925142021.X60209@onyx.ispol.com>



On Thu, 25 Sep 2003, Luca Masini wrote:

> I compiled the module using these commands
>
>    ./configure --with-apxs=/usr/src/apache2-2.0.44/support/apxs

Don't know much about Mandrake, but it seems to me you're pointing at the
wrong apxs, it should really be in /usr/bin or some such. Perhaps someone
familiar w/ Mandrake can comment?

Grisha
From neo at https.ru  Fri Sep 26 00:58:42 2003
From: neo at https.ru (Neo Eureka)
Date: Fri Jan  9 21:47:45 2004
Subject: [mod_python] undefined symbol: apr_bucket_type_flush
In-Reply-To: <oprv2ktmdkywthye@securesmtp.t-online.de>
References: <oprv2ktmdkywthye@securesmtp.t-online.de>
Message-ID: <1118505542.20030926005842@https.ru>


  Hi!

  Some months ago I experimented with Mandrake. I guess you've
installed Apache from a "package". AFAIK, Mandrake has some kind of
"special" Apache flavours.

  I think the best (and the fastest) solution to these problems would
be to compile (the latest version of) original Apache from sources.


> Hi again,
>   I installed mod_python on mandrake 9.1 but it only
> dumps the script content instead of executing it.

> Then I installed mod_php and I have seen that mod_python is
> not loaded at all.

> running

>   httpd -t

> I get the following messages:

>   Syntax error on line 66 of /etc/httpd/conf/httpd.conf:
>   Cannot load /usr/lib/apache2-2.0.44/mod_python.so into server
>   /usr/lib/apache2-2.0.44/mod_python.so: undefined symbol: 
> apr_bucket_type_flush

> So the problem seems to be this undefined apr_bucket_type_flush.

> I compiled the module using these commands

>    ./configure --with-apxs=/usr/src/apache2-2.0.44/support/apxs
>    make
>    su
>    make install

> What's wrong ?

> Thanks.
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python


--- 
Neo Eureka / mailto:neo@https.ru

From modpython at maya.com  Thu Sep 25 17:56:55 2003
From: modpython at maya.com (Seung Chan Lim)
Date: Fri Jan  9 21:47:45 2004
Subject: [mod_python] apache.log_error
Message-ID: <029f01c383af$ef321c60$95fe46c0@GIRLS>

If I'm trying to spew error messages out to the default apache error log am
I doing the right thing by using apache.log_error ??

The problem is that I don't see anything on the default error log which I
believe is Apache2/logs/error.log

This is using mod_python 3.03
Windows 2000
Apache 2.0
Python 2.2

thanks

slim

From is83070 at cis.nctu.edu.tw  Fri Sep 26 10:08:56 2003
From: is83070 at cis.nctu.edu.tw (camge)
Date: Fri Jan  9 21:47:45 2004
Subject: [mod_python] [help]please give an input filter example ?
References: <007c01c37dc6$32d21050$db64a8c0@camgelo>
	<3F69851B.3080703@sjsoft.com> <009d01c37dd0$bc2c5f40$db64a8c0@camgelo>
	<3F69916F.10406@sjsoft.com> <000e01c37de9$60cfd0f0$db64a8c0@camgelo>
	<3F69D71A.8080005@sjsoft.com> <002c01c37e5b$71210920$db64a8c0@camgelo>
	<20030923102333.N24322@onyx.ispol.com>
	<010201c3833e$0a7cfc00$db64a8c0@camgelo>
	<20030925092737.H57967@onyx.ispol.com>
Message-ID: <001401c383d3$2c266e00$db64a8c0@camgelo>


>----- Original Message ----- 
>From: "Gregory (Grisha) Trubetskoy" <grisha@modpython.org>
>Sent: Thursday, September 25, 2003 9:29 PM
>Subject: Re: [mod_python] [help]please give an input filter example ?
>
>
> Most likely, but I don't think there is a way around that because the
> header is sent before the body. Perhaps your filter can store something in
> the request object to communicate to your handler that it needs to read
> more data.
>
> Grisha
>
>

Is there a way to read the header from client
and modify it just like the body in mod_python?
Or any way can modify the body before it sent to the cgi?
Handler in mod_python seems to handle response only.

Thanks for your response!

Best regards,
camge



From is83070 at cis.nctu.edu.tw  Fri Sep 26 15:55:26 2003
From: is83070 at cis.nctu.edu.tw (camge)
Date: Fri Jan  9 21:47:45 2004
Subject: [mod_python] [help]please give an input filter example ?
References: <007c01c37dc6$32d21050$db64a8c0@camgelo>
	<3F69851B.3080703@sjsoft.com> <009d01c37dd0$bc2c5f40$db64a8c0@camgelo>
	<3F69916F.10406@sjsoft.com> <000e01c37de9$60cfd0f0$db64a8c0@camgelo>
	<3F69D71A.8080005@sjsoft.com> <002c01c37e5b$71210920$db64a8c0@camgelo>
	<20030923102333.N24322@onyx.ispol.com>
	<010201c3833e$0a7cfc00$db64a8c0@camgelo>
	<20030925092737.H57967@onyx.ispol.com>
Message-ID: <003301c38403$9ca9ae00$db64a8c0@camgelo>

regardless of Content-Length problem,
I found my apache's error log has these error message when I post data to
cgi.
------------------------------------------------
...
[Fri Sep 26 15:51:31 2003] [error] [client 192.168.100.219] inputfilter
cameoInputFilter: Traceback (most recent call last):, referer:
http://192.168.100.161/test/index.htm
[Fri Sep 26 15:51:31 2003] [error] [client 192.168.100.219] inputfilter
cameoInputFilter:   File "C:\Program
Files\WebSite\lib\python22\lib\site-packages\mod_python\apache.py", line
222, in FilterDispatch
    object(filter), referer: http://192.168.100.161/test/index.htm
[Fri Sep 26 15:51:31 2003] [error] [client 192.168.100.219] inputfilter
cameoInputFilter:   File "C:/Program
Files/WebSite/httpd/CameoMobileSpace\cameoInputFilter.py", line 9, in
inputfilter
    strBody = filter.read(), referer: http://192.168.100.161/test/index.htm
[Fri Sep 26 15:51:31 2003] [error] [client 192.168.100.219] inputfilter
cameoInputFilter: IOError: Input filter read error, referer:
http://192.168.100.161/test/index.htm
...
-------------------------------------------------
although having error log, input filter still works.
Should I catch this exception? and how to handle it, close filter or just
return?
Below is my simple inputfilter:

def inputfilter(filter):
    strBody = filter.read()
    if strBody:
        filter.write(strBody)
    else:
        filter.close()
    return apache.OK

From grisha at modpython.org  Fri Sep 26 10:53:56 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:47:45 2004
Subject: [mod_python] [help]please give an input filter example ?
In-Reply-To: <003301c38403$9ca9ae00$db64a8c0@camgelo>
References: <007c01c37dc6$32d21050$db64a8c0@camgelo>
	<3F69851B.3080703@sjsoft.com>
	<009d01c37dd0$bc2c5f40$db64a8c0@camgelo> <3F69916F.10406@sjsoft.com>
	<3F69D71A.8080005@sjsoft.com><20030923102333.N24322@onyx.ispol.com>
	<20030925092737.H57967@onyx.ispol.com>
	<003301c38403$9ca9ae00$db64a8c0@camgelo>
Message-ID: <20030926104954.C62356@onyx.ispol.com>


Interesting...

If you could change filterobject.c, around line 223, where the code looks
like:

       if (! APR_STATUS_IS_SUCCESS(self->rc)) {
            PyErr_SetObject(PyExc_IOError,
                            PyString_FromString("Input filter read error"));
            return NULL;
To:

       if (! APR_STATUS_IS_SUCCESS(self->rc)) {
            PyErr_Format(PyExc_IOError, "Input filter read error: %d",
                         self->rc);
            return NULL;

This will log the actual return code that Apache is returning on this
error, it might give us more information on what is really going on there.

Thanks,

Grisha


On Fri, 26 Sep 2003, camge wrote:

> regardless of Content-Length problem,
> I found my apache's error log has these error message when I post data to
> cgi.
> ------------------------------------------------
> ...
> [Fri Sep 26 15:51:31 2003] [error] [client 192.168.100.219] inputfilter
> cameoInputFilter: Traceback (most recent call last):, referer:
> http://192.168.100.161/test/index.htm
> [Fri Sep 26 15:51:31 2003] [error] [client 192.168.100.219] inputfilter
> cameoInputFilter:   File "C:\Program
> Files\WebSite\lib\python22\lib\site-packages\mod_python\apache.py", line
> 222, in FilterDispatch
>     object(filter), referer: http://192.168.100.161/test/index.htm
> [Fri Sep 26 15:51:31 2003] [error] [client 192.168.100.219] inputfilter
> cameoInputFilter:   File "C:/Program
> Files/WebSite/httpd/CameoMobileSpace\cameoInputFilter.py", line 9, in
> inputfilter
>     strBody = filter.read(), referer: http://192.168.100.161/test/index.htm
> [Fri Sep 26 15:51:31 2003] [error] [client 192.168.100.219] inputfilter
> cameoInputFilter: IOError: Input filter read error, referer:
> http://192.168.100.161/test/index.htm
> ...
> -------------------------------------------------
> although having error log, input filter still works.
> Should I catch this exception? and how to handle it, close filter or just
> return?
> Below is my simple inputfilter:
>
> def inputfilter(filter):
>     strBody = filter.read()
>     if strBody:
>         filter.write(strBody)
>     else:
>         filter.close()
>     return apache.OK
>
From modpython at maya.com  Fri Sep 26 15:37:06 2003
From: modpython at maya.com (Seung Chan Lim)
Date: Fri Jan  9 21:47:45 2004
Subject: [mod_python] module not reloading?
Message-ID: <037001c38465$9174a550$95fe46c0@GIRLS>

The module reloading mechanism doesn't seem to work. I have to restart
apache everytime to have it reload the modules...

I even tried using the PythonAutoReload directive and set it to "ON" inside
the "Directory" section of the httpd.conf file... no luck..

any advice?

thanks


I'm using python 2.2
mod_python 3.03
Apache 2.0



From michael at dynamine.net  Fri Sep 26 12:50:07 2003
From: michael at dynamine.net (Michael S. Fischer)
Date: Fri Jan  9 21:47:45 2004
Subject: [mod_python] module not reloading?
In-Reply-To: <037001c38465$9174a550$95fe46c0@GIRLS>
References: <037001c38465$9174a550$95fe46c0@GIRLS>
Message-ID: <3F74986F.9010105@dynamine.net>

I have the same problem.  (Same versions, also running OS X 10.2, 
Python2.2 from Fink.)

--Michael

Seung Chan Lim wrote:
> The module reloading mechanism doesn't seem to work. I have to restart
> apache everytime to have it reload the modules...
> 
> I even tried using the PythonAutoReload directive and set it to "ON" inside
> the "Directory" section of the httpd.conf file... no luck..
> 
> any advice?
> 
> thanks
> 
> 
> I'm using python 2.2
> mod_python 3.03
> Apache 2.0
> 
> 
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
> 

From neel at mediapulse.com  Fri Sep 26 16:13:24 2003
From: neel at mediapulse.com (Michael C. Neel)
Date: Fri Jan  9 21:47:45 2004
Subject: [mod_python] module not reloading?
Message-ID: <C0FC22C08B82074A88B500617641577787A787@johnson.mediapulse.net>

I believe the main module reloads, but you will need to manually reload
any modules your module calls you want reloaded.  I tie this into the
PythonDebug setting, like such:

    # if this is in debug/test mode, reload any changes
    if req.get_config().has_key('PythonDebug'):
        reload(www_forms)
        reload(globals)

(if you state PythonDebug Off, there will not be a PythonDebug key at
all - a little gotcha as you might expect there to by a PythonDebug key
with a value of Off).

avoid "from module import *"'s; these don't seem to work with the reload
function (I think that is the way it's supposed to work, btw).

With the above inplace, I don't need to restart/killhup apache unless I
have PythonDebug Off.

HTH,
Mike

> -----Original Message-----
> From: Michael S. Fischer [mailto:michael@dynamine.net] 
> Sent: Friday, September 26, 2003 3:50 PM
> To: Seung Chan Lim
> Cc: mod_python@modpython.org
> Subject: Re: [mod_python] module not reloading?
> 
> 
> I have the same problem.  (Same versions, also running OS X 10.2, 
> Python2.2 from Fink.)
> 
> --Michael
> 
> Seung Chan Lim wrote:
> > The module reloading mechanism doesn't seem to work. I have 
> to restart
> > apache everytime to have it reload the modules...
> > 
> > I even tried using the PythonAutoReload directive and set 
> it to "ON" inside
> > the "Directory" section of the httpd.conf file... no luck..
> > 
> > any advice?
> > 
> > thanks
> > 
> > 
> > I'm using python 2.2
> > mod_python 3.03
> > Apache 2.0
> > 
> > 
> > 
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://mailman.modpython.org/mailman/listinfo/mod_python
> > 
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
> 

From michael at dynamine.net  Fri Sep 26 13:19:59 2003
From: michael at dynamine.net (Michael S. Fischer)
Date: Fri Jan  9 21:47:45 2004
Subject: [mod_python] module not reloading?
In-Reply-To: <C0FC22C08B82074A88B500617641577787A787@johnson.mediapulse.net>
References: <C0FC22C08B82074A88B500617641577787A787@johnson.mediapulse.net>
Message-ID: <3F749F6F.70109@dynamine.net>

Actually, my problem is that the main module reloads, but my called 
modules don't, even if I call reload() explicitly.

--Michael

Michael C. Neel wrote:

> I believe the main module reloads, but you will need to manually reload
> any modules your module calls you want reloaded.  I tie this into the
> PythonDebug setting, like such:
> 
>     # if this is in debug/test mode, reload any changes
>     if req.get_config().has_key('PythonDebug'):
>         reload(www_forms)
>         reload(globals)
> 
> (if you state PythonDebug Off, there will not be a PythonDebug key at
> all - a little gotcha as you might expect there to by a PythonDebug key
> with a value of Off).
> 
> avoid "from module import *"'s; these don't seem to work with the reload
> function (I think that is the way it's supposed to work, btw).
> 
> With the above inplace, I don't need to restart/killhup apache unless I
> have PythonDebug Off.
> 
> HTH,
> Mike
> 
> 
>>-----Original Message-----
>>From: Michael S. Fischer [mailto:michael@dynamine.net] 
>>Sent: Friday, September 26, 2003 3:50 PM
>>To: Seung Chan Lim
>>Cc: mod_python@modpython.org
>>Subject: Re: [mod_python] module not reloading?
>>
>>
>>I have the same problem.  (Same versions, also running OS X 10.2, 
>>Python2.2 from Fink.)
>>
>>--Michael
>>
>>Seung Chan Lim wrote:
>>
>>>The module reloading mechanism doesn't seem to work. I have 
>>
>>to restart
>>
>>>apache everytime to have it reload the modules...
>>>
>>>I even tried using the PythonAutoReload directive and set 
>>
>>it to "ON" inside
>>
>>>the "Directory" section of the httpd.conf file... no luck..
>>>
>>>any advice?
>>>
>>>thanks
>>>
>>>
>>>I'm using python 2.2
>>>mod_python 3.03
>>>Apache 2.0
>>>
>>>
>>>
>>>_______________________________________________
>>>Mod_python mailing list
>>>Mod_python@modpython.org
>>>http://mailman.modpython.org/mailman/listinfo/mod_python
>>>
>>
>>_______________________________________________
>>Mod_python mailing list
>>Mod_python@modpython.org
>>http://mailman.modpython.org/mailman/listinfo/mod_python
>>
> 
> 

From neel at mediapulse.com  Fri Sep 26 16:30:50 2003
From: neel at mediapulse.com (Michael C. Neel)
Date: Fri Jan  9 21:47:45 2004
Subject: [mod_python] module not reloading?
Message-ID: <C0FC22C08B82074A88B50061764157776B9722@johnson.mediapulse.net>

Hmm, without seeing any code, I'm out of ideas.  Here is the (python
2.2.2) docs on reload(), with all it's gotcha's you need to avoid...

reload(module) 
Re-parse and re-initialize an already imported module. The argument must
be a module object, so it must have been successfully imported before.
This is useful if you have edited the module source file using an
external editor and want to try out the new version without leaving the
Python interpreter. The return value is the module object (the same as
the module argument). 
There are a number of caveats: 

If a module is syntactically correct but its initialization fails, the
first import statement for it does not bind its name locally, but does
store a (partially initialized) module object in sys.modules. To reload
the module you must first import it again (this will bind the name to
the partially initialized module object) before you can reload() it. 

When a module is reloaded, its dictionary (containing the module's
global variables) is retained. Redefinitions of names will override the
old definitions, so this is generally not a problem. If the new version
of a module does not define a name that was defined by the old version,
the old definition remains. This feature can be used to the module's
advantage if it maintains a global table or cache of objects -- with a
try statement it can test for the table's presence and skip its
initialization if desired. 

It is legal though generally not very useful to reload built-in or
dynamically loaded modules, except for sys, __main__ and __builtin__. In
many cases, however, extension modules are not designed to be
initialized more than once, and may fail in arbitrary ways when
reloaded. 

If a module imports objects from another module using from ... import
..., calling reload() for the other module does not redefine the objects
imported from it -- one way around this is to re-execute the from
statement, another is to use import and qualified names (module.name)
instead. 

If a module instantiates instances of a class, reloading the module that
defines the class does not affect the method definitions of the
instances -- they continue to use the old class definition. The same is
true for derived classes. 



> -----Original Message-----
> From: Michael S. Fischer [mailto:michael@dynamine.net] 
> Sent: Friday, September 26, 2003 4:20 PM
> To: Michael C. Neel
> Cc: Seung Chan Lim; mod_python@modpython.org
> Subject: Re: [mod_python] module not reloading?
> 
> 
> Actually, my problem is that the main module reloads, but my called 
> modules don't, even if I call reload() explicitly.
> 
> --Michael
> 

From andy at netfxph.com  Sun Sep 28 08:30:37 2003
From: andy at netfxph.com (Andy Sy)
Date: Fri Jan  9 21:47:45 2004
Subject: [mod_python] 
	Win32 Binary of modpython 3.0.3 that has the Python 2.3 patch
Message-ID: <3F762BAD.9040006@netfxph.com>

 > modpython 3.0.3 works fine with Python 2.3, but to build it you
 > need to hack src/include/mod_python.h.  There's a FAQ entry with
 > the necessary patch.
 >
 > Maybe Grisha should release a 3.0.4 with just this one patch?
 >
 > -Barry

I second the motion.  Does anyone have such a binary?
At the very least widespread testing will help uncover
Python 2.3 vis-a-vis modpython 3.x bugs under Windows.

Does anyone have tips on how to compile modpython under
Windows?  Is it possible to do this using MinGW?


From andy at netfxph.com  Mon Sep 29 05:33:30 2003
From: andy at netfxph.com (Andy Sy)
Date: Fri Jan  9 21:47:45 2004
Subject: [mod_python] 
	Windows binary of modpython-3.1.0a for Python 2.3 still won't load
Message-ID: <3F7753AA.1020004@netfxph.com>

/httpd/modpython/win/3.1.0a/mod_python-3.1.0a.win32-py2.3.exe

exhibits the same problems as the earlier versions.  I'm
still getting a module not found error even though it is
clearly in the proper directory.


From is83070 at cis.nctu.edu.tw  Mon Sep 29 10:26:02 2003
From: is83070 at cis.nctu.edu.tw (camge)
Date: Fri Jan  9 21:47:45 2004
Subject: [mod_python] [help]please give an input filter example ?
References: <007c01c37dc6$32d21050$db64a8c0@camgelo>
	<3F69851B.3080703@sjsoft.com> <009d01c37dd0$bc2c5f40$db64a8c0@camgelo>
	<3F69916F.10406@sjsoft.com> <000e01c37de9$60cfd0f0$db64a8c0@camgelo>
	<3F69D71A.8080005@sjsoft.com> <002c01c37e5b$71210920$db64a8c0@camgelo>
	<20030923102333.N24322@onyx.ispol.com>
	<010201c3833e$0a7cfc00$db64a8c0@camgelo>
	<20030925092737.H57967@onyx.ispol.com>
	<003301c38403$9ca9ae00$db64a8c0@camgelo>
	<20030926104954.C62356@onyx.ispol.com>
Message-ID: <001201c38631$f12aa850$db64a8c0@camgelo>

>----- Original Message ----- 
>From: "Gregory (Grisha) Trubetskoy" <grisha@modpython.org>
>
> Interesting...
>
> If you could change filterobject.c, around line 223, where the code looks
> like:
>
>        if (! APR_STATUS_IS_SUCCESS(self->rc)) {
>             PyErr_SetObject(PyExc_IOError,
>                             PyString_FromString("Input filter read
error"));
>             return NULL;
> To:
>
>        if (! APR_STATUS_IS_SUCCESS(self->rc)) {
>             PyErr_Format(PyExc_IOError, "Input filter read error: %d",
>                          self->rc);
>             return NULL;
>
> This will log the actual return code that Apache is returning on this
> error, it might give us more information on what is really going on there.
>
> Thanks,
>
> Grisha
>
Hi Grisha,

    Below is the error message and error code is 730035.
----------------------------------------------------------------------------
------------------------------------------------------
[Mon Sep 29 10:23:56 2003] [notice] Parent: Created child process 2496
[Mon Sep 29 10:23:57 2003] [notice] Child 2496: Child process is running
[Mon Sep 29 10:23:57 2003] [notice] Child 2496: Acquired the start mutex.
[Mon Sep 29 10:23:57 2003] [notice] Child 2496: Starting 250 worker threads.
[Mon Sep 29 10:24:04 2003] [error] [client 211.79.36.248] inputfilter
cameoInputFilter: Traceback (most recent call last):
[Mon Sep 29 10:24:04 2003] [error] [client 211.79.36.248] inputfilter
cameoInputFilter:   File "C:\Program
Files\WebSite\lib\python22\lib\site-packages\mod_python\apache.py", line
222, in FilterDispatch
    object(filter)
[Mon Sep 29 10:24:04 2003] [error] [client 211.79.36.248] inputfilter
cameoInputFilter:   File "C:/Program
Files/WebSite/httpd/CameoMobileSpace\cameoInputFilter.py", line 9, in
inputfilter
    strBody = filter.read()
[Mon Sep 29 10:24:04 2003] [error] [client 211.79.36.248] inputfilter
cameoInputFilter: IOError: Input filter read error: 730035

From davidf at sjsoft.com  Mon Sep 29 07:54:06 2003
From: davidf at sjsoft.com (David Fraser)
Date: Fri Jan  9 21:47:45 2004
Subject: [mod_python] 	Win32 Binary of modpython 3.0.3 that has the Python
	2.3 patch
In-Reply-To: <3F762BAD.9040006@netfxph.com>
References: <3F762BAD.9040006@netfxph.com>
Message-ID: <3F77C8FE.6060900@sjsoft.com>

Andy Sy wrote:

> > modpython 3.0.3 works fine with Python 2.3, but to build it you
> > need to hack src/include/mod_python.h.  There's a FAQ entry with
> > the necessary patch.
> >
> > Maybe Grisha should release a 3.0.4 with just this one patch?
> >
> > -Barry
>
> I second the motion.  Does anyone have such a binary?
> At the very least widespread testing will help uncover
> Python 2.3 vis-a-vis modpython 3.x bugs under Windows.

Yes, this would be a great idea.

> Does anyone have tips on how to compile modpython under
> Windows?  Is it possible to do this using MinGW?

It's fairly complex - seems to require Visual C++ 7.0, also you have to 
then build the installer on a Linux machine I think.
Search the archives of this list for more info...

David


From davidf at sjsoft.com  Mon Sep 29 11:30:40 2003
From: davidf at sjsoft.com (David Fraser)
Date: Fri Jan  9 21:47:45 2004
Subject: [mod_python] jToolkit 0.1 released
Message-ID: <3F77FBC0.1080500@sjsoft.com>

I am pleased to announce the release of jToolkit, a new framework for 
building web applications using modpython and Apache.
jToolkit was developed by St James Software and is aimed at large, 
database-intensive applications with lots of dynamic content.

0.1 is the initial release of jToolkit. I'm trying to follow a 
release-early principle here, so at this stage, jToolkit is 
fully-functional, but documentation is scarce. Use the jToolkit lists 
for help or contributions (I also am on the mod_python and pythondev 
mailing lists).

Here's the blurb from the website, http://jtoolkit.sourceforge.net/

jToolkit is a Python web application framework built on modpython and 
Apache.

It is aimed at dynamically generated pages rather than mostly-static 
pages (for which there are templating solutions). Pages can be produced 
using a variety of widgets. It handles sessions and database connections.

The source code is licensed under the *GPL* license.

We request that for any contributions to jToolkit, *joint copyright* is 
assigned to St James Software. This enables us to keep the public GPL 
version in sync with our internal version, which we use for commercial 
projects. If there are any questions about this, please discuss on any 
of the mailing lists. (Note that if you want to, you can always create 
your own version of jToolkit without returning the contributions to this 
project).

Current features include:
  support for login/logout and user sessions (planned to be integrated 
with modpython 3.1 sessions if that is feasible)
  support for database independence using a wrapper around the Python 
DB-API 2.0
  support for localization using an extension of the gettext modules (so 
that you can have multiple users simultaneously using different languages)
  support for constructing pages using widget objects of various levels 
of complexity, ranging from simple html widgets to table layouts, etc

Any feedback, contributions etc are welcome.
In particular, if anyone actually wants to use this, they'll need help, 
which could then end up being used to create documentation. This is what 
I want to do, so please ask away!

David

From mikeklein at sbcglobal.net  Mon Sep 29 15:27:18 2003
From: mikeklein at sbcglobal.net (Mike Klein)
Date: Fri Jan  9 21:47:45 2004
Subject: [mod_python] Problems installing mod_python...openpty
Message-ID: <AIEFLNLEDPDLOJAIJKHPMEMBEJAA.mikeklein@sbcglobal.net>

I've googled/etc. and can't seem to find an answer to this one.

I am using RH9, and a separately installed Python (v. 2.2.3). My mod_python
is 2.7.8. Mod_python's install instructions say it works with <up to> Python
2.1.

My configure command is:

./configure --with-apxs=/apache/bin/apxs --with-python=/src/Python-2.2.3

The above version of python is compiled without threads and is in
/usr/local/python, whereas stock rh python is in /usr/bin and /usr/lib.

My apache is started with /usr/local/python/bin in the path before /usr/bin,
so apache is now using my custom python. This eliminated some site warnings
I was getting on restart.

When I attempt starting apache I get the following error:

Starting httpsd: Syntax error on line 211 of
/usr/local/apache/conf/httpsd.conf:
Cannot load /usr/local/apache/libexec/mod_python.so into server:
/usr/local/apache/libexec/mod_python.so: undefined symbol: openpty

Any ideas on how to solve this problem?


thanks in advance...

From mikeklein at sbcglobal.net  Mon Sep 29 17:25:44 2003
From: mikeklein at sbcglobal.net (Mike Klein)
Date: Fri Jan  9 21:47:45 2004
Subject: [mod_python] Problems installing mod_python...openpty....changing
	src/Makefile LIBS var fixed...but why needed?
In-Reply-To: <AIEFLNLEDPDLOJAIJKHPMEMBEJAA.mikeklein@sbcglobal.net>
Message-ID: <AIEFLNLEDPDLOJAIJKHPIEMEEJAA.mikeklein@sbcglobal.net>

Well...I google'd some more and found a single page with the answer:

I needed to manually update Makefile in mod_python's src directory and
added -lutil to LIBS variable.

Why is this needed though? I'm running a stock RH9 setup?

I am now able to run py scripts thru apache...


mike

-----Original Message-----
From: mod_python-bounces@modpython.org
[mailto:mod_python-bounces@modpython.org]On Behalf Of Mike Klein
Sent: Monday, September 29, 2003 3:27 PM
To: mod_python@modpython.org
Subject: [mod_python] Problems installing mod_python...openpty


I've googled/etc. and can't seem to find an answer to this one.

I am using RH9, and a separately installed Python (v. 2.2.3). My mod_python
is 2.7.8. Mod_python's install instructions say it works with <up to> Python
2.1.

My configure command is:

./configure --with-apxs=/apache/bin/apxs --with-python=/src/Python-2.2.3

The above version of python is compiled without threads and is in
/usr/local/python, whereas stock rh python is in /usr/bin and /usr/lib.

My apache is started with /usr/local/python/bin in the path before /usr/bin,
so apache is now using my custom python. This eliminated some site warnings
I was getting on restart.

When I attempt starting apache I get the following error:

Starting httpsd: Syntax error on line 211 of
/usr/local/apache/conf/httpsd.conf:
Cannot load /usr/local/apache/libexec/mod_python.so into server:
/usr/local/apache/libexec/mod_python.so: undefined symbol: openpty

Any ideas on how to solve this problem?


thanks in advance...

_______________________________________________
Mod_python mailing list
Mod_python@modpython.org
http://mailman.modpython.org/mailman/listinfo/mod_python

From mikeklein at sbcglobal.net  Mon Sep 29 19:29:19 2003
From: mikeklein at sbcglobal.net (Mike Klein)
Date: Fri Jan  9 21:47:45 2004
Subject: [mod_python] 
	Is there a status handler for mod_python ala mod_perl's
	perl-status, apache's server-status, and php's phpinfo()?
In-Reply-To: <AIEFLNLEDPDLOJAIJKHPIEMEEJAA.mikeklein@sbcglobal.net>
Message-ID: <AIEFLNLEDPDLOJAIJKHPEEMJEJAA.mikeklein@sbcglobal.net>

I like having these pages around as a sanity check and allaround diagnostic.

Does any such beast exist for mod_python? Page would show installed modules,
working environment, etc.


thanks in advance...

mike

From tpc at csua.berkeley.edu  Tue Sep 30 13:37:46 2003
From: tpc at csua.berkeley.edu (tpc@csua.berkeley.edu)
Date: Fri Jan  9 21:47:45 2004
Subject: [mod_python] writing to a file from mod_python
Message-ID: <20030930133235.G29513-100000@localhost.name>


hello all I have the following script that ran fine from the command line:

<code>
#!/usr/bin/env python

#string1 = "hello world!"

def writeFile(string1):
        open('somefile.txt', 'w').write(string1)

## writeFile(string1)
</code>

but as soon as I ported it to mod python I got the following:

<paste>
Mod_python error: "PythonHandler mod_python.publisher"

Traceback (most recent call last):

  File "/usr/lib/python2.2/site-packages/mod_python/apache.py", line 335, in HandlerDispatch
    result = object(req)

  File "/usr/lib/python2.2/site-packages/mod_python/publisher.py", line 194, in handler
    result = apply(object, (), args)

  File "/var/www/html/python/testing.py", line 7, in writeFile

IOError: [Errno 13] Permission denied: 'somefile.txt'
</paste>

I searched the web for the error message, chmod'ed 777 somefile.txt, and
even chown'ed and chgrp'ed to user and group apache, all to no avail.  Is
there a way to write to a file from mod python ?

From nelson at crynwr.com  Mon Sep  1 16:16:16 2003
From: nelson at crynwr.com (Russell Nelson)
Date: Fri Jan  9 21:53:49 2004
Subject: [mod_python] How do I serve up .html files?
In-Reply-To: <20030825213605.O1138@onyx.ispol.com>
References: <16202.30596.238589.112878@desk.crynwr.com>
	<20030825213605.O1138@onyx.ispol.com>
Message-ID: <16211.43280.919607.942196@desk.crynwr.com>

Gregory (Grisha) Trubetskoy writes:
 > P.S. Glad to see you using mod_python!

Me too!  It's a lot faster than a CGI, which was interfering with the
experience.  http://pubsoft.org/ is entirely run by a python program.
I'm going to rewrite my blogging program so that it's dynamic as
well.  Right now it writes static pages (index, archive, and rss).

-- 
--My blog is at angry-economist.russnelson.com  | Free markets express in the
Crynwr sells support for free software  | PGPok | practical world our belief
521 Pleasant Valley Rd. | +1 315 268 1925 voice | that there is that of God
Potsdam, NY 13676-3213  | +1 315 268 9201 FAX   | in all people. -Chris V.
From gdamjan at mail.net.mk  Tue Sep  2 01:15:45 2003
From: gdamjan at mail.net.mk (Damjan)
Date: Fri Jan  9 21:53:49 2004
Subject: [mod_python] Getting the script name with publisher
Message-ID: <20030901231545.GC14389@legolas.on.net.mk>

I have this simple script (test.py) that handled by the publisher:

def index(req):
    script_name = req.subprocess_env['SCRIPT_NAME']
    req.content_type = 'text/html'
    req.send_http_header()
    buf = "Hello, I'm a script. You can call my other methods:"
    buf = buf + "<br>\n" + req.path_info + "<br>\n"
    buf = buf + '''Go <a href="%s/say">here</a>''' % script_name
    return buf
def say(req, what="NOTHING"):
    return "I am saying %s" % what

Now if this script is called as:
[1]  http://127.1/test.py        -> script_name = /test.py
[2]  http://127.1/test.py/       -> script_name = /test.py/
[3]  http://127.1/test.py/index  -> script_name = /test.py
[4]  http://127.1/test.py/index/ -> script_name = /test.py/index


Now obviosly my implementation of getting the script_name doesn't not 
always get the proper result (the proper result being [1] and [3]). 
What's the proper way to do it?? 
I guess the publisher should know the real script name since it had to
import the file...



-- 
Damjan Georgievski
jabberID: damjan@bagra.net.mk
From gdamjan at mail.net.mk  Tue Sep  2 01:50:41 2003
From: gdamjan at mail.net.mk (Damjan)
Date: Fri Jan  9 21:53:49 2004
Subject: [mod_python] Getting the script name with publisher
In-Reply-To: <20030901231545.GC14389@legolas.on.net.mk>
References: <20030901231545.GC14389@legolas.on.net.mk>
Message-ID: <20030901235041.GD14389@legolas.on.net.mk>

> I have this simple script (test.py) that handled by the publisher:

I forgot to mention the test I made were with:
mod_python 3.0.3/ Python 2.3/ Apache 2.0.47 on Slackware-9.0+


PS.
for some strange reason mod_python-3.1.0a would crash Apache on my computer:

mod_python: Creating 256 session mutexes based on 256 max processes and 0 max threads.
(28)No space left on device: mod_python: Failed to create global mutex 127 of 256 (/tmp/mpmtx27278127).
mod_python: We can probably continue, but with diminished ability to process session locks.
mod_python: Hint: On Linux, the problem may be the number of available semaphores, check 'sysctl kernel.sem'
pid file /var/run/httpd.pid overwritten -- Unclean shutdown of previous Apache run?
(28)No space left on device: Couldn't create accept lock

PS2. 
while writing this I solved the mod_python-3.1.0a issue with:

    echo "32000 512 512 512" > /proc/sys/kernel/sem
    
and I also found out that my script works as expected in 3.1.0a 
:)



-- 
Damjan Georgievski
jabberID: damjan@bagra.net.mk
From davis at guydavis.ca  Tue Sep  2 11:10:47 2003
From: davis at guydavis.ca (Guy Davis)
Date: Fri Jan  9 21:53:49 2004
Subject: [mod_python] 
	Safety of using __builtins__ for per-request information?
Message-ID: <3F54CF17.9000006@guydavis.ca>

Hi all,

I'm writing a custom handler using the mod_python.cgi_handler as a guide 
on Apache 1.3 with mod_python 2.7.  Unfortunately, our old CGI makes use 
of certain super-global variables that are not easily done away with.  
I've been able to get this to work by having the handler set the global 
vars into the __builtins__ dictionary.  Then various CGI scripts can 
pull them from __builtins__ when needed. I know using __builtins__ in 
this fashion is not recommended as it's a bit of a hack.

My question is whether storing per-request information in __builtins__ 
is risky due to concurrency reasons.   Put another way, is __builtins__ 
shared between concurrent requests?  For example, person A hits a page 
and the handler stores __builtins__['foo'] = 'bar'.  At nearly the same 
time person B hits a page and the handler stores __builtins__['foo'] = 
'bar2'.  After this occurs, the CGI for person A retrieves 
__builtins__['foo'].  Will the result always be 'bar' or will 'bar2' 
sometimes be returned depending on the timing?

Will the behaviour be any different under Apache 2 and mod_python 3?

Thanks in advance for any responses.

Guy Davis                 http://www.guydavis.ca



From grisha at modpython.org  Tue Sep  2 13:32:27 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:53:49 2004
Subject: [mod_python]  Safety of using __builtins__ for per-request
 information?
In-Reply-To: <3F54CF17.9000006@guydavis.ca>
References: <3F54CF17.9000006@guydavis.ca>
Message-ID: <20030902132450.E6308@onyx.ispol.com>



On Tue, 2 Sep 2003, Guy Davis wrote:

> My question is whether storing per-request information in __builtins__
> is risky due to concurrency reasons.   Put another way, is __builtins__
> shared between concurrent requests?  For example, person A hits a page
> and the handler stores __builtins__['foo'] = 'bar'.  At nearly the same
> time person B hits a page and the handler stores __builtins__['foo'] =
> 'bar2'.  After this occurs, the CGI for person A retrieves
> __builtins__['foo'].  Will the result always be 'bar' or will 'bar2'
> sometimes be returned depending on the timing?

Yes, __builtins__ is shared between requests and using it for per-request
information is not a good idea. You can probably get away with it since
Apache 1.3 isn't multithreaded (unless you're on Windows), but it's still
a bad idea, not only for reasons of concurrency, but also __builtins__
isn't the right place to store anything.

Your best bet is to use the request object itself:

req.foo = 'bar2'

> Will the behaviour be any different under Apache 2 and mod_python 3?

Yes, on apache 2 it is going to be a lot more likely to cause trouble :-)

Grisha
From davidf at sjsoft.com  Tue Sep  2 22:42:33 2003
From: davidf at sjsoft.com (David Fraser)
Date: Fri Jan  9 21:53:49 2004
Subject: [mod_python] Apache startup error using mod_python under Windows
 2000 (have msvcr70.dll)
In-Reply-To: <20030829121653.W53150@onyx.ispol.com>
References: 
	<OF369D809A.F682347B-ON85256D91.004FD7CA-85256D91.0050607E@EU.novartis.net>
	<20030829110249.R53150@onyx.ispol.com> <001201c36e46$1f72d010$0a00a8c0@laird>
	<3F4F7BF2.2090106@sjsoft.com> <20030829121653.W53150@onyx.ispol.com>
Message-ID: <3F5500B9.4020205@sjsoft.com>

Gregory (Grisha) Trubetskoy wrote:

>On Fri, 29 Aug 2003, David Fraser wrote:
>
>  
>
>>Python 2.3, and the easiest way to do that...
>>would be to have an installer for mod_python 3.1a for Python 2.2! Grisha?
>>    
>>
>
>Getting a version for Python 2.2 is tricky because the production
>of the installer requires 2.3, so what I had to do in the past is compile
>for 2.2, but then use 2.3 for the installer, so it's a bit of a pain.
>
>What we really need to do is figure out what is different between our
>systems.
>
>Just to summarise, is this correct? (I am only concerned with 3.1.0a here,
>NOT 3.0.3).
>
>"stock" means the binary from www.python.org, as opposed to Win32, Active
>or compiled. All Apache is the binary from www.apache.org.
>
>       |  mod_py  | Python    | Apache | Win. |
>-------------------------------------------------------
>Perry  |  3.1.0a  | stock 2.3 | 2.0.47 | ?    | OK
>Grisha |  3.1.0a  | stock 2.3 | 2.0.47 | 2000 | OK
>David  |  3.1.0a  | stock 2.3 | 2.0.47 | 2000 | NOT OK
>Laird  |  3.1.0a  | stock 2.3 | 2.0.47 | 2000 | NOT OK
>
>Grisha
>
>  
>
To confirm:
I'm working in Windows 2000
Tested stock Apache 2.0.47, stock Python 2.3, mod_python 3.1a, get error 
loading Module
I tried running FileMon from SysInternals to see if there was some 
dependency etc it was trying to load that was failing, but couldn't see 
anything.
It seems like it is loading the module, but not finding the Apache hooks 
inside it? (Just a guess)

David

From mike.looijmans at asml.com  Wed Sep  3 07:21:15 2003
From: mike.looijmans at asml.com (Mike Looijmans)
Date: Fri Jan  9 21:53:49 2004
Subject: [mod_python] Safety of using __builtins__ for per-request
	information?
Message-ID: <01c371db$322b9780$926a1e6e@wsasd464>

It's not risky in this particular case, but it isn't good practice either...

Using cgi_handler will effectively make your system single-threaded,
regardless of the Apache version used. cgi_handler already shares the
"sys.stdout" and sys.stderr globals, and uses a lock to prevent two requests
to interfere. So within the request, using globals is safe.
I wonder why you use __builtins__, why not just use globals in your own
module? Just create a globals.py or so and import that from each script.

I saw performance _degrade_ because of this when I moved from 'plain' CGI to
mod_python cgihandler (apache 2.0 with worker mpm). Some long requests would
stall the server completely. My solution was to replace all "print"
statements with "output.write(...)" calls, and use the Request object for
output in mod_python scripts and sys.stdout when the server is using plain
CGI. Basically, I turned it around and made a CGI interface that emulates
mod_python (cgihandler does the opposite). The overhead for emulating CGI in
mod_python is huge, while the overhead of emulating mod_python in CGI is
neglectable compared to the interpreter load-and-start.

Mike.


-----Original Message-----
From: Guy Davis <davis@guydavis.ca>
To: mod_python@modpython.org <mod_python@modpython.org>
Date: Tuesday, September 02, 2003 7:13 PM
Subject: [mod_python] Safety of using __builtins__ for per-request
information?


>Hi all,
>
>I'm writing a custom handler using the mod_python.cgi_handler as a guide
>on Apache 1.3 with mod_python 2.7.  Unfortunately, our old CGI makes use
>of certain super-global variables that are not easily done away with.
>I've been able to get this to work by having the handler set the global
>vars into the __builtins__ dictionary.  Then various CGI scripts can
>pull them from __builtins__ when needed. I know using __builtins__ in
>this fashion is not recommended as it's a bit of a hack.
>
>My question is whether storing per-request information in __builtins__
>is risky due to concurrency reasons.   Put another way, is __builtins__
>shared between concurrent requests?  For example, person A hits a page
>and the handler stores __builtins__['foo'] = 'bar'.  At nearly the same
>time person B hits a page and the handler stores __builtins__['foo'] =
>'bar2'.  After this occurs, the CGI for person A retrieves
>__builtins__['foo'].  Will the result always be 'bar' or will 'bar2'
>sometimes be returned depending on the timing?
>
>Will the behaviour be any different under Apache 2 and mod_python 3?
>
>Thanks in advance for any responses.
>
>Guy Davis                 http://www.guydavis.ca
>
>
>
>_______________________________________________
>Mod_python mailing list
>Mod_python@modpython.org
>http://mailman.modpython.org/mailman/listinfo/mod_python
>
>
>
>



-- 
The information contained in this communication and any attachments is confidential and may be privileged, and is for the sole use of the intended recipient(s). Any unauthorized review, use, disclosure or distribution is prohibited. If you are not the intended recipient, please notify the sender immediately by replying to this message and destroy all copies of this message and any attachments. ASML is neither liable for the proper and complete transmission of the information contained in this communication, nor for any delay in its receipt.


From marco.vezzoli at st.com  Wed Sep  3 08:17:18 2003
From: marco.vezzoli at st.com (Marco Vezzoli)
Date: Fri Jan  9 21:53:49 2004
Subject: [mod_python] relocation error with Apache 1.3 on solaris 8
Message-ID: <3F55876E.C9BD222F@st.com>

Hi all,
I'm evaluating mod_python for our intranet site; we are using

solaris 8
gcc 3.0.1
apache 1.3.19
python 2.1.1
mod_python 2.7.8 compiled with DSO 

Compilation and basic tests run good.
I use the mod_python.publisher module for deploy but some modules can't
be imported because there is some name resolution error (messages
follows).
I googled whitout success for this problem (many ask nobody answer).
Thanks in advance for any help.
		Marco


-----------------------------------
Mod_python error: "PythonHandler mod_python.publisher"

Traceback (most recent call last):

  File "/usr/local/lib/python2.1/site-packages/mod_python/apache.py",
line 193, in Dispatch
    result = object(req)

  File "/usr/local/lib/python2.1/site-packages/mod_python/publisher.py",
line 128, in handler
    module = apache.import_module(module_name, _req, [path])

  File "/usr/local/lib/python2.1/site-packages/mod_python/apache.py",
line 335, in import_module
    module = imp.load_module(mname, f, p, d)

  File "/hype/cgi-bin/PyDataAnalysis/EWSSearchProcess.py", line 7, in ?
    import EWS

  File "/hype/cgi-bin/PyDataAnalysis/EWS.py", line 1, in ?
    from psycopg import *

ImportError: ld.so.1: /HTTP-Server/build/apache/bin/httpd: fatal:
relocation error: file /usr/local/lib/libpq.so.2: symbol main:
referenced symbol not found
-----------------------------------

-- 
Marco Vezzoli	   tel. +39 039 603 6852
STMicroelectronics fax. +39 039 603 5055
From perry.tew at cibavision.novartis.com  Wed Sep  3 13:59:36 2003
From: perry.tew at cibavision.novartis.com (perry.tew@cibavision.novartis.com)
Date: Fri Jan  9 21:53:49 2004
Subject: [mod_python] 
	correction: cannot get mod_python3.1a to run against python2.3
Message-ID: <OF11E24A39.2345CE16-ON85256D96.0060276E-85256D96.0062D790@EU.novartis.net>

Grisha,
    Earlier in the thread talking about 3.1a, I reported that I was 
successfully running 3.1a against 2.3.   It appears I was wrong. 
During the install, mod_python found my python2.3 directory in the 
registry and placed its files there, but as I've started developing with 
mod_python, 
I realized it was using my old Python2.2 directories for the python path. 
After I uninstalled 2.2, it stopped working.  Strange. 

Let me ask you, how does the mod_python.so know 
which libraries to link to?  Any idea why it would find 
the 2.2 version and not 2.3?   I now receive the following 
message from apache:
Cannot load C:/perryapps/py/Apache2/modules/mod_python.so into server: The
specified module could not be found.

When I start up python with -, I receive the following output:
Python 2.3 (#46, Jul 29 2003, 18:54:32) [MSC v.1200 32 bin (Intel)] on 
win32

What python version did you build the windows version of 3.1a against?


I also see some comments about mcvcr70.dll in the cvs repository.  I don't 
have
this file in my system.  Then again, your comments in cvs state that it's 
not 
required. 

Is there any other information I can provide to help troubleshoot this for 
myself?
I wish apache would tell me why it can't load mod_python.so.  Is there an 
option
to force apache to devulge additional information?

Sorry for confusion, again, I'm new to all of this.

Perry Tew

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mailman.modpython.org/pipermail/mod_python/attachments/20030903/0dbe868f/attachment-0001.htm
From ronwalf at wam.umd.edu  Wed Sep  3 14:25:38 2003
From: ronwalf at wam.umd.edu (Ron Alford)
Date: Fri Jan  9 21:53:49 2004
Subject: [mod_python] 
	Problem with using apache.import_module for importing scripts
Message-ID: <Pine.LNX.4.44.0309031422590.7361-100000@volus.net>

import_module has a tendency to throw 404s when you have multiple scripts 
of the same name in different directories.  Is there a known way of 
getting around this problem?

My own mod_python handler is effected, and I suspect publisher is, too.

-Ron

--
Ron Alford, KB0NUV
http://volus.net/~ronwalf


From ronwalf at wam.umd.edu  Wed Sep  3 14:34:22 2003
From: ronwalf at wam.umd.edu (Ron Alford)
Date: Fri Jan  9 21:53:49 2004
Subject: [mod_python]  Problem with using apache.import_module for
 importing scripts
In-Reply-To: <Pine.LNX.4.44.0309031422590.7361-100000@volus.net>
Message-ID: <Pine.LNX.4.44.0309031432450.7361-100000@volus.net>

On Wed, 3 Sep 2003, Ron Alford wrote:

> import_module has a tendency to throw 404s when you have multiple scripts 
> of the same name in different directories.  Is there a known way of 
> getting around this problem?
> 
> My own mod_python handler is effected, and I suspect publisher is, too.
> 

This is how I fixed it in apache.py:
...
if not file or (path and not os.path.dirname(file) in path):                    
    raise SERVER_RETURN, HTTP_NOT_FOUND   
if autoreload:
...

goes to 
...
if not file or (path and not os.path.dirname(file) in path):
    #raise SERVER_RETURN, HTTP_NOT_FOUND
    mtime, oldmtime = 0, -1
elif autoreload:
...

--
Ron Alford, KB0NUV
http://volus.net/~ronwalf


From grisha at modpython.org  Wed Sep  3 15:58:13 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:53:49 2004
Subject: [mod_python]  Problem with using apache.import_module for
 importing scripts
In-Reply-To: <Pine.LNX.4.44.0309031432450.7361-100000@volus.net>
References: <Pine.LNX.4.44.0309031432450.7361-100000@volus.net>
Message-ID: <20030903153559.W20438@onyx.ispol.com>


Thanks, that should work OK, and it's still secure because it doesn't
allow access to arbitrary imported modules.

But as a sidenote - you should consider naming your scripts differently
since you end up having to reload them every time the "other" script is
accessed. Also, you may sometimes find object from one script in the
namespace of the other (not sure if it's a Python bug or feature).

Grisha

On Wed, 3 Sep 2003, Ron Alford wrote:

> On Wed, 3 Sep 2003, Ron Alford wrote:
>
> > import_module has a tendency to throw 404s when you have multiple scripts
> > of the same name in different directories.  Is there a known way of
> > getting around this problem?
> >
> > My own mod_python handler is effected, and I suspect publisher is, too.
> >
>
> This is how I fixed it in apache.py:
> ...
> if not file or (path and not os.path.dirname(file) in path):
>     raise SERVER_RETURN, HTTP_NOT_FOUND
> if autoreload:
> ...
>
> goes to
> ...
> if not file or (path and not os.path.dirname(file) in path):
>     #raise SERVER_RETURN, HTTP_NOT_FOUND
>     mtime, oldmtime = 0, -1
> elif autoreload:
> ...
>
> --
> Ron Alford, KB0NUV
> http://volus.net/~ronwalf
>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From synec at viscous.org  Wed Sep  3 17:21:43 2003
From: synec at viscous.org (john spurling)
Date: Fri Jan  9 21:53:49 2004
Subject: [mod_python] relocation error with Apache 1.3 on solaris 8
In-Reply-To: <3F55876E.C9BD222F@st.com>
References: <3F55876E.C9BD222F@st.com>
Message-ID: <20030904002143.GF31952@c7c8.colobox.com>

On Wed, Sep 03, 2003 at 08:17:18AM +0200, Marco Vezzoli wrote:
> Hi all,
> I'm evaluating mod_python for our intranet site; we are using
> 
> solaris 8
> gcc 3.0.1
> apache 1.3.19
> python 2.1.1
> mod_python 2.7.8 compiled with DSO 
> 
> Compilation and basic tests run good.
> I use the mod_python.publisher module for deploy but some modules can't
> be imported because there is some name resolution error (messages
> follows).
> I googled whitout success for this problem (many ask nobody answer).
> Thanks in advance for any help.
> 		Marco

Marco,

this isn't a mod_python problem; it's a psycopg/postgresql problem. in
case you're not familiar, psycopg is a python module used to access a
postgresql database.

it looks to me like psycopg was linked against a different version of
libpq than the one that the runtime linker is using, but that's just a
guess.

you can find more information on psycopg on its website:
http://initd.org/software/psycopg

good luck,
john spurling


> -----------------------------------
> Mod_python error: "PythonHandler mod_python.publisher"
> 
> Traceback (most recent call last):
> 
>   File "/usr/local/lib/python2.1/site-packages/mod_python/apache.py",
> line 193, in Dispatch
>     result = object(req)
> 
>   File "/usr/local/lib/python2.1/site-packages/mod_python/publisher.py",
> line 128, in handler
>     module = apache.import_module(module_name, _req, [path])
> 
>   File "/usr/local/lib/python2.1/site-packages/mod_python/apache.py",
> line 335, in import_module
>     module = imp.load_module(mname, f, p, d)
> 
>   File "/hype/cgi-bin/PyDataAnalysis/EWSSearchProcess.py", line 7, in ?
>     import EWS
> 
>   File "/hype/cgi-bin/PyDataAnalysis/EWS.py", line 1, in ?
>     from psycopg import *
> 
> ImportError: ld.so.1: /HTTP-Server/build/apache/bin/httpd: fatal:
> relocation error: file /usr/local/lib/libpq.so.2: symbol main:
> referenced symbol not found
> -----------------------------------
> 
> -- 
> Marco Vezzoli	   tel. +39 039 603 6852
> STMicroelectronics fax. +39 039 603 5055
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: not available
Url : http://mailman.modpython.org/pipermail/mod_python/attachments/20030903/53baa3a5/attachment-0001.bin
From davis at guydavis.ca  Wed Sep  3 21:18:38 2003
From: davis at guydavis.ca (Guy Davis)
Date: Fri Jan  9 21:53:49 2004
Subject: [mod_python] Code directory layout recommendations?
Message-ID: <1062645517.2832.16.camel@dhcp11.int.guydavis.ca>

Hi all, 

Thanks for the answers to my previous question.  I'm now looking into
reorganizing our current directory layout of Python code.  I was
wondering what your Python web apps use for directory structures?

One idea was to have a directory for "page" modules (generate HTML
mostly), another for library modules, and another for unit tests.

Another possibility is to have a directory per major functional area. 
For example:
	
   functionA/
	-->  functionA_page.py
        -->  functionA_lib1.py
        -->  functionA_lib2.py
        -->  functionA_test.py

   functionB/
        -->  etc...

Both of the examples above are of the CVS workspace.  I'm also debating
whether the actual deploy (web-accessible) directories will be a one to
one mapping of the CVS workspace dirs or whether I'll just dump all the
Python files into one deployment directory.  Python files will be
installed into the web dirs using 'make' on a developer's workstation.

Either approach above would require some tweaks to sys.path.  Is the
standard way to do this is to stick all the required imports into a
single file and then have all other Python modules import it (appending
a relative path like ../../ to sys.path as needed)?  Any other
approaches?

It would be great to hear how you choose to layout your web app
directories and how it has worked out for you.

Thanks.
 

From davidf at sjsoft.com  Thu Sep  4 07:16:56 2003
From: davidf at sjsoft.com (David Fraser)
Date: Fri Jan  9 21:53:49 2004
Subject: [mod_python] Code directory layout recommendations?
In-Reply-To: <1062645517.2832.16.camel@dhcp11.int.guydavis.ca>
References: <1062645517.2832.16.camel@dhcp11.int.guydavis.ca>
Message-ID: <3F56CAC8.5050501@sjsoft.com>

Guy Davis wrote:

>Hi all, 
>
>Thanks for the answers to my previous question.  I'm now looking into
>reorganizing our current directory layout of Python code.  I was
>wondering what your Python web apps use for directory structures?
>
>One idea was to have a directory for "page" modules (generate HTML
>mostly), another for library modules, and another for unit tests.
>
>Another possibility is to have a directory per major functional area. 
>For example:
>	
>   functionA/
>	-->  functionA_page.py
>        -->  functionA_lib1.py
>        -->  functionA_lib2.py
>        -->  functionA_test.py
>
>   functionB/
>        -->  etc...
>
>Both of the examples above are of the CVS workspace.  I'm also debating
>whether the actual deploy (web-accessible) directories will be a one to
>one mapping of the CVS workspace dirs or whether I'll just dump all the
>Python files into one deployment directory.  Python files will be
>installed into the web dirs using 'make' on a developer's workstation.
>
>Either approach above would require some tweaks to sys.path.  Is the
>standard way to do this is to stick all the required imports into a
>single file and then have all other Python modules import it (appending
>a relative path like ../../ to sys.path as needed)?  Any other
>approaches?
>
>It would be great to hear how you choose to layout your web app
>directories and how it has worked out for you.
>
>Thanks.
> 
>
If you're doing an almost-entirely mod-python based application like 
this (i.e. almost all your content is generated by mod_python rather 
than being static),
you may find it better to have one handler in the main directory and let 
it choose which module to pass the other requests to. Then your 
directory structure is defined in Python code rather than by the file 
system. That's what we do

David

From marco.vezzoli at st.com  Thu Sep  4 08:58:57 2003
From: marco.vezzoli at st.com (Marco Vezzoli)
Date: Fri Jan  9 21:53:49 2004
Subject: [mod_python] relocation error with Apache 1.3 on solaris 8
References: <3F55876E.C9BD222F@st.com>
	<20030904002143.GF31952@c7c8.colobox.com>
Message-ID: <3F56E2B1.1E102C94@st.com>

synec@viscous.org wrote:
> 
> On Wed, Sep 03, 2003 at 08:17:18AM +0200, Marco Vezzoli wrote:
> > Hi all,
> > I'm evaluating mod_python for our intranet site; we are using
> >
> > solaris 8
> > gcc 3.0.1
> > apache 1.3.19
> > python 2.1.1
> > mod_python 2.7.8 compiled with DSO
> >
> > Compilation and basic tests run good.
> > I use the mod_python.publisher module for deploy but some modules can't
> > be imported because there is some name resolution error (messages
> > follows).
> > I googled whitout success for this problem (many ask nobody answer).
> > Thanks in advance for any help.
> >               Marco
> 
> Marco,
> 
> this isn't a mod_python problem; it's a psycopg/postgresql problem. in
> case you're not familiar, psycopg is a python module used to access a
> postgresql database.
> 
> it looks to me like psycopg was linked against a different version of
> libpq than the one that the runtime linker is using, but that's just a
> guess.
> 
> you can find more information on psycopg on its website:
> http://initd.org/software/psycopg
> 
> good luck,
> john spurling
> 

Thank you for the answer; I did some other test and I verified that

-some other modules importing .so are working correctly e.g.
mx.DateTime, gadfly
-some don't e.g. cgi (fails to load libssl, messages below)
-another postgres driver fails with a similar error (messages below)
-pure python imports psycopg correctly (so I imagine it could be some
apache/mod_python linking problem)
-no other libpq nor libssl are in the LD_LIBRARY_PATH

I'm using gnu ld: does this cause some problem?
I've tried hacking my path so that it finds Sun's ld but errors are the
same.
Is it an apache config problem?
TIA for any help

	Marco

----error importing cgi----------------------------------
Mod_python error: "PythonHandler mod_python.publisher"

Traceback (most recent call last):

  File "/usr/local/lib/python2.1/site-packages/mod_python/apache.py",
line 193, in Dispatch
    result = object(req)

  File "/usr/local/lib/python2.1/site-packages/mod_python/publisher.py",
line 128, in handler
    module = apache.import_module(module_name, _req, [path])

  File "/usr/local/lib/python2.1/site-packages/mod_python/apache.py",
line 335, in import_module
    module = imp.load_module(mname, f, p, d)

  File "/hype/cgi-bin/PyDataAnalysis/test.py", line 2, in ?
    import cgi

  File "/usr/local/lib/python2.1/cgi.py", line 39, in ?
    import urllib

  File "/usr/local/lib/python2.1/urllib.py", line 26, in ?
    import socket

  File "/usr/local/lib/python2.1/socket.py", line 41, in ?
    from _socket import *

ImportError: ld.so.1: /HTTP-Server/build/apache/bin/httpd: fatal:
relocation error: file /usr/local/lib/libssl.so.0.9.6: symbol main:
referenced symbol not found
--------------------------------------
----error importing pg----------------------------------------
Mod_python error: "PythonHandler mod_python.publisher"

Traceback (most recent call last):

  File "/usr/local/lib/python2.1/site-packages/mod_python/apache.py",
line 193, in Dispatch
    result = object(req)

  File "/usr/local/lib/python2.1/site-packages/mod_python/publisher.py",
line 128, in handler
    module = apache.import_module(module_name, _req, [path])

  File "/usr/local/lib/python2.1/site-packages/mod_python/apache.py",
line 335, in import_module
    module = imp.load_module(mname, f, p, d)

  File "/hype/cgi-bin/PyDataAnalysis/test.py", line 3, in ?
    import pg

  File "/usr/local/lib/python2.1/pg.py", line 7, in ?
    from _pg import *

ImportError: ld.so.1: /HTTP-Server/build/apache/bin/httpd: fatal:
relocation error: file /usr/local/lib/libpq.so.2: symbol main:
referenced symbol not found

-- 
Marco Vezzoli	   tel. +39 039 603 6852
STMicroelectronics fax. +39 039 603 5055
From davidf at sjsoft.com  Thu Sep  4 10:28:06 2003
From: davidf at sjsoft.com (David Fraser)
Date: Fri Jan  9 21:53:49 2004
Subject: [mod_python] relocation error with Apache 1.3 on solaris 8
In-Reply-To: <3F56E2B1.1E102C94@st.com>
References: <3F55876E.C9BD222F@st.com>
	<20030904002143.GF31952@c7c8.colobox.com> <3F56E2B1.1E102C94@st.com>
Message-ID: <3F56F796.4040803@sjsoft.com>

Marco Vezzoli wrote:

>synec@viscous.org wrote:
>  
>
>>On Wed, Sep 03, 2003 at 08:17:18AM +0200, Marco Vezzoli wrote:
>>    
>>
>>>Hi all,
>>>I'm evaluating mod_python for our intranet site; we are using
>>>
>>>solaris 8
>>>gcc 3.0.1
>>>apache 1.3.19
>>>python 2.1.1
>>>mod_python 2.7.8 compiled with DSO
>>>
>>>Compilation and basic tests run good.
>>>I use the mod_python.publisher module for deploy but some modules can't
>>>be imported because there is some name resolution error (messages
>>>follows).
>>>I googled whitout success for this problem (many ask nobody answer).
>>>Thanks in advance for any help.
>>>              Marco
>>>      
>>>
>>Marco,
>>
>>this isn't a mod_python problem; it's a psycopg/postgresql problem. in
>>case you're not familiar, psycopg is a python module used to access a
>>postgresql database.
>>
>>it looks to me like psycopg was linked against a different version of
>>libpq than the one that the runtime linker is using, but that's just a
>>guess.
>>
>>you can find more information on psycopg on its website:
>>http://initd.org/software/psycopg
>>
>>good luck,
>>john spurling
>>
>>    
>>
>
>Thank you for the answer; I did some other test and I verified that
>
>-some other modules importing .so are working correctly e.g.
>mx.DateTime, gadfly
>-some don't e.g. cgi (fails to load libssl, messages below)
>-another postgres driver fails with a similar error (messages below)
>-pure python imports psycopg correctly (so I imagine it could be some
>apache/mod_python linking problem)
>-no other libpq nor libssl are in the LD_LIBRARY_PATH
>
>I'm using gnu ld: does this cause some problem?
>I've tried hacking my path so that it finds Sun's ld but errors are the
>same.
>Is it an apache config problem?
>TIA for any help
>
>	Marco
>  
>
Searching google for httpd fatal relocation error symbol not found libpq 
solaris yields some interesting results, so this seems like a more 
general problem.
e.g. http://www.geocrawler.com/mail/msg.php3?msg_id=7733831&list=10
and an interesting thread on other similar solaris problems
http://msgs.securepoint.com/cgi-bin/get/apache0203/222/1.html

David



From davis at guydavis.ca  Thu Sep  4 16:12:39 2003
From: davis at guydavis.ca (Guy Davis)
Date: Fri Jan  9 21:53:49 2004
Subject: [mod_python] How does mod_python handle concurrency?
Message-ID: <3F57B8D7.1070605@guydavis.ca>

We currently use time.strftime() in our CGI code after setting the TZ 
environment variable to the user's timezone.  Since I'm trying to move 
us away from the mod_python.cgi_handler to our own custom handler, in 
order to allow concurrent request handling, I was wondering how to get 
around the problem of having to update the TZ env var.

This dependency seems to be a problem for concurrent request 
processing.  Does anyone on this list have a trick for doing locale 
specific date formating while handling concurrent requests?

Also, does concurrent request processing in mod_python rely on a single 
Python process with multiple threads?  If so, are sys.exc_type and 
sys.exc_value shared between threads?  I'm on Apache 1.3 now but hope to 
move to Apache 2 soon.

Thanks,
Guy

From dustin at ywlcs.org  Thu Sep  4 18:40:27 2003
From: dustin at ywlcs.org (Dustin Mitchell)
Date: Fri Jan  9 21:53:49 2004
Subject: [mod_python] How does mod_python handle concurrency?
In-Reply-To: <3F57B8D7.1070605@guydavis.ca>
References: <3F57B8D7.1070605@guydavis.ca>
Message-ID: <20030904234027.GV17963@eleanor.internal.ywlcs.org>

On Thu, Sep 04, 2003 at 04:12:39PM -0600, Guy Davis wrote:
> We currently use time.strftime() in our CGI code after setting the TZ 
> environment variable to the user's timezone.  Since I'm trying to move 
> us away from the mod_python.cgi_handler to our own custom handler, in 
> order to allow concurrent request handling, I was wondering how to get 
> around the problem of having to update the TZ env var.

If you can look up the time zone offset, you can adjust the timezones
by simply adding the required number of seconds.  I know this isn't a
very good solution, but it's what I use for the small stuff I do.

I would be very interested in how you determine the user's locale?  Is
there any trick to interpreting request headers? Or is it a user
prefererence for your site?

> Also, does concurrent request processing in mod_python rely on a single 
> Python process with multiple threads?  If so, are sys.exc_type and 
> sys.exc_value shared between threads?  I'm on Apache 1.3 now but hope to 
> move to Apache 2 soon.

Yes, those values are explicitly shared between threads, which is the
reason for the creation of sys.exc_info().  See 

 http://www.python.org/doc/current/lib/module-sys.html

Dustin

-- 

  Dustin Mitchell
  dustin@ywlcs.org/djmitche@alumni.uchicago.edu
  http://people.cs.uchicago.edu/~dustin/
  PGP Key: http://people.cs.uchicago.edu/~dustin/pubkey.txt
From cs1spw at bath.ac.uk  Fri Sep  5 03:42:29 2003
From: cs1spw at bath.ac.uk (Simon Willison)
Date: Fri Jan  9 21:53:49 2004
Subject: [mod_python] Best practise for database connection pooling?
Message-ID: <3F57F815.8020300@bath.ac.uk>

We are looking to build a large content management system using 
mod_python and PostgreSQL. I'm interested in what is considered "best 
practise" for database connection pooling. So far, I've been playing 
with the idea of setting up a single database connection as a global 
variable at the start of each mod_python script - since scripts stay in 
memory between requests, this can be reused for requests without needing 
to reopen the connection. It also means that every httpd child process 
spun off by the server ends up with its own database connection.

The postgres server is running on the same machine as the web server, 
but we may move to separate servers for the two in the future. Am I on 
the right track, or is there a better way of managing database connnections?

Incidentally, the database connection module we are using is 
http://pypgsql.sourceforge.net/

Thanks,

Simon Willison

From marco.vezzoli at st.com  Fri Sep  5 08:11:35 2003
From: marco.vezzoli at st.com (Marco Vezzoli)
Date: Fri Jan  9 21:53:49 2004
Subject: [mod_python] relocation error with Apache 1.3 on solaris 8
References: <3F55876E.C9BD222F@st.com>
	<20030904002143.GF31952@c7c8.colobox.com> <3F56E2B1.1E102C94@st.com>
	<3F56F796.4040803@sjsoft.com>
Message-ID: <3F582917.216458B4@st.com>

> >
> Searching google for httpd fatal relocation error symbol not found libpq
> solaris yields some interesting results, so this seems like a more
> general problem.
> e.g. http://www.geocrawler.com/mail/msg.php3?msg_id=7733831&list=10
> and an interesting thread on other similar solaris problems
> http://msgs.securepoint.com/cgi-bin/get/apache0203/222/1.html
> 
> David

Thank you David for the pointers.
The second one suggests that careful linking options would prevent the
'main' symbol to be generated

>    I have seen a similar failure on AIX recently. It seems that 
>    php (and tcl, which was my case) use a somewhat different way to load 
>    the shared libs than PostgreSQL does.
>
>    While PostgreSQL does not care, they need a shared lib that was linked 
>    with a switch to specify no entry (like -bnoentry on AIX).
>    Maybe that has to do with our RTLD_LAZY ?

and using nm I've found that all mod_*.so libraries do not have any
'main' symbol but libpq.so does have one marked 'U'.
I'll look for more info about linker options.
	Marco
-- 
Marco Vezzoli	   tel. +39 039 603 6852
STMicroelectronics fax. +39 039 603 5055
From davidf at sjsoft.com  Fri Sep  5 09:39:24 2003
From: davidf at sjsoft.com (David Fraser)
Date: Fri Jan  9 21:53:49 2004
Subject: [mod_python] How does mod_python handle concurrency?
In-Reply-To: <20030904234027.GV17963@eleanor.internal.ywlcs.org>
References: <3F57B8D7.1070605@guydavis.ca>
	<20030904234027.GV17963@eleanor.internal.ywlcs.org>
Message-ID: <3F583DAC.5010905@sjsoft.com>

Dustin Mitchell wrote:

>On Thu, Sep 04, 2003 at 04:12:39PM -0600, Guy Davis wrote:
>  
>
>>We currently use time.strftime() in our CGI code after setting the TZ 
>>environment variable to the user's timezone.  Since I'm trying to move 
>>us away from the mod_python.cgi_handler to our own custom handler, in 
>>order to allow concurrent request handling, I was wondering how to get 
>>around the problem of having to update the TZ env var.
>>    
>>
>
>If you can look up the time zone offset, you can adjust the timezones
>by simply adding the required number of seconds.  I know this isn't a
>very good solution, but it's what I use for the small stuff I do.
>
>I would be very interested in how you determine the user's locale?  Is
>there any trick to interpreting request headers? Or is it a user
>prefererence for your site?
>  
>
This is not for the time zone, but we have enhanced the gettext module 
to be able to support multiple locales, and to localize strings per-session.
The user selects a language, the session object passes that to the 
localize function

David

From davidf at sjsoft.com  Fri Sep  5 09:53:31 2003
From: davidf at sjsoft.com (David Fraser)
Date: Fri Jan  9 21:53:50 2004
Subject: [mod_python] Best practise for database connection pooling?
In-Reply-To: <3F57F815.8020300@bath.ac.uk>
References: <3F57F815.8020300@bath.ac.uk>
Message-ID: <3F5840FB.5090006@sjsoft.com>

Simon Willison wrote:

> We are looking to build a large content management system using 
> mod_python and PostgreSQL. I'm interested in what is considered "best 
> practise" for database connection pooling. So far, I've been playing 
> with the idea of setting up a single database connection as a global 
> variable at the start of each mod_python script - since scripts stay 
> in memory between requests, this can be reused for requests without 
> needing to reopen the connection. It also means that every httpd child 
> process spun off by the server ends up with its own database connection.

We have a system where we use multiple different database connections 
for different applications running on the same server.
Each application object exists once per child, and has its own database 
connection.

> The postgres server is running on the same machine as the web server, 
> but we may move to separate servers for the two in the future. Am I on 
> the right track, or is there a better way of managing database 
> connnections?

You may want to look at http://sqlrelay.sourceforge.net/ - I haven't 
used it, but it seems useful particularly if you have separate servers.
For those not going and reading the page:
SQL Relay is a persistent database connection pooling, proxying and load 
balancing system for Unix and Linux supporting ODBC, Oracle, MySQL, 
mSQL, PostgreSQL, Sybase, MS SQL Server, IBM DB2, Interbase, Lago and 
SQLite with APIs for C, C++, Perl, Perl-DBD, Python, Python-DB, Zope, 
PHP, Ruby, Ruby-DBD, TCL and Java, command line clients, a GUI 
configuration tool and extensive documentation. The APIs support 
advanced database operations such as bind variables, multi-row fetches, 
client side result set caching and suspended transactions. It is ideal 
for speeding up database-driven web-based applications, accessing 
databases from unsupported platforms, migrating between databases, 
distributing access to replicated databases and throttling database access.

>
> Incidentally, the database connection module we are using is 
> http://pypgsql.sourceforge.net/

I've found PyGreSQL to be better...
http://www.druid.net/pygresql/
But you may find otherwise...

David

From gdamjan at mail.net.mk  Fri Sep  5 16:18:51 2003
From: gdamjan at mail.net.mk (Damjan)
Date: Fri Jan  9 21:53:50 2004
Subject: [mod_python] How does mod_python handle concurrency?
In-Reply-To: <3F57B8D7.1070605@guydavis.ca>
References: <3F57B8D7.1070605@guydavis.ca>
Message-ID: <20030905141851.GA8470@legolas.on.net.mk>

> We currently use time.strftime() in our CGI code after setting the TZ 
> environment variable to the user's timezone.  Since I'm trying to move 
> us away from the mod_python.cgi_handler to our own custom handler, in 
> order to allow concurrent request handling, I was wondering how to get 
> around the problem of having to update the TZ env var.

Setting environment variables in multithreaded/concurent programs 
is ugly.
I would suggest a different approach for your problem..
t = time.gmtime() # get the UTC time tupple
t = t[:-1] + (TZ,) # set the TZ field of the tupple
time.strftime(format,t) # get the strftime of that 


Also glibc as of 2.3 has a new multithreaded locale API, it doesn't 
depend on global variables. This would be great (and indead is designed
for) for multithreaded application servers like Apache.
Unfourtenatelly I don't know that python bindings for this API exists or
if at all anyone is working on this...

> This dependency seems to be a problem for concurrent request 
> processing.  Does anyone on this list have a trick for doing locale 
> specific date formating while handling concurrent requests?
> http://mailman.modpython.org/mailman/listinfo/mod_python

-- 
Damjan Georgievski
jabberID: damjan@bagra.net.mk
From conrad at hep.caltech.edu  Sat Sep  6 20:04:51 2003
From: conrad at hep.caltech.edu (Conrad Steenberg)
Date: Fri Jan  9 21:53:50 2004
Subject: [mod_python] ANNOUNCE: Mod_python 3.1.0 Alpha
In-Reply-To: <20030829171157.O56156@onyx.ispol.com>
References: <20030828210644.C43921@onyx.ispol.com>
	<20030829171157.O56156@onyx.ispol.com>
Message-ID: <1062903891.2713.33.camel@Presario>

Hi

Having played around with the new version and PSP, I have one question:
My application doesn't use the session infrastructure provided by PSP,
but 256 sessions (in shared memory) are created at startup anyway.

This prompts a change in the kernel semaphore settings on older linuxes
(redhat 7.3 specifically).  As this will likely trip up new sysadmins
that just want to try out the package, is there a way to reduce the
number of sessions (or space for these sessions) by using a directive?

If there isn't such a directive, is it possible to add one?

Cheers!

Conrad

On Fri, 2003-08-29 at 14:21, Gregory (Grisha) Trubetskoy wrote:
> On Fri, 29 Aug 2003, Conrad Steenberg wrote:
> 
> > Hi
> >
> > Tested here to be working under an OpenPKG-1.3 (ish) environment.
> >
> > Any pointers to higher level tools that works with the included version
> > of PSP (such as for constructing a news or blogging site)? There seems
> > to be at least two other projects also calling themselves PSP ;-)
> 
> There is even one called Perl Server Pages :-)
> 
> I doubt there are any tools, since our PSP is brand new. B
> 
> But it's rather simplistic. For everyone's info:
> 
> This describes the syntax:
> 
> http://www.modpython.org/live/mod_python-3.1.0a/doc-html/pyapi-psp.html
> 
> And this describes the psp handler (things like sessions, etc):
> 
> http://www.modpython.org/live/mod_python-3.1.0a/doc-html/pyapi-psp.html
> 
> Also, if you have any JSP experience, there was an e-mail on the dev list
> regarding how it corresponds to PSP, which I'll forward to this list
> (because I forgot where the dev list archives are).
> 
> Grisha
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
-- 
Conrad Steenberg <conrad@hep.caltech.edu>
From grisha at apache.org  Sun Sep  7 18:45:45 2003
From: grisha at apache.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:53:50 2004
Subject: [mod_python] ANNOUNCE: Mod_python 3.1.0 Alpha
In-Reply-To: <1062903891.2713.33.camel@Presario>
References: <20030828210644.C43921@onyx.ispol.com>
	<1062188981.14514.296.camel@heppc22>
	<1062903891.2713.33.camel@Presario>
Message-ID: <20030907180501.B83449@onyx.ispol.com>


On Sat, 6 Sep 2003, Conrad Steenberg wrote:

> This prompts a change in the kernel semaphore settings on older linuxes
> (redhat 7.3 specifically).

Well - I think this is really a redhat problem. I believe I even saw
something reporting it as a security problem - it is very easy for someone
to deprive an rh box of available semaphores. I wonder what the default is
on rh 8 and 9 (anyone?).

> As this will likely trip up new sysadmins that just want to try out the
> package,

It probably will :-(
But that's why there is a "Hint" in the error log for Linux users.

> is there a way to reduce the number of sessions (or space for
> these sessions) by using a directive?

Yes, there is a way - adjust MaxClients. Some MPM's (at least worker) will
alter MaxClients if the other directives do not add up to or exceed it, so
it's possible other values may need adjusting.

BTW, mod_python does NOT quit if it was able to allocate *some* locks, but
not *all*, it only writes a warning to the error log and proceeds. But
what craps out after that is mod_rewrite, which wants a global lock, but
mod_python has eaten them all. So perhaps I can adjust it so that if we
allocated *some* but not *all*, then to free one (or two?)  so that
mod_rewrite is happy.

(On the other hand doing this may seem like going too far to adress what
is really a lousy config default in the kernel....)

Grisha

>
> If there isn't such a directive, is it possible to add one?
>
> Cheers!
>
> Conrad
>
> On Fri, 2003-08-29 at 14:21, Gregory (Grisha) Trubetskoy wrote:
> > On Fri, 29 Aug 2003, Conrad Steenberg wrote:
> >
> > > Hi
> > >
> > > Tested here to be working under an OpenPKG-1.3 (ish) environment.
> > >
> > > Any pointers to higher level tools that works with the included version
> > > of PSP (such as for constructing a news or blogging site)? There seems
> > > to be at least two other projects also calling themselves PSP ;-)
> >
> > There is even one called Perl Server Pages :-)
> >
> > I doubt there are any tools, since our PSP is brand new. B
> >
> > But it's rather simplistic. For everyone's info:
> >
> > This describes the syntax:
> >
> > http://www.modpython.org/live/mod_python-3.1.0a/doc-html/pyapi-psp.html
> >
> > And this describes the psp handler (things like sessions, etc):
> >
> > http://www.modpython.org/live/mod_python-3.1.0a/doc-html/pyapi-psp.html
> >
> > Also, if you have any JSP experience, there was an e-mail on the dev list
> > regarding how it corresponds to PSP, which I'll forward to this list
> > (because I forgot where the dev list archives are).
> >
> > Grisha
> >
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://mailman.modpython.org/mailman/listinfo/mod_python
> --
> Conrad Steenberg <conrad@hep.caltech.edu>
>
From llsousa at ualg.pt  Mon Sep  8 11:48:53 2003
From: llsousa at ualg.pt (Luis Sousa)
Date: Fri Jan  9 21:53:50 2004
Subject: [mod_python] Some problems with mod_python.publisher
In-Reply-To: <20030615154824.64623.qmail@web40402.mail.yahoo.com>
References: <20030615154824.64623.qmail@web40402.mail.yahoo.com>
Message-ID: <3F5C5E95.5080603@ualg.pt>

Michel Thadeu wrote:

>Hi guys!
>
>I having trouble with mod_python.publisher, I using a apache 1.2.27 and
>the mod_python 2.7 (the standard version of debian testing).
>
>I have configured the apache like this:
>
>   <Directory /var/www/modpython>
>     AddHandler python-program .py
>     PythonHandler mod_python.publisher
>   </Directory>
>
>And have made a script named index.py with the next code:
>
>   from mod_python import apache
>   def executar(req):
>           req.content_type="text/html"
>           req.send_http_header()
>           req.write('<H1>Some test of executar!</H1>')
>           return apache.OK
>
The code here can be something like this:
s="<html><h1>hello world</h1></html>"
return s

When using mod_python.publisher you have to return a string
Luis Sousa

>
>But when I execute this script, using the next url...
>
>   http://localhost/modpython/index.py/executar
>
>The page is open, rendening html code, and all the things, but with a
>error message:
>
>   Some test of executar!
>   HTTP/1.1 200 OK Date: Tue, 17 Jun 2003 23:36:26 GMT Server: 
>   Apache/1.3.27 (Unix) Debian GNU/Linux mod_python/2.7.8 Python/2.2.2 
>   PHP/4.1.2 Connection: close Transfer-Encoding: chunked Content-Type:
>
>   text/html; charset=iso-8859-1
>   OK
>   The server encountered an internal error or misconfiguration and was
>
>   unable to complete your request.
>
>   Please contact the server administrator, webmaster@capsulecorp and 
>   inform them of the time the error occurred, and anything you might 
>   have done that may have caused the error.
>
>   More information about this error may be available in the server 
>   error log.
>
>But if I use PythonHanldler and name executar as handler, the error is
>not shown... I read the last lines of error.log of apache, but I don't
>found a critical error:
>
>   [Tue Jun 17 21:42:29 2003] [alert] apache: Could not determine the 
>   server's fully qualified domain name, using 127.0.0.1 for ServerName
>   [Tue Jun 17 21:42:30 2003] [notice] Apache/1.3.27 (Unix) Debian 
>   GNU/Linux mod_python/2.7.8 Python/2.2.2 PHP/4.1.2 configured -- 
>   resuming normal operations
>   [Tue Jun 17 21:42:30 2003] [notice] suEXEC mechanism enabled 
>   (wrapper: /usr/lib/apache/suexec)
>   [Tue Jun 17 21:42:30 2003] [notice] Accept mutex: sysvsem (Default: 
>   sysvsem)
>
>This is the last errors since the last restart of apache...
>
>Well, I don't know what error I made, can someone help me?
>
>thanks
>--
>Michel Thadeu Sabchuk
>Curitiba - Paran? - Brazil
>
>=====
>--
>Michel Thadeu Sabchuk
>Curitiba/PR
>
>_______________________________________________________________________
>Yahoo! Mail
>Mais espa?o, mais seguran?a e gratuito: caixa postal de 6MB, antiv?rus, prote??o contra spam.
>http://br.mail.yahoo.com/
>_______________________________________________
>Mod_python mailing list
>Mod_python@modpython.org
>http://mailman.modpython.org/mailman/listinfo/mod_python
>
>
>  
>


-- 
Luis Sousa
Especialista de Inform?tica
Gabinete de Gest?o de Informa??o, ext: 7837
Campus de Gambelas
Universidade do Algarve, tel: 289800900

-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/x-pkcs7-signature
Size: 3627 bytes
Desc: S/MIME Cryptographic Signature
Url : http://mailman.modpython.org/pipermail/mod_python/attachments/20030908/1f41dfc5/smime-0001.bin
From llsousa at ualg.pt  Mon Sep  8 12:23:41 2003
From: llsousa at ualg.pt (Luis Sousa)
Date: Fri Jan  9 21:53:50 2004
Subject: [mod_python] 
	Handler publisher with multiple directories on the same tree
Message-ID: <3F5C66BD.8060402@ualg.pt>

Hello everybody.

I'm using Apache 1.3.26-0woody3 and mod_python 2.7.8-6, debian releases.
I have configured just one directory on my public_html and added some 
directives to httpd.conf file as follows:

<Directory /home/llsousa/public_html/gpessoal/trunk>
    AddHandler python-program .py
    PythonHandler mod_python.publisher
    PythonDebug On
    PythonPath "sys.path+['/home/llsousa/public_html/gpessoal/trunk']"
</Directory>

And everything worked ok.
So, I needed 2 more folders and I did the same for the rest, like this:

<Directory /home/llsousa/public_html/gpessoal/dev>
    AddHandler python-program .py
    PythonHandler mod_python.publisher
    PythonDebug On
    PythonPath "sys.path+['/home/llsousa/public_html/gpessoal/dev']"
</Directory>

<Directory /home/llsousa/public_html/gpessoal/bugs>
    AddHandler python-program .py
    PythonHandler mod_python.publisher
    PythonDebug On
    PythonPath "sys.path+['/home/llsousa/public_html/gpessoal/bugs']"
</Directory>

But I got a unpleasent surprise, that is, using browser, I access one of 
the projects subsection and everything is OK. After I got the page, I 
tried to access to another of the subsection and I got an 404, page not 
found. If I wait for a while (I don't know exactly, but something like 
one minute) and made reload on browser, I can now see this subsection.

Does anyone have any clue about this ? What am I doing wrong ?

Thanks in advance for your help,
Luis Sousa

-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/x-pkcs7-signature
Size: 3627 bytes
Desc: S/MIME Cryptographic Signature
Url : http://mailman.modpython.org/pipermail/mod_python/attachments/20030908/7509d5b4/smime-0001.bin
From mike.looijmans at asml.com  Mon Sep  8 13:35:35 2003
From: mike.looijmans at asml.com (Mike Looijmans)
Date: Fri Jan  9 21:53:50 2004
Subject: [mod_python] Handler publisher with multiple directories on the
	same tree
Message-ID: <01c375fd$51705d80$926a1e6e@wsasd464>

My guess:

If you wait for about a minute, the server will drop the keepalive
connection and another child process will handle your request. The effect is
that you probably get a brand new environment. Probably if you repeat often
enough, it will break completely when all childs are "loaded".

The problem is probably that you have equal named scripts in each directory.
So if you have

/a/foo.py
/b/foo.py

The first call will fetch /a/foo.py, and when you want to load the 'b'
version, it will just return the 'a' version because a 'foo' script is
already imported, even if pythonpath no longer contains the /a/ directory.

Scripts must have unique names, even when in different directories.

A good workaround is to use the "PythonInterpreter" directive, set it to per
directory or specify a unique interpreter name for each directory.
Each interpreter will have its own modules, so the "already loaded" effect
won't bite you.
This does, however, consume more memory.

This is also great for testing, you can add a "test" directory with a
different interpreter and have an environment completely set apart with it
own set of scripts and data and so.

[snip]
>But I got a unpleasent surprise, that is, using browser, I access one of
>the projects subsection and everything is OK. After I got the page, I
>tried to access to another of the subsection and I got an 404, page not
>found. If I wait for a while (I don't know exactly, but something like
>one minute) and made reload on browser, I can now see this subsection.




-- 
The information contained in this communication and any attachments is confidential and may be privileged, and is for the sole use of the intended recipient(s). Any unauthorized review, use, disclosure or distribution is prohibited. If you are not the intended recipient, please notify the sender immediately by replying to this message and destroy all copies of this message and any attachments. ASML is neither liable for the proper and complete transmission of the information contained in this communication, nor for any delay in its receipt.


From neo at https.ru  Mon Sep  8 16:59:20 2003
From: neo at https.ru (Neo Eureka)
Date: Fri Jan  9 21:53:50 2004
Subject: [mod_python] Resource consumption
In-Reply-To: <20030907180501.B83449@onyx.ispol.com>
References: <20030828210644.C43921@onyx.ispol.com>
 <1062188981.14514.296.camel@heppc22> <1062903891.2713.33.camel@Presario>
 <20030907180501.B83449@onyx.ispol.com>
Message-ID: <11020798025.20030908165920@https.ru>


Hi all!

Grisha,

IIUC, shared memory and semaphores are allocated even if I don't use
sessions or PSP at all ? Is there a way to completely "switch off"
the features I do not (and will not) use ever ? It seems very strange
to me: features that I do not use still consume system resources and
cause problems with server startup (yes, I've got RedHat box).


> On Sat, 6 Sep 2003, Conrad Steenberg wrote:

>> This prompts a change in the kernel semaphore settings on older linuxes
>> (redhat 7.3 specifically).

> Well - I think this is really a redhat problem. I believe I even saw
> something reporting it as a security problem - it is very easy for someone
> to deprive an rh box of available semaphores. I wonder what the default is
> on rh 8 and 9 (anyone?).

>> As this will likely trip up new sysadmins that just want to try out the
>> package,

> It probably will :-(
> But that's why there is a "Hint" in the error log for Linux users.

>> is there a way to reduce the number of sessions (or space for
>> these sessions) by using a directive?

> Yes, there is a way - adjust MaxClients. Some MPM's (at least worker) will
> alter MaxClients if the other directives do not add up to or exceed it, so
> it's possible other values may need adjusting.

> BTW, mod_python does NOT quit if it was able to allocate *some* locks, but
> not *all*, it only writes a warning to the error log and proceeds. But
> what craps out after that is mod_rewrite, which wants a global lock, but
> mod_python has eaten them all. So perhaps I can adjust it so that if we
> allocated *some* but not *all*, then to free one (or two?)  so that
> mod_rewrite is happy.

> (On the other hand doing this may seem like going too far to adress what
> is really a lousy config default in the kernel....)

> Grisha


--- 
Neo Eureka / mailto:neo@https.ru

From llsousa at ualg.pt  Mon Sep  8 14:21:46 2003
From: llsousa at ualg.pt (Luis Sousa)
Date: Fri Jan  9 21:53:50 2004
Subject: [mod_python] Handler publisher with multiple directories on the
 same tree
In-Reply-To: <01c375fd$51705d80$926a1e6e@wsasd464>
References: <01c375fd$51705d80$926a1e6e@wsasd464>
Message-ID: <3F5C826A.80404@ualg.pt>

Skipped content of type multipart/alternative-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/x-pkcs7-signature
Size: 3627 bytes
Desc: S/MIME Cryptographic Signature
Url : http://mailman.modpython.org/pipermail/mod_python/attachments/20030908/79dd05a8/smime-0001.bin
From mike.looijmans at asml.com  Mon Sep  8 15:40:26 2003
From: mike.looijmans at asml.com (Mike Looijmans)
Date: Fri Jan  9 21:53:50 2004
Subject: [mod_python] Handler publisher with multiple directories on
	thesame tree
Message-ID: <01c3760e$c26c4100$926a1e6e@wsasd464>

> When I'm developing I usually have a common problem that is when I
> change a class or some file, sometimes the interpreter remains in memory
> the old version and doesn't load the new one. Is there a way to solve
> this out ? Normally I use an non elegant way, I restart apache!

I use the "reload" built-in function. This loads an internal module from
disk.
My main handler checks if the path_info of the URL is "/request" and if so,
runs the following (you could use publisher to publish this interface as
well).
All "my" modules are named "ops_" something. You could also use the __file__
location as a filter.

def reloadmodules(req):
    '''Try to reload all ops_ modules. This is typically done after updating
    imported scripts, such as ops_cgisql.py. The main scripts will be
    reloaded automatically on demand, so that there is no need to send
    a reload after changing ops_webrellist.py or so.
    This also throws away old DB connections. If there are currently
    active connections, these are preserved.'''
    req.content_type='text/plain'
    # Reload python modules
    modules = sys.modules.keys()
    modules.sort()
    for module in modules:
        if module[:4] == 'ops_':
            try:
                req.write('Reloading: %s\n' % module)
                reload(sys.modules[module])
            except:
                req.write('%s: %s\n' % sys.exc_info()[:2])
    # throw away DB connection objects
    req.write('Destroy DB cached connections\n')
    _lock.acquire()
    try:
        dblist.clear()
    finally:
        _lock.release()
    req.write('Done\n')





-- 
The information contained in this communication and any attachments is confidential and may be privileged, and is for the sole use of the intended recipient(s). Any unauthorized review, use, disclosure or distribution is prohibited. If you are not the intended recipient, please notify the sender immediately by replying to this message and destroy all copies of this message and any attachments. ASML is neither liable for the proper and complete transmission of the information contained in this communication, nor for any delay in its receipt.


From grisha at modpython.org  Mon Sep  8 09:53:57 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:53:50 2004
Subject: [mod_python] Resource consumption
In-Reply-To: <11020798025.20030908165920@https.ru>
References: <20030828210644.C43921@onyx.ispol.com>
	<1062188981.14514.296.camel@heppc22>
	<20030907180501.B83449@onyx.ispol.com>
	<11020798025.20030908165920@https.ru>
Message-ID: <20030908092907.A93462@onyx.ispol.com>



On Mon, 8 Sep 2003, Neo Eureka wrote:

> IIUC, shared memory and semaphores are allocated even if I don't use
> sessions or PSP at all?

Yes (there is no shared memory used for sessions, only locks, which *may*
be semaphores or some other lock implementation, depending on your OS).

> Is there a way to completely "switch off" the features I do not (and
> will not) use ever ?

Not right now. I couldn't think of a way to do it that wouldn't be
confusing. Locks must be allocated at server startup so that children
have access to them. We could have a directive like "PythonSessionLocks
Off", IMHO that's on the ugly side.

Generally, I think keeping the number of Apache directive to a minimum is
a good idea.

> It seems very strange to me: features that I do not use still consume
> system resources

That's not unusual - as an example, every RH box will load all kinds of
modules (including mod_python), but few people ever use them all.

> and cause problems with server startup

This, I agree, *is* a problem, but I think I can work around it without
introducing new Apache directives.

Another point to consider is that on many other systems there will not be
a limit to the number of locks allocated, and there is no cost to
allocating a lock but never using it, so a directive like this wouldn't
make much sense.

Grisha

> (yes, I've got RedHat box).


>
>
> > On Sat, 6 Sep 2003, Conrad Steenberg wrote:
>
> >> This prompts a change in the kernel semaphore settings on older linuxes
> >> (redhat 7.3 specifically).
>
> > Well - I think this is really a redhat problem. I believe I even saw
> > something reporting it as a security problem - it is very easy for someone
> > to deprive an rh box of available semaphores. I wonder what the default is
> > on rh 8 and 9 (anyone?).
>
> >> As this will likely trip up new sysadmins that just want to try out the
> >> package,
>
> > It probably will :-(
> > But that's why there is a "Hint" in the error log for Linux users.
>
> >> is there a way to reduce the number of sessions (or space for
> >> these sessions) by using a directive?
>
> > Yes, there is a way - adjust MaxClients. Some MPM's (at least worker) will
> > alter MaxClients if the other directives do not add up to or exceed it, so
> > it's possible other values may need adjusting.
>
> > BTW, mod_python does NOT quit if it was able to allocate *some* locks, but
> > not *all*, it only writes a warning to the error log and proceeds. But
> > what craps out after that is mod_rewrite, which wants a global lock, but
> > mod_python has eaten them all. So perhaps I can adjust it so that if we
> > allocated *some* but not *all*, then to free one (or two?)  so that
> > mod_rewrite is happy.
>
> > (On the other hand doing this may seem like going too far to adress what
> > is really a lousy config default in the kernel....)
>
> > Grisha
>
>
> ---
> Neo Eureka / mailto:neo@https.ru
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From grickert at coldstorage.com  Mon Sep  8 17:18:13 2003
From: grickert at coldstorage.com (Gerrat Rickert)
Date: Fri Jan  9 21:53:50 2004
Subject: [mod_python] 
Message-ID: <DIEMKLHLKFCCPAEPDMHKIEFECEAA.grickert@coldstorage.com>



Gerrat Rickert
Systems Analyst
Conestoga Coldstorage


From grickert at coldstorage.com  Mon Sep  8 17:42:33 2003
From: grickert at coldstorage.com (Gerrat Rickert)
Date: Fri Jan  9 21:53:50 2004
Subject: [mod_python] 
	PythonHandler does not appear to append directory to import path
Message-ID: <DIEMKLHLKFCCPAEPDMHKCEFFCEAA.grickert@coldstorage.com>

I'm using mod_python 3.03, apache 2.047, and python 2.2.3 on a win2K machine
& am trying to use the publisher handler.  The problem is when I try to add
an additional handler via:

req.addhandler("PythonHandler", testModule, directory_to_append_to_sys_path)

The error I am getting is:

Mod_python error: "PythonHandler testModule"

Traceback (most recent call last):

  File "D:\Python22\lib\site-packages\mod_python\apache.py", line 340, in
HandlerDispatch
    module = import_module(module_name, config)

  File "D:\Python22\lib\site-packages\mod_python\apache.py", line 516, in
import_module
    f, p, d = imp.find_module(parts[i], path)

ImportError: No module named testModule



Looking through the HandlerDispatch function of apache.py, the relevant code
is:

if config.has_key("PythonPath"):
...
else:
    dir = hlist.directory
    if dir and (dir not in sys.path):
        sys.path[:0] = [dir]


This code doesn't appear to add my directory
(directory_to_append_to_sys_path) to the sys.path if I have "PythonPath" in
my httpd.conf file.  Importing my module fails because of this.  I'm not
sure if this is just a misunderstanding on my part or has already been
addressed (in which case I apologize for posting).  As far as I can see, the
"else" portion of this statement should be executed regardless of whether
PythonPath is in the config file or not.  Can anyone else confirm this?

Thanks,
Gerrat Rickert


From grisha at modpython.org  Tue Sep  9 10:41:55 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:53:50 2004
Subject: [mod_python]  PythonHandler does not appear to append directory
 to import path
In-Reply-To: <DIEMKLHLKFCCPAEPDMHKCEFFCEAA.grickert@coldstorage.com>
References: <DIEMKLHLKFCCPAEPDMHKCEFFCEAA.grickert@coldstorage.com>
Message-ID: <20030909103210.V9524@onyx.ispol.com>


Gerrat -

You're right, it doesn't add the directory to the path if PythonPath is
specified. The code that decides this has no way of knowing whether the
handler was specified via an Apache directive or req.add_handler(). It
just follows the rule that PythonPath overrides everything.

The rationale for this all-overriding behaviour of PythonPath is that you
can use it make sure that the directory where the handler is specified is
_not_ in sys.path. (Otherwise, if the directive directory was _always_
added, there would be no way to achieve this)

You can do two things:

1. Add directory_to_append_to_sys_path to PythonPath
2. Get rid of PythonPath. I see a lot of people using it where they really
don't need to. See if you _really_ need it.

What *I* need to do is adjust the documentation of add_handler() to
clarify that dir has no effect when PythonPath is specified.

Grisha

On Mon, 8 Sep 2003, Gerrat Rickert wrote:

> I'm using mod_python 3.03, apache 2.047, and python 2.2.3 on a win2K machine
> & am trying to use the publisher handler.  The problem is when I try to add
> an additional handler via:
>
> req.addhandler("PythonHandler", testModule, directory_to_append_to_sys_path)
>
> The error I am getting is:
>
> Mod_python error: "PythonHandler testModule"
>
> Traceback (most recent call last):
>
>   File "D:\Python22\lib\site-packages\mod_python\apache.py", line 340, in
> HandlerDispatch
>     module = import_module(module_name, config)
>
>   File "D:\Python22\lib\site-packages\mod_python\apache.py", line 516, in
> import_module
>     f, p, d = imp.find_module(parts[i], path)
>
> ImportError: No module named testModule
>
>
>
> Looking through the HandlerDispatch function of apache.py, the relevant code
> is:
>
> if config.has_key("PythonPath"):
> ...
> else:
>     dir = hlist.directory
>     if dir and (dir not in sys.path):
>         sys.path[:0] = [dir]
>
>
> This code doesn't appear to add my directory
> (directory_to_append_to_sys_path) to the sys.path if I have "PythonPath" in
> my httpd.conf file.  Importing my module fails because of this.  I'm not
> sure if this is just a misunderstanding on my part or has already been
> addressed (in which case I apologize for posting).  As far as I can see, the
> "else" portion of this statement should be executed regardless of whether
> PythonPath is in the config file or not.  Can anyone else confirm this?
>
> Thanks,
> Gerrat Rickert
>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From grickert at coldstorage.com  Tue Sep  9 11:43:15 2003
From: grickert at coldstorage.com (Gerrat Rickert)
Date: Fri Jan  9 21:53:50 2004
Subject: [mod_python]  PythonHandler does not appear to append directory
 to import path
Message-ID: <DIEMKLHLKFCCPAEPDMHKIEFHCEAA.grickert@coldstorage.com>

Grisha -

Thanks for your response - much appreciated.  I'm probably using PythonPath
where I don't need to.  I have some modules I'd like to share between
several web apps & I can just add their path to my PYTHONPATH environment
variable & remove the PythonPath directive.

Gerrat


From llsousa at ualg.pt  Tue Sep  9 17:19:00 2003
From: llsousa at ualg.pt (Luis Sousa)
Date: Fri Jan  9 21:53:50 2004
Subject: [mod_python] Handler publisher with multiple directories on
	thesame tree
In-Reply-To: <01c3760e$c26c4100$926a1e6e@wsasd464>
References: <01c3760e$c26c4100$926a1e6e@wsasd464>
Message-ID: <3F5DFD74.3030100@ualg.pt>

Skipped content of type multipart/alternative-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/x-pkcs7-signature
Size: 3627 bytes
Desc: S/MIME Cryptographic Signature
Url : http://mailman.modpython.org/pipermail/mod_python/attachments/20030909/bdba7319/smime-0001.bin
From davidf at sjsoft.com  Tue Sep  9 18:56:34 2003
From: davidf at sjsoft.com (David Fraser)
Date: Fri Jan  9 21:53:50 2004
Subject: [mod_python]  PythonHandler does not appear to append directory
 to import path
In-Reply-To: <DIEMKLHLKFCCPAEPDMHKIEFHCEAA.grickert@coldstorage.com>
References: <DIEMKLHLKFCCPAEPDMHKIEFHCEAA.grickert@coldstorage.com>
Message-ID: <3F5E0642.9090702@sjsoft.com>

Gerrat Rickert wrote:

>Grisha -
>
>Thanks for your response - much appreciated.  I'm probably using PythonPath
>where I don't need to.  I have some modules I'd like to share between
>several web apps & I can just add their path to my PYTHONPATH environment
>variable & remove the PythonPath directive.
>
>Gerrat
>  
>
It might be helpful to look at putting these shared modules in a package 
that is either located under site-packages, or where the location is put 
in a .pth file under site-packages. Then you don't need to adjust any 
path things at all

David

From neel at mediapulse.com  Tue Sep  9 17:26:23 2003
From: neel at mediapulse.com (Michael C. Neel)
Date: Fri Jan  9 21:53:50 2004
Subject: [mod_python] Using dbpool in more than one place....
Message-ID: <C0FC22C08B82074A88B50061764157775CCB@johnson.mediapulse.net>

I'm currently trying to migrate an apache 1.3 / mod_python 2.7.8 site to
apache 2.x and mod_python 3.x.

I currently load two different mod_python modules for the site, one to
log hits to a database, the other to run site site pages.  I'm using
worker threads on apache, and trying to use dbpool to work around
MySQLdb's threading level 1.

The logging module connects to a remote 3.23.x Mysql box; the site
module connects to a local MySQL 4.x database.  If I disable one module,
the other (using dbpool) will run fine; it's when I try to run both I
get problems.  When I "import jon.dbpool as dbpool" on both, I get the
following errors in the global apache log:

Exception exceptions.RuntimeError: 'maximum recursion depth exceeded' in
<function _connection_notinuse at 0x41afbaac> ignored
Exception exceptions.TypeError: 'weak object has gone away' in <function
_connection_notinuse at 0x41afbaac> ignored

When I "import jon.dbpool as logger_dbpool" in the log module and
"import jon.dbpool as dbpool" in the site module I get the following
error in the sites log file:

Mod_python error: "PythonHandler www"

Traceback (most recent call last):

  File "/usr/local/lib/python2.3/site-packages/mod_python/apache.py",
line 338, in HandlerDispatch
    result = object(req)

  File "/home/sites/beta/modules/www.py", line 51, in handler
    c = db.cursor()

  File "/usr/local/lib/python2.3/site-packages/jon/dbpool.py", line 93,
in cursor
    return self._inner.cursor(*args, **kwargs)

  File "/usr/local/lib/python2.3/site-packages/jon/dbpool.py", line 129,
in cursor
    c = _Cursor(self, *args, **kwargs)

  File "/usr/local/lib/python2.3/site-packages/jon/dbpool.py", line 140,
in __init__
    self._outer = connection._outerref()

TypeError: 'NoneType' object is not callable


Is it possbile to use dbpool to connect to two different databases,
using two different mod_python modules?

Thanks,
Mike

From fumanchu at aminus.net  Tue Sep  9 16:59:06 2003
From: fumanchu at aminus.net (fumanchu)
Date: Fri Jan  9 21:53:50 2004
Subject: [mod_python] Using dbpool in more than one place....
In-Reply-To: <DE1CF2B4FEC4A342BF62B6B2B334601E43651A@opus.HQAMOR.amorhq.net>
Message-ID: <DE1CF2B4FEC4A342BF62B6B2B334601E42D20E@opus.HQAMOR.amorhq.net>

Quick response: the message:

Exception exceptions.RuntimeError: 'maximum recursion depth exceeded' in
<function _connection_notinuse at 0x41afbaac> ignored

is most likely due a namespace collision, where you think you're calling
one function and you're really calling another with the same name,
(usually the current function, although parallel recursion has been
known to occur). When using "as", try using unique new names, not
fragments of existing names. So try:

"import jon.dbpool as logger_dbpool" in the log module and
"import jon.dbpool as site_dbpool" in the site module.

Just a thought.


Robert Brewer
fumanchu@aminus.net

From mike.looijmans at asml.com  Wed Sep 10 07:15:45 2003
From: mike.looijmans at asml.com (Mike Looijmans)
Date: Fri Jan  9 21:53:50 2004
Subject: [mod_python] Handler publisher with multiple directories
	onthesame tree
Message-ID: <01c3775a$965dd680$926a1e6e@wsasd464>

>>My main handler checks if the path_info of the URL is "/request" and if 
>
>How do you check this ?


Uh, basically:

if req.path_info == '/reload':
    return reloadModules(req)

:-)



-- 
The information contained in this communication and any attachments is confidential and may be privileged, and is for the sole use of the intended recipient(s). Any unauthorized review, use, disclosure or distribution is prohibited. If you are not the intended recipient, please notify the sender immediately by replying to this message and destroy all copies of this message and any attachments. ASML is neither liable for the proper and complete transmission of the information contained in this communication, nor for any delay in its receipt.


From gdamjan at mail.net.mk  Wed Sep 10 15:55:38 2003
From: gdamjan at mail.net.mk (Damjan)
Date: Fri Jan  9 21:53:50 2004
Subject: [mod_python] ANNOUNCE: Mod_python 3.1.0 Alpha
In-Reply-To: <20030907180501.B83449@onyx.ispol.com>
References: <20030828210644.C43921@onyx.ispol.com>
	<1062188981.14514.296.camel@heppc22> <1062903891.2713.33.camel@Presario>
	<20030907180501.B83449@onyx.ispol.com>
Message-ID: <20030910135538.GC3575@legolas.on.net.mk>

> > This prompts a change in the kernel semaphore settings on older linuxes
> > (redhat 7.3 specifically).
> 
> Well - I think this is really a redhat problem. I believe I even saw
> something reporting it as a security problem - it is very easy for someone
> to deprive an rh box of available semaphores. I wonder what the default is
> on rh 8 and 9 (anyone?).

Well I have Slackware-9+, and the defaults are not changed from the
kernel defaults:
    damjan$ cat /proc/sys/kernel/sem
    250     32000   32      128

I'm using 
    echo "512     32000   32      512" > /proc/sys/kernel/sem
right now.


-- 
Damjan Georgievski
jabberID: damjan@bagra.net.mk
From pu at vo.lu  Thu Sep 11 23:41:22 2003
From: pu at vo.lu (Patrick Useldinger)
Date: Fri Jan  9 21:53:50 2004
Subject: [mod_python] mod_python 3.1
Message-ID: <oprvcui8zixiz7y9@smtp.vo.lu>

I have read in the mailing list archives that only mod_python 3.1 and 
higher will work with Python 2.3. Is this still correct? If so, when is 
version 3.1 sheduled?
-pu
From barry at python.org  Thu Sep 11 18:20:54 2003
From: barry at python.org (Barry Warsaw)
Date: Fri Jan  9 21:53:50 2004
Subject: [mod_python] mod_python 3.1
In-Reply-To: <oprvcui8zixiz7y9@smtp.vo.lu>
References: <oprvcui8zixiz7y9@smtp.vo.lu>
Message-ID: <1063318854.19907.15.camel@anthem>

On Thu, 2003-09-11 at 17:41, Patrick Useldinger wrote:
> I have read in the mailing list archives that only mod_python 3.1 and 
> higher will work with Python 2.3. Is this still correct? If so, when is 
> version 3.1 sheduled?

modpython 3.0.3 works fine with Python 2.3, but to build it you need to
hack src/include/mod_python.h.  There's a FAQ entry with the necessary
patch.

Maybe Grisha should release a 3.0.4 with just this one patch?

-Barry


From pu at vo.lu  Fri Sep 12 00:31:34 2003
From: pu at vo.lu (Patrick Useldinger)
Date: Fri Jan  9 21:53:50 2004
Subject: [mod_python] mod_python 3.1
In-Reply-To: <1063318854.19907.15.camel@anthem>
References: <oprvcui8zixiz7y9@smtp.vo.lu> <1063318854.19907.15.camel@anthem>
Message-ID: <oprvcwuwc2xiz7y9@smtp.vo.lu>

On 11 Sep 2003 18:20:54 -0400, Barry Warsaw <barry@python.org> wrote:

> modpython 3.0.3 works fine with Python 2.3, but to build it you need to
> hack src/include/mod_python.h.  There's a FAQ entry with the necessary
> patch.
>
> Maybe Grisha should release a 3.0.4 with just this one patch?

I have used the Windows binary version, as I have no C compiler. Releasing 
a binary version for Windows with this one change whould be great.
-PU
From barry at python.org  Thu Sep 11 19:41:19 2003
From: barry at python.org (Barry Warsaw)
Date: Fri Jan  9 21:53:50 2004
Subject: [mod_python] mod_python 3.1
In-Reply-To: <oprvcwuwc2xiz7y9@smtp.vo.lu>
References: <oprvcui8zixiz7y9@smtp.vo.lu> <1063318854.19907.15.camel@anthem>
	 <oprvcwuwc2xiz7y9@smtp.vo.lu>
Message-ID: <1063323679.19907.21.camel@anthem>

On Thu, 2003-09-11 at 18:31, Patrick Useldinger wrote:

> I have used the Windows binary version, as I have no C compiler. Releasing 
> a binary version for Windows with this one change whould be great.

I don't know anything about the Windows version, but AFAIK the only
problem with 3.0.3 and Python 2.3 is the definition of LONG_LONG that
got changed and that should only affect source builds.

-Barry


From grisha at modpython.org  Thu Sep 11 22:54:19 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:53:50 2004
Subject: [mod_python] mod_python 3.1
In-Reply-To: <1063318854.19907.15.camel@anthem>
References: <oprvcui8zixiz7y9@smtp.vo.lu> <1063318854.19907.15.camel@anthem>
Message-ID: <20030911224336.A81795@onyx.ispol.com>


On Thu, 11 Sep 2003, Barry Warsaw wrote:

> On Thu, 2003-09-11 at 17:41, Patrick Useldinger wrote:
> > I have read in the mailing list archives that only mod_python 3.1 and
> > higher will work with Python 2.3. Is this still correct? If so, when is
> > version 3.1 sheduled?
>
> modpython 3.0.3 works fine with Python 2.3, but to build it you need to
> hack src/include/mod_python.h.  There's a FAQ entry with the necessary
> patch.
>
> Maybe Grisha should release a 3.0.4 with just this one patch?

I'm not so sure that there aren't other bugs hiding in there.

Originally I wasn't planning on a 3.0.4 because 3.1 is going to be out
some time soon (whatever that means - we don't really have a schedule).
But we'll think about it. :-)

For right now my "official" take is that mod_python 3.0.3 was released
prior to Python 2.3 and so wasn't meant to be used with it.

Grisha
From partha at addlebrain.com  Thu Sep 11 21:11:27 2003
From: partha at addlebrain.com (Partha Aji)
Date: Fri Jan  9 21:53:50 2004
Subject: [mod_python] Can't load mod_python 3.03 in XP
Message-ID: <20030912041127.A4E1F3CEB@sitemail.everyone.net>

Here is  my configuration

Apache HTTP 2.0.47 - g:\apache\Apache2\
OS -> Win XP Home edition

Python Version ->2.3
TCL Version - > 8.4
Mod Python Version -> 3.0.3
Mod python installation file-> mod_python-3.0.3.win32.exe

I added the following line to httpd.conf 
LoadModule python_module modules/mod_python.so

(I have not been able to run the test yet..)

When I start apache I get the following error message
"
Syntax error on line 139 of G:/apache/Apache2/conf/httpd.conf:
Cannot load G:/apache/Apache2/modules/mod_python.so into server: The specified module could not be found.
Note the errors or messages above, and press the <ESC> key to exit.  25...
"

But when I take a peak at G:/apache/Apache2/modules/  directory I see the mod python file right there any ideas? Is mod python expected to run with python 2.3?
Should I compile mod python manually to fix this (I would rather not do so because I wouldn't know how to do it)? 
Any suggestions will be welcome.. Thanks

Partha


From benjamin-hepp at t-online.de  Fri Sep 12 08:28:38 2003
From: benjamin-hepp at t-online.de (Benjamin)
Date: Fri Jan  9 21:53:51 2004
Subject: [mod_python] Can't load mod_python 3.03 in XP
In-Reply-To: <20030912041127.A4E1F3CEB@sitemail.everyone.net>
Message-ID: <000201c378f7$1a0a3e40$0200a8c0@hebben>


> When I start apache I get the following error message
> "
> Syntax error on line 139 of G:/apache/Apache2/conf/httpd.conf:
> Cannot load G:/apache/Apache2/modules/mod_python.so into server:
> The specified module could not be found.
> Note the errors or messages above, and press the <ESC> key to exit.
25...
> "

As said before mod_python must be patched to work with python 2.3.
Or you just use python 2.2.

Benjamin

From andymorritt at rogers.com  Sat Sep 13 11:08:41 2003
From: andymorritt at rogers.com (Andrew)
Date: Fri Jan  9 21:53:51 2004
Subject: [mod_python] Mod Python 3 Error on Adding into Apache.
Message-ID: <3F6332F9.5050107@rogers.com>

I added mod Python into Apache 2 on Win2k with this line:

LoadModule python_module modules/mod_python.so

And when I try to restart the server it displays:

Syntax error on line 973 of D:/Program Files/Apache 
Group/Apache2/conf/httpd.con
f:
Cannot load D:/Program Files/Apache Group/Apache2/modules/mod_python.so 
into ser
ver: The specified module could not be found.

THe Wierd thing is, When I go to D:/Program Files/Apache 
Group/Apache2/modules/ in WIndows Explorer, I SEE the file mod_python.so.

And when I type into the Address bar D:/Program Files/Apache 
Group/Apache2/modules/mod_python.so, The File download comes up.

Also, I have Perl installed with LoadModule perl_module 
modules/mod_perl.so, so LoadMod. Works.

I googled the Archives for this, but could find nothing.

THanks in Advance
Andrew.

From stian at soiland.no  Sun Sep 14 23:56:03 2003
From: stian at soiland.no (Stian =?iso-8859-1?Q?S=F8iland?=)
Date: Fri Jan  9 21:53:51 2004
Subject: [mod_python] 
	Re: Handler publisher with multiple directories on the same tree
In-Reply-To: <3F5C826A.80404@ualg.pt>
References: <01c375fd$51705d80$926a1e6e@wsasd464> <3F5C826A.80404@ualg.pt>
Message-ID: <20030914215603.GD32114@itea.ntnu.no>

On 2003-09-08 15:21:46, Luis Sousa wrote:

> When I'm developing I usually have a common problem that is when I 
> change a class or some file, sometimes the interpreter remains in memory 
> the old version and doesn't load the new one. Is there a way to solve 
> this out ? Normally I use an non elegant way, I restart apache!

We all do the restart dance.. I even set up a port (1337) that restarted
apache on connections to it. 


-- 
Stian S?iland               Work toward win-win situation. Win-lose
Trondheim, Norway           is where you win and the other lose.
http://www.soiland.no/      Lose-lose and lose-win are left as an
                            exercise to the reader.  [Limoncelli/Hogan]

From stian at soiland.no  Sun Sep 14 23:58:27 2003
From: stian at soiland.no (Stian =?iso-8859-1?Q?S=F8iland?=)
Date: Fri Jan  9 21:53:51 2004
Subject: [mod_python] 
	Re: Handler publisher with multiple directories on 	thesame tree
In-Reply-To: <01c3760e$c26c4100$926a1e6e@wsasd464>
References: <01c3760e$c26c4100$926a1e6e@wsasd464>
Message-ID: <20030914215827.GE32114@itea.ntnu.no>

On 2003-09-08 15:40:26, Mike Looijmans wrote:

> My main handler checks if the path_info of the URL is "/request" and if so,
> runs the following (you could use publisher to publish this interface as
> well). All "my" modules are named "ops_" something. You could also use
> the __file__ location as a filter.

I tried that approach, but the problem is that modules must be reloaded
in "correct" order. For instance, a class in module A that subclasses
something from module B, will not work if A is reloaded before B.

(the A-class will be an instance of the OLD b-class)

The only thing that could work is to del the modules from sys.modules.
However, when I tried that, weird errors occured as if half the
mod_python request, sys, site, os etc. were removed.

Clearly some dirty C-pointer hangarounds or something..

-- 
Stian S?iland               Work toward win-win situation. Win-lose
Trondheim, Norway           is where you win and the other lose.
http://www.soiland.no/      Lose-lose and lose-win are left as an
                            exercise to the reader.  [Limoncelli/Hogan]

From grisha at modpython.org  Mon Sep 15 10:32:10 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:53:51 2004
Subject: [mod_python] Mod Python 3 Error on Adding into Apache.
In-Reply-To: <3F6332F9.5050107@rogers.com>
References: <3F6332F9.5050107@rogers.com>
Message-ID: <20030915102842.X28769@onyx.ispol.com>


This is typically a mismatch of mod_python.so and the version of Python
you have on your system.  For some reason windows says "module cannot be
found" whereas it really means "i had problems loading it".

The mod_python binary available from Apache sites should be compatible
with Python 2.2.x, but not 2.3.

Grisha

On Sat, 13 Sep 2003, Andrew wrote:

> I added mod Python into Apache 2 on Win2k with this line:
>
> LoadModule python_module modules/mod_python.so
>
> And when I try to restart the server it displays:
>
> Syntax error on line 973 of D:/Program Files/Apache
> Group/Apache2/conf/httpd.con
> f:
> Cannot load D:/Program Files/Apache Group/Apache2/modules/mod_python.so
> into ser
> ver: The specified module could not be found.
>
> THe Wierd thing is, When I go to D:/Program Files/Apache
> Group/Apache2/modules/ in WIndows Explorer, I SEE the file mod_python.so.
>
> And when I type into the Address bar D:/Program Files/Apache
> Group/Apache2/modules/mod_python.so, The File download comes up.
>
> Also, I have Perl installed with LoadModule perl_module
> modules/mod_perl.so, so LoadMod. Works.
>
> I googled the Archives for this, but could find nothing.
>
> THanks in Advance
> Andrew.
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From conrad at hep.caltech.edu  Tue Sep 16 19:31:24 2003
From: conrad at hep.caltech.edu (Conrad Steenberg)
Date: Fri Jan  9 21:53:51 2004
Subject: [mod_python] ANNOUNCE: Mod_python 3.1.0 Alpha
In-Reply-To: <20030910135538.GC3575@legolas.on.net.mk>
References: <20030828210644.C43921@onyx.ispol.com>
	<1062903891.2713.33.camel@Presario>
	<20030907180501.B83449@onyx.ispol.com>
	<20030910135538.GC3575@legolas.on.net.mk>
Message-ID: <1063733483.28941.53.camel@Presario>

Hi

Just to add a data point to the discussion: on redhat-7.3 the server
crashes if it cannot allocate enough semaphores. This is with
apache-2.0.47. And no, I can't change that because I'm not root on the
box :-(

Cheers

Conrad

On Wed, 2003-09-10 at 15:55, Damjan wrote:
> > > This prompts a change in the kernel semaphore settings on older linuxes
> > > (redhat 7.3 specifically).
> > 
> > Well - I think this is really a redhat problem. I believe I even saw
> > something reporting it as a security problem - it is very easy for someone
> > to deprive an rh box of available semaphores. I wonder what the default is
> > on rh 8 and 9 (anyone?).
> 
> Well I have Slackware-9+, and the defaults are not changed from the
> kernel defaults:
>     damjan$ cat /proc/sys/kernel/sem
>     250     32000   32      128
> 
> I'm using 
>     echo "512     32000   32      512" > /proc/sys/kernel/sem
> right now.
-- 
Conrad Steenberg <conrad@hep.caltech.edu>
-- 
Conrad Steenberg <conrad@hep.caltech.edu>
From greenbeard400 at yahoo.com  Wed Sep 17 21:42:47 2003
From: greenbeard400 at yahoo.com (Greenbeard)
Date: Fri Jan  9 21:53:51 2004
Subject: [mod_python] File upload
Message-ID: <20030918044247.89511.qmail@web21304.mail.yahoo.com>

Does anyone have a good file upload example?  

When I try something like: 

def upload(req, file):
    tempFile = file.read()
 
I get: AttributeError: File instance has no attribute
'read'

if I use:

    tempFile = req.form['file'] 
I get the file contents but I don't think this would
work well with large files (or would it?) 

Also, 
 
when I try to get attribues like file.type I get 

AttributeError: File instance has no attribute 'type'.
I do get the file.filename.   

So how can I tell if it should be a binary write etc.?

It looks like the publisher handler (which I am using)
returns a File object but I can not get it to act like
a file/StringIO object nor can I accesss the
attributes that are mentioned in the documentation.   


I am using W2k, Python 2.2  and Mod_py 3.0.3.  

Thanks for the help,

gb400



__________________________________
Do you Yahoo!?
Yahoo! SiteBuilder - Free, easy-to-use web site design software
http://sitebuilder.yahoo.com
From davidf at sjsoft.com  Thu Sep 18 09:47:24 2003
From: davidf at sjsoft.com (David Fraser)
Date: Fri Jan  9 21:53:51 2004
Subject: [mod_python] File upload
In-Reply-To: <20030918044247.89511.qmail@web21304.mail.yahoo.com>
References: <20030918044247.89511.qmail@web21304.mail.yahoo.com>
Message-ID: <3F69630C.2090403@sjsoft.com>

Greenbeard wrote:

>Does anyone have a good file upload example?  
>
>When I try something like: 
>
>def upload(req, file):
>    tempFile = file.read()
> 
>I get: AttributeError: File instance has no attribute
>'read'
>
>if I use:
>
>    tempFile = req.form['file'] 
>I get the file contents but I don't think this would
>work well with large files (or would it?) 
>
>Also, 
> 
>when I try to get attribues like file.type I get 
>
>AttributeError: File instance has no attribute 'type'.
>I do get the file.filename.   
>
>So how can I tell if it should be a binary write etc.?
>
>It looks like the publisher handler (which I am using)
>returns a File object but I can not get it to act like
>a file/StringIO object nor can I accesss the
>attributes that are mentioned in the documentation.   
>
>
>I am using W2k, Python 2.2  and Mod_py 3.0.3.  
>
>Thanks for the help,
>
>gb400
>
>
>
>__________________________________
>Do you Yahoo!?
>Yahoo! SiteBuilder - Free, easy-to-use web site design software
>http://sitebuilder.yahoo.com
>_______________________________________________
>Mod_python mailing list
>Mod_python@modpython.org
>http://mailman.modpython.org/mailman/listinfo/mod_python
>
>  
>
Don't know much about publisher, but a normal mod_python handler should 
be able to do something like this (totally untested code):

def handle(req):
  argdict = util.FieldStorage(req)
  for key in argdict.keys():
    value = argdict[key]
    if type(value) == types.InstanceType:
      if isinstance(value, util.StringField):
        # this is for a normal field...
        pass
      elif isinstance(value, util.Field):
        # this is for an attachment upload...
        filename = field.filename
        content_type = field.type
        # this will work by doing a read...
        contents = field.value
        # or you can do the read yourself:
        field.file.seek(0)
        contents = field.file.read()
        # reset the position so others can read it
        field.file.seek(0)



From mgomez at aditel.org  Thu Sep 18 10:04:57 2003
From: mgomez at aditel.org (Maria Gomez)
Date: Fri Jan  9 21:53:51 2004
Subject: [mod_python] File upload
In-Reply-To: <20030918044247.89511.qmail@web21304.mail.yahoo.com>
References: <20030918044247.89511.qmail@web21304.mail.yahoo.com>
Message-ID: <20030918080457.GA30620@aditel.org>

On Wed, Sep 17, 2003 at 09:42:47PM -0700, Greenbeard wrote:
> Does anyone have a good file upload example?  
> 
> When I try something like: 
> 
> def upload(req, file):
>     tempFile = file.read()
>  

   Hi,

   I use to do it as follows:

def CheckingUploadedFile(incoming):
    if incoming is None:
        return 0     # File is empty
    if type(incoming) is str:
        return 0     # File is a string
    return 1

def PrepareFile(file):
    """
        Copies uploaded file in a local directory (CACHE_DIR) and names
		it with its md5, whish is almost unique
    """
    aux = file.read()
    md5_n = "name_of_file"
    cache_file = "%s%s" % (cache_dir , md5_n)
    cache_fd = open(cache_file,'w')
    cache_fd.write(aux)
    cache_fd.close()
    return 1

def Upload(req,incoming):
    if CheckingUploadedFile(incoming):
        #Save file(incoming.file) in the proper directory
        PrepareFile(incoming.file)
		return 1
	else:
		print "There was an uploading error"


   To know more the updated structure of the file is:
['__del__', '__doc__', '__getattr__', '__init__', '__module__',
'__repr__', 'disposition', 'disposition_options', 'file', 'filename',
'headers', 'name', 'type', 'type_options']


    Cheers,

-- 
   Maria Gomez Marti - [octal]

=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*
   http://www.aditel.org/~mgomez
=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=* Linux, porque yo lo valgo 
From is83070 at cis.nctu.edu.tw  Thu Sep 18 17:21:01 2003
From: is83070 at cis.nctu.edu.tw (camge)
Date: Fri Jan  9 21:53:51 2004
Subject: [mod_python] [help]please give an input filter example ?
Message-ID: <007c01c37dc6$32d21050$db64a8c0@camgelo>

Hi ,

    I have written an output filter, and it works fine.
But I dont know how to write an input filter, there are not any examples.
I have tried to write an simple input filter according to an output filter.
But it always makes IE hang there.
If any one can give me an example about input filter?
Thanks a lot!

My environment:
  Apache/2.0.44 (Win32) 
  mod_ssl/2.0.44  
  OpenSSL/0.9.7 
  mod_python/3.0.3 
  Python/2.2.2 

Best regards,
camge
From is83070 at cis.nctu.edu.tw  Thu Sep 18 18:36:25 2003
From: is83070 at cis.nctu.edu.tw (camge)
Date: Fri Jan  9 21:53:51 2004
Subject: [mod_python] [help]please give an input filter example ?
References: <007c01c37dc6$32d21050$db64a8c0@camgelo>
	<3F69851B.3080703@sjsoft.com>
Message-ID: <009d01c37dd0$bc2c5f40$db64a8c0@camgelo>

Below is my simple input filter inputFilter.py:
-------------------------------------------------------------
def inputfilter(filter):
    f=open('filter.log','ab')#for debug
    data='start'
    while data!=None:
        try:
            data = filter.read()
            if data:
                filter.write(data)
                f.write(str(data))
        except Exception,e:
                f.write(str(e))
                data=None
     if data==None:
        filter.close()
     f.close()
----------------------------------------
httpd.conf:
----------------------------------------
<Location /test/>
     PythonInputFilter inputFilter MyInputFilter
     SetInputFilter MyInputFilter
</Location>


----- Original Message ----- 
From: "David Fraser" <davidf@sjsoft.com>
To: "camge" <is83070@cis.nctu.edu.tw>
Sent: Thursday, September 18, 2003 6:12 PM
Subject: Re: [mod_python] [help]please give an input filter example ?


> >camge wrote:
> >
> >Hi ,
> >
> >    I have written an output filter, and it works fine.
> >But I dont know how to write an input filter, there are not any examples.
> >I have tried to write an simple input filter according to an output
filter.
> >But it always makes IE hang there.
> >If any one can give me an example about input filter?
> >Thanks a lot!
> >
> >My environment:
> >  Apache/2.0.44 (Win32)
> >  mod_ssl/2.0.44
> >  OpenSSL/0.9.7
> >  mod_python/3.0.3
> >  Python/2.2.2
> >
> >Best regards,
> >camge
> >
> Why don't you send your example input filter that makes IE hang?
>
> Thanks
> David
>
>

From davidf at sjsoft.com  Thu Sep 18 13:05:19 2003
From: davidf at sjsoft.com (David Fraser)
Date: Fri Jan  9 21:53:51 2004
Subject: [mod_python] [help]please give an input filter example ?
In-Reply-To: <009d01c37dd0$bc2c5f40$db64a8c0@camgelo>
References: <007c01c37dc6$32d21050$db64a8c0@camgelo>
	<3F69851B.3080703@sjsoft.com> <009d01c37dd0$bc2c5f40$db64a8c0@camgelo>
Message-ID: <3F69916F.10406@sjsoft.com>

camge wrote:

>----- Original Message ----- 
>From: "David Fraser" <davidf@sjsoft.com>
>To: "camge" <is83070@cis.nctu.edu.tw>
>Sent: Thursday, September 18, 2003 6:12 PM
>Subject: Re: [mod_python] [help]please give an input filter example ?
>
>
>  
>
>>>camge wrote:
>>>
>>>Hi ,
>>>
>>>   I have written an output filter, and it works fine.
>>>But I dont know how to write an input filter, there are not any examples.
>>>I have tried to write an simple input filter according to an output
>>>      
>>>
>filter.
>  
>
>>>But it always makes IE hang there.
>>>If any one can give me an example about input filter?
>>>Thanks a lot!
>>>
>>>My environment:
>>> Apache/2.0.44 (Win32)
>>> mod_ssl/2.0.44
>>> OpenSSL/0.9.7
>>> mod_python/3.0.3
>>> Python/2.2.2
>>>
>>>Best regards,
>>>camge
>>>
>>>      
>>>
>>Why don't you send your example input filter that makes IE hang?
>>
>>Thanks
>>David
>>
>>
>>    
>>
>
>Below is my simple input filter inputFilter.py:
>-------------------------------------------------------------
>def inputfilter(filter):
>    f=open('filter.log','ab')#for debug
>    data='start'
>    while data!=None:
>        try:
>            data = filter.read()
>            if data:
>                filter.write(data)
>                f.write(str(data))
>        except Exception,e:
>                f.write(str(e))
>                data=None
>     if data==None:
>        filter.close()
>     f.close()
>----------------------------------------
>httpd.conf:
>----------------------------------------
><Location /test/>
>     PythonInputFilter inputFilter MyInputFilter
>     SetInputFilter MyInputFilter
></Location>
>
>
>  
>
Excuse me rearranging your post, bottom posting makes discussion easier...

I think the problem here is that you're doing filter.read() which will 
read until an end of file, which will never happen on an input filter.
You probably need a more intelligent way of working out when to stop 
reading, e.g. for HTTP, you could read a line at a time.
What are you wanting to use the input filter for?

David


From is83070 at cis.nctu.edu.tw  Thu Sep 18 21:32:47 2003
From: is83070 at cis.nctu.edu.tw (camge)
Date: Fri Jan  9 21:53:51 2004
Subject: [mod_python] [help]please give an input filter example ?
References: <007c01c37dc6$32d21050$db64a8c0@camgelo>
	<3F69851B.3080703@sjsoft.com> <009d01c37dd0$bc2c5f40$db64a8c0@camgelo>
	<3F69916F.10406@sjsoft.com>
Message-ID: <000e01c37de9$60cfd0f0$db64a8c0@camgelo>


----- Original Message ----- 
From: "David Fraser" <davidf@sjsoft.com>
To: "camge" <is83070@cis.nctu.edu.tw>
Cc: <mod_python@modpython.org>
Sent: Thursday, September 18, 2003 7:05 PM
Subject: Re: [mod_python] [help]please give an input filter example ?


> camge wrote:
>
> >----- Original Message ----- 
> >From: "David Fraser" <davidf@sjsoft.com>
> >To: "camge" <is83070@cis.nctu.edu.tw>
> >Sent: Thursday, September 18, 2003 6:12 PM
> >Subject: Re: [mod_python] [help]please give an input filter example ?
> >
> >
> >
> >
> >>>camge wrote:
> >>>
> >>>Hi ,
> >>>
> >>>   I have written an output filter, and it works fine.
> >>>But I dont know how to write an input filter, there are not any
examples.
> >>>I have tried to write an simple input filter according to an output
> >>>
> >>>
> >filter.
> >
> >
> >>>But it always makes IE hang there.
> >>>If any one can give me an example about input filter?
> >>>Thanks a lot!
> >>>
> >>>My environment:
> >>> Apache/2.0.44 (Win32)
> >>> mod_ssl/2.0.44
> >>> OpenSSL/0.9.7
> >>> mod_python/3.0.3
> >>> Python/2.2.2
> >>>
> >>>Best regards,
> >>>camge
> >>>
> >>>
> >>>
> >>Why don't you send your example input filter that makes IE hang?
> >>
> >>Thanks
> >>David
> >>
> >>
> >>
> >>
> >
> >Below is my simple input filter inputFilter.py:
> >-------------------------------------------------------------
> >def inputfilter(filter):
> >    f=open('filter.log','ab')#for debug
> >    data='start'
> >    while data!=None:
> >        try:
> >            data = filter.read()
> >            if data:
> >                filter.write(data)
> >                f.write(str(data))
> >        except Exception,e:
> >                f.write(str(e))
> >                data=None
> >     if data==None:
> >        filter.close()
> >     f.close()
> >----------------------------------------
> >httpd.conf:
> >----------------------------------------
> ><Location /test/>
> >     PythonInputFilter inputFilter MyInputFilter
> >     SetInputFilter MyInputFilter
> ></Location>
> >
> >
> >
> >
> Excuse me rearranging your post, bottom posting makes discussion easier...
>
> I think the problem here is that you're doing filter.read() which will
> read until an end of file, which will never happen on an input filter.
> You probably need a more intelligent way of working out when to stop
> reading, e.g. for HTTP, you could read a line at a time.
> What are you wanting to use the input filter for?
>
> David
>
>
>
Thanks for your fast response!
I have tried filter.readline(), but it still reads nothing.
I need input filter to convert character set of form data submitted by cell
phone browser.
For example, convert utf-8 to big5 or gb.
If I can do it in input filter, then I dont need to modify all of my pages.





From alentzos at cosmote.gr  Thu Sep 18 16:45:10 2003
From: alentzos at cosmote.gr (Lentzos Athanassios)
Date: Fri Jan  9 21:53:51 2004
Subject: [mod_python] Load python module problem
Message-ID: <4AEFA010DC6711478C8DA31039641A990142F7B9@AHRMAIL.cosmote.gr>



Hi

I have problem to load the mod_python( ver 3.0.3)  to apache (ver 2.0.47) I have done the configuration according to the instructions but i still
get the following error when i try to start apache server  < " Cannot load c:/program files/apache/apache2/modules/mod_python.so into server:The specified
module could not be found." > ,of course the file is there. /* I have installed Python 2.3  on my PC which runs NT os */  ....Please help!!


Lentzos  .P Athanassios (Greece, Athens)
E-mail	:   alentzos@cosmote.gr


-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mailman.modpython.org/pipermail/mod_python/attachments/20030918/007ef00b/attachment-0001.htm
From idiot1 at netzero.net  Thu Sep 18 12:11:42 2003
From: idiot1 at netzero.net (Kirk Bailey)
Date: Fri Jan  9 21:53:51 2004
Subject: [mod_python] File upload
In-Reply-To: <3F69630C.2090403@sjsoft.com>
References: <20030918044247.89511.qmail@web21304.mail.yahoo.com>
	<3F69630C.2090403@sjsoft.com>
Message-ID: <3F69D93E.8060100@netzero.net>

My wiki, wikinehesa, has a upload in it. Try downloading it, and read the form 
in the footer of the page generated by wikinehesaed1.py, and read the script 
wikinehesaed2.py to see how the thing handles doing an upload.

http://www.tinylist.org/

scan down to the OTHER STUFF section and there is the download for wikinehesa. 
To play with it, up by the top near the hit counter is a link to a working 
install of the wiki.

David Fraser wrote:

> Greenbeard wrote:
> 
>> Does anyone have a good file upload example? 
>> When I try something like:
>> def upload(req, file):
>>    tempFile = file.read()
>>
>> I get: AttributeError: File instance has no attribute
>> 'read'
>>
>> if I use:
>>
>>    tempFile = req.form['file'] I get the file contents but I don't 
>> think this would
>> work well with large files (or would it?)
>> Also,
>> when I try to get attribues like file.type I get
>> AttributeError: File instance has no attribute 'type'.
>> I do get the file.filename.  
>> So how can I tell if it should be a binary write etc.?
>>
>> It looks like the publisher handler (which I am using)
>> returns a File object but I can not get it to act like
>> a file/StringIO object nor can I accesss the
>> attributes that are mentioned in the documentation.  
>>
>> I am using W2k, Python 2.2  and Mod_py 3.0.3. 
>> Thanks for the help,
>>
>> gb400
>>
>>
>>
>> __________________________________
>> Do you Yahoo!?
>> Yahoo! SiteBuilder - Free, easy-to-use web site design software
>> http://sitebuilder.yahoo.com
>> _______________________________________________
>> Mod_python mailing list
>> Mod_python@modpython.org
>> http://mailman.modpython.org/mailman/listinfo/mod_python
>>
>>  
>>
> Don't know much about publisher, but a normal mod_python handler should 
> be able to do something like this (totally untested code):
> 
> def handle(req):
>  argdict = util.FieldStorage(req)
>  for key in argdict.keys():
>    value = argdict[key]
>    if type(value) == types.InstanceType:
>      if isinstance(value, util.StringField):
>        # this is for a normal field...
>        pass
>      elif isinstance(value, util.Field):
>        # this is for an attachment upload...
>        filename = field.filename
>        content_type = field.type
>        # this will work by doing a read...
>        contents = field.value
>        # or you can do the read yourself:
>        field.file.seek(0)
>        contents = field.file.read()
>        # reset the position so others can read it
>        field.file.seek(0)
> 
> 
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
> 
> 

-- 

-- 

end

Cheers!
         Kirk D Bailey

  +                              think                                +
   http://www.howlermonkey.net  +-----+        http://www.tinylist.org
   http://www.listville.net     | BOX |  http://www.sacredelectron.org
   Thou art free"-ERIS          +-----+     'Got a light?'-Prometheus
  +                              kniht                                +

Fnord.

From grisha at modpython.org  Thu Sep 18 11:09:25 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:53:51 2004
Subject: [mod_python] File upload
In-Reply-To: <20030918044247.89511.qmail@web21304.mail.yahoo.com>
References: <20030918044247.89511.qmail@web21304.mail.yahoo.com>
Message-ID: <20030918110558.I77494@onyx.ispol.com>


On Wed, 17 Sep 2003, Greenbeard wrote:

> Does anyone have a good file upload example?
>
> When I try something like:
>
> def upload(req, file):
>     tempFile = file.read()

I think it should be file.file.read(). You also may want to make sure that
it's a file upload first - you can do this by testing for existance of a
filename attribute, e.g. hasattr(file, "filename), or, more accurately,
you can make sure it's an instance of util.Field:

	if isinstance(file, util.Field):
		data = file.file.read()
	else:
		return "This is not a file"

Grisha
From davidf at sjsoft.com  Thu Sep 18 18:02:34 2003
From: davidf at sjsoft.com (David Fraser)
Date: Fri Jan  9 21:53:51 2004
Subject: [mod_python] [help]please give an input filter example ?
In-Reply-To: <000e01c37de9$60cfd0f0$db64a8c0@camgelo>
References: <007c01c37dc6$32d21050$db64a8c0@camgelo>
	<3F69851B.3080703@sjsoft.com> <009d01c37dd0$bc2c5f40$db64a8c0@camgelo>
	<3F69916F.10406@sjsoft.com> <000e01c37de9$60cfd0f0$db64a8c0@camgelo>
Message-ID: <3F69D71A.8080005@sjsoft.com>

camge wrote:

>----- Original Message ----- 
>From: "David Fraser" <davidf@sjsoft.com>
>To: "camge" <is83070@cis.nctu.edu.tw>
>Cc: <mod_python@modpython.org>
>Sent: Thursday, September 18, 2003 7:05 PM
>Subject: Re: [mod_python] [help]please give an input filter example ?
>
>
>  
>
>>camge wrote:
>>
>>    
>>
>>>----- Original Message ----- 
>>>From: "David Fraser" <davidf@sjsoft.com>
>>>To: "camge" <is83070@cis.nctu.edu.tw>
>>>Sent: Thursday, September 18, 2003 6:12 PM
>>>Subject: Re: [mod_python] [help]please give an input filter example ?
>>>
>>>
>>>
>>>
>>>      
>>>
>>>>>camge wrote:
>>>>>
>>>>>Hi ,
>>>>>
>>>>>  I have written an output filter, and it works fine.
>>>>>But I dont know how to write an input filter, there are not any
>>>>>          
>>>>>
>examples.
>  
>
>>>>>I have tried to write an simple input filter according to an output
>>>>>
>>>>>
>>>>>          
>>>>>
>>>filter.
>>>
>>>
>>>      
>>>
>>>>>But it always makes IE hang there.
>>>>>If any one can give me an example about input filter?
>>>>>Thanks a lot!
>>>>>
>>>>>My environment:
>>>>>Apache/2.0.44 (Win32)
>>>>>mod_ssl/2.0.44
>>>>>OpenSSL/0.9.7
>>>>>mod_python/3.0.3
>>>>>Python/2.2.2
>>>>>
>>>>>Best regards,
>>>>>camge
>>>>>
>>>>>
>>>>>
>>>>>          
>>>>>
>>>>Why don't you send your example input filter that makes IE hang?
>>>>
>>>>Thanks
>>>>David
>>>>
>>>>
>>>>
>>>>
>>>>        
>>>>
>>>Below is my simple input filter inputFilter.py:
>>>-------------------------------------------------------------
>>>def inputfilter(filter):
>>>   f=open('filter.log','ab')#for debug
>>>   data='start'
>>>   while data!=None:
>>>       try:
>>>           data = filter.read()
>>>           if data:
>>>               filter.write(data)
>>>               f.write(str(data))
>>>       except Exception,e:
>>>               f.write(str(e))
>>>               data=None
>>>    if data==None:
>>>       filter.close()
>>>    f.close()
>>>----------------------------------------
>>>httpd.conf:
>>>----------------------------------------
>>><Location /test/>
>>>    PythonInputFilter inputFilter MyInputFilter
>>>    SetInputFilter MyInputFilter
>>></Location>
>>>
>>>
>>>
>>>
>>>      
>>>
>>Excuse me rearranging your post, bottom posting makes discussion easier...
>>
>>I think the problem here is that you're doing filter.read() which will
>>read until an end of file, which will never happen on an input filter.
>>You probably need a more intelligent way of working out when to stop
>>reading, e.g. for HTTP, you could read a line at a time.
>>What are you wanting to use the input filter for?
>>
>>David
>>
>>
>>
>>    
>>
>Thanks for your fast response!
>I have tried filter.readline(), but it still reads nothing.
>  
>
That's a pleasure. OK, I don't really know anything about input filters, 
I was just pretending... maybe some else can help

>I need input filter to convert character set of form data submitted by cell
>phone browser.
>For example, convert utf-8 to big5 or gb.
>If I can do it in input filter, then I dont need to modify all of my pages.
>  
>
Aha. What I would do is just put a function in a module that changes the 
encoding.
Get the arguments like you normally would, then just do a decode/encode.
Since that module can be accessed from anywhere, it will work just as well.
Also, it's less likely to cause bugs, and will probably be faster 
(you'll only making one jump into the Python interpreter and back)

Cheers
David


From sgillies at frii.com  Thu Sep 18 12:10:07 2003
From: sgillies at frii.com (Sean Gillies)
Date: Fri Jan  9 21:53:51 2004
Subject: [mod_python] 
	UnicodeEncodeError using mod_python-3.0.3 with Python 2.3
Message-ID: <55E7BB6E-EA03-11D7-9809-000393B98B56@frii.com>

Hi,

I'm running into problems with UnicodeEncodeErrors using  
mod_python-3.0.3 with
Python 2.3 on OS X.  Yes, I know I'm asking for trouble with this  
combination,
but I'm leery of replacing Apple's Python 2.2 (which doesn't work with  
mod_python).
All in all, my application is working, but will eventually (and  
unpredictably)
stop and raise this error:

Mod_python error: "PythonHandler mod_python.publisher"

Traceback (most recent call last):

   File  
"/Library/Frameworks/Python.framework/Versions/2.3/lib/python2.3/site- 
packages/mod_python/apache.py", line 332, in HandlerDispatch
     result = object(req)

   File  
"/Library/Frameworks/Python.framework/Versions/2.3/lib/python2.3/site- 
packages/mod_python/publisher.py", line 201, in handler
     result = str(result)

UnicodeEncodeError: 'ascii' codec can't encode character '\u3137' in  
position 412: ordinal not in range(128)

Anybody else using Python 2.3 who has seen this?  I really don't  
understand the error,
it's always '\u3137', and I'm _not_ (to my knowledge) using any unicode  
strings.  I am
using Zope's Page Templates, but I don't see where the page templates  
would be introducing
'\u3137' (the hangul letter tikeut?!).

My module is published with no problems on Linux (KRUD) with  
mod_python-3.0.1 and
Python 2.2.3, so I'm presently living with this problem on my notebook  
and counting
on its absence on the server.

Sean

--
Sean Gillies
sgillies at frii dot com
http://www.frii.com/~sgillies

From perry.tew at cibavision.novartis.com  Thu Sep 18 15:50:04 2003
From: perry.tew at cibavision.novartis.com (perry.tew@cibavision.novartis.com)
Date: Fri Jan  9 21:53:51 2004
Subject: [mod_python] 
	does a mod_python handler exist to generate charts/graphs? (png
	images)
Message-ID: <OF62DF2337.F24A4A42-ON85256DA5.006CA077-85256DA5.006CF44A@EU.novartis.net>

Hello everyone,
   I was about the go down the road of developing a handler to generate 
charts,
similar to the mod_perl Apache::GD::Graph.  I wanted to make sure 
something doesn't exist
before I reinvent the wheel.  Does anyone know of such a thing yet?  If 
so, would you please
provide a url?

Thanks,
Perry Tew
From davidf at sjsoft.com  Thu Sep 18 22:25:46 2003
From: davidf at sjsoft.com (David Fraser)
Date: Fri Jan  9 21:53:51 2004
Subject: [mod_python] 	UnicodeEncodeError using mod_python-3.0.3 with
	Python 2.3
In-Reply-To: <55E7BB6E-EA03-11D7-9809-000393B98B56@frii.com>
References: <55E7BB6E-EA03-11D7-9809-000393B98B56@frii.com>
Message-ID: <3F6A14CA.9030008@sjsoft.com>

Sean Gillies wrote:

> Hi,
>
> I'm running into problems with UnicodeEncodeErrors using  
> mod_python-3.0.3 with
> Python 2.3 on OS X.  Yes, I know I'm asking for trouble with this  
> combination,
> but I'm leery of replacing Apple's Python 2.2 (which doesn't work 
> with  mod_python).
> All in all, my application is working, but will eventually (and  
> unpredictably)
> stop and raise this error:
>
> Mod_python error: "PythonHandler mod_python.publisher"
>
> Traceback (most recent call last):
>
>   File  
> "/Library/Frameworks/Python.framework/Versions/2.3/lib/python2.3/site- 
> packages/mod_python/apache.py", line 332, in HandlerDispatch
>     result = object(req)
>
>   File  
> "/Library/Frameworks/Python.framework/Versions/2.3/lib/python2.3/site- 
> packages/mod_python/publisher.py", line 201, in handler
>     result = str(result)
>
> UnicodeEncodeError: 'ascii' codec can't encode character '\u3137' in  
> position 412: ordinal not in range(128)
>
> Anybody else using Python 2.3 who has seen this?  I really don't  
> understand the error,
> it's always '\u3137', and I'm _not_ (to my knowledge) using any 
> unicode  strings.  I am
> using Zope's Page Templates, but I don't see where the page templates  
> would be introducing
> '\u3137' (the hangul letter tikeut?!).
>
> My module is published with no problems on Linux (KRUD) with  
> mod_python-3.0.1 and
> Python 2.2.3, so I'm presently living with this problem on my 
> notebook  and counting
> on its absence on the server.
>
> Sean
>
> -- 

Try doing things like:
  if type(result) == unicode:
    result = result.encode('iso8859')
You can look up different encodings in the encodings module. The above 
works well for me...
I think you should be able to get the browser's desired encodings from 
the headers sent to the request.

Hope that helps
David


From davidf at sjsoft.com  Thu Sep 18 22:27:29 2003
From: davidf at sjsoft.com (David Fraser)
Date: Fri Jan  9 21:53:51 2004
Subject: [mod_python] 	does a mod_python handler exist to generate
	charts/graphs? (png	images)
In-Reply-To: <OF62DF2337.F24A4A42-ON85256DA5.006CA077-85256DA5.006CF44A@EU.novartis.net>
References: <OF62DF2337.F24A4A42-ON85256DA5.006CA077-85256DA5.006CF44A@EU.novartis.net>
Message-ID: <3F6A1531.5050609@sjsoft.com>

perry.tew@cibavision.novartis.com wrote:

>Hello everyone,
>   I was about the go down the road of developing a handler to generate 
>charts,
>similar to the mod_perl Apache::GD::Graph.  I wanted to make sure 
>something doesn't exist
>before I reinvent the wheel.  Does anyone know of such a thing yet?  If 
>so, would you please
>provide a url?
>
>Thanks,
>Perry Tew
>
There are several Python graphing packages which you could use towards 
this end, the question is how nicely will they plug into a web environment.
I am not aware of any that are set up to do this using mod_python.
I'm also busy looking at the problem, for an application we are 
currently converting to be web based, so discuss plans / things you find 
here and I will to and hopefully we can come up with a nice solution...

Thanks,
David


From perry.tew at cibavision.novartis.com  Thu Sep 18 16:38:09 2003
From: perry.tew at cibavision.novartis.com (perry.tew@cibavision.novartis.com)
Date: Fri Jan  9 21:53:51 2004
Subject: [mod_python] 	does a mod_python handler exist to generate
	charts/graphs? (png	images)
Message-ID: <OF3D2E11CE.51A41DD0-ON85256DA5.0070BC96-85256DA5.00715B65@EU.novartis.net>

David,
  Thanks for the information.  I was looking at using pygdchart2 from 
nullcube.  I was pleased with the interface they've written.  Have you any 
experience with them?  I figured it shouldn't be technically difficult to 
create an interface of parameters that mapped to chart settings.

The only concern I have so far is the method of outputting the chart once 
rendered.  The examples use the draw method:
"""
 chart.draw(filespec)
Draw the graph to the specified file. If the filespec argument is a 
string, it will be treated as the path to a file. Otherwise, filespec is 
assumed to be a Python file object.
"""

I'm new to mod_python, so I'm not sure how to pass the output stream of 
the request object to the draw() method.  If you know, I'm be grateful. If 
not, I'll work at it.  I haven't really dug yet.

btw,   I saw your post earlier about your wiki.  While cruising your site 
I found a MLM I was in need for.  Thanks!

Perry Tew



perry.tew@cibavision.novartis.com wrote:

>Hello everyone,
>   I was about the go down the road of developing a handler to generate 
>charts,
>similar to the mod_perl Apache::GD::Graph.  I wanted to make sure 
>something doesn't exist
>before I reinvent the wheel.  Does anyone know of such a thing yet?  If 
>so, would you please
>provide a url?
>
>Thanks,
>Perry Tew
>
There are several Python graphing packages which you could use towards 
this end, the question is how nicely will they plug into a web 
environment.
I am not aware of any that are set up to do this using mod_python.
I'm also busy looking at the problem, for an application we are 
currently converting to be web based, so discuss plans / things you find 
here and I will to and hopefully we can come up with a nice solution...

Thanks,
David





From davidf at sjsoft.com  Thu Sep 18 22:45:25 2003
From: davidf at sjsoft.com (David Fraser)
Date: Fri Jan  9 21:53:51 2004
Subject: [mod_python] 	does a mod_python handler exist to generate
	charts/graphs? (png	images)
In-Reply-To: <OF3D2E11CE.51A41DD0-ON85256DA5.0070BC96-85256DA5.00715B65@EU.novartis.net>
References: <OF3D2E11CE.51A41DD0-ON85256DA5.0070BC96-85256DA5.00715B65@EU.novartis.net>
Message-ID: <3F6A1965.2040506@sjsoft.com>

perry.tew@cibavision.novartis.com wrote:

>>perry.tew@cibavision.novartis.com wrote:
>>
>>>Hello everyone,
>>>  I was about the go down the road of developing a handler to generate 
>>>charts,
>>>similar to the mod_perl Apache::GD::Graph.  I wanted to make sure 
>>>something doesn't exist
>>>before I reinvent the wheel.  Does anyone know of such a thing yet?  If 
>>>so, would you please
>>>provide a url?
>>>
>>>Thanks,
>>>Perry Tew
>>
>> There are several Python graphing packages which you could use towards
>>
>>this end, the question is how nicely will they plug into a web 
>>environment.
>>I am not aware of any that are set up to do this using mod_python.
>>I'm also busy looking at the problem, for an application we are 
>>currently converting to be web based, so discuss plans / things you find 
>>here and I will to and hopefully we can come up with a nice solution...
>>
>>Thanks,
>>David
>>
>
>David,
>  Thanks for the information.  I was looking at using pygdchart2 from 
>nullcube.  I was pleased with the interface they've written.  Have you any 
>experience with them?  I figured it shouldn't be technically difficult to 
>create an interface of parameters that mapped to chart settings.
>  
>
I haven't had, but will look at it, do you have a URL?

>The only concern I have so far is the method of outputting the chart once 
>rendered.  The examples use the draw method:
>"""
> chart.draw(filespec)
>Draw the graph to the specified file. If the filespec argument is a 
>string, it will be treated as the path to a file. Otherwise, filespec is 
>assumed to be a Python file object.
>"""
>
>I'm new to mod_python, so I'm not sure how to pass the output stream of 
>the request object to the draw() method.  If you know, I'm be grateful. If 
>not, I'll work at it.  I haven't really dug yet.
>  
>
This kind of thing is pretty simple, you can either create a 
StringIO.StringIO object (standard Python) which is a pseudo-file that 
you can get the contents out of using a string, or you could try passing 
the request object (at the appropriate time) and see if it will work 
writing to that.
Another option (assuming the project is open source) is to alter the 
program to support returning the data in a string.
I got the reportlab guys to do this - their project is mainly focussed 
on Reports and PDF, but it also has charting capabilities I haven't 
investigated.
The other charting toolkit I am aware of is Chaco.

I think it would be good to investigate all of them and at least draw up 
a list of their strengths/weaknesses for use in a web server context, 
that might be helpful to other users. Would be good to have a list of 
requirements to evaluate these packages by e.g. how big the package is, 
able to produce different image formats, etc.

>btw,   I saw your post earlier about your wiki.  While cruising your site 
>I found a MLM I was in need for.  Thanks!
>  
>
Sure, but I think it was somebody else replying to my message, I don't 
have a wiki...

>Perry Tew
>  
>
David

PS hope you don't mind me rearranging your post, bottom-posting makes 
the flow easier to see.

From davidf at sjsoft.com  Thu Sep 18 22:49:35 2003
From: davidf at sjsoft.com (David Fraser)
Date: Fri Jan  9 21:53:51 2004
Subject: [mod_python]  does a mod_python handler exist to generate
	charts/graphs? (png images)
In-Reply-To: <Pine.LNX.4.44.0309181636440.1176-100000@q.cis.uoguelph.ca>
References: <Pine.LNX.4.44.0309181636440.1176-100000@q.cis.uoguelph.ca>
Message-ID: <3F6A1A5F.9000703@sjsoft.com>

Stefan C. Kremer wrote:

>You might want to check out:
>
>http://gnuplot-py.sourceforge.net/
>
>and consider interfacing it with mod_python.  I've used it with python and 
>been very happy (though I really like gnuplot to start with, so I'm 
>biased), but have not used it with mod_python.
>
>	Stefan
>  
>
Thanks Stefan, we'll add it to the list...
David

>On Thu, 18 Sep 2003, David Fraser wrote:
>
>  
>
>>perry.tew@cibavision.novartis.com wrote:
>>
>>    
>>
>>>Hello everyone,
>>>  I was about the go down the road of developing a handler to generate 
>>>charts,
>>>similar to the mod_perl Apache::GD::Graph.  I wanted to make sure 
>>>something doesn't exist
>>>before I reinvent the wheel.  Does anyone know of such a thing yet?  If 
>>>so, would you please
>>>provide a url?
>>>
>>>Thanks,
>>>Perry Tew
>>>
>>>      
>>>
>>There are several Python graphing packages which you could use towards 
>>this end, the question is how nicely will they plug into a web environment.
>>I am not aware of any that are set up to do this using mod_python.
>>I'm also busy looking at the problem, for an application we are 
>>currently converting to be web based, so discuss plans / things you find 
>>here and I will to and hopefully we can come up with a nice solution...
>>
>>Thanks,
>>David
>>
>>
>>_______________________________________________
>>Mod_python mailing list
>>Mod_python@modpython.org
>>http://mailman.modpython.org/mailman/listinfo/mod_python
>>
>>    
>>
>
>  
>


From sgillies at frii.com  Thu Sep 18 15:45:32 2003
From: sgillies at frii.com (Sean Gillies)
Date: Fri Jan  9 21:53:51 2004
Subject: [mod_python] 	UnicodeEncodeError using mod_python-3.0.3 with
	Python 2.3
In-Reply-To: <3F6A14CA.9030008@sjsoft.com>
Message-ID: <6D706C13-EA21-11D7-874F-000393B98B56@frii.com>

On Thursday, September 18, 2003, at 02:25  PM, David Fraser wrote:

> Sean Gillies wrote:
>
>> Hi,
>>
>> I'm running into problems with UnicodeEncodeErrors using   
>> mod_python-3.0.3 with
>> Python 2.3 on OS X.  Yes, I know I'm asking for trouble with this   
>> combination,
>> but I'm leery of replacing Apple's Python 2.2 (which doesn't work  
>> with  mod_python).
>> All in all, my application is working, but will eventually (and   
>> unpredictably)
>> stop and raise this error:
>>
>> Mod_python error: "PythonHandler mod_python.publisher"
>>
>> Traceback (most recent call last):
>>
>>   File   
>> "/Library/Frameworks/Python.framework/Versions/2.3/lib/python2.3/ 
>> site- packages/mod_python/apache.py", line 332, in HandlerDispatch
>>     result = object(req)
>>
>>   File   
>> "/Library/Frameworks/Python.framework/Versions/2.3/lib/python2.3/ 
>> site- packages/mod_python/publisher.py", line 201, in handler
>>     result = str(result)
>>
>> UnicodeEncodeError: 'ascii' codec can't encode character '\u3137' in   
>> position 412: ordinal not in range(128)
>>
>> Anybody else using Python 2.3 who has seen this?  I really don't   
>> understand the error,
>> it's always '\u3137', and I'm _not_ (to my knowledge) using any  
>> unicode  strings.  I am
>> using Zope's Page Templates, but I don't see where the page templates  
>>  would be introducing
>> '\u3137' (the hangul letter tikeut?!).
>>
>> My module is published with no problems on Linux (KRUD) with   
>> mod_python-3.0.1 and
>> Python 2.2.3, so I'm presently living with this problem on my  
>> notebook  and counting
>> on its absence on the server.
>>
>> Sean
>>
>> -- 
>
> Try doing things like:
>  if type(result) == unicode:
>    result = result.encode('iso8859')
> You can look up different encodings in the encodings module. The above  
> works well for me...
> I think you should be able to get the browser's desired encodings from  
> the headers sent to the request.
>
> Hope that helps
> David
>

David,

Thanks for the suggestion.  The Zope page template's __call__ method
does indeed return unicode and I've made your change to publisher.py.
Working good.  I also thought about catching the UnicodeEncodeError
like

     if result:
         try:
             result = str(result)
         except UnicodeEncodeError:
             result = str(result.encode('iso8859'))

since str(result) wasn't raising an error every time.

cheers,
Sean

--
Sean Gillies
sgillies at frii dot com
http://www.frii.com/~sgillies

From is83070 at cis.nctu.edu.tw  Fri Sep 19 11:09:14 2003
From: is83070 at cis.nctu.edu.tw (camge)
Date: Fri Jan  9 21:53:51 2004
Subject: [mod_python] [help]please give an input filter example ?
References: <007c01c37dc6$32d21050$db64a8c0@camgelo>
	<3F69851B.3080703@sjsoft.com> <009d01c37dd0$bc2c5f40$db64a8c0@camgelo>
	<3F69916F.10406@sjsoft.com> <000e01c37de9$60cfd0f0$db64a8c0@camgelo>
	<3F69D71A.8080005@sjsoft.com>
Message-ID: <002c01c37e5b$71210920$db64a8c0@camgelo>

> >I need input filter to convert character set of form data submitted by
cell
> >phone browser.
> >For example, convert utf-8 to big5 or gb.
> >If I can do it in input filter, then I dont need to modify all of my
pages.
> >
> >
> Aha. What I would do is just put a function in a module that changes the
> encoding.
> Get the arguments like you normally would, then just do a decode/encode.
> Since that module can be accessed from anywhere, it will work just as
well.
> Also, it's less likely to cause bugs, and will probably be faster
> (you'll only making one jump into the Python interpreter and back)
>
> Cheers
> David
>
Thanks for your suggestion!
But my web server serve not only wap browser but also Pocket IE and IE,
and they all use same module(for easy maintenance).
Adding this function in these modules will be a terrible thing,
because I dont need to convert character encoding for Pocket IE and IE.

If I can do it in input filter, I don't need to modify any things in
original module.

regards,
camge


From alentzos at cosmote.gr  Fri Sep 19 13:44:32 2003
From: alentzos at cosmote.gr (Lentzos Athanassios)
Date: Fri Jan  9 21:53:52 2004
Subject: =?iso-8859-7?Q?=D0=D1=3A_=5Bmod=5Fpython=5D_Load_python_module_problem?=
Message-ID: <4AEFA010DC6711478C8DA31039641A990149D2BD@AHRMAIL.cosmote.gr>

Skipped content of type multipart/alternative-------------- next part --------------
_______________________________________________
Mod_python mailing list
Mod_python@modpython.org
http://mailman.modpython.org/mailman/listinfo/mod_python
From perry.tew at cibavision.novartis.com  Fri Sep 19 09:59:35 2003
From: perry.tew at cibavision.novartis.com (perry.tew@cibavision.novartis.com)
Date: Fri Jan  9 21:53:52 2004
Subject: [mod_python] 	does a mod_python handler exist to generate
	charts/graphs? (png	images)
Message-ID: <OFACFE0A3B.CBD0AC18-ON85256DA6.004B1817-85256DA6.004CDDEC@EU.novartis.net>

David,
   Thanks for the input.  I'll add chaco and gnuplot.py to the list.  So 
far I have (in no order):

reportlab
pygdchart
chaco
gnuplot

I'll have to start investigating each of them.  chaco and gnuplot appear 
to have massive options and functionality.


In response to your earlier suggestions:
"""
This kind of thing is pretty simple, you can either create a 
StringIO.StringIO object (standard Python) which is a pseudo-file that 
you can get the contents out of using a string, or you could try passing 
the request object (at the appropriate time) and see if it will work 
writing to that.
Another option (assuming the project is open source) is to alter the 
program to support returning the data in a string.
I got the reportlab guys to do this - their project is mainly focussed 
on Reports and PDF, but it also has charting capabilities I haven't 
investigated.
"""

I tried to use the StringIO object from both StringIO and cStringIO.  The 
library didn't like
that at all.  I traced some of the pygdchart code.  It drops down into C 
and calls the following code (from _gdchartc.c)
( I stripped out some unnecessary lines):
PyObject *pfile, *labels, *data, *combodata;
FILE *fp;
...
if (!PyArg_ParseTuple(args, "iiO!iiOiOO", &width, &height, &PyFile_Type, 
&pfile, 
...
fp = PyFile_AsFile(pfile);

I so new to python it hurts, but I'm guessing that at this point in a C 
program, pfile has to be an
actual pointer to a file and not a file-like interface such as StringIO? 
Any experience with this?

As for having the author change the interface, I've already emailed them. 
Later on I found
the cStringIO functionality listed in a TODO file for the pygdchart 
library.  Guess I'm not the first...
I don't know how possible it would be to use cStringIO, since the FILE 
pointer is passed through a mess of C libraries

gdchart -> gd -> libjpeg

The functions all the way down to libjpeg are wanting a pointer to a FILE 
structure.   My other thought was
looking for a way to imitate the FILE pointer in memory and modifying the 
entry C code to return back the
in memory data as a binary stream.  I'll have to look into that as well. 
My C is pretty weak as well.  I'm
so thankful there's Google.

As a workaround, here's what I did (using os.tmpfile):

from mod_python import apache
from mod_python import util
import gdchart
import os

def handler(req):
        req.content_type = "image/png"

        chart = gdchart.Line3D()
        chart.width = 250
        chart.height = 250
        chart.xtitle = "xtitle goes here"
        chart.ytitle = "Percentage"
        chart.title = "Example Graph"
        chart.ext_color = [ "white", "yellow", "red", "blue", "green"]
        chart.setData([20, 100, 80, 30, 50],[10,150,20,25,65])
        chart.setLabels(["Mon", "Tue", "Wed", "Thu", "Fri"])
        chart.setLabels(["Mon", "Tue", "Wed", "Thu", "Fri"])

        f = os.tmpfile()
        chart.draw(f)
        f.seek(0)
        req.write(f.read())
        f.close()

        return apache.OK

It outputs a graph for me.    Here's another question that may be 
better suited for comp.lang.python, but do you know if
os.tmpfile() uses an in-memory representation of a file
or does it use a physical file that just remains anonymous?  I'm 
concerned about the wasteful loss of speed having to write to
disk and read it back.

Well, enough rambling.  Thanks for your time,
Perry Tew












David Fraser <davidf@sjsoft.com>
09/18/2003 04:45 PM

 
        To:     Perry Tew/CV/Novartis@PH
        cc:     mod_python@modpython.org
        Subject:        Re: [mod_python]        does a mod_python handler exist to generate 
charts/graphs? (png     images)


perry.tew@cibavision.novartis.com wrote:

>>perry.tew@cibavision.novartis.com wrote:
>>
>>>Hello everyone,
>>>  I was about the go down the road of developing a handler to generate 
>>>charts,
>>>similar to the mod_perl Apache::GD::Graph.  I wanted to make sure 
>>>something doesn't exist
>>>before I reinvent the wheel.  Does anyone know of such a thing yet?  If 

>>>so, would you please
>>>provide a url?
>>>
>>>Thanks,
>>>Perry Tew
>>
>> There are several Python graphing packages which you could use towards
>>
>>this end, the question is how nicely will they plug into a web 
>>environment.
>>I am not aware of any that are set up to do this using mod_python.
>>I'm also busy looking at the problem, for an application we are 
>>currently converting to be web based, so discuss plans / things you find 

>>here and I will to and hopefully we can come up with a nice solution...
>>
>>Thanks,
>>David
>>
>
>David,
>  Thanks for the information.  I was looking at using pygdchart2 from 
>nullcube.  I was pleased with the interface they've written.  Have you 
any 
>experience with them?  I figured it shouldn't be technically difficult to 

>create an interface of parameters that mapped to chart settings.
> 
>
I haven't had, but will look at it, do you have a URL?

>The only concern I have so far is the method of outputting the chart once 

>rendered.  The examples use the draw method:
>"""
> chart.draw(filespec)
>Draw the graph to the specified file. If the filespec argument is a 
>string, it will be treated as the path to a file. Otherwise, filespec is 
>assumed to be a Python file object.
>"""
>
>I'm new to mod_python, so I'm not sure how to pass the output stream of 
>the request object to the draw() method.  If you know, I'm be grateful. 
If 
>not, I'll work at it.  I haven't really dug yet.
> 
>
This kind of thing is pretty simple, you can either create a 
StringIO.StringIO object (standard Python) which is a pseudo-file that 
you can get the contents out of using a string, or you could try passing 
the request object (at the appropriate time) and see if it will work 
writing to that.
Another option (assuming the project is open source) is to alter the 
program to support returning the data in a string.
I got the reportlab guys to do this - their project is mainly focussed 
on Reports and PDF, but it also has charting capabilities I haven't 
investigated.
The other charting toolkit I am aware of is Chaco.

I think it would be good to investigate all of them and at least draw up 
a list of their strengths/weaknesses for use in a web server context, 
that might be helpful to other users. Would be good to have a list of 
requirements to evaluate these packages by e.g. how big the package is, 
able to produce different image formats, etc.

>btw,   I saw your post earlier about your wiki.  While cruising your site 

>I found a MLM I was in need for.  Thanks!
> 
>
Sure, but I think it was somebody else replying to my message, I don't 
have a wiki...

>Perry Tew
> 
>
David

PS hope you don't mind me rearranging your post, bottom-posting makes 
the flow easier to see.




From davidf at sjsoft.com  Fri Sep 19 16:18:16 2003
From: davidf at sjsoft.com (David Fraser)
Date: Fri Jan  9 21:53:52 2004
Subject: [mod_python] 	does a mod_python handler exist to generate
	charts/graphs? (png	images)
In-Reply-To: <OFACFE0A3B.CBD0AC18-ON85256DA6.004B1817-85256DA6.004CDDEC@EU.novartis.net>
References: <OFACFE0A3B.CBD0AC18-ON85256DA6.004B1817-85256DA6.004CDDEC@EU.novartis.net>
Message-ID: <3F6B1028.3040101@sjsoft.com>

perry.tew@cibavision.novartis.com wrote:

>David,
>   Thanks for the input.  I'll add chaco and gnuplot.py to the list.  So 
>far I have (in no order):
>
>reportlab
>pygdchart
>chaco
>gnuplot
>
>I'll have to start investigating each of them.  chaco and gnuplot appear 
>to have massive options and functionality.
>  
>
Great. I'm away for the next few days so it'll be interesting to see 
what you find.

>
>In response to your earlier suggestions:
>"""
>This kind of thing is pretty simple, you can either create a 
>StringIO.StringIO object (standard Python) which is a pseudo-file that 
>you can get the contents out of using a string, or you could try passing 
>the request object (at the appropriate time) and see if it will work 
>writing to that.
>Another option (assuming the project is open source) is to alter the 
>program to support returning the data in a string.
>I got the reportlab guys to do this - their project is mainly focussed 
>on Reports and PDF, but it also has charting capabilities I haven't 
>investigated.
>"""
>
>I tried to use the StringIO object from both StringIO and cStringIO.  The 
>library didn't like
>that at all.  I traced some of the pygdchart code.  It drops down into C 
>and calls the following code (from _gdchartc.c)
>( I stripped out some unnecessary lines):
>PyObject *pfile, *labels, *data, *combodata;
>FILE *fp;
>...
>if (!PyArg_ParseTuple(args, "iiO!iiOiOO", &width, &height, &PyFile_Type, 
>&pfile, 
>...
>fp = PyFile_AsFile(pfile);
>
>I so new to python it hurts, but I'm guessing that at this point in a C 
>program, pfile has to be an
>actual pointer to a file and not a file-like interface such as StringIO? 
>Any experience with this?
>
>As for having the author change the interface, I've already emailed them. 
>Later on I found
>the cStringIO functionality listed in a TODO file for the pygdchart 
>library.  Guess I'm not the first...
>I don't know how possible it would be to use cStringIO, since the FILE 
>pointer is passed through a mess of C libraries
>
>gdchart -> gd -> libjpeg
>
>The functions all the way down to libjpeg are wanting a pointer to a FILE 
>structure.   My other thought was
>looking for a way to imitate the FILE pointer in memory and modifying the 
>entry C code to return back the
>in memory data as a binary stream.  I'll have to look into that as well. 
>My C is pretty weak as well.  I'm
>so thankful there's Google.
>
>As a workaround, here's what I did (using os.tmpfile):
>
>from mod_python import apache
>from mod_python import util
>import gdchart
>import os
>
>def handler(req):
>        req.content_type = "image/png"
>
>        chart = gdchart.Line3D()
>        chart.width = 250
>        chart.height = 250
>        chart.xtitle = "xtitle goes here"
>        chart.ytitle = "Percentage"
>        chart.title = "Example Graph"
>        chart.ext_color = [ "white", "yellow", "red", "blue", "green"]
>        chart.setData([20, 100, 80, 30, 50],[10,150,20,25,65])
>        chart.setLabels(["Mon", "Tue", "Wed", "Thu", "Fri"])
>        chart.setLabels(["Mon", "Tue", "Wed", "Thu", "Fri"])
>
>        f = os.tmpfile()
>        chart.draw(f)
>        f.seek(0)
>        req.write(f.read())
>        f.close()
>
>        return apache.OK
>
>It outputs a graph for me.    Here's another question that may be 
>better suited for comp.lang.python, but do you know if
>os.tmpfile() uses an in-memory representation of a file
>or does it use a physical file that just remains anonymous?  I'm 
>concerned about the wasteful loss of speed having to write to
>disk and read it back.
>
>Well, enough rambling.  Thanks for your time,
>Perry Tew
>  
>
I'm pretty sure os.tmpfile() is a real file. It should probably be 
deleted afterwards.
Definitely the better option here is changing the library...
Thanks for the investigations
David


From alentzos at cosmote.gr  Fri Sep 19 17:20:43 2003
From: alentzos at cosmote.gr (Lentzos Athanassios)
Date: Fri Jan  9 21:53:52 2004
Subject: ??: [mod_python] Load python module problem
Message-ID: <4AEFA010DC6711478C8DA31039641A99014BBFA5@AHRMAIL.cosmote.gr>

First  i want to thank you  for the immediate response.
 
I did what you suggest me ( uninstall of python 2.3 and install of python 2.2.3 ver) but i still have
the same problem. I should notice that  i don't have administration authority to my workstation do you think
that maybe the cause of the problem.

-----?????? ??????-----
???: Benjamin [mailto:benjamin-hepp@t-online.de]
????????: ??????, 18 ??????????? 2003 6:41 ??
????: Lentzos Athanassios
????: Re: [mod_python] Load python module problem


>Hi 
>I have problem to load the mod_python( ver 3.0.3)? to apache (ver
2.0.47) I have done the >configuration according to the instructions but
i still
>get the following error when i try to start apache server? < " Cannot
load c:/program >files/apache/apache2/modules/mod_python.so into
server:The specified
>module could not be found." > ,of course the file is there. /* I have
installed Python >2.3? on my PC which runs NT os */? ....Please help!!
>
>Lentzos? .P Athanassios (Greece, Athens) 
>E-mail? :?? alentzos@cosmote.gr

mod_python doesn't work with Python 2.3.
Use Python 2.2.

Benjamin

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mailman.modpython.org/pipermail/mod_python/attachments/20030919/3935ae37/attachment-0001.htm
From grisha at modpython.org  Mon Sep 22 10:13:56 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:53:52 2004
Subject: [mod_python]  does a mod_python handler exist to generate
 charts/graphs? (png images)
In-Reply-To: <OFACFE0A3B.CBD0AC18-ON85256DA6.004B1817-85256DA6.004CDDEC@EU.novartis.net>
References: <OFACFE0A3B.CBD0AC18-ON85256DA6.004B1817-85256DA6.004CDDEC@EU.novartis.net>
Message-ID: <20030922100713.X33862@onyx.ispol.com>



On Fri, 19 Sep 2003 perry.tew@cibavision.novartis.com wrote:

> I tried to use the StringIO object from both StringIO and cStringIO.
> The library didn't like that at all.  I traced some of the pygdchart
> code.  It drops down into C and calls the following code (from
> _gdchartc.c) ( I stripped out some unnecessary lines):
>
> PyObject *pfile, *labels, *data, *combodata;
> FILE *fp;
> ...
> if (!PyArg_ParseTuple(args, "iiO!iiOiOO", &width, &height, &PyFile_Type,
> &pfile,
> ...
> fp = PyFile_AsFile(pfile);

Since StringIO is not a file (i.e. it is not a Python object of type
"file", it is something else that acts like a file, but only within
Python), I think your only option is to write to a temporary file, then
pass that file in. Take a look at Python's tempfile module (if you haven't
already).

Grisha
From mike.looijmans at asml.com  Tue Sep 23 08:09:59 2003
From: mike.looijmans at asml.com (Mike Looijmans)
Date: Fri Jan  9 21:53:52 2004
Subject: [mod_python]  does a mod_python handler exist to
	generatecharts/graphs? (png images)
Message-ID: <01c38199$51459580$926a1e6e@wsasd464>

You could look into other stuff, which would be partially OS specific:

- Named pipe. Works on most Unixes and on Windows NT system. Write to
something that looks "filish" to most programs but ends up into your
program.
- Socket. Pass a (TCP) socket descriptor, with your Python program
listening, instead of a file handle to the other side.
- Memory files. Supported on some systems, a file that resides in memory.

Some of these will require a little C interfacing, but that's easy to figure
out.

Mike.

-----Original Message-----
>Since StringIO is not a file (i.e. it is not a Python object of type
>"file", it is something else that acts like a file, but only within
>Python), I think your only option is to write to a temporary file, then
>pass that file in. Take a look at Python's tempfile module (if you haven't
>already).




-- 
The information contained in this communication and any attachments is confidential and may be privileged, and is for the sole use of the intended recipient(s). Any unauthorized review, use, disclosure or distribution is prohibited. If you are not the intended recipient, please notify the sender immediately by replying to this message and destroy all copies of this message and any attachments. ASML is neither liable for the proper and complete transmission of the information contained in this communication, nor for any delay in its receipt.


From grisha at modpython.org  Tue Sep 23 10:35:19 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:53:52 2004
Subject: [mod_python] [help]please give an input filter example ?
In-Reply-To: <002c01c37e5b$71210920$db64a8c0@camgelo>
References: <007c01c37dc6$32d21050$db64a8c0@camgelo>
	<3F69851B.3080703@sjsoft.com>
	<009d01c37dd0$bc2c5f40$db64a8c0@camgelo> <3F69916F.10406@sjsoft.com>
	<3F69D71A.8080005@sjsoft.com>
	<002c01c37e5b$71210920$db64a8c0@camgelo>
Message-ID: <20030923102333.N24322@onyx.ispol.com>


I've looked at the input filter code, and I think that what's in 3.0.3 is
broken. If you get the latest CVS version, your input filter code would
look somethng like:

def inputfilter(filter):

	s = filter.read()

	if s:
		## do something with s here

		filter.write(s)
	else:
		filter.close()

	return apache.OK

Note that the filter will only see the body of the POST request, it will
not see the headers, in fact it won't even be called for GET requests.

Grisha

On Fri, 19 Sep 2003, camge wrote:

> > >I need input filter to convert character set of form data submitted by
> cell
> > >phone browser.
> > >For example, convert utf-8 to big5 or gb.
> > >If I can do it in input filter, then I dont need to modify all of my
> pages.
> > >
> > >
> > Aha. What I would do is just put a function in a module that changes the
> > encoding.
> > Get the arguments like you normally would, then just do a decode/encode.
> > Since that module can be accessed from anywhere, it will work just as
> well.
> > Also, it's less likely to cause bugs, and will probably be faster
> > (you'll only making one jump into the Python interpreter and back)
> >
> > Cheers
> > David
> >
> Thanks for your suggestion!
> But my web server serve not only wap browser but also Pocket IE and IE,
> and they all use same module(for easy maintenance).
> Adding this function in these modules will be a terrible thing,
> because I dont need to convert character encoding for Pocket IE and IE.
>
> If I can do it in input filter, I don't need to modify any things in
> original module.
>
> regards,
> camge
>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From is83070 at cis.nctu.edu.tw  Wed Sep 24 09:25:36 2003
From: is83070 at cis.nctu.edu.tw (camge)
Date: Fri Jan  9 21:53:52 2004
Subject: [mod_python] [help]please give an input filter example ?
References: <007c01c37dc6$32d21050$db64a8c0@camgelo>
	<3F69851B.3080703@sjsoft.com> <009d01c37dd0$bc2c5f40$db64a8c0@camgelo>
	<3F69916F.10406@sjsoft.com> <000e01c37de9$60cfd0f0$db64a8c0@camgelo>
	<3F69D71A.8080005@sjsoft.com> <002c01c37e5b$71210920$db64a8c0@camgelo>
	<20030923102333.N24322@onyx.ispol.com>
Message-ID: <001301c3823a$cc9b9c10$db64a8c0@camgelo>

Dear Grisha,

    Many Thanks for your help!
But I dont have compile environment.
What packages must install if My dev platform is windows and
runtime environment is Apache/2.0.44 (Win32) + Python/2.2.2  ?
I am a newbie on apache.

Best regards,
camge

----- Original Message ----- 
From: "Gregory (Grisha) Trubetskoy" <grisha@modpython.org>
To: "camge" <is83070@cis.nctu.edu.tw>
Cc: "David Fraser" <davidf@sjsoft.com>; <mod_python@modpython.org>
Sent: Tuesday, September 23, 2003 10:35 PM
Subject: Re: [mod_python] [help]please give an input filter example ?


>
> I've looked at the input filter code, and I think that what's in 3.0.3 is
> broken. If you get the latest CVS version, your input filter code would
> look somethng like:
>
> def inputfilter(filter):
>
> s = filter.read()
>
> if s:
> ## do something with s here
>
> filter.write(s)
> else:
> filter.close()
>
> return apache.OK
>
> Note that the filter will only see the body of the POST request, it will
> not see the headers, in fact it won't even be called for GET requests.
>
> Grisha
>
> On Fri, 19 Sep 2003, camge wrote:
>
> > > >I need input filter to convert character set of form data submitted
by
> > cell
> > > >phone browser.
> > > >For example, convert utf-8 to big5 or gb.
> > > >If I can do it in input filter, then I dont need to modify all of my
> > pages.
> > > >
> > > >
> > > Aha. What I would do is just put a function in a module that changes
the
> > > encoding.
> > > Get the arguments like you normally would, then just do a
decode/encode.
> > > Since that module can be accessed from anywhere, it will work just as
> > well.
> > > Also, it's less likely to cause bugs, and will probably be faster
> > > (you'll only making one jump into the Python interpreter and back)
> > >
> > > Cheers
> > > David
> > >
> > Thanks for your suggestion!
> > But my web server serve not only wap browser but also Pocket IE and IE,
> > and they all use same module(for easy maintenance).
> > Adding this function in these modules will be a terrible thing,
> > because I dont need to convert character encoding for Pocket IE and IE.
> >
> > If I can do it in input filter, I don't need to modify any things in
> > original module.
> >
> > regards,
> > camge
> >
> >
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://mailman.modpython.org/mailman/listinfo/mod_python
> >
>
>

From sgillies at frii.com  Wed Sep 24 10:20:27 2003
From: sgillies at frii.com (Sean Gillies)
Date: Fri Jan  9 21:53:52 2004
Subject: [mod_python] Use of global for application data?
Message-ID: <02128F25-EEAB-11D7-BC79-000393B98B56@frii.com>

Hi,

I've seen examples of how to create persistent database connections with
mod_python, but not enough examples of other application data.  In my
case the application data are large objects including page templates.  
Exists
a better way than binding values to names in the globals namespace?  
Maybe
I just have a hang-up about globals that I need to overcome.

Sean

--
Sean Gillies
sgillies at frii dot com
http://www.frii.com/~sgillies

From fumanchu at aminus.net  Wed Sep 24 11:31:27 2003
From: fumanchu at aminus.net (fumanchu)
Date: Fri Jan  9 21:53:52 2004
Subject: [mod_python] Use of global for application data?
In-Reply-To: <DE1CF2B4FEC4A342BF62B6B2B334601E4A9B08@opus.HQAMOR.amorhq.net>
Message-ID: <DE1CF2B4FEC4A342BF62B6B2B334601E02F6CC@opus.HQAMOR.amorhq.net>

> I've seen examples of how to create persistent database connections
with
> mod_python, but not enough examples of other application data.
> In my case the application data are large objects including page
templates.
> Exists a better way than binding values to names in the globals
namespace?

"THE globals namespace" sounds misleading to me, unless you're talking
about the __main__ module. Each module has its own global namespace.

> Maybe I just have a hang-up about globals that I need to overcome.

That would depend on what you mean by "a better way". What limitations
of module.attributes are you seeing? I'd be interested to hear more
about your design, including your goals for the page templates--are you
trying to cache them in RAM throughout the life of the application?


Robert Brewer
fumanchu@aminus.net

From sgillies at frii.com  Wed Sep 24 14:38:53 2003
From: sgillies at frii.com (Sean Gillies)
Date: Fri Jan  9 21:53:52 2004
Subject: [mod_python] Use of global for application data?
In-Reply-To: <DE1CF2B4FEC4A342BF62B6B2B334601E02F6CC@opus.HQAMOR.amorhq.net>
Message-ID: <1CCFD4F4-EECF-11D7-BC79-000393B98B56@frii.com>


On Wednesday, September 24, 2003, at 12:31  PM, fumanchu wrote:

>> I've seen examples of how to create persistent database connections
> with
>> mod_python, but not enough examples of other application data.
>> In my case the application data are large objects including page
> templates.
>> Exists a better way than binding values to names in the globals
> namespace?
>
> "THE globals namespace" sounds misleading to me, unless you're talking
> about the __main__ module. Each module has its own global namespace.
>
>> Maybe I just have a hang-up about globals that I need to overcome.
>
> That would depend on what you mean by "a better way". What limitations
> of module.attributes are you seeing? I'd be interested to hear more
> about your design, including your goals for the page templates--are you
> trying to cache them in RAM throughout the life of the application?
>
>
> Robert Brewer
> fumanchu@aminus.net
>

Robert, thanks for the reply.  I went back and re-read the relevant
sections of the Python Reference Manual.  I had misunderstood that
the persistent db connection example in the FAQ was referring to a
name in the __main__ module.

I am using Zope page templates as module attributes and when methods of
my module are called (using the publisher), merging them with data
from several contexts.  I caught and fixed a bug in my code which
was causing numerous (re)loads of the module, and am now having no
problems.

Sean

--
Sean Gillies
sgillies at frii dot com
http://www.frii.com/~sgillies

From luca.masini at t-online.de  Thu Sep 25 06:57:06 2003
From: luca.masini at t-online.de (Luca Masini)
Date: Fri Jan  9 21:53:52 2004
Subject: [mod_python] mod_python just dump the script
Message-ID: <oprv1hdgvfywthye@securesmtp.t-online.de>

Hi,

I installed mod_python on mandrake 9.1 but it only
dumps the script content instead of executing it.

I do as explained in the installation/testing documentation.

Here some snippets of my httpd.conf file:

  ...
  # <mod_python>
  LoadModule python_module /usr/lib/apache2-2.0.44/mod_python.so
  # </mod_python>
  ...
  # <mod_python>
  AddModule mod_python.c
  # </mod_python>
  ...
  # <mod_python>
  AddHandler python-program .py
  <Directory /var/www/html/test>
      PythonHandler mptest
      PythonDebug On
  </Directory>
  # </mod_python>

The test full path of the test program is
  /var/www/html/test/mptest.py

More or less half an year ago I had the same problem on
a Solaris machine but I can remember how it was solved.
:-(

thanks in advance.



From is83070 at cis.nctu.edu.tw  Thu Sep 25 16:21:25 2003
From: is83070 at cis.nctu.edu.tw (camge)
Date: Fri Jan  9 21:53:52 2004
Subject: [mod_python] [help]please give an input filter example ?
References: <007c01c37dc6$32d21050$db64a8c0@camgelo>
	<3F69851B.3080703@sjsoft.com> <009d01c37dd0$bc2c5f40$db64a8c0@camgelo>
	<3F69916F.10406@sjsoft.com> <000e01c37de9$60cfd0f0$db64a8c0@camgelo>
	<3F69D71A.8080005@sjsoft.com> <002c01c37e5b$71210920$db64a8c0@camgelo>
	<20030923102333.N24322@onyx.ispol.com>
Message-ID: <010201c3833e$0a7cfc00$db64a8c0@camgelo>

Hi Grisha,

    I have compiled the latest CVS version, and it works.
But I found another problem here.

>  postData = filter.read()
>  modify(postData)
>  filter.write(postData)

If postData's length is not changed, everything is fine. 
Otherwise IE will hand there.
I guess this is caused by HTTP header "Content-Length" .
Because we changed the request body, but didn't update the header.

regards,
camge

----- Original Message ----- 
From: "Gregory (Grisha) Trubetskoy" <grisha@modpython.org>
To: "camge" <is83070@cis.nctu.edu.tw>
Cc: "David Fraser" <davidf@sjsoft.com>; <mod_python@modpython.org>
Sent: Tuesday, September 23, 2003 10:35 PM
Subject: Re: [mod_python] [help]please give an input filter example ?


> 
> I've looked at the input filter code, and I think that what's in 3.0.3 is
> broken. If you get the latest CVS version, your input filter code would
> look somethng like:
> 
> def inputfilter(filter):
> 
> s = filter.read()
> 
> if s:
> ## do something with s here
> 
> filter.write(s)
> else:
> filter.close()
> 
> return apache.OK
> 
> Note that the filter will only see the body of the POST request, it will
> not see the headers, in fact it won't even be called for GET requests.
> 
> Grisha
> 

From grisha at modpython.org  Thu Sep 25 09:29:35 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:53:52 2004
Subject: [mod_python] [help]please give an input filter example ?
In-Reply-To: <010201c3833e$0a7cfc00$db64a8c0@camgelo>
References: <007c01c37dc6$32d21050$db64a8c0@camgelo>
	<3F69851B.3080703@sjsoft.com>
	<009d01c37dd0$bc2c5f40$db64a8c0@camgelo> <3F69916F.10406@sjsoft.com>
	<3F69D71A.8080005@sjsoft.com><20030923102333.N24322@onyx.ispol.com>
	<010201c3833e$0a7cfc00$db64a8c0@camgelo>
Message-ID: <20030925092737.H57967@onyx.ispol.com>


On Thu, 25 Sep 2003, camge wrote:

> Hi Grisha,
>
>     I have compiled the latest CVS version, and it works.
> But I found another problem here.
>
> >  postData = filter.read()
> >  modify(postData)
> >  filter.write(postData)
>
> If postData's length is not changed, everything is fine.
> Otherwise IE will hand there.
> I guess this is caused by HTTP header "Content-Length" .
> Because we changed the request body, but didn't update the header.

Most likely, but I don't think there is a way around that because the
header is sent before the body. Perhaps your filter can store something in
the request object to communicate to your handler that it needs to read
more data.

Grisha
From luca.masini at t-online.de  Thu Sep 25 21:09:12 2003
From: luca.masini at t-online.de (Luca Masini)
Date: Fri Jan  9 21:53:52 2004
Subject: [mod_python] undefined symbol: apr_bucket_type_flush
Message-ID: <oprv2ktmdkywthye@securesmtp.t-online.de>

Hi again,
  I installed mod_python on mandrake 9.1 but it only
dumps the script content instead of executing it.

Then I installed mod_php and I have seen that mod_python is
not loaded at all.

running

  httpd -t

I get the following messages:

  Syntax error on line 66 of /etc/httpd/conf/httpd.conf:
  Cannot load /usr/lib/apache2-2.0.44/mod_python.so into server
  /usr/lib/apache2-2.0.44/mod_python.so: undefined symbol: 
apr_bucket_type_flush

So the problem seems to be this undefined apr_bucket_type_flush.

I compiled the module using these commands

   ./configure --with-apxs=/usr/src/apache2-2.0.44/support/apxs
   make
   su
   make install

What's wrong ?

Thanks.
From grisha at modpython.org  Thu Sep 25 14:22:41 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:53:52 2004
Subject: [mod_python] undefined symbol: apr_bucket_type_flush
In-Reply-To: <oprv2ktmdkywthye@securesmtp.t-online.de>
References: <oprv2ktmdkywthye@securesmtp.t-online.de>
Message-ID: <20030925142021.X60209@onyx.ispol.com>



On Thu, 25 Sep 2003, Luca Masini wrote:

> I compiled the module using these commands
>
>    ./configure --with-apxs=/usr/src/apache2-2.0.44/support/apxs

Don't know much about Mandrake, but it seems to me you're pointing at the
wrong apxs, it should really be in /usr/bin or some such. Perhaps someone
familiar w/ Mandrake can comment?

Grisha
From neo at https.ru  Fri Sep 26 00:58:42 2003
From: neo at https.ru (Neo Eureka)
Date: Fri Jan  9 21:53:52 2004
Subject: [mod_python] undefined symbol: apr_bucket_type_flush
In-Reply-To: <oprv2ktmdkywthye@securesmtp.t-online.de>
References: <oprv2ktmdkywthye@securesmtp.t-online.de>
Message-ID: <1118505542.20030926005842@https.ru>


  Hi!

  Some months ago I experimented with Mandrake. I guess you've
installed Apache from a "package". AFAIK, Mandrake has some kind of
"special" Apache flavours.

  I think the best (and the fastest) solution to these problems would
be to compile (the latest version of) original Apache from sources.


> Hi again,
>   I installed mod_python on mandrake 9.1 but it only
> dumps the script content instead of executing it.

> Then I installed mod_php and I have seen that mod_python is
> not loaded at all.

> running

>   httpd -t

> I get the following messages:

>   Syntax error on line 66 of /etc/httpd/conf/httpd.conf:
>   Cannot load /usr/lib/apache2-2.0.44/mod_python.so into server
>   /usr/lib/apache2-2.0.44/mod_python.so: undefined symbol: 
> apr_bucket_type_flush

> So the problem seems to be this undefined apr_bucket_type_flush.

> I compiled the module using these commands

>    ./configure --with-apxs=/usr/src/apache2-2.0.44/support/apxs
>    make
>    su
>    make install

> What's wrong ?

> Thanks.
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python


--- 
Neo Eureka / mailto:neo@https.ru

From modpython at maya.com  Thu Sep 25 17:56:55 2003
From: modpython at maya.com (Seung Chan Lim)
Date: Fri Jan  9 21:53:52 2004
Subject: [mod_python] apache.log_error
Message-ID: <029f01c383af$ef321c60$95fe46c0@GIRLS>

If I'm trying to spew error messages out to the default apache error log am
I doing the right thing by using apache.log_error ??

The problem is that I don't see anything on the default error log which I
believe is Apache2/logs/error.log

This is using mod_python 3.03
Windows 2000
Apache 2.0
Python 2.2

thanks

slim

From is83070 at cis.nctu.edu.tw  Fri Sep 26 10:08:56 2003
From: is83070 at cis.nctu.edu.tw (camge)
Date: Fri Jan  9 21:53:52 2004
Subject: [mod_python] [help]please give an input filter example ?
References: <007c01c37dc6$32d21050$db64a8c0@camgelo>
	<3F69851B.3080703@sjsoft.com> <009d01c37dd0$bc2c5f40$db64a8c0@camgelo>
	<3F69916F.10406@sjsoft.com> <000e01c37de9$60cfd0f0$db64a8c0@camgelo>
	<3F69D71A.8080005@sjsoft.com> <002c01c37e5b$71210920$db64a8c0@camgelo>
	<20030923102333.N24322@onyx.ispol.com>
	<010201c3833e$0a7cfc00$db64a8c0@camgelo>
	<20030925092737.H57967@onyx.ispol.com>
Message-ID: <001401c383d3$2c266e00$db64a8c0@camgelo>


>----- Original Message ----- 
>From: "Gregory (Grisha) Trubetskoy" <grisha@modpython.org>
>Sent: Thursday, September 25, 2003 9:29 PM
>Subject: Re: [mod_python] [help]please give an input filter example ?
>
>
> Most likely, but I don't think there is a way around that because the
> header is sent before the body. Perhaps your filter can store something in
> the request object to communicate to your handler that it needs to read
> more data.
>
> Grisha
>
>

Is there a way to read the header from client
and modify it just like the body in mod_python?
Or any way can modify the body before it sent to the cgi?
Handler in mod_python seems to handle response only.

Thanks for your response!

Best regards,
camge



From is83070 at cis.nctu.edu.tw  Fri Sep 26 15:55:26 2003
From: is83070 at cis.nctu.edu.tw (camge)
Date: Fri Jan  9 21:53:52 2004
Subject: [mod_python] [help]please give an input filter example ?
References: <007c01c37dc6$32d21050$db64a8c0@camgelo>
	<3F69851B.3080703@sjsoft.com> <009d01c37dd0$bc2c5f40$db64a8c0@camgelo>
	<3F69916F.10406@sjsoft.com> <000e01c37de9$60cfd0f0$db64a8c0@camgelo>
	<3F69D71A.8080005@sjsoft.com> <002c01c37e5b$71210920$db64a8c0@camgelo>
	<20030923102333.N24322@onyx.ispol.com>
	<010201c3833e$0a7cfc00$db64a8c0@camgelo>
	<20030925092737.H57967@onyx.ispol.com>
Message-ID: <003301c38403$9ca9ae00$db64a8c0@camgelo>

regardless of Content-Length problem,
I found my apache's error log has these error message when I post data to
cgi.
------------------------------------------------
...
[Fri Sep 26 15:51:31 2003] [error] [client 192.168.100.219] inputfilter
cameoInputFilter: Traceback (most recent call last):, referer:
http://192.168.100.161/test/index.htm
[Fri Sep 26 15:51:31 2003] [error] [client 192.168.100.219] inputfilter
cameoInputFilter:   File "C:\Program
Files\WebSite\lib\python22\lib\site-packages\mod_python\apache.py", line
222, in FilterDispatch
    object(filter), referer: http://192.168.100.161/test/index.htm
[Fri Sep 26 15:51:31 2003] [error] [client 192.168.100.219] inputfilter
cameoInputFilter:   File "C:/Program
Files/WebSite/httpd/CameoMobileSpace\cameoInputFilter.py", line 9, in
inputfilter
    strBody = filter.read(), referer: http://192.168.100.161/test/index.htm
[Fri Sep 26 15:51:31 2003] [error] [client 192.168.100.219] inputfilter
cameoInputFilter: IOError: Input filter read error, referer:
http://192.168.100.161/test/index.htm
...
-------------------------------------------------
although having error log, input filter still works.
Should I catch this exception? and how to handle it, close filter or just
return?
Below is my simple inputfilter:

def inputfilter(filter):
    strBody = filter.read()
    if strBody:
        filter.write(strBody)
    else:
        filter.close()
    return apache.OK

From grisha at modpython.org  Fri Sep 26 10:53:56 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 21:53:52 2004
Subject: [mod_python] [help]please give an input filter example ?
In-Reply-To: <003301c38403$9ca9ae00$db64a8c0@camgelo>
References: <007c01c37dc6$32d21050$db64a8c0@camgelo>
	<3F69851B.3080703@sjsoft.com>
	<009d01c37dd0$bc2c5f40$db64a8c0@camgelo> <3F69916F.10406@sjsoft.com>
	<3F69D71A.8080005@sjsoft.com><20030923102333.N24322@onyx.ispol.com>
	<20030925092737.H57967@onyx.ispol.com>
	<003301c38403$9ca9ae00$db64a8c0@camgelo>
Message-ID: <20030926104954.C62356@onyx.ispol.com>


Interesting...

If you could change filterobject.c, around line 223, where the code looks
like:

       if (! APR_STATUS_IS_SUCCESS(self->rc)) {
            PyErr_SetObject(PyExc_IOError,
                            PyString_FromString("Input filter read error"));
            return NULL;
To:

       if (! APR_STATUS_IS_SUCCESS(self->rc)) {
            PyErr_Format(PyExc_IOError, "Input filter read error: %d",
                         self->rc);
            return NULL;

This will log the actual return code that Apache is returning on this
error, it might give us more information on what is really going on there.

Thanks,

Grisha


On Fri, 26 Sep 2003, camge wrote:

> regardless of Content-Length problem,
> I found my apache's error log has these error message when I post data to
> cgi.
> ------------------------------------------------
> ...
> [Fri Sep 26 15:51:31 2003] [error] [client 192.168.100.219] inputfilter
> cameoInputFilter: Traceback (most recent call last):, referer:
> http://192.168.100.161/test/index.htm
> [Fri Sep 26 15:51:31 2003] [error] [client 192.168.100.219] inputfilter
> cameoInputFilter:   File "C:\Program
> Files\WebSite\lib\python22\lib\site-packages\mod_python\apache.py", line
> 222, in FilterDispatch
>     object(filter), referer: http://192.168.100.161/test/index.htm
> [Fri Sep 26 15:51:31 2003] [error] [client 192.168.100.219] inputfilter
> cameoInputFilter:   File "C:/Program
> Files/WebSite/httpd/CameoMobileSpace\cameoInputFilter.py", line 9, in
> inputfilter
>     strBody = filter.read(), referer: http://192.168.100.161/test/index.htm
> [Fri Sep 26 15:51:31 2003] [error] [client 192.168.100.219] inputfilter
> cameoInputFilter: IOError: Input filter read error, referer:
> http://192.168.100.161/test/index.htm
> ...
> -------------------------------------------------
> although having error log, input filter still works.
> Should I catch this exception? and how to handle it, close filter or just
> return?
> Below is my simple inputfilter:
>
> def inputfilter(filter):
>     strBody = filter.read()
>     if strBody:
>         filter.write(strBody)
>     else:
>         filter.close()
>     return apache.OK
>
From modpython at maya.com  Fri Sep 26 15:37:06 2003
From: modpython at maya.com (Seung Chan Lim)
Date: Fri Jan  9 21:53:52 2004
Subject: [mod_python] module not reloading?
Message-ID: <037001c38465$9174a550$95fe46c0@GIRLS>

The module reloading mechanism doesn't seem to work. I have to restart
apache everytime to have it reload the modules...

I even tried using the PythonAutoReload directive and set it to "ON" inside
the "Directory" section of the httpd.conf file... no luck..

any advice?

thanks


I'm using python 2.2
mod_python 3.03
Apache 2.0



From michael at dynamine.net  Fri Sep 26 12:50:07 2003
From: michael at dynamine.net (Michael S. Fischer)
Date: Fri Jan  9 21:53:52 2004
Subject: [mod_python] module not reloading?
In-Reply-To: <037001c38465$9174a550$95fe46c0@GIRLS>
References: <037001c38465$9174a550$95fe46c0@GIRLS>
Message-ID: <3F74986F.9010105@dynamine.net>

I have the same problem.  (Same versions, also running OS X 10.2, 
Python2.2 from Fink.)

--Michael

Seung Chan Lim wrote:
> The module reloading mechanism doesn't seem to work. I have to restart
> apache everytime to have it reload the modules...
> 
> I even tried using the PythonAutoReload directive and set it to "ON" inside
> the "Directory" section of the httpd.conf file... no luck..
> 
> any advice?
> 
> thanks
> 
> 
> I'm using python 2.2
> mod_python 3.03
> Apache 2.0
> 
> 
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
> 

From neel at mediapulse.com  Fri Sep 26 16:13:24 2003
From: neel at mediapulse.com (Michael C. Neel)
Date: Fri Jan  9 21:53:52 2004
Subject: [mod_python] module not reloading?
Message-ID: <C0FC22C08B82074A88B500617641577787A787@johnson.mediapulse.net>

I believe the main module reloads, but you will need to manually reload
any modules your module calls you want reloaded.  I tie this into the
PythonDebug setting, like such:

    # if this is in debug/test mode, reload any changes
    if req.get_config().has_key('PythonDebug'):
        reload(www_forms)
        reload(globals)

(if you state PythonDebug Off, there will not be a PythonDebug key at
all - a little gotcha as you might expect there to by a PythonDebug key
with a value of Off).

avoid "from module import *"'s; these don't seem to work with the reload
function (I think that is the way it's supposed to work, btw).

With the above inplace, I don't need to restart/killhup apache unless I
have PythonDebug Off.

HTH,
Mike

> -----Original Message-----
> From: Michael S. Fischer [mailto:michael@dynamine.net] 
> Sent: Friday, September 26, 2003 3:50 PM
> To: Seung Chan Lim
> Cc: mod_python@modpython.org
> Subject: Re: [mod_python] module not reloading?
> 
> 
> I have the same problem.  (Same versions, also running OS X 10.2, 
> Python2.2 from Fink.)
> 
> --Michael
> 
> Seung Chan Lim wrote:
> > The module reloading mechanism doesn't seem to work. I have 
> to restart
> > apache everytime to have it reload the modules...
> > 
> > I even tried using the PythonAutoReload directive and set 
> it to "ON" inside
> > the "Directory" section of the httpd.conf file... no luck..
> > 
> > any advice?
> > 
> > thanks
> > 
> > 
> > I'm using python 2.2
> > mod_python 3.03
> > Apache 2.0
> > 
> > 
> > 
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://mailman.modpython.org/mailman/listinfo/mod_python
> > 
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
> 

From michael at dynamine.net  Fri Sep 26 13:19:59 2003
From: michael at dynamine.net (Michael S. Fischer)
Date: Fri Jan  9 21:53:52 2004
Subject: [mod_python] module not reloading?
In-Reply-To: <C0FC22C08B82074A88B500617641577787A787@johnson.mediapulse.net>
References: <C0FC22C08B82074A88B500617641577787A787@johnson.mediapulse.net>
Message-ID: <3F749F6F.70109@dynamine.net>

Actually, my problem is that the main module reloads, but my called 
modules don't, even if I call reload() explicitly.

--Michael

Michael C. Neel wrote:

> I believe the main module reloads, but you will need to manually reload
> any modules your module calls you want reloaded.  I tie this into the
> PythonDebug setting, like such:
> 
>     # if this is in debug/test mode, reload any changes
>     if req.get_config().has_key('PythonDebug'):
>         reload(www_forms)
>         reload(globals)
> 
> (if you state PythonDebug Off, there will not be a PythonDebug key at
> all - a little gotcha as you might expect there to by a PythonDebug key
> with a value of Off).
> 
> avoid "from module import *"'s; these don't seem to work with the reload
> function (I think that is the way it's supposed to work, btw).
> 
> With the above inplace, I don't need to restart/killhup apache unless I
> have PythonDebug Off.
> 
> HTH,
> Mike
> 
> 
>>-----Original Message-----
>>From: Michael S. Fischer [mailto:michael@dynamine.net] 
>>Sent: Friday, September 26, 2003 3:50 PM
>>To: Seung Chan Lim
>>Cc: mod_python@modpython.org
>>Subject: Re: [mod_python] module not reloading?
>>
>>
>>I have the same problem.  (Same versions, also running OS X 10.2, 
>>Python2.2 from Fink.)
>>
>>--Michael
>>
>>Seung Chan Lim wrote:
>>
>>>The module reloading mechanism doesn't seem to work. I have 
>>
>>to restart
>>
>>>apache everytime to have it reload the modules...
>>>
>>>I even tried using the PythonAutoReload directive and set 
>>
>>it to "ON" inside
>>
>>>the "Directory" section of the httpd.conf file... no luck..
>>>
>>>any advice?
>>>
>>>thanks
>>>
>>>
>>>I'm using python 2.2
>>>mod_python 3.03
>>>Apache 2.0
>>>
>>>
>>>
>>>_______________________________________________
>>>Mod_python mailing list
>>>Mod_python@modpython.org
>>>http://mailman.modpython.org/mailman/listinfo/mod_python
>>>
>>
>>_______________________________________________
>>Mod_python mailing list
>>Mod_python@modpython.org
>>http://mailman.modpython.org/mailman/listinfo/mod_python
>>
> 
> 

From neel at mediapulse.com  Fri Sep 26 16:30:50 2003
From: neel at mediapulse.com (Michael C. Neel)
Date: Fri Jan  9 21:53:52 2004
Subject: [mod_python] module not reloading?
Message-ID: <C0FC22C08B82074A88B50061764157776B9722@johnson.mediapulse.net>

Hmm, without seeing any code, I'm out of ideas.  Here is the (python
2.2.2) docs on reload(), with all it's gotcha's you need to avoid...

reload(module) 
Re-parse and re-initialize an already imported module. The argument must
be a module object, so it must have been successfully imported before.
This is useful if you have edited the module source file using an
external editor and want to try out the new version without leaving the
Python interpreter. The return value is the module object (the same as
the module argument). 
There are a number of caveats: 

If a module is syntactically correct but its initialization fails, the
first import statement for it does not bind its name locally, but does
store a (partially initialized) module object in sys.modules. To reload
the module you must first import it again (this will bind the name to
the partially initialized module object) before you can reload() it. 

When a module is reloaded, its dictionary (containing the module's
global variables) is retained. Redefinitions of names will override the
old definitions, so this is generally not a problem. If the new version
of a module does not define a name that was defined by the old version,
the old definition remains. This feature can be used to the module's
advantage if it maintains a global table or cache of objects -- with a
try statement it can test for the table's presence and skip its
initialization if desired. 

It is legal though generally not very useful to reload built-in or
dynamically loaded modules, except for sys, __main__ and __builtin__. In
many cases, however, extension modules are not designed to be
initialized more than once, and may fail in arbitrary ways when
reloaded. 

If a module imports objects from another module using from ... import
..., calling reload() for the other module does not redefine the objects
imported from it -- one way around this is to re-execute the from
statement, another is to use import and qualified names (module.name)
instead. 

If a module instantiates instances of a class, reloading the module that
defines the class does not affect the method definitions of the
instances -- they continue to use the old class definition. The same is
true for derived classes. 



> -----Original Message-----
> From: Michael S. Fischer [mailto:michael@dynamine.net] 
> Sent: Friday, September 26, 2003 4:20 PM
> To: Michael C. Neel
> Cc: Seung Chan Lim; mod_python@modpython.org
> Subject: Re: [mod_python] module not reloading?
> 
> 
> Actually, my problem is that the main module reloads, but my called 
> modules don't, even if I call reload() explicitly.
> 
> --Michael
> 

From andy at netfxph.com  Sun Sep 28 08:30:37 2003
From: andy at netfxph.com (Andy Sy)
Date: Fri Jan  9 21:53:52 2004
Subject: [mod_python] 
	Win32 Binary of modpython 3.0.3 that has the Python 2.3 patch
Message-ID: <3F762BAD.9040006@netfxph.com>

 > modpython 3.0.3 works fine with Python 2.3, but to build it you
 > need to hack src/include/mod_python.h.  There's a FAQ entry with
 > the necessary patch.
 >
 > Maybe Grisha should release a 3.0.4 with just this one patch?
 >
 > -Barry

I second the motion.  Does anyone have such a binary?
At the very least widespread testing will help uncover
Python 2.3 vis-a-vis modpython 3.x bugs under Windows.

Does anyone have tips on how to compile modpython under
Windows?  Is it possible to do this using MinGW?


From andy at netfxph.com  Mon Sep 29 05:33:30 2003
From: andy at netfxph.com (Andy Sy)
Date: Fri Jan  9 21:53:53 2004
Subject: [mod_python] 
	Windows binary of modpython-3.1.0a for Python 2.3 still won't load
Message-ID: <3F7753AA.1020004@netfxph.com>

/httpd/modpython/win/3.1.0a/mod_python-3.1.0a.win32-py2.3.exe

exhibits the same problems as the earlier versions.  I'm
still getting a module not found error even though it is
clearly in the proper directory.


From is83070 at cis.nctu.edu.tw  Mon Sep 29 10:26:02 2003
From: is83070 at cis.nctu.edu.tw (camge)
Date: Fri Jan  9 21:53:53 2004
Subject: [mod_python] [help]please give an input filter example ?
References: <007c01c37dc6$32d21050$db64a8c0@camgelo>
	<3F69851B.3080703@sjsoft.com> <009d01c37dd0$bc2c5f40$db64a8c0@camgelo>
	<3F69916F.10406@sjsoft.com> <000e01c37de9$60cfd0f0$db64a8c0@camgelo>
	<3F69D71A.8080005@sjsoft.com> <002c01c37e5b$71210920$db64a8c0@camgelo>
	<20030923102333.N24322@onyx.ispol.com>
	<010201c3833e$0a7cfc00$db64a8c0@camgelo>
	<20030925092737.H57967@onyx.ispol.com>
	<003301c38403$9ca9ae00$db64a8c0@camgelo>
	<20030926104954.C62356@onyx.ispol.com>
Message-ID: <001201c38631$f12aa850$db64a8c0@camgelo>

>----- Original Message ----- 
>From: "Gregory (Grisha) Trubetskoy" <grisha@modpython.org>
>
> Interesting...
>
> If you could change filterobject.c, around line 223, where the code looks
> like:
>
>        if (! APR_STATUS_IS_SUCCESS(self->rc)) {
>             PyErr_SetObject(PyExc_IOError,
>                             PyString_FromString("Input filter read
error"));
>             return NULL;
> To:
>
>        if (! APR_STATUS_IS_SUCCESS(self->rc)) {
>             PyErr_Format(PyExc_IOError, "Input filter read error: %d",
>                          self->rc);
>             return NULL;
>
> This will log the actual return code that Apache is returning on this
> error, it might give us more information on what is really going on there.
>
> Thanks,
>
> Grisha
>
Hi Grisha,

    Below is the error message and error code is 730035.
----------------------------------------------------------------------------
------------------------------------------------------
[Mon Sep 29 10:23:56 2003] [notice] Parent: Created child process 2496
[Mon Sep 29 10:23:57 2003] [notice] Child 2496: Child process is running
[Mon Sep 29 10:23:57 2003] [notice] Child 2496: Acquired the start mutex.
[Mon Sep 29 10:23:57 2003] [notice] Child 2496: Starting 250 worker threads.
[Mon Sep 29 10:24:04 2003] [error] [client 211.79.36.248] inputfilter
cameoInputFilter: Traceback (most recent call last):
[Mon Sep 29 10:24:04 2003] [error] [client 211.79.36.248] inputfilter
cameoInputFilter:   File "C:\Program
Files\WebSite\lib\python22\lib\site-packages\mod_python\apache.py", line
222, in FilterDispatch
    object(filter)
[Mon Sep 29 10:24:04 2003] [error] [client 211.79.36.248] inputfilter
cameoInputFilter:   File "C:/Program
Files/WebSite/httpd/CameoMobileSpace\cameoInputFilter.py", line 9, in
inputfilter
    strBody = filter.read()
[Mon Sep 29 10:24:04 2003] [error] [client 211.79.36.248] inputfilter
cameoInputFilter: IOError: Input filter read error: 730035

From davidf at sjsoft.com  Mon Sep 29 07:54:06 2003
From: davidf at sjsoft.com (David Fraser)
Date: Fri Jan  9 21:53:53 2004
Subject: [mod_python] 	Win32 Binary of modpython 3.0.3 that has the Python
	2.3 patch
In-Reply-To: <3F762BAD.9040006@netfxph.com>
References: <3F762BAD.9040006@netfxph.com>
Message-ID: <3F77C8FE.6060900@sjsoft.com>

Andy Sy wrote:

> > modpython 3.0.3 works fine with Python 2.3, but to build it you
> > need to hack src/include/mod_python.h.  There's a FAQ entry with
> > the necessary patch.
> >
> > Maybe Grisha should release a 3.0.4 with just this one patch?
> >
> > -Barry
>
> I second the motion.  Does anyone have such a binary?
> At the very least widespread testing will help uncover
> Python 2.3 vis-a-vis modpython 3.x bugs under Windows.

Yes, this would be a great idea.

> Does anyone have tips on how to compile modpython under
> Windows?  Is it possible to do this using MinGW?

It's fairly complex - seems to require Visual C++ 7.0, also you have to 
then build the installer on a Linux machine I think.
Search the archives of this list for more info...

David


From davidf at sjsoft.com  Mon Sep 29 11:30:40 2003
From: davidf at sjsoft.com (David Fraser)
Date: Fri Jan  9 21:53:53 2004
Subject: [mod_python] jToolkit 0.1 released
Message-ID: <3F77FBC0.1080500@sjsoft.com>

I am pleased to announce the release of jToolkit, a new framework for 
building web applications using modpython and Apache.
jToolkit was developed by St James Software and is aimed at large, 
database-intensive applications with lots of dynamic content.

0.1 is the initial release of jToolkit. I'm trying to follow a 
release-early principle here, so at this stage, jToolkit is 
fully-functional, but documentation is scarce. Use the jToolkit lists 
for help or contributions (I also am on the mod_python and pythondev 
mailing lists).

Here's the blurb from the website, http://jtoolkit.sourceforge.net/

jToolkit is a Python web application framework built on modpython and 
Apache.

It is aimed at dynamically generated pages rather than mostly-static 
pages (for which there are templating solutions). Pages can be produced 
using a variety of widgets. It handles sessions and database connections.

The source code is licensed under the *GPL* license.

We request that for any contributions to jToolkit, *joint copyright* is 
assigned to St James Software. This enables us to keep the public GPL 
version in sync with our internal version, which we use for commercial 
projects. If there are any questions about this, please discuss on any 
of the mailing lists. (Note that if you want to, you can always create 
your own version of jToolkit without returning the contributions to this 
project).

Current features include:
  support for login/logout and user sessions (planned to be integrated 
with modpython 3.1 sessions if that is feasible)
  support for database independence using a wrapper around the Python 
DB-API 2.0
  support for localization using an extension of the gettext modules (so 
that you can have multiple users simultaneously using different languages)
  support for constructing pages using widget objects of various levels 
of complexity, ranging from simple html widgets to table layouts, etc

Any feedback, contributions etc are welcome.
In particular, if anyone actually wants to use this, they'll need help, 
which could then end up being used to create documentation. This is what 
I want to do, so please ask away!

David

From mikeklein at sbcglobal.net  Mon Sep 29 15:27:18 2003
From: mikeklein at sbcglobal.net (Mike Klein)
Date: Fri Jan  9 21:53:53 2004
Subject: [mod_python] Problems installing mod_python...openpty
Message-ID: <AIEFLNLEDPDLOJAIJKHPMEMBEJAA.mikeklein@sbcglobal.net>

I've googled/etc. and can't seem to find an answer to this one.

I am using RH9, and a separately installed Python (v. 2.2.3). My mod_python
is 2.7.8. Mod_python's install instructions say it works with <up to> Python
2.1.

My configure command is:

./configure --with-apxs=/apache/bin/apxs --with-python=/src/Python-2.2.3

The above version of python is compiled without threads and is in
/usr/local/python, whereas stock rh python is in /usr/bin and /usr/lib.

My apache is started with /usr/local/python/bin in the path before /usr/bin,
so apache is now using my custom python. This eliminated some site warnings
I was getting on restart.

When I attempt starting apache I get the following error:

Starting httpsd: Syntax error on line 211 of
/usr/local/apache/conf/httpsd.conf:
Cannot load /usr/local/apache/libexec/mod_python.so into server:
/usr/local/apache/libexec/mod_python.so: undefined symbol: openpty

Any ideas on how to solve this problem?


thanks in advance...

From mikeklein at sbcglobal.net  Mon Sep 29 17:25:44 2003
From: mikeklein at sbcglobal.net (Mike Klein)
Date: Fri Jan  9 21:53:53 2004
Subject: [mod_python] Problems installing mod_python...openpty....changing
	src/Makefile LIBS var fixed...but why needed?
In-Reply-To: <AIEFLNLEDPDLOJAIJKHPMEMBEJAA.mikeklein@sbcglobal.net>
Message-ID: <AIEFLNLEDPDLOJAIJKHPIEMEEJAA.mikeklein@sbcglobal.net>

Well...I google'd some more and found a single page with the answer:

I needed to manually update Makefile in mod_python's src directory and
added -lutil to LIBS variable.

Why is this needed though? I'm running a stock RH9 setup?

I am now able to run py scripts thru apache...


mike

-----Original Message-----
From: mod_python-bounces@modpython.org
[mailto:mod_python-bounces@modpython.org]On Behalf Of Mike Klein
Sent: Monday, September 29, 2003 3:27 PM
To: mod_python@modpython.org
Subject: [mod_python] Problems installing mod_python...openpty


I've googled/etc. and can't seem to find an answer to this one.

I am using RH9, and a separately installed Python (v. 2.2.3). My mod_python
is 2.7.8. Mod_python's install instructions say it works with <up to> Python
2.1.

My configure command is:

./configure --with-apxs=/apache/bin/apxs --with-python=/src/Python-2.2.3

The above version of python is compiled without threads and is in
/usr/local/python, whereas stock rh python is in /usr/bin and /usr/lib.

My apache is started with /usr/local/python/bin in the path before /usr/bin,
so apache is now using my custom python. This eliminated some site warnings
I was getting on restart.

When I attempt starting apache I get the following error:

Starting httpsd: Syntax error on line 211 of
/usr/local/apache/conf/httpsd.conf:
Cannot load /usr/local/apache/libexec/mod_python.so into server:
/usr/local/apache/libexec/mod_python.so: undefined symbol: openpty

Any ideas on how to solve this problem?


thanks in advance...

_______________________________________________
Mod_python mailing list
Mod_python@modpython.org
http://mailman.modpython.org/mailman/listinfo/mod_python

From mikeklein at sbcglobal.net  Mon Sep 29 19:29:19 2003
From: mikeklein at sbcglobal.net (Mike Klein)
Date: Fri Jan  9 21:53:53 2004
Subject: [mod_python] 
	Is there a status handler for mod_python ala mod_perl's
	perl-status, apache's server-status, and php's phpinfo()?
In-Reply-To: <AIEFLNLEDPDLOJAIJKHPIEMEEJAA.mikeklein@sbcglobal.net>
Message-ID: <AIEFLNLEDPDLOJAIJKHPEEMJEJAA.mikeklein@sbcglobal.net>

I like having these pages around as a sanity check and allaround diagnostic.

Does any such beast exist for mod_python? Page would show installed modules,
working environment, etc.


thanks in advance...

mike

From tpc at csua.berkeley.edu  Tue Sep 30 13:37:46 2003
From: tpc at csua.berkeley.edu (tpc@csua.berkeley.edu)
Date: Fri Jan  9 21:53:53 2004
Subject: [mod_python] writing to a file from mod_python
Message-ID: <20030930133235.G29513-100000@localhost.name>


hello all I have the following script that ran fine from the command line:

<code>
#!/usr/bin/env python

#string1 = "hello world!"

def writeFile(string1):
        open('somefile.txt', 'w').write(string1)

## writeFile(string1)
</code>

but as soon as I ported it to mod python I got the following:

<paste>
Mod_python error: "PythonHandler mod_python.publisher"

Traceback (most recent call last):

  File "/usr/lib/python2.2/site-packages/mod_python/apache.py", line 335, in HandlerDispatch
    result = object(req)

  File "/usr/lib/python2.2/site-packages/mod_python/publisher.py", line 194, in handler
    result = apply(object, (), args)

  File "/var/www/html/python/testing.py", line 7, in writeFile

IOError: [Errno 13] Permission denied: 'somefile.txt'
</paste>

I searched the web for the error message, chmod'ed 777 somefile.txt, and
even chown'ed and chgrp'ed to user and group apache, all to no avail.  Is
there a way to write to a file from mod python ?

From nelson at crynwr.com  Mon Sep  1 16:16:16 2003
From: nelson at crynwr.com (Russell Nelson)
Date: Fri Jan  9 22:00:20 2004
Subject: [mod_python] How do I serve up .html files?
In-Reply-To: <20030825213605.O1138@onyx.ispol.com>
References: <16202.30596.238589.112878@desk.crynwr.com>
	<20030825213605.O1138@onyx.ispol.com>
Message-ID: <16211.43280.919607.942196@desk.crynwr.com>

Gregory (Grisha) Trubetskoy writes:
 > P.S. Glad to see you using mod_python!

Me too!  It's a lot faster than a CGI, which was interfering with the
experience.  http://pubsoft.org/ is entirely run by a python program.
I'm going to rewrite my blogging program so that it's dynamic as
well.  Right now it writes static pages (index, archive, and rss).

-- 
--My blog is at angry-economist.russnelson.com  | Free markets express in the
Crynwr sells support for free software  | PGPok | practical world our belief
521 Pleasant Valley Rd. | +1 315 268 1925 voice | that there is that of God
Potsdam, NY 13676-3213  | +1 315 268 9201 FAX   | in all people. -Chris V.
From gdamjan at mail.net.mk  Tue Sep  2 01:15:45 2003
From: gdamjan at mail.net.mk (Damjan)
Date: Fri Jan  9 22:00:20 2004
Subject: [mod_python] Getting the script name with publisher
Message-ID: <20030901231545.GC14389@legolas.on.net.mk>

I have this simple script (test.py) that handled by the publisher:

def index(req):
    script_name = req.subprocess_env['SCRIPT_NAME']
    req.content_type = 'text/html'
    req.send_http_header()
    buf = "Hello, I'm a script. You can call my other methods:"
    buf = buf + "<br>\n" + req.path_info + "<br>\n"
    buf = buf + '''Go <a href="%s/say">here</a>''' % script_name
    return buf
def say(req, what="NOTHING"):
    return "I am saying %s" % what

Now if this script is called as:
[1]  http://127.1/test.py        -> script_name = /test.py
[2]  http://127.1/test.py/       -> script_name = /test.py/
[3]  http://127.1/test.py/index  -> script_name = /test.py
[4]  http://127.1/test.py/index/ -> script_name = /test.py/index


Now obviosly my implementation of getting the script_name doesn't not 
always get the proper result (the proper result being [1] and [3]). 
What's the proper way to do it?? 
I guess the publisher should know the real script name since it had to
import the file...



-- 
Damjan Georgievski
jabberID: damjan@bagra.net.mk
From gdamjan at mail.net.mk  Tue Sep  2 01:50:41 2003
From: gdamjan at mail.net.mk (Damjan)
Date: Fri Jan  9 22:00:20 2004
Subject: [mod_python] Getting the script name with publisher
In-Reply-To: <20030901231545.GC14389@legolas.on.net.mk>
References: <20030901231545.GC14389@legolas.on.net.mk>
Message-ID: <20030901235041.GD14389@legolas.on.net.mk>

> I have this simple script (test.py) that handled by the publisher:

I forgot to mention the test I made were with:
mod_python 3.0.3/ Python 2.3/ Apache 2.0.47 on Slackware-9.0+


PS.
for some strange reason mod_python-3.1.0a would crash Apache on my computer:

mod_python: Creating 256 session mutexes based on 256 max processes and 0 max threads.
(28)No space left on device: mod_python: Failed to create global mutex 127 of 256 (/tmp/mpmtx27278127).
mod_python: We can probably continue, but with diminished ability to process session locks.
mod_python: Hint: On Linux, the problem may be the number of available semaphores, check 'sysctl kernel.sem'
pid file /var/run/httpd.pid overwritten -- Unclean shutdown of previous Apache run?
(28)No space left on device: Couldn't create accept lock

PS2. 
while writing this I solved the mod_python-3.1.0a issue with:

    echo "32000 512 512 512" > /proc/sys/kernel/sem
    
and I also found out that my script works as expected in 3.1.0a 
:)



-- 
Damjan Georgievski
jabberID: damjan@bagra.net.mk
From davis at guydavis.ca  Tue Sep  2 11:10:47 2003
From: davis at guydavis.ca (Guy Davis)
Date: Fri Jan  9 22:00:20 2004
Subject: [mod_python] 
	Safety of using __builtins__ for per-request information?
Message-ID: <3F54CF17.9000006@guydavis.ca>

Hi all,

I'm writing a custom handler using the mod_python.cgi_handler as a guide 
on Apache 1.3 with mod_python 2.7.  Unfortunately, our old CGI makes use 
of certain super-global variables that are not easily done away with.  
I've been able to get this to work by having the handler set the global 
vars into the __builtins__ dictionary.  Then various CGI scripts can 
pull them from __builtins__ when needed. I know using __builtins__ in 
this fashion is not recommended as it's a bit of a hack.

My question is whether storing per-request information in __builtins__ 
is risky due to concurrency reasons.   Put another way, is __builtins__ 
shared between concurrent requests?  For example, person A hits a page 
and the handler stores __builtins__['foo'] = 'bar'.  At nearly the same 
time person B hits a page and the handler stores __builtins__['foo'] = 
'bar2'.  After this occurs, the CGI for person A retrieves 
__builtins__['foo'].  Will the result always be 'bar' or will 'bar2' 
sometimes be returned depending on the timing?

Will the behaviour be any different under Apache 2 and mod_python 3?

Thanks in advance for any responses.

Guy Davis                 http://www.guydavis.ca



From grisha at modpython.org  Tue Sep  2 13:32:27 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 22:00:20 2004
Subject: [mod_python]  Safety of using __builtins__ for per-request
 information?
In-Reply-To: <3F54CF17.9000006@guydavis.ca>
References: <3F54CF17.9000006@guydavis.ca>
Message-ID: <20030902132450.E6308@onyx.ispol.com>



On Tue, 2 Sep 2003, Guy Davis wrote:

> My question is whether storing per-request information in __builtins__
> is risky due to concurrency reasons.   Put another way, is __builtins__
> shared between concurrent requests?  For example, person A hits a page
> and the handler stores __builtins__['foo'] = 'bar'.  At nearly the same
> time person B hits a page and the handler stores __builtins__['foo'] =
> 'bar2'.  After this occurs, the CGI for person A retrieves
> __builtins__['foo'].  Will the result always be 'bar' or will 'bar2'
> sometimes be returned depending on the timing?

Yes, __builtins__ is shared between requests and using it for per-request
information is not a good idea. You can probably get away with it since
Apache 1.3 isn't multithreaded (unless you're on Windows), but it's still
a bad idea, not only for reasons of concurrency, but also __builtins__
isn't the right place to store anything.

Your best bet is to use the request object itself:

req.foo = 'bar2'

> Will the behaviour be any different under Apache 2 and mod_python 3?

Yes, on apache 2 it is going to be a lot more likely to cause trouble :-)

Grisha
From davidf at sjsoft.com  Tue Sep  2 22:42:33 2003
From: davidf at sjsoft.com (David Fraser)
Date: Fri Jan  9 22:00:20 2004
Subject: [mod_python] Apache startup error using mod_python under Windows
 2000 (have msvcr70.dll)
In-Reply-To: <20030829121653.W53150@onyx.ispol.com>
References: 
	<OF369D809A.F682347B-ON85256D91.004FD7CA-85256D91.0050607E@EU.novartis.net>
	<20030829110249.R53150@onyx.ispol.com> <001201c36e46$1f72d010$0a00a8c0@laird>
	<3F4F7BF2.2090106@sjsoft.com> <20030829121653.W53150@onyx.ispol.com>
Message-ID: <3F5500B9.4020205@sjsoft.com>

Gregory (Grisha) Trubetskoy wrote:

>On Fri, 29 Aug 2003, David Fraser wrote:
>
>  
>
>>Python 2.3, and the easiest way to do that...
>>would be to have an installer for mod_python 3.1a for Python 2.2! Grisha?
>>    
>>
>
>Getting a version for Python 2.2 is tricky because the production
>of the installer requires 2.3, so what I had to do in the past is compile
>for 2.2, but then use 2.3 for the installer, so it's a bit of a pain.
>
>What we really need to do is figure out what is different between our
>systems.
>
>Just to summarise, is this correct? (I am only concerned with 3.1.0a here,
>NOT 3.0.3).
>
>"stock" means the binary from www.python.org, as opposed to Win32, Active
>or compiled. All Apache is the binary from www.apache.org.
>
>       |  mod_py  | Python    | Apache | Win. |
>-------------------------------------------------------
>Perry  |  3.1.0a  | stock 2.3 | 2.0.47 | ?    | OK
>Grisha |  3.1.0a  | stock 2.3 | 2.0.47 | 2000 | OK
>David  |  3.1.0a  | stock 2.3 | 2.0.47 | 2000 | NOT OK
>Laird  |  3.1.0a  | stock 2.3 | 2.0.47 | 2000 | NOT OK
>
>Grisha
>
>  
>
To confirm:
I'm working in Windows 2000
Tested stock Apache 2.0.47, stock Python 2.3, mod_python 3.1a, get error 
loading Module
I tried running FileMon from SysInternals to see if there was some 
dependency etc it was trying to load that was failing, but couldn't see 
anything.
It seems like it is loading the module, but not finding the Apache hooks 
inside it? (Just a guess)

David

From mike.looijmans at asml.com  Wed Sep  3 07:21:15 2003
From: mike.looijmans at asml.com (Mike Looijmans)
Date: Fri Jan  9 22:00:20 2004
Subject: [mod_python] Safety of using __builtins__ for per-request
	information?
Message-ID: <01c371db$322b9780$926a1e6e@wsasd464>

It's not risky in this particular case, but it isn't good practice either...

Using cgi_handler will effectively make your system single-threaded,
regardless of the Apache version used. cgi_handler already shares the
"sys.stdout" and sys.stderr globals, and uses a lock to prevent two requests
to interfere. So within the request, using globals is safe.
I wonder why you use __builtins__, why not just use globals in your own
module? Just create a globals.py or so and import that from each script.

I saw performance _degrade_ because of this when I moved from 'plain' CGI to
mod_python cgihandler (apache 2.0 with worker mpm). Some long requests would
stall the server completely. My solution was to replace all "print"
statements with "output.write(...)" calls, and use the Request object for
output in mod_python scripts and sys.stdout when the server is using plain
CGI. Basically, I turned it around and made a CGI interface that emulates
mod_python (cgihandler does the opposite). The overhead for emulating CGI in
mod_python is huge, while the overhead of emulating mod_python in CGI is
neglectable compared to the interpreter load-and-start.

Mike.


-----Original Message-----
From: Guy Davis <davis@guydavis.ca>
To: mod_python@modpython.org <mod_python@modpython.org>
Date: Tuesday, September 02, 2003 7:13 PM
Subject: [mod_python] Safety of using __builtins__ for per-request
information?


>Hi all,
>
>I'm writing a custom handler using the mod_python.cgi_handler as a guide
>on Apache 1.3 with mod_python 2.7.  Unfortunately, our old CGI makes use
>of certain super-global variables that are not easily done away with.
>I've been able to get this to work by having the handler set the global
>vars into the __builtins__ dictionary.  Then various CGI scripts can
>pull them from __builtins__ when needed. I know using __builtins__ in
>this fashion is not recommended as it's a bit of a hack.
>
>My question is whether storing per-request information in __builtins__
>is risky due to concurrency reasons.   Put another way, is __builtins__
>shared between concurrent requests?  For example, person A hits a page
>and the handler stores __builtins__['foo'] = 'bar'.  At nearly the same
>time person B hits a page and the handler stores __builtins__['foo'] =
>'bar2'.  After this occurs, the CGI for person A retrieves
>__builtins__['foo'].  Will the result always be 'bar' or will 'bar2'
>sometimes be returned depending on the timing?
>
>Will the behaviour be any different under Apache 2 and mod_python 3?
>
>Thanks in advance for any responses.
>
>Guy Davis                 http://www.guydavis.ca
>
>
>
>_______________________________________________
>Mod_python mailing list
>Mod_python@modpython.org
>http://mailman.modpython.org/mailman/listinfo/mod_python
>
>
>
>



-- 
The information contained in this communication and any attachments is confidential and may be privileged, and is for the sole use of the intended recipient(s). Any unauthorized review, use, disclosure or distribution is prohibited. If you are not the intended recipient, please notify the sender immediately by replying to this message and destroy all copies of this message and any attachments. ASML is neither liable for the proper and complete transmission of the information contained in this communication, nor for any delay in its receipt.


From marco.vezzoli at st.com  Wed Sep  3 08:17:18 2003
From: marco.vezzoli at st.com (Marco Vezzoli)
Date: Fri Jan  9 22:00:20 2004
Subject: [mod_python] relocation error with Apache 1.3 on solaris 8
Message-ID: <3F55876E.C9BD222F@st.com>

Hi all,
I'm evaluating mod_python for our intranet site; we are using

solaris 8
gcc 3.0.1
apache 1.3.19
python 2.1.1
mod_python 2.7.8 compiled with DSO 

Compilation and basic tests run good.
I use the mod_python.publisher module for deploy but some modules can't
be imported because there is some name resolution error (messages
follows).
I googled whitout success for this problem (many ask nobody answer).
Thanks in advance for any help.
		Marco


-----------------------------------
Mod_python error: "PythonHandler mod_python.publisher"

Traceback (most recent call last):

  File "/usr/local/lib/python2.1/site-packages/mod_python/apache.py",
line 193, in Dispatch
    result = object(req)

  File "/usr/local/lib/python2.1/site-packages/mod_python/publisher.py",
line 128, in handler
    module = apache.import_module(module_name, _req, [path])

  File "/usr/local/lib/python2.1/site-packages/mod_python/apache.py",
line 335, in import_module
    module = imp.load_module(mname, f, p, d)

  File "/hype/cgi-bin/PyDataAnalysis/EWSSearchProcess.py", line 7, in ?
    import EWS

  File "/hype/cgi-bin/PyDataAnalysis/EWS.py", line 1, in ?
    from psycopg import *

ImportError: ld.so.1: /HTTP-Server/build/apache/bin/httpd: fatal:
relocation error: file /usr/local/lib/libpq.so.2: symbol main:
referenced symbol not found
-----------------------------------

-- 
Marco Vezzoli	   tel. +39 039 603 6852
STMicroelectronics fax. +39 039 603 5055
From perry.tew at cibavision.novartis.com  Wed Sep  3 13:59:36 2003
From: perry.tew at cibavision.novartis.com (perry.tew@cibavision.novartis.com)
Date: Fri Jan  9 22:00:20 2004
Subject: [mod_python] 
	correction: cannot get mod_python3.1a to run against python2.3
Message-ID: <OF11E24A39.2345CE16-ON85256D96.0060276E-85256D96.0062D790@EU.novartis.net>

Grisha,
    Earlier in the thread talking about 3.1a, I reported that I was 
successfully running 3.1a against 2.3.   It appears I was wrong. 
During the install, mod_python found my python2.3 directory in the 
registry and placed its files there, but as I've started developing with 
mod_python, 
I realized it was using my old Python2.2 directories for the python path. 
After I uninstalled 2.2, it stopped working.  Strange. 

Let me ask you, how does the mod_python.so know 
which libraries to link to?  Any idea why it would find 
the 2.2 version and not 2.3?   I now receive the following 
message from apache:
Cannot load C:/perryapps/py/Apache2/modules/mod_python.so into server: The
specified module could not be found.

When I start up python with -, I receive the following output:
Python 2.3 (#46, Jul 29 2003, 18:54:32) [MSC v.1200 32 bin (Intel)] on 
win32

What python version did you build the windows version of 3.1a against?


I also see some comments about mcvcr70.dll in the cvs repository.  I don't 
have
this file in my system.  Then again, your comments in cvs state that it's 
not 
required. 

Is there any other information I can provide to help troubleshoot this for 
myself?
I wish apache would tell me why it can't load mod_python.so.  Is there an 
option
to force apache to devulge additional information?

Sorry for confusion, again, I'm new to all of this.

Perry Tew

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mailman.modpython.org/pipermail/mod_python/attachments/20030903/0dbe868f/attachment-0002.htm
From ronwalf at wam.umd.edu  Wed Sep  3 14:25:38 2003
From: ronwalf at wam.umd.edu (Ron Alford)
Date: Fri Jan  9 22:00:20 2004
Subject: [mod_python] 
	Problem with using apache.import_module for importing scripts
Message-ID: <Pine.LNX.4.44.0309031422590.7361-100000@volus.net>

import_module has a tendency to throw 404s when you have multiple scripts 
of the same name in different directories.  Is there a known way of 
getting around this problem?

My own mod_python handler is effected, and I suspect publisher is, too.

-Ron

--
Ron Alford, KB0NUV
http://volus.net/~ronwalf


From ronwalf at wam.umd.edu  Wed Sep  3 14:34:22 2003
From: ronwalf at wam.umd.edu (Ron Alford)
Date: Fri Jan  9 22:00:20 2004
Subject: [mod_python]  Problem with using apache.import_module for
 importing scripts
In-Reply-To: <Pine.LNX.4.44.0309031422590.7361-100000@volus.net>
Message-ID: <Pine.LNX.4.44.0309031432450.7361-100000@volus.net>

On Wed, 3 Sep 2003, Ron Alford wrote:

> import_module has a tendency to throw 404s when you have multiple scripts 
> of the same name in different directories.  Is there a known way of 
> getting around this problem?
> 
> My own mod_python handler is effected, and I suspect publisher is, too.
> 

This is how I fixed it in apache.py:
...
if not file or (path and not os.path.dirname(file) in path):                    
    raise SERVER_RETURN, HTTP_NOT_FOUND   
if autoreload:
...

goes to 
...
if not file or (path and not os.path.dirname(file) in path):
    #raise SERVER_RETURN, HTTP_NOT_FOUND
    mtime, oldmtime = 0, -1
elif autoreload:
...

--
Ron Alford, KB0NUV
http://volus.net/~ronwalf


From grisha at modpython.org  Wed Sep  3 15:58:13 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 22:00:20 2004
Subject: [mod_python]  Problem with using apache.import_module for
 importing scripts
In-Reply-To: <Pine.LNX.4.44.0309031432450.7361-100000@volus.net>
References: <Pine.LNX.4.44.0309031432450.7361-100000@volus.net>
Message-ID: <20030903153559.W20438@onyx.ispol.com>


Thanks, that should work OK, and it's still secure because it doesn't
allow access to arbitrary imported modules.

But as a sidenote - you should consider naming your scripts differently
since you end up having to reload them every time the "other" script is
accessed. Also, you may sometimes find object from one script in the
namespace of the other (not sure if it's a Python bug or feature).

Grisha

On Wed, 3 Sep 2003, Ron Alford wrote:

> On Wed, 3 Sep 2003, Ron Alford wrote:
>
> > import_module has a tendency to throw 404s when you have multiple scripts
> > of the same name in different directories.  Is there a known way of
> > getting around this problem?
> >
> > My own mod_python handler is effected, and I suspect publisher is, too.
> >
>
> This is how I fixed it in apache.py:
> ...
> if not file or (path and not os.path.dirname(file) in path):
>     raise SERVER_RETURN, HTTP_NOT_FOUND
> if autoreload:
> ...
>
> goes to
> ...
> if not file or (path and not os.path.dirname(file) in path):
>     #raise SERVER_RETURN, HTTP_NOT_FOUND
>     mtime, oldmtime = 0, -1
> elif autoreload:
> ...
>
> --
> Ron Alford, KB0NUV
> http://volus.net/~ronwalf
>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From synec at viscous.org  Wed Sep  3 17:21:43 2003
From: synec at viscous.org (john spurling)
Date: Fri Jan  9 22:00:21 2004
Subject: [mod_python] relocation error with Apache 1.3 on solaris 8
In-Reply-To: <3F55876E.C9BD222F@st.com>
References: <3F55876E.C9BD222F@st.com>
Message-ID: <20030904002143.GF31952@c7c8.colobox.com>

On Wed, Sep 03, 2003 at 08:17:18AM +0200, Marco Vezzoli wrote:
> Hi all,
> I'm evaluating mod_python for our intranet site; we are using
> 
> solaris 8
> gcc 3.0.1
> apache 1.3.19
> python 2.1.1
> mod_python 2.7.8 compiled with DSO 
> 
> Compilation and basic tests run good.
> I use the mod_python.publisher module for deploy but some modules can't
> be imported because there is some name resolution error (messages
> follows).
> I googled whitout success for this problem (many ask nobody answer).
> Thanks in advance for any help.
> 		Marco

Marco,

this isn't a mod_python problem; it's a psycopg/postgresql problem. in
case you're not familiar, psycopg is a python module used to access a
postgresql database.

it looks to me like psycopg was linked against a different version of
libpq than the one that the runtime linker is using, but that's just a
guess.

you can find more information on psycopg on its website:
http://initd.org/software/psycopg

good luck,
john spurling


> -----------------------------------
> Mod_python error: "PythonHandler mod_python.publisher"
> 
> Traceback (most recent call last):
> 
>   File "/usr/local/lib/python2.1/site-packages/mod_python/apache.py",
> line 193, in Dispatch
>     result = object(req)
> 
>   File "/usr/local/lib/python2.1/site-packages/mod_python/publisher.py",
> line 128, in handler
>     module = apache.import_module(module_name, _req, [path])
> 
>   File "/usr/local/lib/python2.1/site-packages/mod_python/apache.py",
> line 335, in import_module
>     module = imp.load_module(mname, f, p, d)
> 
>   File "/hype/cgi-bin/PyDataAnalysis/EWSSearchProcess.py", line 7, in ?
>     import EWS
> 
>   File "/hype/cgi-bin/PyDataAnalysis/EWS.py", line 1, in ?
>     from psycopg import *
> 
> ImportError: ld.so.1: /HTTP-Server/build/apache/bin/httpd: fatal:
> relocation error: file /usr/local/lib/libpq.so.2: symbol main:
> referenced symbol not found
> -----------------------------------
> 
> -- 
> Marco Vezzoli	   tel. +39 039 603 6852
> STMicroelectronics fax. +39 039 603 5055
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: not available
Url : http://mailman.modpython.org/pipermail/mod_python/attachments/20030903/53baa3a5/attachment-0002.bin
From davis at guydavis.ca  Wed Sep  3 21:18:38 2003
From: davis at guydavis.ca (Guy Davis)
Date: Fri Jan  9 22:00:21 2004
Subject: [mod_python] Code directory layout recommendations?
Message-ID: <1062645517.2832.16.camel@dhcp11.int.guydavis.ca>

Hi all, 

Thanks for the answers to my previous question.  I'm now looking into
reorganizing our current directory layout of Python code.  I was
wondering what your Python web apps use for directory structures?

One idea was to have a directory for "page" modules (generate HTML
mostly), another for library modules, and another for unit tests.

Another possibility is to have a directory per major functional area. 
For example:
	
   functionA/
	-->  functionA_page.py
        -->  functionA_lib1.py
        -->  functionA_lib2.py
        -->  functionA_test.py

   functionB/
        -->  etc...

Both of the examples above are of the CVS workspace.  I'm also debating
whether the actual deploy (web-accessible) directories will be a one to
one mapping of the CVS workspace dirs or whether I'll just dump all the
Python files into one deployment directory.  Python files will be
installed into the web dirs using 'make' on a developer's workstation.

Either approach above would require some tweaks to sys.path.  Is the
standard way to do this is to stick all the required imports into a
single file and then have all other Python modules import it (appending
a relative path like ../../ to sys.path as needed)?  Any other
approaches?

It would be great to hear how you choose to layout your web app
directories and how it has worked out for you.

Thanks.
 

From davidf at sjsoft.com  Thu Sep  4 07:16:56 2003
From: davidf at sjsoft.com (David Fraser)
Date: Fri Jan  9 22:00:21 2004
Subject: [mod_python] Code directory layout recommendations?
In-Reply-To: <1062645517.2832.16.camel@dhcp11.int.guydavis.ca>
References: <1062645517.2832.16.camel@dhcp11.int.guydavis.ca>
Message-ID: <3F56CAC8.5050501@sjsoft.com>

Guy Davis wrote:

>Hi all, 
>
>Thanks for the answers to my previous question.  I'm now looking into
>reorganizing our current directory layout of Python code.  I was
>wondering what your Python web apps use for directory structures?
>
>One idea was to have a directory for "page" modules (generate HTML
>mostly), another for library modules, and another for unit tests.
>
>Another possibility is to have a directory per major functional area. 
>For example:
>	
>   functionA/
>	-->  functionA_page.py
>        -->  functionA_lib1.py
>        -->  functionA_lib2.py
>        -->  functionA_test.py
>
>   functionB/
>        -->  etc...
>
>Both of the examples above are of the CVS workspace.  I'm also debating
>whether the actual deploy (web-accessible) directories will be a one to
>one mapping of the CVS workspace dirs or whether I'll just dump all the
>Python files into one deployment directory.  Python files will be
>installed into the web dirs using 'make' on a developer's workstation.
>
>Either approach above would require some tweaks to sys.path.  Is the
>standard way to do this is to stick all the required imports into a
>single file and then have all other Python modules import it (appending
>a relative path like ../../ to sys.path as needed)?  Any other
>approaches?
>
>It would be great to hear how you choose to layout your web app
>directories and how it has worked out for you.
>
>Thanks.
> 
>
If you're doing an almost-entirely mod-python based application like 
this (i.e. almost all your content is generated by mod_python rather 
than being static),
you may find it better to have one handler in the main directory and let 
it choose which module to pass the other requests to. Then your 
directory structure is defined in Python code rather than by the file 
system. That's what we do

David

From marco.vezzoli at st.com  Thu Sep  4 08:58:57 2003
From: marco.vezzoli at st.com (Marco Vezzoli)
Date: Fri Jan  9 22:00:21 2004
Subject: [mod_python] relocation error with Apache 1.3 on solaris 8
References: <3F55876E.C9BD222F@st.com>
	<20030904002143.GF31952@c7c8.colobox.com>
Message-ID: <3F56E2B1.1E102C94@st.com>

synec@viscous.org wrote:
> 
> On Wed, Sep 03, 2003 at 08:17:18AM +0200, Marco Vezzoli wrote:
> > Hi all,
> > I'm evaluating mod_python for our intranet site; we are using
> >
> > solaris 8
> > gcc 3.0.1
> > apache 1.3.19
> > python 2.1.1
> > mod_python 2.7.8 compiled with DSO
> >
> > Compilation and basic tests run good.
> > I use the mod_python.publisher module for deploy but some modules can't
> > be imported because there is some name resolution error (messages
> > follows).
> > I googled whitout success for this problem (many ask nobody answer).
> > Thanks in advance for any help.
> >               Marco
> 
> Marco,
> 
> this isn't a mod_python problem; it's a psycopg/postgresql problem. in
> case you're not familiar, psycopg is a python module used to access a
> postgresql database.
> 
> it looks to me like psycopg was linked against a different version of
> libpq than the one that the runtime linker is using, but that's just a
> guess.
> 
> you can find more information on psycopg on its website:
> http://initd.org/software/psycopg
> 
> good luck,
> john spurling
> 

Thank you for the answer; I did some other test and I verified that

-some other modules importing .so are working correctly e.g.
mx.DateTime, gadfly
-some don't e.g. cgi (fails to load libssl, messages below)
-another postgres driver fails with a similar error (messages below)
-pure python imports psycopg correctly (so I imagine it could be some
apache/mod_python linking problem)
-no other libpq nor libssl are in the LD_LIBRARY_PATH

I'm using gnu ld: does this cause some problem?
I've tried hacking my path so that it finds Sun's ld but errors are the
same.
Is it an apache config problem?
TIA for any help

	Marco

----error importing cgi----------------------------------
Mod_python error: "PythonHandler mod_python.publisher"

Traceback (most recent call last):

  File "/usr/local/lib/python2.1/site-packages/mod_python/apache.py",
line 193, in Dispatch
    result = object(req)

  File "/usr/local/lib/python2.1/site-packages/mod_python/publisher.py",
line 128, in handler
    module = apache.import_module(module_name, _req, [path])

  File "/usr/local/lib/python2.1/site-packages/mod_python/apache.py",
line 335, in import_module
    module = imp.load_module(mname, f, p, d)

  File "/hype/cgi-bin/PyDataAnalysis/test.py", line 2, in ?
    import cgi

  File "/usr/local/lib/python2.1/cgi.py", line 39, in ?
    import urllib

  File "/usr/local/lib/python2.1/urllib.py", line 26, in ?
    import socket

  File "/usr/local/lib/python2.1/socket.py", line 41, in ?
    from _socket import *

ImportError: ld.so.1: /HTTP-Server/build/apache/bin/httpd: fatal:
relocation error: file /usr/local/lib/libssl.so.0.9.6: symbol main:
referenced symbol not found
--------------------------------------
----error importing pg----------------------------------------
Mod_python error: "PythonHandler mod_python.publisher"

Traceback (most recent call last):

  File "/usr/local/lib/python2.1/site-packages/mod_python/apache.py",
line 193, in Dispatch
    result = object(req)

  File "/usr/local/lib/python2.1/site-packages/mod_python/publisher.py",
line 128, in handler
    module = apache.import_module(module_name, _req, [path])

  File "/usr/local/lib/python2.1/site-packages/mod_python/apache.py",
line 335, in import_module
    module = imp.load_module(mname, f, p, d)

  File "/hype/cgi-bin/PyDataAnalysis/test.py", line 3, in ?
    import pg

  File "/usr/local/lib/python2.1/pg.py", line 7, in ?
    from _pg import *

ImportError: ld.so.1: /HTTP-Server/build/apache/bin/httpd: fatal:
relocation error: file /usr/local/lib/libpq.so.2: symbol main:
referenced symbol not found

-- 
Marco Vezzoli	   tel. +39 039 603 6852
STMicroelectronics fax. +39 039 603 5055
From davidf at sjsoft.com  Thu Sep  4 10:28:06 2003
From: davidf at sjsoft.com (David Fraser)
Date: Fri Jan  9 22:00:21 2004
Subject: [mod_python] relocation error with Apache 1.3 on solaris 8
In-Reply-To: <3F56E2B1.1E102C94@st.com>
References: <3F55876E.C9BD222F@st.com>
	<20030904002143.GF31952@c7c8.colobox.com> <3F56E2B1.1E102C94@st.com>
Message-ID: <3F56F796.4040803@sjsoft.com>

Marco Vezzoli wrote:

>synec@viscous.org wrote:
>  
>
>>On Wed, Sep 03, 2003 at 08:17:18AM +0200, Marco Vezzoli wrote:
>>    
>>
>>>Hi all,
>>>I'm evaluating mod_python for our intranet site; we are using
>>>
>>>solaris 8
>>>gcc 3.0.1
>>>apache 1.3.19
>>>python 2.1.1
>>>mod_python 2.7.8 compiled with DSO
>>>
>>>Compilation and basic tests run good.
>>>I use the mod_python.publisher module for deploy but some modules can't
>>>be imported because there is some name resolution error (messages
>>>follows).
>>>I googled whitout success for this problem (many ask nobody answer).
>>>Thanks in advance for any help.
>>>              Marco
>>>      
>>>
>>Marco,
>>
>>this isn't a mod_python problem; it's a psycopg/postgresql problem. in
>>case you're not familiar, psycopg is a python module used to access a
>>postgresql database.
>>
>>it looks to me like psycopg was linked against a different version of
>>libpq than the one that the runtime linker is using, but that's just a
>>guess.
>>
>>you can find more information on psycopg on its website:
>>http://initd.org/software/psycopg
>>
>>good luck,
>>john spurling
>>
>>    
>>
>
>Thank you for the answer; I did some other test and I verified that
>
>-some other modules importing .so are working correctly e.g.
>mx.DateTime, gadfly
>-some don't e.g. cgi (fails to load libssl, messages below)
>-another postgres driver fails with a similar error (messages below)
>-pure python imports psycopg correctly (so I imagine it could be some
>apache/mod_python linking problem)
>-no other libpq nor libssl are in the LD_LIBRARY_PATH
>
>I'm using gnu ld: does this cause some problem?
>I've tried hacking my path so that it finds Sun's ld but errors are the
>same.
>Is it an apache config problem?
>TIA for any help
>
>	Marco
>  
>
Searching google for httpd fatal relocation error symbol not found libpq 
solaris yields some interesting results, so this seems like a more 
general problem.
e.g. http://www.geocrawler.com/mail/msg.php3?msg_id=7733831&list=10
and an interesting thread on other similar solaris problems
http://msgs.securepoint.com/cgi-bin/get/apache0203/222/1.html

David



From davis at guydavis.ca  Thu Sep  4 16:12:39 2003
From: davis at guydavis.ca (Guy Davis)
Date: Fri Jan  9 22:00:21 2004
Subject: [mod_python] How does mod_python handle concurrency?
Message-ID: <3F57B8D7.1070605@guydavis.ca>

We currently use time.strftime() in our CGI code after setting the TZ 
environment variable to the user's timezone.  Since I'm trying to move 
us away from the mod_python.cgi_handler to our own custom handler, in 
order to allow concurrent request handling, I was wondering how to get 
around the problem of having to update the TZ env var.

This dependency seems to be a problem for concurrent request 
processing.  Does anyone on this list have a trick for doing locale 
specific date formating while handling concurrent requests?

Also, does concurrent request processing in mod_python rely on a single 
Python process with multiple threads?  If so, are sys.exc_type and 
sys.exc_value shared between threads?  I'm on Apache 1.3 now but hope to 
move to Apache 2 soon.

Thanks,
Guy

From dustin at ywlcs.org  Thu Sep  4 18:40:27 2003
From: dustin at ywlcs.org (Dustin Mitchell)
Date: Fri Jan  9 22:00:21 2004
Subject: [mod_python] How does mod_python handle concurrency?
In-Reply-To: <3F57B8D7.1070605@guydavis.ca>
References: <3F57B8D7.1070605@guydavis.ca>
Message-ID: <20030904234027.GV17963@eleanor.internal.ywlcs.org>

On Thu, Sep 04, 2003 at 04:12:39PM -0600, Guy Davis wrote:
> We currently use time.strftime() in our CGI code after setting the TZ 
> environment variable to the user's timezone.  Since I'm trying to move 
> us away from the mod_python.cgi_handler to our own custom handler, in 
> order to allow concurrent request handling, I was wondering how to get 
> around the problem of having to update the TZ env var.

If you can look up the time zone offset, you can adjust the timezones
by simply adding the required number of seconds.  I know this isn't a
very good solution, but it's what I use for the small stuff I do.

I would be very interested in how you determine the user's locale?  Is
there any trick to interpreting request headers? Or is it a user
prefererence for your site?

> Also, does concurrent request processing in mod_python rely on a single 
> Python process with multiple threads?  If so, are sys.exc_type and 
> sys.exc_value shared between threads?  I'm on Apache 1.3 now but hope to 
> move to Apache 2 soon.

Yes, those values are explicitly shared between threads, which is the
reason for the creation of sys.exc_info().  See 

 http://www.python.org/doc/current/lib/module-sys.html

Dustin

-- 

  Dustin Mitchell
  dustin@ywlcs.org/djmitche@alumni.uchicago.edu
  http://people.cs.uchicago.edu/~dustin/
  PGP Key: http://people.cs.uchicago.edu/~dustin/pubkey.txt
From cs1spw at bath.ac.uk  Fri Sep  5 03:42:29 2003
From: cs1spw at bath.ac.uk (Simon Willison)
Date: Fri Jan  9 22:00:21 2004
Subject: [mod_python] Best practise for database connection pooling?
Message-ID: <3F57F815.8020300@bath.ac.uk>

We are looking to build a large content management system using 
mod_python and PostgreSQL. I'm interested in what is considered "best 
practise" for database connection pooling. So far, I've been playing 
with the idea of setting up a single database connection as a global 
variable at the start of each mod_python script - since scripts stay in 
memory between requests, this can be reused for requests without needing 
to reopen the connection. It also means that every httpd child process 
spun off by the server ends up with its own database connection.

The postgres server is running on the same machine as the web server, 
but we may move to separate servers for the two in the future. Am I on 
the right track, or is there a better way of managing database connnections?

Incidentally, the database connection module we are using is 
http://pypgsql.sourceforge.net/

Thanks,

Simon Willison

From marco.vezzoli at st.com  Fri Sep  5 08:11:35 2003
From: marco.vezzoli at st.com (Marco Vezzoli)
Date: Fri Jan  9 22:00:21 2004
Subject: [mod_python] relocation error with Apache 1.3 on solaris 8
References: <3F55876E.C9BD222F@st.com>
	<20030904002143.GF31952@c7c8.colobox.com> <3F56E2B1.1E102C94@st.com>
	<3F56F796.4040803@sjsoft.com>
Message-ID: <3F582917.216458B4@st.com>

> >
> Searching google for httpd fatal relocation error symbol not found libpq
> solaris yields some interesting results, so this seems like a more
> general problem.
> e.g. http://www.geocrawler.com/mail/msg.php3?msg_id=7733831&list=10
> and an interesting thread on other similar solaris problems
> http://msgs.securepoint.com/cgi-bin/get/apache0203/222/1.html
> 
> David

Thank you David for the pointers.
The second one suggests that careful linking options would prevent the
'main' symbol to be generated

>    I have seen a similar failure on AIX recently. It seems that 
>    php (and tcl, which was my case) use a somewhat different way to load 
>    the shared libs than PostgreSQL does.
>
>    While PostgreSQL does not care, they need a shared lib that was linked 
>    with a switch to specify no entry (like -bnoentry on AIX).
>    Maybe that has to do with our RTLD_LAZY ?

and using nm I've found that all mod_*.so libraries do not have any
'main' symbol but libpq.so does have one marked 'U'.
I'll look for more info about linker options.
	Marco
-- 
Marco Vezzoli	   tel. +39 039 603 6852
STMicroelectronics fax. +39 039 603 5055
From davidf at sjsoft.com  Fri Sep  5 09:39:24 2003
From: davidf at sjsoft.com (David Fraser)
Date: Fri Jan  9 22:00:21 2004
Subject: [mod_python] How does mod_python handle concurrency?
In-Reply-To: <20030904234027.GV17963@eleanor.internal.ywlcs.org>
References: <3F57B8D7.1070605@guydavis.ca>
	<20030904234027.GV17963@eleanor.internal.ywlcs.org>
Message-ID: <3F583DAC.5010905@sjsoft.com>

Dustin Mitchell wrote:

>On Thu, Sep 04, 2003 at 04:12:39PM -0600, Guy Davis wrote:
>  
>
>>We currently use time.strftime() in our CGI code after setting the TZ 
>>environment variable to the user's timezone.  Since I'm trying to move 
>>us away from the mod_python.cgi_handler to our own custom handler, in 
>>order to allow concurrent request handling, I was wondering how to get 
>>around the problem of having to update the TZ env var.
>>    
>>
>
>If you can look up the time zone offset, you can adjust the timezones
>by simply adding the required number of seconds.  I know this isn't a
>very good solution, but it's what I use for the small stuff I do.
>
>I would be very interested in how you determine the user's locale?  Is
>there any trick to interpreting request headers? Or is it a user
>prefererence for your site?
>  
>
This is not for the time zone, but we have enhanced the gettext module 
to be able to support multiple locales, and to localize strings per-session.
The user selects a language, the session object passes that to the 
localize function

David

From davidf at sjsoft.com  Fri Sep  5 09:53:31 2003
From: davidf at sjsoft.com (David Fraser)
Date: Fri Jan  9 22:00:21 2004
Subject: [mod_python] Best practise for database connection pooling?
In-Reply-To: <3F57F815.8020300@bath.ac.uk>
References: <3F57F815.8020300@bath.ac.uk>
Message-ID: <3F5840FB.5090006@sjsoft.com>

Simon Willison wrote:

> We are looking to build a large content management system using 
> mod_python and PostgreSQL. I'm interested in what is considered "best 
> practise" for database connection pooling. So far, I've been playing 
> with the idea of setting up a single database connection as a global 
> variable at the start of each mod_python script - since scripts stay 
> in memory between requests, this can be reused for requests without 
> needing to reopen the connection. It also means that every httpd child 
> process spun off by the server ends up with its own database connection.

We have a system where we use multiple different database connections 
for different applications running on the same server.
Each application object exists once per child, and has its own database 
connection.

> The postgres server is running on the same machine as the web server, 
> but we may move to separate servers for the two in the future. Am I on 
> the right track, or is there a better way of managing database 
> connnections?

You may want to look at http://sqlrelay.sourceforge.net/ - I haven't 
used it, but it seems useful particularly if you have separate servers.
For those not going and reading the page:
SQL Relay is a persistent database connection pooling, proxying and load 
balancing system for Unix and Linux supporting ODBC, Oracle, MySQL, 
mSQL, PostgreSQL, Sybase, MS SQL Server, IBM DB2, Interbase, Lago and 
SQLite with APIs for C, C++, Perl, Perl-DBD, Python, Python-DB, Zope, 
PHP, Ruby, Ruby-DBD, TCL and Java, command line clients, a GUI 
configuration tool and extensive documentation. The APIs support 
advanced database operations such as bind variables, multi-row fetches, 
client side result set caching and suspended transactions. It is ideal 
for speeding up database-driven web-based applications, accessing 
databases from unsupported platforms, migrating between databases, 
distributing access to replicated databases and throttling database access.

>
> Incidentally, the database connection module we are using is 
> http://pypgsql.sourceforge.net/

I've found PyGreSQL to be better...
http://www.druid.net/pygresql/
But you may find otherwise...

David

From gdamjan at mail.net.mk  Fri Sep  5 16:18:51 2003
From: gdamjan at mail.net.mk (Damjan)
Date: Fri Jan  9 22:00:21 2004
Subject: [mod_python] How does mod_python handle concurrency?
In-Reply-To: <3F57B8D7.1070605@guydavis.ca>
References: <3F57B8D7.1070605@guydavis.ca>
Message-ID: <20030905141851.GA8470@legolas.on.net.mk>

> We currently use time.strftime() in our CGI code after setting the TZ 
> environment variable to the user's timezone.  Since I'm trying to move 
> us away from the mod_python.cgi_handler to our own custom handler, in 
> order to allow concurrent request handling, I was wondering how to get 
> around the problem of having to update the TZ env var.

Setting environment variables in multithreaded/concurent programs 
is ugly.
I would suggest a different approach for your problem..
t = time.gmtime() # get the UTC time tupple
t = t[:-1] + (TZ,) # set the TZ field of the tupple
time.strftime(format,t) # get the strftime of that 


Also glibc as of 2.3 has a new multithreaded locale API, it doesn't 
depend on global variables. This would be great (and indead is designed
for) for multithreaded application servers like Apache.
Unfourtenatelly I don't know that python bindings for this API exists or
if at all anyone is working on this...

> This dependency seems to be a problem for concurrent request 
> processing.  Does anyone on this list have a trick for doing locale 
> specific date formating while handling concurrent requests?
> http://mailman.modpython.org/mailman/listinfo/mod_python

-- 
Damjan Georgievski
jabberID: damjan@bagra.net.mk
From conrad at hep.caltech.edu  Sat Sep  6 20:04:51 2003
From: conrad at hep.caltech.edu (Conrad Steenberg)
Date: Fri Jan  9 22:00:21 2004
Subject: [mod_python] ANNOUNCE: Mod_python 3.1.0 Alpha
In-Reply-To: <20030829171157.O56156@onyx.ispol.com>
References: <20030828210644.C43921@onyx.ispol.com>
	<20030829171157.O56156@onyx.ispol.com>
Message-ID: <1062903891.2713.33.camel@Presario>

Hi

Having played around with the new version and PSP, I have one question:
My application doesn't use the session infrastructure provided by PSP,
but 256 sessions (in shared memory) are created at startup anyway.

This prompts a change in the kernel semaphore settings on older linuxes
(redhat 7.3 specifically).  As this will likely trip up new sysadmins
that just want to try out the package, is there a way to reduce the
number of sessions (or space for these sessions) by using a directive?

If there isn't such a directive, is it possible to add one?

Cheers!

Conrad

On Fri, 2003-08-29 at 14:21, Gregory (Grisha) Trubetskoy wrote:
> On Fri, 29 Aug 2003, Conrad Steenberg wrote:
> 
> > Hi
> >
> > Tested here to be working under an OpenPKG-1.3 (ish) environment.
> >
> > Any pointers to higher level tools that works with the included version
> > of PSP (such as for constructing a news or blogging site)? There seems
> > to be at least two other projects also calling themselves PSP ;-)
> 
> There is even one called Perl Server Pages :-)
> 
> I doubt there are any tools, since our PSP is brand new. B
> 
> But it's rather simplistic. For everyone's info:
> 
> This describes the syntax:
> 
> http://www.modpython.org/live/mod_python-3.1.0a/doc-html/pyapi-psp.html
> 
> And this describes the psp handler (things like sessions, etc):
> 
> http://www.modpython.org/live/mod_python-3.1.0a/doc-html/pyapi-psp.html
> 
> Also, if you have any JSP experience, there was an e-mail on the dev list
> regarding how it corresponds to PSP, which I'll forward to this list
> (because I forgot where the dev list archives are).
> 
> Grisha
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
-- 
Conrad Steenberg <conrad@hep.caltech.edu>
From grisha at apache.org  Sun Sep  7 18:45:45 2003
From: grisha at apache.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 22:00:21 2004
Subject: [mod_python] ANNOUNCE: Mod_python 3.1.0 Alpha
In-Reply-To: <1062903891.2713.33.camel@Presario>
References: <20030828210644.C43921@onyx.ispol.com>
	<1062188981.14514.296.camel@heppc22>
	<1062903891.2713.33.camel@Presario>
Message-ID: <20030907180501.B83449@onyx.ispol.com>


On Sat, 6 Sep 2003, Conrad Steenberg wrote:

> This prompts a change in the kernel semaphore settings on older linuxes
> (redhat 7.3 specifically).

Well - I think this is really a redhat problem. I believe I even saw
something reporting it as a security problem - it is very easy for someone
to deprive an rh box of available semaphores. I wonder what the default is
on rh 8 and 9 (anyone?).

> As this will likely trip up new sysadmins that just want to try out the
> package,

It probably will :-(
But that's why there is a "Hint" in the error log for Linux users.

> is there a way to reduce the number of sessions (or space for
> these sessions) by using a directive?

Yes, there is a way - adjust MaxClients. Some MPM's (at least worker) will
alter MaxClients if the other directives do not add up to or exceed it, so
it's possible other values may need adjusting.

BTW, mod_python does NOT quit if it was able to allocate *some* locks, but
not *all*, it only writes a warning to the error log and proceeds. But
what craps out after that is mod_rewrite, which wants a global lock, but
mod_python has eaten them all. So perhaps I can adjust it so that if we
allocated *some* but not *all*, then to free one (or two?)  so that
mod_rewrite is happy.

(On the other hand doing this may seem like going too far to adress what
is really a lousy config default in the kernel....)

Grisha

>
> If there isn't such a directive, is it possible to add one?
>
> Cheers!
>
> Conrad
>
> On Fri, 2003-08-29 at 14:21, Gregory (Grisha) Trubetskoy wrote:
> > On Fri, 29 Aug 2003, Conrad Steenberg wrote:
> >
> > > Hi
> > >
> > > Tested here to be working under an OpenPKG-1.3 (ish) environment.
> > >
> > > Any pointers to higher level tools that works with the included version
> > > of PSP (such as for constructing a news or blogging site)? There seems
> > > to be at least two other projects also calling themselves PSP ;-)
> >
> > There is even one called Perl Server Pages :-)
> >
> > I doubt there are any tools, since our PSP is brand new. B
> >
> > But it's rather simplistic. For everyone's info:
> >
> > This describes the syntax:
> >
> > http://www.modpython.org/live/mod_python-3.1.0a/doc-html/pyapi-psp.html
> >
> > And this describes the psp handler (things like sessions, etc):
> >
> > http://www.modpython.org/live/mod_python-3.1.0a/doc-html/pyapi-psp.html
> >
> > Also, if you have any JSP experience, there was an e-mail on the dev list
> > regarding how it corresponds to PSP, which I'll forward to this list
> > (because I forgot where the dev list archives are).
> >
> > Grisha
> >
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://mailman.modpython.org/mailman/listinfo/mod_python
> --
> Conrad Steenberg <conrad@hep.caltech.edu>
>
From llsousa at ualg.pt  Mon Sep  8 11:48:53 2003
From: llsousa at ualg.pt (Luis Sousa)
Date: Fri Jan  9 22:00:21 2004
Subject: [mod_python] Some problems with mod_python.publisher
In-Reply-To: <20030615154824.64623.qmail@web40402.mail.yahoo.com>
References: <20030615154824.64623.qmail@web40402.mail.yahoo.com>
Message-ID: <3F5C5E95.5080603@ualg.pt>

Michel Thadeu wrote:

>Hi guys!
>
>I having trouble with mod_python.publisher, I using a apache 1.2.27 and
>the mod_python 2.7 (the standard version of debian testing).
>
>I have configured the apache like this:
>
>   <Directory /var/www/modpython>
>     AddHandler python-program .py
>     PythonHandler mod_python.publisher
>   </Directory>
>
>And have made a script named index.py with the next code:
>
>   from mod_python import apache
>   def executar(req):
>           req.content_type="text/html"
>           req.send_http_header()
>           req.write('<H1>Some test of executar!</H1>')
>           return apache.OK
>
The code here can be something like this:
s="<html><h1>hello world</h1></html>"
return s

When using mod_python.publisher you have to return a string
Luis Sousa

>
>But when I execute this script, using the next url...
>
>   http://localhost/modpython/index.py/executar
>
>The page is open, rendening html code, and all the things, but with a
>error message:
>
>   Some test of executar!
>   HTTP/1.1 200 OK Date: Tue, 17 Jun 2003 23:36:26 GMT Server: 
>   Apache/1.3.27 (Unix) Debian GNU/Linux mod_python/2.7.8 Python/2.2.2 
>   PHP/4.1.2 Connection: close Transfer-Encoding: chunked Content-Type:
>
>   text/html; charset=iso-8859-1
>   OK
>   The server encountered an internal error or misconfiguration and was
>
>   unable to complete your request.
>
>   Please contact the server administrator, webmaster@capsulecorp and 
>   inform them of the time the error occurred, and anything you might 
>   have done that may have caused the error.
>
>   More information about this error may be available in the server 
>   error log.
>
>But if I use PythonHanldler and name executar as handler, the error is
>not shown... I read the last lines of error.log of apache, but I don't
>found a critical error:
>
>   [Tue Jun 17 21:42:29 2003] [alert] apache: Could not determine the 
>   server's fully qualified domain name, using 127.0.0.1 for ServerName
>   [Tue Jun 17 21:42:30 2003] [notice] Apache/1.3.27 (Unix) Debian 
>   GNU/Linux mod_python/2.7.8 Python/2.2.2 PHP/4.1.2 configured -- 
>   resuming normal operations
>   [Tue Jun 17 21:42:30 2003] [notice] suEXEC mechanism enabled 
>   (wrapper: /usr/lib/apache/suexec)
>   [Tue Jun 17 21:42:30 2003] [notice] Accept mutex: sysvsem (Default: 
>   sysvsem)
>
>This is the last errors since the last restart of apache...
>
>Well, I don't know what error I made, can someone help me?
>
>thanks
>--
>Michel Thadeu Sabchuk
>Curitiba - Paran? - Brazil
>
>=====
>--
>Michel Thadeu Sabchuk
>Curitiba/PR
>
>_______________________________________________________________________
>Yahoo! Mail
>Mais espa?o, mais seguran?a e gratuito: caixa postal de 6MB, antiv?rus, prote??o contra spam.
>http://br.mail.yahoo.com/
>_______________________________________________
>Mod_python mailing list
>Mod_python@modpython.org
>http://mailman.modpython.org/mailman/listinfo/mod_python
>
>
>  
>


-- 
Luis Sousa
Especialista de Inform?tica
Gabinete de Gest?o de Informa??o, ext: 7837
Campus de Gambelas
Universidade do Algarve, tel: 289800900

-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/x-pkcs7-signature
Size: 3627 bytes
Desc: S/MIME Cryptographic Signature
Url : http://mailman.modpython.org/pipermail/mod_python/attachments/20030908/1f41dfc5/smime-0002.bin
From llsousa at ualg.pt  Mon Sep  8 12:23:41 2003
From: llsousa at ualg.pt (Luis Sousa)
Date: Fri Jan  9 22:00:21 2004
Subject: [mod_python] 
	Handler publisher with multiple directories on the same tree
Message-ID: <3F5C66BD.8060402@ualg.pt>

Hello everybody.

I'm using Apache 1.3.26-0woody3 and mod_python 2.7.8-6, debian releases.
I have configured just one directory on my public_html and added some 
directives to httpd.conf file as follows:

<Directory /home/llsousa/public_html/gpessoal/trunk>
    AddHandler python-program .py
    PythonHandler mod_python.publisher
    PythonDebug On
    PythonPath "sys.path+['/home/llsousa/public_html/gpessoal/trunk']"
</Directory>

And everything worked ok.
So, I needed 2 more folders and I did the same for the rest, like this:

<Directory /home/llsousa/public_html/gpessoal/dev>
    AddHandler python-program .py
    PythonHandler mod_python.publisher
    PythonDebug On
    PythonPath "sys.path+['/home/llsousa/public_html/gpessoal/dev']"
</Directory>

<Directory /home/llsousa/public_html/gpessoal/bugs>
    AddHandler python-program .py
    PythonHandler mod_python.publisher
    PythonDebug On
    PythonPath "sys.path+['/home/llsousa/public_html/gpessoal/bugs']"
</Directory>

But I got a unpleasent surprise, that is, using browser, I access one of 
the projects subsection and everything is OK. After I got the page, I 
tried to access to another of the subsection and I got an 404, page not 
found. If I wait for a while (I don't know exactly, but something like 
one minute) and made reload on browser, I can now see this subsection.

Does anyone have any clue about this ? What am I doing wrong ?

Thanks in advance for your help,
Luis Sousa

-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/x-pkcs7-signature
Size: 3627 bytes
Desc: S/MIME Cryptographic Signature
Url : http://mailman.modpython.org/pipermail/mod_python/attachments/20030908/7509d5b4/smime-0002.bin
From mike.looijmans at asml.com  Mon Sep  8 13:35:35 2003
From: mike.looijmans at asml.com (Mike Looijmans)
Date: Fri Jan  9 22:00:21 2004
Subject: [mod_python] Handler publisher with multiple directories on the
	same tree
Message-ID: <01c375fd$51705d80$926a1e6e@wsasd464>

My guess:

If you wait for about a minute, the server will drop the keepalive
connection and another child process will handle your request. The effect is
that you probably get a brand new environment. Probably if you repeat often
enough, it will break completely when all childs are "loaded".

The problem is probably that you have equal named scripts in each directory.
So if you have

/a/foo.py
/b/foo.py

The first call will fetch /a/foo.py, and when you want to load the 'b'
version, it will just return the 'a' version because a 'foo' script is
already imported, even if pythonpath no longer contains the /a/ directory.

Scripts must have unique names, even when in different directories.

A good workaround is to use the "PythonInterpreter" directive, set it to per
directory or specify a unique interpreter name for each directory.
Each interpreter will have its own modules, so the "already loaded" effect
won't bite you.
This does, however, consume more memory.

This is also great for testing, you can add a "test" directory with a
different interpreter and have an environment completely set apart with it
own set of scripts and data and so.

[snip]
>But I got a unpleasent surprise, that is, using browser, I access one of
>the projects subsection and everything is OK. After I got the page, I
>tried to access to another of the subsection and I got an 404, page not
>found. If I wait for a while (I don't know exactly, but something like
>one minute) and made reload on browser, I can now see this subsection.




-- 
The information contained in this communication and any attachments is confidential and may be privileged, and is for the sole use of the intended recipient(s). Any unauthorized review, use, disclosure or distribution is prohibited. If you are not the intended recipient, please notify the sender immediately by replying to this message and destroy all copies of this message and any attachments. ASML is neither liable for the proper and complete transmission of the information contained in this communication, nor for any delay in its receipt.


From neo at https.ru  Mon Sep  8 16:59:20 2003
From: neo at https.ru (Neo Eureka)
Date: Fri Jan  9 22:00:21 2004
Subject: [mod_python] Resource consumption
In-Reply-To: <20030907180501.B83449@onyx.ispol.com>
References: <20030828210644.C43921@onyx.ispol.com>
 <1062188981.14514.296.camel@heppc22> <1062903891.2713.33.camel@Presario>
 <20030907180501.B83449@onyx.ispol.com>
Message-ID: <11020798025.20030908165920@https.ru>


Hi all!

Grisha,

IIUC, shared memory and semaphores are allocated even if I don't use
sessions or PSP at all ? Is there a way to completely "switch off"
the features I do not (and will not) use ever ? It seems very strange
to me: features that I do not use still consume system resources and
cause problems with server startup (yes, I've got RedHat box).


> On Sat, 6 Sep 2003, Conrad Steenberg wrote:

>> This prompts a change in the kernel semaphore settings on older linuxes
>> (redhat 7.3 specifically).

> Well - I think this is really a redhat problem. I believe I even saw
> something reporting it as a security problem - it is very easy for someone
> to deprive an rh box of available semaphores. I wonder what the default is
> on rh 8 and 9 (anyone?).

>> As this will likely trip up new sysadmins that just want to try out the
>> package,

> It probably will :-(
> But that's why there is a "Hint" in the error log for Linux users.

>> is there a way to reduce the number of sessions (or space for
>> these sessions) by using a directive?

> Yes, there is a way - adjust MaxClients. Some MPM's (at least worker) will
> alter MaxClients if the other directives do not add up to or exceed it, so
> it's possible other values may need adjusting.

> BTW, mod_python does NOT quit if it was able to allocate *some* locks, but
> not *all*, it only writes a warning to the error log and proceeds. But
> what craps out after that is mod_rewrite, which wants a global lock, but
> mod_python has eaten them all. So perhaps I can adjust it so that if we
> allocated *some* but not *all*, then to free one (or two?)  so that
> mod_rewrite is happy.

> (On the other hand doing this may seem like going too far to adress what
> is really a lousy config default in the kernel....)

> Grisha


--- 
Neo Eureka / mailto:neo@https.ru

From llsousa at ualg.pt  Mon Sep  8 14:21:46 2003
From: llsousa at ualg.pt (Luis Sousa)
Date: Fri Jan  9 22:00:21 2004
Subject: [mod_python] Handler publisher with multiple directories on the
 same tree
In-Reply-To: <01c375fd$51705d80$926a1e6e@wsasd464>
References: <01c375fd$51705d80$926a1e6e@wsasd464>
Message-ID: <3F5C826A.80404@ualg.pt>

Skipped content of type multipart/alternative-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/x-pkcs7-signature
Size: 3627 bytes
Desc: S/MIME Cryptographic Signature
Url : http://mailman.modpython.org/pipermail/mod_python/attachments/20030908/79dd05a8/smime-0002.bin
From mike.looijmans at asml.com  Mon Sep  8 15:40:26 2003
From: mike.looijmans at asml.com (Mike Looijmans)
Date: Fri Jan  9 22:00:21 2004
Subject: [mod_python] Handler publisher with multiple directories on
	thesame tree
Message-ID: <01c3760e$c26c4100$926a1e6e@wsasd464>

> When I'm developing I usually have a common problem that is when I
> change a class or some file, sometimes the interpreter remains in memory
> the old version and doesn't load the new one. Is there a way to solve
> this out ? Normally I use an non elegant way, I restart apache!

I use the "reload" built-in function. This loads an internal module from
disk.
My main handler checks if the path_info of the URL is "/request" and if so,
runs the following (you could use publisher to publish this interface as
well).
All "my" modules are named "ops_" something. You could also use the __file__
location as a filter.

def reloadmodules(req):
    '''Try to reload all ops_ modules. This is typically done after updating
    imported scripts, such as ops_cgisql.py. The main scripts will be
    reloaded automatically on demand, so that there is no need to send
    a reload after changing ops_webrellist.py or so.
    This also throws away old DB connections. If there are currently
    active connections, these are preserved.'''
    req.content_type='text/plain'
    # Reload python modules
    modules = sys.modules.keys()
    modules.sort()
    for module in modules:
        if module[:4] == 'ops_':
            try:
                req.write('Reloading: %s\n' % module)
                reload(sys.modules[module])
            except:
                req.write('%s: %s\n' % sys.exc_info()[:2])
    # throw away DB connection objects
    req.write('Destroy DB cached connections\n')
    _lock.acquire()
    try:
        dblist.clear()
    finally:
        _lock.release()
    req.write('Done\n')





-- 
The information contained in this communication and any attachments is confidential and may be privileged, and is for the sole use of the intended recipient(s). Any unauthorized review, use, disclosure or distribution is prohibited. If you are not the intended recipient, please notify the sender immediately by replying to this message and destroy all copies of this message and any attachments. ASML is neither liable for the proper and complete transmission of the information contained in this communication, nor for any delay in its receipt.


From grisha at modpython.org  Mon Sep  8 09:53:57 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 22:00:21 2004
Subject: [mod_python] Resource consumption
In-Reply-To: <11020798025.20030908165920@https.ru>
References: <20030828210644.C43921@onyx.ispol.com>
	<1062188981.14514.296.camel@heppc22>
	<20030907180501.B83449@onyx.ispol.com>
	<11020798025.20030908165920@https.ru>
Message-ID: <20030908092907.A93462@onyx.ispol.com>



On Mon, 8 Sep 2003, Neo Eureka wrote:

> IIUC, shared memory and semaphores are allocated even if I don't use
> sessions or PSP at all?

Yes (there is no shared memory used for sessions, only locks, which *may*
be semaphores or some other lock implementation, depending on your OS).

> Is there a way to completely "switch off" the features I do not (and
> will not) use ever ?

Not right now. I couldn't think of a way to do it that wouldn't be
confusing. Locks must be allocated at server startup so that children
have access to them. We could have a directive like "PythonSessionLocks
Off", IMHO that's on the ugly side.

Generally, I think keeping the number of Apache directive to a minimum is
a good idea.

> It seems very strange to me: features that I do not use still consume
> system resources

That's not unusual - as an example, every RH box will load all kinds of
modules (including mod_python), but few people ever use them all.

> and cause problems with server startup

This, I agree, *is* a problem, but I think I can work around it without
introducing new Apache directives.

Another point to consider is that on many other systems there will not be
a limit to the number of locks allocated, and there is no cost to
allocating a lock but never using it, so a directive like this wouldn't
make much sense.

Grisha

> (yes, I've got RedHat box).


>
>
> > On Sat, 6 Sep 2003, Conrad Steenberg wrote:
>
> >> This prompts a change in the kernel semaphore settings on older linuxes
> >> (redhat 7.3 specifically).
>
> > Well - I think this is really a redhat problem. I believe I even saw
> > something reporting it as a security problem - it is very easy for someone
> > to deprive an rh box of available semaphores. I wonder what the default is
> > on rh 8 and 9 (anyone?).
>
> >> As this will likely trip up new sysadmins that just want to try out the
> >> package,
>
> > It probably will :-(
> > But that's why there is a "Hint" in the error log for Linux users.
>
> >> is there a way to reduce the number of sessions (or space for
> >> these sessions) by using a directive?
>
> > Yes, there is a way - adjust MaxClients. Some MPM's (at least worker) will
> > alter MaxClients if the other directives do not add up to or exceed it, so
> > it's possible other values may need adjusting.
>
> > BTW, mod_python does NOT quit if it was able to allocate *some* locks, but
> > not *all*, it only writes a warning to the error log and proceeds. But
> > what craps out after that is mod_rewrite, which wants a global lock, but
> > mod_python has eaten them all. So perhaps I can adjust it so that if we
> > allocated *some* but not *all*, then to free one (or two?)  so that
> > mod_rewrite is happy.
>
> > (On the other hand doing this may seem like going too far to adress what
> > is really a lousy config default in the kernel....)
>
> > Grisha
>
>
> ---
> Neo Eureka / mailto:neo@https.ru
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From grickert at coldstorage.com  Mon Sep  8 17:18:13 2003
From: grickert at coldstorage.com (Gerrat Rickert)
Date: Fri Jan  9 22:00:21 2004
Subject: [mod_python] 
Message-ID: <DIEMKLHLKFCCPAEPDMHKIEFECEAA.grickert@coldstorage.com>



Gerrat Rickert
Systems Analyst
Conestoga Coldstorage


From grickert at coldstorage.com  Mon Sep  8 17:42:33 2003
From: grickert at coldstorage.com (Gerrat Rickert)
Date: Fri Jan  9 22:00:21 2004
Subject: [mod_python] 
	PythonHandler does not appear to append directory to import path
Message-ID: <DIEMKLHLKFCCPAEPDMHKCEFFCEAA.grickert@coldstorage.com>

I'm using mod_python 3.03, apache 2.047, and python 2.2.3 on a win2K machine
& am trying to use the publisher handler.  The problem is when I try to add
an additional handler via:

req.addhandler("PythonHandler", testModule, directory_to_append_to_sys_path)

The error I am getting is:

Mod_python error: "PythonHandler testModule"

Traceback (most recent call last):

  File "D:\Python22\lib\site-packages\mod_python\apache.py", line 340, in
HandlerDispatch
    module = import_module(module_name, config)

  File "D:\Python22\lib\site-packages\mod_python\apache.py", line 516, in
import_module
    f, p, d = imp.find_module(parts[i], path)

ImportError: No module named testModule



Looking through the HandlerDispatch function of apache.py, the relevant code
is:

if config.has_key("PythonPath"):
...
else:
    dir = hlist.directory
    if dir and (dir not in sys.path):
        sys.path[:0] = [dir]


This code doesn't appear to add my directory
(directory_to_append_to_sys_path) to the sys.path if I have "PythonPath" in
my httpd.conf file.  Importing my module fails because of this.  I'm not
sure if this is just a misunderstanding on my part or has already been
addressed (in which case I apologize for posting).  As far as I can see, the
"else" portion of this statement should be executed regardless of whether
PythonPath is in the config file or not.  Can anyone else confirm this?

Thanks,
Gerrat Rickert


From grisha at modpython.org  Tue Sep  9 10:41:55 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 22:00:21 2004
Subject: [mod_python]  PythonHandler does not appear to append directory
 to import path
In-Reply-To: <DIEMKLHLKFCCPAEPDMHKCEFFCEAA.grickert@coldstorage.com>
References: <DIEMKLHLKFCCPAEPDMHKCEFFCEAA.grickert@coldstorage.com>
Message-ID: <20030909103210.V9524@onyx.ispol.com>


Gerrat -

You're right, it doesn't add the directory to the path if PythonPath is
specified. The code that decides this has no way of knowing whether the
handler was specified via an Apache directive or req.add_handler(). It
just follows the rule that PythonPath overrides everything.

The rationale for this all-overriding behaviour of PythonPath is that you
can use it make sure that the directory where the handler is specified is
_not_ in sys.path. (Otherwise, if the directive directory was _always_
added, there would be no way to achieve this)

You can do two things:

1. Add directory_to_append_to_sys_path to PythonPath
2. Get rid of PythonPath. I see a lot of people using it where they really
don't need to. See if you _really_ need it.

What *I* need to do is adjust the documentation of add_handler() to
clarify that dir has no effect when PythonPath is specified.

Grisha

On Mon, 8 Sep 2003, Gerrat Rickert wrote:

> I'm using mod_python 3.03, apache 2.047, and python 2.2.3 on a win2K machine
> & am trying to use the publisher handler.  The problem is when I try to add
> an additional handler via:
>
> req.addhandler("PythonHandler", testModule, directory_to_append_to_sys_path)
>
> The error I am getting is:
>
> Mod_python error: "PythonHandler testModule"
>
> Traceback (most recent call last):
>
>   File "D:\Python22\lib\site-packages\mod_python\apache.py", line 340, in
> HandlerDispatch
>     module = import_module(module_name, config)
>
>   File "D:\Python22\lib\site-packages\mod_python\apache.py", line 516, in
> import_module
>     f, p, d = imp.find_module(parts[i], path)
>
> ImportError: No module named testModule
>
>
>
> Looking through the HandlerDispatch function of apache.py, the relevant code
> is:
>
> if config.has_key("PythonPath"):
> ...
> else:
>     dir = hlist.directory
>     if dir and (dir not in sys.path):
>         sys.path[:0] = [dir]
>
>
> This code doesn't appear to add my directory
> (directory_to_append_to_sys_path) to the sys.path if I have "PythonPath" in
> my httpd.conf file.  Importing my module fails because of this.  I'm not
> sure if this is just a misunderstanding on my part or has already been
> addressed (in which case I apologize for posting).  As far as I can see, the
> "else" portion of this statement should be executed regardless of whether
> PythonPath is in the config file or not.  Can anyone else confirm this?
>
> Thanks,
> Gerrat Rickert
>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From grickert at coldstorage.com  Tue Sep  9 11:43:15 2003
From: grickert at coldstorage.com (Gerrat Rickert)
Date: Fri Jan  9 22:00:21 2004
Subject: [mod_python]  PythonHandler does not appear to append directory
 to import path
Message-ID: <DIEMKLHLKFCCPAEPDMHKIEFHCEAA.grickert@coldstorage.com>

Grisha -

Thanks for your response - much appreciated.  I'm probably using PythonPath
where I don't need to.  I have some modules I'd like to share between
several web apps & I can just add their path to my PYTHONPATH environment
variable & remove the PythonPath directive.

Gerrat


From llsousa at ualg.pt  Tue Sep  9 17:19:00 2003
From: llsousa at ualg.pt (Luis Sousa)
Date: Fri Jan  9 22:00:22 2004
Subject: [mod_python] Handler publisher with multiple directories on
	thesame tree
In-Reply-To: <01c3760e$c26c4100$926a1e6e@wsasd464>
References: <01c3760e$c26c4100$926a1e6e@wsasd464>
Message-ID: <3F5DFD74.3030100@ualg.pt>

Skipped content of type multipart/alternative-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/x-pkcs7-signature
Size: 3627 bytes
Desc: S/MIME Cryptographic Signature
Url : http://mailman.modpython.org/pipermail/mod_python/attachments/20030909/bdba7319/smime-0002.bin
From davidf at sjsoft.com  Tue Sep  9 18:56:34 2003
From: davidf at sjsoft.com (David Fraser)
Date: Fri Jan  9 22:00:22 2004
Subject: [mod_python]  PythonHandler does not appear to append directory
 to import path
In-Reply-To: <DIEMKLHLKFCCPAEPDMHKIEFHCEAA.grickert@coldstorage.com>
References: <DIEMKLHLKFCCPAEPDMHKIEFHCEAA.grickert@coldstorage.com>
Message-ID: <3F5E0642.9090702@sjsoft.com>

Gerrat Rickert wrote:

>Grisha -
>
>Thanks for your response - much appreciated.  I'm probably using PythonPath
>where I don't need to.  I have some modules I'd like to share between
>several web apps & I can just add their path to my PYTHONPATH environment
>variable & remove the PythonPath directive.
>
>Gerrat
>  
>
It might be helpful to look at putting these shared modules in a package 
that is either located under site-packages, or where the location is put 
in a .pth file under site-packages. Then you don't need to adjust any 
path things at all

David

From neel at mediapulse.com  Tue Sep  9 17:26:23 2003
From: neel at mediapulse.com (Michael C. Neel)
Date: Fri Jan  9 22:00:22 2004
Subject: [mod_python] Using dbpool in more than one place....
Message-ID: <C0FC22C08B82074A88B50061764157775CCB@johnson.mediapulse.net>

I'm currently trying to migrate an apache 1.3 / mod_python 2.7.8 site to
apache 2.x and mod_python 3.x.

I currently load two different mod_python modules for the site, one to
log hits to a database, the other to run site site pages.  I'm using
worker threads on apache, and trying to use dbpool to work around
MySQLdb's threading level 1.

The logging module connects to a remote 3.23.x Mysql box; the site
module connects to a local MySQL 4.x database.  If I disable one module,
the other (using dbpool) will run fine; it's when I try to run both I
get problems.  When I "import jon.dbpool as dbpool" on both, I get the
following errors in the global apache log:

Exception exceptions.RuntimeError: 'maximum recursion depth exceeded' in
<function _connection_notinuse at 0x41afbaac> ignored
Exception exceptions.TypeError: 'weak object has gone away' in <function
_connection_notinuse at 0x41afbaac> ignored

When I "import jon.dbpool as logger_dbpool" in the log module and
"import jon.dbpool as dbpool" in the site module I get the following
error in the sites log file:

Mod_python error: "PythonHandler www"

Traceback (most recent call last):

  File "/usr/local/lib/python2.3/site-packages/mod_python/apache.py",
line 338, in HandlerDispatch
    result = object(req)

  File "/home/sites/beta/modules/www.py", line 51, in handler
    c = db.cursor()

  File "/usr/local/lib/python2.3/site-packages/jon/dbpool.py", line 93,
in cursor
    return self._inner.cursor(*args, **kwargs)

  File "/usr/local/lib/python2.3/site-packages/jon/dbpool.py", line 129,
in cursor
    c = _Cursor(self, *args, **kwargs)

  File "/usr/local/lib/python2.3/site-packages/jon/dbpool.py", line 140,
in __init__
    self._outer = connection._outerref()

TypeError: 'NoneType' object is not callable


Is it possbile to use dbpool to connect to two different databases,
using two different mod_python modules?

Thanks,
Mike

From fumanchu at aminus.net  Tue Sep  9 16:59:06 2003
From: fumanchu at aminus.net (fumanchu)
Date: Fri Jan  9 22:00:22 2004
Subject: [mod_python] Using dbpool in more than one place....
In-Reply-To: <DE1CF2B4FEC4A342BF62B6B2B334601E43651A@opus.HQAMOR.amorhq.net>
Message-ID: <DE1CF2B4FEC4A342BF62B6B2B334601E42D20E@opus.HQAMOR.amorhq.net>

Quick response: the message:

Exception exceptions.RuntimeError: 'maximum recursion depth exceeded' in
<function _connection_notinuse at 0x41afbaac> ignored

is most likely due a namespace collision, where you think you're calling
one function and you're really calling another with the same name,
(usually the current function, although parallel recursion has been
known to occur). When using "as", try using unique new names, not
fragments of existing names. So try:

"import jon.dbpool as logger_dbpool" in the log module and
"import jon.dbpool as site_dbpool" in the site module.

Just a thought.


Robert Brewer
fumanchu@aminus.net

From mike.looijmans at asml.com  Wed Sep 10 07:15:45 2003
From: mike.looijmans at asml.com (Mike Looijmans)
Date: Fri Jan  9 22:00:22 2004
Subject: [mod_python] Handler publisher with multiple directories
	onthesame tree
Message-ID: <01c3775a$965dd680$926a1e6e@wsasd464>

>>My main handler checks if the path_info of the URL is "/request" and if 
>
>How do you check this ?


Uh, basically:

if req.path_info == '/reload':
    return reloadModules(req)

:-)



-- 
The information contained in this communication and any attachments is confidential and may be privileged, and is for the sole use of the intended recipient(s). Any unauthorized review, use, disclosure or distribution is prohibited. If you are not the intended recipient, please notify the sender immediately by replying to this message and destroy all copies of this message and any attachments. ASML is neither liable for the proper and complete transmission of the information contained in this communication, nor for any delay in its receipt.


From gdamjan at mail.net.mk  Wed Sep 10 15:55:38 2003
From: gdamjan at mail.net.mk (Damjan)
Date: Fri Jan  9 22:00:22 2004
Subject: [mod_python] ANNOUNCE: Mod_python 3.1.0 Alpha
In-Reply-To: <20030907180501.B83449@onyx.ispol.com>
References: <20030828210644.C43921@onyx.ispol.com>
	<1062188981.14514.296.camel@heppc22> <1062903891.2713.33.camel@Presario>
	<20030907180501.B83449@onyx.ispol.com>
Message-ID: <20030910135538.GC3575@legolas.on.net.mk>

> > This prompts a change in the kernel semaphore settings on older linuxes
> > (redhat 7.3 specifically).
> 
> Well - I think this is really a redhat problem. I believe I even saw
> something reporting it as a security problem - it is very easy for someone
> to deprive an rh box of available semaphores. I wonder what the default is
> on rh 8 and 9 (anyone?).

Well I have Slackware-9+, and the defaults are not changed from the
kernel defaults:
    damjan$ cat /proc/sys/kernel/sem
    250     32000   32      128

I'm using 
    echo "512     32000   32      512" > /proc/sys/kernel/sem
right now.


-- 
Damjan Georgievski
jabberID: damjan@bagra.net.mk
From pu at vo.lu  Thu Sep 11 23:41:22 2003
From: pu at vo.lu (Patrick Useldinger)
Date: Fri Jan  9 22:00:22 2004
Subject: [mod_python] mod_python 3.1
Message-ID: <oprvcui8zixiz7y9@smtp.vo.lu>

I have read in the mailing list archives that only mod_python 3.1 and 
higher will work with Python 2.3. Is this still correct? If so, when is 
version 3.1 sheduled?
-pu
From barry at python.org  Thu Sep 11 18:20:54 2003
From: barry at python.org (Barry Warsaw)
Date: Fri Jan  9 22:00:22 2004
Subject: [mod_python] mod_python 3.1
In-Reply-To: <oprvcui8zixiz7y9@smtp.vo.lu>
References: <oprvcui8zixiz7y9@smtp.vo.lu>
Message-ID: <1063318854.19907.15.camel@anthem>

On Thu, 2003-09-11 at 17:41, Patrick Useldinger wrote:
> I have read in the mailing list archives that only mod_python 3.1 and 
> higher will work with Python 2.3. Is this still correct? If so, when is 
> version 3.1 sheduled?

modpython 3.0.3 works fine with Python 2.3, but to build it you need to
hack src/include/mod_python.h.  There's a FAQ entry with the necessary
patch.

Maybe Grisha should release a 3.0.4 with just this one patch?

-Barry


From pu at vo.lu  Fri Sep 12 00:31:34 2003
From: pu at vo.lu (Patrick Useldinger)
Date: Fri Jan  9 22:00:22 2004
Subject: [mod_python] mod_python 3.1
In-Reply-To: <1063318854.19907.15.camel@anthem>
References: <oprvcui8zixiz7y9@smtp.vo.lu> <1063318854.19907.15.camel@anthem>
Message-ID: <oprvcwuwc2xiz7y9@smtp.vo.lu>

On 11 Sep 2003 18:20:54 -0400, Barry Warsaw <barry@python.org> wrote:

> modpython 3.0.3 works fine with Python 2.3, but to build it you need to
> hack src/include/mod_python.h.  There's a FAQ entry with the necessary
> patch.
>
> Maybe Grisha should release a 3.0.4 with just this one patch?

I have used the Windows binary version, as I have no C compiler. Releasing 
a binary version for Windows with this one change whould be great.
-PU
From barry at python.org  Thu Sep 11 19:41:19 2003
From: barry at python.org (Barry Warsaw)
Date: Fri Jan  9 22:00:22 2004
Subject: [mod_python] mod_python 3.1
In-Reply-To: <oprvcwuwc2xiz7y9@smtp.vo.lu>
References: <oprvcui8zixiz7y9@smtp.vo.lu> <1063318854.19907.15.camel@anthem>
	 <oprvcwuwc2xiz7y9@smtp.vo.lu>
Message-ID: <1063323679.19907.21.camel@anthem>

On Thu, 2003-09-11 at 18:31, Patrick Useldinger wrote:

> I have used the Windows binary version, as I have no C compiler. Releasing 
> a binary version for Windows with this one change whould be great.

I don't know anything about the Windows version, but AFAIK the only
problem with 3.0.3 and Python 2.3 is the definition of LONG_LONG that
got changed and that should only affect source builds.

-Barry


From grisha at modpython.org  Thu Sep 11 22:54:19 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 22:00:22 2004
Subject: [mod_python] mod_python 3.1
In-Reply-To: <1063318854.19907.15.camel@anthem>
References: <oprvcui8zixiz7y9@smtp.vo.lu> <1063318854.19907.15.camel@anthem>
Message-ID: <20030911224336.A81795@onyx.ispol.com>


On Thu, 11 Sep 2003, Barry Warsaw wrote:

> On Thu, 2003-09-11 at 17:41, Patrick Useldinger wrote:
> > I have read in the mailing list archives that only mod_python 3.1 and
> > higher will work with Python 2.3. Is this still correct? If so, when is
> > version 3.1 sheduled?
>
> modpython 3.0.3 works fine with Python 2.3, but to build it you need to
> hack src/include/mod_python.h.  There's a FAQ entry with the necessary
> patch.
>
> Maybe Grisha should release a 3.0.4 with just this one patch?

I'm not so sure that there aren't other bugs hiding in there.

Originally I wasn't planning on a 3.0.4 because 3.1 is going to be out
some time soon (whatever that means - we don't really have a schedule).
But we'll think about it. :-)

For right now my "official" take is that mod_python 3.0.3 was released
prior to Python 2.3 and so wasn't meant to be used with it.

Grisha
From partha at addlebrain.com  Thu Sep 11 21:11:27 2003
From: partha at addlebrain.com (Partha Aji)
Date: Fri Jan  9 22:00:22 2004
Subject: [mod_python] Can't load mod_python 3.03 in XP
Message-ID: <20030912041127.A4E1F3CEB@sitemail.everyone.net>

Here is  my configuration

Apache HTTP 2.0.47 - g:\apache\Apache2\
OS -> Win XP Home edition

Python Version ->2.3
TCL Version - > 8.4
Mod Python Version -> 3.0.3
Mod python installation file-> mod_python-3.0.3.win32.exe

I added the following line to httpd.conf 
LoadModule python_module modules/mod_python.so

(I have not been able to run the test yet..)

When I start apache I get the following error message
"
Syntax error on line 139 of G:/apache/Apache2/conf/httpd.conf:
Cannot load G:/apache/Apache2/modules/mod_python.so into server: The specified module could not be found.
Note the errors or messages above, and press the <ESC> key to exit.  25...
"

But when I take a peak at G:/apache/Apache2/modules/  directory I see the mod python file right there any ideas? Is mod python expected to run with python 2.3?
Should I compile mod python manually to fix this (I would rather not do so because I wouldn't know how to do it)? 
Any suggestions will be welcome.. Thanks

Partha


From benjamin-hepp at t-online.de  Fri Sep 12 08:28:38 2003
From: benjamin-hepp at t-online.de (Benjamin)
Date: Fri Jan  9 22:00:22 2004
Subject: [mod_python] Can't load mod_python 3.03 in XP
In-Reply-To: <20030912041127.A4E1F3CEB@sitemail.everyone.net>
Message-ID: <000201c378f7$1a0a3e40$0200a8c0@hebben>


> When I start apache I get the following error message
> "
> Syntax error on line 139 of G:/apache/Apache2/conf/httpd.conf:
> Cannot load G:/apache/Apache2/modules/mod_python.so into server:
> The specified module could not be found.
> Note the errors or messages above, and press the <ESC> key to exit.
25...
> "

As said before mod_python must be patched to work with python 2.3.
Or you just use python 2.2.

Benjamin

From andymorritt at rogers.com  Sat Sep 13 11:08:41 2003
From: andymorritt at rogers.com (Andrew)
Date: Fri Jan  9 22:00:22 2004
Subject: [mod_python] Mod Python 3 Error on Adding into Apache.
Message-ID: <3F6332F9.5050107@rogers.com>

I added mod Python into Apache 2 on Win2k with this line:

LoadModule python_module modules/mod_python.so

And when I try to restart the server it displays:

Syntax error on line 973 of D:/Program Files/Apache 
Group/Apache2/conf/httpd.con
f:
Cannot load D:/Program Files/Apache Group/Apache2/modules/mod_python.so 
into ser
ver: The specified module could not be found.

THe Wierd thing is, When I go to D:/Program Files/Apache 
Group/Apache2/modules/ in WIndows Explorer, I SEE the file mod_python.so.

And when I type into the Address bar D:/Program Files/Apache 
Group/Apache2/modules/mod_python.so, The File download comes up.

Also, I have Perl installed with LoadModule perl_module 
modules/mod_perl.so, so LoadMod. Works.

I googled the Archives for this, but could find nothing.

THanks in Advance
Andrew.

From stian at soiland.no  Sun Sep 14 23:56:03 2003
From: stian at soiland.no (Stian =?iso-8859-1?Q?S=F8iland?=)
Date: Fri Jan  9 22:00:22 2004
Subject: [mod_python] 
	Re: Handler publisher with multiple directories on the same tree
In-Reply-To: <3F5C826A.80404@ualg.pt>
References: <01c375fd$51705d80$926a1e6e@wsasd464> <3F5C826A.80404@ualg.pt>
Message-ID: <20030914215603.GD32114@itea.ntnu.no>

On 2003-09-08 15:21:46, Luis Sousa wrote:

> When I'm developing I usually have a common problem that is when I 
> change a class or some file, sometimes the interpreter remains in memory 
> the old version and doesn't load the new one. Is there a way to solve 
> this out ? Normally I use an non elegant way, I restart apache!

We all do the restart dance.. I even set up a port (1337) that restarted
apache on connections to it. 


-- 
Stian S?iland               Work toward win-win situation. Win-lose
Trondheim, Norway           is where you win and the other lose.
http://www.soiland.no/      Lose-lose and lose-win are left as an
                            exercise to the reader.  [Limoncelli/Hogan]

From stian at soiland.no  Sun Sep 14 23:58:27 2003
From: stian at soiland.no (Stian =?iso-8859-1?Q?S=F8iland?=)
Date: Fri Jan  9 22:00:22 2004
Subject: [mod_python] 
	Re: Handler publisher with multiple directories on 	thesame tree
In-Reply-To: <01c3760e$c26c4100$926a1e6e@wsasd464>
References: <01c3760e$c26c4100$926a1e6e@wsasd464>
Message-ID: <20030914215827.GE32114@itea.ntnu.no>

On 2003-09-08 15:40:26, Mike Looijmans wrote:

> My main handler checks if the path_info of the URL is "/request" and if so,
> runs the following (you could use publisher to publish this interface as
> well). All "my" modules are named "ops_" something. You could also use
> the __file__ location as a filter.

I tried that approach, but the problem is that modules must be reloaded
in "correct" order. For instance, a class in module A that subclasses
something from module B, will not work if A is reloaded before B.

(the A-class will be an instance of the OLD b-class)

The only thing that could work is to del the modules from sys.modules.
However, when I tried that, weird errors occured as if half the
mod_python request, sys, site, os etc. were removed.

Clearly some dirty C-pointer hangarounds or something..

-- 
Stian S?iland               Work toward win-win situation. Win-lose
Trondheim, Norway           is where you win and the other lose.
http://www.soiland.no/      Lose-lose and lose-win are left as an
                            exercise to the reader.  [Limoncelli/Hogan]

From grisha at modpython.org  Mon Sep 15 10:32:10 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 22:00:22 2004
Subject: [mod_python] Mod Python 3 Error on Adding into Apache.
In-Reply-To: <3F6332F9.5050107@rogers.com>
References: <3F6332F9.5050107@rogers.com>
Message-ID: <20030915102842.X28769@onyx.ispol.com>


This is typically a mismatch of mod_python.so and the version of Python
you have on your system.  For some reason windows says "module cannot be
found" whereas it really means "i had problems loading it".

The mod_python binary available from Apache sites should be compatible
with Python 2.2.x, but not 2.3.

Grisha

On Sat, 13 Sep 2003, Andrew wrote:

> I added mod Python into Apache 2 on Win2k with this line:
>
> LoadModule python_module modules/mod_python.so
>
> And when I try to restart the server it displays:
>
> Syntax error on line 973 of D:/Program Files/Apache
> Group/Apache2/conf/httpd.con
> f:
> Cannot load D:/Program Files/Apache Group/Apache2/modules/mod_python.so
> into ser
> ver: The specified module could not be found.
>
> THe Wierd thing is, When I go to D:/Program Files/Apache
> Group/Apache2/modules/ in WIndows Explorer, I SEE the file mod_python.so.
>
> And when I type into the Address bar D:/Program Files/Apache
> Group/Apache2/modules/mod_python.so, The File download comes up.
>
> Also, I have Perl installed with LoadModule perl_module
> modules/mod_perl.so, so LoadMod. Works.
>
> I googled the Archives for this, but could find nothing.
>
> THanks in Advance
> Andrew.
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From conrad at hep.caltech.edu  Tue Sep 16 19:31:24 2003
From: conrad at hep.caltech.edu (Conrad Steenberg)
Date: Fri Jan  9 22:00:22 2004
Subject: [mod_python] ANNOUNCE: Mod_python 3.1.0 Alpha
In-Reply-To: <20030910135538.GC3575@legolas.on.net.mk>
References: <20030828210644.C43921@onyx.ispol.com>
	<1062903891.2713.33.camel@Presario>
	<20030907180501.B83449@onyx.ispol.com>
	<20030910135538.GC3575@legolas.on.net.mk>
Message-ID: <1063733483.28941.53.camel@Presario>

Hi

Just to add a data point to the discussion: on redhat-7.3 the server
crashes if it cannot allocate enough semaphores. This is with
apache-2.0.47. And no, I can't change that because I'm not root on the
box :-(

Cheers

Conrad

On Wed, 2003-09-10 at 15:55, Damjan wrote:
> > > This prompts a change in the kernel semaphore settings on older linuxes
> > > (redhat 7.3 specifically).
> > 
> > Well - I think this is really a redhat problem. I believe I even saw
> > something reporting it as a security problem - it is very easy for someone
> > to deprive an rh box of available semaphores. I wonder what the default is
> > on rh 8 and 9 (anyone?).
> 
> Well I have Slackware-9+, and the defaults are not changed from the
> kernel defaults:
>     damjan$ cat /proc/sys/kernel/sem
>     250     32000   32      128
> 
> I'm using 
>     echo "512     32000   32      512" > /proc/sys/kernel/sem
> right now.
-- 
Conrad Steenberg <conrad@hep.caltech.edu>
-- 
Conrad Steenberg <conrad@hep.caltech.edu>
From greenbeard400 at yahoo.com  Wed Sep 17 21:42:47 2003
From: greenbeard400 at yahoo.com (Greenbeard)
Date: Fri Jan  9 22:00:22 2004
Subject: [mod_python] File upload
Message-ID: <20030918044247.89511.qmail@web21304.mail.yahoo.com>

Does anyone have a good file upload example?  

When I try something like: 

def upload(req, file):
    tempFile = file.read()
 
I get: AttributeError: File instance has no attribute
'read'

if I use:

    tempFile = req.form['file'] 
I get the file contents but I don't think this would
work well with large files (or would it?) 

Also, 
 
when I try to get attribues like file.type I get 

AttributeError: File instance has no attribute 'type'.
I do get the file.filename.   

So how can I tell if it should be a binary write etc.?

It looks like the publisher handler (which I am using)
returns a File object but I can not get it to act like
a file/StringIO object nor can I accesss the
attributes that are mentioned in the documentation.   


I am using W2k, Python 2.2  and Mod_py 3.0.3.  

Thanks for the help,

gb400



__________________________________
Do you Yahoo!?
Yahoo! SiteBuilder - Free, easy-to-use web site design software
http://sitebuilder.yahoo.com
From davidf at sjsoft.com  Thu Sep 18 09:47:24 2003
From: davidf at sjsoft.com (David Fraser)
Date: Fri Jan  9 22:00:22 2004
Subject: [mod_python] File upload
In-Reply-To: <20030918044247.89511.qmail@web21304.mail.yahoo.com>
References: <20030918044247.89511.qmail@web21304.mail.yahoo.com>
Message-ID: <3F69630C.2090403@sjsoft.com>

Greenbeard wrote:

>Does anyone have a good file upload example?  
>
>When I try something like: 
>
>def upload(req, file):
>    tempFile = file.read()
> 
>I get: AttributeError: File instance has no attribute
>'read'
>
>if I use:
>
>    tempFile = req.form['file'] 
>I get the file contents but I don't think this would
>work well with large files (or would it?) 
>
>Also, 
> 
>when I try to get attribues like file.type I get 
>
>AttributeError: File instance has no attribute 'type'.
>I do get the file.filename.   
>
>So how can I tell if it should be a binary write etc.?
>
>It looks like the publisher handler (which I am using)
>returns a File object but I can not get it to act like
>a file/StringIO object nor can I accesss the
>attributes that are mentioned in the documentation.   
>
>
>I am using W2k, Python 2.2  and Mod_py 3.0.3.  
>
>Thanks for the help,
>
>gb400
>
>
>
>__________________________________
>Do you Yahoo!?
>Yahoo! SiteBuilder - Free, easy-to-use web site design software
>http://sitebuilder.yahoo.com
>_______________________________________________
>Mod_python mailing list
>Mod_python@modpython.org
>http://mailman.modpython.org/mailman/listinfo/mod_python
>
>  
>
Don't know much about publisher, but a normal mod_python handler should 
be able to do something like this (totally untested code):

def handle(req):
  argdict = util.FieldStorage(req)
  for key in argdict.keys():
    value = argdict[key]
    if type(value) == types.InstanceType:
      if isinstance(value, util.StringField):
        # this is for a normal field...
        pass
      elif isinstance(value, util.Field):
        # this is for an attachment upload...
        filename = field.filename
        content_type = field.type
        # this will work by doing a read...
        contents = field.value
        # or you can do the read yourself:
        field.file.seek(0)
        contents = field.file.read()
        # reset the position so others can read it
        field.file.seek(0)



From mgomez at aditel.org  Thu Sep 18 10:04:57 2003
From: mgomez at aditel.org (Maria Gomez)
Date: Fri Jan  9 22:00:22 2004
Subject: [mod_python] File upload
In-Reply-To: <20030918044247.89511.qmail@web21304.mail.yahoo.com>
References: <20030918044247.89511.qmail@web21304.mail.yahoo.com>
Message-ID: <20030918080457.GA30620@aditel.org>

On Wed, Sep 17, 2003 at 09:42:47PM -0700, Greenbeard wrote:
> Does anyone have a good file upload example?  
> 
> When I try something like: 
> 
> def upload(req, file):
>     tempFile = file.read()
>  

   Hi,

   I use to do it as follows:

def CheckingUploadedFile(incoming):
    if incoming is None:
        return 0     # File is empty
    if type(incoming) is str:
        return 0     # File is a string
    return 1

def PrepareFile(file):
    """
        Copies uploaded file in a local directory (CACHE_DIR) and names
		it with its md5, whish is almost unique
    """
    aux = file.read()
    md5_n = "name_of_file"
    cache_file = "%s%s" % (cache_dir , md5_n)
    cache_fd = open(cache_file,'w')
    cache_fd.write(aux)
    cache_fd.close()
    return 1

def Upload(req,incoming):
    if CheckingUploadedFile(incoming):
        #Save file(incoming.file) in the proper directory
        PrepareFile(incoming.file)
		return 1
	else:
		print "There was an uploading error"


   To know more the updated structure of the file is:
['__del__', '__doc__', '__getattr__', '__init__', '__module__',
'__repr__', 'disposition', 'disposition_options', 'file', 'filename',
'headers', 'name', 'type', 'type_options']


    Cheers,

-- 
   Maria Gomez Marti - [octal]

=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*
   http://www.aditel.org/~mgomez
=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=* Linux, porque yo lo valgo 
From is83070 at cis.nctu.edu.tw  Thu Sep 18 17:21:01 2003
From: is83070 at cis.nctu.edu.tw (camge)
Date: Fri Jan  9 22:00:22 2004
Subject: [mod_python] [help]please give an input filter example ?
Message-ID: <007c01c37dc6$32d21050$db64a8c0@camgelo>

Hi ,

    I have written an output filter, and it works fine.
But I dont know how to write an input filter, there are not any examples.
I have tried to write an simple input filter according to an output filter.
But it always makes IE hang there.
If any one can give me an example about input filter?
Thanks a lot!

My environment:
  Apache/2.0.44 (Win32) 
  mod_ssl/2.0.44  
  OpenSSL/0.9.7 
  mod_python/3.0.3 
  Python/2.2.2 

Best regards,
camge
From is83070 at cis.nctu.edu.tw  Thu Sep 18 18:36:25 2003
From: is83070 at cis.nctu.edu.tw (camge)
Date: Fri Jan  9 22:00:22 2004
Subject: [mod_python] [help]please give an input filter example ?
References: <007c01c37dc6$32d21050$db64a8c0@camgelo>
	<3F69851B.3080703@sjsoft.com>
Message-ID: <009d01c37dd0$bc2c5f40$db64a8c0@camgelo>

Below is my simple input filter inputFilter.py:
-------------------------------------------------------------
def inputfilter(filter):
    f=open('filter.log','ab')#for debug
    data='start'
    while data!=None:
        try:
            data = filter.read()
            if data:
                filter.write(data)
                f.write(str(data))
        except Exception,e:
                f.write(str(e))
                data=None
     if data==None:
        filter.close()
     f.close()
----------------------------------------
httpd.conf:
----------------------------------------
<Location /test/>
     PythonInputFilter inputFilter MyInputFilter
     SetInputFilter MyInputFilter
</Location>


----- Original Message ----- 
From: "David Fraser" <davidf@sjsoft.com>
To: "camge" <is83070@cis.nctu.edu.tw>
Sent: Thursday, September 18, 2003 6:12 PM
Subject: Re: [mod_python] [help]please give an input filter example ?


> >camge wrote:
> >
> >Hi ,
> >
> >    I have written an output filter, and it works fine.
> >But I dont know how to write an input filter, there are not any examples.
> >I have tried to write an simple input filter according to an output
filter.
> >But it always makes IE hang there.
> >If any one can give me an example about input filter?
> >Thanks a lot!
> >
> >My environment:
> >  Apache/2.0.44 (Win32)
> >  mod_ssl/2.0.44
> >  OpenSSL/0.9.7
> >  mod_python/3.0.3
> >  Python/2.2.2
> >
> >Best regards,
> >camge
> >
> Why don't you send your example input filter that makes IE hang?
>
> Thanks
> David
>
>

From davidf at sjsoft.com  Thu Sep 18 13:05:19 2003
From: davidf at sjsoft.com (David Fraser)
Date: Fri Jan  9 22:00:22 2004
Subject: [mod_python] [help]please give an input filter example ?
In-Reply-To: <009d01c37dd0$bc2c5f40$db64a8c0@camgelo>
References: <007c01c37dc6$32d21050$db64a8c0@camgelo>
	<3F69851B.3080703@sjsoft.com> <009d01c37dd0$bc2c5f40$db64a8c0@camgelo>
Message-ID: <3F69916F.10406@sjsoft.com>

camge wrote:

>----- Original Message ----- 
>From: "David Fraser" <davidf@sjsoft.com>
>To: "camge" <is83070@cis.nctu.edu.tw>
>Sent: Thursday, September 18, 2003 6:12 PM
>Subject: Re: [mod_python] [help]please give an input filter example ?
>
>
>  
>
>>>camge wrote:
>>>
>>>Hi ,
>>>
>>>   I have written an output filter, and it works fine.
>>>But I dont know how to write an input filter, there are not any examples.
>>>I have tried to write an simple input filter according to an output
>>>      
>>>
>filter.
>  
>
>>>But it always makes IE hang there.
>>>If any one can give me an example about input filter?
>>>Thanks a lot!
>>>
>>>My environment:
>>> Apache/2.0.44 (Win32)
>>> mod_ssl/2.0.44
>>> OpenSSL/0.9.7
>>> mod_python/3.0.3
>>> Python/2.2.2
>>>
>>>Best regards,
>>>camge
>>>
>>>      
>>>
>>Why don't you send your example input filter that makes IE hang?
>>
>>Thanks
>>David
>>
>>
>>    
>>
>
>Below is my simple input filter inputFilter.py:
>-------------------------------------------------------------
>def inputfilter(filter):
>    f=open('filter.log','ab')#for debug
>    data='start'
>    while data!=None:
>        try:
>            data = filter.read()
>            if data:
>                filter.write(data)
>                f.write(str(data))
>        except Exception,e:
>                f.write(str(e))
>                data=None
>     if data==None:
>        filter.close()
>     f.close()
>----------------------------------------
>httpd.conf:
>----------------------------------------
><Location /test/>
>     PythonInputFilter inputFilter MyInputFilter
>     SetInputFilter MyInputFilter
></Location>
>
>
>  
>
Excuse me rearranging your post, bottom posting makes discussion easier...

I think the problem here is that you're doing filter.read() which will 
read until an end of file, which will never happen on an input filter.
You probably need a more intelligent way of working out when to stop 
reading, e.g. for HTTP, you could read a line at a time.
What are you wanting to use the input filter for?

David


From is83070 at cis.nctu.edu.tw  Thu Sep 18 21:32:47 2003
From: is83070 at cis.nctu.edu.tw (camge)
Date: Fri Jan  9 22:00:22 2004
Subject: [mod_python] [help]please give an input filter example ?
References: <007c01c37dc6$32d21050$db64a8c0@camgelo>
	<3F69851B.3080703@sjsoft.com> <009d01c37dd0$bc2c5f40$db64a8c0@camgelo>
	<3F69916F.10406@sjsoft.com>
Message-ID: <000e01c37de9$60cfd0f0$db64a8c0@camgelo>


----- Original Message ----- 
From: "David Fraser" <davidf@sjsoft.com>
To: "camge" <is83070@cis.nctu.edu.tw>
Cc: <mod_python@modpython.org>
Sent: Thursday, September 18, 2003 7:05 PM
Subject: Re: [mod_python] [help]please give an input filter example ?


> camge wrote:
>
> >----- Original Message ----- 
> >From: "David Fraser" <davidf@sjsoft.com>
> >To: "camge" <is83070@cis.nctu.edu.tw>
> >Sent: Thursday, September 18, 2003 6:12 PM
> >Subject: Re: [mod_python] [help]please give an input filter example ?
> >
> >
> >
> >
> >>>camge wrote:
> >>>
> >>>Hi ,
> >>>
> >>>   I have written an output filter, and it works fine.
> >>>But I dont know how to write an input filter, there are not any
examples.
> >>>I have tried to write an simple input filter according to an output
> >>>
> >>>
> >filter.
> >
> >
> >>>But it always makes IE hang there.
> >>>If any one can give me an example about input filter?
> >>>Thanks a lot!
> >>>
> >>>My environment:
> >>> Apache/2.0.44 (Win32)
> >>> mod_ssl/2.0.44
> >>> OpenSSL/0.9.7
> >>> mod_python/3.0.3
> >>> Python/2.2.2
> >>>
> >>>Best regards,
> >>>camge
> >>>
> >>>
> >>>
> >>Why don't you send your example input filter that makes IE hang?
> >>
> >>Thanks
> >>David
> >>
> >>
> >>
> >>
> >
> >Below is my simple input filter inputFilter.py:
> >-------------------------------------------------------------
> >def inputfilter(filter):
> >    f=open('filter.log','ab')#for debug
> >    data='start'
> >    while data!=None:
> >        try:
> >            data = filter.read()
> >            if data:
> >                filter.write(data)
> >                f.write(str(data))
> >        except Exception,e:
> >                f.write(str(e))
> >                data=None
> >     if data==None:
> >        filter.close()
> >     f.close()
> >----------------------------------------
> >httpd.conf:
> >----------------------------------------
> ><Location /test/>
> >     PythonInputFilter inputFilter MyInputFilter
> >     SetInputFilter MyInputFilter
> ></Location>
> >
> >
> >
> >
> Excuse me rearranging your post, bottom posting makes discussion easier...
>
> I think the problem here is that you're doing filter.read() which will
> read until an end of file, which will never happen on an input filter.
> You probably need a more intelligent way of working out when to stop
> reading, e.g. for HTTP, you could read a line at a time.
> What are you wanting to use the input filter for?
>
> David
>
>
>
Thanks for your fast response!
I have tried filter.readline(), but it still reads nothing.
I need input filter to convert character set of form data submitted by cell
phone browser.
For example, convert utf-8 to big5 or gb.
If I can do it in input filter, then I dont need to modify all of my pages.





From alentzos at cosmote.gr  Thu Sep 18 16:45:10 2003
From: alentzos at cosmote.gr (Lentzos Athanassios)
Date: Fri Jan  9 22:00:22 2004
Subject: [mod_python] Load python module problem
Message-ID: <4AEFA010DC6711478C8DA31039641A990142F7B9@AHRMAIL.cosmote.gr>



Hi

I have problem to load the mod_python( ver 3.0.3)  to apache (ver 2.0.47) I have done the configuration according to the instructions but i still
get the following error when i try to start apache server  < " Cannot load c:/program files/apache/apache2/modules/mod_python.so into server:The specified
module could not be found." > ,of course the file is there. /* I have installed Python 2.3  on my PC which runs NT os */  ....Please help!!


Lentzos  .P Athanassios (Greece, Athens)
E-mail	:   alentzos@cosmote.gr


-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mailman.modpython.org/pipermail/mod_python/attachments/20030918/007ef00b/attachment-0002.htm
From idiot1 at netzero.net  Thu Sep 18 12:11:42 2003
From: idiot1 at netzero.net (Kirk Bailey)
Date: Fri Jan  9 22:00:22 2004
Subject: [mod_python] File upload
In-Reply-To: <3F69630C.2090403@sjsoft.com>
References: <20030918044247.89511.qmail@web21304.mail.yahoo.com>
	<3F69630C.2090403@sjsoft.com>
Message-ID: <3F69D93E.8060100@netzero.net>

My wiki, wikinehesa, has a upload in it. Try downloading it, and read the form 
in the footer of the page generated by wikinehesaed1.py, and read the script 
wikinehesaed2.py to see how the thing handles doing an upload.

http://www.tinylist.org/

scan down to the OTHER STUFF section and there is the download for wikinehesa. 
To play with it, up by the top near the hit counter is a link to a working 
install of the wiki.

David Fraser wrote:

> Greenbeard wrote:
> 
>> Does anyone have a good file upload example? 
>> When I try something like:
>> def upload(req, file):
>>    tempFile = file.read()
>>
>> I get: AttributeError: File instance has no attribute
>> 'read'
>>
>> if I use:
>>
>>    tempFile = req.form['file'] I get the file contents but I don't 
>> think this would
>> work well with large files (or would it?)
>> Also,
>> when I try to get attribues like file.type I get
>> AttributeError: File instance has no attribute 'type'.
>> I do get the file.filename.  
>> So how can I tell if it should be a binary write etc.?
>>
>> It looks like the publisher handler (which I am using)
>> returns a File object but I can not get it to act like
>> a file/StringIO object nor can I accesss the
>> attributes that are mentioned in the documentation.  
>>
>> I am using W2k, Python 2.2  and Mod_py 3.0.3. 
>> Thanks for the help,
>>
>> gb400
>>
>>
>>
>> __________________________________
>> Do you Yahoo!?
>> Yahoo! SiteBuilder - Free, easy-to-use web site design software
>> http://sitebuilder.yahoo.com
>> _______________________________________________
>> Mod_python mailing list
>> Mod_python@modpython.org
>> http://mailman.modpython.org/mailman/listinfo/mod_python
>>
>>  
>>
> Don't know much about publisher, but a normal mod_python handler should 
> be able to do something like this (totally untested code):
> 
> def handle(req):
>  argdict = util.FieldStorage(req)
>  for key in argdict.keys():
>    value = argdict[key]
>    if type(value) == types.InstanceType:
>      if isinstance(value, util.StringField):
>        # this is for a normal field...
>        pass
>      elif isinstance(value, util.Field):
>        # this is for an attachment upload...
>        filename = field.filename
>        content_type = field.type
>        # this will work by doing a read...
>        contents = field.value
>        # or you can do the read yourself:
>        field.file.seek(0)
>        contents = field.file.read()
>        # reset the position so others can read it
>        field.file.seek(0)
> 
> 
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
> 
> 

-- 

-- 

end

Cheers!
         Kirk D Bailey

  +                              think                                +
   http://www.howlermonkey.net  +-----+        http://www.tinylist.org
   http://www.listville.net     | BOX |  http://www.sacredelectron.org
   Thou art free"-ERIS          +-----+     'Got a light?'-Prometheus
  +                              kniht                                +

Fnord.

From grisha at modpython.org  Thu Sep 18 11:09:25 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 22:00:22 2004
Subject: [mod_python] File upload
In-Reply-To: <20030918044247.89511.qmail@web21304.mail.yahoo.com>
References: <20030918044247.89511.qmail@web21304.mail.yahoo.com>
Message-ID: <20030918110558.I77494@onyx.ispol.com>


On Wed, 17 Sep 2003, Greenbeard wrote:

> Does anyone have a good file upload example?
>
> When I try something like:
>
> def upload(req, file):
>     tempFile = file.read()

I think it should be file.file.read(). You also may want to make sure that
it's a file upload first - you can do this by testing for existance of a
filename attribute, e.g. hasattr(file, "filename), or, more accurately,
you can make sure it's an instance of util.Field:

	if isinstance(file, util.Field):
		data = file.file.read()
	else:
		return "This is not a file"

Grisha
From davidf at sjsoft.com  Thu Sep 18 18:02:34 2003
From: davidf at sjsoft.com (David Fraser)
Date: Fri Jan  9 22:00:22 2004
Subject: [mod_python] [help]please give an input filter example ?
In-Reply-To: <000e01c37de9$60cfd0f0$db64a8c0@camgelo>
References: <007c01c37dc6$32d21050$db64a8c0@camgelo>
	<3F69851B.3080703@sjsoft.com> <009d01c37dd0$bc2c5f40$db64a8c0@camgelo>
	<3F69916F.10406@sjsoft.com> <000e01c37de9$60cfd0f0$db64a8c0@camgelo>
Message-ID: <3F69D71A.8080005@sjsoft.com>

camge wrote:

>----- Original Message ----- 
>From: "David Fraser" <davidf@sjsoft.com>
>To: "camge" <is83070@cis.nctu.edu.tw>
>Cc: <mod_python@modpython.org>
>Sent: Thursday, September 18, 2003 7:05 PM
>Subject: Re: [mod_python] [help]please give an input filter example ?
>
>
>  
>
>>camge wrote:
>>
>>    
>>
>>>----- Original Message ----- 
>>>From: "David Fraser" <davidf@sjsoft.com>
>>>To: "camge" <is83070@cis.nctu.edu.tw>
>>>Sent: Thursday, September 18, 2003 6:12 PM
>>>Subject: Re: [mod_python] [help]please give an input filter example ?
>>>
>>>
>>>
>>>
>>>      
>>>
>>>>>camge wrote:
>>>>>
>>>>>Hi ,
>>>>>
>>>>>  I have written an output filter, and it works fine.
>>>>>But I dont know how to write an input filter, there are not any
>>>>>          
>>>>>
>examples.
>  
>
>>>>>I have tried to write an simple input filter according to an output
>>>>>
>>>>>
>>>>>          
>>>>>
>>>filter.
>>>
>>>
>>>      
>>>
>>>>>But it always makes IE hang there.
>>>>>If any one can give me an example about input filter?
>>>>>Thanks a lot!
>>>>>
>>>>>My environment:
>>>>>Apache/2.0.44 (Win32)
>>>>>mod_ssl/2.0.44
>>>>>OpenSSL/0.9.7
>>>>>mod_python/3.0.3
>>>>>Python/2.2.2
>>>>>
>>>>>Best regards,
>>>>>camge
>>>>>
>>>>>
>>>>>
>>>>>          
>>>>>
>>>>Why don't you send your example input filter that makes IE hang?
>>>>
>>>>Thanks
>>>>David
>>>>
>>>>
>>>>
>>>>
>>>>        
>>>>
>>>Below is my simple input filter inputFilter.py:
>>>-------------------------------------------------------------
>>>def inputfilter(filter):
>>>   f=open('filter.log','ab')#for debug
>>>   data='start'
>>>   while data!=None:
>>>       try:
>>>           data = filter.read()
>>>           if data:
>>>               filter.write(data)
>>>               f.write(str(data))
>>>       except Exception,e:
>>>               f.write(str(e))
>>>               data=None
>>>    if data==None:
>>>       filter.close()
>>>    f.close()
>>>----------------------------------------
>>>httpd.conf:
>>>----------------------------------------
>>><Location /test/>
>>>    PythonInputFilter inputFilter MyInputFilter
>>>    SetInputFilter MyInputFilter
>>></Location>
>>>
>>>
>>>
>>>
>>>      
>>>
>>Excuse me rearranging your post, bottom posting makes discussion easier...
>>
>>I think the problem here is that you're doing filter.read() which will
>>read until an end of file, which will never happen on an input filter.
>>You probably need a more intelligent way of working out when to stop
>>reading, e.g. for HTTP, you could read a line at a time.
>>What are you wanting to use the input filter for?
>>
>>David
>>
>>
>>
>>    
>>
>Thanks for your fast response!
>I have tried filter.readline(), but it still reads nothing.
>  
>
That's a pleasure. OK, I don't really know anything about input filters, 
I was just pretending... maybe some else can help

>I need input filter to convert character set of form data submitted by cell
>phone browser.
>For example, convert utf-8 to big5 or gb.
>If I can do it in input filter, then I dont need to modify all of my pages.
>  
>
Aha. What I would do is just put a function in a module that changes the 
encoding.
Get the arguments like you normally would, then just do a decode/encode.
Since that module can be accessed from anywhere, it will work just as well.
Also, it's less likely to cause bugs, and will probably be faster 
(you'll only making one jump into the Python interpreter and back)

Cheers
David


From sgillies at frii.com  Thu Sep 18 12:10:07 2003
From: sgillies at frii.com (Sean Gillies)
Date: Fri Jan  9 22:00:22 2004
Subject: [mod_python] 
	UnicodeEncodeError using mod_python-3.0.3 with Python 2.3
Message-ID: <55E7BB6E-EA03-11D7-9809-000393B98B56@frii.com>

Hi,

I'm running into problems with UnicodeEncodeErrors using  
mod_python-3.0.3 with
Python 2.3 on OS X.  Yes, I know I'm asking for trouble with this  
combination,
but I'm leery of replacing Apple's Python 2.2 (which doesn't work with  
mod_python).
All in all, my application is working, but will eventually (and  
unpredictably)
stop and raise this error:

Mod_python error: "PythonHandler mod_python.publisher"

Traceback (most recent call last):

   File  
"/Library/Frameworks/Python.framework/Versions/2.3/lib/python2.3/site- 
packages/mod_python/apache.py", line 332, in HandlerDispatch
     result = object(req)

   File  
"/Library/Frameworks/Python.framework/Versions/2.3/lib/python2.3/site- 
packages/mod_python/publisher.py", line 201, in handler
     result = str(result)

UnicodeEncodeError: 'ascii' codec can't encode character '\u3137' in  
position 412: ordinal not in range(128)

Anybody else using Python 2.3 who has seen this?  I really don't  
understand the error,
it's always '\u3137', and I'm _not_ (to my knowledge) using any unicode  
strings.  I am
using Zope's Page Templates, but I don't see where the page templates  
would be introducing
'\u3137' (the hangul letter tikeut?!).

My module is published with no problems on Linux (KRUD) with  
mod_python-3.0.1 and
Python 2.2.3, so I'm presently living with this problem on my notebook  
and counting
on its absence on the server.

Sean

--
Sean Gillies
sgillies at frii dot com
http://www.frii.com/~sgillies

From perry.tew at cibavision.novartis.com  Thu Sep 18 15:50:04 2003
From: perry.tew at cibavision.novartis.com (perry.tew@cibavision.novartis.com)
Date: Fri Jan  9 22:00:23 2004
Subject: [mod_python] 
	does a mod_python handler exist to generate charts/graphs? (png
	images)
Message-ID: <OF62DF2337.F24A4A42-ON85256DA5.006CA077-85256DA5.006CF44A@EU.novartis.net>

Hello everyone,
   I was about the go down the road of developing a handler to generate 
charts,
similar to the mod_perl Apache::GD::Graph.  I wanted to make sure 
something doesn't exist
before I reinvent the wheel.  Does anyone know of such a thing yet?  If 
so, would you please
provide a url?

Thanks,
Perry Tew
From davidf at sjsoft.com  Thu Sep 18 22:25:46 2003
From: davidf at sjsoft.com (David Fraser)
Date: Fri Jan  9 22:00:23 2004
Subject: [mod_python] 	UnicodeEncodeError using mod_python-3.0.3 with
	Python 2.3
In-Reply-To: <55E7BB6E-EA03-11D7-9809-000393B98B56@frii.com>
References: <55E7BB6E-EA03-11D7-9809-000393B98B56@frii.com>
Message-ID: <3F6A14CA.9030008@sjsoft.com>

Sean Gillies wrote:

> Hi,
>
> I'm running into problems with UnicodeEncodeErrors using  
> mod_python-3.0.3 with
> Python 2.3 on OS X.  Yes, I know I'm asking for trouble with this  
> combination,
> but I'm leery of replacing Apple's Python 2.2 (which doesn't work 
> with  mod_python).
> All in all, my application is working, but will eventually (and  
> unpredictably)
> stop and raise this error:
>
> Mod_python error: "PythonHandler mod_python.publisher"
>
> Traceback (most recent call last):
>
>   File  
> "/Library/Frameworks/Python.framework/Versions/2.3/lib/python2.3/site- 
> packages/mod_python/apache.py", line 332, in HandlerDispatch
>     result = object(req)
>
>   File  
> "/Library/Frameworks/Python.framework/Versions/2.3/lib/python2.3/site- 
> packages/mod_python/publisher.py", line 201, in handler
>     result = str(result)
>
> UnicodeEncodeError: 'ascii' codec can't encode character '\u3137' in  
> position 412: ordinal not in range(128)
>
> Anybody else using Python 2.3 who has seen this?  I really don't  
> understand the error,
> it's always '\u3137', and I'm _not_ (to my knowledge) using any 
> unicode  strings.  I am
> using Zope's Page Templates, but I don't see where the page templates  
> would be introducing
> '\u3137' (the hangul letter tikeut?!).
>
> My module is published with no problems on Linux (KRUD) with  
> mod_python-3.0.1 and
> Python 2.2.3, so I'm presently living with this problem on my 
> notebook  and counting
> on its absence on the server.
>
> Sean
>
> -- 

Try doing things like:
  if type(result) == unicode:
    result = result.encode('iso8859')
You can look up different encodings in the encodings module. The above 
works well for me...
I think you should be able to get the browser's desired encodings from 
the headers sent to the request.

Hope that helps
David


From davidf at sjsoft.com  Thu Sep 18 22:27:29 2003
From: davidf at sjsoft.com (David Fraser)
Date: Fri Jan  9 22:00:23 2004
Subject: [mod_python] 	does a mod_python handler exist to generate
	charts/graphs? (png	images)
In-Reply-To: <OF62DF2337.F24A4A42-ON85256DA5.006CA077-85256DA5.006CF44A@EU.novartis.net>
References: <OF62DF2337.F24A4A42-ON85256DA5.006CA077-85256DA5.006CF44A@EU.novartis.net>
Message-ID: <3F6A1531.5050609@sjsoft.com>

perry.tew@cibavision.novartis.com wrote:

>Hello everyone,
>   I was about the go down the road of developing a handler to generate 
>charts,
>similar to the mod_perl Apache::GD::Graph.  I wanted to make sure 
>something doesn't exist
>before I reinvent the wheel.  Does anyone know of such a thing yet?  If 
>so, would you please
>provide a url?
>
>Thanks,
>Perry Tew
>
There are several Python graphing packages which you could use towards 
this end, the question is how nicely will they plug into a web environment.
I am not aware of any that are set up to do this using mod_python.
I'm also busy looking at the problem, for an application we are 
currently converting to be web based, so discuss plans / things you find 
here and I will to and hopefully we can come up with a nice solution...

Thanks,
David


From perry.tew at cibavision.novartis.com  Thu Sep 18 16:38:09 2003
From: perry.tew at cibavision.novartis.com (perry.tew@cibavision.novartis.com)
Date: Fri Jan  9 22:00:23 2004
Subject: [mod_python] 	does a mod_python handler exist to generate
	charts/graphs? (png	images)
Message-ID: <OF3D2E11CE.51A41DD0-ON85256DA5.0070BC96-85256DA5.00715B65@EU.novartis.net>

David,
  Thanks for the information.  I was looking at using pygdchart2 from 
nullcube.  I was pleased with the interface they've written.  Have you any 
experience with them?  I figured it shouldn't be technically difficult to 
create an interface of parameters that mapped to chart settings.

The only concern I have so far is the method of outputting the chart once 
rendered.  The examples use the draw method:
"""
 chart.draw(filespec)
Draw the graph to the specified file. If the filespec argument is a 
string, it will be treated as the path to a file. Otherwise, filespec is 
assumed to be a Python file object.
"""

I'm new to mod_python, so I'm not sure how to pass the output stream of 
the request object to the draw() method.  If you know, I'm be grateful. If 
not, I'll work at it.  I haven't really dug yet.

btw,   I saw your post earlier about your wiki.  While cruising your site 
I found a MLM I was in need for.  Thanks!

Perry Tew



perry.tew@cibavision.novartis.com wrote:

>Hello everyone,
>   I was about the go down the road of developing a handler to generate 
>charts,
>similar to the mod_perl Apache::GD::Graph.  I wanted to make sure 
>something doesn't exist
>before I reinvent the wheel.  Does anyone know of such a thing yet?  If 
>so, would you please
>provide a url?
>
>Thanks,
>Perry Tew
>
There are several Python graphing packages which you could use towards 
this end, the question is how nicely will they plug into a web 
environment.
I am not aware of any that are set up to do this using mod_python.
I'm also busy looking at the problem, for an application we are 
currently converting to be web based, so discuss plans / things you find 
here and I will to and hopefully we can come up with a nice solution...

Thanks,
David





From davidf at sjsoft.com  Thu Sep 18 22:45:25 2003
From: davidf at sjsoft.com (David Fraser)
Date: Fri Jan  9 22:00:23 2004
Subject: [mod_python] 	does a mod_python handler exist to generate
	charts/graphs? (png	images)
In-Reply-To: <OF3D2E11CE.51A41DD0-ON85256DA5.0070BC96-85256DA5.00715B65@EU.novartis.net>
References: <OF3D2E11CE.51A41DD0-ON85256DA5.0070BC96-85256DA5.00715B65@EU.novartis.net>
Message-ID: <3F6A1965.2040506@sjsoft.com>

perry.tew@cibavision.novartis.com wrote:

>>perry.tew@cibavision.novartis.com wrote:
>>
>>>Hello everyone,
>>>  I was about the go down the road of developing a handler to generate 
>>>charts,
>>>similar to the mod_perl Apache::GD::Graph.  I wanted to make sure 
>>>something doesn't exist
>>>before I reinvent the wheel.  Does anyone know of such a thing yet?  If 
>>>so, would you please
>>>provide a url?
>>>
>>>Thanks,
>>>Perry Tew
>>
>> There are several Python graphing packages which you could use towards
>>
>>this end, the question is how nicely will they plug into a web 
>>environment.
>>I am not aware of any that are set up to do this using mod_python.
>>I'm also busy looking at the problem, for an application we are 
>>currently converting to be web based, so discuss plans / things you find 
>>here and I will to and hopefully we can come up with a nice solution...
>>
>>Thanks,
>>David
>>
>
>David,
>  Thanks for the information.  I was looking at using pygdchart2 from 
>nullcube.  I was pleased with the interface they've written.  Have you any 
>experience with them?  I figured it shouldn't be technically difficult to 
>create an interface of parameters that mapped to chart settings.
>  
>
I haven't had, but will look at it, do you have a URL?

>The only concern I have so far is the method of outputting the chart once 
>rendered.  The examples use the draw method:
>"""
> chart.draw(filespec)
>Draw the graph to the specified file. If the filespec argument is a 
>string, it will be treated as the path to a file. Otherwise, filespec is 
>assumed to be a Python file object.
>"""
>
>I'm new to mod_python, so I'm not sure how to pass the output stream of 
>the request object to the draw() method.  If you know, I'm be grateful. If 
>not, I'll work at it.  I haven't really dug yet.
>  
>
This kind of thing is pretty simple, you can either create a 
StringIO.StringIO object (standard Python) which is a pseudo-file that 
you can get the contents out of using a string, or you could try passing 
the request object (at the appropriate time) and see if it will work 
writing to that.
Another option (assuming the project is open source) is to alter the 
program to support returning the data in a string.
I got the reportlab guys to do this - their project is mainly focussed 
on Reports and PDF, but it also has charting capabilities I haven't 
investigated.
The other charting toolkit I am aware of is Chaco.

I think it would be good to investigate all of them and at least draw up 
a list of their strengths/weaknesses for use in a web server context, 
that might be helpful to other users. Would be good to have a list of 
requirements to evaluate these packages by e.g. how big the package is, 
able to produce different image formats, etc.

>btw,   I saw your post earlier about your wiki.  While cruising your site 
>I found a MLM I was in need for.  Thanks!
>  
>
Sure, but I think it was somebody else replying to my message, I don't 
have a wiki...

>Perry Tew
>  
>
David

PS hope you don't mind me rearranging your post, bottom-posting makes 
the flow easier to see.

From davidf at sjsoft.com  Thu Sep 18 22:49:35 2003
From: davidf at sjsoft.com (David Fraser)
Date: Fri Jan  9 22:00:23 2004
Subject: [mod_python]  does a mod_python handler exist to generate
	charts/graphs? (png images)
In-Reply-To: <Pine.LNX.4.44.0309181636440.1176-100000@q.cis.uoguelph.ca>
References: <Pine.LNX.4.44.0309181636440.1176-100000@q.cis.uoguelph.ca>
Message-ID: <3F6A1A5F.9000703@sjsoft.com>

Stefan C. Kremer wrote:

>You might want to check out:
>
>http://gnuplot-py.sourceforge.net/
>
>and consider interfacing it with mod_python.  I've used it with python and 
>been very happy (though I really like gnuplot to start with, so I'm 
>biased), but have not used it with mod_python.
>
>	Stefan
>  
>
Thanks Stefan, we'll add it to the list...
David

>On Thu, 18 Sep 2003, David Fraser wrote:
>
>  
>
>>perry.tew@cibavision.novartis.com wrote:
>>
>>    
>>
>>>Hello everyone,
>>>  I was about the go down the road of developing a handler to generate 
>>>charts,
>>>similar to the mod_perl Apache::GD::Graph.  I wanted to make sure 
>>>something doesn't exist
>>>before I reinvent the wheel.  Does anyone know of such a thing yet?  If 
>>>so, would you please
>>>provide a url?
>>>
>>>Thanks,
>>>Perry Tew
>>>
>>>      
>>>
>>There are several Python graphing packages which you could use towards 
>>this end, the question is how nicely will they plug into a web environment.
>>I am not aware of any that are set up to do this using mod_python.
>>I'm also busy looking at the problem, for an application we are 
>>currently converting to be web based, so discuss plans / things you find 
>>here and I will to and hopefully we can come up with a nice solution...
>>
>>Thanks,
>>David
>>
>>
>>_______________________________________________
>>Mod_python mailing list
>>Mod_python@modpython.org
>>http://mailman.modpython.org/mailman/listinfo/mod_python
>>
>>    
>>
>
>  
>


From sgillies at frii.com  Thu Sep 18 15:45:32 2003
From: sgillies at frii.com (Sean Gillies)
Date: Fri Jan  9 22:00:23 2004
Subject: [mod_python] 	UnicodeEncodeError using mod_python-3.0.3 with
	Python 2.3
In-Reply-To: <3F6A14CA.9030008@sjsoft.com>
Message-ID: <6D706C13-EA21-11D7-874F-000393B98B56@frii.com>

On Thursday, September 18, 2003, at 02:25  PM, David Fraser wrote:

> Sean Gillies wrote:
>
>> Hi,
>>
>> I'm running into problems with UnicodeEncodeErrors using   
>> mod_python-3.0.3 with
>> Python 2.3 on OS X.  Yes, I know I'm asking for trouble with this   
>> combination,
>> but I'm leery of replacing Apple's Python 2.2 (which doesn't work  
>> with  mod_python).
>> All in all, my application is working, but will eventually (and   
>> unpredictably)
>> stop and raise this error:
>>
>> Mod_python error: "PythonHandler mod_python.publisher"
>>
>> Traceback (most recent call last):
>>
>>   File   
>> "/Library/Frameworks/Python.framework/Versions/2.3/lib/python2.3/ 
>> site- packages/mod_python/apache.py", line 332, in HandlerDispatch
>>     result = object(req)
>>
>>   File   
>> "/Library/Frameworks/Python.framework/Versions/2.3/lib/python2.3/ 
>> site- packages/mod_python/publisher.py", line 201, in handler
>>     result = str(result)
>>
>> UnicodeEncodeError: 'ascii' codec can't encode character '\u3137' in   
>> position 412: ordinal not in range(128)
>>
>> Anybody else using Python 2.3 who has seen this?  I really don't   
>> understand the error,
>> it's always '\u3137', and I'm _not_ (to my knowledge) using any  
>> unicode  strings.  I am
>> using Zope's Page Templates, but I don't see where the page templates  
>>  would be introducing
>> '\u3137' (the hangul letter tikeut?!).
>>
>> My module is published with no problems on Linux (KRUD) with   
>> mod_python-3.0.1 and
>> Python 2.2.3, so I'm presently living with this problem on my  
>> notebook  and counting
>> on its absence on the server.
>>
>> Sean
>>
>> -- 
>
> Try doing things like:
>  if type(result) == unicode:
>    result = result.encode('iso8859')
> You can look up different encodings in the encodings module. The above  
> works well for me...
> I think you should be able to get the browser's desired encodings from  
> the headers sent to the request.
>
> Hope that helps
> David
>

David,

Thanks for the suggestion.  The Zope page template's __call__ method
does indeed return unicode and I've made your change to publisher.py.
Working good.  I also thought about catching the UnicodeEncodeError
like

     if result:
         try:
             result = str(result)
         except UnicodeEncodeError:
             result = str(result.encode('iso8859'))

since str(result) wasn't raising an error every time.

cheers,
Sean

--
Sean Gillies
sgillies at frii dot com
http://www.frii.com/~sgillies

From is83070 at cis.nctu.edu.tw  Fri Sep 19 11:09:14 2003
From: is83070 at cis.nctu.edu.tw (camge)
Date: Fri Jan  9 22:00:23 2004
Subject: [mod_python] [help]please give an input filter example ?
References: <007c01c37dc6$32d21050$db64a8c0@camgelo>
	<3F69851B.3080703@sjsoft.com> <009d01c37dd0$bc2c5f40$db64a8c0@camgelo>
	<3F69916F.10406@sjsoft.com> <000e01c37de9$60cfd0f0$db64a8c0@camgelo>
	<3F69D71A.8080005@sjsoft.com>
Message-ID: <002c01c37e5b$71210920$db64a8c0@camgelo>

> >I need input filter to convert character set of form data submitted by
cell
> >phone browser.
> >For example, convert utf-8 to big5 or gb.
> >If I can do it in input filter, then I dont need to modify all of my
pages.
> >
> >
> Aha. What I would do is just put a function in a module that changes the
> encoding.
> Get the arguments like you normally would, then just do a decode/encode.
> Since that module can be accessed from anywhere, it will work just as
well.
> Also, it's less likely to cause bugs, and will probably be faster
> (you'll only making one jump into the Python interpreter and back)
>
> Cheers
> David
>
Thanks for your suggestion!
But my web server serve not only wap browser but also Pocket IE and IE,
and they all use same module(for easy maintenance).
Adding this function in these modules will be a terrible thing,
because I dont need to convert character encoding for Pocket IE and IE.

If I can do it in input filter, I don't need to modify any things in
original module.

regards,
camge


From alentzos at cosmote.gr  Fri Sep 19 13:44:32 2003
From: alentzos at cosmote.gr (Lentzos Athanassios)
Date: Fri Jan  9 22:00:23 2004
Subject: =?iso-8859-7?Q?=D0=D1=3A_=5Bmod=5Fpython=5D_Load_python_module_problem?=
Message-ID: <4AEFA010DC6711478C8DA31039641A990149D2BD@AHRMAIL.cosmote.gr>

Skipped content of type multipart/alternative-------------- next part --------------
_______________________________________________
Mod_python mailing list
Mod_python@modpython.org
http://mailman.modpython.org/mailman/listinfo/mod_python
From perry.tew at cibavision.novartis.com  Fri Sep 19 09:59:35 2003
From: perry.tew at cibavision.novartis.com (perry.tew@cibavision.novartis.com)
Date: Fri Jan  9 22:00:23 2004
Subject: [mod_python] 	does a mod_python handler exist to generate
	charts/graphs? (png	images)
Message-ID: <OFACFE0A3B.CBD0AC18-ON85256DA6.004B1817-85256DA6.004CDDEC@EU.novartis.net>

David,
   Thanks for the input.  I'll add chaco and gnuplot.py to the list.  So 
far I have (in no order):

reportlab
pygdchart
chaco
gnuplot

I'll have to start investigating each of them.  chaco and gnuplot appear 
to have massive options and functionality.


In response to your earlier suggestions:
"""
This kind of thing is pretty simple, you can either create a 
StringIO.StringIO object (standard Python) which is a pseudo-file that 
you can get the contents out of using a string, or you could try passing 
the request object (at the appropriate time) and see if it will work 
writing to that.
Another option (assuming the project is open source) is to alter the 
program to support returning the data in a string.
I got the reportlab guys to do this - their project is mainly focussed 
on Reports and PDF, but it also has charting capabilities I haven't 
investigated.
"""

I tried to use the StringIO object from both StringIO and cStringIO.  The 
library didn't like
that at all.  I traced some of the pygdchart code.  It drops down into C 
and calls the following code (from _gdchartc.c)
( I stripped out some unnecessary lines):
PyObject *pfile, *labels, *data, *combodata;
FILE *fp;
...
if (!PyArg_ParseTuple(args, "iiO!iiOiOO", &width, &height, &PyFile_Type, 
&pfile, 
...
fp = PyFile_AsFile(pfile);

I so new to python it hurts, but I'm guessing that at this point in a C 
program, pfile has to be an
actual pointer to a file and not a file-like interface such as StringIO? 
Any experience with this?

As for having the author change the interface, I've already emailed them. 
Later on I found
the cStringIO functionality listed in a TODO file for the pygdchart 
library.  Guess I'm not the first...
I don't know how possible it would be to use cStringIO, since the FILE 
pointer is passed through a mess of C libraries

gdchart -> gd -> libjpeg

The functions all the way down to libjpeg are wanting a pointer to a FILE 
structure.   My other thought was
looking for a way to imitate the FILE pointer in memory and modifying the 
entry C code to return back the
in memory data as a binary stream.  I'll have to look into that as well. 
My C is pretty weak as well.  I'm
so thankful there's Google.

As a workaround, here's what I did (using os.tmpfile):

from mod_python import apache
from mod_python import util
import gdchart
import os

def handler(req):
        req.content_type = "image/png"

        chart = gdchart.Line3D()
        chart.width = 250
        chart.height = 250
        chart.xtitle = "xtitle goes here"
        chart.ytitle = "Percentage"
        chart.title = "Example Graph"
        chart.ext_color = [ "white", "yellow", "red", "blue", "green"]
        chart.setData([20, 100, 80, 30, 50],[10,150,20,25,65])
        chart.setLabels(["Mon", "Tue", "Wed", "Thu", "Fri"])
        chart.setLabels(["Mon", "Tue", "Wed", "Thu", "Fri"])

        f = os.tmpfile()
        chart.draw(f)
        f.seek(0)
        req.write(f.read())
        f.close()

        return apache.OK

It outputs a graph for me.    Here's another question that may be 
better suited for comp.lang.python, but do you know if
os.tmpfile() uses an in-memory representation of a file
or does it use a physical file that just remains anonymous?  I'm 
concerned about the wasteful loss of speed having to write to
disk and read it back.

Well, enough rambling.  Thanks for your time,
Perry Tew












David Fraser <davidf@sjsoft.com>
09/18/2003 04:45 PM

 
        To:     Perry Tew/CV/Novartis@PH
        cc:     mod_python@modpython.org
        Subject:        Re: [mod_python]        does a mod_python handler exist to generate 
charts/graphs? (png     images)


perry.tew@cibavision.novartis.com wrote:

>>perry.tew@cibavision.novartis.com wrote:
>>
>>>Hello everyone,
>>>  I was about the go down the road of developing a handler to generate 
>>>charts,
>>>similar to the mod_perl Apache::GD::Graph.  I wanted to make sure 
>>>something doesn't exist
>>>before I reinvent the wheel.  Does anyone know of such a thing yet?  If 

>>>so, would you please
>>>provide a url?
>>>
>>>Thanks,
>>>Perry Tew
>>
>> There are several Python graphing packages which you could use towards
>>
>>this end, the question is how nicely will they plug into a web 
>>environment.
>>I am not aware of any that are set up to do this using mod_python.
>>I'm also busy looking at the problem, for an application we are 
>>currently converting to be web based, so discuss plans / things you find 

>>here and I will to and hopefully we can come up with a nice solution...
>>
>>Thanks,
>>David
>>
>
>David,
>  Thanks for the information.  I was looking at using pygdchart2 from 
>nullcube.  I was pleased with the interface they've written.  Have you 
any 
>experience with them?  I figured it shouldn't be technically difficult to 

>create an interface of parameters that mapped to chart settings.
> 
>
I haven't had, but will look at it, do you have a URL?

>The only concern I have so far is the method of outputting the chart once 

>rendered.  The examples use the draw method:
>"""
> chart.draw(filespec)
>Draw the graph to the specified file. If the filespec argument is a 
>string, it will be treated as the path to a file. Otherwise, filespec is 
>assumed to be a Python file object.
>"""
>
>I'm new to mod_python, so I'm not sure how to pass the output stream of 
>the request object to the draw() method.  If you know, I'm be grateful. 
If 
>not, I'll work at it.  I haven't really dug yet.
> 
>
This kind of thing is pretty simple, you can either create a 
StringIO.StringIO object (standard Python) which is a pseudo-file that 
you can get the contents out of using a string, or you could try passing 
the request object (at the appropriate time) and see if it will work 
writing to that.
Another option (assuming the project is open source) is to alter the 
program to support returning the data in a string.
I got the reportlab guys to do this - their project is mainly focussed 
on Reports and PDF, but it also has charting capabilities I haven't 
investigated.
The other charting toolkit I am aware of is Chaco.

I think it would be good to investigate all of them and at least draw up 
a list of their strengths/weaknesses for use in a web server context, 
that might be helpful to other users. Would be good to have a list of 
requirements to evaluate these packages by e.g. how big the package is, 
able to produce different image formats, etc.

>btw,   I saw your post earlier about your wiki.  While cruising your site 

>I found a MLM I was in need for.  Thanks!
> 
>
Sure, but I think it was somebody else replying to my message, I don't 
have a wiki...

>Perry Tew
> 
>
David

PS hope you don't mind me rearranging your post, bottom-posting makes 
the flow easier to see.




From davidf at sjsoft.com  Fri Sep 19 16:18:16 2003
From: davidf at sjsoft.com (David Fraser)
Date: Fri Jan  9 22:00:23 2004
Subject: [mod_python] 	does a mod_python handler exist to generate
	charts/graphs? (png	images)
In-Reply-To: <OFACFE0A3B.CBD0AC18-ON85256DA6.004B1817-85256DA6.004CDDEC@EU.novartis.net>
References: <OFACFE0A3B.CBD0AC18-ON85256DA6.004B1817-85256DA6.004CDDEC@EU.novartis.net>
Message-ID: <3F6B1028.3040101@sjsoft.com>

perry.tew@cibavision.novartis.com wrote:

>David,
>   Thanks for the input.  I'll add chaco and gnuplot.py to the list.  So 
>far I have (in no order):
>
>reportlab
>pygdchart
>chaco
>gnuplot
>
>I'll have to start investigating each of them.  chaco and gnuplot appear 
>to have massive options and functionality.
>  
>
Great. I'm away for the next few days so it'll be interesting to see 
what you find.

>
>In response to your earlier suggestions:
>"""
>This kind of thing is pretty simple, you can either create a 
>StringIO.StringIO object (standard Python) which is a pseudo-file that 
>you can get the contents out of using a string, or you could try passing 
>the request object (at the appropriate time) and see if it will work 
>writing to that.
>Another option (assuming the project is open source) is to alter the 
>program to support returning the data in a string.
>I got the reportlab guys to do this - their project is mainly focussed 
>on Reports and PDF, but it also has charting capabilities I haven't 
>investigated.
>"""
>
>I tried to use the StringIO object from both StringIO and cStringIO.  The 
>library didn't like
>that at all.  I traced some of the pygdchart code.  It drops down into C 
>and calls the following code (from _gdchartc.c)
>( I stripped out some unnecessary lines):
>PyObject *pfile, *labels, *data, *combodata;
>FILE *fp;
>...
>if (!PyArg_ParseTuple(args, "iiO!iiOiOO", &width, &height, &PyFile_Type, 
>&pfile, 
>...
>fp = PyFile_AsFile(pfile);
>
>I so new to python it hurts, but I'm guessing that at this point in a C 
>program, pfile has to be an
>actual pointer to a file and not a file-like interface such as StringIO? 
>Any experience with this?
>
>As for having the author change the interface, I've already emailed them. 
>Later on I found
>the cStringIO functionality listed in a TODO file for the pygdchart 
>library.  Guess I'm not the first...
>I don't know how possible it would be to use cStringIO, since the FILE 
>pointer is passed through a mess of C libraries
>
>gdchart -> gd -> libjpeg
>
>The functions all the way down to libjpeg are wanting a pointer to a FILE 
>structure.   My other thought was
>looking for a way to imitate the FILE pointer in memory and modifying the 
>entry C code to return back the
>in memory data as a binary stream.  I'll have to look into that as well. 
>My C is pretty weak as well.  I'm
>so thankful there's Google.
>
>As a workaround, here's what I did (using os.tmpfile):
>
>from mod_python import apache
>from mod_python import util
>import gdchart
>import os
>
>def handler(req):
>        req.content_type = "image/png"
>
>        chart = gdchart.Line3D()
>        chart.width = 250
>        chart.height = 250
>        chart.xtitle = "xtitle goes here"
>        chart.ytitle = "Percentage"
>        chart.title = "Example Graph"
>        chart.ext_color = [ "white", "yellow", "red", "blue", "green"]
>        chart.setData([20, 100, 80, 30, 50],[10,150,20,25,65])
>        chart.setLabels(["Mon", "Tue", "Wed", "Thu", "Fri"])
>        chart.setLabels(["Mon", "Tue", "Wed", "Thu", "Fri"])
>
>        f = os.tmpfile()
>        chart.draw(f)
>        f.seek(0)
>        req.write(f.read())
>        f.close()
>
>        return apache.OK
>
>It outputs a graph for me.    Here's another question that may be 
>better suited for comp.lang.python, but do you know if
>os.tmpfile() uses an in-memory representation of a file
>or does it use a physical file that just remains anonymous?  I'm 
>concerned about the wasteful loss of speed having to write to
>disk and read it back.
>
>Well, enough rambling.  Thanks for your time,
>Perry Tew
>  
>
I'm pretty sure os.tmpfile() is a real file. It should probably be 
deleted afterwards.
Definitely the better option here is changing the library...
Thanks for the investigations
David


From alentzos at cosmote.gr  Fri Sep 19 17:20:43 2003
From: alentzos at cosmote.gr (Lentzos Athanassios)
Date: Fri Jan  9 22:00:23 2004
Subject: ??: [mod_python] Load python module problem
Message-ID: <4AEFA010DC6711478C8DA31039641A99014BBFA5@AHRMAIL.cosmote.gr>

First  i want to thank you  for the immediate response.
 
I did what you suggest me ( uninstall of python 2.3 and install of python 2.2.3 ver) but i still have
the same problem. I should notice that  i don't have administration authority to my workstation do you think
that maybe the cause of the problem.

-----?????? ??????-----
???: Benjamin [mailto:benjamin-hepp@t-online.de]
????????: ??????, 18 ??????????? 2003 6:41 ??
????: Lentzos Athanassios
????: Re: [mod_python] Load python module problem


>Hi 
>I have problem to load the mod_python( ver 3.0.3)? to apache (ver
2.0.47) I have done the >configuration according to the instructions but
i still
>get the following error when i try to start apache server? < " Cannot
load c:/program >files/apache/apache2/modules/mod_python.so into
server:The specified
>module could not be found." > ,of course the file is there. /* I have
installed Python >2.3? on my PC which runs NT os */? ....Please help!!
>
>Lentzos? .P Athanassios (Greece, Athens) 
>E-mail? :?? alentzos@cosmote.gr

mod_python doesn't work with Python 2.3.
Use Python 2.2.

Benjamin

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mailman.modpython.org/pipermail/mod_python/attachments/20030919/3935ae37/attachment-0002.htm
From grisha at modpython.org  Mon Sep 22 10:13:56 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 22:00:23 2004
Subject: [mod_python]  does a mod_python handler exist to generate
 charts/graphs? (png images)
In-Reply-To: <OFACFE0A3B.CBD0AC18-ON85256DA6.004B1817-85256DA6.004CDDEC@EU.novartis.net>
References: <OFACFE0A3B.CBD0AC18-ON85256DA6.004B1817-85256DA6.004CDDEC@EU.novartis.net>
Message-ID: <20030922100713.X33862@onyx.ispol.com>



On Fri, 19 Sep 2003 perry.tew@cibavision.novartis.com wrote:

> I tried to use the StringIO object from both StringIO and cStringIO.
> The library didn't like that at all.  I traced some of the pygdchart
> code.  It drops down into C and calls the following code (from
> _gdchartc.c) ( I stripped out some unnecessary lines):
>
> PyObject *pfile, *labels, *data, *combodata;
> FILE *fp;
> ...
> if (!PyArg_ParseTuple(args, "iiO!iiOiOO", &width, &height, &PyFile_Type,
> &pfile,
> ...
> fp = PyFile_AsFile(pfile);

Since StringIO is not a file (i.e. it is not a Python object of type
"file", it is something else that acts like a file, but only within
Python), I think your only option is to write to a temporary file, then
pass that file in. Take a look at Python's tempfile module (if you haven't
already).

Grisha
From mike.looijmans at asml.com  Tue Sep 23 08:09:59 2003
From: mike.looijmans at asml.com (Mike Looijmans)
Date: Fri Jan  9 22:00:23 2004
Subject: [mod_python]  does a mod_python handler exist to
	generatecharts/graphs? (png images)
Message-ID: <01c38199$51459580$926a1e6e@wsasd464>

You could look into other stuff, which would be partially OS specific:

- Named pipe. Works on most Unixes and on Windows NT system. Write to
something that looks "filish" to most programs but ends up into your
program.
- Socket. Pass a (TCP) socket descriptor, with your Python program
listening, instead of a file handle to the other side.
- Memory files. Supported on some systems, a file that resides in memory.

Some of these will require a little C interfacing, but that's easy to figure
out.

Mike.

-----Original Message-----
>Since StringIO is not a file (i.e. it is not a Python object of type
>"file", it is something else that acts like a file, but only within
>Python), I think your only option is to write to a temporary file, then
>pass that file in. Take a look at Python's tempfile module (if you haven't
>already).




-- 
The information contained in this communication and any attachments is confidential and may be privileged, and is for the sole use of the intended recipient(s). Any unauthorized review, use, disclosure or distribution is prohibited. If you are not the intended recipient, please notify the sender immediately by replying to this message and destroy all copies of this message and any attachments. ASML is neither liable for the proper and complete transmission of the information contained in this communication, nor for any delay in its receipt.


From grisha at modpython.org  Tue Sep 23 10:35:19 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 22:00:23 2004
Subject: [mod_python] [help]please give an input filter example ?
In-Reply-To: <002c01c37e5b$71210920$db64a8c0@camgelo>
References: <007c01c37dc6$32d21050$db64a8c0@camgelo>
	<3F69851B.3080703@sjsoft.com>
	<009d01c37dd0$bc2c5f40$db64a8c0@camgelo> <3F69916F.10406@sjsoft.com>
	<3F69D71A.8080005@sjsoft.com>
	<002c01c37e5b$71210920$db64a8c0@camgelo>
Message-ID: <20030923102333.N24322@onyx.ispol.com>


I've looked at the input filter code, and I think that what's in 3.0.3 is
broken. If you get the latest CVS version, your input filter code would
look somethng like:

def inputfilter(filter):

	s = filter.read()

	if s:
		## do something with s here

		filter.write(s)
	else:
		filter.close()

	return apache.OK

Note that the filter will only see the body of the POST request, it will
not see the headers, in fact it won't even be called for GET requests.

Grisha

On Fri, 19 Sep 2003, camge wrote:

> > >I need input filter to convert character set of form data submitted by
> cell
> > >phone browser.
> > >For example, convert utf-8 to big5 or gb.
> > >If I can do it in input filter, then I dont need to modify all of my
> pages.
> > >
> > >
> > Aha. What I would do is just put a function in a module that changes the
> > encoding.
> > Get the arguments like you normally would, then just do a decode/encode.
> > Since that module can be accessed from anywhere, it will work just as
> well.
> > Also, it's less likely to cause bugs, and will probably be faster
> > (you'll only making one jump into the Python interpreter and back)
> >
> > Cheers
> > David
> >
> Thanks for your suggestion!
> But my web server serve not only wap browser but also Pocket IE and IE,
> and they all use same module(for easy maintenance).
> Adding this function in these modules will be a terrible thing,
> because I dont need to convert character encoding for Pocket IE and IE.
>
> If I can do it in input filter, I don't need to modify any things in
> original module.
>
> regards,
> camge
>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From is83070 at cis.nctu.edu.tw  Wed Sep 24 09:25:36 2003
From: is83070 at cis.nctu.edu.tw (camge)
Date: Fri Jan  9 22:00:23 2004
Subject: [mod_python] [help]please give an input filter example ?
References: <007c01c37dc6$32d21050$db64a8c0@camgelo>
	<3F69851B.3080703@sjsoft.com> <009d01c37dd0$bc2c5f40$db64a8c0@camgelo>
	<3F69916F.10406@sjsoft.com> <000e01c37de9$60cfd0f0$db64a8c0@camgelo>
	<3F69D71A.8080005@sjsoft.com> <002c01c37e5b$71210920$db64a8c0@camgelo>
	<20030923102333.N24322@onyx.ispol.com>
Message-ID: <001301c3823a$cc9b9c10$db64a8c0@camgelo>

Dear Grisha,

    Many Thanks for your help!
But I dont have compile environment.
What packages must install if My dev platform is windows and
runtime environment is Apache/2.0.44 (Win32) + Python/2.2.2  ?
I am a newbie on apache.

Best regards,
camge

----- Original Message ----- 
From: "Gregory (Grisha) Trubetskoy" <grisha@modpython.org>
To: "camge" <is83070@cis.nctu.edu.tw>
Cc: "David Fraser" <davidf@sjsoft.com>; <mod_python@modpython.org>
Sent: Tuesday, September 23, 2003 10:35 PM
Subject: Re: [mod_python] [help]please give an input filter example ?


>
> I've looked at the input filter code, and I think that what's in 3.0.3 is
> broken. If you get the latest CVS version, your input filter code would
> look somethng like:
>
> def inputfilter(filter):
>
> s = filter.read()
>
> if s:
> ## do something with s here
>
> filter.write(s)
> else:
> filter.close()
>
> return apache.OK
>
> Note that the filter will only see the body of the POST request, it will
> not see the headers, in fact it won't even be called for GET requests.
>
> Grisha
>
> On Fri, 19 Sep 2003, camge wrote:
>
> > > >I need input filter to convert character set of form data submitted
by
> > cell
> > > >phone browser.
> > > >For example, convert utf-8 to big5 or gb.
> > > >If I can do it in input filter, then I dont need to modify all of my
> > pages.
> > > >
> > > >
> > > Aha. What I would do is just put a function in a module that changes
the
> > > encoding.
> > > Get the arguments like you normally would, then just do a
decode/encode.
> > > Since that module can be accessed from anywhere, it will work just as
> > well.
> > > Also, it's less likely to cause bugs, and will probably be faster
> > > (you'll only making one jump into the Python interpreter and back)
> > >
> > > Cheers
> > > David
> > >
> > Thanks for your suggestion!
> > But my web server serve not only wap browser but also Pocket IE and IE,
> > and they all use same module(for easy maintenance).
> > Adding this function in these modules will be a terrible thing,
> > because I dont need to convert character encoding for Pocket IE and IE.
> >
> > If I can do it in input filter, I don't need to modify any things in
> > original module.
> >
> > regards,
> > camge
> >
> >
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://mailman.modpython.org/mailman/listinfo/mod_python
> >
>
>

From sgillies at frii.com  Wed Sep 24 10:20:27 2003
From: sgillies at frii.com (Sean Gillies)
Date: Fri Jan  9 22:00:23 2004
Subject: [mod_python] Use of global for application data?
Message-ID: <02128F25-EEAB-11D7-BC79-000393B98B56@frii.com>

Hi,

I've seen examples of how to create persistent database connections with
mod_python, but not enough examples of other application data.  In my
case the application data are large objects including page templates.  
Exists
a better way than binding values to names in the globals namespace?  
Maybe
I just have a hang-up about globals that I need to overcome.

Sean

--
Sean Gillies
sgillies at frii dot com
http://www.frii.com/~sgillies

From fumanchu at aminus.net  Wed Sep 24 11:31:27 2003
From: fumanchu at aminus.net (fumanchu)
Date: Fri Jan  9 22:00:23 2004
Subject: [mod_python] Use of global for application data?
In-Reply-To: <DE1CF2B4FEC4A342BF62B6B2B334601E4A9B08@opus.HQAMOR.amorhq.net>
Message-ID: <DE1CF2B4FEC4A342BF62B6B2B334601E02F6CC@opus.HQAMOR.amorhq.net>

> I've seen examples of how to create persistent database connections
with
> mod_python, but not enough examples of other application data.
> In my case the application data are large objects including page
templates.
> Exists a better way than binding values to names in the globals
namespace?

"THE globals namespace" sounds misleading to me, unless you're talking
about the __main__ module. Each module has its own global namespace.

> Maybe I just have a hang-up about globals that I need to overcome.

That would depend on what you mean by "a better way". What limitations
of module.attributes are you seeing? I'd be interested to hear more
about your design, including your goals for the page templates--are you
trying to cache them in RAM throughout the life of the application?


Robert Brewer
fumanchu@aminus.net

From sgillies at frii.com  Wed Sep 24 14:38:53 2003
From: sgillies at frii.com (Sean Gillies)
Date: Fri Jan  9 22:00:23 2004
Subject: [mod_python] Use of global for application data?
In-Reply-To: <DE1CF2B4FEC4A342BF62B6B2B334601E02F6CC@opus.HQAMOR.amorhq.net>
Message-ID: <1CCFD4F4-EECF-11D7-BC79-000393B98B56@frii.com>


On Wednesday, September 24, 2003, at 12:31  PM, fumanchu wrote:

>> I've seen examples of how to create persistent database connections
> with
>> mod_python, but not enough examples of other application data.
>> In my case the application data are large objects including page
> templates.
>> Exists a better way than binding values to names in the globals
> namespace?
>
> "THE globals namespace" sounds misleading to me, unless you're talking
> about the __main__ module. Each module has its own global namespace.
>
>> Maybe I just have a hang-up about globals that I need to overcome.
>
> That would depend on what you mean by "a better way". What limitations
> of module.attributes are you seeing? I'd be interested to hear more
> about your design, including your goals for the page templates--are you
> trying to cache them in RAM throughout the life of the application?
>
>
> Robert Brewer
> fumanchu@aminus.net
>

Robert, thanks for the reply.  I went back and re-read the relevant
sections of the Python Reference Manual.  I had misunderstood that
the persistent db connection example in the FAQ was referring to a
name in the __main__ module.

I am using Zope page templates as module attributes and when methods of
my module are called (using the publisher), merging them with data
from several contexts.  I caught and fixed a bug in my code which
was causing numerous (re)loads of the module, and am now having no
problems.

Sean

--
Sean Gillies
sgillies at frii dot com
http://www.frii.com/~sgillies

From luca.masini at t-online.de  Thu Sep 25 06:57:06 2003
From: luca.masini at t-online.de (Luca Masini)
Date: Fri Jan  9 22:00:23 2004
Subject: [mod_python] mod_python just dump the script
Message-ID: <oprv1hdgvfywthye@securesmtp.t-online.de>

Hi,

I installed mod_python on mandrake 9.1 but it only
dumps the script content instead of executing it.

I do as explained in the installation/testing documentation.

Here some snippets of my httpd.conf file:

  ...
  # <mod_python>
  LoadModule python_module /usr/lib/apache2-2.0.44/mod_python.so
  # </mod_python>
  ...
  # <mod_python>
  AddModule mod_python.c
  # </mod_python>
  ...
  # <mod_python>
  AddHandler python-program .py
  <Directory /var/www/html/test>
      PythonHandler mptest
      PythonDebug On
  </Directory>
  # </mod_python>

The test full path of the test program is
  /var/www/html/test/mptest.py

More or less half an year ago I had the same problem on
a Solaris machine but I can remember how it was solved.
:-(

thanks in advance.



From is83070 at cis.nctu.edu.tw  Thu Sep 25 16:21:25 2003
From: is83070 at cis.nctu.edu.tw (camge)
Date: Fri Jan  9 22:00:23 2004
Subject: [mod_python] [help]please give an input filter example ?
References: <007c01c37dc6$32d21050$db64a8c0@camgelo>
	<3F69851B.3080703@sjsoft.com> <009d01c37dd0$bc2c5f40$db64a8c0@camgelo>
	<3F69916F.10406@sjsoft.com> <000e01c37de9$60cfd0f0$db64a8c0@camgelo>
	<3F69D71A.8080005@sjsoft.com> <002c01c37e5b$71210920$db64a8c0@camgelo>
	<20030923102333.N24322@onyx.ispol.com>
Message-ID: <010201c3833e$0a7cfc00$db64a8c0@camgelo>

Hi Grisha,

    I have compiled the latest CVS version, and it works.
But I found another problem here.

>  postData = filter.read()
>  modify(postData)
>  filter.write(postData)

If postData's length is not changed, everything is fine. 
Otherwise IE will hand there.
I guess this is caused by HTTP header "Content-Length" .
Because we changed the request body, but didn't update the header.

regards,
camge

----- Original Message ----- 
From: "Gregory (Grisha) Trubetskoy" <grisha@modpython.org>
To: "camge" <is83070@cis.nctu.edu.tw>
Cc: "David Fraser" <davidf@sjsoft.com>; <mod_python@modpython.org>
Sent: Tuesday, September 23, 2003 10:35 PM
Subject: Re: [mod_python] [help]please give an input filter example ?


> 
> I've looked at the input filter code, and I think that what's in 3.0.3 is
> broken. If you get the latest CVS version, your input filter code would
> look somethng like:
> 
> def inputfilter(filter):
> 
> s = filter.read()
> 
> if s:
> ## do something with s here
> 
> filter.write(s)
> else:
> filter.close()
> 
> return apache.OK
> 
> Note that the filter will only see the body of the POST request, it will
> not see the headers, in fact it won't even be called for GET requests.
> 
> Grisha
> 

From grisha at modpython.org  Thu Sep 25 09:29:35 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 22:00:23 2004
Subject: [mod_python] [help]please give an input filter example ?
In-Reply-To: <010201c3833e$0a7cfc00$db64a8c0@camgelo>
References: <007c01c37dc6$32d21050$db64a8c0@camgelo>
	<3F69851B.3080703@sjsoft.com>
	<009d01c37dd0$bc2c5f40$db64a8c0@camgelo> <3F69916F.10406@sjsoft.com>
	<3F69D71A.8080005@sjsoft.com><20030923102333.N24322@onyx.ispol.com>
	<010201c3833e$0a7cfc00$db64a8c0@camgelo>
Message-ID: <20030925092737.H57967@onyx.ispol.com>


On Thu, 25 Sep 2003, camge wrote:

> Hi Grisha,
>
>     I have compiled the latest CVS version, and it works.
> But I found another problem here.
>
> >  postData = filter.read()
> >  modify(postData)
> >  filter.write(postData)
>
> If postData's length is not changed, everything is fine.
> Otherwise IE will hand there.
> I guess this is caused by HTTP header "Content-Length" .
> Because we changed the request body, but didn't update the header.

Most likely, but I don't think there is a way around that because the
header is sent before the body. Perhaps your filter can store something in
the request object to communicate to your handler that it needs to read
more data.

Grisha
From luca.masini at t-online.de  Thu Sep 25 21:09:12 2003
From: luca.masini at t-online.de (Luca Masini)
Date: Fri Jan  9 22:00:23 2004
Subject: [mod_python] undefined symbol: apr_bucket_type_flush
Message-ID: <oprv2ktmdkywthye@securesmtp.t-online.de>

Hi again,
  I installed mod_python on mandrake 9.1 but it only
dumps the script content instead of executing it.

Then I installed mod_php and I have seen that mod_python is
not loaded at all.

running

  httpd -t

I get the following messages:

  Syntax error on line 66 of /etc/httpd/conf/httpd.conf:
  Cannot load /usr/lib/apache2-2.0.44/mod_python.so into server
  /usr/lib/apache2-2.0.44/mod_python.so: undefined symbol: 
apr_bucket_type_flush

So the problem seems to be this undefined apr_bucket_type_flush.

I compiled the module using these commands

   ./configure --with-apxs=/usr/src/apache2-2.0.44/support/apxs
   make
   su
   make install

What's wrong ?

Thanks.
From grisha at modpython.org  Thu Sep 25 14:22:41 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 22:00:23 2004
Subject: [mod_python] undefined symbol: apr_bucket_type_flush
In-Reply-To: <oprv2ktmdkywthye@securesmtp.t-online.de>
References: <oprv2ktmdkywthye@securesmtp.t-online.de>
Message-ID: <20030925142021.X60209@onyx.ispol.com>



On Thu, 25 Sep 2003, Luca Masini wrote:

> I compiled the module using these commands
>
>    ./configure --with-apxs=/usr/src/apache2-2.0.44/support/apxs

Don't know much about Mandrake, but it seems to me you're pointing at the
wrong apxs, it should really be in /usr/bin or some such. Perhaps someone
familiar w/ Mandrake can comment?

Grisha
From neo at https.ru  Fri Sep 26 00:58:42 2003
From: neo at https.ru (Neo Eureka)
Date: Fri Jan  9 22:00:23 2004
Subject: [mod_python] undefined symbol: apr_bucket_type_flush
In-Reply-To: <oprv2ktmdkywthye@securesmtp.t-online.de>
References: <oprv2ktmdkywthye@securesmtp.t-online.de>
Message-ID: <1118505542.20030926005842@https.ru>


  Hi!

  Some months ago I experimented with Mandrake. I guess you've
installed Apache from a "package". AFAIK, Mandrake has some kind of
"special" Apache flavours.

  I think the best (and the fastest) solution to these problems would
be to compile (the latest version of) original Apache from sources.


> Hi again,
>   I installed mod_python on mandrake 9.1 but it only
> dumps the script content instead of executing it.

> Then I installed mod_php and I have seen that mod_python is
> not loaded at all.

> running

>   httpd -t

> I get the following messages:

>   Syntax error on line 66 of /etc/httpd/conf/httpd.conf:
>   Cannot load /usr/lib/apache2-2.0.44/mod_python.so into server
>   /usr/lib/apache2-2.0.44/mod_python.so: undefined symbol: 
> apr_bucket_type_flush

> So the problem seems to be this undefined apr_bucket_type_flush.

> I compiled the module using these commands

>    ./configure --with-apxs=/usr/src/apache2-2.0.44/support/apxs
>    make
>    su
>    make install

> What's wrong ?

> Thanks.
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python


--- 
Neo Eureka / mailto:neo@https.ru

From modpython at maya.com  Thu Sep 25 17:56:55 2003
From: modpython at maya.com (Seung Chan Lim)
Date: Fri Jan  9 22:00:23 2004
Subject: [mod_python] apache.log_error
Message-ID: <029f01c383af$ef321c60$95fe46c0@GIRLS>

If I'm trying to spew error messages out to the default apache error log am
I doing the right thing by using apache.log_error ??

The problem is that I don't see anything on the default error log which I
believe is Apache2/logs/error.log

This is using mod_python 3.03
Windows 2000
Apache 2.0
Python 2.2

thanks

slim

From is83070 at cis.nctu.edu.tw  Fri Sep 26 10:08:56 2003
From: is83070 at cis.nctu.edu.tw (camge)
Date: Fri Jan  9 22:00:24 2004
Subject: [mod_python] [help]please give an input filter example ?
References: <007c01c37dc6$32d21050$db64a8c0@camgelo>
	<3F69851B.3080703@sjsoft.com> <009d01c37dd0$bc2c5f40$db64a8c0@camgelo>
	<3F69916F.10406@sjsoft.com> <000e01c37de9$60cfd0f0$db64a8c0@camgelo>
	<3F69D71A.8080005@sjsoft.com> <002c01c37e5b$71210920$db64a8c0@camgelo>
	<20030923102333.N24322@onyx.ispol.com>
	<010201c3833e$0a7cfc00$db64a8c0@camgelo>
	<20030925092737.H57967@onyx.ispol.com>
Message-ID: <001401c383d3$2c266e00$db64a8c0@camgelo>


>----- Original Message ----- 
>From: "Gregory (Grisha) Trubetskoy" <grisha@modpython.org>
>Sent: Thursday, September 25, 2003 9:29 PM
>Subject: Re: [mod_python] [help]please give an input filter example ?
>
>
> Most likely, but I don't think there is a way around that because the
> header is sent before the body. Perhaps your filter can store something in
> the request object to communicate to your handler that it needs to read
> more data.
>
> Grisha
>
>

Is there a way to read the header from client
and modify it just like the body in mod_python?
Or any way can modify the body before it sent to the cgi?
Handler in mod_python seems to handle response only.

Thanks for your response!

Best regards,
camge



From is83070 at cis.nctu.edu.tw  Fri Sep 26 15:55:26 2003
From: is83070 at cis.nctu.edu.tw (camge)
Date: Fri Jan  9 22:00:24 2004
Subject: [mod_python] [help]please give an input filter example ?
References: <007c01c37dc6$32d21050$db64a8c0@camgelo>
	<3F69851B.3080703@sjsoft.com> <009d01c37dd0$bc2c5f40$db64a8c0@camgelo>
	<3F69916F.10406@sjsoft.com> <000e01c37de9$60cfd0f0$db64a8c0@camgelo>
	<3F69D71A.8080005@sjsoft.com> <002c01c37e5b$71210920$db64a8c0@camgelo>
	<20030923102333.N24322@onyx.ispol.com>
	<010201c3833e$0a7cfc00$db64a8c0@camgelo>
	<20030925092737.H57967@onyx.ispol.com>
Message-ID: <003301c38403$9ca9ae00$db64a8c0@camgelo>

regardless of Content-Length problem,
I found my apache's error log has these error message when I post data to
cgi.
------------------------------------------------
...
[Fri Sep 26 15:51:31 2003] [error] [client 192.168.100.219] inputfilter
cameoInputFilter: Traceback (most recent call last):, referer:
http://192.168.100.161/test/index.htm
[Fri Sep 26 15:51:31 2003] [error] [client 192.168.100.219] inputfilter
cameoInputFilter:   File "C:\Program
Files\WebSite\lib\python22\lib\site-packages\mod_python\apache.py", line
222, in FilterDispatch
    object(filter), referer: http://192.168.100.161/test/index.htm
[Fri Sep 26 15:51:31 2003] [error] [client 192.168.100.219] inputfilter
cameoInputFilter:   File "C:/Program
Files/WebSite/httpd/CameoMobileSpace\cameoInputFilter.py", line 9, in
inputfilter
    strBody = filter.read(), referer: http://192.168.100.161/test/index.htm
[Fri Sep 26 15:51:31 2003] [error] [client 192.168.100.219] inputfilter
cameoInputFilter: IOError: Input filter read error, referer:
http://192.168.100.161/test/index.htm
...
-------------------------------------------------
although having error log, input filter still works.
Should I catch this exception? and how to handle it, close filter or just
return?
Below is my simple inputfilter:

def inputfilter(filter):
    strBody = filter.read()
    if strBody:
        filter.write(strBody)
    else:
        filter.close()
    return apache.OK

From grisha at modpython.org  Fri Sep 26 10:53:56 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 22:00:24 2004
Subject: [mod_python] [help]please give an input filter example ?
In-Reply-To: <003301c38403$9ca9ae00$db64a8c0@camgelo>
References: <007c01c37dc6$32d21050$db64a8c0@camgelo>
	<3F69851B.3080703@sjsoft.com>
	<009d01c37dd0$bc2c5f40$db64a8c0@camgelo> <3F69916F.10406@sjsoft.com>
	<3F69D71A.8080005@sjsoft.com><20030923102333.N24322@onyx.ispol.com>
	<20030925092737.H57967@onyx.ispol.com>
	<003301c38403$9ca9ae00$db64a8c0@camgelo>
Message-ID: <20030926104954.C62356@onyx.ispol.com>


Interesting...

If you could change filterobject.c, around line 223, where the code looks
like:

       if (! APR_STATUS_IS_SUCCESS(self->rc)) {
            PyErr_SetObject(PyExc_IOError,
                            PyString_FromString("Input filter read error"));
            return NULL;
To:

       if (! APR_STATUS_IS_SUCCESS(self->rc)) {
            PyErr_Format(PyExc_IOError, "Input filter read error: %d",
                         self->rc);
            return NULL;

This will log the actual return code that Apache is returning on this
error, it might give us more information on what is really going on there.

Thanks,

Grisha


On Fri, 26 Sep 2003, camge wrote:

> regardless of Content-Length problem,
> I found my apache's error log has these error message when I post data to
> cgi.
> ------------------------------------------------
> ...
> [Fri Sep 26 15:51:31 2003] [error] [client 192.168.100.219] inputfilter
> cameoInputFilter: Traceback (most recent call last):, referer:
> http://192.168.100.161/test/index.htm
> [Fri Sep 26 15:51:31 2003] [error] [client 192.168.100.219] inputfilter
> cameoInputFilter:   File "C:\Program
> Files\WebSite\lib\python22\lib\site-packages\mod_python\apache.py", line
> 222, in FilterDispatch
>     object(filter), referer: http://192.168.100.161/test/index.htm
> [Fri Sep 26 15:51:31 2003] [error] [client 192.168.100.219] inputfilter
> cameoInputFilter:   File "C:/Program
> Files/WebSite/httpd/CameoMobileSpace\cameoInputFilter.py", line 9, in
> inputfilter
>     strBody = filter.read(), referer: http://192.168.100.161/test/index.htm
> [Fri Sep 26 15:51:31 2003] [error] [client 192.168.100.219] inputfilter
> cameoInputFilter: IOError: Input filter read error, referer:
> http://192.168.100.161/test/index.htm
> ...
> -------------------------------------------------
> although having error log, input filter still works.
> Should I catch this exception? and how to handle it, close filter or just
> return?
> Below is my simple inputfilter:
>
> def inputfilter(filter):
>     strBody = filter.read()
>     if strBody:
>         filter.write(strBody)
>     else:
>         filter.close()
>     return apache.OK
>
From modpython at maya.com  Fri Sep 26 15:37:06 2003
From: modpython at maya.com (Seung Chan Lim)
Date: Fri Jan  9 22:00:24 2004
Subject: [mod_python] module not reloading?
Message-ID: <037001c38465$9174a550$95fe46c0@GIRLS>

The module reloading mechanism doesn't seem to work. I have to restart
apache everytime to have it reload the modules...

I even tried using the PythonAutoReload directive and set it to "ON" inside
the "Directory" section of the httpd.conf file... no luck..

any advice?

thanks


I'm using python 2.2
mod_python 3.03
Apache 2.0



From michael at dynamine.net  Fri Sep 26 12:50:07 2003
From: michael at dynamine.net (Michael S. Fischer)
Date: Fri Jan  9 22:00:24 2004
Subject: [mod_python] module not reloading?
In-Reply-To: <037001c38465$9174a550$95fe46c0@GIRLS>
References: <037001c38465$9174a550$95fe46c0@GIRLS>
Message-ID: <3F74986F.9010105@dynamine.net>

I have the same problem.  (Same versions, also running OS X 10.2, 
Python2.2 from Fink.)

--Michael

Seung Chan Lim wrote:
> The module reloading mechanism doesn't seem to work. I have to restart
> apache everytime to have it reload the modules...
> 
> I even tried using the PythonAutoReload directive and set it to "ON" inside
> the "Directory" section of the httpd.conf file... no luck..
> 
> any advice?
> 
> thanks
> 
> 
> I'm using python 2.2
> mod_python 3.03
> Apache 2.0
> 
> 
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
> 

From neel at mediapulse.com  Fri Sep 26 16:13:24 2003
From: neel at mediapulse.com (Michael C. Neel)
Date: Fri Jan  9 22:00:24 2004
Subject: [mod_python] module not reloading?
Message-ID: <C0FC22C08B82074A88B500617641577787A787@johnson.mediapulse.net>

I believe the main module reloads, but you will need to manually reload
any modules your module calls you want reloaded.  I tie this into the
PythonDebug setting, like such:

    # if this is in debug/test mode, reload any changes
    if req.get_config().has_key('PythonDebug'):
        reload(www_forms)
        reload(globals)

(if you state PythonDebug Off, there will not be a PythonDebug key at
all - a little gotcha as you might expect there to by a PythonDebug key
with a value of Off).

avoid "from module import *"'s; these don't seem to work with the reload
function (I think that is the way it's supposed to work, btw).

With the above inplace, I don't need to restart/killhup apache unless I
have PythonDebug Off.

HTH,
Mike

> -----Original Message-----
> From: Michael S. Fischer [mailto:michael@dynamine.net] 
> Sent: Friday, September 26, 2003 3:50 PM
> To: Seung Chan Lim
> Cc: mod_python@modpython.org
> Subject: Re: [mod_python] module not reloading?
> 
> 
> I have the same problem.  (Same versions, also running OS X 10.2, 
> Python2.2 from Fink.)
> 
> --Michael
> 
> Seung Chan Lim wrote:
> > The module reloading mechanism doesn't seem to work. I have 
> to restart
> > apache everytime to have it reload the modules...
> > 
> > I even tried using the PythonAutoReload directive and set 
> it to "ON" inside
> > the "Directory" section of the httpd.conf file... no luck..
> > 
> > any advice?
> > 
> > thanks
> > 
> > 
> > I'm using python 2.2
> > mod_python 3.03
> > Apache 2.0
> > 
> > 
> > 
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://mailman.modpython.org/mailman/listinfo/mod_python
> > 
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
> 

From michael at dynamine.net  Fri Sep 26 13:19:59 2003
From: michael at dynamine.net (Michael S. Fischer)
Date: Fri Jan  9 22:00:24 2004
Subject: [mod_python] module not reloading?
In-Reply-To: <C0FC22C08B82074A88B500617641577787A787@johnson.mediapulse.net>
References: <C0FC22C08B82074A88B500617641577787A787@johnson.mediapulse.net>
Message-ID: <3F749F6F.70109@dynamine.net>

Actually, my problem is that the main module reloads, but my called 
modules don't, even if I call reload() explicitly.

--Michael

Michael C. Neel wrote:

> I believe the main module reloads, but you will need to manually reload
> any modules your module calls you want reloaded.  I tie this into the
> PythonDebug setting, like such:
> 
>     # if this is in debug/test mode, reload any changes
>     if req.get_config().has_key('PythonDebug'):
>         reload(www_forms)
>         reload(globals)
> 
> (if you state PythonDebug Off, there will not be a PythonDebug key at
> all - a little gotcha as you might expect there to by a PythonDebug key
> with a value of Off).
> 
> avoid "from module import *"'s; these don't seem to work with the reload
> function (I think that is the way it's supposed to work, btw).
> 
> With the above inplace, I don't need to restart/killhup apache unless I
> have PythonDebug Off.
> 
> HTH,
> Mike
> 
> 
>>-----Original Message-----
>>From: Michael S. Fischer [mailto:michael@dynamine.net] 
>>Sent: Friday, September 26, 2003 3:50 PM
>>To: Seung Chan Lim
>>Cc: mod_python@modpython.org
>>Subject: Re: [mod_python] module not reloading?
>>
>>
>>I have the same problem.  (Same versions, also running OS X 10.2, 
>>Python2.2 from Fink.)
>>
>>--Michael
>>
>>Seung Chan Lim wrote:
>>
>>>The module reloading mechanism doesn't seem to work. I have 
>>
>>to restart
>>
>>>apache everytime to have it reload the modules...
>>>
>>>I even tried using the PythonAutoReload directive and set 
>>
>>it to "ON" inside
>>
>>>the "Directory" section of the httpd.conf file... no luck..
>>>
>>>any advice?
>>>
>>>thanks
>>>
>>>
>>>I'm using python 2.2
>>>mod_python 3.03
>>>Apache 2.0
>>>
>>>
>>>
>>>_______________________________________________
>>>Mod_python mailing list
>>>Mod_python@modpython.org
>>>http://mailman.modpython.org/mailman/listinfo/mod_python
>>>
>>
>>_______________________________________________
>>Mod_python mailing list
>>Mod_python@modpython.org
>>http://mailman.modpython.org/mailman/listinfo/mod_python
>>
> 
> 

From neel at mediapulse.com  Fri Sep 26 16:30:50 2003
From: neel at mediapulse.com (Michael C. Neel)
Date: Fri Jan  9 22:00:24 2004
Subject: [mod_python] module not reloading?
Message-ID: <C0FC22C08B82074A88B50061764157776B9722@johnson.mediapulse.net>

Hmm, without seeing any code, I'm out of ideas.  Here is the (python
2.2.2) docs on reload(), with all it's gotcha's you need to avoid...

reload(module) 
Re-parse and re-initialize an already imported module. The argument must
be a module object, so it must have been successfully imported before.
This is useful if you have edited the module source file using an
external editor and want to try out the new version without leaving the
Python interpreter. The return value is the module object (the same as
the module argument). 
There are a number of caveats: 

If a module is syntactically correct but its initialization fails, the
first import statement for it does not bind its name locally, but does
store a (partially initialized) module object in sys.modules. To reload
the module you must first import it again (this will bind the name to
the partially initialized module object) before you can reload() it. 

When a module is reloaded, its dictionary (containing the module's
global variables) is retained. Redefinitions of names will override the
old definitions, so this is generally not a problem. If the new version
of a module does not define a name that was defined by the old version,
the old definition remains. This feature can be used to the module's
advantage if it maintains a global table or cache of objects -- with a
try statement it can test for the table's presence and skip its
initialization if desired. 

It is legal though generally not very useful to reload built-in or
dynamically loaded modules, except for sys, __main__ and __builtin__. In
many cases, however, extension modules are not designed to be
initialized more than once, and may fail in arbitrary ways when
reloaded. 

If a module imports objects from another module using from ... import
..., calling reload() for the other module does not redefine the objects
imported from it -- one way around this is to re-execute the from
statement, another is to use import and qualified names (module.name)
instead. 

If a module instantiates instances of a class, reloading the module that
defines the class does not affect the method definitions of the
instances -- they continue to use the old class definition. The same is
true for derived classes. 



> -----Original Message-----
> From: Michael S. Fischer [mailto:michael@dynamine.net] 
> Sent: Friday, September 26, 2003 4:20 PM
> To: Michael C. Neel
> Cc: Seung Chan Lim; mod_python@modpython.org
> Subject: Re: [mod_python] module not reloading?
> 
> 
> Actually, my problem is that the main module reloads, but my called 
> modules don't, even if I call reload() explicitly.
> 
> --Michael
> 

From andy at netfxph.com  Sun Sep 28 08:30:37 2003
From: andy at netfxph.com (Andy Sy)
Date: Fri Jan  9 22:00:24 2004
Subject: [mod_python] 
	Win32 Binary of modpython 3.0.3 that has the Python 2.3 patch
Message-ID: <3F762BAD.9040006@netfxph.com>

 > modpython 3.0.3 works fine with Python 2.3, but to build it you
 > need to hack src/include/mod_python.h.  There's a FAQ entry with
 > the necessary patch.
 >
 > Maybe Grisha should release a 3.0.4 with just this one patch?
 >
 > -Barry

I second the motion.  Does anyone have such a binary?
At the very least widespread testing will help uncover
Python 2.3 vis-a-vis modpython 3.x bugs under Windows.

Does anyone have tips on how to compile modpython under
Windows?  Is it possible to do this using MinGW?


From andy at netfxph.com  Mon Sep 29 05:33:30 2003
From: andy at netfxph.com (Andy Sy)
Date: Fri Jan  9 22:00:24 2004
Subject: [mod_python] 
	Windows binary of modpython-3.1.0a for Python 2.3 still won't load
Message-ID: <3F7753AA.1020004@netfxph.com>

/httpd/modpython/win/3.1.0a/mod_python-3.1.0a.win32-py2.3.exe

exhibits the same problems as the earlier versions.  I'm
still getting a module not found error even though it is
clearly in the proper directory.


From is83070 at cis.nctu.edu.tw  Mon Sep 29 10:26:02 2003
From: is83070 at cis.nctu.edu.tw (camge)
Date: Fri Jan  9 22:00:24 2004
Subject: [mod_python] [help]please give an input filter example ?
References: <007c01c37dc6$32d21050$db64a8c0@camgelo>
	<3F69851B.3080703@sjsoft.com> <009d01c37dd0$bc2c5f40$db64a8c0@camgelo>
	<3F69916F.10406@sjsoft.com> <000e01c37de9$60cfd0f0$db64a8c0@camgelo>
	<3F69D71A.8080005@sjsoft.com> <002c01c37e5b$71210920$db64a8c0@camgelo>
	<20030923102333.N24322@onyx.ispol.com>
	<010201c3833e$0a7cfc00$db64a8c0@camgelo>
	<20030925092737.H57967@onyx.ispol.com>
	<003301c38403$9ca9ae00$db64a8c0@camgelo>
	<20030926104954.C62356@onyx.ispol.com>
Message-ID: <001201c38631$f12aa850$db64a8c0@camgelo>

>----- Original Message ----- 
>From: "Gregory (Grisha) Trubetskoy" <grisha@modpython.org>
>
> Interesting...
>
> If you could change filterobject.c, around line 223, where the code looks
> like:
>
>        if (! APR_STATUS_IS_SUCCESS(self->rc)) {
>             PyErr_SetObject(PyExc_IOError,
>                             PyString_FromString("Input filter read
error"));
>             return NULL;
> To:
>
>        if (! APR_STATUS_IS_SUCCESS(self->rc)) {
>             PyErr_Format(PyExc_IOError, "Input filter read error: %d",
>                          self->rc);
>             return NULL;
>
> This will log the actual return code that Apache is returning on this
> error, it might give us more information on what is really going on there.
>
> Thanks,
>
> Grisha
>
Hi Grisha,

    Below is the error message and error code is 730035.
----------------------------------------------------------------------------
------------------------------------------------------
[Mon Sep 29 10:23:56 2003] [notice] Parent: Created child process 2496
[Mon Sep 29 10:23:57 2003] [notice] Child 2496: Child process is running
[Mon Sep 29 10:23:57 2003] [notice] Child 2496: Acquired the start mutex.
[Mon Sep 29 10:23:57 2003] [notice] Child 2496: Starting 250 worker threads.
[Mon Sep 29 10:24:04 2003] [error] [client 211.79.36.248] inputfilter
cameoInputFilter: Traceback (most recent call last):
[Mon Sep 29 10:24:04 2003] [error] [client 211.79.36.248] inputfilter
cameoInputFilter:   File "C:\Program
Files\WebSite\lib\python22\lib\site-packages\mod_python\apache.py", line
222, in FilterDispatch
    object(filter)
[Mon Sep 29 10:24:04 2003] [error] [client 211.79.36.248] inputfilter
cameoInputFilter:   File "C:/Program
Files/WebSite/httpd/CameoMobileSpace\cameoInputFilter.py", line 9, in
inputfilter
    strBody = filter.read()
[Mon Sep 29 10:24:04 2003] [error] [client 211.79.36.248] inputfilter
cameoInputFilter: IOError: Input filter read error: 730035

From davidf at sjsoft.com  Mon Sep 29 07:54:06 2003
From: davidf at sjsoft.com (David Fraser)
Date: Fri Jan  9 22:00:24 2004
Subject: [mod_python] 	Win32 Binary of modpython 3.0.3 that has the Python
	2.3 patch
In-Reply-To: <3F762BAD.9040006@netfxph.com>
References: <3F762BAD.9040006@netfxph.com>
Message-ID: <3F77C8FE.6060900@sjsoft.com>

Andy Sy wrote:

> > modpython 3.0.3 works fine with Python 2.3, but to build it you
> > need to hack src/include/mod_python.h.  There's a FAQ entry with
> > the necessary patch.
> >
> > Maybe Grisha should release a 3.0.4 with just this one patch?
> >
> > -Barry
>
> I second the motion.  Does anyone have such a binary?
> At the very least widespread testing will help uncover
> Python 2.3 vis-a-vis modpython 3.x bugs under Windows.

Yes, this would be a great idea.

> Does anyone have tips on how to compile modpython under
> Windows?  Is it possible to do this using MinGW?

It's fairly complex - seems to require Visual C++ 7.0, also you have to 
then build the installer on a Linux machine I think.
Search the archives of this list for more info...

David


From davidf at sjsoft.com  Mon Sep 29 11:30:40 2003
From: davidf at sjsoft.com (David Fraser)
Date: Fri Jan  9 22:00:24 2004
Subject: [mod_python] jToolkit 0.1 released
Message-ID: <3F77FBC0.1080500@sjsoft.com>

I am pleased to announce the release of jToolkit, a new framework for 
building web applications using modpython and Apache.
jToolkit was developed by St James Software and is aimed at large, 
database-intensive applications with lots of dynamic content.

0.1 is the initial release of jToolkit. I'm trying to follow a 
release-early principle here, so at this stage, jToolkit is 
fully-functional, but documentation is scarce. Use the jToolkit lists 
for help or contributions (I also am on the mod_python and pythondev 
mailing lists).

Here's the blurb from the website, http://jtoolkit.sourceforge.net/

jToolkit is a Python web application framework built on modpython and 
Apache.

It is aimed at dynamically generated pages rather than mostly-static 
pages (for which there are templating solutions). Pages can be produced 
using a variety of widgets. It handles sessions and database connections.

The source code is licensed under the *GPL* license.

We request that for any contributions to jToolkit, *joint copyright* is 
assigned to St James Software. This enables us to keep the public GPL 
version in sync with our internal version, which we use for commercial 
projects. If there are any questions about this, please discuss on any 
of the mailing lists. (Note that if you want to, you can always create 
your own version of jToolkit without returning the contributions to this 
project).

Current features include:
  support for login/logout and user sessions (planned to be integrated 
with modpython 3.1 sessions if that is feasible)
  support for database independence using a wrapper around the Python 
DB-API 2.0
  support for localization using an extension of the gettext modules (so 
that you can have multiple users simultaneously using different languages)
  support for constructing pages using widget objects of various levels 
of complexity, ranging from simple html widgets to table layouts, etc

Any feedback, contributions etc are welcome.
In particular, if anyone actually wants to use this, they'll need help, 
which could then end up being used to create documentation. This is what 
I want to do, so please ask away!

David

From mikeklein at sbcglobal.net  Mon Sep 29 15:27:18 2003
From: mikeklein at sbcglobal.net (Mike Klein)
Date: Fri Jan  9 22:00:24 2004
Subject: [mod_python] Problems installing mod_python...openpty
Message-ID: <AIEFLNLEDPDLOJAIJKHPMEMBEJAA.mikeklein@sbcglobal.net>

I've googled/etc. and can't seem to find an answer to this one.

I am using RH9, and a separately installed Python (v. 2.2.3). My mod_python
is 2.7.8. Mod_python's install instructions say it works with <up to> Python
2.1.

My configure command is:

./configure --with-apxs=/apache/bin/apxs --with-python=/src/Python-2.2.3

The above version of python is compiled without threads and is in
/usr/local/python, whereas stock rh python is in /usr/bin and /usr/lib.

My apache is started with /usr/local/python/bin in the path before /usr/bin,
so apache is now using my custom python. This eliminated some site warnings
I was getting on restart.

When I attempt starting apache I get the following error:

Starting httpsd: Syntax error on line 211 of
/usr/local/apache/conf/httpsd.conf:
Cannot load /usr/local/apache/libexec/mod_python.so into server:
/usr/local/apache/libexec/mod_python.so: undefined symbol: openpty

Any ideas on how to solve this problem?


thanks in advance...

From mikeklein at sbcglobal.net  Mon Sep 29 17:25:44 2003
From: mikeklein at sbcglobal.net (Mike Klein)
Date: Fri Jan  9 22:00:24 2004
Subject: [mod_python] Problems installing mod_python...openpty....changing
	src/Makefile LIBS var fixed...but why needed?
In-Reply-To: <AIEFLNLEDPDLOJAIJKHPMEMBEJAA.mikeklein@sbcglobal.net>
Message-ID: <AIEFLNLEDPDLOJAIJKHPIEMEEJAA.mikeklein@sbcglobal.net>

Well...I google'd some more and found a single page with the answer:

I needed to manually update Makefile in mod_python's src directory and
added -lutil to LIBS variable.

Why is this needed though? I'm running a stock RH9 setup?

I am now able to run py scripts thru apache...


mike

-----Original Message-----
From: mod_python-bounces@modpython.org
[mailto:mod_python-bounces@modpython.org]On Behalf Of Mike Klein
Sent: Monday, September 29, 2003 3:27 PM
To: mod_python@modpython.org
Subject: [mod_python] Problems installing mod_python...openpty


I've googled/etc. and can't seem to find an answer to this one.

I am using RH9, and a separately installed Python (v. 2.2.3). My mod_python
is 2.7.8. Mod_python's install instructions say it works with <up to> Python
2.1.

My configure command is:

./configure --with-apxs=/apache/bin/apxs --with-python=/src/Python-2.2.3

The above version of python is compiled without threads and is in
/usr/local/python, whereas stock rh python is in /usr/bin and /usr/lib.

My apache is started with /usr/local/python/bin in the path before /usr/bin,
so apache is now using my custom python. This eliminated some site warnings
I was getting on restart.

When I attempt starting apache I get the following error:

Starting httpsd: Syntax error on line 211 of
/usr/local/apache/conf/httpsd.conf:
Cannot load /usr/local/apache/libexec/mod_python.so into server:
/usr/local/apache/libexec/mod_python.so: undefined symbol: openpty

Any ideas on how to solve this problem?


thanks in advance...

_______________________________________________
Mod_python mailing list
Mod_python@modpython.org
http://mailman.modpython.org/mailman/listinfo/mod_python

From mikeklein at sbcglobal.net  Mon Sep 29 19:29:19 2003
From: mikeklein at sbcglobal.net (Mike Klein)
Date: Fri Jan  9 22:00:24 2004
Subject: [mod_python] 
	Is there a status handler for mod_python ala mod_perl's
	perl-status, apache's server-status, and php's phpinfo()?
In-Reply-To: <AIEFLNLEDPDLOJAIJKHPIEMEEJAA.mikeklein@sbcglobal.net>
Message-ID: <AIEFLNLEDPDLOJAIJKHPEEMJEJAA.mikeklein@sbcglobal.net>

I like having these pages around as a sanity check and allaround diagnostic.

Does any such beast exist for mod_python? Page would show installed modules,
working environment, etc.


thanks in advance...

mike

From tpc at csua.berkeley.edu  Tue Sep 30 13:37:46 2003
From: tpc at csua.berkeley.edu (tpc@csua.berkeley.edu)
Date: Fri Jan  9 22:00:24 2004
Subject: [mod_python] writing to a file from mod_python
Message-ID: <20030930133235.G29513-100000@localhost.name>


hello all I have the following script that ran fine from the command line:

<code>
#!/usr/bin/env python

#string1 = "hello world!"

def writeFile(string1):
        open('somefile.txt', 'w').write(string1)

## writeFile(string1)
</code>

but as soon as I ported it to mod python I got the following:

<paste>
Mod_python error: "PythonHandler mod_python.publisher"

Traceback (most recent call last):

  File "/usr/lib/python2.2/site-packages/mod_python/apache.py", line 335, in HandlerDispatch
    result = object(req)

  File "/usr/lib/python2.2/site-packages/mod_python/publisher.py", line 194, in handler
    result = apply(object, (), args)

  File "/var/www/html/python/testing.py", line 7, in writeFile

IOError: [Errno 13] Permission denied: 'somefile.txt'
</paste>

I searched the web for the error message, chmod'ed 777 somefile.txt, and
even chown'ed and chgrp'ed to user and group apache, all to no avail.  Is
there a way to write to a file from mod python ?

From nelson at crynwr.com  Mon Sep  1 16:16:16 2003
From: nelson at crynwr.com (Russell Nelson)
Date: Fri Jan  9 22:04:09 2004
Subject: [mod_python] How do I serve up .html files?
In-Reply-To: <20030825213605.O1138@onyx.ispol.com>
References: <16202.30596.238589.112878@desk.crynwr.com>
	<20030825213605.O1138@onyx.ispol.com>
Message-ID: <16211.43280.919607.942196@desk.crynwr.com>

Gregory (Grisha) Trubetskoy writes:
 > P.S. Glad to see you using mod_python!

Me too!  It's a lot faster than a CGI, which was interfering with the
experience.  http://pubsoft.org/ is entirely run by a python program.
I'm going to rewrite my blogging program so that it's dynamic as
well.  Right now it writes static pages (index, archive, and rss).

-- 
--My blog is at angry-economist.russnelson.com  | Free markets express in the
Crynwr sells support for free software  | PGPok | practical world our belief
521 Pleasant Valley Rd. | +1 315 268 1925 voice | that there is that of God
Potsdam, NY 13676-3213  | +1 315 268 9201 FAX   | in all people. -Chris V.
From gdamjan at mail.net.mk  Tue Sep  2 01:15:45 2003
From: gdamjan at mail.net.mk (Damjan)
Date: Fri Jan  9 22:04:09 2004
Subject: [mod_python] Getting the script name with publisher
Message-ID: <20030901231545.GC14389@legolas.on.net.mk>

I have this simple script (test.py) that handled by the publisher:

def index(req):
    script_name = req.subprocess_env['SCRIPT_NAME']
    req.content_type = 'text/html'
    req.send_http_header()
    buf = "Hello, I'm a script. You can call my other methods:"
    buf = buf + "<br>\n" + req.path_info + "<br>\n"
    buf = buf + '''Go <a href="%s/say">here</a>''' % script_name
    return buf
def say(req, what="NOTHING"):
    return "I am saying %s" % what

Now if this script is called as:
[1]  http://127.1/test.py        -> script_name = /test.py
[2]  http://127.1/test.py/       -> script_name = /test.py/
[3]  http://127.1/test.py/index  -> script_name = /test.py
[4]  http://127.1/test.py/index/ -> script_name = /test.py/index


Now obviosly my implementation of getting the script_name doesn't not 
always get the proper result (the proper result being [1] and [3]). 
What's the proper way to do it?? 
I guess the publisher should know the real script name since it had to
import the file...



-- 
Damjan Georgievski
jabberID: damjan@bagra.net.mk
From gdamjan at mail.net.mk  Tue Sep  2 01:50:41 2003
From: gdamjan at mail.net.mk (Damjan)
Date: Fri Jan  9 22:04:09 2004
Subject: [mod_python] Getting the script name with publisher
In-Reply-To: <20030901231545.GC14389@legolas.on.net.mk>
References: <20030901231545.GC14389@legolas.on.net.mk>
Message-ID: <20030901235041.GD14389@legolas.on.net.mk>

> I have this simple script (test.py) that handled by the publisher:

I forgot to mention the test I made were with:
mod_python 3.0.3/ Python 2.3/ Apache 2.0.47 on Slackware-9.0+


PS.
for some strange reason mod_python-3.1.0a would crash Apache on my computer:

mod_python: Creating 256 session mutexes based on 256 max processes and 0 max threads.
(28)No space left on device: mod_python: Failed to create global mutex 127 of 256 (/tmp/mpmtx27278127).
mod_python: We can probably continue, but with diminished ability to process session locks.
mod_python: Hint: On Linux, the problem may be the number of available semaphores, check 'sysctl kernel.sem'
pid file /var/run/httpd.pid overwritten -- Unclean shutdown of previous Apache run?
(28)No space left on device: Couldn't create accept lock

PS2. 
while writing this I solved the mod_python-3.1.0a issue with:

    echo "32000 512 512 512" > /proc/sys/kernel/sem
    
and I also found out that my script works as expected in 3.1.0a 
:)



-- 
Damjan Georgievski
jabberID: damjan@bagra.net.mk
From davis at guydavis.ca  Tue Sep  2 11:10:47 2003
From: davis at guydavis.ca (Guy Davis)
Date: Fri Jan  9 22:04:09 2004
Subject: [mod_python] 
	Safety of using __builtins__ for per-request information?
Message-ID: <3F54CF17.9000006@guydavis.ca>

Hi all,

I'm writing a custom handler using the mod_python.cgi_handler as a guide 
on Apache 1.3 with mod_python 2.7.  Unfortunately, our old CGI makes use 
of certain super-global variables that are not easily done away with.  
I've been able to get this to work by having the handler set the global 
vars into the __builtins__ dictionary.  Then various CGI scripts can 
pull them from __builtins__ when needed. I know using __builtins__ in 
this fashion is not recommended as it's a bit of a hack.

My question is whether storing per-request information in __builtins__ 
is risky due to concurrency reasons.   Put another way, is __builtins__ 
shared between concurrent requests?  For example, person A hits a page 
and the handler stores __builtins__['foo'] = 'bar'.  At nearly the same 
time person B hits a page and the handler stores __builtins__['foo'] = 
'bar2'.  After this occurs, the CGI for person A retrieves 
__builtins__['foo'].  Will the result always be 'bar' or will 'bar2' 
sometimes be returned depending on the timing?

Will the behaviour be any different under Apache 2 and mod_python 3?

Thanks in advance for any responses.

Guy Davis                 http://www.guydavis.ca



From grisha at modpython.org  Tue Sep  2 13:32:27 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 22:04:09 2004
Subject: [mod_python]  Safety of using __builtins__ for per-request
 information?
In-Reply-To: <3F54CF17.9000006@guydavis.ca>
References: <3F54CF17.9000006@guydavis.ca>
Message-ID: <20030902132450.E6308@onyx.ispol.com>



On Tue, 2 Sep 2003, Guy Davis wrote:

> My question is whether storing per-request information in __builtins__
> is risky due to concurrency reasons.   Put another way, is __builtins__
> shared between concurrent requests?  For example, person A hits a page
> and the handler stores __builtins__['foo'] = 'bar'.  At nearly the same
> time person B hits a page and the handler stores __builtins__['foo'] =
> 'bar2'.  After this occurs, the CGI for person A retrieves
> __builtins__['foo'].  Will the result always be 'bar' or will 'bar2'
> sometimes be returned depending on the timing?

Yes, __builtins__ is shared between requests and using it for per-request
information is not a good idea. You can probably get away with it since
Apache 1.3 isn't multithreaded (unless you're on Windows), but it's still
a bad idea, not only for reasons of concurrency, but also __builtins__
isn't the right place to store anything.

Your best bet is to use the request object itself:

req.foo = 'bar2'

> Will the behaviour be any different under Apache 2 and mod_python 3?

Yes, on apache 2 it is going to be a lot more likely to cause trouble :-)

Grisha
From davidf at sjsoft.com  Tue Sep  2 22:42:33 2003
From: davidf at sjsoft.com (David Fraser)
Date: Fri Jan  9 22:04:10 2004
Subject: [mod_python] Apache startup error using mod_python under Windows
 2000 (have msvcr70.dll)
In-Reply-To: <20030829121653.W53150@onyx.ispol.com>
References: 
	<OF369D809A.F682347B-ON85256D91.004FD7CA-85256D91.0050607E@EU.novartis.net>
	<20030829110249.R53150@onyx.ispol.com> <001201c36e46$1f72d010$0a00a8c0@laird>
	<3F4F7BF2.2090106@sjsoft.com> <20030829121653.W53150@onyx.ispol.com>
Message-ID: <3F5500B9.4020205@sjsoft.com>

Gregory (Grisha) Trubetskoy wrote:

>On Fri, 29 Aug 2003, David Fraser wrote:
>
>  
>
>>Python 2.3, and the easiest way to do that...
>>would be to have an installer for mod_python 3.1a for Python 2.2! Grisha?
>>    
>>
>
>Getting a version for Python 2.2 is tricky because the production
>of the installer requires 2.3, so what I had to do in the past is compile
>for 2.2, but then use 2.3 for the installer, so it's a bit of a pain.
>
>What we really need to do is figure out what is different between our
>systems.
>
>Just to summarise, is this correct? (I am only concerned with 3.1.0a here,
>NOT 3.0.3).
>
>"stock" means the binary from www.python.org, as opposed to Win32, Active
>or compiled. All Apache is the binary from www.apache.org.
>
>       |  mod_py  | Python    | Apache | Win. |
>-------------------------------------------------------
>Perry  |  3.1.0a  | stock 2.3 | 2.0.47 | ?    | OK
>Grisha |  3.1.0a  | stock 2.3 | 2.0.47 | 2000 | OK
>David  |  3.1.0a  | stock 2.3 | 2.0.47 | 2000 | NOT OK
>Laird  |  3.1.0a  | stock 2.3 | 2.0.47 | 2000 | NOT OK
>
>Grisha
>
>  
>
To confirm:
I'm working in Windows 2000
Tested stock Apache 2.0.47, stock Python 2.3, mod_python 3.1a, get error 
loading Module
I tried running FileMon from SysInternals to see if there was some 
dependency etc it was trying to load that was failing, but couldn't see 
anything.
It seems like it is loading the module, but not finding the Apache hooks 
inside it? (Just a guess)

David

From mike.looijmans at asml.com  Wed Sep  3 07:21:15 2003
From: mike.looijmans at asml.com (Mike Looijmans)
Date: Fri Jan  9 22:04:10 2004
Subject: [mod_python] Safety of using __builtins__ for per-request
	information?
Message-ID: <01c371db$322b9780$926a1e6e@wsasd464>

It's not risky in this particular case, but it isn't good practice either...

Using cgi_handler will effectively make your system single-threaded,
regardless of the Apache version used. cgi_handler already shares the
"sys.stdout" and sys.stderr globals, and uses a lock to prevent two requests
to interfere. So within the request, using globals is safe.
I wonder why you use __builtins__, why not just use globals in your own
module? Just create a globals.py or so and import that from each script.

I saw performance _degrade_ because of this when I moved from 'plain' CGI to
mod_python cgihandler (apache 2.0 with worker mpm). Some long requests would
stall the server completely. My solution was to replace all "print"
statements with "output.write(...)" calls, and use the Request object for
output in mod_python scripts and sys.stdout when the server is using plain
CGI. Basically, I turned it around and made a CGI interface that emulates
mod_python (cgihandler does the opposite). The overhead for emulating CGI in
mod_python is huge, while the overhead of emulating mod_python in CGI is
neglectable compared to the interpreter load-and-start.

Mike.


-----Original Message-----
From: Guy Davis <davis@guydavis.ca>
To: mod_python@modpython.org <mod_python@modpython.org>
Date: Tuesday, September 02, 2003 7:13 PM
Subject: [mod_python] Safety of using __builtins__ for per-request
information?


>Hi all,
>
>I'm writing a custom handler using the mod_python.cgi_handler as a guide
>on Apache 1.3 with mod_python 2.7.  Unfortunately, our old CGI makes use
>of certain super-global variables that are not easily done away with.
>I've been able to get this to work by having the handler set the global
>vars into the __builtins__ dictionary.  Then various CGI scripts can
>pull them from __builtins__ when needed. I know using __builtins__ in
>this fashion is not recommended as it's a bit of a hack.
>
>My question is whether storing per-request information in __builtins__
>is risky due to concurrency reasons.   Put another way, is __builtins__
>shared between concurrent requests?  For example, person A hits a page
>and the handler stores __builtins__['foo'] = 'bar'.  At nearly the same
>time person B hits a page and the handler stores __builtins__['foo'] =
>'bar2'.  After this occurs, the CGI for person A retrieves
>__builtins__['foo'].  Will the result always be 'bar' or will 'bar2'
>sometimes be returned depending on the timing?
>
>Will the behaviour be any different under Apache 2 and mod_python 3?
>
>Thanks in advance for any responses.
>
>Guy Davis                 http://www.guydavis.ca
>
>
>
>_______________________________________________
>Mod_python mailing list
>Mod_python@modpython.org
>http://mailman.modpython.org/mailman/listinfo/mod_python
>
>
>
>



-- 
The information contained in this communication and any attachments is confidential and may be privileged, and is for the sole use of the intended recipient(s). Any unauthorized review, use, disclosure or distribution is prohibited. If you are not the intended recipient, please notify the sender immediately by replying to this message and destroy all copies of this message and any attachments. ASML is neither liable for the proper and complete transmission of the information contained in this communication, nor for any delay in its receipt.


From marco.vezzoli at st.com  Wed Sep  3 08:17:18 2003
From: marco.vezzoli at st.com (Marco Vezzoli)
Date: Fri Jan  9 22:04:10 2004
Subject: [mod_python] relocation error with Apache 1.3 on solaris 8
Message-ID: <3F55876E.C9BD222F@st.com>

Hi all,
I'm evaluating mod_python for our intranet site; we are using

solaris 8
gcc 3.0.1
apache 1.3.19
python 2.1.1
mod_python 2.7.8 compiled with DSO 

Compilation and basic tests run good.
I use the mod_python.publisher module for deploy but some modules can't
be imported because there is some name resolution error (messages
follows).
I googled whitout success for this problem (many ask nobody answer).
Thanks in advance for any help.
		Marco


-----------------------------------
Mod_python error: "PythonHandler mod_python.publisher"

Traceback (most recent call last):

  File "/usr/local/lib/python2.1/site-packages/mod_python/apache.py",
line 193, in Dispatch
    result = object(req)

  File "/usr/local/lib/python2.1/site-packages/mod_python/publisher.py",
line 128, in handler
    module = apache.import_module(module_name, _req, [path])

  File "/usr/local/lib/python2.1/site-packages/mod_python/apache.py",
line 335, in import_module
    module = imp.load_module(mname, f, p, d)

  File "/hype/cgi-bin/PyDataAnalysis/EWSSearchProcess.py", line 7, in ?
    import EWS

  File "/hype/cgi-bin/PyDataAnalysis/EWS.py", line 1, in ?
    from psycopg import *

ImportError: ld.so.1: /HTTP-Server/build/apache/bin/httpd: fatal:
relocation error: file /usr/local/lib/libpq.so.2: symbol main:
referenced symbol not found
-----------------------------------

-- 
Marco Vezzoli	   tel. +39 039 603 6852
STMicroelectronics fax. +39 039 603 5055
From perry.tew at cibavision.novartis.com  Wed Sep  3 13:59:36 2003
From: perry.tew at cibavision.novartis.com (perry.tew@cibavision.novartis.com)
Date: Fri Jan  9 22:04:10 2004
Subject: [mod_python] 
	correction: cannot get mod_python3.1a to run against python2.3
Message-ID: <OF11E24A39.2345CE16-ON85256D96.0060276E-85256D96.0062D790@EU.novartis.net>

Grisha,
    Earlier in the thread talking about 3.1a, I reported that I was 
successfully running 3.1a against 2.3.   It appears I was wrong. 
During the install, mod_python found my python2.3 directory in the 
registry and placed its files there, but as I've started developing with 
mod_python, 
I realized it was using my old Python2.2 directories for the python path. 
After I uninstalled 2.2, it stopped working.  Strange. 

Let me ask you, how does the mod_python.so know 
which libraries to link to?  Any idea why it would find 
the 2.2 version and not 2.3?   I now receive the following 
message from apache:
Cannot load C:/perryapps/py/Apache2/modules/mod_python.so into server: The
specified module could not be found.

When I start up python with -, I receive the following output:
Python 2.3 (#46, Jul 29 2003, 18:54:32) [MSC v.1200 32 bin (Intel)] on 
win32

What python version did you build the windows version of 3.1a against?


I also see some comments about mcvcr70.dll in the cvs repository.  I don't 
have
this file in my system.  Then again, your comments in cvs state that it's 
not 
required. 

Is there any other information I can provide to help troubleshoot this for 
myself?
I wish apache would tell me why it can't load mod_python.so.  Is there an 
option
to force apache to devulge additional information?

Sorry for confusion, again, I'm new to all of this.

Perry Tew

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mailman.modpython.org/pipermail/mod_python/attachments/20030903/0dbe868f/attachment-0003.htm
From ronwalf at wam.umd.edu  Wed Sep  3 14:25:38 2003
From: ronwalf at wam.umd.edu (Ron Alford)
Date: Fri Jan  9 22:04:10 2004
Subject: [mod_python] 
	Problem with using apache.import_module for importing scripts
Message-ID: <Pine.LNX.4.44.0309031422590.7361-100000@volus.net>

import_module has a tendency to throw 404s when you have multiple scripts 
of the same name in different directories.  Is there a known way of 
getting around this problem?

My own mod_python handler is effected, and I suspect publisher is, too.

-Ron

--
Ron Alford, KB0NUV
http://volus.net/~ronwalf


From ronwalf at wam.umd.edu  Wed Sep  3 14:34:22 2003
From: ronwalf at wam.umd.edu (Ron Alford)
Date: Fri Jan  9 22:04:10 2004
Subject: [mod_python]  Problem with using apache.import_module for
 importing scripts
In-Reply-To: <Pine.LNX.4.44.0309031422590.7361-100000@volus.net>
Message-ID: <Pine.LNX.4.44.0309031432450.7361-100000@volus.net>

On Wed, 3 Sep 2003, Ron Alford wrote:

> import_module has a tendency to throw 404s when you have multiple scripts 
> of the same name in different directories.  Is there a known way of 
> getting around this problem?
> 
> My own mod_python handler is effected, and I suspect publisher is, too.
> 

This is how I fixed it in apache.py:
...
if not file or (path and not os.path.dirname(file) in path):                    
    raise SERVER_RETURN, HTTP_NOT_FOUND   
if autoreload:
...

goes to 
...
if not file or (path and not os.path.dirname(file) in path):
    #raise SERVER_RETURN, HTTP_NOT_FOUND
    mtime, oldmtime = 0, -1
elif autoreload:
...

--
Ron Alford, KB0NUV
http://volus.net/~ronwalf


From grisha at modpython.org  Wed Sep  3 15:58:13 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 22:04:10 2004
Subject: [mod_python]  Problem with using apache.import_module for
 importing scripts
In-Reply-To: <Pine.LNX.4.44.0309031432450.7361-100000@volus.net>
References: <Pine.LNX.4.44.0309031432450.7361-100000@volus.net>
Message-ID: <20030903153559.W20438@onyx.ispol.com>


Thanks, that should work OK, and it's still secure because it doesn't
allow access to arbitrary imported modules.

But as a sidenote - you should consider naming your scripts differently
since you end up having to reload them every time the "other" script is
accessed. Also, you may sometimes find object from one script in the
namespace of the other (not sure if it's a Python bug or feature).

Grisha

On Wed, 3 Sep 2003, Ron Alford wrote:

> On Wed, 3 Sep 2003, Ron Alford wrote:
>
> > import_module has a tendency to throw 404s when you have multiple scripts
> > of the same name in different directories.  Is there a known way of
> > getting around this problem?
> >
> > My own mod_python handler is effected, and I suspect publisher is, too.
> >
>
> This is how I fixed it in apache.py:
> ...
> if not file or (path and not os.path.dirname(file) in path):
>     raise SERVER_RETURN, HTTP_NOT_FOUND
> if autoreload:
> ...
>
> goes to
> ...
> if not file or (path and not os.path.dirname(file) in path):
>     #raise SERVER_RETURN, HTTP_NOT_FOUND
>     mtime, oldmtime = 0, -1
> elif autoreload:
> ...
>
> --
> Ron Alford, KB0NUV
> http://volus.net/~ronwalf
>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From synec at viscous.org  Wed Sep  3 17:21:43 2003
From: synec at viscous.org (john spurling)
Date: Fri Jan  9 22:04:10 2004
Subject: [mod_python] relocation error with Apache 1.3 on solaris 8
In-Reply-To: <3F55876E.C9BD222F@st.com>
References: <3F55876E.C9BD222F@st.com>
Message-ID: <20030904002143.GF31952@c7c8.colobox.com>

On Wed, Sep 03, 2003 at 08:17:18AM +0200, Marco Vezzoli wrote:
> Hi all,
> I'm evaluating mod_python for our intranet site; we are using
> 
> solaris 8
> gcc 3.0.1
> apache 1.3.19
> python 2.1.1
> mod_python 2.7.8 compiled with DSO 
> 
> Compilation and basic tests run good.
> I use the mod_python.publisher module for deploy but some modules can't
> be imported because there is some name resolution error (messages
> follows).
> I googled whitout success for this problem (many ask nobody answer).
> Thanks in advance for any help.
> 		Marco

Marco,

this isn't a mod_python problem; it's a psycopg/postgresql problem. in
case you're not familiar, psycopg is a python module used to access a
postgresql database.

it looks to me like psycopg was linked against a different version of
libpq than the one that the runtime linker is using, but that's just a
guess.

you can find more information on psycopg on its website:
http://initd.org/software/psycopg

good luck,
john spurling


> -----------------------------------
> Mod_python error: "PythonHandler mod_python.publisher"
> 
> Traceback (most recent call last):
> 
>   File "/usr/local/lib/python2.1/site-packages/mod_python/apache.py",
> line 193, in Dispatch
>     result = object(req)
> 
>   File "/usr/local/lib/python2.1/site-packages/mod_python/publisher.py",
> line 128, in handler
>     module = apache.import_module(module_name, _req, [path])
> 
>   File "/usr/local/lib/python2.1/site-packages/mod_python/apache.py",
> line 335, in import_module
>     module = imp.load_module(mname, f, p, d)
> 
>   File "/hype/cgi-bin/PyDataAnalysis/EWSSearchProcess.py", line 7, in ?
>     import EWS
> 
>   File "/hype/cgi-bin/PyDataAnalysis/EWS.py", line 1, in ?
>     from psycopg import *
> 
> ImportError: ld.so.1: /HTTP-Server/build/apache/bin/httpd: fatal:
> relocation error: file /usr/local/lib/libpq.so.2: symbol main:
> referenced symbol not found
> -----------------------------------
> 
> -- 
> Marco Vezzoli	   tel. +39 039 603 6852
> STMicroelectronics fax. +39 039 603 5055
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: not available
Url : http://mailman.modpython.org/pipermail/mod_python/attachments/20030903/53baa3a5/attachment-0003.bin
From davis at guydavis.ca  Wed Sep  3 21:18:38 2003
From: davis at guydavis.ca (Guy Davis)
Date: Fri Jan  9 22:04:10 2004
Subject: [mod_python] Code directory layout recommendations?
Message-ID: <1062645517.2832.16.camel@dhcp11.int.guydavis.ca>

Hi all, 

Thanks for the answers to my previous question.  I'm now looking into
reorganizing our current directory layout of Python code.  I was
wondering what your Python web apps use for directory structures?

One idea was to have a directory for "page" modules (generate HTML
mostly), another for library modules, and another for unit tests.

Another possibility is to have a directory per major functional area. 
For example:
	
   functionA/
	-->  functionA_page.py
        -->  functionA_lib1.py
        -->  functionA_lib2.py
        -->  functionA_test.py

   functionB/
        -->  etc...

Both of the examples above are of the CVS workspace.  I'm also debating
whether the actual deploy (web-accessible) directories will be a one to
one mapping of the CVS workspace dirs or whether I'll just dump all the
Python files into one deployment directory.  Python files will be
installed into the web dirs using 'make' on a developer's workstation.

Either approach above would require some tweaks to sys.path.  Is the
standard way to do this is to stick all the required imports into a
single file and then have all other Python modules import it (appending
a relative path like ../../ to sys.path as needed)?  Any other
approaches?

It would be great to hear how you choose to layout your web app
directories and how it has worked out for you.

Thanks.
 

From davidf at sjsoft.com  Thu Sep  4 07:16:56 2003
From: davidf at sjsoft.com (David Fraser)
Date: Fri Jan  9 22:04:10 2004
Subject: [mod_python] Code directory layout recommendations?
In-Reply-To: <1062645517.2832.16.camel@dhcp11.int.guydavis.ca>
References: <1062645517.2832.16.camel@dhcp11.int.guydavis.ca>
Message-ID: <3F56CAC8.5050501@sjsoft.com>

Guy Davis wrote:

>Hi all, 
>
>Thanks for the answers to my previous question.  I'm now looking into
>reorganizing our current directory layout of Python code.  I was
>wondering what your Python web apps use for directory structures?
>
>One idea was to have a directory for "page" modules (generate HTML
>mostly), another for library modules, and another for unit tests.
>
>Another possibility is to have a directory per major functional area. 
>For example:
>	
>   functionA/
>	-->  functionA_page.py
>        -->  functionA_lib1.py
>        -->  functionA_lib2.py
>        -->  functionA_test.py
>
>   functionB/
>        -->  etc...
>
>Both of the examples above are of the CVS workspace.  I'm also debating
>whether the actual deploy (web-accessible) directories will be a one to
>one mapping of the CVS workspace dirs or whether I'll just dump all the
>Python files into one deployment directory.  Python files will be
>installed into the web dirs using 'make' on a developer's workstation.
>
>Either approach above would require some tweaks to sys.path.  Is the
>standard way to do this is to stick all the required imports into a
>single file and then have all other Python modules import it (appending
>a relative path like ../../ to sys.path as needed)?  Any other
>approaches?
>
>It would be great to hear how you choose to layout your web app
>directories and how it has worked out for you.
>
>Thanks.
> 
>
If you're doing an almost-entirely mod-python based application like 
this (i.e. almost all your content is generated by mod_python rather 
than being static),
you may find it better to have one handler in the main directory and let 
it choose which module to pass the other requests to. Then your 
directory structure is defined in Python code rather than by the file 
system. That's what we do

David

From marco.vezzoli at st.com  Thu Sep  4 08:58:57 2003
From: marco.vezzoli at st.com (Marco Vezzoli)
Date: Fri Jan  9 22:04:10 2004
Subject: [mod_python] relocation error with Apache 1.3 on solaris 8
References: <3F55876E.C9BD222F@st.com>
	<20030904002143.GF31952@c7c8.colobox.com>
Message-ID: <3F56E2B1.1E102C94@st.com>

synec@viscous.org wrote:
> 
> On Wed, Sep 03, 2003 at 08:17:18AM +0200, Marco Vezzoli wrote:
> > Hi all,
> > I'm evaluating mod_python for our intranet site; we are using
> >
> > solaris 8
> > gcc 3.0.1
> > apache 1.3.19
> > python 2.1.1
> > mod_python 2.7.8 compiled with DSO
> >
> > Compilation and basic tests run good.
> > I use the mod_python.publisher module for deploy but some modules can't
> > be imported because there is some name resolution error (messages
> > follows).
> > I googled whitout success for this problem (many ask nobody answer).
> > Thanks in advance for any help.
> >               Marco
> 
> Marco,
> 
> this isn't a mod_python problem; it's a psycopg/postgresql problem. in
> case you're not familiar, psycopg is a python module used to access a
> postgresql database.
> 
> it looks to me like psycopg was linked against a different version of
> libpq than the one that the runtime linker is using, but that's just a
> guess.
> 
> you can find more information on psycopg on its website:
> http://initd.org/software/psycopg
> 
> good luck,
> john spurling
> 

Thank you for the answer; I did some other test and I verified that

-some other modules importing .so are working correctly e.g.
mx.DateTime, gadfly
-some don't e.g. cgi (fails to load libssl, messages below)
-another postgres driver fails with a similar error (messages below)
-pure python imports psycopg correctly (so I imagine it could be some
apache/mod_python linking problem)
-no other libpq nor libssl are in the LD_LIBRARY_PATH

I'm using gnu ld: does this cause some problem?
I've tried hacking my path so that it finds Sun's ld but errors are the
same.
Is it an apache config problem?
TIA for any help

	Marco

----error importing cgi----------------------------------
Mod_python error: "PythonHandler mod_python.publisher"

Traceback (most recent call last):

  File "/usr/local/lib/python2.1/site-packages/mod_python/apache.py",
line 193, in Dispatch
    result = object(req)

  File "/usr/local/lib/python2.1/site-packages/mod_python/publisher.py",
line 128, in handler
    module = apache.import_module(module_name, _req, [path])

  File "/usr/local/lib/python2.1/site-packages/mod_python/apache.py",
line 335, in import_module
    module = imp.load_module(mname, f, p, d)

  File "/hype/cgi-bin/PyDataAnalysis/test.py", line 2, in ?
    import cgi

  File "/usr/local/lib/python2.1/cgi.py", line 39, in ?
    import urllib

  File "/usr/local/lib/python2.1/urllib.py", line 26, in ?
    import socket

  File "/usr/local/lib/python2.1/socket.py", line 41, in ?
    from _socket import *

ImportError: ld.so.1: /HTTP-Server/build/apache/bin/httpd: fatal:
relocation error: file /usr/local/lib/libssl.so.0.9.6: symbol main:
referenced symbol not found
--------------------------------------
----error importing pg----------------------------------------
Mod_python error: "PythonHandler mod_python.publisher"

Traceback (most recent call last):

  File "/usr/local/lib/python2.1/site-packages/mod_python/apache.py",
line 193, in Dispatch
    result = object(req)

  File "/usr/local/lib/python2.1/site-packages/mod_python/publisher.py",
line 128, in handler
    module = apache.import_module(module_name, _req, [path])

  File "/usr/local/lib/python2.1/site-packages/mod_python/apache.py",
line 335, in import_module
    module = imp.load_module(mname, f, p, d)

  File "/hype/cgi-bin/PyDataAnalysis/test.py", line 3, in ?
    import pg

  File "/usr/local/lib/python2.1/pg.py", line 7, in ?
    from _pg import *

ImportError: ld.so.1: /HTTP-Server/build/apache/bin/httpd: fatal:
relocation error: file /usr/local/lib/libpq.so.2: symbol main:
referenced symbol not found

-- 
Marco Vezzoli	   tel. +39 039 603 6852
STMicroelectronics fax. +39 039 603 5055
From davidf at sjsoft.com  Thu Sep  4 10:28:06 2003
From: davidf at sjsoft.com (David Fraser)
Date: Fri Jan  9 22:04:10 2004
Subject: [mod_python] relocation error with Apache 1.3 on solaris 8
In-Reply-To: <3F56E2B1.1E102C94@st.com>
References: <3F55876E.C9BD222F@st.com>
	<20030904002143.GF31952@c7c8.colobox.com> <3F56E2B1.1E102C94@st.com>
Message-ID: <3F56F796.4040803@sjsoft.com>

Marco Vezzoli wrote:

>synec@viscous.org wrote:
>  
>
>>On Wed, Sep 03, 2003 at 08:17:18AM +0200, Marco Vezzoli wrote:
>>    
>>
>>>Hi all,
>>>I'm evaluating mod_python for our intranet site; we are using
>>>
>>>solaris 8
>>>gcc 3.0.1
>>>apache 1.3.19
>>>python 2.1.1
>>>mod_python 2.7.8 compiled with DSO
>>>
>>>Compilation and basic tests run good.
>>>I use the mod_python.publisher module for deploy but some modules can't
>>>be imported because there is some name resolution error (messages
>>>follows).
>>>I googled whitout success for this problem (many ask nobody answer).
>>>Thanks in advance for any help.
>>>              Marco
>>>      
>>>
>>Marco,
>>
>>this isn't a mod_python problem; it's a psycopg/postgresql problem. in
>>case you're not familiar, psycopg is a python module used to access a
>>postgresql database.
>>
>>it looks to me like psycopg was linked against a different version of
>>libpq than the one that the runtime linker is using, but that's just a
>>guess.
>>
>>you can find more information on psycopg on its website:
>>http://initd.org/software/psycopg
>>
>>good luck,
>>john spurling
>>
>>    
>>
>
>Thank you for the answer; I did some other test and I verified that
>
>-some other modules importing .so are working correctly e.g.
>mx.DateTime, gadfly
>-some don't e.g. cgi (fails to load libssl, messages below)
>-another postgres driver fails with a similar error (messages below)
>-pure python imports psycopg correctly (so I imagine it could be some
>apache/mod_python linking problem)
>-no other libpq nor libssl are in the LD_LIBRARY_PATH
>
>I'm using gnu ld: does this cause some problem?
>I've tried hacking my path so that it finds Sun's ld but errors are the
>same.
>Is it an apache config problem?
>TIA for any help
>
>	Marco
>  
>
Searching google for httpd fatal relocation error symbol not found libpq 
solaris yields some interesting results, so this seems like a more 
general problem.
e.g. http://www.geocrawler.com/mail/msg.php3?msg_id=7733831&list=10
and an interesting thread on other similar solaris problems
http://msgs.securepoint.com/cgi-bin/get/apache0203/222/1.html

David



From davis at guydavis.ca  Thu Sep  4 16:12:39 2003
From: davis at guydavis.ca (Guy Davis)
Date: Fri Jan  9 22:04:10 2004
Subject: [mod_python] How does mod_python handle concurrency?
Message-ID: <3F57B8D7.1070605@guydavis.ca>

We currently use time.strftime() in our CGI code after setting the TZ 
environment variable to the user's timezone.  Since I'm trying to move 
us away from the mod_python.cgi_handler to our own custom handler, in 
order to allow concurrent request handling, I was wondering how to get 
around the problem of having to update the TZ env var.

This dependency seems to be a problem for concurrent request 
processing.  Does anyone on this list have a trick for doing locale 
specific date formating while handling concurrent requests?

Also, does concurrent request processing in mod_python rely on a single 
Python process with multiple threads?  If so, are sys.exc_type and 
sys.exc_value shared between threads?  I'm on Apache 1.3 now but hope to 
move to Apache 2 soon.

Thanks,
Guy

From dustin at ywlcs.org  Thu Sep  4 18:40:27 2003
From: dustin at ywlcs.org (Dustin Mitchell)
Date: Fri Jan  9 22:04:10 2004
Subject: [mod_python] How does mod_python handle concurrency?
In-Reply-To: <3F57B8D7.1070605@guydavis.ca>
References: <3F57B8D7.1070605@guydavis.ca>
Message-ID: <20030904234027.GV17963@eleanor.internal.ywlcs.org>

On Thu, Sep 04, 2003 at 04:12:39PM -0600, Guy Davis wrote:
> We currently use time.strftime() in our CGI code after setting the TZ 
> environment variable to the user's timezone.  Since I'm trying to move 
> us away from the mod_python.cgi_handler to our own custom handler, in 
> order to allow concurrent request handling, I was wondering how to get 
> around the problem of having to update the TZ env var.

If you can look up the time zone offset, you can adjust the timezones
by simply adding the required number of seconds.  I know this isn't a
very good solution, but it's what I use for the small stuff I do.

I would be very interested in how you determine the user's locale?  Is
there any trick to interpreting request headers? Or is it a user
prefererence for your site?

> Also, does concurrent request processing in mod_python rely on a single 
> Python process with multiple threads?  If so, are sys.exc_type and 
> sys.exc_value shared between threads?  I'm on Apache 1.3 now but hope to 
> move to Apache 2 soon.

Yes, those values are explicitly shared between threads, which is the
reason for the creation of sys.exc_info().  See 

 http://www.python.org/doc/current/lib/module-sys.html

Dustin

-- 

  Dustin Mitchell
  dustin@ywlcs.org/djmitche@alumni.uchicago.edu
  http://people.cs.uchicago.edu/~dustin/
  PGP Key: http://people.cs.uchicago.edu/~dustin/pubkey.txt
From cs1spw at bath.ac.uk  Fri Sep  5 03:42:29 2003
From: cs1spw at bath.ac.uk (Simon Willison)
Date: Fri Jan  9 22:04:10 2004
Subject: [mod_python] Best practise for database connection pooling?
Message-ID: <3F57F815.8020300@bath.ac.uk>

We are looking to build a large content management system using 
mod_python and PostgreSQL. I'm interested in what is considered "best 
practise" for database connection pooling. So far, I've been playing 
with the idea of setting up a single database connection as a global 
variable at the start of each mod_python script - since scripts stay in 
memory between requests, this can be reused for requests without needing 
to reopen the connection. It also means that every httpd child process 
spun off by the server ends up with its own database connection.

The postgres server is running on the same machine as the web server, 
but we may move to separate servers for the two in the future. Am I on 
the right track, or is there a better way of managing database connnections?

Incidentally, the database connection module we are using is 
http://pypgsql.sourceforge.net/

Thanks,

Simon Willison

From marco.vezzoli at st.com  Fri Sep  5 08:11:35 2003
From: marco.vezzoli at st.com (Marco Vezzoli)
Date: Fri Jan  9 22:04:10 2004
Subject: [mod_python] relocation error with Apache 1.3 on solaris 8
References: <3F55876E.C9BD222F@st.com>
	<20030904002143.GF31952@c7c8.colobox.com> <3F56E2B1.1E102C94@st.com>
	<3F56F796.4040803@sjsoft.com>
Message-ID: <3F582917.216458B4@st.com>

> >
> Searching google for httpd fatal relocation error symbol not found libpq
> solaris yields some interesting results, so this seems like a more
> general problem.
> e.g. http://www.geocrawler.com/mail/msg.php3?msg_id=7733831&list=10
> and an interesting thread on other similar solaris problems
> http://msgs.securepoint.com/cgi-bin/get/apache0203/222/1.html
> 
> David

Thank you David for the pointers.
The second one suggests that careful linking options would prevent the
'main' symbol to be generated

>    I have seen a similar failure on AIX recently. It seems that 
>    php (and tcl, which was my case) use a somewhat different way to load 
>    the shared libs than PostgreSQL does.
>
>    While PostgreSQL does not care, they need a shared lib that was linked 
>    with a switch to specify no entry (like -bnoentry on AIX).
>    Maybe that has to do with our RTLD_LAZY ?

and using nm I've found that all mod_*.so libraries do not have any
'main' symbol but libpq.so does have one marked 'U'.
I'll look for more info about linker options.
	Marco
-- 
Marco Vezzoli	   tel. +39 039 603 6852
STMicroelectronics fax. +39 039 603 5055
From davidf at sjsoft.com  Fri Sep  5 09:39:24 2003
From: davidf at sjsoft.com (David Fraser)
Date: Fri Jan  9 22:04:10 2004
Subject: [mod_python] How does mod_python handle concurrency?
In-Reply-To: <20030904234027.GV17963@eleanor.internal.ywlcs.org>
References: <3F57B8D7.1070605@guydavis.ca>
	<20030904234027.GV17963@eleanor.internal.ywlcs.org>
Message-ID: <3F583DAC.5010905@sjsoft.com>

Dustin Mitchell wrote:

>On Thu, Sep 04, 2003 at 04:12:39PM -0600, Guy Davis wrote:
>  
>
>>We currently use time.strftime() in our CGI code after setting the TZ 
>>environment variable to the user's timezone.  Since I'm trying to move 
>>us away from the mod_python.cgi_handler to our own custom handler, in 
>>order to allow concurrent request handling, I was wondering how to get 
>>around the problem of having to update the TZ env var.
>>    
>>
>
>If you can look up the time zone offset, you can adjust the timezones
>by simply adding the required number of seconds.  I know this isn't a
>very good solution, but it's what I use for the small stuff I do.
>
>I would be very interested in how you determine the user's locale?  Is
>there any trick to interpreting request headers? Or is it a user
>prefererence for your site?
>  
>
This is not for the time zone, but we have enhanced the gettext module 
to be able to support multiple locales, and to localize strings per-session.
The user selects a language, the session object passes that to the 
localize function

David

From davidf at sjsoft.com  Fri Sep  5 09:53:31 2003
From: davidf at sjsoft.com (David Fraser)
Date: Fri Jan  9 22:04:10 2004
Subject: [mod_python] Best practise for database connection pooling?
In-Reply-To: <3F57F815.8020300@bath.ac.uk>
References: <3F57F815.8020300@bath.ac.uk>
Message-ID: <3F5840FB.5090006@sjsoft.com>

Simon Willison wrote:

> We are looking to build a large content management system using 
> mod_python and PostgreSQL. I'm interested in what is considered "best 
> practise" for database connection pooling. So far, I've been playing 
> with the idea of setting up a single database connection as a global 
> variable at the start of each mod_python script - since scripts stay 
> in memory between requests, this can be reused for requests without 
> needing to reopen the connection. It also means that every httpd child 
> process spun off by the server ends up with its own database connection.

We have a system where we use multiple different database connections 
for different applications running on the same server.
Each application object exists once per child, and has its own database 
connection.

> The postgres server is running on the same machine as the web server, 
> but we may move to separate servers for the two in the future. Am I on 
> the right track, or is there a better way of managing database 
> connnections?

You may want to look at http://sqlrelay.sourceforge.net/ - I haven't 
used it, but it seems useful particularly if you have separate servers.
For those not going and reading the page:
SQL Relay is a persistent database connection pooling, proxying and load 
balancing system for Unix and Linux supporting ODBC, Oracle, MySQL, 
mSQL, PostgreSQL, Sybase, MS SQL Server, IBM DB2, Interbase, Lago and 
SQLite with APIs for C, C++, Perl, Perl-DBD, Python, Python-DB, Zope, 
PHP, Ruby, Ruby-DBD, TCL and Java, command line clients, a GUI 
configuration tool and extensive documentation. The APIs support 
advanced database operations such as bind variables, multi-row fetches, 
client side result set caching and suspended transactions. It is ideal 
for speeding up database-driven web-based applications, accessing 
databases from unsupported platforms, migrating between databases, 
distributing access to replicated databases and throttling database access.

>
> Incidentally, the database connection module we are using is 
> http://pypgsql.sourceforge.net/

I've found PyGreSQL to be better...
http://www.druid.net/pygresql/
But you may find otherwise...

David

From gdamjan at mail.net.mk  Fri Sep  5 16:18:51 2003
From: gdamjan at mail.net.mk (Damjan)
Date: Fri Jan  9 22:04:10 2004
Subject: [mod_python] How does mod_python handle concurrency?
In-Reply-To: <3F57B8D7.1070605@guydavis.ca>
References: <3F57B8D7.1070605@guydavis.ca>
Message-ID: <20030905141851.GA8470@legolas.on.net.mk>

> We currently use time.strftime() in our CGI code after setting the TZ 
> environment variable to the user's timezone.  Since I'm trying to move 
> us away from the mod_python.cgi_handler to our own custom handler, in 
> order to allow concurrent request handling, I was wondering how to get 
> around the problem of having to update the TZ env var.

Setting environment variables in multithreaded/concurent programs 
is ugly.
I would suggest a different approach for your problem..
t = time.gmtime() # get the UTC time tupple
t = t[:-1] + (TZ,) # set the TZ field of the tupple
time.strftime(format,t) # get the strftime of that 


Also glibc as of 2.3 has a new multithreaded locale API, it doesn't 
depend on global variables. This would be great (and indead is designed
for) for multithreaded application servers like Apache.
Unfourtenatelly I don't know that python bindings for this API exists or
if at all anyone is working on this...

> This dependency seems to be a problem for concurrent request 
> processing.  Does anyone on this list have a trick for doing locale 
> specific date formating while handling concurrent requests?
> http://mailman.modpython.org/mailman/listinfo/mod_python

-- 
Damjan Georgievski
jabberID: damjan@bagra.net.mk
From conrad at hep.caltech.edu  Sat Sep  6 20:04:51 2003
From: conrad at hep.caltech.edu (Conrad Steenberg)
Date: Fri Jan  9 22:04:10 2004
Subject: [mod_python] ANNOUNCE: Mod_python 3.1.0 Alpha
In-Reply-To: <20030829171157.O56156@onyx.ispol.com>
References: <20030828210644.C43921@onyx.ispol.com>
	<20030829171157.O56156@onyx.ispol.com>
Message-ID: <1062903891.2713.33.camel@Presario>

Hi

Having played around with the new version and PSP, I have one question:
My application doesn't use the session infrastructure provided by PSP,
but 256 sessions (in shared memory) are created at startup anyway.

This prompts a change in the kernel semaphore settings on older linuxes
(redhat 7.3 specifically).  As this will likely trip up new sysadmins
that just want to try out the package, is there a way to reduce the
number of sessions (or space for these sessions) by using a directive?

If there isn't such a directive, is it possible to add one?

Cheers!

Conrad

On Fri, 2003-08-29 at 14:21, Gregory (Grisha) Trubetskoy wrote:
> On Fri, 29 Aug 2003, Conrad Steenberg wrote:
> 
> > Hi
> >
> > Tested here to be working under an OpenPKG-1.3 (ish) environment.
> >
> > Any pointers to higher level tools that works with the included version
> > of PSP (such as for constructing a news or blogging site)? There seems
> > to be at least two other projects also calling themselves PSP ;-)
> 
> There is even one called Perl Server Pages :-)
> 
> I doubt there are any tools, since our PSP is brand new. B
> 
> But it's rather simplistic. For everyone's info:
> 
> This describes the syntax:
> 
> http://www.modpython.org/live/mod_python-3.1.0a/doc-html/pyapi-psp.html
> 
> And this describes the psp handler (things like sessions, etc):
> 
> http://www.modpython.org/live/mod_python-3.1.0a/doc-html/pyapi-psp.html
> 
> Also, if you have any JSP experience, there was an e-mail on the dev list
> regarding how it corresponds to PSP, which I'll forward to this list
> (because I forgot where the dev list archives are).
> 
> Grisha
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
-- 
Conrad Steenberg <conrad@hep.caltech.edu>
From grisha at apache.org  Sun Sep  7 18:45:45 2003
From: grisha at apache.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 22:04:10 2004
Subject: [mod_python] ANNOUNCE: Mod_python 3.1.0 Alpha
In-Reply-To: <1062903891.2713.33.camel@Presario>
References: <20030828210644.C43921@onyx.ispol.com>
	<1062188981.14514.296.camel@heppc22>
	<1062903891.2713.33.camel@Presario>
Message-ID: <20030907180501.B83449@onyx.ispol.com>


On Sat, 6 Sep 2003, Conrad Steenberg wrote:

> This prompts a change in the kernel semaphore settings on older linuxes
> (redhat 7.3 specifically).

Well - I think this is really a redhat problem. I believe I even saw
something reporting it as a security problem - it is very easy for someone
to deprive an rh box of available semaphores. I wonder what the default is
on rh 8 and 9 (anyone?).

> As this will likely trip up new sysadmins that just want to try out the
> package,

It probably will :-(
But that's why there is a "Hint" in the error log for Linux users.

> is there a way to reduce the number of sessions (or space for
> these sessions) by using a directive?

Yes, there is a way - adjust MaxClients. Some MPM's (at least worker) will
alter MaxClients if the other directives do not add up to or exceed it, so
it's possible other values may need adjusting.

BTW, mod_python does NOT quit if it was able to allocate *some* locks, but
not *all*, it only writes a warning to the error log and proceeds. But
what craps out after that is mod_rewrite, which wants a global lock, but
mod_python has eaten them all. So perhaps I can adjust it so that if we
allocated *some* but not *all*, then to free one (or two?)  so that
mod_rewrite is happy.

(On the other hand doing this may seem like going too far to adress what
is really a lousy config default in the kernel....)

Grisha

>
> If there isn't such a directive, is it possible to add one?
>
> Cheers!
>
> Conrad
>
> On Fri, 2003-08-29 at 14:21, Gregory (Grisha) Trubetskoy wrote:
> > On Fri, 29 Aug 2003, Conrad Steenberg wrote:
> >
> > > Hi
> > >
> > > Tested here to be working under an OpenPKG-1.3 (ish) environment.
> > >
> > > Any pointers to higher level tools that works with the included version
> > > of PSP (such as for constructing a news or blogging site)? There seems
> > > to be at least two other projects also calling themselves PSP ;-)
> >
> > There is even one called Perl Server Pages :-)
> >
> > I doubt there are any tools, since our PSP is brand new. B
> >
> > But it's rather simplistic. For everyone's info:
> >
> > This describes the syntax:
> >
> > http://www.modpython.org/live/mod_python-3.1.0a/doc-html/pyapi-psp.html
> >
> > And this describes the psp handler (things like sessions, etc):
> >
> > http://www.modpython.org/live/mod_python-3.1.0a/doc-html/pyapi-psp.html
> >
> > Also, if you have any JSP experience, there was an e-mail on the dev list
> > regarding how it corresponds to PSP, which I'll forward to this list
> > (because I forgot where the dev list archives are).
> >
> > Grisha
> >
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://mailman.modpython.org/mailman/listinfo/mod_python
> --
> Conrad Steenberg <conrad@hep.caltech.edu>
>
From llsousa at ualg.pt  Mon Sep  8 11:48:53 2003
From: llsousa at ualg.pt (Luis Sousa)
Date: Fri Jan  9 22:04:10 2004
Subject: [mod_python] Some problems with mod_python.publisher
In-Reply-To: <20030615154824.64623.qmail@web40402.mail.yahoo.com>
References: <20030615154824.64623.qmail@web40402.mail.yahoo.com>
Message-ID: <3F5C5E95.5080603@ualg.pt>

Michel Thadeu wrote:

>Hi guys!
>
>I having trouble with mod_python.publisher, I using a apache 1.2.27 and
>the mod_python 2.7 (the standard version of debian testing).
>
>I have configured the apache like this:
>
>   <Directory /var/www/modpython>
>     AddHandler python-program .py
>     PythonHandler mod_python.publisher
>   </Directory>
>
>And have made a script named index.py with the next code:
>
>   from mod_python import apache
>   def executar(req):
>           req.content_type="text/html"
>           req.send_http_header()
>           req.write('<H1>Some test of executar!</H1>')
>           return apache.OK
>
The code here can be something like this:
s="<html><h1>hello world</h1></html>"
return s

When using mod_python.publisher you have to return a string
Luis Sousa

>
>But when I execute this script, using the next url...
>
>   http://localhost/modpython/index.py/executar
>
>The page is open, rendening html code, and all the things, but with a
>error message:
>
>   Some test of executar!
>   HTTP/1.1 200 OK Date: Tue, 17 Jun 2003 23:36:26 GMT Server: 
>   Apache/1.3.27 (Unix) Debian GNU/Linux mod_python/2.7.8 Python/2.2.2 
>   PHP/4.1.2 Connection: close Transfer-Encoding: chunked Content-Type:
>
>   text/html; charset=iso-8859-1
>   OK
>   The server encountered an internal error or misconfiguration and was
>
>   unable to complete your request.
>
>   Please contact the server administrator, webmaster@capsulecorp and 
>   inform them of the time the error occurred, and anything you might 
>   have done that may have caused the error.
>
>   More information about this error may be available in the server 
>   error log.
>
>But if I use PythonHanldler and name executar as handler, the error is
>not shown... I read the last lines of error.log of apache, but I don't
>found a critical error:
>
>   [Tue Jun 17 21:42:29 2003] [alert] apache: Could not determine the 
>   server's fully qualified domain name, using 127.0.0.1 for ServerName
>   [Tue Jun 17 21:42:30 2003] [notice] Apache/1.3.27 (Unix) Debian 
>   GNU/Linux mod_python/2.7.8 Python/2.2.2 PHP/4.1.2 configured -- 
>   resuming normal operations
>   [Tue Jun 17 21:42:30 2003] [notice] suEXEC mechanism enabled 
>   (wrapper: /usr/lib/apache/suexec)
>   [Tue Jun 17 21:42:30 2003] [notice] Accept mutex: sysvsem (Default: 
>   sysvsem)
>
>This is the last errors since the last restart of apache...
>
>Well, I don't know what error I made, can someone help me?
>
>thanks
>--
>Michel Thadeu Sabchuk
>Curitiba - Paran? - Brazil
>
>=====
>--
>Michel Thadeu Sabchuk
>Curitiba/PR
>
>_______________________________________________________________________
>Yahoo! Mail
>Mais espa?o, mais seguran?a e gratuito: caixa postal de 6MB, antiv?rus, prote??o contra spam.
>http://br.mail.yahoo.com/
>_______________________________________________
>Mod_python mailing list
>Mod_python@modpython.org
>http://mailman.modpython.org/mailman/listinfo/mod_python
>
>
>  
>


-- 
Luis Sousa
Especialista de Inform?tica
Gabinete de Gest?o de Informa??o, ext: 7837
Campus de Gambelas
Universidade do Algarve, tel: 289800900

-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/x-pkcs7-signature
Size: 3627 bytes
Desc: S/MIME Cryptographic Signature
Url : http://mailman.modpython.org/pipermail/mod_python/attachments/20030908/1f41dfc5/smime-0003.bin
From llsousa at ualg.pt  Mon Sep  8 12:23:41 2003
From: llsousa at ualg.pt (Luis Sousa)
Date: Fri Jan  9 22:04:10 2004
Subject: [mod_python] 
	Handler publisher with multiple directories on the same tree
Message-ID: <3F5C66BD.8060402@ualg.pt>

Hello everybody.

I'm using Apache 1.3.26-0woody3 and mod_python 2.7.8-6, debian releases.
I have configured just one directory on my public_html and added some 
directives to httpd.conf file as follows:

<Directory /home/llsousa/public_html/gpessoal/trunk>
    AddHandler python-program .py
    PythonHandler mod_python.publisher
    PythonDebug On
    PythonPath "sys.path+['/home/llsousa/public_html/gpessoal/trunk']"
</Directory>

And everything worked ok.
So, I needed 2 more folders and I did the same for the rest, like this:

<Directory /home/llsousa/public_html/gpessoal/dev>
    AddHandler python-program .py
    PythonHandler mod_python.publisher
    PythonDebug On
    PythonPath "sys.path+['/home/llsousa/public_html/gpessoal/dev']"
</Directory>

<Directory /home/llsousa/public_html/gpessoal/bugs>
    AddHandler python-program .py
    PythonHandler mod_python.publisher
    PythonDebug On
    PythonPath "sys.path+['/home/llsousa/public_html/gpessoal/bugs']"
</Directory>

But I got a unpleasent surprise, that is, using browser, I access one of 
the projects subsection and everything is OK. After I got the page, I 
tried to access to another of the subsection and I got an 404, page not 
found. If I wait for a while (I don't know exactly, but something like 
one minute) and made reload on browser, I can now see this subsection.

Does anyone have any clue about this ? What am I doing wrong ?

Thanks in advance for your help,
Luis Sousa

-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/x-pkcs7-signature
Size: 3627 bytes
Desc: S/MIME Cryptographic Signature
Url : http://mailman.modpython.org/pipermail/mod_python/attachments/20030908/7509d5b4/smime-0003.bin
From mike.looijmans at asml.com  Mon Sep  8 13:35:35 2003
From: mike.looijmans at asml.com (Mike Looijmans)
Date: Fri Jan  9 22:04:10 2004
Subject: [mod_python] Handler publisher with multiple directories on the
	same tree
Message-ID: <01c375fd$51705d80$926a1e6e@wsasd464>

My guess:

If you wait for about a minute, the server will drop the keepalive
connection and another child process will handle your request. The effect is
that you probably get a brand new environment. Probably if you repeat often
enough, it will break completely when all childs are "loaded".

The problem is probably that you have equal named scripts in each directory.
So if you have

/a/foo.py
/b/foo.py

The first call will fetch /a/foo.py, and when you want to load the 'b'
version, it will just return the 'a' version because a 'foo' script is
already imported, even if pythonpath no longer contains the /a/ directory.

Scripts must have unique names, even when in different directories.

A good workaround is to use the "PythonInterpreter" directive, set it to per
directory or specify a unique interpreter name for each directory.
Each interpreter will have its own modules, so the "already loaded" effect
won't bite you.
This does, however, consume more memory.

This is also great for testing, you can add a "test" directory with a
different interpreter and have an environment completely set apart with it
own set of scripts and data and so.

[snip]
>But I got a unpleasent surprise, that is, using browser, I access one of
>the projects subsection and everything is OK. After I got the page, I
>tried to access to another of the subsection and I got an 404, page not
>found. If I wait for a while (I don't know exactly, but something like
>one minute) and made reload on browser, I can now see this subsection.




-- 
The information contained in this communication and any attachments is confidential and may be privileged, and is for the sole use of the intended recipient(s). Any unauthorized review, use, disclosure or distribution is prohibited. If you are not the intended recipient, please notify the sender immediately by replying to this message and destroy all copies of this message and any attachments. ASML is neither liable for the proper and complete transmission of the information contained in this communication, nor for any delay in its receipt.


From neo at https.ru  Mon Sep  8 16:59:20 2003
From: neo at https.ru (Neo Eureka)
Date: Fri Jan  9 22:04:10 2004
Subject: [mod_python] Resource consumption
In-Reply-To: <20030907180501.B83449@onyx.ispol.com>
References: <20030828210644.C43921@onyx.ispol.com>
 <1062188981.14514.296.camel@heppc22> <1062903891.2713.33.camel@Presario>
 <20030907180501.B83449@onyx.ispol.com>
Message-ID: <11020798025.20030908165920@https.ru>


Hi all!

Grisha,

IIUC, shared memory and semaphores are allocated even if I don't use
sessions or PSP at all ? Is there a way to completely "switch off"
the features I do not (and will not) use ever ? It seems very strange
to me: features that I do not use still consume system resources and
cause problems with server startup (yes, I've got RedHat box).


> On Sat, 6 Sep 2003, Conrad Steenberg wrote:

>> This prompts a change in the kernel semaphore settings on older linuxes
>> (redhat 7.3 specifically).

> Well - I think this is really a redhat problem. I believe I even saw
> something reporting it as a security problem - it is very easy for someone
> to deprive an rh box of available semaphores. I wonder what the default is
> on rh 8 and 9 (anyone?).

>> As this will likely trip up new sysadmins that just want to try out the
>> package,

> It probably will :-(
> But that's why there is a "Hint" in the error log for Linux users.

>> is there a way to reduce the number of sessions (or space for
>> these sessions) by using a directive?

> Yes, there is a way - adjust MaxClients. Some MPM's (at least worker) will
> alter MaxClients if the other directives do not add up to or exceed it, so
> it's possible other values may need adjusting.

> BTW, mod_python does NOT quit if it was able to allocate *some* locks, but
> not *all*, it only writes a warning to the error log and proceeds. But
> what craps out after that is mod_rewrite, which wants a global lock, but
> mod_python has eaten them all. So perhaps I can adjust it so that if we
> allocated *some* but not *all*, then to free one (or two?)  so that
> mod_rewrite is happy.

> (On the other hand doing this may seem like going too far to adress what
> is really a lousy config default in the kernel....)

> Grisha


--- 
Neo Eureka / mailto:neo@https.ru

From llsousa at ualg.pt  Mon Sep  8 14:21:46 2003
From: llsousa at ualg.pt (Luis Sousa)
Date: Fri Jan  9 22:04:11 2004
Subject: [mod_python] Handler publisher with multiple directories on the
 same tree
In-Reply-To: <01c375fd$51705d80$926a1e6e@wsasd464>
References: <01c375fd$51705d80$926a1e6e@wsasd464>
Message-ID: <3F5C826A.80404@ualg.pt>

Skipped content of type multipart/alternative-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/x-pkcs7-signature
Size: 3627 bytes
Desc: S/MIME Cryptographic Signature
Url : http://mailman.modpython.org/pipermail/mod_python/attachments/20030908/79dd05a8/smime-0003.bin
From mike.looijmans at asml.com  Mon Sep  8 15:40:26 2003
From: mike.looijmans at asml.com (Mike Looijmans)
Date: Fri Jan  9 22:04:11 2004
Subject: [mod_python] Handler publisher with multiple directories on
	thesame tree
Message-ID: <01c3760e$c26c4100$926a1e6e@wsasd464>

> When I'm developing I usually have a common problem that is when I
> change a class or some file, sometimes the interpreter remains in memory
> the old version and doesn't load the new one. Is there a way to solve
> this out ? Normally I use an non elegant way, I restart apache!

I use the "reload" built-in function. This loads an internal module from
disk.
My main handler checks if the path_info of the URL is "/request" and if so,
runs the following (you could use publisher to publish this interface as
well).
All "my" modules are named "ops_" something. You could also use the __file__
location as a filter.

def reloadmodules(req):
    '''Try to reload all ops_ modules. This is typically done after updating
    imported scripts, such as ops_cgisql.py. The main scripts will be
    reloaded automatically on demand, so that there is no need to send
    a reload after changing ops_webrellist.py or so.
    This also throws away old DB connections. If there are currently
    active connections, these are preserved.'''
    req.content_type='text/plain'
    # Reload python modules
    modules = sys.modules.keys()
    modules.sort()
    for module in modules:
        if module[:4] == 'ops_':
            try:
                req.write('Reloading: %s\n' % module)
                reload(sys.modules[module])
            except:
                req.write('%s: %s\n' % sys.exc_info()[:2])
    # throw away DB connection objects
    req.write('Destroy DB cached connections\n')
    _lock.acquire()
    try:
        dblist.clear()
    finally:
        _lock.release()
    req.write('Done\n')





-- 
The information contained in this communication and any attachments is confidential and may be privileged, and is for the sole use of the intended recipient(s). Any unauthorized review, use, disclosure or distribution is prohibited. If you are not the intended recipient, please notify the sender immediately by replying to this message and destroy all copies of this message and any attachments. ASML is neither liable for the proper and complete transmission of the information contained in this communication, nor for any delay in its receipt.


From grisha at modpython.org  Mon Sep  8 09:53:57 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 22:04:11 2004
Subject: [mod_python] Resource consumption
In-Reply-To: <11020798025.20030908165920@https.ru>
References: <20030828210644.C43921@onyx.ispol.com>
	<1062188981.14514.296.camel@heppc22>
	<20030907180501.B83449@onyx.ispol.com>
	<11020798025.20030908165920@https.ru>
Message-ID: <20030908092907.A93462@onyx.ispol.com>



On Mon, 8 Sep 2003, Neo Eureka wrote:

> IIUC, shared memory and semaphores are allocated even if I don't use
> sessions or PSP at all?

Yes (there is no shared memory used for sessions, only locks, which *may*
be semaphores or some other lock implementation, depending on your OS).

> Is there a way to completely "switch off" the features I do not (and
> will not) use ever ?

Not right now. I couldn't think of a way to do it that wouldn't be
confusing. Locks must be allocated at server startup so that children
have access to them. We could have a directive like "PythonSessionLocks
Off", IMHO that's on the ugly side.

Generally, I think keeping the number of Apache directive to a minimum is
a good idea.

> It seems very strange to me: features that I do not use still consume
> system resources

That's not unusual - as an example, every RH box will load all kinds of
modules (including mod_python), but few people ever use them all.

> and cause problems with server startup

This, I agree, *is* a problem, but I think I can work around it without
introducing new Apache directives.

Another point to consider is that on many other systems there will not be
a limit to the number of locks allocated, and there is no cost to
allocating a lock but never using it, so a directive like this wouldn't
make much sense.

Grisha

> (yes, I've got RedHat box).


>
>
> > On Sat, 6 Sep 2003, Conrad Steenberg wrote:
>
> >> This prompts a change in the kernel semaphore settings on older linuxes
> >> (redhat 7.3 specifically).
>
> > Well - I think this is really a redhat problem. I believe I even saw
> > something reporting it as a security problem - it is very easy for someone
> > to deprive an rh box of available semaphores. I wonder what the default is
> > on rh 8 and 9 (anyone?).
>
> >> As this will likely trip up new sysadmins that just want to try out the
> >> package,
>
> > It probably will :-(
> > But that's why there is a "Hint" in the error log for Linux users.
>
> >> is there a way to reduce the number of sessions (or space for
> >> these sessions) by using a directive?
>
> > Yes, there is a way - adjust MaxClients. Some MPM's (at least worker) will
> > alter MaxClients if the other directives do not add up to or exceed it, so
> > it's possible other values may need adjusting.
>
> > BTW, mod_python does NOT quit if it was able to allocate *some* locks, but
> > not *all*, it only writes a warning to the error log and proceeds. But
> > what craps out after that is mod_rewrite, which wants a global lock, but
> > mod_python has eaten them all. So perhaps I can adjust it so that if we
> > allocated *some* but not *all*, then to free one (or two?)  so that
> > mod_rewrite is happy.
>
> > (On the other hand doing this may seem like going too far to adress what
> > is really a lousy config default in the kernel....)
>
> > Grisha
>
>
> ---
> Neo Eureka / mailto:neo@https.ru
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From grickert at coldstorage.com  Mon Sep  8 17:18:13 2003
From: grickert at coldstorage.com (Gerrat Rickert)
Date: Fri Jan  9 22:04:11 2004
Subject: [mod_python] 
Message-ID: <DIEMKLHLKFCCPAEPDMHKIEFECEAA.grickert@coldstorage.com>



Gerrat Rickert
Systems Analyst
Conestoga Coldstorage


From grickert at coldstorage.com  Mon Sep  8 17:42:33 2003
From: grickert at coldstorage.com (Gerrat Rickert)
Date: Fri Jan  9 22:04:11 2004
Subject: [mod_python] 
	PythonHandler does not appear to append directory to import path
Message-ID: <DIEMKLHLKFCCPAEPDMHKCEFFCEAA.grickert@coldstorage.com>

I'm using mod_python 3.03, apache 2.047, and python 2.2.3 on a win2K machine
& am trying to use the publisher handler.  The problem is when I try to add
an additional handler via:

req.addhandler("PythonHandler", testModule, directory_to_append_to_sys_path)

The error I am getting is:

Mod_python error: "PythonHandler testModule"

Traceback (most recent call last):

  File "D:\Python22\lib\site-packages\mod_python\apache.py", line 340, in
HandlerDispatch
    module = import_module(module_name, config)

  File "D:\Python22\lib\site-packages\mod_python\apache.py", line 516, in
import_module
    f, p, d = imp.find_module(parts[i], path)

ImportError: No module named testModule



Looking through the HandlerDispatch function of apache.py, the relevant code
is:

if config.has_key("PythonPath"):
...
else:
    dir = hlist.directory
    if dir and (dir not in sys.path):
        sys.path[:0] = [dir]


This code doesn't appear to add my directory
(directory_to_append_to_sys_path) to the sys.path if I have "PythonPath" in
my httpd.conf file.  Importing my module fails because of this.  I'm not
sure if this is just a misunderstanding on my part or has already been
addressed (in which case I apologize for posting).  As far as I can see, the
"else" portion of this statement should be executed regardless of whether
PythonPath is in the config file or not.  Can anyone else confirm this?

Thanks,
Gerrat Rickert


From grisha at modpython.org  Tue Sep  9 10:41:55 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 22:04:11 2004
Subject: [mod_python]  PythonHandler does not appear to append directory
 to import path
In-Reply-To: <DIEMKLHLKFCCPAEPDMHKCEFFCEAA.grickert@coldstorage.com>
References: <DIEMKLHLKFCCPAEPDMHKCEFFCEAA.grickert@coldstorage.com>
Message-ID: <20030909103210.V9524@onyx.ispol.com>


Gerrat -

You're right, it doesn't add the directory to the path if PythonPath is
specified. The code that decides this has no way of knowing whether the
handler was specified via an Apache directive or req.add_handler(). It
just follows the rule that PythonPath overrides everything.

The rationale for this all-overriding behaviour of PythonPath is that you
can use it make sure that the directory where the handler is specified is
_not_ in sys.path. (Otherwise, if the directive directory was _always_
added, there would be no way to achieve this)

You can do two things:

1. Add directory_to_append_to_sys_path to PythonPath
2. Get rid of PythonPath. I see a lot of people using it where they really
don't need to. See if you _really_ need it.

What *I* need to do is adjust the documentation of add_handler() to
clarify that dir has no effect when PythonPath is specified.

Grisha

On Mon, 8 Sep 2003, Gerrat Rickert wrote:

> I'm using mod_python 3.03, apache 2.047, and python 2.2.3 on a win2K machine
> & am trying to use the publisher handler.  The problem is when I try to add
> an additional handler via:
>
> req.addhandler("PythonHandler", testModule, directory_to_append_to_sys_path)
>
> The error I am getting is:
>
> Mod_python error: "PythonHandler testModule"
>
> Traceback (most recent call last):
>
>   File "D:\Python22\lib\site-packages\mod_python\apache.py", line 340, in
> HandlerDispatch
>     module = import_module(module_name, config)
>
>   File "D:\Python22\lib\site-packages\mod_python\apache.py", line 516, in
> import_module
>     f, p, d = imp.find_module(parts[i], path)
>
> ImportError: No module named testModule
>
>
>
> Looking through the HandlerDispatch function of apache.py, the relevant code
> is:
>
> if config.has_key("PythonPath"):
> ...
> else:
>     dir = hlist.directory
>     if dir and (dir not in sys.path):
>         sys.path[:0] = [dir]
>
>
> This code doesn't appear to add my directory
> (directory_to_append_to_sys_path) to the sys.path if I have "PythonPath" in
> my httpd.conf file.  Importing my module fails because of this.  I'm not
> sure if this is just a misunderstanding on my part or has already been
> addressed (in which case I apologize for posting).  As far as I can see, the
> "else" portion of this statement should be executed regardless of whether
> PythonPath is in the config file or not.  Can anyone else confirm this?
>
> Thanks,
> Gerrat Rickert
>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From grickert at coldstorage.com  Tue Sep  9 11:43:15 2003
From: grickert at coldstorage.com (Gerrat Rickert)
Date: Fri Jan  9 22:04:11 2004
Subject: [mod_python]  PythonHandler does not appear to append directory
 to import path
Message-ID: <DIEMKLHLKFCCPAEPDMHKIEFHCEAA.grickert@coldstorage.com>

Grisha -

Thanks for your response - much appreciated.  I'm probably using PythonPath
where I don't need to.  I have some modules I'd like to share between
several web apps & I can just add their path to my PYTHONPATH environment
variable & remove the PythonPath directive.

Gerrat


From llsousa at ualg.pt  Tue Sep  9 17:19:00 2003
From: llsousa at ualg.pt (Luis Sousa)
Date: Fri Jan  9 22:04:11 2004
Subject: [mod_python] Handler publisher with multiple directories on
	thesame tree
In-Reply-To: <01c3760e$c26c4100$926a1e6e@wsasd464>
References: <01c3760e$c26c4100$926a1e6e@wsasd464>
Message-ID: <3F5DFD74.3030100@ualg.pt>

Skipped content of type multipart/alternative-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/x-pkcs7-signature
Size: 3627 bytes
Desc: S/MIME Cryptographic Signature
Url : http://mailman.modpython.org/pipermail/mod_python/attachments/20030909/bdba7319/smime-0003.bin
From davidf at sjsoft.com  Tue Sep  9 18:56:34 2003
From: davidf at sjsoft.com (David Fraser)
Date: Fri Jan  9 22:04:11 2004
Subject: [mod_python]  PythonHandler does not appear to append directory
 to import path
In-Reply-To: <DIEMKLHLKFCCPAEPDMHKIEFHCEAA.grickert@coldstorage.com>
References: <DIEMKLHLKFCCPAEPDMHKIEFHCEAA.grickert@coldstorage.com>
Message-ID: <3F5E0642.9090702@sjsoft.com>

Gerrat Rickert wrote:

>Grisha -
>
>Thanks for your response - much appreciated.  I'm probably using PythonPath
>where I don't need to.  I have some modules I'd like to share between
>several web apps & I can just add their path to my PYTHONPATH environment
>variable & remove the PythonPath directive.
>
>Gerrat
>  
>
It might be helpful to look at putting these shared modules in a package 
that is either located under site-packages, or where the location is put 
in a .pth file under site-packages. Then you don't need to adjust any 
path things at all

David

From neel at mediapulse.com  Tue Sep  9 17:26:23 2003
From: neel at mediapulse.com (Michael C. Neel)
Date: Fri Jan  9 22:04:11 2004
Subject: [mod_python] Using dbpool in more than one place....
Message-ID: <C0FC22C08B82074A88B50061764157775CCB@johnson.mediapulse.net>

I'm currently trying to migrate an apache 1.3 / mod_python 2.7.8 site to
apache 2.x and mod_python 3.x.

I currently load two different mod_python modules for the site, one to
log hits to a database, the other to run site site pages.  I'm using
worker threads on apache, and trying to use dbpool to work around
MySQLdb's threading level 1.

The logging module connects to a remote 3.23.x Mysql box; the site
module connects to a local MySQL 4.x database.  If I disable one module,
the other (using dbpool) will run fine; it's when I try to run both I
get problems.  When I "import jon.dbpool as dbpool" on both, I get the
following errors in the global apache log:

Exception exceptions.RuntimeError: 'maximum recursion depth exceeded' in
<function _connection_notinuse at 0x41afbaac> ignored
Exception exceptions.TypeError: 'weak object has gone away' in <function
_connection_notinuse at 0x41afbaac> ignored

When I "import jon.dbpool as logger_dbpool" in the log module and
"import jon.dbpool as dbpool" in the site module I get the following
error in the sites log file:

Mod_python error: "PythonHandler www"

Traceback (most recent call last):

  File "/usr/local/lib/python2.3/site-packages/mod_python/apache.py",
line 338, in HandlerDispatch
    result = object(req)

  File "/home/sites/beta/modules/www.py", line 51, in handler
    c = db.cursor()

  File "/usr/local/lib/python2.3/site-packages/jon/dbpool.py", line 93,
in cursor
    return self._inner.cursor(*args, **kwargs)

  File "/usr/local/lib/python2.3/site-packages/jon/dbpool.py", line 129,
in cursor
    c = _Cursor(self, *args, **kwargs)

  File "/usr/local/lib/python2.3/site-packages/jon/dbpool.py", line 140,
in __init__
    self._outer = connection._outerref()

TypeError: 'NoneType' object is not callable


Is it possbile to use dbpool to connect to two different databases,
using two different mod_python modules?

Thanks,
Mike

From fumanchu at aminus.net  Tue Sep  9 16:59:06 2003
From: fumanchu at aminus.net (fumanchu)
Date: Fri Jan  9 22:04:11 2004
Subject: [mod_python] Using dbpool in more than one place....
In-Reply-To: <DE1CF2B4FEC4A342BF62B6B2B334601E43651A@opus.HQAMOR.amorhq.net>
Message-ID: <DE1CF2B4FEC4A342BF62B6B2B334601E42D20E@opus.HQAMOR.amorhq.net>

Quick response: the message:

Exception exceptions.RuntimeError: 'maximum recursion depth exceeded' in
<function _connection_notinuse at 0x41afbaac> ignored

is most likely due a namespace collision, where you think you're calling
one function and you're really calling another with the same name,
(usually the current function, although parallel recursion has been
known to occur). When using "as", try using unique new names, not
fragments of existing names. So try:

"import jon.dbpool as logger_dbpool" in the log module and
"import jon.dbpool as site_dbpool" in the site module.

Just a thought.


Robert Brewer
fumanchu@aminus.net

From mike.looijmans at asml.com  Wed Sep 10 07:15:45 2003
From: mike.looijmans at asml.com (Mike Looijmans)
Date: Fri Jan  9 22:04:11 2004
Subject: [mod_python] Handler publisher with multiple directories
	onthesame tree
Message-ID: <01c3775a$965dd680$926a1e6e@wsasd464>

>>My main handler checks if the path_info of the URL is "/request" and if 
>
>How do you check this ?


Uh, basically:

if req.path_info == '/reload':
    return reloadModules(req)

:-)



-- 
The information contained in this communication and any attachments is confidential and may be privileged, and is for the sole use of the intended recipient(s). Any unauthorized review, use, disclosure or distribution is prohibited. If you are not the intended recipient, please notify the sender immediately by replying to this message and destroy all copies of this message and any attachments. ASML is neither liable for the proper and complete transmission of the information contained in this communication, nor for any delay in its receipt.


From gdamjan at mail.net.mk  Wed Sep 10 15:55:38 2003
From: gdamjan at mail.net.mk (Damjan)
Date: Fri Jan  9 22:04:11 2004
Subject: [mod_python] ANNOUNCE: Mod_python 3.1.0 Alpha
In-Reply-To: <20030907180501.B83449@onyx.ispol.com>
References: <20030828210644.C43921@onyx.ispol.com>
	<1062188981.14514.296.camel@heppc22> <1062903891.2713.33.camel@Presario>
	<20030907180501.B83449@onyx.ispol.com>
Message-ID: <20030910135538.GC3575@legolas.on.net.mk>

> > This prompts a change in the kernel semaphore settings on older linuxes
> > (redhat 7.3 specifically).
> 
> Well - I think this is really a redhat problem. I believe I even saw
> something reporting it as a security problem - it is very easy for someone
> to deprive an rh box of available semaphores. I wonder what the default is
> on rh 8 and 9 (anyone?).

Well I have Slackware-9+, and the defaults are not changed from the
kernel defaults:
    damjan$ cat /proc/sys/kernel/sem
    250     32000   32      128

I'm using 
    echo "512     32000   32      512" > /proc/sys/kernel/sem
right now.


-- 
Damjan Georgievski
jabberID: damjan@bagra.net.mk
From pu at vo.lu  Thu Sep 11 23:41:22 2003
From: pu at vo.lu (Patrick Useldinger)
Date: Fri Jan  9 22:04:11 2004
Subject: [mod_python] mod_python 3.1
Message-ID: <oprvcui8zixiz7y9@smtp.vo.lu>

I have read in the mailing list archives that only mod_python 3.1 and 
higher will work with Python 2.3. Is this still correct? If so, when is 
version 3.1 sheduled?
-pu
From barry at python.org  Thu Sep 11 18:20:54 2003
From: barry at python.org (Barry Warsaw)
Date: Fri Jan  9 22:04:11 2004
Subject: [mod_python] mod_python 3.1
In-Reply-To: <oprvcui8zixiz7y9@smtp.vo.lu>
References: <oprvcui8zixiz7y9@smtp.vo.lu>
Message-ID: <1063318854.19907.15.camel@anthem>

On Thu, 2003-09-11 at 17:41, Patrick Useldinger wrote:
> I have read in the mailing list archives that only mod_python 3.1 and 
> higher will work with Python 2.3. Is this still correct? If so, when is 
> version 3.1 sheduled?

modpython 3.0.3 works fine with Python 2.3, but to build it you need to
hack src/include/mod_python.h.  There's a FAQ entry with the necessary
patch.

Maybe Grisha should release a 3.0.4 with just this one patch?

-Barry


From pu at vo.lu  Fri Sep 12 00:31:34 2003
From: pu at vo.lu (Patrick Useldinger)
Date: Fri Jan  9 22:04:11 2004
Subject: [mod_python] mod_python 3.1
In-Reply-To: <1063318854.19907.15.camel@anthem>
References: <oprvcui8zixiz7y9@smtp.vo.lu> <1063318854.19907.15.camel@anthem>
Message-ID: <oprvcwuwc2xiz7y9@smtp.vo.lu>

On 11 Sep 2003 18:20:54 -0400, Barry Warsaw <barry@python.org> wrote:

> modpython 3.0.3 works fine with Python 2.3, but to build it you need to
> hack src/include/mod_python.h.  There's a FAQ entry with the necessary
> patch.
>
> Maybe Grisha should release a 3.0.4 with just this one patch?

I have used the Windows binary version, as I have no C compiler. Releasing 
a binary version for Windows with this one change whould be great.
-PU
From barry at python.org  Thu Sep 11 19:41:19 2003
From: barry at python.org (Barry Warsaw)
Date: Fri Jan  9 22:04:11 2004
Subject: [mod_python] mod_python 3.1
In-Reply-To: <oprvcwuwc2xiz7y9@smtp.vo.lu>
References: <oprvcui8zixiz7y9@smtp.vo.lu> <1063318854.19907.15.camel@anthem>
	 <oprvcwuwc2xiz7y9@smtp.vo.lu>
Message-ID: <1063323679.19907.21.camel@anthem>

On Thu, 2003-09-11 at 18:31, Patrick Useldinger wrote:

> I have used the Windows binary version, as I have no C compiler. Releasing 
> a binary version for Windows with this one change whould be great.

I don't know anything about the Windows version, but AFAIK the only
problem with 3.0.3 and Python 2.3 is the definition of LONG_LONG that
got changed and that should only affect source builds.

-Barry


From grisha at modpython.org  Thu Sep 11 22:54:19 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 22:04:11 2004
Subject: [mod_python] mod_python 3.1
In-Reply-To: <1063318854.19907.15.camel@anthem>
References: <oprvcui8zixiz7y9@smtp.vo.lu> <1063318854.19907.15.camel@anthem>
Message-ID: <20030911224336.A81795@onyx.ispol.com>


On Thu, 11 Sep 2003, Barry Warsaw wrote:

> On Thu, 2003-09-11 at 17:41, Patrick Useldinger wrote:
> > I have read in the mailing list archives that only mod_python 3.1 and
> > higher will work with Python 2.3. Is this still correct? If so, when is
> > version 3.1 sheduled?
>
> modpython 3.0.3 works fine with Python 2.3, but to build it you need to
> hack src/include/mod_python.h.  There's a FAQ entry with the necessary
> patch.
>
> Maybe Grisha should release a 3.0.4 with just this one patch?

I'm not so sure that there aren't other bugs hiding in there.

Originally I wasn't planning on a 3.0.4 because 3.1 is going to be out
some time soon (whatever that means - we don't really have a schedule).
But we'll think about it. :-)

For right now my "official" take is that mod_python 3.0.3 was released
prior to Python 2.3 and so wasn't meant to be used with it.

Grisha
From partha at addlebrain.com  Thu Sep 11 21:11:27 2003
From: partha at addlebrain.com (Partha Aji)
Date: Fri Jan  9 22:04:11 2004
Subject: [mod_python] Can't load mod_python 3.03 in XP
Message-ID: <20030912041127.A4E1F3CEB@sitemail.everyone.net>

Here is  my configuration

Apache HTTP 2.0.47 - g:\apache\Apache2\
OS -> Win XP Home edition

Python Version ->2.3
TCL Version - > 8.4
Mod Python Version -> 3.0.3
Mod python installation file-> mod_python-3.0.3.win32.exe

I added the following line to httpd.conf 
LoadModule python_module modules/mod_python.so

(I have not been able to run the test yet..)

When I start apache I get the following error message
"
Syntax error on line 139 of G:/apache/Apache2/conf/httpd.conf:
Cannot load G:/apache/Apache2/modules/mod_python.so into server: The specified module could not be found.
Note the errors or messages above, and press the <ESC> key to exit.  25...
"

But when I take a peak at G:/apache/Apache2/modules/  directory I see the mod python file right there any ideas? Is mod python expected to run with python 2.3?
Should I compile mod python manually to fix this (I would rather not do so because I wouldn't know how to do it)? 
Any suggestions will be welcome.. Thanks

Partha


From benjamin-hepp at t-online.de  Fri Sep 12 08:28:38 2003
From: benjamin-hepp at t-online.de (Benjamin)
Date: Fri Jan  9 22:04:11 2004
Subject: [mod_python] Can't load mod_python 3.03 in XP
In-Reply-To: <20030912041127.A4E1F3CEB@sitemail.everyone.net>
Message-ID: <000201c378f7$1a0a3e40$0200a8c0@hebben>


> When I start apache I get the following error message
> "
> Syntax error on line 139 of G:/apache/Apache2/conf/httpd.conf:
> Cannot load G:/apache/Apache2/modules/mod_python.so into server:
> The specified module could not be found.
> Note the errors or messages above, and press the <ESC> key to exit.
25...
> "

As said before mod_python must be patched to work with python 2.3.
Or you just use python 2.2.

Benjamin

From andymorritt at rogers.com  Sat Sep 13 11:08:41 2003
From: andymorritt at rogers.com (Andrew)
Date: Fri Jan  9 22:04:11 2004
Subject: [mod_python] Mod Python 3 Error on Adding into Apache.
Message-ID: <3F6332F9.5050107@rogers.com>

I added mod Python into Apache 2 on Win2k with this line:

LoadModule python_module modules/mod_python.so

And when I try to restart the server it displays:

Syntax error on line 973 of D:/Program Files/Apache 
Group/Apache2/conf/httpd.con
f:
Cannot load D:/Program Files/Apache Group/Apache2/modules/mod_python.so 
into ser
ver: The specified module could not be found.

THe Wierd thing is, When I go to D:/Program Files/Apache 
Group/Apache2/modules/ in WIndows Explorer, I SEE the file mod_python.so.

And when I type into the Address bar D:/Program Files/Apache 
Group/Apache2/modules/mod_python.so, The File download comes up.

Also, I have Perl installed with LoadModule perl_module 
modules/mod_perl.so, so LoadMod. Works.

I googled the Archives for this, but could find nothing.

THanks in Advance
Andrew.

From stian at soiland.no  Sun Sep 14 23:56:03 2003
From: stian at soiland.no (Stian =?iso-8859-1?Q?S=F8iland?=)
Date: Fri Jan  9 22:04:11 2004
Subject: [mod_python] 
	Re: Handler publisher with multiple directories on the same tree
In-Reply-To: <3F5C826A.80404@ualg.pt>
References: <01c375fd$51705d80$926a1e6e@wsasd464> <3F5C826A.80404@ualg.pt>
Message-ID: <20030914215603.GD32114@itea.ntnu.no>

On 2003-09-08 15:21:46, Luis Sousa wrote:

> When I'm developing I usually have a common problem that is when I 
> change a class or some file, sometimes the interpreter remains in memory 
> the old version and doesn't load the new one. Is there a way to solve 
> this out ? Normally I use an non elegant way, I restart apache!

We all do the restart dance.. I even set up a port (1337) that restarted
apache on connections to it. 


-- 
Stian S?iland               Work toward win-win situation. Win-lose
Trondheim, Norway           is where you win and the other lose.
http://www.soiland.no/      Lose-lose and lose-win are left as an
                            exercise to the reader.  [Limoncelli/Hogan]

From stian at soiland.no  Sun Sep 14 23:58:27 2003
From: stian at soiland.no (Stian =?iso-8859-1?Q?S=F8iland?=)
Date: Fri Jan  9 22:04:11 2004
Subject: [mod_python] 
	Re: Handler publisher with multiple directories on 	thesame tree
In-Reply-To: <01c3760e$c26c4100$926a1e6e@wsasd464>
References: <01c3760e$c26c4100$926a1e6e@wsasd464>
Message-ID: <20030914215827.GE32114@itea.ntnu.no>

On 2003-09-08 15:40:26, Mike Looijmans wrote:

> My main handler checks if the path_info of the URL is "/request" and if so,
> runs the following (you could use publisher to publish this interface as
> well). All "my" modules are named "ops_" something. You could also use
> the __file__ location as a filter.

I tried that approach, but the problem is that modules must be reloaded
in "correct" order. For instance, a class in module A that subclasses
something from module B, will not work if A is reloaded before B.

(the A-class will be an instance of the OLD b-class)

The only thing that could work is to del the modules from sys.modules.
However, when I tried that, weird errors occured as if half the
mod_python request, sys, site, os etc. were removed.

Clearly some dirty C-pointer hangarounds or something..

-- 
Stian S?iland               Work toward win-win situation. Win-lose
Trondheim, Norway           is where you win and the other lose.
http://www.soiland.no/      Lose-lose and lose-win are left as an
                            exercise to the reader.  [Limoncelli/Hogan]

From grisha at modpython.org  Mon Sep 15 10:32:10 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 22:04:11 2004
Subject: [mod_python] Mod Python 3 Error on Adding into Apache.
In-Reply-To: <3F6332F9.5050107@rogers.com>
References: <3F6332F9.5050107@rogers.com>
Message-ID: <20030915102842.X28769@onyx.ispol.com>


This is typically a mismatch of mod_python.so and the version of Python
you have on your system.  For some reason windows says "module cannot be
found" whereas it really means "i had problems loading it".

The mod_python binary available from Apache sites should be compatible
with Python 2.2.x, but not 2.3.

Grisha

On Sat, 13 Sep 2003, Andrew wrote:

> I added mod Python into Apache 2 on Win2k with this line:
>
> LoadModule python_module modules/mod_python.so
>
> And when I try to restart the server it displays:
>
> Syntax error on line 973 of D:/Program Files/Apache
> Group/Apache2/conf/httpd.con
> f:
> Cannot load D:/Program Files/Apache Group/Apache2/modules/mod_python.so
> into ser
> ver: The specified module could not be found.
>
> THe Wierd thing is, When I go to D:/Program Files/Apache
> Group/Apache2/modules/ in WIndows Explorer, I SEE the file mod_python.so.
>
> And when I type into the Address bar D:/Program Files/Apache
> Group/Apache2/modules/mod_python.so, The File download comes up.
>
> Also, I have Perl installed with LoadModule perl_module
> modules/mod_perl.so, so LoadMod. Works.
>
> I googled the Archives for this, but could find nothing.
>
> THanks in Advance
> Andrew.
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From conrad at hep.caltech.edu  Tue Sep 16 19:31:24 2003
From: conrad at hep.caltech.edu (Conrad Steenberg)
Date: Fri Jan  9 22:04:11 2004
Subject: [mod_python] ANNOUNCE: Mod_python 3.1.0 Alpha
In-Reply-To: <20030910135538.GC3575@legolas.on.net.mk>
References: <20030828210644.C43921@onyx.ispol.com>
	<1062903891.2713.33.camel@Presario>
	<20030907180501.B83449@onyx.ispol.com>
	<20030910135538.GC3575@legolas.on.net.mk>
Message-ID: <1063733483.28941.53.camel@Presario>

Hi

Just to add a data point to the discussion: on redhat-7.3 the server
crashes if it cannot allocate enough semaphores. This is with
apache-2.0.47. And no, I can't change that because I'm not root on the
box :-(

Cheers

Conrad

On Wed, 2003-09-10 at 15:55, Damjan wrote:
> > > This prompts a change in the kernel semaphore settings on older linuxes
> > > (redhat 7.3 specifically).
> > 
> > Well - I think this is really a redhat problem. I believe I even saw
> > something reporting it as a security problem - it is very easy for someone
> > to deprive an rh box of available semaphores. I wonder what the default is
> > on rh 8 and 9 (anyone?).
> 
> Well I have Slackware-9+, and the defaults are not changed from the
> kernel defaults:
>     damjan$ cat /proc/sys/kernel/sem
>     250     32000   32      128
> 
> I'm using 
>     echo "512     32000   32      512" > /proc/sys/kernel/sem
> right now.
-- 
Conrad Steenberg <conrad@hep.caltech.edu>
-- 
Conrad Steenberg <conrad@hep.caltech.edu>
From greenbeard400 at yahoo.com  Wed Sep 17 21:42:47 2003
From: greenbeard400 at yahoo.com (Greenbeard)
Date: Fri Jan  9 22:04:11 2004
Subject: [mod_python] File upload
Message-ID: <20030918044247.89511.qmail@web21304.mail.yahoo.com>

Does anyone have a good file upload example?  

When I try something like: 

def upload(req, file):
    tempFile = file.read()
 
I get: AttributeError: File instance has no attribute
'read'

if I use:

    tempFile = req.form['file'] 
I get the file contents but I don't think this would
work well with large files (or would it?) 

Also, 
 
when I try to get attribues like file.type I get 

AttributeError: File instance has no attribute 'type'.
I do get the file.filename.   

So how can I tell if it should be a binary write etc.?

It looks like the publisher handler (which I am using)
returns a File object but I can not get it to act like
a file/StringIO object nor can I accesss the
attributes that are mentioned in the documentation.   


I am using W2k, Python 2.2  and Mod_py 3.0.3.  

Thanks for the help,

gb400



__________________________________
Do you Yahoo!?
Yahoo! SiteBuilder - Free, easy-to-use web site design software
http://sitebuilder.yahoo.com
From davidf at sjsoft.com  Thu Sep 18 09:47:24 2003
From: davidf at sjsoft.com (David Fraser)
Date: Fri Jan  9 22:04:11 2004
Subject: [mod_python] File upload
In-Reply-To: <20030918044247.89511.qmail@web21304.mail.yahoo.com>
References: <20030918044247.89511.qmail@web21304.mail.yahoo.com>
Message-ID: <3F69630C.2090403@sjsoft.com>

Greenbeard wrote:

>Does anyone have a good file upload example?  
>
>When I try something like: 
>
>def upload(req, file):
>    tempFile = file.read()
> 
>I get: AttributeError: File instance has no attribute
>'read'
>
>if I use:
>
>    tempFile = req.form['file'] 
>I get the file contents but I don't think this would
>work well with large files (or would it?) 
>
>Also, 
> 
>when I try to get attribues like file.type I get 
>
>AttributeError: File instance has no attribute 'type'.
>I do get the file.filename.   
>
>So how can I tell if it should be a binary write etc.?
>
>It looks like the publisher handler (which I am using)
>returns a File object but I can not get it to act like
>a file/StringIO object nor can I accesss the
>attributes that are mentioned in the documentation.   
>
>
>I am using W2k, Python 2.2  and Mod_py 3.0.3.  
>
>Thanks for the help,
>
>gb400
>
>
>
>__________________________________
>Do you Yahoo!?
>Yahoo! SiteBuilder - Free, easy-to-use web site design software
>http://sitebuilder.yahoo.com
>_______________________________________________
>Mod_python mailing list
>Mod_python@modpython.org
>http://mailman.modpython.org/mailman/listinfo/mod_python
>
>  
>
Don't know much about publisher, but a normal mod_python handler should 
be able to do something like this (totally untested code):

def handle(req):
  argdict = util.FieldStorage(req)
  for key in argdict.keys():
    value = argdict[key]
    if type(value) == types.InstanceType:
      if isinstance(value, util.StringField):
        # this is for a normal field...
        pass
      elif isinstance(value, util.Field):
        # this is for an attachment upload...
        filename = field.filename
        content_type = field.type
        # this will work by doing a read...
        contents = field.value
        # or you can do the read yourself:
        field.file.seek(0)
        contents = field.file.read()
        # reset the position so others can read it
        field.file.seek(0)



From mgomez at aditel.org  Thu Sep 18 10:04:57 2003
From: mgomez at aditel.org (Maria Gomez)
Date: Fri Jan  9 22:04:11 2004
Subject: [mod_python] File upload
In-Reply-To: <20030918044247.89511.qmail@web21304.mail.yahoo.com>
References: <20030918044247.89511.qmail@web21304.mail.yahoo.com>
Message-ID: <20030918080457.GA30620@aditel.org>

On Wed, Sep 17, 2003 at 09:42:47PM -0700, Greenbeard wrote:
> Does anyone have a good file upload example?  
> 
> When I try something like: 
> 
> def upload(req, file):
>     tempFile = file.read()
>  

   Hi,

   I use to do it as follows:

def CheckingUploadedFile(incoming):
    if incoming is None:
        return 0     # File is empty
    if type(incoming) is str:
        return 0     # File is a string
    return 1

def PrepareFile(file):
    """
        Copies uploaded file in a local directory (CACHE_DIR) and names
		it with its md5, whish is almost unique
    """
    aux = file.read()
    md5_n = "name_of_file"
    cache_file = "%s%s" % (cache_dir , md5_n)
    cache_fd = open(cache_file,'w')
    cache_fd.write(aux)
    cache_fd.close()
    return 1

def Upload(req,incoming):
    if CheckingUploadedFile(incoming):
        #Save file(incoming.file) in the proper directory
        PrepareFile(incoming.file)
		return 1
	else:
		print "There was an uploading error"


   To know more the updated structure of the file is:
['__del__', '__doc__', '__getattr__', '__init__', '__module__',
'__repr__', 'disposition', 'disposition_options', 'file', 'filename',
'headers', 'name', 'type', 'type_options']


    Cheers,

-- 
   Maria Gomez Marti - [octal]

=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*
   http://www.aditel.org/~mgomez
=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=*=* Linux, porque yo lo valgo 
From is83070 at cis.nctu.edu.tw  Thu Sep 18 17:21:01 2003
From: is83070 at cis.nctu.edu.tw (camge)
Date: Fri Jan  9 22:04:11 2004
Subject: [mod_python] [help]please give an input filter example ?
Message-ID: <007c01c37dc6$32d21050$db64a8c0@camgelo>

Hi ,

    I have written an output filter, and it works fine.
But I dont know how to write an input filter, there are not any examples.
I have tried to write an simple input filter according to an output filter.
But it always makes IE hang there.
If any one can give me an example about input filter?
Thanks a lot!

My environment:
  Apache/2.0.44 (Win32) 
  mod_ssl/2.0.44  
  OpenSSL/0.9.7 
  mod_python/3.0.3 
  Python/2.2.2 

Best regards,
camge
From is83070 at cis.nctu.edu.tw  Thu Sep 18 18:36:25 2003
From: is83070 at cis.nctu.edu.tw (camge)
Date: Fri Jan  9 22:04:11 2004
Subject: [mod_python] [help]please give an input filter example ?
References: <007c01c37dc6$32d21050$db64a8c0@camgelo>
	<3F69851B.3080703@sjsoft.com>
Message-ID: <009d01c37dd0$bc2c5f40$db64a8c0@camgelo>

Below is my simple input filter inputFilter.py:
-------------------------------------------------------------
def inputfilter(filter):
    f=open('filter.log','ab')#for debug
    data='start'
    while data!=None:
        try:
            data = filter.read()
            if data:
                filter.write(data)
                f.write(str(data))
        except Exception,e:
                f.write(str(e))
                data=None
     if data==None:
        filter.close()
     f.close()
----------------------------------------
httpd.conf:
----------------------------------------
<Location /test/>
     PythonInputFilter inputFilter MyInputFilter
     SetInputFilter MyInputFilter
</Location>


----- Original Message ----- 
From: "David Fraser" <davidf@sjsoft.com>
To: "camge" <is83070@cis.nctu.edu.tw>
Sent: Thursday, September 18, 2003 6:12 PM
Subject: Re: [mod_python] [help]please give an input filter example ?


> >camge wrote:
> >
> >Hi ,
> >
> >    I have written an output filter, and it works fine.
> >But I dont know how to write an input filter, there are not any examples.
> >I have tried to write an simple input filter according to an output
filter.
> >But it always makes IE hang there.
> >If any one can give me an example about input filter?
> >Thanks a lot!
> >
> >My environment:
> >  Apache/2.0.44 (Win32)
> >  mod_ssl/2.0.44
> >  OpenSSL/0.9.7
> >  mod_python/3.0.3
> >  Python/2.2.2
> >
> >Best regards,
> >camge
> >
> Why don't you send your example input filter that makes IE hang?
>
> Thanks
> David
>
>

From davidf at sjsoft.com  Thu Sep 18 13:05:19 2003
From: davidf at sjsoft.com (David Fraser)
Date: Fri Jan  9 22:04:11 2004
Subject: [mod_python] [help]please give an input filter example ?
In-Reply-To: <009d01c37dd0$bc2c5f40$db64a8c0@camgelo>
References: <007c01c37dc6$32d21050$db64a8c0@camgelo>
	<3F69851B.3080703@sjsoft.com> <009d01c37dd0$bc2c5f40$db64a8c0@camgelo>
Message-ID: <3F69916F.10406@sjsoft.com>

camge wrote:

>----- Original Message ----- 
>From: "David Fraser" <davidf@sjsoft.com>
>To: "camge" <is83070@cis.nctu.edu.tw>
>Sent: Thursday, September 18, 2003 6:12 PM
>Subject: Re: [mod_python] [help]please give an input filter example ?
>
>
>  
>
>>>camge wrote:
>>>
>>>Hi ,
>>>
>>>   I have written an output filter, and it works fine.
>>>But I dont know how to write an input filter, there are not any examples.
>>>I have tried to write an simple input filter according to an output
>>>      
>>>
>filter.
>  
>
>>>But it always makes IE hang there.
>>>If any one can give me an example about input filter?
>>>Thanks a lot!
>>>
>>>My environment:
>>> Apache/2.0.44 (Win32)
>>> mod_ssl/2.0.44
>>> OpenSSL/0.9.7
>>> mod_python/3.0.3
>>> Python/2.2.2
>>>
>>>Best regards,
>>>camge
>>>
>>>      
>>>
>>Why don't you send your example input filter that makes IE hang?
>>
>>Thanks
>>David
>>
>>
>>    
>>
>
>Below is my simple input filter inputFilter.py:
>-------------------------------------------------------------
>def inputfilter(filter):
>    f=open('filter.log','ab')#for debug
>    data='start'
>    while data!=None:
>        try:
>            data = filter.read()
>            if data:
>                filter.write(data)
>                f.write(str(data))
>        except Exception,e:
>                f.write(str(e))
>                data=None
>     if data==None:
>        filter.close()
>     f.close()
>----------------------------------------
>httpd.conf:
>----------------------------------------
><Location /test/>
>     PythonInputFilter inputFilter MyInputFilter
>     SetInputFilter MyInputFilter
></Location>
>
>
>  
>
Excuse me rearranging your post, bottom posting makes discussion easier...

I think the problem here is that you're doing filter.read() which will 
read until an end of file, which will never happen on an input filter.
You probably need a more intelligent way of working out when to stop 
reading, e.g. for HTTP, you could read a line at a time.
What are you wanting to use the input filter for?

David


From is83070 at cis.nctu.edu.tw  Thu Sep 18 21:32:47 2003
From: is83070 at cis.nctu.edu.tw (camge)
Date: Fri Jan  9 22:04:12 2004
Subject: [mod_python] [help]please give an input filter example ?
References: <007c01c37dc6$32d21050$db64a8c0@camgelo>
	<3F69851B.3080703@sjsoft.com> <009d01c37dd0$bc2c5f40$db64a8c0@camgelo>
	<3F69916F.10406@sjsoft.com>
Message-ID: <000e01c37de9$60cfd0f0$db64a8c0@camgelo>


----- Original Message ----- 
From: "David Fraser" <davidf@sjsoft.com>
To: "camge" <is83070@cis.nctu.edu.tw>
Cc: <mod_python@modpython.org>
Sent: Thursday, September 18, 2003 7:05 PM
Subject: Re: [mod_python] [help]please give an input filter example ?


> camge wrote:
>
> >----- Original Message ----- 
> >From: "David Fraser" <davidf@sjsoft.com>
> >To: "camge" <is83070@cis.nctu.edu.tw>
> >Sent: Thursday, September 18, 2003 6:12 PM
> >Subject: Re: [mod_python] [help]please give an input filter example ?
> >
> >
> >
> >
> >>>camge wrote:
> >>>
> >>>Hi ,
> >>>
> >>>   I have written an output filter, and it works fine.
> >>>But I dont know how to write an input filter, there are not any
examples.
> >>>I have tried to write an simple input filter according to an output
> >>>
> >>>
> >filter.
> >
> >
> >>>But it always makes IE hang there.
> >>>If any one can give me an example about input filter?
> >>>Thanks a lot!
> >>>
> >>>My environment:
> >>> Apache/2.0.44 (Win32)
> >>> mod_ssl/2.0.44
> >>> OpenSSL/0.9.7
> >>> mod_python/3.0.3
> >>> Python/2.2.2
> >>>
> >>>Best regards,
> >>>camge
> >>>
> >>>
> >>>
> >>Why don't you send your example input filter that makes IE hang?
> >>
> >>Thanks
> >>David
> >>
> >>
> >>
> >>
> >
> >Below is my simple input filter inputFilter.py:
> >-------------------------------------------------------------
> >def inputfilter(filter):
> >    f=open('filter.log','ab')#for debug
> >    data='start'
> >    while data!=None:
> >        try:
> >            data = filter.read()
> >            if data:
> >                filter.write(data)
> >                f.write(str(data))
> >        except Exception,e:
> >                f.write(str(e))
> >                data=None
> >     if data==None:
> >        filter.close()
> >     f.close()
> >----------------------------------------
> >httpd.conf:
> >----------------------------------------
> ><Location /test/>
> >     PythonInputFilter inputFilter MyInputFilter
> >     SetInputFilter MyInputFilter
> ></Location>
> >
> >
> >
> >
> Excuse me rearranging your post, bottom posting makes discussion easier...
>
> I think the problem here is that you're doing filter.read() which will
> read until an end of file, which will never happen on an input filter.
> You probably need a more intelligent way of working out when to stop
> reading, e.g. for HTTP, you could read a line at a time.
> What are you wanting to use the input filter for?
>
> David
>
>
>
Thanks for your fast response!
I have tried filter.readline(), but it still reads nothing.
I need input filter to convert character set of form data submitted by cell
phone browser.
For example, convert utf-8 to big5 or gb.
If I can do it in input filter, then I dont need to modify all of my pages.





From alentzos at cosmote.gr  Thu Sep 18 16:45:10 2003
From: alentzos at cosmote.gr (Lentzos Athanassios)
Date: Fri Jan  9 22:04:12 2004
Subject: [mod_python] Load python module problem
Message-ID: <4AEFA010DC6711478C8DA31039641A990142F7B9@AHRMAIL.cosmote.gr>



Hi

I have problem to load the mod_python( ver 3.0.3)  to apache (ver 2.0.47) I have done the configuration according to the instructions but i still
get the following error when i try to start apache server  < " Cannot load c:/program files/apache/apache2/modules/mod_python.so into server:The specified
module could not be found." > ,of course the file is there. /* I have installed Python 2.3  on my PC which runs NT os */  ....Please help!!


Lentzos  .P Athanassios (Greece, Athens)
E-mail	:   alentzos@cosmote.gr


-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mailman.modpython.org/pipermail/mod_python/attachments/20030918/007ef00b/attachment-0003.htm
From idiot1 at netzero.net  Thu Sep 18 12:11:42 2003
From: idiot1 at netzero.net (Kirk Bailey)
Date: Fri Jan  9 22:04:12 2004
Subject: [mod_python] File upload
In-Reply-To: <3F69630C.2090403@sjsoft.com>
References: <20030918044247.89511.qmail@web21304.mail.yahoo.com>
	<3F69630C.2090403@sjsoft.com>
Message-ID: <3F69D93E.8060100@netzero.net>

My wiki, wikinehesa, has a upload in it. Try downloading it, and read the form 
in the footer of the page generated by wikinehesaed1.py, and read the script 
wikinehesaed2.py to see how the thing handles doing an upload.

http://www.tinylist.org/

scan down to the OTHER STUFF section and there is the download for wikinehesa. 
To play with it, up by the top near the hit counter is a link to a working 
install of the wiki.

David Fraser wrote:

> Greenbeard wrote:
> 
>> Does anyone have a good file upload example? 
>> When I try something like:
>> def upload(req, file):
>>    tempFile = file.read()
>>
>> I get: AttributeError: File instance has no attribute
>> 'read'
>>
>> if I use:
>>
>>    tempFile = req.form['file'] I get the file contents but I don't 
>> think this would
>> work well with large files (or would it?)
>> Also,
>> when I try to get attribues like file.type I get
>> AttributeError: File instance has no attribute 'type'.
>> I do get the file.filename.  
>> So how can I tell if it should be a binary write etc.?
>>
>> It looks like the publisher handler (which I am using)
>> returns a File object but I can not get it to act like
>> a file/StringIO object nor can I accesss the
>> attributes that are mentioned in the documentation.  
>>
>> I am using W2k, Python 2.2  and Mod_py 3.0.3. 
>> Thanks for the help,
>>
>> gb400
>>
>>
>>
>> __________________________________
>> Do you Yahoo!?
>> Yahoo! SiteBuilder - Free, easy-to-use web site design software
>> http://sitebuilder.yahoo.com
>> _______________________________________________
>> Mod_python mailing list
>> Mod_python@modpython.org
>> http://mailman.modpython.org/mailman/listinfo/mod_python
>>
>>  
>>
> Don't know much about publisher, but a normal mod_python handler should 
> be able to do something like this (totally untested code):
> 
> def handle(req):
>  argdict = util.FieldStorage(req)
>  for key in argdict.keys():
>    value = argdict[key]
>    if type(value) == types.InstanceType:
>      if isinstance(value, util.StringField):
>        # this is for a normal field...
>        pass
>      elif isinstance(value, util.Field):
>        # this is for an attachment upload...
>        filename = field.filename
>        content_type = field.type
>        # this will work by doing a read...
>        contents = field.value
>        # or you can do the read yourself:
>        field.file.seek(0)
>        contents = field.file.read()
>        # reset the position so others can read it
>        field.file.seek(0)
> 
> 
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
> 
> 

-- 

-- 

end

Cheers!
         Kirk D Bailey

  +                              think                                +
   http://www.howlermonkey.net  +-----+        http://www.tinylist.org
   http://www.listville.net     | BOX |  http://www.sacredelectron.org
   Thou art free"-ERIS          +-----+     'Got a light?'-Prometheus
  +                              kniht                                +

Fnord.

From grisha at modpython.org  Thu Sep 18 11:09:25 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 22:04:12 2004
Subject: [mod_python] File upload
In-Reply-To: <20030918044247.89511.qmail@web21304.mail.yahoo.com>
References: <20030918044247.89511.qmail@web21304.mail.yahoo.com>
Message-ID: <20030918110558.I77494@onyx.ispol.com>


On Wed, 17 Sep 2003, Greenbeard wrote:

> Does anyone have a good file upload example?
>
> When I try something like:
>
> def upload(req, file):
>     tempFile = file.read()

I think it should be file.file.read(). You also may want to make sure that
it's a file upload first - you can do this by testing for existance of a
filename attribute, e.g. hasattr(file, "filename), or, more accurately,
you can make sure it's an instance of util.Field:

	if isinstance(file, util.Field):
		data = file.file.read()
	else:
		return "This is not a file"

Grisha
From davidf at sjsoft.com  Thu Sep 18 18:02:34 2003
From: davidf at sjsoft.com (David Fraser)
Date: Fri Jan  9 22:04:12 2004
Subject: [mod_python] [help]please give an input filter example ?
In-Reply-To: <000e01c37de9$60cfd0f0$db64a8c0@camgelo>
References: <007c01c37dc6$32d21050$db64a8c0@camgelo>
	<3F69851B.3080703@sjsoft.com> <009d01c37dd0$bc2c5f40$db64a8c0@camgelo>
	<3F69916F.10406@sjsoft.com> <000e01c37de9$60cfd0f0$db64a8c0@camgelo>
Message-ID: <3F69D71A.8080005@sjsoft.com>

camge wrote:

>----- Original Message ----- 
>From: "David Fraser" <davidf@sjsoft.com>
>To: "camge" <is83070@cis.nctu.edu.tw>
>Cc: <mod_python@modpython.org>
>Sent: Thursday, September 18, 2003 7:05 PM
>Subject: Re: [mod_python] [help]please give an input filter example ?
>
>
>  
>
>>camge wrote:
>>
>>    
>>
>>>----- Original Message ----- 
>>>From: "David Fraser" <davidf@sjsoft.com>
>>>To: "camge" <is83070@cis.nctu.edu.tw>
>>>Sent: Thursday, September 18, 2003 6:12 PM
>>>Subject: Re: [mod_python] [help]please give an input filter example ?
>>>
>>>
>>>
>>>
>>>      
>>>
>>>>>camge wrote:
>>>>>
>>>>>Hi ,
>>>>>
>>>>>  I have written an output filter, and it works fine.
>>>>>But I dont know how to write an input filter, there are not any
>>>>>          
>>>>>
>examples.
>  
>
>>>>>I have tried to write an simple input filter according to an output
>>>>>
>>>>>
>>>>>          
>>>>>
>>>filter.
>>>
>>>
>>>      
>>>
>>>>>But it always makes IE hang there.
>>>>>If any one can give me an example about input filter?
>>>>>Thanks a lot!
>>>>>
>>>>>My environment:
>>>>>Apache/2.0.44 (Win32)
>>>>>mod_ssl/2.0.44
>>>>>OpenSSL/0.9.7
>>>>>mod_python/3.0.3
>>>>>Python/2.2.2
>>>>>
>>>>>Best regards,
>>>>>camge
>>>>>
>>>>>
>>>>>
>>>>>          
>>>>>
>>>>Why don't you send your example input filter that makes IE hang?
>>>>
>>>>Thanks
>>>>David
>>>>
>>>>
>>>>
>>>>
>>>>        
>>>>
>>>Below is my simple input filter inputFilter.py:
>>>-------------------------------------------------------------
>>>def inputfilter(filter):
>>>   f=open('filter.log','ab')#for debug
>>>   data='start'
>>>   while data!=None:
>>>       try:
>>>           data = filter.read()
>>>           if data:
>>>               filter.write(data)
>>>               f.write(str(data))
>>>       except Exception,e:
>>>               f.write(str(e))
>>>               data=None
>>>    if data==None:
>>>       filter.close()
>>>    f.close()
>>>----------------------------------------
>>>httpd.conf:
>>>----------------------------------------
>>><Location /test/>
>>>    PythonInputFilter inputFilter MyInputFilter
>>>    SetInputFilter MyInputFilter
>>></Location>
>>>
>>>
>>>
>>>
>>>      
>>>
>>Excuse me rearranging your post, bottom posting makes discussion easier...
>>
>>I think the problem here is that you're doing filter.read() which will
>>read until an end of file, which will never happen on an input filter.
>>You probably need a more intelligent way of working out when to stop
>>reading, e.g. for HTTP, you could read a line at a time.
>>What are you wanting to use the input filter for?
>>
>>David
>>
>>
>>
>>    
>>
>Thanks for your fast response!
>I have tried filter.readline(), but it still reads nothing.
>  
>
That's a pleasure. OK, I don't really know anything about input filters, 
I was just pretending... maybe some else can help

>I need input filter to convert character set of form data submitted by cell
>phone browser.
>For example, convert utf-8 to big5 or gb.
>If I can do it in input filter, then I dont need to modify all of my pages.
>  
>
Aha. What I would do is just put a function in a module that changes the 
encoding.
Get the arguments like you normally would, then just do a decode/encode.
Since that module can be accessed from anywhere, it will work just as well.
Also, it's less likely to cause bugs, and will probably be faster 
(you'll only making one jump into the Python interpreter and back)

Cheers
David


From sgillies at frii.com  Thu Sep 18 12:10:07 2003
From: sgillies at frii.com (Sean Gillies)
Date: Fri Jan  9 22:04:12 2004
Subject: [mod_python] 
	UnicodeEncodeError using mod_python-3.0.3 with Python 2.3
Message-ID: <55E7BB6E-EA03-11D7-9809-000393B98B56@frii.com>

Hi,

I'm running into problems with UnicodeEncodeErrors using  
mod_python-3.0.3 with
Python 2.3 on OS X.  Yes, I know I'm asking for trouble with this  
combination,
but I'm leery of replacing Apple's Python 2.2 (which doesn't work with  
mod_python).
All in all, my application is working, but will eventually (and  
unpredictably)
stop and raise this error:

Mod_python error: "PythonHandler mod_python.publisher"

Traceback (most recent call last):

   File  
"/Library/Frameworks/Python.framework/Versions/2.3/lib/python2.3/site- 
packages/mod_python/apache.py", line 332, in HandlerDispatch
     result = object(req)

   File  
"/Library/Frameworks/Python.framework/Versions/2.3/lib/python2.3/site- 
packages/mod_python/publisher.py", line 201, in handler
     result = str(result)

UnicodeEncodeError: 'ascii' codec can't encode character '\u3137' in  
position 412: ordinal not in range(128)

Anybody else using Python 2.3 who has seen this?  I really don't  
understand the error,
it's always '\u3137', and I'm _not_ (to my knowledge) using any unicode  
strings.  I am
using Zope's Page Templates, but I don't see where the page templates  
would be introducing
'\u3137' (the hangul letter tikeut?!).

My module is published with no problems on Linux (KRUD) with  
mod_python-3.0.1 and
Python 2.2.3, so I'm presently living with this problem on my notebook  
and counting
on its absence on the server.

Sean

--
Sean Gillies
sgillies at frii dot com
http://www.frii.com/~sgillies

From perry.tew at cibavision.novartis.com  Thu Sep 18 15:50:04 2003
From: perry.tew at cibavision.novartis.com (perry.tew@cibavision.novartis.com)
Date: Fri Jan  9 22:04:12 2004
Subject: [mod_python] 
	does a mod_python handler exist to generate charts/graphs? (png
	images)
Message-ID: <OF62DF2337.F24A4A42-ON85256DA5.006CA077-85256DA5.006CF44A@EU.novartis.net>

Hello everyone,
   I was about the go down the road of developing a handler to generate 
charts,
similar to the mod_perl Apache::GD::Graph.  I wanted to make sure 
something doesn't exist
before I reinvent the wheel.  Does anyone know of such a thing yet?  If 
so, would you please
provide a url?

Thanks,
Perry Tew
From davidf at sjsoft.com  Thu Sep 18 22:25:46 2003
From: davidf at sjsoft.com (David Fraser)
Date: Fri Jan  9 22:04:12 2004
Subject: [mod_python] 	UnicodeEncodeError using mod_python-3.0.3 with
	Python 2.3
In-Reply-To: <55E7BB6E-EA03-11D7-9809-000393B98B56@frii.com>
References: <55E7BB6E-EA03-11D7-9809-000393B98B56@frii.com>
Message-ID: <3F6A14CA.9030008@sjsoft.com>

Sean Gillies wrote:

> Hi,
>
> I'm running into problems with UnicodeEncodeErrors using  
> mod_python-3.0.3 with
> Python 2.3 on OS X.  Yes, I know I'm asking for trouble with this  
> combination,
> but I'm leery of replacing Apple's Python 2.2 (which doesn't work 
> with  mod_python).
> All in all, my application is working, but will eventually (and  
> unpredictably)
> stop and raise this error:
>
> Mod_python error: "PythonHandler mod_python.publisher"
>
> Traceback (most recent call last):
>
>   File  
> "/Library/Frameworks/Python.framework/Versions/2.3/lib/python2.3/site- 
> packages/mod_python/apache.py", line 332, in HandlerDispatch
>     result = object(req)
>
>   File  
> "/Library/Frameworks/Python.framework/Versions/2.3/lib/python2.3/site- 
> packages/mod_python/publisher.py", line 201, in handler
>     result = str(result)
>
> UnicodeEncodeError: 'ascii' codec can't encode character '\u3137' in  
> position 412: ordinal not in range(128)
>
> Anybody else using Python 2.3 who has seen this?  I really don't  
> understand the error,
> it's always '\u3137', and I'm _not_ (to my knowledge) using any 
> unicode  strings.  I am
> using Zope's Page Templates, but I don't see where the page templates  
> would be introducing
> '\u3137' (the hangul letter tikeut?!).
>
> My module is published with no problems on Linux (KRUD) with  
> mod_python-3.0.1 and
> Python 2.2.3, so I'm presently living with this problem on my 
> notebook  and counting
> on its absence on the server.
>
> Sean
>
> -- 

Try doing things like:
  if type(result) == unicode:
    result = result.encode('iso8859')
You can look up different encodings in the encodings module. The above 
works well for me...
I think you should be able to get the browser's desired encodings from 
the headers sent to the request.

Hope that helps
David


From davidf at sjsoft.com  Thu Sep 18 22:27:29 2003
From: davidf at sjsoft.com (David Fraser)
Date: Fri Jan  9 22:04:12 2004
Subject: [mod_python] 	does a mod_python handler exist to generate
	charts/graphs? (png	images)
In-Reply-To: <OF62DF2337.F24A4A42-ON85256DA5.006CA077-85256DA5.006CF44A@EU.novartis.net>
References: <OF62DF2337.F24A4A42-ON85256DA5.006CA077-85256DA5.006CF44A@EU.novartis.net>
Message-ID: <3F6A1531.5050609@sjsoft.com>

perry.tew@cibavision.novartis.com wrote:

>Hello everyone,
>   I was about the go down the road of developing a handler to generate 
>charts,
>similar to the mod_perl Apache::GD::Graph.  I wanted to make sure 
>something doesn't exist
>before I reinvent the wheel.  Does anyone know of such a thing yet?  If 
>so, would you please
>provide a url?
>
>Thanks,
>Perry Tew
>
There are several Python graphing packages which you could use towards 
this end, the question is how nicely will they plug into a web environment.
I am not aware of any that are set up to do this using mod_python.
I'm also busy looking at the problem, for an application we are 
currently converting to be web based, so discuss plans / things you find 
here and I will to and hopefully we can come up with a nice solution...

Thanks,
David


From perry.tew at cibavision.novartis.com  Thu Sep 18 16:38:09 2003
From: perry.tew at cibavision.novartis.com (perry.tew@cibavision.novartis.com)
Date: Fri Jan  9 22:04:12 2004
Subject: [mod_python] 	does a mod_python handler exist to generate
	charts/graphs? (png	images)
Message-ID: <OF3D2E11CE.51A41DD0-ON85256DA5.0070BC96-85256DA5.00715B65@EU.novartis.net>

David,
  Thanks for the information.  I was looking at using pygdchart2 from 
nullcube.  I was pleased with the interface they've written.  Have you any 
experience with them?  I figured it shouldn't be technically difficult to 
create an interface of parameters that mapped to chart settings.

The only concern I have so far is the method of outputting the chart once 
rendered.  The examples use the draw method:
"""
 chart.draw(filespec)
Draw the graph to the specified file. If the filespec argument is a 
string, it will be treated as the path to a file. Otherwise, filespec is 
assumed to be a Python file object.
"""

I'm new to mod_python, so I'm not sure how to pass the output stream of 
the request object to the draw() method.  If you know, I'm be grateful. If 
not, I'll work at it.  I haven't really dug yet.

btw,   I saw your post earlier about your wiki.  While cruising your site 
I found a MLM I was in need for.  Thanks!

Perry Tew



perry.tew@cibavision.novartis.com wrote:

>Hello everyone,
>   I was about the go down the road of developing a handler to generate 
>charts,
>similar to the mod_perl Apache::GD::Graph.  I wanted to make sure 
>something doesn't exist
>before I reinvent the wheel.  Does anyone know of such a thing yet?  If 
>so, would you please
>provide a url?
>
>Thanks,
>Perry Tew
>
There are several Python graphing packages which you could use towards 
this end, the question is how nicely will they plug into a web 
environment.
I am not aware of any that are set up to do this using mod_python.
I'm also busy looking at the problem, for an application we are 
currently converting to be web based, so discuss plans / things you find 
here and I will to and hopefully we can come up with a nice solution...

Thanks,
David





From davidf at sjsoft.com  Thu Sep 18 22:45:25 2003
From: davidf at sjsoft.com (David Fraser)
Date: Fri Jan  9 22:04:12 2004
Subject: [mod_python] 	does a mod_python handler exist to generate
	charts/graphs? (png	images)
In-Reply-To: <OF3D2E11CE.51A41DD0-ON85256DA5.0070BC96-85256DA5.00715B65@EU.novartis.net>
References: <OF3D2E11CE.51A41DD0-ON85256DA5.0070BC96-85256DA5.00715B65@EU.novartis.net>
Message-ID: <3F6A1965.2040506@sjsoft.com>

perry.tew@cibavision.novartis.com wrote:

>>perry.tew@cibavision.novartis.com wrote:
>>
>>>Hello everyone,
>>>  I was about the go down the road of developing a handler to generate 
>>>charts,
>>>similar to the mod_perl Apache::GD::Graph.  I wanted to make sure 
>>>something doesn't exist
>>>before I reinvent the wheel.  Does anyone know of such a thing yet?  If 
>>>so, would you please
>>>provide a url?
>>>
>>>Thanks,
>>>Perry Tew
>>
>> There are several Python graphing packages which you could use towards
>>
>>this end, the question is how nicely will they plug into a web 
>>environment.
>>I am not aware of any that are set up to do this using mod_python.
>>I'm also busy looking at the problem, for an application we are 
>>currently converting to be web based, so discuss plans / things you find 
>>here and I will to and hopefully we can come up with a nice solution...
>>
>>Thanks,
>>David
>>
>
>David,
>  Thanks for the information.  I was looking at using pygdchart2 from 
>nullcube.  I was pleased with the interface they've written.  Have you any 
>experience with them?  I figured it shouldn't be technically difficult to 
>create an interface of parameters that mapped to chart settings.
>  
>
I haven't had, but will look at it, do you have a URL?

>The only concern I have so far is the method of outputting the chart once 
>rendered.  The examples use the draw method:
>"""
> chart.draw(filespec)
>Draw the graph to the specified file. If the filespec argument is a 
>string, it will be treated as the path to a file. Otherwise, filespec is 
>assumed to be a Python file object.
>"""
>
>I'm new to mod_python, so I'm not sure how to pass the output stream of 
>the request object to the draw() method.  If you know, I'm be grateful. If 
>not, I'll work at it.  I haven't really dug yet.
>  
>
This kind of thing is pretty simple, you can either create a 
StringIO.StringIO object (standard Python) which is a pseudo-file that 
you can get the contents out of using a string, or you could try passing 
the request object (at the appropriate time) and see if it will work 
writing to that.
Another option (assuming the project is open source) is to alter the 
program to support returning the data in a string.
I got the reportlab guys to do this - their project is mainly focussed 
on Reports and PDF, but it also has charting capabilities I haven't 
investigated.
The other charting toolkit I am aware of is Chaco.

I think it would be good to investigate all of them and at least draw up 
a list of their strengths/weaknesses for use in a web server context, 
that might be helpful to other users. Would be good to have a list of 
requirements to evaluate these packages by e.g. how big the package is, 
able to produce different image formats, etc.

>btw,   I saw your post earlier about your wiki.  While cruising your site 
>I found a MLM I was in need for.  Thanks!
>  
>
Sure, but I think it was somebody else replying to my message, I don't 
have a wiki...

>Perry Tew
>  
>
David

PS hope you don't mind me rearranging your post, bottom-posting makes 
the flow easier to see.

From davidf at sjsoft.com  Thu Sep 18 22:49:35 2003
From: davidf at sjsoft.com (David Fraser)
Date: Fri Jan  9 22:04:12 2004
Subject: [mod_python]  does a mod_python handler exist to generate
	charts/graphs? (png images)
In-Reply-To: <Pine.LNX.4.44.0309181636440.1176-100000@q.cis.uoguelph.ca>
References: <Pine.LNX.4.44.0309181636440.1176-100000@q.cis.uoguelph.ca>
Message-ID: <3F6A1A5F.9000703@sjsoft.com>

Stefan C. Kremer wrote:

>You might want to check out:
>
>http://gnuplot-py.sourceforge.net/
>
>and consider interfacing it with mod_python.  I've used it with python and 
>been very happy (though I really like gnuplot to start with, so I'm 
>biased), but have not used it with mod_python.
>
>	Stefan
>  
>
Thanks Stefan, we'll add it to the list...
David

>On Thu, 18 Sep 2003, David Fraser wrote:
>
>  
>
>>perry.tew@cibavision.novartis.com wrote:
>>
>>    
>>
>>>Hello everyone,
>>>  I was about the go down the road of developing a handler to generate 
>>>charts,
>>>similar to the mod_perl Apache::GD::Graph.  I wanted to make sure 
>>>something doesn't exist
>>>before I reinvent the wheel.  Does anyone know of such a thing yet?  If 
>>>so, would you please
>>>provide a url?
>>>
>>>Thanks,
>>>Perry Tew
>>>
>>>      
>>>
>>There are several Python graphing packages which you could use towards 
>>this end, the question is how nicely will they plug into a web environment.
>>I am not aware of any that are set up to do this using mod_python.
>>I'm also busy looking at the problem, for an application we are 
>>currently converting to be web based, so discuss plans / things you find 
>>here and I will to and hopefully we can come up with a nice solution...
>>
>>Thanks,
>>David
>>
>>
>>_______________________________________________
>>Mod_python mailing list
>>Mod_python@modpython.org
>>http://mailman.modpython.org/mailman/listinfo/mod_python
>>
>>    
>>
>
>  
>


From sgillies at frii.com  Thu Sep 18 15:45:32 2003
From: sgillies at frii.com (Sean Gillies)
Date: Fri Jan  9 22:04:12 2004
Subject: [mod_python] 	UnicodeEncodeError using mod_python-3.0.3 with
	Python 2.3
In-Reply-To: <3F6A14CA.9030008@sjsoft.com>
Message-ID: <6D706C13-EA21-11D7-874F-000393B98B56@frii.com>

On Thursday, September 18, 2003, at 02:25  PM, David Fraser wrote:

> Sean Gillies wrote:
>
>> Hi,
>>
>> I'm running into problems with UnicodeEncodeErrors using   
>> mod_python-3.0.3 with
>> Python 2.3 on OS X.  Yes, I know I'm asking for trouble with this   
>> combination,
>> but I'm leery of replacing Apple's Python 2.2 (which doesn't work  
>> with  mod_python).
>> All in all, my application is working, but will eventually (and   
>> unpredictably)
>> stop and raise this error:
>>
>> Mod_python error: "PythonHandler mod_python.publisher"
>>
>> Traceback (most recent call last):
>>
>>   File   
>> "/Library/Frameworks/Python.framework/Versions/2.3/lib/python2.3/ 
>> site- packages/mod_python/apache.py", line 332, in HandlerDispatch
>>     result = object(req)
>>
>>   File   
>> "/Library/Frameworks/Python.framework/Versions/2.3/lib/python2.3/ 
>> site- packages/mod_python/publisher.py", line 201, in handler
>>     result = str(result)
>>
>> UnicodeEncodeError: 'ascii' codec can't encode character '\u3137' in   
>> position 412: ordinal not in range(128)
>>
>> Anybody else using Python 2.3 who has seen this?  I really don't   
>> understand the error,
>> it's always '\u3137', and I'm _not_ (to my knowledge) using any  
>> unicode  strings.  I am
>> using Zope's Page Templates, but I don't see where the page templates  
>>  would be introducing
>> '\u3137' (the hangul letter tikeut?!).
>>
>> My module is published with no problems on Linux (KRUD) with   
>> mod_python-3.0.1 and
>> Python 2.2.3, so I'm presently living with this problem on my  
>> notebook  and counting
>> on its absence on the server.
>>
>> Sean
>>
>> -- 
>
> Try doing things like:
>  if type(result) == unicode:
>    result = result.encode('iso8859')
> You can look up different encodings in the encodings module. The above  
> works well for me...
> I think you should be able to get the browser's desired encodings from  
> the headers sent to the request.
>
> Hope that helps
> David
>

David,

Thanks for the suggestion.  The Zope page template's __call__ method
does indeed return unicode and I've made your change to publisher.py.
Working good.  I also thought about catching the UnicodeEncodeError
like

     if result:
         try:
             result = str(result)
         except UnicodeEncodeError:
             result = str(result.encode('iso8859'))

since str(result) wasn't raising an error every time.

cheers,
Sean

--
Sean Gillies
sgillies at frii dot com
http://www.frii.com/~sgillies

From is83070 at cis.nctu.edu.tw  Fri Sep 19 11:09:14 2003
From: is83070 at cis.nctu.edu.tw (camge)
Date: Fri Jan  9 22:04:12 2004
Subject: [mod_python] [help]please give an input filter example ?
References: <007c01c37dc6$32d21050$db64a8c0@camgelo>
	<3F69851B.3080703@sjsoft.com> <009d01c37dd0$bc2c5f40$db64a8c0@camgelo>
	<3F69916F.10406@sjsoft.com> <000e01c37de9$60cfd0f0$db64a8c0@camgelo>
	<3F69D71A.8080005@sjsoft.com>
Message-ID: <002c01c37e5b$71210920$db64a8c0@camgelo>

> >I need input filter to convert character set of form data submitted by
cell
> >phone browser.
> >For example, convert utf-8 to big5 or gb.
> >If I can do it in input filter, then I dont need to modify all of my
pages.
> >
> >
> Aha. What I would do is just put a function in a module that changes the
> encoding.
> Get the arguments like you normally would, then just do a decode/encode.
> Since that module can be accessed from anywhere, it will work just as
well.
> Also, it's less likely to cause bugs, and will probably be faster
> (you'll only making one jump into the Python interpreter and back)
>
> Cheers
> David
>
Thanks for your suggestion!
But my web server serve not only wap browser but also Pocket IE and IE,
and they all use same module(for easy maintenance).
Adding this function in these modules will be a terrible thing,
because I dont need to convert character encoding for Pocket IE and IE.

If I can do it in input filter, I don't need to modify any things in
original module.

regards,
camge


From alentzos at cosmote.gr  Fri Sep 19 13:44:32 2003
From: alentzos at cosmote.gr (Lentzos Athanassios)
Date: Fri Jan  9 22:04:12 2004
Subject: =?iso-8859-7?Q?=D0=D1=3A_=5Bmod=5Fpython=5D_Load_python_module_problem?=
Message-ID: <4AEFA010DC6711478C8DA31039641A990149D2BD@AHRMAIL.cosmote.gr>

Skipped content of type multipart/alternative-------------- next part --------------
_______________________________________________
Mod_python mailing list
Mod_python@modpython.org
http://mailman.modpython.org/mailman/listinfo/mod_python
From perry.tew at cibavision.novartis.com  Fri Sep 19 09:59:35 2003
From: perry.tew at cibavision.novartis.com (perry.tew@cibavision.novartis.com)
Date: Fri Jan  9 22:04:12 2004
Subject: [mod_python] 	does a mod_python handler exist to generate
	charts/graphs? (png	images)
Message-ID: <OFACFE0A3B.CBD0AC18-ON85256DA6.004B1817-85256DA6.004CDDEC@EU.novartis.net>

David,
   Thanks for the input.  I'll add chaco and gnuplot.py to the list.  So 
far I have (in no order):

reportlab
pygdchart
chaco
gnuplot

I'll have to start investigating each of them.  chaco and gnuplot appear 
to have massive options and functionality.


In response to your earlier suggestions:
"""
This kind of thing is pretty simple, you can either create a 
StringIO.StringIO object (standard Python) which is a pseudo-file that 
you can get the contents out of using a string, or you could try passing 
the request object (at the appropriate time) and see if it will work 
writing to that.
Another option (assuming the project is open source) is to alter the 
program to support returning the data in a string.
I got the reportlab guys to do this - their project is mainly focussed 
on Reports and PDF, but it also has charting capabilities I haven't 
investigated.
"""

I tried to use the StringIO object from both StringIO and cStringIO.  The 
library didn't like
that at all.  I traced some of the pygdchart code.  It drops down into C 
and calls the following code (from _gdchartc.c)
( I stripped out some unnecessary lines):
PyObject *pfile, *labels, *data, *combodata;
FILE *fp;
...
if (!PyArg_ParseTuple(args, "iiO!iiOiOO", &width, &height, &PyFile_Type, 
&pfile, 
...
fp = PyFile_AsFile(pfile);

I so new to python it hurts, but I'm guessing that at this point in a C 
program, pfile has to be an
actual pointer to a file and not a file-like interface such as StringIO? 
Any experience with this?

As for having the author change the interface, I've already emailed them. 
Later on I found
the cStringIO functionality listed in a TODO file for the pygdchart 
library.  Guess I'm not the first...
I don't know how possible it would be to use cStringIO, since the FILE 
pointer is passed through a mess of C libraries

gdchart -> gd -> libjpeg

The functions all the way down to libjpeg are wanting a pointer to a FILE 
structure.   My other thought was
looking for a way to imitate the FILE pointer in memory and modifying the 
entry C code to return back the
in memory data as a binary stream.  I'll have to look into that as well. 
My C is pretty weak as well.  I'm
so thankful there's Google.

As a workaround, here's what I did (using os.tmpfile):

from mod_python import apache
from mod_python import util
import gdchart
import os

def handler(req):
        req.content_type = "image/png"

        chart = gdchart.Line3D()
        chart.width = 250
        chart.height = 250
        chart.xtitle = "xtitle goes here"
        chart.ytitle = "Percentage"
        chart.title = "Example Graph"
        chart.ext_color = [ "white", "yellow", "red", "blue", "green"]
        chart.setData([20, 100, 80, 30, 50],[10,150,20,25,65])
        chart.setLabels(["Mon", "Tue", "Wed", "Thu", "Fri"])
        chart.setLabels(["Mon", "Tue", "Wed", "Thu", "Fri"])

        f = os.tmpfile()
        chart.draw(f)
        f.seek(0)
        req.write(f.read())
        f.close()

        return apache.OK

It outputs a graph for me.    Here's another question that may be 
better suited for comp.lang.python, but do you know if
os.tmpfile() uses an in-memory representation of a file
or does it use a physical file that just remains anonymous?  I'm 
concerned about the wasteful loss of speed having to write to
disk and read it back.

Well, enough rambling.  Thanks for your time,
Perry Tew












David Fraser <davidf@sjsoft.com>
09/18/2003 04:45 PM

 
        To:     Perry Tew/CV/Novartis@PH
        cc:     mod_python@modpython.org
        Subject:        Re: [mod_python]        does a mod_python handler exist to generate 
charts/graphs? (png     images)


perry.tew@cibavision.novartis.com wrote:

>>perry.tew@cibavision.novartis.com wrote:
>>
>>>Hello everyone,
>>>  I was about the go down the road of developing a handler to generate 
>>>charts,
>>>similar to the mod_perl Apache::GD::Graph.  I wanted to make sure 
>>>something doesn't exist
>>>before I reinvent the wheel.  Does anyone know of such a thing yet?  If 

>>>so, would you please
>>>provide a url?
>>>
>>>Thanks,
>>>Perry Tew
>>
>> There are several Python graphing packages which you could use towards
>>
>>this end, the question is how nicely will they plug into a web 
>>environment.
>>I am not aware of any that are set up to do this using mod_python.
>>I'm also busy looking at the problem, for an application we are 
>>currently converting to be web based, so discuss plans / things you find 

>>here and I will to and hopefully we can come up with a nice solution...
>>
>>Thanks,
>>David
>>
>
>David,
>  Thanks for the information.  I was looking at using pygdchart2 from 
>nullcube.  I was pleased with the interface they've written.  Have you 
any 
>experience with them?  I figured it shouldn't be technically difficult to 

>create an interface of parameters that mapped to chart settings.
> 
>
I haven't had, but will look at it, do you have a URL?

>The only concern I have so far is the method of outputting the chart once 

>rendered.  The examples use the draw method:
>"""
> chart.draw(filespec)
>Draw the graph to the specified file. If the filespec argument is a 
>string, it will be treated as the path to a file. Otherwise, filespec is 
>assumed to be a Python file object.
>"""
>
>I'm new to mod_python, so I'm not sure how to pass the output stream of 
>the request object to the draw() method.  If you know, I'm be grateful. 
If 
>not, I'll work at it.  I haven't really dug yet.
> 
>
This kind of thing is pretty simple, you can either create a 
StringIO.StringIO object (standard Python) which is a pseudo-file that 
you can get the contents out of using a string, or you could try passing 
the request object (at the appropriate time) and see if it will work 
writing to that.
Another option (assuming the project is open source) is to alter the 
program to support returning the data in a string.
I got the reportlab guys to do this - their project is mainly focussed 
on Reports and PDF, but it also has charting capabilities I haven't 
investigated.
The other charting toolkit I am aware of is Chaco.

I think it would be good to investigate all of them and at least draw up 
a list of their strengths/weaknesses for use in a web server context, 
that might be helpful to other users. Would be good to have a list of 
requirements to evaluate these packages by e.g. how big the package is, 
able to produce different image formats, etc.

>btw,   I saw your post earlier about your wiki.  While cruising your site 

>I found a MLM I was in need for.  Thanks!
> 
>
Sure, but I think it was somebody else replying to my message, I don't 
have a wiki...

>Perry Tew
> 
>
David

PS hope you don't mind me rearranging your post, bottom-posting makes 
the flow easier to see.




From davidf at sjsoft.com  Fri Sep 19 16:18:16 2003
From: davidf at sjsoft.com (David Fraser)
Date: Fri Jan  9 22:04:12 2004
Subject: [mod_python] 	does a mod_python handler exist to generate
	charts/graphs? (png	images)
In-Reply-To: <OFACFE0A3B.CBD0AC18-ON85256DA6.004B1817-85256DA6.004CDDEC@EU.novartis.net>
References: <OFACFE0A3B.CBD0AC18-ON85256DA6.004B1817-85256DA6.004CDDEC@EU.novartis.net>
Message-ID: <3F6B1028.3040101@sjsoft.com>

perry.tew@cibavision.novartis.com wrote:

>David,
>   Thanks for the input.  I'll add chaco and gnuplot.py to the list.  So 
>far I have (in no order):
>
>reportlab
>pygdchart
>chaco
>gnuplot
>
>I'll have to start investigating each of them.  chaco and gnuplot appear 
>to have massive options and functionality.
>  
>
Great. I'm away for the next few days so it'll be interesting to see 
what you find.

>
>In response to your earlier suggestions:
>"""
>This kind of thing is pretty simple, you can either create a 
>StringIO.StringIO object (standard Python) which is a pseudo-file that 
>you can get the contents out of using a string, or you could try passing 
>the request object (at the appropriate time) and see if it will work 
>writing to that.
>Another option (assuming the project is open source) is to alter the 
>program to support returning the data in a string.
>I got the reportlab guys to do this - their project is mainly focussed 
>on Reports and PDF, but it also has charting capabilities I haven't 
>investigated.
>"""
>
>I tried to use the StringIO object from both StringIO and cStringIO.  The 
>library didn't like
>that at all.  I traced some of the pygdchart code.  It drops down into C 
>and calls the following code (from _gdchartc.c)
>( I stripped out some unnecessary lines):
>PyObject *pfile, *labels, *data, *combodata;
>FILE *fp;
>...
>if (!PyArg_ParseTuple(args, "iiO!iiOiOO", &width, &height, &PyFile_Type, 
>&pfile, 
>...
>fp = PyFile_AsFile(pfile);
>
>I so new to python it hurts, but I'm guessing that at this point in a C 
>program, pfile has to be an
>actual pointer to a file and not a file-like interface such as StringIO? 
>Any experience with this?
>
>As for having the author change the interface, I've already emailed them. 
>Later on I found
>the cStringIO functionality listed in a TODO file for the pygdchart 
>library.  Guess I'm not the first...
>I don't know how possible it would be to use cStringIO, since the FILE 
>pointer is passed through a mess of C libraries
>
>gdchart -> gd -> libjpeg
>
>The functions all the way down to libjpeg are wanting a pointer to a FILE 
>structure.   My other thought was
>looking for a way to imitate the FILE pointer in memory and modifying the 
>entry C code to return back the
>in memory data as a binary stream.  I'll have to look into that as well. 
>My C is pretty weak as well.  I'm
>so thankful there's Google.
>
>As a workaround, here's what I did (using os.tmpfile):
>
>from mod_python import apache
>from mod_python import util
>import gdchart
>import os
>
>def handler(req):
>        req.content_type = "image/png"
>
>        chart = gdchart.Line3D()
>        chart.width = 250
>        chart.height = 250
>        chart.xtitle = "xtitle goes here"
>        chart.ytitle = "Percentage"
>        chart.title = "Example Graph"
>        chart.ext_color = [ "white", "yellow", "red", "blue", "green"]
>        chart.setData([20, 100, 80, 30, 50],[10,150,20,25,65])
>        chart.setLabels(["Mon", "Tue", "Wed", "Thu", "Fri"])
>        chart.setLabels(["Mon", "Tue", "Wed", "Thu", "Fri"])
>
>        f = os.tmpfile()
>        chart.draw(f)
>        f.seek(0)
>        req.write(f.read())
>        f.close()
>
>        return apache.OK
>
>It outputs a graph for me.    Here's another question that may be 
>better suited for comp.lang.python, but do you know if
>os.tmpfile() uses an in-memory representation of a file
>or does it use a physical file that just remains anonymous?  I'm 
>concerned about the wasteful loss of speed having to write to
>disk and read it back.
>
>Well, enough rambling.  Thanks for your time,
>Perry Tew
>  
>
I'm pretty sure os.tmpfile() is a real file. It should probably be 
deleted afterwards.
Definitely the better option here is changing the library...
Thanks for the investigations
David


From alentzos at cosmote.gr  Fri Sep 19 17:20:43 2003
From: alentzos at cosmote.gr (Lentzos Athanassios)
Date: Fri Jan  9 22:04:12 2004
Subject: ??: [mod_python] Load python module problem
Message-ID: <4AEFA010DC6711478C8DA31039641A99014BBFA5@AHRMAIL.cosmote.gr>

First  i want to thank you  for the immediate response.
 
I did what you suggest me ( uninstall of python 2.3 and install of python 2.2.3 ver) but i still have
the same problem. I should notice that  i don't have administration authority to my workstation do you think
that maybe the cause of the problem.

-----?????? ??????-----
???: Benjamin [mailto:benjamin-hepp@t-online.de]
????????: ??????, 18 ??????????? 2003 6:41 ??
????: Lentzos Athanassios
????: Re: [mod_python] Load python module problem


>Hi 
>I have problem to load the mod_python( ver 3.0.3)? to apache (ver
2.0.47) I have done the >configuration according to the instructions but
i still
>get the following error when i try to start apache server? < " Cannot
load c:/program >files/apache/apache2/modules/mod_python.so into
server:The specified
>module could not be found." > ,of course the file is there. /* I have
installed Python >2.3? on my PC which runs NT os */? ....Please help!!
>
>Lentzos? .P Athanassios (Greece, Athens) 
>E-mail? :?? alentzos@cosmote.gr

mod_python doesn't work with Python 2.3.
Use Python 2.2.

Benjamin

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mailman.modpython.org/pipermail/mod_python/attachments/20030919/3935ae37/attachment-0003.htm
From grisha at modpython.org  Mon Sep 22 10:13:56 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 22:04:12 2004
Subject: [mod_python]  does a mod_python handler exist to generate
 charts/graphs? (png images)
In-Reply-To: <OFACFE0A3B.CBD0AC18-ON85256DA6.004B1817-85256DA6.004CDDEC@EU.novartis.net>
References: <OFACFE0A3B.CBD0AC18-ON85256DA6.004B1817-85256DA6.004CDDEC@EU.novartis.net>
Message-ID: <20030922100713.X33862@onyx.ispol.com>



On Fri, 19 Sep 2003 perry.tew@cibavision.novartis.com wrote:

> I tried to use the StringIO object from both StringIO and cStringIO.
> The library didn't like that at all.  I traced some of the pygdchart
> code.  It drops down into C and calls the following code (from
> _gdchartc.c) ( I stripped out some unnecessary lines):
>
> PyObject *pfile, *labels, *data, *combodata;
> FILE *fp;
> ...
> if (!PyArg_ParseTuple(args, "iiO!iiOiOO", &width, &height, &PyFile_Type,
> &pfile,
> ...
> fp = PyFile_AsFile(pfile);

Since StringIO is not a file (i.e. it is not a Python object of type
"file", it is something else that acts like a file, but only within
Python), I think your only option is to write to a temporary file, then
pass that file in. Take a look at Python's tempfile module (if you haven't
already).

Grisha
From mike.looijmans at asml.com  Tue Sep 23 08:09:59 2003
From: mike.looijmans at asml.com (Mike Looijmans)
Date: Fri Jan  9 22:04:12 2004
Subject: [mod_python]  does a mod_python handler exist to
	generatecharts/graphs? (png images)
Message-ID: <01c38199$51459580$926a1e6e@wsasd464>

You could look into other stuff, which would be partially OS specific:

- Named pipe. Works on most Unixes and on Windows NT system. Write to
something that looks "filish" to most programs but ends up into your
program.
- Socket. Pass a (TCP) socket descriptor, with your Python program
listening, instead of a file handle to the other side.
- Memory files. Supported on some systems, a file that resides in memory.

Some of these will require a little C interfacing, but that's easy to figure
out.

Mike.

-----Original Message-----
>Since StringIO is not a file (i.e. it is not a Python object of type
>"file", it is something else that acts like a file, but only within
>Python), I think your only option is to write to a temporary file, then
>pass that file in. Take a look at Python's tempfile module (if you haven't
>already).




-- 
The information contained in this communication and any attachments is confidential and may be privileged, and is for the sole use of the intended recipient(s). Any unauthorized review, use, disclosure or distribution is prohibited. If you are not the intended recipient, please notify the sender immediately by replying to this message and destroy all copies of this message and any attachments. ASML is neither liable for the proper and complete transmission of the information contained in this communication, nor for any delay in its receipt.


From grisha at modpython.org  Tue Sep 23 10:35:19 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 22:04:12 2004
Subject: [mod_python] [help]please give an input filter example ?
In-Reply-To: <002c01c37e5b$71210920$db64a8c0@camgelo>
References: <007c01c37dc6$32d21050$db64a8c0@camgelo>
	<3F69851B.3080703@sjsoft.com>
	<009d01c37dd0$bc2c5f40$db64a8c0@camgelo> <3F69916F.10406@sjsoft.com>
	<3F69D71A.8080005@sjsoft.com>
	<002c01c37e5b$71210920$db64a8c0@camgelo>
Message-ID: <20030923102333.N24322@onyx.ispol.com>


I've looked at the input filter code, and I think that what's in 3.0.3 is
broken. If you get the latest CVS version, your input filter code would
look somethng like:

def inputfilter(filter):

	s = filter.read()

	if s:
		## do something with s here

		filter.write(s)
	else:
		filter.close()

	return apache.OK

Note that the filter will only see the body of the POST request, it will
not see the headers, in fact it won't even be called for GET requests.

Grisha

On Fri, 19 Sep 2003, camge wrote:

> > >I need input filter to convert character set of form data submitted by
> cell
> > >phone browser.
> > >For example, convert utf-8 to big5 or gb.
> > >If I can do it in input filter, then I dont need to modify all of my
> pages.
> > >
> > >
> > Aha. What I would do is just put a function in a module that changes the
> > encoding.
> > Get the arguments like you normally would, then just do a decode/encode.
> > Since that module can be accessed from anywhere, it will work just as
> well.
> > Also, it's less likely to cause bugs, and will probably be faster
> > (you'll only making one jump into the Python interpreter and back)
> >
> > Cheers
> > David
> >
> Thanks for your suggestion!
> But my web server serve not only wap browser but also Pocket IE and IE,
> and they all use same module(for easy maintenance).
> Adding this function in these modules will be a terrible thing,
> because I dont need to convert character encoding for Pocket IE and IE.
>
> If I can do it in input filter, I don't need to modify any things in
> original module.
>
> regards,
> camge
>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From is83070 at cis.nctu.edu.tw  Wed Sep 24 09:25:36 2003
From: is83070 at cis.nctu.edu.tw (camge)
Date: Fri Jan  9 22:04:12 2004
Subject: [mod_python] [help]please give an input filter example ?
References: <007c01c37dc6$32d21050$db64a8c0@camgelo>
	<3F69851B.3080703@sjsoft.com> <009d01c37dd0$bc2c5f40$db64a8c0@camgelo>
	<3F69916F.10406@sjsoft.com> <000e01c37de9$60cfd0f0$db64a8c0@camgelo>
	<3F69D71A.8080005@sjsoft.com> <002c01c37e5b$71210920$db64a8c0@camgelo>
	<20030923102333.N24322@onyx.ispol.com>
Message-ID: <001301c3823a$cc9b9c10$db64a8c0@camgelo>

Dear Grisha,

    Many Thanks for your help!
But I dont have compile environment.
What packages must install if My dev platform is windows and
runtime environment is Apache/2.0.44 (Win32) + Python/2.2.2  ?
I am a newbie on apache.

Best regards,
camge

----- Original Message ----- 
From: "Gregory (Grisha) Trubetskoy" <grisha@modpython.org>
To: "camge" <is83070@cis.nctu.edu.tw>
Cc: "David Fraser" <davidf@sjsoft.com>; <mod_python@modpython.org>
Sent: Tuesday, September 23, 2003 10:35 PM
Subject: Re: [mod_python] [help]please give an input filter example ?


>
> I've looked at the input filter code, and I think that what's in 3.0.3 is
> broken. If you get the latest CVS version, your input filter code would
> look somethng like:
>
> def inputfilter(filter):
>
> s = filter.read()
>
> if s:
> ## do something with s here
>
> filter.write(s)
> else:
> filter.close()
>
> return apache.OK
>
> Note that the filter will only see the body of the POST request, it will
> not see the headers, in fact it won't even be called for GET requests.
>
> Grisha
>
> On Fri, 19 Sep 2003, camge wrote:
>
> > > >I need input filter to convert character set of form data submitted
by
> > cell
> > > >phone browser.
> > > >For example, convert utf-8 to big5 or gb.
> > > >If I can do it in input filter, then I dont need to modify all of my
> > pages.
> > > >
> > > >
> > > Aha. What I would do is just put a function in a module that changes
the
> > > encoding.
> > > Get the arguments like you normally would, then just do a
decode/encode.
> > > Since that module can be accessed from anywhere, it will work just as
> > well.
> > > Also, it's less likely to cause bugs, and will probably be faster
> > > (you'll only making one jump into the Python interpreter and back)
> > >
> > > Cheers
> > > David
> > >
> > Thanks for your suggestion!
> > But my web server serve not only wap browser but also Pocket IE and IE,
> > and they all use same module(for easy maintenance).
> > Adding this function in these modules will be a terrible thing,
> > because I dont need to convert character encoding for Pocket IE and IE.
> >
> > If I can do it in input filter, I don't need to modify any things in
> > original module.
> >
> > regards,
> > camge
> >
> >
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://mailman.modpython.org/mailman/listinfo/mod_python
> >
>
>

From sgillies at frii.com  Wed Sep 24 10:20:27 2003
From: sgillies at frii.com (Sean Gillies)
Date: Fri Jan  9 22:04:13 2004
Subject: [mod_python] Use of global for application data?
Message-ID: <02128F25-EEAB-11D7-BC79-000393B98B56@frii.com>

Hi,

I've seen examples of how to create persistent database connections with
mod_python, but not enough examples of other application data.  In my
case the application data are large objects including page templates.  
Exists
a better way than binding values to names in the globals namespace?  
Maybe
I just have a hang-up about globals that I need to overcome.

Sean

--
Sean Gillies
sgillies at frii dot com
http://www.frii.com/~sgillies

From fumanchu at aminus.net  Wed Sep 24 11:31:27 2003
From: fumanchu at aminus.net (fumanchu)
Date: Fri Jan  9 22:04:13 2004
Subject: [mod_python] Use of global for application data?
In-Reply-To: <DE1CF2B4FEC4A342BF62B6B2B334601E4A9B08@opus.HQAMOR.amorhq.net>
Message-ID: <DE1CF2B4FEC4A342BF62B6B2B334601E02F6CC@opus.HQAMOR.amorhq.net>

> I've seen examples of how to create persistent database connections
with
> mod_python, but not enough examples of other application data.
> In my case the application data are large objects including page
templates.
> Exists a better way than binding values to names in the globals
namespace?

"THE globals namespace" sounds misleading to me, unless you're talking
about the __main__ module. Each module has its own global namespace.

> Maybe I just have a hang-up about globals that I need to overcome.

That would depend on what you mean by "a better way". What limitations
of module.attributes are you seeing? I'd be interested to hear more
about your design, including your goals for the page templates--are you
trying to cache them in RAM throughout the life of the application?


Robert Brewer
fumanchu@aminus.net

From sgillies at frii.com  Wed Sep 24 14:38:53 2003
From: sgillies at frii.com (Sean Gillies)
Date: Fri Jan  9 22:04:13 2004
Subject: [mod_python] Use of global for application data?
In-Reply-To: <DE1CF2B4FEC4A342BF62B6B2B334601E02F6CC@opus.HQAMOR.amorhq.net>
Message-ID: <1CCFD4F4-EECF-11D7-BC79-000393B98B56@frii.com>


On Wednesday, September 24, 2003, at 12:31  PM, fumanchu wrote:

>> I've seen examples of how to create persistent database connections
> with
>> mod_python, but not enough examples of other application data.
>> In my case the application data are large objects including page
> templates.
>> Exists a better way than binding values to names in the globals
> namespace?
>
> "THE globals namespace" sounds misleading to me, unless you're talking
> about the __main__ module. Each module has its own global namespace.
>
>> Maybe I just have a hang-up about globals that I need to overcome.
>
> That would depend on what you mean by "a better way". What limitations
> of module.attributes are you seeing? I'd be interested to hear more
> about your design, including your goals for the page templates--are you
> trying to cache them in RAM throughout the life of the application?
>
>
> Robert Brewer
> fumanchu@aminus.net
>

Robert, thanks for the reply.  I went back and re-read the relevant
sections of the Python Reference Manual.  I had misunderstood that
the persistent db connection example in the FAQ was referring to a
name in the __main__ module.

I am using Zope page templates as module attributes and when methods of
my module are called (using the publisher), merging them with data
from several contexts.  I caught and fixed a bug in my code which
was causing numerous (re)loads of the module, and am now having no
problems.

Sean

--
Sean Gillies
sgillies at frii dot com
http://www.frii.com/~sgillies

From luca.masini at t-online.de  Thu Sep 25 06:57:06 2003
From: luca.masini at t-online.de (Luca Masini)
Date: Fri Jan  9 22:04:13 2004
Subject: [mod_python] mod_python just dump the script
Message-ID: <oprv1hdgvfywthye@securesmtp.t-online.de>

Hi,

I installed mod_python on mandrake 9.1 but it only
dumps the script content instead of executing it.

I do as explained in the installation/testing documentation.

Here some snippets of my httpd.conf file:

  ...
  # <mod_python>
  LoadModule python_module /usr/lib/apache2-2.0.44/mod_python.so
  # </mod_python>
  ...
  # <mod_python>
  AddModule mod_python.c
  # </mod_python>
  ...
  # <mod_python>
  AddHandler python-program .py
  <Directory /var/www/html/test>
      PythonHandler mptest
      PythonDebug On
  </Directory>
  # </mod_python>

The test full path of the test program is
  /var/www/html/test/mptest.py

More or less half an year ago I had the same problem on
a Solaris machine but I can remember how it was solved.
:-(

thanks in advance.



From is83070 at cis.nctu.edu.tw  Thu Sep 25 16:21:25 2003
From: is83070 at cis.nctu.edu.tw (camge)
Date: Fri Jan  9 22:04:13 2004
Subject: [mod_python] [help]please give an input filter example ?
References: <007c01c37dc6$32d21050$db64a8c0@camgelo>
	<3F69851B.3080703@sjsoft.com> <009d01c37dd0$bc2c5f40$db64a8c0@camgelo>
	<3F69916F.10406@sjsoft.com> <000e01c37de9$60cfd0f0$db64a8c0@camgelo>
	<3F69D71A.8080005@sjsoft.com> <002c01c37e5b$71210920$db64a8c0@camgelo>
	<20030923102333.N24322@onyx.ispol.com>
Message-ID: <010201c3833e$0a7cfc00$db64a8c0@camgelo>

Hi Grisha,

    I have compiled the latest CVS version, and it works.
But I found another problem here.

>  postData = filter.read()
>  modify(postData)
>  filter.write(postData)

If postData's length is not changed, everything is fine. 
Otherwise IE will hand there.
I guess this is caused by HTTP header "Content-Length" .
Because we changed the request body, but didn't update the header.

regards,
camge

----- Original Message ----- 
From: "Gregory (Grisha) Trubetskoy" <grisha@modpython.org>
To: "camge" <is83070@cis.nctu.edu.tw>
Cc: "David Fraser" <davidf@sjsoft.com>; <mod_python@modpython.org>
Sent: Tuesday, September 23, 2003 10:35 PM
Subject: Re: [mod_python] [help]please give an input filter example ?


> 
> I've looked at the input filter code, and I think that what's in 3.0.3 is
> broken. If you get the latest CVS version, your input filter code would
> look somethng like:
> 
> def inputfilter(filter):
> 
> s = filter.read()
> 
> if s:
> ## do something with s here
> 
> filter.write(s)
> else:
> filter.close()
> 
> return apache.OK
> 
> Note that the filter will only see the body of the POST request, it will
> not see the headers, in fact it won't even be called for GET requests.
> 
> Grisha
> 

From grisha at modpython.org  Thu Sep 25 09:29:35 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 22:04:13 2004
Subject: [mod_python] [help]please give an input filter example ?
In-Reply-To: <010201c3833e$0a7cfc00$db64a8c0@camgelo>
References: <007c01c37dc6$32d21050$db64a8c0@camgelo>
	<3F69851B.3080703@sjsoft.com>
	<009d01c37dd0$bc2c5f40$db64a8c0@camgelo> <3F69916F.10406@sjsoft.com>
	<3F69D71A.8080005@sjsoft.com><20030923102333.N24322@onyx.ispol.com>
	<010201c3833e$0a7cfc00$db64a8c0@camgelo>
Message-ID: <20030925092737.H57967@onyx.ispol.com>


On Thu, 25 Sep 2003, camge wrote:

> Hi Grisha,
>
>     I have compiled the latest CVS version, and it works.
> But I found another problem here.
>
> >  postData = filter.read()
> >  modify(postData)
> >  filter.write(postData)
>
> If postData's length is not changed, everything is fine.
> Otherwise IE will hand there.
> I guess this is caused by HTTP header "Content-Length" .
> Because we changed the request body, but didn't update the header.

Most likely, but I don't think there is a way around that because the
header is sent before the body. Perhaps your filter can store something in
the request object to communicate to your handler that it needs to read
more data.

Grisha
From luca.masini at t-online.de  Thu Sep 25 21:09:12 2003
From: luca.masini at t-online.de (Luca Masini)
Date: Fri Jan  9 22:04:13 2004
Subject: [mod_python] undefined symbol: apr_bucket_type_flush
Message-ID: <oprv2ktmdkywthye@securesmtp.t-online.de>

Hi again,
  I installed mod_python on mandrake 9.1 but it only
dumps the script content instead of executing it.

Then I installed mod_php and I have seen that mod_python is
not loaded at all.

running

  httpd -t

I get the following messages:

  Syntax error on line 66 of /etc/httpd/conf/httpd.conf:
  Cannot load /usr/lib/apache2-2.0.44/mod_python.so into server
  /usr/lib/apache2-2.0.44/mod_python.so: undefined symbol: 
apr_bucket_type_flush

So the problem seems to be this undefined apr_bucket_type_flush.

I compiled the module using these commands

   ./configure --with-apxs=/usr/src/apache2-2.0.44/support/apxs
   make
   su
   make install

What's wrong ?

Thanks.
From grisha at modpython.org  Thu Sep 25 14:22:41 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 22:04:13 2004
Subject: [mod_python] undefined symbol: apr_bucket_type_flush
In-Reply-To: <oprv2ktmdkywthye@securesmtp.t-online.de>
References: <oprv2ktmdkywthye@securesmtp.t-online.de>
Message-ID: <20030925142021.X60209@onyx.ispol.com>



On Thu, 25 Sep 2003, Luca Masini wrote:

> I compiled the module using these commands
>
>    ./configure --with-apxs=/usr/src/apache2-2.0.44/support/apxs

Don't know much about Mandrake, but it seems to me you're pointing at the
wrong apxs, it should really be in /usr/bin or some such. Perhaps someone
familiar w/ Mandrake can comment?

Grisha
From neo at https.ru  Fri Sep 26 00:58:42 2003
From: neo at https.ru (Neo Eureka)
Date: Fri Jan  9 22:04:13 2004
Subject: [mod_python] undefined symbol: apr_bucket_type_flush
In-Reply-To: <oprv2ktmdkywthye@securesmtp.t-online.de>
References: <oprv2ktmdkywthye@securesmtp.t-online.de>
Message-ID: <1118505542.20030926005842@https.ru>


  Hi!

  Some months ago I experimented with Mandrake. I guess you've
installed Apache from a "package". AFAIK, Mandrake has some kind of
"special" Apache flavours.

  I think the best (and the fastest) solution to these problems would
be to compile (the latest version of) original Apache from sources.


> Hi again,
>   I installed mod_python on mandrake 9.1 but it only
> dumps the script content instead of executing it.

> Then I installed mod_php and I have seen that mod_python is
> not loaded at all.

> running

>   httpd -t

> I get the following messages:

>   Syntax error on line 66 of /etc/httpd/conf/httpd.conf:
>   Cannot load /usr/lib/apache2-2.0.44/mod_python.so into server
>   /usr/lib/apache2-2.0.44/mod_python.so: undefined symbol: 
> apr_bucket_type_flush

> So the problem seems to be this undefined apr_bucket_type_flush.

> I compiled the module using these commands

>    ./configure --with-apxs=/usr/src/apache2-2.0.44/support/apxs
>    make
>    su
>    make install

> What's wrong ?

> Thanks.
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python


--- 
Neo Eureka / mailto:neo@https.ru

From modpython at maya.com  Thu Sep 25 17:56:55 2003
From: modpython at maya.com (Seung Chan Lim)
Date: Fri Jan  9 22:04:13 2004
Subject: [mod_python] apache.log_error
Message-ID: <029f01c383af$ef321c60$95fe46c0@GIRLS>

If I'm trying to spew error messages out to the default apache error log am
I doing the right thing by using apache.log_error ??

The problem is that I don't see anything on the default error log which I
believe is Apache2/logs/error.log

This is using mod_python 3.03
Windows 2000
Apache 2.0
Python 2.2

thanks

slim

From is83070 at cis.nctu.edu.tw  Fri Sep 26 10:08:56 2003
From: is83070 at cis.nctu.edu.tw (camge)
Date: Fri Jan  9 22:04:13 2004
Subject: [mod_python] [help]please give an input filter example ?
References: <007c01c37dc6$32d21050$db64a8c0@camgelo>
	<3F69851B.3080703@sjsoft.com> <009d01c37dd0$bc2c5f40$db64a8c0@camgelo>
	<3F69916F.10406@sjsoft.com> <000e01c37de9$60cfd0f0$db64a8c0@camgelo>
	<3F69D71A.8080005@sjsoft.com> <002c01c37e5b$71210920$db64a8c0@camgelo>
	<20030923102333.N24322@onyx.ispol.com>
	<010201c3833e$0a7cfc00$db64a8c0@camgelo>
	<20030925092737.H57967@onyx.ispol.com>
Message-ID: <001401c383d3$2c266e00$db64a8c0@camgelo>


>----- Original Message ----- 
>From: "Gregory (Grisha) Trubetskoy" <grisha@modpython.org>
>Sent: Thursday, September 25, 2003 9:29 PM
>Subject: Re: [mod_python] [help]please give an input filter example ?
>
>
> Most likely, but I don't think there is a way around that because the
> header is sent before the body. Perhaps your filter can store something in
> the request object to communicate to your handler that it needs to read
> more data.
>
> Grisha
>
>

Is there a way to read the header from client
and modify it just like the body in mod_python?
Or any way can modify the body before it sent to the cgi?
Handler in mod_python seems to handle response only.

Thanks for your response!

Best regards,
camge



From is83070 at cis.nctu.edu.tw  Fri Sep 26 15:55:26 2003
From: is83070 at cis.nctu.edu.tw (camge)
Date: Fri Jan  9 22:04:13 2004
Subject: [mod_python] [help]please give an input filter example ?
References: <007c01c37dc6$32d21050$db64a8c0@camgelo>
	<3F69851B.3080703@sjsoft.com> <009d01c37dd0$bc2c5f40$db64a8c0@camgelo>
	<3F69916F.10406@sjsoft.com> <000e01c37de9$60cfd0f0$db64a8c0@camgelo>
	<3F69D71A.8080005@sjsoft.com> <002c01c37e5b$71210920$db64a8c0@camgelo>
	<20030923102333.N24322@onyx.ispol.com>
	<010201c3833e$0a7cfc00$db64a8c0@camgelo>
	<20030925092737.H57967@onyx.ispol.com>
Message-ID: <003301c38403$9ca9ae00$db64a8c0@camgelo>

regardless of Content-Length problem,
I found my apache's error log has these error message when I post data to
cgi.
------------------------------------------------
...
[Fri Sep 26 15:51:31 2003] [error] [client 192.168.100.219] inputfilter
cameoInputFilter: Traceback (most recent call last):, referer:
http://192.168.100.161/test/index.htm
[Fri Sep 26 15:51:31 2003] [error] [client 192.168.100.219] inputfilter
cameoInputFilter:   File "C:\Program
Files\WebSite\lib\python22\lib\site-packages\mod_python\apache.py", line
222, in FilterDispatch
    object(filter), referer: http://192.168.100.161/test/index.htm
[Fri Sep 26 15:51:31 2003] [error] [client 192.168.100.219] inputfilter
cameoInputFilter:   File "C:/Program
Files/WebSite/httpd/CameoMobileSpace\cameoInputFilter.py", line 9, in
inputfilter
    strBody = filter.read(), referer: http://192.168.100.161/test/index.htm
[Fri Sep 26 15:51:31 2003] [error] [client 192.168.100.219] inputfilter
cameoInputFilter: IOError: Input filter read error, referer:
http://192.168.100.161/test/index.htm
...
-------------------------------------------------
although having error log, input filter still works.
Should I catch this exception? and how to handle it, close filter or just
return?
Below is my simple inputfilter:

def inputfilter(filter):
    strBody = filter.read()
    if strBody:
        filter.write(strBody)
    else:
        filter.close()
    return apache.OK

From grisha at modpython.org  Fri Sep 26 10:53:56 2003
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri Jan  9 22:04:13 2004
Subject: [mod_python] [help]please give an input filter example ?
In-Reply-To: <003301c38403$9ca9ae00$db64a8c0@camgelo>
References: <007c01c37dc6$32d21050$db64a8c0@camgelo>
	<3F69851B.3080703@sjsoft.com>
	<009d01c37dd0$bc2c5f40$db64a8c0@camgelo> <3F69916F.10406@sjsoft.com>
	<3F69D71A.8080005@sjsoft.com><20030923102333.N24322@onyx.ispol.com>
	<20030925092737.H57967@onyx.ispol.com>
	<003301c38403$9ca9ae00$db64a8c0@camgelo>
Message-ID: <20030926104954.C62356@onyx.ispol.com>


Interesting...

If you could change filterobject.c, around line 223, where the code looks
like:

       if (! APR_STATUS_IS_SUCCESS(self->rc)) {
            PyErr_SetObject(PyExc_IOError,
                            PyString_FromString("Input filter read error"));
            return NULL;
To:

       if (! APR_STATUS_IS_SUCCESS(self->rc)) {
            PyErr_Format(PyExc_IOError, "Input filter read error: %d",
                         self->rc);
            return NULL;

This will log the actual return code that Apache is returning on this
error, it might give us more information on what is really going on there.

Thanks,

Grisha


On Fri, 26 Sep 2003, camge wrote:

> regardless of Content-Length problem,
> I found my apache's error log has these error message when I post data to
> cgi.
> ------------------------------------------------
> ...
> [Fri Sep 26 15:51:31 2003] [error] [client 192.168.100.219] inputfilter
> cameoInputFilter: Traceback (most recent call last):, referer:
> http://192.168.100.161/test/index.htm
> [Fri Sep 26 15:51:31 2003] [error] [client 192.168.100.219] inputfilter
> cameoInputFilter:   File "C:\Program
> Files\WebSite\lib\python22\lib\site-packages\mod_python\apache.py", line
> 222, in FilterDispatch
>     object(filter), referer: http://192.168.100.161/test/index.htm
> [Fri Sep 26 15:51:31 2003] [error] [client 192.168.100.219] inputfilter
> cameoInputFilter:   File "C:/Program
> Files/WebSite/httpd/CameoMobileSpace\cameoInputFilter.py", line 9, in
> inputfilter
>     strBody = filter.read(), referer: http://192.168.100.161/test/index.htm
> [Fri Sep 26 15:51:31 2003] [error] [client 192.168.100.219] inputfilter
> cameoInputFilter: IOError: Input filter read error, referer:
> http://192.168.100.161/test/index.htm
> ...
> -------------------------------------------------
> although having error log, input filter still works.
> Should I catch this exception? and how to handle it, close filter or just
> return?
> Below is my simple inputfilter:
>
> def inputfilter(filter):
>     strBody = filter.read()
>     if strBody:
>         filter.write(strBody)
>     else:
>         filter.close()
>     return apache.OK
>
From modpython at maya.com  Fri Sep 26 15:37:06 2003
From: modpython at maya.com (Seung Chan Lim)
Date: Fri Jan  9 22:04:13 2004
Subject: [mod_python] module not reloading?
Message-ID: <037001c38465$9174a550$95fe46c0@GIRLS>

The module reloading mechanism doesn't seem to work. I have to restart
apache everytime to have it reload the modules...

I even tried using the PythonAutoReload directive and set it to "ON" inside
the "Directory" section of the httpd.conf file... no luck..

any advice?

thanks


I'm using python 2.2
mod_python 3.03
Apache 2.0



From michael at dynamine.net  Fri Sep 26 12:50:07 2003
From: michael at dynamine.net (Michael S. Fischer)
Date: Fri Jan  9 22:04:13 2004
Subject: [mod_python] module not reloading?
In-Reply-To: <037001c38465$9174a550$95fe46c0@GIRLS>
References: <037001c38465$9174a550$95fe46c0@GIRLS>
Message-ID: <3F74986F.9010105@dynamine.net>

I have the same problem.  (Same versions, also running OS X 10.2, 
Python2.2 from Fink.)

--Michael

Seung Chan Lim wrote:
> The module reloading mechanism doesn't seem to work. I have to restart
> apache everytime to have it reload the modules...
> 
> I even tried using the PythonAutoReload directive and set it to "ON" inside
> the "Directory" section of the httpd.conf file... no luck..
> 
> any advice?
> 
> thanks
> 
> 
> I'm using python 2.2
> mod_python 3.03
> Apache 2.0
> 
> 
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
> 

From neel at mediapulse.com  Fri Sep 26 16:13:24 2003
From: neel at mediapulse.com (Michael C. Neel)
Date: Fri Jan  9 22:04:13 2004
Subject: [mod_python] module not reloading?
Message-ID: <C0FC22C08B82074A88B500617641577787A787@johnson.mediapulse.net>

I believe the main module reloads, but you will need to manually reload
any modules your module calls you want reloaded.  I tie this into the
PythonDebug setting, like such:

    # if this is in debug/test mode, reload any changes
    if req.get_config().has_key('PythonDebug'):
        reload(www_forms)
        reload(globals)

(if you state PythonDebug Off, there will not be a PythonDebug key at
all - a little gotcha as you might expect there to by a PythonDebug key
with a value of Off).

avoid "from module import *"'s; these don't seem to work with the reload
function (I think that is the way it's supposed to work, btw).

With the above inplace, I don't need to restart/killhup apache unless I
have PythonDebug Off.

HTH,
Mike

> -----Original Message-----
> From: Michael S. Fischer [mailto:michael@dynamine.net] 
> Sent: Friday, September 26, 2003 3:50 PM
> To: Seung Chan Lim
> Cc: mod_python@modpython.org
> Subject: Re: [mod_python] module not reloading?
> 
> 
> I have the same problem.  (Same versions, also running OS X 10.2, 
> Python2.2 from Fink.)
> 
> --Michael
> 
> Seung Chan Lim wrote:
> > The module reloading mechanism doesn't seem to work. I have 
> to restart
> > apache everytime to have it reload the modules...
> > 
> > I even tried using the PythonAutoReload directive and set 
> it to "ON" inside
> > the "Directory" section of the httpd.conf file... no luck..
> > 
> > any advice?
> > 
> > thanks
> > 
> > 
> > I'm using python 2.2
> > mod_python 3.03
> > Apache 2.0
> > 
> > 
> > 
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://mailman.modpython.org/mailman/listinfo/mod_python
> > 
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
> 

From michael at dynamine.net  Fri Sep 26 13:19:59 2003
From: michael at dynamine.net (Michael S. Fischer)
Date: Fri Jan  9 22:04:13 2004
Subject: [mod_python] module not reloading?
In-Reply-To: <C0FC22C08B82074A88B500617641577787A787@johnson.mediapulse.net>
References: <C0FC22C08B82074A88B500617641577787A787@johnson.mediapulse.net>
Message-ID: <3F749F6F.70109@dynamine.net>

Actually, my problem is that the main module reloads, but my called 
modules don't, even if I call reload() explicitly.

--Michael

Michael C. Neel wrote:

> I believe the main module reloads, but you will need to manually reload
> any modules your module calls you want reloaded.  I tie this into the
> PythonDebug setting, like such:
> 
>     # if this is in debug/test mode, reload any changes
>     if req.get_config().has_key('PythonDebug'):
>         reload(www_forms)
>         reload(globals)
> 
> (if you state PythonDebug Off, there will not be a PythonDebug key at
> all - a little gotcha as you might expect there to by a PythonDebug key
> with a value of Off).
> 
> avoid "from module import *"'s; these don't seem to work with the reload
> function (I think that is the way it's supposed to work, btw).
> 
> With the above inplace, I don't need to restart/killhup apache unless I
> have PythonDebug Off.
> 
> HTH,
> Mike
> 
> 
>>-----Original Message-----
>>From: Michael S. Fischer [mailto:michael@dynamine.net] 
>>Sent: Friday, September 26, 2003 3:50 PM
>>To: Seung Chan Lim
>>Cc: mod_python@modpython.org
>>Subject: Re: [mod_python] module not reloading?
>>
>>
>>I have the same problem.  (Same versions, also running OS X 10.2, 
>>Python2.2 from Fink.)
>>
>>--Michael
>>
>>Seung Chan Lim wrote:
>>
>>>The module reloading mechanism doesn't seem to work. I have 
>>
>>to restart
>>
>>>apache everytime to have it reload the modules...
>>>
>>>I even tried using the PythonAutoReload directive and set 
>>
>>it to "ON" inside
>>
>>>the "Directory" section of the httpd.conf file... no luck..
>>>
>>>any advice?
>>>
>>>thanks
>>>
>>>
>>>I'm using python 2.2
>>>mod_python 3.03
>>>Apache 2.0
>>>
>>>
>>>
>>>_______________________________________________
>>>Mod_python mailing list
>>>Mod_python@modpython.org
>>>http://mailman.modpython.org/mailman/listinfo/mod_python
>>>
>>
>>_______________________________________________
>>Mod_python mailing list
>>Mod_python@modpython.org
>>http://mailman.modpython.org/mailman/listinfo/mod_python
>>
> 
> 

From neel at mediapulse.com  Fri Sep 26 16:30:50 2003
From: neel at mediapulse.com (Michael C. Neel)
Date: Fri Jan  9 22:04:13 2004
Subject: [mod_python] module not reloading?
Message-ID: <C0FC22C08B82074A88B50061764157776B9722@johnson.mediapulse.net>

Hmm, without seeing any code, I'm out of ideas.  Here is the (python
2.2.2) docs on reload(), with all it's gotcha's you need to avoid...

reload(module) 
Re-parse and re-initialize an already imported module. The argument must
be a module object, so it must have been successfully imported before.
This is useful if you have edited the module source file using an
external editor and want to try out the new version without leaving the
Python interpreter. The return value is the module object (the same as
the module argument). 
There are a number of caveats: 

If a module is syntactically correct but its initialization fails, the
first import statement for it does not bind its name locally, but does
store a (partially initialized) module object in sys.modules. To reload
the module you must first import it again (this will bind the name to
the partially initialized module object) before you can reload() it. 

When a module is reloaded, its dictionary (containing the module's
global variables) is retained. Redefinitions of names will override the
old definitions, so this is generally not a problem. If the new version
of a module does not define a name that was defined by the old version,
the old definition remains. This feature can be used to the module's
advantage if it maintains a global table or cache of objects -- with a
try statement it can test for the table's presence and skip its
initialization if desired. 

It is legal though generally not very useful to reload built-in or
dynamically loaded modules, except for sys, __main__ and __builtin__. In
many cases, however, extension modules are not designed to be
initialized more than once, and may fail in arbitrary ways when
reloaded. 

If a module imports objects from another module using from ... import
..., calling reload() for the other module does not redefine the objects
imported from it -- one way around this is to re-execute the from
statement, another is to use import and qualified names (module.name)
instead. 

If a module instantiates instances of a class, reloading the module that
defines the class does not affect the method definitions of the
instances -- they continue to use the old class definition. The same is
true for derived classes. 



> -----Original Message-----
> From: Michael S. Fischer [mailto:michael@dynamine.net] 
> Sent: Friday, September 26, 2003 4:20 PM
> To: Michael C. Neel
> Cc: Seung Chan Lim; mod_python@modpython.org
> Subject: Re: [mod_python] module not reloading?
> 
> 
> Actually, my problem is that the main module reloads, but my called 
> modules don't, even if I call reload() explicitly.
> 
> --Michael
> 

From andy at netfxph.com  Sun Sep 28 08:30:37 2003
From: andy at netfxph.com (Andy Sy)
Date: Fri Jan  9 22:04:13 2004
Subject: [mod_python] 
	Win32 Binary of modpython 3.0.3 that has the Python 2.3 patch
Message-ID: <3F762BAD.9040006@netfxph.com>

 > modpython 3.0.3 works fine with Python 2.3, but to build it you
 > need to hack src/include/mod_python.h.  There's a FAQ entry with
 > the necessary patch.
 >
 > Maybe Grisha should release a 3.0.4 with just this one patch?
 >
 > -Barry

I second the motion.  Does anyone have such a binary?
At the very least widespread testing will help uncover
Python 2.3 vis-a-vis modpython 3.x bugs under Windows.

Does anyone have tips on how to compile modpython under
Windows?  Is it possible to do this using MinGW?


From andy at netfxph.com  Mon Sep 29 05:33:30 2003
From: andy at netfxph.com (Andy Sy)
Date: Fri Jan  9 22:04:13 2004
Subject: [mod_python] 
	Windows binary of modpython-3.1.0a for Python 2.3 still won't load
Message-ID: <3F7753AA.1020004@netfxph.com>

/httpd/modpython/win/3.1.0a/mod_python-3.1.0a.win32-py2.3.exe

exhibits the same problems as the earlier versions.  I'm
still getting a module not found error even though it is
clearly in the proper directory.


From is83070 at cis.nctu.edu.tw  Mon Sep 29 10:26:02 2003
From: is83070 at cis.nctu.edu.tw (camge)
Date: Fri Jan  9 22:04:13 2004
Subject: [mod_python] [help]please give an input filter example ?
References: <007c01c37dc6$32d21050$db64a8c0@camgelo>
	<3F69851B.3080703@sjsoft.com> <009d01c37dd0$bc2c5f40$db64a8c0@camgelo>
	<3F69916F.10406@sjsoft.com> <000e01c37de9$60cfd0f0$db64a8c0@camgelo>
	<3F69D71A.8080005@sjsoft.com> <002c01c37e5b$71210920$db64a8c0@camgelo>
	<20030923102333.N24322@onyx.ispol.com>
	<010201c3833e$0a7cfc00$db64a8c0@camgelo>
	<20030925092737.H57967@onyx.ispol.com>
	<003301c38403$9ca9ae00$db64a8c0@camgelo>
	<20030926104954.C62356@onyx.ispol.com>
Message-ID: <001201c38631$f12aa850$db64a8c0@camgelo>

>----- Original Message ----- 
>From: "Gregory (Grisha) Trubetskoy" <grisha@modpython.org>
>
> Interesting...
>
> If you could change filterobject.c, around line 223, where the code looks
> like:
>
>        if (! APR_STATUS_IS_SUCCESS(self->rc)) {
>             PyErr_SetObject(PyExc_IOError,
>                             PyString_FromString("Input filter read
error"));
>             return NULL;
> To:
>
>        if (! APR_STATUS_IS_SUCCESS(self->rc)) {
>             PyErr_Format(PyExc_IOError, "Input filter read error: %d",
>                          self->rc);
>             return NULL;
>
> This will log the actual return code that Apache is returning on this
> error, it might give us more information on what is really going on there.
>
> Thanks,
>
> Grisha
>
Hi Grisha,

    Below is the error message and error code is 730035.
----------------------------------------------------------------------------
------------------------------------------------------
[Mon Sep 29 10:23:56 2003] [notice] Parent: Created child process 2496
[Mon Sep 29 10:23:57 2003] [notice] Child 2496: Child process is running
[Mon Sep 29 10:23:57 2003] [notice] Child 2496: Acquired the start mutex.
[Mon Sep 29 10:23:57 2003] [notice] Child 2496: Starting 250 worker threads.
[Mon Sep 29 10:24:04 2003] [error] [client 211.79.36.248] inputfilter
cameoInputFilter: Traceback (most recent call last):
[Mon Sep 29 10:24:04 2003] [error] [client 211.79.36.248] inputfilter
cameoInputFilter:   File "C:\Program
Files\WebSite\lib\python22\lib\site-packages\mod_python\apache.py", line
222, in FilterDispatch
    object(filter)
[Mon Sep 29 10:24:04 2003] [error] [client 211.79.36.248] inputfilter
cameoInputFilter:   File "C:/Program
Files/WebSite/httpd/CameoMobileSpace\cameoInputFilter.py", line 9, in
inputfilter
    strBody = filter.read()
[Mon Sep 29 10:24:04 2003] [error] [client 211.79.36.248] inputfilter
cameoInputFilter: IOError: Input filter read error: 730035

From davidf at sjsoft.com  Mon Sep 29 07:54:06 2003
From: davidf at sjsoft.com (David Fraser)
Date: Fri Jan  9 22:04:13 2004
Subject: [mod_python] 	Win32 Binary of modpython 3.0.3 that has the Python
	2.3 patch
In-Reply-To: <3F762BAD.9040006@netfxph.com>
References: <3F762BAD.9040006@netfxph.com>
Message-ID: <3F77C8FE.6060900@sjsoft.com>

Andy Sy wrote:

> > modpython 3.0.3 works fine with Python 2.3, but to build it you
> > need to hack src/include/mod_python.h.  There's a FAQ entry with
> > the necessary patch.
> >
> > Maybe Grisha should release a 3.0.4 with just this one patch?
> >
> > -Barry
>
> I second the motion.  Does anyone have such a binary?
> At the very least widespread testing will help uncover
> Python 2.3 vis-a-vis modpython 3.x bugs under Windows.

Yes, this would be a great idea.

> Does anyone have tips on how to compile modpython under
> Windows?  Is it possible to do this using MinGW?

It's fairly complex - seems to require Visual C++ 7.0, also you have to 
then build the installer on a Linux machine I think.
Search the archives of this list for more info...

David


From davidf at sjsoft.com  Mon Sep 29 11:30:40 2003
From: davidf at sjsoft.com (David Fraser)
Date: Fri Jan  9 22:04:13 2004
Subject: [mod_python] jToolkit 0.1 released
Message-ID: <3F77FBC0.1080500@sjsoft.com>

I am pleased to announce the release of jToolkit, a new framework for 
building web applications using modpython and Apache.
jToolkit was developed by St James Software and is aimed at large, 
database-intensive applications with lots of dynamic content.

0.1 is the initial release of jToolkit. I'm trying to follow a 
release-early principle here, so at this stage, jToolkit is 
fully-functional, but documentation is scarce. Use the jToolkit lists 
for help or contributions (I also am on the mod_python and pythondev 
mailing lists).

Here's the blurb from the website, http://jtoolkit.sourceforge.net/

jToolkit is a Python web application framework built on modpython and 
Apache.

It is aimed at dynamically generated pages rather than mostly-static 
pages (for which there are templating solutions). Pages can be produced 
using a variety of widgets. It handles sessions and database connections.

The source code is licensed under the *GPL* license.

We request that for any contributions to jToolkit, *joint copyright* is 
assigned to St James Software. This enables us to keep the public GPL 
version in sync with our internal version, which we use for commercial 
projects. If there are any questions about this, please discuss on any 
of the mailing lists. (Note that if you want to, you can always create 
your own version of jToolkit without returning the contributions to this 
project).

Current features include:
  support for login/logout and user sessions (planned to be integrated 
with modpython 3.1 sessions if that is feasible)
  support for database independence using a wrapper around the Python 
DB-API 2.0
  support for localization using an extension of the gettext modules (so 
that you can have multiple users simultaneously using different languages)
  support for constructing pages using widget objects of various levels 
of complexity, ranging from simple html widgets to table layouts, etc

Any feedback, contributions etc are welcome.
In particular, if anyone actually wants to use this, they'll need help, 
which could then end up being used to create documentation. This is what 
I want to do, so please ask away!

David

From mikeklein at sbcglobal.net  Mon Sep 29 15:27:18 2003
From: mikeklein at sbcglobal.net (Mike Klein)
Date: Fri Jan  9 22:04:13 2004
Subject: [mod_python] Problems installing mod_python...openpty
Message-ID: <AIEFLNLEDPDLOJAIJKHPMEMBEJAA.mikeklein@sbcglobal.net>

I've googled/etc. and can't seem to find an answer to this one.

I am using RH9, and a separately installed Python (v. 2.2.3). My mod_python
is 2.7.8. Mod_python's install instructions say it works with <up to> Python
2.1.

My configure command is:

./configure --with-apxs=/apache/bin/apxs --with-python=/src/Python-2.2.3

The above version of python is compiled without threads and is in
/usr/local/python, whereas stock rh python is in /usr/bin and /usr/lib.

My apache is started with /usr/local/python/bin in the path before /usr/bin,
so apache is now using my custom python. This eliminated some site warnings
I was getting on restart.

When I attempt starting apache I get the following error:

Starting httpsd: Syntax error on line 211 of
/usr/local/apache/conf/httpsd.conf:
Cannot load /usr/local/apache/libexec/mod_python.so into server:
/usr/local/apache/libexec/mod_python.so: undefined symbol: openpty

Any ideas on how to solve this problem?


thanks in advance...

From mikeklein at sbcglobal.net  Mon Sep 29 17:25:44 2003
From: mikeklein at sbcglobal.net (Mike Klein)
Date: Fri Jan  9 22:04:13 2004
Subject: [mod_python] Problems installing mod_python...openpty....changing
	src/Makefile LIBS var fixed...but why needed?
In-Reply-To: <AIEFLNLEDPDLOJAIJKHPMEMBEJAA.mikeklein@sbcglobal.net>
Message-ID: <AIEFLNLEDPDLOJAIJKHPIEMEEJAA.mikeklein@sbcglobal.net>

Well...I google'd some more and found a single page with the answer:

I needed to manually update Makefile in mod_python's src directory and
added -lutil to LIBS variable.

Why is this needed though? I'm running a stock RH9 setup?

I am now able to run py scripts thru apache...


mike

-----Original Message-----
From: mod_python-bounces@modpython.org
[mailto:mod_python-bounces@modpython.org]On Behalf Of Mike Klein
Sent: Monday, September 29, 2003 3:27 PM
To: mod_python@modpython.org
Subject: [mod_python] Problems installing mod_python...openpty


I've googled/etc. and can't seem to find an answer to this one.

I am using RH9, and a separately installed Python (v. 2.2.3). My mod_python
is 2.7.8. Mod_python's install instructions say it works with <up to> Python
2.1.

My configure command is:

./configure --with-apxs=/apache/bin/apxs --with-python=/src/Python-2.2.3

The above version of python is compiled without threads and is in
/usr/local/python, whereas stock rh python is in /usr/bin and /usr/lib.

My apache is started with /usr/local/python/bin in the path before /usr/bin,
so apache is now using my custom python. This eliminated some site warnings
I was getting on restart.

When I attempt starting apache I get the following error:

Starting httpsd: Syntax error on line 211 of
/usr/local/apache/conf/httpsd.conf:
Cannot load /usr/local/apache/libexec/mod_python.so into server:
/usr/local/apache/libexec/mod_python.so: undefined symbol: openpty

Any ideas on how to solve this problem?


thanks in advance...

_______________________________________________
Mod_python mailing list
Mod_python@modpython.org
http://mailman.modpython.org/mailman/listinfo/mod_python

From mikeklein at sbcglobal.net  Mon Sep 29 19:29:19 2003
From: mikeklein at sbcglobal.net (Mike Klein)
Date: Fri Jan  9 22:04:13 2004
Subject: [mod_python] 
	Is there a status handler for mod_python ala mod_perl's
	perl-status, apache's server-status, and php's phpinfo()?
In-Reply-To: <AIEFLNLEDPDLOJAIJKHPIEMEEJAA.mikeklein@sbcglobal.net>
Message-ID: <AIEFLNLEDPDLOJAIJKHPEEMJEJAA.mikeklein@sbcglobal.net>

I like having these pages around as a sanity check and allaround diagnostic.

Does any such beast exist for mod_python? Page would show installed modules,
working environment, etc.


thanks in advance...

mike

From tpc at csua.berkeley.edu  Tue Sep 30 13:37:46 2003
From: tpc at csua.berkeley.edu (tpc@csua.berkeley.edu)
Date: Fri Jan  9 22:04:13 2004
Subject: [mod_python] writing to a file from mod_python
Message-ID: <20030930133235.G29513-100000@localhost.name>


hello all I have the following script that ran fine from the command line:

<code>
#!/usr/bin/env python

#string1 = "hello world!"

def writeFile(string1):
        open('somefile.txt', 'w').write(string1)

## writeFile(string1)
</code>

but as soon as I ported it to mod python I got the following:

<paste>
Mod_python error: "PythonHandler mod_python.publisher"

Traceback (most recent call last):

  File "/usr/lib/python2.2/site-packages/mod_python/apache.py", line 335, in HandlerDispatch
    result = object(req)

  File "/usr/lib/python2.2/site-packages/mod_python/publisher.py", line 194, in handler
    result = apply(object, (), args)

  File "/var/www/html/python/testing.py", line 7, in writeFile

IOError: [Errno 13] Permission denied: 'somefile.txt'
</paste>

I searched the web for the error message, chmod'ed 777 somefile.txt, and
even chown'ed and chgrp'ed to user and group apache, all to no avail.  Is
there a way to write to a file from mod python ?

