From lucian at tonicagency.com  Mon May  3 23:33:57 2004
From: lucian at tonicagency.com (Nicolescu Lucian)
Date: Mon May  3 16:36:00 2004
Subject: [mod_python] import module behaviour ?!
Message-ID: <200405032135.i43LZwVM002620@slash.mediapulse.com>

hi there,

I am a new into mod_python and there is a strange thing I noticed:
I use import <somefile_from_current_dir> to have access to some global
variables I need in my application (so I don't have to reinitialize it again
in another file)
the thing is that if I make any changes in <somefile_from_current_dir> they
will not be noticed until I restart apache
is there another way around this ?

btw: I use: apache 2.0.48, python 2.3.3, mod_python 3.1.3 !

10x,
Nicolescu Lucian

From lucian at tonicagency.com  Tue May  4 00:38:03 2004
From: lucian at tonicagency.com (Nicolescu Lucian)
Date: Mon May  3 17:33:22 2004
Subject: [mod_python] import module behaviour ?!
In-Reply-To: <200405032135.i43LZwVM002620@slash.mediapulse.com>
Message-ID: <200405032233.i43MXJVM002755@slash.mediapulse.com>

looks like reload(module) does the trick !
:D

Nicolescu Lucian
 

> -----Original Message-----
> From: mod_python-bounces@modpython.org 
> [mailto:mod_python-bounces@modpython.org] On Behalf Of 
> Nicolescu Lucian
> Sent: Monday, May 03, 2004 11:34 PM
> To: mod_python@modpython.org
> Subject: [mod_python] import module behaviour ?!
> 
> hi there,
> 
> I am a new into mod_python and there is a strange thing I noticed:
> I use import <somefile_from_current_dir> to have access to some global
> variables I need in my application (so I don't have to 
> reinitialize it again
> in another file)
> the thing is that if I make any changes in 
> <somefile_from_current_dir> they
> will not be noticed until I restart apache
> is there another way around this ?
> 
> btw: I use: apache 2.0.48, python 2.3.3, mod_python 3.1.3 !
> 
> 10x,
> Nicolescu Lucian
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python

From grisha at modpython.org  Mon May  3 22:53:25 2004
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Mon May  3 22:48:24 2004
Subject: [mod_python] import module behaviour ?!
In-Reply-To: <200405032135.i43LZwVM002620@slash.mediapulse.com>
References: <200405032135.i43LZwVM002620@slash.mediapulse.com>
Message-ID: <20040503225139.E29438@onyx.ispol.com>


Instead of using

  import somemodule

try using

  from mod_python import apache

  somemodule = apache.import_module('somemodule')

Then it will be reloaded automatically every time somemodule.py changes.

HTH,

Grisha


On Mon, 3 May 2004, Nicolescu Lucian wrote:

> hi there,
>
> I am a new into mod_python and there is a strange thing I noticed:
> I use import <somefile_from_current_dir> to have access to some global
> variables I need in my application (so I don't have to reinitialize it again
> in another file)
> the thing is that if I make any changes in <somefile_from_current_dir> they
> will not be noticed until I restart apache
> is there another way around this ?
>
> btw: I use: apache 2.0.48, python 2.3.3, mod_python 3.1.3 !
>
> 10x,
> Nicolescu Lucian
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From SAiello at Jentoo.com  Tue May  4 10:30:41 2004
From: SAiello at Jentoo.com (SAiello@Jentoo.com)
Date: Tue May  4 08:09:15 2004
Subject: [mod_python] General performance of the different handlers
Message-ID: <200405041030.41455.SAiello@Jentoo.com>

Hello All,

I am trying to write a Web Email IMAP client using mod_python. Currently I 
have email box navigation and email listing working. I am using mod_python 
publisher. At this point I am doing some stress testing on my code, checking 
before I go any further, that the code does not cause large amounts of system 
load, etc. From the results, I believe I started off thinking to grandiose. I 
created a a library of functions, one function does all my HTML rendering. 
Well all this lovely code, puts a huge load on the CPU. So I am thinking I 
need to scale things back a bit, make things run more simply. Under the docs, 
Section 1.1 Performance, I see the mod_python handler doing more requests per 
sec than mod_python publisher. My basic question is which mod_python should I 
use for the best system response and cause the least amount of system load ? 
Where does PSP handler fit in, in regards to performance ?

Thanks for any of your thoughts or ideas,
  Steven Aiello
From davidf at sjsoft.com  Tue May  4 15:19:00 2004
From: davidf at sjsoft.com (David Fraser)
Date: Tue May  4 09:07:52 2004
Subject: [mod_python] General performance of the different handlers
In-Reply-To: <200405041030.41455.SAiello@Jentoo.com>
References: <200405041030.41455.SAiello@Jentoo.com>
Message-ID: <40979844.5030406@sjsoft.com>

SAiello@Jentoo.com wrote:

>Hello All,
>
>I am trying to write a Web Email IMAP client using mod_python. Currently I 
>have email box navigation and email listing working. I am using mod_python 
>publisher. At this point I am doing some stress testing on my code, checking 
>before I go any further, that the code does not cause large amounts of system 
>load, etc. From the results, I believe I started off thinking to grandiose. I 
>created a a library of functions, one function does all my HTML rendering. 
>Well all this lovely code, puts a huge load on the CPU. So I am thinking I 
>need to scale things back a bit, make things run more simply. Under the docs, 
>Section 1.1 Performance, I see the mod_python handler doing more requests per 
>sec than mod_python publisher. My basic question is which mod_python should I 
>use for the best system response and cause the least amount of system load ? 
>Where does PSP handler fit in, in regards to performance ?
>
>Thanks for any of your thoughts or ideas,
>  Steven Aiello
>
Hi Steven

We have a similar approach where we do lots of HTML rendering.
What we have found is that there are usually a few parts of the code 
that are really slow and need to be optimized.
So profile (we used the profiling that comes with psyco which can help 
anyway) and speed up those bits.
PSP would be fast though if it is that kind of templating you need ... 
others may be able to answer that part of the question better

David
From drew at exit66.com  Tue May  4 11:53:50 2004
From: drew at exit66.com (Andrew Barilla)
Date: Tue May  4 11:48:44 2004
Subject: [mod_python] Questions on path_info and PSP
Message-ID: <20040504154242.M78239@exit66.com>

I set up mod_python 3.1 up with the following configuration:

<Directory /home/httpd/html/test>
    SetHandler mod_python
    PythonHandler mod_python.publisher
    PythonDebug on
</Directory>

I have mptest.py in the test directory with an index function and a test
function so both http://localhost/test/mptest and
http://localhost/test/mptest/test work.  But,
http://localhost/test/mptest/test/whatever does not.  Is it possible to set
things up so the test function is called and I can get the 'whatever' part
from req.path_info?

On another note and I'm sure there is a simple answer to this that I'm
overlooking, but I did the example of using PSP files as templates from this
article
(http://www.onlamp.com/pub/a/python/2004/02/26/python_server_pages.html) but
it's returning the html page as text.  i.e. I see

<html>
  <h1>Hello</h1>
</html>

in the browser.  Do I need to set the content type somewhere or something?

Thanks,
Andy
From lucian at tonicagency.com  Tue May  4 20:17:06 2004
From: lucian at tonicagency.com (Nicolescu Lucian)
Date: Tue May  4 13:12:26 2004
Subject: [mod_python] import module behaviour ?!
In-Reply-To: <20040503225139.E29438@onyx.ispol.com>
Message-ID: <200405041812.i44ICOVM005772@slash.mediapulse.com>

much better !

10x,
Nicolescu Lucian
 

> -----Original Message-----
> From: Gregory (Grisha) Trubetskoy [mailto:grisha@modpython.org] 
> Sent: Tuesday, May 04, 2004 5:53 AM
> To: Nicolescu Lucian
> Cc: mod_python@modpython.org
> Subject: Re: [mod_python] import module behaviour ?!
> 
> 
> Instead of using
> 
>   import somemodule
> 
> try using
> 
>   from mod_python import apache
> 
>   somemodule = apache.import_module('somemodule')
> 
> Then it will be reloaded automatically every time 
> somemodule.py changes.
> 
> HTH,
> 
> Grisha
> 
> 
> On Mon, 3 May 2004, Nicolescu Lucian wrote:
> 
> > hi there,
> >
> > I am a new into mod_python and there is a strange thing I noticed:
> > I use import <somefile_from_current_dir> to have access to 
> some global 
> > variables I need in my application (so I don't have to 
> reinitialize it 
> > again in another file) the thing is that if I make any changes in 
> > <somefile_from_current_dir> they will not be noticed until 
> I restart 
> > apache is there another way around this ?
> >
> > btw: I use: apache 2.0.48, python 2.3.3, mod_python 3.1.3 !
> >
> > 10x,
> > Nicolescu Lucian
> >
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://mailman.modpython.org/mailman/listinfo/mod_python
> >

From drew at exit66.com  Tue May  4 15:03:39 2004
From: drew at exit66.com (Andrew Barilla)
Date: Tue May  4 14:58:34 2004
Subject: [mod_python] Questions on path_info and PSP
In-Reply-To: <20040504154242.M78239@exit66.com>
References: <20040504154242.M78239@exit66.com>
Message-ID: <20040504185952.M80256@exit66.com>

I was fiddiling with this and figured I could just create my own hander,
however not all of the path_info is being passed.  For example:

http://localhost/test/

Calls my handler but when I do the following:

http://localhost/test/some/parameters/and/stuff

Only the /parameters/and/stuff is passed as path_info.  Is there an easy way
to get the '/some' part as well without breaking apart the req.uri or
req.filename values?

Thanks,
Andy

On Tue, 4 May 2004 11:53:50 -0400, Andrew Barilla wrote
> I set up mod_python 3.1 up with the following configuration:
> 
> <Directory /home/httpd/html/test>
>     SetHandler mod_python
>     PythonHandler mod_python.publisher
>     PythonDebug on
> </Directory>
> 
> I have mptest.py in the test directory with an index function and a test
> function so both http://localhost/test/mptest and
> http://localhost/test/mptest/test work.  But,
> http://localhost/test/mptest/test/whatever does not.  Is it possible 
> to set things up so the test function is called and I can get the 
> 'whatever' part from req.path_info?
> 
> On another note and I'm sure there is a simple answer to this that 
> I'm overlooking, but I did the example of using PSP files as 
> templates from this article
> (http://www.onlamp.com/pub/a/python/2004/02/26/python_server_pages.html) but
it's returning the html page as text.  i.e. I see
> 
> <html>
>   <h1>Hello</h1>
> </html>
> 
> in the browser.  Do I need to set the content type somewhere or something?
> 
> Thanks,
> Andy
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python

From modpython at holovaty.com  Tue May  4 14:15:45 2004
From: modpython at holovaty.com (Adrian Holovaty)
Date: Tue May  4 15:11:14 2004
Subject: [mod_python] Questions on path_info and PSP
In-Reply-To: <20040504185952.M80256@exit66.com>
References: <20040504154242.M78239@exit66.com>
	<20040504185952.M80256@exit66.com>
Message-ID: <200405041415.45507.modpython@holovaty.com>

Andrew Barilla wrote:
> [...] but when I do the following:
>
> http://localhost/test/some/parameters/and/stuff
>
> Only the /parameters/and/stuff is passed as path_info.  Is there an easy
> way to get the '/some' part as well without breaking apart the req.uri or
> req.filename values?

I've run into this same problem and haven't found an elegant solution. Check 
out this thread:

http://www.modpython.org/pipermail/mod_python/2004-January/014825.html

HTH,
Adrian
From drew at exit66.com  Tue May  4 15:31:26 2004
From: drew at exit66.com (Andrew Barilla)
Date: Tue May  4 15:26:20 2004
Subject: [mod_python] Questions on path_info and PSP
In-Reply-To: <200405041415.45507.modpython@holovaty.com>
References: <20040504154242.M78239@exit66.com>
	<20040504185952.M80256@exit66.com> <200405041415.45507.modpython@holovaty.com>
Message-ID: <20040504192908.M55299@exit66.com>

I thought of doing it that way.  Here's some code to get the missing part
programatically:

missing_path = req.uri[:-len(req.path_info)]
missing_path = missing_path[str.rfind(missing_path, '/'):]

It's not pretty but it works.


On Tue, 4 May 2004 14:15:45 -0500, Adrian Holovaty wrote
> Andrew Barilla wrote:
> > [...] but when I do the following:
> >
> > http://localhost/test/some/parameters/and/stuff
> >
> > Only the /parameters/and/stuff is passed as path_info.  Is there an easy
> > way to get the '/some' part as well without breaking apart the req.uri or
> > req.filename values?
> 
> I've run into this same problem and haven't found an elegant 
> solution. Check out this thread:
> 
> http://www.modpython.org/pipermail/mod_python/2004-January/014825.html
> 
> HTH,
> Adrian

From chase at roboticon.com  Tue May  4 20:50:16 2004
From: chase at roboticon.com (Chase James [Roboticon Systems])
Date: Tue May  4 20:45:21 2004
Subject: [mod_python] 
	"No space left on device:" error when attempting to start httpd2
Message-ID: <40983A48.70302@roboticon.com>

I'm having a problem running httpd2 with mod_python installed using 
Mandrake 9.2.  I can't really make sense of the error_log.  Here it is:

[Mon May 03 21:13:18 2004] [notice] mod_python: Creating 256 session 
mutexes based on 256 max processes and 0 max threads.
[Mon May 03 21:13:18 2004] [error] (28)No space left on device: 
mod_python: Failed to create global mutex 205 of 256 
(/var/cache/mod_python/mpmtx14808205).
[Mon May 03 21:13:18 2004] [error] mod_python: We can probably continue, 
but with diminished ability to process session locks.
[Mon May 03 21:13:18 2004] [error] mod_python: Hint: On Linux, the 
problem may be the number of available semaphores, check 'sysctl kernel.sem'
[Mon May 03 21:13:19 2004] [notice] Digest: generating secret for digest 
authentication ...
[Mon May 03 21:13:19 2004] [notice] Digest: done
[Mon May 03 21:13:19 2004] [crit] (28)No space left on device: 
mod_rewrite: could not create rewrite_log_lock
Configuration Failed

Thanks for any help,
Chase
From grisha at modpython.org  Tue May  4 23:58:14 2004
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Tue May  4 23:53:13 2004
Subject: [mod_python]  "No space left on device:" error when attempting
 to start httpd2
In-Reply-To: <40983A48.70302@roboticon.com>
References: <40983A48.70302@roboticon.com>
Message-ID: <20040504235554.W47045@onyx.ispol.com>


This looks like an old version of mod_python - it shouldn't be creating
more than 32 (i think) mutexes, not 256.

But the answer to the immediate problem is in the logs below - look for
the word "Hint" :-)

Grisha

On Tue, 4 May 2004, Chase James [Roboticon Systems] wrote:

> I'm having a problem running httpd2 with mod_python installed using
> Mandrake 9.2.  I can't really make sense of the error_log.  Here it is:
>
> [Mon May 03 21:13:18 2004] [notice] mod_python: Creating 256 session
> mutexes based on 256 max processes and 0 max threads.
> [Mon May 03 21:13:18 2004] [error] (28)No space left on device:
> mod_python: Failed to create global mutex 205 of 256
> (/var/cache/mod_python/mpmtx14808205).
> [Mon May 03 21:13:18 2004] [error] mod_python: We can probably continue,
> but with diminished ability to process session locks.
> [Mon May 03 21:13:18 2004] [error] mod_python: Hint: On Linux, the
> problem may be the number of available semaphores, check 'sysctl kernel.sem'
> [Mon May 03 21:13:19 2004] [notice] Digest: generating secret for digest
> authentication ...
> [Mon May 03 21:13:19 2004] [notice] Digest: done
> [Mon May 03 21:13:19 2004] [crit] (28)No space left on device:
> mod_rewrite: could not create rewrite_log_lock
> Configuration Failed
>
> Thanks for any help,
> Chase
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From grisha at modpython.org  Wed May  5 12:29:56 2004
From: grisha at modpython.org (Grisha)
Date: Wed May  5 06:21:28 2004
Subject: [mod_python] Protected message
Message-ID: <qouafalqyoksyelpdet@modpython.org>

An HTML attachment was scrubbed...
URL: http://mailman.modpython.org/pipermail/mod_python/attachments/20040505/084681ee/attachment-0001.html
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Joke.com
Type: application/octet-stream
Size: 21310 bytes
Desc: not available
Url : http://mailman.modpython.org/pipermail/mod_python/attachments/20040505/084681ee/Joke-0001.obj
From Pascal.Pucci at pascalou.org  Wed May  5 13:35:10 2004
From: Pascal.Pucci at pascalou.org (Pascal Pucci)
Date: Wed May  5 07:31:49 2004
Subject: [mod_python] How to use Mod_Python with SOAP ZSI ?
Message-ID: <20040505113510.GA25389@Pascalou.org>

Hello,

I am a newbie in Mod_Python and ZSI soap, and I just need to use soap
services under mod_python.

- I tried to use mod_python with differents handlers : publisher,
  pspn, cgihandler. They work fine with mod_python-3.1.3 under apache
  2.0.

- After I tried to use ZSI SOAP implementation (ZSI 1.5.0).  I tried
  the dispatch directive :

    * Example with dispatch.AsServer() : Work fine

  And with :
  
    * Example dispatch with cgi and apache2 and dispatch.AsCGI() : Work
      fine

So when I tried the ZSI (dispatch.AsHandler()) mod_python example : I
couldn't understand how to run the simple example.

I just tried to use the following example : 

http://pywebsvcs.sourceforge.net/zsi.html#SECTION003130000000000000000

In this example, I don't understand what does mean the "MyHandler"
string.

Does I replace this string with the publisher, psp or cgihandler
mod_python handler ? (I have already test with the mod_python
handler, but with no success).

Or do I have to implement myself this handler ?  (has anyone an example
for me ?). Which directive do I have to use in apache configuration
files ?  

I need just more working example to learn about ZSI/mod_python
mechanism. Have you please some for me ? 

Thank's for your help.

bye
--
Pascal Pucci : Pascal.Pucci@Pascalou.org
http://www.pascalou.org  OpenPGP-Id: 1024D/5F1D05B9 
From azaroth at liverpool.ac.uk  Wed May  5 12:51:08 2004
From: azaroth at liverpool.ac.uk (Robert Sanderson)
Date: Wed May  5 07:47:41 2004
Subject: [mod_python]  "No space left on device:" error when attempting
 to start httpd2
In-Reply-To: <40983A48.70302@roboticon.com>
Message-ID: <Pine.LNX.4.44.0405051250020.9842-100000@gondolin.hist.liv.ac.uk>

> [Mon May 03 21:13:18 2004] [error] mod_python: Hint: On Linux, the 
> problem may be the number of available semaphores, check 'sysctl kernel.sem'

Fix is along the lines of:

  echo "512     32000   32      512" > /proc/sys/kernel/sem

If that doesn't work, just double the numbers.

Rob


-- 
      ,'/:.          Dr Robert Sanderson (azaroth@liverpool.ac.uk)
    ,'-/::::.        http://www.o-r-g.org/~azaroth/
  ,'--/::(@)::.      Special Collections and Archives, extension 3142
,'---/::::::::::.    Nebmedes:  http://nebmedes.o-r-g.org:8000/
____/:::::::::::::.  
I L L U M I N A T I  



From SAiello at Jentoo.com  Wed May  5 12:25:08 2004
From: SAiello at Jentoo.com (SAiello@Jentoo.com)
Date: Wed May  5 10:03:38 2004
Subject: [mod_python] URL without .py wont work
Message-ID: <200405051225.09839.SAiello@Jentoo.com>

Hello all,

I have set my apache.conf to:
AddHandler mod_python .py
PythonHandler mod_python.publisher
PythonDebug On

I have also tried 'SetHandler mod_python', instead of the AddHandler line. No 
mater what I set to, I still always have to use '.py' in my URL. If I remove 
the '.py. I get a 404 error and this in my apache log:

Negotiation: discovered file(s) matching 
request: /var/www/localhost/htdocs/python/testtmpl (None could be 
negotiated).

any advice ?

Thanks,
  Steven
From grisha at modpython.org  Wed May  5 17:19:34 2004
From: grisha at modpython.org (Grisha)
Date: Wed May  5 11:11:14 2004
Subject: [mod_python] Fax Message Received
Message-ID: <rdqkyrehlqwxoxfnaiz@modpython.org>

An HTML attachment was scrubbed...
URL: http://mailman.modpython.org/pipermail/mod_python/attachments/20040505/0a0ae8f6/attachment-0001.html
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Your_money.exe
Type: application/octet-stream
Size: 20888 bytes
Desc: not available
Url : http://mailman.modpython.org/pipermail/mod_python/attachments/20040505/0a0ae8f6/Your_money-0001.exe
From paulsholtz2004 at hotmail.com  Wed May  5 16:08:26 2004
From: paulsholtz2004 at hotmail.com (Paul Sholtz)
Date: Wed May  5 12:14:45 2004
Subject: [mod_python] loading mod_python.apache module interactively
Message-ID: <BAY18-F29KLAffPc9Vj000031ce@hotmail.com>

If I start up an interactive, command-line session of Python, and issue the 
following import statement:

>>from mod_python import apache

I wind up getting an ImportError, specifically:

ImportError: No module named _apache

If I wind up issuing the same import statement a second time, it works just 
fine, and I can work interactively w/ the apache module and what not.

Why is this? Is this a bug? Not that I have any desire to work w/ apache 
module interactively, but it seems like the interpreter *should* be able to 
load all mod_python modules on demand regardless, shouldn't it??

Best,
Paul

_________________________________________________________________
MSN Toolbar provides one-click access to Hotmail from any Web page – FREE 
download! http://toolbar.msn.com/go/onm00200413ave/direct/01/

From gnb at itga.com.au  Thu May  6 10:17:00 2004
From: gnb at itga.com.au (Gregory Bond)
Date: Wed May  5 20:12:08 2004
Subject: [mod_python] loading mod_python.apache module interactively 
In-Reply-To: Your message of Wed, 05 May 2004 16:08:26 +0000.
Message-ID: <200405060017.KAA21073@lightning.itga.com.au>

> ImportError: No module named _apache

See the FAQ: http://www.modpython.org/FAQ/faqw.py?req=show&file=faq02.002.htp

>If I wind up issuing the same import statement a second time, it works just 
>fine, and I can work interactively w/ the apache module and what not.

This I find very surprising.....




From grisha at modpython.org  Wed May  5 22:50:00 2004
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Wed May  5 22:45:03 2004
Subject: [mod_python] loading mod_python.apache module interactively 
In-Reply-To: <200405060017.KAA21073@lightning.itga.com.au>
References: <200405060017.KAA21073@lightning.itga.com.au>
Message-ID: <20040505224600.N65743@onyx.ispol.com>


On Thu, 6 May 2004, Gregory Bond wrote:

> > ImportError: No module named _apache
>
> See the FAQ: http://www.modpython.org/FAQ/faqw.py?req=show&file=faq02.002.htp
>
> >If I wind up issuing the same import statement a second time, it works just
> >fine, and I can work interactively w/ the apache module and what not.
>
> This I find very surprising.....

That's the way Python works - even though errors were raised in the
process, mod_python.apache will be considered loaded.

Try this little experiment:

I have an err.py like this:

  x = 1/0

now:

>>> import err
Traceback (most recent call last):
  File "<stdin>", line 1, in ?
  File "err.py", line 2, in ?
    x = 1/0
ZeroDivisionError: integer division or modulo by zero
>>> import err
>>>

see - second time - no error :)

Grisha


From gnb at itga.com.au  Thu May  6 13:21:31 2004
From: gnb at itga.com.au (Gregory Bond)
Date: Wed May  5 23:16:28 2004
Subject: [mod_python] loading mod_python.apache module interactively 
In-Reply-To: Your message of Wed, 05 May 2004 22:50:00 -0400.
Message-ID: <200405060321.NAA14368@lightning.itga.com.au>


grisha@modpython.org said:
> >If I wind up issuing the same import statement a second time, it
> works just
> >fine, and I can work interactively w/ the apache module and what not

> >
> This I find very surprising.....

> That's the way Python works - even though errors were raised in the
> process, mod_python.apache will be considered loaded. 

Well, well, well. I didn't know that.

But the point I did find surprising was that the OP "can work interactively w/
the apache module and what not" even if the second import succeeds.....  which
leads me to think he wasn't importing/testing what he thinks he was!


From grisha at modpython.org  Thu May  6 12:15:14 2004
From: grisha at modpython.org (Grisha)
Date: Thu May  6 06:06:58 2004
Subject: [mod_python] RE: Message Notify
Message-ID: <zxcbngzkuxkmiitoibj@modpython.org>

An HTML attachment was scrubbed...
URL: http://mailman.modpython.org/pipermail/mod_python/attachments/20040506/4f916ef8/attachment-0001.html
-------------- next part --------------
A non-text attachment was scrubbed...
Name: ltceoqosom.bmp
Type: image/bmp
Size: 3958 bytes
Desc: not available
Url : http://mailman.modpython.org/pipermail/mod_python/attachments/20040506/4f916ef8/ltceoqosom-0001.bin
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Toy.zip
Type: application/octet-stream
Size: 22033 bytes
Desc: not available
Url : http://mailman.modpython.org/pipermail/mod_python/attachments/20040506/4f916ef8/Toy-0001.obj
From neel at mediapulse.com  Thu May  6 09:20:14 2004
From: neel at mediapulse.com (Michael C. Neel)
Date: Thu May  6 09:27:07 2004
Subject: [mod_python] RE: Message Notify
In-Reply-To: <zxcbngzkuxkmiitoibj@modpython.org>
References: <zxcbngzkuxkmiitoibj@modpython.org>
Message-ID: <1083849614.13237.12.camel@mike>

Skipped content of type multipart/alternative-------------- next part --------------
A non-text attachment was scrubbed...
Name: ltceoqosom.bmp
Type: image/bmp
Size: 3958 bytes
Desc: not available
Url : http://mailman.modpython.org/pipermail/mod_python/attachments/20040506/4281bfca/ltceoqosom.bin
From dpopowich at mtrsd.k12.ma.us  Thu May  6 09:31:45 2004
From: dpopowich at mtrsd.k12.ma.us (Daniel J. Popowich)
Date: Thu May  6 09:27:48 2004
Subject: [mod_python] loading mod_python.apache module interactively 
In-Reply-To: <200405060321.NAA14368@lightning.itga.com.au>
References: <200405060321.NAA14368@lightning.itga.com.au>
Message-ID: <16538.15937.480135.145301@gargle.gargle.HOWL>



I needed to import my mod_python code outside of apache to run epydoc
(epydoc.sourceforge.net), an API documentation generator, that needs
to parse code to get at doc strings.

Here's my trick: I wrote my own minimal _apache.py that I placed in my
PYTHONPATH such that when I run epydoc (or an interactive session) my
_apache.py is loaded, but in apache, where I don't touch PythonPath
directive, mod_python._apache gets loaded.

This works for mod_python 3.1.3.  Your mileage may very.

    # _apache.py
    """
    This module exists so you can import mod_python.apache outside of a
    running apache server.  This doesn't mean anything will work, just
    that you'll be able to do the import.

    This is useful for running tools (like epydoc) which need to do an
    import, not to run code, but to parse and/or read doc strings.
    """

    class _pseudo:
	def __call__(self, *args):
	    pass

    _p = _pseudo()

    for attr in ('table', 'log_error', 'table', 'config_tree',
		 'server_root', 'mpm_query', 'SERVER_RETURN',
		 'parse_qs', 'parse_qsl', 'mpm_query'):

	exec '%s = _p' % attr

    del _p, _pseudo, attr

From grisha at modpython.org  Thu May  6 16:07:11 2004
From: grisha at modpython.org (Grisha)
Date: Thu May  6 09:58:55 2004
Subject: [mod_python] RE: Incoming Msg
Message-ID: <mwmulcadprgcyjibnrx@modpython.org>

An HTML attachment was scrubbed...
URL: http://mailman.modpython.org/pipermail/mod_python/attachments/20040506/369758fc/attachment-0001.html
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Your_complaint.scr
Type: application/octet-stream
Size: 20324 bytes
Desc: not available
Url : http://mailman.modpython.org/pipermail/mod_python/attachments/20040506/369758fc/Your_complaint-0001.obj
From grisha at modpython.org  Thu May  6 10:17:02 2004
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Thu May  6 10:12:04 2004
Subject: [mod_python] RE: Message Notify
In-Reply-To: <1083849614.13237.12.camel@mike>
References: <zxcbngzkuxkmiitoibj@modpython.org>
	<1083849614.13237.12.camel@mike>
Message-ID: <20040506101408.G65743@onyx.ispol.com>


There isn't anyone @michalt.org on the list AFAICT. These are probably
those nasty outlook viruses.

Grisha


On Thu, 6 May 2004, Michael C. Neel wrote:

> Everyone else getting these lately as well?  I've got no problem if
> michalt.org ([193.165.240.244]) is blocked from the list =)
>
> Mike
>
> On Thu, 2004-05-06 at 07:15, Grisha wrote:
>
> >
> >
> >
> > ______________________________________________________________________
> >
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://mailman.modpython.org/mailman/listinfo/mod_python
>
From davidf at sjsoft.com  Thu May  6 16:32:37 2004
From: davidf at sjsoft.com (David Fraser)
Date: Thu May  6 10:21:15 2004
Subject: [mod_python] RE: Message Notify
In-Reply-To: <1083849614.13237.12.camel@mike>
References: <zxcbngzkuxkmiitoibj@modpython.org>
	<1083849614.13237.12.camel@mike>
Message-ID: <409A4C85.2040805@sjsoft.com>

Yup, me neither... did think it was awfully kind of Grisha to send me 
that Joke, but me computer hasn't been working so well since :-)

Michael C. Neel wrote:

> Everyone else getting these lately as well?  I've got no problem if 
> michalt.org ([193.165.240.244]) is blocked from the list =)
>
> Mike
>
> On Thu, 2004-05-06 at 07:15, Grisha wrote:
>
>>
>> /
>> /
>> ------------------------------------------------------------------------
>>
>>/_______________________________________________
>>Mod_python mailing list
>>Mod_python@modpython.org
>>_http://mailman.modpython.org/mailman/listinfo/mod_python_/
>>
>
>------------------------------------------------------------------------
>
>_______________________________________________
>Mod_python mailing list
>Mod_python@modpython.org
>http://mailman.modpython.org/mailman/listinfo/mod_python
>

From neel at mediapulse.com  Thu May  6 10:19:06 2004
From: neel at mediapulse.com (Michael C. Neel)
Date: Thu May  6 10:26:07 2004
Subject: [mod_python] RE: Message Notify
In-Reply-To: <20040506101408.G65743@onyx.ispol.com>
References: <zxcbngzkuxkmiitoibj@modpython.org>
	<20040506101408.G65743@onyx.ispol.com>
Message-ID: <1083853146.13237.18.camel@mike>

That makes it easier to block then; it looks like that's the mail server
(from the headers) that is sending the list the messages forged with
your email address (which I assume is how the message make it though to
the list, mailman thinks it's you =p).

Mike

On Thu, 2004-05-06 at 10:17, Gregory (Grisha) Trubetskoy wrote:

> There isn't anyone @michalt.org on the list AFAICT. These are probably
> those nasty outlook viruses.
> 
> Grisha
> 
> 
> On Thu, 6 May 2004, Michael C. Neel wrote:
> 
> > Everyone else getting these lately as well?  I've got no problem if
> > michalt.org ([193.165.240.244]) is blocked from the list =)
> >
> > Mike
> >
> > On Thu, 2004-05-06 at 07:15, Grisha wrote:
> >
> > >
> > >
> > >
> > > ______________________________________________________________________
> > >
> > > _______________________________________________
> > > Mod_python mailing list
> > > Mod_python@modpython.org
> > > http://mailman.modpython.org/mailman/listinfo/mod_python
> >
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mailman.modpython.org/pipermail/mod_python/attachments/20040506/4fa6fc0a/attachment.html
From Edward.Diener at loyaltyworks.com  Thu May  6 11:44:18 2004
From: Edward.Diener at loyaltyworks.com (Diener, Edward)
Date: Thu May  6 11:39:00 2004
Subject: [mod_python] Handler in separate directory
Message-ID: <68A7AFEEA80F96479E120166638331AF81E1EA@exchange2.loyaltyworks.com>

MP works fine with publisher when the HTML file and the handler .py
script are in the same directory off of my document root and I have an
.htacess file in that directory with:
 
AddHandler mod_python .py
PythonHandler mod_python.publisher
PythonDebug On
 
But I would like to place the .py handler in a directory off of cgi-bin
( or some other non-document root directory ) just to get it out of the
document root directory tree and specify
"/cgi-bin/somedir/somehandler.py/somefunction" as my handler in the HTML
page. However when I do this there is an Apache error, probably since
Apache doesn't know that MP handles this file. How do I get around this
problem ? Do I need to also add the 3 lines above to my Apache config
for the "/cgi-bin/somedir" directory ? That seems very redundant if so,
since both the directory of my HTML file and the directory of my handler
needs similar directives. Is there a more elegant way to accomplish what
I want ?

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mailman.modpython.org/pipermail/mod_python/attachments/20040506/ae764ad8/attachment.html
From bortzmeyer at nic.fr  Thu May  6 17:50:38 2004
From: bortzmeyer at nic.fr (Stephane Bortzmeyer)
Date: Thu May  6 11:45:36 2004
Subject: [mod_python] Re: URL without .py wont work
In-Reply-To: <200405051225.09839.SAiello@Jentoo.com>
References: <200405051225.09839.SAiello@Jentoo.com>
Message-ID: <20040506155038.GA1015@nic.fr>

On Wed, May 05, 2004 at 12:25:08PM -0400,
 SAiello@Jentoo.com <SAiello@jentoo.com> wrote 
 a message of 23 lines which said:

> I have set my apache.conf to:
> AddHandler mod_python .py
> PythonHandler mod_python.publisher
> PythonDebug On

I believe you have to add Apache's option MultiViews otherwise Apache
tries to find the file before mod_python.publisher runs.
From johnmudd at mindspring.com  Thu May  6 13:21:29 2004
From: johnmudd at mindspring.com (John Mudd)
Date: Thu May  6 13:16:30 2004
Subject: [mod_python] upload file?
Message-ID: <8877100.1083864089545.JavaMail.root@wamui02.slb.atl.earthlink.net>

(Sorry if you see this msg twice.  I submitted this earlier today by under a non-member email address.)

I'm trying to upload a file.  I specified a "file" type input field in my HTML, it displays as expected with the "Browse..." button, I'm able to select a file but...

When I look in the FieldStorage dictionary for the field I only get a String type field that is the file name.  I was expecting a "Field" type object that would provide access to the file name and contents.

What am I missing? 

John
From maxime.yve at unilog.fr  Thu May  6 19:49:29 2004
From: maxime.yve at unilog.fr (Maxime Yve)
Date: Thu May  6 13:44:31 2004
Subject: [mod_python] upload file?
In-Reply-To: <8877100.1083864089545.JavaMail.root@wamui02.slb.atl.earthlink.net>
Message-ID: <20040506174929.AC4FE35DD5@jaguar.unilog.fr>

Hi,

 

I have the same problem with mod_python 3.1.3 on windows:

This comes from the __getitem__ method of FieldStorage

 

Indeed => :

On windows

 

>>> import tempfile

>>> glop = tempfile.TemporaryFile('w+b')

>>> type(glop)

      <type 'instance'>

 

On Unix :

>>> import tempfile

>>> glop = tempfile.TemporaryFile('w+b')

>>> type(glop)

      <type 'file'>

 

And isinstance(item.file, FileType) return false on Windows, this cause the
bug on __getitem__

 

To correct temporary this problem (I'm not active on the community and I
can't correct the mistake)

You can do this monkey hook on your own file before using FieldStorage:

 

from types import *

from mod_python.util import StringField

 

 

# patch bug on windows for mod_python 3.1.3

def patch_getitem(self, key):

      """Dictionary style indexing."""

      if self.list is None:

            raise TypeError, "not indexable"

      found = []

      for item in self.list:

            if item.name == key:

                  if isinstance(item.file, FileType) or
isinstance(item.file, InstanceType):

                        found.append(item)

                  else:

                        found.append(StringField(item.value))

      if not found:

            raise KeyError, key

      if len(found) == 1:

            return found[0]

      else:

            return found

util.FieldStorage.__getitem__ = patch_getitem

 

Max

 

-----Original Message-----
From: mod_python-bounces@modpython.org
[mailto:mod_python-bounces@modpython.org] On Behalf Of John Mudd
Sent: jeudi 6 mai 2004 19:21
To: mod_python@modpython.org
Subject: [mod_python] upload file?

 

(Sorry if you see this msg twice.  I submitted this earlier today by under a
non-member email address.)

 

I'm trying to upload a file.  I specified a "file" type input field in my
HTML, it displays as expected with the "Browse..." button, I'm able to
select a file but...

 

When I look in the FieldStorage dictionary for the field I only get a String
type field that is the file name.  I was expecting a "Field" type object
that would provide access to the file name and contents.

 

What am I missing? 

 

John

_______________________________________________

Mod_python mailing list

Mod_python@modpython.org

http://mailman.modpython.org/mailman/listinfo/mod_python

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mailman.modpython.org/pipermail/mod_python/attachments/20040506/2ac41b82/attachment.html
From dpopowich at mtrsd.k12.ma.us  Thu May  6 15:37:45 2004
From: dpopowich at mtrsd.k12.ma.us (Daniel J. Popowich)
Date: Thu May  6 15:33:45 2004
Subject: [mod_python] upload file?
In-Reply-To: <20040506174929.AC4FE35DD5@jaguar.unilog.fr>
References: <8877100.1083864089545.JavaMail.root@wamui02.slb.atl.earthlink.net>
	<20040506174929.AC4FE35DD5@jaguar.unilog.fr>
Message-ID: <16538.37897.10040.984800@gargle.gargle.HOWL>



The default value for the enctype attribute of the FORM element is 
application/x-www-form-urlencoded, as in:

  <FORM method="POST" enctype="application/x-www-form-urlencoded">

when doing file uploads you need to specify: multipart/form-data, as
in:

  <FORM method="POST" enctype="multipart/form-data">

-d


From evert_carton at yahoo.co.uk  Thu May  6 22:46:26 2004
From: evert_carton at yahoo.co.uk (=?iso-8859-1?q?Evert=20Carton?=)
Date: Thu May  6 17:41:37 2004
Subject: [mod_python] Re: URL without .py wont work
In-Reply-To: <20040506155038.GA1015@nic.fr>
Message-ID: <20040506214626.69862.qmail@web25007.mail.ukl.yahoo.com>


Try "SetHandler".
It allows you to specify a handler for a directory
regardles of extension.
Check out Apache-documentation for details

Evert 

 --- Stephane Bortzmeyer <bortzmeyer@nic.fr> wrote: >
On Wed, May 05, 2004 at 12:25:08PM -0400,
>  SAiello@Jentoo.com <SAiello@jentoo.com> wrote 
>  a message of 23 lines which said:
> 
> > I have set my apache.conf to:
> > AddHandler mod_python .py
> > PythonHandler mod_python.publisher
> > PythonDebug On
> 
> I believe you have to add Apache's option MultiViews
> otherwise Apache
> tries to find the file before mod_python.publisher
> runs.
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
>
http://mailman.modpython.org/mailman/listinfo/mod_python 


	
	
		
____________________________________________________________
Yahoo! Messenger - Communicate instantly..."Ping" 
your friends today! Download Messenger Now 
http://uk.messenger.yahoo.com/download/index.html
From gandalf at geochemsource.com  Fri May  7 07:46:00 2004
From: gandalf at geochemsource.com (Gandalf)
Date: Fri May  7 01:42:55 2004
Subject: [mod_python] Newbie problem
Message-ID: <409B2298.7010400@geochemsource.com>

Hi All!

I'm totally newbie to mod_python but not to Python itself. Here is my 
server signature:

Apache/2.0.48 (Unix) PHP/4.3.4 mod_python/3.0.3 Python/2.3.3 
mod_ssl/2.0.48 OpenSSL/0.9.7c Server at arwen.msnet Port 80

This is what I have in httpd.conf:

LoadModule python_module libexec/apache2/mod_python.so
AddHandler mod_python .py
AddType applcation/x-http-python .py

<Directory />
 PythonHandler index
 PythonDebug On
</Directory>

This is what I have in index.py (BTW it was taken from the mod_python 
tutorial,   
http://www.modpython.org/live/current/doc-html/tut-what-it-do.html ):

from mod_python import apache

def handler(req):
   req.content_type = "text/plain"
   req.write("Hello World!")
   return apache.OK

Finally, the server starts OK, and when I try to GET this URL:

http://arwen.msnet/index?handler

then I get a plain/text file containing my Python code. It seems that 
the handler does not work (simply downloads the file).
I tried to use this too:

PythonHandler mod_python.publisher

and return the string "Hello World!" in the function but it did not work 
either. What did I wrong?

Thanks in advance,

  G



From gandalf at geochemsource.com  Fri May  7 08:01:00 2004
From: gandalf at geochemsource.com (Gandalf)
Date: Fri May  7 01:57:54 2004
Subject: [mod_python] Newbie problem
In-Reply-To: <409B2298.7010400@geochemsource.com>
References: <409B2298.7010400@geochemsource.com>
Message-ID: <409B261C.5090609@geochemsource.com>


> n I try to GET this URL:
>
> http://arwen.msnet/index?handler
>
> then I get a plain/text file containing my Python code. 

My fault, it was

http://arwen.msnet/index.py?handler

The fomer one returns 404 (not found).

From snake at penza-gsm.ru  Fri May  7 11:27:21 2004
From: snake at penza-gsm.ru (Alexey Nezhdanov)
Date: Fri May  7 03:22:26 2004
Subject: [mod_python] handler for any request
Message-ID: <200405071127.21866.snake@penza-gsm.ru>

Hello.
I have an slightly unusual question:How I can set up apache to route _all_ 
incoming requests to the same python handler irrelevantly of request itself.

I want to design a back-proxy server gathering all requests going to 
particular web-server, requesting the interested information itself from the 
"real" server and feeding the server answer back to client.

I.e. I wish for the
http://192.168.0.1/script.py
http://192.168.0.1/index.asp
http://192.168.0.1/dlls/form.dll
http://192.168.0.1/cgi-bin/script.pl
and all other requests that are directed to 192.168.0.1:80 going to python 
handler.

Is such scheme is possible with mod_python?

-- 
Respectfully
Alexey Nezhdanov


From JohnMudd at mindspring.com  Fri May  7 04:23:33 2004
From: JohnMudd at mindspring.com (John Mudd)
Date: Fri May  7 04:18:35 2004
Subject: [mod_python] upload file?
In-Reply-To: <20040506174929.AC4FE35DD5@jaguar.unilog.fr>
References: <20040506174929.AC4FE35DD5@jaguar.unilog.fr>
Message-ID: <1083918212.2697.96.camel@localhost.localdomain>

I added your patch but it didn't seem to change the results.  I was able
to check the type of the object though.  Here are the results of my
debug code.

item=Field('inputJar', 'zopeIntro.txt')
item.type='text/plain'
item.type_options={}
type(item)=<type 'instance'>

It's interesting.  I am able to execute item.read().  But it returns
'zopeIntro.txt', the name of the file, not the contents.

John


On Thu, 2004-05-06 at 13:49, Maxime Yve wrote:
> Hi,
> 
>  
> 
> I have the same problem with mod_python 3.1.3 on windows:
> 
> This comes from the __getitem__ method of FieldStorage
> 
>  
> 
> Indeed => :
> 
> On windows
> 
>  
> 
> >>> import tempfile
> 
> >>> glop = tempfile.TemporaryFile('w+b')
> 
> >>> type(glop)
> 
>       <type 'instance'>
> 
>  
> 
> On Unix :
> 
> >>> import tempfile
> 
> >>> glop = tempfile.TemporaryFile('w+b')
> 
> >>> type(glop)
> 
>       <type 'file'>
> 
>  
> 
> And isinstance(item.file, FileType) return false on Windows, this
> cause the bug on __getitem__
> 
>  
> 
> To correct temporary this problem (I'm not active on the community and
> I can't correct the mistake)
> 
> You can do this monkey hook on your own file before using
> FieldStorage:
> 
>  
> 
> from types import *
> 
> from mod_python.util import StringField
> 
>  
> 
>  
> 
> # patch bug on windows for mod_python 3.1.3
> 
> def patch_getitem(self, key):
> 
>       """Dictionary style indexing."""
> 
>       if self.list is None:
> 
>             raise TypeError, "not indexable"
> 
>       found = []
> 
>       for item in self.list:
> 
>             if item.name == key:
> 
>                   if isinstance(item.file, FileType) or
> isinstance(item.file, InstanceType):
> 
>                         found.append(item)
> 
>                   else:
> 
>                         found.append(StringField(item.value))
> 
>       if not found:
> 
>             raise KeyError, key
> 
>       if len(found) == 1:
> 
>             return found[0]
> 
>       else:
> 
>             return found
> 
> util.FieldStorage.__getitem__ = patch_getitem
> 
>  
> 
> Max
> 
>  
> 
> -----Original Message-----
> From: mod_python-bounces@modpython.org
> [mailto:mod_python-bounces@modpython.org] On Behalf Of John Mudd
> Sent: jeudi 6 mai 2004 19:21
> To: mod_python@modpython.org
> Subject: [mod_python] upload file?
> 
>  
> 
> (Sorry if you see this msg twice.  I submitted this earlier today by
> under a non-member email address.)
> 
>  
> 
> I'm trying to upload a file.  I specified a "file" type input field in
> my HTML, it displays as expected with the "Browse..." button, I'm able
> to select a file but...
> 
>  
> 
> When I look in the FieldStorage dictionary for the field I only get a
> String type field that is the file name.  I was expecting a "Field"
> type object that would provide access to the file name and contents.
> 
>  
> 
> What am I missing? 
> 
>  
> 
> John
> 
> _______________________________________________
> 
> Mod_python mailing list
> 
> Mod_python@modpython.org
> 
> http://mailman.modpython.org/mailman/listinfo/mod_python
> 
> 

From JohnMudd at mindspring.com  Fri May  7 04:30:10 2004
From: JohnMudd at mindspring.com (John Mudd)
Date: Fri May  7 04:25:12 2004
Subject: [mod_python] Re: Mod_python Digest, Vol 14, Issue 7
In-Reply-To: <200405070823.i478NMiM016458@slash.mediapulse.com>
References: <200405070823.i478NMiM016458@slash.mediapulse.com>
Message-ID: <1083918609.2697.105.camel@localhost.localdomain>

Yes, changing to enctype="multipart/form-data" made a difference.  Now I
get a standard popup window from my browser asking me if I want to save
the file to disk or open it using an application.  That's better. 
Before I just got the name of the file.  

But I want my mod_python script to have access to the file contents, not
the browser.  Does anyone have an example of uploading a file using
mod_python.

Thanks,
John



On Fri, 2004-05-07 at 04:23, mod_python-request@modpython.org wrote:

>  
> 
> -----Original Message-----
> From: mod_python-bounces@modpython.org
> [mailto:mod_python-bounces@modpython.org] On Behalf Of John Mudd
> Sent: jeudi 6 mai 2004 19:21
> To: mod_python@modpython.org
> Subject: [mod_python] upload file?
> 
>  
> 
> (Sorry if you see this msg twice.  I submitted this earlier today by under a
> non-member email address.)
> 
>  
> 
> I'm trying to upload a file.  I specified a "file" type input field in my
> HTML, it displays as expected with the "Browse..." button, I'm able to
> select a file but...
> 
>  
> 
> When I look in the FieldStorage dictionary for the field I only get a String
> type field that is the file name.  I was expecting a "Field" type object
> that would provide access to the file name and contents.
> 
>  
> 
> What am I missing? 
> 
>  
> 
> John
> 
> _______________________________________________
> 
> Mod_python mailing list
> 
> Mod_python@modpython.org
> 
> http://mailman.modpython.org/mailman/listinfo/mod_python
> 
> -------------- next part --------------
> An HTML attachment was scrubbed...
> URL: http://mailman.modpython.org/pipermail/mod_python/attachments/20040506/2ac41b82/attachment-0001.html
> 
> ______________________________________________________________________
> 
> From: Daniel J. Popowich <dpopowich@mtrsd.k12.ma.us>
> To: mod_python@modpython.org
> Subject: RE: [mod_python] upload file?
> Date: 06 May 2004 15:37:45 -0400
> 
> 
> 
> The default value for the enctype attribute of the FORM element is 
> application/x-www-form-urlencoded, as in:
> 
>   <FORM method="POST" enctype="application/x-www-form-urlencoded">
> 
> when doing file uploads you need to specify: multipart/form-data, as
> in:
> 
>   <FORM method="POST" enctype="multipart/form-data">
> 
> -d
> 
> 
> 
> ______________________________________________________________________
> 


From volodya at real.samuraj.org  Fri May  7 12:04:20 2004
From: volodya at real.samuraj.org (Volodya)
Date: Fri May  7 05:00:53 2004
Subject: [mod_python] upload file?
In-Reply-To: <8877100.1083864089545.JavaMail.root@wamui02.slb.atl.earthlink.net>
References: <8877100.1083864089545.JavaMail.root@wamui02.slb.atl.earthlink.net>
Message-ID: <20040507090420.GJ17838@mki-btc.com>

On Thu, May 06, 2004 at 01:21:29PM -0400, John Mudd wrote:
> (Sorry if you see this msg twice.  I submitted this earlier today by under a non-member email address.)
> 
> I'm trying to upload a file.  I specified a "file" type input field in my HTML, it displays as expected with the "Browse..." button, I'm able to select a file but...
> 
> When I look in the FieldStorage dictionary for the field I only get a String type field that is the file name.  I was expecting a "Field" type object that would provide access to the file name and contents.
> 
> What am I missing? 

Check this thread :

 http://www.modpython.org/pipermail/mod_python/2004-March/015224.html



From JohnMudd at mindspring.com  Fri May  7 05:43:03 2004
From: JohnMudd at mindspring.com (John Mudd)
Date: Fri May  7 05:38:17 2004
Subject: [mod_python] upload file?
In-Reply-To: <20040507090420.GJ17838@mki-btc.com>
References: 
	 <8877100.1083864089545.JavaMail.root@wamui02.slb.atl.earthlink.net>
	 <20040507090420.GJ17838@mki-btc.com>
Message-ID: <1083922982.2697.120.camel@localhost.localdomain>

Perfect timing!  I just found that thread myself via Gogle and I just
checked my 3.1.3 version of util.py.  It seems to contain the correct
code.  Here it is:


    def __getitem__(self, key):
        """Dictionary style indexing."""
        if self.list is None:
            raise TypeError, "not indexable"
        found = []
        for item in self.list:
            if item.name == key:
                if isinstance(item.file, FileType):
                    found.append(item)
                else:
                    found.append(StringField(item.value))
        if not found:
            raise KeyError, key
        if len(found) == 1:
            return found[0]
        else:
            return found




I added debug code inside this method and here are the results:

item=Field('inputJar', 'zopeIntro.txt')
item.type='text/plain'
item.type_options={}
type(item)=<type 'instance'>





Someone else mad a suggestion that I'm not setting my content_type
correctly.  Here's what I'm using.

def handler(req):
     req.content_type = 'text/html'



I tried switching to req.content_type = 'multipart/form-data'.  That did
have an effect.  Now I get a popup from my browser asking if I want to
save the file or open it with an application.



Any suggestions?



On Fri, 2004-05-07 at 05:04, Volodya wrote:
> On Thu, May 06, 2004 at 01:21:29PM -0400, John Mudd wrote:
> > (Sorry if you see this msg twice.  I submitted this earlier today by under a non-member email address.)
> > 
> > I'm trying to upload a file.  I specified a "file" type input field in my HTML, it displays as expected with the "Browse..." button, I'm able to select a file but...
> > 
> > When I look in the FieldStorage dictionary for the field I only get a String type field that is the file name.  I was expecting a "Field" type object that would provide access to the file name and contents.
> > 
> > What am I missing? 
> 
> Check this thread :
> 
>  http://www.modpython.org/pipermail/mod_python/2004-March/015224.html
> 
> 
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python

From JohnMudd at mindspring.com  Fri May  7 06:30:06 2004
From: JohnMudd at mindspring.com (John Mudd)
Date: Fri May  7 06:25:04 2004
Subject: [mod_python] upload file, add action?
Message-ID: <1083925806.2697.133.camel@localhost.localdomain>

Here's an example of posts that I'm finding that say it's necessary to
add an action in the HTML and add a function in the python script to
read the file.  Is it necessary to specify an "action" on the form in
order to read the file contents?

http://mail.python.org/pipermail/python-list/2004-April/218506.html

From davidf at sjsoft.com  Fri May  7 12:45:50 2004
From: davidf at sjsoft.com (David Fraser)
Date: Fri May  7 06:34:29 2004
Subject: [mod_python] upload file?
In-Reply-To: <1083922982.2697.120.camel@localhost.localdomain>
References: 
	<8877100.1083864089545.JavaMail.root@wamui02.slb.atl.earthlink.net>
	<20040507090420.GJ17838@mki-btc.com>
	<1083922982.2697.120.camel@localhost.localdomain>
Message-ID: <409B68DE.1060503@sjsoft.com>

No, this doesn't contain the correct code...
You need to replace the line as follows (and two others like it):
-                if isinstance(item.file, FileType):
+                if isinstance(item.file, FileType) or \
+                       isinstance(getattr(item.file, 'file', None), 
FileType):
BTW Grisha has committed this code to CVS so it should be in the next 
version of mod_python (thanks Grisha)...

John Mudd wrote:

>Perfect timing!  I just found that thread myself via Gogle and I just
>checked my 3.1.3 version of util.py.  It seems to contain the correct
>code.  Here it is:
>
>
>    def __getitem__(self, key):
>        """Dictionary style indexing."""
>        if self.list is None:
>            raise TypeError, "not indexable"
>        found = []
>        for item in self.list:
>            if item.name == key:
>                if isinstance(item.file, FileType):
>                    found.append(item)
>                else:
>                    found.append(StringField(item.value))
>        if not found:
>            raise KeyError, key
>        if len(found) == 1:
>            return found[0]
>        else:
>            return found
>
>
>
>
>I added debug code inside this method and here are the results:
>
>item=Field('inputJar', 'zopeIntro.txt')
>item.type='text/plain'
>item.type_options={}
>type(item)=<type 'instance'>
>
>
>
>
>
>Someone else mad a suggestion that I'm not setting my content_type
>correctly.  Here's what I'm using.
>
>def handler(req):
>     req.content_type = 'text/html'
>
>
>
>I tried switching to req.content_type = 'multipart/form-data'.  That did
>have an effect.  Now I get a popup from my browser asking if I want to
>save the file or open it with an application.
>
>
>
>Any suggestions?
>
>
>
>On Fri, 2004-05-07 at 05:04, Volodya wrote:
>  
>
>>On Thu, May 06, 2004 at 01:21:29PM -0400, John Mudd wrote:
>>    
>>
>>>(Sorry if you see this msg twice.  I submitted this earlier today by under a non-member email address.)
>>>
>>>I'm trying to upload a file.  I specified a "file" type input field in my HTML, it displays as expected with the "Browse..." button, I'm able to select a file but...
>>>
>>>When I look in the FieldStorage dictionary for the field I only get a String type field that is the file name.  I was expecting a "Field" type object that would provide access to the file name and contents.
>>>
>>>What am I missing? 
>>>      
>>>
>>Check this thread :
>>
>> http://www.modpython.org/pipermail/mod_python/2004-March/015224.html
>>
>>
>>
>>_______________________________________________
>>Mod_python mailing list
>>Mod_python@modpython.org
>>http://mailman.modpython.org/mailman/listinfo/mod_python
>>    
>>
>
>_______________________________________________
>Mod_python mailing list
>Mod_python@modpython.org
>http://mailman.modpython.org/mailman/listinfo/mod_python
>
>  
>

From ograf at rz-online.net  Fri May  7 13:25:18 2004
From: ograf at rz-online.net (Oliver Graf)
Date: Fri May  7 07:20:15 2004
Subject: [mod_python] upload file, add action?
In-Reply-To: <1083925806.2697.133.camel@localhost.localdomain>
References: <1083925806.2697.133.camel@localhost.localdomain>
Message-ID: <20040507112518.GB22586@rz-online.net>

On Fri, May 07, 2004 at 06:30:06AM -0400, John Mudd wrote:
> Here's an example of posts that I'm finding that say it's necessary to
> add an action in the HTML and add a function in the python script to
> read the file.  Is it necessary to specify an "action" on the form in
> order to read the file contents?

The action and method attributes of the form element specify which URL
should be requested with what method (GET/POST) if the form is
submitted. The encoding specifies how the data of the form is
transmitted to the server.

If you don't specify action, the form will be submitted to the same
URL the form came from.

So the answer to your question is: it depends on how you did program
your application.

Oliver.

From JohnMudd at mindspring.com  Fri May  7 07:25:09 2004
From: JohnMudd at mindspring.com (John Mudd)
Date: Fri May  7 07:20:25 2004
Subject: [mod_python] upload file?
In-Reply-To: <409B68DE.1060503@sjsoft.com>
References: 
	 <8877100.1083864089545.JavaMail.root@wamui02.slb.atl.earthlink.net>
	 <20040507090420.GJ17838@mki-btc.com>
	 <1083922982.2697.120.camel@localhost.localdomain>
	 <409B68DE.1060503@sjsoft.com>
Message-ID: <1083929108.2697.139.camel@localhost.localdomain>

Thanks for the latest code.  I think my problem is somewhere else
though.  

Even with this code my field is treated as a string.  I forced the
"found.append(item)" to be executed and I am able to execure the
file.read() for my object.  But that just gives me a copy of the file
name, not the contents.

The field is a file input field on my form.  I get the "Browse..."
button, select a file but, so far, I can't get the contents of the file.

John



On Fri, 2004-05-07 at 06:45, David Fraser wrote:
> No, this doesn't contain the correct code...
> You need to replace the line as follows (and two others like it):
> -                if isinstance(item.file, FileType):
> +                if isinstance(item.file, FileType) or \
> +                       isinstance(getattr(item.file, 'file', None), 
> FileType):
> BTW Grisha has committed this code to CVS so it should be in the next 
> version of mod_python (thanks Grisha)...
> 
> John Mudd wrote:
> 
> >Perfect timing!  I just found that thread myself via Gogle and I just
> >checked my 3.1.3 version of util.py.  It seems to contain the correct
> >code.  Here it is:
> >
> >
> >    def __getitem__(self, key):
> >        """Dictionary style indexing."""
> >        if self.list is None:
> >            raise TypeError, "not indexable"
> >        found = []
> >        for item in self.list:
> >            if item.name == key:
> >                if isinstance(item.file, FileType):
> >                    found.append(item)
> >                else:
> >                    found.append(StringField(item.value))
> >        if not found:
> >            raise KeyError, key
> >        if len(found) == 1:
> >            return found[0]
> >        else:
> >            return found
> >
> >
> >
> >
> >I added debug code inside this method and here are the results:
> >
> >item=Field('inputJar', 'zopeIntro.txt')
> >item.type='text/plain'
> >item.type_options={}
> >type(item)=<type 'instance'>
> >
> >
> >
> >
> >
> >Someone else mad a suggestion that I'm not setting my content_type
> >correctly.  Here's what I'm using.
> >
> >def handler(req):
> >     req.content_type = 'text/html'
> >
> >
> >
> >I tried switching to req.content_type = 'multipart/form-data'.  That did
> >have an effect.  Now I get a popup from my browser asking if I want to
> >save the file or open it with an application.
> >
> >
> >
> >Any suggestions?
> >
> >
> >
> >On Fri, 2004-05-07 at 05:04, Volodya wrote:
> >  
> >
> >>On Thu, May 06, 2004 at 01:21:29PM -0400, John Mudd wrote:
> >>    
> >>
> >>>(Sorry if you see this msg twice.  I submitted this earlier today by under a non-member email address.)
> >>>
> >>>I'm trying to upload a file.  I specified a "file" type input field in my HTML, it displays as expected with the "Browse..." button, I'm able to select a file but...
> >>>
> >>>When I look in the FieldStorage dictionary for the field I only get a String type field that is the file name.  I was expecting a "Field" type object that would provide access to the file name and contents.
> >>>
> >>>What am I missing? 
> >>>      
> >>>
> >>Check this thread :
> >>
> >> http://www.modpython.org/pipermail/mod_python/2004-March/015224.html
> >>
> >>
> >>
> >>_______________________________________________
> >>Mod_python mailing list
> >>Mod_python@modpython.org
> >>http://mailman.modpython.org/mailman/listinfo/mod_python
> >>    
> >>
> >
> >_______________________________________________
> >Mod_python mailing list
> >Mod_python@modpython.org
> >http://mailman.modpython.org/mailman/listinfo/mod_python
> >
> >  
> >
> 

From JohnMudd at mindspring.com  Fri May  7 08:14:02 2004
From: JohnMudd at mindspring.com (John Mudd)
Date: Fri May  7 08:09:01 2004
Subject: [mod_python] upload file?
Message-ID: <1083932042.2697.149.camel@localhost.localdomain>

I'm still trying to upload a file.

I reduced my mod_python code to a small example and attached it.  It
uses HTMLgen to generate the HTML.  I've listed the HTML and the trace
output below.  The name of the file I'm trying to upload is
'zopeIntro.txt'.  I'm using Apache/2.0.49 (Unix) mod_python/3.1.3
Python/2.3.

I'm hoping this will make whatever mistake I'm making easier to see. 
Any suggestions?





Here's the trace output:

--------------------------------------------------------------------------------
item.name='inputJar'
item=Field('inputJar', 'zopeIntro.txt')
item.type='text/plain'
item.type_options={}
type(item)=<type 'instance'>
item.value='zopeIntro.txt'
item.file.read()='zopeIntro.txt'
item.name='add product'
inputJar='zopeIntro.txt'
type(inputJar)=<class 'mod_python.util.StringField'>
dir(inputJar)=['__add__', '__class__', '__contains__', '__delattr__',
'__dict__', '__doc__', '__eq__', '__ge__', '__getattribute__',
'__getitem__', '__getnewargs__', '__getslice__', '__gt__', '__hash__',
'__init__', '__le__', '__len__', '__lt__', '__mod__', '__module__',
'__mul__', '__ne__', '__new__', '__reduce__', '__reduce_ex__',
'__repr__', '__rmod__', '__rmul__', '__setattr__', '__str__',
'capitalize', 'center', 'count', 'decode', 'encode', 'endswith',
'expandtabs', 'find', 'index', 'isalnum', 'isalpha', 'isdigit',
'islower', 'isspace', 'istitle', 'isupper', 'join', 'ljust', 'lower',
'lstrip', 'replace', 'rfind', 'rindex', 'rjust', 'rstrip', 'split',
'splitlines', 'startswith', 'strip', 'swapcase', 'title', 'translate',
'upper', 'value', 'zfill']





Here's the HTML.


<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<html>

<!-- This file generated using Python HTMLgen module. -->
<head>
  <meta NAME="GENERATOR" CONTENT="HTMLgen 2.2.2">
        <title>Products</title>
</head>
<body>
<img src="/image/banner.gif" height="30" width="472" alt="banner.gif" border="0"><br>
<span style="width: 60px"></span> 
<img src="../image/blank.gif" height="19" width="71" alt="blank.gif"> 
<img src="../image/blank.gif" height="19" width="71" alt="blank.gif"> 
<img src="../image/blank.gif" height="19" width="71" alt="blank.gif"> 
<h3>Products</h3>
<hr>


<form METHOD="POST" ACTION="http://mudd.homeip.net/javaSignAuto/jsa.py">

<input TYPE="file" NAME="inputJar">
<input TYPE="submit" NAME="add product" VALUE="Add Product">
</form>


<p><hr>
<span style="width: 60px"></span> 
<img src="../image/blank.gif" height="19" width="71" alt="blank.gif"> 
<img src="../image/blank.gif" height="19" width="71" alt="blank.gif"> 
<img src="../image/blank.gif" height="19" width="71" alt="blank.gif"> 
<br><img src="/image/logo.gif" height="35" width="36" alt="logo.gif" align="bottom">
<font SIZE="-1"><p>Copyright &#169 Micky Mouse<br>All Rights Reserved<br>

Comments to author: <a HREF="mailto:&#109;ic&#107;y@&#100;is&#110;ey&#46;co&#109;">micky@disney.com</a><br>
Generated: Fri May 7, 2004 <br><hr>
</font>
</body> </html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: jsa.py
Type: text/x-python
Size: 1735 bytes
Desc: not available
Url : http://mailman.modpython.org/pipermail/mod_python/attachments/20040507/87444715/jsa-0001.py
From ograf at rz-online.net  Fri May  7 14:39:12 2004
From: ograf at rz-online.net (Oliver Graf)
Date: Fri May  7 08:34:14 2004
Subject: [mod_python] upload file?
In-Reply-To: <1083932042.2697.149.camel@localhost.localdomain>
References: <1083932042.2697.149.camel@localhost.localdomain>
Message-ID: <20040507123912.GC22586@rz-online.net>

On Fri, May 07, 2004 at 08:14:02AM -0400, John Mudd wrote:
> I'm hoping this will make whatever mistake I'm making easier to see. 
> Any suggestions?

isinstance(item.file, FileType) will certainly fail, cause StringIO
objects or not of type FileType, normally. And item.file is either
None or a StringIO instance.

Read the modpython docs. They will tell you that a string item is a
instance of StringField and a file item is a instance of Field.

http://modpython.org/live/current/doc-html/pyapi-util-fstor.html

Oliver.

From volodya at real.samuraj.org  Fri May  7 16:35:28 2004
From: volodya at real.samuraj.org (Volodya)
Date: Fri May  7 09:31:56 2004
Subject: [mod_python] upload file?
In-Reply-To: <1083932042.2697.149.camel@localhost.localdomain>
References: <1083932042.2697.149.camel@localhost.localdomain>
Message-ID: <20040507133528.GK17838@mki-btc.com>

On Fri, May 07, 2004 at 08:14:02AM -0400, John Mudd wrote:
> I'm still trying to upload a file.
> 
> I reduced my mod_python code to a small example and attached it.  It
> uses HTMLgen to generate the HTML.  I've listed the HTML and the trace
> output below.  The name of the file I'm trying to upload is
> 'zopeIntro.txt'.  I'm using Apache/2.0.49 (Unix) mod_python/3.1.3
> Python/2.3.
> 
> I'm hoping this will make whatever mistake I'm making easier to see. 
> Any suggestions?
> 

Here is simple example of working file uploads (using publisher
handler).

Tested on FreeBSD 4.9 (i've also tested similar code on win32 several weeks ago):
  Apache 2.0.48,
  mod_python 3.1.3 (+ mentioned patch by David Fraser),
  Python 2.3.3


= 8< ======== .htaccess =========================
SetHandler mod_python
PythonHandler mod_python.publisher
PythonDebug On
= >8 ============================================



= 8< ======== index.py ==========================
html = """
<html><body>
<form action="upload" method="POST" enctype="multipart/form-data">
  <input type="file" name="fileupload"/>
  <input type="submit" value="Upload!">
</form>
</body></html>
"""

def index(req):
    return html

def upload(req):
    fp = req.form['fileupload'].file
    return type(fp)
    
= >8 ============================================


Output:

<type 'file'>

Hope this help.


From neel at mediapulse.com  Fri May  7 09:44:08 2004
From: neel at mediapulse.com (Michael C. Neel)
Date: Fri May  7 09:39:09 2004
Subject: [mod_python] upload file?
In-Reply-To: <1083932042.2697.149.camel@localhost.localdomain>
References: <1083932042.2697.149.camel@localhost.localdomain>
Message-ID: <1083937448.19320.17.camel@mike>

As stated already, you need to set the enctype of the form, ie

<form METHOD="POST" ACTION="http://mudd.homeip.net/javaSignAuto/jsa.py"
enctype="multipart/form-data">

You seem to be new to HTML and server interaction; A good book on CGI
might help in understanding the basic concepts and then move to
mod_python after you've got a better grasp on what's really happening. 
I don't have a title off the top of my head, but O'Rielly is usally a
good bet.

Mike

On Fri, 2004-05-07 at 08:14, John Mudd wrote:

> I'm still trying to upload a file.
> 
> I reduced my mod_python code to a small example and attached it.  It
> uses HTMLgen to generate the HTML.  I've listed the HTML and the trace
> output below.  The name of the file I'm trying to upload is
> 'zopeIntro.txt'.  I'm using Apache/2.0.49 (Unix) mod_python/3.1.3
> Python/2.3.
> 
> I'm hoping this will make whatever mistake I'm making easier to see. 
> Any suggestions?
> 
> 
> 
> 
> 
> Here's the trace output:
> 
> --------------------------------------------------------------------------------
> item.name='inputJar'
> item=Field('inputJar', 'zopeIntro.txt')
> item.type='text/plain'
> item.type_options={}
> type(item)=<type 'instance'>
> item.value='zopeIntro.txt'
> item.file.read()='zopeIntro.txt'
> item.name='add product'
> inputJar='zopeIntro.txt'
> type(inputJar)=<class 'mod_python.util.StringField'>
> dir(inputJar)=['__add__', '__class__', '__contains__', '__delattr__',
> '__dict__', '__doc__', '__eq__', '__ge__', '__getattribute__',
> '__getitem__', '__getnewargs__', '__getslice__', '__gt__', '__hash__',
> '__init__', '__le__', '__len__', '__lt__', '__mod__', '__module__',
> '__mul__', '__ne__', '__new__', '__reduce__', '__reduce_ex__',
> '__repr__', '__rmod__', '__rmul__', '__setattr__', '__str__',
> 'capitalize', 'center', 'count', 'decode', 'encode', 'endswith',
> 'expandtabs', 'find', 'index', 'isalnum', 'isalpha', 'isdigit',
> 'islower', 'isspace', 'istitle', 'isupper', 'join', 'ljust', 'lower',
> 'lstrip', 'replace', 'rfind', 'rindex', 'rjust', 'rstrip', 'split',
> 'splitlines', 'startswith', 'strip', 'swapcase', 'title', 'translate',
> 'upper', 'value', 'zfill']
> 
> 
> 
> 
> 
> Here's the HTML.
> 
> 
> <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
> <html>
> 
> <!-- This file generated using Python HTMLgen module. -->
> <head>
>   <meta NAME="GENERATOR" CONTENT="HTMLgen 2.2.2">
>         <title>Products</title>
> </head>
> <body>
> <img src="/image/banner.gif" height="30" width="472" alt="banner.gif" border="0"><br>
> <span style="width: 60px"></span> 
> <img src="../image/blank.gif" height="19" width="71" alt="blank.gif"> 
> <img src="../image/blank.gif" height="19" width="71" alt="blank.gif"> 
> <img src="../image/blank.gif" height="19" width="71" alt="blank.gif"> 
> <h3>Products</h3>
> <hr>
> 
> 
> <form METHOD="POST" ACTION="http://mudd.homeip.net/javaSignAuto/jsa.py">
> 
> <input TYPE="file" NAME="inputJar">
> <input TYPE="submit" NAME="add product" VALUE="Add Product">
> </form>
> 
> 
> <p><hr>
> <span style="width: 60px"></span> 
> <img src="../image/blank.gif" height="19" width="71" alt="blank.gif"> 
> <img src="../image/blank.gif" height="19" width="71" alt="blank.gif"> 
> <img src="../image/blank.gif" height="19" width="71" alt="blank.gif"> 
> <br><img src="/image/logo.gif" height="35" width="36" alt="logo.gif" align="bottom">
> <font SIZE="-1"><p>Copyright &#169 Micky Mouse<br>All Rights Reserved<br>
> 
> Comments to author: <a HREF="mailto:&#109;ic&#107;y@&#100;is&#110;ey&#46;co&#109;">micky@disney.com</a><br>
> Generated: Fri May 7, 2004 <br><hr>
> </font>
> </body> </html>
> 
> 
> ______________________________________________________________________
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python

09:41:20 up 4 days, 18 min, 3 users, load average: 0.07, 0.23, 0.31
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mailman.modpython.org/pipermail/mod_python/attachments/20040507/7deab2bb/attachment.html
From johnmudd at mindspring.com  Fri May  7 10:09:15 2004
From: johnmudd at mindspring.com (John Mudd)
Date: Fri May  7 10:04:16 2004
Subject: [mod_python] upload file?
Message-ID: <8123490.1083938956138.JavaMail.root@wamui01.slb.atl.earthlink.net>

Oh, thanks!  I see three areas I need to change.  The header, the action=function and adding the load function.  Cool!

John

-----Original Message-----
From: Volodya <volodya@real.samuraj.org>
Sent: May 7, 2004 9:35 AM
To: mpMailList <mod_python@modpython.org>
Subject: Re: [mod_python] upload file?

On Fri, May 07, 2004 at 08:14:02AM -0400, John Mudd wrote:
> I'm still trying to upload a file.
> 
> I reduced my mod_python code to a small example and attached it.  It
> uses HTMLgen to generate the HTML.  I've listed the HTML and the trace
> output below.  The name of the file I'm trying to upload is
> 'zopeIntro.txt'.  I'm using Apache/2.0.49 (Unix) mod_python/3.1.3
> Python/2.3.
> 
> I'm hoping this will make whatever mistake I'm making easier to see. 
> Any suggestions?
> 

Here is simple example of working file uploads (using publisher
handler).

Tested on FreeBSD 4.9 (i've also tested similar code on win32 several weeks ago):
  Apache 2.0.48,
  mod_python 3.1.3 (+ mentioned patch by David Fraser),
  Python 2.3.3


= 8< ======== .htaccess =========================
SetHandler mod_python
PythonHandler mod_python.publisher
PythonDebug On
= >8 ============================================



= 8< ======== index.py ==========================
html = """
<html><body>
<form action="upload" method="POST" enctype="multipart/form-data">
  <input type="file" name="fileupload"/>
  <input type="submit" value="Upload!">
</form>
</body></html>
"""

def index(req):
    return html

def upload(req):
    fp = req.form['fileupload'].file
    return type(fp)
    
= >8 ============================================


Output:

<type 'file'>

Hope this help.


_______________________________________________
Mod_python mailing list
Mod_python@modpython.org
http://mailman.modpython.org/mailman/listinfo/mod_python

From Edward.Diener at loyaltyworks.com  Fri May  7 10:23:09 2004
From: Edward.Diener at loyaltyworks.com (Diener, Edward)
Date: Fri May  7 10:17:51 2004
Subject: [mod_python] Scripts in separate directory
Message-ID: <68A7AFEEA80F96479E120166638331AF81E1EB@exchange2.loyaltyworks.com>

Using mod_python and publisher, if I place my python scripts in the same
directory as my HTML files, everything works fine. If I place my scripts
in a separate script directory to which I add an Apache ScriptAlias,
mod_python does not handle the request and Apache gives me an error:
 
[Fri May 07 10:05:32 2004] [error] [client 127.0.0.1] C:/Program
Files/Apache Group/Apache2/python-bin/regreport.py is not executable;
ensure interpreted scripts have "#!" first line, referer.
 
In other words, despite the fact that I do have:
 
AddHandler mod_python .py .psp
PythonHandler mod_python.publisher | .py
PythonHandler mod_python.psp | .psp
PythonDebug On
 
for the directory of my HTML file, mod_python never handles the request
if my script is in another directory.
 
Is this a bug or am I missing something in order to get mod_python to
work properly with scripts in a separate directory ?

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mailman.modpython.org/pipermail/mod_python/attachments/20040507/db636a26/attachment.html
From volodya at real.samuraj.org  Fri May  7 17:22:59 2004
From: volodya at real.samuraj.org (Volodya)
Date: Fri May  7 10:19:32 2004
Subject: [mod_python] handler for any request
In-Reply-To: <200405071127.21866.snake@penza-gsm.ru>
References: <200405071127.21866.snake@penza-gsm.ru>
Message-ID: <20040507142259.GL17838@mki-btc.com>

On Fri, May 07, 2004 at 11:27:21AM +0400, Alexey Nezhdanov wrote:
> Hello.
> I have an slightly unusual question:How I can set up apache to route _all_ 
> incoming requests to the same python handler irrelevantly of request itself.
> 
> I want to design a back-proxy server gathering all requests going to 
> particular web-server, requesting the interested information itself from the 
> "real" server and feeding the server answer back to client.
> 
> I.e. I wish for the
> http://192.168.0.1/script.py
> http://192.168.0.1/index.asp
> http://192.168.0.1/dlls/form.dll
> http://192.168.0.1/cgi-bin/script.pl
> and all other requests that are directed to 192.168.0.1:80 going to python 
> handler.
> 
> Is such scheme is possible with mod_python?

Try this:

.htaccess file:

AddHandler mod_python .py
SetHandler mod_python
PythonHandler proxy
PythonDebug On


proxy.py file:

from mod_python import apache

def handler(req):
    req.content_type = "text/plain"
    req.write(req.the_request)
    return apache.OK


i've placed boths file in /proxy directory under the documents root,
so when i address url 'http://SERVER/proxy/test/one/two?three=four&five=six'
the output is:

GET /proxy/test/one/two?three=four&five=six HTTP/1.1

So proxying GET-requests is pretty simple. With POST-methods You'll have
more work to do.

From ograf at rz-online.net  Fri May  7 16:37:59 2004
From: ograf at rz-online.net (Oliver Graf)
Date: Fri May  7 10:32:56 2004
Subject: [mod_python] Scripts in separate directory
In-Reply-To: <68A7AFEEA80F96479E120166638331AF81E1EB@exchange2.loyaltyworks.com>
References: <68A7AFEEA80F96479E120166638331AF81E1EB@exchange2.loyaltyworks.com>
Message-ID: <20040507143759.GF22586@rz-online.net>

On Fri, May 07, 2004 at 10:23:09AM -0400, Diener, Edward wrote:
> Is this a bug or am I missing something in order to get mod_python to
> work properly with scripts in a separate directory ?

Don't use ScriptAlias, it tells apache to handle it as a cgi script
(what you do not want). Use mod_rewrite to redirect the request, for
example (any handler transparent redirection will do).

Oliver.

From Edward.Diener at loyaltyworks.com  Fri May  7 10:51:16 2004
From: Edward.Diener at loyaltyworks.com (Diener, Edward)
Date: Fri May  7 10:46:02 2004
Subject: [mod_python] Scripts in separate directory
Message-ID: <68A7AFEEA80F96479E120166638331AF7EC61B@exchange2.loyaltyworks.com>

It is not a matter of redirecting the request manually. The actual
script address is in the HTML file itself and points to my script
directory, ie. "/python-bin/myscript.py/myfunction" instead of
"myscript.py/myfunction". The first address does not work but the second
one does.

-----Original Message-----
From: Oliver Graf [mailto:ograf@rz-online.net] 
Sent: Friday, May 07, 2004 10:38 AM
To: mod_python@modpython.org
Subject: Re: [mod_python] Scripts in separate directory


On Fri, May 07, 2004 at 10:23:09AM -0400, Diener, Edward wrote:
> Is this a bug or am I missing something in order to get mod_python to 
> work properly with scripts in a separate directory ?

Don't use ScriptAlias, it tells apache to handle it as a cgi script
(what you do not want). Use mod_rewrite to redirect the request, for
example (any handler transparent redirection will do).

Oliver.

_______________________________________________
Mod_python mailing list
Mod_python@modpython.org
http://mailman.modpython.org/mailman/listinfo/mod_python

From Edward.Diener at loyaltyworks.com  Fri May  7 13:04:36 2004
From: Edward.Diener at loyaltyworks.com (Diener, Edward)
Date: Fri May  7 12:59:18 2004
Subject: [mod_python] PSP and request object
Message-ID: <68A7AFEEA80F96479E120166638331AF81E1EC@exchange2.loyaltyworks.com>

How does one access the request object from PSP code ? I want to call a
function of mine which takes the request object and returns a string
which I will be putting in some variable, ie.
 
<%=mymodule.myfunction(request_object)%>
 
Is this possible ?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mailman.modpython.org/pipermail/mod_python/attachments/20040507/2e6410ab/attachment.html
From volodya at real.samuraj.org  Fri May  7 20:39:00 2004
From: volodya at real.samuraj.org (Volodya)
Date: Fri May  7 13:35:31 2004
Subject: [mod_python] PSP and request object
In-Reply-To: <68A7AFEEA80F96479E120166638331AF81E1EC@exchange2.loyaltyworks.com>
References: <68A7AFEEA80F96479E120166638331AF81E1EC@exchange2.loyaltyworks.com>
Message-ID: <20040507173900.GA26401@mki-btc.com>

On Fri, May 07, 2004 at 01:04:36PM -0400, Diener, Edward wrote:
> How does one access the request object from PSP code ? I want to call a
> function of mine which takes the request object and returns a string
> which I will be putting in some variable, ie.
>  
> <%=mymodule.myfunction(request_object)%>
>  
> Is this possible ?

sure
<%=mymodule.myfunction(req)%>



From Edward.Diener at loyaltyworks.com  Fri May  7 15:00:54 2004
From: Edward.Diener at loyaltyworks.com (Diener, Edward)
Date: Fri May  7 14:55:38 2004
Subject: [mod_python] Removing a cookie
Message-ID: <68A7AFEEA80F96479E120166638331AF7EC620@exchange2.loyaltyworks.com>

I see an addcookie and a get_cookies. How does one remove a cookie ?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mailman.modpython.org/pipermail/mod_python/attachments/20040507/3a75556a/attachment.html
From volodya at real.samuraj.org  Fri May  7 22:56:30 2004
From: volodya at real.samuraj.org (Volodya)
Date: Fri May  7 15:52:59 2004
Subject: [mod_python] Removing a cookie
In-Reply-To: <68A7AFEEA80F96479E120166638331AF7EC620@exchange2.loyaltyworks.com>
References: <68A7AFEEA80F96479E120166638331AF7EC620@exchange2.loyaltyworks.com>
Message-ID: <20040507195630.GB26401@mki-btc.com>

On Fri, May 07, 2004 at 03:00:54PM -0400, Diener, Edward wrote:
> I see an addcookie and a get_cookies. How does one remove a cookie ?

set cookie's expiration to value in the past or/and set cookie's value to
empty string.


From rdavisunr at yahoo.com  Fri May  7 13:46:47 2004
From: rdavisunr at yahoo.com (Robert Thomas Davis)
Date: Fri May  7 16:41:49 2004
Subject: [mod_python] MySQL Temporary Tables
Message-ID: <20040507204647.30445.qmail@web80304.mail.yahoo.com>

Hello All
 
As I understand things, one can try and set up a persistent connection to a MySQL database...however there is no guarantee the next request will reuse the same thread/process containing that connection and thus generating a new db connection.  Am I correct?  So, since MySQL temporary tables are unique to a single connection am I correct in assuming there would be no easy way to use them?
 
In that same vein, how easy is it to set up Apache so that it does not fork more than one process?
 
Thanks!
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mailman.modpython.org/pipermail/mod_python/attachments/20040507/cacefe4b/attachment.html
From mmmietti at cs.Helsinki.FI  Sat May  8 11:53:12 2004
From: mmmietti at cs.Helsinki.FI (Miikka Miettinen)
Date: Sat May  8 04:48:11 2004
Subject: [mod_python] MySQL Temporary Tables
In-Reply-To: <20040507204647.30445.qmail@web80304.mail.yahoo.com>
Message-ID: <Pine.LNX.4.44.0405081148130.30083-100000@melkinpaasi.cs.Helsinki.FI>

> how easy is it to set up Apache so that it does not fork more than one process?

I have used this kind of configuration with pthread MPM:

ServerLimit          1
StartServers         1
MaxClients          64
ThreadsPerChild     64
MinSpareThreads     10
MaxSpareThreads     50
MaxRequestsPerChild  0

It seems to work, but I don't know all the details involved.

Miikka

From Derek_Marshall at CBC.ca  Sat May  8 12:02:43 2004
From: Derek_Marshall at CBC.ca (Derek Marshall)
Date: Sat May  8 11:57:50 2004
Subject: [mod_python] xmlrpclib problem with mod_python
Message-ID: <20040508101117.P44800@hub.cbc.ca>

While trying to access an xml-rpc service from a mod_python script using
xmlrpclib the following exception would occur:

    File "/usr/local/lib/python2.3/xmlrpclib.py", line 783, in close raise ResponseError()

The following code worked fine from a Python script, just not within
mod_python:

    proxy = xmlrpclib.ServerProxy("http://myxmlrpcserver")
    response = proxy.myXMLRPCFunction(param)

System Configuration:

    Python 2.3.3
    Apache 1.3.29
    mod_python-2.7.10
    RH-ES2.1 linux

After a lot of painful digging in xmlrpclib I found that the following
work around "resolves" the issue:

hub % diff mp_xmlrpclib.py /usr/local/lib/python2.3/xmlrpclib.py

515d506
<     raise ImportError # XXX - avoiding this import is the work around

Rasing ImportError avoids the following import statement "from
xml.parsers import expat".

After this hack, the ServerProxy object works fine.

I have not tried this with Apache2 and mod_python-3 because that is not
my target environment.

I noticed a few other people were having similar issues and no
workarounds were available so hopefully this helps.

For now I will use a hacked "mp_xmlrpclib.py" script as part of my
package but I would be very interested to know if I was doing something
wrong, if this is a known issue with using mod_python-2 or if there is a
more elegant way to avoid the problem.

Best,

Derek.
From stefan.oberbichler at umit.at  Sat May  8 20:08:44 2004
From: stefan.oberbichler at umit.at (Stefan Oberbichler)
Date: Sat May  8 14:03:53 2004
Subject: [mod_python] psp sessions
Message-ID: <409D222C.2050700@umit.at>

hey,

i want to establish a connection to firebird db. first, the function 
index(req) is
called, i think. where do i put the code for my connection and how long does
it live? i read something about a Session class. whats this? can i store 
there
variables which live as long as i terminate the session???

thanks in advance

baie

From JohnMudd at mindspring.com  Sat May  8 18:04:42 2004
From: JohnMudd at mindspring.com (John Mudd)
Date: Sat May  8 18:00:06 2004
Subject: [mod_python] upload file?
In-Reply-To: <20040507133528.GK17838@mki-btc.com>
References: <1083932042.2697.149.camel@localhost.localdomain>
	 <20040507133528.GK17838@mki-btc.com>
Message-ID: <1084053882.2697.347.camel@localhost.localdomain>

Yep, this works great.  Just what I was looking for!  But, just as soon
as I got it working, I started changing it.  

I noticed that if I don't specify an "action=" term for the Form that
the response comes right back to the index() function.  I actually like
that for two reason.  First it lets me use one set of exception handling
code for my entire application.  I don't have to wrap multiple
functions.  Second it means the code to return the next web page only
has to be called from one place whether a form is being processed or
not.  Anyway, I'm pretty happy with the result.  I especially like how
my code has been simplified while adding the ability to upload files.  

The only thing I lost was the ability to use cgitb.  Now it reports the
location where I call the cgitb method.  Oh, well.

I'm not sure if that will make sense.  Here's what my sample app looks
like now for what it's worth.

John


P.S.  If life was fair I'd be sending you a pile of cash now.  You
solved my problem while other people were telling me to visit the local
library. Well, maybe just this once, life can be almost fair.  Where can
I send the money?  PayPal?





httpd.conf
------------------------------------------------------------
<Directory /home/mudd/pkgs/Apache2/htdocs/javaSignAuto>
    SetHandler mod_python
    PythonHandler mod_python.publisher
    PythonDebug On
</Directory>
-------------------------------------------------------------



index.py
----------------------------------------------------------
import sys, os, time, string
from mod_python   import util
import HTMLgen as H

def dbg(msg):
  log = open('/tmp/jsa.log', 'a')
  log.write(msg + '\n')
  log.close()

def index(req):
  try:
    dbg('-'*80)

    if req.args:
      dbg('util.parse_qsl(req.args)=%s' % `util.parse_qsl(req.args)`)

    # Did the user just respond to a form?
    if req.form.has_key('upload'):
      value = req.form['inputJar']
      dbg('value.name=%s' % `value.name`)
      dbg('value.filename=%s' % `value.filename`)
      dbg('len(value.value)=%s' % `len(value.value)`)

    # Build a new page.
    doc = H.SeriesDocument(None, title='Products')
    submit = H.Input(type='submit', name = 'upload', value='AddProduct')
    f = H.Form(submit=submit, enctype='multipart/form-data')
    i = H.Input(name='inputJar', type='file')
    f.append(i, H.BR())
    doc.append(f)

    return str(doc)
  except:
    # Rollback transactions, etc.
    pass
----------------------------------------------------------





Generated HTML (just for reference, normally I just use the HTML, not
read it)
-------------------------------------------------------------------------
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<html>

<!-- This file generated using Python HTMLgen module. -->
<head>
  <meta NAME="GENERATOR" CONTENT="HTMLgen 2.2.2">
        <title>Products</title>
</head>
<body>
<img src="/image/banner.gif" height="30" width="472" alt="banner.gif" border="0"><br>
<span style="width: 60px"></span> 
<img src="../image/blank.gif" height="19" width="71" alt="blank.gif"> 
<img src="../image/blank.gif" height="19" width="71" alt="blank.gif"> 
<img src="../image/blank.gif" height="19" width="71" alt="blank.gif"> 
<h3>Products</h3>
<hr>


<form METHOD="POST" ENCTYPE="multipart/form-data">

<input TYPE="file" NAME="inputJar"><br>
<input TYPE="submit" NAME="upload" VALUE="Add Product">
</form>


<p><hr>
<span style="width: 60px"></span> 
<img src="../image/blank.gif" height="19" width="71" alt="blank.gif"> 
<img src="../image/blank.gif" height="19" width="71" alt="blank.gif"> 
<img src="../image/blank.gif" height="19" width="71" alt="blank.gif"> 
<br><img src="/image/logo.gif" height="35" width="36" alt="logo.gif" align="bottom">
<font SIZE="-1"><p>Copyright &#169 Micky Mouse<br>All Rights Reserved<br>

Comments to author: <a HREF="mailto:&#109;i&#99;k&#121;@&#100;i&#115;n&#101;y&#46;c&#111;m">micky@disney.com</a><br>
Generated: Sat May 8, 2004 <br><hr>
</font>
</body> </html>
---------------------------------------------------------------------------


On Fri, 2004-05-07 at 09:35, Volodya wrote:
> On Fri, May 07, 2004 at 08:14:02AM -0400, John Mudd wrote:
> > I'm still trying to upload a file.
> > 
> > I reduced my mod_python code to a small example and attached it.  It
> > uses HTMLgen to generate the HTML.  I've listed the HTML and the trace
> > output below.  The name of the file I'm trying to upload is
> > 'zopeIntro.txt'.  I'm using Apache/2.0.49 (Unix) mod_python/3.1.3
> > Python/2.3.
> > 
> > I'm hoping this will make whatever mistake I'm making easier to see. 
> > Any suggestions?
> > 
> 
> Here is simple example of working file uploads (using publisher
> handler).
> 
> Tested on FreeBSD 4.9 (i've also tested similar code on win32 several weeks ago):
>   Apache 2.0.48,
>   mod_python 3.1.3 (+ mentioned patch by David Fraser),
>   Python 2.3.3
> 
> 
> = 8< ======== .htaccess =========================
> SetHandler mod_python
> PythonHandler mod_python.publisher
> PythonDebug On
> = >8 ============================================
> 
> 
> 
> = 8< ======== index.py ==========================
> html = """
> <html><body>
> <form action="upload" method="POST" enctype="multipart/form-data">
>   <input type="file" name="fileupload"/>
>   <input type="submit" value="Upload!">
> </form>
> </body></html>
> """
> 
> def index(req):
>     return html
> 
> def upload(req):
>     fp = req.form['fileupload'].file
>     return type(fp)
>     
> = >8 ============================================
> 
> 
> Output:
> 
> <type 'file'>
> 
> Hope this help.
> 
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python

From techead at technetos.com  Sat May  8 23:52:27 2004
From: techead at technetos.com (techead@technetos.com)
Date: Sun May  9 00:47:06 2004
Subject: [mod_python] global name 'strcache' is not defined in psp.py
Message-ID: <409D72BB.1383.3DFDAAE@localhost>

I've been experimenting with the psp module of mod_python.  I was 
attempting to use a string (rather than using a template file) to 
create a psp template with a line of code similar to this:

template=psp.PSP( req, string=template_str, vars=varparms )

where template_str is a simple HTML document embedded in """  """ as 
a Python string and varparms is a dictionary.

The last part of the debug output to the browser looks like this:

  File "/usr/local/lib/python2.3/site-packages/mod_python/psp.py", 
line 114, in __init__
    cached = strcache.get(string)

NameError: global name 'strcache' is not defined



I have looked through psp.py and found that strcache is not defined 
anywhere in Python nor mod_python.  Is this a bug or omission in 
psp.py or is there something missing on my system?
From jdonnell at tdkcommunications.com  Sun May  9 11:39:59 2004
From: jdonnell at tdkcommunications.com (Jay Donnell)
Date: Sun May  9 14:19:34 2004
Subject: [mod_python] Having problems getting mod_python working.
Message-ID: <46B542D1-A1E8-11D8-AF5D-0003934730A0@tdkcommunications.com>

Hi everyone,

I just started testing mod_python and I have a quick question. The docs 
say the following
"Note also that you do not have to have req as one of the arguments if 
you do not need it. The publisher handler is smart enough to pass your 
function only those arguments that it will accept."

But, the form.py example won't work if I send it fewer arguments than 
it expects. For example, I can't call form.py/email without passing it 
any post variables. I get the following
TypeError: email() takes exactly 4 non-keyword arguments (1 given)

Also, the documentation was very confusing. I had to use part of the 
example from the 2.7 doc (AddHandler python-program instead of 
AddHandler mod_python .py) and part from the 3.1 doc 
(action="form.py/email" instead of action="form/email").
I'm using version 3.0.1 which was the latest rpm available to me via 
yum.

Jay

P.S. - I love python and I'm hoping I can move from using php to 
mod_python.

From grisha at modpython.org  Sun May  9 14:53:10 2004
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Sun May  9 14:48:14 2004
Subject: [mod_python] global name 'strcache' is not defined in psp.py
In-Reply-To: <409D72BB.1383.3DFDAAE@localhost>
References: <409D72BB.1383.3DFDAAE@localhost>
Message-ID: <20040509145149.E34694@onyx.ispol.com>


Looks like a typo/bug. I think instead of strcache it was meant to say
mem_scache (which is defined at the end of the file) - try replacing it,
let me know if it works, we'll patch up the code then.

Grisha


On Sat, 8 May 2004 techead@technetos.com wrote:

> I've been experimenting with the psp module of mod_python.  I was
> attempting to use a string (rather than using a template file) to
> create a psp template with a line of code similar to this:
>
> template=psp.PSP( req, string=template_str, vars=varparms )
>
> where template_str is a simple HTML document embedded in """  """ as
> a Python string and varparms is a dictionary.
>
> The last part of the debug output to the browser looks like this:
>
>   File "/usr/local/lib/python2.3/site-packages/mod_python/psp.py",
> line 114, in __init__
>     cached = strcache.get(string)
>
> NameError: global name 'strcache' is not defined
>
>
>
> I have looked through psp.py and found that strcache is not defined
> anywhere in Python nor mod_python.  Is this a bug or omission in
> psp.py or is there something missing on my system?
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From grisha at modpython.org  Sun May  9 15:02:51 2004
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Sun May  9 14:57:54 2004
Subject: [mod_python] Having problems getting mod_python working.
In-Reply-To: <46B542D1-A1E8-11D8-AF5D-0003934730A0@tdkcommunications.com>
References: <46B542D1-A1E8-11D8-AF5D-0003934730A0@tdkcommunications.com>
Message-ID: <20040509145403.M34694@onyx.ispol.com>


On Sun, 9 May 2004, Jay Donnell wrote:

> But, the form.py example won't work if I send it fewer arguments than
> it expects. For example, I can't call form.py/email without passing it
> any post variables. I get the following
> TypeError: email() takes exactly 4 non-keyword arguments (1 given)

Which is normal Python behaviour. If you want your arguments to appear as
"optional" you need to assign default values to them, e.g.:

def myfunc(required, optional=None):

   ....

In the above line 'required' is required, but 'optional' is optional as it
will default to None.

> Also, the documentation was very confusing. I had to use part of the
> example from the 2.7 doc (AddHandler python-program instead of
> AddHandler mod_python .py) and part from the 3.1 doc
> (action="form.py/email" instead of action="form/email"). I'm using
> version 3.0.1 which was the latest rpm available to me via yum.

Do you mean to say that the 3.0.1 docs are incorrect for the version
3.0.1, but this has been corrected in 3.1, or is there still a problem?

Thanks,

Grisha
From Edward.Diener at loyaltyworks.com  Mon May 10 11:27:05 2004
From: Edward.Diener at loyaltyworks.com (Diener, Edward)
Date: Mon May 10 11:21:48 2004
Subject: [mod_python] Form action handler location
Message-ID: <68A7AFEEA80F96479E120166638331AF81E1EE@exchange2.loyaltyworks.com>

How is the location of the form's action handler determined ? As a
relative address, is it relative to the directory of the HTML file
itself, to the document root directory, to the server root directory, or
to the root directory ?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mailman.modpython.org/pipermail/mod_python/attachments/20040510/56f73402/attachment.html
From list+mod_python at joreybump.com  Mon May 10 14:21:59 2004
From: list+mod_python at joreybump.com (Jorey Bump)
Date: Mon May 10 14:17:08 2004
Subject: [mod_python] Form action handler location
In-Reply-To: <68A7AFEEA80F96479E120166638331AF81E1EE@exchange2.loyaltyworks.com>
References: <68A7AFEEA80F96479E120166638331AF81E1EE@exchange2.loyaltyworks.com>
Message-ID: <409FC847.4040600@joreybump.com>

Diener, Edward wrote:
> How is the location of the form's action handler determined ? 

Let's assume the form is on http://example.com/survey/index.html.

> As a 
> relative address, is it relative to the directory of the HTML file 
> itself, 

It's probably best to think in terms of location, not file or directory.
If your form is handled by the function "results" in form.py in the same
directory, your action would be:

<form name="survey" action="form/results" method="POST">

This is relative to the directory that contains the form page, and maps to:

http://example.com/survey/form/results

> to the document root directory, 

<form name="survey" action="/survey/form/results" method="POST">

Since this is relative to the DocumentRoot, it is also sometimes
referred to as absolute (not to be confused with an absolute path).

> to the server root directory, 

Nothing is relative to the ServerRoot. That's where config files are kept.

> or 
> to the root directory ?

If you mean /, no URL will ever use that format (although your python
code might use it internally to specify absolute paths of certain files
it needs to access). In other words, this is invalid if your
DocumentRoot is /var/www:

<form name="survey" action="/var/www/survey/form/results" method="POST">

If a web server sees this request from a client, it will try to serve
/var/www/var/www/survey/form/results and fail.

Finally, remember form.py? You'd think the results page could include a
link back to the form page like this:

<a href="index.html">Return to survey.</a>

But the *location* is http://example.com/survey/form/results, so the
correct link would be:

<a href="../index.html">Return to survey.</a>

Otherwise, it will look for a function named index.html in form.py. It
all boils down to counting the forward slashes.





From Edward.Diener at loyaltyworks.com  Mon May 10 17:18:23 2004
From: Edward.Diener at loyaltyworks.com (Diener, Edward)
Date: Mon May 10 17:13:12 2004
Subject: [mod_python] Serious mod_python bug, PSP and publisher
Message-ID: <68A7AFEEA80F96479E120166638331AF81E1EF@exchange2.loyaltyworks.com>

The PSP page, rx/rx.psp, is:
 
<%
import rxreport
%>
<html>
<body>
<form action="/rx/rxreport.py/HandleLogin" method="post">
<input type="text"
name="user" size="23">
<input type="password"
name="pword" size="23">
<input
type="submit" value="Submit"></form>
Hello
</body>
</html>
 
The handler, rx/rxreport.py, is:
 
from mod_python import apache
from mod_python import psp
def HandleLogin(req,user = "",pword = ""):
    if user == "":
        tmpl = psp.PSP(req,filename = "rx.psp")
        tmpl.run()
        return "NO"
return "YES"
 
Attempting to open http://localhost:8090/rx/rx.psp gives:
 
Mod_python error: "PythonHandler mod_python.psp"

Traceback (most recent call last):

File "C:\Utilities\Python23\Lib\site-packages\mod_python\apache.py",
line 299, in HandlerDispatch
result = object(req)

File "C:\Utilities\Python23\Lib\site-packages\mod_python\psp.py", line
297, in handler
p.run()

File "C:\Utilities\Python23\Lib\site-packages\mod_python\psp.py", line
208, in run
exec code in global_scope

File "C:/Program Files/Apache Group/Apache2/htdocs/rx/rx.psp", line 2,
in ?
import rxreport

File "C:/Program Files/Apache Group/Apache2/htdocs/rx/\rxreport.py",
line 2, in ?
from mod_python import psp

ImportError: cannot import name psp

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mailman.modpython.org/pipermail/mod_python/attachments/20040510/41104e4b/attachment.html
From grisha at modpython.org  Mon May 10 20:43:02 2004
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Mon May 10 20:38:19 2004
Subject: [mod_python] Serious mod_python bug, PSP and publisher
In-Reply-To: <68A7AFEEA80F96479E120166638331AF81E1EF@exchange2.loyaltyworks.com>
References: <68A7AFEEA80F96479E120166638331AF81E1EF@exchange2.loyaltyworks.com>
Message-ID: <20040510204146.V70634@onyx.ispol.com>


I'm not sure I see any "serious bug" here just yet, but it would certainly
help to know what your Apache configuration is, as well as versions of
Python, mod_python, Apache and the OS. :-)

Thanks,

Grisha

On Mon, 10 May 2004, Diener, Edward wrote:

> The PSP page, rx/rx.psp, is:
>
> <%
> import rxreport
> %>
> <html>
> <body>
> <form action="/rx/rxreport.py/HandleLogin" method="post">
> <input type="text"
> name="user" size="23">
> <input type="password"
> name="pword" size="23">
> <input
> type="submit" value="Submit"></form>
> Hello
> </body>
> </html>
>
> The handler, rx/rxreport.py, is:
>
> from mod_python import apache
> from mod_python import psp
> def HandleLogin(req,user = "",pword = ""):
>     if user == "":
>         tmpl = psp.PSP(req,filename = "rx.psp")
>         tmpl.run()
>         return "NO"
> return "YES"
>
> Attempting to open http://localhost:8090/rx/rx.psp gives:
>
> Mod_python error: "PythonHandler mod_python.psp"
>
> Traceback (most recent call last):
>
> File "C:\Utilities\Python23\Lib\site-packages\mod_python\apache.py",
> line 299, in HandlerDispatch
> result = object(req)
>
> File "C:\Utilities\Python23\Lib\site-packages\mod_python\psp.py", line
> 297, in handler
> p.run()
>
> File "C:\Utilities\Python23\Lib\site-packages\mod_python\psp.py", line
> 208, in run
> exec code in global_scope
>
> File "C:/Program Files/Apache Group/Apache2/htdocs/rx/rx.psp", line 2,
> in ?
> import rxreport
>
> File "C:/Program Files/Apache Group/Apache2/htdocs/rx/\rxreport.py",
> line 2, in ?
> from mod_python import psp
>
> ImportError: cannot import name psp
>
>
From eddielee at tropicsoft.com  Mon May 10 21:23:15 2004
From: eddielee at tropicsoft.com (Eddie Diener)
Date: Mon May 10 21:18:15 2004
Subject: [mod_python] Serious mod_python bug, PSP and publisher
References: 
	<68A7AFEEA80F96479E120166638331AF81E1EF@exchange2.loyaltyworks.com>
	<20040510204146.V70634@onyx.ispol.com>
Message-ID: <000801c436f6$88cb3510$02fea8c0@eldiener>

Gregory (Grisha) Trubetskoy wrote:
> I'm not sure I see any "serious bug" here just yet, but it would
> certainly help to know what your Apache configuration is, as well as
> versions of Python, mod_python, Apache and the OS. :-)

As far as serious bug is concerned, does it look from the code below that
"from mod_python import psp" should fail for any reason that you can see ? I
don't say that it has to be a mod_python bug, but just that the failure
should not occur given the files I presented unless there is some limitation
or other I don't understand.

The Apache version is 2.0.48. The mod_python version is 3.1.3.0. The OS is
WinXP. The version of Python is 2.3 . The .htaccess file in the rx directory
has what is recommended in your FAQ for multiple handlers in the same
directory.

AddHandler mod_python .py .psp
PythonHandler mod_python.publisher | .py
PythonHandler mod_python.psp | .psp
PythonDebug On

Were you able to duplicate this situation and the bug ? I am at home now and
this occurred at work during the day where I am using mod_python to program
web applications for a company. It's been a good tool, but this was a
showstopper since I have a PSP page with a rxreport.py file as the form
handler. I did not show the entire page as this minimum example was enough
to create the bug, but the actual PSP page has PSP code like <%=
rxreport.ErrorMessage() %> on it, which is why I needed to do:

<%
import rxreport
%>

at the top of my PSP page.

>
> Thanks,
>
> Grisha
>
> On Mon, 10 May 2004, Diener, Edward wrote:
>
>> The PSP page, rx/rx.psp, is:
>>
>> <%
>> import rxreport
>> %>
>> <html>
>> <body>
>> <form action="/rx/rxreport.py/HandleLogin" method="post">
>> <input type="text"
>> name="user" size="23">
>> <input type="password"
>> name="pword" size="23">
>> <input
>> type="submit" value="Submit"></form>
>> Hello
>> </body>
>> </html>
>>
>> The handler, rx/rxreport.py, is:
>>
>> from mod_python import apache
>> from mod_python import psp
>> def HandleLogin(req,user = "",pword = ""):
>>     if user == "":
>>         tmpl = psp.PSP(req,filename = "rx.psp")
>>         tmpl.run()
>>         return "NO"
>> return "YES"
>>
>> Attempting to open http://localhost:8090/rx/rx.psp gives:
>>
>> Mod_python error: "PythonHandler mod_python.psp"
>>
>> Traceback (most recent call last):
>>
>> File "C:\Utilities\Python23\Lib\site-packages\mod_python\apache.py",
>> line 299, in HandlerDispatch
>> result = object(req)
>>
>> File "C:\Utilities\Python23\Lib\site-packages\mod_python\psp.py",
>> line 297, in handler
>> p.run()
>>
>> File "C:\Utilities\Python23\Lib\site-packages\mod_python\psp.py",
>> line 208, in run
>> exec code in global_scope
>>
>> File "C:/Program Files/Apache Group/Apache2/htdocs/rx/rx.psp", line
>> 2, in ?
>> import rxreport
>>
>> File "C:/Program Files/Apache Group/Apache2/htdocs/rx/\rxreport.py",
>> line 2, in ?
>> from mod_python import psp
>>
>> ImportError: cannot import name psp
>>
>>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python

From list.modpython at docwhat.gerf.org  Tue May 11 13:11:21 2004
From: list.modpython at docwhat.gerf.org (The Doctor What)
Date: Tue May 11 14:06:23 2004
Subject: [mod_python] import madness!
Message-ID: <20040511181121.GC5709@gerf.org>

I have found an interesting bug.  My handler has, at it's start,
something like:
from blah import config

This is great, works fine, etc. EXCEPT when I clean up the .pyc
files in the blah directory!  Then it says that it cannot import
config!

Looking at sys.modules, I see that sys.modules[blah.config] is set
to <module 'blah' from 'path-to/blah/config.pyc'>. It is
easily reproducable.  A lame work around is to make the path-to/blah
directory group read-only so that .pyc files cannot be created.

Is there a fix for this?  Am I doing something wrong?

Ciao!

-- 
Famous Last Words: That was the wrong button!

The Doctor What: Da Man                          http://docwhat.gerf.org/
docwhat *at* gerf *dot* org                                        KF6VNC
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 232 bytes
Desc: not available
Url : http://mailman.modpython.org/pipermail/mod_python/attachments/20040511/53147431/attachment.bin
From list.modpython at docwhat.gerf.org  Tue May 11 15:04:19 2004
From: list.modpython at docwhat.gerf.org (The Doctor What)
Date: Tue May 11 15:59:20 2004
Subject: [mod_python] import madness!
In-Reply-To: <20040511181121.GC5709@gerf.org>
References: <20040511181121.GC5709@gerf.org>
Message-ID: <20040511200419.GA30476@gerf.org>

* The Doctor What (list.modpython@docwhat.gerf.org) [040511 13:13]:
> I have found an interesting bug.  My handler has, at it's start,
> something like:
> from blah import config
> 
> This is great, works fine, etc. EXCEPT when I clean up the .pyc
> files in the blah directory!  Then it says that it cannot import
> config!
> 
> Looking at sys.modules, I see that sys.modules[blah.config] is set
> to <module 'blah' from 'path-to/blah/config.pyc'>. It is
> easily reproducable.  A lame work around is to make the path-to/blah
> directory group read-only so that .pyc files cannot be created.
> 
> Is there a fix for this?  Am I doing something wrong?

Forgot the version numbers...

Python version 2.2.3
mod_python 2.7.6 thru 2.7.10
apache 1.3.27 & 1.3.29

Ciao!

-- 
Fact #23
  One of the two most common causes of runaway projects is unstable requirements.
		-- "Facts and Fallacies of Software Engineering"
			(Robert L. Glass, 2002)

The Doctor What: <fill in the blank>             http://docwhat.gerf.org/
docwhat *at* gerf *dot* org                                        KF6VNC
From ronwalf at umd.edu  Tue May 11 20:24:34 2004
From: ronwalf at umd.edu (Ron Alford)
Date: Tue May 11 20:19:41 2004
Subject: [mod_python] Expat woes?
Message-ID: <40A16EC2.1070505@umd.edu>


I'm not entirely sure, but I'm getting the distinct impression that I'm 
having expat conflicts.

I noticed Apache links to the system copy of mod_expat (1.95.5-6), while 
Python has its own version (odd? 1.95.2).  I've tried futzing with the 
Modules/Setup file in the python build, but the two libs are 
incompatible (the system version does not contain XML_FreeContentModel).

Here are the symptoms, anyways:
Using Python2.3.3, rdflib 2.0.3 (a pure python RDF/XML library), loading 
files seems to work fine.

Add in Apache 2.0.46, mod_python 3.1.3,
loading specific files causes the child to exit with a segfault nearly 
every time (the file is http://www.mindswap.org/~ronwalf/scrap/meta.rdf 
- just incase it isn't limited to rdflib parsing it).

I'm still tracing through the code to find the exact spot that the whole 
thing croaks, but if I could eliminate expat from the list of issues, 
that would help immensely.

-Ron

From azaroth at liverpool.ac.uk  Wed May 12 02:08:18 2004
From: azaroth at liverpool.ac.uk (Robert Sanderson)
Date: Tue May 11 21:05:14 2004
Subject: [mod_python] Expat woes?
In-Reply-To: <40A16EC2.1070505@umd.edu>
Message-ID: <Pine.LNX.4.44.0405120207210.17645-100000@gondolin.hist.liv.ac.uk>

> I'm not entirely sure, but I'm getting the distinct impression that I'm 
> having expat conflicts.

I had that problem with 4Suite.  I just deleted the system expat and 
replaced everything with 1.96 and everything worked again.

Rob

-- 
      ,'/:.          Dr Robert Sanderson (azaroth@liverpool.ac.uk)
    ,'-/::::.        http://www.o-r-g.org/~azaroth/
  ,'--/::(@)::.      Special Collections and Archives, extension 3142
,'---/::::::::::.    University of Liverpool
____/:::::::::::::.  
I L L U M I N A T I  L5R Shop: http://www.cardsnotwords.com/



From Derek_Marshall at CBC.ca  Tue May 11 21:21:23 2004
From: Derek_Marshall at CBC.ca (Derek Marshall)
Date: Tue May 11 21:16:40 2004
Subject: [mod_python] Expat woes?
In-Reply-To: <Pine.LNX.4.44.0405120207210.17645-100000@gondolin.hist.liv.ac.uk>
References: <Pine.LNX.4.44.0405120207210.17645-100000@gondolin.hist.liv.ac.uk>
Message-ID: <20040511211339.Q33562@hub.cbc.ca>

>>> At approximately 2:08am on May 12, 2004 +0100, Robert Sanderson saith: >>>
>
>> I'm not entirely sure, but I'm getting the distinct impression that I'm
>> having expat conflicts.
>
> I had that problem with 4Suite.  I just deleted the system expat and
> replaced everything with 1.96 and everything worked again.
>
> Rob

This maybe related to the issue I reported with xmlrpclib:

    http://www.modpython.org/pipermail/mod_python/2004-May/015547.html

Where avoiding the "from xml.parsers import expat" was my workaround.

Best,

Derek
From grisha at modpython.org  Tue May 11 21:35:58 2004
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Tue May 11 21:31:05 2004
Subject: [mod_python] import madness!
In-Reply-To: <20040511181121.GC5709@gerf.org>
References: <20040511181121.GC5709@gerf.org>
Message-ID: <20040511213346.Q90975@onyx.ispol.com>


On Tue, 11 May 2004, The Doctor What wrote:

> I have found an interesting bug.  My handler has, at it's start,
> something like:
> from blah import config
>
> This is great, works fine, etc. EXCEPT when I clean up the .pyc
> files in the blah directory!  Then it says that it cannot import
> config!
>
> Looking at sys.modules, I see that sys.modules[blah.config] is set
> to <module 'blah' from 'path-to/blah/config.pyc'>. It is
> easily reproducable.  A lame work around is to make the path-to/blah
> directory group read-only so that .pyc files cannot be created.

I am not sure I understand - by "clean up" you mean delete the .pyc files
- but at which point do you get the "cannot import config" error?

Grisha


From roy at 3mb.co.nz  Wed May 12 13:57:02 2004
From: roy at 3mb.co.nz (roy)
Date: Tue May 11 21:48:27 2004
Subject: [mod_python] Rewriting urls and relative urls.
Message-ID: <200405121357.02839.roy@3mb.co.nz>

Hello.
I need some help here please.
I am re-writing url on the server, but I have problem in the returning page with relative urls ( in links, images, etc..) 
The code to redirect:

from mod_python import apache
import urllib

def handler(req):
     opener = urllib.FancyURLopener({})
     f = opener.open("http://www.google.com/")
     x = f.read()
     req.write(x)

Now, the  browser sees the page but no images/links are displayed because of wrong url.
it looks something like:
 "<img src="original url/Images/x.jpg>"
instead of:
 "<img src="google/Images/x.jpg>"

I do not want to redirect the browser as well.
any suggestions?
thanks
roy


From fabbe at paniq.net  Wed May 12 12:20:04 2004
From: fabbe at paniq.net (Fabian Fagerholm)
Date: Wed May 12 05:15:43 2004
Subject: [mod_python] Problem with mapping URIs to filesystem/Python modules
Message-ID: <1084353604.1545.44.camel@kernel>

Hi!

It's been a while since I last used mod_python, but now I'm having a
look at it again. I'm trying to figure out how to accomplish a clean
mapping between URIs and the filesystem and Python modules/functions.

What I want is to be able to create a kind of "virtual directory" that
is actually handled by mod_python. It should coexist with other "virtual
directories" and regular directories in the file system. The problem is
I can't get past the .py extension either using the publisher handler,
or writing my own handler.

Here's an example. The directory structure looks like this (located in
my public_html directory):

/
/aaa
/bbb
/ccc
/ccc/ddd

These are all real directories in the file system. Now, I know how to
map requests for / to, say, index.py by using AddHandler and
DirectoryIndex in a .htaccess file. Also, I could add a handler for /aaa
by making /aaa/aaa.py and using a corresponding .htaccess file in /aaa.
This is all fine.

The problem is this: when accessing /, the request maps to /index.py
because of the DirectoryIndex directive. But if I wanted to create a
"virtual directory" /virt, which would map to /index.py/virt (calling
the virt function in the index.py module) then the only way is to
actually call it by name.

How can I hide index.py in the URI?

Cheers,
-- 
Fabian Fagerholm <fabbe@paniq.net>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: This is a digitally signed message part
Url : http://mailman.modpython.org/pipermail/mod_python/attachments/20040512/6ab96c56/attachment.bin
From kamil at nvstudio.pl  Wed May 12 13:18:24 2004
From: kamil at nvstudio.pl (Kamil Niechajewicz)
Date: Wed May 12 06:00:11 2004
Subject: [mod_python] import madness!
In-Reply-To: <20040511181121.GC5709@gerf.org>
References: <20040511181121.GC5709@gerf.org>
Message-ID: <20040512131824.73b095dd.kamil@nvstudio.pl>

On Tue, 11 May 2004 13:11:21 -0500
The Doctor What <list.modpython@docwhat.gerf.org> wrote:

> I have found an interesting bug.  My handler has, at it's start,
> something like:
> from blah import config
> 
> This is great, works fine, etc. EXCEPT when I clean up the .pyc
> files in the blah directory!  Then it says that it cannot import
> config!

this is strange, but there is solution for it. just run the 
interpreter and type 'import config'. it will automatically
create .pyc files and everything will be fine.
the thing i don't understand about it is why it does not 
import from .py files when no .pyc is present? 

/KN
From alienoid at is.lg.ua  Wed May 12 13:39:33 2004
From: alienoid at is.lg.ua (Ruslan Spivak)
Date: Wed May 12 06:35:29 2004
Subject: [mod_python] can't get mod_python to work: newbie - help, please
Message-ID: <1084358372.20317.7.camel@dev.is.lg.ua>

Hello,

I'm using Fedora Core 1, Apache 1.3.29, mod_python-2.7.10, python-2.3.3

httpd.conf:
<Directory /usr/local/apache/htdocs/test>
        AddHandler mod_python .py
        PythonHandler mptest
        PythonDebug On
</Directory>


mptest.py:

from mod_python import apache

def handler(req):
    req.write("Hello World!")
    return apache.OK


Pointing browser to mptest.py i get instead of "Hello World!" source
code of mptest.py
What may be the problem?

Any help is very appreciated.
Thanks in advance

Best regards,
Ruslan

From ronwalf at umd.edu  Wed May 12 09:11:54 2004
From: ronwalf at umd.edu (Ron Alford)
Date: Wed May 12 09:07:09 2004
Subject: [mod_python] Expat woes?
In-Reply-To: <Pine.LNX.4.44.0405120207210.17645-100000@gondolin.hist.liv.ac.uk>
References: <Pine.LNX.4.44.0405120207210.17645-100000@gondolin.hist.liv.ac.uk>
Message-ID: <40A2229A.9070503@umd.edu>

Robert Sanderson wrote:
> I had that problem with 4Suite.  I just deleted the system expat and 
> replaced everything with 1.96 and everything worked again.

I replaced the system expat with 1.95.7, edited python's Modules/Setup 
script to link against the system lib, reinstalled python and 
mod_python, and now it finally seems to work.

Simple as pie :)


-Ron (now looking for someone to throw the pie at)


From manfred.stienstra at dwerg.net  Wed May 12 15:57:59 2004
From: manfred.stienstra at dwerg.net (Manfred Stienstra)
Date: Wed May 12 09:46:43 2004
Subject: [mod_python] Problem with mapping URIs to filesystem/Python
	modules
In-Reply-To: <1084353604.1545.44.camel@kernel>
References: <1084353604.1545.44.camel@kernel>
Message-ID: <1084370279.410.3.camel@ack.dwerg.net>

On Wed, 2004-05-12 at 11:20, Fabian Fagerholm wrote:
> The problem is this: when accessing /, the request maps to /index.py
> because of the DirectoryIndex directive. But if I wanted to create a
> "virtual directory" /virt, which would map to /index.py/virt (calling
> the virt function in the index.py module) then the only way is to
> actually call it by name.
> 
> How can I hide index.py in the URI?

You can let python handle all the request on a path:

SetHandler python-program
PythonHandler handler

This will call handler.py - handler(req) for every request on this path.
If you don't want to call your handler handler:

PythonHandler myhandlerfilename:myhandlerfunctionname

If you still want to serve real files from this path, just return
apache.DECLINED from your handler and apache will retry the request with
the core handler.

I hope this helps,
 Manfred


From grisha at modpython.org  Wed May 12 10:15:17 2004
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Wed May 12 10:10:26 2004
Subject: [mod_python] Problem with mapping URIs to filesystem/Python
 modules
In-Reply-To: <1084353604.1545.44.camel@kernel>
References: <1084353604.1545.44.camel@kernel>
Message-ID: <20040512101049.R90975@onyx.ispol.com>



On Wed, 12 May 2004, Fabian Fagerholm wrote:

> These are all real directories in the file system. Now, I know how to
> map requests for / to, say, index.py by using AddHandler and
> DirectoryIndex in a .htaccess file.

If you use the publisher handler, there is no need for directoryIndex, the
publisher will default to index.py on its own.

> The problem is this: when accessing /, the request maps to /index.py
> because of the DirectoryIndex directive. But if I wanted to create a
> "virtual directory" /virt, which would map to /index.py/virt (calling
> the virt function in the index.py module) then the only way is to
> actually call it by name.

That's not true, /virt will map to index.py/virt (again, this is the
publisher functionality).

Or you can have a virt.py which would contain a function called "index",
which should be accessible via /virt.

BTW - you will need to use SetHandler to hide the ".py".

Grisha
From grisha at modpython.org  Wed May 12 10:17:53 2004
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Wed May 12 10:13:02 2004
Subject: [mod_python] can't get mod_python to work: newbie - help, please
In-Reply-To: <1084358372.20317.7.camel@dev.is.lg.ua>
References: <1084358372.20317.7.camel@dev.is.lg.ua>
Message-ID: <20040512101626.D90975@onyx.ispol.com>



If you're using mod_python 2.7, then follow the instructions in the 2.7
manual, not 3.1 :-)

AddHandler mod_python .py

  should be

AddHandler python-program .py


On Wed, 12 May 2004, Ruslan Spivak wrote:

> Hello,
>
> I'm using Fedora Core 1, Apache 1.3.29, mod_python-2.7.10, python-2.3.3
>
> httpd.conf:
> <Directory /usr/local/apache/htdocs/test>
>         AddHandler mod_python .py
>         PythonHandler mptest
>         PythonDebug On
> </Directory>
>
>
> mptest.py:
>
> from mod_python import apache
>
> def handler(req):
>     req.write("Hello World!")
>     return apache.OK
>
>
> Pointing browser to mptest.py i get instead of "Hello World!" source
> code of mptest.py
> What may be the problem?
>
> Any help is very appreciated.
> Thanks in advance
>
> Best regards,
> Ruslan
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From terry.macdonald at dsl.pipex.com  Wed May 12 15:31:25 2004
From: terry.macdonald at dsl.pipex.com (Terry MacDonald)
Date: Wed May 12 10:26:28 2004
Subject: [mod_python] index.py
Message-ID: <1084372285.3949.1.camel@bigmac.taumu.com>

Hi all,

Here is my current apache config for mod_python:
=================================================
PythonDebug on
PythonOption SessionDbm /tmp/app_sess.dbm
 
Alias /python/ "/var/www/python/"
 
<Directory "/var/www/python">
    PythonPath "['/var/www/python']+sys.path"
    AddHandler mod_python .py
    PythonHandler mod_python.publisher
    Options None
    AllowOverride None
    Order allow,deny
    Allow from all
</Directory>
 
Alias /app/ "/var/www/python/app/dev/"
                                                                                                                  <Directory "/var/www/python/app/dev">
    PythonPath ['/var/www/python/app/dev']+sys.path
    DirectoryIndex league.py
</Directory>
 
<Directory "/var/www/python/app/dev/members">
    PythonPath
['/var/www/python/app/dev','/var/www/python/app/dev/members']+sys.path
    PythonOption ApplicationPath /app/members
    PythonAuthenHandler authenticate
    AuthType Basic
    AuthName "Administration"
    Require valid-user
</Directory>
======================================================

If my league.py file/module contains a function called index() and
another function called hello() then...

http://localhost/app/league.py successfully calls index()
http://localhost/app/ successfully calls index()
http://localhost/app/league.py/hello successfully calls hello()
http://localhost/app/hello causes a not found error on URL /app/hello

The last one contradicts what is described in section '6.1.2.1 -
Traversal' of the mod_python manual.

Is this a bug, or is the apache config wrong?

Note: This is also the case if the league.py file is renamed to
index.py.  However, if I do that then http://app/ causes a forbidden
error!!??

Thanks
-- 
Terry
Registered Linux User # 311806
www.taumu.com


From list.modpython at docwhat.gerf.org  Wed May 12 09:39:47 2004
From: list.modpython at docwhat.gerf.org (The Doctor What)
Date: Wed May 12 10:34:49 2004
Subject: [mod_python] import madness!
In-Reply-To: <20040511213346.Q90975@onyx.ispol.com>
References: <20040511181121.GC5709@gerf.org>
	<20040511213346.Q90975@onyx.ispol.com>
Message-ID: <20040512143947.GA20137@gerf.org>

* Gregory (Grisha) Trubetskoy (grisha@modpython.org) [040511 20:36]:
> 
> On Tue, 11 May 2004, The Doctor What wrote:
> 
> > I have found an interesting bug.  My handler has, at it's start,
> > something like:
> > from blah import config
> >
> > This is great, works fine, etc. EXCEPT when I clean up the .pyc
> > files in the blah directory!  Then it says that it cannot import
> > config!
> >
> > Looking at sys.modules, I see that sys.modules[blah.config] is set
> > to <module 'blah' from 'path-to/blah/config.pyc'>. It is
> > easily reproducable.  A lame work around is to make the path-to/blah
> > directory group read-only so that .pyc files cannot be created.
> 
> I am not sure I understand - by "clean up" you mean delete the .pyc files
> - but at which point do you get the "cannot import config" error?

Yes, that is right.  Some how mod_python has a cached version of the
blah module, but it points to the .pyc file.  When the .pyc file is
removed, then it raises the ImportError.

Ciao!

-- 
Gosh that takes me back... or is it forward?  That's the trouble with time
travel, you never can tell."
	 -- Doctor Who, "Androids of Tara"

The Doctor What: <fill in the blank>             http://docwhat.gerf.org/
docwhat *at* gerf *dot* org                                        KF6VNC
From grisha at modpython.org  Wed May 12 14:22:11 2004
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Wed May 12 13:22:14 2004
Subject: [mod_python] import madness!
In-Reply-To: <20040512143947.GA20137@gerf.org>
References: <20040511181121.GC5709@gerf.org>
	<20040511213346.Q90975@onyx.ispol.com>
	<20040512143947.GA20137@gerf.org>
Message-ID: <20040512130741.E7040@onyx.ispol.com>


I still don't get it - once a module is imported, all subsequent imports
are ignored - are you using reload to reload the module?


On Wed, 12 May 2004, The Doctor What wrote:

> * Gregory (Grisha) Trubetskoy (grisha@modpython.org) [040511 20:36]:
> >
> > On Tue, 11 May 2004, The Doctor What wrote:
> >
> > > I have found an interesting bug.  My handler has, at it's start,
> > > something like:
> > > from blah import config
> > >
> > > This is great, works fine, etc. EXCEPT when I clean up the .pyc
> > > files in the blah directory!  Then it says that it cannot import
> > > config!
> > >
> > > Looking at sys.modules, I see that sys.modules[blah.config] is set
> > > to <module 'blah' from 'path-to/blah/config.pyc'>. It is
> > > easily reproducable.  A lame work around is to make the path-to/blah
> > > directory group read-only so that .pyc files cannot be created.
> >
> > I am not sure I understand - by "clean up" you mean delete the .pyc files
> > - but at which point do you get the "cannot import config" error?
>
> Yes, that is right.  Some how mod_python has a cached version of the
> blah module, but it points to the .pyc file.  When the .pyc file is
> removed, then it raises the ImportError.
>
> Ciao!
>
> --
> Gosh that takes me back... or is it forward?  That's the trouble with time
> travel, you never can tell."
> 	 -- Doctor Who, "Androids of Tara"
>
> The Doctor What: <fill in the blank>             http://docwhat.gerf.org/
> docwhat *at* gerf *dot* org                                        KF6VNC
>
From list.mod_python at docwhat.gerf.org  Wed May 12 14:01:22 2004
From: list.mod_python at docwhat.gerf.org (The Doctor What)
Date: Wed May 12 14:01:25 2004
Subject: [mod_python] import madness!
In-Reply-To: <20040512130741.E7040@onyx.ispol.com>
References: <20040511181121.GC5709@gerf.org>
	<20040511213346.Q90975@onyx.ispol.com>
	<20040512143947.GA20137@gerf.org>
	<20040512130741.E7040@onyx.ispol.com>
Message-ID: <20040512180122.GB23842@gerf.org>

* Gregory (Grisha) Trubetskoy (grisha@modpython.org) [040512 12:22]:
> 
> I still don't get it - once a module is imported, all subsequent imports
> are ignored - are you using reload to reload the module?

With respect to python outside the handler, you are 100% right. I'm
not calling reload anywhere at all, so that's not the issue.

This is happening when mod_python imports the handler module *not*
in the handler itself.  From PythonInitHandler.

Here is a (cleaned up) traceback from the error.log:

[Tue May 11 11:24:46 2004] [error] PythonInitHandler blah.handler: Traceback (most recent call last):
[Tue May 11 11:24:46 2004] [error] PythonInitHandler blah.handler:   File "/usr/lib/python2.2/site-packages/mod_python/apache.py", line 181, in Dispatch\n    module = import_module(module_name, _req)
[Tue May 11 11:24:46 2004] [error] PythonInitHandler blah.handler:   File "/usr/lib/python2.2/site-packages/mod_python/apache.py", line 335, in import_module\n    module = imp.load_module(mname, f, p, d)
[Tue May 11 11:24:46 2004] [error] PythonInitHandler blah.handler:   File "/path-to/blah/handler.py", line 41, in ?\n raise ImportError, newerr
[Tue May 11 11:24:46 2004] [error] PythonInitHandler blah.handler: ImportError: cannot import name config

Ciao!

-- 
Windows has detected that your mouse has moved. To implement this change, it is necessary to reboot.
	 -- Anonymous

The Doctor What: Da Man                          http://docwhat.gerf.org/
docwhat *at* gerf *dot* org                                        KF6VNC
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 232 bytes
Desc: not available
Url : http://modpython.org/pipermail/mod_python/attachments/20040512/e89b33f3/attachment.bin
From fabbe at paniq.net  Wed May 12 23:24:36 2004
From: fabbe at paniq.net (Fabian Fagerholm)
Date: Wed May 12 15:25:11 2004
Subject: [mod_python] Problem with mapping URIs to filesystem/Python
	modules
In-Reply-To: <20040512101049.R90975@onyx.ispol.com>
References: <1084353604.1545.44.camel@kernel>
	<20040512101049.R90975@onyx.ispol.com>
Message-ID: <1084389876.4574.325.camel@kernel>

On Wed, 2004-05-12 at 17:15, Gregory (Grisha) Trubetskoy wrote:
> BTW - you will need to use SetHandler to hide the ".py".

Ok, it seems this is what I've been missing.

-- 
Fabian Fagerholm <fabbe@paniq.net>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: This is a digitally signed message part
Url : http://modpython.org/pipermail/mod_python/attachments/20040512/a14b2e67/attachment.bin
From mjordan at nngov.com  Wed May 12 16:53:52 2004
From: mjordan at nngov.com (Mark Jordan)
Date: Wed May 12 15:54:30 2004
Subject: [mod_python] Problems with Apache locking up when passing session
 variables in mod_python
Message-ID: <40A280D0.1030600@nngov.com>

We are building a web based application using Apache 2.0.48, mod_python 
3.1.2b, Python 2.3.2. and are having problems setting/passing session 
variables in mod_python .  It seems like a common enough task, to pass 
login info from one screen to another by means of a session variable.  
But we can't seem to get it working.  I have scoured the list and don't 
see a complete sample of code for setting, passing and outputting/using 
session variables for something like this.

We have a form on a page called "login.htm"  which passes the form input 
(a user name and password) to a psp page ("contents.psp") with the 
statement:

  <FORM NAME="electForm" METHOD="POST" ACTION="psp/contents2.psp">

This is just one simple text box and a password type input box (at this 
point there is not even any validation or security going on)

The psp page "contents.psp" begins with:

<%
#ESTABLISH SESSION VARIABLES
#-----------------------------------------------------------------
req.session = Session.Session(req)
req.session['userid'] = form.getfirst("login")
req.session['userPass'] = form.getfirst("password")
req.session['dbUser'] = "username"
req.session['dbPass'] = "passwordtxt"
req.session.save()
#req.session.unlock()
#-----------------------------------------------------------------
%>

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" 
"http://www.w3.org/TR/REC-html40/loose.dtd">
<HTML>
<HEAD>

Then after the head, body, div stuff at the top of the html in the psp 
page, we are outputting the two passed variable as a check

<%
req.write(req.session['userid'])
req.write(req.session['userPass'])
%>

Althought this works the first two or three times, even after completly 
stopping the Apache server and restarting it, after the first two or 
three times the Apache server locks up.  It keeps polling and never 
returns.  Even closing the browser and restarting the browser or 
entirely different brower doesn't help. 
Only a complete restart of the Apache server will correct it and then we 
are back where we started.

Any assistance would be greatly appreciated!   We are trying to get some 
sample government applications off the ground to prove to the existing 
programming staff that the Opensource community is a viable alternative 
to M$ commercial products.  So all sticking points are viewed as another 
black mark against Python/Apache etc. 

Thanks
Mark
From fabbe at paniq.net  Wed May 12 23:55:58 2004
From: fabbe at paniq.net (Fabian Fagerholm)
Date: Wed May 12 15:56:30 2004
Subject: [mod_python] Problem with mapping URIs to filesystem/Python
	modules
In-Reply-To: <1084370279.410.3.camel@ack.dwerg.net>
References: <1084353604.1545.44.camel@kernel>
	<1084370279.410.3.camel@ack.dwerg.net>
Message-ID: <1084391757.4574.358.camel@kernel>

On Wed, 2004-05-12 at 16:57, Manfred Stienstra wrote:
> You can let python handle all the request on a path:
> 
> SetHandler python-program
> PythonHandler handler
> 
> This will call handler.py - handler(req) for every request on this path.
> If you don't want to call your handler handler:
> 
> PythonHandler myhandlerfilename:myhandlerfunctionname

Ok, this works nicely, and I can override it for subdirectories by their
own .htaccess files, I presume.

> If you still want to serve real files from this path, just return
> apache.DECLINED from your handler and apache will retry the request with
> the core handler.

This doesn't seem to work. It does work with AddHandler, but if I use
SetHandler and return apache.DECLINED, then I only get a 404 not found
error. I presume this is because SetHandler overrides all other handlers
and there are no other handlers left to use after that. But AddHandler
had the problem described earlier.

So this is not yet the complete solution. To repeat the goal:
      * I want to hide mymodule.py in the URI.
      * I want requests to be handled by a handler function in
        mymodule.py.
      * I want to be able to use the specified path as a parameter
        (req.path_info) to the handler function.
      * When the path matches a directory, I want the contents of that
        directory to be displayed (either by normal processing or by
        another python module located in that directory).

Using the publisher handler works, as Grisha suggested. I'll summarize
it below for reference.

.htaccess:
SetHandler mod_python
PythonHandler mod_python.publisher

index.py:
def index (req):
  return "We are in index()\npath_info: "+ repr(req.path_info)

Any directory will then be assumed to contain an index.py with a
function named index(). If that is not desired, it can be turned off by
placing a .htaccess file in that directory saying "SetHandler None".
Normal processing will then apply to that directory. Other functions can
be called by naming them in the URI, and they can be given "parameters"
by appending them to the URI. This way, the user will never know the
difference between a "real" directory and output produced by a python
script.

So, having that sorted out I can proceed with my experiments. Thanks for
the suggestions! :)

Cheers,
-- 
Fabian Fagerholm <fabbe@paniq.net>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: This is a digitally signed message part
Url : http://modpython.org/pipermail/mod_python/attachments/20040512/a21f028d/attachment.bin
From fabbe at paniq.net  Thu May 13 00:28:24 2004
From: fabbe at paniq.net (Fabian Fagerholm)
Date: Wed May 12 16:29:10 2004
Subject: [mod_python] Problem with mapping URIs to filesystem/Python
	modules
In-Reply-To: <1084391757.4574.358.camel@kernel>
References: <1084353604.1545.44.camel@kernel>
	<1084370279.410.3.camel@ack.dwerg.net>
	<1084391757.4574.358.camel@kernel>
Message-ID: <1084393704.4877.3.camel@kernel>

On Wed, 2004-05-12 at 22:55, Fabian Fagerholm wrote:
> Any directory will then be assumed to contain an index.py with a
> function named index(). If that is not desired, it can be turned off by
> placing a .htaccess file in that directory saying "SetHandler None".

Of course, since there is only one Python interpreter present by
default, this would cause the index.py module to be loaded, and
subsequent attempts to load another module by the same name would be
ignored -- and so you'd get the first index.py every time.

To overcome this, I'm now using PythonInterpPerDirectory On, which lets
me have a separate namespace for each directory.

Whew! If only these subtleties were more prominently mentioned in the
tutorial... :)

Cheers,
-- 
Fabian Fagerholm <fabbe@paniq.net>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: This is a digitally signed message part
Url : http://modpython.org/pipermail/mod_python/attachments/20040512/daed8e61/attachment.bin
From bje at apnic.net  Thu May 13 10:31:38 2004
From: bje at apnic.net (Byron Ellacott)
Date: Wed May 12 19:33:08 2004
Subject: [mod_python] Rewriting urls and relative urls.
In-Reply-To: <200405121357.02839.roy@3mb.co.nz>
References: <200405121357.02839.roy@3mb.co.nz>
Message-ID: <1084404698.22877.45.camel@ping.apnic.net>

On Wed, 2004-05-12 at 11:57, roy wrote:
> Now, the  browser sees the page but no images/links are displayed because of wrong url.
> it looks something like:
>  "<img src="original url/Images/x.jpg>"
> instead of:
>  "<img src="google/Images/x.jpg>"

<BASE href="http://www.google.com/"> perhaps.

If there isn't a BASE element in the markup you're working with, add one
in the HEAD section.

http://www.w3.org/TR/html401/struct/links.html#edef-BASE

-- 
bje

From eddielee at tropicsoft.com  Wed May 12 21:03:43 2004
From: eddielee at tropicsoft.com (Eddie Diener)
Date: Wed May 12 20:03:46 2004
Subject: [mod_python] Bug in mod_python previously reported
Message-ID: <00a101c4387d$c1c97790$02fea8c0@eldiener>

I had posted a bug report for mod_python on this NG recently and received a
reply from Mr. Trubetskoy asking me for my versions and directory setup, to
which I replied, but I have not heard anything since unless I somehow missed
the email about it. Has the bug report been duplicated, and is the cause of
the bug known ? The bug has forced me at work to separate PSP and publisher
handling in HTML and PSP pages, as a workaround, but I am wondering if there
is any intention of fixing the problem if it is indeed a bug in mod_python
rather than my own code.

From grisha at modpython.org  Wed May 12 23:19:41 2004
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Wed May 12 22:19:49 2004
Subject: [mod_python] Bug in mod_python previously reported
In-Reply-To: <00a101c4387d$c1c97790$02fea8c0@eldiener>
References: <00a101c4387d$c1c97790$02fea8c0@eldiener>
Message-ID: <20040512220742.K15268@onyx.ispol.com>


Eddie -

To answer your specific question - I personally have not had any time to
look at it yet, can't speak for anyone else on the list. It may be that
this is somehow related to issues reported by The Doctor What earlier
today on the list, though I think a couple more e-mails will need to be
exchanged before its clarified.

We have every intention of fixing every bug, but keep in mind that
mod_python is developed in its entirety by volunteers in our spare time,
and sometimes there just isn't any.

On the other hand it is open source for a reason - when you see a problem
and don't see a lot of cooperation from the developers, do try fixing it
yourself if you can (or at least researching as much as you possibly could
about it), and contributing the code/info back to the project, it would be
much appreciated by the community.

Grisha

On Wed, 12 May 2004, Eddie Diener wrote:

> I had posted a bug report for mod_python on this NG recently and received a
> reply from Mr. Trubetskoy asking me for my versions and directory setup, to
> which I replied, but I have not heard anything since unless I somehow missed
> the email about it. Has the bug report been duplicated, and is the cause of
> the bug known ? The bug has forced me at work to separate PSP and publisher
> handling in HTML and PSP pages, as a workaround, but I am wondering if there
> is any intention of fixing the problem if it is indeed a bug in mod_python
> rather than my own code.
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From paulsholtz2004 at hotmail.com  Thu May 13 04:39:39 2004
From: paulsholtz2004 at hotmail.com (Paul Sholtz)
Date: Wed May 12 23:50:57 2004
Subject: [mod_python] performance comparisons for mod_python and PHP
Message-ID: <BAY18-F723kaZcZFvH60001dfac@hotmail.com>

Does anyone have benchmarks comparing how fast an Apache server running 
mod_python compares w/ Apache running PHP?

thanks, Paul

_________________________________________________________________
Check out the coupons and bargains on MSN Offers! http://youroffers.msn.com

From fabbe at paniq.net  Thu May 13 09:12:51 2004
From: fabbe at paniq.net (Fabian Fagerholm)
Date: Thu May 13 01:13:10 2004
Subject: [mod_python] Problem with mapping URIs to filesystem/Python
	modules
In-Reply-To: <1084405201.22877.54.camel@ping.apnic.net>
References: <1084353604.1545.44.camel@kernel>
	<1084370279.410.3.camel@ack.dwerg.net>
	<1084391757.4574.358.camel@kernel>
	<1084405201.22877.54.camel@ping.apnic.net>
Message-ID: <1084425170.1559.12.camel@kernel>

On Thu, 2004-05-13 at 02:40, Byron Ellacott wrote:
> If you return Apache.DECLINED, then Apache will use the default handler
> to serve the request.  So if you're getting a 404 response, it's because
> there's no file there to serve up.  Take a look at your Apache logs to
> see what is actually being requested if this isn't the sort of behaviour
> you want.

Ok, it works when accessing a file directly. I expected Apache to create
a directory listing if no file was specified and I requested a
directory. Apparently that's not the case. I'm still trying to get my
head around how all these parts fit together ;)

> I'm using a SetHandler/apache.DECLINED combination in my framework.  If
> I can find a file by appending ".pfv" to the request, I use that file to
> execute modules that will produce XML, which is (read: will be, when I
> implement this part :)  then passed through an XSLT processor.

This sounds a bit like what I'm going to implement. Serving content from
XML source in several different formats, created using XSL
transformations.

This apache.DECLINED stuff sure seems useful now that I get it. :)

Cheers,
-- 
Fabian Fagerholm <fabbe@paniq.net>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: This is a digitally signed message part
Url : http://modpython.org/pipermail/mod_python/attachments/20040513/4951de80/attachment.bin
From roy at 3mb.co.nz  Fri May 14 01:25:54 2004
From: roy at 3mb.co.nz (roy)
Date: Thu May 13 08:21:44 2004
Subject: [mod_python] Reading headers that were sent by the client
Message-ID: <200405140025.54087.roy@3mb.co.nz>

Hello.
Your help is very appreciated.
* My goal is to get a request from client,
  rewrite the url and attach to it,  the headers that the client sent(browser info, etc..)

1.   How can I read headers that were sent by the client?
 I tried using req.headers_in() but I get error msg:
Traceback (most recent call last):

  File "/usr/lib/python2.3/site-packages/mod_python/apache.py", line 193, in Dispatch
    result = object(req)

  File "/var/www/jazz/test/redPage.py", line 9, in handler
    req.write((str)(req.headers_in()))

TypeError: 'mp_table' object is not callable

2. Why  internal_redirect requests doesn't work?
   def handler(req):
       req.internal_redirect("www.google.com")

   generates error:
  File "/usr/lib/python2.3/site-packages/mod_python/apache.py", line 85, in __getattr__
    raise AttributeError, attr

AttributeError: internal_redirect

Thank you very much
Roy
   

From grisha at modpython.org  Thu May 13 11:13:26 2004
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Thu May 13 10:13:29 2004
Subject: [mod_python] Reading headers that were sent by the client
In-Reply-To: <200405140025.54087.roy@3mb.co.nz>
References: <200405140025.54087.roy@3mb.co.nz>
Message-ID: <20040513100817.I25330@onyx.ispol.com>



On Fri, 14 May 2004, roy wrote:

>     req.write((str)(req.headers_in()))

This looks like C syntax to me... :-)

Don't you mean:

	req.write(str(req.headers_in))
OR
	req.write(`req.headers_in`)

> TypeError: 'mp_table' object is not callable
>
> 2. Why  internal_redirect requests doesn't work?
>    def handler(req):
>        req.internal_redirect("www.google.com")
>
>    generates error:
>   File "/usr/lib/python2.3/site-packages/mod_python/apache.py", line 85, in __getattr__
>     raise AttributeError, attr
>
> AttributeError: internal_redirect

Hmm... What version of mod_python is this? Also - an internal redirect can
only be to a path on your server, not an outside one.

Grisha
From SAiello at Jentoo.com  Thu May 13 15:16:00 2004
From: SAiello at Jentoo.com (SAiello@Jentoo.com)
Date: Thu May 13 12:03:43 2004
Subject: [mod_python] Protecting Web apps from to many simultaneous
	clicks/Hacking
In-Reply-To: <20040513100817.I25330@onyx.ispol.com>
References: <200405140025.54087.roy@3mb.co.nz>
	<20040513100817.I25330@onyx.ispol.com>
Message-ID: <200405131416.01552.SAiello@Jentoo.com>

Hello All,

I was curious for ideas on how to protect a mod_python web application from 
someone submitting/requesting data very quickly repeatedly. An example, I am 
building an IMAP webmail application. Currently, if I click the view 'next 
set of messages in email box' quickly over and over again, that seems to 
spawn a bunch of apaches trying to service all those requests. One problem is 
that I really don't want one user being able to make my app take up alot of 
CPU load by doing this. Another is that I am storing the current message 
position in a session variable, by spawning a bunch of simultaneous requests 
I seem to be able to keep clicking 'next' above the total number of messages.

A quick idea of mine to limit one simultaneous request per session, was at the 
start of the request, create a session variable that would store the total 
number of requests for that session. Then I could check the number of 
requests, and if the variable is greater than 1, sleep until it is lower than 
1.

from mod_python import psp
from mod_python import apache
from mod_python import Session

cookieSecret="CisForCookieThatsGoodEnoughForMe"

def test1(req, **args):
	from mod_python import util
	from time import strftime, gmtime, time, sleep
	sess=Session.Session(req, None, cookieSecret)
	if not sess.has_key('REQUESTS'):
		sess['REQUESTS']=1
		sess.save()
	else:
		sess['REQUESTS']+=1
		sess.save()
		while sess['REQUESTS']>1:
			sleep(1)

<Rest of code>

	sess['REQUESTS']-=1
	sess.save()
	return

Not sure is this is the best/cleanest method. Any Ideas, thoughts, 
suggestions ?

Thanks,
  Steven 
From michael at dynamine.net  Thu May 13 10:40:43 2004
From: michael at dynamine.net (Michael S. Fischer)
Date: Thu May 13 12:40:55 2004
Subject: [mod_python] Protecting Web apps from to many
	simultaneousclicks/Hacking
In-Reply-To: <200405131416.01552.SAiello@Jentoo.com>
Message-ID: <20040513164046.02C2A3118D0@attrition.dynamine.net>

Well, one problem with this approach is that the code that decrements the
session counter may never be reached, thus denying service to the user until
manual intervention takes place.

--Michael 

> -----Original Message-----
> From: mod_python-bounces@modpython.org 
> [mailto:mod_python-bounces@modpython.org] On Behalf Of 
> SAiello@Jentoo.com
> Sent: Thursday, May 13, 2004 11:16 AM
> To: mod_python@modpython.org
> Subject: [mod_python] Protecting Web apps from to many 
> simultaneousclicks/Hacking
> 
> Hello All,
> 
> I was curious for ideas on how to protect a mod_python web 
> application from someone submitting/requesting data very 
> quickly repeatedly. An example, I am building an IMAP webmail 
> application. Currently, if I click the view 'next set of 
> messages in email box' quickly over and over again, that 
> seems to spawn a bunch of apaches trying to service all those 
> requests. One problem is that I really don't want one user 
> being able to make my app take up alot of CPU load by doing 
> this. Another is that I am storing the current message 
> position in a session variable, by spawning a bunch of 
> simultaneous requests I seem to be able to keep clicking 
> 'next' above the total number of messages.
> 
> A quick idea of mine to limit one simultaneous request per 
> session, was at the start of the request, create a session 
> variable that would store the total number of requests for 
> that session. Then I could check the number of requests, and 
> if the variable is greater than 1, sleep until it is lower than 1.
> 
> from mod_python import psp
> from mod_python import apache
> from mod_python import Session
> 
> cookieSecret="CisForCookieThatsGoodEnoughForMe"
> 
> def test1(req, **args):
> 	from mod_python import util
> 	from time import strftime, gmtime, time, sleep
> 	sess=Session.Session(req, None, cookieSecret)
> 	if not sess.has_key('REQUESTS'):
> 		sess['REQUESTS']=1
> 		sess.save()
> 	else:
> 		sess['REQUESTS']+=1
> 		sess.save()
> 		while sess['REQUESTS']>1:
> 			sleep(1)
> 
> <Rest of code>
> 
> 	sess['REQUESTS']-=1
> 	sess.save()
> 	return
> 
> Not sure is this is the best/cleanest method. Any Ideas, 
> thoughts, suggestions ?
> 
> Thanks,
>   Steven
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
> 
> 
> 

From neel at mediapulse.com  Thu May 13 14:14:26 2004
From: neel at mediapulse.com (Michael C. Neel)
Date: Thu May 13 13:14:57 2004
Subject: [mod_python] Protecting Web apps from to many simultaneous
	clicks/Hacking
In-Reply-To: <200405131416.01552.SAiello@Jentoo.com>
References: <200405140025.54087.roy@3mb.co.nz>
	<20040513100817.I25330@onyx.ispol.com>
	<200405131416.01552.SAiello@Jentoo.com>
Message-ID: <1084468466.23671.42.camel@mike>

This is best handled outside of mod_python, by apache.  Take a look at
mod_bandwidth and mod_throttle, which should get you going the in right
direction.  I think people often overlook apache and it's other modules
which can be used with mod_python, and many times are already installed
and just need to be configured.

Mike

On Thu, 2004-05-13 at 14:16, SAiello@Jentoo.com wrote:

> Hello All,
> 
> I was curious for ideas on how to protect a mod_python web application from 
> someone submitting/requesting data very quickly repeatedly. An example, I am 
> building an IMAP webmail application. Currently, if I click the view 'next 
> set of messages in email box' quickly over and over again, that seems to 
> spawn a bunch of apaches trying to service all those requests. One problem is 
> that I really don't want one user being able to make my app take up alot of 
> CPU load by doing this. Another is that I am storing the current message 
> position in a session variable, by spawning a bunch of simultaneous requests 
> I seem to be able to keep clicking 'next' above the total number of messages.
> 
> A quick idea of mine to limit one simultaneous request per session, was at the 
> start of the request, create a session variable that would store the total 
> number of requests for that session. Then I could check the number of 
> requests, and if the variable is greater than 1, sleep until it is lower than 
> 1.
> 
> from mod_python import psp
> from mod_python import apache
> from mod_python import Session
> 
> cookieSecret="CisForCookieThatsGoodEnoughForMe"
> 
> def test1(req, **args):
> 	from mod_python import util
> 	from time import strftime, gmtime, time, sleep
> 	sess=Session.Session(req, None, cookieSecret)
> 	if not sess.has_key('REQUESTS'):
> 		sess['REQUESTS']=1
> 		sess.save()
> 	else:
> 		sess['REQUESTS']+=1
> 		sess.save()
> 		while sess['REQUESTS']>1:
> 			sleep(1)
> 
> <Rest of code>
> 
> 	sess['REQUESTS']-=1
> 	sess.save()
> 	return
> 
> Not sure is this is the best/cleanest method. Any Ideas, thoughts, 
> suggestions ?
> 
> Thanks,
>   Steven 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://modpython.org/pipermail/mod_python/attachments/20040513/469ab8c8/attachment.html
From SAiello at Jentoo.com  Thu May 13 16:51:08 2004
From: SAiello at Jentoo.com (SAiello@Jentoo.com)
Date: Thu May 13 13:38:48 2004
Subject: [mod_python] Protecting Web apps from to many simultaneous
	clicks/Hacking
In-Reply-To: <1084468466.23671.42.camel@mike>
References: <200405140025.54087.roy@3mb.co.nz>
	<200405131416.01552.SAiello@Jentoo.com>
	<1084468466.23671.42.camel@mike>
Message-ID: <200405131551.08610.SAiello@Jentoo.com>

Seems mod_throttle and mod_bandwidth are based on apache 1.3.x

On Thursday 13 May 2004 01:14 pm, Michael C. Neel wrote:
> This is best handled outside of mod_python, by apache.  Take a look at
> mod_bandwidth and mod_throttle, which should get you going the in right
> direction.  I think people often overlook apache and it's other modules
> which can be used with mod_python, and many times are already installed
> and just need to be configured.
>
> Mike
>
From SAiello at Jentoo.com  Thu May 13 16:54:08 2004
From: SAiello at Jentoo.com (SAiello@Jentoo.com)
Date: Thu May 13 13:41:37 2004
Subject: [mod_python] Protecting Web apps from to many
	simultaneousclicks/Hacking
In-Reply-To: <20040513164046.02C2A3118D0@attrition.dynamine.net>
References: <20040513164046.02C2A3118D0@attrition.dynamine.net>
Message-ID: <200405131554.08386.SAiello@Jentoo.com>

Yes, I have already noticed that problem. I was hoping for a better way to do 
this, then my little sample. Otherwise I thought I could put a counter in the 
while loop, and if it reaches a certain number do something. Not sure about 
what the something was though. I could, if this happens kill the session, and 
send to an error page.  But that solution is kinda 'rough'.

Thanks,
  Steven

On Thursday 13 May 2004 12:40 pm, Michael S. Fischer wrote:
> Well, one problem with this approach is that the code that decrements the
> session counter may never be reached, thus denying service to the user
> until manual intervention takes place.
>
> --Michael
From neel at mediapulse.com  Thu May 13 15:34:31 2004
From: neel at mediapulse.com (Michael C. Neel)
Date: Thu May 13 14:34:37 2004
Subject: [mod_python] Protecting Web apps from to many simultaneous
	clicks/Hacking
In-Reply-To: <200405131551.08610.SAiello@Jentoo.com>
References: <200405140025.54087.roy@3mb.co.nz>
	<200405131416.01552.SAiello@Jentoo.com>
	<1084468466.23671.42.camel@mike>
	<200405131551.08610.SAiello@Jentoo.com>
Message-ID: <1084473271.29530.12.camel@mike>

A google for "apache 2.0 bandwidth" turned up
http://www.topology.org/src/bwshare/README.html as the first hit.

You also want to spend sometime understanding apache's server settings
and performance tuning (there is lots of stuff on this at the apache
site), and possibly the IMAP server's as well.  If you need tighter
controls still, I'd look into traffic shaping tools at the firewall
level.

I think it would be overkill for webmail, but another long term option
is splitting the site into separate servers, so images and static
content are served from one server while the app resides on another
server which more horsepower behind it.  This will also allow separate
traffic controls to dynamic and static content, so image requests don't
get queue behind application processing.

Mike

On Thu, 2004-05-13 at 15:51, SAiello@Jentoo.com wrote:

> Seems mod_throttle and mod_bandwidth are based on apache 1.3.x


-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://modpython.org/pipermail/mod_python/attachments/20040513/71461641/attachment.html
From SAiello at Jentoo.com  Thu May 13 18:18:49 2004
From: SAiello at Jentoo.com (SAiello@Jentoo.com)
Date: Thu May 13 15:06:21 2004
Subject: [mod_python] Protecting Web apps from to many simultaneous
	clicks/Hacking
In-Reply-To: <1084473271.29530.12.camel@mike>
References: <200405140025.54087.roy@3mb.co.nz>
	<200405131551.08610.SAiello@Jentoo.com>
	<1084473271.29530.12.camel@mike>
Message-ID: <200405131718.49605.SAiello@Jentoo.com>

Thanks for all the good info and suggestions.

I have done abit of browsing and checking of Apache's server settings so far. 
I would like to have the 'protection' either a part of Apache or mod_python. 
I prefer to try to use functions of the software I am already using, then 
having to add another application/software layer. Since mod_python was 
managing authentication and my sessions, I figured that was the best place to 
start.

Performance tuning/tweaking is definitely on the schedule. But I do not see 
app protection and performance tweaking as the same. I would like to make the 
app be able to protect itself, as long as it is simple and does not add too 
many CPU cycles. Besides, if the app has some basic protection written into 
it, and I use bandwidth throttling, I then have two sperate layers of 
protection. 

As to splitting the site, thats another long term plan. for Images I was 
thinking of using AOLServer. I have read a few articles saying that as an 
image server/cache it is very fast. Though all my images have been custom 
made by me, and are very small in size. So far the biggest is 1,126 bytes.

I am just not writing yet another webmail client. What I am writing is a 
webmail client for my email system I have put together. The design goal is to 
have many small nodes that are redundant for each other and spread the load. 
Back end systems (IMAP, filtering, SMTP, etc) are already done.  I just need 
a GUI to glue all the bits together for the user :) Sorry if I went offtopic 
on what I am trying to do.

Thanks,
  Steven

On Thursday 13 May 2004 02:34 pm, you wrote:
> A google for "apache 2.0 bandwidth" turned up
> http://www.topology.org/src/bwshare/README.html as the first hit.
>
> You also want to spend sometime understanding apache's server settings
> and performance tuning (there is lots of stuff on this at the apache
> site), and possibly the IMAP server's as well.  If you need tighter
> controls still, I'd look into traffic shaping tools at the firewall
> level.
>
> I think it would be overkill for webmail, but another long term option
> is splitting the site into separate servers, so images and static
> content are served from one server while the app resides on another
> server which more horsepower behind it.  This will also allow separate
> traffic controls to dynamic and static content, so image requests don't
> get queue behind application processing.
>
> Mike
From michael at dynamine.net  Thu May 13 13:19:09 2004
From: michael at dynamine.net (Michael S. Fischer)
Date: Thu May 13 15:18:46 2004
Subject: [mod_python] Protecting Web apps from to many
	simultaneousclicks/Hacking
In-Reply-To: <200405131718.49605.SAiello@Jentoo.com>
Message-ID: <20040513191842.1A9DC3118D0@attrition.dynamine.net>

This is way off topic, but..

You mention AOLserver for serving static files -- I had a long discussion
with one of the AOLserver proponents (Phil Greenspun formerly of photo.net)
a few years ago on the very subject, and he advised me (and I concur) that
it's really hard to serve static files any faster than Apache can on a
system with sendfile() in the C API.  Linux has had sendfile() for awhile
now, as does FreeBSD.

Where AOLserver shines is with concurrent execution of TCL-based scripts.

Finally: try to use the right tool for the job.  While adding another layer
might seem like additional work, many projects have failed because of
needless delays and frustration by developers trying to reinvent the wheel.
NIH ("not invented here") is a terrible plague.

--Michael

> -----Original Message-----
> From: mod_python-bounces@modpython.org 
> [mailto:mod_python-bounces@modpython.org] On Behalf Of 
> SAiello@Jentoo.com
> Sent: Thursday, May 13, 2004 2:19 PM
> To: mod_python@modpython.org
> Subject: Re: [mod_python] Protecting Web apps from to many 
> simultaneousclicks/Hacking
> 
> Thanks for all the good info and suggestions.
> 
> I have done abit of browsing and checking of Apache's server 
> settings so far. 
> I would like to have the 'protection' either a part of Apache 
> or mod_python. 
> I prefer to try to use functions of the software I am already 
> using, then having to add another application/software layer. 
> Since mod_python was managing authentication and my sessions, 
> I figured that was the best place to start.
> 
> Performance tuning/tweaking is definitely on the schedule. 
> But I do not see app protection and performance tweaking as 
> the same. I would like to make the app be able to protect 
> itself, as long as it is simple and does not add too many CPU 
> cycles. Besides, if the app has some basic protection written 
> into it, and I use bandwidth throttling, I then have two 
> sperate layers of protection. 
> 
> As to splitting the site, thats another long term plan. for 
> Images I was thinking of using AOLServer. I have read a few 
> articles saying that as an image server/cache it is very 
> fast. Though all my images have been custom made by me, and 
> are very small in size. So far the biggest is 1,126 bytes.
> 
> I am just not writing yet another webmail client. What I am 
> writing is a webmail client for my email system I have put 
> together. The design goal is to have many small nodes that 
> are redundant for each other and spread the load. 
> Back end systems (IMAP, filtering, SMTP, etc) are already 
> done.  I just need a GUI to glue all the bits together for 
> the user :) Sorry if I went offtopic on what I am trying to do.
> 
> Thanks,
>   Steven
> 
> On Thursday 13 May 2004 02:34 pm, you wrote:
> > A google for "apache 2.0 bandwidth" turned up 
> > http://www.topology.org/src/bwshare/README.html as the first hit.
> >
> > You also want to spend sometime understanding apache's 
> server settings 
> > and performance tuning (there is lots of stuff on this at 
> the apache 
> > site), and possibly the IMAP server's as well.  If you need tighter 
> > controls still, I'd look into traffic shaping tools at the firewall 
> > level.
> >
> > I think it would be overkill for webmail, but another long 
> term option 
> > is splitting the site into separate servers, so images and static 
> > content are served from one server while the app resides on another 
> > server which more horsepower behind it.  This will also 
> allow separate 
> > traffic controls to dynamic and static content, so image requests 
> > don't get queue behind application processing.
> >
> > Mike
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
> 
> 
> 

From gustavo.cordova at q-voz.com  Thu May 13 17:23:49 2004
From: gustavo.cordova at q-voz.com (=?iso-8859-1?Q?Gustavo_C=F3rdova_Avila?=)
Date: Thu May 13 17:24:46 2004
Subject: [mod_python] Protecting Web apps from to
	manysimultaneousclicks/Hacking
In-Reply-To: <20040513191842.1A9DC3118D0@attrition.dynamine.net>
Message-ID: <!~!UENERkVCMDkAAQACAAAAAAAAAAAAAAAAABgAAAAAAAAAo5mHXnRFkU2A7MLhj8g/IMKAAAAQAAAAU3XJYRn6qkmg6e90Uc74JAEAAAAA@q-voz.com>

Regarding serving static files, you could investigate using thttp for
this purpose, according to documents on the website, many use thttp to
server static contente, and Apache for dynamic content.

Another alternative, if under Linux, is to use the Tux http accelerator
(search in redhat's site, I don't have a link right now) to serve static
content and to pass through dynamic requests to apache. This is pretty
neat because static-content requests never leave the kernel, and get
served up directly by it, I don't think it's possible to be any faster
than that.

Good luck :)

-gus

From bje at apnic.net  Fri May 14 13:39:48 2004
From: bje at apnic.net (Byron Ellacott)
Date: Thu May 13 22:41:20 2004
Subject: [mod_python] Protecting Web apps from to many simultaneous
	clicks/Hacking
In-Reply-To: <200405131416.01552.SAiello@Jentoo.com>
References: <200405140025.54087.roy@3mb.co.nz>
	<20040513100817.I25330@onyx.ispol.com>
	<200405131416.01552.SAiello@Jentoo.com>
Message-ID: <1084502387.26128.59.camel@ping.apnic.net>

On Fri, 2004-05-14 at 04:16, SAiello@Jentoo.com wrote:
> I was curious for ideas on how to protect a mod_python web application from 
> someone submitting/requesting data very quickly repeatedly. An example, I am 

If you mean, 'how do I protect against someone maliciously trying to
overload my server' then the throttling/bandwidth limiting suggestions
already given are useful tools.  If you mean, 'how do I improve my
server's performance to handle high load' then read on.

> building an IMAP webmail application. Currently, if I click the view 'next 
> set of messages in email box' quickly over and over again, that seems to 
> spawn a bunch of apaches trying to service all those requests. One problem is 
> that I really don't want one user being able to make my app take up alot of 
> CPU load by doing this. Another is that I am storing the current message 
> position in a session variable, by spawning a bunch of simultaneous requests 
> I seem to be able to keep clicking 'next' above the total number of messages.

Use caching.  If you've only just asked the IMAP server for the contents
of message #404, there's no good reason to ask it again.  You could
cache the messages, the message indexes, or even the entire output of a
given request.

Also, you probably shouldn't be storing the 'current message position'
in a session.  This implies that the user is only viewing one page at
once, which in a lot of cases isn't true.  They might open a message in
a new window or tab, for instance, and have two messages open at once. 
Which one is 'current' in that situation?

A possibly better way would be to have the "Next" link, as generated in
response to a request to display a particular message, also include
information about which message should be considered the next message. 
For example, I would probably implement this as a method to display a
message by ID, and for each generated display, include a "Next" button
which generates a request to display message #(ID + 1).

If the functionality of "Next" means "Next Unread" or some such, I'd
probably generate a request to display the next unread message after
message #ID, so once again, the knowledge about the 'current' message is
tied to a particular display.

Another, more serious, problem is that you appear to have a race
condition.  One request might be getting the 'current' message ID,
comparing it to the maximum, then incrementing the session value. 
Another request does the same.  Unfortunately, due to the way
multiprocessing works, one of them preempted the other, and did its work
between the "compare" and the "increment" commands.  Thus, the first
increments the value again, making it too high.

This is serious because my understanding of mod_python.Session is that
it automatically does session locking.  In other words, there should
already be only one simultaneous request per session.

> A quick idea of mine to limit one simultaneous request per session, was at the 
> start of the request, create a session variable that would store the total 
> number of requests for that session. Then I could check the number of 
> requests, and if the variable is greater than 1, sleep until it is lower than 
> 1.

... so yes, the general idea is sound.  Your implementation is a little
flawed, however.  

> 1	sess=Session.Session(req, None, cookieSecret)
> 2	if not sess.has_key('REQUESTS'):
> 3		sess['REQUESTS']=1
> 4		sess.save()
> 5	else:
> 6		sess['REQUESTS']+=1
> 7		sess.save()
> 8		while sess['REQUESTS']>1:
> 9			sleep(1)
> 10	sess['REQUESTS']-=1
> 11	sess.save()

I've added line numbers to help the discussion.  So, you create a
session object at line 1.  This is when the locking should already have
occurred.  In lines 2-4, you introduce a race condition: if a second
process preempts your request after line 2, but before line 4, that
process will also get False from sess.has_key('REQUESTS').  This means
two separate processes will reach line 3 thinking they have exclusive
access to the session.  A similar race condition exists between lines 6
and 7.

More problematic, lines 8 and 9 loop until sess['REQUESTS'] <= 1. 
Unfortunately, you didn't refresh the session in that loop, so I would
expect any request entering that loop will never leave it.  You may need
a "sess.load()" in the loop.

Finally, at line 10 you decrement your own, local value, and save that
to the shared session.  This would immediately overwrite any other value
there.  Granted, if you had achieved a lock by this point, what's in
there would be what you expected to be in there.

For what it's worth, a quick test with Apache/2.0.47 (Debian GNU/Linux)
mod_python/3.1.3 Python/2.3.3 shows that "s = Session.Session(req, None,
'foobar')" does in fact do session locking.

In the context of the original request, I'd start by reducing the
response time of each request before I started finding ways to deny
excessive requests. :)

-- 
bje

From list.mod_python at docwhat.gerf.org  Thu May 13 23:34:16 2004
From: list.mod_python at docwhat.gerf.org (The Doctor What)
Date: Thu May 13 23:34:19 2004
Subject: [mod_python] import madness!
In-Reply-To: <20040512131824.73b095dd.kamil@nvstudio.pl>
References: <20040511181121.GC5709@gerf.org>
	<20040512131824.73b095dd.kamil@nvstudio.pl>
Message-ID: <20040514033416.GA20098@gerf.org>

* Kamil Niechajewicz (kamil@nvstudio.pl) [040512 05:06]:
> On Tue, 11 May 2004 13:11:21 -0500
> The Doctor What <list.modpython@docwhat.gerf.org> wrote:
> 
> > I have found an interesting bug.  My handler has, at it's start,
> > something like:
> > from blah import config
> > 
> > This is great, works fine, etc. EXCEPT when I clean up the .pyc
> > files in the blah directory!  Then it says that it cannot import
> > config!
> 
> this is strange, but there is solution for it. just run the 
> interpreter and type 'import config'. it will automatically
> create .pyc files and everything will be fine.
> the thing i don't understand about it is why it does not 
> import from .py files when no .pyc is present? 

I agree, it should do that on it's own.  It's something in the way
mod_python's handler stuff works.

Regarding your "import config" suggestion, it doesn't work on a
heavily used system.  Before that command can run, a user will get
errors (500 server errors, specifically).  I cannot afford that.
This is a web application that drives a whole company, having
periodic "errors" isn't acceptable.

Any other suggestions?

Ciao!

-- 
"There's a problem with NT - it fails a lot,"
	-- Jimmy Treybig, founder of Tandem Computers

The Doctor What: Da Man                          http://docwhat.gerf.org/
docwhat *at* gerf *dot* org                                        KF6VNC
From list.mod_python at docwhat.gerf.org  Thu May 13 23:35:14 2004
From: list.mod_python at docwhat.gerf.org (The Doctor What)
Date: Thu May 13 23:35:16 2004
Subject: [mod_python] BUG: local_ip in connobject.c is wrong.
Message-ID: <20040514033514.GB20098@gerf.org>

 From line 261 in connobject.c:
    {"local_ip",           T_STRING,    OFF(remote_ip), RO},
    {"local_host",         T_STRING,    OFF(remote_host), RO},

Shouldn't the value in OFF() be local_ip and local_host?

Equally, there should probably be a unit test to confirm that
local_addr[0] == local_ip (ditto for remote_*)

Ciao!

-- 
Fact #17
  Reuse-in-the-large works best for families of related systems.
		-- "Facts and Fallacies of Software Engineering"
			(Robert L. Glass, 2002)

The Doctor What: Not that 'who' guy              http://docwhat.gerf.org/
docwhat *at* gerf *dot* org                                        KF6VNC
From SAiello at Jentoo.com  Fri May 14 10:17:06 2004
From: SAiello at Jentoo.com (SAiello@Jentoo.com)
Date: Fri May 14 07:04:47 2004
Subject: [mod_python] Protecting Web apps from to many simultaneous
	clicks/Hacking
In-Reply-To: <1084502387.26128.59.camel@ping.apnic.net>
References: <200405140025.54087.roy@3mb.co.nz>
	<200405131416.01552.SAiello@Jentoo.com>
	<1084502387.26128.59.camel@ping.apnic.net>
Message-ID: <200405140917.06096.SAiello@Jentoo.com>

> If you mean, 'how do I protect against someone maliciously trying to
> overload my server' then the throttling/bandwidth limiting suggestions
> already given are useful tools.  If you mean, 'how do I improve my
> server's performance to handle high load' then read on.

The reason I ask is a bit of both 'overload server' & 'improve server's 
performance'. Also it has a little of 'I want my program to run within 
certain design parameters, and it should do some simple checking to make sure 
it is running within those parameters'.

> Use caching.  If you've only just asked the IMAP server for the contents
> of message #404, there's no good reason to ask it again.  You could
> cache the messages, the message indexes, or even the entire output of a
> given request.

I have already used some caching. When listing the contents of an email box I 
cache the folder list, the message's ID in sorted order, and the current 
window (i.e. 1-20) message's 'from, subject, date'. As I continue, I am not 
sure where I am going to add more caching. The design of the email solution 
(webmail and server backends) is designed to have many small nodes running in 
parallel. It is not like I am going to have one IMAP server, with alot of web 
frontends hitting it. The design is to have a local 'IMAP frontend' on every 
web frontend. Thus, the 'IMAP frontends' contact the 'IMAP backends'. The 
communication between the IMAP frontends and backends would handle individual 
message caching. Also, it will probably do it alot more efficiently than I 
can.

> Also, you probably shouldn't be storing the 'current message position'
> in a session.  This implies that the user is only viewing one page at
> once, which in a lot of cases isn't true.  They might open a message in
> a new window or tab, for instance, and have two messages open at once.
> Which one is 'current' in that situation?
>
> A possibly better way would be to have the "Next" link, as generated in
> response to a request to display a particular message, also include
> information about which message should be considered the next message.
> For example, I would probably implement this as a method to display a
> message by ID, and for each generated display, include a "Next" button
> which generates a request to display message #(ID + 1).
>
> If the functionality of "Next" means "Next Unread" or some such, I'd
> probably generate a request to display the next unread message after
> message #ID, so once again, the knowledge about the 'current' message is
> tied to a particular display.

When I said 'Next', I meant the next button to display the next window of 
messages in the email box (i.e. showing messages 1-20 and then 21-40).
But the point you bring up is very valid, and brings up concerns for other 
ways I have used session variables. Guess it is time for another rewrite. For 
caching, do you have any suggestions ? dbm, external database, etc ?

> ... so yes, the general idea is sound.  Your implementation is a little
> flawed, however.

Yeah I knew it was flawed, I need a better understanding of the dynamics and 
workings of Apache/mod_python. I played around last night, and here is what I 
came up with.

if not sess.has_key('REQUESTS'):
	sess['REQUESTS']=1
	sess.save()
else:
	sess['REQUESTS']+=1
	sess.save()
	if sess['REQUESTS']>1:
		sess['REQUESTS']=0
		sess.save()
		req.internal_redirect('/python/error/manySessions')
		return

The '/python/error/manySessions' displays a quick little error, and there is 
an auto refresh of three seconds. After the refresh, the user sees the page 
they were looking for.
From grisha at modpython.org  Fri May 14 10:56:33 2004
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri May 14 09:56:37 2004
Subject: [mod_python] Protecting Web apps from to many simultaneous
	clicks/Hacking
In-Reply-To: <1084502387.26128.59.camel@ping.apnic.net>
References: <200405140025.54087.roy@3mb.co.nz>
	<20040513100817.I25330@onyx.ispol.com>
	<200405131416.01552.SAiello@Jentoo.com>
	<1084502387.26128.59.camel@ping.apnic.net>
Message-ID: <20040514095112.V44865@onyx.ispol.com>



On Fri, 14 May 2004, Byron Ellacott wrote:

> > 1	sess=Session.Session(req, None, cookieSecret)
> > 2	if not sess.has_key('REQUESTS'):
> > 3		sess['REQUESTS']=1
> > 4		sess.save()
> > 5	else:
> > 6		sess['REQUESTS']+=1
> > 7		sess.save()
> > 8		while sess['REQUESTS']>1:
> > 9			sleep(1)
> > 10	sess['REQUESTS']-=1
> > 11	sess.save()
>
> I've added line numbers to help the discussion.  So, you create a
> session object at line 1.  This is when the locking should already have
> occurred.  In lines 2-4, you introduce a race condition: if a second
> process preempts your request after line 2, but before line 4, that
> process will also get False from sess.has_key('REQUESTS').  This means
> two separate processes will reach line 3 thinking they have exclusive
> access to the session.  A similar race condition exists between lines 6
> and 7.

With session locking on (which would be true in the code above), once one
process reaches 2, no other process will be able to get past 1 until the
first request is over. So there is no race condition, unless I'm missing
something.

Also, since it isn't obvious, sess.save() does not release the lock. The
lock can be released explicitely with unlock(), or it would be released
for you in the request cleanup phase.

Grisha
From SAiello at Jentoo.com  Fri May 14 14:36:14 2004
From: SAiello at Jentoo.com (SAiello@Jentoo.com)
Date: Fri May 14 11:23:58 2004
Subject: [mod_python] Protecting Web apps from to many simultaneous
	clicks/Hacking
In-Reply-To: <20040514095112.V44865@onyx.ispol.com>
References: <200405140025.54087.roy@3mb.co.nz>
	<1084502387.26128.59.camel@ping.apnic.net>
	<20040514095112.V44865@onyx.ispol.com>
Message-ID: <200405141336.15391.SAiello@Jentoo.com>

On Friday 14 May 2004 09:56 am, Gregory (Grisha) Trubetskoy wrote:
> With session locking on (which would be true in the code above), once one
> process reaches 2, no other process will be able to get past 1 until the
> first request is over. So there is no race condition, unless I'm missing
> something.

With that 1st code sample of mine, if racing = my broweser waiting forever for 
a response from the server, because my code was stuck in the while loop. Then 
I was somehow racing. I think it could of been my code though, it wasn't the 
best of examples. 

Since my original post, I have since updated how I manage multiple 
simultaneous sessions. If you like I can create a test script using the first 
one to test for racing to confirm that I was.

Since I am not very knowledgeable on the dynamics of Apache, I can only guess 
why I was racing. But when I was clicking wildly at the mod_python page, I 
had top open on the server. Sometimes I would see an apache process marked as 
defunct. Could it be this process, incremented the session variable, then it 
went defunct, hence never decrementing the session var ?

Server Specs:
  Gentoo distribution of GNU/Linux, kernel 2.6.4
  Apache 2.0.49 with berkdb, gdbm, & ldap compiled in.
  mod_python 3.1.3


From bakey at traq.com  Fri May 14 12:16:42 2004
From: bakey at traq.com (Brian Akey)
Date: Fri May 14 12:16:54 2004
Subject: [mod_python] performance comparisons for mod_python and PHP
In-Reply-To: <BAY18-F723kaZcZFvH60001dfac@hotmail.com>
References: <BAY18-F723kaZcZFvH60001dfac@hotmail.com>
Message-ID: <1084551401.8459.19.camel@g6.us.traq.com>

I did some stats a while back and mod_python on a good xeon machine was
faster than php. Unless you buy the commercial addons to make php
faster. mod_python was doing about 575 pages per sec. Php was about 395
pages per sec. In real production the page speeds are much closer and
slower.
> Does anyone have benchmarks comparing how fast an Apache server running 
> mod_python compares w/ Apache running PHP?


From grisha at modpython.org  Fri May 14 13:32:25 2004
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri May 14 12:32:32 2004
Subject: [mod_python] Protecting Web apps from to many simultaneous
	clicks/Hacking
In-Reply-To: <200405141336.15391.SAiello@Jentoo.com>
References: <200405140025.54087.roy@3mb.co.nz>
	<1084502387.26128.59.camel@ping.apnic.net>
	<20040514095112.V44865@onyx.ispol.com>
	<200405141336.15391.SAiello@Jentoo.com>
Message-ID: <20040514120440.A45772@onyx.ispol.com>


I think Byron was referring to classic definition of a "race condition",
which is "whoever gets there first will determine the outcome of events"
(more info here http://en.wikipedia.org/wiki/Race_condition).

I think the racing you're referring to is called an infinite loop or a
stale lock. The former is an indiciation of a problem with your code, and
you should see a process on your server consuming a lot of CPU time when
this happens.

The latter could happen if httpd crashed before having a chance to release
the lock. If httpd crashed, you would see something in your error logs
like 'exited on signal 11'. Another possibility (of a stale lock) is that
somehow mod_python fails to release the lock, i.e. the cleanup isn't
executing, but in my experience cleanups are 100% reliable, I've never
seen one not executing.

So I would try to work towards figuring out conclusively what the issue is
narrowing it down to one of the possibilities I listed, from there we can
start solving the problem (or you'll solve it yourself in the process).

Grisha

On Fri, 14 May 2004, SAiello@Jentoo.com wrote:

> On Friday 14 May 2004 09:56 am, Gregory (Grisha) Trubetskoy wrote:
> > With session locking on (which would be true in the code above), once one
> > process reaches 2, no other process will be able to get past 1 until the
> > first request is over. So there is no race condition, unless I'm missing
> > something.
>
> With that 1st code sample of mine, if racing = my broweser waiting forever for
> a response from the server, because my code was stuck in the while loop. Then
> I was somehow racing. I think it could of been my code though, it wasn't the
> best of examples.
>
> Since my original post, I have since updated how I manage multiple
> simultaneous sessions. If you like I can create a test script using the first
> one to test for racing to confirm that I was.
>
> Since I am not very knowledgeable on the dynamics of Apache, I can only guess
> why I was racing. But when I was clicking wildly at the mod_python page, I
> had top open on the server. Sometimes I would see an apache process marked as
> defunct. Could it be this process, incremented the session variable, then it
> went defunct, hence never decrementing the session var ?
>
> Server Specs:
>   Gentoo distribution of GNU/Linux, kernel 2.6.4
>   Apache 2.0.49 with berkdb, gdbm, & ldap compiled in.
>   mod_python 3.1.3
>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From geert at boskant.nl  Sat May 15 13:16:46 2004
From: geert at boskant.nl (Geert Jansen)
Date: Sat May 15 06:17:11 2004
Subject: [mod_python] Creating a thread-safe handler
Message-ID: <000001c43a65$ba6eada0$6406a8c0@greetop>

Hi,

I am trying to make my mod_python application thread safe so it can be
run on Windows. Not everything is completely clear to me yet, so
hopefully someone can help me out.

Python threads run in the same sub-interpreter, so you need some kind of
synchronization when handling global objects. A threading.Lock can help
here. However, how can such a lock be safely created? The lock itself
must be a global object as well.

For example:

def my_handler(req):
    global lock
    try:
        lock.acquire()
    except NameError:
        lock = Lock()   # XXX: not thread safe!
        lock.acquire()  # Lock could be created by another thread
   # do thread-unsafe stuff here
   lock.unlock()

A solution seems to be to use PythonImport to pre-import the handler
module. Because that's run when a child is started, I assume no threads
have been created yet and a global Lock can be safely set up. But this
seems a hack. Any ideas?

Thanks,
Geert Jansen

From stian at soiland.no  Sat May 15 15:29:24 2004
From: stian at soiland.no (Stian =?iso-8859-1?Q?S=F8iland?=)
Date: Sat May 15 08:29:28 2004
Subject: [mod_python] Re: Creating a thread-safe handler
In-Reply-To: <000001c43a65$ba6eada0$6406a8c0@greetop>
References: <000001c43a65$ba6eada0$6406a8c0@greetop>
Message-ID: <20040515122924.GA25279@itea.ntnu.no>

On 2004-05-15 12:16:46, Geert Jansen wrote:

> def my_handler(req):
>     global lock
>     try:
>         lock.acquire()
>     except NameError:
>         lock = Lock()   # XXX: not thread safe!
>         lock.acquire()  # Lock could be created by another thread
>    # do thread-unsafe stuff here
>    lock.unlock()

A module import is threadsafe[1], so the simple thing to do is:

lock = Lock()
def my_handler(req):
    lock.acquire()
    ...
    lock.unlock()
     

     
.. [1] http://www.python.org/doc/current/lib/module-imp.html

    lock_held(  )   
    
    Return True if the import lock is currently held, else False. On platforms
    without threads, always return False. 

    On platforms with threads, a thread executing an import holds an internal
    lock until the import is complete. This lock blocks other threads
    from doing an import until the original import completes, which in
    turn prevents other threads from seeing incomplete module objects
    constructed by the original thread while in the process of
    completing its import (and the imports, if any, triggered by that).     

-- 
Stian S?iland               Work toward win-win situation. Win-lose
Trondheim, Norway           is where you win and the other lose.
http://www.soiland.no/      Lose-lose and lose-win are left as an
                            exercise to the reader.  [Limoncelli/Hogan]
                            Og dette er en ekstra linje 

From bje at apnic.net  Mon May 17 10:24:18 2004
From: bje at apnic.net (Byron Ellacott)
Date: Sun May 16 19:25:58 2004
Subject: [mod_python] Protecting Web apps from to many simultaneous
	clicks/Hacking
In-Reply-To: <200405140917.06096.SAiello@Jentoo.com>
References: <200405140025.54087.roy@3mb.co.nz>
	<200405131416.01552.SAiello@Jentoo.com>
	<1084502387.26128.59.camel@ping.apnic.net>
	<200405140917.06096.SAiello@Jentoo.com>
Message-ID: <1084749857.941.35.camel@ping.apnic.net>

On Fri, 2004-05-14 at 23:17, SAiello@Jentoo.com wrote:
> I have already used some caching. When listing the contents of an email box I 
> cache the folder list, the message's ID in sorted order, and the current 
> window (i.e. 1-20) message's 'from, subject, date'. As I continue, I am not 
> sure where I am going to add more caching. The design of the email solution 

I'd cache the results of most IMAP queries.  Thus, you get a relatively
slow response for the first access to any piece of information, but
relatively snappy for subsequent accesses (think: moving backwards and
forwards through the message list).

> (webmail and server backends) is designed to have many small nodes running in 
> parallel. It is not like I am going to have one IMAP server, with alot of web 
> frontends hitting it. The design is to have a local 'IMAP frontend' on every 
> web frontend. Thus, the 'IMAP frontends' contact the 'IMAP backends'. The 
> communication between the IMAP frontends and backends would handle individual 
> message caching. Also, it will probably do it alot more efficiently than I 
> can.

The trouble is that communication between the frontends and backends
probably has a lot of expensive overhead.  I'm making a few assumptions
about how your system works here that may be invalid.  First up, I'm
assuming that a frontend is connecting to a backend using a TCP
connection.  Establishing a TCP connection is a non-trivial operation;
even connecting to the local host can be relatively costly.  Doing a DNS
lookup for the IMAP backend's IP address is expensive too, though easy
to avoid.  Once a connection's established, you need to present the
backend with your user's credentials, which involves more round trips of
data, and then finally you can do your IMAP operation, which has further
TCP overhead.  After that, you need to close the TCP connection, which
is probably done after the user sees their result, but before the Apache
process is available to serve another result.

Compare this to, for example, storing some cached information in your
session: mod_python is already loading and saving your session via dbm
or shm, so the additional overhead is the marshalling and I/O for the
cached data.  Significantly less than talking to an IMAP backend.

If you're using IMAP connection pools, this section is fairly much
irrelevant, since you're avoiding the high costs of connection setup and
teardown for most requests.  However, it's been my experience that
connection pools are difficult to achieve in a forked Apache world.

> When I said 'Next', I meant the next button to display the next window of 
> messages in the email box (i.e. showing messages 1-20 and then 21-40).
> But the point you bring up is very valid, and brings up concerns for other 
> ways I have used session variables. Guess it is time for another rewrite. For 
> caching, do you have any suggestions ? dbm, external database, etc ?

mod_python's session data first up, because it will have already tied
your cached data to a particular user, and because a lot of the overhead
of storing/retrieving data is ameliorated with the session work, and
because it's easier to use Grisha's work than to duplicate it. :)

Otherwise, I'd probably use as lightweight a system as possible, which
would most likely mean anydbm.

> 	if sess['REQUESTS']>1:

The trouble I'm having here is that if session locking is working, you
should never encounter a value of sess['REQUESTS'] > 1.  The session
should be automatically locking when you first create it, and remaining
locked, as Grisha says, until it's cleaned up when the request
completes.  In fact, copy/pasting your code, appending the
"sess['REQUESTS']-=1" and saving the session before returning apache.OK,
I cannot get redirected.  I inserted a sleep(10) before the decrement
and return, and hit reload a dozen odd times.  The only effect of this
was to make my browser spend two minutes loading the final page. :)

If I put in "sess.unlock()" right after I create the session, I can get
myself redirected to the error page.

Any idea how you might be winding up with an unlocked session?  What's
your Apache version?  mod_python version?  What's the request serving
model (worker threads, forked, etc)?

-- 
bje

From SAiello at Jentoo.com  Sun May 16 23:42:20 2004
From: SAiello at Jentoo.com (SAiello@Jentoo.com)
Date: Sun May 16 20:29:30 2004
Subject: [mod_python] Protecting Web apps from to many simultaneous
	clicks/Hacking
In-Reply-To: <1084749857.941.35.camel@ping.apnic.net>
References: <200405140025.54087.roy@3mb.co.nz>
	<200405140917.06096.SAiello@Jentoo.com>
	<1084749857.941.35.camel@ping.apnic.net>
Message-ID: <200405162242.20902.SAiello@Jentoo.com>

On Sunday 16 May 2004 07:24 pm, Byron Ellacott wrote:
> The trouble is that communication between the frontends and backends
> probably has a lot of expensive overhead.  I'm making a few assumptions
> about how your system works here that may be invalid.  First up, I'm
> assuming that a frontend is connecting to a backend using a TCP
> connection.  Establishing a TCP connection is a non-trivial operation;
> even connecting to the local host can be relatively costly.  Doing a DNS
> lookup for the IMAP backend's IP address is expensive too, though easy
> to avoid.  Once a connection's established, you need to present the
> backend with your user's credentials, which involves more round trips of
> data, and then finally you can do your IMAP operation, which has further
> TCP overhead.  After that, you need to close the TCP connection, which
> is probably done after the user sees their result, but before the Apache
> process is available to serve another result.
>
> Compare this to, for example, storing some cached information in your
> session: mod_python is already loading and saving your session via dbm
> or shm, so the additional overhead is the marshalling and I/O for the
> cached data.  Significantly less than talking to an IMAP backend.
>
> If you're using IMAP connection pools, this section is fairly much
> irrelevant, since you're avoiding the high costs of connection setup and
> teardown for most requests.  However, it's been my experience that
> connection pools are difficult to achieve in a forked Apache world.

Oh believe me, I know my IMAP connections are rather expensive. Currently I am 
using Python's imaplib, for all imap queries. You have to understand I am not 
an advance Python programer. Maybe intermediate programmer, but I am still 
trying to learn the Pythonic way to do things, in using the language as 
efficiently as possible. And if my Python code relies on other software (i.e. 
Apache) trying to understand the dynamics of how that software works, and the 
interaction between it and Python. So basically my head is swimming. My 
current goal is to get something up and running with my current knowledge 
base, running as best as I can design now, learning as I go.

Connection Pools seem like a daunting undertaking, it could just be an 
illusion.  Until I understand the basic definition of a Connection Pool, in a 
programming way. It will seem like a complicate and mysterious thing.

Currently, when ever I require IMAP information, a connection needs to be 
established, user authentication, information request, close IMAP connection, 
parse the IMAP information into useable lists/distionaries, display web page. 
In the beginning I really didn't like having to open and close the IMAP 
connection, seemed like such a waste. So I tried to store the imaplib 
function into a session var, that was bad. ImapLib can't be pickled due to it 
using __slots__. I wrote the writer of imapLib, and he said he wasn't even 
aware it used __slots__, and that he may look at it at some point. So to me 
my next option was to look at writing my own IMAP library, how hard can it 
be.. Results, I am not even close to handling tcp sockets. At this point I 
was flustered, and came to conclusion to design my app as best I can, and 
after it is working, go back and try to work on the bits I feel can be done 
better.

> mod_python's session data first up, because it will have already tied
> your cached data to a particular user, and because a lot of the overhead
> of storing/retrieving data is ameliorated with the session work, and
> because it's easier to use Grisha's work than to duplicate it. :)

That was my thinking to to use the session storage option. It seemes the 
easiest way to do it. But I am always wary when doing something the easy way.

> The trouble I'm having here is that if session locking is working, you
> should never encounter a value of sess['REQUESTS'] > 1.  The session
> should be automatically locking when you first create it, and remaining
> locked, as Grisha says, until it's cleaned up when the request
> completes.  In fact, copy/pasting your code, appending the
> "sess['REQUESTS']-=1" and saving the session before returning apache.OK,
> I cannot get redirected.  I inserted a sleep(10) before the decrement
> and return, and hit reload a dozen odd times.  The only effect of this
> was to make my browser spend two minutes loading the final page. :)
>
> If I put in "sess.unlock()" right after I create the session, I can get
> myself redirected to the error page.
>
> Any idea how you might be winding up with an unlocked session?  What's
> your Apache version?  mod_python version?  What's the request serving
> model (worker threads, forked, etc)?

I do not use refresh to cause the error, but page links (i.e. like the Next 
button for the next set of messages).  clicking over and over on  the A link 
will cause it. It isn't the browser, I have tried Konqueror, firefox, and IE, 
they all will get my error page. Below are my system specs. I think Apache is 
forking, because I am not using threads as a compile option, so that is 
forked right ? I have to read up on which is better, I tried apache with 
threads once to see if that was the issue..  still did the same thing.

If ya like external access is available to the box, if ya want to take a peek. 
still rather rough.. so dun laugh

Server Specs:
  Gentoo distribution of GNU/Linux, kernel 2.6.4
  Apache 2.0.49 with berkdb, gdbm, & ldap compiled in.
  mod_python 3.1.3

Sorry for long post, and if I provided to much information, just trying to 
give ya a feel where I am technical with Python programming and my thought 
process.

  Steven

From fabbe at paniq.net  Mon May 17 11:55:57 2004
From: fabbe at paniq.net (Fabian Fagerholm)
Date: Mon May 17 03:56:19 2004
Subject: [mod_python] PSP strcache error
Message-ID: <1084780557.1557.10.camel@kernel>

Hi!
I'm trying to make use of PSP in my own handler. My handler generates
PSP code and tries to construct a PSP object with this code, using the
string argument of the PSP constructor:

from mod_python import apache, psp
...
my_psp_object = psp.PSP (req, string = my_psp_string)

However, I get the following error (edited):

File "/usr/lib/python2.3/site-packages/mod_python/psp.py", line 114, in __init__
    cached = strcache.get(string)

NameError: global name 'strcache' is not defined

Looking at psp.py, indeed I can't seem to find any place where the
strcache variable would be initialized.

Any hints?

-- 
Fabian Fagerholm <fabbe@paniq.net>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: This is a digitally signed message part
Url : http://modpython.org/pipermail/mod_python/attachments/20040517/95f37e1e/attachment.bin
From volodya at real.samuraj.org  Mon May 17 12:11:48 2004
From: volodya at real.samuraj.org (Volodya)
Date: Mon May 17 04:12:19 2004
Subject: [mod_python] PSP strcache error
In-Reply-To: <1084780557.1557.10.camel@kernel>
References: <1084780557.1557.10.camel@kernel>
Message-ID: <20040517081148.GA20780@debian.mki-btc.com>

On Mon, May 17, 2004 at 10:55:57AM +0300, Fabian Fagerholm wrote:
> Hi!
> I'm trying to make use of PSP in my own handler. My handler generates
> PSP code and tries to construct a PSP object with this code, using the
> string argument of the PSP constructor:
> 
> from mod_python import apache, psp
> ...
> my_psp_object = psp.PSP (req, string = my_psp_string)
> 
> However, I get the following error (edited):
> 
> File "/usr/lib/python2.3/site-packages/mod_python/psp.py", line 114, in __init__
>     cached = strcache.get(string)
> 
> NameError: global name 'strcache' is not defined
> 
> Looking at psp.py, indeed I can't seem to find any place where the
> strcache variable would be initialized.
> 
> Any hints?

http://www.modpython.org/pipermail/mod_python/2004-May/015552.html


From fabbe at paniq.net  Mon May 17 12:51:55 2004
From: fabbe at paniq.net (Fabian Fagerholm)
Date: Mon May 17 04:52:29 2004
Subject: [mod_python] PSP strcache error
In-Reply-To: <20040517081148.GA20780@debian.mki-btc.com>
References: <1084780557.1557.10.camel@kernel>
	<20040517081148.GA20780@debian.mki-btc.com>
Message-ID: <1084783915.1557.15.camel@kernel>

On Mon, 2004-05-17 at 11:11, Volodya wrote:
> > File "/usr/lib/python2.3/site-packages/mod_python/psp.py", line 114, in __init__
> >     cached = strcache.get(string)
> > 
> > NameError: global name 'strcache' is not defined
> > 
> > Looking at psp.py, indeed I can't seem to find any place where the
> > strcache variable would be initialized.
> > 
> > Any hints?
> 
> http://www.modpython.org/pipermail/mod_python/2004-May/015552.html

Replacing strcache with mem_scache just locks up the application. The
same thing does appear to happen if I use the following in a file:

<div>.</div>

(with newline at the end)

Any more ideas?

-- 
Fabian Fagerholm <fabbe@paniq.net>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: This is a digitally signed message part
Url : http://modpython.org/pipermail/mod_python/attachments/20040517/db4bf6da/attachment.bin
From davidf at sjsoft.com  Mon May 17 14:07:48 2004
From: davidf at sjsoft.com (David Fraser)
Date: Mon May 17 07:01:10 2004
Subject: [mod_python] error message when mutexes cannot be created
Message-ID: <40A89D04.7060306@sjsoft.com>

Hi

I recently had trouble restarting my Apache server.
I got the following error message when trying to start it:
[Mon May 17 12:32:59 2004] [error] (28)No space left on device: Cannot 
create SSLMutex
Configuration Failed

It turned out this was because there were left-over mutexes that hadn't 
been deallocated when Apache was shut down.
Most of these are created by mod_python.

I wonder if the error message can be improved to say "Maximum Mutexes 
exceeded" as it seemed a bit misleading.
Anyway I suspect it isn't in the mod_python code itself.

But also, would there be a way for mod_python to pick up left-over 
mutexes from dead apache processes and kill them?

I probably don't have too good an understanding of how they work, so 
this may be an ignorant suggestion...

David

From davidf at sjsoft.com  Mon May 17 14:14:30 2004
From: davidf at sjsoft.com (David Fraser)
Date: Mon May 17 07:07:51 2004
Subject: [mod_python] Re: error message when mutexes cannot be created
In-Reply-To: <40A89D04.7060306@sjsoft.com>
References: <40A89D04.7060306@sjsoft.com>
Message-ID: <40A89E96.4020106@sjsoft.com>

David Fraser wrote:

> Hi
>
> I recently had trouble restarting my Apache server.
> I got the following error message when trying to start it:
> [Mon May 17 12:32:59 2004] [error] (28)No space left on device: Cannot 
> create SSLMutex
> Configuration Failed
>
> It turned out this was because there were left-over mutexes that 
> hadn't been deallocated when Apache was shut down.
> Most of these are created by mod_python.
>
> I wonder if the error message can be improved to say "Maximum Mutexes 
> exceeded" as it seemed a bit misleading.
> Anyway I suspect it isn't in the mod_python code itself.
>
> But also, would there be a way for mod_python to pick up left-over 
> mutexes from dead apache processes and kill them?
>
> I probably don't have too good an understanding of how they work, so 
> this may be an ignorant suggestion...
>
> David
>
OK, I have worked out why the extra mutexes were being allocated...

When restarting, I sometimes get the following error:
Starting httpd: (98)Address already in use: make_sock: could not bind to 
address [::]:443
no listening sockets available, shutting down
Unable to open logs
                                                           [FAILED]

It seems that if this happens, Apache shuts down, but the mod_python 
mutexes have already been allocated and they aren't deallocated...
Is there a way to detect a configuration error that prevents full start 
up and release the mutexes?

David
From volodya at real.samuraj.org  Mon May 17 16:28:20 2004
From: volodya at real.samuraj.org (Volodya)
Date: Mon May 17 08:28:44 2004
Subject: [mod_python] PSP strcache error
In-Reply-To: <1084783915.1557.15.camel@kernel>
References: <1084780557.1557.10.camel@kernel>
	<20040517081148.GA20780@debian.mki-btc.com>
	<1084783915.1557.15.camel@kernel>
Message-ID: <20040517122820.GA21417@debian.mki-btc.com>

On Mon, May 17, 2004 at 11:51:55AM +0300, Fabian Fagerholm wrote:
> On Mon, 2004-05-17 at 11:11, Volodya wrote:
> > > File "/usr/lib/python2.3/site-packages/mod_python/psp.py", line 114, in __init__
> > >     cached = strcache.get(string)
> > > 
> > > NameError: global name 'strcache' is not defined
> > > 
> > > Looking at psp.py, indeed I can't seem to find any place where the
> > > strcache variable would be initialized.
> > > 
> > > Any hints?
> > 
> > http://www.modpython.org/pipermail/mod_python/2004-May/015552.html
> 
> Replacing strcache with mem_scache just locks up the application. The
> same thing does appear to happen if I use the following in a file:
> 
> <div>.</div>
> 
> (with newline at the end)
> 
> Any more ideas?
> 

Quick & dirty hack:

In psp.py , PSP.__init__ :

# ---------------------------------------------------------------

         if filename:
 
             # if filename is not absolute, default to our guess                                               
             # of current directory                                                                            
             if not os.path.isabs(filename):
                 base = os.path.split(req.filename)[0]
                 self.filename = os.path.join(base, filename)
 
             self.load_from_file()
         else:
 
             #cached = strcache.get(string)
             #if cached:
             #   self.code = cached
             #else:
             #   strcache.store(string)


	     # !!! HACK !!!
             parsed = _psp.parsestring(string)
             self.code = compile(parsed,"<string>","exec")
	     

# ---------------------------------------------------------------

1. Original (broken) caching code is commented
2. Added compile call

tested on:


# --  test.py ---------------------------------------------------

from mod_python import apache, psp

psp_string = """                                                                                              
<html><body>                                                                                                  
<%                                                                                                            
for i in range(5):                                                                                            
    req.write("Hello<br/>");                                                                                  
#endif                                                                                                        
%>                                                                                                            
</body></html>                                                                                                
"""
 
 
def handler(req):
    psp_object = psp.PSP(req, string = psp_string)
    req.write(str(psp_object))
    return apache.OK

# --  end of test.py --------------------------------------------


Hope this helps.

From grisha at modpython.org  Mon May 17 13:06:45 2004
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Mon May 17 12:06:47 2004
Subject: [mod_python] Re: error message when mutexes cannot be created
In-Reply-To: <40A89E96.4020106@sjsoft.com>
References: <40A89D04.7060306@sjsoft.com> <40A89E96.4020106@sjsoft.com>
Message-ID: <20040517120457.Y8073@onyx.ispol.com>



On Mon, 17 May 2004, David Fraser wrote:

> When restarting, I sometimes get the following error:
> Starting httpd: (98)Address already in use: make_sock: could not bind to
> address [::]:443
> no listening sockets available, shutting down
> Unable to open logs
>                                                            [FAILED]
>
> It seems that if this happens, Apache shuts down, but the mod_python
> mutexes have already been allocated and they aren't deallocated...
> Is there a way to detect a configuration error that prevents full start
> up and release the mutexes?
>

Hmm... This would qualify as a bug, though I'm not clear whether this is a
problem with mod_python, or rather Apache itself for not giving mod_python
an opportunity cleanup mutexes.

What version of Apache/Python/MP/OS is this?

Grisha
From richard.whitehurst at reputations.co.uk  Mon May 17 18:26:06 2004
From: richard.whitehurst at reputations.co.uk (Richard Whitehurst)
Date: Mon May 17 12:36:11 2004
Subject: [mod_python] handler - cookie conditional page
Message-ID: <000c01c43c2b$a8ba04c0$77272ad9@nsoptimup4>

Hi,

I am using RedHat ES 3, Apache 2.0.46, mod_python 3.0.3, Python 2.2.3

I have migrated from Perl to Python with ease and pleasure but struggle with mod_python.  And yes I've read everyhing mod_python related and more.  Instead of relating the problems I've had I thought I would just say what I am trying to acheive by means of a Python Handler and hope you can suggest a way:

If a cookie does not exist for a page requested from a particular location:
    redirect to a reminder page
else:
    serve the page requested without intervention

Seems simple enough but ...

tia

Richard

From techead at technetos.com  Mon May 17 18:16:37 2004
From: techead at technetos.com (techead@technetos.com)
Date: Mon May 17 18:16:26 2004
Subject: [mod_python] PSP strcache error
Message-ID: <40A8F375.15219.18FBBBA4@localhost>

I was fighting the strcache.get() error in the PSP modules recently 
and decided it might be a bug in the psp.py module of mod_python.  
Grisha confirmed this and said that it will be fixed in the next 
release.

In the mean time I made enough modifications to get it working for me 
so that I could use mem_scache.  Here is a diff output of the changes 
I made if anyone else is interested:

#diff psp.py.org psp.py
114c114
<             cached = strcache.get(string)
---
>             cached = mem_scache.get(string)
118,119c118,119
<                 self.code = _psp.parsestring(string)
<                 strcache.store(string)
---
>                 mem_scache.store(string,_psp.parsestring(string))
>                 self.code = mem_scache.get(string)
355c355,356
<         self.cache[key] = (1, val)
---
>         code = compile(val, "<string>", "exec")
>         self.cache[key] = (1, code)
361c362
<             hist, val = self.cache[key]
---
>             hits, code = self.cache[key]
363c364
<             return val
---
>             return code

From bje at apnic.net  Tue May 18 14:42:25 2004
From: bje at apnic.net (Byron Ellacott)
Date: Mon May 17 23:44:10 2004
Subject: [mod_python] Protecting Web apps from to many simultaneous
	clicks/Hacking
In-Reply-To: <200405162242.20902.SAiello@Jentoo.com>
References: <200405140025.54087.roy@3mb.co.nz>
	<200405140917.06096.SAiello@Jentoo.com>
	<1084749857.941.35.camel@ping.apnic.net>
	<200405162242.20902.SAiello@Jentoo.com>
Message-ID: <1084851745.3210.55.camel@ping.apnic.net>

On Mon, 2004-05-17 at 12:42, SAiello@Jentoo.com wrote:
> Connection Pools seem like a daunting undertaking, it could just be an 
> illusion.  Until I understand the basic definition of a Connection Pool, in a 
> programming way. It will seem like a complicate and mysterious thing.

Connection pools in Apache are particularly difficult because it is
rather difficult to safely share open connections across multiple
processes.  In short, this is a complicated and mysterious thing, and I
don't recommend trying it. :)

> Currently, when ever I require IMAP information, a connection needs to be 
> established, user authentication, information request, close IMAP connection, 
> parse the IMAP information into useable lists/distionaries, display web page. 
> In the beginning I really didn't like having to open and close the IMAP 
> connection, seemed like such a waste. So I tried to store the imaplib 
> function into a session var, that was bad. ImapLib can't be pickled due to it 
> using __slots__. I wrote the writer of imapLib, and he said he wasn't even 
> aware it used __slots__, and that he may look at it at some point. So to me 
> my next option was to look at writing my own IMAP library, how hard can it 
> be.. Results, I am not even close to handling tcp sockets. At this point I 
> was flustered, and came to conclusion to design my app as best I can, and 
> after it is working, go back and try to work on the bits I feel can be done 
> better.

You would be unable to pickle ImapLib anyway - pickling takes the state
of an object and serialises it to a data stream, with unpickling being
the reverse.  However, in the case of a TCP connection to an IMAP
server, there is state held by both the OS and the IMAP server about the
established connection which cannot be serialised.

(Imagine: you write a pickled ImapLib object to disk, three days later
when you try to unpickle it, how does the remote IMAP server know that
it's an unpickled object from before?)

One way to solve the problem would be to extend the ImapLib object to
store enough information to reestablish the connection, but this
wouldn't help here - you'd still be doing the expensive connection
establishment when you unpickled the object!

Rather, I would look for places you make the imaplib calls, and see if
you could first check for cached data in your session before doing the
call:

def fetch_index(sess, user, password):
    if sess.has_key('cache') and sess.cache.has_key('index'):
        if sess.cache['index']['expires'] > time.time():
            return sess.cache['index']['data']
    index = imaplib_fetch_index(user, password)
    if not sess.has_key('cache'):
        sess['cache'] = {}
    sess['cache']['index'] = {}
    sess['cache']['index']['expires'] = time.time() + 300
    sess['cache']['index']['data'] = index
    return index

What this does is check if your session has a cache, and if that cache
contains an entry for the imap index, and that the cached entry has not
expired (it only lasts 5 minutes in this case).  If it does, the cached
version is returned.

Otherwise, the old call to fetch the index from imaplib is executed, the
cache is created if it didn't exist, and an entry for the imap index is
added.

> That was my thinking to to use the session storage option. It seemes the 
> easiest way to do it. But I am always wary when doing something the easy way.

I like doing things the easy way.  If it's easy to understand now, it'll
be easy to understand six months later when you need to do maintenance. 
If it's easy to write, it should be easy to spot bugs.  And if it's easy
to do, it'll take you less time than a more complex alternative.

> I do not use refresh to cause the error, but page links (i.e. like the Next 
> button for the next set of messages).  clicking over and over on  the A link 

>From the server end, it's still a bunch of requests coming in hot on
each others' heels.  I used refresh so I didn't have to futz around
making a form that submitted to a mod_python module; I just threw in an
index.py and a PythonHandler index.

> will cause it. It isn't the browser, I have tried Konqueror, firefox, and IE, 
> they all will get my error page. Below are my system specs. I think Apache is 
> forking, because I am not using threads as a compile option, so that is 
> forked right ? I have to read up on which is better, I tried apache with 
> threads once to see if that was the issue..  still did the same thing.

"Which process model is better" is a tricky question, and probably
outside of the immediate scope of this list - and definitely outside the
scope of my experience. :)

> Server Specs:
>   Gentoo distribution of GNU/Linux, kernel 2.6.4
>   Apache 2.0.49 with berkdb, gdbm, & ldap compiled in.
>   mod_python 3.1.3

I'm running 2.0.47 with 3.1.3, but it doesn't sound like this is a
problem with your versions.  I can't shed any light on why your sessions
are apparently not locked; so I don't know if I can help you further. :(

-- 
bje

From davidf at sjsoft.com  Tue May 18 09:25:13 2004
From: davidf at sjsoft.com (David Fraser)
Date: Tue May 18 02:18:36 2004
Subject: [mod_python] Re: error message when mutexes cannot be created
In-Reply-To: <20040517120457.Y8073@onyx.ispol.com>
References: <40A89D04.7060306@sjsoft.com> <40A89E96.4020106@sjsoft.com>
	<20040517120457.Y8073@onyx.ispol.com>
Message-ID: <40A9AC49.9020206@sjsoft.com>

Gregory (Grisha) Trubetskoy wrote:

>On Mon, 17 May 2004, David Fraser wrote:
>
>  
>
>>When restarting, I sometimes get the following error:
>>Starting httpd: (98)Address already in use: make_sock: could not bind to
>>address [::]:443
>>no listening sockets available, shutting down
>>Unable to open logs
>>                                                           [FAILED]
>>
>>It seems that if this happens, Apache shuts down, but the mod_python
>>mutexes have already been allocated and they aren't deallocated...
>>Is there a way to detect a configuration error that prevents full start
>>up and release the mutexes?
>>
>>    
>>
>
>Hmm... This would qualify as a bug, though I'm not clear whether this is a
>problem with mod_python, or rather Apache itself for not giving mod_python
>an opportunity cleanup mutexes.
>  
>
Yes, I've added some code to my init script that detects it and cleans 
them up, so at least I can see when its happening now.
I think Apache isn't shutting down properly.

>What version of Apache/Python/MP/OS is this?
>  
>
Good point, can't believe I didn't say!
It's Linux, kernel 2.6.5, Fedora Core 2, Apache 2.0.49, mod_python 3.1.3 
(all standard rpms from fedora)

What's the best way to debug this?

David

From SAiello at Jentoo.com  Tue May 18 14:00:54 2004
From: SAiello at Jentoo.com (SAiello@Jentoo.com)
Date: Tue May 18 10:47:49 2004
Subject: [mod_python] Protecting Web apps from to many simultaneous
	clicks/Hacking
In-Reply-To: <1084851745.3210.55.camel@ping.apnic.net>
References: <200405140025.54087.roy@3mb.co.nz>
	<200405162242.20902.SAiello@Jentoo.com>
	<1084851745.3210.55.camel@ping.apnic.net>
Message-ID: <200405181300.54792.SAiello@Jentoo.com>

On Monday 17 May 2004 11:42 pm, Byron Ellacott wrote:
> From the server end, it's still a bunch of requests coming in hot on
> each others' heels.  I used refresh so I didn't have to futz around
> making a form that submitted to a mod_python module; I just threw in an
> index.py and a PythonHandler index.

Well it is both form submits and HTML A HREF links. Currently both the form 
and all A links call the same module that created them, basically it the same 
URL over and over again. So you do not have to create another module.

Today, I think I will be working on my hybrid IMAP wrapper/IMAP data cache 
module. It should not take too long, I have been taking a break from coding 
for the last few days to think about it.

I would like to spend some time this afternoon recreating my lock issue, and 
see if it is just my coding, my server/configuration, or something else. I 
will let you all know, if I see anything interesting.

Thank you again,
  Steven
From Edward.Diener at loyaltyworks.com  Tue May 18 12:58:39 2004
From: Edward.Diener at loyaltyworks.com (Diener, Edward)
Date: Tue May 18 11:58:41 2004
Subject: [mod_python] Controlling authentication at run-time
Message-ID: <68A7AFEEA80F96479E120166638331AF81E1F1@exchange2.loyaltyworks.com>

If Apache authentication is setup for files in a document directory
through directives in an .htaccess file, once the user has entered their
user name and password and is allowed access to the file, they are no
longer prompted each subsequent time as long as their session is active.
Is there a way to control this at run-time so that the user will be
prompted for their user name and password in subsequent access to the
file, using mod_python ?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://modpython.org/pipermail/mod_python/attachments/20040518/162edaa9/attachment.html
From grisha at modpython.org  Tue May 18 14:00:30 2004
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Tue May 18 13:00:32 2004
Subject: [mod_python] Re: error message when mutexes cannot be created
In-Reply-To: <40A9AC49.9020206@sjsoft.com>
References: <40A89D04.7060306@sjsoft.com> <40A89E96.4020106@sjsoft.com>
	<20040517120457.Y8073@onyx.ispol.com> <40A9AC49.9020206@sjsoft.com>
Message-ID: <20040518125658.F30222@onyx.ispol.com>



On Tue, 18 May 2004, David Fraser wrote:

> Yes, I've added some code to my init script that detects it and cleans
> them up, so at least I can see when its happening now.
> I think Apache isn't shutting down properly.

Do you see anything in the Apache error log indicating it crashed,
something like "child pid 12345 exit signal Segmentation fault (11)" or a
core file with a timestamp matching the time when Apache quit - this would
be a clear indication of it crashing.

BTW - Would you care to share the code you added to clean up mutexes (on
the dev list preferably)? :-)

Grisha


> >What version of Apache/Python/MP/OS is this?
> >
> >
> Good point, can't believe I didn't say!
> It's Linux, kernel 2.6.5, Fedora Core 2, Apache 2.0.49, mod_python 3.1.3
> (all standard rpms from fedora)
>
> What's the best way to debug this?
>
> David
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From list at joreybump.com  Tue May 18 14:12:01 2004
From: list at joreybump.com (Jorey Bump)
Date: Tue May 18 13:12:07 2004
Subject: [mod_python] Controlling authentication at run-time
In-Reply-To: <68A7AFEEA80F96479E120166638331AF81E1F1@exchange2.loyaltyworks.com>
References: <68A7AFEEA80F96479E120166638331AF81E1F1@exchange2.loyaltyworks.com>
Message-ID: <40AA43E1.5000703@joreybump.com>

Diener, Edward wrote:

> If Apache authentication is setup for files in a document directory 
> through directives in an .htaccess file, once the user has entered their 
> user name and password and is allowed access to the file, they are no 
> longer prompted each subsequent time as long as their session is active. 

The server continues to require the authentication for *each* access to 
the file. Your browser will provide it, but it will hide this action 
from you; hence, no prompt.

> Is there a way to control this at run-time so that the user will be 
> prompted for their user name and password in subsequent access to the 
> file, using mod_python ?

You can avoid HTTP Basic Authentication entirely, and create a function 
that displays a login form before serving the file from a directory that 
exists outside the document root.

That's just one possibility, there are plenty of other ways to approach it.
From Edward.Diener at loyaltyworks.com  Tue May 18 15:51:42 2004
From: Edward.Diener at loyaltyworks.com (Diener, Edward)
Date: Tue May 18 14:51:36 2004
Subject: [mod_python] Controlling authentication at run-time
Message-ID: <68A7AFEEA80F96479E120166638331AF7EC640@exchange2.loyaltyworks.com>

Why would the browser hide this action from me, producing no prompt ?

Diener, Edward wrote:

> If Apache authentication is setup for files in a document directory
> through directives in an .htaccess file, once the user has entered
their 
> user name and password and is allowed access to the file, they are no 
> longer prompted each subsequent time as long as their session is
active. 

The server continues to require the authentication for *each* access to 
the file. Your browser will provide it, but it will hide this action 
from you; hence, no prompt.

> Is there a way to control this at run-time so that the user will be
> prompted for their user name and password in subsequent access to the 
> file, using mod_python ?

You can avoid HTTP Basic Authentication entirely, and create a function 
that displays a login form before serving the file from a directory that

exists outside the document root.

That's just one possibility, there are plenty of other ways to approach
it. _______________________________________________
Mod_python mailing list
Mod_python@modpython.org
http://mailman.modpython.org/mailman/listinfo/mod_python

From ccurvey at earthlink.net  Tue May 18 16:25:16 2004
From: ccurvey at earthlink.net (Chris Curvey)
Date: Tue May 18 15:16:40 2004
Subject: [mod_python] Controlling authentication at run-time
In-Reply-To: <68A7AFEEA80F96479E120166638331AF7EC640@exchange2.loyaltyworks.com>
References: <68A7AFEEA80F96479E120166638331AF7EC640@exchange2.loyaltyworks.com>
Message-ID: <40AA631C.6070702@earthlink.net>

That's "Just The Way It Works".  ("It" in this case, being the basic 
authentication that's implemented as part of Apache.)

There's an example in the docs 
(http://www.modpython.org/live/current/doc-html/tut-more-complicated.html) 
that has instructions on setting up your own authentication handler 
using mod_python.  If I were you, I'd start there.  You could put 
whatever you wanted in there.

-Chris


Diener, Edward wrote:

>Why would the browser hide this action from me, producing no prompt ?
>
>Diener, Edward wrote:
>
>  
>
>>If Apache authentication is setup for files in a document directory
>>through directives in an .htaccess file, once the user has entered
>>    
>>
>their 
>  
>
>>user name and password and is allowed access to the file, they are no 
>>longer prompted each subsequent time as long as their session is
>>    
>>
>active. 
>
>The server continues to require the authentication for *each* access to 
>the file. Your browser will provide it, but it will hide this action 
>from you; hence, no prompt.
>
>  
>
>>Is there a way to control this at run-time so that the user will be
>>prompted for their user name and password in subsequent access to the 
>>file, using mod_python ?
>>    
>>
>
>You can avoid HTTP Basic Authentication entirely, and create a function 
>that displays a login form before serving the file from a directory that
>
>exists outside the document root.
>
>That's just one possibility, there are plenty of other ways to approach
>it. _______________________________________________
>Mod_python mailing list
>Mod_python@modpython.org
>http://mailman.modpython.org/mailman/listinfo/mod_python
>
>_______________________________________________
>Mod_python mailing list
>Mod_python@modpython.org
>http://mailman.modpython.org/mailman/listinfo/mod_python
>
>  
>


From michael at dynamine.net  Tue May 18 13:19:42 2004
From: michael at dynamine.net (Michael S. Fischer)
Date: Tue May 18 15:19:22 2004
Subject: [mod_python] Controlling authentication at run-time
In-Reply-To: <68A7AFEEA80F96479E120166638331AF7EC640@exchange2.loyaltyworks.com>
Message-ID: <20040518191913.0D46E3118BE@attrition.dynamine.net>

Diener, Edward writes:

> Why would the browser hide this action from me, producing no prompt ?

The browser caches credentials so that the user doesn't have to
re-authenticate every time he requests a page in the same authentication
realm during the same session.   

To do so otherwise would make the web browsing experience very annoying:
Imagine having to re-enter your user ID and password every time you changed
pages during a web banking session.

Note that this behavior was present in Web browsers even before Netscape
introduced cookies.

--Michael

From list at joreybump.com  Tue May 18 16:27:45 2004
From: list at joreybump.com (Jorey Bump)
Date: Tue May 18 15:27:50 2004
Subject: [mod_python] Controlling authentication at run-time
In-Reply-To: <68A7AFEEA80F96479E120166638331AF7EC640@exchange2.loyaltyworks.com>
References: <68A7AFEEA80F96479E120166638331AF7EC640@exchange2.loyaltyworks.com>
Message-ID: <40AA63B1.5070009@joreybump.com>

Diener, Edward wrote:

> Why would the browser hide this action from me, producing no prompt ?

For the sake of convenience. A browser must prompt for the login when it 
first encounters a location protected by HTTP Basic Authentication, 
since it doesn't know the user/password. Obviously, anyone could program 
a browser that simply caches this information for later reuse, but 
convention requires that the browser forgets this information when you 
close it. In fact, many will offer to save these values for future use 
(a potentially dangerous practice).

Why is this behavior important? Pick any modern password-protected web 
site and count the number of dependent files that must be loaded to 
render the page, such as images, stylesheets, javascript sources, etc. 
If your browser didn't remember your login, you would be prompted for 
every single one of those files. The site would be practically unusable.
From richard.whitehurst at reputations.co.uk  Wed May 19 12:43:51 2004
From: richard.whitehurst at reputations.co.uk (Richard Whitehurst)
Date: Wed May 19 06:42:35 2004
Subject: [mod_python] Directory indexing problem
Message-ID: <000d01c43d8e$4abbf9a0$a5e69851@nsoptimup4>

I would be very grateful for any help on this - see setup below.

When requesting /www/python the handler follows the IF path correctly.
Subsequently, with the same request (cookie is detected and ELSE path followed),
I get 404 Not Found and in the error log I get "Attempt to serve directory: /www/python/",
although requesting /www/python/index.html is served up ok.

If I remove the handler from the config, /www/python is served up ok, so the handler seems to
be affecting the "DirectoryIndex index.html" directive.

<Directory /www/python>
    SetHandler python-program
    PythonHandler sshandler
</Directory>

def handler(req):
    if not req.headers_in.has_key('Cookie'):
        req.headers_out['location'] = '/services/codeofconduct.html'
        req.status = apache.HTTP_SEE_OTHER
        return apache.OK
    else:
        return apache.DECLINED

Best wishes
Richard

Using: RedHat ES 3, Apache 2.0.46, mod_python 3.0.3, Python 2.2.3

From dg at sponsera.com  Wed May 19 10:58:20 2004
From: dg at sponsera.com (David Geller)
Date: Wed May 19 10:00:27 2004
Subject: [mod_python] questions about mod_python publisher
Message-ID: <40AB67FC.6070009@sponsera.com>

Hi,

I have been using the publisher handler for development purposes (after 
having used the more general handler paradigm previously), and am 
considering deployment..

Some questions:

1. Is the publisher suitable for public access, in terms of security, etc.?

2. With the publisher, can you store your python programs outside the 
document root? (I couldn't figure out a way for this)

3. With publisher, is it possible to hide the ".py" suffix?

4. I guess I would like to know what the publisher is really good for - 
it is convenient, but is it just better to code your own handler by hand?

Thanks in advance!

David

-- 
David Geller
Sponsera, LLC



From Edward.Diener at loyaltyworks.com  Wed May 19 11:22:21 2004
From: Edward.Diener at loyaltyworks.com (Diener, Edward)
Date: Wed May 19 10:22:02 2004
Subject: [mod_python] Controlling authentication at run-time
Message-ID: <68A7AFEEA80F96479E120166638331AF7EC641@exchange2.loyaltyworks.com>

>From other people's reply, that even when authentication is required by
the server the browser will automatically supply the user and password
during subsequent authentication requests after the first one, I do not
think that anything which I can do in my own authentication handler will
change the way the browser works.


That's "Just The Way It Works".  ("It" in this case, being the basic 
authentication that's implemented as part of Apache.)

There's an example in the docs 
(http://www.modpython.org/live/current/doc-html/tut-more-complicated.htm
l) 
that has instructions on setting up your own authentication handler 
using mod_python.  If I were you, I'd start there.  You could put 
whatever you wanted in there.

-Chris


Diener, Edward wrote:

>Why would the browser hide this action from me, producing no prompt ?
>
>Diener, Edward wrote:
>
>  
>
>>If Apache authentication is setup for files in a document directory 
>>through directives in an .htaccess file, once the user has entered
>>    
>>
>their
>  
>
>>user name and password and is allowed access to the file, they are no
>>longer prompted each subsequent time as long as their session is
>>    
>>
>active.
>
>The server continues to require the authentication for *each* access to
>the file. Your browser will provide it, but it will hide this action 
>from you; hence, no prompt.
>
>  
>
>>Is there a way to control this at run-time so that the user will be 
>>prompted for their user name and password in subsequent access to the 
>>file, using mod_python ?
>>    
>>
>
>You can avoid HTTP Basic Authentication entirely, and create a function
>that displays a login form before serving the file from a directory
that
>
>exists outside the document root.
>
>That's just one possibility, there are plenty of other ways to approach

>it. _______________________________________________
>Mod_python mailing list
>Mod_python@modpython.org 
>http://mailman.modpython.org/mailman/listinfo/mod_python
>
>_______________________________________________
>Mod_python mailing list
>Mod_python@modpython.org 
>http://mailman.modpython.org/mailman/listinfo/mod_python
>
>  
>



From Edward.Diener at loyaltyworks.com  Wed May 19 11:26:26 2004
From: Edward.Diener at loyaltyworks.com (Diener, Edward)
Date: Wed May 19 10:26:12 2004
Subject: [mod_python] Controlling authentication at run-time
Message-ID: <68A7AFEEA80F96479E120166638331AF81E1F3@exchange2.loyaltyworks.com>

OK, I understand that the browser is automatically supplying the
authentication information to the server. Is there any way to
short-circuit this for a particular URL ? The only thing I can think of
is that since the browser is supplying authentication information on
subsequent attempts within a session, if I can programatically close
down the session, I can force the authentication dialog the next time
around. Is there a way to programatically close down a session from the
server side using mod_python ?

Diener, Edward wrote:

> Why would the browser hide this action from me, producing no prompt ?

For the sake of convenience. A browser must prompt for the login when it

first encounters a location protected by HTTP Basic Authentication, 
since it doesn't know the user/password. Obviously, anyone could program

a browser that simply caches this information for later reuse, but 
convention requires that the browser forgets this information when you 
close it. In fact, many will offer to save these values for future use 
(a potentially dangerous practice).

Why is this behavior important? Pick any modern password-protected web 
site and count the number of dependent files that must be loaded to 
render the page, such as images, stylesheets, javascript sources, etc. 
If your browser didn't remember your login, you would be prompted for 
every single one of those files. The site would be practically unusable.
_______________________________________________
Mod_python mailing list
Mod_python@modpython.org
http://mailman.modpython.org/mailman/listinfo/mod_python

From davidf at sjsoft.com  Wed May 19 18:26:45 2004
From: davidf at sjsoft.com (David Fraser)
Date: Wed May 19 11:20:03 2004
Subject: [mod_python] Controlling authentication at run-time
In-Reply-To: <68A7AFEEA80F96479E120166638331AF81E1F3@exchange2.loyaltyworks.com>
References: <68A7AFEEA80F96479E120166638331AF81E1F3@exchange2.loyaltyworks.com>
Message-ID: <40AB7CB5.8050408@sjsoft.com>

 From my experience, you'll be a lot better off doing your own thing 
with cookies (or using the mod_python session code) than trying to use 
HTTP authentication. It's just as easy to code and you have a lot more 
flexibility - HTTP authentication support in most browsers isn't really 
designed for logging out.

David

Diener, Edward wrote:

>OK, I understand that the browser is automatically supplying the
>authentication information to the server. Is there any way to
>short-circuit this for a particular URL ? The only thing I can think of
>is that since the browser is supplying authentication information on
>subsequent attempts within a session, if I can programatically close
>down the session, I can force the authentication dialog the next time
>around. Is there a way to programatically close down a session from the
>server side using mod_python ?
>
>Diener, Edward wrote:
>
>  
>
>>Why would the browser hide this action from me, producing no prompt ?
>>    
>>
>
>For the sake of convenience. A browser must prompt for the login when it
>
>first encounters a location protected by HTTP Basic Authentication, 
>since it doesn't know the user/password. Obviously, anyone could program
>
>a browser that simply caches this information for later reuse, but 
>convention requires that the browser forgets this information when you 
>close it. In fact, many will offer to save these values for future use 
>(a potentially dangerous practice).
>
>Why is this behavior important? Pick any modern password-protected web 
>site and count the number of dependent files that must be loaded to 
>render the page, such as images, stylesheets, javascript sources, etc. 
>If your browser didn't remember your login, you would be prompted for 
>every single one of those files. The site would be practically unusable.
>_______________________________________________
>Mod_python mailing list
>Mod_python@modpython.org
>http://mailman.modpython.org/mailman/listinfo/mod_python
>
>_______________________________________________
>Mod_python mailing list
>Mod_python@modpython.org
>http://mailman.modpython.org/mailman/listinfo/mod_python
>
>  
>

From Edward.Diener at loyaltyworks.com  Wed May 19 12:22:29 2004
From: Edward.Diener at loyaltyworks.com (Diener, Edward)
Date: Wed May 19 11:22:09 2004
Subject: [mod_python] Python started with -U option as an Apache handler
Message-ID: <68A7AFEEA80F96479E120166638331AF7EC643@exchange2.loyaltyworks.com>

How do I get Apache to start python with the -U option when it is used
in an AddHandler statement ? When using straight CGI, and the file
upload functionality in it, python must be started with the -U option in
order for it to upload binary files, as opposed to text files,
correctly.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://modpython.org/pipermail/mod_python/attachments/20040519/1327f9fd/attachment.html
From neel at mediapulse.com  Wed May 19 12:52:13 2004
From: neel at mediapulse.com (Michael C. Neel)
Date: Wed May 19 11:52:23 2004
Subject: [mod_python] Python started with -U option as an Apache handler
In-Reply-To: <68A7AFEEA80F96479E120166638331AF7EC643@exchange2.loyaltyworks.com>
References: <68A7AFEEA80F96479E120166638331AF7EC643@exchange2.loyaltyworks.com>
Message-ID: <1084981933.16936.9.camel@mike.mediapulse.com>

I've handled serveral file types in mod_python from uploaded forms, and
didn't need anything special set.  If your not getting the files, check
that the form has the correct enctype set.  If you are getting data
that's incorrect, post some details on how you are accessing the files
to the list.

Mike

On Wed, 2004-05-19 at 11:22, Diener, Edward wrote:

> How do I get Apache to start python with the -U option when it is used
> in an AddHandler statement ? When using straight CGI, and the file
> upload functionality in it, python must be started with the -U option
> in order for it to upload binary files, as opposed to text files,
> correctly.
> 
> ______________________________________________________________________
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python

__________________________________ 

michael.neel@mediapulse.com
vice president of information systems
865.675.4455 x30
800.380.4514

www.mediapulse.com
__________________________________
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://modpython.org/pipermail/mod_python/attachments/20040519/5b602f47/attachment.html
From Edward.Diener at loyaltyworks.com  Wed May 19 13:33:31 2004
From: Edward.Diener at loyaltyworks.com (Diener, Edward)
Date: Wed May 19 12:33:27 2004
Subject: [mod_python] Python started with -U option as an Apache handler
Message-ID: <68A7AFEEA80F96479E120166638331AF81E1F4@exchange2.loyaltyworks.com>

The form has 

enctype="multipart/form-data"

In the HTML page.

I don't see why the form's enctype should affect how CGI creates a
string from a file when one specifies form["AFormField"].value for a
form field of <input type="file" name="AFormField"> but I will take any
help I can get on this. Evidently when CGI creates a string from the
file name when this access is done, it is opening the file as a text
file rather than a binary file, which is not good.

-----Original Message-----
From: Michael C. Neel [mailto:neel@mediapulse.com] 
Sent: Wednesday, May 19, 2004 11:52 AM
To: Diener, Edward
Cc: mod_python@modpython.org
Subject: Re: [mod_python] Python started with -U option as an Apache
handler


I've handled serveral file types in mod_python from uploaded forms, and
didn't need anything special set.  If your not getting the files, check
that the form has the correct enctype set.  If you are getting data
that's incorrect, post some details on how you are accessing the files
to the list.

Mike

On Wed, 2004-05-19 at 11:22, Diener, Edward wrote: 
How do I get Apache to start python with the -U option when it is used
in an AddHandler statement ? When using straight CGI, and the file
upload functionality in it, python must be started with the -U option in
order for it to upload binary files, as opposed to text files,
correctly.



_______________________________________________
Mod_python mailing list
Mod_python@modpython.org
http://mailman.modpython.org/mailman/listinfo/mod_python
__________________________________ michael.neel@mediapulse.comvice
president of information systems865.675.4455
x30800.380.4514www.mediapulse.com__________________________________ 

From neel at mediapulse.com  Wed May 19 14:00:16 2004
From: neel at mediapulse.com (Michael C. Neel)
Date: Wed May 19 13:00:28 2004
Subject: [mod_python] Python started with -U option as an Apache handler
In-Reply-To: <68A7AFEEA80F96479E120166638331AF81E1F4@exchange2.loyaltyworks.com>
References: <68A7AFEEA80F96479E120166638331AF81E1F4@exchange2.loyaltyworks.com>
Message-ID: <1084986016.16936.23.camel@mike.mediapulse.com>

I take it your using FieldStorage class of mod_python correct?  Take a
look at the docs should help:

http://modpython.org/live/current/doc-html/pyapi-util-fstor.html
http://modpython.org/live/current/doc-html/pyapi-util-fstor-fld.html

And since you mention you've used cgi in the past, take note of the
folling in the docs:

"Note: Unlike the standard library cgi module FieldStorage class, a
Field object is returned only when it is a file upload. In all other
cases the return is an instance of StringField. This means that you do
not need to use the .value attribute to access values of fields in most
cases."

I don't use the FieldStorage class, but it looks like you want
form["AFormField"].file

Mike

On Wed, 2004-05-19 at 12:33, Diener, Edward wrote:

> The form has 
> 
> enctype="multipart/form-data"
> 
> In the HTML page.
> 
> I don't see why the form's enctype should affect how CGI creates a
> string from a file when one specifies form["AFormField"].value for a
> form field of <input type="file" name="AFormField"> but I will take any
> help I can get on this. Evidently when CGI creates a string from the
> file name when this access is done, it is opening the file as a text
> file rather than a binary file, which is not good.
> 
> -----Original Message-----
> From: Michael C. Neel [mailto:neel@mediapulse.com] 
> Sent: Wednesday, May 19, 2004 11:52 AM
> To: Diener, Edward
> Cc: mod_python@modpython.org
> Subject: Re: [mod_python] Python started with -U option as an Apache
> handler
> 
> 
> I've handled serveral file types in mod_python from uploaded forms, and
> didn't need anything special set.  If your not getting the files, check
> that the form has the correct enctype set.  If you are getting data
> that's incorrect, post some details on how you are accessing the files
> to the list.
> 
> Mike
> 
> On Wed, 2004-05-19 at 11:22, Diener, Edward wrote: 
> How do I get Apache to start python with the -U option when it is used
> in an AddHandler statement ? When using straight CGI, and the file
> upload functionality in it, python must be started with the -U option in
> order for it to upload binary files, as opposed to text files,
> correctly.
> 
> 
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
> __________________________________ michael.neel@mediapulse.comvice
> president of information systems865.675.4455
> x30800.380.4514www.mediapulse.com__________________________________ 

__________________________________ 

michael.neel@mediapulse.com
vice president of information systems
865.675.4455 x30
800.380.4514

www.mediapulse.com
__________________________________
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://modpython.org/pipermail/mod_python/attachments/20040519/77c9a93b/attachment.html
From terry.macdonald at dsl.pipex.com  Wed May 19 19:12:23 2004
From: terry.macdonald at dsl.pipex.com (Terry MacDonald)
Date: Wed May 19 13:12:26 2004
Subject: [mod_python] questions about mod_python publisher
In-Reply-To: <40AB67FC.6070009@sponsera.com>
References: <40AB67FC.6070009@sponsera.com>
Message-ID: <1084986743.8661.12.camel@bigmac.taumu.com>

Some good questions especially...

3. With publisher, is it possible to hide the ".py" suffix?

I've been trying for an answer to that for a while.  The suggestion is
that one uses SetHandler but I'll be %^&(* if I can get it to work
properly. AddHandler (with Directorys) works fine.

If anyone out there is using the publisher handler and SetHandler to
avoid having .py extensions and it works! could they publish the
pertinent configuration data please (pretty please!). I tend not to use
.htaccess files and prefer the main config file for setting these things
up - if that helps.




On Wed, 2004-05-19 at 14:58, David Geller wrote:
> Hi,
> 
> I have been using the publisher handler for development purposes (after 
> having used the more general handler paradigm previously), and am 
> considering deployment..
> 
> Some questions:
> 
> 1. Is the publisher suitable for public access, in terms of security, etc.?
> 
> 2. With the publisher, can you store your python programs outside the 
> document root? (I couldn't figure out a way for this)
> 
> 3. With publisher, is it possible to hide the ".py" suffix?
> 
> 4. I guess I would like to know what the publisher is really good for - 
> it is convenient, but is it just better to code your own handler by hand?
> 
> Thanks in advance!
> 
> David
-- 
Terry
Registered Linux User # 311806
www.taumu.com


From Edward.Diener at loyaltyworks.com  Wed May 19 14:24:00 2004
From: Edward.Diener at loyaltyworks.com (Diener, Edward)
Date: Wed May 19 13:23:38 2004
Subject: [mod_python] Python started with -U option as an Apache handler
Message-ID: <68A7AFEEA80F96479E120166638331AF7EC646@exchange2.loyaltyworks.com>

Problem has been solved by having my first bang line in the .py file end
in python -u

	-----Original Message-----
	From: Michael C. Neel [mailto:neel@mediapulse.com] 
	Sent: Wednesday, May 19, 2004 1:00 PM
	To: Diener, Edward
	Cc: mod_python@modpython.org
	Subject: RE: [mod_python] Python started with -U option as an
Apache handler
	
	
	I take it your using FieldStorage class of mod_python correct?
Take a look at the docs should help:
	
	http://modpython.org/live/current/doc-html/pyapi-util-fstor.html
	
http://modpython.org/live/current/doc-html/pyapi-util-fstor-fld.html
	
	And since you mention you've used cgi in the past, take note of
the folling in the docs:
	
	"Note: Unlike the standard library cgi module FieldStorage
class, a Field object is returned only when it is a file upload. In all
other cases the return is an instance of StringField. This means that
you do not need to use the .value attribute to access values of fields
in most cases."
	
	I don't use the FieldStorage class, but it looks like you want
form["AFormField"].file
	
	Mike
	
	On Wed, 2004-05-19 at 12:33, Diener, Edward wrote: 

		The form has 
		
		enctype="multipart/form-data"
		
		In the HTML page.
		
		I don't see why the form's enctype should affect how CGI
creates a
		string from a file when one specifies
form["AFormField"].value for a
		form field of <input type="file" name="AFormField"> but
I will take any
		help I can get on this. Evidently when CGI creates a
string from the
		file name when this access is done, it is opening the
file as a text
		file rather than a binary file, which is not good.
		
		-----Original Message-----
		From: Michael C. Neel [mailto:neel@mediapulse.com] 
		Sent: Wednesday, May 19, 2004 11:52 AM
		To: Diener, Edward
		Cc: mod_python@modpython.org
		Subject: Re: [mod_python] Python started with -U option
as an Apache
		handler
		
		
		I've handled serveral file types in mod_python from
uploaded forms, and
		didn't need anything special set.  If your not getting
the files, check
		that the form has the correct enctype set.  If you are
getting data
		that's incorrect, post some details on how you are
accessing the files
		to the list.
		
		Mike
		
		On Wed, 2004-05-19 at 11:22, Diener, Edward wrote: 
		How do I get Apache to start python with the -U option
when it is used
		in an AddHandler statement ? When using straight CGI,
and the file
		upload functionality in it, python must be started with
the -U option in
		order for it to upload binary files, as opposed to text
files,
		correctly.
		
		
		
		_______________________________________________
		Mod_python mailing list
		Mod_python@modpython.org
		http://mailman.modpython.org/mailman/listinfo/mod_python
<http://mailman.modpython.org/mailman/listinfo/mod_python> 
		__________________________________
michael.neel@mediapulse.comvice
		president of information systems865.675.4455
		x30800.380.4514www.mediapulse.com
<http://www.mediapulse.com> __________________________________ 

	
__________________________________ 

michael.neel <mailto:michael.neel@mediapulse.com> @mediapulse.com
<mailto:michael.neel@mediapulse.com> 
vice president of information systems
865.675.4455 x30
800.380.4514

www.mediapulse.com <http://www.mediapulse.com/> 
__________________________________ 	


-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://modpython.org/pipermail/mod_python/attachments/20040519/d97a4e76/attachment.html
From list at joreybump.com  Wed May 19 14:27:25 2004
From: list at joreybump.com (Jorey Bump)
Date: Wed May 19 13:27:35 2004
Subject: [mod_python] questions about mod_python publisher
In-Reply-To: <40AB67FC.6070009@sponsera.com>
References: <40AB67FC.6070009@sponsera.com>
Message-ID: <40AB98FD.6050004@joreybump.com>

David Geller wrote:

> Hi,
> 
> I have been using the publisher handler for development purposes (after 
> having used the more general handler paradigm previously), and am 
> considering deployment..
> 
> Some questions:
> 
> 1. Is the publisher suitable for public access, in terms of security, etc.?

I'm using it publicly. I'm unaware of any intrinsic security issues. It 
will only be as secure as the apps you write.

> 2. With the publisher, can you store your python programs outside the 
> document root? (I couldn't figure out a way for this)

Yes, but there are different answers to this question. You can place 
your files anywhere on the system, and use the Alias directive in your 
apache configuration:

  Alias /snake/ /var/www/python/

Then you would use this URL:

  http://www.example.com/snake/

You can also develop packages and install them in the site-packages 
directory alongside other 3rd party packages. Then they will be in your 
path for easy importing and sharing among applications. Of course, you 
will still need at least one python file to run under apache, but the 
bulk of your code will be completely out of the web directory.

> 3. With publisher, is it possible to hide the ".py" suffix?

I don't need to use the suffix. My httpd.conf looks like this (Debian 
Woody: apache 1.3.26, mod_python 2.7.8):

<Directory /var/www/documentroot>
   AddHandler python-program .py
   PythonHandler mod_python.publisher
   PythonDebug On
</Directory>

I can access function foobar in app.py like this:

  http://www.example.com/app/foobar

> 4. I guess I would like to know what the publisher is really good for - 
> it is convenient, but is it just better to code your own handler by hand?

I can't imagine why. Publisher is clean and crisp. I love it!

As an example of its convenience, I wrote and tested an entire module on 
a Windows machine and copied it to my Linux server. I added a single 
function to handle the request from a web page and serve as a frontend 
to the rest of the application. I've never encountered that kind of 
portability before.






From davidf at sjsoft.com  Wed May 19 20:58:31 2004
From: davidf at sjsoft.com (David Fraser)
Date: Wed May 19 13:51:49 2004
Subject: [mod_python] Controlling authentication at run-time
In-Reply-To: <1084988103.8661.36.camel@bigmac.taumu.com>
References: <68A7AFEEA80F96479E120166638331AF81E1F3@exchange2.loyaltyworks.com>	
	<40AB7CB5.8050408@sjsoft.com>
	<1084988103.8661.36.camel@bigmac.taumu.com>
Message-ID: <40ABA047.3080105@sjsoft.com>

Presume you meant to send this to the list too...

David

Terry MacDonald wrote:

>Looking for suggestions/ideas/implementations...
>
>On the subject of authentication lets assume we are using the publisher
>handler and that we do not want to use basic http authentication to ask
>for login details; we want our own nice login integrated into the page.
>
>Another requirement is to have the login page appear only when the user
>wants to access certain areas/pages of the site and they are not already
>logged in (all other pages are public). The 'are they' 'aren't they'
>logged in can be handled by the session stuff which I understand and
>have implemented elsewhere.
>
>Note: when not using the http basic authentication any authenhandler
>specified in the python http config is NOT called. Therefore authen code
>now has to be integrated into each of the the protected pages - correct?
>instead of always being called before the main handler when a certain
>directory is accessed.
>  
>
Yes, correct...

>Anyway, question(s):
>
>A protected page is requested and the user has yet to login (session
>check at start of page does this, yes?), so the login page is
>displayed.  If login is successful how do we know which of the protected
>pages we should display because that information (i.e. originally
>requested page) was several requests ago before a session was
>established, since then we have had login information sent to us.
>
>Summarising, as users log in how do I display the page they originally
>requested prior to the login stuff getting in the way and not some
>default page as a get out clause. 
>  
>
You can either serve the login page from the original URL they were 
accessing, or redirect them to the login page but pass a parameter 
indicating where to go next...
Note I'm not too familiar with publisher...

>Cheers
>
>On Wed, 2004-05-19 at 16:26, David Fraser wrote:
>  
>
>> From my experience, you'll be a lot better off doing your own thing 
>>with cookies (or using the mod_python session code) than trying to use 
>>HTTP authentication. It's just as easy to code and you have a lot more 
>>flexibility - HTTP authentication support in most browsers isn't really 
>>designed for logging out.
>>
>>David
>>
>>Diener, Edward wrote:
>>
>>    
>>
>>>OK, I understand that the browser is automatically supplying the
>>>authentication information to the server. Is there any way to
>>>short-circuit this for a particular URL ? The only thing I can think of
>>>is that since the browser is supplying authentication information on
>>>subsequent attempts within a session, if I can programatically close
>>>down the session, I can force the authentication dialog the next time
>>>around. Is there a way to programatically close down a session from the
>>>server side using mod_python ?
>>>
>>>Diener, Edward wrote:
>>>
>>> 
>>>
>>>      
>>>
>>>>Why would the browser hide this action from me, producing no prompt ?
>>>>   
>>>>
>>>>        
>>>>
>>>For the sake of convenience. A browser must prompt for the login when it
>>>
>>>first encounters a location protected by HTTP Basic Authentication, 
>>>since it doesn't know the user/password. Obviously, anyone could program
>>>
>>>a browser that simply caches this information for later reuse, but 
>>>convention requires that the browser forgets this information when you 
>>>close it. In fact, many will offer to save these values for future use 
>>>(a potentially dangerous practice).
>>>
>>>Why is this behavior important? Pick any modern password-protected web 
>>>site and count the number of dependent files that must be loaded to 
>>>render the page, such as images, stylesheets, javascript sources, etc. 
>>>If your browser didn't remember your login, you would be prompted for 
>>>every single one of those files. The site would be practically unusable.
>>>_______________________________________________
>>>Mod_python mailing list
>>>Mod_python@modpython.org
>>>http://mailman.modpython.org/mailman/listinfo/mod_python
>>>
>>>_______________________________________________
>>>Mod_python mailing list
>>>Mod_python@modpython.org
>>>http://mailman.modpython.org/mailman/listinfo/mod_python
>>>
>>> 
>>>
>>>      
>>>
>>_______________________________________________
>>Mod_python mailing list
>>Mod_python@modpython.org
>>http://mailman.modpython.org/mailman/listinfo/mod_python
>>    
>>

From terry.macdonald at dsl.pipex.com  Wed May 19 19:56:02 2004
From: terry.macdonald at dsl.pipex.com (Terry MacDonald)
Date: Wed May 19 13:56:05 2004
Subject: [mod_python] questions about mod_python publisher
In-Reply-To: <40AB98FD.6050004@joreybump.com>
References: <40AB67FC.6070009@sponsera.com> <40AB98FD.6050004@joreybump.com>
Message-ID: <1084989362.8661.48.camel@bigmac.taumu.com>

On Wed, 2004-05-19 at 18:27, Jorey Bump wrote:
> I don't need to use the suffix. My httpd.conf looks like this (Debian 
> Woody: apache 1.3.26, mod_python 2.7.8):
> 
> <Directory /var/www/documentroot>
>    AddHandler python-program .py
>    PythonHandler mod_python.publisher
>    PythonDebug On
> </Directory>
> 
> I can access function foobar in app.py like this:
> 
>   http://www.example.com/app/foobar


Well something is different because with this config (i'm not an apache
expert):

(Using Fedora Core 1, apache 2.0.48 and mod_python 3.1.3)

PythonDebug on
 
<Directory "/var/www/python">
    PythonPath "['/var/www/python']+sys.path"
    AddHandler mod_python .py
    PythonHandler mod_python.publisher
    Options None
    AllowOverride None
    Order allow,deny
    Allow from all
</Directory>

my foobar in app.py called as http://localhost/app/foobar gives a 'Not
Found' error while http://localhost/app.py/foobar works fine.

This is an ongoing bugbear for me: dropping the .py.  Can anyone explain
this odd behaviour, Grisha?


David Geller wrote:
> 
> > Hi,
> > 
> > I have been using the publisher handler for development purposes (after 
> > having used the more general handler paradigm previously), and am 
> > considering deployment..
> > 
> > Some questions:
> > 
> > 1. Is the publisher suitable for public access, in terms of security, etc.?
> 
> I'm using it publicly. I'm unaware of any intrinsic security issues. It 
> will only be as secure as the apps you write.
> 
> > 2. With the publisher, can you store your python programs outside the 
> > document root? (I couldn't figure out a way for this)
> 
> Yes, but there are different answers to this question. You can place 
> your files anywhere on the system, and use the Alias directive in your 
> apache configuration:
> 
>   Alias /snake/ /var/www/python/
> 
> Then you would use this URL:
> 
>   http://www.example.com/snake/
> 
> You can also develop packages and install them in the site-packages 
> directory alongside other 3rd party packages. Then they will be in your 
> path for easy importing and sharing among applications. Of course, you 
> will still need at least one python file to run under apache, but the 
> bulk of your code will be completely out of the web directory.
> 
> > 3. With publisher, is it possible to hide the ".py" suffix?
> 
> I don't need to use the suffix. My httpd.conf looks like this (Debian 
> Woody: apache 1.3.26, mod_python 2.7.8):
> 
> <Directory /var/www/documentroot>
>    AddHandler python-program .py
>    PythonHandler mod_python.publisher
>    PythonDebug On
> </Directory>
> 
> I can access function foobar in app.py like this:
> 
>   http://www.example.com/app/foobar
> 
> > 4. I guess I would like to know what the publisher is really good for - 
> > it is convenient, but is it just better to code your own handler by hand?
> 
> I can't imagine why. Publisher is clean and crisp. I love it!
> 
> As an example of its convenience, I wrote and tested an entire module on 
> a Windows machine and copied it to my Linux server. I added a single 
> function to handle the request from a web page and serve as a frontend 
> to the rest of the application. I've never encountered that kind of 
> portability before.
> 
> 
> 
> 
> 
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
-- 
Terry
Registered Linux User # 311806
www.taumu.com


From dg at sponsera.com  Wed May 19 15:24:29 2004
From: dg at sponsera.com (David Geller)
Date: Wed May 19 14:24:37 2004
Subject: [mod_python] questions about mod_python publisher
In-Reply-To: <1084989362.8661.48.camel@bigmac.taumu.com>
References: <40AB67FC.6070009@sponsera.com> <40AB98FD.6050004@joreybump.com>
	<1084989362.8661.48.camel@bigmac.taumu.com>
Message-ID: <40ABA65D.2030003@sponsera.com>

I have had the same experience as Terry.

However, I just tried something and it worked!

 <Directory /www/docroot>
      PythonInterpreter myapp2
    PythonPath "blahblabh
    SetHandler python-program
    PythonHandler mod_python.publisher
    PythonDebug On
  </Directory>

i.e., use "SetHander python-program" with no following argument ".py", 
followed by "PythonHandler with arg of mod_python.publisher"

Terry MacDonald wrote:

>On Wed, 2004-05-19 at 18:27, Jorey Bump wrote:
>  
>
>>I don't need to use the suffix. My httpd.conf looks like this (Debian 
>>Woody: apache 1.3.26, mod_python 2.7.8):
>>
>><Directory /var/www/documentroot>
>>   AddHandler python-program .py
>>   PythonHandler mod_python.publisher
>>   PythonDebug On
>></Directory>
>>
>>I can access function foobar in app.py like this:
>>
>>  http://www.example.com/app/foobar
>>    
>>
>
>
>Well something is different because with this config (i'm not an apache
>expert):
>
>(Using Fedora Core 1, apache 2.0.48 and mod_python 3.1.3)
>
>PythonDebug on
> 
><Directory "/var/www/python">
>    PythonPath "['/var/www/python']+sys.path"
>    AddHandler mod_python .py
>    PythonHandler mod_python.publisher
>    Options None
>    AllowOverride None
>    Order allow,deny
>    Allow from all
></Directory>
>
>my foobar in app.py called as http://localhost/app/foobar gives a 'Not
>Found' error while http://localhost/app.py/foobar works fine.
>
>This is an ongoing bugbear for me: dropping the .py.  Can anyone explain
>this odd behaviour, Grisha?
>
>
>David Geller wrote:
>  
>
>>>Hi,
>>>
>>>I have been using the publisher handler for development purposes (after 
>>>having used the more general handler paradigm previously), and am 
>>>considering deployment..
>>>
>>>Some questions:
>>>
>>>1. Is the publisher suitable for public access, in terms of security, etc.?
>>>      
>>>
>>I'm using it publicly. I'm unaware of any intrinsic security issues. It 
>>will only be as secure as the apps you write.
>>
>>    
>>
>>>2. With the publisher, can you store your python programs outside the 
>>>document root? (I couldn't figure out a way for this)
>>>      
>>>
>>Yes, but there are different answers to this question. You can place 
>>your files anywhere on the system, and use the Alias directive in your 
>>apache configuration:
>>
>>  Alias /snake/ /var/www/python/
>>
>>Then you would use this URL:
>>
>>  http://www.example.com/snake/
>>
>>You can also develop packages and install them in the site-packages 
>>directory alongside other 3rd party packages. Then they will be in your 
>>path for easy importing and sharing among applications. Of course, you 
>>will still need at least one python file to run under apache, but the 
>>bulk of your code will be completely out of the web directory.
>>
>>    
>>
>>>3. With publisher, is it possible to hide the ".py" suffix?
>>>      
>>>
>>I don't need to use the suffix. My httpd.conf looks like this (Debian 
>>Woody: apache 1.3.26, mod_python 2.7.8):
>>
>><Directory /var/www/documentroot>
>>   AddHandler python-program .py
>>   PythonHandler mod_python.publisher
>>   PythonDebug On
>></Directory>
>>
>>I can access function foobar in app.py like this:
>>
>>  http://www.example.com/app/foobar
>>
>>    
>>
>>>4. I guess I would like to know what the publisher is really good for - 
>>>it is convenient, but is it just better to code your own handler by hand?
>>>      
>>>
>>I can't imagine why. Publisher is clean and crisp. I love it!
>>
>>As an example of its convenience, I wrote and tested an entire module on 
>>a Windows machine and copied it to my Linux server. I added a single 
>>function to handle the request from a web page and serve as a frontend 
>>to the rest of the application. I've never encountered that kind of 
>>portability before.
>>
>>
>>
>>
>>
>>
>>_______________________________________________
>>Mod_python mailing list
>>Mod_python@modpython.org
>>http://mailman.modpython.org/mailman/listinfo/mod_python
>>    
>>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://modpython.org/pipermail/mod_python/attachments/20040519/b9790f51/attachment.html
From volodya at real.samuraj.org  Wed May 19 22:40:26 2004
From: volodya at real.samuraj.org (Volodya)
Date: Wed May 19 14:41:02 2004
Subject: [mod_python] questions about mod_python publisher
In-Reply-To: <1084986743.8661.12.camel@bigmac.taumu.com>
References: <40AB67FC.6070009@sponsera.com>
	<1084986743.8661.12.camel@bigmac.taumu.com>
Message-ID: <20040519184026.GA31401@debian.mki-btc.com>

On Wed, May 19, 2004 at 06:12:23PM +0100, Terry MacDonald wrote:
> Some good questions especially...
> 
> 3. With publisher, is it possible to hide the ".py" suffix?
> 
> I've been trying for an answer to that for a while.  The suggestion is
> that one uses SetHandler but I'll be %^&(* if I can get it to work
> properly. AddHandler (with Directorys) works fine.
> 
> If anyone out there is using the publisher handler and SetHandler to
> avoid having .py extensions and it works! could they publish the
> pertinent configuration data please (pretty please!). I tend not to use
> .htaccess files and prefer the main config file for setting these things
> up - if that helps.
> 
> 

Just write your publisher's code into index.py file.
For example , if we have /var/www/test/index.py (where /var/www/ is
the httpd's document root), than we can use:

http://SERVER/test/     	(calls index function in index.py)
http://SERVER/test/hello        (calls hello function in index.py)
http://SERVER/test/?id=555      (calls index function with id paramater
				set to 555)

Set these options for test subdirectory (as for me, i prefer .htaccess):
  SetHandler mod_python
  PythonHandler mod_python.publisher


From list at joreybump.com  Wed May 19 16:57:17 2004
From: list at joreybump.com (Jorey Bump)
Date: Wed May 19 15:57:25 2004
Subject: [mod_python] questions about mod_python publisher
In-Reply-To: <40ABA65D.2030003@sponsera.com>
References: <40AB67FC.6070009@sponsera.com>
	<40AB98FD.6050004@joreybump.com>	<1084989362.8661.48.camel@bigmac.taumu.com>
	<40ABA65D.2030003@sponsera.com>
Message-ID: <40ABBC1D.1040406@joreybump.com>

David Geller wrote:

> I have had the same experience as Terry.
> 
> However, I just tried something and it worked!
> 
>  <Directory /www/docroot>
>       PythonInterpreter myapp2
>     PythonPath "blahblabh
>     SetHandler python-program
>     PythonHandler mod_python.publisher
>     PythonDebug On
>   </Directory>
> 
> i.e., use "SetHander python-program" with no following argument ".py", 
> followed by "PythonHandler with arg of mod_python.publisher"

Hmmm, then *every* file needs to be a python program. You can't mix 
html, php and image files. You might as well just run python apps from 
cgi-bin.

This is an interesting problem. With these directives in httpd.conf:

<Directory /var/www/documentroot>
   AddHandler python-program .py
   PythonHandler mod_python.publisher
   PythonDebug On
</Directory>

And assuming my app is test.py:

def hello(req):
     x = "Hello, world!"
     return x

I can access it on my Debian Woody production server (apache 1.3.26, 
mod_python 2.7.8) like this :

  http://www.example.com/test/hello

But on my Red Hat 9 server (apache 2.0.40, and mod_python 3.0.1-4), I 
need the extension:

   http://www.example.com/test.py/hello

If I change the AddHandler directive to:

   SetHandler python-program

I MUST access it without the extension, but all files in the directory 
are treated as python programs. This seems less flexible to me. I can't 
simply turn on mod_python for the entire site, as I do now. Is this the 
result of a change in apache or mod_python?






From terry.macdonald at dsl.pipex.com  Thu May 20 00:14:06 2004
From: terry.macdonald at dsl.pipex.com (Terry MacDonald)
Date: Wed May 19 18:14:10 2004
Subject: [mod_python] questions about mod_python publisher
In-Reply-To: <40ABA65D.2030003@sponsera.com>
References: <40AB67FC.6070009@sponsera.com> <40AB98FD.6050004@joreybump.com>
	<1084989362.8661.48.camel@bigmac.taumu.com>
	<40ABA65D.2030003@sponsera.com>
Message-ID: <1085004846.8661.55.camel@bigmac.taumu.com>

If your workaround is reliant on using python-program instaed of
mod_python then unfortunately, according to Grisha, python-program which
can be used interchangeably with mod_python is going to be deprecated in
future releases.


On Wed, 2004-05-19 at 19:24, David Geller wrote:
> I have had the same experience as Terry.
> 
> However, I just tried something and it worked!
> 
>  <Directory /www/docroot>
>       PythonInterpreter myapp2
>     PythonPath "blahblabh
>     SetHandler python-program
>     PythonHandler mod_python.publisher
>     PythonDebug On 
>   </Directory>
> 
> i.e., use "SetHander python-program" with no following argument ".py",
> followed by "PythonHandler with arg of mod_python.publisher"
> 
> Terry MacDonald wrote:
> > On Wed, 2004-05-19 at 18:27, Jorey Bump wrote:
> >   
> > > I don't need to use the suffix. My httpd.conf looks like this (Debian 
> > > Woody: apache 1.3.26, mod_python 2.7.8):
> > > 
> > > <Directory /var/www/documentroot>
> > >    AddHandler python-program .py
> > >    PythonHandler mod_python.publisher
> > >    PythonDebug On
> > > </Directory>
> > > 
> > > I can access function foobar in app.py like this:
> > > 
> > >   http://www.example.com/app/foobar
> > >     
> > 
> > Well something is different because with this config (i'm not an apache
> > expert):
> > 
> > (Using Fedora Core 1, apache 2.0.48 and mod_python 3.1.3)
> > 
> > PythonDebug on
> >  
> > <Directory "/var/www/python">
> >     PythonPath "['/var/www/python']+sys.path"
> >     AddHandler mod_python .py
> >     PythonHandler mod_python.publisher
> >     Options None
> >     AllowOverride None
> >     Order allow,deny
> >     Allow from all
> > </Directory>
> > 
> > my foobar in app.py called as http://localhost/app/foobar gives a 'Not
> > Found' error while http://localhost/app.py/foobar works fine.
> > 
> > This is an ongoing bugbear for me: dropping the .py.  Can anyone explain
> > this odd behaviour, Grisha?
> > 
> > 
> > David Geller wrote:
> >   
> > > > Hi,
> > > > 
> > > > I have been using the publisher handler for development purposes (after 
> > > > having used the more general handler paradigm previously), and am 
> > > > considering deployment..
> > > > 
> > > > Some questions:
> > > > 
> > > > 1. Is the publisher suitable for public access, in terms of security, etc.?
> > > >       
> > > I'm using it publicly. I'm unaware of any intrinsic security issues. It 
> > > will only be as secure as the apps you write.
> > > 
> > >     
> > > > 2. With the publisher, can you store your python programs outside the 
> > > > document root? (I couldn't figure out a way for this)
> > > >       
> > > Yes, but there are different answers to this question. You can place 
> > > your files anywhere on the system, and use the Alias directive in your 
> > > apache configuration:
> > > 
> > >   Alias /snake/ /var/www/python/
> > > 
> > > Then you would use this URL:
> > > 
> > >   http://www.example.com/snake/
> > > 
> > > You can also develop packages and install them in the site-packages 
> > > directory alongside other 3rd party packages. Then they will be in your 
> > > path for easy importing and sharing among applications. Of course, you 
> > > will still need at least one python file to run under apache, but the 
> > > bulk of your code will be completely out of the web directory.
> > > 
> > >     
> > > > 3. With publisher, is it possible to hide the ".py" suffix?
> > > >       
> > > I don't need to use the suffix. My httpd.conf looks like this (Debian 
> > > Woody: apache 1.3.26, mod_python 2.7.8):
> > > 
> > > <Directory /var/www/documentroot>
> > >    AddHandler python-program .py
> > >    PythonHandler mod_python.publisher
> > >    PythonDebug On
> > > </Directory>
> > > 
> > > I can access function foobar in app.py like this:
> > > 
> > >   http://www.example.com/app/foobar
> > > 
> > >     
> > > > 4. I guess I would like to know what the publisher is really good for - 
> > > > it is convenient, but is it just better to code your own handler by hand?
> > > >       
> > > I can't imagine why. Publisher is clean and crisp. I love it!
> > > 
> > > As an example of its convenience, I wrote and tested an entire module on 
> > > a Windows machine and copied it to my Linux server. I added a single 
> > > function to handle the request from a web page and serve as a frontend 
> > > to the rest of the application. I've never encountered that kind of 
> > > portability before.
> > > 
> > > 
> > > 
> > > 
> > > 
> > > 
> > > _______________________________________________
> > > Mod_python mailing list
> > > Mod_python@modpython.org
> > > http://mailman.modpython.org/mailman/listinfo/mod_python
> > >     
> 
> 
> ______________________________________________________________________
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
-- 
Terry
Registered Linux User # 311806
www.taumu.com


From terry.macdonald at dsl.pipex.com  Thu May 20 00:34:22 2004
From: terry.macdonald at dsl.pipex.com (Terry MacDonald)
Date: Wed May 19 18:34:25 2004
Subject: [mod_python] questions about mod_python publisher
In-Reply-To: <40ABBC1D.1040406@joreybump.com>
References: <40AB67FC.6070009@sponsera.com> <40AB98FD.6050004@joreybump.com>
	<1084989362.8661.48.camel@bigmac.taumu.com>
	<40ABA65D.2030003@sponsera.com> <40ABBC1D.1040406@joreybump.com>
Message-ID: <1085006062.8661.79.camel@bigmac.taumu.com>


On Wed, 2004-05-19 at 20:57, Jorey Bump wrote:
> I MUST access it without the extension, but all files in the directory 
> are treated as python programs. This seems less flexible to me. I can't 
> simply turn on mod_python for the entire site, as I do now. Is this the 
> result of a change in apache or mod_python?
> 
Is this why when I use try to use SetHandler (and publisher) my css file
and img files fail to load. I just get a plain text version of my web
pages.   Everything works for AddHandler (but I have to use extensions)

-- 
Terry
Registered Linux User # 311806
www.taumu.com


From terry.macdonald at dsl.pipex.com  Thu May 20 01:14:49 2004
From: terry.macdonald at dsl.pipex.com (Terry MacDonald)
Date: Wed May 19 19:14:52 2004
Subject: [mod_python] questions about mod_python publisher
In-Reply-To: <20040519184026.GA31401@debian.mki-btc.com>
References: <40AB67FC.6070009@sponsera.com>
	<1084986743.8661.12.camel@bigmac.taumu.com>
	<20040519184026.GA31401@debian.mki-btc.com>
Message-ID: <1085008488.8661.121.camel@bigmac.taumu.com>

On Wed, 2004-05-19 at 19:40, Volodya wrote:

> Just write your publisher's code into index.py file.
> For example , if we have /var/www/test/index.py (where /var/www/ is
> the httpd's document root), than we can use:
> 
> http://SERVER/test/     	(calls index function in index.py)
> http://SERVER/test/hello        (calls hello function in index.py)
> http://SERVER/test/?id=555      (calls index function with id paramater
> 				set to 555)
> 
> Set these options for test subdirectory (as for me, i prefer .htaccess):
>   SetHandler mod_python
>   PythonHandler mod_python.publisher
> 

If I use SetHandler 

 http://SERVER/test/ causes a forbidden error
 http://SERVER/test/hello causes a not found error

Using Addhandler works but with a minor error explained in a mail I
posted back on the 12 May and repeated below...

Here is my current apache config for mod_python:
=================================================
PythonDebug on
PythonOption SessionDbm /tmp/app_sess.dbm
 
Alias /python/ "/var/www/python/"
 
<Directory "/var/www/python">
    PythonPath "['/var/www/python']+sys.path"
    AddHandler mod_python .py
    PythonHandler mod_python.publisher
    Options None
    AllowOverride None
    Order allow,deny
    Allow from all
</Directory>
 
Alias /app/ "/var/www/python/app/"
                                                                                                                  <Directory "/var/www/python/app">
    PythonPath ['/var/www/python/app']+sys.path
    DirectoryIndex league.py
</Directory>
 
<Directory "/var/www/python/app/members">
    PythonPath
['/var/www/python/app','/var/www/python/app/members']+sys.path
    PythonOption ApplicationPath /app/members
    PythonAuthenHandler authenticate
    AuthType Basic
    AuthName "Administration"
    Require valid-user
</Directory>
======================================================

If my league.py file/module contains a function called index() and
another function called hello() then...

http://localhost/app/league.py successfully calls index()
http://localhost/app/ successfully calls index()
http://localhost/app/league.py/hello successfully calls hello()
http://localhost/app/hello causes a not found error on URL /app/hello

The last one contradicts what is described in section '6.1.2.1 -
Traversal' of the mod_python manual.

Is this a bug, or is the apache config wrong?

Note: This is also the case if the league.py file is renamed to
index.py.  However, if I do that then http://app/ causes a forbidden
error!!??


-- 
Terry
Registered Linux User # 311806
www.taumu.com


From stian at soiland.no  Thu May 20 09:06:12 2004
From: stian at soiland.no (Stian =?iso-8859-1?Q?S=F8iland?=)
Date: Thu May 20 02:06:16 2004
Subject: [mod_python] Re: questions about mod_python publisher
In-Reply-To: <40ABBC1D.1040406@joreybump.com>
References: <40AB67FC.6070009@sponsera.com> <40AB98FD.6050004@joreybump.com>
	<1084989362.8661.48.camel@bigmac.taumu.com>
	<40ABA65D.2030003@sponsera.com> <40ABBC1D.1040406@joreybump.com>
Message-ID: <20040520060612.GC10909@itea.ntnu.no>

On 2004-05-19 21:57:17, Jorey Bump wrote:

> I can access it on my Debian Woody production server (apache 1.3.26, 
> mod_python 2.7.8) like this :
> 
>  http://www.example.com/test/hello
> 
> But on my Red Hat 9 server (apache 2.0.40, and mod_python 3.0.1-4), I 
> need the extension:
> 
>   http://www.example.com/test.py/hello

The reason why Debian-apache accepts the lack of .py and Redhat don't,
is probably since the former will include an apache feature called
MultiViews.

Try in .htaccess or similar:

    Options +MultiViews

As in my debian default httpd.conf:

    <Directory "/www/default/htdocs/">
        Options Indexes Includes FollowSymLinks MultiViews ExecCGI
        ...
    </Directory>    

This makes apache look up in the directory to find sub-matching names.
FOr instance, http://www.somewhere.com/image5 would work if image5.jpg
were present - and the file extension of the actual file image5.jpg
would be used to select the right MIME-type.

Similar, if you have a mod_python script test.py - just test will work
fine - unless you have other files that starts with "test". This way,
you could hide your implementation details, and "test" could be
anything, .py, .html, .php, .cgi or a normal directory.

I'm not sure if this fixes issues with index.py though.

-- 
Stian S?iland               Work toward win-win situation. Win-lose
Trondheim, Norway           is where you win and the other lose.
http://www.soiland.no/      Lose-lose and lose-win are left as an
                            exercise to the reader.  [Limoncelli/Hogan]
                            Og dette er en ekstra linje 

From volodya at real.samuraj.org  Thu May 20 11:24:27 2004
From: volodya at real.samuraj.org (Volodya)
Date: Thu May 20 03:24:59 2004
Subject: [mod_python] questions about mod_python publisher
In-Reply-To: <1085008488.8661.121.camel@bigmac.taumu.com>
References: <40AB67FC.6070009@sponsera.com>
	<1084986743.8661.12.camel@bigmac.taumu.com>
	<20040519184026.GA31401@debian.mki-btc.com>
	<1085008488.8661.121.camel@bigmac.taumu.com>
Message-ID: <20040520072427.GA352@debian.mki-btc.com>

On Thu, May 20, 2004 at 12:14:49AM +0100, Terry MacDonald wrote:
> If my league.py file/module contains a function called index() and
> another function called hello() then...
> 
> http://localhost/app/league.py successfully calls index()
> http://localhost/app/ successfully calls index()
> http://localhost/app/league.py/hello successfully calls hello()
> http://localhost/app/hello causes a not found error on URL /app/hello
> 
> The last one contradicts what is described in section '6.1.2.1 -
> Traversal' of the mod_python manual.
> 
> Is this a bug, or is the apache config wrong?
> 
> Note: This is also the case if the league.py file is renamed to
> index.py.  However, if I do that then http://app/ causes a forbidden
> error!!??

What environment is it ? (Apache/mod_python version)

From volodya at real.samuraj.org  Thu May 20 11:51:00 2004
From: volodya at real.samuraj.org (Volodya)
Date: Thu May 20 03:51:31 2004
Subject: [mod_python] questions about mod_python publisher
In-Reply-To: <1084989362.8661.48.camel@bigmac.taumu.com>
References: <40AB67FC.6070009@sponsera.com> <40AB98FD.6050004@joreybump.com>
	<1084989362.8661.48.camel@bigmac.taumu.com>
Message-ID: <20040520075100.GB352@debian.mki-btc.com>

On Wed, May 19, 2004 at 06:56:02PM +0100, Terry MacDonald wrote:
> On Wed, 2004-05-19 at 18:27, Jorey Bump wrote:
> > I don't need to use the suffix. My httpd.conf looks like this (Debian 
> > Woody: apache 1.3.26, mod_python 2.7.8):
> > 
> > <Directory /var/www/documentroot>
> >    AddHandler python-program .py
> >    PythonHandler mod_python.publisher
> >    PythonDebug On
> > </Directory>
> > 
> > I can access function foobar in app.py like this:
> > 
> >   http://www.example.com/app/foobar
> 
> 
> Well something is different because with this config (i'm not an apache
> expert):
> 
> (Using Fedora Core 1, apache 2.0.48 and mod_python 3.1.3)
> 
> PythonDebug on
>  
> <Directory "/var/www/python">
>     PythonPath "['/var/www/python']+sys.path"
>     AddHandler mod_python .py
>     PythonHandler mod_python.publisher
>     Options None
>     AllowOverride None
>     Order allow,deny
>     Allow from all
> </Directory>
> 
> my foobar in app.py called as http://localhost/app/foobar gives a 'Not
> Found' error while http://localhost/app.py/foobar works fine.
> 
> This is an ongoing bugbear for me: dropping the .py.  Can anyone explain
> this odd behaviour, Grisha?
> 

Under Apache 2 , you MUST use "SetHandler mod_python". By this, you're
telling Apache to direct all requests (in this dir) to mod_python
module. And by specifying "PythonHandler mod_python.publisher" , your're
telling mod_python to use publisher handler.

So when you're accessing http://localhost/app/foobar , Apache directs
this request to mod_python. Mod_python uses publisher-handler logic to
process this request. This page explains traversal logic:

http://www.modpython.org/live/current/doc-html/hand-pub-alg-trav.html

Quote :
  If req.filename is empty, the module name defaults to "index".

So publisher-handler will try to import index.py module , and execute
its foobar() function.

In your case :
  You have no SetHandler directive , so Apache directs only *.py
  requests to mod_python module.

So:
  http://localhost/app.py/foobar  , passes to mod_python
  
  and
  
  http://localhost/app/foobar is served by Apache itself wich
  produces 404 error.



P.S. As far as i know, SetHandler/AddHandler behavior
is slightly different in Apache 1.3 and Apache 2.


Hope this helps.
From volodya at real.samuraj.org  Thu May 20 12:07:21 2004
From: volodya at real.samuraj.org (Volodya)
Date: Thu May 20 04:07:52 2004
Subject: [mod_python] questions about mod_python publisher
In-Reply-To: <40ABBC1D.1040406@joreybump.com>
References: <40AB67FC.6070009@sponsera.com> <40AB98FD.6050004@joreybump.com>
	<1084989362.8661.48.camel@bigmac.taumu.com>
	<40ABA65D.2030003@sponsera.com> <40ABBC1D.1040406@joreybump.com>
Message-ID: <20040520080721.GC352@debian.mki-btc.com>

On Wed, May 19, 2004 at 03:57:17PM -0400, Jorey Bump wrote:
> David Geller wrote:
> 
> >I have had the same experience as Terry.
> >
> >However, I just tried something and it worked!
> >
> > <Directory /www/docroot>
> >      PythonInterpreter myapp2
> >    PythonPath "blahblabh
> >    SetHandler python-program
> >    PythonHandler mod_python.publisher
> >    PythonDebug On
> >  </Directory>
> >
> >i.e., use "SetHander python-program" with no following argument ".py", 
> >followed by "PythonHandler with arg of mod_python.publisher"
> 
> Hmmm, then *every* file needs to be a python program. You can't mix 
> html, php and image files. You might as well just run python apps from 
> cgi-bin.
> 
> This is an interesting problem. With these directives in httpd.conf:
> 
> <Directory /var/www/documentroot>
>   AddHandler python-program .py
>   PythonHandler mod_python.publisher
>   PythonDebug On
> </Directory>
> 
> And assuming my app is test.py:
> 
> def hello(req):
>     x = "Hello, world!"
>     return x
> 
> I can access it on my Debian Woody production server (apache 1.3.26, 
> mod_python 2.7.8) like this :
> 
>  http://www.example.com/test/hello
> 
> But on my Red Hat 9 server (apache 2.0.40, and mod_python 3.0.1-4), I 
> need the extension:
> 
>   http://www.example.com/test.py/hello
> 
> If I change the AddHandler directive to:
> 
>   SetHandler python-program
> 
> I MUST access it without the extension, but all files in the directory 
> are treated as python programs. This seems less flexible to me. I can't 
> simply turn on mod_python for the entire site, as I do now. Is this the 
> result of a change in apache or mod_python?
> 

You can "turn off" mod_python for specific files or locations by using:

 SetHandler default

If you prefer httpd.conf use <Location> directive:
<Location /python/css >
SetHandler default
</Location>

or <Files> directive:

# text files
<Files *.txt>
SetHandler default
</Files>

# gfx files
<Files ~ "\.(gif|jpe?g|png)$">
SetHandler default
</Files>


Hope this helps.
From volodya at real.samuraj.org  Thu May 20 12:10:49 2004
From: volodya at real.samuraj.org (Volodya)
Date: Thu May 20 04:11:20 2004
Subject: [mod_python] questions about mod_python publisher
In-Reply-To: <40ABBC1D.1040406@joreybump.com>
References: <40AB67FC.6070009@sponsera.com> <40AB98FD.6050004@joreybump.com>
	<1084989362.8661.48.camel@bigmac.taumu.com>
	<40ABA65D.2030003@sponsera.com> <40ABBC1D.1040406@joreybump.com>
Message-ID: <20040520081049.GD352@debian.mki-btc.com>

On Wed, May 19, 2004 at 03:57:17PM -0400, Jorey Bump wrote:
> David Geller wrote:
> 
> >I have had the same experience as Terry.
> >
> >However, I just tried something and it worked!
> >
> > <Directory /www/docroot>
> >      PythonInterpreter myapp2
> >    PythonPath "blahblabh
> >    SetHandler python-program
> >    PythonHandler mod_python.publisher
> >    PythonDebug On
> >  </Directory>
> >
> >i.e., use "SetHander python-program" with no following argument ".py", 
> >followed by "PythonHandler with arg of mod_python.publisher"
> 
> Hmmm, then *every* file needs to be a python program. You can't mix 
> html, php and image files. You might as well just run python apps from 
> cgi-bin.
> 
> This is an interesting problem. With these directives in httpd.conf:
> 
> <Directory /var/www/documentroot>
>   AddHandler python-program .py
>   PythonHandler mod_python.publisher
>   PythonDebug On
> </Directory>
> 
> And assuming my app is test.py:
> 
> def hello(req):
>     x = "Hello, world!"
>     return x
> 
> I can access it on my Debian Woody production server (apache 1.3.26, 
> mod_python 2.7.8) like this :
> 
>  http://www.example.com/test/hello
> 
> But on my Red Hat 9 server (apache 2.0.40, and mod_python 3.0.1-4), I 
> need the extension:
> 
>   http://www.example.com/test.py/hello
> 
> If I change the AddHandler directive to:
> 
>   SetHandler python-program
> 
> I MUST access it without the extension, but all files in the directory 
> are treated as python programs. This seems less flexible to me. I can't 
> simply turn on mod_python for the entire site, as I do now. Is this the 
> result of a change in apache or mod_python?
> 

Use   "SetHandler default" to switch it off for certain file-types or
locations. (<Files>,<Location> directives)

From terry.macdonald at dsl.pipex.com  Thu May 20 12:54:20 2004
From: terry.macdonald at dsl.pipex.com (Terry MacDonald)
Date: Thu May 20 06:54:28 2004
Subject: [mod_python] questions about mod_python publisher
In-Reply-To: <20040520075100.GB352@debian.mki-btc.com>
References: <40AB67FC.6070009@sponsera.com> <40AB98FD.6050004@joreybump.com>
	<1084989362.8661.48.camel@bigmac.taumu.com>
	<20040520075100.GB352@debian.mki-btc.com>
Message-ID: <1085050460.5436.9.camel@bigmac.taumu.com>

On Thu, 2004-05-20 at 08:51, Volodya wrote:
> On Wed, May 19, 2004 at 06:56:02PM +0100, Terry MacDonald wrote:
> > On Wed, 2004-05-19 at 18:27, Jorey Bump wrote:
> > > I don't need to use the suffix. My httpd.conf looks like this (Debian 
> > > Woody: apache 1.3.26, mod_python 2.7.8):
> > > 
> > > <Directory /var/www/documentroot>
> > >    AddHandler python-program .py
> > >    PythonHandler mod_python.publisher
> > >    PythonDebug On
> > > </Directory>
> > > 
> > > I can access function foobar in app.py like this:
> > > 
> > >   http://www.example.com/app/foobar
> > 
> > 
> > Well something is different because with this config (i'm not an apache
> > expert):
> > 
> > (Using Fedora Core 1, apache 2.0.48 and mod_python 3.1.3)
> > 
> > PythonDebug on
> >  
> > <Directory "/var/www/python">
> >     PythonPath "['/var/www/python']+sys.path"
> >     AddHandler mod_python .py
> >     PythonHandler mod_python.publisher
> >     Options None
> >     AllowOverride None
> >     Order allow,deny
> >     Allow from all
> > </Directory>
> > 
> > my foobar in app.py called as http://localhost/app/foobar gives a 'Not
> > Found' error while http://localhost/app.py/foobar works fine.
> > 
> > This is an ongoing bugbear for me: dropping the .py.  Can anyone explain
> > this odd behaviour, Grisha?
> > 
> 
> Under Apache 2 , you MUST use "SetHandler mod_python". By this, you're
> telling Apache to direct all requests (in this dir) to mod_python
> module. And by specifying "PythonHandler mod_python.publisher" , your're
> telling mod_python to use publisher handler.
> 
> So when you're accessing http://localhost/app/foobar , Apache directs
> this request to mod_python. Mod_python uses publisher-handler logic to
> process this request. This page explains traversal logic:
> 
> http://www.modpython.org/live/current/doc-html/hand-pub-alg-trav.html
> 
> Quote :
>   If req.filename is empty, the module name defaults to "index".
> 
> So publisher-handler will try to import index.py module , and execute
> its foobar() function.
> 
> In your case :
>   You have no SetHandler directive , so Apache directs only *.py
>   requests to mod_python module.
> 
> So:
>   http://localhost/app.py/foobar  , passes to mod_python
>   
>   and
>   
>   http://localhost/app/foobar is served by Apache itself wich
>   produces 404 error.
> 
> 
> 
> P.S. As far as i know, SetHandler/AddHandler behavior
> is slightly different in Apache 1.3 and Apache 2.

If I do this in http.conf

PythonDebug on

<Location /test>
    SetHandler mod_python
    PythonHandler mod_python.publisher
</Location>

If in the test directory I have a file index.py containing a function
index() and I direct my browser to http://localhost/test  I get this:

Mod_python error: "PythonHandler mod_python.publisher"

Traceback (most recent call last):

  File "/usr/lib/python2.2/site-packages/mod_python/apache.py", line 299, in HandlerDispatch
    result = object(req)

  File "/usr/lib/python2.2/site-packages/mod_python/publisher.py", line 98, in handler
    path=[path])

  File "/usr/lib/python2.2/site-packages/mod_python/apache.py", line 454, in import_module
    f, p, d = imp.find_module(parts[i], path)

ImportError: No module named test

The publisher is treating the '/test' part of the URI as a module!

So what am I doing wrong?

-- 
Terry
Registered Linux User # 311806
www.taumu.com


From volodya at real.samuraj.org  Thu May 20 15:27:15 2004
From: volodya at real.samuraj.org (Volodya)
Date: Thu May 20 07:27:48 2004
Subject: [mod_python] questions about mod_python publisher
In-Reply-To: <1085050460.5436.9.camel@bigmac.taumu.com>
References: <40AB67FC.6070009@sponsera.com> <40AB98FD.6050004@joreybump.com>
	<1084989362.8661.48.camel@bigmac.taumu.com>
	<20040520075100.GB352@debian.mki-btc.com>
	<1085050460.5436.9.camel@bigmac.taumu.com>
Message-ID: <20040520112715.GA1496@debian.mki-btc.com>

On Thu, May 20, 2004 at 11:54:20AM +0100, Terry MacDonald wrote:
> If I do this in http.conf
> 
> PythonDebug on
> 
> <Location /test>
>     SetHandler mod_python
>     PythonHandler mod_python.publisher
> </Location>
> 
> If in the test directory I have a file index.py containing a function
> index() and I direct my browser to http://localhost/test  I get this:
> 
> Mod_python error: "PythonHandler mod_python.publisher"
> 
> Traceback (most recent call last):
> 
>   File "/usr/lib/python2.2/site-packages/mod_python/apache.py", line 299, in HandlerDispatch
>     result = object(req)
> 
>   File "/usr/lib/python2.2/site-packages/mod_python/publisher.py", line 98, in handler
>     path=[path])
> 
>   File "/usr/lib/python2.2/site-packages/mod_python/apache.py", line 454, in import_module
>     f, p, d = imp.find_module(parts[i], path)
> 
> ImportError: No module named test
> 
> The publisher is treating the '/test' part of the URI as a module!
> 
> So what am I doing wrong?

I've tried the same, and everything works fine.

Portion of my httpd.conf (Apache 2.0.48):

<VirtualHost 192.168.0.201:80>
     ServerName lan.MYDOMAIN.TLD
     ServerAdmin postmaster@MYDOMAIN.TLD
     DocumentRoot /home/volodya/lan/data
     ScriptAlias /cgi-bin/ /home/volodya/lan/cgi-bin/
     <Directory /home/volodya/lan/data/>
             AllowOverride All
             Order allow,deny
             Allow from all
     </Directory>
     <Directory /home/volodya/lan/cgi-bin/>
             AllowOverride All
             Options ExecCGI
             Order allow,deny
             Allow from all
     </Directory>
     # -------------------------------------------------
     <Location /test>
                 SetHandler mod_python
                 PythonHandler mod_python.publisher
     </Location>
     # -------------------------------------------------
     ErrorLog  /home/volodya/lan/log/error-lan.log
     CustomLog /home/volodya/lan/log/access-lan.log common
 </VirtualHost>


index.py , placed into /home/volodya/lan/data/test directory:

# ------------------------------
def index(req):
    return "hello"

def func(req, name="world"):
    return "Hello, %s !" % name
# ------------------------------


http://lan.MYDOMAIN.TLD/test/
  Output: hello

http://lan.MYDOMAIN.TLD/test/func?name=Volodya
  output: Hello, Volodya !


Env: Apache 2.0.48 (prefork mpm), mod_python 3.1.3, Python 2.3.3, FreeBSD 4.9

From terry.macdonald at dsl.pipex.com  Thu May 20 13:56:55 2004
From: terry.macdonald at dsl.pipex.com (Terry MacDonald)
Date: Thu May 20 07:57:08 2004
Subject: [mod_python] questions about mod_python publisher
In-Reply-To: <20040520112715.GA1496@debian.mki-btc.com>
References: <40AB67FC.6070009@sponsera.com> <40AB98FD.6050004@joreybump.com>
	<1084989362.8661.48.camel@bigmac.taumu.com>
	<20040520075100.GB352@debian.mki-btc.com>
	<1085050460.5436.9.camel@bigmac.taumu.com>
	<20040520112715.GA1496@debian.mki-btc.com>
Message-ID: <1085054215.5436.17.camel@bigmac.taumu.com>

On Thu, 2004-05-20 at 12:27, Volodya wrote:
> On Thu, May 20, 2004 at 11:54:20AM +0100, Terry MacDonald wrote:
> > If I do this in http.conf
> > 
> > PythonDebug on
> > 
> > <Location /test>
> >     SetHandler mod_python
> >     PythonHandler mod_python.publisher
> > </Location>
> > 
> > If in the test directory I have a file index.py containing a function
> > index() and I direct my browser to http://localhost/test  I get this:
> > 
> > Mod_python error: "PythonHandler mod_python.publisher"
> > 
> > Traceback (most recent call last):
> > 
> >   File "/usr/lib/python2.2/site-packages/mod_python/apache.py", line 299, in HandlerDispatch
> >     result = object(req)
> > 
> >   File "/usr/lib/python2.2/site-packages/mod_python/publisher.py", line 98, in handler
> >     path=[path])
> > 
> >   File "/usr/lib/python2.2/site-packages/mod_python/apache.py", line 454, in import_module
> >     f, p, d = imp.find_module(parts[i], path)
> > 
> > ImportError: No module named test
> > 
> > The publisher is treating the '/test' part of the URI as a module!
> > 
> > So what am I doing wrong?
> 
> I've tried the same, and everything works fine.
> 
> Portion of my httpd.conf (Apache 2.0.48):
> 
> <VirtualHost 192.168.0.201:80>
>      ServerName lan.MYDOMAIN.TLD
>      ServerAdmin postmaster@MYDOMAIN.TLD
>      DocumentRoot /home/volodya/lan/data
>      ScriptAlias /cgi-bin/ /home/volodya/lan/cgi-bin/
>      <Directory /home/volodya/lan/data/>
>              AllowOverride All
>              Order allow,deny
>              Allow from all
>      </Directory>
>      <Directory /home/volodya/lan/cgi-bin/>
>              AllowOverride All
>              Options ExecCGI
>              Order allow,deny
>              Allow from all
>      </Directory>
>      # -------------------------------------------------
>      <Location /test>
>                  SetHandler mod_python
>                  PythonHandler mod_python.publisher
>      </Location>
>      # -------------------------------------------------
>      ErrorLog  /home/volodya/lan/log/error-lan.log
>      CustomLog /home/volodya/lan/log/access-lan.log common
>  </VirtualHost>
> 
> 
> index.py , placed into /home/volodya/lan/data/test directory:
> 
> # ------------------------------
> def index(req):
>     return "hello"
> 
> def func(req, name="world"):
>     return "Hello, %s !" % name
> # ------------------------------
> 
> 
> http://lan.MYDOMAIN.TLD/test/
>   Output: hello
> 
> http://lan.MYDOMAIN.TLD/test/func?name=Volodya
>   output: Hello, Volodya !
> 
> 
> Env: Apache 2.0.48 (prefork mpm), mod_python 3.1.3, Python 2.3.3, FreeBSD 4.9
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python

If I use Directory instead of Location it works except my images and css
files are not loaded, those files are in subdirectories of /test
(/test/images and /test/css)

Other info:

My Document root is /var/ww/html however my application resides in
/var/www/python/test; is this significant?

FC1, apache 2.0.48, mod_python 3.1.3

-- 
Terry
Registered Linux User # 311806
www.taumu.com


From volodya at real.samuraj.org  Thu May 20 16:39:13 2004
From: volodya at real.samuraj.org (Volodya)
Date: Thu May 20 08:39:45 2004
Subject: [mod_python] questions about mod_python publisher
In-Reply-To: <1085054215.5436.17.camel@bigmac.taumu.com>
References: <40AB67FC.6070009@sponsera.com> <40AB98FD.6050004@joreybump.com>
	<1084989362.8661.48.camel@bigmac.taumu.com>
	<20040520075100.GB352@debian.mki-btc.com>
	<1085050460.5436.9.camel@bigmac.taumu.com>
	<20040520112715.GA1496@debian.mki-btc.com>
	<1085054215.5436.17.camel@bigmac.taumu.com>
Message-ID: <20040520123913.GA1804@debian.mki-btc.com>

On Thu, May 20, 2004 at 12:56:55PM +0100, Terry MacDonald wrote:

[skipped] 

> If I use Directory instead of Location it works except my images and css
> files are not loaded, those files are in subdirectories of /test
> (/test/images and /test/css)

Add following lines into httpd.conf:
    <Location /test/css>
       SetHandler default
    </Location>
    <Location /test/images>
       SetHandler default
    </Location>

That is why i prefer to use .htaccess tuning. Atleast during developing
stage. No need to touch Apache's global config.

From list at joreybump.com  Thu May 20 10:05:16 2004
From: list at joreybump.com (Jorey Bump)
Date: Thu May 20 09:05:25 2004
Subject: [mod_python] Re: questions about mod_python publisher
In-Reply-To: <20040520060612.GC10909@itea.ntnu.no>
References: <40AB67FC.6070009@sponsera.com>
	<40AB98FD.6050004@joreybump.com>	<1084989362.8661.48.camel@bigmac.taumu.com>	<40ABA65D.2030003@sponsera.com>
	<40ABBC1D.1040406@joreybump.com>
	<20040520060612.GC10909@itea.ntnu.no>
Message-ID: <40ACAD0C.1050509@joreybump.com>

Stian S?iland wrote:
> On 2004-05-19 21:57:17, Jorey Bump wrote:
> 
> 
>>I can access it on my Debian Woody production server (apache 1.3.26, 
>>mod_python 2.7.8) like this :
>>
>> http://www.example.com/test/hello
>>
>>But on my Red Hat 9 server (apache 2.0.40, and mod_python 3.0.1-4), I 
>>need the extension:
>>
>>  http://www.example.com/test.py/hello
> 
> 
> The reason why Debian-apache accepts the lack of .py and Redhat don't,
> is probably since the former will include an apache feature called
> MultiViews.

I'm glad I included my system details -- you're absolutely right. In 
fact, my error log was filled with MultiView-related complaints when I 
switched to Debian because of the way I normally set up directory 
permissions. I changed the permissions, but now I wish I had 
investigated further.

> Try in .htaccess or similar:
> 
>     Options +MultiViews
> 
> As in my debian default httpd.conf:
> 
>     <Directory "/www/default/htdocs/">
>         Options Indexes Includes FollowSymLinks MultiViews ExecCGI
>         ...
>     </Directory>    
> 
> This makes apache look up in the directory to find sub-matching names.
> FOr instance, http://www.somewhere.com/image5 would work if image5.jpg
> were present - and the file extension of the actual file image5.jpg
> would be used to select the right MIME-type.

I've done this on the Red Hat 9 server, and it will work with images, 
HTML and text files.

> Similar, if you have a mod_python script test.py - just test will work
> fine - unless you have other files that starts with "test". This way,
> you could hide your implementation details, and "test" could be
> anything, .py, .html, .php, .cgi or a normal directory.

Yet this still doesn't work on the RH 9 box. It doesn't work for foo.py 
or phpinfo.php. I've searched for differences between the RH and Debian 
conf files, but they barely resemble each other, and nothing stands out. 
I've checked for MIME information in httpd.conf and related magic files, 
but neither contain reference to .py files. Any ideas? I feel like I'm 
one step away from discovering platform-independent implementation details.

From r.barrett at ftel.co.uk  Thu May 20 18:35:49 2004
From: r.barrett at ftel.co.uk (Richard Barrett)
Date: Thu May 20 12:36:51 2004
Subject: [mod_python] Why are some Apache request record fields read only
	under mod_python
Message-ID: <C0864A0E-AA7B-11D8-9B1A-000A957C9A50@ftel.co.uk>

I am trying to re-implement, using mod_python 3.1.3, an Apache 2 
translation handler, originally implemented (by me) using mod_perl. Do 
not ask why unless you want to be bored. And anyway I prefer the Python 
language to Perl.

I appear to be finding members (fields) of the request record which 
have been selected to be read only by the mod_python and thus I cannot 
setup the request record to get the proxy access I need done by 
mod_proxy. For the case in point, with mod_python 3.1.3, the proxyreq 
and handler cannot be set.

What criteria were used in choosing which Apache data structure fields 
were to be read only and why the discrepancy between mod_python and 
mod_perl, both of which are Apache Foundation supported projects, 
presumably with similar objective. And please, do not say the reason is 
to protect developers from their own mistakes.

From sorr at rightnow.com  Thu May 20 12:44:12 2004
From: sorr at rightnow.com (Orr, Steve)
Date: Thu May 20 13:44:19 2004
Subject: [mod_python] Intermixing legacy CGI with mod_python
Message-ID: <D30BE1A2F9109A43BA989E2F51684056062CA325@pobox.corp.rightnow.com>

I've got a large CGI web app with lots of HTML mixed in. The manual says
the CGI handler is provided for migrating away from legacy CGI but it
also discourages use of the CGI handler such that I'm fearful of
considering it as a transitional approach. Does anybody have testimonial
experience they can share in this area?

TIA

From Edward.Diener at loyaltyworks.com  Thu May 20 15:05:40 2004
From: Edward.Diener at loyaltyworks.com (Diener, Edward)
Date: Thu May 20 14:05:35 2004
Subject: [mod_python] Problem doing PSP redirect
Message-ID: <68A7AFEEA80F96479E120166638331AF7EC648@exchange2.loyaltyworks.com>

In the code of my PSP page a do a psp.redirect(somestringvalue) and I
receive this trace:
 
Mod_python error: "PythonHandler mod_python.psp"

Traceback (most recent call last):

  File "C:\Utilities\Python23\Lib\site-packages\mod_python\apache.py",
line 299, in HandlerDispatch
    result = object(req)

  File "C:\Utilities\Python23\Lib\site-packages\mod_python\psp.py", line
297, in handler
    p.run()

  File "C:\Utilities\Python23\Lib\site-packages\mod_python\psp.py", line
208, in run
    exec code in global_scope

  File "C:/Program Files/Apache
Group/Apache2/htdocs/RegistrationTwo/RegistrationPageUpdate.psp", line
21, in ?
    psp.redirect(req.url)

  File "C:\Utilities\Python23\Lib\site-packages\mod_python\psp.py", line
84, in redirect
    util.redirect(self.req, location, permanent)

  File "C:\Utilities\Python23\Lib\site-packages\mod_python\util.py",
line 371, in redirect
    req.err_headers_out["Location"] = location

TypeError: table values must be strings
 
The value which I am passing as the redirect URL (req.url) is a string.
I even print it to a log and it is a totally valid URL address. Why am I
getting this error ?
 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://modpython.org/pipermail/mod_python/attachments/20040520/af969250/attachment.html
From Edward.Diener at loyaltyworks.com  Thu May 20 15:42:27 2004
From: Edward.Diener at loyaltyworks.com (Diener, Edward)
Date: Thu May 20 14:42:19 2004
Subject: [mod_python] Problem doing PSP redirect
Message-ID: <68A7AFEEA80F96479E120166638331AF7EC649@exchange2.loyaltyworks.com>

You are correct. It is actually a form value, which is a StringField. I
really fell asleep on this one.


-----Original Message-----
From: Volodya [mailto:volodya@real.samuraj.org] 
Sent: Thursday, May 20, 2004 2:37 PM
To: Diener, Edward
Subject: Re: [mod_python] Problem doing PSP redirect


On Thu, May 20, 2004 at 02:05:40PM -0400, Diener, Edward wrote:
> In the code of my PSP page a do a psp.redirect(somestringvalue) and I 
> receive this trace:
>  
> Mod_python error: "PythonHandler mod_python.psp"
> 
> Traceback (most recent call last):
> 
>   File "C:\Utilities\Python23\Lib\site-packages\mod_python\apache.py",
> line 299, in HandlerDispatch
>     result = object(req)
> 
>   File "C:\Utilities\Python23\Lib\site-packages\mod_python\psp.py", 
> line 297, in handler
>     p.run()
> 
>   File "C:\Utilities\Python23\Lib\site-packages\mod_python\psp.py", 
> line 208, in run
>     exec code in global_scope
> 
>   File "C:/Program Files/Apache 
> Group/Apache2/htdocs/RegistrationTwo/RegistrationPageUpdate.psp", line

> 21, in ?
>     psp.redirect(req.url)
> 
>   File "C:\Utilities\Python23\Lib\site-packages\mod_python\psp.py", 
> line 84, in redirect
>     util.redirect(self.req, location, permanent)
> 
>   File "C:\Utilities\Python23\Lib\site-packages\mod_python\util.py",
> line 371, in redirect
>     req.err_headers_out["Location"] = location
> 
> TypeError: table values must be strings
>  
> The value which I am passing as the redirect URL (req.url) is a 
> string. I even print it to a log and it is a totally valid URL 
> address. Why am I getting this error ?

Double check that this string is string in fact. Best way is to print
its type:

req.write("Type is: %s" % type(somestring))


From Edward.Diener at loyaltyworks.com  Thu May 20 16:30:07 2004
From: Edward.Diener at loyaltyworks.com (Diener, Edward)
Date: Thu May 20 15:29:47 2004
Subject: [mod_python] PSP FieldStorage
Message-ID: <68A7AFEEA80F96479E120166638331AF81E1F5@exchange2.loyaltyworks.com>

In my PSP code I reference the global form object, which is created as a
FieldStorage object I believe with keep_blank_values set to False. In my
form I need to access the names of my check boxes in a generic way
whether or not they are checked. With keep_blank_values set to False,
when a check box is not checked, the name of the check box never shows
up in the form object. How do I reference a form object in my PSP code
so that it is created with keep_blank_values set to True ?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://modpython.org/pipermail/mod_python/attachments/20040520/58001ed2/attachment.html
From richard.whitehurst at reputations.co.uk  Fri May 21 12:06:26 2004
From: richard.whitehurst at reputations.co.uk (Richard Whitehurst)
Date: Fri May 21 06:04:30 2004
Subject: [mod_python] Directory indexing problem
Message-ID: <001101c43f1b$50fbe990$0a01a8c0@nsoptimup4>

I now see that It's that old chestnut SetHandler/AddHandler/apache.DECLINED:

No use returning apache.DECLINED from a 'set' handler as there no other handler
to do the work and will give 404 in some/all(?) circumstances.

So use AddHandler instead.

Richard
 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://modpython.org/pipermail/mod_python/attachments/20040521/47d4a6a7/attachment.html
From Edward.Diener at loyaltyworks.com  Fri May 21 11:46:22 2004
From: Edward.Diener at loyaltyworks.com (Diener, Edward)
Date: Fri May 21 10:46:07 2004
Subject: [mod_python] Accessing all form fields, empty strings or not
Message-ID: <68A7AFEEA80F96479E120166638331AF7EC64B@exchange2.loyaltyworks.com>

I need to access all form fields in my mod_python PSP code, whether they
are empty strings or not. The 'form' global variable is created so that
fields which have empty strings do not appear in the 'form'. Surely
there must be some way in mod_python PSP code that I can access form
field names and values even if the value is an empty string. What is it
?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://modpython.org/pipermail/mod_python/attachments/20040521/dffa9543/attachment.html
From fheredero at topmusic.ch  Fri May 21 18:16:16 2004
From: fheredero at topmusic.ch (=?Windows-1252?Q?Fran=E7ois_Heredero_-_Top_Music_SA?=)
Date: Fri May 21 11:16:55 2004
Subject: [mod_python] Accessing all form fields, empty strings or not
Message-ID: <NHBBJIKGILMEKGJNGPPBOEIBEAAA.fheredero@topmusic.ch>



-----Message d'origine-----
De : Fran?ois Heredero - Top Music SA [mailto:fheredero@topmusic.ch]
Envoy? : vendredi, 21. mai 2004 17:13
? : Diener, Edward
Objet : RE: [mod_python] Accessing all form fields, empty strings or not


>i need to access all form fields in my mod_python PSP code,
>whether they are empty strings or not.
I think (but perhaps I'm wrong) empty strings are not supplied by http
protocol...

With the CGI module, I use :

form = cgi.FieldStorage()
mytext = float(form.getfirst("text", ""))

Fran?ois

From Edward.Diener at loyaltyworks.com  Fri May 21 12:27:47 2004
From: Edward.Diener at loyaltyworks.com (Diener, Edward)
Date: Fri May 21 11:27:25 2004
Subject: [mod_python] Accessing all form fields, empty strings or not
Message-ID: <68A7AFEEA80F96479E120166638331AF7EC64C@exchange2.loyaltyworks.com>

> -----Original Message-----
> From: Fran?ois Heredero - Top Music SA [mailto:fheredero@topmusic.ch] 
> Sent: Friday, May 21, 2004 11:16 AM
> To: Diener, Edward
> Cc: mod_python@modpython.org
> Subject: RE: [mod_python] Accessing all form fields, empty 
> strings or not
> 
> 
> 
> 
> -----Message d'origine-----
> De : Fran?ois Heredero - Top Music SA 
> [mailto:fheredero@topmusic.ch] Envoy? : > vendredi, 21. mai 
> 2004 17:13 ? : Diener, Edward Objet : RE: [mod_python] 
> Accessing all form fields, empty strings or not
> 
> 
> >i need to access all form fields in my mod_python PSP code, whether 
> >they are empty strings or not.
> I think (but perhaps I'm wrong) empty strings are not 
> supplied by http protocol...
> 
> With the CGI module, I use :
> 
> form = cgi.FieldStorage()
> mytext = float(form.getfirst("text", ""))

Does this tell me whether or not "text" is a form field or not if the return is an empty string ? Three cases:

1) The field "text" is a form field and the value is not empty. I assume theis returns the value.

2) The field "text" is a form field and the value is empty. I assume this returns the default. Does it ?

3) The field "text" is not a form field. What is returned or is an exception thrown ?

I need to distinguish between cases 2) and 3)


From fheredero at topmusic.ch  Fri May 21 18:28:13 2004
From: fheredero at topmusic.ch (=?Windows-1252?Q?Fran=E7ois_Heredero_-_Top_Music_SA?=)
Date: Fri May 21 11:28:42 2004
Subject: [mod_python] Accessing all form fields, empty strings or not
In-Reply-To: <NHBBJIKGILMEKGJNGPPBOEIBEAAA.fheredero@topmusic.ch>
Message-ID: <NHBBJIKGILMEKGJNGPPBIEICEAAA.fheredero@topmusic.ch>

> With the CGI module, I use :
>
> form = cgi.FieldStorage()
> mytext = float(form.getfirst("text", ""))

oopps sorry :

mytext = form.getfirst("text", "")

Fran?ois

From grisha at modpython.org  Fri May 21 12:36:26 2004
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri May 21 11:36:40 2004
Subject: [mod_python] Accessing all form fields, empty strings or not
In-Reply-To: <68A7AFEEA80F96479E120166638331AF7EC64B@exchange2.loyaltyworks.com>
References: <68A7AFEEA80F96479E120166638331AF7EC64B@exchange2.loyaltyworks.com>
Message-ID: <20040521113335.N91814@onyx.ispol.com>



On Fri, 21 May 2004, Diener, Edward wrote:

> I need to access all form fields in my mod_python PSP code, whether they
> are empty strings or not. The 'form' global variable is created so that
> fields which have empty strings do not appear in the 'form'.

Are you sure that this is the case?

Looking at psp.py:

        # does this code use form?
        form = None
        if "form" in code.co_names:
            form = util.FieldStorage(req, keep_blank_values=1)


"keep_blank_values" is set to 1.

Grisha
From Edward.Diener at loyaltyworks.com  Fri May 21 14:17:24 2004
From: Edward.Diener at loyaltyworks.com (Diener, Edward)
Date: Fri May 21 13:17:19 2004
Subject: [mod_python] Accessing all form fields, empty strings or not
Message-ID: <68A7AFEEA80F96479E120166638331AF81E1F6@exchange2.loyaltyworks.com>



> -----Original Message-----
> From: Gregory (Grisha) Trubetskoy [mailto:grisha@modpython.org] 
> Sent: Friday, May 21, 2004 11:36 AM
> To: Diener, Edward
> Cc: mod_python@modpython.org
> Subject: Re: [mod_python] Accessing all form fields, empty 
> strings or not
> 
> 
> 
> 
> On Fri, 21 May 2004, Diener, Edward wrote:
> 
> > I need to access all form fields in my mod_python PSP code, whether 
> > they are empty strings or not. The 'form' global variable 
> is created 
> > so that fields which have empty strings do not appear in the 'form'.
> 
> Are you sure that this is the case?
> 
> Looking at psp.py:
> 
>         # does this code use form?
>         form = None
>         if "form" in code.co_names:
>             form = util.FieldStorage(req, keep_blank_values=1)
> 
> 
> "keep_blank_values" is set to 1.

That is very strange because when I check the keys for my form (
form.keys() ), the checkbox field only exists in the list of keys when
the checkbox is checked but doesn't exist otherwise. But I do see the
code mentioned above in psp.py. Is there any other way to find out if a
field exists in a form irregardless whether its value is blank or not ?

From michael at dynamine.net  Fri May 21 11:30:52 2004
From: michael at dynamine.net (Michael S. Fischer)
Date: Fri May 21 13:31:05 2004
Subject: [mod_python] Accessing all form fields, empty strings or not
In-Reply-To: <68A7AFEEA80F96479E120166638331AF81E1F6@exchange2.loyaltyworks.com>
Message-ID: <20040521173056.5B97C3118BE@attrition.dynamine.net>

Edward Diener writes:

> That is very strange because when I check the keys for my form (
> form.keys() ), the checkbox field only exists in the list of 
> keys when the checkbox is checked but doesn't exist 
> otherwise. But I do see the code mentioned above in psp.py. 
> Is there any other way to find out if a field exists in a 
> form irregardless whether its value is blank or not ?

You didn't mention that it was a checkbox field before.

Checkbox fields are a special case; many browsers do not include unchecked
checkbox fields when submitting a form to the server (MSIE 6 included).
Therefore, it should not be unsurprising that such empty fields are not in
the list of form keys.

There's nothing you can do about this other than to recognize the situation
and code around it.

Cheers,

--Michael

From Edward.Diener at loyaltyworks.com  Fri May 21 14:34:57 2004
From: Edward.Diener at loyaltyworks.com (Diener, Edward)
Date: Fri May 21 13:34:36 2004
Subject: [mod_python] Accessing all form fields, empty strings or not
Message-ID: <68A7AFEEA80F96479E120166638331AF7EC64E@exchange2.loyaltyworks.com>

> -----Original Message-----
> From: Michael S. Fischer [mailto:michael@dynamine.net] 
> Sent: Friday, May 21, 2004 1:31 PM
> To: Diener, Edward
> Cc: mod_python@modpython.org
> Subject: RE: [mod_python] Accessing all form fields, empty 
> strings or not
> 
> 
> Edward Diener writes:
> 
> > That is very strange because when I check the keys for my form (
> > form.keys() ), the checkbox field only exists in the list of
> > keys when the checkbox is checked but doesn't exist 
> > otherwise. But I do see the code mentioned above in psp.py. 
> > Is there any other way to find out if a field exists in a 
> > form irregardless whether its value is blank or not ?
> 
> You didn't mention that it was a checkbox field before.
> 
> Checkbox fields are a special case; many browsers do not 
> include unchecked checkbox fields when submitting a form to 
> the server (MSIE 6 included). Therefore, it should not be 
> unsurprising that such empty fields are not in the list of form keys.
> 
> There's nothing you can do about this other than to recognize 
> the situation and code around it.

OK, now I understand. I will have to add appropriate hidden fields with
values to deal with the problem. Thanks !

From gustavo.cordova at q-voz.com  Fri May 21 13:36:43 2004
From: gustavo.cordova at q-voz.com (=?iso-8859-1?Q?Gustavo_C=F3rdova_Avila?=)
Date: Fri May 21 13:37:58 2004
Subject: [mod_python] Accessing all form fields, empty strings or not
In-Reply-To: <68A7AFEEA80F96479E120166638331AF81E1F6@exchange2.loyaltyworks.com>
Message-ID: <!~!UENERkVCMDkAAQACAAAAAAAAAAAAAAAAABgAAAAAAAAAo5mHXnRFkU2A7MLhj8g/IMKAAAAQAAAAcuwh+YUUWU2pDuqpxZ2TswEAAAAA@q-voz.com>

> From: Diener, Edward
> 
> [...snip...]
> 
> That is very strange because when I check the keys for my form (
> form.keys() ), the checkbox field only exists in the list of 
> keys when the checkbox is checked but doesn't exist 
> otherwise.
>

This is the normal behaviour; checkbox items don't "exist" in
the returned form data unless it's checked.

-gustavo


From nick at dd.revealed.net  Fri May 21 13:53:57 2004
From: nick at dd.revealed.net (Nick)
Date: Fri May 21 13:54:05 2004
Subject: [mod_python] mod_python 3.1.3: PythonHandlerModule
Message-ID: <40AE4235.2030108@dd.revealed.net>

Hi all,

Specifying PythonHandlerModule in the apache config causes mod_python to
attempt to execute the connectionhandler, regardless of its existence.  This
is very undesirable, since I don't want to ever have a connection handler
but have multiple handlers in my module.

Is this the intended behavior?  Listing the 4 handler directives I'll need
individually is more error prone than having only 1 for my users.

Thanks,
Nick


From grisha at modpython.org  Fri May 21 16:04:52 2004
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Fri May 21 15:04:59 2004
Subject: [mod_python] mod_python 3.1.3: PythonHandlerModule
In-Reply-To: <40AE4235.2030108@dd.revealed.net>
References: <40AE4235.2030108@dd.revealed.net>
Message-ID: <20040521150224.A96030@onyx.ispol.com>


I think this is a bug.

In apache.py, around line 96:

            # find the object
            object = resolve_object(module, object_str,
                                    arg=conn, silent=0)

make that
            # find the object
            object = resolve_object(module, object_str,
                                    arg=conn, silent=conn.hlist.silent)

and let me know if it fixes it, then we'll add it into the CVS for next
version.

Thanks,

Grisha


On Fri, 21 May 2004, Nick wrote:

> Hi all,
>
> Specifying PythonHandlerModule in the apache config causes mod_python to
> attempt to execute the connectionhandler, regardless of its existence.  This
> is very undesirable, since I don't want to ever have a connection handler
> but have multiple handlers in my module.
>
> Is this the intended behavior?  Listing the 4 handler directives I'll need
> individually is more error prone than having only 1 for my users.
>
> Thanks,
> Nick
>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From nick at dd.revealed.net  Fri May 21 15:42:30 2004
From: nick at dd.revealed.net (Nick)
Date: Fri May 21 15:42:43 2004
Subject: [mod_python] mod_python 3.1.3: PythonHandlerModule
In-Reply-To: <20040521150224.A96030@onyx.ispol.com>
References: <40AE4235.2030108@dd.revealed.net>
	<20040521150224.A96030@onyx.ispol.com>
Message-ID: <40AE5BA6.5020503@dd.revealed.net>

Thanks for a quick reply, but it didn't solve the problem. 
conn.hlist.silent is 0 at the call.

Nick

Gregory (Grisha) Trubetskoy wrote:

> I think this is a bug.
> 
> In apache.py, around line 96:
> 
>             # find the object
>             object = resolve_object(module, object_str,
>                                     arg=conn, silent=0)
> 
> make that
>             # find the object
>             object = resolve_object(module, object_str,
>                                     arg=conn, silent=conn.hlist.silent)
> 
> and let me know if it fixes it, then we'll add it into the CVS for next
> version.

From bje at apnic.net  Mon May 24 09:48:05 2004
From: bje at apnic.net (Byron Ellacott)
Date: Sun May 23 18:48:19 2004
Subject: [mod_python] Directory indexing problem
In-Reply-To: <001101c43f1b$50fbe990$0a01a8c0@nsoptimup4>
References: <001101c43f1b$50fbe990$0a01a8c0@nsoptimup4>
Message-ID: <1085352485.20705.8.camel@ping.apnic.net>

On Fri, 2004-05-21 at 20:06, Richard Whitehurst wrote:
> I now see that It's that old chestnut
> SetHandler/AddHandler/apache.DECLINED:
> No use returning apache.DECLINED from a 'set' handler as there no
> other handler
> to do the work and will give 404 in some/all(?) circumstances.

.htaccess:
SetHandler mod_python
PythonHandler index

index.py:
from mod_python import apache

def handler(req):
    return apache.DECLINED

level25.png:
image/png data

$ wget -S http://localhost:8080/test/level25.png
 1 HTTP/1.1 200 OK
 3 Server: Apache/2.0.47 (Debian GNU/Linux) mod_python/3.1.3
Python/2.3.3
10 Content-Type: image/png
08:43:19 (153.38 MB/s) - `level25.png.1' saved [26537/26537]

(trimmed wget output)

The only difference between SetHandler and AddHandler is that AddHandler
requires one or more extension arguments to map the handler to, while
SetHandle applies to all matching files (where 'matching' means 'files
that fall under the domain of the containing <Directory> or <Location>
section.'

(Noting that a .htaccess behaves mostly as a <Directory>.)

-- 
bje

From b.niemann at betternet.de  Wed May 19 18:02:02 2004
From: b.niemann at betternet.de (Benjamin Niemann)
Date: Mon May 24 03:40:16 2004
Subject: [mod_python] Re: Controlling authentication at run-time
In-Reply-To: <68A7AFEEA80F96479E120166638331AF81E1F1@exchange2.loyaltyworks.com>
References: <68A7AFEEA80F96479E120166638331AF81E1F1@exchange2.loyaltyworks.com>
Message-ID: <c8fss3$p6j$1@sea.gmane.org>

Diener, Edward wrote:
> If Apache authentication is setup for files in a document directory 
> through directives in an .htaccess file, once the user has entered their 
> user name and password and is allowed access to the file, they are no 
> longer prompted each subsequent time as long as their session is active. 
> Is there a way to control this at run-time so that the user will be 
> prompted for their user name and password in subsequent access to the 
> file, using mod_python ?
As others have already mentioned, it's the browser that remembers the 
login data - until the browser is closed. There is *NO* way to tell the 
browser to forget this (except for serving a page that triggers a 
browser crash ;)
Something I could think of is: if you want to reauthenticate the user, 
supply a different authentication realm (AuthName in apache.conf). E.g. 
add a random number... But then you have to handle HTTP authentication 
yourself, you can't use .htaccess files, as these are static.
I *think* this should trigger reauthentication, but I never tried it before.

From jafo at tummy.com  Mon May 24 06:25:06 2004
From: jafo at tummy.com (Sean Reifschneider)
Date: Mon May 24 07:25:14 2004
Subject: [mod_python] Module getting imported twice?
Message-ID: <20040524112506.GB4469@tummy.com>

I'm having a kind of weird problem and I don't fully understand why it's
happening.  Basically, it seems that sometimes a module I'm importing
(from site-packages), is losing it's mind.  It's like half way through a
function it's running in entirely a different name-space.  Yes, this can
happen while making two calls into a module on successive lines of a
function.

What I traced it down to is that different calls are showing the
following values for the module:

   <module 'jotweb.jotwebutils' from
      '/usr/lib/python2.2/site-packages/jotweb/jotwebutils.py'>
   <module
      '/var/www/jotweb/www.tummy.jotweb.jotwebutils' from
      '/usr/lib/python2.2/site-packages/jotweb/jotwebutils.py'>

I really don't understand the latter.  My HTML and site-related python
files are in "/var/www/jotweb/www.tummy.com/html".

If, in jotwebutils.py, I dump the stack when the module is imported, I
see that the first time it's imported with the following:

   File "/var/tmp/mod_python-3.0.4-root/usr/lib/python2.2/site-packages/mod_python/apache.py",
      line 274, in HandlerDispatch 
   File "/var/tmp/mod_python-3.0.4-root/usr/lib/python2.2/site-packages/mod_python/apache.py",
      line 440, in import_module 
   File "lib/jotweb/__init__.py", line 32, in ? 

and the second time it's imported with:

   File "/var/tmp/mod_python-3.0.4-root/usr/lib/python2.2/site-packages/mod_python/apache.py",
      line 274, in HandlerDispatch 
   File "/usr/lib/python2.2/site-packages/jotweb/jotweb_mod_python.py",
      line 45, in handler     def handler(req): 
   [... Deep into the bowels of my handler code ...]
   File "/var/www/jotweb/www.tummy.com/html/navigation.py",
      line 3, in ?     import time, string, re, dircache, math 
   File "lib/jotweb/__init__.py", line 32, in ?

Now, it should be noted that I'm using the "imp" module to load modules
dynamically when they are referenced from my HTML templates.  But the
code in question that is triggering this is:

   from jotweb import jotwebutils
   import jotweb

   navbar = jotwebutils.getGlobal('navbar')
   urlBase = jotweb.config.getconfig().get('tummyurlbase', 'unknown')

jotwebutils.getGlobal is very simple:

   def getGlobal(name): 
      from jotweb import config
      return(config.getconfig()['talglobalvars'][name].value())

If I change the "tummyurlbase" line above to:

   urlBase = jotwebutils.getGlobal('jotwebconfig').get('tummyurlbase', 'unknown')

it works fine.  I can do many "getGlobal()" lines, but if I do a
"getconfig()", it's suddenly using another jotwebutils module.

Note that all the jotweb imports are done using "import".  Only local
files in my HTML directory are imported using the "imp" module.

I'm able to find workarounds for these issues in most cases, but it's
kind of driving me crazy as far as when something will work and when it
will lose it's mind.

I tried moving getconfig() into the jotwebutils module, but that just
seemed to make it worse.  Then getGlobal() was also acting this way.

Any thoughts?

Thanks,
Sean
-- 
 How does a girl like you get to be a girl like you?
                 -- _North_by_Northwest_
Sean Reifschneider, Member of Technical Staff <jafo@tummy.com>
tummy.com, ltd. - Linux Consulting since 1995.  Qmail, Python, SysAdmin
From grisha at modpython.org  Mon May 24 11:46:29 2004
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Mon May 24 10:46:38 2004
Subject: [mod_python] Module getting imported twice?
In-Reply-To: <20040524112506.GB4469@tummy.com>
References: <20040524112506.GB4469@tummy.com>
Message-ID: <20040524104452.F51317@onyx.ispol.com>


Sean -

I couldn't quite figure this out - do you actually have more than one
jotwebutils.py in the sys.path?

Grisha


On Mon, 24 May 2004, Sean Reifschneider wrote:

> I'm having a kind of weird problem and I don't fully understand why it's
> happening.  Basically, it seems that sometimes a module I'm importing
> (from site-packages), is losing it's mind.  It's like half way through a
> function it's running in entirely a different name-space.  Yes, this can
> happen while making two calls into a module on successive lines of a
> function.
>
> What I traced it down to is that different calls are showing the
> following values for the module:
>
>    <module 'jotweb.jotwebutils' from
>       '/usr/lib/python2.2/site-packages/jotweb/jotwebutils.py'>
>    <module
>       '/var/www/jotweb/www.tummy.jotweb.jotwebutils' from
>       '/usr/lib/python2.2/site-packages/jotweb/jotwebutils.py'>
>
> I really don't understand the latter.  My HTML and site-related python
> files are in "/var/www/jotweb/www.tummy.com/html".
>
> If, in jotwebutils.py, I dump the stack when the module is imported, I
> see that the first time it's imported with the following:
>
>    File "/var/tmp/mod_python-3.0.4-root/usr/lib/python2.2/site-packages/mod_python/apache.py",
>       line 274, in HandlerDispatch
>    File "/var/tmp/mod_python-3.0.4-root/usr/lib/python2.2/site-packages/mod_python/apache.py",
>       line 440, in import_module
>    File "lib/jotweb/__init__.py", line 32, in ?
>
> and the second time it's imported with:
>
>    File "/var/tmp/mod_python-3.0.4-root/usr/lib/python2.2/site-packages/mod_python/apache.py",
>       line 274, in HandlerDispatch
>    File "/usr/lib/python2.2/site-packages/jotweb/jotweb_mod_python.py",
>       line 45, in handler     def handler(req):
>    [... Deep into the bowels of my handler code ...]
>    File "/var/www/jotweb/www.tummy.com/html/navigation.py",
>       line 3, in ?     import time, string, re, dircache, math
>    File "lib/jotweb/__init__.py", line 32, in ?
>
> Now, it should be noted that I'm using the "imp" module to load modules
> dynamically when they are referenced from my HTML templates.  But the
> code in question that is triggering this is:
>
>    from jotweb import jotwebutils
>    import jotweb
>
>    navbar = jotwebutils.getGlobal('navbar')
>    urlBase = jotweb.config.getconfig().get('tummyurlbase', 'unknown')
>
> jotwebutils.getGlobal is very simple:
>
>    def getGlobal(name):
>       from jotweb import config
>       return(config.getconfig()['talglobalvars'][name].value())
>
> If I change the "tummyurlbase" line above to:
>
>    urlBase = jotwebutils.getGlobal('jotwebconfig').get('tummyurlbase', 'unknown')
>
> it works fine.  I can do many "getGlobal()" lines, but if I do a
> "getconfig()", it's suddenly using another jotwebutils module.
>
> Note that all the jotweb imports are done using "import".  Only local
> files in my HTML directory are imported using the "imp" module.
>
> I'm able to find workarounds for these issues in most cases, but it's
> kind of driving me crazy as far as when something will work and when it
> will lose it's mind.
>
> I tried moving getconfig() into the jotwebutils module, but that just
> seemed to make it worse.  Then getGlobal() was also acting this way.
>
> Any thoughts?
>
> Thanks,
> Sean
> --
>  How does a girl like you get to be a girl like you?
>                  -- _North_by_Northwest_
> Sean Reifschneider, Member of Technical Staff <jafo@tummy.com>
> tummy.com, ltd. - Linux Consulting since 1995.  Qmail, Python, SysAdmin
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From jafo at tummy.com  Mon May 24 10:10:04 2004
From: jafo at tummy.com (Sean Reifschneider)
Date: Mon May 24 11:10:13 2004
Subject: [mod_python] Module getting imported twice?
In-Reply-To: <20040524104452.F51317@onyx.ispol.com>
References: <20040524112506.GB4469@tummy.com>
	<20040524104452.F51317@onyx.ispol.com>
Message-ID: <20040524151004.GF4469@tummy.com>

On Mon, May 24, 2004 at 10:46:29AM -0400, Gregory (Grisha) Trubetskoy wrote:
>I couldn't quite figure this out - do you actually have more than one
>jotwebutils.py in the sys.path?

No.  As you can see from this:

>>    <module 'jotweb.jotwebutils' from
>>       '/usr/lib/python2.2/site-packages/jotweb/jotwebutils.py'>
>>    <module
>>       '/var/www/jotweb/www.tummy.jotweb.jotwebutils' from
>>       '/usr/lib/python2.2/site-packages/jotweb/jotwebutils.py'>

Both of them were imported from the same file.

Sean
-- 
 Get your data structures correct first, and the rest of the program will
 write itself.  -- David Jones
Sean Reifschneider, Member of Technical Staff <jafo@tummy.com>
tummy.com, ltd. - Linux Consulting since 1995.  Qmail, Python, SysAdmin
From stian at soiland.no  Mon May 24 19:24:54 2004
From: stian at soiland.no (Stian =?iso-8859-1?Q?S=F8iland?=)
Date: Mon May 24 12:25:09 2004
Subject: [mod_python] Re: Accessing all form fields, empty strings or not
In-Reply-To: <68A7AFEEA80F96479E120166638331AF7EC64E@exchange2.loyaltyworks.com>
References: <68A7AFEEA80F96479E120166638331AF7EC64E@exchange2.loyaltyworks.com>
Message-ID: <20040524162454.GB17764@itea.ntnu.no>

On 2004-05-21 19:34:57, Diener, Edward wrote:

> OK, now I understand. I will have to add appropriate hidden fields with
> values to deal with the problem. Thanks !

Just in case you didn't know: 


If you need to save the state, note that the Session thingie (included
with mod_python) might be what you want. This requires cookie support
for session IDs, but stores values locally.

Hidden values are ok for other things, for instance if you are editing
a database object 722, you might want to include 

    <input type="hidden" name="id" value="722" />  

-- 
Stian S?iland               Work toward win-win situation. Win-lose
Trondheim, Norway           is where you win and the other lose.
http://www.soiland.no/      Lose-lose and lose-win are left as an
                            exercise to the reader.  [Limoncelli/Hogan]
                            Og dette er en ekstra linje 

From grisha at modpython.org  Mon May 24 14:18:45 2004
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Mon May 24 13:18:47 2004
Subject: [mod_python] Module getting imported twice?
In-Reply-To: <20040524151004.GF4469@tummy.com>
References: <20040524112506.GB4469@tummy.com>
	<20040524104452.F51317@onyx.ispol.com>
	<20040524151004.GF4469@tummy.com>
Message-ID: <20040524131529.U53655@onyx.ispol.com>



On Mon, 24 May 2004, Sean Reifschneider wrote:

> On Mon, May 24, 2004 at 10:46:29AM -0400, Gregory (Grisha) Trubetskoy wrote:
> >I couldn't quite figure this out - do you actually have more than one
> >jotwebutils.py in the sys.path?
>
> No.  As you can see from this:
>
> >>    <module 'jotweb.jotwebutils' from
> >>       '/usr/lib/python2.2/site-packages/jotweb/jotwebutils.py'>
> >>    <module
> >>       '/var/www/jotweb/www.tummy.jotweb.jotwebutils' from
> >>       '/usr/lib/python2.2/site-packages/jotweb/jotwebutils.py'>

This second one does look odd. But it's very hard to tell what is going on
here. First, I'd try Python 2.3 (and mp 3.1) and see if it behaves
differently.

Also, the value of module I think depends on how it is imported, i.e.
using 'from' vs 'import' vs the imp module might give you different
results, and perhaps there is a bug in Python when a module is imported by
more than way it corrupts the value of module...

Grisha
From jafo at tummy.com  Mon May 24 15:24:47 2004
From: jafo at tummy.com (Sean Reifschneider)
Date: Mon May 24 16:24:56 2004
Subject: [mod_python] Module getting imported twice?
In-Reply-To: <20040524131529.U53655@onyx.ispol.com>
References: <20040524112506.GB4469@tummy.com>
	<20040524104452.F51317@onyx.ispol.com>
	<20040524151004.GF4469@tummy.com>
	<20040524131529.U53655@onyx.ispol.com>
Message-ID: <20040524202447.GK4469@tummy.com>

On Mon, May 24, 2004 at 01:18:45PM -0400, Gregory (Grisha) Trubetskoy wrote:
>This second one does look odd. But it's very hard to tell what is going on
>here. First, I'd try Python 2.3 (and mp 3.1) and see if it behaves
>differently.

That tool-chain is totally breaking my application, so that's going to
take a while to figure out.  It's just generating blank pages at the
moment, I have no idea why, no errors in error_log.

>Also, the value of module I think depends on how it is imported, i.e.
>using 'from' vs 'import' vs the imp module might give you different
>results, and perhaps there is a bug in Python when a module is imported by
>more than way it corrupts the value of module...

I'm fairly sure that this module is not getting imported by "imp".  I
added logging of any time a module was imported by imp, and it isn't
directly called by that.  However, a module that is imported by imp is
importing these modules and that's where the code is that is failing.
As I said, one line works, the next line doesn't.  That code is within a
module imported with imp.

Sean
-- 
 If you don't have time to do it right, when will you ever find time to do
 it over?
Sean Reifschneider, Member of Technical Staff <jafo@tummy.com>
tummy.com, ltd. - Linux Consulting since 1995.  Qmail, Python, SysAdmin
From hawkeesk8 at yahoo.com  Mon May 24 18:13:30 2004
From: hawkeesk8 at yahoo.com (Kevin Smith)
Date: Mon May 24 20:13:51 2004
Subject: [mod_python] Session timeout reset bug?
Message-ID: <20040525001330.77180.qmail@web50903.mail.yahoo.com>

Hi,

I believe I may have come across a bug in the
resetting of the timeout in the Session object.  I
could not get the session to timeout and tracked down
the problem to inside the __init__() of the
BaseSession class.  Should there not be an explicit
save of the session object after  the line that reads:

        self._accessed = time.time()

This is the last thing performed in the method just
before the random cleanup.

Anyway, I added the following line and now everything
behaves as expected:

        self._accessed = time.time()
        self.save()

On other notes, I also ran across a bit of a "gotcha."
 I set the timeout parameter as a PythonOption.  Of
course, when retrieving the value it comes in as a
string.  I then unwittingly sent that off as a
parameter to Session.Session().  Only after a lot of
scratching my head I discovered that the timeout
calculation in load() was taking my timeout 'string'
and successfully doing the ">" operation on it but the
result was always False.  Could there not be an
explicit cast to float?  (of course I later casted to
a float before sending which then led to the
investigation of the aforementioned problem)

Cheers


	
		
__________________________________
Do you Yahoo!?
Friends.  Fun.  Try the all-new Yahoo! Messenger.
http://messenger.yahoo.com/ 
From dpopowich at comcast.net  Tue May 25 14:13:57 2004
From: dpopowich at comcast.net (Daniel J. Popowich)
Date: Tue May 25 13:15:04 2004
Subject: [mod_python] Announcing: Mod_python Servlets
Message-ID: <16563.32469.848207.100003@gargle.gargle.HOWL>


A few months ago I asked Grisha what was the best way to make a
contribution of code to mod_python.  He said I should post it to
python-dev and then we'd take it from there.

I felt I needed to write comprehensive documentation and put together
a solid tutorial before posting the code.  Nearly three months later,
here I am.

It can be downloaded from:

    http://home.comcast.net/~d.popowich/mpservlets/

Below is a snippet from the README file included in the package.  It
gives an overview of the handler and its key functionality:

Cheers,

Daniel Popowich

----------------------------------------------------------------------
Excerpt from README:
----------------------------------------------------------------------

    Mod_python Servlets

    ============
    0. Preamble
    ============

    It is my intention to donate this handler to mod_python and by
    extension, the Apache Foundation.  To this end, I have put together
    the handler, along with API reference documentation and a tutorial in
    the hopes that developers will use it and, finding it a simple, yet
    powerfully productive tool, use it in their projects, offer feedback
    and, eventually, promote its acceptance in the mainstream
    distribution.


    ============
    1. Overview
    ============

    If mod_python's publisher handler is a functional view of the web, the
    servlet handler is an object oriented view of the web.  It is inspired
    by WebWare (http://webware.sourceforge.net).

    I programmed with Webware for many projects.  I loved the object
    oriented view of the web it promoted and found it to be a very
    productive tool to quickly prototype web applications.  However, I
    found it lacking in a number of ways: 1) it has its own server process
    that needs to be started and managed, this is in addition to apache or
    another web server; 2) its class hierarchy is rather deep: there are
    five classes, inclusive, in the hierarchy between the base class and
    the class that represents an HTML page (there are only two in
    Mod_python Servlets); 3) even though a web server like apache manages
    processes and/or threads, WebWare has its own extensive thread
    management system which adds complexity to an overall web application;
    4) WebWare promotes a comprehensive buy-in to their framework that,
    personally, I found unwieldy.

    In short, I found WebWare too "big" for my needs and started looking
    for something more streamlined.  I couldn't find it.

    Since I never intended on using a web server other than apache, it
    made sense to give mod_python a closer look than I had before.  It was
    immediately clear that process/thread management came "free" by using
    an apache handler.  The publisher handler is clearly a powerful tool,
    but I missed the OO view of WebWare.  I looked at mod_python handlers
    that are available in the opensource community, but found most
    required a buy-in to their framework and/or content management system.

    At some point I realized it would be VERY easy to implement the best
    features of WebWare as a mod_python handler without the bloat and
    management burdens of other systems.  Best of all, it would be easy to
    reuse many features of mod_python without re-inventing the wheel
    (Session, Cookie, FieldStorage, etc.)


    ==================================================
    1.5. Goals (which turns out to be a feature list)
    ==================================================

      1. Using mod_python, write a handler that operates in much the same
	 way as WebWare: for any given request, create (or reuse) an
	 instance of a well-defined base class to process the request,
	 calling, in order, a set of methods on the instance.

      2. Offer tools to manage much of the tedium of web programming:
	 processing query arguments and form variables.  Mod_python
	 Servlets, building on mod_python.utils.FieldStorage, will
	 automatically create instance variables for query arguments and
	 form variables, allowing the developer to specify default values
	 if they don't appear in the request as well as conversion methods
	 to convert the strings to arbitrary python objects.  In addition,
	 there is built-in support to accept python lists and dicts as
	 form variables.  E.g., you can give HTML FORM elements names,
	 such as, "foo[a]", "foo[b]", "foo[c]", ... and have returned to
	 your servlet an instance variable named "foo", a dict, with keys
	 "a", "b", "c", ... and their values being whatever was specified
	 in the FORM.  Likewise, naming FORM elements with the same name
	 (as with a CHECKBOX or SELECT with multiple set) Mod_python
	 Servlets can return a python list.

      3. Allow for arbitrary methods of servlets to be called when forms
	 are submitted.  With Mod_python Servlets you can name FORM BUTTON
	 and/or INPUT SUBMIT/BUTTON elements with a special syntax such
	 that when the form is submitted, a method the developer specifies
	 will be called.  Security features are built-in to prevent *any*
	 method to be called, just those the developer specifies.

      4. Remove the tedium of generating HTML documents.  I HATE writing
	 HTML.  Mod_python Servlets generates well-defined HTML documents
	 and through the setting of instance variables and/or overriding
	 base methods, offer the developer much flexibility in customizing
	 their HTML.  When used with a tool like HyperText or HTMLgen, you
	 can write web applications without EVER having to write HTML.

      5. Support basic HTTP authentication.  Mod_python Servlets has tools
	 to manage HTTP authentication including a simple method that
	 accepts any mapping (that supports the standard get() method)
	 where keys are usernames and values are passwords.

      6. Promote no framework that requires buy-in other than the servlets
	 themselves.  Mod_python Servlets does not insist your content be
	 in a certain format or that you use any other third-party
	 packages.  This is not a religious movement!

      7. Make the management footprint small.  The handler function and
	 one supporting class are less than 150 lines of code (after
	 stripping doc strings).  The bulk of the functionality is in the
	 class hierarchy that represents a servlet.

      8. Most importantly, separate processing from content.  I loathe
	 PHP.  By extension, mod_python PSP.  If you, like me, have an
	 inbred need to separate code from content AND you thrive in an OO
	 view of the web, Mod_python Servlets are for you.


From nick at dd.revealed.net  Tue May 25 14:55:34 2004
From: nick at dd.revealed.net (Nick)
Date: Tue May 25 14:55:50 2004
Subject: [mod_python] Re: Announcing: Mod_python Servlets
In-Reply-To: <16563.32469.848207.100003@gargle.gargle.HOWL>
References: <16563.32469.848207.100003@gargle.gargle.HOWL>
Message-ID: <40B396A6.8070306@dd.revealed.net>

Odd that this should be announced today as well, but I have been working on 
a commercial web product that uses mod_python for some time now, and 
recently I got all rights back to it and have been working toward making it 
available as open source software.  I was just about to finish packaging it 
up when I read the announcement here, so here's something else to add to the 
mix.  It is a combination template/servlet engine called the Python Servlet 
Engine (PSE).

Instead of outlining the features, just visit the home page at 
http://nick.borko.org/pse where you can find the marketing hype (left over 
from commercial days), the user's manual, and the source.  Feedback welcome.

Nick
From modpy at nebbe.com  Wed May 26 11:49:26 2004
From: modpy at nebbe.com (Robb Nebbe)
Date: Wed May 26 05:55:28 2004
Subject: [mod_python] configuration problems on SuSE 9.1
Message-ID: <200405261049.26206.modpy@nebbe.com>

Hi,

I have tried to test my installation as described in the 
documentation. My current thinking is that the handler is not being 
installed and that this probably has something to do with my apache 
configuration.  The result I am seeing is the default apache behavior 
where files are passed straight through to the browser.

I have read through the mailing list archives and something similar 
seems to come up a couple times a month but I have not found any 
answers that fix my problem.

my httpd.conf contains

<Directory /svr/www/htdocs/test>
    AddHandler mod_python .py
    PythonHandler mptest
    PythonDebug On
</Directory>

the file mptest.py is straight from the manual and is
located at /svr/www/htdocs/test/mptest.py:

"""
from mod_python import apache

def handler(req):
        req.write("Hello World!")
        return apache.OK
"""

The URL is "http://localhost/test/mptest.py"

Apache seems to be working fine by itself, the mod_python module is 
loaded (otherwise apache chokes on the <Directory... information in 
httpd.conf) and it is finding the correct file mptest.py.

The software is the standard SuSE 9.1 versions:

mod_python 3.1.3-34
apache 2.0.49-23
python 2.3.3-85

Any thoughts or pointers would be appreciated.

Robb


From sorr at rightnow.com  Wed May 26 10:42:07 2004
From: sorr at rightnow.com (Orr, Steve)
Date: Wed May 26 11:42:15 2004
Subject: [mod_python] Intermixing legacy CGI with mod_python
Message-ID: <D30BE1A2F9109A43BA989E2F5168405603FA43CB@pobox.corp.rightnow.com>

Regarding this topic... Your collective silence is deafening... And
discouraging! Doesn't anyone on this list have ANY experience with this?


-----Original Message-----
From: mod_python-bounces@modpython.org
[mailto:mod_python-bounces@modpython.org] On Behalf Of Orr, Steve
Sent: Thursday, May 20, 2004 11:44 AM
To: mod_python@modpython.org
Subject: [mod_python] Intermixing legacy CGI with mod_python


I've got a large CGI web app with lots of HTML mixed in. The manual says
the CGI handler is provided for migrating away from legacy CGI but it
also discourages use of the CGI handler such that I'm fearful of
considering it as a transitional approach. Does anybody have testimonial
experience they can share in this area?

TIA

_______________________________________________
Mod_python mailing list
Mod_python@modpython.org
http://mailman.modpython.org/mailman/listinfo/mod_python


From gustavo.cordova at q-voz.com  Wed May 26 12:04:55 2004
From: gustavo.cordova at q-voz.com (=?iso-8859-1?Q?Gustavo_C=F3rdova_Avila?=)
Date: Wed May 26 12:06:22 2004
Subject: [mod_python] Intermixing legacy CGI with mod_python
In-Reply-To: <D30BE1A2F9109A43BA989E2F5168405603FA43CB@pobox.corp.rightnow.com>
Message-ID: <!~!UENERkVCMDkAAQACAAAAAAAAAAAAAAAAABgAAAAAAAAAo5mHXnRFkU2A7MLhj8g/IMKAAAAQAAAAT5GDSasLcE+1ksjIKXNH9QEAAAAA@q-voz.com>

> 
> Regarding this topic... Your collective silence is 
> deafening... And discouraging! Doesn't anyone on this list 
> have ANY experience with this?
>

Have you tried it on a test server?

Most of us on the list, probably, have more experience running
mod_python
application as handlers or using publisher or psp, that would surely
account for this deafening silence.

Maybe.

-gus


From sorr at rightnow.com  Wed May 26 11:36:19 2004
From: sorr at rightnow.com (Orr, Steve)
Date: Wed May 26 12:36:22 2004
Subject: [mod_python] Intermixing legacy CGI with mod_python
Message-ID: <D30BE1A2F9109A43BA989E2F51684056062CA336@pobox.corp.rightnow.com>

Thanks, at least I don't feel too ignored. :-)

I did a benchmark test with mod_python which included maintaining a pool of database connections. By not having to connect to the database for each CGI script and not having to constantly reload the Python interpreter I was able to demonstrate that a mod_python implementation would perform 100 times faster.

I'm really just interested in CGI application performance and not Apache handlers,  publisher, or psp so would I be better off with fastcgi? (We only need to run on Apache.)

Anyone have experience with both mod_python and fastcgi and care to give candid feedback?

AtDhVaAnNkCsE



-----Original Message-----
From: Gustavo C?rdova Avila [mailto:gustavo.cordova@q-voz.com] 
Sent: Wednesday, May 26, 2004 10:05 AM
To: Orr, Steve; mod_python@modpython.org
Subject: RE: [mod_python] Intermixing legacy CGI with mod_python


> 
> Regarding this topic... Your collective silence is
> deafening... And discouraging! Doesn't anyone on this list 
> have ANY experience with this?
>

Have you tried it on a test server?

Most of us on the list, probably, have more experience running
mod_python
application as handlers or using publisher or psp, that would surely
account for this deafening silence.

Maybe.

-gus




From grisha at modpython.org  Wed May 26 14:39:32 2004
From: grisha at modpython.org (Gregory (Grisha) Trubetskoy)
Date: Wed May 26 13:39:34 2004
Subject: [mod_python] Intermixing legacy CGI with mod_python
In-Reply-To: <D30BE1A2F9109A43BA989E2F51684056062CA336@pobox.corp.rightnow.com>
References: <D30BE1A2F9109A43BA989E2F51684056062CA336@pobox.corp.rightnow.com>
Message-ID: <20040526133817.Q94691@onyx.ispol.com>


I'd say that if CGI is a definite requirement, mod_python isn't going to
be your best bet.

Grisha


On Wed, 26 May 2004, Orr, Steve wrote:

> Thanks, at least I don't feel too ignored. :-)
>
> I did a benchmark test with mod_python which included maintaining a pool
> of database connections. By not having to connect to the database for
> each CGI script and not having to constantly reload the Python
> interpreter I was able to demonstrate that a mod_python implementation
> would perform 100 times faster.
>
> I'm really just interested in CGI application performance and not Apache
> handlers, publisher, or psp so would I be better off with fastcgi? (We
> only need to run on Apache.)
>
> Anyone have experience with both mod_python and fastcgi and care to give
> candid feedback?
>
> AtDhVaAnNkCsE
>
>
>
> -----Original Message-----
> From: Gustavo C?rdova Avila [mailto:gustavo.cordova@q-voz.com]
> Sent: Wednesday, May 26, 2004 10:05 AM
> To: Orr, Steve; mod_python@modpython.org
> Subject: RE: [mod_python] Intermixing legacy CGI with mod_python
>
>
> >
> > Regarding this topic... Your collective silence is
> > deafening... And discouraging! Doesn't anyone on this list
> > have ANY experience with this?
> >
>
> Have you tried it on a test server?
>
> Most of us on the list, probably, have more experience running
> mod_python
> application as handlers or using publisher or psp, that would surely
> account for this deafening silence.
>
> Maybe.
>
> -gus
>
>
>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From krishna at ironport.com  Wed May 26 12:04:07 2004
From: krishna at ironport.com (Krishna Srinivasan)
Date: Wed May 26 14:04:09 2004
Subject: [mod_python] Reimporting again and again
Message-ID: <Pine.BSF.4.55.0405261103320.39275@saint.ironport.com>


Greetings.

This is my configuration -

FreeBSD 4.9
Python 2.2.3 (--without-threads)
Apache 2.0.49
ModPython 3.1.3
I also did the 'setenv LD_PRELOAD /usr/lib/libc_r.so"

There is an index.py which has three functions.
Every time a call is made to one of these three
functions, there is an entry (a "notice") in the
"error_log" that this module is being (Re)imported.

Why so ? Can someone please explain what's going on ?
Or am I missing some flags/directives that I should
have set ?

Any ideas ??? Please help,

Thanks,
Krishna.

From Edward.Diener at loyaltyworks.com  Wed May 26 17:05:13 2004
From: Edward.Diener at loyaltyworks.com (Diener, Edward)
Date: Wed May 26 16:04:58 2004
Subject: [mod_python] Document root
Message-ID: <68A7AFEEA80F96479E120166638331AF7EC65A@exchange2.loyaltyworks.com>

The document root is returned by the req.document_root() function. But
it seems I should be able to obtain the document root without needing a
request object, since such a value applies to Apache itself. Is there a
way of getting Apache internal values ? I do see the Apache functions
but the explanation of what some of these return, such as config_tree(),
seem pretty sparse and I have the feeling that such values are available
somehow. Does anybody know how I might obtain the document root without
a request object, as well as access to other Apache internal values ?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://modpython.org/pipermail/mod_python/attachments/20040526/a50c2d87/attachment.html
From michael at dynamine.net  Wed May 26 14:23:54 2004
From: michael at dynamine.net (Michael S. Fischer)
Date: Wed May 26 16:24:06 2004
Subject: [mod_python] Document root
In-Reply-To: <68A7AFEEA80F96479E120166638331AF7EC65A@exchange2.loyaltyworks.com>
Message-ID: <20040526202357.4D1E73118BE@attrition.dynamine.net>

This has been asked before, I believe.
 
Apache has to determine the proper virtual host for a given request before
it can figure out what the document root is.  For this reason, the document
root can only be part of the request object.
 
--Michael


  _____  

From: mod_python-bounces@modpython.org
[mailto:mod_python-bounces@modpython.org] On Behalf Of Diener, Edward
Sent: Wednesday, May 26, 2004 1:05 PM
To: mod_python@modpython.org
Subject: [mod_python] Document root


The document root is returned by the req.document_root() function. But it
seems I should be able to obtain the document root without needing a request
object, since such a value applies to Apache itself. Is there a way of
getting Apache internal values ? I do see the Apache functions but the
explanation of what some of these return, such as config_tree(), seem pretty
sparse and I have the feeling that such values are available somehow. Does
anybody know how I might obtain the document root without a request object,
as well as access to other Apache internal values ?

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://modpython.org/pipermail/mod_python/attachments/20040526/bf7b8588/attachment.html
From sorr at rightnow.com  Wed May 26 16:40:09 2004
From: sorr at rightnow.com (Orr, Steve)
Date: Wed May 26 17:40:13 2004
Subject: [mod_python] Intermixing legacy CGI with mod_python
Message-ID: <D30BE1A2F9109A43BA989E2F5168405603FA43D3@pobox.corp.rightnow.com>

> I'm really just interested in CGI application performance
OK, what if I said "web application performance?


-----Original Message-----
From: Gregory (Grisha) Trubetskoy [mailto:grisha@modpython.org] 
Sent: Wednesday, May 26, 2004 11:40 AM
To: Orr, Steve
Cc: Gustavo C?rdova Avila; mod_python@modpython.org
Subject: RE: [mod_python] Intermixing legacy CGI with mod_python



I'd say that if CGI is a definite requirement, mod_python isn't going to be your best bet.

Grisha


On Wed, 26 May 2004, Orr, Steve wrote:

> Thanks, at least I don't feel too ignored. :-)
>
> I did a benchmark test with mod_python which included maintaining a 
> pool of database connections. By not having to connect to the database 
> for each CGI script and not having to constantly reload the Python 
> interpreter I was able to demonstrate that a mod_python implementation 
> would perform 100 times faster.
>
> I'm really just interested in CGI application performance and not 
> Apache handlers, publisher, or psp so would I be better off with 
> fastcgi? (We only need to run on Apache.)
>
> Anyone have experience with both mod_python and fastcgi and care to 
> give candid feedback?
>
> AtDhVaAnNkCsE
>
>
>
> -----Original Message-----
> From: Gustavo C?rdova Avila [mailto:gustavo.cordova@q-voz.com]
> Sent: Wednesday, May 26, 2004 10:05 AM
> To: Orr, Steve; mod_python@modpython.org
> Subject: RE: [mod_python] Intermixing legacy CGI with mod_python
>
>
> >
> > Regarding this topic... Your collective silence is deafening... And 
> > discouraging! Doesn't anyone on this list have ANY experience with 
> > this?
> >
>
> Have you tried it on a test server?
>
> Most of us on the list, probably, have more experience running 
> mod_python application as handlers or using publisher or psp, that 
> would surely account for this deafening silence.
>
> Maybe.
>
> -gus
>
>
>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org 
> http://mailman.modpython.org/mailman/listinfo/mod_python
>


From krishna at ironport.com  Wed May 26 17:27:55 2004
From: krishna at ironport.com (Krishna Srinivasan)
Date: Wed May 26 19:27:58 2004
Subject: [mod_python] max session value
Message-ID: <Pine.BSF.4.55.0405261627130.39275@saint.ironport.com>


What is the maximum value that can be set
via sess.set_timeout() ???

Thanks,
Krishna.

From gdamjan at mail.net.mk  Wed May 26 16:34:17 2004
From: gdamjan at mail.net.mk (Damjan)
Date: Wed May 26 20:16:25 2004
Subject: [mod_python] Suggestion: libpython.so
Message-ID: <20040526133417.GA1151@legolas.on.net.mk>

Recent python installations (I think from 2.3) by default build a
dynamic libpython library. 

I think mod_python should have a ./configure
option to use the dynamic library instead of the static library archive.

The only change is that "-L/usr/lib/python2.3/config" should be
removed from the LDFLAGS in src/Makefile. This way two things are
gained, mod_python.so is 100k instead of 1.3M, and minor upgrades to
python would also upgrade mod_python.


-- 
damjan | ??????
This is my jabber ID --> damjan@bagra.net.mk <-- not my mail address!!!
From ppercot at free.fr  Thu May 27 13:12:19 2004
From: ppercot at free.fr (Patrick Percot)
Date: Thu May 27 06:12:24 2004
Subject: [mod_python] Re: Undocumented (?) change in PythonPath for 3.0 vs
	2.7
Message-ID: <20040527.121219.95064973.ppercot@free.fr>

Hi,

[..Zapp? 17 lignes et 463 caract?res..]

> But if I do this under 3.0:
> 
>   <Directory /mywebdir>
>     AddHandler python-program .py
>     PythonDebug On
>     <Files *.py>
>       PythonPath "['/mywebdir'] + sys.path"
>     </Files>
>     <Files "prog1.py"
>       PythonHandler prog1
>     </Files>
>     <Files "prog2.py"
>       PythonHandler prog2
>     </Files>
>   </Directory>
> 
> (i.e. put the PythonPath inside a <Files *.py>) this works. 

I tried this too, because  the PythonPath directive didn't worked at all
for me. But I had no success with <Files *.py> directive. 

It worked only inside a <Files *> directive. 

I have the following software :

Python 2.3.3
mod_python 3.1.3
Apache 2.0.49

under  Debian Gnu/Linux  (the preceding  software  are not  part of  the
Debian packages).

[..Zapp? 8 lignes et 98 caract?res..]

?+
PP
-- 
Groupe Morbihannais d'Utilisateurs de Logiciels Libres http://www.tuxbihan.org
Identifiant Jabber: pp@amessage.de
GPG fingerprint = 1A4F E154 3D2C A20E E4CA  A543 7951 C5C2 E44A A0B5

Patrick Percot.

From davidf at sjsoft.com  Thu May 27 17:07:50 2004
From: davidf at sjsoft.com (David Fraser)
Date: Thu May 27 10:07:53 2004
Subject: [mod_python] Suggestion: libpython.so
In-Reply-To: <20040526133417.GA1151@legolas.on.net.mk>
References: <20040526133417.GA1151@legolas.on.net.mk>
Message-ID: <40B5F636.3080604@sjsoft.com>

Damjan wrote:

>Recent python installations (I think from 2.3) by default build a
>dynamic libpython library. 
>
>I think mod_python should have a ./configure
>option to use the dynamic library instead of the static library archive.
>
>The only change is that "-L/usr/lib/python2.3/config" should be
>removed from the LDFLAGS in src/Makefile. This way two things are
>gained, mod_python.so is 100k instead of 1.3M, and minor upgrades to
>python would also upgrade mod_python.
>  
>
Note that this is what happens on windows.
I am currently working on improving the setup.py script so it can build 
the extension on Unix as well as Windows.
Not everyone may want to do it like this... since apxs is nice. But it 
seems to work fine.
I might try and include an option to use the dynamic library...

David
From ppercot at free.fr  Thu May 27 20:00:06 2004
From: ppercot at free.fr (Patrick Percot)
Date: Thu May 27 13:00:17 2004
Subject: [mod_python] Usage of VirtualHost with publisher or handler
Message-ID: <20040527.190006.70228026.ppercot@free.fr>

Hi,

It seems that a difference of behaviour between publisher and handler. 

I want to  put the request handlers in the  directory handled by Apache,
and the rest of the application in another directory. Perhaps you should
consider  it is  not the  best choice,  but I  noticed  some differences
between the two configurations :


First  config with  publisher,  I *DO  NOT  NEED* to  add the  directory
/var/www/myapp/web to PythonPath :

<VirtualHost myapp.muaddib>
	DocumentRoot /var/www/myapp/web
	ServerName myapp.muaddib

	SetHandler python-program
	PythonDebug On
	<Files *>
		PythonPath "sys.path + ['/usr/local/myapp']"
	</Files>
	PythonHandler mod_python.publisher

</VirtualHost>


Second  configuration  with  handler,  I  *NEED* to  add  the  directory
/var/www/myapp/web(2) to PythonPath :

<VirtualHost myapp2.muaddib>
	DocumentRoot /var/www/myapp/web2
	ServerName myapp2.muaddib

	SetHandler python-program
	PythonDebug On
	PythonHandler handler

	<Files *>
		PythonPath "sys.path + ['/var/www/myapp/web2'] + ['/usr/local/myapp']"
	</Files>

</VirtualHost>


I also noticed  that with a <Directory > directive, there  is no need to
add the directory path to PythonPath. 

I did not see anything about those differences of behaviour on the FAQ. 


Is this a feature or a bug ? ;)


?+
PP
-- 
Groupe Morbihannais d'Utilisateurs de Logiciels Libres http://www.tuxbihan.org
Identifiant Jabber: pp@amessage.de
GPG fingerprint = 1A4F E154 3D2C A20E E4CA  A543 7951 C5C2 E44A A0B5

Patrick Percot.

From neel at mediapulse.com  Thu May 27 14:32:25 2004
From: neel at mediapulse.com (Michael C. Neel)
Date: Thu May 27 13:32:07 2004
Subject: [mod_python] Suggestion: libpython.so
In-Reply-To: <40B5F636.3080604@sjsoft.com>
References: <20040526133417.GA1151@legolas.on.net.mk>
	<40B5F636.3080604@sjsoft.com>
Message-ID: <1085679145.32147.75.camel@mike.mediapulse.com>

I'd be curious to see what, if any, performance changes this would
result in.  A shame you can't timeit.py /usr/bin/apache =p

Mike

On Thu, 2004-05-27 at 10:07, David Fraser wrote:

> Damjan wrote:
> 
> >Recent python installations (I think from 2.3) by default build a
> >dynamic libpython library. 
> >
> >I think mod_python should have a ./configure
> >option to use the dynamic library instead of the static library archive.
> >
> >The only change is that "-L/usr/lib/python2.3/config" should be
> >removed from the LDFLAGS in src/Makefile. This way two things are
> >gained, mod_python.so is 100k instead of 1.3M, and minor upgrades to
> >python would also upgrade mod_python.
> >  
> >
> Note that this is what happens on windows.
> I am currently working on improving the setup.py script so it can build 
> the extension on Unix as well as Windows.
> Not everyone may want to do it like this... since apxs is nice. But it 
> seems to work fine.
> I might try and include an option to use the dynamic library...
> 
> David
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python

__________________________________ 

michael.neel@mediapulse.com
vice president of information systems
865.675.4455 x30
800.380.4514

www.mediapulse.com
__________________________________
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://modpython.org/pipermail/mod_python/attachments/20040527/fc58c369/attachment.html
From michael at dynamine.net  Thu May 27 11:57:44 2004
From: michael at dynamine.net (Michael S. Fischer)
Date: Thu May 27 13:57:16 2004
Subject: [mod_python] Suggestion: libpython.so
In-Reply-To: <1085679145.32147.75.camel@mike.mediapulse.com>
Message-ID: <20040527175709.2DEEC3118BE@attrition.dynamine.net>

That's what ab(1) is for.
 
--Michael


  _____  

From: mod_python-bounces@modpython.org
[mailto:mod_python-bounces@modpython.org] On Behalf Of Michael C. Neel
Sent: Thursday, May 27, 2004 10:32 AM
To: David Fraser
Cc: Damjan; mod_python@modpython.org
Subject: Re: [mod_python] Suggestion: libpython.so


I'd be curious to see what, if any, performance changes this would result
in.  A shame you can't timeit.py /usr/bin/apache =p

Mike

On Thu, 2004-05-27 at 10:07, David Fraser wrote: 

Damjan wrote:



>Recent python installations (I think from 2.3) by default build a

>dynamic libpython library. 

>

>I think mod_python should have a ./configure

>option to use the dynamic library instead of the static library archive.

>

>The only change is that "-L/usr/lib/python2.3/config" should be

>removed from the LDFLAGS in src/Makefile. This way two things are

>gained, mod_python.so is 100k instead of 1.3M, and minor upgrades to

>python would also upgrade mod_python.

>  

>

Note that this is what happens on windows.

I am currently working on improving the setup.py script so it can build 

the extension on Unix as well as Windows.

Not everyone may want to do it like this... since apxs is nice. But it 

seems to work fine.

I might try and include an option to use the dynamic library...



David

_______________________________________________

Mod_python mailing list

Mod_python@modpython.org

 <http://mailman.modpython.org/mailman/listinfo/mod_python>
http://mailman.modpython.org/mailman/listinfo/mod_python



__________________________________ 

 <mailto:michael.neel@mediapulse.com> michael.neel
<mailto:michael.neel@mediapulse.com> @mediapulse.com
vice president of information systems
865.675.4455 x30
800.380.4514

 <http://www.mediapulse.com/> www.mediapulse.com
__________________________________ 	


-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://modpython.org/pipermail/mod_python/attachments/20040527/5928a31a/attachment.html
From neel at mediapulse.com  Thu May 27 16:57:57 2004
From: neel at mediapulse.com (Michael C. Neel)
Date: Thu May 27 15:57:39 2004
Subject: [mod_python] Suggestion: libpython.so
In-Reply-To: <20040527175709.2DEEC3118BE@attrition.dynamine.net>
References: <20040527175709.2DEEC3118BE@attrition.dynamine.net>
Message-ID: <1085687877.32147.123.camel@mike.mediapulse.com>

I don't think I'm alone when I say using ab to benchmark an application
versus static content can become more art than science =p

So since it's be brought up, what does everyone here use to performance
test their mod Python applications?

Mike

On Thu, 2004-05-27 at 13:57, Michael S. Fischer wrote:

> That's what ab(1) is for.
>  
> --Michael


-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://modpython.org/pipermail/mod_python/attachments/20040527/6a81681f/attachment.html
From nick at dd.revealed.net  Thu May 27 16:42:37 2004
From: nick at dd.revealed.net (Nick)
Date: Thu May 27 16:42:51 2004
Subject: [mod_python] Suggestion: libpython.so
In-Reply-To: <1085687877.32147.123.camel@mike.mediapulse.com>
References: <20040527175709.2DEEC3118BE@attrition.dynamine.net>
	<1085687877.32147.123.camel@mike.mediapulse.com>
Message-ID: <40B652BD.2040409@dd.revealed.net>

Michael C. Neel wrote:

> So since it's be brought up, what does everyone here use to performance 
> test their mod Python applications?

Albeit crude, I use siege.

Nick
From rmangaliag at slu.edu.ph  Fri May 28 17:17:33 2004
From: rmangaliag at slu.edu.ph (ali)
Date: Fri May 28 04:04:56 2004
Subject: [mod_python] session problem in win2k
Message-ID: <1085732253.40b6f59d3b521@webmail.slu.edu.ph>

i am quite new to mod_python and this is my first time to use session in
modpython...

using a simple index.psp file with these contents:

<%
from mod_python import Session
test = Session.Session(req)
%>

it produces this "500 Internal Server Error"... in the apache error log, it
shows this...

[Fri May 28 15:45:41 2004] [error] [client 127.0.0.1] PythonHandler
mod_python.psp: Traceback (most recent call last):, referer: http://localhost/
[Fri May 28 15:45:41 2004] [error] [client 127.0.0.1] PythonHandler
mod_python.psp:   File "F:\Python23\Lib\site-packages\mod_python\apache.py",
line 299, in HandlerDispatch
    result = object(req), referer: http://localhost/
[Fri May 28 15:45:41 2004] [error] [client 127.0.0.1] PythonHandler
mod_python.psp:   File "F:\Python23\Lib\site-packages\mod_python\psp.py", line
297, in handler
    p.run(), referer: http://localhost/
[Fri May 28 15:45:41 2004] [error] [client 127.0.0.1] PythonHandler
mod_python.psp:   File "F:\Python23\Lib\site-packages\mod_python\psp.py", line
208, in run
    exec code in global_scope, referer: http://localhost/
[Fri May 28 15:45:41 2004] [error] [client 127.0.0.1] PythonHandler
mod_python.psp:   File "F:/htdocs/test/index.psp", line 3, in ?
    test = Session.Session(req), referer: http://localhost/
[Fri May 28 15:45:42 2004] [error] [client 127.0.0.1] PythonHandler
mod_python.psp:   File "F:\Python23\Lib\site-packages\mod_python\Session.py",
line 386, in Session
    timeout=timeout, lock=lock), referer: http://localhost/
[Fri May 28 15:45:42 2004] [error] [client 127.0.0.1] PythonHandler
mod_python.psp:   File "F:\Python23\Lib\site-packages\mod_python\Session.py",
line 358, in __init__
    timeout=timeout, lock=lock), referer: http://localhost/
[Fri May 28 15:45:42 2004] [error] [client 127.0.0.1] PythonHandler
mod_python.psp:   File "F:\Python23\Lib\site-packages\mod_python\Session.py",
line 132, in __init__
    Cookie.add_cookie(self._req, self.make_cookie()), referer:
http://localhost/
[Fri May 28 15:45:42 2004] [error] [client 127.0.0.1] PythonHandler
mod_python.psp:   File "F:\Python23\Lib\site-packages\mod_python\Session.py",
line 160, in make_cookie
    c.path = dirpath[len(docroot):], referer: http://localhost/
[Fri May 28 15:45:42 2004] [error] [client 127.0.0.1] PythonHandler
mod_python.psp: TypeError: unsubscriptable object, referer: http://localhost/

what could be my mistake???

thanks...

by the way these are my computer details...
windows 2000 prof
apache 2.0.43
python 2.3
modpython 3.1.3

note: this is what the error log shows when apache is restarted...

[Fri May 28 15:52:30 2004] [notice] mod_python: Creating 32 session mutexes
based on 0 max processes and 250 max threads.
[Fri May 28 15:52:30 2004] [notice] Parent: Created child process 2692
[Fri May 28 15:52:31 2004] [notice] mod_python: Creating 32 session mutexes
based on 0 max processes and 250 max threads.
[Fri May 28 15:52:31 2004] [notice] Child 2692: Child process is running
(720123)The filename, directory name, or volume label syntax is incorrect.  :
mod_python: Failed to reinit global mutex <null>.
[Fri May 28 15:52:31 2004] [notice] Child 2692: Acquired the start mutex.
[Fri May 28 15:52:31 2004] [notice] Child 2692: Starting 250 worker threads.




----------------------------------------------------------------
This message was sent using IMP, the Internet Messaging Program.
From krishna at ironport.com  Fri May 28 19:44:36 2004
From: krishna at ironport.com (Krishna Srinivasan)
Date: Fri May 28 21:44:47 2004
Subject: [mod_python] Sessions and cleaning up...
Message-ID: <Pine.BSF.4.55.0405281834100.39275@saint.ironport.com>


Greetings.

Can someone please explain how exactly sessions are cleaned up ?
I am seeing a constant increase in the /tmp/mp_sess.dbm though
I believe I am doing a 'delete' (and cleanup).

For each session, whenever a user does some action (which internally
involves creating objects and storing them in the session dictionary),
I do a "req.sess.save".
[Where req.sess = Session.Session()]

And then when they do a 'logout' - I do this :
req.sess.delete()
req.sess.invalidate()

I am assuming that the former cleans up the session-object from
the dbm in the /tmp directory and the latter invalidates the
session-cookie-id from the headers (from the modpy online doc).

However,  the size of mp_sess.dbm in /tmp is on the rise
always. Can someone please tell me what else I should be doing ?

I store everything in a simple dictionary.
req.sess["mydict"] = <mydictionary>
The 'mydictionary' object keeps expanding based on user-actions.
I even do a 'del' to remove objects from this 'mydictionary'
object to keep the space down.

I am also wondering if setting up sess.set_timeout() number
has any impact on the dmb being cleaned up or updated. I
would think 'sess.delete' and/or 'sess.invalidate' would
over-ride timeout-value-set.

On a related note, I had posted a question couple of days
back on if there was any max limit for session timeouts
and if that has any impacts.

System - FreeBSD 4.7 - Apache 2.0.48 - Python 2.2.3 - ModPy 3.1.3

Please let me know how to fix this.

Thanks,
Krishna.

From krishna at ironport.com  Fri May 28 20:02:03 2004
From: krishna at ironport.com (Krishna Srinivasan)
Date: Fri May 28 22:02:07 2004
Subject: [mod_python] Wrong link for "download the full archive" ???
Message-ID: <Pine.BSF.4.55.0405281853160.39275@saint.ironport.com>


There is a link to "download the full raw archive" on
the Mod_python archives page at -
http://www.modpython.org/pipermail/mod_python/

But this link downloads a 1.3 MB file and clearly
doesn't have the entire content while the text
beside the link claims it to be a 15MB file,

-Krishna

From perica at zivkovic.nl  Mon May 31 21:28:42 2004
From: perica at zivkovic.nl (Perica Zivkovic)
Date: Mon May 31 14:28:55 2004
Subject: [mod_python] FreeBSD 4.9 | python 2.3.4 | apache 2.0.49 |
	mod_python 3.1.3
Message-ID: <000001c4473d$1d21ad60$6501a8c0@mali>

Hi,

sorry for posting this but I checked all documentation and google and
didn't find any help...

I installed FreeBSD 4.9 and on that clean install I installed from
source (not ports) following:

1. apache 2.0.49
2. python 2.3.4
3. mod_python 3.1.3 (configured with apxs...)

everithing was smooth and easy but...

I included "LoadModule ..." line provided to me by mod python install
script and after I attempt to start apache I get this:

----------------------------
Syntax error on line 233 of /usr/local/apache2/conf/httpd.conf:
Cannot load /usr/local/apache2/modules/mod_python.so into server:
/usr/local/apache2/modules/mod_python.so: Undefined symbol
"pthread_self"
----------------------------

I'm not posting this after first failed attempt... I tried to reinstall
an do this three times but no luck...

Please help

grt.

Perica


