<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Cookies &amp; Redirects
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Cookies%20%26%20Redirects&In-Reply-To=5.2.1.1.2.20040822030418.02a98ec0%40mail.pyxos.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016170.html">
   <LINK REL="Next"  HREF="016183.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Cookies &amp; Redirects</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Jim Dabell</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Cookies%20%26%20Redirects&In-Reply-To=5.2.1.1.2.20040822030418.02a98ec0%40mail.pyxos.com"
       TITLE="[mod_python] Cookies &amp; Redirects">jim-mod-python at jimdabell.com
       </A><BR>
    <I>Mon Aug 23 06:03:42 EDT 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="016170.html">[mod_python] Cookies &amp; Redirects
</A></li>
        <LI>Next message: <A HREF="016183.html">[mod_python] Cookies &amp; Redirects
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16178">[ date ]</a>
              <a href="thread.html#16178">[ thread ]</a>
              <a href="subject.html#16178">[ subject ]</a>
              <a href="author.html#16178">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Sunday 22 August 2004 09:14, Daniel West wrote:
&gt;<i> I have a script that needs to receive a request, set a cookie, and then
</I>&gt;<i> redirect to another location.  I'm using PSP on mod_python 3.1.3.  I'm not
</I>&gt;<i> getting the Set-Cookie header in the request response.
</I>[snip]
&gt;<i> Why is it that mod_python seems to honor the Set-Cookie header for the OK
</I>&gt;<i> status code, but not the others?
</I>
Your mistake is in assuming that adding something to req.headers_out will 
result in headers being sent out ;).

For some reason, mod_python has separated the concept of response headers out 
into two separate types - headers that are sent out in normal conditions, and 
headers that are sent out in error conditions.  I would guess that raising 
any type of exception will cause mod_python to ignore normal headers (but 
still pull out Location in the case of HTTP_SEE_OTHER).

In other words, the working version of the code you posted is:

&lt;%
cookie = &quot;...&quot; # set the cookie to something
req.err_headers_out.add('Set-Cookie', cookie) # note use of err_headers_out
req.headers_out[&quot;Location&quot;] = &quot;<A HREF="http://...&quot;">http://...&quot;</A>
raise apache.SERVER_RETURN, apache.HTTP_SEE_OTHER
%&gt;

I personally think it's pretty silly to have two separate sets of headers, I'm 
guessing this is an internal Apache issue that is being exposed 
unnecessarily.  Especially in this case, it is nonsensical to consider a 
simple redirect to be an error condition that should ignore normal headers.

Also note that using psp.redirect() instead of raising an exception provides 
the behaviour you want.  Another alternative is to set req.status to what you 
want and raise apache.OK.  Also, it appears whoever wrote util.redirect() is 
aware of the problem, as it manually sets req.status and then raises 
apache.OK, rather than simply raising an exception with the correct value.

Under what circumstances is having separate sets of headers useful?  Does 
anybody actually need this?  It seems to me that it would be far more 
intuitive to have headers_out sent for every type of response.  At the very 
least, 3xx status codes should not be treated as an error condition (that's 
what 4xx and 5xx are for).

-- 
Jim Dabell

</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="016170.html">[mod_python] Cookies &amp; Redirects
</A></li>
	<LI>Next message: <A HREF="016183.html">[mod_python] Cookies &amp; Redirects
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16178">[ date ]</a>
              <a href="thread.html#16178">[ thread ]</a>
              <a href="subject.html#16178">[ subject ]</a>
              <a href="author.html#16178">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
