<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] HTTP-Keep alive bug?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20HTTP-Keep%20alive%20bug%3F&In-Reply-To=20040806071819.GA20246%40vomjom.org">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016000.html">
   <LINK REL="Next"  HREF="016017.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] HTTP-Keep alive bug?</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>S&#233;bastien Arnaud</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20HTTP-Keep%20alive%20bug%3F&In-Reply-To=20040806071819.GA20246%40vomjom.org"
       TITLE="[mod_python] HTTP-Keep alive bug?">arnaudsj at mac.com
       </A><BR>
    <I>Mon Aug  9 00:30:16 EDT 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="016000.html">[mod_python] HTTP-Keep alive bug?
</A></li>
        <LI>Next message: <A HREF="016017.html">[mod_python] HTTP-Keep alive bug?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16013">[ date ]</a>
              <a href="thread.html#16013">[ thread ]</a>
              <a href="subject.html#16013">[ subject ]</a>
              <a href="author.html#16013">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thanks Jonathan for your response.

I have done a little bit more investigation and I think that I managed 
a work around:

First, I was wrong when I said mod_python was forcing the HTTP Header 
&quot;Connection: Close&quot;, it is in fact responding to a client request http 
keep-alive, but it is missing an important part: the HTTP header 
&quot;Content-Length: xxx&quot;! Since it is the only way browsers can keep 
connections alive (to know how much bytes they need to expect back from 
the server), without it, most browsers will NOT keep the connection 
alive (maybe your version of Firefox is sensitive to this missing 
header and tries to wait for more content to come back from the server)

For the record I got mistaken in my early tests because I used Lynx to 
get the HTTP headers back, and found out that Lynx did not send a valid 
HTTP 1.1 request with keep-alive (duh!), therefore it was ok to receive 
a &quot;Connection: Close&quot; back then.

Anyway, I think it would be nice to have an explanation why mod_python 
is not setting by default the Content-Length HTTP header when it is 
already setting the &quot;Connection: Keep-alive&quot; HTTP header in response to 
a keep-alive request from the client.

If you set it by hand in your python code like this though:
	ResultHTML = &quot;Your output HTML to the client&quot;
	req.headers_out['Content-Length']=str(len(ResultHTML))
	req.write(ResultHTML)

It works, and you can then start to enjoy the performance boost of 
&quot;keep-alive&quot; connections.

Cheers,

S&#233;bastien


On Aug 6, 2004, at 2:18 AM, Jonathan Hseu wrote:

&gt;<i> On Thu, Aug 05, 2004 at 10:54:51PM -0500, S?bastien Arnaud wrote:
</I>&gt;&gt;<i> Hi,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I wonder if anybody else had been getting the same problem that I
</I>&gt;&gt;<i> noticed with http keep alive request being not answered properly by
</I>&gt;&gt;<i> mod_python. If you take the very simple mptest example, and use ab to
</I>&gt;&gt;<i> benchmark/stress this trivial example, you may notice that even though
</I>&gt;&gt;<i> you are requesting to use http-keep alive (-k option in ab), the
</I>&gt;&gt;<i> resulting page (<A HREF="http://yourserver/test/mptest.py">http://yourserver/test/mptest.py</A>) is forcing the
</I>&gt;&gt;<i> connection to close (inspect the HTTP headers and see Connection:
</I>&gt;&gt;<i> Close).
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Well, I don't know if this is related, but I do experience an issue 
</I>&gt;<i> with
</I>&gt;<i> keep-alive and mod_python (although, I just assumed it was firefox's
</I>&gt;<i> problem, even though I don't get that bug with anything but firefox).
</I>&gt;<i> Basically, on some keep-alive requests, firefox gives me the HTTP
</I>&gt;<i> headers and other stuff and renders that as text instead of the actual
</I>&gt;<i> page.  Most likely, this is related to your keep-alive bug, since this
</I>&gt;<i> only happens _after_ the first request in a keep-alive request.
</I>&gt;<i>
</I>&gt;<i> Jonathan Hseu
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mod_python mailing list
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I>-------------- next part --------------
A non-text attachment was scrubbed...
Name: PGP.sig
Type: application/pgp-signature
Size: 155 bytes
Desc: This is a digitally signed message part
Url : <A HREF="http://modpython.org/pipermail/mod_python/attachments/20040808/b2018e69/PGP.bin">http://modpython.org/pipermail/mod_python/attachments/20040808/b2018e69/PGP.bin</A>
</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="016000.html">[mod_python] HTTP-Keep alive bug?
</A></li>
	<LI>Next message: <A HREF="016017.html">[mod_python] HTTP-Keep alive bug?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16013">[ date ]</a>
              <a href="thread.html#16013">[ thread ]</a>
              <a href="subject.html#16013">[ subject ]</a>
              <a href="author.html#16013">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="DISABLEhttp://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
