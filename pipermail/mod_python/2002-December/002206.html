<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] cgi handler bug?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20cgi%20handler%20bug%3F&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002205.html">
   <LINK REL="Next"  HREF="002208.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] cgi handler bug?</H1>
    <B>Gregory Bond</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20cgi%20handler%20bug%3F&In-Reply-To="
       TITLE="[mod_python] cgi handler bug?">gnb at itga.com.au
       </A><BR>
    <I>Fri Dec 20 17:33:18 EST 2002</I>
    <P><UL>
        <LI>Previous message: <A HREF="002205.html">[mod_python] import mod_puthon.util fails 
</A></li>
        <LI>Next message: <A HREF="002208.html">[mod_python] installation problems
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2206">[ date ]</a>
              <a href="thread.html#2206">[ thread ]</a>
              <a href="subject.html#2206">[ subject ]</a>
              <a href="author.html#2206">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>[FreeBSD 4.7, python 2.2.2, Apache 2.0.43, mod_python 3.0.1]

When I try and run something using cgihandler, I get the following error:

[Fri Dec 20 16:54:25 2002] [error] [client 192.168.71.163] PythonHandler mod_python.cgihandler:   File &quot;/usr/local/lib/python2.2/site-packages/mod_python/apache.py&quot;, line 764, in restore_nocgi
    for k in osenv:
[Fri Dec 20 16:54:25 2002] [error] [client 192.168.71.163] PythonHandler mod_python.cgihandler: RuntimeError: dictionary changed size during iteration

Looking at mod_python/apache.py:restore_nocgi(), this does:
    for k in osenv:
        del osenv[k]

This is never going to be legal in Python 2.2.  Shouldn't this be 

    for k in osenv.keys():
        del osenv[k]

?

Having made that change, and a few little fixes to the cgi program, (__name__
== &quot;__main__&quot; is no longer true, &quot;foo-bar.py&quot; is not a good name as &quot;import
foo-bar&quot; is a syntax error) my cgi now runs inside mod_python.  But the HTML
generated by the CGI is sent twice, so my page displays double.  I've added 
debugging and the HTML is only being sent from the script once, as far as I 
can tell.  (i.e. I print a string of length 2132 bytes, but View Page Info 
shows 4215 bytes.   No, I have no idea where the missing 49 bytes are!)

Any clues?

Greg.



</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002205.html">[mod_python] import mod_puthon.util fails 
</A></li>
	<LI>Next message: <A HREF="002208.html">[mod_python] installation problems
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2206">[ date ]</a>
              <a href="thread.html#2206">[ thread ]</a>
              <a href="subject.html#2206">[ subject ]</a>
              <a href="author.html#2206">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
