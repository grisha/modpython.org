<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] ioerrors with worker thread mpm
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20ioerrors%20with%20worker%20thread%20mpm&In-Reply-To=437ab9280812101957k4942d9f0xab4c7a67cb68d87d%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025847.html">
   <LINK REL="Next"  HREF="025849.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] ioerrors with worker thread mpm</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20ioerrors%20with%20worker%20thread%20mpm&In-Reply-To=437ab9280812101957k4942d9f0xab4c7a67cb68d87d%40mail.gmail.com"
       TITLE="[mod_python] ioerrors with worker thread mpm">graham.dumpleton at gmail.com
       </A><BR>
    <I>Wed Dec 10 23:33:27 EST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="025847.html">[mod_python] ioerrors with worker thread mpm
</A></li>
        <LI>Next message: <A HREF="025849.html">[mod_python] ioerrors with worker thread mpm
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25848">[ date ]</a>
              <a href="thread.html#25848">[ thread ]</a>
              <a href="subject.html#25848">[ subject ]</a>
              <a href="author.html#25848">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>2008/12/11 Michael Barton &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">mike at weirdlooking.com</A>&gt;:
&gt;<i> Yes, sorry.  The exceptions I've seen are raised by sendall and recv
</I>&gt;<i> on socket objects inside httplib, which is connected to a service.  I
</I>&gt;<i> can reproduce this with a very simple handler like,
</I>&gt;<i>
</I>&gt;<i>  from mod_python import apache
</I>&gt;<i>  from socket import socket
</I>&gt;<i>
</I>&gt;<i>  def handler(req):
</I>&gt;<i>      s = socket()
</I>&gt;<i>      s.connect(('localhost', 80))
</I>&gt;<i>      s.recv(1024)
</I>&gt;<i>      return apache.OK
</I>&gt;<i>
</I>&gt;<i> Make a request to that handler, which will obviously not return any
</I>&gt;<i> time soon.  Then hit the server enough times that it reaches
</I>&gt;<i> MaxRequestsPerChild.  And,
</I>&gt;<i>
</I>&gt;<i> ...
</I>&gt;<i>  File &quot;/home/redbo/test/modpython_handler.py&quot;, line 7, in handler\n
</I>&gt;<i>  s.recv(1024)
</I>&gt;<i> error: (4, 'Interrupted system call')
</I>
Apache doesn't appear to use SA_RESTART when registering signal
handlers, so yes, it means that system calls interrupted by a signal
will not be restarted. This is quite normal behaviour and typically
programs should be written to detect an EINTR and retry the system
library function call being done if they need to be robust in the face
of such an event. That is, code which would run in an unknown
environment, can't assume system calls will be restarted.

The EAGAIN error is different and doubtful it is cause by signals.
What EAGAIN means will depend on what system library call is being
used. For recv() it means:

     [EAGAIN]           The socket is marked non-blocking, and the receive
                        operation would block, or a receive timeout had been
                        set, and the timeout expired before data were
                        received.

Graham

&gt;<i> On Wed, Dec 10, 2008 at 9:19 PM, Graham Dumpleton
</I>&gt;<i> &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">graham.dumpleton at gmail.com</A>&gt; wrote:
</I>&gt;&gt;<i> Blocking i/o operations against what? Sockets you have created off to
</I>&gt;&gt;<i> something else????
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> 2008/12/11 Michael Barton &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">mike at weirdlooking.com</A>&gt;:
</I>&gt;&gt;&gt;<i> Hey list!
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> I'm having a problem adapting a mod_python-based app to work with
</I>&gt;&gt;&gt;<i> Apache's worker thread mpm.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> When the process hits MaxRequestsPerChild under a high concurrency of
</I>&gt;&gt;&gt;<i> requests, blocking i/o operations in other threads on that child raise
</I>&gt;&gt;&gt;<i> exceptions (mostly EINTR or EAGAIN IOErrors in httplib).
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> It looks like system calls are being interrupted by signals Apache
</I>&gt;&gt;&gt;<i> uses to control its children.  But that seems like a problem that
</I>&gt;&gt;&gt;<i> would have come up before, and I can't find much by searching the web
</I>&gt;&gt;&gt;<i> or list archives.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> I figured I'd punt to the list and see if anyone has other thoughts.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> My setup is: debian, apache 2.2.3, mod_python 3.3.1, python 2.4.4
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> --Mike
</I>&gt;&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;&gt;<i> Mod_python mailing list
</I>&gt;&gt;&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;&gt;&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mod_python mailing list
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I>&gt;<i>
</I></PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="025847.html">[mod_python] ioerrors with worker thread mpm
</A></li>
	<LI>Next message: <A HREF="025849.html">[mod_python] ioerrors with worker thread mpm
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25848">[ date ]</a>
              <a href="thread.html#25848">[ thread ]</a>
              <a href="subject.html#25848">[ subject ]</a>
              <a href="author.html#25848">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
