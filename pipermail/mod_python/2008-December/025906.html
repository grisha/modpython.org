<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] mod_rewrite and publisher
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20mod_rewrite%20and%20publisher&In-Reply-To=a595de7a0812301745u2f3c414dhf6a7958a3f038383%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025905.html">
   <LINK REL="Next"  HREF="025907.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] mod_rewrite and publisher</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20mod_rewrite%20and%20publisher&In-Reply-To=a595de7a0812301745u2f3c414dhf6a7958a3f038383%40mail.gmail.com"
       TITLE="[mod_python] mod_rewrite and publisher">graham.dumpleton at gmail.com
       </A><BR>
    <I>Tue Dec 30 21:48:34 EST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="025905.html">[mod_python] mod_rewrite and publisher
</A></li>
        <LI>Next message: <A HREF="025907.html">[mod_python] mod_rewrite and publisher
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25906">[ date ]</a>
              <a href="thread.html#25906">[ thread ]</a>
              <a href="subject.html#25906">[ subject ]</a>
              <a href="author.html#25906">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Log values of:

  req.filename
  req.uri
  req.path_info
  req.args

In the handler and post so can see better what you are saying is
getting passed to it.

Unless you are saying publisher isn't getting the request at all.

Graham

2008/12/31 Clodoaldo Pinto Neto &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">clodoaldo.pinto.neto at gmail.com</A>&gt;:
&gt;<i> I'm working on an old mod_python-publisher site. I'm changing the
</I>&gt;<i> current query string parameters to dynamic urls using mod_rewrite
</I>&gt;<i> inside a virtual host.
</I>&gt;<i>
</I>&gt;<i>    &lt;Directory /var/www/html/example.com&gt;
</I>&gt;<i>       SetHandler mod_python
</I>&gt;<i>       PythonHandler /home/example/mod/_publisher.py
</I>&gt;<i>       PythonOption mod_python.importer.path &quot;['/home/example/mod']&quot;
</I>&gt;<i>       PythonFixupHandler /home/example/mod/_upload_limit.py
</I>&gt;<i>    &lt;/Directory&gt;
</I>&gt;<i>
</I>&gt;<i>    RewriteLog /var/log/httpd/example.com-rewrite.log
</I>&gt;<i>    RewriteLogLevel 9
</I>&gt;<i>    RewriteEngine on
</I>&gt;<i>    RewriteRule ^/pub/.* - [L]
</I>&gt;<i>    RewriteRule ^/$ /index.py [L]
</I>&gt;<i>    RewriteRule ^/(.*?)/?$ /$1/
</I>&gt;<i>    RewriteRule ^(/(a|b|c))?([/\w]+?)(/(\d+))?/$ $3/?tv=$2&amp;pagina=$5 [NC]
</I>&gt;<i>    RewriteRule ^([/\w]*?)(/(x|y|z))?(/(\w+?))?(/(\w+?))?/$ \
</I>&gt;<i> $1/?uf=$3&amp;localidade=$5&amp;bairro=$7 [QSA,NC]
</I>&gt;<i>    RewriteRule ^(/(\w+))?(/(\w+))?/$ /?marca=$2&amp;modelo=$4 [QSA]
</I>&gt;<i>    RewriteRule ^/$ /index.py [QSA,L]
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> The rewrite is working as expected. The problem i have is the
</I>&gt;<i> publisher doing its own rewrite (is it?) after the one above using the
</I>&gt;<i> original uri not the rewrote one.
</I>&gt;<i>
</I>&gt;<i> rewrite log:
</I>&gt;<i>
</I>&gt;<i> 10.1.1.101 - - [30/Dec/2008:23:28:45 --0200]
</I>&gt;<i> [example.dkt/sid#b94e66e0][rid#bedec338/initial] (3) split
</I>&gt;<i> uri=/?marca=&amp;modelo= -&gt; uri=/,
</I>&gt;<i> args=marca=&amp;modelo=&amp;uf=DF&amp;localidade=Sao_Paulo&amp;bairro=&amp;tv=a&amp;pagina=2
</I>&gt;<i> 10.1.1.101 - - [30/Dec/2008:23:28:45 --0200]
</I>&gt;<i> [example.dkt/sid#b94e66e0][rid#bedec338/initial] (3) applying pattern
</I>&gt;<i> '^/$' to uri '/'
</I>&gt;<i> 10.1.1.101 - - [30/Dec/2008:23:28:45 --0200]
</I>&gt;<i> [example.dkt/sid#b94e66e0][rid#bedec338/initial] (2) rewrite '/' -&gt;
</I>&gt;<i> '/index.py'
</I>&gt;<i> 10.1.1.101 - - [30/Dec/2008:23:28:45 --0200]
</I>&gt;<i> [example.dkt/sid#b94e66e0][rid#bedec338/initial] (2) local path
</I>&gt;<i> result: /index.py
</I>&gt;<i> 10.1.1.101 - - [30/Dec/2008:23:28:45 --0200]
</I>&gt;<i> [example.dkt/sid#b94e66e0][rid#bedec338/initial] (2) prefixed with
</I>&gt;<i> document_root to /var/www/html/example.com/index.py
</I>&gt;<i> 10.1.1.101 - - [30/Dec/2008:23:28:45 --0200]
</I>&gt;<i> [example.dkt/sid#b94e66e0][rid#bedec338/initial] (1) go-ahead with
</I>&gt;<i> /var/www/html/example.com/index.py [OK]
</I>&gt;<i>
</I>&gt;<i> Then the publisher gets from there with the original uri:
</I>&gt;<i>
</I>&gt;<i> 10.1.1.101 - - [30/Dec/2008:23:28:45 --0200]
</I>&gt;<i> [example.dkt/sid#b94e66e0][rid#beac0170/initial] (2) init rewrite
</I>&gt;<i> engine with requested uri /a/DF/Sao_Paulo/
</I>&gt;<i>
</I>&gt;<i> How to make the publisher use the rewrote uri? Or what am i missing
</I>&gt;<i> and should be doing?
</I>&gt;<i>
</I>&gt;<i> _publisher.py:
</I>&gt;<i>
</I>&gt;<i> from mod_python import publisher
</I>&gt;<i> from os.path import basename
</I>&gt;<i>
</I>&gt;<i> def handler(req):
</I>&gt;<i>   req.add_output_filter('DEFLATE')
</I>&gt;<i>   if basename(req.filename) == 'index.py':
</I>&gt;<i>      req.uri = '/'
</I>&gt;<i>   return publisher.handler(req)
</I>&gt;<i>
</I>&gt;<i> Regards, Clodoaldo
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mod_python mailing list
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I>&gt;<i>
</I></PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="025905.html">[mod_python] mod_rewrite and publisher
</A></li>
	<LI>Next message: <A HREF="025907.html">[mod_python] mod_rewrite and publisher
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25906">[ date ]</a>
              <a href="thread.html#25906">[ thread ]</a>
              <a href="subject.html#25906">[ subject ]</a>
              <a href="author.html#25906">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
