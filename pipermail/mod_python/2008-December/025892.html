<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Apache/mod_python: Registering a request handler
	dynamically
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Apache/mod_python%3A%20Registering%20a%20request%20handler%0A%09dynamically&In-Reply-To=1230498837.26523.11.camel%40localhost">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025891.html">
   <LINK REL="Next"  HREF="025893.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Apache/mod_python: Registering a request handler
	dynamically</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Apache/mod_python%3A%20Registering%20a%20request%20handler%0A%09dynamically&In-Reply-To=1230498837.26523.11.camel%40localhost"
       TITLE="[mod_python] Apache/mod_python: Registering a request handler
	dynamically">graham.dumpleton at gmail.com
       </A><BR>
    <I>Sun Dec 28 16:34:21 EST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="025891.html">[mod_python] Apache/mod_python: Registering a request handler
	dynamically
</A></li>
        <LI>Next message: <A HREF="025893.html">[mod_python] Apache/mod_python: Registering a request handler
	dynamically
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25892">[ date ]</a>
              <a href="thread.html#25892">[ thread ]</a>
              <a href="subject.html#25892">[ subject ]</a>
              <a href="author.html#25892">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>2008/12/29 Samuel Abels &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">newsgroups at debain.org</A>&gt;:
&gt;<i> (I also sent this to comp.lang.python before realizing that this list is
</I>&gt;<i> the better place, so apologies if you got this message twice.)
</I>&gt;<i>
</I>&gt;<i> Hi,
</I>&gt;<i>
</I>&gt;<i> Is there a way to dynamically overwrite the request handler from within
</I>&gt;<i> mod_python scripts? Something along those lines:
</I>&gt;<i>
</I>&gt;<i> ---------------
</I>&gt;<i> from mod_python import apache
</I>&gt;<i>
</I>&gt;<i> def myhandler(request):
</I>&gt;<i>    request.content_type = 'text/plain'
</I>&gt;<i>    request.write('Hello world')
</I>&gt;<i>
</I>&gt;<i> apache.set_default_handler(myhandler)
</I>&gt;<i> ---------------
</I>&gt;<i>
</I>&gt;<i> I specifically want to avoid changing the Apache directive, as this code
</I>&gt;<i> is supposed to function regardless of whether the user has access to
</I>&gt;<i> change the Apache directive.
</I>&gt;<i>
</I>&gt;<i> The reason is that I am trying to hide the difference between different
</I>&gt;<i> environments (such as mod_python or CGI) from the developer, such that
</I>&gt;<i> the following is possible:
</I>&gt;<i>
</I>&gt;<i> ---------------
</I>&gt;<i> #!/usr/bin/python
</I>&gt;<i> import os, os.path
</I>&gt;<i> os.chdir(os.path.dirname(__file__))
</I>&gt;<i> from PleaseHideMyEnvironment import RequestHandler
</I>&gt;<i>
</I>&gt;<i> def index(request):
</I>&gt;<i>    # Note that the request argument here is one created by
</I>&gt;<i>    # the PleaseHideMyEnvironment module, not a mod_python one.
</I>&gt;<i>    request.write('Hello World')
</I>&gt;<i>
</I>&gt;<i> RequestHandler(index)
</I>&gt;<i> ---------------
</I>&gt;<i>
</I>&gt;<i> So at the time at which RequestHandler() is created, I need a way to
</I>&gt;<i> make sure that mod_python calls to the RequestHandler instead of the
</I>&gt;<i> normal handler, whenever a new request is made.
</I>&gt;<i>
</I>&gt;<i> Any idea?
</I>
Are you saying you want one script to be able to work under either CGI
or mod_python? If you are then I would recommend you use WSGI instead
as WSGI interface is specifically designed to be used across multiple
hosting mechanisms.

For example, presuming I got last bit right, the following would work
with mod_wsgi or CGI as written:

#!/usr/bin/env python

def application(environ, start_response):
    status = '200 OK'
    output = 'Hello World!'

    response_headers = [('Content-type', 'text/plain'),
                        ('Content-Length', str(len(output)))]
    start_response(status, response_headers)

    return [output]

if __name__ == &quot;__main__&quot;:
    import wsgiref.handlers
    wsgiref.handlers.CGIHandler().run(application)

The CGI handler only gets triggered if script executed. In mod_wsgi it
loads file and then calls direct to 'application'.

The application object could also be plugged into many other WSGI
compliant hosting solutions as well. There are even WSGI adapters out
there for mod_python, although if you go the WSGI way, you are better
off using mod_wsgi instead.

So, go read up about WSGI instead, it is a better long term solution
as not tied to a specific hosting mechanism.

Graham
</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="025891.html">[mod_python] Apache/mod_python: Registering a request handler
	dynamically
</A></li>
	<LI>Next message: <A HREF="025893.html">[mod_python] Apache/mod_python: Registering a request handler
	dynamically
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25892">[ date ]</a>
              <a href="thread.html#25892">[ thread ]</a>
              <a href="subject.html#25892">[ subject ]</a>
              <a href="author.html#25892">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
