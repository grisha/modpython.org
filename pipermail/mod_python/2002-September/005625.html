<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Mod_python and Sub-Interpreter segregation
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Mod_python%20and%20Sub-Interpreter%20segregation&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="005632.html">
   <LINK REL="Next"  HREF="005626.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Mod_python and Sub-Interpreter segregation</H1>
    <B>Bryan Mongeau</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Mod_python%20and%20Sub-Interpreter%20segregation&In-Reply-To="
       TITLE="[mod_python] Mod_python and Sub-Interpreter segregation">bryan at eevolved.com
       </A><BR>
    <I>Fri Sep 13 17:11:22 EST 2002</I>
    <P><UL>
        <LI>Previous message: <A HREF="005632.html">[mod_python] Mod_python and Sub-Interpreter segregation
</A></li>
        <LI>Next message: <A HREF="005626.html">[mod_python] Mod_python and Sub-Interpreter segregation
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5625">[ date ]</a>
              <a href="thread.html#5625">[ thread ]</a>
              <a href="subject.html#5625">[ subject ]</a>
              <a href="author.html#5625">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<table border=0 width="100%"><tr><td>
<!--beginarticle-->
<PRE>Greetings,

I've been playing around with mod_python and have noticed a peculiar behaviour 
that perhaps someone could explain to me.  As the mod_python documentation 
explains, a sub-interpreter is created for each virtual host (default).  I 
therefore expected global variables within this sub-interpreter to be able to 
maintain state between hits.  I created a simple script ( included below ) to 
observe this behaviour by counting hits in a global variable and printing the 
interpreter name.

To my surprise, it seems as if different apache child processes run their 
python code in different sub-interpreters even though the interpreter name 
remains the same ( virtualhost ). I produced this behaviour by loading the 
script in my browser and refreshing (very) rapidly. What happens is the hit 
counter eventually returns to zero, meaning that the global variable is no 
longer in the namespace. Repeated refreshing causes the hit counter to jump 
all over the place as I presume it jumps from one apache child process to 
another, each having their own sub-interpreters and global variables.

It seems as if each child process has its own sub-interpreter? Or am I 
confused? Was this documented? Enlightenment is greatly appreciated. 
Unfortunately the behaviour I am observing is undesired.

Here is the code to demonstrate:

from mod_python import apache
def handler(req):
    try:
        globals()['hits']+=1
    except KeyError:
        globals()['hits'] = 0
    req.write(&quot;interpreter_name=&quot; + req.interpreter )
    req.write(&quot; - hits: &quot; + str(globals()['hits']))
    return apache.OK
-- 
Bryan Mongeau
eEvolved Inc. - IT Consulting &amp; Custom Software
<A HREF="http://eevolved.com/">http://eevolved.com/</A>
--
&quot;The true function of life, that which is being maximized in the natural 
world, is DNA survival. But DNA is not floating free; it is locked up in 
living bodies and it has made the most of the levers of power at its 
disposal.&quot; -- Richard Dawkins


</PRE>
<!--endarticle-->
</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="005632.html">[mod_python] Mod_python and Sub-Interpreter segregation
</A></li>
	<LI>Next message: <A HREF="005626.html">[mod_python] Mod_python and Sub-Interpreter segregation
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5625">[ date ]</a>
              <a href="thread.html#5625">[ thread ]</a>
              <a href="subject.html#5625">[ subject ]</a>
              <a href="author.html#5625">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
