<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Mod_python and Sub-Interpreter segregation
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Mod_python%20and%20Sub-Interpreter%20segregation&In-Reply-To=200209131711.22854.bryan%40eevolved.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="013019.html">
   <LINK REL="Next"  HREF="013023.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Mod_python and Sub-Interpreter segregation</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Brian Hawthorne</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Mod_python%20and%20Sub-Interpreter%20segregation&In-Reply-To=200209131711.22854.bryan%40eevolved.com"
       TITLE="[mod_python] Mod_python and Sub-Interpreter segregation">brianh at exelixis.com
       </A><BR>
    <I>Fri Sep 13 14:28:37 EST 2002</I>
    <P><UL>
        <LI>Previous message: <A HREF="013019.html">[mod_python] Mod_python and Sub-Interpreter segregation
</A></li>
        <LI>Next message: <A HREF="013023.html">[mod_python] Mod_python and Sub-Interpreter segregation
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13020">[ date ]</a>
              <a href="thread.html#13020">[ thread ]</a>
              <a href="subject.html#13020">[ subject ]</a>
              <a href="author.html#13020">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>unfortunately, there is no way to share global data among multiple
apache child processes without using an external database of some sort.
this is true regardless of how many interpreters you have in each child
proc.  i anticipate that the multithreaded server model available in
apache2 will address this issue, though i haven't gotten my hands dirty
yet trying to set up modpy3 alpha with apache2.

brian hawthorne
-bioinformatics,
Exelixis, Inc.


On Fri, 13 Sep 2002, Bryan Mongeau wrote:

&gt;<i> Greetings,
</I>&gt;<i> 
</I>&gt;<i> I've been playing around with mod_python and have noticed a peculiar behaviour 
</I>&gt;<i> that perhaps someone could explain to me.  As the mod_python documentation 
</I>&gt;<i> explains, a sub-interpreter is created for each virtual host (default).  I 
</I>&gt;<i> therefore expected global variables within this sub-interpreter to be able to 
</I>&gt;<i> maintain state between hits.  I created a simple script ( included below ) to 
</I>&gt;<i> observe this behaviour by counting hits in a global variable and printing the 
</I>&gt;<i> interpreter name.
</I>&gt;<i> 
</I>&gt;<i> To my surprise, it seems as if different apache child processes run their 
</I>&gt;<i> python code in different sub-interpreters even though the interpreter name 
</I>&gt;<i> remains the same ( virtualhost ). I produced this behaviour by loading the 
</I>&gt;<i> script in my browser and refreshing (very) rapidly. What happens is the hit 
</I>&gt;<i> counter eventually returns to zero, meaning that the global variable is no 
</I>&gt;<i> longer in the namespace. Repeated refreshing causes the hit counter to jump 
</I>&gt;<i> all over the place as I presume it jumps from one apache child process to 
</I>&gt;<i> another, each having their own sub-interpreters and global variables.
</I>&gt;<i> 
</I>&gt;<i> It seems as if each child process has its own sub-interpreter? Or am I 
</I>&gt;<i> confused? Was this documented? Enlightenment is greatly appreciated. 
</I>&gt;<i> Unfortunately the behaviour I am observing is undesired.
</I>&gt;<i> 
</I>&gt;<i> Here is the code to demonstrate:
</I>&gt;<i> 
</I>&gt;<i> from mod_python import apache
</I>&gt;<i> def handler(req):
</I>&gt;<i>     try:
</I>&gt;<i>         globals()['hits']+=1
</I>&gt;<i>     except KeyError:
</I>&gt;<i>         globals()['hits'] = 0
</I>&gt;<i>     req.write(&quot;interpreter_name=&quot; + req.interpreter )
</I>&gt;<i>     req.write(&quot; - hits: &quot; + str(globals()['hits']))
</I>&gt;<i>     return apache.OK
</I>&gt;<i> -- 
</I>&gt;<i> Bryan Mongeau
</I>&gt;<i> eEvolved Inc. - IT Consulting &amp; Custom Software
</I>&gt;<i> <A HREF="http://eevolved.com/">http://eevolved.com/</A>
</I>&gt;<i> --
</I>&gt;<i> &quot;The true function of life, that which is being maximized in the natural 
</I>&gt;<i> world, is DNA survival. But DNA is not floating free; it is locked up in 
</I>&gt;<i> living bodies and it has made the most of the levers of power at its 
</I>&gt;<i> disposal.&quot; -- Richard Dawkins
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mod_python mailing list
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;<i> <A HREF="http://www.modpython.org/mailman/listinfo/mod_python">http://www.modpython.org/mailman/listinfo/mod_python</A>
</I>&gt;<i> 
</I>

</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="013019.html">[mod_python] Mod_python and Sub-Interpreter segregation
</A></li>
	<LI>Next message: <A HREF="013023.html">[mod_python] Mod_python and Sub-Interpreter segregation
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13020">[ date ]</a>
              <a href="thread.html#13020">[ thread ]</a>
              <a href="subject.html#13020">[ subject ]</a>
              <a href="author.html#13020">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
