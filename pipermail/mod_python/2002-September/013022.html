<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Mod_python and Sub-Interpreter segregation
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Mod_python%20and%20Sub-Interpreter%20segregation&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="013023.html">
   <LINK REL="Next"  HREF="013024.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Mod_python and Sub-Interpreter segregation</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Michael C. Neel</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Mod_python%20and%20Sub-Interpreter%20segregation&In-Reply-To="
       TITLE="[mod_python] Mod_python and Sub-Interpreter segregation">neel at mediapulse.com
       </A><BR>
    <I>Fri Sep 13 17:40:42 EST 2002</I>
    <P><UL>
        <LI>Previous message: <A HREF="013023.html">[mod_python] Mod_python and Sub-Interpreter segregation
</A></li>
        <LI>Next message: <A HREF="013024.html">[mod_python] Mod_python and Sub-Interpreter segregation
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13022">[ date ]</a>
              <a href="thread.html#13022">[ thread ]</a>
              <a href="subject.html#13022">[ subject ]</a>
              <a href="author.html#13022">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I don't think this will work in apache2 either, based on my limited
experience.

Apache2 threaded still has separate processes (children) along with
threads.  You can either have a fixed number of processes, and let the
threads grow and shrink, or have a fixed number of threads per process
and add more processes as needed.

While this will help with resource pooling, you'll still need an outside
database to have a global variable.  Now with apache2's cgid (a process
to handle all cgi scripts since forking a 75 thread apache child would
be, um, bad) there might be something you can do there, but then that
means you app is a CGI and we don't use that word in 2002 anymore...

Mike 

--
Michael C. Neel
There are only 10 types of people in the world;
those who understand binary and those who don't.


-----Original Message-----
From: Brian Hawthorne [mailto:<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">brianh at exelixis.com</A>] 
Sent: Friday, September 13, 2002 5:29 PM
To: Bryan Mongeau
Cc: <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">mod_python at modpython.org</A>
Subject: Re: [mod_python] Mod_python and Sub-Interpreter segregation


unfortunately, there is no way to share global data among multiple
apache child processes without using an external database of some sort.
this is true regardless of how many interpreters you have in each child
proc.  i anticipate that the multithreaded server model available in
apache2 will address this issue, though i haven't gotten my hands dirty
yet trying to set up modpy3 alpha with apache2.

brian hawthorne
-bioinformatics,
Exelixis, Inc.


On Fri, 13 Sep 2002, Bryan Mongeau wrote:

&gt;<i> Greetings,
</I>&gt;<i> 
</I>&gt;<i> I've been playing around with mod_python and have noticed a peculiar
</I>behaviour 
&gt;<i> that perhaps someone could explain to me.  As the mod_python
</I>documentation 
&gt;<i> explains, a sub-interpreter is created for each virtual host
</I>(default).  I 
&gt;<i> therefore expected global variables within this sub-interpreter to be
</I>able to 
&gt;<i> maintain state between hits.  I created a simple script ( included
</I>below ) to 
&gt;<i> observe this behaviour by counting hits in a global variable and
</I>printing the 
&gt;<i> interpreter name.
</I>&gt;<i> 
</I>&gt;<i> To my surprise, it seems as if different apache child processes run
</I>their 
&gt;<i> python code in different sub-interpreters even though the interpreter
</I>name 
&gt;<i> remains the same ( virtualhost ). I produced this behaviour by loading
</I>the 
&gt;<i> script in my browser and refreshing (very) rapidly. What happens is
</I>the hit 
&gt;<i> counter eventually returns to zero, meaning that the global variable
</I>is no 
&gt;<i> longer in the namespace. Repeated refreshing causes the hit counter to
</I>jump 
&gt;<i> all over the place as I presume it jumps from one apache child process
</I>to 
&gt;<i> another, each having their own sub-interpreters and global variables.
</I>&gt;<i> 
</I>&gt;<i> It seems as if each child process has its own sub-interpreter? Or am I
</I>
&gt;<i> confused? Was this documented? Enlightenment is greatly appreciated. 
</I>&gt;<i> Unfortunately the behaviour I am observing is undesired.
</I>&gt;<i> 
</I>&gt;<i> Here is the code to demonstrate:
</I>&gt;<i> 
</I>&gt;<i> from mod_python import apache
</I>&gt;<i> def handler(req):
</I>&gt;<i>     try:
</I>&gt;<i>         globals()['hits']+=1
</I>&gt;<i>     except KeyError:
</I>&gt;<i>         globals()['hits'] = 0
</I>&gt;<i>     req.write(&quot;interpreter_name=&quot; + req.interpreter )
</I>&gt;<i>     req.write(&quot; - hits: &quot; + str(globals()['hits']))
</I>&gt;<i>     return apache.OK
</I>&gt;<i> -- 
</I>&gt;<i> Bryan Mongeau
</I>&gt;<i> eEvolved Inc. - IT Consulting &amp; Custom Software
</I>&gt;<i> <A HREF="http://eevolved.com/">http://eevolved.com/</A>
</I>&gt;<i> --
</I>&gt;<i> &quot;The true function of life, that which is being maximized in the
</I>natural 
&gt;<i> world, is DNA survival. But DNA is not floating free; it is locked up
</I>in 
&gt;<i> living bodies and it has made the most of the levers of power at its 
</I>&gt;<i> disposal.&quot; -- Richard Dawkins
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mod_python mailing list
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;<i> <A HREF="http://www.modpython.org/mailman/listinfo/mod_python">http://www.modpython.org/mailman/listinfo/mod_python</A>
</I>&gt;<i> 
</I>
_______________________________________________
Mod_python mailing list
<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
<A HREF="http://www.modpython.org/mailman/listinfo/mod_python">http://www.modpython.org/mailman/listinfo/mod_python</A>


</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="013023.html">[mod_python] Mod_python and Sub-Interpreter segregation
</A></li>
	<LI>Next message: <A HREF="013024.html">[mod_python] Mod_python and Sub-Interpreter segregation
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13022">[ date ]</a>
              <a href="thread.html#13022">[ thread ]</a>
              <a href="subject.html#13022">[ subject ]</a>
              <a href="author.html#13022">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
