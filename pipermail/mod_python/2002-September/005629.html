<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Mod_python and Sub-Interpreter segregation
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Mod_python%20and%20Sub-Interpreter%20segregation&In-Reply-To=200209131711.22854.bryan%40eevolved.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="005626.html">
   <LINK REL="Next"  HREF="005628.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Mod_python and Sub-Interpreter segregation</H1>
    <B>Jeff Davis</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Mod_python%20and%20Sub-Interpreter%20segregation&In-Reply-To=200209131711.22854.bryan%40eevolved.com"
       TITLE="[mod_python] Mod_python and Sub-Interpreter segregation">list-mod_python at empires.org
       </A><BR>
    <I>Fri Sep 13 14:48:57 EST 2002</I>
    <P><UL>
        <LI>Previous message: <A HREF="005626.html">[mod_python] Mod_python and Sub-Interpreter segregation
</A></li>
        <LI>Next message: <A HREF="005628.html">[mod_python] Mod_python and Sub-Interpreter segregation
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5629">[ date ]</a>
              <a href="thread.html#5629">[ thread ]</a>
              <a href="subject.html#5629">[ subject ]</a>
              <a href="author.html#5629">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<table border=0 width="100%"><tr><td>
<!--beginarticle-->
<PRE>Hi,

The only way I know of that an interpreter can be shared is if you have a 
multithreaded app.

I think that's possible because it seems to me that python does well with 
threads. That way, each request could execute in it's own interpreter 
function call, and that way they'd be separate, but allow you to share global 
variables. However, that seems like it might be a little tricky, so I am not 
sure how feasible it is. Also note that the data wouldn't survive an apache 
restart.

However, to have the one-process-many-threads per virtualhost in apache2, you 
need to use mpm perchild. That mpm isn't really stable, so you might need to 
wait a while.

You might consider a lightweigtht DB or a RAM based filesystem or something in 
the interim. Or, if you wanted a featureful database you could use postgresql 
and persistant connections and it would still operate at a pretty good speed, 
which could be a good idea if you need to use a database for your application 
anyway.

Regards,
	Jeff

On Friday 13 September 2002 10:11 am, Bryan Mongeau wrote:
&gt;<i> Greetings,
</I>&gt;<i>
</I>&gt;<i> I've been playing around with mod_python and have noticed a peculiar
</I>&gt;<i> behaviour that perhaps someone could explain to me.  As the mod_python
</I>&gt;<i> documentation explains, a sub-interpreter is created for each virtual host
</I>&gt;<i> (default).  I therefore expected global variables within this
</I>&gt;<i> sub-interpreter to be able to maintain state between hits.  I created a
</I>&gt;<i> simple script ( included below ) to observe this behaviour by counting hits
</I>&gt;<i> in a global variable and printing the interpreter name.
</I>&gt;<i>
</I>&gt;<i> To my surprise, it seems as if different apache child processes run their
</I>&gt;<i> python code in different sub-interpreters even though the interpreter name
</I>&gt;<i> remains the same ( virtualhost ). I produced this behaviour by loading the
</I>&gt;<i> script in my browser and refreshing (very) rapidly. What happens is the hit
</I>&gt;<i> counter eventually returns to zero, meaning that the global variable is no
</I>&gt;<i> longer in the namespace. Repeated refreshing causes the hit counter to jump
</I>&gt;<i> all over the place as I presume it jumps from one apache child process to
</I>&gt;<i> another, each having their own sub-interpreters and global variables.
</I>&gt;<i>
</I>&gt;<i> It seems as if each child process has its own sub-interpreter? Or am I
</I>&gt;<i> confused? Was this documented? Enlightenment is greatly appreciated.
</I>&gt;<i> Unfortunately the behaviour I am observing is undesired.
</I>&gt;<i>
</I>&gt;<i> Here is the code to demonstrate:
</I>&gt;<i>
</I>&gt;<i> from mod_python import apache
</I>&gt;<i> def handler(req):
</I>&gt;<i>     try:
</I>&gt;<i>         globals()['hits']+=1
</I>&gt;<i>     except KeyError:
</I>&gt;<i>         globals()['hits'] = 0
</I>&gt;<i>     req.write(&quot;interpreter_name=&quot; + req.interpreter )
</I>&gt;<i>     req.write(&quot; - hits: &quot; + str(globals()['hits']))
</I>&gt;<i>     return apache.OK
</I>

</PRE>
<!--endarticle-->
</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="005626.html">[mod_python] Mod_python and Sub-Interpreter segregation
</A></li>
	<LI>Next message: <A HREF="005628.html">[mod_python] Mod_python and Sub-Interpreter segregation
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5629">[ date ]</a>
              <a href="thread.html#5629">[ thread ]</a>
              <a href="subject.html#5629">[ subject ]</a>
              <a href="author.html#5629">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
