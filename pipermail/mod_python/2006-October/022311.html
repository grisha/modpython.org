<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Multiple call to Session.Session(req) problem
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Multiple%20call%20to%20Session.Session%28req%29%20problem&In-Reply-To=778770d80610130735i122ca20dwa0284611bde910cb%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022309.html">
   <LINK REL="Next"  HREF="022313.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Multiple call to Session.Session(req) problem</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Jim Gallacher</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Multiple%20call%20to%20Session.Session%28req%29%20problem&In-Reply-To=778770d80610130735i122ca20dwa0284611bde910cb%40mail.gmail.com"
       TITLE="[mod_python] Multiple call to Session.Session(req) problem">jpg at jgassociates.ca
       </A><BR>
    <I>Fri Oct 13 11:16:01 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="022309.html">[mod_python] Multiple call to Session.Session(req) problem
</A></li>
        <LI>Next message: <A HREF="022313.html">[mod_python] Multiple call to Session.Session(req) problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22311">[ date ]</a>
              <a href="thread.html#22311">[ thread ]</a>
              <a href="subject.html#22311">[ subject ]</a>
              <a href="author.html#22311">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Alex Greif wrote:
&gt;<i> Hi,
</I>&gt;<i> 
</I>&gt;<i> I have the problem that getting the session instance in a handler more
</I>&gt;<i> than once makes the server hang on the second access to the session.
</I>&gt;<i> the problem does ot occure on windows XP but on suse Linux with 3.2.10
</I>&gt;<i> 
</I>&gt;<i> Here is my scenario:
</I>&gt;<i> 
</I>&gt;<i> def view_ticket_detail(req, ticketId):
</I>&gt;<i>    def __access__(req, user):
</I>&gt;<i>        ...
</I>&gt;<i>        # webutil.authorize will get the session
</I>&gt;<i>        return webutil.authorize(req=req, login=user, neededRole=neededRole)
</I>&gt;<i> 
</I>&gt;<i>    req.content_type = &quot;text/html&quot;
</I>&gt;<i>    ...
</I>&gt;<i>    # now I need the session again
</I>&gt;<i>    session = Session.MemorySession(req) ###### &lt;-- here the server hangs
</I>&gt;<i> 
</I>&gt;<i> any ideas?
</I>
Yep. You've deadlock the session. You can't have more than one session 
instance in the same request.

Put your session in the req object within your webutil.authroize() code, 
and when you need it later retrieve it from there.

webutil.py
==========

def authorize(req):
     req.session = Session.MemorySession(req)
     ...

And in when you need it later:

def view_ticket_detail(req, ticketId):
    def __access__(req, user):
        ...
        # webutil.authorize will get the session
        return webutil.authorize(req=req, login=user, neededRole=neededRole)

    req.content_type = &quot;text/html&quot;
    ...
    # now I need the session again
    session = req.session


Jim
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="022309.html">[mod_python] Multiple call to Session.Session(req) problem
</A></li>
	<LI>Next message: <A HREF="022313.html">[mod_python] Multiple call to Session.Session(req) problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22311">[ date ]</a>
              <a href="thread.html#22311">[ thread ]</a>
              <a href="subject.html#22311">[ subject ]</a>
              <a href="author.html#22311">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
