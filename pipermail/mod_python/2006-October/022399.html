<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] util.FieldStorage
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20util.FieldStorage&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022405.html">
   <LINK REL="Next"  HREF="022404.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] util.FieldStorage</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20util.FieldStorage&In-Reply-To="
       TITLE="[mod_python] util.FieldStorage">grahamd at dscpl.com.au
       </A><BR>
    <I>Thu Oct 26 19:08:13 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="022405.html">[mod_python] myghty.session with Python2.2
</A></li>
        <LI>Next message: <A HREF="022404.html">[mod_python] util.FieldStorage
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22399">[ date ]</a>
              <a href="thread.html#22399">[ thread ]</a>
              <a href="subject.html#22399">[ subject ]</a>
              <a href="author.html#22399">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Brian Bird wrote ..
&gt;<i> Hmm, good question. The term &quot;dictionary-like&quot; doesn't actually have a
</I>&gt;<i> definitive meaning does it?
</I>&gt;<i> 
</I>&gt;<i> In my case, the methods I was expecting to find were:
</I>&gt;<i> __getitem__, __setitem__, __delitem__, get, has_key, items, keys,
</I>&gt;<i> setdefault, update, values
</I>
The issue with __setitem__() is whether it should be additive or whether it
should replace. The current add_field() member in 3.3 is additive. That is, if
a value for that key is already there, it adds an extra value against the key
rather than replacing any existing value. In Trac &lt; 0.10.0 from memory they
provided their own __setitem__() in a derived version of the class which
effectively did what add_field() did, ie., it was additive, which isn't what
many would expect of a dictionary. For __delitem__() only choice is too
delete all values associated with a key, not way to delete one value although
one has to question why you might anyway. For setdefault(), second argument
to get() achieves same outcome.

The main question then is how would people expect __setitem__() to
behave?

Graham

&gt;<i> However, if util.FieldStorage is meant to be &quot;treated like a dictionary&quot;
</I>&gt;<i> then I can imagine when someone will expect all the other methods too.
</I>&gt;<i> 
</I>&gt;<i> This makes me think that if FieldStorage is going to contain some kind
</I>&gt;<i> of internal dictionary to store the actual data, perhaps these other
</I>&gt;<i> dict methods should be called directly on it: ie.
</I>&gt;<i> 
</I>&gt;<i> def __getattr__(self, attr):
</I>&gt;<i>     return getattr(self.dictionary, attr)
</I>&gt;<i> 
</I>&gt;<i> or possibly it could be re-written to inherit from dict directly?
</I>&gt;<i> 
</I>&gt;<i> If this is going to become a pain though, I'll live with the
</I>&gt;<i> inconvenience in my code of swapping between objects when necessary :-)
</I>&gt;<i> 
</I>&gt;<i> Brian
</I>&gt;<i> 
</I>&gt;<i> &gt; -----Original Message-----
</I>&gt;<i> &gt; From: Graham Dumpleton [mailto:<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">grahamd at dscpl.com.au</A>]
</I>&gt;<i> &gt; Sent: 26 October 2006 12:48
</I>&gt;<i> &gt; To: Brian Bird
</I>&gt;<i> &gt; Cc: <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">mod_python at modpython.org</A>
</I>&gt;<i> &gt; Subject: Re: [mod_python] util.FieldStorage
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Yes, but how dictionary like is the issue that I don't see anyone
</I>&gt;<i> giving
</I>&gt;<i> &gt; an answer for. Ie., out  of:
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt;  &gt;&gt;&gt; dir({})
</I>&gt;<i> &gt; ['__class__', '__cmp__', '__contains__', '__delattr__',
</I>&gt;<i> &gt; '__delitem__', '__doc__', '__eq__', '__ge__', '__getattribute__',
</I>&gt;<i> &gt; '__getitem__', '__gt__', '__hash__', '__init__', '__iter__',
</I>&gt;<i> &gt; '__le__', '__len__', '__lt__', '__ne__', '__new__', '__reduce__',
</I>&gt;<i> &gt; '__reduce_ex__', '__repr__', '__setattr__', '__setitem__', '__str__',
</I>&gt;<i> &gt; 'clear', 'copy', 'fromkeys', 'get', 'has_key', 'items', 'iteritems',
</I>&gt;<i> &gt; 'iterkeys', 'itervalues', 'keys', 'pop', 'popitem', 'setdefault',
</I>&gt;<i> &gt; 'update', 'values']
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; what do you expect to be provided and work? Not all of them make
</I>&gt;<i> &gt; sense. Knowing which you think should work would be helpful.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; I'd probably hold off trying to work out any patches yourself. The
</I>&gt;<i> more
</I>&gt;<i> &gt; I look at FieldStorage the less I understand why some of the changes
</I>&gt;<i> &gt; were made. I'm not talking about how a dictionary based index was
</I>&gt;<i> &gt; added, but more how some of the code was shifted around when it
</I>&gt;<i> &gt; probably didn't need to, with the result being that the code then
</I>&gt;<i> became
</I>&gt;<i> &gt; incompatible with versions of Trac which were out at the time. It
</I>&gt;<i> would
</I>&gt;<i> &gt; not have been that hard to maintain compatibility with Trac and still
</I>&gt;<i> &gt; get
</I>&gt;<i> &gt; the desired gains they were after. I can see myself therefore doing a
</I>&gt;<i> &gt; bit
</I>&gt;<i> &gt; or reorganisation of the code to fix the identified issue, but also
</I>&gt;<i> &gt; reinstate
</I>&gt;<i> &gt; Trac compatibility.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Graham
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; On 26/10/2006, at 9:32 PM, Brian Bird wrote:
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; &gt; The benefit of being more dictionary-like is just convenience. As
</I>&gt;<i> &gt; &gt; util.FieldStorage doesn't have all the dictionary methods then I
</I>&gt;<i> &gt; &gt; usually
</I>&gt;<i> &gt; &gt; just convert it to a real dictionary.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; However, I'd like to also keep the getfirst and getlist methods,
</I>&gt;<i> which
</I>&gt;<i> &gt; &gt; would mean writing my own class to inherit from dict and converting
</I>&gt;<i> &gt; &gt; between them. I can't easily inherit util.FieldStorage because all
</I>&gt;<i> my
</I>&gt;<i> &gt; &gt; code has standalone unittests which can't import _apache
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; It's not the end of the world if util.FieldStorage isn't updated,
</I>&gt;<i> &gt; &gt; but it
</I>&gt;<i> &gt; &gt; would make my life a lot simpler ;-) I may try and have a go at
</I>&gt;<i> &gt; &gt; updating
</I>&gt;<i> &gt; &gt; it - is there any documentation on the best way to provide
</I>&gt;<i> &gt; &gt; patches/unittests for ModPython?
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; Brian
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;&gt; -----Original Message-----
</I>&gt;<i> &gt; &gt;&gt; From: Graham Dumpleton [mailto:<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">grahamd at dscpl.com.au</A>]
</I>&gt;<i> &gt; &gt;&gt; Sent: 26 October 2006 11:12
</I>&gt;<i> &gt; &gt;&gt; To: Brian Bird
</I>&gt;<i> &gt; &gt;&gt; Cc: <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">mod_python at modpython.org</A> '<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">mod_python at modpython.org</A>'
</I>&gt;<i> &gt; &gt;&gt; Subject: Re: [mod_python] util.FieldStorage
</I>&gt;<i> &gt; &gt;&gt;
</I>&gt;<i> &gt; &gt;&gt; Yes, FieldStorage in 3.3 is broken in as much as add_field() if
</I>&gt;<i> &gt; &gt;&gt; called
</I>&gt;<i> &gt; &gt;&gt; after the first time that the 'dictionary' attribute is accessed in
</I>&gt;<i> &gt; &gt;&gt; some way,
</I>&gt;<i> &gt; &gt;&gt; does not result in that value ending up in the dictionary. Thus it
</I>&gt;<i> is
</I>&gt;<i> &gt; &gt;&gt; not
</I>&gt;<i> &gt; &gt;&gt; visible to __getitem__(), has_key() etc.
</I>&gt;<i> &gt; &gt;&gt;
</I>&gt;<i> &gt; &gt;&gt; Something else to fix. :-(
</I>&gt;<i> &gt; &gt;&gt;
</I>&gt;<i> &gt; &gt;&gt; Graham
</I>&gt;<i> &gt; &gt;&gt;
</I>&gt;<i> &gt; &gt;&gt; On 26/10/2006, at 7:56 PM, Graham Dumpleton wrote:
</I>&gt;<i> &gt; &gt;&gt;
</I>&gt;<i> &gt; &gt;&gt;&gt; The util.FieldStorage implementation in mod_python 3.3 is quite a
</I>&gt;<i> &gt; &gt; bit
</I>&gt;<i> &gt; &gt;&gt;&gt; different to what is used in older versions of mod_python and
</I>&gt;<i> which
</I>&gt;<i> &gt; &gt;&gt;&gt; you based your changes upon. Thus your changes are not compatible
</I>&gt;<i> &gt; &gt;&gt;&gt; with the new code base.
</I>&gt;<i> &gt; &gt;&gt;&gt;
</I>&gt;<i> &gt; &gt;&gt;&gt; Some have talked about making the new implementation of the
</I>&gt;<i> &gt; &gt;&gt;&gt; FieldStorage class more dictionary like than it is, but no one has
</I>&gt;<i> &gt; &gt;&gt;&gt; stepped up to provide any changes.
</I>&gt;<i> &gt; &gt;&gt;&gt;
</I>&gt;<i> &gt; &gt;&gt;&gt; To be honest I haven't actually looked into how FieldStorage is
</I>&gt;<i> &gt; &gt;&gt;&gt; implemented as someone outside of the core developers provided
</I>&gt;<i> &gt; &gt;&gt;&gt; the updated code and it was integrated by someone other than
</I>&gt;<i> &gt; &gt;&gt;&gt; myself. Looking at the code now, I actually think it might be a
</I>&gt;<i> bit
</I>&gt;<i> &gt; &gt;&gt;&gt; broken. I'll have to do some playing with the code.
</I>&gt;<i> &gt; &gt;&gt;&gt;
</I>&gt;<i> &gt; &gt;&gt;&gt; BTW, what benefits do you think you get if it is more dictionary
</I>&gt;<i> &gt; &gt; like?
</I>&gt;<i> &gt; &gt;&gt;&gt; I am not sure I understand the reason for making such changes in
</I>&gt;<i> &gt; &gt;&gt;&gt; the first place.
</I>&gt;<i> &gt; &gt;&gt;&gt;
</I>&gt;<i> &gt; &gt;&gt;&gt; Graham
</I>&gt;<i> &gt; &gt;&gt;&gt;
</I>&gt;<i> &gt; &gt;&gt;&gt; On 26/10/2006, at 7:14 PM, Brian Bird wrote:
</I>&gt;<i> &gt; &gt;&gt;&gt;
</I>&gt;<i> &gt; &gt;&gt;&gt;&gt; Is there anything in the works to make util.FieldStorage act more
</I>&gt;<i> &gt; &gt;&gt;&gt;&gt; like a real dictionary? Specifically, it doesn't support the
</I>&gt;<i> &gt; &gt;&gt;&gt;&gt; __setitem__, __delitem__ methods. Since the documentation states
</I>&gt;<i> &gt; &gt;&gt;&gt;&gt; &quot;it can be treated like a dictionary&quot; I was surprised to find
</I>&gt;<i> &gt; &gt;&gt;&gt;&gt; these methods missing.
</I>&gt;<i> &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt;&gt;&gt;&gt; I know it's easy to change it to a real dictionary to get these
</I>&gt;<i> &gt; &gt;&gt;&gt;&gt; methods, but then you lose the (very useful) getlist() method. At
</I>&gt;<i> &gt; &gt;&gt;&gt;&gt; first glance it doesn't look like much work to add the extra
</I>&gt;<i> &gt; &gt;&gt;&gt;&gt; methods (but I haven't looked at how it may affect values which
</I>&gt;<i> &gt; &gt;&gt;&gt;&gt; aren't StringField's).
</I>&gt;<i> &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt;&gt;&gt;&gt; I've just looked in the latest subversion and found that the
</I>&gt;<i> items
</I>&gt;<i> &gt; &gt;&gt;&gt;&gt; () method is now in util.FieldStorage, as well as a method
</I>&gt;<i> &gt; &gt;&gt;&gt;&gt; add_field() which looks suspiciously like __setitem__ should, but
</I>&gt;<i> &gt; &gt;&gt;&gt;&gt; no sign of a __delitem__. However, there now seems to be a
</I>&gt;<i> &gt; &gt;&gt;&gt;&gt; self.dictionary object which could be useful - perhaps all
</I>&gt;<i> &gt; &gt;&gt;&gt;&gt; unrecognised methods should be passed onto self.dictionary in the
</I>&gt;<i> &gt; &gt;&gt;&gt;&gt; __getattr__ instead of raising an AttributeError?
</I>&gt;<i> &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt;&gt;&gt;&gt; I've put below what I thought needed adding to the
</I>&gt;<i> &gt; &gt;&gt;&gt;&gt; util.FieldStorage class before I noticed self.dictionary in case
</I>&gt;<i> &gt; &gt;&gt;&gt;&gt; it's any help.
</I>&gt;<i> &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt;&gt;&gt;&gt; ### Disclaimer - completely untested! J ###
</I>&gt;<i> &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt;&gt;&gt;&gt; def __setitem__(self, key, value):
</I>&gt;<i> &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt;&gt;&gt;&gt;     self.list.append(util.Field(key, cStringIO.StringIO(key),
</I>&gt;<i> &gt; &gt;&gt;&gt;&gt; &quot;text/plain&quot;, {}, None, {}))
</I>&gt;<i> &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt;&gt;&gt;&gt; def __delitem__(self, key):
</I>&gt;<i> &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt;&gt;&gt;&gt;     for item in self.list:
</I>&gt;<i> &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt;&gt;&gt;&gt;         if item.name == key:
</I>&gt;<i> &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt;&gt;&gt;&gt;             self.list.remove(item)
</I>&gt;<i> &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt;&gt;&gt;&gt; def items(self):
</I>&gt;<i> &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt;&gt;&gt;&gt;     result = []
</I>&gt;<i> &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt;&gt;&gt;&gt;     for key in self.keys():
</I>&gt;<i> &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt;&gt;&gt;&gt;         result.append((key, self[key]))
</I>&gt;<i> &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt;&gt;&gt;&gt;     return result
</I>&gt;<i> &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt;&gt;&gt;&gt; def update(self, d):
</I>&gt;<i> &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt;&gt;&gt;&gt;     for k in d.keys():
</I>&gt;<i> &gt; &gt;&gt;&gt;&gt;
</I>&gt;<i> &gt; &gt;&gt;&gt;&gt;         self[k] = d[k]
</I>&gt;<i> &gt; &gt;&gt;&gt;
</I>&gt;<i> &gt; &gt;&gt;&gt; _______________________________________________
</I>&gt;<i> &gt; &gt;&gt;&gt; Mod_python mailing list
</I>&gt;<i> &gt; &gt;&gt;&gt; <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;<i> &gt; &gt;&gt;&gt; <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; _______________________________________________
</I>&gt;<i> &gt; &gt; Mod_python mailing list
</I>&gt;<i> &gt; &gt; <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;<i> &gt; &gt; <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I></PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="022405.html">[mod_python] myghty.session with Python2.2
</A></li>
	<LI>Next message: <A HREF="022404.html">[mod_python] util.FieldStorage
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22399">[ date ]</a>
              <a href="thread.html#22399">[ thread ]</a>
              <a href="subject.html#22399">[ subject ]</a>
              <a href="author.html#22399">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
