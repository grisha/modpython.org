<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Building a web application using Cheetah and
	mod_python
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Building%20a%20web%20application%20using%20Cheetah%20and%0A%09mod_python&In-Reply-To=93f7db120610271444q73ab89ecuf1e019c41c0d290%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022408.html">
   <LINK REL="Next"  HREF="022417.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Building a web application using Cheetah and
	mod_python</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Building%20a%20web%20application%20using%20Cheetah%20and%0A%09mod_python&In-Reply-To=93f7db120610271444q73ab89ecuf1e019c41c0d290%40mail.gmail.com"
       TITLE="[mod_python] Building a web application using Cheetah and
	mod_python">grahamd at dscpl.com.au
       </A><BR>
    <I>Fri Oct 27 23:32:35 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="022408.html">[mod_python] Building a web application using Cheetah and mod_python
</A></li>
        <LI>Next message: <A HREF="022417.html">[mod_python] Building a web application using Cheetah and
	mod_python
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22414">[ date ]</a>
              <a href="thread.html#22414">[ thread ]</a>
              <a href="subject.html#22414">[ subject ]</a>
              <a href="author.html#22414">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On 28/10/2006, at 7:44 AM, Sebastian Celis wrote:

&gt;<i> Hello,
</I>&gt;<i>
</I>&gt;<i> I am new to this list and have just recently begun to work on a
</I>&gt;<i> project where I wish to use mod_python.publisher and cheetah to drive
</I>&gt;<i> an entire web application.  I apologize if the following topics have
</I>&gt;<i> been discussed to death recently, but I have read through the
</I>&gt;<i> documentation on both sites and have searched through the mailing-list
</I>&gt;<i> archives and while I have seen similar discussions, I have yet to find
</I>&gt;<i> definitive answers.  I am able to get most things to work, however I
</I>&gt;<i> can't help but feel that there are better ways of approaching some of
</I>&gt;<i> my situations.
</I>&gt;<i>
</I>&gt;<i> First, I'll quickly describe my directory structure:
</I>&gt;<i>
</I>&gt;<i> /var/www/app -- The base directory to the web application.  This will
</I>&gt;<i> directly contain most of the python files that correspond directly to
</I>&gt;<i> URLs.  For example, index.py, login.py, etc.  In this directory.
</I>&gt;<i> /var/www/app/templates -- Contains all of my cheetah templates.
</I>&gt;<i> /var/www/app/include -- Contains the python utility modules I am
</I>&gt;<i> writing specifically for this application.
</I>&gt;<i>
</I>&gt;<i> Now, onto the questions.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> 1) Importing compiled cheetah templates
</I>&gt;<i>
</I>&gt;<i> Assume I have code like the following in /var/www/app/test1.py
</I>&gt;<i>
</I>&gt;<i> ######################################
</I>&gt;<i> from mod_python import apache
</I>&gt;<i> from Cheetah.Template import Template
</I>&gt;<i>
</I>&gt;<i> def index(req):
</I>&gt;<i>    req.content_type = &quot;text/html&quot;
</I>&gt;<i>
</I>&gt;<i>    dict = {'title': 'My Title!', 'message': 'Hello world!'}
</I>&gt;<i>    templateModule = apache.import_module(&quot;templates/myTemplate&quot;)
</I>
Using '/' in the module name like this is not portable and is dependent
on peculiarities of the behaviour of Python on a specific platform.  
It will
not for example work on Mac OS X and also possibly not on Windows.

&gt;<i>    t = getattr(templateModule, &quot;myTemplate&quot;)()
</I>&gt;<i>    searchList = t.searchList()
</I>&gt;<i>    searchList.insert(0, dict)
</I>&gt;<i>
</I>&gt;<i>    return(t.respond())
</I>&gt;<i> ######################################
</I>&gt;<i>
</I>&gt;<i> Is this the best way to import template modules and then evaluate  
</I>&gt;<i> them?
</I>
No, in as much as you are having to create a parallel hierarchy of  
publisher
handlers for each Cheetah page. You would be better off using a custom
handler which does the dispatch direct to the compiled Cheetah template
classes. See the mod_python handler described in:

   <A HREF="http://wiki.cheetahtemplate.org/cheetah-recipes.html">http://wiki.cheetahtemplate.org/cheetah-recipes.html</A>

&gt;<i> 2) Modifying PythonPath prevents modules from being imported
</I>&gt;<i>
</I>&gt;<i> Inside file /var/www/app/test2.py, I have the following code:
</I>&gt;<i>
</I>&gt;<i> import config
</I>&gt;<i> (or)
</I>&gt;<i> config = apache.import_module(&quot;config&quot;)
</I>&gt;<i>
</I>&gt;<i> Both of these commands load /var/www/app/config.py, and seem to work
</I>&gt;<i> fine.  However, if I add
</I>&gt;<i>
</I>&gt;<i> PythonPath &quot;['/var/www/app/templates']+sys.path&quot;
</I>&gt;<i>
</I>&gt;<i> to my apache configuration, I get an error next time I run test2.py.
</I>&gt;<i>
</I>&gt;<i> ###
</I>&gt;<i> Mod_python error: &quot;PythonHandler mod_python.publisher&quot;
</I>&gt;<i>
</I>&gt;<i> Traceback (most recent call last):
</I>&gt;<i>
</I>&gt;<i>  File &quot;/usr/lib/python2.4/site-packages/mod_python/apache.py&quot;, line
</I>&gt;<i> 299, in HandlerDispatch
</I>&gt;<i>    result = object(req)
</I>&gt;<i>
</I>&gt;<i>  File &quot;/usr/lib/python2.4/site-packages/mod_python/publisher.py&quot;,
</I>&gt;<i> line 213, in handler
</I>&gt;<i>    published = publish_object(req, object)
</I>&gt;<i>
</I>&gt;<i>  File &quot;/usr/lib/python2.4/site-packages/mod_python/publisher.py&quot;,
</I>&gt;<i> line 412, in publish_object
</I>&gt;<i>    return publish_object(req,util.apply_fs_data(object, req.form,  
</I>&gt;<i> req=req))
</I>&gt;<i>
</I>&gt;<i>  File &quot;/usr/lib/python2.4/site-packages/mod_python/util.py&quot;, line
</I>&gt;<i> 439, in apply_fs_data
</I>&gt;<i>    return object(**args)
</I>&gt;<i>
</I>&gt;<i>  File &quot;/var/www/app/test2.py&quot;, line 8, in index
</I>&gt;<i>    config = apache.import_module(&quot;config&quot;)
</I>&gt;<i>
</I>&gt;<i>  File &quot;/usr/lib/python2.4/site-packages/mod_python/apache.py&quot;, line
</I>&gt;<i> 461, in import_module
</I>&gt;<i>    f, p, d = imp.find_module(parts[i], path)
</I>&gt;<i>
</I>&gt;<i> ImportError: No module named config
</I>&gt;<i> ###
</I>&gt;<i>
</I>&gt;<i> Why does this initially work but then stop working once I add a
</I>&gt;<i> directory to my path?  I can fix it by adding '/var/www/app' to my
</I>&gt;<i> PythonPath as well, but I don't understand why it didn't work before
</I>&gt;<i> that.
</I>
That is just how mod_python has always worked. Setting PythonPath
stops mod_python looking in the directory the handler was specified
for. Yes it is a pain. FWIW, this behaviour changes in mod_python 3.3
where the whole issue of module importing is dealt with a bit  
differently
and is much more consistent and predictable.

Current versions of mod_python have a lot of issues when it comes
to the module importer. You should really have a read of:

   <A HREF="http://www.dscpl.com.au/wiki/ModPython/Articles/">http://www.dscpl.com.au/wiki/ModPython/Articles/</A> 
ModuleImportingIsBroken

&gt;<i> 3) Cheetah and #include
</I>&gt;<i>
</I>&gt;<i> I have read a lot about why mod_python sets the current working
</I>&gt;<i> directory to '/', but this seems to be causing some larger problems
</I>&gt;<i> when cheetah comes into play.  (3) and (4) discuss two issues that I
</I>&gt;<i> am having trouble with.
</I>&gt;<i>
</I>&gt;<i> Here is /var/www/app/templates/testPage.tmpl:
</I>&gt;<i> ###
</I>&gt;<i> #include 'header_include.tmpl'
</I>&gt;<i> &lt;head&gt;
</I>&gt;<i> &lt;title&gt;$title&lt;/title&gt;
</I>&gt;<i> &lt;/head&gt;
</I>&gt;<i> &lt;body&gt;
</I>&gt;<i> &lt;p&gt;$message&lt;/p&gt;
</I>&gt;<i> &lt;/body&gt;
</I>&gt;<i> #include 'footer_include.tmpl'
</I>&gt;<i> ###
</I>&gt;<i>
</I>&gt;<i> However, as this actually tries to load /header_include.tmpl and
</I>&gt;<i> /footer_include.tmpl instead of the ones located in my templates
</I>&gt;<i> directory, this will not work.
</I>
If you are going to use compiled templates, you are possibly better  
off using
a site page base class and have specific pages extend that page. These
common blocks are then accessible through the base class. This means you
get the benefit of compiled code for the included blocks as well,  
instead of
it having to be interpreted each time.

&gt;<i> I came up with two workarounds,
</I>&gt;<i> however I don't really love either:
</I>&gt;<i>
</I>&gt;<i> a)
</I>&gt;<i>
</I>&gt;<i> ###
</I>&gt;<i> #include os.path.join(os.path.dirname(__file__),  
</I>&gt;<i> 'header_include.tmpl')
</I>&gt;<i> &lt;head&gt;
</I>&gt;<i> &lt;title&gt;$title&lt;/title&gt;
</I>&gt;<i> &lt;/head&gt;
</I>&gt;<i> &lt;body&gt;
</I>&gt;<i> &lt;p&gt;$message&lt;/p&gt;
</I>&gt;<i> &lt;/body&gt;
</I>&gt;<i> #include os.path.join(os.path.dirname(__file__),  
</I>&gt;<i> 'footer_include.tmpl')
</I>&gt;<i> ###
</I>&gt;<i>
</I>&gt;<i> b)
</I>&gt;<i>
</I>&gt;<i> Actually pass $templatesDir into all of my templates and then  
</I>&gt;<i> instead call:
</I>&gt;<i>
</I>&gt;<i> ###
</I>&gt;<i> #include os.path.join(templatesDir, 'header_include.tmpl')
</I>&gt;<i> &lt;head&gt;
</I>&gt;<i> &lt;title&gt;$title&lt;/title&gt;
</I>&gt;<i> &lt;/head&gt;
</I>&gt;<i> &lt;body&gt;
</I>&gt;<i> &lt;p&gt;$message&lt;/p&gt;
</I>&gt;<i> &lt;/body&gt;
</I>&gt;<i> #include os.path.join(templatesDir, 'footer_include.tmpl')
</I>&gt;<i> ###
</I>&gt;<i>
</I>&gt;<i> I guess I'm leaning toward (a), but both seem cumbersome and slower
</I>&gt;<i> than necessary.  Is there a better way to do this?
</I>
If my memory of Cheetah is correct, then extending from a site page  
which
has reusable bits like this as I describe above is better.

&gt;<i> 4) Cheetah and inheritance
</I>&gt;<i>
</I>&gt;<i> Assume these two files:
</I>&gt;<i>
</I>&gt;<i> /var/www/app/templates/overall_base.tmpl
</I>&gt;<i> ###
</I>&gt;<i> &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
</I>&gt;<i> &lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.1//EN&quot;
</I>&gt;<i>          &quot;<A HREF="http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd&quot;">http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd&quot;</A>&gt;
</I>&gt;<i> &lt;html xmlns=&quot;<A HREF="http://www.w3.org/1999/xhtml&quot;">http://www.w3.org/1999/xhtml&quot;</A> xml:lang=&quot;en&quot;&gt;
</I>&gt;<i> &lt;head&gt;
</I>&gt;<i>    &lt;title&gt;$title&lt;/title&gt;
</I>&gt;<i> &lt;/head&gt;
</I>&gt;<i> &lt;body&gt;
</I>&gt;<i>    $bodyContent
</I>&gt;<i> &lt;/body&gt;
</I>&gt;<i> &lt;/html&gt;
</I>&gt;<i> ###
</I>&gt;<i>
</I>&gt;<i> /var/www/app/templates/overall_base_extender.tmpl
</I>&gt;<i> ###
</I>&gt;<i> #overall_base = apache.import_module(&quot;overall_base&quot;)
</I>&gt;<i> (or)
</I>&gt;<i> #from overall_base import overall_base
</I>&gt;<i>
</I>&gt;<i> #extends overall_base
</I>&gt;<i> #def title
</I>&gt;<i> Welcome to Foo
</I>&gt;<i> #end def
</I>&gt;<i> #def bodyContent
</I>&gt;<i> Hello world!
</I>&gt;<i> #end def
</I>&gt;<i>
</I>&gt;<i> This second file only works if I add /var/www/app/templates to my
</I>&gt;<i> PythonPath.  And, due to (2) above, I then also have to add
</I>&gt;<i> /var/www/app to PythonPath.  Is this really necessary?=
</I>
With the version of mod_python you are using, yes it is necessary.

&gt;<i> #overall_base = apache.import_module(&quot;overall_base&quot;,
</I>&gt;<i> path=[os.path.dirname(__file__)])
</I>&gt;<i>
</I>&gt;<i> doesn't seem to work inside the cheetah template file.  Even
</I>&gt;<i>
</I>&gt;<i> #sys.path.append(os.path.dirname(__file__))
</I>&gt;<i> #overall_base = apache.import_module(&quot;overall_base&quot;)
</I>
That one I am not sure about. You may be hitting one of the other  
problems
with PythonPath based module importing which is you can't easily have  
the
same name module in different directories and be sure you import the one
you want.

In general I wouldn't recommend using apache.import_module() within
Cheetah templates explicitly.

&gt;<i> doesn't seem to work.  Is there any way to get inheriting templates to
</I>&gt;<i> work without modifying PythonPath to include all the directories where
</I>&gt;<i> my base templates might be located?
</I>
Not really.

&gt;<i> I apologize for the huge length of this e-mail.  I am still fairly new
</I>&gt;<i> to mod_python and cheetah, but so far I really like what I see.  I
</I>&gt;<i> just feel like there are a few issues I need to wrap my head around
</I>&gt;<i> before I can really dive into developing applications.  Any pointers
</I>&gt;<i> or help with these issues that you can provide would be greatly
</I>&gt;<i> appreciated.
</I>
Things are a bit easier to manage and easier to predict when  
mod_python 3.3
can be used. Version 3.3 of mod_python hasn't been released yet, but  
is quite
close. If you want to try the source for mod_python out of the  
Subversion
repository, then can suggest better ways of doing things.

Graham
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="022408.html">[mod_python] Building a web application using Cheetah and mod_python
</A></li>
	<LI>Next message: <A HREF="022417.html">[mod_python] Building a web application using Cheetah and
	mod_python
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22414">[ date ]</a>
              <a href="thread.html#22414">[ thread ]</a>
              <a href="subject.html#22414">[ subject ]</a>
              <a href="author.html#22414">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
