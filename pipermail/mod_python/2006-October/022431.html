<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Can i have both Marshal and Signed
	CookieswithPublisher?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Can%20i%20have%20both%20Marshal%20and%20Signed%0A%09CookieswithPublisher%3F&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022430.html">
   <LINK REL="Next"  HREF="022432.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Can i have both Marshal and Signed
	CookieswithPublisher?</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Can%20i%20have%20both%20Marshal%20and%20Signed%0A%09CookieswithPublisher%3F&In-Reply-To="
       TITLE="[mod_python] Can i have both Marshal and Signed
	CookieswithPublisher?">grahamd at dscpl.com.au
       </A><BR>
    <I>Sun Oct 29 18:54:05 EST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="022430.html">[mod_python] Can i have both Marshal and Signed
	CookieswithPublisher?
</A></li>
        <LI>Next message: <A HREF="022432.html">[mod_python] Can i have both Marshal and Signed
	CookieswithPublisher?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22431">[ date ]</a>
              <a href="thread.html#22431">[ thread ]</a>
              <a href="subject.html#22431">[ subject ]</a>
              <a href="author.html#22431">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Clodoaldo Pinto Neto wrote ..
&gt;<i> 2006/10/29, Graham Dumpleton &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">grahamd at dscpl.com.au</A>&gt;:
</I>&gt;<i> &gt; I have created a JIRA issue for this at:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;   <A HREF="http://issues.apache.org/jira/browse/MODPYTHON-200">http://issues.apache.org/jira/browse/MODPYTHON-200</A>
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; At the moment I have made changes (not committed), that would allow
</I>&gt;<i> &gt; one to do:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;     cookies = Cookie.get_cookies(req, Cookie.MarshalCookie, secret='secret',
</I>&gt;<i> names=['marshal'])
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; That is, when using Cookie.get_cookies(), one can optionally provide
</I>&gt;<i> a
</I>&gt;<i> &gt; keyword argument called 'names' which is a set/list of cookie names
</I>&gt;<i> &gt; to decode.
</I>&gt;<i> 
</I>&gt;<i> IMHO, the least surprise behavior is if Cookie.get_cookies() returned
</I>&gt;<i> all cookies of the given class regardless of how many different cookie
</I>&gt;<i> classes there are in the header.
</I>
There is nothing in a cookie string though to be able to identify it as being
of a particular type. The only way you can know is to try and decode it and
if it works then it probably is. This is probably not a good way of doing
things. First off the application should only be decoding its own cookies
and not others which may have been sent to the site in general. Thus, allowing
one to say which cookies to decode is probably a better step.

&gt;<i> Why isn't the except clause catching the exception? What exception is
</I>&gt;<i> being raised?:
</I>&gt;<i>
</I>&gt;<i>     def parse(Class, s, secret):
</I>&gt;<i> 
</I>&gt;<i>         dict = _parse_cookie(s, Class)
</I>&gt;<i> 
</I>&gt;<i>         for k in dict:
</I>&gt;<i>             c = dict[k]
</I>&gt;<i>             try:
</I>&gt;<i>                 c.unmarshal(secret)
</I>&gt;<i>             except (CookieError, ValueError):
</I>&gt;<i>                 # downgrade to Cookie
</I>&gt;<i>                 dict[k] = Cookie.parse(Cookie.__str__(c))[k]
</I>&gt;<i> 
</I>&gt;<i>         return dict
</I>
Good point. Probably because the error isn't a CookieError.

&gt;<i> What is the point in downgrading the cookie? If it is tampered or
</I>&gt;<i> corrupted then why not just discard it?
</I>
This issue has come up recently in relation to signed Sessions. For
Sessions at least it wasn't a big problem but couldn't get any feedback
on issue in general so nothing done. See:

  <A HREF="http://issues.apache.org/jira/browse/MODPYTHON-191">http://issues.apache.org/jira/browse/MODPYTHON-191</A>

For how the implementation works, the documentation certainly does
not say that the type of the cookie should be checked, when it should.

To affect some change, some sort of consensus is needed about how
to change it and for there to be a good understanding that this will
not cause problems with existing code. Remember this code was
written many years ago (not by I) and so one always has to be sure
that changes will not break things.

So, please do contribute further feedback and ideas, but when it comes
down to it, unless its obvious a change should be made in a certain
way, if only one person is pushing it, I am not always going to do it.
I would prefer a few people at least to agree, especially when I don't
use a lot of this stuff personally and so don't always know what should
be done. Some times I do make an arbitrary decision to make a change
when I get no feedback, but one of these days it is going to surely
bite me.

Graham
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="022430.html">[mod_python] Can i have both Marshal and Signed
	CookieswithPublisher?
</A></li>
	<LI>Next message: <A HREF="022432.html">[mod_python] Can i have both Marshal and Signed
	CookieswithPublisher?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22431">[ date ]</a>
              <a href="thread.html#22431">[ thread ]</a>
              <a href="subject.html#22431">[ subject ]</a>
              <a href="author.html#22431">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
