<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] smarter session (un)locking possible?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20smarter%20session%20%28un%29locking%20possible%3F&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022325.html">
   <LINK REL="Next"  HREF="022327.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] smarter session (un)locking possible?</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Andreas Klauer</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20smarter%20session%20%28un%29locking%20possible%3F&In-Reply-To="
       TITLE="[mod_python] smarter session (un)locking possible?">Andreas.Klauer at metamorpher.de
       </A><BR>
    <I>Sun Oct 15 18:23:27 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="022325.html">[mod_python] python server pages + session
</A></li>
        <LI>Next message: <A HREF="022327.html">[mod_python] Bizarre problems with rewriting URLs?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22326">[ date ]</a>
              <a href="thread.html#22326">[ thread ]</a>
              <a href="subject.html#22326">[ subject ]</a>
              <a href="author.html#22326">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

I just wasted half day to get rid of a problem, which I, due to lack 
of experience, have to describe as 'random mod_python lockups'. 
Turns out they were caused because I was using Sessions, and Sessions 
lock until the end of the request by default.

The 'lockup' occurs when sending concurrent requests to the server,
which happens quite frequently when users open a lot of tabs on the 
page or - worse - download a file via mod_python.

The culprit code was actually a subroutine like this:

def _get_user_id(req):
    s = Session.Session(req)
    if s.is_new():
        s['id'] = _generate_unique_id()
    s.save()
    return s['id']

Now, first of all I don't want to complain about locking here. 
The fact that I noticed it so late, checked everywhere but there 
for a problem, just shows how much I know about locking issues. 
So it's a good thing that it is taken care of by mod_python.

However, I wonder if mod_python could not have handled this case 
in a smarter way. After all, the session is only used in a separate 
subroutine. The session object does not even exist anymore after 
it returns. Yet it may still take quite some time until the request 
completes.

If it is possible in Python when an object has no more references 
(I'm new to Python so I'm not sure), I would prefer if it could 
unlock the Session immediately. It would be safer than letting me 
doing the locking myself, because I could accidentally unlock at 
a time where it is not safe (because the reference to the session 
object is still around and could be accessed).

Regards
Andreas Klauer
</PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="022325.html">[mod_python] python server pages + session
</A></li>
	<LI>Next message: <A HREF="022327.html">[mod_python] Bizarre problems with rewriting URLs?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22326">[ date ]</a>
              <a href="thread.html#22326">[ thread ]</a>
              <a href="subject.html#22326">[ subject ]</a>
              <a href="author.html#22326">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
