<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] AddHandler / SetHandler (black magic)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20AddHandler%20/%20SetHandler%20%28black%20magic%29&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022209.html">
   <LINK REL="Next"  HREF="022210.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] AddHandler / SetHandler (black magic)</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>marinus van aswegen</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20AddHandler%20/%20SetHandler%20%28black%20magic%29&In-Reply-To="
       TITLE="[mod_python] AddHandler / SetHandler (black magic)">mvanaswegen at gmail.com
       </A><BR>
    <I>Fri Oct  6 03:01:32 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="022209.html">[mod_python] What appears in the browser address window.
</A></li>
        <LI>Next message: <A HREF="022210.html">[mod_python] AddHandler / SetHandler (black magic)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22208">[ date ]</a>
              <a href="thread.html#22208">[ thread ]</a>
              <a href="subject.html#22208">[ subject ]</a>
              <a href="author.html#22208">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi All

I think i've just entered the real of apache config black magic. Just a
quick report back.

The to provide the necessary context, I would like to call my app
<A HREF="http://url/app/function">http://url/app/function</A>
other resources like html files and images are in the same directory. A call
to the url should redirect to app/index

1. I tried using the AddHandler but this forced me to add the .py extension
2. I tried using the SetHandler to force all calls to the directory to
mod_python, this meant that other non python files could not be served.
3. I then tried Grahams suggestion of excluding certain file types and
forcing them to the default handler. This worked  however I ended up with a
situation where the I could not invoke my app or serve the index.html file
if the user requested the directory. For some strange reason the
DirectoryIndex directive was being ignored. I assume this has something to
do with the Publish and sethandler mix. Another bad side effect was that the
user would be able to request the app.py directly and get the code (no no!)
4. Time for some black magic, I used the file directive to black all calls
to pyc and py files (this is not a good security practise, It's much better
to deny and explicitly permit than the other way around) I then set the
handler depending on the content(see below).

I read the config from my ubuntu box where with an AddHandler I was able to
get Apache to behave like I wanted to and I found that I had to directory
blocks one in the Vhost config and one in the main config file, I suspect
there was some strange command interpolation going on there.  There must be
a cleaner way of doing this?

&lt;VirtualHost *:443&gt;
     DocumentRoot &quot;/opt/www&quot;
     ServerName www.test.co.za

     SSLEngine on
     SSLCertificateFile /opt/keys/server.crt
     SSLCertificateKeyFile /opt/keys/server.key
&lt;/VirtualHost&gt;

&lt;Directory &quot;/opt/www&gt;

    # extend the pathon path so our python modules can be loaded
    PythonPath &quot;['/modules'] + sys.path&quot;

    # set the handler to mod_python + publisher so we can call url/python
    &lt;Files ~ &quot;^cmd$&quot;&gt;
        SetHandler mod_python
    &lt;/Files&gt;

    PythonHandler mod_python.publisher
    PythonDebug On

    # only permit access to the following files
    &lt;Files ~ &quot;\.(gif|html|jpg|png)$&quot;&gt;
        SetHandler default-handler
    &lt;/Files&gt;

&lt;/Directory&gt;


On 10/5/06, marinus van aswegen &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">mvanaswegen at gmail.com</A>&gt; wrote:
&gt;<i>
</I>&gt;<i> Hi Graham
</I>&gt;<i>
</I>&gt;<i> Thanks for the comments, I'm going to try and use the sethandler because I
</I>&gt;<i> don't want the .py extensions in the URL. I'll use the default handler to
</I>&gt;<i> serve static content i.e. jpegs.
</I>&gt;<i>
</I>&gt;<i> &lt;Files *.jpg&gt;
</I>&gt;<i>
</I>&gt;<i> SetHandler default-handler
</I>&gt;<i> &lt;/Files&gt;
</I>&gt;<i>
</I>&gt;<i> I think there should be a big fat link on the mod_python front page to
</I>&gt;<i> your articles section.
</I>&gt;<i>
</I>&gt;<i> Regards
</I>&gt;<i>
</I>&gt;<i> Marinus
</I>&gt;<i>
</I>&gt;<i> PS the mod_python FAQ was a bit confusing on this topic
</I>&gt;<i> <A HREF="http://www.modpython.org/FAQ/faqw.py?req=all#2.17">http://www.modpython.org/FAQ/faqw.py?req=all#2.17</A>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On 10/5/06, Graham Dumpleton &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">grahamd at dscpl.com.au</A>&gt; wrote:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; marinus van aswegen wrote ..
</I>&gt;<i> &gt; &gt; Hi All
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; Let me pull this thread together. I had a working Apache2/mod_python
</I>&gt;<i> &gt; setup
</I>&gt;<i> &gt; &gt; on Ubuntu.
</I>&gt;<i> &gt; &gt; Mod_python was setup so that I could call my python ap url/app/func
</I>&gt;<i> &gt; &gt; all worked fine until i moved my app to fedora. i just got the app
</I>&gt;<i> &gt; &gt; working again but apache wont serve any other files like images now.
</I>&gt;<i> &gt; &gt; will hit the faq when i get home later.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; And it is because you are using the SetHandler directive. By using that
</I>&gt;<i> &gt; directive, all requests will be intercepted and sent through to
</I>&gt;<i> &gt; mod_python.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Read:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;   <A HREF="http://www.dscpl.com.au/wiki/ModPython/Articles/SetHandlerVersusAddHandler">http://www.dscpl.com.au/wiki/ModPython/Articles/SetHandlerVersusAddHandler</A>
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; It explains the difference between SetHandler and AddHandler.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; You may just want to use:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;   AddHandler mod_python .py
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; instead of SetHandler, but generally this means you need to use .py in
</I>&gt;<i> &gt; your URLs for Python stuff.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Graham
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &gt; &lt;SNIP&gt;
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; LoadModule python_module modules/mod_python.so
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; NameVirtualHost *:80
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; &lt;VirtualHost *:80&gt;
</I>&gt;<i> &gt; &gt;     DocumentRoot &quot;/opt/www&quot;
</I>&gt;<i> &gt; &gt;     ServerName www.test.co.za
</I>&gt;<i> &gt; &gt;     DirectoryIndex index.html
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; &lt;/VirtualHost&gt;
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; # Virtual host Virtual Host 0
</I>&gt;<i> &gt; &gt; &lt;VirtualHost *:443&gt;
</I>&gt;<i> &gt; &gt;      DocumentRoot &quot;/opt/www&quot;
</I>&gt;<i> &gt; &gt;      ServerName www.test.co.za
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;     DirectoryIndex index.html
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;      SSLEngine on
</I>&gt;<i> &gt; &gt;      SSLCertificateFile /keys/server.crt
</I>&gt;<i> &gt; &gt;      SSLCertificateKeyFile /keys/server.key
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; &lt;/VirtualHost&gt;
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; &lt;VirtualHost *:80&gt;
</I>&gt;<i> &gt; &gt;     DocumentRoot &quot;/opt/www.telic.co.za&quot;
</I>&gt;<i> &gt; &gt;     ServerName www.telic.co.za
</I>&gt;<i> &gt; &gt; &lt;/VirtualHost&gt;
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; &lt;Directory &quot;/&quot;&gt;
</I>&gt;<i> &gt; &gt;         Options FollowSymLinks
</I>&gt;<i> &gt; &gt;         AllowOverride None
</I>&gt;<i> &gt; &gt; &lt;/Directory&gt;
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; &lt;Directory &quot;/opt/www&quot;&gt;
</I>&gt;<i> &gt; &gt;      # extend the pathon path so our python modules can be loaded
</I>&gt;<i> &gt; &gt;     PythonPath &quot;['/opt/www'] + sys.path&quot;
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;     # set the handler to mod_python + publisher so we can call
</I>&gt;<i> &gt; url/python
</I>&gt;<i> &gt; &gt;     SetHandler mod_python
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;     PythonHandler mod_python.publisher
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;     PythonDebug On
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;     # do not permit access to compiled python code
</I>&gt;<i> &gt; &gt;         &lt;Files *.pyc&gt;
</I>&gt;<i> &gt; &gt;             deny from all
</I>&gt;<i> &gt; &gt;         &lt;/Files&gt;
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; &lt;/Directory&gt;
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; On 10/3/06, Eric Brunson &lt; <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">brunson at brunson.com</A>&gt; wrote:
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; Colin Bean wrote:
</I>&gt;<i> &gt; &gt; &gt; &gt; Thanks for the correction, Eric; I've never actually done that and
</I>&gt;<i> &gt; &gt; &gt; &gt; assumed incorrectly.  Shame on me for recommending something that
</I>&gt;<i> &gt; I
</I>&gt;<i> &gt; &gt; &gt; &gt; haven't tried!
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; No worries, we're all here to learn.  :-)
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; Marinus, what I should have asked originally was how apache was
</I>&gt;<i> &gt; &gt; &gt; &gt; failing with your config files (and what's in the error
</I>&gt;<i> &gt; log).  What
</I>&gt;<i> &gt; &gt; &gt; &gt; does your &quot;limited success&quot; mean?
</I>&gt;<i> &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; -Colin
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; _______________________________________________
</I>&gt;<i> &gt; &gt; &gt; Mod_python mailing list
</I>&gt;<i> &gt; &gt; &gt; <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;<i> &gt; &gt; &gt; <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; _______________________________________________
</I>&gt;<i> &gt; &gt; Mod_python mailing list
</I>&gt;<i> &gt; &gt; <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;<i> &gt; &gt; <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I>&gt;<i> &gt;
</I>&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20061006/627fc00e/attachment-0001.html">http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20061006/627fc00e/attachment-0001.html</A>
</PRE>







<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="022209.html">[mod_python] What appears in the browser address window.
</A></li>
	<LI>Next message: <A HREF="022210.html">[mod_python] AddHandler / SetHandler (black magic)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22208">[ date ]</a>
              <a href="thread.html#22208">[ thread ]</a>
              <a href="subject.html#22208">[ subject ]</a>
              <a href="author.html#22208">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="DISABLEhttp://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
