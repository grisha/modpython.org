<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Bizarre problems with rewriting URLs?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Bizarre%20problems%20with%20rewriting%20URLs%3F&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022328.html">
   <LINK REL="Next"  HREF="022330.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Bizarre problems with rewriting URLs?</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Bizarre%20problems%20with%20rewriting%20URLs%3F&In-Reply-To="
       TITLE="[mod_python] Bizarre problems with rewriting URLs?">grahamd at dscpl.com.au
       </A><BR>
    <I>Sun Oct 15 23:28:59 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="022328.html">[mod_python] Bizarre problems with rewriting URLs?
</A></li>
        <LI>Next message: <A HREF="022330.html">[mod_python] Bizarre problems with rewriting URLs?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22329">[ date ]</a>
              <a href="thread.html#22329">[ thread ]</a>
              <a href="subject.html#22329">[ subject ]</a>
              <a href="author.html#22329">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Please keep the discussion on the mod_python mailing list. Ie., use
reply-all and not just reply.

Aaron Gallagher wrote ..
&gt;<i> On Oct 15, 2006, at 6:31 PM, Graham Dumpleton wrote:
</I>&gt;<i> &gt; By all means post that part of your configuration which is  
</I>&gt;<i> &gt; relevant, but also
</I>&gt;<i> &gt; state which version of mod_python you are using. Also make it clear 
</I>&gt;<i> &gt; whether you
</I>&gt;<i> &gt; have different parts of the URL namespace with their own PythonHandler
</I>&gt;<i> &gt; directives and whether you have separated them if possible by  
</I>&gt;<i> &gt; tagging them
</I>&gt;<i> &gt; against different Python interpreter instances using PythonInterpreter
</I>&gt;<i> &gt; directive or otherwise.
</I>&gt;<i> 
</I>&gt;<i> Here's excerpts from my configuration files:
</I>&gt;<i> 
</I>&gt;<i> &lt;Directory /home/gethabbo/public_html&gt;
</I>&gt;<i>          SetHandler mod_python
</I>&gt;<i>          PythonHandler questionable
</I>&gt;<i>          PythonAuthenHandler questionable
</I>&gt;<i>          PythonOption site_name gethabbo
</I>&gt;<i> &lt;/Directory&gt;
</I>&gt;<i> &lt;Directory /home/gethabbo/public_html/editor&gt;
</I>&gt;<i>          AuthType Basic
</I>&gt;<i>          AuthName &quot;Questionable&quot;
</I>&gt;<i>          Require valid-user
</I>&gt;<i> &lt;/Directory&gt;
</I>&gt;<i> 
</I>&gt;<i> RewriteMap lowercase int:tolower
</I>&gt;<i> RewriteMap vhost txt:/etc/apache2/vhost.map
</I>&gt;<i> 
</I>&gt;<i> # Use the dynamic virtual host map.
</I>&gt;<i> RewriteCond %{REQUEST_URI} !^/icons/
</I>&gt;<i> RewriteCond %{REQUEST_URI} !^/cgi-bin/
</I>&gt;<i> RewriteCond %{REQUEST_URI} !^/mail/
</I>&gt;<i> RewriteCond %{REQUEST_URI} !^/phpmyadmin/
</I>&gt;<i> RewriteCond %{REQUEST_URI} !^/mt/
</I>&gt;<i> RewriteCond ${lowercase:%{SERVER_NAME}} ^(.+)$
</I>&gt;<i> RewriteCond ${vhost:%1} ^(/.*)$
</I>&gt;<i> RewriteRule ^/(.*)$ %1/public_html/$1 [L]
</I>&gt;<i> 
</I>&gt;<i> And the relevant line in my map:
</I>&gt;<i> www.gethabbo.com        /home/gethabbo
</I>&gt;<i> 
</I>&gt;<i> &gt; No. It is a known problem with mod_python that the order of  
</I>&gt;<i> &gt; directories in
</I>&gt;<i> &gt; sys.path can be random. As a result, if you use the same module  
</I>&gt;<i> &gt; name in
</I>&gt;<i> &gt; different handler directories, you can get strange things  
</I>&gt;<i> &gt; happening, more so if
</I>&gt;<i> &gt; you are using the worker MPM on UNIX.
</I>&gt;<i> 
</I>&gt;<i> Okay. I need to find a way to determine where the Directory is that  
</I>&gt;<i> the handler is defined for. Is there a way to access the  
</I>&gt;<i> configuration other than PythonOptions from the req object?
</I>
On this later issue of determining what the handler root is, it depends
on which version of mod_python you are using.

In mod_python 2.X, you had to use:

        # In mod_python 2.X have the req.get_dirs() method.
        handler_root = req.get_dirs()[&quot;PythonHandler&quot;]

In mod_python 3.0, 3.1 and 3.2 you would use:

        # In mod_python 3.X have the req.hlist member.
        handler_root = req.hlist.directory

Note though that in both cases, if the handler directive was inside of
a Files directive, the value was wrong due to problems with mod_python.
You would also get a bogus value if using the Location directive.

In mod_python 3.3, the preferred way (if using new importer) is:

        handler_root = apache.get_handler_root()

The req.hlist.directory method also still exists, but for cases like the
Files directive and other cases it will be None and one is supposed
to look back through req.hlist.parent to find context in which handler
was specified. If you use apache.get_handler_root() you don't have
to do that and it will always return correct value without having to
look through the mod_python internals to get it.

In respect of your rewrite problem, don't know. When I get a chance
will go back and read your original description of the problem to see
if I can work out what the real issue is.

Graham
</PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="022328.html">[mod_python] Bizarre problems with rewriting URLs?
</A></li>
	<LI>Next message: <A HREF="022330.html">[mod_python] Bizarre problems with rewriting URLs?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22329">[ date ]</a>
              <a href="thread.html#22329">[ thread ]</a>
              <a href="subject.html#22329">[ subject ]</a>
              <a href="author.html#22329">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
