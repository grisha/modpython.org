<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] util.FieldStorage
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20util.FieldStorage&In-Reply-To=A517B25C116F414281788C829739DB3B18F3EA%40stmail.Menai.local">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022393.html">
   <LINK REL="Next"  HREF="022395.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] util.FieldStorage</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20util.FieldStorage&In-Reply-To=A517B25C116F414281788C829739DB3B18F3EA%40stmail.Menai.local"
       TITLE="[mod_python] util.FieldStorage">grahamd at dscpl.com.au
       </A><BR>
    <I>Thu Oct 26 07:48:03 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="022393.html">[mod_python] util.FieldStorage
</A></li>
        <LI>Next message: <A HREF="022395.html">[mod_python] util.FieldStorage
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22394">[ date ]</a>
              <a href="thread.html#22394">[ thread ]</a>
              <a href="subject.html#22394">[ subject ]</a>
              <a href="author.html#22394">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Yes, but how dictionary like is the issue that I don't see anyone giving
an answer for. Ie., out  of:

 &gt;&gt;&gt; dir({})
['__class__', '__cmp__', '__contains__', '__delattr__',  
'__delitem__', '__doc__', '__eq__', '__ge__', '__getattribute__',  
'__getitem__', '__gt__', '__hash__', '__init__', '__iter__',  
'__le__', '__len__', '__lt__', '__ne__', '__new__', '__reduce__',  
'__reduce_ex__', '__repr__', '__setattr__', '__setitem__', '__str__',  
'clear', 'copy', 'fromkeys', 'get', 'has_key', 'items', 'iteritems',  
'iterkeys', 'itervalues', 'keys', 'pop', 'popitem', 'setdefault',  
'update', 'values']

what do you expect to be provided and work? Not all of them make
sense. Knowing which you think should work would be helpful.

I'd probably hold off trying to work out any patches yourself. The more
I look at FieldStorage the less I understand why some of the changes
were made. I'm not talking about how a dictionary based index was
added, but more how some of the code was shifted around when it
probably didn't need to, with the result being that the code then became
incompatible with versions of Trac which were out at the time. It would
not have been that hard to maintain compatibility with Trac and still  
get
the desired gains they were after. I can see myself therefore doing a  
bit
or reorganisation of the code to fix the identified issue, but also  
reinstate
Trac compatibility.

Graham

On 26/10/2006, at 9:32 PM, Brian Bird wrote:

&gt;<i> The benefit of being more dictionary-like is just convenience. As
</I>&gt;<i> util.FieldStorage doesn't have all the dictionary methods then I  
</I>&gt;<i> usually
</I>&gt;<i> just convert it to a real dictionary.
</I>&gt;<i>
</I>&gt;<i> However, I'd like to also keep the getfirst and getlist methods, which
</I>&gt;<i> would mean writing my own class to inherit from dict and converting
</I>&gt;<i> between them. I can't easily inherit util.FieldStorage because all my
</I>&gt;<i> code has standalone unittests which can't import _apache
</I>&gt;<i>
</I>&gt;<i> It's not the end of the world if util.FieldStorage isn't updated,  
</I>&gt;<i> but it
</I>&gt;<i> would make my life a lot simpler ;-) I may try and have a go at  
</I>&gt;<i> updating
</I>&gt;<i> it - is there any documentation on the best way to provide
</I>&gt;<i> patches/unittests for ModPython?
</I>&gt;<i>
</I>&gt;<i> Brian
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i> -----Original Message-----
</I>&gt;&gt;<i> From: Graham Dumpleton [mailto:<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">grahamd at dscpl.com.au</A>]
</I>&gt;&gt;<i> Sent: 26 October 2006 11:12
</I>&gt;&gt;<i> To: Brian Bird
</I>&gt;&gt;<i> Cc: <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">mod_python at modpython.org</A> '<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">mod_python at modpython.org</A>'
</I>&gt;&gt;<i> Subject: Re: [mod_python] util.FieldStorage
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Yes, FieldStorage in 3.3 is broken in as much as add_field() if  
</I>&gt;&gt;<i> called
</I>&gt;&gt;<i> after the first time that the 'dictionary' attribute is accessed in
</I>&gt;&gt;<i> some way,
</I>&gt;&gt;<i> does not result in that value ending up in the dictionary. Thus it is
</I>&gt;&gt;<i> not
</I>&gt;&gt;<i> visible to __getitem__(), has_key() etc.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Something else to fix. :-(
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Graham
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On 26/10/2006, at 7:56 PM, Graham Dumpleton wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> The util.FieldStorage implementation in mod_python 3.3 is quite a
</I>&gt;<i> bit
</I>&gt;&gt;&gt;<i> different to what is used in older versions of mod_python and which
</I>&gt;&gt;&gt;<i> you based your changes upon. Thus your changes are not compatible
</I>&gt;&gt;&gt;<i> with the new code base.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Some have talked about making the new implementation of the
</I>&gt;&gt;&gt;<i> FieldStorage class more dictionary like than it is, but no one has
</I>&gt;&gt;&gt;<i> stepped up to provide any changes.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> To be honest I haven't actually looked into how FieldStorage is
</I>&gt;&gt;&gt;<i> implemented as someone outside of the core developers provided
</I>&gt;&gt;&gt;<i> the updated code and it was integrated by someone other than
</I>&gt;&gt;&gt;<i> myself. Looking at the code now, I actually think it might be a bit
</I>&gt;&gt;&gt;<i> broken. I'll have to do some playing with the code.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> BTW, what benefits do you think you get if it is more dictionary
</I>&gt;<i> like?
</I>&gt;&gt;&gt;<i> I am not sure I understand the reason for making such changes in
</I>&gt;&gt;&gt;<i> the first place.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Graham
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> On 26/10/2006, at 7:14 PM, Brian Bird wrote:
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> Is there anything in the works to make util.FieldStorage act more
</I>&gt;&gt;&gt;&gt;<i> like a real dictionary? Specifically, it doesn't support the
</I>&gt;&gt;&gt;&gt;<i> __setitem__, __delitem__ methods. Since the documentation states
</I>&gt;&gt;&gt;&gt;<i> &quot;it can be treated like a dictionary&quot; I was surprised to find
</I>&gt;&gt;&gt;&gt;<i> these methods missing.
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> I know it's easy to change it to a real dictionary to get these
</I>&gt;&gt;&gt;&gt;<i> methods, but then you lose the (very useful) getlist() method. At
</I>&gt;&gt;&gt;&gt;<i> first glance it doesn't look like much work to add the extra
</I>&gt;&gt;&gt;&gt;<i> methods (but I haven't looked at how it may affect values which
</I>&gt;&gt;&gt;&gt;<i> aren't StringField's).
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> I've just looked in the latest subversion and found that the items
</I>&gt;&gt;&gt;&gt;<i> () method is now in util.FieldStorage, as well as a method
</I>&gt;&gt;&gt;&gt;<i> add_field() which looks suspiciously like __setitem__ should, but
</I>&gt;&gt;&gt;&gt;<i> no sign of a __delitem__. However, there now seems to be a
</I>&gt;&gt;&gt;&gt;<i> self.dictionary object which could be useful - perhaps all
</I>&gt;&gt;&gt;&gt;<i> unrecognised methods should be passed onto self.dictionary in the
</I>&gt;&gt;&gt;&gt;<i> __getattr__ instead of raising an AttributeError?
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> I've put below what I thought needed adding to the
</I>&gt;&gt;&gt;&gt;<i> util.FieldStorage class before I noticed self.dictionary in case
</I>&gt;&gt;&gt;&gt;<i> it's any help.
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> ### Disclaimer - completely untested! J ###
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> def __setitem__(self, key, value):
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i>     self.list.append(util.Field(key, cStringIO.StringIO(key),
</I>&gt;&gt;&gt;&gt;<i> &quot;text/plain&quot;, {}, None, {}))
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> def __delitem__(self, key):
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i>     for item in self.list:
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i>         if item.name == key:
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i>             self.list.remove(item)
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> def items(self):
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i>     result = []
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i>     for key in self.keys():
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i>         result.append((key, self[key]))
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i>     return result
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> def update(self, d):
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i>     for k in d.keys():
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i>         self[k] = d[k]
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;&gt;<i> Mod_python mailing list
</I>&gt;&gt;&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;&gt;&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mod_python mailing list
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I>
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="022393.html">[mod_python] util.FieldStorage
</A></li>
	<LI>Next message: <A HREF="022395.html">[mod_python] util.FieldStorage
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22394">[ date ]</a>
              <a href="thread.html#22394">[ thread ]</a>
              <a href="subject.html#22394">[ subject ]</a>
              <a href="author.html#22394">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="DISABLEhttp://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
