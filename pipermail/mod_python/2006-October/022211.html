<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] AddHandler / SetHandler (black magic)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20AddHandler%20/%20SetHandler%20%28black%20magic%29&In-Reply-To=ffa39deb0610060001x684c0d96w425e07989f5aca0b%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="022214.html">
   <LINK REL="Next"  HREF="022215.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] AddHandler / SetHandler (black magic)</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20AddHandler%20/%20SetHandler%20%28black%20magic%29&In-Reply-To=ffa39deb0610060001x684c0d96w425e07989f5aca0b%40mail.gmail.com"
       TITLE="[mod_python] AddHandler / SetHandler (black magic)">grahamd at dscpl.com.au
       </A><BR>
    <I>Fri Oct  6 06:53:12 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="022214.html">[mod_python] AddHandler / SetHandler (black magic)
</A></li>
        <LI>Next message: <A HREF="022215.html">[mod_python] webinterface for a local telnet server
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22211">[ date ]</a>
              <a href="thread.html#22211">[ thread ]</a>
              <a href="subject.html#22211">[ subject ]</a>
              <a href="author.html#22211">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On 06/10/2006, at 5:01 PM, marinus van aswegen wrote:

&gt;<i> Hi All
</I>&gt;<i>
</I>&gt;<i> I think i've just entered the real of apache config black magic.  
</I>&gt;<i> Just a quick report back.
</I>&gt;<i>
</I>&gt;<i> The to provide the necessary context, I would like to call my app  
</I>&gt;<i> <A HREF="http://url/app/function">http://url/app/function</A>
</I>&gt;<i> other resources like html files and images are in the same  
</I>&gt;<i> directory. A call to the url should redirect to app/index
</I>&gt;<i>
</I>&gt;<i> 1. I tried using the AddHandler but this forced me to add the .py  
</I>&gt;<i> extension
</I>
Use of AddHandler does not imply that .py must be used. This is  
explained
in my article. You do need to do more black magic Apache configuration
though to get it to work. I have made a slight change to the article  
to mention
AddHandler explicitly in the section which deals with resource  
extensions.

&gt;<i> 2. I tried using the SetHandler to force all calls to the directory  
</I>&gt;<i> to mod_python, this meant that other non python files could not be  
</I>&gt;<i> served.
</I>&gt;<i> 3. I then tried Grahams suggestion of excluding certain file types  
</I>&gt;<i> and forcing them to the default handler. This worked  however I  
</I>&gt;<i> ended up with a situation where the I could not invoke my app or  
</I>&gt;<i> serve the index.html file if the user requested the directory. For  
</I>&gt;<i> some strange reason the DirectoryIndex directive was being ignored.  
</I>&gt;<i> I assume this has something to do with the Publish and sethandler  
</I>&gt;<i> mix. Another bad side effect was that the user would be able to  
</I>&gt;<i> request the app.py directly and get the code (no no!)
</I>
That DirectoryIndex only comes into play when AddHandler is used and  
that
it is the responsibility of the handler to handle the request against  
the directory
when SetHandler was used was mentioned in my article. I have made a  
slight
change to the article now to make that more explicit that  
DirectoryIndex doesn't
apply when SetHandler is used.

&gt;<i> 4. Time for some black magic, I used the file directive to black  
</I>&gt;<i> all calls to pyc and py files (this is not a good security  
</I>&gt;<i> practise, It's much better to deny and explicitly permit than the  
</I>&gt;<i> other way around) I then set the handler depending on the content 
</I>&gt;<i> (see below).
</I>&gt;<i>
</I>&gt;<i> I read the config from my ubuntu box where with an AddHandler I was  
</I>&gt;<i> able to get Apache to behave like I wanted to and I found that I  
</I>&gt;<i> had to directory blocks one in the Vhost config and one in the main  
</I>&gt;<i> config file, I suspect there was some strange command interpolation  
</I>&gt;<i> going on there.  There must be a cleaner way of doing this?
</I>&gt;<i>
</I>&gt;<i> &lt;VirtualHost *:443&gt;
</I>&gt;<i>      DocumentRoot &quot;/opt/www&quot;
</I>&gt;<i>      ServerName www.test.co.za
</I>&gt;<i>
</I>&gt;<i>      SSLEngine on
</I>&gt;<i>      SSLCertificateFile /opt/keys/server.crt
</I>&gt;<i>      SSLCertificateKeyFile /opt/keys/server.key
</I>&gt;<i> &lt;/VirtualHost&gt;
</I>&gt;<i>
</I>&gt;<i> &lt;Directory &quot;/opt/www&gt;
</I>&gt;<i>
</I>&gt;<i>     # extend the pathon path so our python modules can be loaded
</I>&gt;<i>     PythonPath &quot;['/modules'] + sys.path&quot;
</I>&gt;<i>
</I>&gt;<i>     # set the handler to mod_python + publisher so we can call url/ 
</I>&gt;<i> python
</I>&gt;<i>     &lt;Files ~ &quot;^cmd$&quot;&gt;
</I>&gt;<i>         SetHandler mod_python
</I>&gt;<i>     &lt;/Files&gt;
</I>&gt;<i>
</I>&gt;<i>     PythonHandler mod_python.publisher
</I>&gt;<i>     PythonDebug On
</I>&gt;<i>
</I>&gt;<i>     # only permit access to the following files
</I>&gt;<i>     &lt;Files ~ &quot;\.(gif|html|jpg|png)$&quot;&gt;
</I>&gt;<i>         SetHandler default-handler
</I>&gt;<i>     &lt;/Files&gt;
</I>&gt;<i>
</I>&gt;<i> &lt;/Directory&gt;
</I>
Try:

&lt;Directory &quot;/opt/www&gt;

     # extend the pathon path so our python modules can be loaded
     PythonPath &quot;['/modules'] + sys.path&quot;

     AddHandler mod_python .py
     PythonHandler mod_python.publisher

     &lt;Files *.pyc&gt;
     deny from all
     &lt;/Files&gt;

     PythonDebug On

     Options MultiViews
     MultiviewsMatch Handlers

     AddType text/html;qs=1.0 .py
     AddType text/html;qs=0.9 .html
     AddType text/plain;qs=0.8 .txt

     DirectoryIndex index.py

&lt;/Directory&gt;

With this, requests against directory should get redirected to index.py
internally. You should also be able to access publisher code without
having to specific a .py extension. Ie., '/index' should work.

For anyone who missed the reference to the article originally, the URL
is:

   <A HREF="http://www.dscpl.com.au/wiki/ModPython/Articles/">http://www.dscpl.com.au/wiki/ModPython/Articles/</A> 
SetHandlerVersusAddHandler

Graham

&gt;<i> On 10/5/06, marinus van aswegen &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">mvanaswegen at gmail.com</A>&gt; wrote: Hi  
</I>&gt;<i> Graham
</I>&gt;<i>
</I>&gt;<i> Thanks for the comments, I'm going to try and use the sethandler  
</I>&gt;<i> because I don't want the .py extensions in the URL. I'll use the  
</I>&gt;<i> default handler to serve static content i.e. jpegs.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> SetHandler default-handler
</I>&gt;<i> I think there should be a big fat link on the mod_python front page  
</I>&gt;<i> to your articles section.
</I>&gt;<i>
</I>&gt;<i> Regards
</I>&gt;<i>
</I>&gt;<i> Marinus
</I>&gt;<i>
</I>&gt;<i> PS the mod_python FAQ was a bit confusing on this topic http:// 
</I>&gt;<i> www.modpython.org/FAQ/faqw.py?req=all#2.17
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> On 10/5/06, Graham Dumpleton &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">grahamd at dscpl.com.au</A> &gt; wrote: marinus  
</I>&gt;<i> van aswegen wrote ..
</I>&gt;<i> &gt; Hi All
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Let me pull this thread together. I had a working Apache2/ 
</I>&gt;<i> mod_python setup
</I>&gt;<i> &gt; on Ubuntu.
</I>&gt;<i> &gt; Mod_python was setup so that I could call my python ap url/app/func
</I>&gt;<i> &gt; all worked fine until i moved my app to fedora. i just got the app
</I>&gt;<i> &gt; working again but apache wont serve any other files like images now.
</I>&gt;<i> &gt; will hit the faq when i get home later.
</I>&gt;<i>
</I>&gt;<i> And it is because you are using the SetHandler directive. By using  
</I>&gt;<i> that
</I>&gt;<i> directive, all requests will be intercepted and sent through to  
</I>&gt;<i> mod_python.
</I>&gt;<i>
</I>&gt;<i> Read:
</I>&gt;<i>
</I>&gt;<i>    <A HREF="http://www.dscpl.com.au/wiki/ModPython/Articles/">http://www.dscpl.com.au/wiki/ModPython/Articles/</A> 
</I>&gt;<i> SetHandlerVersusAddHandler
</I>&gt;<i>
</I>&gt;<i> It explains the difference between SetHandler and AddHandler.
</I>&gt;<i>
</I>&gt;<i> You may just want to use:
</I>&gt;<i>
</I>&gt;<i>   AddHandler mod_python .py
</I>&gt;<i>
</I>&gt;<i> instead of SetHandler, but generally this means you need to use .py in
</I>&gt;<i> your URLs for Python stuff.
</I>&gt;<i>
</I>&gt;<i> Graham
</I>&gt;<i>
</I>&gt;<i> &gt; &lt;SNIP&gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; LoadModule python_module modules/mod_python.so
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; NameVirtualHost *:80
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &lt;VirtualHost *:80&gt;
</I>&gt;<i> &gt;     DocumentRoot &quot;/opt/www&quot;
</I>&gt;<i> &gt;     ServerName www.test.co.za
</I>&gt;<i> &gt;     DirectoryIndex index.html
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &lt;/VirtualHost&gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; # Virtual host Virtual Host 0
</I>&gt;<i> &gt; &lt;VirtualHost *:443&gt;
</I>&gt;<i> &gt;      DocumentRoot &quot;/opt/www&quot;
</I>&gt;<i> &gt;      ServerName www.test.co.za
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;     DirectoryIndex index.html
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;      SSLEngine on
</I>&gt;<i> &gt;      SSLCertificateFile /keys/server.crt
</I>&gt;<i> &gt;      SSLCertificateKeyFile /keys/server.key
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &lt;/VirtualHost&gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &lt;VirtualHost *:80&gt;
</I>&gt;<i> &gt;     DocumentRoot &quot;/opt/www.telic.co.za&quot;
</I>&gt;<i> &gt;     ServerName www.telic.co.za
</I>&gt;<i> &gt; &lt;/VirtualHost&gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &lt;Directory &quot;/&quot;&gt;
</I>&gt;<i> &gt;         Options FollowSymLinks
</I>&gt;<i> &gt;         AllowOverride None
</I>&gt;<i> &gt; &lt;/Directory&gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &lt;Directory &quot;/opt/www&quot;&gt;
</I>&gt;<i> &gt;      # extend the pathon path so our python modules can be loaded
</I>&gt;<i> &gt;     PythonPath &quot;['/opt/www'] + sys.path&quot;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;     # set the handler to mod_python + publisher so we can call  
</I>&gt;<i> url/python
</I>&gt;<i> &gt;     SetHandler mod_python
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;     PythonHandler mod_python.publisher
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;     PythonDebug On
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;     # do not permit access to compiled python code
</I>&gt;<i> &gt;         &lt;Files *.pyc&gt;
</I>&gt;<i> &gt;             deny from all
</I>&gt;<i> &gt;         &lt;/Files&gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &lt;/Directory&gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; On 10/3/06, Eric Brunson &lt; <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">brunson at brunson.com</A>&gt; wrote:
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; Colin Bean wrote:
</I>&gt;<i> &gt; &gt; &gt; Thanks for the correction, Eric; I've never actually done  
</I>&gt;<i> that and
</I>&gt;<i> &gt; &gt; &gt; assumed incorrectly.  Shame on me for recommending something  
</I>&gt;<i> that I
</I>&gt;<i> &gt; &gt; &gt; haven't tried!
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; No worries, we're all here to learn.  :-)
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; Marinus, what I should have asked originally was how apache was
</I>&gt;<i> &gt; &gt; &gt; failing with your config files (and what's in the error  
</I>&gt;<i> log).  What
</I>&gt;<i> &gt; &gt; &gt; does your &quot;limited success&quot; mean?
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; -Colin
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; _______________________________________________
</I>&gt;<i> &gt; &gt; Mod_python mailing list
</I>&gt;<i> &gt; &gt; <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;<i> &gt; &gt; <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; _______________________________________________
</I>&gt;<i> &gt; Mod_python mailing list
</I>&gt;<i> &gt; <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;<i> &gt; <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mod_python mailing list
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I></PRE>








<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="022214.html">[mod_python] AddHandler / SetHandler (black magic)
</A></li>
	<LI>Next message: <A HREF="022215.html">[mod_python] webinterface for a local telnet server
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22211">[ date ]</a>
              <a href="thread.html#22211">[ thread ]</a>
              <a href="subject.html#22211">[ subject ]</a>
              <a href="author.html#22211">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="DISABLEhttp://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
