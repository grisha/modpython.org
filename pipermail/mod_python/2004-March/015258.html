<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Lack of support for subrequests in mod_python?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Lack%20of%20support%20for%20subrequests%20in%20mod_python%3F&In-Reply-To=B02EAFE2-78F8-11D8-9BA6-000A957C9A50%40openinfo.co.uk">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="015256.html">
   <LINK REL="Next"  HREF="015248.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Lack of support for subrequests in mod_python?</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Gregory (Grisha) Trubetskoy</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Lack%20of%20support%20for%20subrequests%20in%20mod_python%3F&In-Reply-To=B02EAFE2-78F8-11D8-9BA6-000A957C9A50%40openinfo.co.uk"
       TITLE="[mod_python] Lack of support for subrequests in mod_python?">grisha at modpython.org
       </A><BR>
    <I>Thu Mar 18 13:18:48 EST 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="015256.html">[mod_python] Lack of support for subrequests in mod_python?
</A></li>
        <LI>Next message: <A HREF="015248.html">[mod_python] _apache module 
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15258">[ date ]</a>
              <a href="thread.html#15258">[ thread ]</a>
              <a href="subject.html#15258">[ subject ]</a>
              <a href="author.html#15258">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>

On Thu, 18 Mar 2004, Richard Barrett wrote:

&gt;<i> First up is the lack of access to running subequests using functions on
</I>&gt;<i> a request to analogues of the ap_sub_req_lookup_uri() and
</I>&gt;<i> ap_sub_req_lookup_file() functions, and their friends such as
</I>&gt;<i> ap_run_sub_req(). If I am correct and these capabilities are indeed
</I>&gt;<i> omitted, is there a good reason for me not to consider producing my own
</I>&gt;<i> fork of mod_python-3.1.3 in order to gain access to the functions from
</I>&gt;<i> my python code?
</I>
They aren't there because noone has needed them so far. Instead producing
a fork, why not subscribe to the <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">python-dev at httpd.apache.org</A> list and
submit a patch?

&gt;<i> Second up is a separate query about implementation style for
</I>&gt;<i> input/output filters; a Python output filter implementation I have just
</I>&gt;<i> done bringing the issue to mind. I found that successive calls into my
</I>&gt;<i> output filter function to service a particular request were passed a
</I>&gt;<i> succession of different Python filter objects during the life of
</I>&gt;<i> servicing the particular request. For a proxied request returning
</I>&gt;<i> around 80k bytes of data 3 or 4 different filter objects were passed
</I>&gt;<i> in, with the sum total of data from them being the whole of incoming
</I>&gt;<i> response's body. This contrasts with Apache's C API where the filter
</I>&gt;<i> function would be passed the same context data on each call for
</I>&gt;<i> servicing a given request. The filter I was writing needed state to be
</I>&gt;<i> carried from the inception of the request's processing until the EOS
</I>&gt;<i> bucket was encountered; the filter uses an incremental HTML parser with
</I>&gt;<i> a SAX interface which is being feed data progressively all of which is
</I>&gt;<i> not necessarily consumed during the life of my filter function's
</I>&gt;<i> invocation during which the data was read from the filter object. My
</I>&gt;<i> initial thought was that filter objects should have an attribute,
</I>&gt;<i> initialized to None, which my filter could use to store a state object
</I>&gt;<i> for recovery on each entry to my filter function. With such a state
</I>&gt;<i> variable unavailable, my second thought was to use a global dictionary
</I>&gt;<i> using the filter's id() as key to a state variable as value. But both
</I>&gt;<i> of there were non-starters because filter objects passed into my filter
</I>&gt;<i> function could be different throughout the life of the particular
</I>&gt;<i> filter invocation. I ended using the global dictionary idea but with
</I>&gt;<i> the request and server obeject id()s as key (belt and braces approaches
</I>&gt;<i> possibly). It works but feels a bit inelegant and I am wondering what
</I>&gt;<i> an &quot;expert&quot; would have done to solve the problem.
</I>
I cc-d the <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">python-dev at httpd</A> list, I think we should move it there since
this is very techical and concerns how mod_python works rather than how to
use it.

Reading the above - it's hard for me to say right off the bat why there is
a new filter object created every time - there may be a good reason for
it, or there may be no good reason at all.

This will definitely need some code studying, which, btw, you're more than
welcome to do. If you need a quick fix - then the filter.req I'm sure is
the same throughout the request, so you can store your data as an
attribute of the request object, rather than filter.

Grisha
</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="015256.html">[mod_python] Lack of support for subrequests in mod_python?
</A></li>
	<LI>Next message: <A HREF="015248.html">[mod_python] _apache module 
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15258">[ date ]</a>
              <a href="thread.html#15258">[ thread ]</a>
              <a href="subject.html#15258">[ subject ]</a>
              <a href="author.html#15258">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
