<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Win32 platform - test installers available
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Win32%20platform%20-%20test%20installers%20available&In-Reply-To=20040304115447.R32625%40onyx.ispol.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="015111.html">
   <LINK REL="Next"  HREF="015123.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Win32 platform - test installers available</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>David Fraser</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Win32%20platform%20-%20test%20installers%20available&In-Reply-To=20040304115447.R32625%40onyx.ispol.com"
       TITLE="[mod_python] Win32 platform - test installers available">davidf at sjsoft.com
       </A><BR>
    <I>Fri Mar  5 10:32:18 EST 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="015111.html">[mod_python] Win32 platform - test installers available
</A></li>
        <LI>Next message: <A HREF="015123.html">[mod_python] Win32 platform - test installers available
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15113">[ date ]</a>
              <a href="thread.html#15113">[ thread ]</a>
              <a href="subject.html#15113">[ subject ]</a>
              <a href="author.html#15113">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Gregory (Grisha) Trubetskoy wrote:

&gt;<i>On Thu, 4 Mar 2004, David Fraser wrote:
</I>&gt;<i>  
</I>&gt;<i>
</I>&gt;&gt;<i>Is there a reason there hasn't been a binary made for win32 yet?
</I>&gt;&gt;<i>    
</I>&gt;&gt;<i>
</I>&gt;<i>mainly because making one is a PITA... i'll get to it some time. if anyone
</I>&gt;<i>wants to volunteer, you are more than welcome
</I>&gt;<i>  
</I>&gt;<i>
</I>Cool. We need it for our apps, so I'll do this seeing as I have got it 
working now...

&gt;&gt;<i>I'll try and look at it myself now, but using VC++ 6 so may be difficult...
</I>&gt;&gt;<i>I am using Apache 2.0.48 win32 sources and Python 2.3.3 standard
</I>&gt;&gt;<i>distribution...
</I>&gt;&gt;<i>    
</I>&gt;&gt;<i>
</I>&gt;<i>you shouldn't need apache sources. just install the binary apache
</I>&gt;<i>distribution, but remember to click on the &quot;custom&quot; install and include
</I>&gt;<i>the header files.
</I>&gt;<i>  
</I>&gt;<i>
</I>Thanks, that's helpful...

&gt;&gt;<i>Compiling Apache for windows is described here:
</I>&gt;&gt;<i><A HREF="http://httpd.apache.org/docs-2.0/platform/win_compiling.html">http://httpd.apache.org/docs-2.0/platform/win_compiling.html</A>
</I>&gt;&gt;<i>That seems to work fine with VC++ 6
</I>&gt;&gt;<i>    
</I>&gt;&gt;<i>
</I>&gt;<i>see above; no need to compile apache
</I>&gt;<i>  
</I>&gt;<i>
</I>&gt;&gt;<i>Compiling mod_python for windows seems to require compiling in src based
</I>&gt;&gt;<i>on the project file for VC++7
</I>&gt;&gt;<i>    
</I>&gt;&gt;<i>
</I>&gt;<i>i actually use the .net version (is that same as 7?) - sorry, it's the
</I>&gt;<i>only thing i have access to.
</I>&gt;<i>  
</I>&gt;<i>
</I>Yes, .net is version 7. Likewise version 6 is the only one I have access 
to ... but shouldn't make much of a difference to people...

&gt;&gt;<i>I took the vc7to6_prjconverter tool from
</I>&gt;&gt;<i><A HREF="http://www.codeproject.com/tools/prjconverter.asp">http://www.codeproject.com/tools/prjconverter.asp</A> and converted the file
</I>&gt;&gt;<i>for VC++6
</I>&gt;&gt;<i>Then I had to manually change paths to point to my Apache include and
</I>&gt;&gt;<i>Release (lib) directories and my Python include and libs directories
</I>&gt;&gt;<i>    
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i>  
</I>&gt;<i>
</I>&gt;&gt;<i>(note that I didn't have to compile Python from source as the include
</I>&gt;&gt;<i>and libs are included with the standard distribution...)
</I>&gt;&gt;<i>    
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i>correct, no need to compile your own Python either
</I>&gt;<i>
</I>&gt;<i>  
</I>&gt;<i>
</I>&gt;&gt;<i>These originally are set as $(PYTHONSRC) and $(APACHESRC) in the include
</I>&gt;&gt;<i>and libs paths.
</I>&gt;&gt;<i>    
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i>yes. these are the only things you should set (in system preferences |
</I>&gt;<i>environment)
</I>&gt;<i>  
</I>&gt;<i>
</I>OK, Visual C++ 6 actually can handle these settings, I just had them 
wrong, so there are no changes needed to the generated .dsp file...

&gt;&gt;<i>I also had to manually add the srclib/apr/include and
</I>&gt;&gt;<i>srclib/apr-util/include directories from Apache to the include path, and
</I>&gt;&gt;<i>the srclib/apr/Release and srclib/apr-util/Release directories to the
</I>&gt;&gt;<i>library path.
</I>&gt;&gt;<i>    
</I>&gt;&gt;<i>
</I>&gt;<i>this is because you compiled your own apache
</I>&gt;<i>  
</I>&gt;<i>
</I>Right, I didn't need them when using the Apache installation + include + 
libs

&gt;&gt;<i>Then mod_python linked successfully!
</I>&gt;&gt;<i>    
</I>&gt;&gt;<i>
</I>&gt;<i>cool
</I>&gt;<i>  
</I>&gt;<i>
</I>&gt;&gt;<i>To build the win32 installer it needs to be done in the dist directory
</I>&gt;&gt;<i>(apparently under Unix)
</I>&gt;&gt;<i>I had troubles trying to run configure on MinGW as it needs an apxs to
</I>&gt;&gt;<i>find...
</I>&gt;&gt;<i>but the APXS is not actually needed for the setup script (the code that
</I>&gt;&gt;<i>used it is commented out)
</I>&gt;&gt;<i>So I ran configure on Linux, and built the installer there...
</I>&gt;&gt;<i>This is done by copying src/Release/mod_python.so to the dist directory.
</I>&gt;&gt;<i>    
</I>&gt;&gt;<i>
</I>&gt;<i>not anymore, it now can be done under windows. In fact it *has* to because
</I>&gt;<i>this step also compiles _psp.
</I>&gt;<i>  
</I>&gt;<i>
</I>Hmmm ... the setup.py seems to not compile _psp on windows... is there a 
reason for this?
I will try and merge the two setup approaches by autodetecting 
compilability...

&gt;<i>you DO need to manually create a setup.py from setup.py.in since
</I>&gt;<i>./configure, as you noted, won't work on windows
</I>&gt;<i>  
</I>&gt;<i>
</I>I have now done a fresh patch (similar to another I did) which means 
that setup.py no longer needs configure.
Basically I search through config.status and if that fails search 
through the sources to find MP_VERSION
This can now also detect the APXS version from config.status on Unix
In any case on Windows the config.status file is hard to generate ... 
maybe what's needed here are Windows-specific changes to enable 
configure to pick up the Apache path without apxs

A final change I could do to setup.py.in would be to include the
APXS = &quot;@APXS@&quot;
line, then autodetect if that has not been modified by configure, and do 
the search in that case only... but that may be getting a bit complex

This code seems to be used to find an installed mod_python.so file - but 
currently seems to not include it on Unix. Am I missing something?

&gt;&gt;<i>In fact I found that by simply copying the setup.py generated on Linux I
</I>&gt;&gt;<i>could run this on Windows
</I>&gt;&gt;<i>The instruction is:
</I>&gt;&gt;<i>  setup.py bdist_wininst --install-script=win32_postinstall.py
</I>&gt;&gt;<i>    
</I>&gt;&gt;<i>
</I>&gt;<i>perhaps distutils take care of it automtically, but I've always
</I>&gt;<i>done it separately, building the mod_python package for the standard lib,
</I>&gt;<i>which would be a step just before the bdist_wininst.
</I>&gt;<i>  
</I>&gt;<i>
</I>Yes, distutils should take care of this automatically...

&gt;<i>I had to copy src and mod_python (in lib/python) to under dist (on unix
</I>&gt;<i>the makefiles creates symlinks, but they don't work under windows, so you
</I>&gt;<i>have to copy), then run
</I>&gt;<i>
</I>&gt;<i>(This has to be run from the VC++ msdos shell, since it will invoke the
</I>&gt;<i>compiler to build _psp.so (or _psp.dll, don't remember))
</I>&gt;<i>
</I>&gt;<i> python setup.py build
</I>&gt;<i>
</I>&gt;<i>  
</I>&gt;<i>
</I>I'll start trying to work the above out, just wanted to get this patch 
off for comments...

&gt;&gt;<i>I hope the above instructions are useful to anyone else trying the same
</I>&gt;&gt;<i>thing.
</I>&gt;&gt;<i>    
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i>me too. And if someone would care to clean up the Windows build process
</I>&gt;<i>and make it seamless enough and contribute it as a patch, we would all
</I>&gt;<i>very much appreciate it. I personally dislike Windows so much, I don't
</I>&gt;<i>know that will ever bring myself to doing this - just building the Windows
</I>&gt;<i>installer is already such a horrifying experience that I usually don't
</I>&gt;<i>touch Windows for months thereafeter ;-)
</I>&gt;<i>  
</I>&gt;<i>
</I>:<i>-) Hopefully this is a step along the right direction, let me know
</I>
&gt;&gt;<i>I have not yet fully tested this binary or installer but it seemed to
</I>&gt;&gt;<i>run our applications fine.
</I>&gt;&gt;<i>mod_python.so and mod_python-3.1.3.win32.exe can be downloaded from:
</I>&gt;&gt;<i><A HREF="http://davidf.sjsoft.com/files/mod_python.so">http://davidf.sjsoft.com/files/mod_python.so</A>
</I>&gt;&gt;<i><A HREF="http://davidf.sjsoft.com/files/mod_python-3.1.3.win32.exe">http://davidf.sjsoft.com/files/mod_python-3.1.3.win32.exe</A>
</I>&gt;&gt;<i>    
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i>See if you can run the tests. You will have to manually rig a testconf.py
</I>&gt;<i>(NOTE - it will not like blanks in path names, e.g. &quot;Program Files&quot;, the
</I>&gt;<i>only work around I found was using the DOS path name, which you can
</I>&gt;<i>determine by firing up command.exe (as opposed to cmd.exe) i believe). But
</I>&gt;<i>once you get past the testconf.py, usually all tests run OK.
</I>&gt;<i>  
</I>&gt;<i>
</I>OK, I managed to fix the testconf.py, and will try look at 
autogenerating that too...
An initial problem, though, was that the LockFile directive is not 
included in Win32 Apache, so I have attached a patch to make this depend 
on mod_prefork

&gt;&gt;<i>I would appreciate feedback (on this list) so that hopefully these can
</I>&gt;&gt;<i>be included in the official release ...
</I>&gt;&gt;<i>    
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i>Thanks for trying!
</I>&gt;<i>
</I>&gt;<i>Grisha
</I>&gt;<i>  
</I>&gt;<i>
</I>My pleasure

David

-------------- next part --------------
A non-text attachment was scrubbed...
Name: setup-lookupall.patch
Type: text/x-patch
Size: 4505 bytes
Desc: not available
Url : <A HREF="http://mailman.modpython.org/pipermail/mod_python/attachments/20040305/840171d3/setup-lookupall.bin">http://mailman.modpython.org/pipermail/mod_python/attachments/20040305/840171d3/setup-lookupall.bin</A>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: test-win32.patch
Type: text/x-patch
Size: 573 bytes
Desc: not available
Url : <A HREF="http://mailman.modpython.org/pipermail/mod_python/attachments/20040305/840171d3/test-win32.bin">http://mailman.modpython.org/pipermail/mod_python/attachments/20040305/840171d3/test-win32.bin</A>
</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="015111.html">[mod_python] Win32 platform - test installers available
</A></li>
	<LI>Next message: <A HREF="015123.html">[mod_python] Win32 platform - test installers available
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15113">[ date ]</a>
              <a href="thread.html#15113">[ thread ]</a>
              <a href="subject.html#15113">[ subject ]</a>
              <a href="author.html#15113">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
