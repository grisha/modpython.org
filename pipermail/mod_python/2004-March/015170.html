<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Re: persistent, reliable globals
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Re%3A%20persistent%2C%20reliable%20globals&In-Reply-To=20040308114302.R36312-100000%40inman.medianstrip.net">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="015168.html">
   <LINK REL="Next"  HREF="015171.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Re: persistent, reliable globals</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Ben</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Re%3A%20persistent%2C%20reliable%20globals&In-Reply-To=20040308114302.R36312-100000%40inman.medianstrip.net"
       TITLE="[mod_python] Re: persistent, reliable globals">ben at medianstrip.net
       </A><BR>
    <I>Mon Mar  8 19:52:55 EST 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="015168.html">[mod_python]  Supporting legacy PHP pages while still giving
	mod_python the root
</A></li>
        <LI>Next message: <A HREF="015171.html">[mod_python] Re: persistent, reliable globals
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15170">[ date ]</a>
              <a href="thread.html#15170">[ thread ]</a>
              <a href="subject.html#15170">[ subject ]</a>
              <a href="author.html#15170">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello all,

After grovelling mod_python, mod_perl, and Apache API docs, what i've
discovered is this:

If you just want to initialize a global variable, you can probably do
that using the &quot;PythonImport&quot; directive.  in short:

ServerName foo.com
PythonPath &quot;sys.path+['/path/to/MyGlobals']&quot;
PythonImport MyGlobals foo.com

or something like this, depending on how you set the
PythonInterpPerDirective/Directory settings.  PythonImport happens
per-subinterpreter (not for the main interpreter, nor per-thread),
inside of the apache per-child hook.  This of course will only be
shared within a child process, within a named subinterpreter.  There
are good docs on how it is used in the mod_python manuals.

More examples:

PythonInterpPerDirective
&lt;Directory /mydir&gt;
	AddHandler mod_python .py
	PythonHandler mod_python.publisher
	PythonPath &quot;sys.path+['/path/to/MyGlobals']&quot;
	PythonImport MyGlobals /mydir
&lt;/Directory&gt;

OR

# Creates a subinterpreter &quot;MyInterpreter&quot; which handles the
# requests in this scope to be run there
PythonInterpreter MyInterpreter
PythonPath &quot;sys.path+['/path/to/MyGlobals']&quot;
PythonImport MyGlobals MyInterpreter

There are some caveats, however:

1) The imports happen at child initialization time, when a lot of the
configuration hasn't been merged in yet.  This includes:
PythonInterpreter (!!!), PythonOptions, ....

2) PythonImport is not really subinterpreter-scoped: it is a global
directive that specifies the interpreter name.  Plus PythonInterpreter
isn't in effect at the time of import, either.  It would be nice to
have a directive like

PythonInterpInit Foo

which would affect the interpreter &quot;in the current scope&quot; in the
apache configuration -- i.e. at the virtual server level by default,
or per directive / directory if those options are used.

3) This is not entirely specific to PythonImport, but it is difficult
in general to get your hands on configuration variables
(PythonOption-s, in particular) not in the context of a request.  It
would be nice if each subinterpreter had access to the Apache
configuration variables (e.g. PythonOptions) scope-local to it.

As a workaround, I'm using named interpreters and moving all
sub-interpreter-specific configuration into importable files.

4) Running with PythonAutoReload may still kill global variables if
you're not careful.

B

ps put this into the FAQ?

On Mon, 8 Mar 2004, Ben wrote:

&gt;<i> Hello,
</I>&gt;<i>
</I>&gt;<i> it seems like this is a question that is asked enough to be worth
</I>&gt;<i>
</I>&gt;<i> a) putting into the FAQ (for now), and
</I>&gt;<i> b) eventually trying to solve.
</I>&gt;<i>
</I>&gt;<i> i used to do some apache API coding so i'd be willing to look into
</I>&gt;<i> trying to support per-child (and possibly per-thread) initialization
</I>&gt;<i> code.  i remember this used to be possible, and looking at mod_perl i
</I>&gt;<i> see it has a PerlChildExitHandler.
</I>&gt;<i>
</I>&gt;<i> <A HREF="http://perl.apache.org/docs/2.0/user/handlers/server.html">http://perl.apache.org/docs/2.0/user/handlers/server.html</A>
</I>&gt;<i>
</I>&gt;<i> i'll start code-diving today, and let people know what i find.  (oh
</I>&gt;<i> woe to the python programmer who has to read C!)
</I>&gt;<i>
</I>&gt;<i> take care, B
</I>&gt;<i>
</I>&gt;<i> ps i happen to want this for my project, which is an object / aspect
</I>&gt;<i> oriented servlet framework, that supports mixin-style functionality
</I>&gt;<i> for session-based authentication, caching, etc.  i plan on releasing
</I>&gt;<i> that too, after some bugfixes and documentation.
</I>

</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="015168.html">[mod_python]  Supporting legacy PHP pages while still giving
	mod_python the root
</A></li>
	<LI>Next message: <A HREF="015171.html">[mod_python] Re: persistent, reliable globals
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15170">[ date ]</a>
              <a href="thread.html#15170">[ thread ]</a>
              <a href="subject.html#15170">[ subject ]</a>
              <a href="author.html#15170">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
