<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] server cleanup 
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20server%20cleanup%20&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="015201.html">
   <LINK REL="Next"  HREF="015212.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] server cleanup </H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Michael C. Neel</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20server%20cleanup%20&In-Reply-To="
       TITLE="[mod_python] server cleanup ">neel at mediapulse.com
       </A><BR>
    <I>Thu Mar 11 10:27:57 EST 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="015201.html">Pylets (was RE: [mod_python] persistent, reliable globals)
</A></li>
        <LI>Next message: <A HREF="015212.html">Pylets (was RE: [mod_python] persistent, reliable globals)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15211">[ date ]</a>
              <a href="thread.html#15211">[ thread ]</a>
              <a href="subject.html#15211">[ subject ]</a>
              <a href="author.html#15211">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Actually, everything is correct here, server.register_cleanup is
intended to take a request object.

There are two cleanups you can use in Apache (I don't know if mod_pytohn
does them both, going off of Apache API here).  One is the request
cleanup, the other server cleanup.

Request cleanup is run as the very last phase of the request, after the
logging phase and after the client connection is closed.  Anything that
you need to custom delete from a request can be done here, but sometimes
you want to keep something arounf for another request - an example is
the log file it self, you don't want to open and close this file each
request, but rather open it the first request and keep it open for all
requests following.

This is where server cleanup comes it.  It is registered from a request,
but doesn't execute until the server is shutdown.  This means the parent
apache process is killed, not the children.  So in code you would see if
the log file was open, if not open it and register a server cleanup to
close it.  If it was open, just get the file handle.

The advantage of this method over serverinit/servershutdown and
childinit/childshutdown (not currently supported in mod_python, but in
the Apache API) is that setup can be done at request time, per directoy
and/or query args, for very unique requirments.

It's very dated now, but the Orilley book &quot;Apache Modules in C and Perl&quot;
is probably the best thing out there for understanding the Apache API.
It's not hard to read that and then take it to mod_python.  Maybe the
next edition will be &quot;Apache Modules in C, Perl and Python&quot;? =)

Mike


&gt;<i> -----Original Message-----
</I>&gt;<i> From: Ben [mailto:<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">ben at medianstrip.net</A>] 
</I>&gt;<i> Subject: Re: [mod_python] server cleanup 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> ah, interesting.  something for a the FAQ i guess.  hope you don't
</I>&gt;<i> mind me quoting you there.
</I>&gt;<i> 
</I>&gt;<i> B
</I>&gt;<i> 
</I>&gt;<i> On Thu, 11 Mar 2004, Gregory Bond wrote:
</I>&gt;<i> 
</I>&gt;<i> &gt; (IIUC from last time this was asked...)
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; because apache lazy-evaluates the config info and only 
</I>&gt;<i> builds server objects
</I>&gt;<i> &gt; when a request for that (possibly virtual) server arrives.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>
</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="015201.html">Pylets (was RE: [mod_python] persistent, reliable globals)
</A></li>
	<LI>Next message: <A HREF="015212.html">Pylets (was RE: [mod_python] persistent, reliable globals)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#15211">[ date ]</a>
              <a href="thread.html#15211">[ thread ]</a>
              <a href="subject.html#15211">[ subject ]</a>
              <a href="author.html#15211">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
