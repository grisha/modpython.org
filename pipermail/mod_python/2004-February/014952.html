<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] setting content_type intelligently
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20setting%20content_type%20intelligently&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014950.html">
   <LINK REL="Next"  HREF="014955.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] setting content_type intelligently</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Michael C. Neel</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20setting%20content_type%20intelligently&In-Reply-To="
       TITLE="[mod_python] setting content_type intelligently">neel at mediapulse.com
       </A><BR>
    <I>Thu Feb  5 12:01:38 EST 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="014950.html">[mod_python] setting content_type intelligently
</A></li>
        <LI>Next message: <A HREF="014955.html">[mod_python] setting content_type intelligently
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14952">[ date ]</a>
              <a href="thread.html#14952">[ thread ]</a>
              <a href="subject.html#14952">[ subject ]</a>
              <a href="author.html#14952">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Well, imho when things get painful it's usally time to consider
something's not right =).

As a hail mary play, I believe there is a phase of the request where
apache goes searching the disk for the file, separate from the content
handling phase.  This is where DocumentRoot, Alias, ScriptAlias, etc are
all handled.  You could handle this yourself, and when you image request
comes in, set the required pieces of the request data to state the
location of the image on disk.  The your content handler would return
apache.DECLINED, and then apache mime magic would take over.

FYI apache's mime handling is just extension based.  The mapping is
either defined in the conf files (something called mime.conf fulle of
AddTypes) or can be told to use the /etc/mime.types file.  If your
concern is images only, python's stdlib imghdr module, which can tell
the image type by looking at the first few bytes of the file, and works
for the images files that would be used in a web page.  If you also have
other data, such as pdf's, then best to go with mime.types.  If your
apache is using /etc/mime.types, then you can have mimetypes also use
that file.  See what your mimetypes.knownfiles are, and run
mimetypes.init() to load the files listed (if they exist).

let me know if any of the above pan out,
mike

&gt;<i> I'm aware I can (technically) return apache.DECLINED, it's just that
</I>&gt;<i> it doesn't work for me because the images are outside of DocumentRoot.
</I>&gt;<i> 
</I>...
&gt;<i> For cultural reasons this is not feasible for this app.  My users
</I>&gt;<i> demand their images be &quot;near&quot; their docs.  Oh, tho I've tried to press
</I>&gt;<i> the issue.
</I>
</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="014950.html">[mod_python] setting content_type intelligently
</A></li>
	<LI>Next message: <A HREF="014955.html">[mod_python] setting content_type intelligently
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14952">[ date ]</a>
              <a href="thread.html#14952">[ thread ]</a>
              <a href="subject.html#14952">[ subject ]</a>
              <a href="author.html#14952">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
