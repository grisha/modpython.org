<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Any support for on-time Initialization?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Any%20support%20for%20on-time%20Initialization%3F&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014924.html">
   <LINK REL="Next"  HREF="014926.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Any support for on-time Initialization?</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Michael C. Neel</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Any%20support%20for%20on-time%20Initialization%3F&In-Reply-To="
       TITLE="[mod_python] Any support for on-time Initialization?">neel at mediapulse.com
       </A><BR>
    <I>Mon Feb  2 14:33:55 EST 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="014924.html">[mod_python] Conditional handlers?
</A></li>
        <LI>Next message: <A HREF="014926.html">[mod_python] Conditional handlers?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14925">[ date ]</a>
              <a href="thread.html#14925">[ thread ]</a>
              <a href="subject.html#14925">[ subject ]</a>
              <a href="author.html#14925">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;<i>From my own adventures, MySQL is okay with having a large number of
</I>connections open - it doesn't seem to affect performance.  Just make
sure your connection limit is set at or higher than your apache process
limit; there will be a one-to-one tie here assuming each apache child
makes only one connection.

Also, MySQL seems to be okay with not getting an explicit db.close()
call, so you can connect to the database either in the first request and
reuse that from there on out, or connect when the module is imported,
like such:

from modpython import apache
import MySQLdb

db = MySQLdb.connect()

def handler(req):
	c = db.cursor()
	## do stuff
	c.close()
	
	return apache.OK

Which can be the easiest if your database settings can be hard coded.
Like Daniel said, going with a threaded MPM is not for the faint of
heart, as MySQLdb doesn't like sharing connections very much.

If your not using MySQL you may be able to get away with the above, but
do some testing first to be safe.


&gt;<i> -----Original Message-----
</I>&gt;<i> From: Daniel West [mailto:<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">dwmp at opti.cgi.net</A>] 
</I>&gt;<i> Sent: Monday, February 02, 2004 1:30 PM
</I>&gt;<i> To: <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">mod_python at modpython.org</A>
</I>&gt;<i> Subject: Re: [mod_python] Any support for on-time Initialization?
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Jalil,
</I>&gt;<i> 
</I>&gt;<i> The best way to setup database connections is just to wait 
</I>&gt;<i> for the first 
</I>&gt;<i> request to come in.  Keep your database connection in a 
</I>&gt;<i> module name space 
</I>&gt;<i> that all of your pages share and it'll persist between 
</I>&gt;<i> connections so long 
</I>&gt;<i> as you don't explicitly close it.  Once you import a module 
</I>&gt;<i> it stays in the 
</I>&gt;<i> interpreter name space between requests so future requests 
</I>&gt;<i> have access to 
</I>&gt;<i> the module without having to load it again.
</I>&gt;<i> 
</I>&gt;<i> If you're interested in keeping &quot;pools&quot; of database 
</I>&gt;<i> connections then you 
</I>&gt;<i> may be considering one of the multi-threaded MPM's for Apache 
</I>&gt;<i> 2.  You'll 
</I>&gt;<i> save yourself a lot of hair pulling if you stick with the 
</I>&gt;<i> prefork mpm.  It 
</I>&gt;<i> bears saying that in the prefork mpm, each process does not share 
</I>&gt;<i> interpreter resources with the other processes.  This means 
</I>&gt;<i> each process 
</I>&gt;<i> will have it's own &quot;pool&quot; of database connections which may 
</I>&gt;<i> not bode well 
</I>&gt;<i> with your database server if you run a moderately heavy Apache load.
</I>&gt;<i> 
</I>&gt;<i> -Dan
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> At 10:12 AM 2/2/2004 -0800, you wrote:
</I>&gt;<i> &gt;I was wondering if there is any support for one-time 
</I>&gt;<i> initialization for 
</I>&gt;<i> &gt;applications in mod-python - similar to the init() call of a 
</I>&gt;<i> servlet for 
</I>&gt;<i> &gt;example. I would like to set up a database connection pool 
</I>&gt;<i> but I need to 
</I>&gt;<i> &gt;do it only once when my app starts.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;If there is no support for initialization, what is the best 
</I>&gt;<i> way to set up 
</I>&gt;<i> &gt;things that need to be set up only once per app in mod-python?
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;Thanks,
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;-Jalil
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;_______________________________________________
</I>&gt;<i> &gt;Mod_python mailing list
</I>&gt;<i> &gt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;<i> &gt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mod_python mailing list
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I>&gt;<i> 
</I>
</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="014924.html">[mod_python] Conditional handlers?
</A></li>
	<LI>Next message: <A HREF="014926.html">[mod_python] Conditional handlers?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14925">[ date ]</a>
              <a href="thread.html#14925">[ thread ]</a>
              <a href="subject.html#14925">[ subject ]</a>
              <a href="author.html#14925">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
