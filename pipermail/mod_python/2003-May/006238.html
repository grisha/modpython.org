<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] mod_python slowness
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20mod_python%20slowness&In-Reply-To=20030516120158.K6045-100000%40oldchief.reply.net">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="006237.html">
   <LINK REL="Next"  HREF="006235.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] mod_python slowness</H1>
    <B>Alex Turner</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20mod_python%20slowness&In-Reply-To=20030516120158.K6045-100000%40oldchief.reply.net"
       TITLE="[mod_python] mod_python slowness">aturner at neteconomist.com
       </A><BR>
    <I>Fri May 16 12:27:38 EST 2003</I>
    <P><UL>
        <LI>Previous message: <A HREF="006237.html">[mod_python] mod_python slowness
</A></li>
        <LI>Next message: <A HREF="006235.html">[mod_python] mod_python for python 2.3
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6238">[ date ]</a>
              <a href="thread.html#6238">[ thread ]</a>
              <a href="subject.html#6238">[ subject ]</a>
              <a href="author.html#6238">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<table border=0 width="100%"><tr><td>
<!--beginarticle-->
<PRE>
DOH!

I found the problem.  And can easily explain the discrepancy between
running the script stand alone vs in apache.  There is one major
difference between apache, and standalone: Cookies.  My Container object
that is passed to each tag function was fetching the cookies from the
request object for each execution! I moved the code into the right place,
i.e. where the request object initialy get's dealt with, and that has
of course cured the problem!

Many thanks to all who have replied.

And as a random editorial, I have to say that I enjoy working with 
mod_python/python as a web platform far more than any other I've used 
previously including php, perl, java and coldfusion.  It has both the 
flexibility and the power to make web development fast and easy (thank 
goodness for proper stack traces and a consistance language API!)

Alex Turner
NetEconomist

On Fri, 16 May 2003, Gregory (Grisha) Trubetskoy wrote:

&gt;<i> 
</I>&gt;<i> The times listed below, are these averages of multiple iterations (e.g.
</I>&gt;<i> 10000) or just a one time try?
</I>&gt;<i> 
</I>&gt;<i> Anyway - it doesn't look like this is where the bottleneck is - you
</I>&gt;<i> mentioned before that a page that took 2.2 seconds to load takes 23
</I>&gt;<i> seconds - that's almost 21 seconds of difference whereas below you have a
</I>&gt;<i> slowdown of 0.8 secs.
</I>&gt;<i> 
</I>&gt;<i> Grisha
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> On Fri, 16 May 2003, Alex Turner wrote:
</I>&gt;<i> 
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; It's very unlikely to be a network problem because both the database and
</I>&gt;<i> &gt; the web server are running on the same host.  The timings that I took were
</I>&gt;<i> &gt; done by placing a start=time.time() at the top of the code section that
</I>&gt;<i> &gt; executes
</I>&gt;<i> &gt; the file, and a print time.time()-start at the end, so I'm fairly
</I>&gt;<i> &gt; convinced that these are accurate.  I then placed more time tests around
</I>&gt;<i> &gt; other parts of the mechanism which allowed me to gauge how long each
</I>&gt;<i> &gt; segment of the run takes.  I have found a serious flaw in my database
</I>&gt;<i> &gt; class, having corrected that though, I found something interesting:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; This is my init routine for by DBResult class:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; def __init__(self,query):
</I>&gt;<i> &gt;  start=time.time()
</I>&gt;<i> &gt;  self.query=query
</I>&gt;<i> &gt;  self.counter=0;
</I>&gt;<i> &gt;  self.lresults_l=self.query.getresult()
</I>&gt;<i> &gt;  self.dresults_l=self.query.dictresult()
</I>&gt;<i> &gt;  self.fresults_l=[]
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;  # Copy the indexed/dict values into fresults
</I>&gt;<i> &gt;  for a in range(len(self.lresults_l)):
</I>&gt;<i> &gt;    x=0
</I>&gt;<i> &gt;    self.fresults_l.append({})
</I>&gt;<i> &gt;    for b in self.lresults_l[a]:
</I>&gt;<i> &gt;       self.fresults_l[a][x]=b
</I>&gt;<i> &gt;       x=x+1
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;    for b in self.dresults_l[a].keys():
</I>&gt;<i> &gt;       self.fresults_l[a][b]=self.dresults_l[a][b]
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;  print &quot;Init time %f&lt;br&gt;\n&quot; % (time.time()-start)
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; It's not pretty, but it does show something wierd:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; inside apache this gives a time of: 0.178554 secs
</I>&gt;<i> &gt; outside apache this gives a time of: 0.093750 secs
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; almost twice as fast.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Maybe this is a pg module problem, I don't know, but it's certainly wierd!
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Alex Turner
</I>&gt;<i> &gt; NetEconomist
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; On Tue, 13 May 2003, Jack Diederich wrote:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; I'm pretty sure this is not a DNS problem.  I can break down each loop
</I>&gt;<i> &gt; &gt; &gt; that calls the database, and it shows 0.7 seconds per row returning
</I>&gt;<i> &gt; &gt; &gt; instead of like 0.03 seconds.  The dns servers are all configured
</I>&gt;<i> &gt; &gt; &gt; correctly for both forward and reverse lookups, and I do not have the same
</I>&gt;<i> &gt; &gt; &gt; problems in PHP (other the fact that PHP is crap compared to python - but
</I>&gt;<i> &gt; &gt; &gt; it's not this slow).
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; Are you doing anything wierd like running apache or progres
</I>&gt;<i> &gt; &gt; through inetd (so it has to start a new process for every
</I>&gt;<i> &gt; &gt; request)?  Or are you doing a new database connection for
</I>&gt;<i> &gt; &gt; each row?
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; If the identical python program takes 1/10th the time running
</I>&gt;<i> &gt; &gt; stand-alone I think the DNS was one the right track - it must
</I>&gt;<i> &gt; &gt; be a network related problem.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; You might also want to print to the resulting page the time
</I>&gt;<i> &gt; &gt; the process took from start to finish.  If the page is very
</I>&gt;<i> &gt; &gt; complicated it might look slower even if it isn't.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; You can also try commenting out all the database calls and
</I>&gt;<i> &gt; &gt; timing the stand alone and mod_python versions.  That will
</I>&gt;<i> &gt; &gt; at least allow you to narrow down the problem.  Also consider
</I>&gt;<i> &gt; &gt; using 'strace' on the stand alone and the apache version.
</I>&gt;<i> &gt; &gt; Compare the system calls between the two to see if something
</I>&gt;<i> &gt; &gt; pathological is happening in the mod_python case.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; -jack
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; _______________________________________________
</I>&gt;<i> &gt; Mod_python mailing list
</I>&gt;<i> &gt; <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;<i> &gt; <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I>&gt;<i> &gt;
</I>&gt;<i> 
</I>
</PRE>
<!--endarticle-->
</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="006237.html">[mod_python] mod_python slowness
</A></li>
	<LI>Next message: <A HREF="006235.html">[mod_python] mod_python for python 2.3
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#6238">[ date ]</a>
              <a href="thread.html#6238">[ thread ]</a>
              <a href="subject.html#6238">[ subject ]</a>
              <a href="author.html#6238">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
