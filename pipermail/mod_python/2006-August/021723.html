<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Upload progress indicator shows after upload?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Upload%20progress%20indicator%20shows%20after%20upload%3F&In-Reply-To=1154560845.10027%40dscpl.user.openhosting.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021719.html">
   <LINK REL="Next"  HREF="021726.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Upload progress indicator shows after upload?</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Colin Bean</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Upload%20progress%20indicator%20shows%20after%20upload%3F&In-Reply-To=1154560845.10027%40dscpl.user.openhosting.com"
       TITLE="[mod_python] Upload progress indicator shows after upload?">ccbean at gmail.com
       </A><BR>
    <I>Wed Aug  2 21:05:44 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="021719.html">[mod_python] Upload progress indicator shows after upload?
</A></li>
        <LI>Next message: <A HREF="021726.html">[mod_python] Upload progress indicator shows after upload?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21723">[ date ]</a>
              <a href="thread.html#21723">[ thread ]</a>
              <a href="subject.html#21723">[ subject ]</a>
              <a href="author.html#21723">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Definitely, I should have mentioned that the communication between the
filter and the handler would be a significant problem in itself.
Hopefully my initial description was scary enough that nobody tried it
:<i>P
</I>
I can see how an impatient user would think that a file upload wasn't
&quot;working&quot; if the browser didn't give them any feedback, but hopefully
anybody uploading very large files to your server can be trusted
understand the delay, or at least read some instructions that you
provide for them.

Enough veering off topic; but I think part of the point here is that
any kind of progress bar like this is limited by the way HTTP file
uploads work, so this isn't really specific to mod_python. If a
framework somewhere provides an upload bar (using HTTP / HTML, at
least), it seems like it would have to use a kludge similar to what I
described above.  Correct me if I'm wrong...

-Colin


On 8/2/06, Graham Dumpleton &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">grahamd at dscpl.com.au</A>&gt; wrote:
&gt;<i> Colin Bean wrote ..
</I>&gt;<i> &gt; Unfortunately, what you're trying to do is more complicated than this.
</I>&gt;<i> &gt;  First of all, by the time your handler is called, the file has
</I>&gt;<i> &gt; already been sent over the network, and your handler is only reading
</I>&gt;<i> &gt; it from a tempfile on disk.  Also, a handler only sends one response
</I>&gt;<i> &gt; back after running to completion, so your code is behaving as
</I>&gt;<i> &gt; expected.  It finishes processing the file upload (including doing
</I>&gt;<i> &gt; everything in your loop), and when it's finished it sends a response
</I>&gt;<i> &gt; back to the client.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Sorry I can't provide more constructive feedback having never actually
</I>&gt;<i> &gt; implemented something like this.  To take a guess at it, you'd need to
</I>&gt;<i> &gt; use an InputFilter to examine the upload request as it is read (I
</I>&gt;<i> &gt; believe this phase happens before the tempfile is written to disk),
</I>&gt;<i> &gt; and this would need to somehow communicate with another mod_python
</I>&gt;<i> &gt; handler which would return the current upload progress.  The client
</I>&gt;<i> &gt; page wold have to keep polling this handler (with an XMLHttpRequest,
</I>&gt;<i> &gt; perhaps) and display the results it gets with each poll.  Yeah, it's
</I>&gt;<i> &gt; pretty ugly...
</I>&gt;<i>
</I>&gt;<i> Except that a subsequent request to try and monitor progress may in a multi
</I>&gt;<i> process version of Apache end up at a different process and will not have
</I>&gt;<i> access to where the original request is up to.
</I>&gt;<i>
</I>&gt;<i> In short, there are many reasons why a progress meter is hard to implement and
</I>&gt;<i> may not even give a correct indication of what is happening anyway.
</I>&gt;<i>
</I>&gt;<i> Personally, I am not sure what the fascination is with them besides the eye
</I>&gt;<i> candy value of it.
</I>&gt;<i>
</I>&gt;<i> Graham
</I>&gt;<i>
</I>&gt;<i> &gt; HTH,
</I>&gt;<i> &gt; Colin
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; On 8/1/06, jadacyrus &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">jadacyrus at gmail.com</A>&gt; wrote:
</I>&gt;<i> &gt; &gt; Essentially this is what I have setup for my upload script:
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; [code]
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; #HTML Stuff here
</I>&gt;<i> &gt; &gt; #Declare variables etc...
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;     while bytes_left &gt;= 0:
</I>&gt;<i> &gt; &gt;             fileData = req.form['filename'].file.read(1024)
</I>&gt;<i> &gt; &gt;             filebuffer = filebuffer + fileData
</I>&gt;<i> &gt; &gt;             bytes_left = bytes_left - 1024
</I>&gt;<i> &gt; &gt;             bytes_read = bytes_read + 1024
</I>&gt;<i> &gt; &gt;             percent = bytes_read/int(length) * 100
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; #Some nested IF statements to display a progress indicator using images
</I>&gt;<i> &gt; &gt; based on the percent variable.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; [/code]
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; This is contained in my upload.py in the function upFile which is called
</I>&gt;<i> &gt; &gt; from the POST method. However, It seems that the file uploads completely
</I>&gt;<i> &gt; &gt; first and then it will show the progress indications afterwards. However
</I>&gt;<i> &gt; &gt; this doesn't seem to be logically what my code should be doing. I'm
</I>&gt;<i> &gt; &gt; somewhat new to mod_python but not python in general, any suggestions?
</I>&gt;<i> &gt; &gt; _______________________________________________
</I>&gt;<i> &gt; &gt; Mod_python mailing list
</I>&gt;<i> &gt; &gt; <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;<i> &gt; &gt; <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; _______________________________________________
</I>&gt;<i> &gt; Mod_python mailing list
</I>&gt;<i> &gt; <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;<i> &gt; <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I>&gt;<i>
</I></PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="021719.html">[mod_python] Upload progress indicator shows after upload?
</A></li>
	<LI>Next message: <A HREF="021726.html">[mod_python] Upload progress indicator shows after upload?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21723">[ date ]</a>
              <a href="thread.html#21723">[ thread ]</a>
              <a href="subject.html#21723">[ subject ]</a>
              <a href="author.html#21723">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="DISABLEhttp://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
