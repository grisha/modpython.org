<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] For what session locking is? Do i need it while
	using MySQL?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20For%20what%20session%20locking%20is%3F%20Do%20i%20need%20it%20while%0A%09using%20MySQL%3F&In-Reply-To=151314394203.20060810235754%40zdisk.net">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021788.html">
   <LINK REL="Next"  HREF="021800.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] For what session locking is? Do i need it while
	using MySQL?</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Jim Gallacher</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20For%20what%20session%20locking%20is%3F%20Do%20i%20need%20it%20while%0A%09using%20MySQL%3F&In-Reply-To=151314394203.20060810235754%40zdisk.net"
       TITLE="[mod_python] For what session locking is? Do i need it while
	using MySQL?">jpg at jgassociates.ca
       </A><BR>
    <I>Fri Aug 11 12:27:55 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="021788.html">[mod_python] For what session locking is? Do i need it while
	using MySQL?
</A></li>
        <LI>Next message: <A HREF="021800.html">[mod_python] For what session locking is? Do i need it while
	using MySQL?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21809">[ date ]</a>
              <a href="thread.html#21809">[ thread ]</a>
              <a href="subject.html#21809">[ subject ]</a>
              <a href="author.html#21809">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Norman Tindall wrote:
&gt;<i> Hello Jim,
</I>&gt;<i> 
</I>&gt;<i>       I describe you the session locking mechanizm as i see,
</I>&gt;<i>       correct me if i am wrong.
</I>&gt;<i> 
</I>&gt;<i>       As to lock subroutine in _apache we passing:
</I>&gt;<i>       1 - server object
</I>&gt;<i>       2 - session_id
</I>&gt;<i>       From this i can tell that in fact locked session_ids (session
</I>&gt;<i>       data locked indirect)
</I>&gt;<i> 
</I>&gt;<i>       +----------------------------------------------+---------------------+
</I>&gt;<i>       |  session_id                       |  status  | serv that aq  lock  |
</I>&gt;<i>       +----------------------------------------------+---------------------+
</I>&gt;<i>       |  5540fda192a40b4acd084decdb6f66ed |  locked  | thread 1 server id
</I>&gt;<i>       |  9ec0c48867bff638b7a790c314ed52ff |  locked  | thread 4 server id
</I>&gt;<i>       |  .. .. .. .. .. .. .. .. .. .. .. .. .... .... .... .... ..
</I>&gt;<i>       +-------------------------------------------------------------------
</I>&gt;<i>           ^     |            ^           |                 ^      |
</I>&gt;<i>    1)Lock |     |            | 4)Lock    |         7)Lock  |      |
</I>&gt;<i>           | 3)release        |           |                 |  9) release
</I>&gt;<i>           |     |            |    6)release                |      |
</I>&gt;<i>       +-----------+    +--------------------+        +----------------
</I>&gt;<i>       | thread 1  |    | thread 2           |        | thread 3 also
</I>&gt;<i>       +-----------+    +-----------                   trying to aquire
</I>&gt;<i>       | aquired lock   | trying to
</I>&gt;<i>         on 5540fd..      aquire lock on                          |
</I>&gt;<i>         sess_id          5540fd.. but blocked                    |
</I>&gt;<i>                          until thread 1 releases lock            | 8) write
</I>&gt;<i>                |                \   5) Write                     |
</I>&gt;<i>      2) Write  |     +--------------------------------------+    |
</I>&gt;<i>                -----&gt;|  session data (in file or mysql)     | &lt;---
</I>&gt;<i>                      +--------------------------------------+
</I>&gt;<i> 
</I>&gt;<i>        Thread 1 locking sess_id, making manipulation with session
</I>&gt;<i>        data, writing it to file (or DBD or MySQL), release lock,
</I>&gt;<i>        then thread 2 locking that sess_id and so on..
</I>&gt;<i>        So in fact locked session_id, while session locked indirect,
</I>&gt;<i>        because no manipulation can be made before lock aquire and so
</I>&gt;<i>        manipulation with same sess_id data is quened across threads.
</I>&gt;<i> 
</I>&gt;<i>        And if i right, my module from previous letter will work with
</I>&gt;<i>        lock.
</I>&gt;<i> 
</I>&gt;<i>        Am i right?
</I>

Yes, although there may be some additional locking going on for the
actual data store.

For example the current implementation of of DbmSession serializes
access to the dbm file using a global lock so there are actually 2 locks
involved - one for the session (represented by the session id) and one
for the dbm file. The global lock for the file ensures the integrity of
the data store, so even if the user elects to turn off session locking
the dbm file will not be corrupted, even if the data for individual
sessions is not valid. FileSession uses a similar trick.

Jim

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="021788.html">[mod_python] For what session locking is? Do i need it while
	using MySQL?
</A></li>
	<LI>Next message: <A HREF="021800.html">[mod_python] For what session locking is? Do i need it while
	using MySQL?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21809">[ date ]</a>
              <a href="thread.html#21809">[ thread ]</a>
              <a href="subject.html#21809">[ subject ]</a>
              <a href="author.html#21809">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
