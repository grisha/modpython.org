<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] req.sendfile() problem
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20req.sendfile%28%29%20problem&In-Reply-To=18452913.379731154713795822.JavaMail.tomcat%40aurora">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021749.html">
   <LINK REL="Next"  HREF="021746.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] req.sendfile() problem</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Jim Gallacher</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20req.sendfile%28%29%20problem&In-Reply-To=18452913.379731154713795822.JavaMail.tomcat%40aurora"
       TITLE="[mod_python] req.sendfile() problem">jpg at jgassociates.ca
       </A><BR>
    <I>Tue Aug  8 10:35:32 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="021749.html">[mod_python] req.sendfile() problem
</A></li>
        <LI>Next message: <A HREF="021746.html">[mod_python] &quot;0&quot; added after content, magically
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21761">[ date ]</a>
              <a href="thread.html#21761">[ thread ]</a>
              <a href="subject.html#21761">[ subject ]</a>
              <a href="author.html#21761">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thomas J. Schirripa wrote:
&gt;<i> Thanks a lot guys, the problem is fixed. I feel so stupid because it ended up being a naming problem - I thought the path looked okay, and I automatically assumed the name wasn't a problem because I would have thought the IOError message would have said something along the lines of &quot;cannot find file&quot;. Anyways, I actually had a question about handling the exception because I did try doing that.
</I>&gt;<i> 
</I>&gt;<i> I had req.sendfile() in a try/except block, but in order to to send the error message to the browser....
</I>&gt;<i> Here's what I did...
</I>&gt;<i> 
</I>&gt;<i> def handler(req):
</I>&gt;<i> 	fields = util.FieldStorage(req)
</I>&gt;<i> 	filename = os.path.basename(fields[&quot;filename&quot;])
</I>&gt;<i> 	directory = os.path.dirname(fields[&quot;filename&quot;])
</I>&gt;<i> 	req.headers_out[&quot;Content-Disposition&quot;] = &quot;attachment; filename=%s&quot; % filename
</I>&gt;<i> 	req.content_type = &quot;text/plain&quot;
</I>&gt;<i> 	try:
</I>&gt;<i> 		req.sendfile(&quot;%s/%s&quot; % (directory, filename))
</I>&gt;<i> 	except IOError, e:
</I>&gt;<i> 		req.content_type = &quot;text/html&quot;
</I>&gt;<i> 		req.write(&quot;Raised exception reads:\n&lt;br&gt;%s&quot; % str(e))
</I>&gt;<i> 		return apache.OK
</I>&gt;<i> 	return apache.OK
</I>&gt;<i> 
</I>&gt;<i> Here's what happened:
</I>&gt;<i> instead of the IOError displaying in the browser, the file downloaded and had the req.write() message in it:
</I>&gt;<i> &quot;Raised exception reads:
</I>&gt;<i> &lt;br&gt;Could not stat file for reading&quot;
</I>&gt;<i> 
</I>&gt;<i> I thought I read somewhere you can't change the content type after it has been set (a limitation of http -  in fact, this is why I have a seperate sendFile handler... so I can set the content type properly), but I didn't think this would be a problem. Is there a way to get the message to display in the browser instead of sending over an html file with the message?
</I>
You can change the content-type, or any other response headers anytime
you want, up to the first call to req.write or req.sendfile. That first
call will cause the headers to be sent before the response body, so
changing the headers from that point on will have no effect. This is a
restriction imposed by HTTP, just as you surmise.

Jim

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="021749.html">[mod_python] req.sendfile() problem
</A></li>
	<LI>Next message: <A HREF="021746.html">[mod_python] &quot;0&quot; added after content, magically
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21761">[ date ]</a>
              <a href="thread.html#21761">[ thread ]</a>
              <a href="subject.html#21761">[ subject ]</a>
              <a href="author.html#21761">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="DISABLEhttp://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
