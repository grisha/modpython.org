<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] req.sendfile() problem
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20req.sendfile%28%29%20problem&In-Reply-To=10890432.379101154708106680.JavaMail.tomcat%40aurora">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021741.html">
   <LINK REL="Next"  HREF="021744.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] req.sendfile() problem</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Joseph Barillari</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20req.sendfile%28%29%20problem&In-Reply-To=10890432.379101154708106680.JavaMail.tomcat%40aurora"
       TITLE="[mod_python] req.sendfile() problem">joeb at mit.edu
       </A><BR>
    <I>Fri Aug  4 12:29:13 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="021741.html">[mod_python] req.sendfile() problem
</A></li>
        <LI>Next message: <A HREF="021744.html">[mod_python] req.sendfile() problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21742">[ date ]</a>
              <a href="thread.html#21742">[ thread ]</a>
              <a href="subject.html#21742">[ subject ]</a>
              <a href="author.html#21742">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Fri, Aug 04, 2006 at 12:15:06PM -0400, Thomas J. Schirripa wrote:
&gt;<i> Before stating my problem, let me say that I am running apache version 2.0.52, mod_python 3.2.8, python 2.3, all on Redhat Enterprise Linux WS release 4.
</I>&gt;<i> 
</I>&gt;<i> Basically I have a webpage where the client uploads a file and some scripts/programs run on the server and produce output files. Some of this output is spit out onto another webpage, but I want to give the client the option to download the output files. Since I am using multiple webpages, I had to figure out a way to transfer data from one page to another. The only sensible solution that I could figure out was to use psp to feed variables from my handlers into hidden form inputs in my template. From the output html page, the client can click a submit button next to the output filename that says &quot;download&quot;. The hidden form inputs have the information as to where the file is located on the server, and the action on the form refers to my sendFile handler. That handler looks like this:
</I>&gt;<i> 
</I>&gt;<i> def handler(req):
</I>&gt;<i> 	fields = util.FieldStorage(req)
</I>&gt;<i>         #Note: the filename is an absolute path, so I am going to split that up into directory and filename for clarity
</I>&gt;<i> 	filename = os.path.basename(fields[&quot;filename&quot;])
</I>&gt;<i> 	path = os.path.dirname(fields[&quot;filename&quot;])
</I>&gt;<i> 	req.headers_out[&quot;Content-Disposition&quot;] = &quot;attachment; filename=%s&quot; % filename
</I>&gt;<i> 	req.content_type = &quot;text/plain&quot;
</I>&gt;<i> 	req.sendfile(&quot;%s/%s&quot; % (directory, filename))
</I>&gt;<i> 	return apache.OK
</I>&gt;<i> 
</I>&gt;<i> I am not sure if I am using req.header_out or req.content-type correctly or how critical those lines are (I found it in another post), but my problem is that I am getting a file to download with the proper filename, BUT the file has a mod_python error message in it that reads:
</I>&gt;<i> 
</I>&gt;<i> IOError: Could not stat file for reading
</I>&gt;<i> 
</I>&gt;<i> and the error points to the line with req.sendfile(). Can anyone tell me what's going on and how to correct this?
</I>&gt;<i> Thanks,
</I>&gt;<i> Tom
</I>

Have you tried adding a 
req.log_error(&quot;%s/%s&quot; % (directory, filename))  
above the sendfile line to see if the server is looking in the right place?

Joe

-- 
Joseph Barillari
<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">joeb at mit.edu</A>
107 Ave. Louis Pasteur, Vandy Box 346, Boston, MA 02115
617-519-9250 (mobile)
</PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="021741.html">[mod_python] req.sendfile() problem
</A></li>
	<LI>Next message: <A HREF="021744.html">[mod_python] req.sendfile() problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21742">[ date ]</a>
              <a href="thread.html#21742">[ thread ]</a>
              <a href="subject.html#21742">[ subject ]</a>
              <a href="author.html#21742">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
