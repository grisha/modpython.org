<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] PyThreadState_Swap(NULL)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20PyThreadState_Swap%28NULL%29&In-Reply-To=ec7g3d%246k2%241%40sea.gmane.org">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021895.html">
   <LINK REL="Next"  HREF="021897.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] PyThreadState_Swap(NULL)</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20PyThreadState_Swap%28NULL%29&In-Reply-To=ec7g3d%246k2%241%40sea.gmane.org"
       TITLE="[mod_python] PyThreadState_Swap(NULL)">grahamd at dscpl.com.au
       </A><BR>
    <I>Sat Aug 19 18:05:23 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="021895.html">[mod_python] PyThreadState_Swap(NULL)
</A></li>
        <LI>Next message: <A HREF="021897.html">[mod_python] PyThreadState_Swap(NULL)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21896">[ date ]</a>
              <a href="thread.html#21896">[ thread ]</a>
              <a href="subject.html#21896">[ subject ]</a>
              <a href="author.html#21896">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On 20/08/2006, at 3:02 AM, Bryan wrote:

&gt;<i> i've written a program that uses python c api code that lives in a  
</I>&gt;<i> shared library that is loaded by a custom apache module (mod_xxx).   
</I>&gt;<i> this python c api code all works correctly under our test server  
</I>&gt;<i> and under apache but only if mod_python isn't loaded.  when apache  
</I>&gt;<i> loads mod_python as shown in the http.conf snippet below,  
</I>&gt;<i> PyThreadState_Swap(NULL) in mod_xxx returns NULL.  when the snippet  
</I>&gt;<i> of code in http.conf is commented out, it works again.  what do i  
</I>&gt;<i> have to do to have mod_xxx code work correctly when apache loads  
</I>&gt;<i> mod_python?
</I>&gt;<i>
</I>&gt;<i> i put our module after mod_python, commented out Py_Initialize(),  
</I>&gt;<i> and Py_IsInitialized() returned True, but PyThreadState_Swap() failed.
</I>&gt;<i>
</I>&gt;<i> i put our module before mod_python, called Py_Initialize(), and  
</I>&gt;<i> Py_IsInitialized() returned True, but PyThreadState_Swap() failed.
</I>&gt;<i>
</I>&gt;<i> i removed mod_python and our module succeeded.
</I>&gt;<i>
</I>&gt;<i> i even tested combinations of calling and PyEval_InitThreads() but  
</I>&gt;<i> didn't work either.
</I>&gt;<i>
</I>&gt;<i> any help to get our custom module co-existing with mod_python would  
</I>&gt;<i> be very appreciated.
</I>
For a start, which version of mod_python are you using? There were some
important changes in mod_python 3.2.8 to allow third party modules for
Python to work properly where those third party modules used the simple
GIL API for thread management. See:

   <A HREF="https://issues.apache.org/jira/browse/MODPYTHON-77">https://issues.apache.org/jira/browse/MODPYTHON-77</A>

Whether this would help is debatable though, as by the sound of it you
are doing a full embedding of Python in your own library much like  
mod_python
does and that may still conflict.

It is possible that you might have to wait until a new API is added  
to mod_python
as discussed in:

   <A HREF="https://issues.apache.org/jira/browse/MODPYTHON-165">https://issues.apache.org/jira/browse/MODPYTHON-165</A>

The intent with this API was to allow other Apache modules to access the
framework used by mod_python for the construction and access to Python
interpreter instances and to a wrapper for request object etc. That  
way a
third party module doesn't need to do it and no risk of there being a  
conflict
in the way each managed it.

This new API hasn't been added yet as no one had stepped up to say they
were interested enough to want to use it. If you are prepared and  
able to use
latest development builds of mod_python from subversion repository, I  
could
add the minimal functions required and you could start experimenting.

Other than that, can only suggest you post up the most minimal skeleton
possible showing what you are doing, preferably something that could be
compiled and tested.

Graham
</PRE>










<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="021895.html">[mod_python] PyThreadState_Swap(NULL)
</A></li>
	<LI>Next message: <A HREF="021897.html">[mod_python] PyThreadState_Swap(NULL)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21896">[ date ]</a>
              <a href="thread.html#21896">[ thread ]</a>
              <a href="subject.html#21896">[ subject ]</a>
              <a href="author.html#21896">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
