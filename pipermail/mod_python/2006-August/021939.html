<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Object persistence?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Object%20persistence%3F&In-Reply-To=op.tezozgwe9etm87%40avari254.mt.ltu.se">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021938.html">
   <LINK REL="Next"  HREF="021925.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Object persistence?</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Jim Gallacher</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Object%20persistence%3F&In-Reply-To=op.tezozgwe9etm87%40avari254.mt.ltu.se"
       TITLE="[mod_python] Object persistence?">jpg at jgassociates.ca
       </A><BR>
    <I>Mon Aug 28 07:49:56 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="021938.html">[mod_python] Object persistence?
</A></li>
        <LI>Next message: <A HREF="021925.html">[mod_python] mpcp
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21939">[ date ]</a>
              <a href="thread.html#21939">[ thread ]</a>
              <a href="subject.html#21939">[ subject ]</a>
              <a href="author.html#21939">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Fredrik Sandin wrote:
&gt;<i> On Sat, 26 Aug 2006 05:36:14 +0200, Graham Dumpleton 
</I>&gt;<i> &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">grahamd at dscpl.com.au</A>&gt; wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On 25/08/2006, at 11:16 PM, Fredrik Sandin wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Hello!
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> I am new to mod_python and could need some advice. I want to create an
</I>&gt;&gt;&gt;<i> online GUI with mod_python for an existing application written in 
</I>&gt;&gt;&gt;<i> Python.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> The Python application organizes distributed computations and therefore
</I>&gt;&gt;&gt;<i> maintains network connections to a number of computers. Users post jobs,
</I>&gt;&gt;&gt;<i> which are sent somewhere for execution and then the result is sent back
</I>&gt;&gt;&gt;<i> by a callback function. Illustration of principle:
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> class MyComputerCluster:
</I>&gt;&gt;&gt;<i>     def __init__(self, callback):
</I>&gt;&gt;&gt;<i>         self.callback = callback
</I>&gt;&gt;&gt;<i>         ...
</I>&gt;&gt;&gt;<i>     def post_job(self, description):
</I>&gt;&gt;&gt;<i>         ...
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> def mycallback(userid, result):
</I>&gt;&gt;&gt;<i>     print 'User %d requested: %s' % (userid, result)
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> mycluster = MyComputerCluster(mycallback)
</I>&gt;&gt;&gt;<i> mycluster.post_job('compute the meaning of 42')
</I>&gt;&gt;&gt;<i> ...
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Now, there is one major issue - Is it possible to create an object of 
</I>&gt;&gt;&gt;<i> type
</I>&gt;&gt;&gt;<i> MyComputerCluster for each user of the online GUI and keep it in memory
</I>&gt;&gt;&gt;<i> between calls, without spoiling the network connections maintained by 
</I>&gt;&gt;&gt;<i> the
</I>&gt;&gt;&gt;<i> object? Session variables can be used as reference for a persistent 
</I>&gt;&gt;&gt;<i> object,
</I>&gt;&gt;&gt;<i> but how to create it?
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> A solution would be to write an independent service that creates the
</I>&gt;&gt;&gt;<i> objects and listens for requests (post_job, get_result), but that takes
</I>&gt;&gt;&gt;<i> time...
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Does the code above you give as an example already exist and a part of
</I>&gt;&gt;<i> your existing Python application? What framework is your application for
</I>&gt;&gt;<i> performing the distributed jobs written in, or is it some home grown 
</I>&gt;&gt;<i> custom
</I>&gt;&gt;<i> framework?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I have a sense of what you want to do, but because no real information is
</I>&gt;&gt;<i> provided about the existing application or what framework it uses, it 
</I>&gt;&gt;<i> is hard
</I>&gt;&gt;<i> to give any advice.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Anyway, if the issue is more about how handlers in mod_python might
</I>&gt;&gt;<i> communicate with your application, you might look at XML-RPC using the
</I>&gt;&gt;<i> xmlrpclib module in Python. Depending on the framework the application
</I>&gt;&gt;<i> uses though, it may not be possible to embed an XML-RPC server in the
</I>&gt;&gt;<i> application which could respond to the handlers run under mod_python.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Can you perhaps be clearer about the separation between your mod_python
</I>&gt;&gt;<i> handlers and your application and how you intend communicating between
</I>&gt;&gt;<i> the two.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Graham
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Dear Graham,
</I>&gt;<i> 
</I>&gt;<i> yes, the code I gave as an example represents an existing Python
</I>&gt;<i> application. It is home-gown, so your suggestion to embed an XML-RPC
</I>&gt;<i> server could do the trick, will have a closer look at it. Thanks!
</I>&gt;<i> 
</I>&gt;<i> By the way, why is it so difficult to support persistent objects,
</I>&gt;<i> a &quot;state&quot;, from one call to the next? The mod_php application itself
</I>&gt;<i> has a state, and each user can be associated with a sessid, so the
</I>&gt;<i> problem must be that a user could be served by different mod_php
</I>&gt;<i> processes from one call to the next?
</I>
Correct, assuming you s/mod_php/mod_python/. :) Each process gets its 
own interpreter with a separate copy of all your objects. It's exactly 
the same as launching multiple python interpreters from the command 
line. Each one is completely independent, and I'm sure that you wouldn't 
expect a change to some object in one interpreter to change a 
corresponding object in another interpreter? In mod_python it all comes 
down to the mpm you are using. The only one where that has a single 
process where objects could easily be shared across threads is 
mpm-winnt, but this obviously limited to Windows. There is no generic 
mod_python solution that will work with all of the Apache mpm's.

&gt;<i> In that case, would it not be possible to use the sessid to make
</I>&gt;<i> sure that a user is served by the same mod_php process as long
</I>&gt;<i> as the session is valid?
</I>
No. Apache selects an available process to handle a request pretty much 
at random. (It may be the same process if there is a KeepAlive, but you 
shouldn't count on it). Apache itself has no knowledge (or interest) in 
the internal workings of your application, such as a session cookie, so 
there is no way associate a process with a session. It works the other 
way around, with the mod_python handler associating a session cookie 
with some data in a persistent store.

Jim
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="021938.html">[mod_python] Object persistence?
</A></li>
	<LI>Next message: <A HREF="021925.html">[mod_python] mpcp
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21939">[ date ]</a>
              <a href="thread.html#21939">[ thread ]</a>
              <a href="subject.html#21939">[ subject ]</a>
              <a href="author.html#21939">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
