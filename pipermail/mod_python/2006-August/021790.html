<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Shared global variables among apache children?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Shared%20global%20variables%20among%20apache%20children%3F&In-Reply-To=44DB8436.3020601%40ussonet.net">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021789.html">
   <LINK REL="Next"  HREF="021791.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Shared global variables among apache children?</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Joshua Ginsberg</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Shared%20global%20variables%20among%20apache%20children%3F&In-Reply-To=44DB8436.3020601%40ussonet.net"
       TITLE="[mod_python] Shared global variables among apache children?">listspam at flowtheory.net
       </A><BR>
    <I>Thu Aug 10 15:25:36 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="021789.html">[mod_python] Shared global variables among apache children?
</A></li>
        <LI>Next message: <A HREF="021791.html">[mod_python] XMLHttpRequest + CGI + mod_python
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21790">[ date ]</a>
              <a href="thread.html#21790">[ thread ]</a>
              <a href="subject.html#21790">[ subject ]</a>
              <a href="author.html#21790">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Geez, there are a lot of questions about IPC this week... :-/

Justin --

Let's say you open two terminals, and in each you run a python
interpreter. In the first, you tell it:

&gt;&gt;&gt;<i> x = 3
</I>
And in the second you tell it:

&gt;&gt;&gt;<i> x = 3
</I>
And then back in the first you tell it:

&gt;&gt;&gt;<i> x += 1
</I>
And then in the second you tell it:

&gt;&gt;&gt;<i> print x
</I>
What are you going to get? 3 of course -- not 4. Duh! That's because
they're separate processes. Separate memory spaces. Totally independent.
It's the same thing with Apache. Each Apache process runs with its own
unique memory space and its own unique Python instance.

So solve this problem the same way you'd solve it with two separate
Python interpreter processes. Examples:

1) Use files and locks.
2) Use something like SQL that has locking built in.
3) Use some IPC protocol -- XMLRPC or (hehe) D-BUS

But if you want a purely multithreaded web server that has one big
shared memory space, use AOLServer or something like that. Apache was
originally designed to do forking and lots of it. It's only recently
that it has been developing MPM models that have multiple connections
handled by a process with multiple threads, and this doesn't happen the
same way in all MPMs or on all platforms.

-jag

On Thu, 2006-08-10 at 14:08 -0500, justind wrote:
&gt;<i> It feels like I'm missing either one configuration option or this may 
</I>&gt;<i> not even be possible.
</I>&gt;<i> 
</I>&gt;<i> I have this little bit of code. I expected, that every 4 seconds that x 
</I>&gt;<i> would increment by 1 on the returned page. It does. However I think that 
</I>&gt;<i> this same code is loaded into each child process (correct me if I'm 
</I>&gt;<i> wrong) of apache.
</I>&gt;<i> Depending on which child I get, and when they were launched (hitting 
</I>&gt;<i> refresh rapidly on Firefox seems to demonstrate this too me) I get a 
</I>&gt;<i> different page back. One will show 4 then a refresh will show 3, another 
</I>&gt;<i> will show 3, another will show 4 and so on and so forth.
</I>&gt;<i> 
</I>&gt;<i> I guess my question is, how can I share the global variable of x among 
</I>&gt;<i> all the apache child processes, or is this really my problem)?
</I>&gt;<i> 
</I>&gt;<i> Any help would be very appreciated.
</I>&gt;<i> 
</I>&gt;<i> Code follows below:
</I>&gt;<i> 
</I>&gt;<i> from mod_python import apache
</I>&gt;<i> import time
</I>&gt;<i> import thread
</I>&gt;<i> 
</I>&gt;<i> x = 1
</I>&gt;<i> 
</I>&gt;<i> def handler(req):
</I>&gt;<i>     global x
</I>&gt;<i>     req.content_type = 'text/plain'
</I>&gt;<i>     req.write(&quot;Hello World! &quot; + str(x))
</I>&gt;<i>     return apache.OK
</I>&gt;<i> 
</I>&gt;<i> def do_me():
</I>&gt;<i>     global x
</I>&gt;<i>     while True:
</I>&gt;<i>         time.sleep(4)
</I>&gt;<i>         x += 1               
</I>&gt;<i>                
</I>&gt;<i> thread.start_new(do_me,())   
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mod_python mailing list
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I>
</PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="021789.html">[mod_python] Shared global variables among apache children?
</A></li>
	<LI>Next message: <A HREF="021791.html">[mod_python] XMLHttpRequest + CGI + mod_python
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21790">[ date ]</a>
              <a href="thread.html#21790">[ thread ]</a>
              <a href="subject.html#21790">[ subject ]</a>
              <a href="author.html#21790">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
