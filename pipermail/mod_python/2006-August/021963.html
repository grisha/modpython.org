<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] [SPAM] can't set several cookies from the same page
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20%5BSPAM%5D%20can%27t%20set%20several%20cookies%20from%20the%20same%20page&In-Reply-To=20060830154822.GA43964%40fasterix.frmug.org">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021964.html">
   <LINK REL="Next"  HREF="021961.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] [SPAM] can't set several cookies from the same page</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Jim Gallacher</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20%5BSPAM%5D%20can%27t%20set%20several%20cookies%20from%20the%20same%20page&In-Reply-To=20060830154822.GA43964%40fasterix.frmug.org"
       TITLE="[mod_python] [SPAM] can't set several cookies from the same page">jpg at jgassociates.ca
       </A><BR>
    <I>Wed Aug 30 16:44:44 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="021964.html">[SPAM] Re: [mod_python] [SPAM] can't set several cookies from
	the	same page
</A></li>
        <LI>Next message: <A HREF="021961.html">[mod_python] examples of using simpletal with modpython
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21963">[ date ]</a>
              <a href="thread.html#21963">[ thread ]</a>
              <a href="subject.html#21963">[ subject ]</a>
              <a href="author.html#21963">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Your first call to req.write() causes the response headers to be sent to 
the client. Once the headers are sent it's too late to set another 
cookie. This is not unique to mod_python - it's just the way cookies 
work. Make sure you set all your cookies (or any other header for that 
matter) before calling req.write()

Jim


Pierre Beyssac wrote:
&gt;<i> Hello,
</I>&gt;<i> 
</I>&gt;<i> I'm a happy mod_python user since... yesterday.
</I>&gt;<i> 
</I>&gt;<i> I can't seem to get the following to work: setting 2 cookies from
</I>&gt;<i> the same request. The following code is taken from the documentation
</I>&gt;<i> for the most part; apparently, it results in only one &quot;Set-Cookie&quot;
</I>&gt;<i> header being emitted in the HTTP reply headers.
</I>&gt;<i> 
</I>&gt;<i> Initially I just wanted to establish a session + a cookie at the
</I>&gt;<i> same time and it didn't work either, apparently for the same reason.
</I>&gt;<i> 
</I>&gt;<i> Any idea what I am doing wrong? Am I missing something obvious?
</I>&gt;<i> 
</I>&gt;<i> I'm using mod_python 3.2.10, Python 2.4.3, Apache 2.0.59 on FreeBSD 4.11.
</I>&gt;<i> 
</I>&gt;<i> ---
</I>&gt;<i> from mod_python import apache, Cookie, Session
</I>&gt;<i> import time
</I>&gt;<i> 
</I>&gt;<i> SECRET = &quot;mYseCret&quot;
</I>&gt;<i> 
</I>&gt;<i> def _cookiehandler(req, ident):
</I>&gt;<i>     cookies = Cookie.get_cookies(req, Cookie.MarshalCookie,
</I>&gt;<i>                                  secret=SECRET)
</I>&gt;<i>     if cookies.has_key(ident):
</I>&gt;<i>         mycookie = cookies[ident]
</I>&gt;<i>         req.write(&quot;OK, cookie found: %s\n&quot; % mycookie)
</I>&gt;<i>         if type(mycookie) is Cookie.MarshalCookie:
</I>&gt;<i>             req.write('Here is what it looks like decoded: %s=%s\n'
</I>&gt;<i>                       % (mycookie.name, mycookie.value))
</I>&gt;<i>         else:
</I>&gt;<i>             req.write('Strange, cannot decode...\n')
</I>&gt;<i>     else:
</I>&gt;<i>         value = {'eu_org': ident}
</I>&gt;<i>         Cookie.add_cookie(req, Cookie.MarshalCookie(ident, value, SECRET))
</I>&gt;<i>         req.write(&quot;No cookie found, trying to set one\n&quot;)
</I>&gt;<i> 
</I>&gt;<i> def handler(req):
</I>&gt;<i>     req.content_type = &quot;text/plain&quot;
</I>&gt;<i>     _cookiehandler(req, 'id1')
</I>&gt;<i>     _cookiehandler(req, 'id2')
</I>&gt;<i>     return apache.OK
</I>&gt;<i> ---
</I>&gt;<i> Generated reply :
</I>&gt;<i> ---
</I>&gt;<i> Date: Tue, 29 Aug 2006 19:54:28 GMT
</I>&gt;<i> Server: Apache/2.0.59 (FreeBSD) mod_python/3.2.10 Python/2.4.3 mod_ssl/2.0.59 OpenSSL/0.9.7d-p1
</I>&gt;<i> Cache-Control: no-cache=&quot;set-cookie&quot;
</I>&gt;<i> Set-Cookie: id1=d68b2820cbded02eea3afc876689f30ae3QGAAAAZXVfb3JndAMAAABpZDEw
</I>&gt;<i> Connection: close
</I>&gt;<i> Content-Type: text/plain; charset=ISO-8859-1
</I>&gt;<i> 
</I>&gt;<i> No cookie found, trying to set one
</I>&gt;<i> No cookie found, trying to set one
</I>&gt;<i> 
</I>
</PRE>









<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="021964.html">[SPAM] Re: [mod_python] [SPAM] can't set several cookies from
	the	same page
</A></li>
	<LI>Next message: <A HREF="021961.html">[mod_python] examples of using simpletal with modpython
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21963">[ date ]</a>
              <a href="thread.html#21963">[ thread ]</a>
              <a href="subject.html#21963">[ subject ]</a>
              <a href="author.html#21963">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
