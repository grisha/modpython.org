<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Upload progress indicator shows after upload?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Upload%20progress%20indicator%20shows%20after%20upload%3F&In-Reply-To=44CFE03E.40604%40gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="021707.html">
   <LINK REL="Next"  HREF="021708.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Upload progress indicator shows after upload?</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Colin Bean</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Upload%20progress%20indicator%20shows%20after%20upload%3F&In-Reply-To=44CFE03E.40604%40gmail.com"
       TITLE="[mod_python] Upload progress indicator shows after upload?">ccbean at gmail.com
       </A><BR>
    <I>Wed Aug  2 14:43:45 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="021707.html">[mod_python] Upload progress indicator shows after upload?
</A></li>
        <LI>Next message: <A HREF="021708.html">[mod_python] Setting req-&gt;user for mod_dav_svn (concerning leaks)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21711">[ date ]</a>
              <a href="thread.html#21711">[ thread ]</a>
              <a href="subject.html#21711">[ subject ]</a>
              <a href="author.html#21711">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Unfortunately, what you're trying to do is more complicated than this.
 First of all, by the time your handler is called, the file has
already been sent over the network, and your handler is only reading
it from a tempfile on disk.  Also, a handler only sends one response
back after running to completion, so your code is behaving as
expected.  It finishes processing the file upload (including doing
everything in your loop), and when it's finished it sends a response
back to the client.

Sorry I can't provide more constructive feedback having never actually
implemented something like this.  To take a guess at it, you'd need to
use an InputFilter to examine the upload request as it is read (I
believe this phase happens before the tempfile is written to disk),
and this would need to somehow communicate with another mod_python
handler which would return the current upload progress.  The client
page wold have to keep polling this handler (with an XMLHttpRequest,
perhaps) and display the results it gets with each poll.  Yeah, it's
pretty ugly...

HTH,
Colin


On 8/1/06, jadacyrus &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">jadacyrus at gmail.com</A>&gt; wrote:
&gt;<i> Essentially this is what I have setup for my upload script:
</I>&gt;<i>
</I>&gt;<i> [code]
</I>&gt;<i>
</I>&gt;<i> #HTML Stuff here
</I>&gt;<i> #Declare variables etc...
</I>&gt;<i>
</I>&gt;<i>     while bytes_left &gt;= 0:
</I>&gt;<i>             fileData = req.form['filename'].file.read(1024)
</I>&gt;<i>             filebuffer = filebuffer + fileData
</I>&gt;<i>             bytes_left = bytes_left - 1024
</I>&gt;<i>             bytes_read = bytes_read + 1024
</I>&gt;<i>             percent = bytes_read/int(length) * 100
</I>&gt;<i>
</I>&gt;<i> #Some nested IF statements to display a progress indicator using images
</I>&gt;<i> based on the percent variable.
</I>&gt;<i>
</I>&gt;<i> [/code]
</I>&gt;<i>
</I>&gt;<i> This is contained in my upload.py in the function upFile which is called
</I>&gt;<i> from the POST method. However, It seems that the file uploads completely
</I>&gt;<i> first and then it will show the progress indications afterwards. However
</I>&gt;<i> this doesn't seem to be logically what my code should be doing. I'm
</I>&gt;<i> somewhat new to mod_python but not python in general, any suggestions?
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mod_python mailing list
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I>&gt;<i>
</I></PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="021707.html">[mod_python] Upload progress indicator shows after upload?
</A></li>
	<LI>Next message: <A HREF="021708.html">[mod_python] Setting req-&gt;user for mod_dav_svn (concerning leaks)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#21711">[ date ]</a>
              <a href="thread.html#21711">[ thread ]</a>
              <a href="subject.html#21711">[ subject ]</a>
              <a href="author.html#21711">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
