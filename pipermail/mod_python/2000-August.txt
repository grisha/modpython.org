From bohheong at asiacontent.com  Wed Aug  2 22:41:33 2000
From: bohheong at asiacontent.com (Boh Heong Yap)
Date: Fri Jan  9 21:45:59 2004
Subject: [mod_python] can't start mod_python
Message-ID: <20000803054133.24083@mail.asiacontent.com>

hi, 

I wonder if someone could help. I've been playing with the configuration
of mod_python for the last few days without success. I managed to compile
in mod_pyton statically into in Apache 1.3.12, got it restarted and tested it.

    config details at end...

When I run ~/bin/httpd -l, mod-python.c is displayed.


From grisha at ispol.com  Wed Aug  2 15:22:23 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:45:59 2004
Subject: [mod_python] can't start mod_python
In-Reply-To: <20000803054133.24083@mail.asiacontent.com>
Message-ID: <Pine.LNX.4.21.0008021521520.28399-100000@saturn.ispol.com>

Which user does apache run as and what are the permissions on the
mod_python directory and everything in it?

--
  Gregory (Grisha) Trubetskoy
       grisha@ispol.com

On Wed, 2 Aug 2000, Boh Heong Yap wrote:

> hi, 
> 
> I wonder if someone could help. I've been playing with the configuration
> of mod_python for the last few days without success. I managed to compile
> in mod_pyton statically into in Apache 1.3.12, got it restarted and tested it.
> 
>     config details at end...
> 
> When I run ~/bin/httpd -l, mod-python.c is displayed.
> 
> 
> >From the browser, "http://222.64.245.xx/pytest.py", gives the message:-
> 
>     Internal Server Error
> 
>     The server encountered an internal error or misconfiguration and was     
>     unable to complete your request.
> 
> Other normal web request seem to work fine. 
> This is what the error logs show...
> 
>     [Wed Aug  2 20:58:57 2000] [notice] caught SIGTERM, shutting down
>     [Wed Aug  2 20:59:02 2000] [notice] Apache/1.3.12 (Unix) configured
> -- resuming
>         normal operations
>     'import site' failed; use -v for traceback
>     make_obcallback(): could not import mod_python.apache.
>     make_obcallback(): could not call init.
>     [Wed Aug  2 20:59:45 2000] [error] [client 202.77.245.126] python_handler:
>         make_obcallback returned no obCallBack!
> 
> 
> The mod_python module sits in 
> 
>         /usr/local/lib/python1.5/mod_python
> 
>     (along with other .pc. .pyc modules)
> 
> 
> In my httpd.conf (everything is there, no srm.conf, access.conf), I have 
> 
>     AddHandler python-program .py
>     PythonHandler pytest.py
>     PythonDebug on
>     PythonPath "sys.path+['/usr/local/lib/python1.5/mod_python']
> 
> this is within the <Directory..> directives for ~/apache/htdocs.
> pytest.py is same as the "Hello World" example in the tutorial in
> mod_python...
> 
> 
> Also when in the Python interpreter, I try to load stuff manually, 
> ie:
> 
>     >>> from mod_python import apache
>     Traceback (innermost last):
>     File "<stdin>", line 1, in ?
>     File "/usr/local/lib/python1.5/mod_python/apache.py", line 18, in ?
>         import _apache
>     ImportError: No module named _apache
>     >>>
> 
> and apache.py does indeed have the line "import _apache"
> 
> Loading other standard python modules like "sys" works OK, hence I think
> PYTHONPATH seems OK.
> 
> 
> config_info
> ------------------
> Apache - 1.3.12
> Python 1.5, compiled from source, standard
>     (both are installed in /usr/local)
> system Linux Mandrake 7.0, 2.2.12 kernel 
> Compaq box, P3.
> 
> 
> Any help from anyone will be appreciated.
> 
> Hope I can get this working. Would love to use Python for a few things here.
> 
> 
> 
> ----------------------------------------------------------
> Boh-heong Yap
> Project Manager, eCommerce
> 				bohheong@asiacontent.com				
> 
> Asiacontent.com a leading pan-Asian Internet company,
> with focus on: content, advertising and e-commerce.
> -----------------------------------------------------------
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 


From richard at whitequeen.com  Tue Aug  1 08:20:21 2000
From: richard at whitequeen.com (richard offer)
Date: Fri Jan  9 21:45:59 2004
Subject: [mod_python] the return of *Occasional* AttributeError: Handler
Message-ID: <200008011520.e71FKLA03253@whitequeen.com>

 
Hi all,

I've started getting the same error I reported back the beginning of Jul,
in that *occasionaly* I get a

[Tue Aug  1 05:37:12 2000] [error] PythonHandler index: Traceback (innermost last):
[Tue Aug  1 05:37:12 2000] [error] PythonHandler index:   File "/usr/local/lib/python1.5/site-packages/mod_python/apache.py", line 96, in Dispatch
    object = self.resolve_object(module, object_str)
[Tue Aug  1 05:37:12 2000] [error] PythonHandler index:   File "/usr/local/lib/python1.5/site-packages/mod_python/apache.py", line 42, in resolve_object
    obj = getattr(obj, obj_str)
[Tue Aug  1 05:37:12 2000] [error] PythonHandler index: AttributeError: handler


In fact I've probably been getting it all the time, but the person who
I run the site for just got back from vaccation and wanted to see it.

To refresh everyone's memory, the is an occasional (but frequent) error,
my guess is that its timing related, since you can sometimes get it
to disappear by reloading the page---sometimes it will fail elsewhere,
sometimes it works...

My suspicion of it being timing related is reinforced as it never happened
on the development machine, it happens more on the production machine
(same physical machine, but chrooted), and it happens a lot more when
I access the site via the internet (as opposed to via my intranet).

The site in question talks to a MySQL database via a persistant
connection.


Is there any ideas on how to debug this ? Extra diagnostics I can add
in apache.py ?

[ RH 6.1/mod_python 2.4/ DSL ]

thanks.

richard.

-- 
richard offer @ home 
          84 FE 48 E4 74 D0 26 D4  31 8E B6 86 98 74 E2 7C  8A FB BF A3
_______________________________http://www.whitequeen.com/users/richard/
* 



-- 
richard offer @ home 
          84 FE 48 E4 74 D0 26 D4  31 8E B6 86 98 74 E2 7C  8A FB BF A3
_______________________________http://www.whitequeen.com/users/richard/

From grisha at ispol.com  Thu Aug  3 08:17:59 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:45:59 2004
Subject: [mod_python] the return of *Occasional* AttributeError: Handler
In-Reply-To: <200008011520.e71FKLA03253@whitequeen.com>
Message-ID: <Pine.LNX.4.21.0008030815040.31424-100000@saturn.ispol.com>

Try upgrading to 2.4.1. It gives you additional info for Attribute errors.

Grisha

On Tue, 1 Aug 2000, richard offer wrote:

> 
>  
> Hi all,
> 
> I've started getting the same error I reported back the beginning of Jul,
> in that *occasionaly* I get a
> 
> [Tue Aug  1 05:37:12 2000] [error] PythonHandler index: Traceback (innermost last):
> [Tue Aug  1 05:37:12 2000] [error] PythonHandler index:   File "/usr/local/lib/python1.5/site-packages/mod_python/apache.py", line 96, in Dispatch
>     object = self.resolve_object(module, object_str)
> [Tue Aug  1 05:37:12 2000] [error] PythonHandler index:   File "/usr/local/lib/python1.5/site-packages/mod_python/apache.py", line 42, in resolve_object
>     obj = getattr(obj, obj_str)
> [Tue Aug  1 05:37:12 2000] [error] PythonHandler index: AttributeError: handler
> 
> 
> In fact I've probably been getting it all the time, but the person who
> I run the site for just got back from vaccation and wanted to see it.
> 
> To refresh everyone's memory, the is an occasional (but frequent) error,
> my guess is that its timing related, since you can sometimes get it
> to disappear by reloading the page---sometimes it will fail elsewhere,
> sometimes it works...
> 
> My suspicion of it being timing related is reinforced as it never happened
> on the development machine, it happens more on the production machine
> (same physical machine, but chrooted), and it happens a lot more when
> I access the site via the internet (as opposed to via my intranet).
> 
> The site in question talks to a MySQL database via a persistant
> connection.
> 
> 
> Is there any ideas on how to debug this ? Extra diagnostics I can add
> in apache.py ?
> 
> [ RH 6.1/mod_python 2.4/ DSL ]
> 
> thanks.
> 
> richard.
> 
> -- 
> richard offer @ home 
>           84 FE 48 E4 74 D0 26 D4  31 8E B6 86 98 74 E2 7C  8A FB BF A3
> _______________________________http://www.whitequeen.com/users/richard/
> * 
> 
> 
> 
> -- 
> richard offer @ home 
>           84 FE 48 E4 74 D0 26 D4  31 8E B6 86 98 74 E2 7C  8A FB BF A3
> _______________________________http://www.whitequeen.com/users/richard/
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 


From jack at icecast.org  Fri Aug  4 23:19:58 2000
From: jack at icecast.org (Jack Moffitt)
Date: Fri Jan  9 21:45:59 2004
Subject: [mod_python] authenhandler not working
Message-ID: <20000804231958.E5841@tk421.icecast.org>

Using the tutorial, i got the first example to work.  

Then i did the second example, and that is not authenticating me.  I
figured I've got a typo somewhere so i modified it to look like:

def authenhandler(req):
        user = req.connection.user
        pw = req.get_basic_auth_pw()

        if user == "spam" and pw == "eggs":
                return apache.OK
        else:
                apache.log_error('start', apache.APLOG_NOTICE)
                apache.log_error(user, apache.APLOG_NOTICE)
                apache.log_error(pw, apache.APLOG_NOTICE)
                apache.log_error('end', apache.APLOG_NOTICE)
                return apache.HTTP_UNAUTHORIZED


when I make the request, i get (from error_log):

[Fri Aug  4 23:07:57 2000] [notice] (13)Permission denied: start
[Fri Aug  4 23:07:57 2000] [notice] (13)Permission denied: eggs
[Fri Aug  4 23:07:57 2000] [notice] (13)Permission denied: end

the user var must be blank, because it never makes it.  

access_log has:

127.0.0.1 - spam [04/Aug/2000:23:07:57 -0700] "GET /test/test.py HTTP/1.0" 401 471

which has the username correct.

Where am I going wrong here?  Or is this a bug?

jack.

From gps at trix.dircon.co.uk  Mon Aug  7 02:00:52 2000
From: gps at trix.dircon.co.uk (Graham Swallow)
Date: Fri Jan  9 21:45:59 2004
Subject: [mod_python] SPIN_py works with mod_python
Message-ID: <Pine.LNX.4.04.10008070155030.1292-100000@trix.dircon.co.uk>

You have to mess with the PATHS and the /etc/sgml/ pathnames,
but then it just works. It is an SGML parser (actually SP is
the Parser, SPIN is the interface to Python).

I wouldn't recommend using SPIN on a production server because 
it is not mem-leakage tested, and because if users can upload
SGML they can down load any file (named as an entity), however
it provides elem_info and elem_obj, which are very useful
when building SGML/HTML/XML trees. You can also use them without
initialising the parser, and wrap them in names that you like.

Graham (who thinks mod_python is great)

Begin4
Title:          SPIN_py - SGML Parser Integration (Python)
Version:        0.2.3
Entered-date:   2000-08-06
Description:    SP is _the_ SGML Parser.
                spin_py.so is a loadable Python module.
                SPIN_py uses the generic
                SP-API and routes its events to Python, with some
                fixups on the way. It also provides a few
                C-Python types which are very useful when building
                SGML/HTML/XML trees (elem_info, elem_obj).
                This release includes a standard libsp16.so (binary)
                otherwise its 100K not 1MB. To compile from source
                you may need SP-1.3.4 from http://www.jclark.com/
Keywords:       SGML HTML XML SP Parser Python Apache mod_python
Author:         gps@trix.dircon.co.uk (Graham Swallow)
Primary-site:   http://www.trix.dircon.co.uk/SPIN/
Alternate-site: metalab.unc.edu /pub/Linux/utils/text/
                1026522   SPIN_py-0806.tgz
Platforms:      libc.so.6, gcc-2.96, Linux, Solaris, NOT-HP-UX-YET,
Copying-policy: L-GPL
End



From gps at trix.dircon.co.uk  Mon Aug  7 22:19:08 2000
From: gps at trix.dircon.co.uk (Graham Swallow)
Date: Fri Jan  9 21:45:59 2004
Subject: [mod_python] pcre.error from python
Message-ID: <Pine.LNX.4.04.10008072154560.809-200000@trix.dircon.co.uk>

It doesnt happen every time but I get faults or trace-backs from pcre.
I think its due to interference between the pcre in python, and the
pcre in php (Perl Compat. Regular Expression). sig-seg or either of:

	pcre.error: ('unmatched parentheses', 40)
	pcre.error: ('\\ at end of pattern', 4425)

(Presumably these are random errors from some other memory corruption,
or incorrect function call, there are no parentheses or \\'s)

I haven't got a clue what to do about it, (would statically linking
pcre into python work? Can separate <Directories> NOT have mod_XYZ
loaded?) but if you see the above symptom, try the attached test script.

	Graham

-------------- next part --------------
#!/usr/bin/env python
# called by httpd or by shell

def handler(req):
	from mod_python import apache
	return handler2( req )
	# forgetting the above return is interesting. Try it!

def handler2( req ):

	req.content_type="text/plain"
	req.send_http_header()
	import re
	instr = "Old and New\n"
	outstr = re.sub( "Old", "New", instr, 0 )
	req.write( outstr )
	try:
		t = apache.OK
	except:
		t = "shell_mode"
	return t

if __name__ == '__main__':
	class REQ_DUMMY:
		def __init__( req, fd ):
			# req has writable (and readable) fields
			# when calling from shell ...
			req.fd = fd
		def send_http_header( req ):
			print "Not apache, so I sont say:", req.content_type
		def write( req, text ):
			req.fd.write( text )

	import sys
	# fd = open( "/dev/null", 'w' )
	# fd = open( "test_out.html", 'w' )
	fd = sys.stderr
	req_dummy = REQ_DUMMY( fd )
	handler2( req_dummy )

From Robert.Nasca at macquarie.com.au  Tue Aug  8 09:27:12 2000
From: Robert.Nasca at macquarie.com.au (Robert Nasca)
Date: Fri Jan  9 21:45:59 2004
Subject: [mod_python] mod_python / win32all and COM
Message-ID: <2D0E3DBA4C66D31195920008C784F4AF01332A5C@nt_syd_ex08.macbank>

Hi,

Is there an FAQ on using mod_python with COM? It seems that I am having problems due to the threaded nature of Apache on win32 and it's interaction with COM.

I have created an interface to some COM objects using the "makepy.py" program which comes with win32all.

When I run Apache with ThreadsPerChild set to 1, everything runs fine (albeit with only one client), but when I set this to something higher, I get errors saying "CoInitialise() has not been called", which I assume are related to Apache spawning multiple threads. I've attached the output below.

Mod_python error: "PythonHandler pytest"Traceback (innermost last):
  File "h:\website\python\mod_python\apache.py", line 119, in Dispatch
    result = object(req)
  File "h:/website/htdocs/test\pytest.py", line 8, in handler
    d = Snakey.Database.RiskReporterDatabase()
  File "H:\WebSite\Python\Snakey\Database.py", line 32, in __init__
    self.openConnection("DSN=RISK_REPORTER")
  File "H:\WebSite\Python\Snakey\Database.py", line 20, in openConnection
    self.connection = msado21.Connection()
  File "H:\PythonDev\Snakey\msado21.py", line 1607, in __init__
com_error: (-2147221008, 'CoInitialize has not been called.', None, None)

If anyone has a suggestion on what is happening, or pointers to some information on using mod_python and COM, it would be appreciated.

Thanks,
Rob.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mailman.modpython.org/pipermail/mod_python/attachments/20000808/8ccbceb4/attachment.htm
From efernandez at sistelnet.es  Wed Aug  9 08:51:50 2000
From: efernandez at sistelnet.es (Eduardo Fernandez)
Date: Fri Jan  9 21:45:59 2004
Subject: [mod_python] problem with authen handler
Message-ID: <007701c001ce$4b6b7c40$248a4cc3@sistelnet.es>

Hello everyone:

I whis I had discovered mod_python before. It would have saved me a lot of
headaches in the application I am developing right now. In this app, I
authenticate the users via a regular form in a page, and then keep the
"logged-in" state with cookies.

I want to do it right (TM), and use basic http authentication with
mod_python.

So I set up the documentation example, got the "Hello World!" part to work
and now I am trying to make the authenhandler to work.

I have copied the example as in the documentation and tried to access the
page. I get the user/pw window and fill it, but it alway fails with a 401
error.

I have tried diferent usernames and pws, but it always fails. The apache
logs show the user along with the 401 error, so I think I have the setup
working mostly ok.

Where could be the quirk?

Thanks in advance.
--
Eduardo Fern?ndez Corrales
eduardo@sistelnet.es
Sistelnet Integraciones Telem?ticas - http://www.sistelnet.es
NUEVOS TELEFONOS: 95-4186897 95-4186898 902-293030 Fax: 954186901


From jack at icecast.org  Wed Aug  9 17:12:33 2000
From: jack at icecast.org (Jack Moffitt)
Date: Fri Jan  9 21:45:59 2004
Subject: [mod_python] problem with authen handler
In-Reply-To: <007701c001ce$4b6b7c40$248a4cc3@sistelnet.es>
Message-ID: <Pine.LNX.4.10.10008091711260.14914-100000@deathstar.icecast.org>

I have the same problem, which i posted about a few days back.  Having
done some more research:

req.connection.user is correct, it has teh username

if i do username = req.connection.user then username == None.  I don't get
it.

jack.


On Wed, 9 Aug 2000, Eduardo Fernandez wrote:

> Hello everyone:
> 
> I whis I had discovered mod_python before. It would have saved me a lot of
> headaches in the application I am developing right now. In this app, I
> authenticate the users via a regular form in a page, and then keep the
> "logged-in" state with cookies.
> 
> I want to do it right (TM), and use basic http authentication with
> mod_python.
> 
> So I set up the documentation example, got the "Hello World!" part to work
> and now I am trying to make the authenhandler to work.
> 
> I have copied the example as in the documentation and tried to access the
> page. I get the user/pw window and fill it, but it alway fails with a 401
> error.
> 
> I have tried diferent usernames and pws, but it always fails. The apache
> logs show the user along with the 401 error, so I think I have the setup
> working mostly ok.
> 
> Where could be the quirk?
> 
> Thanks in advance.
> --
> Eduardo Fernández Corrales
> eduardo@sistelnet.es
> Sistelnet Integraciones Telemáticas - http://www.sistelnet.es
> NUEVOS TELEFONOS: 95-4186897 95-4186898 902-293030 Fax: 954186901
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 


From goodwin at apple.com  Wed Aug  9 22:21:02 2000
From: goodwin at apple.com (Larry Goodwin)
Date: Fri Jan  9 21:45:59 2004
Subject: [mod_python] invalid command in Apache config
Message-ID: <39923BBB.ABA1FFF6@apple.com>

I installed mod_python by changing the Apache config. 
Added "AddModule modules/extra/mod_python.c" to the Configuration file
Copied mod_python.c from mod_python...src/mod_python.c to apache.../src/modules/extra/
Ran configure, make and make install

Added the following to the httpd.conf file.
<Directory "/usr/local/webpages/test/">
AddHandler python-program .py
PythonHandler test
PythonDebug On
</Directory>

The test.py file is in /usr/local/webpages/test/
When I run apachectl configtest I get:
Syntax error on line 561 of /usr/local/apache/conf/httpd.conf:
Invalid command 'PythonHandler', perhaps mis-spelled or defined by a
module not included in the server configuration

Apache is 1.3.12 and mod_python is 2,4,1, Python is 1.5.2

Is there any way to make sure the mod_python.c was added to Apache or is
there another problem/

thanks

From grisha at ispol.com  Thu Aug 10 08:19:53 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:45:59 2004
Subject: [mod_python] problem with authen handler
In-Reply-To: <Pine.LNX.4.10.10008091711260.14914-100000@deathstar.icecast.org>
Message-ID: <Pine.LNX.4.21.0008100819040.9858-100000@saturn.ispol.com>

I'm looking into this right now.... It looks like if you call
get_basic_auth_pw() *first* - you get the user name.

Grisha


On Wed, 9 Aug 2000, Jack Moffitt wrote:

> I have the same problem, which i posted about a few days back.  Having
> done some more research:
> 
> req.connection.user is correct, it has teh username
> 
> if i do username = req.connection.user then username == None.  I don't get
> it.
> 
> jack.
> 
> 
> On Wed, 9 Aug 2000, Eduardo Fernandez wrote:
> 
> > Hello everyone:
> > 
> > I whis I had discovered mod_python before. It would have saved me a lot of
> > headaches in the application I am developing right now. In this app, I
> > authenticate the users via a regular form in a page, and then keep the
> > "logged-in" state with cookies.
> > 
> > I want to do it right (TM), and use basic http authentication with
> > mod_python.
> > 
> > So I set up the documentation example, got the "Hello World!" part to work
> > and now I am trying to make the authenhandler to work.
> > 
> > I have copied the example as in the documentation and tried to access the
> > page. I get the user/pw window and fill it, but it alway fails with a 401
> > error.
> > 
> > I have tried diferent usernames and pws, but it always fails. The apache
> > logs show the user along with the 401 error, so I think I have the setup
> > working mostly ok.
> > 
> > Where could be the quirk?
> > 
> > Thanks in advance.
> > --
> > Eduardo Fern?ndez Corrales
> > eduardo@sistelnet.es
> > Sistelnet Integraciones Telem?ticas - http://www.sistelnet.es
> > NUEVOS TELEFONOS: 95-4186897 95-4186898 902-293030 Fax: 954186901
> > 
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://www.modpython.org/mailman/listinfo/mod_python
> > 
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 


From grisha at ispol.com  Thu Aug 10 09:38:46 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:45:59 2004
Subject: [mod_python] some bug fixes and new features in CVS
Message-ID: <Pine.LNX.4.21.0008100927060.10100-100000@saturn.ispol.com>

Just FYI - 

I've checked in to the CVS server on sourceforge the version of mod_python
that has a number of new features, fixes and improvements. Some changes
were quite radical which is why I don't want to put it out as a release
just yet.

There are instructions on how to retrieve code from CVS on 
http://sourceforge.net/cvs/?group_id=7107

Some of the most significant changes are:

o New PythonEnablePdb directive that allows handlers to be executed
  within pdb (Python debugger).

o Proper finalization - Py_Finalize() C API function is called with a
  child proces exits, thus making sure all objects are destroyed properly.

o Dynamic handler registration. Now you can add handlers from within
  handlers. Extremely useful if you want, for example, to write an
  authentication handler that decides based on the userid which handler
  will handle the request.

o There is now a way to have multiple keys in a table via the
  add() function. Having multiple keys is critical to being able
  to set multiple cookies, as someone pointed out on this list.

o mod_python.c should compile with the -ansi option without warnings.


--
  Gregory (Grisha) Trubetskoy
       grisha@ispol.com


From grisha at ispol.com  Thu Aug 10 11:35:08 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:45:59 2004
Subject: [mod_python] some bug fixes and new features in CVS
In-Reply-To: <20000810135152.2096.qmail@web2206.mail.yahoo.com>
Message-ID: <Pine.LNX.4.21.0008101127050.10351-100000@saturn.ispol.com>

The CGI memory leak is not a problem with mod_python itself really. It has
to do with cgi.py and what it does. The thing to realize about mod_python
(or mod_perl, or php for that matter), is that code that is not careful
about memory allocation, will make apache process grow and grow.

I think that there are only two possible solutions - 

1. Some mod_python module that kills httpd when it reaches a certain
size. That's the technique mod_perl folks use.

2. A fix/rewrite of cgi.py.

The latter is the right thing to do, of course, but who knows when it will
happen....

I'd like to mention that this issue is certainly high on my TODO list, and
I'm open to any advice, suggetions, code snippets, patches, etc :-)

Grisha


On Thu, 10 Aug 2000, Alexis Iglauer wrote:

> Has the cgi memory leak been sorted out yet?  I am
> having to restart my apache at least once a day to not
> swamp my machine......
> 
> Keep up the excellent work!
> Regards
> Alexis
> --- Gregory Trubetskoy <grisha@ispol.com> wrote:
> > 
> > Just FYI - 
> > 
> > I've checked in to the CVS server on sourceforge the
> > version of mod_python
> > that has a number of new features, fixes and
> > improvements. Some changes
> > were quite radical which is why I don't want to put
> > it out as a release
> > just yet.
> > 
> > There are instructions on how to retrieve code from
> > CVS on 
> > http://sourceforge.net/cvs/?group_id=7107
> > 
> > Some of the most significant changes are:
> > 
> > o New PythonEnablePdb directive that allows handlers
> > to be executed
> >   within pdb (Python debugger).
> > 
> > o Proper finalization - Py_Finalize() C API function
> > is called with a
> >   child proces exits, thus making sure all objects
> > are destroyed properly.
> > 
> > o Dynamic handler registration. Now you can add
> > handlers from within
> >   handlers. Extremely useful if you want, for
> > example, to write an
> >   authentication handler that decides based on the
> > userid which handler
> >   will handle the request.
> > 
> > o There is now a way to have multiple keys in a
> > table via the
> >   add() function. Having multiple keys is critical
> > to being able
> >   to set multiple cookies, as someone pointed out on
> > this list.
> > 
> > o mod_python.c should compile with the -ansi option
> > without warnings.
> > 
> > 
> > --
> >   Gregory (Grisha) Trubetskoy
> >        grisha@ispol.com
> > 
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://www.modpython.org/mailman/listinfo/mod_python
> 
> 
> __________________________________________________
> Do You Yahoo!?
> Kick off your party with Yahoo! Invites.
> http://invites.yahoo.com/
> 


From sbi at acse.be  Thu Aug 10 19:40:09 2000
From: sbi at acse.be (Stephane Bidoul)
Date: Fri Jan  9 21:45:59 2004
Subject: [mod_python] mod_python / win32all and COM
References: <2D0E3DBA4C66D31195920008C784F4AF01332A5C@nt_syd_ex08.macbank>
Message-ID: <00a801c002f2$0d882020$faa679c1@spirou>

I think you need to put COM in free-threaded mode
by doing

>>> sys.coinit_flags = 0

before anything else.

There is a mention of this in the Python COM readme,
but and can't recall where it's documented in more details...

Tell me if it works for you.

-sbi

----- Original Message -----
From: "Robert Nasca" <Robert.Nasca@macquarie.com.au>
To: <mod_python@modpython.org>
Sent: Tuesday, 08 August, 2000 01:27
Subject: [mod_python] mod_python / win32all and COM


> Hi,
>
> Is there an FAQ on using mod_python with COM? It seems that I am having
> problems due to the threaded nature of Apache on win32 and it's
> interaction with COM.
>
> I have created an interface to some COM objects using the "makepy.py"
> program which comes with win32all.
>
> When I run Apache with ThreadsPerChild set to 1, everything runs fine
> (albeit with only one client), but when I set this to something higher,
> I get errors saying "CoInitialise() has not been called", which I assume
> are related to Apache spawning multiple threads. I've attached the
> output below.
>
> Mod_python error: "PythonHandler pytest"Traceback (innermost last):
>   File "h:\website\python\mod_python\apache.py", line 119, in Dispatch
>     result = object(req)
>   File "h:/website/htdocs/test\pytest.py", line 8, in handler
>     d = Snakey.Database.RiskReporterDatabase()
>   File "H:\WebSite\Python\Snakey\Database.py", line 32, in __init__
>     self.openConnection("DSN=RISK_REPORTER")
>   File "H:\WebSite\Python\Snakey\Database.py", line 20, in
> openConnection
>     self.connection = msado21.Connection()
>   File "H:\PythonDev\Snakey\msado21.py", line 1607, in __init__
> com_error: (-2147221008, 'CoInitialize has not been called.', None,
> None)
>
> If anyone has a suggestion on what is happening, or pointers to some
> information on using mod_python and COM, it would be appreciated.
>
> Thanks,
> Rob.
>
>



From goodwin at apple.com  Fri Aug 11 10:59:21 2000
From: goodwin at apple.com (Larry Goodwin)
Date: Fri Jan  9 21:45:59 2004
Subject: [mod_python] Problems with getting mod_python into Apache
Message-ID: <39943D7C.CB56DBA0@apple.com>

Folks, I am still having problems with getting mod_python compiled into
Apache 1.3.12
I followed the procedures:
cd apache/src
vi Configuration
AddModule modules/extra/mod_python.c
./Configure

Get this error:
+ adding selected modules
    o python_module uses ConfigStart/End
 + checking sizeof various data types
 + doing sanity check on compiler and options
** A test compilation with your Makefile configuration
** failed.  The below error output from the compilation
** test will give you an idea what is failing. Note that
** Apache requires an ANSI C Compiler, such as gcc.

======== Error Output for sanity check ========
cd ..; gcc  -DAIX=41 -DNEED_RLIM_T -U__STR__ -DAIX_BIND_PROCESSOR -DUSE_HSREGEX
-DUSE_EXPAT -I./lib/expat-lite -DNO_DL_NEEDED 
-I/usr/local/include/python1.5  -
Wl,-bE:python.exp -lld      -o helpers/dummy helpers/dummy.c   /usr/local/lib/py
thon1.5/config/libpython1.5.a      -lm
ld: 0706-004 Cannot find or read export file: python.exp
        ld:accessx(): No such file or directory
collect2: ld returned 255 exit status
make: *** [dummy] Error 1
============= End of Error Report =============

 Aborting!

python.exp is in /usr/local/lib/python1.5/conf

My path is: 
PATH=/usr/local/bin:/usr/local/lib/python1.5:/usr/local/lib/python1.5/conf:/usr/
local/include/python1.5:/usr/bin:/etc:/usr/sbin:/usr/ucb:/usr/bin/X11:/sbin

Thanks,
Larry

From daniel at unity.copyleft.no  Fri Aug 11 21:29:58 2000
From: daniel at unity.copyleft.no (Daniel Mikkelsen)
Date: Fri Jan  9 21:45:59 2004
Subject: [mod_python] PythonImport
Message-ID: <Pine.LNX.4.10.10008112123040.27319-100000@unity.copyleft.no>

Hi.

I'm having problems with loading modules not located in the global
site-packages directory. 

I want to load a module that opens a connection to a database, and
I want this module to be located in the same directory as the .py
files that will make use of it. 

However, I always get:

  Fri Aug 11 21:16:46 2000] [error] directive_PythonImport: error
  importing open_db_con ImportError: No module named open_db_con

If I copy the module into site-packages, this works. But I don't want
do this, as I expect to have lots of different programs that will 
want to access lots of different databases. 

I've tried using the PythonPath directive, to no avail. I'm using 
mod_python 2.4.1 loaded dynamically with Apache 1.3.9 on OpenBSD 2.6. 

Anything obvious I'm doing wrong?

-- Daniel Mikkelsen, Copyleft Software



From michael at stroeder.com  Fri Aug 11 21:50:05 2000
From: michael at stroeder.com (Michael =?iso-8859-1?Q?Str=F6der?=)
Date: Fri Jan  9 21:45:59 2004
Subject: [mod_python] PythonImport
References: <Pine.LNX.4.10.10008112123040.27319-100000@unity.copyleft.no>
Message-ID: <399458ED.BC942863@stroeder.com>

Daniel Mikkelsen wrote:
> 
> I'm having problems with loading modules not located in the global
> site-packages directory.
> 
> I want to load a module that opens a connection to a database, and
> I want this module to be located in the same directory as the .py
> files that will make use of it.

sys.path.append() is not an option?

Ciao, Michael.

From bfordham at piratech.net  Fri Aug 11 16:07:15 2000
From: bfordham at piratech.net (bfordham@piratech.net)
Date: Fri Jan  9 21:45:59 2004
Subject: [mod_python] PythonImport
In-Reply-To: <Pine.LNX.4.10.10008112123040.27319-100000@unity.copyleft.no>
Message-ID: <399424B3.32484.9BFEE0@localhost>

-----BEGIN PGP SIGNED MESSAGE-----

On 11 Aug 2000, at 21:29, Daniel Mikkelsen wrote:

> Hi.
> 
> I'm having problems with loading modules not located in the global
> site-packages directory. 

I tried a couple of quick tests.  First I created a module (yoda.py)
with one line (x=1) and put it in the directory with my main script. 
Told the main script to import it and print yoda.x; worked fine.

Moved yoda.py to directory blah, and added:
PythonPath "sys.path+['/serverpath','/serverpath/blah']
to my httpd.conf file.  Restarted the server, it worked, too.

I'm running Debian 2.1, Apache 1.3.12 and mod_python as a DSO.

Are you sure the script to want imported is in a directory the server
can read?  Did you restart the server?

Sorry I can't be of more help

- --B

-----BEGIN PGP SIGNATURE-----
Version: N/A

iQCVAwUBOZRctw2B1TBOdblFAQE+6AP5AVcFKkk8lwXZg8aXrpIUFJ29dJ+es3zy
LA0uHhKr1GVP0MoGuU/K6ovw9jU+mQG/XweirNn1ZjcCj5tAbxx26V9d15fF5Llx
z2aklem04SOExXNcXsM4DWCm/Rpe4O79TEdrPB//ZcdBmoBXgPbEbZ8R033y54Hy
thKrNKNZcM0=
=U2pW
-----END PGP SIGNATURE-----


From grisha at ispol.com  Fri Aug 11 17:25:14 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:45:59 2004
Subject: [mod_python] PythonImport
In-Reply-To: <Pine.LNX.4.10.10008112123040.27319-100000@unity.copyleft.no>
Message-ID: <Pine.LNX.4.21.0008111723300.14946-100000@saturn.ispol.com>

Is your PythonImport within an appropriate <Directory> tag or just by
itself?

--
  Gregory (Grisha) Trubetskoy
       grisha@ispol.com

On Fri, 11 Aug 2000, Daniel Mikkelsen wrote:

> Hi.
> 
> I'm having problems with loading modules not located in the global
> site-packages directory. 
> 
> I want to load a module that opens a connection to a database, and
> I want this module to be located in the same directory as the .py
> files that will make use of it. 
> 
> However, I always get:
> 
>   Fri Aug 11 21:16:46 2000] [error] directive_PythonImport: error
>   importing open_db_con ImportError: No module named open_db_con
> 
> If I copy the module into site-packages, this works. But I don't want
> do this, as I expect to have lots of different programs that will 
> want to access lots of different databases. 
> 
> I've tried using the PythonPath directive, to no avail. I'm using 
> mod_python 2.4.1 loaded dynamically with Apache 1.3.9 on OpenBSD 2.6. 
> 
> Anything obvious I'm doing wrong?
> 
> -- Daniel Mikkelsen, Copyleft Software
> 
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 


From daniel at unity.copyleft.no  Fri Aug 11 23:26:13 2000
From: daniel at unity.copyleft.no (Daniel Mikkelsen)
Date: Fri Jan  9 21:45:59 2004
Subject: [mod_python] PythonTransHandler
Message-ID: <Pine.LNX.4.10.10008112323570.27319-100000@unity.copyleft.no>

Hi.

Anyone here know how the PythonTransHandler works? It looks like it's
supposed to let me translate the URI at an early stage. But I'm
uncertain as to how my transhandler(req) is supposed to realize the 
translation it does. 

-- Daniel Mikkelsen, Copyelft Software



From L.A.Timochouk at ukc.ac.uk  Fri Aug 11 23:00:29 2000
From: L.A.Timochouk at ukc.ac.uk (Dr. L.A. Timochouk)
Date: Fri Jan  9 21:45:59 2004
Subject: [mod_python] A patch for mod_python-2.4.1
Message-ID: <Pine.GSO.4.21.0008112257320.29709-100000@myrtle.ukc.ac.uk>

Hello All,

Please find attached a patch for mod_python-2.4.1. It addresses two issues:

(1) The current implementation of "req_read" method seems to contain a bug
    (or a problematic feature?): it may return less bytes than was requested,
    due to a known sockets phenomenon called "short read". Namely, a single
    "read" on a TCP socket returns data ONLY up to the end of the current
    IP packet; several "read"s may be required to get the whole amount
    requested. The current implementation did not guard against that; on the
    contrary, it shrank the output buffer is less-than-expected bytes were
    received. In particular, this may result in incomplete receiving of POSTed
    data (the problem shows up on large submissions only). The proposed
    patch fixes it.

(2) A new Apache directive,

    PythonOptimize On|Off

    is implemented. If set, it allows us to run the interpreter in the
    fully-optimising mode (equivalent to -OO Python command-line argument)
    which may be useful for time-critical applications.

Best regards,

Dr. Leonid Timochouk
Computing Laboratory
University of Kent at Canterbury
England
===============================================================================

--- mod_python.c.orig	Tue Jul  4 18:49:31 2000
+++ mod_python.c	Sun Jul 23 16:39:55 2000
@@ -1277,7 +1277,7 @@
 static PyObject * req_read(requestobject *self, PyObject *args)
 {
 
-    int len, rc, bytes_read;
+    int len, rc, bytes_read, chunk_len;
     char *buffer;
     PyObject *result;
 
@@ -1316,13 +1316,18 @@
 	return NULL;
 
     /* read it in */
+    /* BEWARE of short reads!  */
     buffer = PyString_AS_STRING((PyStringObject *) result);
-    bytes_read = ap_get_client_block(self->request_rec, buffer, len);
-
-    /* resize if necessary */
-    if (bytes_read < len) 
-	if(_PyString_Resize(&result, bytes_read))
+    bytes_read = 0;
+    while (bytes_read < len)
+    {
+	chunk_len = ap_get_client_block
+		    (self->request_rec, buffer+bytes_read, len-bytes_read);
+	if  (chunk_len == 0)
+	    /* Connection closed -- it's better not to return anything */
 	    return NULL;
+    	bytes_read += chunk_len;
+    }
 
     return result;
 }
@@ -2087,6 +2092,19 @@
 }
 
 /**
+ ** directive_PythonOptimize
+ **
+ *	This function called whenever PythonOptimize directive
+ *	is encountered.
+ */
+static const char *directive_PythonOptimize(cmd_parms *cmd, void *mconfig,
+					    int val) {
+    if (val)
+	Py_OptimizeFlag = 2; /* Optimize and remove function descr strings */
+    return NULL;
+}
+
+/**
  ** directive_PythonInterpPerDirectory
  **
  *      This function called whenever PythonInterpPerDirectory directive
@@ -2409,6 +2427,14 @@
 	OR_ALL,                         
 	FLAG,                               
 	"Send (most) Python error output to the client rather than logfile."
+    },
+    {
+	"PythonOptimize",
+	directive_PythonOptimize,
+	NULL,
+	OR_ALL,
+	FLAG,
+	"Set the equivalent of the -O command-line flag on the interpreter."
     },
     {
 	"PythonNoReload",                 



From dyeung at ust.hk  Mon Aug 14 09:26:49 2000
From: dyeung at ust.hk (David YEUNG)
Date: Fri Jan  9 21:45:59 2004
Subject: [mod_python] How to define an environment variable for other python module to use?
Message-ID: <39974AD9.2C33FAE1@ust.hk>

I have other python modules which usually need to read some environment
variables, e.g., an python-oracle interface module needs to read the "ORACLE_SID"
to know where the database to connect. I used to defining this variable in the "shell"
before invoking a python CGI program, e.g.:

   #!/bin/sh
   export ORACLE_SID=orcl
   exec /some/oracle/python/interface.cgi

I would like to try the mod_python using the default CGI handler, but does someone
know how to define some environment variable in mod_python?

Thanks

david

From jack at icecast.org  Sun Aug 13 18:37:05 2000
From: jack at icecast.org (Jack Moffitt)
Date: Fri Jan  9 21:46:00 2004
Subject: [mod_python] How to define an environment variable for other
 python module to use?
In-Reply-To: <39974AD9.2C33FAE1@ust.hk>
Message-ID: <Pine.LNX.4.10.10008131836030.24345-100000@deathstar.icecast.org>

generally when we do this with php, we define the ENV variables in the
apache startup script, so that they get into every child process.  then
they are readable with the normal environment functions.

we don't normally change where the oracle_sid is, so we have no need to
set them.

jack.

On Mon, 14 Aug 2000, David YEUNG wrote:

> I have other python modules which usually need to read some environment
> variables, e.g., an python-oracle interface module needs to read the "ORACLE_SID"
> to know where the database to connect. I used to defining this variable in the "shell"
> before invoking a python CGI program, e.g.:
> 
>    #!/bin/sh
>    export ORACLE_SID=orcl
>    exec /some/oracle/python/interface.cgi
> 
> I would like to try the mod_python using the default CGI handler, but does someone
> know how to define some environment variable in mod_python?
> 
> Thanks
> 
> david
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 


From rdevide at ican.at  Mon Aug 14 11:51:37 2000
From: rdevide at ican.at (Devide Robert)
Date: Fri Jan  9 21:46:00 2004
Subject: [mod_python] some bug fixes and new features in CVS
References: <Pine.LNX.4.21.0008101127050.10351-100000@saturn.ispol.com>
Message-ID: <3997C129.EA8F5DED@ican.at>

Gregory Trubetskoy wrote:
> 1. Some mod_python module that kills httpd when it reaches a certain
> size. That's the technique mod_perl folks use.

Would rather use something like

MaxRequestsPerChild 100

in apache config.
(as it had proofed to be the simplest and most effective way to 'handle'
memory leaks in various modules)

dave

From grisha at ispol.com  Mon Aug 14 08:31:17 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:46:00 2004
Subject: [mod_python] PythonTransHandler
In-Reply-To: <Pine.LNX.4.10.10008112323570.27319-100000@unity.copyleft.no>
Message-ID: <Pine.LNX.4.21.0008140827470.1734-100000@saturn.ispol.com>

You basically take assign a value to req.filename, usually based on
req.uri. There is a problem in 2.4.1 though - the filename attribute is
read-only. This has been fixed in the latest code which you can get from
CVS.

--
  Gregory (Grisha) Trubetskoy
       grisha@ispol.com

On Fri, 11 Aug 2000, Daniel Mikkelsen wrote:

> Hi.
> 
> Anyone here know how the PythonTransHandler works? It looks like it's
> supposed to let me translate the URI at an early stage. But I'm
> uncertain as to how my transhandler(req) is supposed to realize the 
> translation it does. 
> 
> -- Daniel Mikkelsen, Copyelft Software
> 
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 


From grisha at ispol.com  Mon Aug 14 08:36:09 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:46:00 2004
Subject: [mod_python] A patch for mod_python-2.4.1
In-Reply-To: <Pine.GSO.4.21.0008112257320.29709-100000@myrtle.ukc.ac.uk>
Message-ID: <Pine.LNX.4.21.0008140834280.1734-100000@saturn.ispol.com>

Thanks Leonid. I still have your original -OO patch in my INBOX and I'll
make sure to apply it.

Question - are you sure ap_get_client_block() doesn't take care of short
reads?

Thanks!

--
  Gregory (Grisha) Trubetskoy
       grisha@ispol.com

On Fri, 11 Aug 2000, Dr. L.A. Timochouk wrote:

> Hello All,
> 
> Please find attached a patch for mod_python-2.4.1. It addresses two issues:
> 
> (1) The current implementation of "req_read" method seems to contain a bug
>     (or a problematic feature?): it may return less bytes than was requested,
>     due to a known sockets phenomenon called "short read". Namely, a single
>     "read" on a TCP socket returns data ONLY up to the end of the current
>     IP packet; several "read"s may be required to get the whole amount
>     requested. The current implementation did not guard against that; on the
>     contrary, it shrank the output buffer is less-than-expected bytes were
>     received. In particular, this may result in incomplete receiving of POSTed
>     data (the problem shows up on large submissions only). The proposed
>     patch fixes it.
> 
> (2) A new Apache directive,
> 
>     PythonOptimize On|Off
> 
>     is implemented. If set, it allows us to run the interpreter in the
>     fully-optimising mode (equivalent to -OO Python command-line argument)
>     which may be useful for time-critical applications.
> 
> Best regards,
> 
> Dr. Leonid Timochouk
> Computing Laboratory
> University of Kent at Canterbury
> England
> ===============================================================================
> 
> --- mod_python.c.orig	Tue Jul  4 18:49:31 2000
> +++ mod_python.c	Sun Jul 23 16:39:55 2000
> @@ -1277,7 +1277,7 @@
>  static PyObject * req_read(requestobject *self, PyObject *args)
>  {
>  
> -    int len, rc, bytes_read;
> +    int len, rc, bytes_read, chunk_len;
>      char *buffer;
>      PyObject *result;
>  
> @@ -1316,13 +1316,18 @@
>  	return NULL;
>  
>      /* read it in */
> +    /* BEWARE of short reads!  */
>      buffer = PyString_AS_STRING((PyStringObject *) result);
> -    bytes_read = ap_get_client_block(self->request_rec, buffer, len);
> -
> -    /* resize if necessary */
> -    if (bytes_read < len) 
> -	if(_PyString_Resize(&result, bytes_read))
> +    bytes_read = 0;
> +    while (bytes_read < len)
> +    {
> +	chunk_len = ap_get_client_block
> +		    (self->request_rec, buffer+bytes_read, len-bytes_read);
> +	if  (chunk_len == 0)
> +	    /* Connection closed -- it's better not to return anything */
>  	    return NULL;
> +    	bytes_read += chunk_len;
> +    }
>  
>      return result;
>  }
> @@ -2087,6 +2092,19 @@
>  }
>  
>  /**
> + ** directive_PythonOptimize
> + **
> + *	This function called whenever PythonOptimize directive
> + *	is encountered.
> + */
> +static const char *directive_PythonOptimize(cmd_parms *cmd, void *mconfig,
> +					    int val) {
> +    if (val)
> +	Py_OptimizeFlag = 2; /* Optimize and remove function descr strings */
> +    return NULL;
> +}
> +
> +/**
>   ** directive_PythonInterpPerDirectory
>   **
>   *      This function called whenever PythonInterpPerDirectory directive
> @@ -2409,6 +2427,14 @@
>  	OR_ALL,                         
>  	FLAG,                               
>  	"Send (most) Python error output to the client rather than logfile."
> +    },
> +    {
> +	"PythonOptimize",
> +	directive_PythonOptimize,
> +	NULL,
> +	OR_ALL,
> +	FLAG,
> +	"Set the equivalent of the -O command-line flag on the interpreter."
>      },
>      {
>  	"PythonNoReload",                 
> 
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 


From grisha at ispol.com  Mon Aug 14 08:46:38 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:46:00 2004
Subject: [mod_python] some bug fixes and new features in CVS
In-Reply-To: <3997C129.EA8F5DED@ican.at>
Message-ID: <Pine.LNX.4.21.0008140845080.1734-100000@saturn.ispol.com>

That's the way I would do it. BTW - I heard that this directive does
nothing on Win32 where Apache is threaded. Of course the solution I
sugested (killing the process) wouldn't help either....

Grisha

On Mon, 14 Aug 2000, Devide Robert wrote:

> Gregory Trubetskoy wrote:
> > 1. Some mod_python module that kills httpd when it reaches a certain
> > size. That's the technique mod_perl folks use.
> 
> Would rather use something like
> 
> MaxRequestsPerChild 100
> 
> in apache config.
> (as it had proofed to be the simplest and most effective way to 'handle'
> memory leaks in various modules)
> 
> dave
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 


From miguel at yorku.ca  Mon Aug 14 09:20:56 2000
From: miguel at yorku.ca (Miguel Marques)
Date: Fri Jan  9 21:46:00 2004
Subject: [mod_python] some bug fixes and new features in CVS
In-Reply-To: <Pine.LNX.4.21.0008101127050.10351-100000@saturn.ispol.com>
References: <20000810135152.2096.qmail@web2206.mail.yahoo.com>
	<Pine.LNX.4.21.0008101127050.10351-100000@saturn.ispol.com>
Message-ID: <20000814092056B.miguel@yorku.ca>

On Thu, 10 Aug 2000 11:35:08 -0400 (EDT), Gregory Trubetskoy <grisha@ispol.com> wrote:
> 
> The CGI memory leak is not a problem with mod_python itself really. It has
> to do with cgi.py and what it does. The thing to realize about mod_python

Could you elaborate on why or how cgi.py leaks memory?  I'm using both
mod_python and cgi on a project that will see very large usage and I
would like to try and figure out if I should drop usage of cgi.py or not.
Thanks!

							Miguel

C. Miguel Marques, York University, Computing & Communications Services
e-mail: miguel@yorku.ca, voice: (416)736-2100x22684, fax: (416)736-5830

From L.A.Timochouk at ukc.ac.uk  Mon Aug 14 15:44:19 2000
From: L.A.Timochouk at ukc.ac.uk (Dr. L.A. Timochouk)
Date: Fri Jan  9 21:46:00 2004
Subject: [mod_python] A patch for mod_python-2.4.1
In-Reply-To: <Pine.LNX.4.21.0008140834280.1734-100000@saturn.ispol.com>
Message-ID: <Pine.GSO.4.21.0008141538030.24919-100000@myrtle.ukc.ac.uk>

Yes, it appeared to us that "ap_get_client_block" is susceptible to short
reads -- it indeed reads a BLOCK until the end of the current IP datagram
but no further. The problem was discovered when we implemented our Web
site with relatively large user submissions (by POST) using the current
version of mod_python. The exact cause of the problem was identified with
the help of "tcpdump".

Sincerely, L.A.Timochouk


From gstein at lyra.org  Mon Aug 14 12:53:29 2000
From: gstein at lyra.org (Greg Stein)
Date: Fri Jan  9 21:46:00 2004
Subject: [mod_python] A patch for mod_python-2.4.1 (fwd)
In-Reply-To: <Pine.LNX.4.21.0008141206500.2308-100000@saturn.ispol.com>; from grisha@ispol.com on Mon, Aug 14, 2000 at 12:08:19PM -0400
References: <Pine.LNX.4.21.0008141206500.2308-100000@saturn.ispol.com>
Message-ID: <20000814125329.X19525@lyra.org>

Nope. Haven't been reading it.

ap_get_client_block() returns a length. It can definitely return a length
less than that requested.

Or is it that length==0 gets returned before the end of the request? (which
would typically end the read loop)

Cheers,
-g

On Mon, Aug 14, 2000 at 12:08:19PM -0400, Gregory Trubetskoy wrote:
> 
> Greg -
> 
> Are you following this thread? This could could qualify as a bug in
> Apache if Dr. Timochouk is right.
> 
> Grisha
> 
> 
> ---------- Forwarded message ----------
> Date: Mon, 14 Aug 2000 15:44:19 +0100 (BST)
> From: Dr. L.A. Timochouk <L.A.Timochouk@ukc.ac.uk>
> To: Gregory Trubetskoy <grisha@ispol.com>
> Cc: mod_python@modpython.org
> Subject: Re: [mod_python] A patch for mod_python-2.4.1
> 
> Yes, it appeared to us that "ap_get_client_block" is susceptible to short
> reads -- it indeed reads a BLOCK until the end of the current IP datagram
> but no further. The problem was discovered when we implemented our Web
> site with relatively large user submissions (by POST) using the current
> version of mod_python. The exact cause of the problem was identified with
> the help of "tcpdump".
> 
> Sincerely, L.A.Timochouk

-- 
Greg Stein, http://www.lyra.org/

From jameswalker at clear.net.nz  Wed Aug 16 12:40:15 2000
From: jameswalker at clear.net.nz (James Walker)
Date: Fri Jan  9 21:46:00 2004
Subject: [mod_python] test.py runs even when deleted
Message-ID: <3999e2ef.dc4.0@clear.net.nz>

I've gotten mod_python (from the RPM) working on my Linux 6.2/Apache 1.3.12 box.
 I've sorted out all the <directory> stuff in httpd.conf and gotten the "Hello
to the ...." appear when accessing test.py or for that matter t.py (yes I understand
the "PythonHandler test" thing (I think)).

Now the issue.  I've deleted test.py and have a helloworld.py which has the
handler defined and which puts out a whole heap of html text.  However I still
get the same "Hello to ..." text from test.py (which is deleted!).  This happens
even after restarting apache and/or then rebooting the machine.

Anyone able to figure that one out?  I'm really looking forward to getting into
Python as I find it heaps easier to read/understand then Perl.  But while CGI
based Python scripts is an option I would prefer mod_python.

Hope somone can help,
James Walker.

From jameswalker at clear.net.nz  Thu Aug 17 10:02:52 2000
From: jameswalker at clear.net.nz (James Walker)
Date: Fri Jan  9 21:46:00 2004
Subject: [mod_python] test.py runs even when deleted
References: <3999e2ef.dc4.0@clear.net.nz>
Message-ID: <399B0F8C.208EDBC1@clear.net.nz>

Sorted.  Didn't realise that the .htaccess file actually had some stuff in it.  It's
directives were over-riding those I had in httpd.conf.  I commented those out and it
all started to behave as I was expecting.

Yah!  Off we go.

Cheers,
James.


James Walker wrote:

> I've gotten mod_python (from the RPM) working on my Linux 6.2/Apache 1.3.12 box.
>  I've sorted out all the <directory> stuff in httpd.conf and gotten the "Hello
> to the ...." appear when accessing test.py or for that matter t.py (yes I understand
> the "PythonHandler test" thing (I think)).
>
> Now the issue.  I've deleted test.py and have a helloworld.py which has the
> handler defined and which puts out a whole heap of html text.  However I still
> get the same "Hello to ..." text from test.py (which is deleted!).  This happens
> even after restarting apache and/or then rebooting the machine.
>
> Anyone able to figure that one out?  I'm really looking forward to getting into
> Python as I find it heaps easier to read/understand then Perl.  But while CGI
> based Python scripts is an option I would prefer mod_python.
>
> Hope somone can help,
> James Walker.
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python


From dirk at infostreet.com  Wed Aug 16 17:09:17 2000
From: dirk at infostreet.com (Dirk Leas)
Date: Fri Jan  9 21:46:00 2004
Subject: [mod_python] POSTed form fields?
Message-ID: <NBBBKMMANMGEEBHPJJECKEMDHKAA.dirk@infostreet.com>

How do I access them? I post a form with a hidden field, a text field, and
two fields encoded in the action. I dump all the request values (strings and
tables) and don't see my form fields, only values encoded in the URL. Quick
suggestion?

I've tried mod_python on both linux and win32 and get the same behavior.

Later,
D

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mailman.modpython.org/pipermail/mod_python/attachments/20000816/30422d2c/attachment.htm
From L.A.Timochouk at ukc.ac.uk  Thu Aug 17 01:31:43 2000
From: L.A.Timochouk at ukc.ac.uk (Dr. L.A. Timochouk)
Date: Fri Jan  9 21:46:00 2004
Subject: [mod_python] POSTed form fields?
In-Reply-To: <NBBBKMMANMGEEBHPJJECKEMDHKAA.dirk@infostreet.com>
Message-ID: <Pine.GSO.4.21.0008170121130.7748-100000@myrtle.ukc.ac.uk>

The request object does not contain parsed (or even unparsed) POSTed
fields, so you need to read and parse them yourself:

(1) get the total length of the POSTed data from the "Content-length"
    header (available through the "headers_in" table in the request
    object);

(2) read the data in using the "read" method on the req object; NB:
    in mod_python 2.4.1, "read" can return a shorter data chunk than
    requested ("short read"); a patch had been submitted which
    rectifies the problem; alternatively you can do multiple "read"s
    until you get the whole length of your data;

(3) then you can parse the contents splitting it into key=value
    pairs separated by "&"s. There are some subtleties like multiple
    fields with the same name, file submission by POST,etc, to take
    care about.

Hope it will help,

Leonid Timochouk
Computing Laboratory
University of Kent at Canterbury
England


From kevin at GamesAndTheory.com  Wed Aug 16 21:04:11 2000
From: kevin at GamesAndTheory.com (Kevin Douglas)
Date: Fri Jan  9 21:46:00 2004
Subject: [mod_python] not compiling
Message-ID: <DKEEJHGMIIOMNIJFOCAICEKLCBAA.kevin@GamesAndTheory.com>

apache 1.3.12 and the latest release of mod_python

more info later after i beat it around


(this is also a test message)


h3ll0!
:P


-kev



From grisha at ispol.com  Thu Aug 17 09:05:24 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:46:00 2004
Subject: [mod_python] POSTed form fields?
In-Reply-To: <Pine.GSO.4.21.0008170121130.7748-100000@myrtle.ukc.ac.uk>
Message-ID: <Pine.LNX.4.21.0008170859400.13868-100000@saturn.ispol.com>

In other words, something like:

import cgi

len = int(req.headers_in["content-length"])
form_data = cgi.parse_qs(req.read(len))

Should do it. Dr. Timouchouk is right - if you're POSTing large files
(50K+), then you should check the size returned by read() and read() again
if it wasn't all.

The next release will make this unnecessary - read() will return all there
was to read. It will also follow the apache Timeout directive.

If you're handy with CVS - you can get that code right now from the
sourceforge CVS server.

--
  Gregory (Grisha) Trubetskoy
       grisha@ispol.com

On Thu, 17 Aug 2000, Dr. L.A. Timochouk wrote:

> The request object does not contain parsed (or even unparsed) POSTed
> fields, so you need to read and parse them yourself:
> 
> (1) get the total length of the POSTed data from the "Content-length"
>     header (available through the "headers_in" table in the request
>     object);
> 
> (2) read the data in using the "read" method on the req object; NB:
>     in mod_python 2.4.1, "read" can return a shorter data chunk than
>     requested ("short read"); a patch had been submitted which
>     rectifies the problem; alternatively you can do multiple "read"s
>     until you get the whole length of your data;
> 
> (3) then you can parse the contents splitting it into key=value
>     pairs separated by "&"s. There are some subtleties like multiple
>     fields with the same name, file submission by POST,etc, to take
>     care about.
> 
> Hope it will help,
> 
> Leonid Timochouk
> Computing Laboratory
> University of Kent at Canterbury
> England
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 



From lahondes at pasteur.fr  Thu Aug 17 18:12:09 2000
From: lahondes at pasteur.fr (Raynald de Lahondes)
Date: Fri Jan  9 21:46:00 2004
Subject: [mod_python] configuring mod_python in Debian 2.2
Message-ID: <20000817181209.C13600@pombe.vironc.pasteur.fr>

I am interested in mod_python but have difficulties in configuring the
program. I am using Debian 2.2 binaries, id est:

apache 1.3.9
python 1.5.2

I successfully compiled the lib and installed them in
/usr/lib/python1.5/site-packages/mod_python

the "compileall.py" was ok.

I compiled mod_python as suggested with apxs tool

apxs -I /usr/include/python1.5 -c mod_python.c \
/usr/lib/python1.5/config/libpython1.5.a -lpthread

and copied the resulting mod_python.so in /usr/lib/apache/1.3/

I modified the httpd.conf as suggested (first module, cf FAQ):
LoadModule python_module /usr/lib/apache/1.3/mod_python.so

(apache started OK)
I modified srm.conf (resource file for apache in Debian)

AddHandler python-program .py
PythonHandler test
PythonDebug On

and restarted apache again.

Then I create /var/www/test

and put the example test.py in /var/www/test/test.py

access to http://localfile/test/anything.py

generate an error: (in apache/error.log)

[Thu Aug 17 17:29:03 2000] [error] PythonHandler test: Traceback\
(innermost last):
[Thu Aug 17 17:29:03 2000] [error] PythonHandler test:   File\
"/usr/lib/python1.5/mod_python/apache.py", line 113, in Dispatch
[Thu Aug 17 17:29:03 2000] [error] PythonHandler test:   File\
"/usr/lib/python1.5/mod_python/apache.py", line 246, in import_module
[Thu Aug 17 17:29:03 2000] [error] PythonHandler test: ImportError: No\
module named test

I tried to check directly with python libs but I can't:

>>> from mod_python import apache
Traceback (innermost last):
  File "<stdin>", line 1, in ?
  File "/usr/lib/python1.5/mod_python/apache.py", line 18, in ?
ImportError: No module named _apache
>>> 


I have done nearly all I could do with the documentation I have, I need some
help please !

-- 
Raynald de Lahondes
Unite des Virus Oncogenes - Departement de Biotechnologie
Institut Pasteur - 25, rue du Docteur Roux
75724 Paris Cedex 15 - FRANCE
tel: 01.45.68.84.54 - fax: 01.40.61.30.33 - cellular: 06.15.65.85.08
email: lahondes@pasteur.fr 

From grisha at ispol.com  Thu Aug 17 13:48:49 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:46:00 2004
Subject: [mod_python] configuring mod_python in Debian 2.2
In-Reply-To: <20000817181209.C13600@pombe.vironc.pasteur.fr>
Message-ID: <Pine.LNX.4.21.0008171346430.14123-100000@saturn.ispol.com>

Make sure you have some <Directory> tags, i.e:

<Directory /var/www/test>
	AddHandler python-program .py
	PythonHandler test
	PythonDebug On
</Directory>


On Thu, 17 Aug 2000, Raynald de Lahondes wrote:

> I am interested in mod_python but have difficulties in configuring the
> program. I am using Debian 2.2 binaries, id est:
> 
> apache 1.3.9
> python 1.5.2
> 
> I successfully compiled the lib and installed them in
> /usr/lib/python1.5/site-packages/mod_python
> 
> the "compileall.py" was ok.
> 
> I compiled mod_python as suggested with apxs tool
> 
> apxs -I /usr/include/python1.5 -c mod_python.c \
> /usr/lib/python1.5/config/libpython1.5.a -lpthread
> 
> and copied the resulting mod_python.so in /usr/lib/apache/1.3/
> 
> I modified the httpd.conf as suggested (first module, cf FAQ):
> LoadModule python_module /usr/lib/apache/1.3/mod_python.so
> 
> (apache started OK)
> I modified srm.conf (resource file for apache in Debian)
> 
> AddHandler python-program .py
> PythonHandler test
> PythonDebug On
> 
> and restarted apache again.
> 
> Then I create /var/www/test
> 
> and put the example test.py in /var/www/test/test.py
> 
> access to http://localfile/test/anything.py
> 
> generate an error: (in apache/error.log)
> 
> [Thu Aug 17 17:29:03 2000] [error] PythonHandler test: Traceback\
> (innermost last):
> [Thu Aug 17 17:29:03 2000] [error] PythonHandler test:   File\
> "/usr/lib/python1.5/mod_python/apache.py", line 113, in Dispatch
> [Thu Aug 17 17:29:03 2000] [error] PythonHandler test:   File\
> "/usr/lib/python1.5/mod_python/apache.py", line 246, in import_module
> [Thu Aug 17 17:29:03 2000] [error] PythonHandler test: ImportError: No\
> module named test
> 
> I tried to check directly with python libs but I can't:
> 
> >>> from mod_python import apache
> Traceback (innermost last):
>   File "<stdin>", line 1, in ?
>   File "/usr/lib/python1.5/mod_python/apache.py", line 18, in ?
> ImportError: No module named _apache
> >>> 
> 
> 
> I have done nearly all I could do with the documentation I have, I need some
> help please !
> 
> -- 
> Raynald de Lahondes
> Unite des Virus Oncogenes - Departement de Biotechnologie
> Institut Pasteur - 25, rue du Docteur Roux
> 75724 Paris Cedex 15 - FRANCE
> tel: 01.45.68.84.54 - fax: 01.40.61.30.33 - cellular: 06.15.65.85.08
> email: lahondes@pasteur.fr 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 


From rsalz at caveosystems.com  Thu Aug 17 15:09:08 2000
From: rsalz at caveosystems.com (Rich Salz)
Date: Fri Jan  9 21:46:00 2004
Subject: [mod_python] Swig, and mod_ssl
References: <200007160231.WAA04120@pc1.caveosystems.com>
Message-ID: <399C3854.B91CE827@caveosystems.com>

Back in mid-July, I wrote rsalz@caveosystems.com wrote:
> Swig (http://www.swig.org) is a "compiler" that can parse most C
> header files and automatically generate code for Perl, Tcl, Python,
> and Java.  At a rough guess, approximately half of mod_python.c could
> be replaced by a couple-dozen lines.  I wonder if it makes sense
> to use SWIG, and for sites without it, include the Swig output.
> (Just like some programs include the output of Yacc, for those without it.)
> 
> Second question, which motivated the first: anyone looked at what
> could/should be added to the mod_python objects when mod_ssl is used?

Here is what I am going to end up doing.  I added a "get_swig_handle"
method that returns the request_rec code into the SWIG representation
of a pointer.  I'll then write little SWIG code to pull things out of
the mod_ssl context.  I'll send get_swig_handle and a sample use if
there's interest.
	/r$

From grisha at ispol.com  Thu Aug 17 15:37:54 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:46:00 2004
Subject: [mod_python] Swig, and mod_ssl
In-Reply-To: <399C3854.B91CE827@caveosystems.com>
Message-ID: <Pine.LNX.4.21.0008171533280.14123-100000@saturn.ispol.com>

That'd be interesting to see. 

I'd really appreciate a lamens terms explanation of what it is you're
trying to get out of mod_ssl and what are the steps issues involved with
it? I'm somewhat mod_ssl ingorant - I've used it to set up SSL sites and
I'm somwhat familiar with use of openssl to generate certificates and
such, but I know next to nothing about mod_ssl internals.

P.S. Does SWIG really have to be involved in order for this to work?

--
  Gregory (Grisha) Trubetskoy
       grisha@ispol.com

On Thu, 17 Aug 2000, Rich Salz wrote:

> Back in mid-July, I wrote rsalz@caveosystems.com wrote:
> > Swig (http://www.swig.org) is a "compiler" that can parse most C
> > header files and automatically generate code for Perl, Tcl, Python,
> > and Java.  At a rough guess, approximately half of mod_python.c could
> > be replaced by a couple-dozen lines.  I wonder if it makes sense
> > to use SWIG, and for sites without it, include the Swig output.
> > (Just like some programs include the output of Yacc, for those without it.)
> > 
> > Second question, which motivated the first: anyone looked at what
> > could/should be added to the mod_python objects when mod_ssl is used?
> 
> Here is what I am going to end up doing.  I added a "get_swig_handle"
> method that returns the request_rec code into the SWIG representation
> of a pointer.  I'll then write little SWIG code to pull things out of
> the mod_ssl context.  I'll send get_swig_handle and a sample use if
> there's interest.
> 	/r$
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 


From rsalz at caveosystems.com  Thu Aug 17 15:51:10 2000
From: rsalz at caveosystems.com (Rich Salz)
Date: Fri Jan  9 21:46:00 2004
Subject: [mod_python] Swig, and mod_ssl
References: <Pine.LNX.4.21.0008171533280.14123-100000@saturn.ispol.com>
Message-ID: <399C422E.1387F0CC@caveosystems.com>

> That'd be interesting to see.

Let me play with it a day or two and I'll send the patch along.

> I'd really appreciate a lamens terms explanation of what it is you're
> trying to get out of mod_ssl and what are the steps issues involved with
> it?

The simplest thing is: I want to be able to get the the DN of the client
and their entire cert, if there is one.  With this, I can do all my own
authorization rules in my python code.  Later on, I want to be able to
control what crypto protocols they're using, etc.

> I'm somwhat familiar with use of openssl to generate certificates and
> such, but I know next to nothing about mod_ssl internals.

> P.S. Does SWIG really have to be involved in order for this to work?

No.  It just saves me a lot of time. SWIG is a "compiler" that read C
(and, to some extent) C++ header files, and generates all the python
code to map the datatypes, and wrappers that convert from Py objects to
the C objects, and back.  Simple things (numbers strings) get mapped
directly, others are only exposed as pointers unless you write your own
conversions.  There are some good examples at http://www.swig.org

Ng Pheng Siong has a package, M2Crypto, that exposes most of the OpenSSL
functions up through python (via swig) -- see
http://www.post1.com/home/ngps.  So all I need is a little glue code
(i.e., my get_swig_handle patch) and I can do what I need.
	/r$

From grisha at ispol.com  Fri Aug 18 08:43:26 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:46:00 2004
Subject: [mod_python] Swig, and mod_ssl
In-Reply-To: <399C422E.1387F0CC@caveosystems.com>
Message-ID: <Pine.LNX.4.21.0008180839400.15289-100000@saturn.ispol.com>

On Thu, 17 Aug 2000, Rich Salz wrote:

> The simplest thing is: I want to be able to get the the DN of the client
> and their entire cert

BTW, one way to get DN is "SSLOptions +FakeBasicAuth", then the DN should
appear in req.connection.user.

http://www.modssl.org/docs/2.6/ssl_howto.html#ToC9


Grisha


From rsalz at caveosystems.com  Fri Aug 18 09:34:02 2000
From: rsalz at caveosystems.com (Rich Salz)
Date: Fri Jan  9 21:46:00 2004
Subject: [mod_python] Swig, and mod_ssl
References: <Pine.LNX.4.21.0008180839400.15289-100000@saturn.ispol.com>
Message-ID: <399D3B4A.7C5772BB@caveosystems.com>

> BTW, one way to get DN is "SSLOptions +FakeBasicAuth", then the DN should
> appear in req.connection.user.

Right.  But I need more than that.  I need to know *if* there's a client
cert, all the nitty-gritty details of it (e.g., what the keyUsage
extension is), I need to do my own verification, no CRL processing, my
own chain verification, etc.  Lots of stuff.  Ralph did a great job
writing a turn-key application that is great for most folks, but I need
to really get under the hood....

From pereran at yahoo.com  Fri Aug 18 07:57:16 2000
From: pereran at yahoo.com (Niranjan Perera)
Date: Fri Jan  9 21:46:00 2004
Subject: [mod_python] Trying to get mod_python+apache on FreeBSD working.
Message-ID: <20000818145716.24237.qmail@web512.mail.yahoo.com>

Hello:

I am  a newbie.

System: FreeBSD 4.0,
        Apache 1.3.12
        Python 1.5.2

Download mod_python, and followed instructions.

Added the following entry to httpd.conf

AddModule mod_python.c
<Directory /usr/local/www/data>
        AddHandler python-program .py
        PythonHandler test
        PythonDebug On
</Directory>

Placed in /usr/local/www/data the following code (
demo.py )
from mod_python import apache

def handler(req):
        req.send_http_header()
        req.write("Hello from Python!")
        return apache.OK

restarted httpd,

when I type http://xxx.yyy.zzz.com/demo.py
I get the following error message:

Mod_python error: "PythonHandler test"

Traceback (innermost last):

  File
"/usr/local/lib/python1.5/site-packages/mod_python/apache.py",
line 116, in Dispatch
    object = self.resolve_object(module, object_str)

  File
"/usr/local/lib/python1.5/site-packages/mod_python/apache.py",
line 51, in resolve_object
    raise AttributeError, s

AttributeError: module
'/usr/local/lib/python1.5/test/__init__.pyc' contains
no 'handler'


What am I missing ?


Thanks,

-- Niranjan






__________________________________________________
Do You Yahoo!?
Send instant messages & get email alerts with Yahoo! Messenger.
http://im.yahoo.com/

From michael at stroeder.com  Fri Aug 18 18:04:51 2000
From: michael at stroeder.com (Michael =?iso-8859-1?Q?Str=F6der?=)
Date: Fri Jan  9 21:46:00 2004
Subject: [mod_python] Swig, and mod_ssl
References: <Pine.LNX.4.21.0008180839400.15289-100000@saturn.ispol.com> <399D3B4A.7C5772BB@caveosystems.com>
Message-ID: <399D5EA3.7975AAEC@stroeder.com>

Rich Salz wrote:
> 
> > BTW, one way to get DN is "SSLOptions +FakeBasicAuth", then the DN 
> > should appear in req.connection.user.
> 
> Right.  But I need more than that.  I need to know *if* there's a client
> cert, all the nitty-gritty details of it (e.g., what the keyUsage
> extension is), I need to do my own verification, no CRL processing, my
> own chain verification, etc.  Lots of stuff.

I'm not sure I fully understand the problem but if you set

  SSLOptions +ExportCertData

you will get the client and server certs "PEM"-formatted exported to
the OS environment in variables SSL_CLIENT_CERT and SSL_SERVER_CERT.

Ciao, Michael.

From wmedia at hotmail.com  Fri Aug 18 12:22:02 2000
From: wmedia at hotmail.com (William Smith)
Date: Fri Jan  9 21:46:00 2004
Subject: [mod_python] Problems with mod_python
Message-ID: <F2176fQSgeR4UIS42NX000009c4@hotmail.com>

I am using RedHat 6.2 x86, Apache 1.3.12 and mod_python 2.4.1.
I compiled and installed mod_python with apxs.
Apache runs as user nobody and group nobody

I read the modpython archives and have the following server errors
which I saw mentioned in the archive message Aug 2, 2000 by
Boh Heong Yap (bohheong@asiacontent.com):

   make_obcallback(): could not import mod_python.apache.
    make_obcallback(): could not call init.

I tried in httpd.conf both:

<Directory /usr/apache/python>
        AddHandler python-program .py
        PythonHandler test
        PythonDebug On
</Directory>

and

<Directory /usr/apache/python>
    AddHandler python-program .py
    PythonHandler test
    PythonDebug On
</Directory>

which I also saw in the archives as a fix.  However this did not work.

The directories and files in
/usr/lib/python1.5/site-packages/mod_python are world readable but
owned by root.

Using the comand line I get:

File "/usr/lib/python1.5/site-packages/mod_python/apache.py", line
18, in ?
    import _apache
ImportError: No module named _apache

when I try "from mod_python import apache".

Any help getting this to work would be appreciated.
________________________________________________________________________
Get Your Private, Free E-mail from MSN Hotmail at http://www.hotmail.com


From rsalz at caveosystems.com  Fri Aug 18 12:29:42 2000
From: rsalz at caveosystems.com (Rich Salz)
Date: Fri Jan  9 21:46:00 2004
Subject: [mod_python] Swig, and mod_ssl
References: <Pine.LNX.4.21.0008180839400.15289-100000@saturn.ispol.com> <399D3B4A.7C5772BB@caveosystems.com> <399D5EA3.7975AAEC@stroeder.com>
Message-ID: <399D6476.62BE89E7@caveosystems.com>

>   SSLOptions +ExportCertData

Yes, thanks.  I need more than that.  I need just about full
programmatic control over SSL within my python module.

From grisha at ispol.com  Fri Aug 18 12:30:04 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:46:00 2004
Subject: [mod_python] Swig, and mod_ssl
In-Reply-To: <399D5EA3.7975AAEC@stroeder.com>
Message-ID: <Pine.LNX.4.21.0008181228110.18108-100000@saturn.ispol.com>


If that is correct - then all that stuff should show up in 

req.subprocess_env["SSL_CLIENT_CERT"] and ["SSL_SERVER_CERT"]

:-)

Rich - could you verify this?

Grisha

On Fri, 18 Aug 2000, Michael Str?der wrote:

> I'm not sure I fully understand the problem but if you set
> 
>   SSLOptions +ExportCertData
> 
> you will get the client and server certs "PEM"-formatted exported to
> the OS environment in variables SSL_CLIENT_CERT and SSL_SERVER_CERT.



From grisha at ispol.com  Fri Aug 18 12:38:23 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:46:00 2004
Subject: [mod_python] Problems with mod_python
In-Reply-To: <F2176fQSgeR4UIS42NX000009c4@hotmail.com>
Message-ID: <Pine.LNX.4.21.0008181237490.18108-100000@saturn.ispol.com>

the only thing I can think of is that the direcories where mod_python is
should also be world executable...

Grisha

On Fri, 18 Aug 2000, William Smith wrote:

> I am using RedHat 6.2 x86, Apache 1.3.12 and mod_python 2.4.1.
> I compiled and installed mod_python with apxs.
> Apache runs as user nobody and group nobody
> 
> I read the modpython archives and have the following server errors
> which I saw mentioned in the archive message Aug 2, 2000 by
> Boh Heong Yap (bohheong@asiacontent.com):
> 
>    make_obcallback(): could not import mod_python.apache.
>     make_obcallback(): could not call init.
> 
> I tried in httpd.conf both:
> 
> <Directory /usr/apache/python>
>         AddHandler python-program .py
>         PythonHandler test
>         PythonDebug On
> </Directory>
> 
> and
> 
> <Directory /usr/apache/python>
>     AddHandler python-program .py
>     PythonHandler test
>     PythonDebug On
> </Directory>
> 
> which I also saw in the archives as a fix.  However this did not work.
> 
> The directories and files in
> /usr/lib/python1.5/site-packages/mod_python are world readable but
> owned by root.
> 
> Using the comand line I get:
> 
> File "/usr/lib/python1.5/site-packages/mod_python/apache.py", line
> 18, in ?
>     import _apache
> ImportError: No module named _apache
> 
> when I try "from mod_python import apache".
> 
> Any help getting this to work would be appreciated.
> ________________________________________________________________________
> Get Your Private, Free E-mail from MSN Hotmail at http://www.hotmail.com
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 


From rsalz at caveosystems.com  Fri Aug 18 12:46:12 2000
From: rsalz at caveosystems.com (Rich Salz)
Date: Fri Jan  9 21:46:00 2004
Subject: [mod_python] Swig, and mod_ssl
References: <Pine.LNX.4.21.0008181228110.18108-100000@saturn.ispol.com>
Message-ID: <399D6854.B5B21303@caveosystems.com>

> >   SSLOptions +ExportCertData
> req.subprocess_env["SSL_CLIENT_CERT"] and ["SSL_SERVER_CERT"]
> Rich - could you verify this?

sure, yup, works fine.  The PEM-encoded server cert (and the client one,
if presented) is ther.  That's not enough for my app, but maybe that's
enough for everyone else, and my little hack isn't needed.
	/r$

From michael at stroeder.com  Fri Aug 18 19:10:49 2000
From: michael at stroeder.com (Michael =?iso-8859-1?Q?Str=F6der?=)
Date: Fri Jan  9 21:46:00 2004
Subject: [mod_python] Swig, and mod_ssl
References: <Pine.LNX.4.21.0008180839400.15289-100000@saturn.ispol.com> <399D3B4A.7C5772BB@caveosystems.com> <399D5EA3.7975AAEC@stroeder.com> <399D6476.62BE89E7@caveosystems.com>
Message-ID: <399D6E19.2B7BA55E@stroeder.com>

Rich Salz wrote:
> 
> >   SSLOptions +ExportCertData
> 
> Yes, thanks.  I need more than that.  I need just about full
> programmatic control over SSL within my python module.

You want to have your own Python written verify callback before
mod_ssl accepts the cert as being valid?

Ciao, Michael.

From grisha at ispol.com  Fri Aug 18 16:50:49 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:46:00 2004
Subject: [mod_python] How to define an environment variable for other
 python module to use?
In-Reply-To: <39974AD9.2C33FAE1@ust.hk>
Message-ID: <Pine.LNX.4.21.0008181646320.18916-100000@saturn.ispol.com>

Sorry for a late answer - 

If you are using strictly mod_python (without cgihandler), then the
standard apache SetEnv or PassEnv directives should work.

If you're using cgihandler, and if the python-oracle interface module is
written in C, then most likely it uses the actual process environment. In
this case you will have to use os.putenv() function prior to using the
oracle interface. Otherwise, simply assigning something to os.environ
should do it.

Does this answer your question?

--
  Gregory (Grisha) Trubetskoy
       grisha@ispol.com

On Mon, 14 Aug 2000, David YEUNG wrote:

> I have other python modules which usually need to read some environment
> variables, e.g., an python-oracle interface module needs to read the "ORACLE_SID"
> to know where the database to connect. I used to defining this variable in the "shell"
> before invoking a python CGI program, e.g.:
> 
>    #!/bin/sh
>    export ORACLE_SID=orcl
>    exec /some/oracle/python/interface.cgi
> 
> I would like to try the mod_python using the default CGI handler, but does someone
> know how to define some environment variable in mod_python?
> 
> Thanks
> 
> david
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 


From dyeung at ust.hk  Sat Aug 19 08:15:27 2000
From: dyeung at ust.hk (David Yeung)
Date: Fri Jan  9 21:46:00 2004
Subject: [mod_python] How to define an environment variable for otherpython 
 module to use?
References: <Pine.LNX.4.21.0008181646320.18916-100000@saturn.ispol.com>
Message-ID: <399DD19F.F4CC2B0E@ust.hk>

Gregory

According to the Python document, if os.putvar is used to change the
environment, such changes only affect subprocesses started with
os.system(), popen(), fork() and execv(), so it is probably not
able to solve the problem.

Thanks

david


Gregory Trubetskoy wrote:
> 
> Sorry for a late answer -
> 
> If you are using strictly mod_python (without cgihandler), then the
> standard apache SetEnv or PassEnv directives should work.
> 
> If you're using cgihandler, and if the python-oracle interface module is
> written in C, then most likely it uses the actual process environment. In
> this case you will have to use os.putenv() function prior to using the
> oracle interface. Otherwise, simply assigning something to os.environ
> should do it.
> 
> Does this answer your question?
> 
> --
>   Gregory (Grisha) Trubetskoy
>        grisha@ispol.com
> 
> On Mon, 14 Aug 2000, David YEUNG wrote:
> 
> > I have other python modules which usually need to read some environment
> > variables, e.g., an python-oracle interface module needs to read the "ORACLE_SID"
> > to know where the database to connect. I used to defining this variable in the "shell"
> > before invoking a python CGI program, e.g.:
> >
> >    #!/bin/sh
> >    export ORACLE_SID=orcl
> >    exec /some/oracle/python/interface.cgi
> >
> > I would like to try the mod_python using the default CGI handler, but does someone
> > know how to define some environment variable in mod_python?
> >
> > Thanks
> >
> > david
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://www.modpython.org/mailman/listinfo/mod_python
> >

From lahondes at pasteur.fr  Mon Aug 21 10:22:11 2000
From: lahondes at pasteur.fr (Raynald de Lahondes)
Date: Fri Jan  9 21:46:01 2004
Subject: [mod_python] Problems with mod_python
In-Reply-To: <F2176fQSgeR4UIS42NX000009c4@hotmail.com>; from wmedia@hotmail.com on Fri, Aug 18, 2000 at 12:22:02PM -0400
References: <F2176fQSgeR4UIS42NX000009c4@hotmail.com>
Message-ID: <20000821102211.A19171@pombe.vironc.pasteur.fr>

On Fri, Aug 18, 2000 at 12:22:02PM -0400, William Smith wrote:
> I am using RedHat 6.2 x86, Apache 1.3.12 and mod_python 2.4.1.
> I compiled and installed mod_python with apxs.
> Apache runs as user nobody and group nobody
>
> I read the modpython archives and have the following server errors
> which I saw mentioned in the archive message Aug 2, 2000 by
> Boh Heong Yap (bohheong@asiacontent.com):
>
>    make_obcallback(): could not import mod_python.apache.
>     make_obcallback(): could not call init.

Are you sure you installed the libs properly ? (I think I had those errors
when libs where not OK). When the python libs were installed (Ist part of
Install) recompiling whith apxs and re-installing the mod_python.so solved
the pb.

> Using the comand line I get:
> 
> File "/usr/lib/python1.5/site-packages/mod_python/apache.py", line
> 18, in ?
>     import _apache
> ImportError: No module named _apache
> 
> when I try "from mod_python import apache".
> 

I am not familiar neither with external extension of python nor apache but I
understand that "import _apache" only works within apache module, because
it's a call to mod_python.so code. Anyway my mod-python works and "import
_apache" still does not work...

I hope you find this usefull.

Raynald de Lahond?s
lahondes@pasteur.fr


From grisha at ispol.com  Mon Aug 21 16:54:29 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:46:01 2004
Subject: [mod_python] How to define an environment variable for otherpython
  module to use?
In-Reply-To: <399DD19F.F4CC2B0E@ust.hk>
Message-ID: <Pine.LNX.4.21.0008211652540.7663-100000@saturn.ispol.com>

David - 

I just looked at the docs, and I didn't see the word "only" mentioned
anywhere.

Grisha


On Sat, 19 Aug 2000, David Yeung wrote:

> Gregory
> 
> According to the Python document, if os.putvar is used to change the
> environment, such changes only affect subprocesses started with
> os.system(), popen(), fork() and execv(), so it is probably not
> able to solve the problem.
> 
> Thanks
> 
> david
> 
> 
> Gregory Trubetskoy wrote:
> > 
> > Sorry for a late answer -
> > 
> > If you are using strictly mod_python (without cgihandler), then the
> > standard apache SetEnv or PassEnv directives should work.
> > 
> > If you're using cgihandler, and if the python-oracle interface module is
> > written in C, then most likely it uses the actual process environment. In
> > this case you will have to use os.putenv() function prior to using the
> > oracle interface. Otherwise, simply assigning something to os.environ
> > should do it.
> > 
> > Does this answer your question?
> > 
> > --
> >   Gregory (Grisha) Trubetskoy
> >        grisha@ispol.com
> > 
> > On Mon, 14 Aug 2000, David YEUNG wrote:
> > 
> > > I have other python modules which usually need to read some environment
> > > variables, e.g., an python-oracle interface module needs to read the "ORACLE_SID"
> > > to know where the database to connect. I used to defining this variable in the "shell"
> > > before invoking a python CGI program, e.g.:
> > >
> > >    #!/bin/sh
> > >    export ORACLE_SID=orcl
> > >    exec /some/oracle/python/interface.cgi
> > >
> > > I would like to try the mod_python using the default CGI handler, but does someone
> > > know how to define some environment variable in mod_python?
> > >
> > > Thanks
> > >
> > > david
> > > _______________________________________________
> > > Mod_python mailing list
> > > Mod_python@modpython.org
> > > http://www.modpython.org/mailman/listinfo/mod_python
> > >
> 


From bryan at optimumnetwork.com  Tue Aug 22 12:00:04 2000
From: bryan at optimumnetwork.com (Bryan O'Shea)
Date: Fri Jan  9 21:46:01 2004
Subject: [mod_python] Build errors with php-4.0.1pl2
Message-ID: <39A224F4.14224BCE@optimumnetwork.com>

i am having troubles building with php-4.0.1pl2 and mod_python-2.4.1
i compiled installed php then followed installs instructions for
mod_python then went to build apache with

./configure --prefix=/home/apache
--activate-module=src/modules/extra/mod_python.c \
--activate-module=src/modules/php4/libphp4.a

if i build with one or the other the build turns out ok. when i
build both modules together it flops


any help would be apreciated
thanks

************************************************************************************************

<=== src/modules/standard
===> src/modules/extra
gcc -c -I/usr/local/include/python1.5 -I../../os/unix -I../../include
-DLINUX=2 -I/home/bryan/src/php-4.0.1pl2
-I/home/bryan/src/php-4.0.1pl2/main -I/home/bryan/src/php-4.0.1pl2/main
-I/home/bryan/src/php-4.0.1pl2/Zend -I/home/bryan/src/php-4.0.1pl2/Zend
-I/home/bryan/src/php-4.0.1pl2 -DUSE_EXPAT -I../../lib/expat-lite
-DNO_DL_NEEDED `../../apaci` mod_python.c
rm -f libextra.a
ar cr libextra.a mod_python.o
ranlib libextra.a
<=== src/modules/extra
===> src/modules/php4
gcc -c -I/usr/local/include/python1.5 -I../../os/unix -I../../include
-DLINUX=2 -I/home/bryan/src/php-4.0.1pl2
-I/home/bryan/src/php-4.0.1pl2/main -I/home/bryan/src/php-4.0.1pl2/main
-I/home/bryan/src/php-4.0.1pl2/Zend -I/home/bryan/src/php-4.0.1pl2/Zend
-I/home/bryan/src/php-4.0.1pl2 -DUSE_EXPAT -I../../lib/expat-lite
-DNO_DL_NEEDED `../../apaci`  mod_php4.c
cp libmodphp4.a libphp4.a
ar r libphp4.a mod_php4.o
ranlib libphp4.a
<=== src/modules/php4
<=== src/modules
gcc -c -I/usr/local/include/python1.5 -I./os/unix -I./include
-DLINUX=2 -I/home/bryan/src/php-4.0.1pl2
-I/home/bryan/src/php-4.0.1pl2/main -I/home/bryan/src/php-4.0.1pl2/main
-I/home/bryan/src/php-4.0.1pl2/Zend -I/home/bryan/src/php-4.0.1pl2/Zend
-I/home/bryan/src/php-4.0.1pl2 -DUSE_EXPAT -I./lib/expat-lite
-DNO_DL_NEEDED `./apaci` modules.c
gcc -c -I/usr/local/include/python1.5 -I./os/unix -I./include
-DLINUX=2 -I/home/bryan/src/php-4.0.1pl2
-I/home/bryan/src/php-4.0.1pl2/main -I/home/bryan/src/php-4.0.1pl2/main
-I/home/bryan/src/php-4.0.1pl2/Zend -I/home/bryan/src/php-4.0.1pl2/Zend
-I/home/bryan/src/php-4.0.1pl2 -DUSE_EXPAT -I./lib/expat-lite
-DNO_DL_NEEDED `./apaci` buildmark.c
gcc  -DLINUX=2 -I/home/bryan/src/php-4.0.1pl2
-I/home/bryan/src/php-4.0.1pl2/main -I/home/bryan/src/php-4.0.1pl2/main
-I/home/bryan/src/php-4.0.1pl2/Zend -I/home/bryan/src/php-4.0.1pl2/Zend
-I/home/bryan/src/php-4.0.1pl2 -DUSE_EXPAT -I./lib/expat-lite
-DNO_DL_NEEDED `./apaci` -Xlinker -export-dynamic       \
      -o httpd buildmark.o modules.o modules/standard/libstandard.a
modules/extra/libextra.a modules/php4/libphp4.a main/libmain.a
./os/unix/libos.a ap/libap.a  lib/expat-lite/libexpat.a
-Wl,-rpath,/usr/local/mysql/lib/mysql -Wl,-rpath,/usr/local/pgsql/lib
-rdynamic -L/usr/local/mysql/lib/mysql -L/usr/local/pgsql/lib
-Lmodules/php4 -L../modules/php4 -L../../modules/php4 -lmodphp4  -lgdbm
-lpam  -ldl -lpq -lmysqlclient -lresolv -lm -ldl -lcrypt -lnsl
-lresolv  -lm -lcrypt /usr/local/lib/python1.5/config/libpython1.5.a
-lieee -lnet -ldl  -lpthread   -lm
/usr/local/lib/python1.5/config/libpython1.5.a(pypcre.o): In function
`pcre_study':
/home/bryan/src/Python-1.5.2/Modules/./pypcre.c:501: multiple definition

of `pcre_malloc'
modules/php4/libphp4.a(pcre.o):/home/bryan/src/php-4.0.1pl2/ext/pcre/pcrelib/pcre.c:238:

first defined here
/usr/local/lib/python1.5/config/libpython1.5.a(pypcre.o): In function
`pcre_study':
/home/bryan/src/Python-1.5.2/Modules/./pypcre.c:501: multiple definition

of `pcre_free'
modules/php4/libphp4.a(pcre.o):/home/bryan/src/php-4.0.1pl2/ext/pcre/pcrelib/pcre.c:238:

first defined here
collect2: ld returned 1 exit status
make[2]: *** [target_static] Error 1
make[2]: Leaving directory `/home/bryan/src/apache_1.3.12/src'
make[1]: *** [build-std] Error 2
make[1]: Leaving directory `/home/bryan/src/apache_1.3.12'
make: *** [build] Error 2




From chris at zeus.foote.com.au  Wed Aug 23 14:12:05 2000
From: chris at zeus.foote.com.au (Chris Foote)
Date: Fri Jan  9 21:46:01 2004
Subject: [mod_python] interoperability with cgi module
Message-ID: <Pine.BSF.4.20.0008231317520.26683-100000@localhost>

Is there any way of getting the CGI environment from mod_python
(i.e. via req.add_common_vars()) usable by the Python libraries
standard cgi module ?

e.g. something like the following (html form POST's to this script):

import os
import cgi
from mod_python import apache

def handler(req):
	req.content_type  = "text/plain"
	req.send_http_header()
	
	req.add_common_vars()
	
	# add req's CGI vars into the environment
	for k in req.subprocess_env.keys():
		os.environ[k] = req.subprocess_env[k]

	form = cgi.FieldStorage()
	cgi.parse_header(str(req.headers_in))

	len = int(req.headers_in["content-length"])
	form_data = req.read(len)
	cgi.parse_qs(form_data)

	cgi.test()
	if form.has_key("field"):
		req.write('field = ' + form["field"].value + '\n')

	return apache.OK

however, the cgi module doesn't display anything for cgi.test()
and form['field'] doesn't exist.

I'm new to Python, and especially mod_pythod - am I going about
this in the wrong way ?  i.e. should I be bothering with the cgi
module at all ?



Cheers,

Chris Foote                        chris@zeus.foote.com.au


From R.Barrett at ftel.co.uk  Wed Aug 23 11:30:18 2000
From: R.Barrett at ftel.co.uk (Richard Barrett)
Date: Fri Jan  9 21:46:01 2004
Subject: [mod_python] extended access to conn_rec
Message-ID: <v04220803b5c94cb54996@[172.16.3.104]>

I've started working with mod_python-2.4.1; good stuff.

I wanted to access the local_addr and remote_addr fields of the 
conn_rec struct but access to the fields is not supported via the 
connection object by mod_python.so

Accordingly I've added some code to mod_python.c to return the 
contents of these fields. The code is a minor variation of functions 
'borrowed' from socketmodule.c in the standard Python 1.5.2 
distribution. The python object returned is the same as that returned 
by the getpeername and getsockname member functions on standard 
socket objects. I would have called functions makeipaddr  and 
makesockaddr in socketmodule.so instead of adding copies to 
mod_python but they are declared as static in socketmodule.c and 
hence are unavailable.

If there is a better way of doing this or anything I've said above is 
rubbish I would appreciate some (polite) feedback. I don't claim any 
particular expertise with C or python extensions so some reader may 
find fault with this stuff. But it works for me so far.

The diff for my changes to mod_python.c follow:
-----------------------------------------------------


91a92,94
>  /* Other headers */
>  #include <sys/socket.h>
>
928a932,954
>  static PyObject *
>  mymakeipaddr(struct sockaddr_in *addr)
>  {
>      long x = ntohl(addr->sin_addr.s_addr);
>      char buf[100];
>      sprintf(buf, "%d.%d.%d.%d",
>          (int) (x>>24) & 0xff, (int) (x>>16) & 0xff,
>          (int) (x>> 8) & 0xff, (int) (x>> 0) & 0xff);
>      return PyString_FromString(buf);
>  }
>
>  static PyObject *
>  mymakesockaddr(struct sockaddr_in *addr)
>  {
>      PyObject *addrobj = mymakeipaddr(addr);
>      PyObject *ret = NULL;
>      if (addrobj) {
>          ret = Py_BuildValue("Oi", addrobj, ntohs(addr->sin_port));
>          Py_DECREF(addrobj);
>      }
>      return ret;
>  }
>
968a995,1000
>      else if (strcmp(name, "local_addr") == 0) {
>  		return mymakesockaddr(&(self->conn->local_addr));
>  	}
>      else if (strcmp(name, "remote_addr") == 0) {
>  		return mymakesockaddr(&(self->conn->remote_addr));
>  	}
------------------------------------------------------------------
Richard Barrett, PostPoint 27,         e-mail:r.barrett@ftel.co.uk
Fujitsu Telecommunications Europe Ltd,      tel: (44) 121 717 6337
Solihull Parkway, Birmingham Business Park, B37 7YU, England
"Democracy is two wolves and a lamb voting on what to have for
lunch. Liberty is a well armed lamb contesting the vote."
Benjamin Franklin, 1759
------------------------------------------------------------------

From grisha at ispol.com  Wed Aug 23 09:22:50 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:46:01 2004
Subject: [mod_python] interoperability with cgi module
In-Reply-To: <Pine.BSF.4.20.0008231317520.26683-100000@localhost>
Message-ID: <Pine.LNX.4.21.0008230920200.14880-100000@saturn.ispol.com>

Look at how it's done in the cgihandler:
http://www.modpython.org/live/mod_python-2.4.1/lib/python/mod_python/cgihandler.py

apache.setup_cgi() is what you need.

as a shortcut, I think 

os.env = req.subprocess_env 

might just do the trick.

Grisha

--
  Gregory (Grisha) Trubetskoy
       grisha@ispol.com

On Wed, 23 Aug 2000, Chris Foote wrote:

> Is there any way of getting the CGI environment from mod_python
> (i.e. via req.add_common_vars()) usable by the Python libraries
> standard cgi module ?
> 
> e.g. something like the following (html form POST's to this script):
> 
> import os
> import cgi
> from mod_python import apache
> 
> def handler(req):
> 	req.content_type  = "text/plain"
> 	req.send_http_header()
> 	
> 	req.add_common_vars()
> 	
> 	# add req's CGI vars into the environment
> 	for k in req.subprocess_env.keys():
> 		os.environ[k] = req.subprocess_env[k]
> 
> 	form = cgi.FieldStorage()
> 	cgi.parse_header(str(req.headers_in))
> 
> 	len = int(req.headers_in["content-length"])
> 	form_data = req.read(len)
> 	cgi.parse_qs(form_data)
> 
> 	cgi.test()
> 	if form.has_key("field"):
> 		req.write('field = ' + form["field"].value + '\n')
> 
> 	return apache.OK
> 
> however, the cgi module doesn't display anything for cgi.test()
> and form['field'] doesn't exist.
> 
> I'm new to Python, and especially mod_pythod - am I going about
> this in the wrong way ?  i.e. should I be bothering with the cgi
> module at all ?
> 
> 
> 
> Cheers,
> 
> Chris Foote                        chris@zeus.foote.com.au
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 


From miguel at yorku.ca  Wed Aug 23 09:35:34 2000
From: miguel at yorku.ca (Miguel Marques)
Date: Fri Jan  9 21:46:01 2004
Subject: [mod_python] interoperability with cgi module
In-Reply-To: <Pine.BSF.4.20.0008231317520.26683-100000@localhost>
References: <Pine.BSF.4.20.0008231317520.26683-100000@localhost>
Message-ID: <20000823093534X.miguel@yorku.ca>

On Wed, 23 Aug 2000 14:12:05 +0930 (CST), Chris Foote <chris@zeus.foote.com.au> wrote:
> Is there any way of getting the CGI environment from mod_python
> (i.e. via req.add_common_vars()) usable by the Python libraries
> standard cgi module ?
> 
> e.g. something like the following (html form POST's to this script):
> 
> import os
> import cgi
> from mod_python import apache
> 
> def handler(req):
> 	req.content_type  = "text/plain"
> 	req.send_http_header()
> 	
> 	req.add_common_vars()
> 	
> 	# add req's CGI vars into the environment
> 	for k in req.subprocess_env.keys():
> 		os.environ[k] = req.subprocess_env[k]
> 
> 	form = cgi.FieldStorage()
> 	cgi.parse_header(str(req.headers_in))
> 
> 	len = int(req.headers_in["content-length"])
> 	form_data = req.read(len)
> 	cgi.parse_qs(form_data)
> 
> 	cgi.test()
> 	if form.has_key("field"):
> 		req.write('field = ' + form["field"].value + '\n')
> 
> 	return apache.OK
> 
> however, the cgi module doesn't display anything for cgi.test()
> and form['field'] doesn't exist.
Above try
    form = cgi.parse_qs(form_data)
to get the POST data.  cgi.parse_qs returns a dictionary with the
data.


						Miguel

C. Miguel Marques, York University, Computing & Communications Services
e-mail: miguel@yorku.ca, voice: (416)736-2100x22684, fax: (416)736-5830


From hdstich at commplex-media.de  Thu Aug 24 09:24:08 2000
From: hdstich at commplex-media.de (Hans-Dieter Stich)
Date: Fri Jan  9 21:46:01 2004
Subject: [mod_python] re.compile problem
Message-ID: <XFMail.000824092408.hdstich@commplex-media.de>

i have seen messages on the mailing list about problems with the compiling of
regular expressons! are there any new hints?

my mod_python is build also dynamically into the apache!

thanx!

ciao
h-d

____________________________________________________________________

  Commplex Media AG             Hans-Dieter Stich/CTO
  Office Ulm                    fon:  +49-7304-434997
  Development Team              fax:  +49-7304-434998
  Spatzenweg 12                 mail: hdstich@commplex-media.de
  89160 Dornstadt               web:  http://www.commplex-media.de/
____________________________________________________________________


From walaces at prasair.com.br  Mon Aug 28 12:23:24 2000
From: walaces at prasair.com.br (Walace Soares)
Date: Fri Jan  9 21:46:01 2004
Subject: [mod_python] Apache Problems
Message-ID: <E13FB1366C26D411BDD9000102240287046FC2@SERVIDOR>

Hi,

I have the mod_python instaled within Apache in a Linux slackware box.
Python is working fine.
But when I am trying to run mod_python, apache show me the message:

Mod_python error: "PythonHandler pytest.py"
Traceback (innermost last): File
"/usr/lib/python1.5/site-packages/mod_python/apache.py", line 113, in
Dispatch module = import_module(module_name, req)
File "/usr/lib/python1.5/site-packages/mod_python/apache.py", line 246, in
import_module module = __import__(module_name)
File "/usr/lib/python1.5/pytest.py", line 3
req.send_httpd header()
		^
SyntaxError: invalid syntax


Could Anyone please help me ?


Walace

My configuration:
Slacware 7.0
Apache 1.3.12
Python 1.5.2
mod_python 2.4.1





From miguel at yorku.ca  Mon Aug 28 11:49:05 2000
From: miguel at yorku.ca (Miguel Marques)
Date: Fri Jan  9 21:46:01 2004
Subject: [mod_python] Apache Problems
In-Reply-To: <E13FB1366C26D411BDD9000102240287046FC2@SERVIDOR>
References: <E13FB1366C26D411BDD9000102240287046FC2@SERVIDOR>
Message-ID: <20000828114905P.miguel@yorku.ca>

On Mon, 28 Aug 2000 12:23:24 -0300, "Walace Soares" <walaces@prasair.com.br> wrote:
> Hi,
> 
> I have the mod_python instaled within Apache in a Linux slackware box.
> Python is working fine.
> But when I am trying to run mod_python, apache show me the message:
> 
> Mod_python error: "PythonHandler pytest.py"
> Traceback (innermost last): File
> "/usr/lib/python1.5/site-packages/mod_python/apache.py", line 113, in
> Dispatch module = import_module(module_name, req)
> File "/usr/lib/python1.5/site-packages/mod_python/apache.py", line 246, in
> import_module module = __import__(module_name)
> File "/usr/lib/python1.5/pytest.py", line 3
> req.send_httpd header()
> 		^
> SyntaxError: invalid syntax
I think that should be:
req.send_http_header()

							Miguel

C. Miguel Marques, York University, Computing & Communications Services
e-mail: miguel@yorku.ca, voice: (416)736-2100x22684, fax: (416)736-5830

From bryan at optimumnetwork.com  Tue Aug 29 14:14:54 2000
From: bryan at optimumnetwork.com (Bryan O'Shea)
Date: Fri Jan  9 21:46:01 2004
Subject: [mod_python] test
Message-ID: <39AB7F0E.6219DB78@optimumnetwork.com>

does the list work ??


From bryan at optimumnetwork.com  Tue Aug 29 14:48:53 2000
From: bryan at optimumnetwork.com (Bryan O'Shea)
Date: Fri Jan  9 21:46:01 2004
Subject: [mod_python] php and mod_python compile problems with apache
Message-ID: <39AB8705.D8532012@optimumnetwork.com>

i am having troubles building with php-4.0.1pl2 and mod_python-2.4.1
i compiled installed php then followed installs instructions for
mod_python then went to build apache with

./configure --prefix=/home/apache
--activate-module=src/modules/extra/mod_python.c \
--activate-module=src/modules/php4/libphp4.a

if i build with one or the other the build turns out ok. when i
build both modules together it flops


any help would be apreciated
thanks

************************************************************************************************

<=== src/modules/standard
===> src/modules/extra
gcc -c -I/usr/local/include/python1.5 -I../../os/unix -I../../include
-DLINUX=2 -I/home/bryan/src/php-4.0.1pl2
-I/home/bryan/src/php-4.0.1pl2/main -I/home/bryan/src/php-4.0.1pl2/main
-I/home/bryan/src/php-4.0.1pl2/Zend -I/home/bryan/src/php-4.0.1pl2/Zend
-I/home/bryan/src/php-4.0.1pl2 -DUSE_EXPAT -I../../lib/expat-lite
-DNO_DL_NEEDED `../../apaci` mod_python.c
rm -f libextra.a
ar cr libextra.a mod_python.o
ranlib libextra.a
<=== src/modules/extra
===> src/modules/php4
gcc -c -I/usr/local/include/python1.5 -I../../os/unix -I../../include
-DLINUX=2 -I/home/bryan/src/php-4.0.1pl2
-I/home/bryan/src/php-4.0.1pl2/main -I/home/bryan/src/php-4.0.1pl2/main
-I/home/bryan/src/php-4.0.1pl2/Zend -I/home/bryan/src/php-4.0.1pl2/Zend
-I/home/bryan/src/php-4.0.1pl2 -DUSE_EXPAT -I../../lib/expat-lite
-DNO_DL_NEEDED `../../apaci`  mod_php4.c
cp libmodphp4.a libphp4.a
ar r libphp4.a mod_php4.o
ranlib libphp4.a
<=== src/modules/php4
<=== src/modules
gcc -c -I/usr/local/include/python1.5 -I./os/unix -I./include
-DLINUX=2 -I/home/bryan/src/php-4.0.1pl2
-I/home/bryan/src/php-4.0.1pl2/main -I/home/bryan/src/php-4.0.1pl2/main
-I/home/bryan/src/php-4.0.1pl2/Zend -I/home/bryan/src/php-4.0.1pl2/Zend
-I/home/bryan/src/php-4.0.1pl2 -DUSE_EXPAT -I./lib/expat-lite
-DNO_DL_NEEDED `./apaci` modules.c
gcc -c -I/usr/local/include/python1.5 -I./os/unix -I./include
-DLINUX=2 -I/home/bryan/src/php-4.0.1pl2
-I/home/bryan/src/php-4.0.1pl2/main -I/home/bryan/src/php-4.0.1pl2/main
-I/home/bryan/src/php-4.0.1pl2/Zend -I/home/bryan/src/php-4.0.1pl2/Zend
-I/home/bryan/src/php-4.0.1pl2 -DUSE_EXPAT -I./lib/expat-lite
-DNO_DL_NEEDED `./apaci` buildmark.c
gcc  -DLINUX=2 -I/home/bryan/src/php-4.0.1pl2
-I/home/bryan/src/php-4.0.1pl2/main -I/home/bryan/src/php-4.0.1pl2/main
-I/home/bryan/src/php-4.0.1pl2/Zend -I/home/bryan/src/php-4.0.1pl2/Zend
-I/home/bryan/src/php-4.0.1pl2 -DUSE_EXPAT -I./lib/expat-lite
-DNO_DL_NEEDED `./apaci` -Xlinker -export-dynamic       \
      -o httpd buildmark.o modules.o modules/standard/libstandard.a
modules/extra/libextra.a modules/php4/libphp4.a main/libmain.a
./os/unix/libos.a ap/libap.a  lib/expat-lite/libexpat.a
-Wl,-rpath,/usr/local/mysql/lib/mysql -Wl,-rpath,/usr/local/pgsql/lib
-rdynamic -L/usr/local/mysql/lib/mysql -L/usr/local/pgsql/lib
-Lmodules/php4 -L../modules/php4 -L../../modules/php4 -lmodphp4  -lgdbm
-lpam  -ldl -lpq -lmysqlclient -lresolv -lm -ldl -lcrypt -lnsl
-lresolv  -lm -lcrypt /usr/local/lib/python1.5/config/libpython1.5.a
-lieee -lnet -ldl  -lpthread   -lm
/usr/local/lib/python1.5/config/libpython1.5.a(pypcre.o): In function
`pcre_study':
/home/bryan/src/Python-1.5.2/Modules/./pypcre.c:501: multiple definition

of `pcre_malloc'
modules/php4/libphp4.a(pcre.o):/home/bryan/src/php-4.0.1pl2/ext/pcre/pcrelib/pcre.c:238:

first defined here
/usr/local/lib/python1.5/config/libpython1.5.a(pypcre.o): In function
`pcre_study':
/home/bryan/src/Python-1.5.2/Modules/./pypcre.c:501: multiple definition

of `pcre_free'
modules/php4/libphp4.a(pcre.o):/home/bryan/src/php-4.0.1pl2/ext/pcre/pcrelib/pcre.c:238:

first defined here
collect2: ld returned 1 exit status
make[2]: *** [target_static] Error 1
make[2]: Leaving directory `/home/bryan/src/apache_1.3.12/src'
make[1]: *** [build-std] Error 2
make[1]: Leaving directory `/home/bryan/src/apache_1.3.12'
make: *** [build] Error 2






From grisha at ispol.com  Tue Aug 29 15:39:07 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:46:01 2004
Subject: [mod_python] php and mod_python compile problems with apache
In-Reply-To: <39AB8705.D8532012@optimumnetwork.com>
Message-ID: <Pine.LNX.4.21.0008291537030.15779-100000@saturn.ispol.com>

I know this has something to do with the pcre (regular
expression) library. I think both PHP and Python have to be linked against
the same version or else it won't work. I saw something about this come
across the apache list - apache 2.0 uses pcre as well and that causes some
problems for Python.

Perhaps someone more knowledgeable on the subject can enlighten us?

--
  Gregory (Grisha) Trubetskoy
       grisha@ispol.com

On Tue, 29 Aug 2000, Bryan O'Shea wrote:

> i am having troubles building with php-4.0.1pl2 and mod_python-2.4.1
> i compiled installed php then followed installs instructions for
> mod_python then went to build apache with
> 
> ./configure --prefix=/home/apache
> --activate-module=src/modules/extra/mod_python.c \
> --activate-module=src/modules/php4/libphp4.a
> 
> if i build with one or the other the build turns out ok. when i
> build both modules together it flops
> 
> 
> any help would be apreciated
> thanks
> 
> ************************************************************************************************
> 
> <=== src/modules/standard
> ===> src/modules/extra
> gcc -c -I/usr/local/include/python1.5 -I../../os/unix -I../../include
> -DLINUX=2 -I/home/bryan/src/php-4.0.1pl2
> -I/home/bryan/src/php-4.0.1pl2/main -I/home/bryan/src/php-4.0.1pl2/main
> -I/home/bryan/src/php-4.0.1pl2/Zend -I/home/bryan/src/php-4.0.1pl2/Zend
> -I/home/bryan/src/php-4.0.1pl2 -DUSE_EXPAT -I../../lib/expat-lite
> -DNO_DL_NEEDED `../../apaci` mod_python.c
> rm -f libextra.a
> ar cr libextra.a mod_python.o
> ranlib libextra.a
> <=== src/modules/extra
> ===> src/modules/php4
> gcc -c -I/usr/local/include/python1.5 -I../../os/unix -I../../include
> -DLINUX=2 -I/home/bryan/src/php-4.0.1pl2
> -I/home/bryan/src/php-4.0.1pl2/main -I/home/bryan/src/php-4.0.1pl2/main
> -I/home/bryan/src/php-4.0.1pl2/Zend -I/home/bryan/src/php-4.0.1pl2/Zend
> -I/home/bryan/src/php-4.0.1pl2 -DUSE_EXPAT -I../../lib/expat-lite
> -DNO_DL_NEEDED `../../apaci`  mod_php4.c
> cp libmodphp4.a libphp4.a
> ar r libphp4.a mod_php4.o
> ranlib libphp4.a
> <=== src/modules/php4
> <=== src/modules
> gcc -c -I/usr/local/include/python1.5 -I./os/unix -I./include
> -DLINUX=2 -I/home/bryan/src/php-4.0.1pl2
> -I/home/bryan/src/php-4.0.1pl2/main -I/home/bryan/src/php-4.0.1pl2/main
> -I/home/bryan/src/php-4.0.1pl2/Zend -I/home/bryan/src/php-4.0.1pl2/Zend
> -I/home/bryan/src/php-4.0.1pl2 -DUSE_EXPAT -I./lib/expat-lite
> -DNO_DL_NEEDED `./apaci` modules.c
> gcc -c -I/usr/local/include/python1.5 -I./os/unix -I./include
> -DLINUX=2 -I/home/bryan/src/php-4.0.1pl2
> -I/home/bryan/src/php-4.0.1pl2/main -I/home/bryan/src/php-4.0.1pl2/main
> -I/home/bryan/src/php-4.0.1pl2/Zend -I/home/bryan/src/php-4.0.1pl2/Zend
> -I/home/bryan/src/php-4.0.1pl2 -DUSE_EXPAT -I./lib/expat-lite
> -DNO_DL_NEEDED `./apaci` buildmark.c
> gcc  -DLINUX=2 -I/home/bryan/src/php-4.0.1pl2
> -I/home/bryan/src/php-4.0.1pl2/main -I/home/bryan/src/php-4.0.1pl2/main
> -I/home/bryan/src/php-4.0.1pl2/Zend -I/home/bryan/src/php-4.0.1pl2/Zend
> -I/home/bryan/src/php-4.0.1pl2 -DUSE_EXPAT -I./lib/expat-lite
> -DNO_DL_NEEDED `./apaci` -Xlinker -export-dynamic       \
>       -o httpd buildmark.o modules.o modules/standard/libstandard.a
> modules/extra/libextra.a modules/php4/libphp4.a main/libmain.a
> ./os/unix/libos.a ap/libap.a  lib/expat-lite/libexpat.a
> -Wl,-rpath,/usr/local/mysql/lib/mysql -Wl,-rpath,/usr/local/pgsql/lib
> -rdynamic -L/usr/local/mysql/lib/mysql -L/usr/local/pgsql/lib
> -Lmodules/php4 -L../modules/php4 -L../../modules/php4 -lmodphp4  -lgdbm
> -lpam  -ldl -lpq -lmysqlclient -lresolv -lm -ldl -lcrypt -lnsl
> -lresolv  -lm -lcrypt /usr/local/lib/python1.5/config/libpython1.5.a
> -lieee -lnet -ldl  -lpthread   -lm
> /usr/local/lib/python1.5/config/libpython1.5.a(pypcre.o): In function
> `pcre_study':
> /home/bryan/src/Python-1.5.2/Modules/./pypcre.c:501: multiple definition
> 
> of `pcre_malloc'
> modules/php4/libphp4.a(pcre.o):/home/bryan/src/php-4.0.1pl2/ext/pcre/pcrelib/pcre.c:238:
> 
> first defined here
> /usr/local/lib/python1.5/config/libpython1.5.a(pypcre.o): In function
> `pcre_study':
> /home/bryan/src/Python-1.5.2/Modules/./pypcre.c:501: multiple definition
> 
> of `pcre_free'
> modules/php4/libphp4.a(pcre.o):/home/bryan/src/php-4.0.1pl2/ext/pcre/pcrelib/pcre.c:238:
> 
> first defined here
> collect2: ld returned 1 exit status
> make[2]: *** [target_static] Error 1
> make[2]: Leaving directory `/home/bryan/src/apache_1.3.12/src'
> make[1]: *** [build-std] Error 2
> make[1]: Leaving directory `/home/bryan/src/apache_1.3.12'
> make: *** [build] Error 2
> 
> 
> 
> 
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 


From kkinder at tridog.com  Tue Aug 29 14:36:09 2000
From: kkinder at tridog.com (Ken Kinder)
Date: Fri Jan  9 21:46:01 2004
Subject: [mod_python] PyApache, FastCGI, modpython comparison
Message-ID: <39AC1EB9.E59FDF64@tridog.com>

Can some give me a feel for the differences between PyApache,
FastCGI/Python, ModPython? I would like to know specifically about
portability, performance issues, and process control. I've written much
of a Python-based online store which I plan to Open Source and am now
needing to look at persistance. The non-serial, threaded environment is
a must.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: kkinder.vcf
Type: text/x-vcard
Size: 244 bytes
Desc: Card for Ken Kinder
Url : http://mailman.modpython.org/pipermail/mod_python/attachments/20000829/eebfd259/kkinder.vcf
From bohheong at asiacontent.com  Wed Aug  2 22:41:33 2000
From: bohheong at asiacontent.com (Boh Heong Yap)
Date: Fri Jan  9 21:52:03 2004
Subject: [mod_python] can't start mod_python
Message-ID: <20000803054133.24083@mail.asiacontent.com>

hi, 

I wonder if someone could help. I've been playing with the configuration
of mod_python for the last few days without success. I managed to compile
in mod_pyton statically into in Apache 1.3.12, got it restarted and tested it.

    config details at end...

When I run ~/bin/httpd -l, mod-python.c is displayed.


From grisha at ispol.com  Wed Aug  2 15:22:23 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:52:03 2004
Subject: [mod_python] can't start mod_python
In-Reply-To: <20000803054133.24083@mail.asiacontent.com>
Message-ID: <Pine.LNX.4.21.0008021521520.28399-100000@saturn.ispol.com>

Which user does apache run as and what are the permissions on the
mod_python directory and everything in it?

--
  Gregory (Grisha) Trubetskoy
       grisha@ispol.com

On Wed, 2 Aug 2000, Boh Heong Yap wrote:

> hi, 
> 
> I wonder if someone could help. I've been playing with the configuration
> of mod_python for the last few days without success. I managed to compile
> in mod_pyton statically into in Apache 1.3.12, got it restarted and tested it.
> 
>     config details at end...
> 
> When I run ~/bin/httpd -l, mod-python.c is displayed.
> 
> 
> >From the browser, "http://222.64.245.xx/pytest.py", gives the message:-
> 
>     Internal Server Error
> 
>     The server encountered an internal error or misconfiguration and was     
>     unable to complete your request.
> 
> Other normal web request seem to work fine. 
> This is what the error logs show...
> 
>     [Wed Aug  2 20:58:57 2000] [notice] caught SIGTERM, shutting down
>     [Wed Aug  2 20:59:02 2000] [notice] Apache/1.3.12 (Unix) configured
> -- resuming
>         normal operations
>     'import site' failed; use -v for traceback
>     make_obcallback(): could not import mod_python.apache.
>     make_obcallback(): could not call init.
>     [Wed Aug  2 20:59:45 2000] [error] [client 202.77.245.126] python_handler:
>         make_obcallback returned no obCallBack!
> 
> 
> The mod_python module sits in 
> 
>         /usr/local/lib/python1.5/mod_python
> 
>     (along with other .pc. .pyc modules)
> 
> 
> In my httpd.conf (everything is there, no srm.conf, access.conf), I have 
> 
>     AddHandler python-program .py
>     PythonHandler pytest.py
>     PythonDebug on
>     PythonPath "sys.path+['/usr/local/lib/python1.5/mod_python']
> 
> this is within the <Directory..> directives for ~/apache/htdocs.
> pytest.py is same as the "Hello World" example in the tutorial in
> mod_python...
> 
> 
> Also when in the Python interpreter, I try to load stuff manually, 
> ie:
> 
>     >>> from mod_python import apache
>     Traceback (innermost last):
>     File "<stdin>", line 1, in ?
>     File "/usr/local/lib/python1.5/mod_python/apache.py", line 18, in ?
>         import _apache
>     ImportError: No module named _apache
>     >>>
> 
> and apache.py does indeed have the line "import _apache"
> 
> Loading other standard python modules like "sys" works OK, hence I think
> PYTHONPATH seems OK.
> 
> 
> config_info
> ------------------
> Apache - 1.3.12
> Python 1.5, compiled from source, standard
>     (both are installed in /usr/local)
> system Linux Mandrake 7.0, 2.2.12 kernel 
> Compaq box, P3.
> 
> 
> Any help from anyone will be appreciated.
> 
> Hope I can get this working. Would love to use Python for a few things here.
> 
> 
> 
> ----------------------------------------------------------
> Boh-heong Yap
> Project Manager, eCommerce
> 				bohheong@asiacontent.com				
> 
> Asiacontent.com a leading pan-Asian Internet company,
> with focus on: content, advertising and e-commerce.
> -----------------------------------------------------------
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 


From richard at whitequeen.com  Tue Aug  1 08:20:21 2000
From: richard at whitequeen.com (richard offer)
Date: Fri Jan  9 21:52:03 2004
Subject: [mod_python] the return of *Occasional* AttributeError: Handler
Message-ID: <200008011520.e71FKLA03253@whitequeen.com>

 
Hi all,

I've started getting the same error I reported back the beginning of Jul,
in that *occasionaly* I get a

[Tue Aug  1 05:37:12 2000] [error] PythonHandler index: Traceback (innermost last):
[Tue Aug  1 05:37:12 2000] [error] PythonHandler index:   File "/usr/local/lib/python1.5/site-packages/mod_python/apache.py", line 96, in Dispatch
    object = self.resolve_object(module, object_str)
[Tue Aug  1 05:37:12 2000] [error] PythonHandler index:   File "/usr/local/lib/python1.5/site-packages/mod_python/apache.py", line 42, in resolve_object
    obj = getattr(obj, obj_str)
[Tue Aug  1 05:37:12 2000] [error] PythonHandler index: AttributeError: handler


In fact I've probably been getting it all the time, but the person who
I run the site for just got back from vaccation and wanted to see it.

To refresh everyone's memory, the is an occasional (but frequent) error,
my guess is that its timing related, since you can sometimes get it
to disappear by reloading the page---sometimes it will fail elsewhere,
sometimes it works...

My suspicion of it being timing related is reinforced as it never happened
on the development machine, it happens more on the production machine
(same physical machine, but chrooted), and it happens a lot more when
I access the site via the internet (as opposed to via my intranet).

The site in question talks to a MySQL database via a persistant
connection.


Is there any ideas on how to debug this ? Extra diagnostics I can add
in apache.py ?

[ RH 6.1/mod_python 2.4/ DSL ]

thanks.

richard.

-- 
richard offer @ home 
          84 FE 48 E4 74 D0 26 D4  31 8E B6 86 98 74 E2 7C  8A FB BF A3
_______________________________http://www.whitequeen.com/users/richard/
* 



-- 
richard offer @ home 
          84 FE 48 E4 74 D0 26 D4  31 8E B6 86 98 74 E2 7C  8A FB BF A3
_______________________________http://www.whitequeen.com/users/richard/

From grisha at ispol.com  Thu Aug  3 08:17:59 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:52:03 2004
Subject: [mod_python] the return of *Occasional* AttributeError: Handler
In-Reply-To: <200008011520.e71FKLA03253@whitequeen.com>
Message-ID: <Pine.LNX.4.21.0008030815040.31424-100000@saturn.ispol.com>

Try upgrading to 2.4.1. It gives you additional info for Attribute errors.

Grisha

On Tue, 1 Aug 2000, richard offer wrote:

> 
>  
> Hi all,
> 
> I've started getting the same error I reported back the beginning of Jul,
> in that *occasionaly* I get a
> 
> [Tue Aug  1 05:37:12 2000] [error] PythonHandler index: Traceback (innermost last):
> [Tue Aug  1 05:37:12 2000] [error] PythonHandler index:   File "/usr/local/lib/python1.5/site-packages/mod_python/apache.py", line 96, in Dispatch
>     object = self.resolve_object(module, object_str)
> [Tue Aug  1 05:37:12 2000] [error] PythonHandler index:   File "/usr/local/lib/python1.5/site-packages/mod_python/apache.py", line 42, in resolve_object
>     obj = getattr(obj, obj_str)
> [Tue Aug  1 05:37:12 2000] [error] PythonHandler index: AttributeError: handler
> 
> 
> In fact I've probably been getting it all the time, but the person who
> I run the site for just got back from vaccation and wanted to see it.
> 
> To refresh everyone's memory, the is an occasional (but frequent) error,
> my guess is that its timing related, since you can sometimes get it
> to disappear by reloading the page---sometimes it will fail elsewhere,
> sometimes it works...
> 
> My suspicion of it being timing related is reinforced as it never happened
> on the development machine, it happens more on the production machine
> (same physical machine, but chrooted), and it happens a lot more when
> I access the site via the internet (as opposed to via my intranet).
> 
> The site in question talks to a MySQL database via a persistant
> connection.
> 
> 
> Is there any ideas on how to debug this ? Extra diagnostics I can add
> in apache.py ?
> 
> [ RH 6.1/mod_python 2.4/ DSL ]
> 
> thanks.
> 
> richard.
> 
> -- 
> richard offer @ home 
>           84 FE 48 E4 74 D0 26 D4  31 8E B6 86 98 74 E2 7C  8A FB BF A3
> _______________________________http://www.whitequeen.com/users/richard/
> * 
> 
> 
> 
> -- 
> richard offer @ home 
>           84 FE 48 E4 74 D0 26 D4  31 8E B6 86 98 74 E2 7C  8A FB BF A3
> _______________________________http://www.whitequeen.com/users/richard/
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 


From jack at icecast.org  Fri Aug  4 23:19:58 2000
From: jack at icecast.org (Jack Moffitt)
Date: Fri Jan  9 21:52:03 2004
Subject: [mod_python] authenhandler not working
Message-ID: <20000804231958.E5841@tk421.icecast.org>

Using the tutorial, i got the first example to work.  

Then i did the second example, and that is not authenticating me.  I
figured I've got a typo somewhere so i modified it to look like:

def authenhandler(req):
        user = req.connection.user
        pw = req.get_basic_auth_pw()

        if user == "spam" and pw == "eggs":
                return apache.OK
        else:
                apache.log_error('start', apache.APLOG_NOTICE)
                apache.log_error(user, apache.APLOG_NOTICE)
                apache.log_error(pw, apache.APLOG_NOTICE)
                apache.log_error('end', apache.APLOG_NOTICE)
                return apache.HTTP_UNAUTHORIZED


when I make the request, i get (from error_log):

[Fri Aug  4 23:07:57 2000] [notice] (13)Permission denied: start
[Fri Aug  4 23:07:57 2000] [notice] (13)Permission denied: eggs
[Fri Aug  4 23:07:57 2000] [notice] (13)Permission denied: end

the user var must be blank, because it never makes it.  

access_log has:

127.0.0.1 - spam [04/Aug/2000:23:07:57 -0700] "GET /test/test.py HTTP/1.0" 401 471

which has the username correct.

Where am I going wrong here?  Or is this a bug?

jack.

From gps at trix.dircon.co.uk  Mon Aug  7 02:00:52 2000
From: gps at trix.dircon.co.uk (Graham Swallow)
Date: Fri Jan  9 21:52:03 2004
Subject: [mod_python] SPIN_py works with mod_python
Message-ID: <Pine.LNX.4.04.10008070155030.1292-100000@trix.dircon.co.uk>

You have to mess with the PATHS and the /etc/sgml/ pathnames,
but then it just works. It is an SGML parser (actually SP is
the Parser, SPIN is the interface to Python).

I wouldn't recommend using SPIN on a production server because 
it is not mem-leakage tested, and because if users can upload
SGML they can down load any file (named as an entity), however
it provides elem_info and elem_obj, which are very useful
when building SGML/HTML/XML trees. You can also use them without
initialising the parser, and wrap them in names that you like.

Graham (who thinks mod_python is great)

Begin4
Title:          SPIN_py - SGML Parser Integration (Python)
Version:        0.2.3
Entered-date:   2000-08-06
Description:    SP is _the_ SGML Parser.
                spin_py.so is a loadable Python module.
                SPIN_py uses the generic
                SP-API and routes its events to Python, with some
                fixups on the way. It also provides a few
                C-Python types which are very useful when building
                SGML/HTML/XML trees (elem_info, elem_obj).
                This release includes a standard libsp16.so (binary)
                otherwise its 100K not 1MB. To compile from source
                you may need SP-1.3.4 from http://www.jclark.com/
Keywords:       SGML HTML XML SP Parser Python Apache mod_python
Author:         gps@trix.dircon.co.uk (Graham Swallow)
Primary-site:   http://www.trix.dircon.co.uk/SPIN/
Alternate-site: metalab.unc.edu /pub/Linux/utils/text/
                1026522   SPIN_py-0806.tgz
Platforms:      libc.so.6, gcc-2.96, Linux, Solaris, NOT-HP-UX-YET,
Copying-policy: L-GPL
End



From gps at trix.dircon.co.uk  Mon Aug  7 22:19:08 2000
From: gps at trix.dircon.co.uk (Graham Swallow)
Date: Fri Jan  9 21:52:03 2004
Subject: [mod_python] pcre.error from python
Message-ID: <Pine.LNX.4.04.10008072154560.809-200000@trix.dircon.co.uk>

It doesnt happen every time but I get faults or trace-backs from pcre.
I think its due to interference between the pcre in python, and the
pcre in php (Perl Compat. Regular Expression). sig-seg or either of:

	pcre.error: ('unmatched parentheses', 40)
	pcre.error: ('\\ at end of pattern', 4425)

(Presumably these are random errors from some other memory corruption,
or incorrect function call, there are no parentheses or \\'s)

I haven't got a clue what to do about it, (would statically linking
pcre into python work? Can separate <Directories> NOT have mod_XYZ
loaded?) but if you see the above symptom, try the attached test script.

	Graham

-------------- next part --------------
#!/usr/bin/env python
# called by httpd or by shell

def handler(req):
	from mod_python import apache
	return handler2( req )
	# forgetting the above return is interesting. Try it!

def handler2( req ):

	req.content_type="text/plain"
	req.send_http_header()
	import re
	instr = "Old and New\n"
	outstr = re.sub( "Old", "New", instr, 0 )
	req.write( outstr )
	try:
		t = apache.OK
	except:
		t = "shell_mode"
	return t

if __name__ == '__main__':
	class REQ_DUMMY:
		def __init__( req, fd ):
			# req has writable (and readable) fields
			# when calling from shell ...
			req.fd = fd
		def send_http_header( req ):
			print "Not apache, so I sont say:", req.content_type
		def write( req, text ):
			req.fd.write( text )

	import sys
	# fd = open( "/dev/null", 'w' )
	# fd = open( "test_out.html", 'w' )
	fd = sys.stderr
	req_dummy = REQ_DUMMY( fd )
	handler2( req_dummy )

From Robert.Nasca at macquarie.com.au  Tue Aug  8 09:27:12 2000
From: Robert.Nasca at macquarie.com.au (Robert Nasca)
Date: Fri Jan  9 21:52:03 2004
Subject: [mod_python] mod_python / win32all and COM
Message-ID: <2D0E3DBA4C66D31195920008C784F4AF01332A5C@nt_syd_ex08.macbank>

Hi,

Is there an FAQ on using mod_python with COM? It seems that I am having problems due to the threaded nature of Apache on win32 and it's interaction with COM.

I have created an interface to some COM objects using the "makepy.py" program which comes with win32all.

When I run Apache with ThreadsPerChild set to 1, everything runs fine (albeit with only one client), but when I set this to something higher, I get errors saying "CoInitialise() has not been called", which I assume are related to Apache spawning multiple threads. I've attached the output below.

Mod_python error: "PythonHandler pytest"Traceback (innermost last):
  File "h:\website\python\mod_python\apache.py", line 119, in Dispatch
    result = object(req)
  File "h:/website/htdocs/test\pytest.py", line 8, in handler
    d = Snakey.Database.RiskReporterDatabase()
  File "H:\WebSite\Python\Snakey\Database.py", line 32, in __init__
    self.openConnection("DSN=RISK_REPORTER")
  File "H:\WebSite\Python\Snakey\Database.py", line 20, in openConnection
    self.connection = msado21.Connection()
  File "H:\PythonDev\Snakey\msado21.py", line 1607, in __init__
com_error: (-2147221008, 'CoInitialize has not been called.', None, None)

If anyone has a suggestion on what is happening, or pointers to some information on using mod_python and COM, it would be appreciated.

Thanks,
Rob.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mailman.modpython.org/pipermail/mod_python/attachments/20000808/8ccbceb4/attachment-0001.htm
From efernandez at sistelnet.es  Wed Aug  9 08:51:50 2000
From: efernandez at sistelnet.es (Eduardo Fernandez)
Date: Fri Jan  9 21:52:03 2004
Subject: [mod_python] problem with authen handler
Message-ID: <007701c001ce$4b6b7c40$248a4cc3@sistelnet.es>

Hello everyone:

I whis I had discovered mod_python before. It would have saved me a lot of
headaches in the application I am developing right now. In this app, I
authenticate the users via a regular form in a page, and then keep the
"logged-in" state with cookies.

I want to do it right (TM), and use basic http authentication with
mod_python.

So I set up the documentation example, got the "Hello World!" part to work
and now I am trying to make the authenhandler to work.

I have copied the example as in the documentation and tried to access the
page. I get the user/pw window and fill it, but it alway fails with a 401
error.

I have tried diferent usernames and pws, but it always fails. The apache
logs show the user along with the 401 error, so I think I have the setup
working mostly ok.

Where could be the quirk?

Thanks in advance.
--
Eduardo Fern?ndez Corrales
eduardo@sistelnet.es
Sistelnet Integraciones Telem?ticas - http://www.sistelnet.es
NUEVOS TELEFONOS: 95-4186897 95-4186898 902-293030 Fax: 954186901


From jack at icecast.org  Wed Aug  9 17:12:33 2000
From: jack at icecast.org (Jack Moffitt)
Date: Fri Jan  9 21:52:03 2004
Subject: [mod_python] problem with authen handler
In-Reply-To: <007701c001ce$4b6b7c40$248a4cc3@sistelnet.es>
Message-ID: <Pine.LNX.4.10.10008091711260.14914-100000@deathstar.icecast.org>

I have the same problem, which i posted about a few days back.  Having
done some more research:

req.connection.user is correct, it has teh username

if i do username = req.connection.user then username == None.  I don't get
it.

jack.


On Wed, 9 Aug 2000, Eduardo Fernandez wrote:

> Hello everyone:
> 
> I whis I had discovered mod_python before. It would have saved me a lot of
> headaches in the application I am developing right now. In this app, I
> authenticate the users via a regular form in a page, and then keep the
> "logged-in" state with cookies.
> 
> I want to do it right (TM), and use basic http authentication with
> mod_python.
> 
> So I set up the documentation example, got the "Hello World!" part to work
> and now I am trying to make the authenhandler to work.
> 
> I have copied the example as in the documentation and tried to access the
> page. I get the user/pw window and fill it, but it alway fails with a 401
> error.
> 
> I have tried diferent usernames and pws, but it always fails. The apache
> logs show the user along with the 401 error, so I think I have the setup
> working mostly ok.
> 
> Where could be the quirk?
> 
> Thanks in advance.
> --
> Eduardo Fernández Corrales
> eduardo@sistelnet.es
> Sistelnet Integraciones Telemáticas - http://www.sistelnet.es
> NUEVOS TELEFONOS: 95-4186897 95-4186898 902-293030 Fax: 954186901
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 


From goodwin at apple.com  Wed Aug  9 22:21:02 2000
From: goodwin at apple.com (Larry Goodwin)
Date: Fri Jan  9 21:52:04 2004
Subject: [mod_python] invalid command in Apache config
Message-ID: <39923BBB.ABA1FFF6@apple.com>

I installed mod_python by changing the Apache config. 
Added "AddModule modules/extra/mod_python.c" to the Configuration file
Copied mod_python.c from mod_python...src/mod_python.c to apache.../src/modules/extra/
Ran configure, make and make install

Added the following to the httpd.conf file.
<Directory "/usr/local/webpages/test/">
AddHandler python-program .py
PythonHandler test
PythonDebug On
</Directory>

The test.py file is in /usr/local/webpages/test/
When I run apachectl configtest I get:
Syntax error on line 561 of /usr/local/apache/conf/httpd.conf:
Invalid command 'PythonHandler', perhaps mis-spelled or defined by a
module not included in the server configuration

Apache is 1.3.12 and mod_python is 2,4,1, Python is 1.5.2

Is there any way to make sure the mod_python.c was added to Apache or is
there another problem/

thanks

From grisha at ispol.com  Thu Aug 10 08:19:53 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:52:04 2004
Subject: [mod_python] problem with authen handler
In-Reply-To: <Pine.LNX.4.10.10008091711260.14914-100000@deathstar.icecast.org>
Message-ID: <Pine.LNX.4.21.0008100819040.9858-100000@saturn.ispol.com>

I'm looking into this right now.... It looks like if you call
get_basic_auth_pw() *first* - you get the user name.

Grisha


On Wed, 9 Aug 2000, Jack Moffitt wrote:

> I have the same problem, which i posted about a few days back.  Having
> done some more research:
> 
> req.connection.user is correct, it has teh username
> 
> if i do username = req.connection.user then username == None.  I don't get
> it.
> 
> jack.
> 
> 
> On Wed, 9 Aug 2000, Eduardo Fernandez wrote:
> 
> > Hello everyone:
> > 
> > I whis I had discovered mod_python before. It would have saved me a lot of
> > headaches in the application I am developing right now. In this app, I
> > authenticate the users via a regular form in a page, and then keep the
> > "logged-in" state with cookies.
> > 
> > I want to do it right (TM), and use basic http authentication with
> > mod_python.
> > 
> > So I set up the documentation example, got the "Hello World!" part to work
> > and now I am trying to make the authenhandler to work.
> > 
> > I have copied the example as in the documentation and tried to access the
> > page. I get the user/pw window and fill it, but it alway fails with a 401
> > error.
> > 
> > I have tried diferent usernames and pws, but it always fails. The apache
> > logs show the user along with the 401 error, so I think I have the setup
> > working mostly ok.
> > 
> > Where could be the quirk?
> > 
> > Thanks in advance.
> > --
> > Eduardo Fern?ndez Corrales
> > eduardo@sistelnet.es
> > Sistelnet Integraciones Telem?ticas - http://www.sistelnet.es
> > NUEVOS TELEFONOS: 95-4186897 95-4186898 902-293030 Fax: 954186901
> > 
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://www.modpython.org/mailman/listinfo/mod_python
> > 
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 


From grisha at ispol.com  Thu Aug 10 09:38:46 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:52:04 2004
Subject: [mod_python] some bug fixes and new features in CVS
Message-ID: <Pine.LNX.4.21.0008100927060.10100-100000@saturn.ispol.com>

Just FYI - 

I've checked in to the CVS server on sourceforge the version of mod_python
that has a number of new features, fixes and improvements. Some changes
were quite radical which is why I don't want to put it out as a release
just yet.

There are instructions on how to retrieve code from CVS on 
http://sourceforge.net/cvs/?group_id=7107

Some of the most significant changes are:

o New PythonEnablePdb directive that allows handlers to be executed
  within pdb (Python debugger).

o Proper finalization - Py_Finalize() C API function is called with a
  child proces exits, thus making sure all objects are destroyed properly.

o Dynamic handler registration. Now you can add handlers from within
  handlers. Extremely useful if you want, for example, to write an
  authentication handler that decides based on the userid which handler
  will handle the request.

o There is now a way to have multiple keys in a table via the
  add() function. Having multiple keys is critical to being able
  to set multiple cookies, as someone pointed out on this list.

o mod_python.c should compile with the -ansi option without warnings.


--
  Gregory (Grisha) Trubetskoy
       grisha@ispol.com


From grisha at ispol.com  Thu Aug 10 11:35:08 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:52:04 2004
Subject: [mod_python] some bug fixes and new features in CVS
In-Reply-To: <20000810135152.2096.qmail@web2206.mail.yahoo.com>
Message-ID: <Pine.LNX.4.21.0008101127050.10351-100000@saturn.ispol.com>

The CGI memory leak is not a problem with mod_python itself really. It has
to do with cgi.py and what it does. The thing to realize about mod_python
(or mod_perl, or php for that matter), is that code that is not careful
about memory allocation, will make apache process grow and grow.

I think that there are only two possible solutions - 

1. Some mod_python module that kills httpd when it reaches a certain
size. That's the technique mod_perl folks use.

2. A fix/rewrite of cgi.py.

The latter is the right thing to do, of course, but who knows when it will
happen....

I'd like to mention that this issue is certainly high on my TODO list, and
I'm open to any advice, suggetions, code snippets, patches, etc :-)

Grisha


On Thu, 10 Aug 2000, Alexis Iglauer wrote:

> Has the cgi memory leak been sorted out yet?  I am
> having to restart my apache at least once a day to not
> swamp my machine......
> 
> Keep up the excellent work!
> Regards
> Alexis
> --- Gregory Trubetskoy <grisha@ispol.com> wrote:
> > 
> > Just FYI - 
> > 
> > I've checked in to the CVS server on sourceforge the
> > version of mod_python
> > that has a number of new features, fixes and
> > improvements. Some changes
> > were quite radical which is why I don't want to put
> > it out as a release
> > just yet.
> > 
> > There are instructions on how to retrieve code from
> > CVS on 
> > http://sourceforge.net/cvs/?group_id=7107
> > 
> > Some of the most significant changes are:
> > 
> > o New PythonEnablePdb directive that allows handlers
> > to be executed
> >   within pdb (Python debugger).
> > 
> > o Proper finalization - Py_Finalize() C API function
> > is called with a
> >   child proces exits, thus making sure all objects
> > are destroyed properly.
> > 
> > o Dynamic handler registration. Now you can add
> > handlers from within
> >   handlers. Extremely useful if you want, for
> > example, to write an
> >   authentication handler that decides based on the
> > userid which handler
> >   will handle the request.
> > 
> > o There is now a way to have multiple keys in a
> > table via the
> >   add() function. Having multiple keys is critical
> > to being able
> >   to set multiple cookies, as someone pointed out on
> > this list.
> > 
> > o mod_python.c should compile with the -ansi option
> > without warnings.
> > 
> > 
> > --
> >   Gregory (Grisha) Trubetskoy
> >        grisha@ispol.com
> > 
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://www.modpython.org/mailman/listinfo/mod_python
> 
> 
> __________________________________________________
> Do You Yahoo!?
> Kick off your party with Yahoo! Invites.
> http://invites.yahoo.com/
> 


From sbi at acse.be  Thu Aug 10 19:40:09 2000
From: sbi at acse.be (Stephane Bidoul)
Date: Fri Jan  9 21:52:04 2004
Subject: [mod_python] mod_python / win32all and COM
References: <2D0E3DBA4C66D31195920008C784F4AF01332A5C@nt_syd_ex08.macbank>
Message-ID: <00a801c002f2$0d882020$faa679c1@spirou>

I think you need to put COM in free-threaded mode
by doing

>>> sys.coinit_flags = 0

before anything else.

There is a mention of this in the Python COM readme,
but and can't recall where it's documented in more details...

Tell me if it works for you.

-sbi

----- Original Message -----
From: "Robert Nasca" <Robert.Nasca@macquarie.com.au>
To: <mod_python@modpython.org>
Sent: Tuesday, 08 August, 2000 01:27
Subject: [mod_python] mod_python / win32all and COM


> Hi,
>
> Is there an FAQ on using mod_python with COM? It seems that I am having
> problems due to the threaded nature of Apache on win32 and it's
> interaction with COM.
>
> I have created an interface to some COM objects using the "makepy.py"
> program which comes with win32all.
>
> When I run Apache with ThreadsPerChild set to 1, everything runs fine
> (albeit with only one client), but when I set this to something higher,
> I get errors saying "CoInitialise() has not been called", which I assume
> are related to Apache spawning multiple threads. I've attached the
> output below.
>
> Mod_python error: "PythonHandler pytest"Traceback (innermost last):
>   File "h:\website\python\mod_python\apache.py", line 119, in Dispatch
>     result = object(req)
>   File "h:/website/htdocs/test\pytest.py", line 8, in handler
>     d = Snakey.Database.RiskReporterDatabase()
>   File "H:\WebSite\Python\Snakey\Database.py", line 32, in __init__
>     self.openConnection("DSN=RISK_REPORTER")
>   File "H:\WebSite\Python\Snakey\Database.py", line 20, in
> openConnection
>     self.connection = msado21.Connection()
>   File "H:\PythonDev\Snakey\msado21.py", line 1607, in __init__
> com_error: (-2147221008, 'CoInitialize has not been called.', None,
> None)
>
> If anyone has a suggestion on what is happening, or pointers to some
> information on using mod_python and COM, it would be appreciated.
>
> Thanks,
> Rob.
>
>



From goodwin at apple.com  Fri Aug 11 10:59:21 2000
From: goodwin at apple.com (Larry Goodwin)
Date: Fri Jan  9 21:52:04 2004
Subject: [mod_python] Problems with getting mod_python into Apache
Message-ID: <39943D7C.CB56DBA0@apple.com>

Folks, I am still having problems with getting mod_python compiled into
Apache 1.3.12
I followed the procedures:
cd apache/src
vi Configuration
AddModule modules/extra/mod_python.c
./Configure

Get this error:
+ adding selected modules
    o python_module uses ConfigStart/End
 + checking sizeof various data types
 + doing sanity check on compiler and options
** A test compilation with your Makefile configuration
** failed.  The below error output from the compilation
** test will give you an idea what is failing. Note that
** Apache requires an ANSI C Compiler, such as gcc.

======== Error Output for sanity check ========
cd ..; gcc  -DAIX=41 -DNEED_RLIM_T -U__STR__ -DAIX_BIND_PROCESSOR -DUSE_HSREGEX
-DUSE_EXPAT -I./lib/expat-lite -DNO_DL_NEEDED 
-I/usr/local/include/python1.5  -
Wl,-bE:python.exp -lld      -o helpers/dummy helpers/dummy.c   /usr/local/lib/py
thon1.5/config/libpython1.5.a      -lm
ld: 0706-004 Cannot find or read export file: python.exp
        ld:accessx(): No such file or directory
collect2: ld returned 255 exit status
make: *** [dummy] Error 1
============= End of Error Report =============

 Aborting!

python.exp is in /usr/local/lib/python1.5/conf

My path is: 
PATH=/usr/local/bin:/usr/local/lib/python1.5:/usr/local/lib/python1.5/conf:/usr/
local/include/python1.5:/usr/bin:/etc:/usr/sbin:/usr/ucb:/usr/bin/X11:/sbin

Thanks,
Larry

From daniel at unity.copyleft.no  Fri Aug 11 21:29:58 2000
From: daniel at unity.copyleft.no (Daniel Mikkelsen)
Date: Fri Jan  9 21:52:04 2004
Subject: [mod_python] PythonImport
Message-ID: <Pine.LNX.4.10.10008112123040.27319-100000@unity.copyleft.no>

Hi.

I'm having problems with loading modules not located in the global
site-packages directory. 

I want to load a module that opens a connection to a database, and
I want this module to be located in the same directory as the .py
files that will make use of it. 

However, I always get:

  Fri Aug 11 21:16:46 2000] [error] directive_PythonImport: error
  importing open_db_con ImportError: No module named open_db_con

If I copy the module into site-packages, this works. But I don't want
do this, as I expect to have lots of different programs that will 
want to access lots of different databases. 

I've tried using the PythonPath directive, to no avail. I'm using 
mod_python 2.4.1 loaded dynamically with Apache 1.3.9 on OpenBSD 2.6. 

Anything obvious I'm doing wrong?

-- Daniel Mikkelsen, Copyleft Software



From michael at stroeder.com  Fri Aug 11 21:50:05 2000
From: michael at stroeder.com (Michael =?iso-8859-1?Q?Str=F6der?=)
Date: Fri Jan  9 21:52:04 2004
Subject: [mod_python] PythonImport
References: <Pine.LNX.4.10.10008112123040.27319-100000@unity.copyleft.no>
Message-ID: <399458ED.BC942863@stroeder.com>

Daniel Mikkelsen wrote:
> 
> I'm having problems with loading modules not located in the global
> site-packages directory.
> 
> I want to load a module that opens a connection to a database, and
> I want this module to be located in the same directory as the .py
> files that will make use of it.

sys.path.append() is not an option?

Ciao, Michael.

From bfordham at piratech.net  Fri Aug 11 16:07:15 2000
From: bfordham at piratech.net (bfordham@piratech.net)
Date: Fri Jan  9 21:52:04 2004
Subject: [mod_python] PythonImport
In-Reply-To: <Pine.LNX.4.10.10008112123040.27319-100000@unity.copyleft.no>
Message-ID: <399424B3.32484.9BFEE0@localhost>

-----BEGIN PGP SIGNED MESSAGE-----

On 11 Aug 2000, at 21:29, Daniel Mikkelsen wrote:

> Hi.
> 
> I'm having problems with loading modules not located in the global
> site-packages directory. 

I tried a couple of quick tests.  First I created a module (yoda.py)
with one line (x=1) and put it in the directory with my main script. 
Told the main script to import it and print yoda.x; worked fine.

Moved yoda.py to directory blah, and added:
PythonPath "sys.path+['/serverpath','/serverpath/blah']
to my httpd.conf file.  Restarted the server, it worked, too.

I'm running Debian 2.1, Apache 1.3.12 and mod_python as a DSO.

Are you sure the script to want imported is in a directory the server
can read?  Did you restart the server?

Sorry I can't be of more help

- --B

-----BEGIN PGP SIGNATURE-----
Version: N/A

iQCVAwUBOZRctw2B1TBOdblFAQE+6AP5AVcFKkk8lwXZg8aXrpIUFJ29dJ+es3zy
LA0uHhKr1GVP0MoGuU/K6ovw9jU+mQG/XweirNn1ZjcCj5tAbxx26V9d15fF5Llx
z2aklem04SOExXNcXsM4DWCm/Rpe4O79TEdrPB//ZcdBmoBXgPbEbZ8R033y54Hy
thKrNKNZcM0=
=U2pW
-----END PGP SIGNATURE-----


From grisha at ispol.com  Fri Aug 11 17:25:14 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:52:04 2004
Subject: [mod_python] PythonImport
In-Reply-To: <Pine.LNX.4.10.10008112123040.27319-100000@unity.copyleft.no>
Message-ID: <Pine.LNX.4.21.0008111723300.14946-100000@saturn.ispol.com>

Is your PythonImport within an appropriate <Directory> tag or just by
itself?

--
  Gregory (Grisha) Trubetskoy
       grisha@ispol.com

On Fri, 11 Aug 2000, Daniel Mikkelsen wrote:

> Hi.
> 
> I'm having problems with loading modules not located in the global
> site-packages directory. 
> 
> I want to load a module that opens a connection to a database, and
> I want this module to be located in the same directory as the .py
> files that will make use of it. 
> 
> However, I always get:
> 
>   Fri Aug 11 21:16:46 2000] [error] directive_PythonImport: error
>   importing open_db_con ImportError: No module named open_db_con
> 
> If I copy the module into site-packages, this works. But I don't want
> do this, as I expect to have lots of different programs that will 
> want to access lots of different databases. 
> 
> I've tried using the PythonPath directive, to no avail. I'm using 
> mod_python 2.4.1 loaded dynamically with Apache 1.3.9 on OpenBSD 2.6. 
> 
> Anything obvious I'm doing wrong?
> 
> -- Daniel Mikkelsen, Copyleft Software
> 
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 


From daniel at unity.copyleft.no  Fri Aug 11 23:26:13 2000
From: daniel at unity.copyleft.no (Daniel Mikkelsen)
Date: Fri Jan  9 21:52:04 2004
Subject: [mod_python] PythonTransHandler
Message-ID: <Pine.LNX.4.10.10008112323570.27319-100000@unity.copyleft.no>

Hi.

Anyone here know how the PythonTransHandler works? It looks like it's
supposed to let me translate the URI at an early stage. But I'm
uncertain as to how my transhandler(req) is supposed to realize the 
translation it does. 

-- Daniel Mikkelsen, Copyelft Software



From L.A.Timochouk at ukc.ac.uk  Fri Aug 11 23:00:29 2000
From: L.A.Timochouk at ukc.ac.uk (Dr. L.A. Timochouk)
Date: Fri Jan  9 21:52:04 2004
Subject: [mod_python] A patch for mod_python-2.4.1
Message-ID: <Pine.GSO.4.21.0008112257320.29709-100000@myrtle.ukc.ac.uk>

Hello All,

Please find attached a patch for mod_python-2.4.1. It addresses two issues:

(1) The current implementation of "req_read" method seems to contain a bug
    (or a problematic feature?): it may return less bytes than was requested,
    due to a known sockets phenomenon called "short read". Namely, a single
    "read" on a TCP socket returns data ONLY up to the end of the current
    IP packet; several "read"s may be required to get the whole amount
    requested. The current implementation did not guard against that; on the
    contrary, it shrank the output buffer is less-than-expected bytes were
    received. In particular, this may result in incomplete receiving of POSTed
    data (the problem shows up on large submissions only). The proposed
    patch fixes it.

(2) A new Apache directive,

    PythonOptimize On|Off

    is implemented. If set, it allows us to run the interpreter in the
    fully-optimising mode (equivalent to -OO Python command-line argument)
    which may be useful for time-critical applications.

Best regards,

Dr. Leonid Timochouk
Computing Laboratory
University of Kent at Canterbury
England
===============================================================================

--- mod_python.c.orig	Tue Jul  4 18:49:31 2000
+++ mod_python.c	Sun Jul 23 16:39:55 2000
@@ -1277,7 +1277,7 @@
 static PyObject * req_read(requestobject *self, PyObject *args)
 {
 
-    int len, rc, bytes_read;
+    int len, rc, bytes_read, chunk_len;
     char *buffer;
     PyObject *result;
 
@@ -1316,13 +1316,18 @@
 	return NULL;
 
     /* read it in */
+    /* BEWARE of short reads!  */
     buffer = PyString_AS_STRING((PyStringObject *) result);
-    bytes_read = ap_get_client_block(self->request_rec, buffer, len);
-
-    /* resize if necessary */
-    if (bytes_read < len) 
-	if(_PyString_Resize(&result, bytes_read))
+    bytes_read = 0;
+    while (bytes_read < len)
+    {
+	chunk_len = ap_get_client_block
+		    (self->request_rec, buffer+bytes_read, len-bytes_read);
+	if  (chunk_len == 0)
+	    /* Connection closed -- it's better not to return anything */
 	    return NULL;
+    	bytes_read += chunk_len;
+    }
 
     return result;
 }
@@ -2087,6 +2092,19 @@
 }
 
 /**
+ ** directive_PythonOptimize
+ **
+ *	This function called whenever PythonOptimize directive
+ *	is encountered.
+ */
+static const char *directive_PythonOptimize(cmd_parms *cmd, void *mconfig,
+					    int val) {
+    if (val)
+	Py_OptimizeFlag = 2; /* Optimize and remove function descr strings */
+    return NULL;
+}
+
+/**
  ** directive_PythonInterpPerDirectory
  **
  *      This function called whenever PythonInterpPerDirectory directive
@@ -2409,6 +2427,14 @@
 	OR_ALL,                         
 	FLAG,                               
 	"Send (most) Python error output to the client rather than logfile."
+    },
+    {
+	"PythonOptimize",
+	directive_PythonOptimize,
+	NULL,
+	OR_ALL,
+	FLAG,
+	"Set the equivalent of the -O command-line flag on the interpreter."
     },
     {
 	"PythonNoReload",                 



From dyeung at ust.hk  Mon Aug 14 09:26:49 2000
From: dyeung at ust.hk (David YEUNG)
Date: Fri Jan  9 21:52:04 2004
Subject: [mod_python] How to define an environment variable for other python module to use?
Message-ID: <39974AD9.2C33FAE1@ust.hk>

I have other python modules which usually need to read some environment
variables, e.g., an python-oracle interface module needs to read the "ORACLE_SID"
to know where the database to connect. I used to defining this variable in the "shell"
before invoking a python CGI program, e.g.:

   #!/bin/sh
   export ORACLE_SID=orcl
   exec /some/oracle/python/interface.cgi

I would like to try the mod_python using the default CGI handler, but does someone
know how to define some environment variable in mod_python?

Thanks

david

From jack at icecast.org  Sun Aug 13 18:37:05 2000
From: jack at icecast.org (Jack Moffitt)
Date: Fri Jan  9 21:52:04 2004
Subject: [mod_python] How to define an environment variable for other
 python module to use?
In-Reply-To: <39974AD9.2C33FAE1@ust.hk>
Message-ID: <Pine.LNX.4.10.10008131836030.24345-100000@deathstar.icecast.org>

generally when we do this with php, we define the ENV variables in the
apache startup script, so that they get into every child process.  then
they are readable with the normal environment functions.

we don't normally change where the oracle_sid is, so we have no need to
set them.

jack.

On Mon, 14 Aug 2000, David YEUNG wrote:

> I have other python modules which usually need to read some environment
> variables, e.g., an python-oracle interface module needs to read the "ORACLE_SID"
> to know where the database to connect. I used to defining this variable in the "shell"
> before invoking a python CGI program, e.g.:
> 
>    #!/bin/sh
>    export ORACLE_SID=orcl
>    exec /some/oracle/python/interface.cgi
> 
> I would like to try the mod_python using the default CGI handler, but does someone
> know how to define some environment variable in mod_python?
> 
> Thanks
> 
> david
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 


From rdevide at ican.at  Mon Aug 14 11:51:37 2000
From: rdevide at ican.at (Devide Robert)
Date: Fri Jan  9 21:52:04 2004
Subject: [mod_python] some bug fixes and new features in CVS
References: <Pine.LNX.4.21.0008101127050.10351-100000@saturn.ispol.com>
Message-ID: <3997C129.EA8F5DED@ican.at>

Gregory Trubetskoy wrote:
> 1. Some mod_python module that kills httpd when it reaches a certain
> size. That's the technique mod_perl folks use.

Would rather use something like

MaxRequestsPerChild 100

in apache config.
(as it had proofed to be the simplest and most effective way to 'handle'
memory leaks in various modules)

dave

From grisha at ispol.com  Mon Aug 14 08:31:17 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:52:04 2004
Subject: [mod_python] PythonTransHandler
In-Reply-To: <Pine.LNX.4.10.10008112323570.27319-100000@unity.copyleft.no>
Message-ID: <Pine.LNX.4.21.0008140827470.1734-100000@saturn.ispol.com>

You basically take assign a value to req.filename, usually based on
req.uri. There is a problem in 2.4.1 though - the filename attribute is
read-only. This has been fixed in the latest code which you can get from
CVS.

--
  Gregory (Grisha) Trubetskoy
       grisha@ispol.com

On Fri, 11 Aug 2000, Daniel Mikkelsen wrote:

> Hi.
> 
> Anyone here know how the PythonTransHandler works? It looks like it's
> supposed to let me translate the URI at an early stage. But I'm
> uncertain as to how my transhandler(req) is supposed to realize the 
> translation it does. 
> 
> -- Daniel Mikkelsen, Copyelft Software
> 
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 


From grisha at ispol.com  Mon Aug 14 08:36:09 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:52:04 2004
Subject: [mod_python] A patch for mod_python-2.4.1
In-Reply-To: <Pine.GSO.4.21.0008112257320.29709-100000@myrtle.ukc.ac.uk>
Message-ID: <Pine.LNX.4.21.0008140834280.1734-100000@saturn.ispol.com>

Thanks Leonid. I still have your original -OO patch in my INBOX and I'll
make sure to apply it.

Question - are you sure ap_get_client_block() doesn't take care of short
reads?

Thanks!

--
  Gregory (Grisha) Trubetskoy
       grisha@ispol.com

On Fri, 11 Aug 2000, Dr. L.A. Timochouk wrote:

> Hello All,
> 
> Please find attached a patch for mod_python-2.4.1. It addresses two issues:
> 
> (1) The current implementation of "req_read" method seems to contain a bug
>     (or a problematic feature?): it may return less bytes than was requested,
>     due to a known sockets phenomenon called "short read". Namely, a single
>     "read" on a TCP socket returns data ONLY up to the end of the current
>     IP packet; several "read"s may be required to get the whole amount
>     requested. The current implementation did not guard against that; on the
>     contrary, it shrank the output buffer is less-than-expected bytes were
>     received. In particular, this may result in incomplete receiving of POSTed
>     data (the problem shows up on large submissions only). The proposed
>     patch fixes it.
> 
> (2) A new Apache directive,
> 
>     PythonOptimize On|Off
> 
>     is implemented. If set, it allows us to run the interpreter in the
>     fully-optimising mode (equivalent to -OO Python command-line argument)
>     which may be useful for time-critical applications.
> 
> Best regards,
> 
> Dr. Leonid Timochouk
> Computing Laboratory
> University of Kent at Canterbury
> England
> ===============================================================================
> 
> --- mod_python.c.orig	Tue Jul  4 18:49:31 2000
> +++ mod_python.c	Sun Jul 23 16:39:55 2000
> @@ -1277,7 +1277,7 @@
>  static PyObject * req_read(requestobject *self, PyObject *args)
>  {
>  
> -    int len, rc, bytes_read;
> +    int len, rc, bytes_read, chunk_len;
>      char *buffer;
>      PyObject *result;
>  
> @@ -1316,13 +1316,18 @@
>  	return NULL;
>  
>      /* read it in */
> +    /* BEWARE of short reads!  */
>      buffer = PyString_AS_STRING((PyStringObject *) result);
> -    bytes_read = ap_get_client_block(self->request_rec, buffer, len);
> -
> -    /* resize if necessary */
> -    if (bytes_read < len) 
> -	if(_PyString_Resize(&result, bytes_read))
> +    bytes_read = 0;
> +    while (bytes_read < len)
> +    {
> +	chunk_len = ap_get_client_block
> +		    (self->request_rec, buffer+bytes_read, len-bytes_read);
> +	if  (chunk_len == 0)
> +	    /* Connection closed -- it's better not to return anything */
>  	    return NULL;
> +    	bytes_read += chunk_len;
> +    }
>  
>      return result;
>  }
> @@ -2087,6 +2092,19 @@
>  }
>  
>  /**
> + ** directive_PythonOptimize
> + **
> + *	This function called whenever PythonOptimize directive
> + *	is encountered.
> + */
> +static const char *directive_PythonOptimize(cmd_parms *cmd, void *mconfig,
> +					    int val) {
> +    if (val)
> +	Py_OptimizeFlag = 2; /* Optimize and remove function descr strings */
> +    return NULL;
> +}
> +
> +/**
>   ** directive_PythonInterpPerDirectory
>   **
>   *      This function called whenever PythonInterpPerDirectory directive
> @@ -2409,6 +2427,14 @@
>  	OR_ALL,                         
>  	FLAG,                               
>  	"Send (most) Python error output to the client rather than logfile."
> +    },
> +    {
> +	"PythonOptimize",
> +	directive_PythonOptimize,
> +	NULL,
> +	OR_ALL,
> +	FLAG,
> +	"Set the equivalent of the -O command-line flag on the interpreter."
>      },
>      {
>  	"PythonNoReload",                 
> 
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 


From grisha at ispol.com  Mon Aug 14 08:46:38 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:52:04 2004
Subject: [mod_python] some bug fixes and new features in CVS
In-Reply-To: <3997C129.EA8F5DED@ican.at>
Message-ID: <Pine.LNX.4.21.0008140845080.1734-100000@saturn.ispol.com>

That's the way I would do it. BTW - I heard that this directive does
nothing on Win32 where Apache is threaded. Of course the solution I
sugested (killing the process) wouldn't help either....

Grisha

On Mon, 14 Aug 2000, Devide Robert wrote:

> Gregory Trubetskoy wrote:
> > 1. Some mod_python module that kills httpd when it reaches a certain
> > size. That's the technique mod_perl folks use.
> 
> Would rather use something like
> 
> MaxRequestsPerChild 100
> 
> in apache config.
> (as it had proofed to be the simplest and most effective way to 'handle'
> memory leaks in various modules)
> 
> dave
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 


From miguel at yorku.ca  Mon Aug 14 09:20:56 2000
From: miguel at yorku.ca (Miguel Marques)
Date: Fri Jan  9 21:52:04 2004
Subject: [mod_python] some bug fixes and new features in CVS
In-Reply-To: <Pine.LNX.4.21.0008101127050.10351-100000@saturn.ispol.com>
References: <20000810135152.2096.qmail@web2206.mail.yahoo.com>
	<Pine.LNX.4.21.0008101127050.10351-100000@saturn.ispol.com>
Message-ID: <20000814092056B.miguel@yorku.ca>

On Thu, 10 Aug 2000 11:35:08 -0400 (EDT), Gregory Trubetskoy <grisha@ispol.com> wrote:
> 
> The CGI memory leak is not a problem with mod_python itself really. It has
> to do with cgi.py and what it does. The thing to realize about mod_python

Could you elaborate on why or how cgi.py leaks memory?  I'm using both
mod_python and cgi on a project that will see very large usage and I
would like to try and figure out if I should drop usage of cgi.py or not.
Thanks!

							Miguel

C. Miguel Marques, York University, Computing & Communications Services
e-mail: miguel@yorku.ca, voice: (416)736-2100x22684, fax: (416)736-5830

From L.A.Timochouk at ukc.ac.uk  Mon Aug 14 15:44:19 2000
From: L.A.Timochouk at ukc.ac.uk (Dr. L.A. Timochouk)
Date: Fri Jan  9 21:52:04 2004
Subject: [mod_python] A patch for mod_python-2.4.1
In-Reply-To: <Pine.LNX.4.21.0008140834280.1734-100000@saturn.ispol.com>
Message-ID: <Pine.GSO.4.21.0008141538030.24919-100000@myrtle.ukc.ac.uk>

Yes, it appeared to us that "ap_get_client_block" is susceptible to short
reads -- it indeed reads a BLOCK until the end of the current IP datagram
but no further. The problem was discovered when we implemented our Web
site with relatively large user submissions (by POST) using the current
version of mod_python. The exact cause of the problem was identified with
the help of "tcpdump".

Sincerely, L.A.Timochouk


From gstein at lyra.org  Mon Aug 14 12:53:29 2000
From: gstein at lyra.org (Greg Stein)
Date: Fri Jan  9 21:52:04 2004
Subject: [mod_python] A patch for mod_python-2.4.1 (fwd)
In-Reply-To: <Pine.LNX.4.21.0008141206500.2308-100000@saturn.ispol.com>; from grisha@ispol.com on Mon, Aug 14, 2000 at 12:08:19PM -0400
References: <Pine.LNX.4.21.0008141206500.2308-100000@saturn.ispol.com>
Message-ID: <20000814125329.X19525@lyra.org>

Nope. Haven't been reading it.

ap_get_client_block() returns a length. It can definitely return a length
less than that requested.

Or is it that length==0 gets returned before the end of the request? (which
would typically end the read loop)

Cheers,
-g

On Mon, Aug 14, 2000 at 12:08:19PM -0400, Gregory Trubetskoy wrote:
> 
> Greg -
> 
> Are you following this thread? This could could qualify as a bug in
> Apache if Dr. Timochouk is right.
> 
> Grisha
> 
> 
> ---------- Forwarded message ----------
> Date: Mon, 14 Aug 2000 15:44:19 +0100 (BST)
> From: Dr. L.A. Timochouk <L.A.Timochouk@ukc.ac.uk>
> To: Gregory Trubetskoy <grisha@ispol.com>
> Cc: mod_python@modpython.org
> Subject: Re: [mod_python] A patch for mod_python-2.4.1
> 
> Yes, it appeared to us that "ap_get_client_block" is susceptible to short
> reads -- it indeed reads a BLOCK until the end of the current IP datagram
> but no further. The problem was discovered when we implemented our Web
> site with relatively large user submissions (by POST) using the current
> version of mod_python. The exact cause of the problem was identified with
> the help of "tcpdump".
> 
> Sincerely, L.A.Timochouk

-- 
Greg Stein, http://www.lyra.org/

From jameswalker at clear.net.nz  Wed Aug 16 12:40:15 2000
From: jameswalker at clear.net.nz (James Walker)
Date: Fri Jan  9 21:52:04 2004
Subject: [mod_python] test.py runs even when deleted
Message-ID: <3999e2ef.dc4.0@clear.net.nz>

I've gotten mod_python (from the RPM) working on my Linux 6.2/Apache 1.3.12 box.
 I've sorted out all the <directory> stuff in httpd.conf and gotten the "Hello
to the ...." appear when accessing test.py or for that matter t.py (yes I understand
the "PythonHandler test" thing (I think)).

Now the issue.  I've deleted test.py and have a helloworld.py which has the
handler defined and which puts out a whole heap of html text.  However I still
get the same "Hello to ..." text from test.py (which is deleted!).  This happens
even after restarting apache and/or then rebooting the machine.

Anyone able to figure that one out?  I'm really looking forward to getting into
Python as I find it heaps easier to read/understand then Perl.  But while CGI
based Python scripts is an option I would prefer mod_python.

Hope somone can help,
James Walker.

From jameswalker at clear.net.nz  Thu Aug 17 10:02:52 2000
From: jameswalker at clear.net.nz (James Walker)
Date: Fri Jan  9 21:52:04 2004
Subject: [mod_python] test.py runs even when deleted
References: <3999e2ef.dc4.0@clear.net.nz>
Message-ID: <399B0F8C.208EDBC1@clear.net.nz>

Sorted.  Didn't realise that the .htaccess file actually had some stuff in it.  It's
directives were over-riding those I had in httpd.conf.  I commented those out and it
all started to behave as I was expecting.

Yah!  Off we go.

Cheers,
James.


James Walker wrote:

> I've gotten mod_python (from the RPM) working on my Linux 6.2/Apache 1.3.12 box.
>  I've sorted out all the <directory> stuff in httpd.conf and gotten the "Hello
> to the ...." appear when accessing test.py or for that matter t.py (yes I understand
> the "PythonHandler test" thing (I think)).
>
> Now the issue.  I've deleted test.py and have a helloworld.py which has the
> handler defined and which puts out a whole heap of html text.  However I still
> get the same "Hello to ..." text from test.py (which is deleted!).  This happens
> even after restarting apache and/or then rebooting the machine.
>
> Anyone able to figure that one out?  I'm really looking forward to getting into
> Python as I find it heaps easier to read/understand then Perl.  But while CGI
> based Python scripts is an option I would prefer mod_python.
>
> Hope somone can help,
> James Walker.
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python


From dirk at infostreet.com  Wed Aug 16 17:09:17 2000
From: dirk at infostreet.com (Dirk Leas)
Date: Fri Jan  9 21:52:04 2004
Subject: [mod_python] POSTed form fields?
Message-ID: <NBBBKMMANMGEEBHPJJECKEMDHKAA.dirk@infostreet.com>

How do I access them? I post a form with a hidden field, a text field, and
two fields encoded in the action. I dump all the request values (strings and
tables) and don't see my form fields, only values encoded in the URL. Quick
suggestion?

I've tried mod_python on both linux and win32 and get the same behavior.

Later,
D

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mailman.modpython.org/pipermail/mod_python/attachments/20000816/30422d2c/attachment-0001.htm
From L.A.Timochouk at ukc.ac.uk  Thu Aug 17 01:31:43 2000
From: L.A.Timochouk at ukc.ac.uk (Dr. L.A. Timochouk)
Date: Fri Jan  9 21:52:04 2004
Subject: [mod_python] POSTed form fields?
In-Reply-To: <NBBBKMMANMGEEBHPJJECKEMDHKAA.dirk@infostreet.com>
Message-ID: <Pine.GSO.4.21.0008170121130.7748-100000@myrtle.ukc.ac.uk>

The request object does not contain parsed (or even unparsed) POSTed
fields, so you need to read and parse them yourself:

(1) get the total length of the POSTed data from the "Content-length"
    header (available through the "headers_in" table in the request
    object);

(2) read the data in using the "read" method on the req object; NB:
    in mod_python 2.4.1, "read" can return a shorter data chunk than
    requested ("short read"); a patch had been submitted which
    rectifies the problem; alternatively you can do multiple "read"s
    until you get the whole length of your data;

(3) then you can parse the contents splitting it into key=value
    pairs separated by "&"s. There are some subtleties like multiple
    fields with the same name, file submission by POST,etc, to take
    care about.

Hope it will help,

Leonid Timochouk
Computing Laboratory
University of Kent at Canterbury
England


From kevin at GamesAndTheory.com  Wed Aug 16 21:04:11 2000
From: kevin at GamesAndTheory.com (Kevin Douglas)
Date: Fri Jan  9 21:52:04 2004
Subject: [mod_python] not compiling
Message-ID: <DKEEJHGMIIOMNIJFOCAICEKLCBAA.kevin@GamesAndTheory.com>

apache 1.3.12 and the latest release of mod_python

more info later after i beat it around


(this is also a test message)


h3ll0!
:P


-kev



From grisha at ispol.com  Thu Aug 17 09:05:24 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:52:04 2004
Subject: [mod_python] POSTed form fields?
In-Reply-To: <Pine.GSO.4.21.0008170121130.7748-100000@myrtle.ukc.ac.uk>
Message-ID: <Pine.LNX.4.21.0008170859400.13868-100000@saturn.ispol.com>

In other words, something like:

import cgi

len = int(req.headers_in["content-length"])
form_data = cgi.parse_qs(req.read(len))

Should do it. Dr. Timouchouk is right - if you're POSTing large files
(50K+), then you should check the size returned by read() and read() again
if it wasn't all.

The next release will make this unnecessary - read() will return all there
was to read. It will also follow the apache Timeout directive.

If you're handy with CVS - you can get that code right now from the
sourceforge CVS server.

--
  Gregory (Grisha) Trubetskoy
       grisha@ispol.com

On Thu, 17 Aug 2000, Dr. L.A. Timochouk wrote:

> The request object does not contain parsed (or even unparsed) POSTed
> fields, so you need to read and parse them yourself:
> 
> (1) get the total length of the POSTed data from the "Content-length"
>     header (available through the "headers_in" table in the request
>     object);
> 
> (2) read the data in using the "read" method on the req object; NB:
>     in mod_python 2.4.1, "read" can return a shorter data chunk than
>     requested ("short read"); a patch had been submitted which
>     rectifies the problem; alternatively you can do multiple "read"s
>     until you get the whole length of your data;
> 
> (3) then you can parse the contents splitting it into key=value
>     pairs separated by "&"s. There are some subtleties like multiple
>     fields with the same name, file submission by POST,etc, to take
>     care about.
> 
> Hope it will help,
> 
> Leonid Timochouk
> Computing Laboratory
> University of Kent at Canterbury
> England
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 



From lahondes at pasteur.fr  Thu Aug 17 18:12:09 2000
From: lahondes at pasteur.fr (Raynald de Lahondes)
Date: Fri Jan  9 21:52:04 2004
Subject: [mod_python] configuring mod_python in Debian 2.2
Message-ID: <20000817181209.C13600@pombe.vironc.pasteur.fr>

I am interested in mod_python but have difficulties in configuring the
program. I am using Debian 2.2 binaries, id est:

apache 1.3.9
python 1.5.2

I successfully compiled the lib and installed them in
/usr/lib/python1.5/site-packages/mod_python

the "compileall.py" was ok.

I compiled mod_python as suggested with apxs tool

apxs -I /usr/include/python1.5 -c mod_python.c \
/usr/lib/python1.5/config/libpython1.5.a -lpthread

and copied the resulting mod_python.so in /usr/lib/apache/1.3/

I modified the httpd.conf as suggested (first module, cf FAQ):
LoadModule python_module /usr/lib/apache/1.3/mod_python.so

(apache started OK)
I modified srm.conf (resource file for apache in Debian)

AddHandler python-program .py
PythonHandler test
PythonDebug On

and restarted apache again.

Then I create /var/www/test

and put the example test.py in /var/www/test/test.py

access to http://localfile/test/anything.py

generate an error: (in apache/error.log)

[Thu Aug 17 17:29:03 2000] [error] PythonHandler test: Traceback\
(innermost last):
[Thu Aug 17 17:29:03 2000] [error] PythonHandler test:   File\
"/usr/lib/python1.5/mod_python/apache.py", line 113, in Dispatch
[Thu Aug 17 17:29:03 2000] [error] PythonHandler test:   File\
"/usr/lib/python1.5/mod_python/apache.py", line 246, in import_module
[Thu Aug 17 17:29:03 2000] [error] PythonHandler test: ImportError: No\
module named test

I tried to check directly with python libs but I can't:

>>> from mod_python import apache
Traceback (innermost last):
  File "<stdin>", line 1, in ?
  File "/usr/lib/python1.5/mod_python/apache.py", line 18, in ?
ImportError: No module named _apache
>>> 


I have done nearly all I could do with the documentation I have, I need some
help please !

-- 
Raynald de Lahondes
Unite des Virus Oncogenes - Departement de Biotechnologie
Institut Pasteur - 25, rue du Docteur Roux
75724 Paris Cedex 15 - FRANCE
tel: 01.45.68.84.54 - fax: 01.40.61.30.33 - cellular: 06.15.65.85.08
email: lahondes@pasteur.fr 

From grisha at ispol.com  Thu Aug 17 13:48:49 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:52:04 2004
Subject: [mod_python] configuring mod_python in Debian 2.2
In-Reply-To: <20000817181209.C13600@pombe.vironc.pasteur.fr>
Message-ID: <Pine.LNX.4.21.0008171346430.14123-100000@saturn.ispol.com>

Make sure you have some <Directory> tags, i.e:

<Directory /var/www/test>
	AddHandler python-program .py
	PythonHandler test
	PythonDebug On
</Directory>


On Thu, 17 Aug 2000, Raynald de Lahondes wrote:

> I am interested in mod_python but have difficulties in configuring the
> program. I am using Debian 2.2 binaries, id est:
> 
> apache 1.3.9
> python 1.5.2
> 
> I successfully compiled the lib and installed them in
> /usr/lib/python1.5/site-packages/mod_python
> 
> the "compileall.py" was ok.
> 
> I compiled mod_python as suggested with apxs tool
> 
> apxs -I /usr/include/python1.5 -c mod_python.c \
> /usr/lib/python1.5/config/libpython1.5.a -lpthread
> 
> and copied the resulting mod_python.so in /usr/lib/apache/1.3/
> 
> I modified the httpd.conf as suggested (first module, cf FAQ):
> LoadModule python_module /usr/lib/apache/1.3/mod_python.so
> 
> (apache started OK)
> I modified srm.conf (resource file for apache in Debian)
> 
> AddHandler python-program .py
> PythonHandler test
> PythonDebug On
> 
> and restarted apache again.
> 
> Then I create /var/www/test
> 
> and put the example test.py in /var/www/test/test.py
> 
> access to http://localfile/test/anything.py
> 
> generate an error: (in apache/error.log)
> 
> [Thu Aug 17 17:29:03 2000] [error] PythonHandler test: Traceback\
> (innermost last):
> [Thu Aug 17 17:29:03 2000] [error] PythonHandler test:   File\
> "/usr/lib/python1.5/mod_python/apache.py", line 113, in Dispatch
> [Thu Aug 17 17:29:03 2000] [error] PythonHandler test:   File\
> "/usr/lib/python1.5/mod_python/apache.py", line 246, in import_module
> [Thu Aug 17 17:29:03 2000] [error] PythonHandler test: ImportError: No\
> module named test
> 
> I tried to check directly with python libs but I can't:
> 
> >>> from mod_python import apache
> Traceback (innermost last):
>   File "<stdin>", line 1, in ?
>   File "/usr/lib/python1.5/mod_python/apache.py", line 18, in ?
> ImportError: No module named _apache
> >>> 
> 
> 
> I have done nearly all I could do with the documentation I have, I need some
> help please !
> 
> -- 
> Raynald de Lahondes
> Unite des Virus Oncogenes - Departement de Biotechnologie
> Institut Pasteur - 25, rue du Docteur Roux
> 75724 Paris Cedex 15 - FRANCE
> tel: 01.45.68.84.54 - fax: 01.40.61.30.33 - cellular: 06.15.65.85.08
> email: lahondes@pasteur.fr 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 


From rsalz at caveosystems.com  Thu Aug 17 15:09:08 2000
From: rsalz at caveosystems.com (Rich Salz)
Date: Fri Jan  9 21:52:04 2004
Subject: [mod_python] Swig, and mod_ssl
References: <200007160231.WAA04120@pc1.caveosystems.com>
Message-ID: <399C3854.B91CE827@caveosystems.com>

Back in mid-July, I wrote rsalz@caveosystems.com wrote:
> Swig (http://www.swig.org) is a "compiler" that can parse most C
> header files and automatically generate code for Perl, Tcl, Python,
> and Java.  At a rough guess, approximately half of mod_python.c could
> be replaced by a couple-dozen lines.  I wonder if it makes sense
> to use SWIG, and for sites without it, include the Swig output.
> (Just like some programs include the output of Yacc, for those without it.)
> 
> Second question, which motivated the first: anyone looked at what
> could/should be added to the mod_python objects when mod_ssl is used?

Here is what I am going to end up doing.  I added a "get_swig_handle"
method that returns the request_rec code into the SWIG representation
of a pointer.  I'll then write little SWIG code to pull things out of
the mod_ssl context.  I'll send get_swig_handle and a sample use if
there's interest.
	/r$

From grisha at ispol.com  Thu Aug 17 15:37:54 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:52:04 2004
Subject: [mod_python] Swig, and mod_ssl
In-Reply-To: <399C3854.B91CE827@caveosystems.com>
Message-ID: <Pine.LNX.4.21.0008171533280.14123-100000@saturn.ispol.com>

That'd be interesting to see. 

I'd really appreciate a lamens terms explanation of what it is you're
trying to get out of mod_ssl and what are the steps issues involved with
it? I'm somewhat mod_ssl ingorant - I've used it to set up SSL sites and
I'm somwhat familiar with use of openssl to generate certificates and
such, but I know next to nothing about mod_ssl internals.

P.S. Does SWIG really have to be involved in order for this to work?

--
  Gregory (Grisha) Trubetskoy
       grisha@ispol.com

On Thu, 17 Aug 2000, Rich Salz wrote:

> Back in mid-July, I wrote rsalz@caveosystems.com wrote:
> > Swig (http://www.swig.org) is a "compiler" that can parse most C
> > header files and automatically generate code for Perl, Tcl, Python,
> > and Java.  At a rough guess, approximately half of mod_python.c could
> > be replaced by a couple-dozen lines.  I wonder if it makes sense
> > to use SWIG, and for sites without it, include the Swig output.
> > (Just like some programs include the output of Yacc, for those without it.)
> > 
> > Second question, which motivated the first: anyone looked at what
> > could/should be added to the mod_python objects when mod_ssl is used?
> 
> Here is what I am going to end up doing.  I added a "get_swig_handle"
> method that returns the request_rec code into the SWIG representation
> of a pointer.  I'll then write little SWIG code to pull things out of
> the mod_ssl context.  I'll send get_swig_handle and a sample use if
> there's interest.
> 	/r$
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 


From rsalz at caveosystems.com  Thu Aug 17 15:51:10 2000
From: rsalz at caveosystems.com (Rich Salz)
Date: Fri Jan  9 21:52:04 2004
Subject: [mod_python] Swig, and mod_ssl
References: <Pine.LNX.4.21.0008171533280.14123-100000@saturn.ispol.com>
Message-ID: <399C422E.1387F0CC@caveosystems.com>

> That'd be interesting to see.

Let me play with it a day or two and I'll send the patch along.

> I'd really appreciate a lamens terms explanation of what it is you're
> trying to get out of mod_ssl and what are the steps issues involved with
> it?

The simplest thing is: I want to be able to get the the DN of the client
and their entire cert, if there is one.  With this, I can do all my own
authorization rules in my python code.  Later on, I want to be able to
control what crypto protocols they're using, etc.

> I'm somwhat familiar with use of openssl to generate certificates and
> such, but I know next to nothing about mod_ssl internals.

> P.S. Does SWIG really have to be involved in order for this to work?

No.  It just saves me a lot of time. SWIG is a "compiler" that read C
(and, to some extent) C++ header files, and generates all the python
code to map the datatypes, and wrappers that convert from Py objects to
the C objects, and back.  Simple things (numbers strings) get mapped
directly, others are only exposed as pointers unless you write your own
conversions.  There are some good examples at http://www.swig.org

Ng Pheng Siong has a package, M2Crypto, that exposes most of the OpenSSL
functions up through python (via swig) -- see
http://www.post1.com/home/ngps.  So all I need is a little glue code
(i.e., my get_swig_handle patch) and I can do what I need.
	/r$

From grisha at ispol.com  Fri Aug 18 08:43:26 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:52:05 2004
Subject: [mod_python] Swig, and mod_ssl
In-Reply-To: <399C422E.1387F0CC@caveosystems.com>
Message-ID: <Pine.LNX.4.21.0008180839400.15289-100000@saturn.ispol.com>

On Thu, 17 Aug 2000, Rich Salz wrote:

> The simplest thing is: I want to be able to get the the DN of the client
> and their entire cert

BTW, one way to get DN is "SSLOptions +FakeBasicAuth", then the DN should
appear in req.connection.user.

http://www.modssl.org/docs/2.6/ssl_howto.html#ToC9


Grisha


From rsalz at caveosystems.com  Fri Aug 18 09:34:02 2000
From: rsalz at caveosystems.com (Rich Salz)
Date: Fri Jan  9 21:52:05 2004
Subject: [mod_python] Swig, and mod_ssl
References: <Pine.LNX.4.21.0008180839400.15289-100000@saturn.ispol.com>
Message-ID: <399D3B4A.7C5772BB@caveosystems.com>

> BTW, one way to get DN is "SSLOptions +FakeBasicAuth", then the DN should
> appear in req.connection.user.

Right.  But I need more than that.  I need to know *if* there's a client
cert, all the nitty-gritty details of it (e.g., what the keyUsage
extension is), I need to do my own verification, no CRL processing, my
own chain verification, etc.  Lots of stuff.  Ralph did a great job
writing a turn-key application that is great for most folks, but I need
to really get under the hood....

From pereran at yahoo.com  Fri Aug 18 07:57:16 2000
From: pereran at yahoo.com (Niranjan Perera)
Date: Fri Jan  9 21:52:05 2004
Subject: [mod_python] Trying to get mod_python+apache on FreeBSD working.
Message-ID: <20000818145716.24237.qmail@web512.mail.yahoo.com>

Hello:

I am  a newbie.

System: FreeBSD 4.0,
        Apache 1.3.12
        Python 1.5.2

Download mod_python, and followed instructions.

Added the following entry to httpd.conf

AddModule mod_python.c
<Directory /usr/local/www/data>
        AddHandler python-program .py
        PythonHandler test
        PythonDebug On
</Directory>

Placed in /usr/local/www/data the following code (
demo.py )
from mod_python import apache

def handler(req):
        req.send_http_header()
        req.write("Hello from Python!")
        return apache.OK

restarted httpd,

when I type http://xxx.yyy.zzz.com/demo.py
I get the following error message:

Mod_python error: "PythonHandler test"

Traceback (innermost last):

  File
"/usr/local/lib/python1.5/site-packages/mod_python/apache.py",
line 116, in Dispatch
    object = self.resolve_object(module, object_str)

  File
"/usr/local/lib/python1.5/site-packages/mod_python/apache.py",
line 51, in resolve_object
    raise AttributeError, s

AttributeError: module
'/usr/local/lib/python1.5/test/__init__.pyc' contains
no 'handler'


What am I missing ?


Thanks,

-- Niranjan






__________________________________________________
Do You Yahoo!?
Send instant messages & get email alerts with Yahoo! Messenger.
http://im.yahoo.com/

From michael at stroeder.com  Fri Aug 18 18:04:51 2000
From: michael at stroeder.com (Michael =?iso-8859-1?Q?Str=F6der?=)
Date: Fri Jan  9 21:52:05 2004
Subject: [mod_python] Swig, and mod_ssl
References: <Pine.LNX.4.21.0008180839400.15289-100000@saturn.ispol.com> <399D3B4A.7C5772BB@caveosystems.com>
Message-ID: <399D5EA3.7975AAEC@stroeder.com>

Rich Salz wrote:
> 
> > BTW, one way to get DN is "SSLOptions +FakeBasicAuth", then the DN 
> > should appear in req.connection.user.
> 
> Right.  But I need more than that.  I need to know *if* there's a client
> cert, all the nitty-gritty details of it (e.g., what the keyUsage
> extension is), I need to do my own verification, no CRL processing, my
> own chain verification, etc.  Lots of stuff.

I'm not sure I fully understand the problem but if you set

  SSLOptions +ExportCertData

you will get the client and server certs "PEM"-formatted exported to
the OS environment in variables SSL_CLIENT_CERT and SSL_SERVER_CERT.

Ciao, Michael.

From wmedia at hotmail.com  Fri Aug 18 12:22:02 2000
From: wmedia at hotmail.com (William Smith)
Date: Fri Jan  9 21:52:05 2004
Subject: [mod_python] Problems with mod_python
Message-ID: <F2176fQSgeR4UIS42NX000009c4@hotmail.com>

I am using RedHat 6.2 x86, Apache 1.3.12 and mod_python 2.4.1.
I compiled and installed mod_python with apxs.
Apache runs as user nobody and group nobody

I read the modpython archives and have the following server errors
which I saw mentioned in the archive message Aug 2, 2000 by
Boh Heong Yap (bohheong@asiacontent.com):

   make_obcallback(): could not import mod_python.apache.
    make_obcallback(): could not call init.

I tried in httpd.conf both:

<Directory /usr/apache/python>
        AddHandler python-program .py
        PythonHandler test
        PythonDebug On
</Directory>

and

<Directory /usr/apache/python>
    AddHandler python-program .py
    PythonHandler test
    PythonDebug On
</Directory>

which I also saw in the archives as a fix.  However this did not work.

The directories and files in
/usr/lib/python1.5/site-packages/mod_python are world readable but
owned by root.

Using the comand line I get:

File "/usr/lib/python1.5/site-packages/mod_python/apache.py", line
18, in ?
    import _apache
ImportError: No module named _apache

when I try "from mod_python import apache".

Any help getting this to work would be appreciated.
________________________________________________________________________
Get Your Private, Free E-mail from MSN Hotmail at http://www.hotmail.com


From rsalz at caveosystems.com  Fri Aug 18 12:29:42 2000
From: rsalz at caveosystems.com (Rich Salz)
Date: Fri Jan  9 21:52:05 2004
Subject: [mod_python] Swig, and mod_ssl
References: <Pine.LNX.4.21.0008180839400.15289-100000@saturn.ispol.com> <399D3B4A.7C5772BB@caveosystems.com> <399D5EA3.7975AAEC@stroeder.com>
Message-ID: <399D6476.62BE89E7@caveosystems.com>

>   SSLOptions +ExportCertData

Yes, thanks.  I need more than that.  I need just about full
programmatic control over SSL within my python module.

From grisha at ispol.com  Fri Aug 18 12:30:04 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:52:05 2004
Subject: [mod_python] Swig, and mod_ssl
In-Reply-To: <399D5EA3.7975AAEC@stroeder.com>
Message-ID: <Pine.LNX.4.21.0008181228110.18108-100000@saturn.ispol.com>


If that is correct - then all that stuff should show up in 

req.subprocess_env["SSL_CLIENT_CERT"] and ["SSL_SERVER_CERT"]

:-)

Rich - could you verify this?

Grisha

On Fri, 18 Aug 2000, Michael Str?der wrote:

> I'm not sure I fully understand the problem but if you set
> 
>   SSLOptions +ExportCertData
> 
> you will get the client and server certs "PEM"-formatted exported to
> the OS environment in variables SSL_CLIENT_CERT and SSL_SERVER_CERT.



From grisha at ispol.com  Fri Aug 18 12:38:23 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:52:05 2004
Subject: [mod_python] Problems with mod_python
In-Reply-To: <F2176fQSgeR4UIS42NX000009c4@hotmail.com>
Message-ID: <Pine.LNX.4.21.0008181237490.18108-100000@saturn.ispol.com>

the only thing I can think of is that the direcories where mod_python is
should also be world executable...

Grisha

On Fri, 18 Aug 2000, William Smith wrote:

> I am using RedHat 6.2 x86, Apache 1.3.12 and mod_python 2.4.1.
> I compiled and installed mod_python with apxs.
> Apache runs as user nobody and group nobody
> 
> I read the modpython archives and have the following server errors
> which I saw mentioned in the archive message Aug 2, 2000 by
> Boh Heong Yap (bohheong@asiacontent.com):
> 
>    make_obcallback(): could not import mod_python.apache.
>     make_obcallback(): could not call init.
> 
> I tried in httpd.conf both:
> 
> <Directory /usr/apache/python>
>         AddHandler python-program .py
>         PythonHandler test
>         PythonDebug On
> </Directory>
> 
> and
> 
> <Directory /usr/apache/python>
>     AddHandler python-program .py
>     PythonHandler test
>     PythonDebug On
> </Directory>
> 
> which I also saw in the archives as a fix.  However this did not work.
> 
> The directories and files in
> /usr/lib/python1.5/site-packages/mod_python are world readable but
> owned by root.
> 
> Using the comand line I get:
> 
> File "/usr/lib/python1.5/site-packages/mod_python/apache.py", line
> 18, in ?
>     import _apache
> ImportError: No module named _apache
> 
> when I try "from mod_python import apache".
> 
> Any help getting this to work would be appreciated.
> ________________________________________________________________________
> Get Your Private, Free E-mail from MSN Hotmail at http://www.hotmail.com
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 


From rsalz at caveosystems.com  Fri Aug 18 12:46:12 2000
From: rsalz at caveosystems.com (Rich Salz)
Date: Fri Jan  9 21:52:05 2004
Subject: [mod_python] Swig, and mod_ssl
References: <Pine.LNX.4.21.0008181228110.18108-100000@saturn.ispol.com>
Message-ID: <399D6854.B5B21303@caveosystems.com>

> >   SSLOptions +ExportCertData
> req.subprocess_env["SSL_CLIENT_CERT"] and ["SSL_SERVER_CERT"]
> Rich - could you verify this?

sure, yup, works fine.  The PEM-encoded server cert (and the client one,
if presented) is ther.  That's not enough for my app, but maybe that's
enough for everyone else, and my little hack isn't needed.
	/r$

From michael at stroeder.com  Fri Aug 18 19:10:49 2000
From: michael at stroeder.com (Michael =?iso-8859-1?Q?Str=F6der?=)
Date: Fri Jan  9 21:52:05 2004
Subject: [mod_python] Swig, and mod_ssl
References: <Pine.LNX.4.21.0008180839400.15289-100000@saturn.ispol.com> <399D3B4A.7C5772BB@caveosystems.com> <399D5EA3.7975AAEC@stroeder.com> <399D6476.62BE89E7@caveosystems.com>
Message-ID: <399D6E19.2B7BA55E@stroeder.com>

Rich Salz wrote:
> 
> >   SSLOptions +ExportCertData
> 
> Yes, thanks.  I need more than that.  I need just about full
> programmatic control over SSL within my python module.

You want to have your own Python written verify callback before
mod_ssl accepts the cert as being valid?

Ciao, Michael.

From grisha at ispol.com  Fri Aug 18 16:50:49 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:52:05 2004
Subject: [mod_python] How to define an environment variable for other
 python module to use?
In-Reply-To: <39974AD9.2C33FAE1@ust.hk>
Message-ID: <Pine.LNX.4.21.0008181646320.18916-100000@saturn.ispol.com>

Sorry for a late answer - 

If you are using strictly mod_python (without cgihandler), then the
standard apache SetEnv or PassEnv directives should work.

If you're using cgihandler, and if the python-oracle interface module is
written in C, then most likely it uses the actual process environment. In
this case you will have to use os.putenv() function prior to using the
oracle interface. Otherwise, simply assigning something to os.environ
should do it.

Does this answer your question?

--
  Gregory (Grisha) Trubetskoy
       grisha@ispol.com

On Mon, 14 Aug 2000, David YEUNG wrote:

> I have other python modules which usually need to read some environment
> variables, e.g., an python-oracle interface module needs to read the "ORACLE_SID"
> to know where the database to connect. I used to defining this variable in the "shell"
> before invoking a python CGI program, e.g.:
> 
>    #!/bin/sh
>    export ORACLE_SID=orcl
>    exec /some/oracle/python/interface.cgi
> 
> I would like to try the mod_python using the default CGI handler, but does someone
> know how to define some environment variable in mod_python?
> 
> Thanks
> 
> david
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 


From dyeung at ust.hk  Sat Aug 19 08:15:27 2000
From: dyeung at ust.hk (David Yeung)
Date: Fri Jan  9 21:52:05 2004
Subject: [mod_python] How to define an environment variable for otherpython 
 module to use?
References: <Pine.LNX.4.21.0008181646320.18916-100000@saturn.ispol.com>
Message-ID: <399DD19F.F4CC2B0E@ust.hk>

Gregory

According to the Python document, if os.putvar is used to change the
environment, such changes only affect subprocesses started with
os.system(), popen(), fork() and execv(), so it is probably not
able to solve the problem.

Thanks

david


Gregory Trubetskoy wrote:
> 
> Sorry for a late answer -
> 
> If you are using strictly mod_python (without cgihandler), then the
> standard apache SetEnv or PassEnv directives should work.
> 
> If you're using cgihandler, and if the python-oracle interface module is
> written in C, then most likely it uses the actual process environment. In
> this case you will have to use os.putenv() function prior to using the
> oracle interface. Otherwise, simply assigning something to os.environ
> should do it.
> 
> Does this answer your question?
> 
> --
>   Gregory (Grisha) Trubetskoy
>        grisha@ispol.com
> 
> On Mon, 14 Aug 2000, David YEUNG wrote:
> 
> > I have other python modules which usually need to read some environment
> > variables, e.g., an python-oracle interface module needs to read the "ORACLE_SID"
> > to know where the database to connect. I used to defining this variable in the "shell"
> > before invoking a python CGI program, e.g.:
> >
> >    #!/bin/sh
> >    export ORACLE_SID=orcl
> >    exec /some/oracle/python/interface.cgi
> >
> > I would like to try the mod_python using the default CGI handler, but does someone
> > know how to define some environment variable in mod_python?
> >
> > Thanks
> >
> > david
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://www.modpython.org/mailman/listinfo/mod_python
> >

From lahondes at pasteur.fr  Mon Aug 21 10:22:11 2000
From: lahondes at pasteur.fr (Raynald de Lahondes)
Date: Fri Jan  9 21:52:05 2004
Subject: [mod_python] Problems with mod_python
In-Reply-To: <F2176fQSgeR4UIS42NX000009c4@hotmail.com>; from wmedia@hotmail.com on Fri, Aug 18, 2000 at 12:22:02PM -0400
References: <F2176fQSgeR4UIS42NX000009c4@hotmail.com>
Message-ID: <20000821102211.A19171@pombe.vironc.pasteur.fr>

On Fri, Aug 18, 2000 at 12:22:02PM -0400, William Smith wrote:
> I am using RedHat 6.2 x86, Apache 1.3.12 and mod_python 2.4.1.
> I compiled and installed mod_python with apxs.
> Apache runs as user nobody and group nobody
>
> I read the modpython archives and have the following server errors
> which I saw mentioned in the archive message Aug 2, 2000 by
> Boh Heong Yap (bohheong@asiacontent.com):
>
>    make_obcallback(): could not import mod_python.apache.
>     make_obcallback(): could not call init.

Are you sure you installed the libs properly ? (I think I had those errors
when libs where not OK). When the python libs were installed (Ist part of
Install) recompiling whith apxs and re-installing the mod_python.so solved
the pb.

> Using the comand line I get:
> 
> File "/usr/lib/python1.5/site-packages/mod_python/apache.py", line
> 18, in ?
>     import _apache
> ImportError: No module named _apache
> 
> when I try "from mod_python import apache".
> 

I am not familiar neither with external extension of python nor apache but I
understand that "import _apache" only works within apache module, because
it's a call to mod_python.so code. Anyway my mod-python works and "import
_apache" still does not work...

I hope you find this usefull.

Raynald de Lahond?s
lahondes@pasteur.fr


From grisha at ispol.com  Mon Aug 21 16:54:29 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:52:05 2004
Subject: [mod_python] How to define an environment variable for otherpython
  module to use?
In-Reply-To: <399DD19F.F4CC2B0E@ust.hk>
Message-ID: <Pine.LNX.4.21.0008211652540.7663-100000@saturn.ispol.com>

David - 

I just looked at the docs, and I didn't see the word "only" mentioned
anywhere.

Grisha


On Sat, 19 Aug 2000, David Yeung wrote:

> Gregory
> 
> According to the Python document, if os.putvar is used to change the
> environment, such changes only affect subprocesses started with
> os.system(), popen(), fork() and execv(), so it is probably not
> able to solve the problem.
> 
> Thanks
> 
> david
> 
> 
> Gregory Trubetskoy wrote:
> > 
> > Sorry for a late answer -
> > 
> > If you are using strictly mod_python (without cgihandler), then the
> > standard apache SetEnv or PassEnv directives should work.
> > 
> > If you're using cgihandler, and if the python-oracle interface module is
> > written in C, then most likely it uses the actual process environment. In
> > this case you will have to use os.putenv() function prior to using the
> > oracle interface. Otherwise, simply assigning something to os.environ
> > should do it.
> > 
> > Does this answer your question?
> > 
> > --
> >   Gregory (Grisha) Trubetskoy
> >        grisha@ispol.com
> > 
> > On Mon, 14 Aug 2000, David YEUNG wrote:
> > 
> > > I have other python modules which usually need to read some environment
> > > variables, e.g., an python-oracle interface module needs to read the "ORACLE_SID"
> > > to know where the database to connect. I used to defining this variable in the "shell"
> > > before invoking a python CGI program, e.g.:
> > >
> > >    #!/bin/sh
> > >    export ORACLE_SID=orcl
> > >    exec /some/oracle/python/interface.cgi
> > >
> > > I would like to try the mod_python using the default CGI handler, but does someone
> > > know how to define some environment variable in mod_python?
> > >
> > > Thanks
> > >
> > > david
> > > _______________________________________________
> > > Mod_python mailing list
> > > Mod_python@modpython.org
> > > http://www.modpython.org/mailman/listinfo/mod_python
> > >
> 


From bryan at optimumnetwork.com  Tue Aug 22 12:00:04 2000
From: bryan at optimumnetwork.com (Bryan O'Shea)
Date: Fri Jan  9 21:52:05 2004
Subject: [mod_python] Build errors with php-4.0.1pl2
Message-ID: <39A224F4.14224BCE@optimumnetwork.com>

i am having troubles building with php-4.0.1pl2 and mod_python-2.4.1
i compiled installed php then followed installs instructions for
mod_python then went to build apache with

./configure --prefix=/home/apache
--activate-module=src/modules/extra/mod_python.c \
--activate-module=src/modules/php4/libphp4.a

if i build with one or the other the build turns out ok. when i
build both modules together it flops


any help would be apreciated
thanks

************************************************************************************************

<=== src/modules/standard
===> src/modules/extra
gcc -c -I/usr/local/include/python1.5 -I../../os/unix -I../../include
-DLINUX=2 -I/home/bryan/src/php-4.0.1pl2
-I/home/bryan/src/php-4.0.1pl2/main -I/home/bryan/src/php-4.0.1pl2/main
-I/home/bryan/src/php-4.0.1pl2/Zend -I/home/bryan/src/php-4.0.1pl2/Zend
-I/home/bryan/src/php-4.0.1pl2 -DUSE_EXPAT -I../../lib/expat-lite
-DNO_DL_NEEDED `../../apaci` mod_python.c
rm -f libextra.a
ar cr libextra.a mod_python.o
ranlib libextra.a
<=== src/modules/extra
===> src/modules/php4
gcc -c -I/usr/local/include/python1.5 -I../../os/unix -I../../include
-DLINUX=2 -I/home/bryan/src/php-4.0.1pl2
-I/home/bryan/src/php-4.0.1pl2/main -I/home/bryan/src/php-4.0.1pl2/main
-I/home/bryan/src/php-4.0.1pl2/Zend -I/home/bryan/src/php-4.0.1pl2/Zend
-I/home/bryan/src/php-4.0.1pl2 -DUSE_EXPAT -I../../lib/expat-lite
-DNO_DL_NEEDED `../../apaci`  mod_php4.c
cp libmodphp4.a libphp4.a
ar r libphp4.a mod_php4.o
ranlib libphp4.a
<=== src/modules/php4
<=== src/modules
gcc -c -I/usr/local/include/python1.5 -I./os/unix -I./include
-DLINUX=2 -I/home/bryan/src/php-4.0.1pl2
-I/home/bryan/src/php-4.0.1pl2/main -I/home/bryan/src/php-4.0.1pl2/main
-I/home/bryan/src/php-4.0.1pl2/Zend -I/home/bryan/src/php-4.0.1pl2/Zend
-I/home/bryan/src/php-4.0.1pl2 -DUSE_EXPAT -I./lib/expat-lite
-DNO_DL_NEEDED `./apaci` modules.c
gcc -c -I/usr/local/include/python1.5 -I./os/unix -I./include
-DLINUX=2 -I/home/bryan/src/php-4.0.1pl2
-I/home/bryan/src/php-4.0.1pl2/main -I/home/bryan/src/php-4.0.1pl2/main
-I/home/bryan/src/php-4.0.1pl2/Zend -I/home/bryan/src/php-4.0.1pl2/Zend
-I/home/bryan/src/php-4.0.1pl2 -DUSE_EXPAT -I./lib/expat-lite
-DNO_DL_NEEDED `./apaci` buildmark.c
gcc  -DLINUX=2 -I/home/bryan/src/php-4.0.1pl2
-I/home/bryan/src/php-4.0.1pl2/main -I/home/bryan/src/php-4.0.1pl2/main
-I/home/bryan/src/php-4.0.1pl2/Zend -I/home/bryan/src/php-4.0.1pl2/Zend
-I/home/bryan/src/php-4.0.1pl2 -DUSE_EXPAT -I./lib/expat-lite
-DNO_DL_NEEDED `./apaci` -Xlinker -export-dynamic       \
      -o httpd buildmark.o modules.o modules/standard/libstandard.a
modules/extra/libextra.a modules/php4/libphp4.a main/libmain.a
./os/unix/libos.a ap/libap.a  lib/expat-lite/libexpat.a
-Wl,-rpath,/usr/local/mysql/lib/mysql -Wl,-rpath,/usr/local/pgsql/lib
-rdynamic -L/usr/local/mysql/lib/mysql -L/usr/local/pgsql/lib
-Lmodules/php4 -L../modules/php4 -L../../modules/php4 -lmodphp4  -lgdbm
-lpam  -ldl -lpq -lmysqlclient -lresolv -lm -ldl -lcrypt -lnsl
-lresolv  -lm -lcrypt /usr/local/lib/python1.5/config/libpython1.5.a
-lieee -lnet -ldl  -lpthread   -lm
/usr/local/lib/python1.5/config/libpython1.5.a(pypcre.o): In function
`pcre_study':
/home/bryan/src/Python-1.5.2/Modules/./pypcre.c:501: multiple definition

of `pcre_malloc'
modules/php4/libphp4.a(pcre.o):/home/bryan/src/php-4.0.1pl2/ext/pcre/pcrelib/pcre.c:238:

first defined here
/usr/local/lib/python1.5/config/libpython1.5.a(pypcre.o): In function
`pcre_study':
/home/bryan/src/Python-1.5.2/Modules/./pypcre.c:501: multiple definition

of `pcre_free'
modules/php4/libphp4.a(pcre.o):/home/bryan/src/php-4.0.1pl2/ext/pcre/pcrelib/pcre.c:238:

first defined here
collect2: ld returned 1 exit status
make[2]: *** [target_static] Error 1
make[2]: Leaving directory `/home/bryan/src/apache_1.3.12/src'
make[1]: *** [build-std] Error 2
make[1]: Leaving directory `/home/bryan/src/apache_1.3.12'
make: *** [build] Error 2




From chris at zeus.foote.com.au  Wed Aug 23 14:12:05 2000
From: chris at zeus.foote.com.au (Chris Foote)
Date: Fri Jan  9 21:52:05 2004
Subject: [mod_python] interoperability with cgi module
Message-ID: <Pine.BSF.4.20.0008231317520.26683-100000@localhost>

Is there any way of getting the CGI environment from mod_python
(i.e. via req.add_common_vars()) usable by the Python libraries
standard cgi module ?

e.g. something like the following (html form POST's to this script):

import os
import cgi
from mod_python import apache

def handler(req):
	req.content_type  = "text/plain"
	req.send_http_header()
	
	req.add_common_vars()
	
	# add req's CGI vars into the environment
	for k in req.subprocess_env.keys():
		os.environ[k] = req.subprocess_env[k]

	form = cgi.FieldStorage()
	cgi.parse_header(str(req.headers_in))

	len = int(req.headers_in["content-length"])
	form_data = req.read(len)
	cgi.parse_qs(form_data)

	cgi.test()
	if form.has_key("field"):
		req.write('field = ' + form["field"].value + '\n')

	return apache.OK

however, the cgi module doesn't display anything for cgi.test()
and form['field'] doesn't exist.

I'm new to Python, and especially mod_pythod - am I going about
this in the wrong way ?  i.e. should I be bothering with the cgi
module at all ?



Cheers,

Chris Foote                        chris@zeus.foote.com.au


From R.Barrett at ftel.co.uk  Wed Aug 23 11:30:18 2000
From: R.Barrett at ftel.co.uk (Richard Barrett)
Date: Fri Jan  9 21:52:05 2004
Subject: [mod_python] extended access to conn_rec
Message-ID: <v04220803b5c94cb54996@[172.16.3.104]>

I've started working with mod_python-2.4.1; good stuff.

I wanted to access the local_addr and remote_addr fields of the 
conn_rec struct but access to the fields is not supported via the 
connection object by mod_python.so

Accordingly I've added some code to mod_python.c to return the 
contents of these fields. The code is a minor variation of functions 
'borrowed' from socketmodule.c in the standard Python 1.5.2 
distribution. The python object returned is the same as that returned 
by the getpeername and getsockname member functions on standard 
socket objects. I would have called functions makeipaddr  and 
makesockaddr in socketmodule.so instead of adding copies to 
mod_python but they are declared as static in socketmodule.c and 
hence are unavailable.

If there is a better way of doing this or anything I've said above is 
rubbish I would appreciate some (polite) feedback. I don't claim any 
particular expertise with C or python extensions so some reader may 
find fault with this stuff. But it works for me so far.

The diff for my changes to mod_python.c follow:
-----------------------------------------------------


91a92,94
>  /* Other headers */
>  #include <sys/socket.h>
>
928a932,954
>  static PyObject *
>  mymakeipaddr(struct sockaddr_in *addr)
>  {
>      long x = ntohl(addr->sin_addr.s_addr);
>      char buf[100];
>      sprintf(buf, "%d.%d.%d.%d",
>          (int) (x>>24) & 0xff, (int) (x>>16) & 0xff,
>          (int) (x>> 8) & 0xff, (int) (x>> 0) & 0xff);
>      return PyString_FromString(buf);
>  }
>
>  static PyObject *
>  mymakesockaddr(struct sockaddr_in *addr)
>  {
>      PyObject *addrobj = mymakeipaddr(addr);
>      PyObject *ret = NULL;
>      if (addrobj) {
>          ret = Py_BuildValue("Oi", addrobj, ntohs(addr->sin_port));
>          Py_DECREF(addrobj);
>      }
>      return ret;
>  }
>
968a995,1000
>      else if (strcmp(name, "local_addr") == 0) {
>  		return mymakesockaddr(&(self->conn->local_addr));
>  	}
>      else if (strcmp(name, "remote_addr") == 0) {
>  		return mymakesockaddr(&(self->conn->remote_addr));
>  	}
------------------------------------------------------------------
Richard Barrett, PostPoint 27,         e-mail:r.barrett@ftel.co.uk
Fujitsu Telecommunications Europe Ltd,      tel: (44) 121 717 6337
Solihull Parkway, Birmingham Business Park, B37 7YU, England
"Democracy is two wolves and a lamb voting on what to have for
lunch. Liberty is a well armed lamb contesting the vote."
Benjamin Franklin, 1759
------------------------------------------------------------------

From grisha at ispol.com  Wed Aug 23 09:22:50 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:52:05 2004
Subject: [mod_python] interoperability with cgi module
In-Reply-To: <Pine.BSF.4.20.0008231317520.26683-100000@localhost>
Message-ID: <Pine.LNX.4.21.0008230920200.14880-100000@saturn.ispol.com>

Look at how it's done in the cgihandler:
http://www.modpython.org/live/mod_python-2.4.1/lib/python/mod_python/cgihandler.py

apache.setup_cgi() is what you need.

as a shortcut, I think 

os.env = req.subprocess_env 

might just do the trick.

Grisha

--
  Gregory (Grisha) Trubetskoy
       grisha@ispol.com

On Wed, 23 Aug 2000, Chris Foote wrote:

> Is there any way of getting the CGI environment from mod_python
> (i.e. via req.add_common_vars()) usable by the Python libraries
> standard cgi module ?
> 
> e.g. something like the following (html form POST's to this script):
> 
> import os
> import cgi
> from mod_python import apache
> 
> def handler(req):
> 	req.content_type  = "text/plain"
> 	req.send_http_header()
> 	
> 	req.add_common_vars()
> 	
> 	# add req's CGI vars into the environment
> 	for k in req.subprocess_env.keys():
> 		os.environ[k] = req.subprocess_env[k]
> 
> 	form = cgi.FieldStorage()
> 	cgi.parse_header(str(req.headers_in))
> 
> 	len = int(req.headers_in["content-length"])
> 	form_data = req.read(len)
> 	cgi.parse_qs(form_data)
> 
> 	cgi.test()
> 	if form.has_key("field"):
> 		req.write('field = ' + form["field"].value + '\n')
> 
> 	return apache.OK
> 
> however, the cgi module doesn't display anything for cgi.test()
> and form['field'] doesn't exist.
> 
> I'm new to Python, and especially mod_pythod - am I going about
> this in the wrong way ?  i.e. should I be bothering with the cgi
> module at all ?
> 
> 
> 
> Cheers,
> 
> Chris Foote                        chris@zeus.foote.com.au
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 


From miguel at yorku.ca  Wed Aug 23 09:35:34 2000
From: miguel at yorku.ca (Miguel Marques)
Date: Fri Jan  9 21:52:05 2004
Subject: [mod_python] interoperability with cgi module
In-Reply-To: <Pine.BSF.4.20.0008231317520.26683-100000@localhost>
References: <Pine.BSF.4.20.0008231317520.26683-100000@localhost>
Message-ID: <20000823093534X.miguel@yorku.ca>

On Wed, 23 Aug 2000 14:12:05 +0930 (CST), Chris Foote <chris@zeus.foote.com.au> wrote:
> Is there any way of getting the CGI environment from mod_python
> (i.e. via req.add_common_vars()) usable by the Python libraries
> standard cgi module ?
> 
> e.g. something like the following (html form POST's to this script):
> 
> import os
> import cgi
> from mod_python import apache
> 
> def handler(req):
> 	req.content_type  = "text/plain"
> 	req.send_http_header()
> 	
> 	req.add_common_vars()
> 	
> 	# add req's CGI vars into the environment
> 	for k in req.subprocess_env.keys():
> 		os.environ[k] = req.subprocess_env[k]
> 
> 	form = cgi.FieldStorage()
> 	cgi.parse_header(str(req.headers_in))
> 
> 	len = int(req.headers_in["content-length"])
> 	form_data = req.read(len)
> 	cgi.parse_qs(form_data)
> 
> 	cgi.test()
> 	if form.has_key("field"):
> 		req.write('field = ' + form["field"].value + '\n')
> 
> 	return apache.OK
> 
> however, the cgi module doesn't display anything for cgi.test()
> and form['field'] doesn't exist.
Above try
    form = cgi.parse_qs(form_data)
to get the POST data.  cgi.parse_qs returns a dictionary with the
data.


						Miguel

C. Miguel Marques, York University, Computing & Communications Services
e-mail: miguel@yorku.ca, voice: (416)736-2100x22684, fax: (416)736-5830


From hdstich at commplex-media.de  Thu Aug 24 09:24:08 2000
From: hdstich at commplex-media.de (Hans-Dieter Stich)
Date: Fri Jan  9 21:52:05 2004
Subject: [mod_python] re.compile problem
Message-ID: <XFMail.000824092408.hdstich@commplex-media.de>

i have seen messages on the mailing list about problems with the compiling of
regular expressons! are there any new hints?

my mod_python is build also dynamically into the apache!

thanx!

ciao
h-d

____________________________________________________________________

  Commplex Media AG             Hans-Dieter Stich/CTO
  Office Ulm                    fon:  +49-7304-434997
  Development Team              fax:  +49-7304-434998
  Spatzenweg 12                 mail: hdstich@commplex-media.de
  89160 Dornstadt               web:  http://www.commplex-media.de/
____________________________________________________________________


From walaces at prasair.com.br  Mon Aug 28 12:23:24 2000
From: walaces at prasair.com.br (Walace Soares)
Date: Fri Jan  9 21:52:05 2004
Subject: [mod_python] Apache Problems
Message-ID: <E13FB1366C26D411BDD9000102240287046FC2@SERVIDOR>

Hi,

I have the mod_python instaled within Apache in a Linux slackware box.
Python is working fine.
But when I am trying to run mod_python, apache show me the message:

Mod_python error: "PythonHandler pytest.py"
Traceback (innermost last): File
"/usr/lib/python1.5/site-packages/mod_python/apache.py", line 113, in
Dispatch module = import_module(module_name, req)
File "/usr/lib/python1.5/site-packages/mod_python/apache.py", line 246, in
import_module module = __import__(module_name)
File "/usr/lib/python1.5/pytest.py", line 3
req.send_httpd header()
		^
SyntaxError: invalid syntax


Could Anyone please help me ?


Walace

My configuration:
Slacware 7.0
Apache 1.3.12
Python 1.5.2
mod_python 2.4.1





From miguel at yorku.ca  Mon Aug 28 11:49:05 2000
From: miguel at yorku.ca (Miguel Marques)
Date: Fri Jan  9 21:52:05 2004
Subject: [mod_python] Apache Problems
In-Reply-To: <E13FB1366C26D411BDD9000102240287046FC2@SERVIDOR>
References: <E13FB1366C26D411BDD9000102240287046FC2@SERVIDOR>
Message-ID: <20000828114905P.miguel@yorku.ca>

On Mon, 28 Aug 2000 12:23:24 -0300, "Walace Soares" <walaces@prasair.com.br> wrote:
> Hi,
> 
> I have the mod_python instaled within Apache in a Linux slackware box.
> Python is working fine.
> But when I am trying to run mod_python, apache show me the message:
> 
> Mod_python error: "PythonHandler pytest.py"
> Traceback (innermost last): File
> "/usr/lib/python1.5/site-packages/mod_python/apache.py", line 113, in
> Dispatch module = import_module(module_name, req)
> File "/usr/lib/python1.5/site-packages/mod_python/apache.py", line 246, in
> import_module module = __import__(module_name)
> File "/usr/lib/python1.5/pytest.py", line 3
> req.send_httpd header()
> 		^
> SyntaxError: invalid syntax
I think that should be:
req.send_http_header()

							Miguel

C. Miguel Marques, York University, Computing & Communications Services
e-mail: miguel@yorku.ca, voice: (416)736-2100x22684, fax: (416)736-5830

From bryan at optimumnetwork.com  Tue Aug 29 14:14:54 2000
From: bryan at optimumnetwork.com (Bryan O'Shea)
Date: Fri Jan  9 21:52:05 2004
Subject: [mod_python] test
Message-ID: <39AB7F0E.6219DB78@optimumnetwork.com>

does the list work ??


From bryan at optimumnetwork.com  Tue Aug 29 14:48:53 2000
From: bryan at optimumnetwork.com (Bryan O'Shea)
Date: Fri Jan  9 21:52:05 2004
Subject: [mod_python] php and mod_python compile problems with apache
Message-ID: <39AB8705.D8532012@optimumnetwork.com>

i am having troubles building with php-4.0.1pl2 and mod_python-2.4.1
i compiled installed php then followed installs instructions for
mod_python then went to build apache with

./configure --prefix=/home/apache
--activate-module=src/modules/extra/mod_python.c \
--activate-module=src/modules/php4/libphp4.a

if i build with one or the other the build turns out ok. when i
build both modules together it flops


any help would be apreciated
thanks

************************************************************************************************

<=== src/modules/standard
===> src/modules/extra
gcc -c -I/usr/local/include/python1.5 -I../../os/unix -I../../include
-DLINUX=2 -I/home/bryan/src/php-4.0.1pl2
-I/home/bryan/src/php-4.0.1pl2/main -I/home/bryan/src/php-4.0.1pl2/main
-I/home/bryan/src/php-4.0.1pl2/Zend -I/home/bryan/src/php-4.0.1pl2/Zend
-I/home/bryan/src/php-4.0.1pl2 -DUSE_EXPAT -I../../lib/expat-lite
-DNO_DL_NEEDED `../../apaci` mod_python.c
rm -f libextra.a
ar cr libextra.a mod_python.o
ranlib libextra.a
<=== src/modules/extra
===> src/modules/php4
gcc -c -I/usr/local/include/python1.5 -I../../os/unix -I../../include
-DLINUX=2 -I/home/bryan/src/php-4.0.1pl2
-I/home/bryan/src/php-4.0.1pl2/main -I/home/bryan/src/php-4.0.1pl2/main
-I/home/bryan/src/php-4.0.1pl2/Zend -I/home/bryan/src/php-4.0.1pl2/Zend
-I/home/bryan/src/php-4.0.1pl2 -DUSE_EXPAT -I../../lib/expat-lite
-DNO_DL_NEEDED `../../apaci`  mod_php4.c
cp libmodphp4.a libphp4.a
ar r libphp4.a mod_php4.o
ranlib libphp4.a
<=== src/modules/php4
<=== src/modules
gcc -c -I/usr/local/include/python1.5 -I./os/unix -I./include
-DLINUX=2 -I/home/bryan/src/php-4.0.1pl2
-I/home/bryan/src/php-4.0.1pl2/main -I/home/bryan/src/php-4.0.1pl2/main
-I/home/bryan/src/php-4.0.1pl2/Zend -I/home/bryan/src/php-4.0.1pl2/Zend
-I/home/bryan/src/php-4.0.1pl2 -DUSE_EXPAT -I./lib/expat-lite
-DNO_DL_NEEDED `./apaci` modules.c
gcc -c -I/usr/local/include/python1.5 -I./os/unix -I./include
-DLINUX=2 -I/home/bryan/src/php-4.0.1pl2
-I/home/bryan/src/php-4.0.1pl2/main -I/home/bryan/src/php-4.0.1pl2/main
-I/home/bryan/src/php-4.0.1pl2/Zend -I/home/bryan/src/php-4.0.1pl2/Zend
-I/home/bryan/src/php-4.0.1pl2 -DUSE_EXPAT -I./lib/expat-lite
-DNO_DL_NEEDED `./apaci` buildmark.c
gcc  -DLINUX=2 -I/home/bryan/src/php-4.0.1pl2
-I/home/bryan/src/php-4.0.1pl2/main -I/home/bryan/src/php-4.0.1pl2/main
-I/home/bryan/src/php-4.0.1pl2/Zend -I/home/bryan/src/php-4.0.1pl2/Zend
-I/home/bryan/src/php-4.0.1pl2 -DUSE_EXPAT -I./lib/expat-lite
-DNO_DL_NEEDED `./apaci` -Xlinker -export-dynamic       \
      -o httpd buildmark.o modules.o modules/standard/libstandard.a
modules/extra/libextra.a modules/php4/libphp4.a main/libmain.a
./os/unix/libos.a ap/libap.a  lib/expat-lite/libexpat.a
-Wl,-rpath,/usr/local/mysql/lib/mysql -Wl,-rpath,/usr/local/pgsql/lib
-rdynamic -L/usr/local/mysql/lib/mysql -L/usr/local/pgsql/lib
-Lmodules/php4 -L../modules/php4 -L../../modules/php4 -lmodphp4  -lgdbm
-lpam  -ldl -lpq -lmysqlclient -lresolv -lm -ldl -lcrypt -lnsl
-lresolv  -lm -lcrypt /usr/local/lib/python1.5/config/libpython1.5.a
-lieee -lnet -ldl  -lpthread   -lm
/usr/local/lib/python1.5/config/libpython1.5.a(pypcre.o): In function
`pcre_study':
/home/bryan/src/Python-1.5.2/Modules/./pypcre.c:501: multiple definition

of `pcre_malloc'
modules/php4/libphp4.a(pcre.o):/home/bryan/src/php-4.0.1pl2/ext/pcre/pcrelib/pcre.c:238:

first defined here
/usr/local/lib/python1.5/config/libpython1.5.a(pypcre.o): In function
`pcre_study':
/home/bryan/src/Python-1.5.2/Modules/./pypcre.c:501: multiple definition

of `pcre_free'
modules/php4/libphp4.a(pcre.o):/home/bryan/src/php-4.0.1pl2/ext/pcre/pcrelib/pcre.c:238:

first defined here
collect2: ld returned 1 exit status
make[2]: *** [target_static] Error 1
make[2]: Leaving directory `/home/bryan/src/apache_1.3.12/src'
make[1]: *** [build-std] Error 2
make[1]: Leaving directory `/home/bryan/src/apache_1.3.12'
make: *** [build] Error 2






From grisha at ispol.com  Tue Aug 29 15:39:07 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:52:05 2004
Subject: [mod_python] php and mod_python compile problems with apache
In-Reply-To: <39AB8705.D8532012@optimumnetwork.com>
Message-ID: <Pine.LNX.4.21.0008291537030.15779-100000@saturn.ispol.com>

I know this has something to do with the pcre (regular
expression) library. I think both PHP and Python have to be linked against
the same version or else it won't work. I saw something about this come
across the apache list - apache 2.0 uses pcre as well and that causes some
problems for Python.

Perhaps someone more knowledgeable on the subject can enlighten us?

--
  Gregory (Grisha) Trubetskoy
       grisha@ispol.com

On Tue, 29 Aug 2000, Bryan O'Shea wrote:

> i am having troubles building with php-4.0.1pl2 and mod_python-2.4.1
> i compiled installed php then followed installs instructions for
> mod_python then went to build apache with
> 
> ./configure --prefix=/home/apache
> --activate-module=src/modules/extra/mod_python.c \
> --activate-module=src/modules/php4/libphp4.a
> 
> if i build with one or the other the build turns out ok. when i
> build both modules together it flops
> 
> 
> any help would be apreciated
> thanks
> 
> ************************************************************************************************
> 
> <=== src/modules/standard
> ===> src/modules/extra
> gcc -c -I/usr/local/include/python1.5 -I../../os/unix -I../../include
> -DLINUX=2 -I/home/bryan/src/php-4.0.1pl2
> -I/home/bryan/src/php-4.0.1pl2/main -I/home/bryan/src/php-4.0.1pl2/main
> -I/home/bryan/src/php-4.0.1pl2/Zend -I/home/bryan/src/php-4.0.1pl2/Zend
> -I/home/bryan/src/php-4.0.1pl2 -DUSE_EXPAT -I../../lib/expat-lite
> -DNO_DL_NEEDED `../../apaci` mod_python.c
> rm -f libextra.a
> ar cr libextra.a mod_python.o
> ranlib libextra.a
> <=== src/modules/extra
> ===> src/modules/php4
> gcc -c -I/usr/local/include/python1.5 -I../../os/unix -I../../include
> -DLINUX=2 -I/home/bryan/src/php-4.0.1pl2
> -I/home/bryan/src/php-4.0.1pl2/main -I/home/bryan/src/php-4.0.1pl2/main
> -I/home/bryan/src/php-4.0.1pl2/Zend -I/home/bryan/src/php-4.0.1pl2/Zend
> -I/home/bryan/src/php-4.0.1pl2 -DUSE_EXPAT -I../../lib/expat-lite
> -DNO_DL_NEEDED `../../apaci`  mod_php4.c
> cp libmodphp4.a libphp4.a
> ar r libphp4.a mod_php4.o
> ranlib libphp4.a
> <=== src/modules/php4
> <=== src/modules
> gcc -c -I/usr/local/include/python1.5 -I./os/unix -I./include
> -DLINUX=2 -I/home/bryan/src/php-4.0.1pl2
> -I/home/bryan/src/php-4.0.1pl2/main -I/home/bryan/src/php-4.0.1pl2/main
> -I/home/bryan/src/php-4.0.1pl2/Zend -I/home/bryan/src/php-4.0.1pl2/Zend
> -I/home/bryan/src/php-4.0.1pl2 -DUSE_EXPAT -I./lib/expat-lite
> -DNO_DL_NEEDED `./apaci` modules.c
> gcc -c -I/usr/local/include/python1.5 -I./os/unix -I./include
> -DLINUX=2 -I/home/bryan/src/php-4.0.1pl2
> -I/home/bryan/src/php-4.0.1pl2/main -I/home/bryan/src/php-4.0.1pl2/main
> -I/home/bryan/src/php-4.0.1pl2/Zend -I/home/bryan/src/php-4.0.1pl2/Zend
> -I/home/bryan/src/php-4.0.1pl2 -DUSE_EXPAT -I./lib/expat-lite
> -DNO_DL_NEEDED `./apaci` buildmark.c
> gcc  -DLINUX=2 -I/home/bryan/src/php-4.0.1pl2
> -I/home/bryan/src/php-4.0.1pl2/main -I/home/bryan/src/php-4.0.1pl2/main
> -I/home/bryan/src/php-4.0.1pl2/Zend -I/home/bryan/src/php-4.0.1pl2/Zend
> -I/home/bryan/src/php-4.0.1pl2 -DUSE_EXPAT -I./lib/expat-lite
> -DNO_DL_NEEDED `./apaci` -Xlinker -export-dynamic       \
>       -o httpd buildmark.o modules.o modules/standard/libstandard.a
> modules/extra/libextra.a modules/php4/libphp4.a main/libmain.a
> ./os/unix/libos.a ap/libap.a  lib/expat-lite/libexpat.a
> -Wl,-rpath,/usr/local/mysql/lib/mysql -Wl,-rpath,/usr/local/pgsql/lib
> -rdynamic -L/usr/local/mysql/lib/mysql -L/usr/local/pgsql/lib
> -Lmodules/php4 -L../modules/php4 -L../../modules/php4 -lmodphp4  -lgdbm
> -lpam  -ldl -lpq -lmysqlclient -lresolv -lm -ldl -lcrypt -lnsl
> -lresolv  -lm -lcrypt /usr/local/lib/python1.5/config/libpython1.5.a
> -lieee -lnet -ldl  -lpthread   -lm
> /usr/local/lib/python1.5/config/libpython1.5.a(pypcre.o): In function
> `pcre_study':
> /home/bryan/src/Python-1.5.2/Modules/./pypcre.c:501: multiple definition
> 
> of `pcre_malloc'
> modules/php4/libphp4.a(pcre.o):/home/bryan/src/php-4.0.1pl2/ext/pcre/pcrelib/pcre.c:238:
> 
> first defined here
> /usr/local/lib/python1.5/config/libpython1.5.a(pypcre.o): In function
> `pcre_study':
> /home/bryan/src/Python-1.5.2/Modules/./pypcre.c:501: multiple definition
> 
> of `pcre_free'
> modules/php4/libphp4.a(pcre.o):/home/bryan/src/php-4.0.1pl2/ext/pcre/pcrelib/pcre.c:238:
> 
> first defined here
> collect2: ld returned 1 exit status
> make[2]: *** [target_static] Error 1
> make[2]: Leaving directory `/home/bryan/src/apache_1.3.12/src'
> make[1]: *** [build-std] Error 2
> make[1]: Leaving directory `/home/bryan/src/apache_1.3.12'
> make: *** [build] Error 2
> 
> 
> 
> 
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 


From kkinder at tridog.com  Tue Aug 29 14:36:09 2000
From: kkinder at tridog.com (Ken Kinder)
Date: Fri Jan  9 21:52:05 2004
Subject: [mod_python] PyApache, FastCGI, modpython comparison
Message-ID: <39AC1EB9.E59FDF64@tridog.com>

Can some give me a feel for the differences between PyApache,
FastCGI/Python, ModPython? I would like to know specifically about
portability, performance issues, and process control. I've written much
of a Python-based online store which I plan to Open Source and am now
needing to look at persistance. The non-serial, threaded environment is
a must.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: kkinder.vcf
Type: text/x-vcard
Size: 244 bytes
Desc: Card for Ken Kinder
Url : http://mailman.modpython.org/pipermail/mod_python/attachments/20000829/eebfd259/kkinder-0001.vcf
From bohheong at asiacontent.com  Wed Aug  2 22:41:33 2000
From: bohheong at asiacontent.com (Boh Heong Yap)
Date: Fri Jan  9 21:58:35 2004
Subject: [mod_python] can't start mod_python
Message-ID: <20000803054133.24083@mail.asiacontent.com>

hi, 

I wonder if someone could help. I've been playing with the configuration
of mod_python for the last few days without success. I managed to compile
in mod_pyton statically into in Apache 1.3.12, got it restarted and tested it.

    config details at end...

When I run ~/bin/httpd -l, mod-python.c is displayed.


From grisha at ispol.com  Wed Aug  2 15:22:23 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:58:35 2004
Subject: [mod_python] can't start mod_python
In-Reply-To: <20000803054133.24083@mail.asiacontent.com>
Message-ID: <Pine.LNX.4.21.0008021521520.28399-100000@saturn.ispol.com>

Which user does apache run as and what are the permissions on the
mod_python directory and everything in it?

--
  Gregory (Grisha) Trubetskoy
       grisha@ispol.com

On Wed, 2 Aug 2000, Boh Heong Yap wrote:

> hi, 
> 
> I wonder if someone could help. I've been playing with the configuration
> of mod_python for the last few days without success. I managed to compile
> in mod_pyton statically into in Apache 1.3.12, got it restarted and tested it.
> 
>     config details at end...
> 
> When I run ~/bin/httpd -l, mod-python.c is displayed.
> 
> 
> >From the browser, "http://222.64.245.xx/pytest.py", gives the message:-
> 
>     Internal Server Error
> 
>     The server encountered an internal error or misconfiguration and was     
>     unable to complete your request.
> 
> Other normal web request seem to work fine. 
> This is what the error logs show...
> 
>     [Wed Aug  2 20:58:57 2000] [notice] caught SIGTERM, shutting down
>     [Wed Aug  2 20:59:02 2000] [notice] Apache/1.3.12 (Unix) configured
> -- resuming
>         normal operations
>     'import site' failed; use -v for traceback
>     make_obcallback(): could not import mod_python.apache.
>     make_obcallback(): could not call init.
>     [Wed Aug  2 20:59:45 2000] [error] [client 202.77.245.126] python_handler:
>         make_obcallback returned no obCallBack!
> 
> 
> The mod_python module sits in 
> 
>         /usr/local/lib/python1.5/mod_python
> 
>     (along with other .pc. .pyc modules)
> 
> 
> In my httpd.conf (everything is there, no srm.conf, access.conf), I have 
> 
>     AddHandler python-program .py
>     PythonHandler pytest.py
>     PythonDebug on
>     PythonPath "sys.path+['/usr/local/lib/python1.5/mod_python']
> 
> this is within the <Directory..> directives for ~/apache/htdocs.
> pytest.py is same as the "Hello World" example in the tutorial in
> mod_python...
> 
> 
> Also when in the Python interpreter, I try to load stuff manually, 
> ie:
> 
>     >>> from mod_python import apache
>     Traceback (innermost last):
>     File "<stdin>", line 1, in ?
>     File "/usr/local/lib/python1.5/mod_python/apache.py", line 18, in ?
>         import _apache
>     ImportError: No module named _apache
>     >>>
> 
> and apache.py does indeed have the line "import _apache"
> 
> Loading other standard python modules like "sys" works OK, hence I think
> PYTHONPATH seems OK.
> 
> 
> config_info
> ------------------
> Apache - 1.3.12
> Python 1.5, compiled from source, standard
>     (both are installed in /usr/local)
> system Linux Mandrake 7.0, 2.2.12 kernel 
> Compaq box, P3.
> 
> 
> Any help from anyone will be appreciated.
> 
> Hope I can get this working. Would love to use Python for a few things here.
> 
> 
> 
> ----------------------------------------------------------
> Boh-heong Yap
> Project Manager, eCommerce
> 				bohheong@asiacontent.com				
> 
> Asiacontent.com a leading pan-Asian Internet company,
> with focus on: content, advertising and e-commerce.
> -----------------------------------------------------------
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 


From richard at whitequeen.com  Tue Aug  1 08:20:21 2000
From: richard at whitequeen.com (richard offer)
Date: Fri Jan  9 21:58:35 2004
Subject: [mod_python] the return of *Occasional* AttributeError: Handler
Message-ID: <200008011520.e71FKLA03253@whitequeen.com>

 
Hi all,

I've started getting the same error I reported back the beginning of Jul,
in that *occasionaly* I get a

[Tue Aug  1 05:37:12 2000] [error] PythonHandler index: Traceback (innermost last):
[Tue Aug  1 05:37:12 2000] [error] PythonHandler index:   File "/usr/local/lib/python1.5/site-packages/mod_python/apache.py", line 96, in Dispatch
    object = self.resolve_object(module, object_str)
[Tue Aug  1 05:37:12 2000] [error] PythonHandler index:   File "/usr/local/lib/python1.5/site-packages/mod_python/apache.py", line 42, in resolve_object
    obj = getattr(obj, obj_str)
[Tue Aug  1 05:37:12 2000] [error] PythonHandler index: AttributeError: handler


In fact I've probably been getting it all the time, but the person who
I run the site for just got back from vaccation and wanted to see it.

To refresh everyone's memory, the is an occasional (but frequent) error,
my guess is that its timing related, since you can sometimes get it
to disappear by reloading the page---sometimes it will fail elsewhere,
sometimes it works...

My suspicion of it being timing related is reinforced as it never happened
on the development machine, it happens more on the production machine
(same physical machine, but chrooted), and it happens a lot more when
I access the site via the internet (as opposed to via my intranet).

The site in question talks to a MySQL database via a persistant
connection.


Is there any ideas on how to debug this ? Extra diagnostics I can add
in apache.py ?

[ RH 6.1/mod_python 2.4/ DSL ]

thanks.

richard.

-- 
richard offer @ home 
          84 FE 48 E4 74 D0 26 D4  31 8E B6 86 98 74 E2 7C  8A FB BF A3
_______________________________http://www.whitequeen.com/users/richard/
* 



-- 
richard offer @ home 
          84 FE 48 E4 74 D0 26 D4  31 8E B6 86 98 74 E2 7C  8A FB BF A3
_______________________________http://www.whitequeen.com/users/richard/

From grisha at ispol.com  Thu Aug  3 08:17:59 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:58:35 2004
Subject: [mod_python] the return of *Occasional* AttributeError: Handler
In-Reply-To: <200008011520.e71FKLA03253@whitequeen.com>
Message-ID: <Pine.LNX.4.21.0008030815040.31424-100000@saturn.ispol.com>

Try upgrading to 2.4.1. It gives you additional info for Attribute errors.

Grisha

On Tue, 1 Aug 2000, richard offer wrote:

> 
>  
> Hi all,
> 
> I've started getting the same error I reported back the beginning of Jul,
> in that *occasionaly* I get a
> 
> [Tue Aug  1 05:37:12 2000] [error] PythonHandler index: Traceback (innermost last):
> [Tue Aug  1 05:37:12 2000] [error] PythonHandler index:   File "/usr/local/lib/python1.5/site-packages/mod_python/apache.py", line 96, in Dispatch
>     object = self.resolve_object(module, object_str)
> [Tue Aug  1 05:37:12 2000] [error] PythonHandler index:   File "/usr/local/lib/python1.5/site-packages/mod_python/apache.py", line 42, in resolve_object
>     obj = getattr(obj, obj_str)
> [Tue Aug  1 05:37:12 2000] [error] PythonHandler index: AttributeError: handler
> 
> 
> In fact I've probably been getting it all the time, but the person who
> I run the site for just got back from vaccation and wanted to see it.
> 
> To refresh everyone's memory, the is an occasional (but frequent) error,
> my guess is that its timing related, since you can sometimes get it
> to disappear by reloading the page---sometimes it will fail elsewhere,
> sometimes it works...
> 
> My suspicion of it being timing related is reinforced as it never happened
> on the development machine, it happens more on the production machine
> (same physical machine, but chrooted), and it happens a lot more when
> I access the site via the internet (as opposed to via my intranet).
> 
> The site in question talks to a MySQL database via a persistant
> connection.
> 
> 
> Is there any ideas on how to debug this ? Extra diagnostics I can add
> in apache.py ?
> 
> [ RH 6.1/mod_python 2.4/ DSL ]
> 
> thanks.
> 
> richard.
> 
> -- 
> richard offer @ home 
>           84 FE 48 E4 74 D0 26 D4  31 8E B6 86 98 74 E2 7C  8A FB BF A3
> _______________________________http://www.whitequeen.com/users/richard/
> * 
> 
> 
> 
> -- 
> richard offer @ home 
>           84 FE 48 E4 74 D0 26 D4  31 8E B6 86 98 74 E2 7C  8A FB BF A3
> _______________________________http://www.whitequeen.com/users/richard/
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 


From jack at icecast.org  Fri Aug  4 23:19:58 2000
From: jack at icecast.org (Jack Moffitt)
Date: Fri Jan  9 21:58:35 2004
Subject: [mod_python] authenhandler not working
Message-ID: <20000804231958.E5841@tk421.icecast.org>

Using the tutorial, i got the first example to work.  

Then i did the second example, and that is not authenticating me.  I
figured I've got a typo somewhere so i modified it to look like:

def authenhandler(req):
        user = req.connection.user
        pw = req.get_basic_auth_pw()

        if user == "spam" and pw == "eggs":
                return apache.OK
        else:
                apache.log_error('start', apache.APLOG_NOTICE)
                apache.log_error(user, apache.APLOG_NOTICE)
                apache.log_error(pw, apache.APLOG_NOTICE)
                apache.log_error('end', apache.APLOG_NOTICE)
                return apache.HTTP_UNAUTHORIZED


when I make the request, i get (from error_log):

[Fri Aug  4 23:07:57 2000] [notice] (13)Permission denied: start
[Fri Aug  4 23:07:57 2000] [notice] (13)Permission denied: eggs
[Fri Aug  4 23:07:57 2000] [notice] (13)Permission denied: end

the user var must be blank, because it never makes it.  

access_log has:

127.0.0.1 - spam [04/Aug/2000:23:07:57 -0700] "GET /test/test.py HTTP/1.0" 401 471

which has the username correct.

Where am I going wrong here?  Or is this a bug?

jack.

From gps at trix.dircon.co.uk  Mon Aug  7 02:00:52 2000
From: gps at trix.dircon.co.uk (Graham Swallow)
Date: Fri Jan  9 21:58:35 2004
Subject: [mod_python] SPIN_py works with mod_python
Message-ID: <Pine.LNX.4.04.10008070155030.1292-100000@trix.dircon.co.uk>

You have to mess with the PATHS and the /etc/sgml/ pathnames,
but then it just works. It is an SGML parser (actually SP is
the Parser, SPIN is the interface to Python).

I wouldn't recommend using SPIN on a production server because 
it is not mem-leakage tested, and because if users can upload
SGML they can down load any file (named as an entity), however
it provides elem_info and elem_obj, which are very useful
when building SGML/HTML/XML trees. You can also use them without
initialising the parser, and wrap them in names that you like.

Graham (who thinks mod_python is great)

Begin4
Title:          SPIN_py - SGML Parser Integration (Python)
Version:        0.2.3
Entered-date:   2000-08-06
Description:    SP is _the_ SGML Parser.
                spin_py.so is a loadable Python module.
                SPIN_py uses the generic
                SP-API and routes its events to Python, with some
                fixups on the way. It also provides a few
                C-Python types which are very useful when building
                SGML/HTML/XML trees (elem_info, elem_obj).
                This release includes a standard libsp16.so (binary)
                otherwise its 100K not 1MB. To compile from source
                you may need SP-1.3.4 from http://www.jclark.com/
Keywords:       SGML HTML XML SP Parser Python Apache mod_python
Author:         gps@trix.dircon.co.uk (Graham Swallow)
Primary-site:   http://www.trix.dircon.co.uk/SPIN/
Alternate-site: metalab.unc.edu /pub/Linux/utils/text/
                1026522   SPIN_py-0806.tgz
Platforms:      libc.so.6, gcc-2.96, Linux, Solaris, NOT-HP-UX-YET,
Copying-policy: L-GPL
End



From gps at trix.dircon.co.uk  Mon Aug  7 22:19:08 2000
From: gps at trix.dircon.co.uk (Graham Swallow)
Date: Fri Jan  9 21:58:35 2004
Subject: [mod_python] pcre.error from python
Message-ID: <Pine.LNX.4.04.10008072154560.809-200000@trix.dircon.co.uk>

It doesnt happen every time but I get faults or trace-backs from pcre.
I think its due to interference between the pcre in python, and the
pcre in php (Perl Compat. Regular Expression). sig-seg or either of:

	pcre.error: ('unmatched parentheses', 40)
	pcre.error: ('\\ at end of pattern', 4425)

(Presumably these are random errors from some other memory corruption,
or incorrect function call, there are no parentheses or \\'s)

I haven't got a clue what to do about it, (would statically linking
pcre into python work? Can separate <Directories> NOT have mod_XYZ
loaded?) but if you see the above symptom, try the attached test script.

	Graham

-------------- next part --------------
#!/usr/bin/env python
# called by httpd or by shell

def handler(req):
	from mod_python import apache
	return handler2( req )
	# forgetting the above return is interesting. Try it!

def handler2( req ):

	req.content_type="text/plain"
	req.send_http_header()
	import re
	instr = "Old and New\n"
	outstr = re.sub( "Old", "New", instr, 0 )
	req.write( outstr )
	try:
		t = apache.OK
	except:
		t = "shell_mode"
	return t

if __name__ == '__main__':
	class REQ_DUMMY:
		def __init__( req, fd ):
			# req has writable (and readable) fields
			# when calling from shell ...
			req.fd = fd
		def send_http_header( req ):
			print "Not apache, so I sont say:", req.content_type
		def write( req, text ):
			req.fd.write( text )

	import sys
	# fd = open( "/dev/null", 'w' )
	# fd = open( "test_out.html", 'w' )
	fd = sys.stderr
	req_dummy = REQ_DUMMY( fd )
	handler2( req_dummy )

From Robert.Nasca at macquarie.com.au  Tue Aug  8 09:27:12 2000
From: Robert.Nasca at macquarie.com.au (Robert Nasca)
Date: Fri Jan  9 21:58:35 2004
Subject: [mod_python] mod_python / win32all and COM
Message-ID: <2D0E3DBA4C66D31195920008C784F4AF01332A5C@nt_syd_ex08.macbank>

Hi,

Is there an FAQ on using mod_python with COM? It seems that I am having problems due to the threaded nature of Apache on win32 and it's interaction with COM.

I have created an interface to some COM objects using the "makepy.py" program which comes with win32all.

When I run Apache with ThreadsPerChild set to 1, everything runs fine (albeit with only one client), but when I set this to something higher, I get errors saying "CoInitialise() has not been called", which I assume are related to Apache spawning multiple threads. I've attached the output below.

Mod_python error: "PythonHandler pytest"Traceback (innermost last):
  File "h:\website\python\mod_python\apache.py", line 119, in Dispatch
    result = object(req)
  File "h:/website/htdocs/test\pytest.py", line 8, in handler
    d = Snakey.Database.RiskReporterDatabase()
  File "H:\WebSite\Python\Snakey\Database.py", line 32, in __init__
    self.openConnection("DSN=RISK_REPORTER")
  File "H:\WebSite\Python\Snakey\Database.py", line 20, in openConnection
    self.connection = msado21.Connection()
  File "H:\PythonDev\Snakey\msado21.py", line 1607, in __init__
com_error: (-2147221008, 'CoInitialize has not been called.', None, None)

If anyone has a suggestion on what is happening, or pointers to some information on using mod_python and COM, it would be appreciated.

Thanks,
Rob.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mailman.modpython.org/pipermail/mod_python/attachments/20000808/8ccbceb4/attachment-0002.htm
From efernandez at sistelnet.es  Wed Aug  9 08:51:50 2000
From: efernandez at sistelnet.es (Eduardo Fernandez)
Date: Fri Jan  9 21:58:35 2004
Subject: [mod_python] problem with authen handler
Message-ID: <007701c001ce$4b6b7c40$248a4cc3@sistelnet.es>

Hello everyone:

I whis I had discovered mod_python before. It would have saved me a lot of
headaches in the application I am developing right now. In this app, I
authenticate the users via a regular form in a page, and then keep the
"logged-in" state with cookies.

I want to do it right (TM), and use basic http authentication with
mod_python.

So I set up the documentation example, got the "Hello World!" part to work
and now I am trying to make the authenhandler to work.

I have copied the example as in the documentation and tried to access the
page. I get the user/pw window and fill it, but it alway fails with a 401
error.

I have tried diferent usernames and pws, but it always fails. The apache
logs show the user along with the 401 error, so I think I have the setup
working mostly ok.

Where could be the quirk?

Thanks in advance.
--
Eduardo Fern?ndez Corrales
eduardo@sistelnet.es
Sistelnet Integraciones Telem?ticas - http://www.sistelnet.es
NUEVOS TELEFONOS: 95-4186897 95-4186898 902-293030 Fax: 954186901


From jack at icecast.org  Wed Aug  9 17:12:33 2000
From: jack at icecast.org (Jack Moffitt)
Date: Fri Jan  9 21:58:35 2004
Subject: [mod_python] problem with authen handler
In-Reply-To: <007701c001ce$4b6b7c40$248a4cc3@sistelnet.es>
Message-ID: <Pine.LNX.4.10.10008091711260.14914-100000@deathstar.icecast.org>

I have the same problem, which i posted about a few days back.  Having
done some more research:

req.connection.user is correct, it has teh username

if i do username = req.connection.user then username == None.  I don't get
it.

jack.


On Wed, 9 Aug 2000, Eduardo Fernandez wrote:

> Hello everyone:
> 
> I whis I had discovered mod_python before. It would have saved me a lot of
> headaches in the application I am developing right now. In this app, I
> authenticate the users via a regular form in a page, and then keep the
> "logged-in" state with cookies.
> 
> I want to do it right (TM), and use basic http authentication with
> mod_python.
> 
> So I set up the documentation example, got the "Hello World!" part to work
> and now I am trying to make the authenhandler to work.
> 
> I have copied the example as in the documentation and tried to access the
> page. I get the user/pw window and fill it, but it alway fails with a 401
> error.
> 
> I have tried diferent usernames and pws, but it always fails. The apache
> logs show the user along with the 401 error, so I think I have the setup
> working mostly ok.
> 
> Where could be the quirk?
> 
> Thanks in advance.
> --
> Eduardo Fernández Corrales
> eduardo@sistelnet.es
> Sistelnet Integraciones Telemáticas - http://www.sistelnet.es
> NUEVOS TELEFONOS: 95-4186897 95-4186898 902-293030 Fax: 954186901
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 


From goodwin at apple.com  Wed Aug  9 22:21:02 2000
From: goodwin at apple.com (Larry Goodwin)
Date: Fri Jan  9 21:58:35 2004
Subject: [mod_python] invalid command in Apache config
Message-ID: <39923BBB.ABA1FFF6@apple.com>

I installed mod_python by changing the Apache config. 
Added "AddModule modules/extra/mod_python.c" to the Configuration file
Copied mod_python.c from mod_python...src/mod_python.c to apache.../src/modules/extra/
Ran configure, make and make install

Added the following to the httpd.conf file.
<Directory "/usr/local/webpages/test/">
AddHandler python-program .py
PythonHandler test
PythonDebug On
</Directory>

The test.py file is in /usr/local/webpages/test/
When I run apachectl configtest I get:
Syntax error on line 561 of /usr/local/apache/conf/httpd.conf:
Invalid command 'PythonHandler', perhaps mis-spelled or defined by a
module not included in the server configuration

Apache is 1.3.12 and mod_python is 2,4,1, Python is 1.5.2

Is there any way to make sure the mod_python.c was added to Apache or is
there another problem/

thanks

From grisha at ispol.com  Thu Aug 10 08:19:53 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:58:35 2004
Subject: [mod_python] problem with authen handler
In-Reply-To: <Pine.LNX.4.10.10008091711260.14914-100000@deathstar.icecast.org>
Message-ID: <Pine.LNX.4.21.0008100819040.9858-100000@saturn.ispol.com>

I'm looking into this right now.... It looks like if you call
get_basic_auth_pw() *first* - you get the user name.

Grisha


On Wed, 9 Aug 2000, Jack Moffitt wrote:

> I have the same problem, which i posted about a few days back.  Having
> done some more research:
> 
> req.connection.user is correct, it has teh username
> 
> if i do username = req.connection.user then username == None.  I don't get
> it.
> 
> jack.
> 
> 
> On Wed, 9 Aug 2000, Eduardo Fernandez wrote:
> 
> > Hello everyone:
> > 
> > I whis I had discovered mod_python before. It would have saved me a lot of
> > headaches in the application I am developing right now. In this app, I
> > authenticate the users via a regular form in a page, and then keep the
> > "logged-in" state with cookies.
> > 
> > I want to do it right (TM), and use basic http authentication with
> > mod_python.
> > 
> > So I set up the documentation example, got the "Hello World!" part to work
> > and now I am trying to make the authenhandler to work.
> > 
> > I have copied the example as in the documentation and tried to access the
> > page. I get the user/pw window and fill it, but it alway fails with a 401
> > error.
> > 
> > I have tried diferent usernames and pws, but it always fails. The apache
> > logs show the user along with the 401 error, so I think I have the setup
> > working mostly ok.
> > 
> > Where could be the quirk?
> > 
> > Thanks in advance.
> > --
> > Eduardo Fern?ndez Corrales
> > eduardo@sistelnet.es
> > Sistelnet Integraciones Telem?ticas - http://www.sistelnet.es
> > NUEVOS TELEFONOS: 95-4186897 95-4186898 902-293030 Fax: 954186901
> > 
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://www.modpython.org/mailman/listinfo/mod_python
> > 
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 


From grisha at ispol.com  Thu Aug 10 09:38:46 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:58:35 2004
Subject: [mod_python] some bug fixes and new features in CVS
Message-ID: <Pine.LNX.4.21.0008100927060.10100-100000@saturn.ispol.com>

Just FYI - 

I've checked in to the CVS server on sourceforge the version of mod_python
that has a number of new features, fixes and improvements. Some changes
were quite radical which is why I don't want to put it out as a release
just yet.

There are instructions on how to retrieve code from CVS on 
http://sourceforge.net/cvs/?group_id=7107

Some of the most significant changes are:

o New PythonEnablePdb directive that allows handlers to be executed
  within pdb (Python debugger).

o Proper finalization - Py_Finalize() C API function is called with a
  child proces exits, thus making sure all objects are destroyed properly.

o Dynamic handler registration. Now you can add handlers from within
  handlers. Extremely useful if you want, for example, to write an
  authentication handler that decides based on the userid which handler
  will handle the request.

o There is now a way to have multiple keys in a table via the
  add() function. Having multiple keys is critical to being able
  to set multiple cookies, as someone pointed out on this list.

o mod_python.c should compile with the -ansi option without warnings.


--
  Gregory (Grisha) Trubetskoy
       grisha@ispol.com


From grisha at ispol.com  Thu Aug 10 11:35:08 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:58:35 2004
Subject: [mod_python] some bug fixes and new features in CVS
In-Reply-To: <20000810135152.2096.qmail@web2206.mail.yahoo.com>
Message-ID: <Pine.LNX.4.21.0008101127050.10351-100000@saturn.ispol.com>

The CGI memory leak is not a problem with mod_python itself really. It has
to do with cgi.py and what it does. The thing to realize about mod_python
(or mod_perl, or php for that matter), is that code that is not careful
about memory allocation, will make apache process grow and grow.

I think that there are only two possible solutions - 

1. Some mod_python module that kills httpd when it reaches a certain
size. That's the technique mod_perl folks use.

2. A fix/rewrite of cgi.py.

The latter is the right thing to do, of course, but who knows when it will
happen....

I'd like to mention that this issue is certainly high on my TODO list, and
I'm open to any advice, suggetions, code snippets, patches, etc :-)

Grisha


On Thu, 10 Aug 2000, Alexis Iglauer wrote:

> Has the cgi memory leak been sorted out yet?  I am
> having to restart my apache at least once a day to not
> swamp my machine......
> 
> Keep up the excellent work!
> Regards
> Alexis
> --- Gregory Trubetskoy <grisha@ispol.com> wrote:
> > 
> > Just FYI - 
> > 
> > I've checked in to the CVS server on sourceforge the
> > version of mod_python
> > that has a number of new features, fixes and
> > improvements. Some changes
> > were quite radical which is why I don't want to put
> > it out as a release
> > just yet.
> > 
> > There are instructions on how to retrieve code from
> > CVS on 
> > http://sourceforge.net/cvs/?group_id=7107
> > 
> > Some of the most significant changes are:
> > 
> > o New PythonEnablePdb directive that allows handlers
> > to be executed
> >   within pdb (Python debugger).
> > 
> > o Proper finalization - Py_Finalize() C API function
> > is called with a
> >   child proces exits, thus making sure all objects
> > are destroyed properly.
> > 
> > o Dynamic handler registration. Now you can add
> > handlers from within
> >   handlers. Extremely useful if you want, for
> > example, to write an
> >   authentication handler that decides based on the
> > userid which handler
> >   will handle the request.
> > 
> > o There is now a way to have multiple keys in a
> > table via the
> >   add() function. Having multiple keys is critical
> > to being able
> >   to set multiple cookies, as someone pointed out on
> > this list.
> > 
> > o mod_python.c should compile with the -ansi option
> > without warnings.
> > 
> > 
> > --
> >   Gregory (Grisha) Trubetskoy
> >        grisha@ispol.com
> > 
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://www.modpython.org/mailman/listinfo/mod_python
> 
> 
> __________________________________________________
> Do You Yahoo!?
> Kick off your party with Yahoo! Invites.
> http://invites.yahoo.com/
> 


From sbi at acse.be  Thu Aug 10 19:40:09 2000
From: sbi at acse.be (Stephane Bidoul)
Date: Fri Jan  9 21:58:36 2004
Subject: [mod_python] mod_python / win32all and COM
References: <2D0E3DBA4C66D31195920008C784F4AF01332A5C@nt_syd_ex08.macbank>
Message-ID: <00a801c002f2$0d882020$faa679c1@spirou>

I think you need to put COM in free-threaded mode
by doing

>>> sys.coinit_flags = 0

before anything else.

There is a mention of this in the Python COM readme,
but and can't recall where it's documented in more details...

Tell me if it works for you.

-sbi

----- Original Message -----
From: "Robert Nasca" <Robert.Nasca@macquarie.com.au>
To: <mod_python@modpython.org>
Sent: Tuesday, 08 August, 2000 01:27
Subject: [mod_python] mod_python / win32all and COM


> Hi,
>
> Is there an FAQ on using mod_python with COM? It seems that I am having
> problems due to the threaded nature of Apache on win32 and it's
> interaction with COM.
>
> I have created an interface to some COM objects using the "makepy.py"
> program which comes with win32all.
>
> When I run Apache with ThreadsPerChild set to 1, everything runs fine
> (albeit with only one client), but when I set this to something higher,
> I get errors saying "CoInitialise() has not been called", which I assume
> are related to Apache spawning multiple threads. I've attached the
> output below.
>
> Mod_python error: "PythonHandler pytest"Traceback (innermost last):
>   File "h:\website\python\mod_python\apache.py", line 119, in Dispatch
>     result = object(req)
>   File "h:/website/htdocs/test\pytest.py", line 8, in handler
>     d = Snakey.Database.RiskReporterDatabase()
>   File "H:\WebSite\Python\Snakey\Database.py", line 32, in __init__
>     self.openConnection("DSN=RISK_REPORTER")
>   File "H:\WebSite\Python\Snakey\Database.py", line 20, in
> openConnection
>     self.connection = msado21.Connection()
>   File "H:\PythonDev\Snakey\msado21.py", line 1607, in __init__
> com_error: (-2147221008, 'CoInitialize has not been called.', None,
> None)
>
> If anyone has a suggestion on what is happening, or pointers to some
> information on using mod_python and COM, it would be appreciated.
>
> Thanks,
> Rob.
>
>



From goodwin at apple.com  Fri Aug 11 10:59:21 2000
From: goodwin at apple.com (Larry Goodwin)
Date: Fri Jan  9 21:58:36 2004
Subject: [mod_python] Problems with getting mod_python into Apache
Message-ID: <39943D7C.CB56DBA0@apple.com>

Folks, I am still having problems with getting mod_python compiled into
Apache 1.3.12
I followed the procedures:
cd apache/src
vi Configuration
AddModule modules/extra/mod_python.c
./Configure

Get this error:
+ adding selected modules
    o python_module uses ConfigStart/End
 + checking sizeof various data types
 + doing sanity check on compiler and options
** A test compilation with your Makefile configuration
** failed.  The below error output from the compilation
** test will give you an idea what is failing. Note that
** Apache requires an ANSI C Compiler, such as gcc.

======== Error Output for sanity check ========
cd ..; gcc  -DAIX=41 -DNEED_RLIM_T -U__STR__ -DAIX_BIND_PROCESSOR -DUSE_HSREGEX
-DUSE_EXPAT -I./lib/expat-lite -DNO_DL_NEEDED 
-I/usr/local/include/python1.5  -
Wl,-bE:python.exp -lld      -o helpers/dummy helpers/dummy.c   /usr/local/lib/py
thon1.5/config/libpython1.5.a      -lm
ld: 0706-004 Cannot find or read export file: python.exp
        ld:accessx(): No such file or directory
collect2: ld returned 255 exit status
make: *** [dummy] Error 1
============= End of Error Report =============

 Aborting!

python.exp is in /usr/local/lib/python1.5/conf

My path is: 
PATH=/usr/local/bin:/usr/local/lib/python1.5:/usr/local/lib/python1.5/conf:/usr/
local/include/python1.5:/usr/bin:/etc:/usr/sbin:/usr/ucb:/usr/bin/X11:/sbin

Thanks,
Larry

From daniel at unity.copyleft.no  Fri Aug 11 21:29:58 2000
From: daniel at unity.copyleft.no (Daniel Mikkelsen)
Date: Fri Jan  9 21:58:36 2004
Subject: [mod_python] PythonImport
Message-ID: <Pine.LNX.4.10.10008112123040.27319-100000@unity.copyleft.no>

Hi.

I'm having problems with loading modules not located in the global
site-packages directory. 

I want to load a module that opens a connection to a database, and
I want this module to be located in the same directory as the .py
files that will make use of it. 

However, I always get:

  Fri Aug 11 21:16:46 2000] [error] directive_PythonImport: error
  importing open_db_con ImportError: No module named open_db_con

If I copy the module into site-packages, this works. But I don't want
do this, as I expect to have lots of different programs that will 
want to access lots of different databases. 

I've tried using the PythonPath directive, to no avail. I'm using 
mod_python 2.4.1 loaded dynamically with Apache 1.3.9 on OpenBSD 2.6. 

Anything obvious I'm doing wrong?

-- Daniel Mikkelsen, Copyleft Software



From michael at stroeder.com  Fri Aug 11 21:50:05 2000
From: michael at stroeder.com (Michael =?iso-8859-1?Q?Str=F6der?=)
Date: Fri Jan  9 21:58:36 2004
Subject: [mod_python] PythonImport
References: <Pine.LNX.4.10.10008112123040.27319-100000@unity.copyleft.no>
Message-ID: <399458ED.BC942863@stroeder.com>

Daniel Mikkelsen wrote:
> 
> I'm having problems with loading modules not located in the global
> site-packages directory.
> 
> I want to load a module that opens a connection to a database, and
> I want this module to be located in the same directory as the .py
> files that will make use of it.

sys.path.append() is not an option?

Ciao, Michael.

From bfordham at piratech.net  Fri Aug 11 16:07:15 2000
From: bfordham at piratech.net (bfordham@piratech.net)
Date: Fri Jan  9 21:58:36 2004
Subject: [mod_python] PythonImport
In-Reply-To: <Pine.LNX.4.10.10008112123040.27319-100000@unity.copyleft.no>
Message-ID: <399424B3.32484.9BFEE0@localhost>

-----BEGIN PGP SIGNED MESSAGE-----

On 11 Aug 2000, at 21:29, Daniel Mikkelsen wrote:

> Hi.
> 
> I'm having problems with loading modules not located in the global
> site-packages directory. 

I tried a couple of quick tests.  First I created a module (yoda.py)
with one line (x=1) and put it in the directory with my main script. 
Told the main script to import it and print yoda.x; worked fine.

Moved yoda.py to directory blah, and added:
PythonPath "sys.path+['/serverpath','/serverpath/blah']
to my httpd.conf file.  Restarted the server, it worked, too.

I'm running Debian 2.1, Apache 1.3.12 and mod_python as a DSO.

Are you sure the script to want imported is in a directory the server
can read?  Did you restart the server?

Sorry I can't be of more help

- --B

-----BEGIN PGP SIGNATURE-----
Version: N/A

iQCVAwUBOZRctw2B1TBOdblFAQE+6AP5AVcFKkk8lwXZg8aXrpIUFJ29dJ+es3zy
LA0uHhKr1GVP0MoGuU/K6ovw9jU+mQG/XweirNn1ZjcCj5tAbxx26V9d15fF5Llx
z2aklem04SOExXNcXsM4DWCm/Rpe4O79TEdrPB//ZcdBmoBXgPbEbZ8R033y54Hy
thKrNKNZcM0=
=U2pW
-----END PGP SIGNATURE-----


From grisha at ispol.com  Fri Aug 11 17:25:14 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:58:36 2004
Subject: [mod_python] PythonImport
In-Reply-To: <Pine.LNX.4.10.10008112123040.27319-100000@unity.copyleft.no>
Message-ID: <Pine.LNX.4.21.0008111723300.14946-100000@saturn.ispol.com>

Is your PythonImport within an appropriate <Directory> tag or just by
itself?

--
  Gregory (Grisha) Trubetskoy
       grisha@ispol.com

On Fri, 11 Aug 2000, Daniel Mikkelsen wrote:

> Hi.
> 
> I'm having problems with loading modules not located in the global
> site-packages directory. 
> 
> I want to load a module that opens a connection to a database, and
> I want this module to be located in the same directory as the .py
> files that will make use of it. 
> 
> However, I always get:
> 
>   Fri Aug 11 21:16:46 2000] [error] directive_PythonImport: error
>   importing open_db_con ImportError: No module named open_db_con
> 
> If I copy the module into site-packages, this works. But I don't want
> do this, as I expect to have lots of different programs that will 
> want to access lots of different databases. 
> 
> I've tried using the PythonPath directive, to no avail. I'm using 
> mod_python 2.4.1 loaded dynamically with Apache 1.3.9 on OpenBSD 2.6. 
> 
> Anything obvious I'm doing wrong?
> 
> -- Daniel Mikkelsen, Copyleft Software
> 
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 


From daniel at unity.copyleft.no  Fri Aug 11 23:26:13 2000
From: daniel at unity.copyleft.no (Daniel Mikkelsen)
Date: Fri Jan  9 21:58:36 2004
Subject: [mod_python] PythonTransHandler
Message-ID: <Pine.LNX.4.10.10008112323570.27319-100000@unity.copyleft.no>

Hi.

Anyone here know how the PythonTransHandler works? It looks like it's
supposed to let me translate the URI at an early stage. But I'm
uncertain as to how my transhandler(req) is supposed to realize the 
translation it does. 

-- Daniel Mikkelsen, Copyelft Software



From L.A.Timochouk at ukc.ac.uk  Fri Aug 11 23:00:29 2000
From: L.A.Timochouk at ukc.ac.uk (Dr. L.A. Timochouk)
Date: Fri Jan  9 21:58:36 2004
Subject: [mod_python] A patch for mod_python-2.4.1
Message-ID: <Pine.GSO.4.21.0008112257320.29709-100000@myrtle.ukc.ac.uk>

Hello All,

Please find attached a patch for mod_python-2.4.1. It addresses two issues:

(1) The current implementation of "req_read" method seems to contain a bug
    (or a problematic feature?): it may return less bytes than was requested,
    due to a known sockets phenomenon called "short read". Namely, a single
    "read" on a TCP socket returns data ONLY up to the end of the current
    IP packet; several "read"s may be required to get the whole amount
    requested. The current implementation did not guard against that; on the
    contrary, it shrank the output buffer is less-than-expected bytes were
    received. In particular, this may result in incomplete receiving of POSTed
    data (the problem shows up on large submissions only). The proposed
    patch fixes it.

(2) A new Apache directive,

    PythonOptimize On|Off

    is implemented. If set, it allows us to run the interpreter in the
    fully-optimising mode (equivalent to -OO Python command-line argument)
    which may be useful for time-critical applications.

Best regards,

Dr. Leonid Timochouk
Computing Laboratory
University of Kent at Canterbury
England
===============================================================================

--- mod_python.c.orig	Tue Jul  4 18:49:31 2000
+++ mod_python.c	Sun Jul 23 16:39:55 2000
@@ -1277,7 +1277,7 @@
 static PyObject * req_read(requestobject *self, PyObject *args)
 {
 
-    int len, rc, bytes_read;
+    int len, rc, bytes_read, chunk_len;
     char *buffer;
     PyObject *result;
 
@@ -1316,13 +1316,18 @@
 	return NULL;
 
     /* read it in */
+    /* BEWARE of short reads!  */
     buffer = PyString_AS_STRING((PyStringObject *) result);
-    bytes_read = ap_get_client_block(self->request_rec, buffer, len);
-
-    /* resize if necessary */
-    if (bytes_read < len) 
-	if(_PyString_Resize(&result, bytes_read))
+    bytes_read = 0;
+    while (bytes_read < len)
+    {
+	chunk_len = ap_get_client_block
+		    (self->request_rec, buffer+bytes_read, len-bytes_read);
+	if  (chunk_len == 0)
+	    /* Connection closed -- it's better not to return anything */
 	    return NULL;
+    	bytes_read += chunk_len;
+    }
 
     return result;
 }
@@ -2087,6 +2092,19 @@
 }
 
 /**
+ ** directive_PythonOptimize
+ **
+ *	This function called whenever PythonOptimize directive
+ *	is encountered.
+ */
+static const char *directive_PythonOptimize(cmd_parms *cmd, void *mconfig,
+					    int val) {
+    if (val)
+	Py_OptimizeFlag = 2; /* Optimize and remove function descr strings */
+    return NULL;
+}
+
+/**
  ** directive_PythonInterpPerDirectory
  **
  *      This function called whenever PythonInterpPerDirectory directive
@@ -2409,6 +2427,14 @@
 	OR_ALL,                         
 	FLAG,                               
 	"Send (most) Python error output to the client rather than logfile."
+    },
+    {
+	"PythonOptimize",
+	directive_PythonOptimize,
+	NULL,
+	OR_ALL,
+	FLAG,
+	"Set the equivalent of the -O command-line flag on the interpreter."
     },
     {
 	"PythonNoReload",                 



From dyeung at ust.hk  Mon Aug 14 09:26:49 2000
From: dyeung at ust.hk (David YEUNG)
Date: Fri Jan  9 21:58:36 2004
Subject: [mod_python] How to define an environment variable for other python module to use?
Message-ID: <39974AD9.2C33FAE1@ust.hk>

I have other python modules which usually need to read some environment
variables, e.g., an python-oracle interface module needs to read the "ORACLE_SID"
to know where the database to connect. I used to defining this variable in the "shell"
before invoking a python CGI program, e.g.:

   #!/bin/sh
   export ORACLE_SID=orcl
   exec /some/oracle/python/interface.cgi

I would like to try the mod_python using the default CGI handler, but does someone
know how to define some environment variable in mod_python?

Thanks

david

From jack at icecast.org  Sun Aug 13 18:37:05 2000
From: jack at icecast.org (Jack Moffitt)
Date: Fri Jan  9 21:58:36 2004
Subject: [mod_python] How to define an environment variable for other
 python module to use?
In-Reply-To: <39974AD9.2C33FAE1@ust.hk>
Message-ID: <Pine.LNX.4.10.10008131836030.24345-100000@deathstar.icecast.org>

generally when we do this with php, we define the ENV variables in the
apache startup script, so that they get into every child process.  then
they are readable with the normal environment functions.

we don't normally change where the oracle_sid is, so we have no need to
set them.

jack.

On Mon, 14 Aug 2000, David YEUNG wrote:

> I have other python modules which usually need to read some environment
> variables, e.g., an python-oracle interface module needs to read the "ORACLE_SID"
> to know where the database to connect. I used to defining this variable in the "shell"
> before invoking a python CGI program, e.g.:
> 
>    #!/bin/sh
>    export ORACLE_SID=orcl
>    exec /some/oracle/python/interface.cgi
> 
> I would like to try the mod_python using the default CGI handler, but does someone
> know how to define some environment variable in mod_python?
> 
> Thanks
> 
> david
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 


From rdevide at ican.at  Mon Aug 14 11:51:37 2000
From: rdevide at ican.at (Devide Robert)
Date: Fri Jan  9 21:58:36 2004
Subject: [mod_python] some bug fixes and new features in CVS
References: <Pine.LNX.4.21.0008101127050.10351-100000@saturn.ispol.com>
Message-ID: <3997C129.EA8F5DED@ican.at>

Gregory Trubetskoy wrote:
> 1. Some mod_python module that kills httpd when it reaches a certain
> size. That's the technique mod_perl folks use.

Would rather use something like

MaxRequestsPerChild 100

in apache config.
(as it had proofed to be the simplest and most effective way to 'handle'
memory leaks in various modules)

dave

From grisha at ispol.com  Mon Aug 14 08:31:17 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:58:36 2004
Subject: [mod_python] PythonTransHandler
In-Reply-To: <Pine.LNX.4.10.10008112323570.27319-100000@unity.copyleft.no>
Message-ID: <Pine.LNX.4.21.0008140827470.1734-100000@saturn.ispol.com>

You basically take assign a value to req.filename, usually based on
req.uri. There is a problem in 2.4.1 though - the filename attribute is
read-only. This has been fixed in the latest code which you can get from
CVS.

--
  Gregory (Grisha) Trubetskoy
       grisha@ispol.com

On Fri, 11 Aug 2000, Daniel Mikkelsen wrote:

> Hi.
> 
> Anyone here know how the PythonTransHandler works? It looks like it's
> supposed to let me translate the URI at an early stage. But I'm
> uncertain as to how my transhandler(req) is supposed to realize the 
> translation it does. 
> 
> -- Daniel Mikkelsen, Copyelft Software
> 
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 


From grisha at ispol.com  Mon Aug 14 08:36:09 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:58:36 2004
Subject: [mod_python] A patch for mod_python-2.4.1
In-Reply-To: <Pine.GSO.4.21.0008112257320.29709-100000@myrtle.ukc.ac.uk>
Message-ID: <Pine.LNX.4.21.0008140834280.1734-100000@saturn.ispol.com>

Thanks Leonid. I still have your original -OO patch in my INBOX and I'll
make sure to apply it.

Question - are you sure ap_get_client_block() doesn't take care of short
reads?

Thanks!

--
  Gregory (Grisha) Trubetskoy
       grisha@ispol.com

On Fri, 11 Aug 2000, Dr. L.A. Timochouk wrote:

> Hello All,
> 
> Please find attached a patch for mod_python-2.4.1. It addresses two issues:
> 
> (1) The current implementation of "req_read" method seems to contain a bug
>     (or a problematic feature?): it may return less bytes than was requested,
>     due to a known sockets phenomenon called "short read". Namely, a single
>     "read" on a TCP socket returns data ONLY up to the end of the current
>     IP packet; several "read"s may be required to get the whole amount
>     requested. The current implementation did not guard against that; on the
>     contrary, it shrank the output buffer is less-than-expected bytes were
>     received. In particular, this may result in incomplete receiving of POSTed
>     data (the problem shows up on large submissions only). The proposed
>     patch fixes it.
> 
> (2) A new Apache directive,
> 
>     PythonOptimize On|Off
> 
>     is implemented. If set, it allows us to run the interpreter in the
>     fully-optimising mode (equivalent to -OO Python command-line argument)
>     which may be useful for time-critical applications.
> 
> Best regards,
> 
> Dr. Leonid Timochouk
> Computing Laboratory
> University of Kent at Canterbury
> England
> ===============================================================================
> 
> --- mod_python.c.orig	Tue Jul  4 18:49:31 2000
> +++ mod_python.c	Sun Jul 23 16:39:55 2000
> @@ -1277,7 +1277,7 @@
>  static PyObject * req_read(requestobject *self, PyObject *args)
>  {
>  
> -    int len, rc, bytes_read;
> +    int len, rc, bytes_read, chunk_len;
>      char *buffer;
>      PyObject *result;
>  
> @@ -1316,13 +1316,18 @@
>  	return NULL;
>  
>      /* read it in */
> +    /* BEWARE of short reads!  */
>      buffer = PyString_AS_STRING((PyStringObject *) result);
> -    bytes_read = ap_get_client_block(self->request_rec, buffer, len);
> -
> -    /* resize if necessary */
> -    if (bytes_read < len) 
> -	if(_PyString_Resize(&result, bytes_read))
> +    bytes_read = 0;
> +    while (bytes_read < len)
> +    {
> +	chunk_len = ap_get_client_block
> +		    (self->request_rec, buffer+bytes_read, len-bytes_read);
> +	if  (chunk_len == 0)
> +	    /* Connection closed -- it's better not to return anything */
>  	    return NULL;
> +    	bytes_read += chunk_len;
> +    }
>  
>      return result;
>  }
> @@ -2087,6 +2092,19 @@
>  }
>  
>  /**
> + ** directive_PythonOptimize
> + **
> + *	This function called whenever PythonOptimize directive
> + *	is encountered.
> + */
> +static const char *directive_PythonOptimize(cmd_parms *cmd, void *mconfig,
> +					    int val) {
> +    if (val)
> +	Py_OptimizeFlag = 2; /* Optimize and remove function descr strings */
> +    return NULL;
> +}
> +
> +/**
>   ** directive_PythonInterpPerDirectory
>   **
>   *      This function called whenever PythonInterpPerDirectory directive
> @@ -2409,6 +2427,14 @@
>  	OR_ALL,                         
>  	FLAG,                               
>  	"Send (most) Python error output to the client rather than logfile."
> +    },
> +    {
> +	"PythonOptimize",
> +	directive_PythonOptimize,
> +	NULL,
> +	OR_ALL,
> +	FLAG,
> +	"Set the equivalent of the -O command-line flag on the interpreter."
>      },
>      {
>  	"PythonNoReload",                 
> 
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 


From grisha at ispol.com  Mon Aug 14 08:46:38 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:58:36 2004
Subject: [mod_python] some bug fixes and new features in CVS
In-Reply-To: <3997C129.EA8F5DED@ican.at>
Message-ID: <Pine.LNX.4.21.0008140845080.1734-100000@saturn.ispol.com>

That's the way I would do it. BTW - I heard that this directive does
nothing on Win32 where Apache is threaded. Of course the solution I
sugested (killing the process) wouldn't help either....

Grisha

On Mon, 14 Aug 2000, Devide Robert wrote:

> Gregory Trubetskoy wrote:
> > 1. Some mod_python module that kills httpd when it reaches a certain
> > size. That's the technique mod_perl folks use.
> 
> Would rather use something like
> 
> MaxRequestsPerChild 100
> 
> in apache config.
> (as it had proofed to be the simplest and most effective way to 'handle'
> memory leaks in various modules)
> 
> dave
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 


From miguel at yorku.ca  Mon Aug 14 09:20:56 2000
From: miguel at yorku.ca (Miguel Marques)
Date: Fri Jan  9 21:58:36 2004
Subject: [mod_python] some bug fixes and new features in CVS
In-Reply-To: <Pine.LNX.4.21.0008101127050.10351-100000@saturn.ispol.com>
References: <20000810135152.2096.qmail@web2206.mail.yahoo.com>
	<Pine.LNX.4.21.0008101127050.10351-100000@saturn.ispol.com>
Message-ID: <20000814092056B.miguel@yorku.ca>

On Thu, 10 Aug 2000 11:35:08 -0400 (EDT), Gregory Trubetskoy <grisha@ispol.com> wrote:
> 
> The CGI memory leak is not a problem with mod_python itself really. It has
> to do with cgi.py and what it does. The thing to realize about mod_python

Could you elaborate on why or how cgi.py leaks memory?  I'm using both
mod_python and cgi on a project that will see very large usage and I
would like to try and figure out if I should drop usage of cgi.py or not.
Thanks!

							Miguel

C. Miguel Marques, York University, Computing & Communications Services
e-mail: miguel@yorku.ca, voice: (416)736-2100x22684, fax: (416)736-5830

From L.A.Timochouk at ukc.ac.uk  Mon Aug 14 15:44:19 2000
From: L.A.Timochouk at ukc.ac.uk (Dr. L.A. Timochouk)
Date: Fri Jan  9 21:58:36 2004
Subject: [mod_python] A patch for mod_python-2.4.1
In-Reply-To: <Pine.LNX.4.21.0008140834280.1734-100000@saturn.ispol.com>
Message-ID: <Pine.GSO.4.21.0008141538030.24919-100000@myrtle.ukc.ac.uk>

Yes, it appeared to us that "ap_get_client_block" is susceptible to short
reads -- it indeed reads a BLOCK until the end of the current IP datagram
but no further. The problem was discovered when we implemented our Web
site with relatively large user submissions (by POST) using the current
version of mod_python. The exact cause of the problem was identified with
the help of "tcpdump".

Sincerely, L.A.Timochouk


From gstein at lyra.org  Mon Aug 14 12:53:29 2000
From: gstein at lyra.org (Greg Stein)
Date: Fri Jan  9 21:58:36 2004
Subject: [mod_python] A patch for mod_python-2.4.1 (fwd)
In-Reply-To: <Pine.LNX.4.21.0008141206500.2308-100000@saturn.ispol.com>; from grisha@ispol.com on Mon, Aug 14, 2000 at 12:08:19PM -0400
References: <Pine.LNX.4.21.0008141206500.2308-100000@saturn.ispol.com>
Message-ID: <20000814125329.X19525@lyra.org>

Nope. Haven't been reading it.

ap_get_client_block() returns a length. It can definitely return a length
less than that requested.

Or is it that length==0 gets returned before the end of the request? (which
would typically end the read loop)

Cheers,
-g

On Mon, Aug 14, 2000 at 12:08:19PM -0400, Gregory Trubetskoy wrote:
> 
> Greg -
> 
> Are you following this thread? This could could qualify as a bug in
> Apache if Dr. Timochouk is right.
> 
> Grisha
> 
> 
> ---------- Forwarded message ----------
> Date: Mon, 14 Aug 2000 15:44:19 +0100 (BST)
> From: Dr. L.A. Timochouk <L.A.Timochouk@ukc.ac.uk>
> To: Gregory Trubetskoy <grisha@ispol.com>
> Cc: mod_python@modpython.org
> Subject: Re: [mod_python] A patch for mod_python-2.4.1
> 
> Yes, it appeared to us that "ap_get_client_block" is susceptible to short
> reads -- it indeed reads a BLOCK until the end of the current IP datagram
> but no further. The problem was discovered when we implemented our Web
> site with relatively large user submissions (by POST) using the current
> version of mod_python. The exact cause of the problem was identified with
> the help of "tcpdump".
> 
> Sincerely, L.A.Timochouk

-- 
Greg Stein, http://www.lyra.org/

From jameswalker at clear.net.nz  Wed Aug 16 12:40:15 2000
From: jameswalker at clear.net.nz (James Walker)
Date: Fri Jan  9 21:58:36 2004
Subject: [mod_python] test.py runs even when deleted
Message-ID: <3999e2ef.dc4.0@clear.net.nz>

I've gotten mod_python (from the RPM) working on my Linux 6.2/Apache 1.3.12 box.
 I've sorted out all the <directory> stuff in httpd.conf and gotten the "Hello
to the ...." appear when accessing test.py or for that matter t.py (yes I understand
the "PythonHandler test" thing (I think)).

Now the issue.  I've deleted test.py and have a helloworld.py which has the
handler defined and which puts out a whole heap of html text.  However I still
get the same "Hello to ..." text from test.py (which is deleted!).  This happens
even after restarting apache and/or then rebooting the machine.

Anyone able to figure that one out?  I'm really looking forward to getting into
Python as I find it heaps easier to read/understand then Perl.  But while CGI
based Python scripts is an option I would prefer mod_python.

Hope somone can help,
James Walker.

From jameswalker at clear.net.nz  Thu Aug 17 10:02:52 2000
From: jameswalker at clear.net.nz (James Walker)
Date: Fri Jan  9 21:58:36 2004
Subject: [mod_python] test.py runs even when deleted
References: <3999e2ef.dc4.0@clear.net.nz>
Message-ID: <399B0F8C.208EDBC1@clear.net.nz>

Sorted.  Didn't realise that the .htaccess file actually had some stuff in it.  It's
directives were over-riding those I had in httpd.conf.  I commented those out and it
all started to behave as I was expecting.

Yah!  Off we go.

Cheers,
James.


James Walker wrote:

> I've gotten mod_python (from the RPM) working on my Linux 6.2/Apache 1.3.12 box.
>  I've sorted out all the <directory> stuff in httpd.conf and gotten the "Hello
> to the ...." appear when accessing test.py or for that matter t.py (yes I understand
> the "PythonHandler test" thing (I think)).
>
> Now the issue.  I've deleted test.py and have a helloworld.py which has the
> handler defined and which puts out a whole heap of html text.  However I still
> get the same "Hello to ..." text from test.py (which is deleted!).  This happens
> even after restarting apache and/or then rebooting the machine.
>
> Anyone able to figure that one out?  I'm really looking forward to getting into
> Python as I find it heaps easier to read/understand then Perl.  But while CGI
> based Python scripts is an option I would prefer mod_python.
>
> Hope somone can help,
> James Walker.
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python


From dirk at infostreet.com  Wed Aug 16 17:09:17 2000
From: dirk at infostreet.com (Dirk Leas)
Date: Fri Jan  9 21:58:36 2004
Subject: [mod_python] POSTed form fields?
Message-ID: <NBBBKMMANMGEEBHPJJECKEMDHKAA.dirk@infostreet.com>

How do I access them? I post a form with a hidden field, a text field, and
two fields encoded in the action. I dump all the request values (strings and
tables) and don't see my form fields, only values encoded in the URL. Quick
suggestion?

I've tried mod_python on both linux and win32 and get the same behavior.

Later,
D

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mailman.modpython.org/pipermail/mod_python/attachments/20000816/30422d2c/attachment-0002.htm
From L.A.Timochouk at ukc.ac.uk  Thu Aug 17 01:31:43 2000
From: L.A.Timochouk at ukc.ac.uk (Dr. L.A. Timochouk)
Date: Fri Jan  9 21:58:36 2004
Subject: [mod_python] POSTed form fields?
In-Reply-To: <NBBBKMMANMGEEBHPJJECKEMDHKAA.dirk@infostreet.com>
Message-ID: <Pine.GSO.4.21.0008170121130.7748-100000@myrtle.ukc.ac.uk>

The request object does not contain parsed (or even unparsed) POSTed
fields, so you need to read and parse them yourself:

(1) get the total length of the POSTed data from the "Content-length"
    header (available through the "headers_in" table in the request
    object);

(2) read the data in using the "read" method on the req object; NB:
    in mod_python 2.4.1, "read" can return a shorter data chunk than
    requested ("short read"); a patch had been submitted which
    rectifies the problem; alternatively you can do multiple "read"s
    until you get the whole length of your data;

(3) then you can parse the contents splitting it into key=value
    pairs separated by "&"s. There are some subtleties like multiple
    fields with the same name, file submission by POST,etc, to take
    care about.

Hope it will help,

Leonid Timochouk
Computing Laboratory
University of Kent at Canterbury
England


From kevin at GamesAndTheory.com  Wed Aug 16 21:04:11 2000
From: kevin at GamesAndTheory.com (Kevin Douglas)
Date: Fri Jan  9 21:58:36 2004
Subject: [mod_python] not compiling
Message-ID: <DKEEJHGMIIOMNIJFOCAICEKLCBAA.kevin@GamesAndTheory.com>

apache 1.3.12 and the latest release of mod_python

more info later after i beat it around


(this is also a test message)


h3ll0!
:P


-kev



From grisha at ispol.com  Thu Aug 17 09:05:24 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:58:36 2004
Subject: [mod_python] POSTed form fields?
In-Reply-To: <Pine.GSO.4.21.0008170121130.7748-100000@myrtle.ukc.ac.uk>
Message-ID: <Pine.LNX.4.21.0008170859400.13868-100000@saturn.ispol.com>

In other words, something like:

import cgi

len = int(req.headers_in["content-length"])
form_data = cgi.parse_qs(req.read(len))

Should do it. Dr. Timouchouk is right - if you're POSTing large files
(50K+), then you should check the size returned by read() and read() again
if it wasn't all.

The next release will make this unnecessary - read() will return all there
was to read. It will also follow the apache Timeout directive.

If you're handy with CVS - you can get that code right now from the
sourceforge CVS server.

--
  Gregory (Grisha) Trubetskoy
       grisha@ispol.com

On Thu, 17 Aug 2000, Dr. L.A. Timochouk wrote:

> The request object does not contain parsed (or even unparsed) POSTed
> fields, so you need to read and parse them yourself:
> 
> (1) get the total length of the POSTed data from the "Content-length"
>     header (available through the "headers_in" table in the request
>     object);
> 
> (2) read the data in using the "read" method on the req object; NB:
>     in mod_python 2.4.1, "read" can return a shorter data chunk than
>     requested ("short read"); a patch had been submitted which
>     rectifies the problem; alternatively you can do multiple "read"s
>     until you get the whole length of your data;
> 
> (3) then you can parse the contents splitting it into key=value
>     pairs separated by "&"s. There are some subtleties like multiple
>     fields with the same name, file submission by POST,etc, to take
>     care about.
> 
> Hope it will help,
> 
> Leonid Timochouk
> Computing Laboratory
> University of Kent at Canterbury
> England
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 



From lahondes at pasteur.fr  Thu Aug 17 18:12:09 2000
From: lahondes at pasteur.fr (Raynald de Lahondes)
Date: Fri Jan  9 21:58:36 2004
Subject: [mod_python] configuring mod_python in Debian 2.2
Message-ID: <20000817181209.C13600@pombe.vironc.pasteur.fr>

I am interested in mod_python but have difficulties in configuring the
program. I am using Debian 2.2 binaries, id est:

apache 1.3.9
python 1.5.2

I successfully compiled the lib and installed them in
/usr/lib/python1.5/site-packages/mod_python

the "compileall.py" was ok.

I compiled mod_python as suggested with apxs tool

apxs -I /usr/include/python1.5 -c mod_python.c \
/usr/lib/python1.5/config/libpython1.5.a -lpthread

and copied the resulting mod_python.so in /usr/lib/apache/1.3/

I modified the httpd.conf as suggested (first module, cf FAQ):
LoadModule python_module /usr/lib/apache/1.3/mod_python.so

(apache started OK)
I modified srm.conf (resource file for apache in Debian)

AddHandler python-program .py
PythonHandler test
PythonDebug On

and restarted apache again.

Then I create /var/www/test

and put the example test.py in /var/www/test/test.py

access to http://localfile/test/anything.py

generate an error: (in apache/error.log)

[Thu Aug 17 17:29:03 2000] [error] PythonHandler test: Traceback\
(innermost last):
[Thu Aug 17 17:29:03 2000] [error] PythonHandler test:   File\
"/usr/lib/python1.5/mod_python/apache.py", line 113, in Dispatch
[Thu Aug 17 17:29:03 2000] [error] PythonHandler test:   File\
"/usr/lib/python1.5/mod_python/apache.py", line 246, in import_module
[Thu Aug 17 17:29:03 2000] [error] PythonHandler test: ImportError: No\
module named test

I tried to check directly with python libs but I can't:

>>> from mod_python import apache
Traceback (innermost last):
  File "<stdin>", line 1, in ?
  File "/usr/lib/python1.5/mod_python/apache.py", line 18, in ?
ImportError: No module named _apache
>>> 


I have done nearly all I could do with the documentation I have, I need some
help please !

-- 
Raynald de Lahondes
Unite des Virus Oncogenes - Departement de Biotechnologie
Institut Pasteur - 25, rue du Docteur Roux
75724 Paris Cedex 15 - FRANCE
tel: 01.45.68.84.54 - fax: 01.40.61.30.33 - cellular: 06.15.65.85.08
email: lahondes@pasteur.fr 

From grisha at ispol.com  Thu Aug 17 13:48:49 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:58:36 2004
Subject: [mod_python] configuring mod_python in Debian 2.2
In-Reply-To: <20000817181209.C13600@pombe.vironc.pasteur.fr>
Message-ID: <Pine.LNX.4.21.0008171346430.14123-100000@saturn.ispol.com>

Make sure you have some <Directory> tags, i.e:

<Directory /var/www/test>
	AddHandler python-program .py
	PythonHandler test
	PythonDebug On
</Directory>


On Thu, 17 Aug 2000, Raynald de Lahondes wrote:

> I am interested in mod_python but have difficulties in configuring the
> program. I am using Debian 2.2 binaries, id est:
> 
> apache 1.3.9
> python 1.5.2
> 
> I successfully compiled the lib and installed them in
> /usr/lib/python1.5/site-packages/mod_python
> 
> the "compileall.py" was ok.
> 
> I compiled mod_python as suggested with apxs tool
> 
> apxs -I /usr/include/python1.5 -c mod_python.c \
> /usr/lib/python1.5/config/libpython1.5.a -lpthread
> 
> and copied the resulting mod_python.so in /usr/lib/apache/1.3/
> 
> I modified the httpd.conf as suggested (first module, cf FAQ):
> LoadModule python_module /usr/lib/apache/1.3/mod_python.so
> 
> (apache started OK)
> I modified srm.conf (resource file for apache in Debian)
> 
> AddHandler python-program .py
> PythonHandler test
> PythonDebug On
> 
> and restarted apache again.
> 
> Then I create /var/www/test
> 
> and put the example test.py in /var/www/test/test.py
> 
> access to http://localfile/test/anything.py
> 
> generate an error: (in apache/error.log)
> 
> [Thu Aug 17 17:29:03 2000] [error] PythonHandler test: Traceback\
> (innermost last):
> [Thu Aug 17 17:29:03 2000] [error] PythonHandler test:   File\
> "/usr/lib/python1.5/mod_python/apache.py", line 113, in Dispatch
> [Thu Aug 17 17:29:03 2000] [error] PythonHandler test:   File\
> "/usr/lib/python1.5/mod_python/apache.py", line 246, in import_module
> [Thu Aug 17 17:29:03 2000] [error] PythonHandler test: ImportError: No\
> module named test
> 
> I tried to check directly with python libs but I can't:
> 
> >>> from mod_python import apache
> Traceback (innermost last):
>   File "<stdin>", line 1, in ?
>   File "/usr/lib/python1.5/mod_python/apache.py", line 18, in ?
> ImportError: No module named _apache
> >>> 
> 
> 
> I have done nearly all I could do with the documentation I have, I need some
> help please !
> 
> -- 
> Raynald de Lahondes
> Unite des Virus Oncogenes - Departement de Biotechnologie
> Institut Pasteur - 25, rue du Docteur Roux
> 75724 Paris Cedex 15 - FRANCE
> tel: 01.45.68.84.54 - fax: 01.40.61.30.33 - cellular: 06.15.65.85.08
> email: lahondes@pasteur.fr 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 


From rsalz at caveosystems.com  Thu Aug 17 15:09:08 2000
From: rsalz at caveosystems.com (Rich Salz)
Date: Fri Jan  9 21:58:36 2004
Subject: [mod_python] Swig, and mod_ssl
References: <200007160231.WAA04120@pc1.caveosystems.com>
Message-ID: <399C3854.B91CE827@caveosystems.com>

Back in mid-July, I wrote rsalz@caveosystems.com wrote:
> Swig (http://www.swig.org) is a "compiler" that can parse most C
> header files and automatically generate code for Perl, Tcl, Python,
> and Java.  At a rough guess, approximately half of mod_python.c could
> be replaced by a couple-dozen lines.  I wonder if it makes sense
> to use SWIG, and for sites without it, include the Swig output.
> (Just like some programs include the output of Yacc, for those without it.)
> 
> Second question, which motivated the first: anyone looked at what
> could/should be added to the mod_python objects when mod_ssl is used?

Here is what I am going to end up doing.  I added a "get_swig_handle"
method that returns the request_rec code into the SWIG representation
of a pointer.  I'll then write little SWIG code to pull things out of
the mod_ssl context.  I'll send get_swig_handle and a sample use if
there's interest.
	/r$

From grisha at ispol.com  Thu Aug 17 15:37:54 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:58:36 2004
Subject: [mod_python] Swig, and mod_ssl
In-Reply-To: <399C3854.B91CE827@caveosystems.com>
Message-ID: <Pine.LNX.4.21.0008171533280.14123-100000@saturn.ispol.com>

That'd be interesting to see. 

I'd really appreciate a lamens terms explanation of what it is you're
trying to get out of mod_ssl and what are the steps issues involved with
it? I'm somewhat mod_ssl ingorant - I've used it to set up SSL sites and
I'm somwhat familiar with use of openssl to generate certificates and
such, but I know next to nothing about mod_ssl internals.

P.S. Does SWIG really have to be involved in order for this to work?

--
  Gregory (Grisha) Trubetskoy
       grisha@ispol.com

On Thu, 17 Aug 2000, Rich Salz wrote:

> Back in mid-July, I wrote rsalz@caveosystems.com wrote:
> > Swig (http://www.swig.org) is a "compiler" that can parse most C
> > header files and automatically generate code for Perl, Tcl, Python,
> > and Java.  At a rough guess, approximately half of mod_python.c could
> > be replaced by a couple-dozen lines.  I wonder if it makes sense
> > to use SWIG, and for sites without it, include the Swig output.
> > (Just like some programs include the output of Yacc, for those without it.)
> > 
> > Second question, which motivated the first: anyone looked at what
> > could/should be added to the mod_python objects when mod_ssl is used?
> 
> Here is what I am going to end up doing.  I added a "get_swig_handle"
> method that returns the request_rec code into the SWIG representation
> of a pointer.  I'll then write little SWIG code to pull things out of
> the mod_ssl context.  I'll send get_swig_handle and a sample use if
> there's interest.
> 	/r$
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 


From rsalz at caveosystems.com  Thu Aug 17 15:51:10 2000
From: rsalz at caveosystems.com (Rich Salz)
Date: Fri Jan  9 21:58:36 2004
Subject: [mod_python] Swig, and mod_ssl
References: <Pine.LNX.4.21.0008171533280.14123-100000@saturn.ispol.com>
Message-ID: <399C422E.1387F0CC@caveosystems.com>

> That'd be interesting to see.

Let me play with it a day or two and I'll send the patch along.

> I'd really appreciate a lamens terms explanation of what it is you're
> trying to get out of mod_ssl and what are the steps issues involved with
> it?

The simplest thing is: I want to be able to get the the DN of the client
and their entire cert, if there is one.  With this, I can do all my own
authorization rules in my python code.  Later on, I want to be able to
control what crypto protocols they're using, etc.

> I'm somwhat familiar with use of openssl to generate certificates and
> such, but I know next to nothing about mod_ssl internals.

> P.S. Does SWIG really have to be involved in order for this to work?

No.  It just saves me a lot of time. SWIG is a "compiler" that read C
(and, to some extent) C++ header files, and generates all the python
code to map the datatypes, and wrappers that convert from Py objects to
the C objects, and back.  Simple things (numbers strings) get mapped
directly, others are only exposed as pointers unless you write your own
conversions.  There are some good examples at http://www.swig.org

Ng Pheng Siong has a package, M2Crypto, that exposes most of the OpenSSL
functions up through python (via swig) -- see
http://www.post1.com/home/ngps.  So all I need is a little glue code
(i.e., my get_swig_handle patch) and I can do what I need.
	/r$

From grisha at ispol.com  Fri Aug 18 08:43:26 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:58:36 2004
Subject: [mod_python] Swig, and mod_ssl
In-Reply-To: <399C422E.1387F0CC@caveosystems.com>
Message-ID: <Pine.LNX.4.21.0008180839400.15289-100000@saturn.ispol.com>

On Thu, 17 Aug 2000, Rich Salz wrote:

> The simplest thing is: I want to be able to get the the DN of the client
> and their entire cert

BTW, one way to get DN is "SSLOptions +FakeBasicAuth", then the DN should
appear in req.connection.user.

http://www.modssl.org/docs/2.6/ssl_howto.html#ToC9


Grisha


From rsalz at caveosystems.com  Fri Aug 18 09:34:02 2000
From: rsalz at caveosystems.com (Rich Salz)
Date: Fri Jan  9 21:58:36 2004
Subject: [mod_python] Swig, and mod_ssl
References: <Pine.LNX.4.21.0008180839400.15289-100000@saturn.ispol.com>
Message-ID: <399D3B4A.7C5772BB@caveosystems.com>

> BTW, one way to get DN is "SSLOptions +FakeBasicAuth", then the DN should
> appear in req.connection.user.

Right.  But I need more than that.  I need to know *if* there's a client
cert, all the nitty-gritty details of it (e.g., what the keyUsage
extension is), I need to do my own verification, no CRL processing, my
own chain verification, etc.  Lots of stuff.  Ralph did a great job
writing a turn-key application that is great for most folks, but I need
to really get under the hood....

From pereran at yahoo.com  Fri Aug 18 07:57:16 2000
From: pereran at yahoo.com (Niranjan Perera)
Date: Fri Jan  9 21:58:36 2004
Subject: [mod_python] Trying to get mod_python+apache on FreeBSD working.
Message-ID: <20000818145716.24237.qmail@web512.mail.yahoo.com>

Hello:

I am  a newbie.

System: FreeBSD 4.0,
        Apache 1.3.12
        Python 1.5.2

Download mod_python, and followed instructions.

Added the following entry to httpd.conf

AddModule mod_python.c
<Directory /usr/local/www/data>
        AddHandler python-program .py
        PythonHandler test
        PythonDebug On
</Directory>

Placed in /usr/local/www/data the following code (
demo.py )
from mod_python import apache

def handler(req):
        req.send_http_header()
        req.write("Hello from Python!")
        return apache.OK

restarted httpd,

when I type http://xxx.yyy.zzz.com/demo.py
I get the following error message:

Mod_python error: "PythonHandler test"

Traceback (innermost last):

  File
"/usr/local/lib/python1.5/site-packages/mod_python/apache.py",
line 116, in Dispatch
    object = self.resolve_object(module, object_str)

  File
"/usr/local/lib/python1.5/site-packages/mod_python/apache.py",
line 51, in resolve_object
    raise AttributeError, s

AttributeError: module
'/usr/local/lib/python1.5/test/__init__.pyc' contains
no 'handler'


What am I missing ?


Thanks,

-- Niranjan






__________________________________________________
Do You Yahoo!?
Send instant messages & get email alerts with Yahoo! Messenger.
http://im.yahoo.com/

From michael at stroeder.com  Fri Aug 18 18:04:51 2000
From: michael at stroeder.com (Michael =?iso-8859-1?Q?Str=F6der?=)
Date: Fri Jan  9 21:58:36 2004
Subject: [mod_python] Swig, and mod_ssl
References: <Pine.LNX.4.21.0008180839400.15289-100000@saturn.ispol.com> <399D3B4A.7C5772BB@caveosystems.com>
Message-ID: <399D5EA3.7975AAEC@stroeder.com>

Rich Salz wrote:
> 
> > BTW, one way to get DN is "SSLOptions +FakeBasicAuth", then the DN 
> > should appear in req.connection.user.
> 
> Right.  But I need more than that.  I need to know *if* there's a client
> cert, all the nitty-gritty details of it (e.g., what the keyUsage
> extension is), I need to do my own verification, no CRL processing, my
> own chain verification, etc.  Lots of stuff.

I'm not sure I fully understand the problem but if you set

  SSLOptions +ExportCertData

you will get the client and server certs "PEM"-formatted exported to
the OS environment in variables SSL_CLIENT_CERT and SSL_SERVER_CERT.

Ciao, Michael.

From wmedia at hotmail.com  Fri Aug 18 12:22:02 2000
From: wmedia at hotmail.com (William Smith)
Date: Fri Jan  9 21:58:37 2004
Subject: [mod_python] Problems with mod_python
Message-ID: <F2176fQSgeR4UIS42NX000009c4@hotmail.com>

I am using RedHat 6.2 x86, Apache 1.3.12 and mod_python 2.4.1.
I compiled and installed mod_python with apxs.
Apache runs as user nobody and group nobody

I read the modpython archives and have the following server errors
which I saw mentioned in the archive message Aug 2, 2000 by
Boh Heong Yap (bohheong@asiacontent.com):

   make_obcallback(): could not import mod_python.apache.
    make_obcallback(): could not call init.

I tried in httpd.conf both:

<Directory /usr/apache/python>
        AddHandler python-program .py
        PythonHandler test
        PythonDebug On
</Directory>

and

<Directory /usr/apache/python>
    AddHandler python-program .py
    PythonHandler test
    PythonDebug On
</Directory>

which I also saw in the archives as a fix.  However this did not work.

The directories and files in
/usr/lib/python1.5/site-packages/mod_python are world readable but
owned by root.

Using the comand line I get:

File "/usr/lib/python1.5/site-packages/mod_python/apache.py", line
18, in ?
    import _apache
ImportError: No module named _apache

when I try "from mod_python import apache".

Any help getting this to work would be appreciated.
________________________________________________________________________
Get Your Private, Free E-mail from MSN Hotmail at http://www.hotmail.com


From rsalz at caveosystems.com  Fri Aug 18 12:29:42 2000
From: rsalz at caveosystems.com (Rich Salz)
Date: Fri Jan  9 21:58:37 2004
Subject: [mod_python] Swig, and mod_ssl
References: <Pine.LNX.4.21.0008180839400.15289-100000@saturn.ispol.com> <399D3B4A.7C5772BB@caveosystems.com> <399D5EA3.7975AAEC@stroeder.com>
Message-ID: <399D6476.62BE89E7@caveosystems.com>

>   SSLOptions +ExportCertData

Yes, thanks.  I need more than that.  I need just about full
programmatic control over SSL within my python module.

From grisha at ispol.com  Fri Aug 18 12:30:04 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:58:37 2004
Subject: [mod_python] Swig, and mod_ssl
In-Reply-To: <399D5EA3.7975AAEC@stroeder.com>
Message-ID: <Pine.LNX.4.21.0008181228110.18108-100000@saturn.ispol.com>


If that is correct - then all that stuff should show up in 

req.subprocess_env["SSL_CLIENT_CERT"] and ["SSL_SERVER_CERT"]

:-)

Rich - could you verify this?

Grisha

On Fri, 18 Aug 2000, Michael Str?der wrote:

> I'm not sure I fully understand the problem but if you set
> 
>   SSLOptions +ExportCertData
> 
> you will get the client and server certs "PEM"-formatted exported to
> the OS environment in variables SSL_CLIENT_CERT and SSL_SERVER_CERT.



From grisha at ispol.com  Fri Aug 18 12:38:23 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:58:37 2004
Subject: [mod_python] Problems with mod_python
In-Reply-To: <F2176fQSgeR4UIS42NX000009c4@hotmail.com>
Message-ID: <Pine.LNX.4.21.0008181237490.18108-100000@saturn.ispol.com>

the only thing I can think of is that the direcories where mod_python is
should also be world executable...

Grisha

On Fri, 18 Aug 2000, William Smith wrote:

> I am using RedHat 6.2 x86, Apache 1.3.12 and mod_python 2.4.1.
> I compiled and installed mod_python with apxs.
> Apache runs as user nobody and group nobody
> 
> I read the modpython archives and have the following server errors
> which I saw mentioned in the archive message Aug 2, 2000 by
> Boh Heong Yap (bohheong@asiacontent.com):
> 
>    make_obcallback(): could not import mod_python.apache.
>     make_obcallback(): could not call init.
> 
> I tried in httpd.conf both:
> 
> <Directory /usr/apache/python>
>         AddHandler python-program .py
>         PythonHandler test
>         PythonDebug On
> </Directory>
> 
> and
> 
> <Directory /usr/apache/python>
>     AddHandler python-program .py
>     PythonHandler test
>     PythonDebug On
> </Directory>
> 
> which I also saw in the archives as a fix.  However this did not work.
> 
> The directories and files in
> /usr/lib/python1.5/site-packages/mod_python are world readable but
> owned by root.
> 
> Using the comand line I get:
> 
> File "/usr/lib/python1.5/site-packages/mod_python/apache.py", line
> 18, in ?
>     import _apache
> ImportError: No module named _apache
> 
> when I try "from mod_python import apache".
> 
> Any help getting this to work would be appreciated.
> ________________________________________________________________________
> Get Your Private, Free E-mail from MSN Hotmail at http://www.hotmail.com
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 


From rsalz at caveosystems.com  Fri Aug 18 12:46:12 2000
From: rsalz at caveosystems.com (Rich Salz)
Date: Fri Jan  9 21:58:37 2004
Subject: [mod_python] Swig, and mod_ssl
References: <Pine.LNX.4.21.0008181228110.18108-100000@saturn.ispol.com>
Message-ID: <399D6854.B5B21303@caveosystems.com>

> >   SSLOptions +ExportCertData
> req.subprocess_env["SSL_CLIENT_CERT"] and ["SSL_SERVER_CERT"]
> Rich - could you verify this?

sure, yup, works fine.  The PEM-encoded server cert (and the client one,
if presented) is ther.  That's not enough for my app, but maybe that's
enough for everyone else, and my little hack isn't needed.
	/r$

From michael at stroeder.com  Fri Aug 18 19:10:49 2000
From: michael at stroeder.com (Michael =?iso-8859-1?Q?Str=F6der?=)
Date: Fri Jan  9 21:58:37 2004
Subject: [mod_python] Swig, and mod_ssl
References: <Pine.LNX.4.21.0008180839400.15289-100000@saturn.ispol.com> <399D3B4A.7C5772BB@caveosystems.com> <399D5EA3.7975AAEC@stroeder.com> <399D6476.62BE89E7@caveosystems.com>
Message-ID: <399D6E19.2B7BA55E@stroeder.com>

Rich Salz wrote:
> 
> >   SSLOptions +ExportCertData
> 
> Yes, thanks.  I need more than that.  I need just about full
> programmatic control over SSL within my python module.

You want to have your own Python written verify callback before
mod_ssl accepts the cert as being valid?

Ciao, Michael.

From grisha at ispol.com  Fri Aug 18 16:50:49 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:58:37 2004
Subject: [mod_python] How to define an environment variable for other
 python module to use?
In-Reply-To: <39974AD9.2C33FAE1@ust.hk>
Message-ID: <Pine.LNX.4.21.0008181646320.18916-100000@saturn.ispol.com>

Sorry for a late answer - 

If you are using strictly mod_python (without cgihandler), then the
standard apache SetEnv or PassEnv directives should work.

If you're using cgihandler, and if the python-oracle interface module is
written in C, then most likely it uses the actual process environment. In
this case you will have to use os.putenv() function prior to using the
oracle interface. Otherwise, simply assigning something to os.environ
should do it.

Does this answer your question?

--
  Gregory (Grisha) Trubetskoy
       grisha@ispol.com

On Mon, 14 Aug 2000, David YEUNG wrote:

> I have other python modules which usually need to read some environment
> variables, e.g., an python-oracle interface module needs to read the "ORACLE_SID"
> to know where the database to connect. I used to defining this variable in the "shell"
> before invoking a python CGI program, e.g.:
> 
>    #!/bin/sh
>    export ORACLE_SID=orcl
>    exec /some/oracle/python/interface.cgi
> 
> I would like to try the mod_python using the default CGI handler, but does someone
> know how to define some environment variable in mod_python?
> 
> Thanks
> 
> david
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 


From dyeung at ust.hk  Sat Aug 19 08:15:27 2000
From: dyeung at ust.hk (David Yeung)
Date: Fri Jan  9 21:58:37 2004
Subject: [mod_python] How to define an environment variable for otherpython 
 module to use?
References: <Pine.LNX.4.21.0008181646320.18916-100000@saturn.ispol.com>
Message-ID: <399DD19F.F4CC2B0E@ust.hk>

Gregory

According to the Python document, if os.putvar is used to change the
environment, such changes only affect subprocesses started with
os.system(), popen(), fork() and execv(), so it is probably not
able to solve the problem.

Thanks

david


Gregory Trubetskoy wrote:
> 
> Sorry for a late answer -
> 
> If you are using strictly mod_python (without cgihandler), then the
> standard apache SetEnv or PassEnv directives should work.
> 
> If you're using cgihandler, and if the python-oracle interface module is
> written in C, then most likely it uses the actual process environment. In
> this case you will have to use os.putenv() function prior to using the
> oracle interface. Otherwise, simply assigning something to os.environ
> should do it.
> 
> Does this answer your question?
> 
> --
>   Gregory (Grisha) Trubetskoy
>        grisha@ispol.com
> 
> On Mon, 14 Aug 2000, David YEUNG wrote:
> 
> > I have other python modules which usually need to read some environment
> > variables, e.g., an python-oracle interface module needs to read the "ORACLE_SID"
> > to know where the database to connect. I used to defining this variable in the "shell"
> > before invoking a python CGI program, e.g.:
> >
> >    #!/bin/sh
> >    export ORACLE_SID=orcl
> >    exec /some/oracle/python/interface.cgi
> >
> > I would like to try the mod_python using the default CGI handler, but does someone
> > know how to define some environment variable in mod_python?
> >
> > Thanks
> >
> > david
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://www.modpython.org/mailman/listinfo/mod_python
> >

From lahondes at pasteur.fr  Mon Aug 21 10:22:11 2000
From: lahondes at pasteur.fr (Raynald de Lahondes)
Date: Fri Jan  9 21:58:37 2004
Subject: [mod_python] Problems with mod_python
In-Reply-To: <F2176fQSgeR4UIS42NX000009c4@hotmail.com>; from wmedia@hotmail.com on Fri, Aug 18, 2000 at 12:22:02PM -0400
References: <F2176fQSgeR4UIS42NX000009c4@hotmail.com>
Message-ID: <20000821102211.A19171@pombe.vironc.pasteur.fr>

On Fri, Aug 18, 2000 at 12:22:02PM -0400, William Smith wrote:
> I am using RedHat 6.2 x86, Apache 1.3.12 and mod_python 2.4.1.
> I compiled and installed mod_python with apxs.
> Apache runs as user nobody and group nobody
>
> I read the modpython archives and have the following server errors
> which I saw mentioned in the archive message Aug 2, 2000 by
> Boh Heong Yap (bohheong@asiacontent.com):
>
>    make_obcallback(): could not import mod_python.apache.
>     make_obcallback(): could not call init.

Are you sure you installed the libs properly ? (I think I had those errors
when libs where not OK). When the python libs were installed (Ist part of
Install) recompiling whith apxs and re-installing the mod_python.so solved
the pb.

> Using the comand line I get:
> 
> File "/usr/lib/python1.5/site-packages/mod_python/apache.py", line
> 18, in ?
>     import _apache
> ImportError: No module named _apache
> 
> when I try "from mod_python import apache".
> 

I am not familiar neither with external extension of python nor apache but I
understand that "import _apache" only works within apache module, because
it's a call to mod_python.so code. Anyway my mod-python works and "import
_apache" still does not work...

I hope you find this usefull.

Raynald de Lahond?s
lahondes@pasteur.fr


From grisha at ispol.com  Mon Aug 21 16:54:29 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:58:37 2004
Subject: [mod_python] How to define an environment variable for otherpython
  module to use?
In-Reply-To: <399DD19F.F4CC2B0E@ust.hk>
Message-ID: <Pine.LNX.4.21.0008211652540.7663-100000@saturn.ispol.com>

David - 

I just looked at the docs, and I didn't see the word "only" mentioned
anywhere.

Grisha


On Sat, 19 Aug 2000, David Yeung wrote:

> Gregory
> 
> According to the Python document, if os.putvar is used to change the
> environment, such changes only affect subprocesses started with
> os.system(), popen(), fork() and execv(), so it is probably not
> able to solve the problem.
> 
> Thanks
> 
> david
> 
> 
> Gregory Trubetskoy wrote:
> > 
> > Sorry for a late answer -
> > 
> > If you are using strictly mod_python (without cgihandler), then the
> > standard apache SetEnv or PassEnv directives should work.
> > 
> > If you're using cgihandler, and if the python-oracle interface module is
> > written in C, then most likely it uses the actual process environment. In
> > this case you will have to use os.putenv() function prior to using the
> > oracle interface. Otherwise, simply assigning something to os.environ
> > should do it.
> > 
> > Does this answer your question?
> > 
> > --
> >   Gregory (Grisha) Trubetskoy
> >        grisha@ispol.com
> > 
> > On Mon, 14 Aug 2000, David YEUNG wrote:
> > 
> > > I have other python modules which usually need to read some environment
> > > variables, e.g., an python-oracle interface module needs to read the "ORACLE_SID"
> > > to know where the database to connect. I used to defining this variable in the "shell"
> > > before invoking a python CGI program, e.g.:
> > >
> > >    #!/bin/sh
> > >    export ORACLE_SID=orcl
> > >    exec /some/oracle/python/interface.cgi
> > >
> > > I would like to try the mod_python using the default CGI handler, but does someone
> > > know how to define some environment variable in mod_python?
> > >
> > > Thanks
> > >
> > > david
> > > _______________________________________________
> > > Mod_python mailing list
> > > Mod_python@modpython.org
> > > http://www.modpython.org/mailman/listinfo/mod_python
> > >
> 


From bryan at optimumnetwork.com  Tue Aug 22 12:00:04 2000
From: bryan at optimumnetwork.com (Bryan O'Shea)
Date: Fri Jan  9 21:58:37 2004
Subject: [mod_python] Build errors with php-4.0.1pl2
Message-ID: <39A224F4.14224BCE@optimumnetwork.com>

i am having troubles building with php-4.0.1pl2 and mod_python-2.4.1
i compiled installed php then followed installs instructions for
mod_python then went to build apache with

./configure --prefix=/home/apache
--activate-module=src/modules/extra/mod_python.c \
--activate-module=src/modules/php4/libphp4.a

if i build with one or the other the build turns out ok. when i
build both modules together it flops


any help would be apreciated
thanks

************************************************************************************************

<=== src/modules/standard
===> src/modules/extra
gcc -c -I/usr/local/include/python1.5 -I../../os/unix -I../../include
-DLINUX=2 -I/home/bryan/src/php-4.0.1pl2
-I/home/bryan/src/php-4.0.1pl2/main -I/home/bryan/src/php-4.0.1pl2/main
-I/home/bryan/src/php-4.0.1pl2/Zend -I/home/bryan/src/php-4.0.1pl2/Zend
-I/home/bryan/src/php-4.0.1pl2 -DUSE_EXPAT -I../../lib/expat-lite
-DNO_DL_NEEDED `../../apaci` mod_python.c
rm -f libextra.a
ar cr libextra.a mod_python.o
ranlib libextra.a
<=== src/modules/extra
===> src/modules/php4
gcc -c -I/usr/local/include/python1.5 -I../../os/unix -I../../include
-DLINUX=2 -I/home/bryan/src/php-4.0.1pl2
-I/home/bryan/src/php-4.0.1pl2/main -I/home/bryan/src/php-4.0.1pl2/main
-I/home/bryan/src/php-4.0.1pl2/Zend -I/home/bryan/src/php-4.0.1pl2/Zend
-I/home/bryan/src/php-4.0.1pl2 -DUSE_EXPAT -I../../lib/expat-lite
-DNO_DL_NEEDED `../../apaci`  mod_php4.c
cp libmodphp4.a libphp4.a
ar r libphp4.a mod_php4.o
ranlib libphp4.a
<=== src/modules/php4
<=== src/modules
gcc -c -I/usr/local/include/python1.5 -I./os/unix -I./include
-DLINUX=2 -I/home/bryan/src/php-4.0.1pl2
-I/home/bryan/src/php-4.0.1pl2/main -I/home/bryan/src/php-4.0.1pl2/main
-I/home/bryan/src/php-4.0.1pl2/Zend -I/home/bryan/src/php-4.0.1pl2/Zend
-I/home/bryan/src/php-4.0.1pl2 -DUSE_EXPAT -I./lib/expat-lite
-DNO_DL_NEEDED `./apaci` modules.c
gcc -c -I/usr/local/include/python1.5 -I./os/unix -I./include
-DLINUX=2 -I/home/bryan/src/php-4.0.1pl2
-I/home/bryan/src/php-4.0.1pl2/main -I/home/bryan/src/php-4.0.1pl2/main
-I/home/bryan/src/php-4.0.1pl2/Zend -I/home/bryan/src/php-4.0.1pl2/Zend
-I/home/bryan/src/php-4.0.1pl2 -DUSE_EXPAT -I./lib/expat-lite
-DNO_DL_NEEDED `./apaci` buildmark.c
gcc  -DLINUX=2 -I/home/bryan/src/php-4.0.1pl2
-I/home/bryan/src/php-4.0.1pl2/main -I/home/bryan/src/php-4.0.1pl2/main
-I/home/bryan/src/php-4.0.1pl2/Zend -I/home/bryan/src/php-4.0.1pl2/Zend
-I/home/bryan/src/php-4.0.1pl2 -DUSE_EXPAT -I./lib/expat-lite
-DNO_DL_NEEDED `./apaci` -Xlinker -export-dynamic       \
      -o httpd buildmark.o modules.o modules/standard/libstandard.a
modules/extra/libextra.a modules/php4/libphp4.a main/libmain.a
./os/unix/libos.a ap/libap.a  lib/expat-lite/libexpat.a
-Wl,-rpath,/usr/local/mysql/lib/mysql -Wl,-rpath,/usr/local/pgsql/lib
-rdynamic -L/usr/local/mysql/lib/mysql -L/usr/local/pgsql/lib
-Lmodules/php4 -L../modules/php4 -L../../modules/php4 -lmodphp4  -lgdbm
-lpam  -ldl -lpq -lmysqlclient -lresolv -lm -ldl -lcrypt -lnsl
-lresolv  -lm -lcrypt /usr/local/lib/python1.5/config/libpython1.5.a
-lieee -lnet -ldl  -lpthread   -lm
/usr/local/lib/python1.5/config/libpython1.5.a(pypcre.o): In function
`pcre_study':
/home/bryan/src/Python-1.5.2/Modules/./pypcre.c:501: multiple definition

of `pcre_malloc'
modules/php4/libphp4.a(pcre.o):/home/bryan/src/php-4.0.1pl2/ext/pcre/pcrelib/pcre.c:238:

first defined here
/usr/local/lib/python1.5/config/libpython1.5.a(pypcre.o): In function
`pcre_study':
/home/bryan/src/Python-1.5.2/Modules/./pypcre.c:501: multiple definition

of `pcre_free'
modules/php4/libphp4.a(pcre.o):/home/bryan/src/php-4.0.1pl2/ext/pcre/pcrelib/pcre.c:238:

first defined here
collect2: ld returned 1 exit status
make[2]: *** [target_static] Error 1
make[2]: Leaving directory `/home/bryan/src/apache_1.3.12/src'
make[1]: *** [build-std] Error 2
make[1]: Leaving directory `/home/bryan/src/apache_1.3.12'
make: *** [build] Error 2




From chris at zeus.foote.com.au  Wed Aug 23 14:12:05 2000
From: chris at zeus.foote.com.au (Chris Foote)
Date: Fri Jan  9 21:58:37 2004
Subject: [mod_python] interoperability with cgi module
Message-ID: <Pine.BSF.4.20.0008231317520.26683-100000@localhost>

Is there any way of getting the CGI environment from mod_python
(i.e. via req.add_common_vars()) usable by the Python libraries
standard cgi module ?

e.g. something like the following (html form POST's to this script):

import os
import cgi
from mod_python import apache

def handler(req):
	req.content_type  = "text/plain"
	req.send_http_header()
	
	req.add_common_vars()
	
	# add req's CGI vars into the environment
	for k in req.subprocess_env.keys():
		os.environ[k] = req.subprocess_env[k]

	form = cgi.FieldStorage()
	cgi.parse_header(str(req.headers_in))

	len = int(req.headers_in["content-length"])
	form_data = req.read(len)
	cgi.parse_qs(form_data)

	cgi.test()
	if form.has_key("field"):
		req.write('field = ' + form["field"].value + '\n')

	return apache.OK

however, the cgi module doesn't display anything for cgi.test()
and form['field'] doesn't exist.

I'm new to Python, and especially mod_pythod - am I going about
this in the wrong way ?  i.e. should I be bothering with the cgi
module at all ?



Cheers,

Chris Foote                        chris@zeus.foote.com.au


From R.Barrett at ftel.co.uk  Wed Aug 23 11:30:18 2000
From: R.Barrett at ftel.co.uk (Richard Barrett)
Date: Fri Jan  9 21:58:37 2004
Subject: [mod_python] extended access to conn_rec
Message-ID: <v04220803b5c94cb54996@[172.16.3.104]>

I've started working with mod_python-2.4.1; good stuff.

I wanted to access the local_addr and remote_addr fields of the 
conn_rec struct but access to the fields is not supported via the 
connection object by mod_python.so

Accordingly I've added some code to mod_python.c to return the 
contents of these fields. The code is a minor variation of functions 
'borrowed' from socketmodule.c in the standard Python 1.5.2 
distribution. The python object returned is the same as that returned 
by the getpeername and getsockname member functions on standard 
socket objects. I would have called functions makeipaddr  and 
makesockaddr in socketmodule.so instead of adding copies to 
mod_python but they are declared as static in socketmodule.c and 
hence are unavailable.

If there is a better way of doing this or anything I've said above is 
rubbish I would appreciate some (polite) feedback. I don't claim any 
particular expertise with C or python extensions so some reader may 
find fault with this stuff. But it works for me so far.

The diff for my changes to mod_python.c follow:
-----------------------------------------------------


91a92,94
>  /* Other headers */
>  #include <sys/socket.h>
>
928a932,954
>  static PyObject *
>  mymakeipaddr(struct sockaddr_in *addr)
>  {
>      long x = ntohl(addr->sin_addr.s_addr);
>      char buf[100];
>      sprintf(buf, "%d.%d.%d.%d",
>          (int) (x>>24) & 0xff, (int) (x>>16) & 0xff,
>          (int) (x>> 8) & 0xff, (int) (x>> 0) & 0xff);
>      return PyString_FromString(buf);
>  }
>
>  static PyObject *
>  mymakesockaddr(struct sockaddr_in *addr)
>  {
>      PyObject *addrobj = mymakeipaddr(addr);
>      PyObject *ret = NULL;
>      if (addrobj) {
>          ret = Py_BuildValue("Oi", addrobj, ntohs(addr->sin_port));
>          Py_DECREF(addrobj);
>      }
>      return ret;
>  }
>
968a995,1000
>      else if (strcmp(name, "local_addr") == 0) {
>  		return mymakesockaddr(&(self->conn->local_addr));
>  	}
>      else if (strcmp(name, "remote_addr") == 0) {
>  		return mymakesockaddr(&(self->conn->remote_addr));
>  	}
------------------------------------------------------------------
Richard Barrett, PostPoint 27,         e-mail:r.barrett@ftel.co.uk
Fujitsu Telecommunications Europe Ltd,      tel: (44) 121 717 6337
Solihull Parkway, Birmingham Business Park, B37 7YU, England
"Democracy is two wolves and a lamb voting on what to have for
lunch. Liberty is a well armed lamb contesting the vote."
Benjamin Franklin, 1759
------------------------------------------------------------------

From grisha at ispol.com  Wed Aug 23 09:22:50 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:58:37 2004
Subject: [mod_python] interoperability with cgi module
In-Reply-To: <Pine.BSF.4.20.0008231317520.26683-100000@localhost>
Message-ID: <Pine.LNX.4.21.0008230920200.14880-100000@saturn.ispol.com>

Look at how it's done in the cgihandler:
http://www.modpython.org/live/mod_python-2.4.1/lib/python/mod_python/cgihandler.py

apache.setup_cgi() is what you need.

as a shortcut, I think 

os.env = req.subprocess_env 

might just do the trick.

Grisha

--
  Gregory (Grisha) Trubetskoy
       grisha@ispol.com

On Wed, 23 Aug 2000, Chris Foote wrote:

> Is there any way of getting the CGI environment from mod_python
> (i.e. via req.add_common_vars()) usable by the Python libraries
> standard cgi module ?
> 
> e.g. something like the following (html form POST's to this script):
> 
> import os
> import cgi
> from mod_python import apache
> 
> def handler(req):
> 	req.content_type  = "text/plain"
> 	req.send_http_header()
> 	
> 	req.add_common_vars()
> 	
> 	# add req's CGI vars into the environment
> 	for k in req.subprocess_env.keys():
> 		os.environ[k] = req.subprocess_env[k]
> 
> 	form = cgi.FieldStorage()
> 	cgi.parse_header(str(req.headers_in))
> 
> 	len = int(req.headers_in["content-length"])
> 	form_data = req.read(len)
> 	cgi.parse_qs(form_data)
> 
> 	cgi.test()
> 	if form.has_key("field"):
> 		req.write('field = ' + form["field"].value + '\n')
> 
> 	return apache.OK
> 
> however, the cgi module doesn't display anything for cgi.test()
> and form['field'] doesn't exist.
> 
> I'm new to Python, and especially mod_pythod - am I going about
> this in the wrong way ?  i.e. should I be bothering with the cgi
> module at all ?
> 
> 
> 
> Cheers,
> 
> Chris Foote                        chris@zeus.foote.com.au
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 


From miguel at yorku.ca  Wed Aug 23 09:35:34 2000
From: miguel at yorku.ca (Miguel Marques)
Date: Fri Jan  9 21:58:37 2004
Subject: [mod_python] interoperability with cgi module
In-Reply-To: <Pine.BSF.4.20.0008231317520.26683-100000@localhost>
References: <Pine.BSF.4.20.0008231317520.26683-100000@localhost>
Message-ID: <20000823093534X.miguel@yorku.ca>

On Wed, 23 Aug 2000 14:12:05 +0930 (CST), Chris Foote <chris@zeus.foote.com.au> wrote:
> Is there any way of getting the CGI environment from mod_python
> (i.e. via req.add_common_vars()) usable by the Python libraries
> standard cgi module ?
> 
> e.g. something like the following (html form POST's to this script):
> 
> import os
> import cgi
> from mod_python import apache
> 
> def handler(req):
> 	req.content_type  = "text/plain"
> 	req.send_http_header()
> 	
> 	req.add_common_vars()
> 	
> 	# add req's CGI vars into the environment
> 	for k in req.subprocess_env.keys():
> 		os.environ[k] = req.subprocess_env[k]
> 
> 	form = cgi.FieldStorage()
> 	cgi.parse_header(str(req.headers_in))
> 
> 	len = int(req.headers_in["content-length"])
> 	form_data = req.read(len)
> 	cgi.parse_qs(form_data)
> 
> 	cgi.test()
> 	if form.has_key("field"):
> 		req.write('field = ' + form["field"].value + '\n')
> 
> 	return apache.OK
> 
> however, the cgi module doesn't display anything for cgi.test()
> and form['field'] doesn't exist.
Above try
    form = cgi.parse_qs(form_data)
to get the POST data.  cgi.parse_qs returns a dictionary with the
data.


						Miguel

C. Miguel Marques, York University, Computing & Communications Services
e-mail: miguel@yorku.ca, voice: (416)736-2100x22684, fax: (416)736-5830


From hdstich at commplex-media.de  Thu Aug 24 09:24:08 2000
From: hdstich at commplex-media.de (Hans-Dieter Stich)
Date: Fri Jan  9 21:58:37 2004
Subject: [mod_python] re.compile problem
Message-ID: <XFMail.000824092408.hdstich@commplex-media.de>

i have seen messages on the mailing list about problems with the compiling of
regular expressons! are there any new hints?

my mod_python is build also dynamically into the apache!

thanx!

ciao
h-d

____________________________________________________________________

  Commplex Media AG             Hans-Dieter Stich/CTO
  Office Ulm                    fon:  +49-7304-434997
  Development Team              fax:  +49-7304-434998
  Spatzenweg 12                 mail: hdstich@commplex-media.de
  89160 Dornstadt               web:  http://www.commplex-media.de/
____________________________________________________________________


From walaces at prasair.com.br  Mon Aug 28 12:23:24 2000
From: walaces at prasair.com.br (Walace Soares)
Date: Fri Jan  9 21:58:37 2004
Subject: [mod_python] Apache Problems
Message-ID: <E13FB1366C26D411BDD9000102240287046FC2@SERVIDOR>

Hi,

I have the mod_python instaled within Apache in a Linux slackware box.
Python is working fine.
But when I am trying to run mod_python, apache show me the message:

Mod_python error: "PythonHandler pytest.py"
Traceback (innermost last): File
"/usr/lib/python1.5/site-packages/mod_python/apache.py", line 113, in
Dispatch module = import_module(module_name, req)
File "/usr/lib/python1.5/site-packages/mod_python/apache.py", line 246, in
import_module module = __import__(module_name)
File "/usr/lib/python1.5/pytest.py", line 3
req.send_httpd header()
		^
SyntaxError: invalid syntax


Could Anyone please help me ?


Walace

My configuration:
Slacware 7.0
Apache 1.3.12
Python 1.5.2
mod_python 2.4.1





From miguel at yorku.ca  Mon Aug 28 11:49:05 2000
From: miguel at yorku.ca (Miguel Marques)
Date: Fri Jan  9 21:58:37 2004
Subject: [mod_python] Apache Problems
In-Reply-To: <E13FB1366C26D411BDD9000102240287046FC2@SERVIDOR>
References: <E13FB1366C26D411BDD9000102240287046FC2@SERVIDOR>
Message-ID: <20000828114905P.miguel@yorku.ca>

On Mon, 28 Aug 2000 12:23:24 -0300, "Walace Soares" <walaces@prasair.com.br> wrote:
> Hi,
> 
> I have the mod_python instaled within Apache in a Linux slackware box.
> Python is working fine.
> But when I am trying to run mod_python, apache show me the message:
> 
> Mod_python error: "PythonHandler pytest.py"
> Traceback (innermost last): File
> "/usr/lib/python1.5/site-packages/mod_python/apache.py", line 113, in
> Dispatch module = import_module(module_name, req)
> File "/usr/lib/python1.5/site-packages/mod_python/apache.py", line 246, in
> import_module module = __import__(module_name)
> File "/usr/lib/python1.5/pytest.py", line 3
> req.send_httpd header()
> 		^
> SyntaxError: invalid syntax
I think that should be:
req.send_http_header()

							Miguel

C. Miguel Marques, York University, Computing & Communications Services
e-mail: miguel@yorku.ca, voice: (416)736-2100x22684, fax: (416)736-5830

From bryan at optimumnetwork.com  Tue Aug 29 14:14:54 2000
From: bryan at optimumnetwork.com (Bryan O'Shea)
Date: Fri Jan  9 21:58:37 2004
Subject: [mod_python] test
Message-ID: <39AB7F0E.6219DB78@optimumnetwork.com>

does the list work ??


From bryan at optimumnetwork.com  Tue Aug 29 14:48:53 2000
From: bryan at optimumnetwork.com (Bryan O'Shea)
Date: Fri Jan  9 21:58:37 2004
Subject: [mod_python] php and mod_python compile problems with apache
Message-ID: <39AB8705.D8532012@optimumnetwork.com>

i am having troubles building with php-4.0.1pl2 and mod_python-2.4.1
i compiled installed php then followed installs instructions for
mod_python then went to build apache with

./configure --prefix=/home/apache
--activate-module=src/modules/extra/mod_python.c \
--activate-module=src/modules/php4/libphp4.a

if i build with one or the other the build turns out ok. when i
build both modules together it flops


any help would be apreciated
thanks

************************************************************************************************

<=== src/modules/standard
===> src/modules/extra
gcc -c -I/usr/local/include/python1.5 -I../../os/unix -I../../include
-DLINUX=2 -I/home/bryan/src/php-4.0.1pl2
-I/home/bryan/src/php-4.0.1pl2/main -I/home/bryan/src/php-4.0.1pl2/main
-I/home/bryan/src/php-4.0.1pl2/Zend -I/home/bryan/src/php-4.0.1pl2/Zend
-I/home/bryan/src/php-4.0.1pl2 -DUSE_EXPAT -I../../lib/expat-lite
-DNO_DL_NEEDED `../../apaci` mod_python.c
rm -f libextra.a
ar cr libextra.a mod_python.o
ranlib libextra.a
<=== src/modules/extra
===> src/modules/php4
gcc -c -I/usr/local/include/python1.5 -I../../os/unix -I../../include
-DLINUX=2 -I/home/bryan/src/php-4.0.1pl2
-I/home/bryan/src/php-4.0.1pl2/main -I/home/bryan/src/php-4.0.1pl2/main
-I/home/bryan/src/php-4.0.1pl2/Zend -I/home/bryan/src/php-4.0.1pl2/Zend
-I/home/bryan/src/php-4.0.1pl2 -DUSE_EXPAT -I../../lib/expat-lite
-DNO_DL_NEEDED `../../apaci`  mod_php4.c
cp libmodphp4.a libphp4.a
ar r libphp4.a mod_php4.o
ranlib libphp4.a
<=== src/modules/php4
<=== src/modules
gcc -c -I/usr/local/include/python1.5 -I./os/unix -I./include
-DLINUX=2 -I/home/bryan/src/php-4.0.1pl2
-I/home/bryan/src/php-4.0.1pl2/main -I/home/bryan/src/php-4.0.1pl2/main
-I/home/bryan/src/php-4.0.1pl2/Zend -I/home/bryan/src/php-4.0.1pl2/Zend
-I/home/bryan/src/php-4.0.1pl2 -DUSE_EXPAT -I./lib/expat-lite
-DNO_DL_NEEDED `./apaci` modules.c
gcc -c -I/usr/local/include/python1.5 -I./os/unix -I./include
-DLINUX=2 -I/home/bryan/src/php-4.0.1pl2
-I/home/bryan/src/php-4.0.1pl2/main -I/home/bryan/src/php-4.0.1pl2/main
-I/home/bryan/src/php-4.0.1pl2/Zend -I/home/bryan/src/php-4.0.1pl2/Zend
-I/home/bryan/src/php-4.0.1pl2 -DUSE_EXPAT -I./lib/expat-lite
-DNO_DL_NEEDED `./apaci` buildmark.c
gcc  -DLINUX=2 -I/home/bryan/src/php-4.0.1pl2
-I/home/bryan/src/php-4.0.1pl2/main -I/home/bryan/src/php-4.0.1pl2/main
-I/home/bryan/src/php-4.0.1pl2/Zend -I/home/bryan/src/php-4.0.1pl2/Zend
-I/home/bryan/src/php-4.0.1pl2 -DUSE_EXPAT -I./lib/expat-lite
-DNO_DL_NEEDED `./apaci` -Xlinker -export-dynamic       \
      -o httpd buildmark.o modules.o modules/standard/libstandard.a
modules/extra/libextra.a modules/php4/libphp4.a main/libmain.a
./os/unix/libos.a ap/libap.a  lib/expat-lite/libexpat.a
-Wl,-rpath,/usr/local/mysql/lib/mysql -Wl,-rpath,/usr/local/pgsql/lib
-rdynamic -L/usr/local/mysql/lib/mysql -L/usr/local/pgsql/lib
-Lmodules/php4 -L../modules/php4 -L../../modules/php4 -lmodphp4  -lgdbm
-lpam  -ldl -lpq -lmysqlclient -lresolv -lm -ldl -lcrypt -lnsl
-lresolv  -lm -lcrypt /usr/local/lib/python1.5/config/libpython1.5.a
-lieee -lnet -ldl  -lpthread   -lm
/usr/local/lib/python1.5/config/libpython1.5.a(pypcre.o): In function
`pcre_study':
/home/bryan/src/Python-1.5.2/Modules/./pypcre.c:501: multiple definition

of `pcre_malloc'
modules/php4/libphp4.a(pcre.o):/home/bryan/src/php-4.0.1pl2/ext/pcre/pcrelib/pcre.c:238:

first defined here
/usr/local/lib/python1.5/config/libpython1.5.a(pypcre.o): In function
`pcre_study':
/home/bryan/src/Python-1.5.2/Modules/./pypcre.c:501: multiple definition

of `pcre_free'
modules/php4/libphp4.a(pcre.o):/home/bryan/src/php-4.0.1pl2/ext/pcre/pcrelib/pcre.c:238:

first defined here
collect2: ld returned 1 exit status
make[2]: *** [target_static] Error 1
make[2]: Leaving directory `/home/bryan/src/apache_1.3.12/src'
make[1]: *** [build-std] Error 2
make[1]: Leaving directory `/home/bryan/src/apache_1.3.12'
make: *** [build] Error 2






From grisha at ispol.com  Tue Aug 29 15:39:07 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 21:58:37 2004
Subject: [mod_python] php and mod_python compile problems with apache
In-Reply-To: <39AB8705.D8532012@optimumnetwork.com>
Message-ID: <Pine.LNX.4.21.0008291537030.15779-100000@saturn.ispol.com>

I know this has something to do with the pcre (regular
expression) library. I think both PHP and Python have to be linked against
the same version or else it won't work. I saw something about this come
across the apache list - apache 2.0 uses pcre as well and that causes some
problems for Python.

Perhaps someone more knowledgeable on the subject can enlighten us?

--
  Gregory (Grisha) Trubetskoy
       grisha@ispol.com

On Tue, 29 Aug 2000, Bryan O'Shea wrote:

> i am having troubles building with php-4.0.1pl2 and mod_python-2.4.1
> i compiled installed php then followed installs instructions for
> mod_python then went to build apache with
> 
> ./configure --prefix=/home/apache
> --activate-module=src/modules/extra/mod_python.c \
> --activate-module=src/modules/php4/libphp4.a
> 
> if i build with one or the other the build turns out ok. when i
> build both modules together it flops
> 
> 
> any help would be apreciated
> thanks
> 
> ************************************************************************************************
> 
> <=== src/modules/standard
> ===> src/modules/extra
> gcc -c -I/usr/local/include/python1.5 -I../../os/unix -I../../include
> -DLINUX=2 -I/home/bryan/src/php-4.0.1pl2
> -I/home/bryan/src/php-4.0.1pl2/main -I/home/bryan/src/php-4.0.1pl2/main
> -I/home/bryan/src/php-4.0.1pl2/Zend -I/home/bryan/src/php-4.0.1pl2/Zend
> -I/home/bryan/src/php-4.0.1pl2 -DUSE_EXPAT -I../../lib/expat-lite
> -DNO_DL_NEEDED `../../apaci` mod_python.c
> rm -f libextra.a
> ar cr libextra.a mod_python.o
> ranlib libextra.a
> <=== src/modules/extra
> ===> src/modules/php4
> gcc -c -I/usr/local/include/python1.5 -I../../os/unix -I../../include
> -DLINUX=2 -I/home/bryan/src/php-4.0.1pl2
> -I/home/bryan/src/php-4.0.1pl2/main -I/home/bryan/src/php-4.0.1pl2/main
> -I/home/bryan/src/php-4.0.1pl2/Zend -I/home/bryan/src/php-4.0.1pl2/Zend
> -I/home/bryan/src/php-4.0.1pl2 -DUSE_EXPAT -I../../lib/expat-lite
> -DNO_DL_NEEDED `../../apaci`  mod_php4.c
> cp libmodphp4.a libphp4.a
> ar r libphp4.a mod_php4.o
> ranlib libphp4.a
> <=== src/modules/php4
> <=== src/modules
> gcc -c -I/usr/local/include/python1.5 -I./os/unix -I./include
> -DLINUX=2 -I/home/bryan/src/php-4.0.1pl2
> -I/home/bryan/src/php-4.0.1pl2/main -I/home/bryan/src/php-4.0.1pl2/main
> -I/home/bryan/src/php-4.0.1pl2/Zend -I/home/bryan/src/php-4.0.1pl2/Zend
> -I/home/bryan/src/php-4.0.1pl2 -DUSE_EXPAT -I./lib/expat-lite
> -DNO_DL_NEEDED `./apaci` modules.c
> gcc -c -I/usr/local/include/python1.5 -I./os/unix -I./include
> -DLINUX=2 -I/home/bryan/src/php-4.0.1pl2
> -I/home/bryan/src/php-4.0.1pl2/main -I/home/bryan/src/php-4.0.1pl2/main
> -I/home/bryan/src/php-4.0.1pl2/Zend -I/home/bryan/src/php-4.0.1pl2/Zend
> -I/home/bryan/src/php-4.0.1pl2 -DUSE_EXPAT -I./lib/expat-lite
> -DNO_DL_NEEDED `./apaci` buildmark.c
> gcc  -DLINUX=2 -I/home/bryan/src/php-4.0.1pl2
> -I/home/bryan/src/php-4.0.1pl2/main -I/home/bryan/src/php-4.0.1pl2/main
> -I/home/bryan/src/php-4.0.1pl2/Zend -I/home/bryan/src/php-4.0.1pl2/Zend
> -I/home/bryan/src/php-4.0.1pl2 -DUSE_EXPAT -I./lib/expat-lite
> -DNO_DL_NEEDED `./apaci` -Xlinker -export-dynamic       \
>       -o httpd buildmark.o modules.o modules/standard/libstandard.a
> modules/extra/libextra.a modules/php4/libphp4.a main/libmain.a
> ./os/unix/libos.a ap/libap.a  lib/expat-lite/libexpat.a
> -Wl,-rpath,/usr/local/mysql/lib/mysql -Wl,-rpath,/usr/local/pgsql/lib
> -rdynamic -L/usr/local/mysql/lib/mysql -L/usr/local/pgsql/lib
> -Lmodules/php4 -L../modules/php4 -L../../modules/php4 -lmodphp4  -lgdbm
> -lpam  -ldl -lpq -lmysqlclient -lresolv -lm -ldl -lcrypt -lnsl
> -lresolv  -lm -lcrypt /usr/local/lib/python1.5/config/libpython1.5.a
> -lieee -lnet -ldl  -lpthread   -lm
> /usr/local/lib/python1.5/config/libpython1.5.a(pypcre.o): In function
> `pcre_study':
> /home/bryan/src/Python-1.5.2/Modules/./pypcre.c:501: multiple definition
> 
> of `pcre_malloc'
> modules/php4/libphp4.a(pcre.o):/home/bryan/src/php-4.0.1pl2/ext/pcre/pcrelib/pcre.c:238:
> 
> first defined here
> /usr/local/lib/python1.5/config/libpython1.5.a(pypcre.o): In function
> `pcre_study':
> /home/bryan/src/Python-1.5.2/Modules/./pypcre.c:501: multiple definition
> 
> of `pcre_free'
> modules/php4/libphp4.a(pcre.o):/home/bryan/src/php-4.0.1pl2/ext/pcre/pcrelib/pcre.c:238:
> 
> first defined here
> collect2: ld returned 1 exit status
> make[2]: *** [target_static] Error 1
> make[2]: Leaving directory `/home/bryan/src/apache_1.3.12/src'
> make[1]: *** [build-std] Error 2
> make[1]: Leaving directory `/home/bryan/src/apache_1.3.12'
> make: *** [build] Error 2
> 
> 
> 
> 
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 


From kkinder at tridog.com  Tue Aug 29 14:36:09 2000
From: kkinder at tridog.com (Ken Kinder)
Date: Fri Jan  9 21:58:37 2004
Subject: [mod_python] PyApache, FastCGI, modpython comparison
Message-ID: <39AC1EB9.E59FDF64@tridog.com>

Can some give me a feel for the differences between PyApache,
FastCGI/Python, ModPython? I would like to know specifically about
portability, performance issues, and process control. I've written much
of a Python-based online store which I plan to Open Source and am now
needing to look at persistance. The non-serial, threaded environment is
a must.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: kkinder.vcf
Type: text/x-vcard
Size: 244 bytes
Desc: Card for Ken Kinder
Url : http://mailman.modpython.org/pipermail/mod_python/attachments/20000829/eebfd259/kkinder-0002.vcf
From bohheong at asiacontent.com  Wed Aug  2 22:41:33 2000
From: bohheong at asiacontent.com (Boh Heong Yap)
Date: Fri Jan  9 22:02:24 2004
Subject: [mod_python] can't start mod_python
Message-ID: <20000803054133.24083@mail.asiacontent.com>

hi, 

I wonder if someone could help. I've been playing with the configuration
of mod_python for the last few days without success. I managed to compile
in mod_pyton statically into in Apache 1.3.12, got it restarted and tested it.

    config details at end...

When I run ~/bin/httpd -l, mod-python.c is displayed.


From grisha at ispol.com  Wed Aug  2 15:22:23 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 22:02:24 2004
Subject: [mod_python] can't start mod_python
In-Reply-To: <20000803054133.24083@mail.asiacontent.com>
Message-ID: <Pine.LNX.4.21.0008021521520.28399-100000@saturn.ispol.com>

Which user does apache run as and what are the permissions on the
mod_python directory and everything in it?

--
  Gregory (Grisha) Trubetskoy
       grisha@ispol.com

On Wed, 2 Aug 2000, Boh Heong Yap wrote:

> hi, 
> 
> I wonder if someone could help. I've been playing with the configuration
> of mod_python for the last few days without success. I managed to compile
> in mod_pyton statically into in Apache 1.3.12, got it restarted and tested it.
> 
>     config details at end...
> 
> When I run ~/bin/httpd -l, mod-python.c is displayed.
> 
> 
> >From the browser, "http://222.64.245.xx/pytest.py", gives the message:-
> 
>     Internal Server Error
> 
>     The server encountered an internal error or misconfiguration and was     
>     unable to complete your request.
> 
> Other normal web request seem to work fine. 
> This is what the error logs show...
> 
>     [Wed Aug  2 20:58:57 2000] [notice] caught SIGTERM, shutting down
>     [Wed Aug  2 20:59:02 2000] [notice] Apache/1.3.12 (Unix) configured
> -- resuming
>         normal operations
>     'import site' failed; use -v for traceback
>     make_obcallback(): could not import mod_python.apache.
>     make_obcallback(): could not call init.
>     [Wed Aug  2 20:59:45 2000] [error] [client 202.77.245.126] python_handler:
>         make_obcallback returned no obCallBack!
> 
> 
> The mod_python module sits in 
> 
>         /usr/local/lib/python1.5/mod_python
> 
>     (along with other .pc. .pyc modules)
> 
> 
> In my httpd.conf (everything is there, no srm.conf, access.conf), I have 
> 
>     AddHandler python-program .py
>     PythonHandler pytest.py
>     PythonDebug on
>     PythonPath "sys.path+['/usr/local/lib/python1.5/mod_python']
> 
> this is within the <Directory..> directives for ~/apache/htdocs.
> pytest.py is same as the "Hello World" example in the tutorial in
> mod_python...
> 
> 
> Also when in the Python interpreter, I try to load stuff manually, 
> ie:
> 
>     >>> from mod_python import apache
>     Traceback (innermost last):
>     File "<stdin>", line 1, in ?
>     File "/usr/local/lib/python1.5/mod_python/apache.py", line 18, in ?
>         import _apache
>     ImportError: No module named _apache
>     >>>
> 
> and apache.py does indeed have the line "import _apache"
> 
> Loading other standard python modules like "sys" works OK, hence I think
> PYTHONPATH seems OK.
> 
> 
> config_info
> ------------------
> Apache - 1.3.12
> Python 1.5, compiled from source, standard
>     (both are installed in /usr/local)
> system Linux Mandrake 7.0, 2.2.12 kernel 
> Compaq box, P3.
> 
> 
> Any help from anyone will be appreciated.
> 
> Hope I can get this working. Would love to use Python for a few things here.
> 
> 
> 
> ----------------------------------------------------------
> Boh-heong Yap
> Project Manager, eCommerce
> 				bohheong@asiacontent.com				
> 
> Asiacontent.com a leading pan-Asian Internet company,
> with focus on: content, advertising and e-commerce.
> -----------------------------------------------------------
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 


From richard at whitequeen.com  Tue Aug  1 08:20:21 2000
From: richard at whitequeen.com (richard offer)
Date: Fri Jan  9 22:02:25 2004
Subject: [mod_python] the return of *Occasional* AttributeError: Handler
Message-ID: <200008011520.e71FKLA03253@whitequeen.com>

 
Hi all,

I've started getting the same error I reported back the beginning of Jul,
in that *occasionaly* I get a

[Tue Aug  1 05:37:12 2000] [error] PythonHandler index: Traceback (innermost last):
[Tue Aug  1 05:37:12 2000] [error] PythonHandler index:   File "/usr/local/lib/python1.5/site-packages/mod_python/apache.py", line 96, in Dispatch
    object = self.resolve_object(module, object_str)
[Tue Aug  1 05:37:12 2000] [error] PythonHandler index:   File "/usr/local/lib/python1.5/site-packages/mod_python/apache.py", line 42, in resolve_object
    obj = getattr(obj, obj_str)
[Tue Aug  1 05:37:12 2000] [error] PythonHandler index: AttributeError: handler


In fact I've probably been getting it all the time, but the person who
I run the site for just got back from vaccation and wanted to see it.

To refresh everyone's memory, the is an occasional (but frequent) error,
my guess is that its timing related, since you can sometimes get it
to disappear by reloading the page---sometimes it will fail elsewhere,
sometimes it works...

My suspicion of it being timing related is reinforced as it never happened
on the development machine, it happens more on the production machine
(same physical machine, but chrooted), and it happens a lot more when
I access the site via the internet (as opposed to via my intranet).

The site in question talks to a MySQL database via a persistant
connection.


Is there any ideas on how to debug this ? Extra diagnostics I can add
in apache.py ?

[ RH 6.1/mod_python 2.4/ DSL ]

thanks.

richard.

-- 
richard offer @ home 
          84 FE 48 E4 74 D0 26 D4  31 8E B6 86 98 74 E2 7C  8A FB BF A3
_______________________________http://www.whitequeen.com/users/richard/
* 



-- 
richard offer @ home 
          84 FE 48 E4 74 D0 26 D4  31 8E B6 86 98 74 E2 7C  8A FB BF A3
_______________________________http://www.whitequeen.com/users/richard/

From grisha at ispol.com  Thu Aug  3 08:17:59 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 22:02:25 2004
Subject: [mod_python] the return of *Occasional* AttributeError: Handler
In-Reply-To: <200008011520.e71FKLA03253@whitequeen.com>
Message-ID: <Pine.LNX.4.21.0008030815040.31424-100000@saturn.ispol.com>

Try upgrading to 2.4.1. It gives you additional info for Attribute errors.

Grisha

On Tue, 1 Aug 2000, richard offer wrote:

> 
>  
> Hi all,
> 
> I've started getting the same error I reported back the beginning of Jul,
> in that *occasionaly* I get a
> 
> [Tue Aug  1 05:37:12 2000] [error] PythonHandler index: Traceback (innermost last):
> [Tue Aug  1 05:37:12 2000] [error] PythonHandler index:   File "/usr/local/lib/python1.5/site-packages/mod_python/apache.py", line 96, in Dispatch
>     object = self.resolve_object(module, object_str)
> [Tue Aug  1 05:37:12 2000] [error] PythonHandler index:   File "/usr/local/lib/python1.5/site-packages/mod_python/apache.py", line 42, in resolve_object
>     obj = getattr(obj, obj_str)
> [Tue Aug  1 05:37:12 2000] [error] PythonHandler index: AttributeError: handler
> 
> 
> In fact I've probably been getting it all the time, but the person who
> I run the site for just got back from vaccation and wanted to see it.
> 
> To refresh everyone's memory, the is an occasional (but frequent) error,
> my guess is that its timing related, since you can sometimes get it
> to disappear by reloading the page---sometimes it will fail elsewhere,
> sometimes it works...
> 
> My suspicion of it being timing related is reinforced as it never happened
> on the development machine, it happens more on the production machine
> (same physical machine, but chrooted), and it happens a lot more when
> I access the site via the internet (as opposed to via my intranet).
> 
> The site in question talks to a MySQL database via a persistant
> connection.
> 
> 
> Is there any ideas on how to debug this ? Extra diagnostics I can add
> in apache.py ?
> 
> [ RH 6.1/mod_python 2.4/ DSL ]
> 
> thanks.
> 
> richard.
> 
> -- 
> richard offer @ home 
>           84 FE 48 E4 74 D0 26 D4  31 8E B6 86 98 74 E2 7C  8A FB BF A3
> _______________________________http://www.whitequeen.com/users/richard/
> * 
> 
> 
> 
> -- 
> richard offer @ home 
>           84 FE 48 E4 74 D0 26 D4  31 8E B6 86 98 74 E2 7C  8A FB BF A3
> _______________________________http://www.whitequeen.com/users/richard/
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 


From jack at icecast.org  Fri Aug  4 23:19:58 2000
From: jack at icecast.org (Jack Moffitt)
Date: Fri Jan  9 22:02:25 2004
Subject: [mod_python] authenhandler not working
Message-ID: <20000804231958.E5841@tk421.icecast.org>

Using the tutorial, i got the first example to work.  

Then i did the second example, and that is not authenticating me.  I
figured I've got a typo somewhere so i modified it to look like:

def authenhandler(req):
        user = req.connection.user
        pw = req.get_basic_auth_pw()

        if user == "spam" and pw == "eggs":
                return apache.OK
        else:
                apache.log_error('start', apache.APLOG_NOTICE)
                apache.log_error(user, apache.APLOG_NOTICE)
                apache.log_error(pw, apache.APLOG_NOTICE)
                apache.log_error('end', apache.APLOG_NOTICE)
                return apache.HTTP_UNAUTHORIZED


when I make the request, i get (from error_log):

[Fri Aug  4 23:07:57 2000] [notice] (13)Permission denied: start
[Fri Aug  4 23:07:57 2000] [notice] (13)Permission denied: eggs
[Fri Aug  4 23:07:57 2000] [notice] (13)Permission denied: end

the user var must be blank, because it never makes it.  

access_log has:

127.0.0.1 - spam [04/Aug/2000:23:07:57 -0700] "GET /test/test.py HTTP/1.0" 401 471

which has the username correct.

Where am I going wrong here?  Or is this a bug?

jack.

From gps at trix.dircon.co.uk  Mon Aug  7 02:00:52 2000
From: gps at trix.dircon.co.uk (Graham Swallow)
Date: Fri Jan  9 22:02:25 2004
Subject: [mod_python] SPIN_py works with mod_python
Message-ID: <Pine.LNX.4.04.10008070155030.1292-100000@trix.dircon.co.uk>

You have to mess with the PATHS and the /etc/sgml/ pathnames,
but then it just works. It is an SGML parser (actually SP is
the Parser, SPIN is the interface to Python).

I wouldn't recommend using SPIN on a production server because 
it is not mem-leakage tested, and because if users can upload
SGML they can down load any file (named as an entity), however
it provides elem_info and elem_obj, which are very useful
when building SGML/HTML/XML trees. You can also use them without
initialising the parser, and wrap them in names that you like.

Graham (who thinks mod_python is great)

Begin4
Title:          SPIN_py - SGML Parser Integration (Python)
Version:        0.2.3
Entered-date:   2000-08-06
Description:    SP is _the_ SGML Parser.
                spin_py.so is a loadable Python module.
                SPIN_py uses the generic
                SP-API and routes its events to Python, with some
                fixups on the way. It also provides a few
                C-Python types which are very useful when building
                SGML/HTML/XML trees (elem_info, elem_obj).
                This release includes a standard libsp16.so (binary)
                otherwise its 100K not 1MB. To compile from source
                you may need SP-1.3.4 from http://www.jclark.com/
Keywords:       SGML HTML XML SP Parser Python Apache mod_python
Author:         gps@trix.dircon.co.uk (Graham Swallow)
Primary-site:   http://www.trix.dircon.co.uk/SPIN/
Alternate-site: metalab.unc.edu /pub/Linux/utils/text/
                1026522   SPIN_py-0806.tgz
Platforms:      libc.so.6, gcc-2.96, Linux, Solaris, NOT-HP-UX-YET,
Copying-policy: L-GPL
End



From gps at trix.dircon.co.uk  Mon Aug  7 22:19:08 2000
From: gps at trix.dircon.co.uk (Graham Swallow)
Date: Fri Jan  9 22:02:25 2004
Subject: [mod_python] pcre.error from python
Message-ID: <Pine.LNX.4.04.10008072154560.809-200000@trix.dircon.co.uk>

It doesnt happen every time but I get faults or trace-backs from pcre.
I think its due to interference between the pcre in python, and the
pcre in php (Perl Compat. Regular Expression). sig-seg or either of:

	pcre.error: ('unmatched parentheses', 40)
	pcre.error: ('\\ at end of pattern', 4425)

(Presumably these are random errors from some other memory corruption,
or incorrect function call, there are no parentheses or \\'s)

I haven't got a clue what to do about it, (would statically linking
pcre into python work? Can separate <Directories> NOT have mod_XYZ
loaded?) but if you see the above symptom, try the attached test script.

	Graham

-------------- next part --------------
#!/usr/bin/env python
# called by httpd or by shell

def handler(req):
	from mod_python import apache
	return handler2( req )
	# forgetting the above return is interesting. Try it!

def handler2( req ):

	req.content_type="text/plain"
	req.send_http_header()
	import re
	instr = "Old and New\n"
	outstr = re.sub( "Old", "New", instr, 0 )
	req.write( outstr )
	try:
		t = apache.OK
	except:
		t = "shell_mode"
	return t

if __name__ == '__main__':
	class REQ_DUMMY:
		def __init__( req, fd ):
			# req has writable (and readable) fields
			# when calling from shell ...
			req.fd = fd
		def send_http_header( req ):
			print "Not apache, so I sont say:", req.content_type
		def write( req, text ):
			req.fd.write( text )

	import sys
	# fd = open( "/dev/null", 'w' )
	# fd = open( "test_out.html", 'w' )
	fd = sys.stderr
	req_dummy = REQ_DUMMY( fd )
	handler2( req_dummy )

From Robert.Nasca at macquarie.com.au  Tue Aug  8 09:27:12 2000
From: Robert.Nasca at macquarie.com.au (Robert Nasca)
Date: Fri Jan  9 22:02:25 2004
Subject: [mod_python] mod_python / win32all and COM
Message-ID: <2D0E3DBA4C66D31195920008C784F4AF01332A5C@nt_syd_ex08.macbank>

Hi,

Is there an FAQ on using mod_python with COM? It seems that I am having problems due to the threaded nature of Apache on win32 and it's interaction with COM.

I have created an interface to some COM objects using the "makepy.py" program which comes with win32all.

When I run Apache with ThreadsPerChild set to 1, everything runs fine (albeit with only one client), but when I set this to something higher, I get errors saying "CoInitialise() has not been called", which I assume are related to Apache spawning multiple threads. I've attached the output below.

Mod_python error: "PythonHandler pytest"Traceback (innermost last):
  File "h:\website\python\mod_python\apache.py", line 119, in Dispatch
    result = object(req)
  File "h:/website/htdocs/test\pytest.py", line 8, in handler
    d = Snakey.Database.RiskReporterDatabase()
  File "H:\WebSite\Python\Snakey\Database.py", line 32, in __init__
    self.openConnection("DSN=RISK_REPORTER")
  File "H:\WebSite\Python\Snakey\Database.py", line 20, in openConnection
    self.connection = msado21.Connection()
  File "H:\PythonDev\Snakey\msado21.py", line 1607, in __init__
com_error: (-2147221008, 'CoInitialize has not been called.', None, None)

If anyone has a suggestion on what is happening, or pointers to some information on using mod_python and COM, it would be appreciated.

Thanks,
Rob.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mailman.modpython.org/pipermail/mod_python/attachments/20000808/8ccbceb4/attachment-0003.htm
From efernandez at sistelnet.es  Wed Aug  9 08:51:50 2000
From: efernandez at sistelnet.es (Eduardo Fernandez)
Date: Fri Jan  9 22:02:25 2004
Subject: [mod_python] problem with authen handler
Message-ID: <007701c001ce$4b6b7c40$248a4cc3@sistelnet.es>

Hello everyone:

I whis I had discovered mod_python before. It would have saved me a lot of
headaches in the application I am developing right now. In this app, I
authenticate the users via a regular form in a page, and then keep the
"logged-in" state with cookies.

I want to do it right (TM), and use basic http authentication with
mod_python.

So I set up the documentation example, got the "Hello World!" part to work
and now I am trying to make the authenhandler to work.

I have copied the example as in the documentation and tried to access the
page. I get the user/pw window and fill it, but it alway fails with a 401
error.

I have tried diferent usernames and pws, but it always fails. The apache
logs show the user along with the 401 error, so I think I have the setup
working mostly ok.

Where could be the quirk?

Thanks in advance.
--
Eduardo Fern?ndez Corrales
eduardo@sistelnet.es
Sistelnet Integraciones Telem?ticas - http://www.sistelnet.es
NUEVOS TELEFONOS: 95-4186897 95-4186898 902-293030 Fax: 954186901


From jack at icecast.org  Wed Aug  9 17:12:33 2000
From: jack at icecast.org (Jack Moffitt)
Date: Fri Jan  9 22:02:25 2004
Subject: [mod_python] problem with authen handler
In-Reply-To: <007701c001ce$4b6b7c40$248a4cc3@sistelnet.es>
Message-ID: <Pine.LNX.4.10.10008091711260.14914-100000@deathstar.icecast.org>

I have the same problem, which i posted about a few days back.  Having
done some more research:

req.connection.user is correct, it has teh username

if i do username = req.connection.user then username == None.  I don't get
it.

jack.


On Wed, 9 Aug 2000, Eduardo Fernandez wrote:

> Hello everyone:
> 
> I whis I had discovered mod_python before. It would have saved me a lot of
> headaches in the application I am developing right now. In this app, I
> authenticate the users via a regular form in a page, and then keep the
> "logged-in" state with cookies.
> 
> I want to do it right (TM), and use basic http authentication with
> mod_python.
> 
> So I set up the documentation example, got the "Hello World!" part to work
> and now I am trying to make the authenhandler to work.
> 
> I have copied the example as in the documentation and tried to access the
> page. I get the user/pw window and fill it, but it alway fails with a 401
> error.
> 
> I have tried diferent usernames and pws, but it always fails. The apache
> logs show the user along with the 401 error, so I think I have the setup
> working mostly ok.
> 
> Where could be the quirk?
> 
> Thanks in advance.
> --
> Eduardo Fernández Corrales
> eduardo@sistelnet.es
> Sistelnet Integraciones Telemáticas - http://www.sistelnet.es
> NUEVOS TELEFONOS: 95-4186897 95-4186898 902-293030 Fax: 954186901
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 


From goodwin at apple.com  Wed Aug  9 22:21:02 2000
From: goodwin at apple.com (Larry Goodwin)
Date: Fri Jan  9 22:02:25 2004
Subject: [mod_python] invalid command in Apache config
Message-ID: <39923BBB.ABA1FFF6@apple.com>

I installed mod_python by changing the Apache config. 
Added "AddModule modules/extra/mod_python.c" to the Configuration file
Copied mod_python.c from mod_python...src/mod_python.c to apache.../src/modules/extra/
Ran configure, make and make install

Added the following to the httpd.conf file.
<Directory "/usr/local/webpages/test/">
AddHandler python-program .py
PythonHandler test
PythonDebug On
</Directory>

The test.py file is in /usr/local/webpages/test/
When I run apachectl configtest I get:
Syntax error on line 561 of /usr/local/apache/conf/httpd.conf:
Invalid command 'PythonHandler', perhaps mis-spelled or defined by a
module not included in the server configuration

Apache is 1.3.12 and mod_python is 2,4,1, Python is 1.5.2

Is there any way to make sure the mod_python.c was added to Apache or is
there another problem/

thanks

From grisha at ispol.com  Thu Aug 10 08:19:53 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 22:02:25 2004
Subject: [mod_python] problem with authen handler
In-Reply-To: <Pine.LNX.4.10.10008091711260.14914-100000@deathstar.icecast.org>
Message-ID: <Pine.LNX.4.21.0008100819040.9858-100000@saturn.ispol.com>

I'm looking into this right now.... It looks like if you call
get_basic_auth_pw() *first* - you get the user name.

Grisha


On Wed, 9 Aug 2000, Jack Moffitt wrote:

> I have the same problem, which i posted about a few days back.  Having
> done some more research:
> 
> req.connection.user is correct, it has teh username
> 
> if i do username = req.connection.user then username == None.  I don't get
> it.
> 
> jack.
> 
> 
> On Wed, 9 Aug 2000, Eduardo Fernandez wrote:
> 
> > Hello everyone:
> > 
> > I whis I had discovered mod_python before. It would have saved me a lot of
> > headaches in the application I am developing right now. In this app, I
> > authenticate the users via a regular form in a page, and then keep the
> > "logged-in" state with cookies.
> > 
> > I want to do it right (TM), and use basic http authentication with
> > mod_python.
> > 
> > So I set up the documentation example, got the "Hello World!" part to work
> > and now I am trying to make the authenhandler to work.
> > 
> > I have copied the example as in the documentation and tried to access the
> > page. I get the user/pw window and fill it, but it alway fails with a 401
> > error.
> > 
> > I have tried diferent usernames and pws, but it always fails. The apache
> > logs show the user along with the 401 error, so I think I have the setup
> > working mostly ok.
> > 
> > Where could be the quirk?
> > 
> > Thanks in advance.
> > --
> > Eduardo Fern?ndez Corrales
> > eduardo@sistelnet.es
> > Sistelnet Integraciones Telem?ticas - http://www.sistelnet.es
> > NUEVOS TELEFONOS: 95-4186897 95-4186898 902-293030 Fax: 954186901
> > 
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://www.modpython.org/mailman/listinfo/mod_python
> > 
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 


From grisha at ispol.com  Thu Aug 10 09:38:46 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 22:02:25 2004
Subject: [mod_python] some bug fixes and new features in CVS
Message-ID: <Pine.LNX.4.21.0008100927060.10100-100000@saturn.ispol.com>

Just FYI - 

I've checked in to the CVS server on sourceforge the version of mod_python
that has a number of new features, fixes and improvements. Some changes
were quite radical which is why I don't want to put it out as a release
just yet.

There are instructions on how to retrieve code from CVS on 
http://sourceforge.net/cvs/?group_id=7107

Some of the most significant changes are:

o New PythonEnablePdb directive that allows handlers to be executed
  within pdb (Python debugger).

o Proper finalization - Py_Finalize() C API function is called with a
  child proces exits, thus making sure all objects are destroyed properly.

o Dynamic handler registration. Now you can add handlers from within
  handlers. Extremely useful if you want, for example, to write an
  authentication handler that decides based on the userid which handler
  will handle the request.

o There is now a way to have multiple keys in a table via the
  add() function. Having multiple keys is critical to being able
  to set multiple cookies, as someone pointed out on this list.

o mod_python.c should compile with the -ansi option without warnings.


--
  Gregory (Grisha) Trubetskoy
       grisha@ispol.com


From grisha at ispol.com  Thu Aug 10 11:35:08 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 22:02:25 2004
Subject: [mod_python] some bug fixes and new features in CVS
In-Reply-To: <20000810135152.2096.qmail@web2206.mail.yahoo.com>
Message-ID: <Pine.LNX.4.21.0008101127050.10351-100000@saturn.ispol.com>

The CGI memory leak is not a problem with mod_python itself really. It has
to do with cgi.py and what it does. The thing to realize about mod_python
(or mod_perl, or php for that matter), is that code that is not careful
about memory allocation, will make apache process grow and grow.

I think that there are only two possible solutions - 

1. Some mod_python module that kills httpd when it reaches a certain
size. That's the technique mod_perl folks use.

2. A fix/rewrite of cgi.py.

The latter is the right thing to do, of course, but who knows when it will
happen....

I'd like to mention that this issue is certainly high on my TODO list, and
I'm open to any advice, suggetions, code snippets, patches, etc :-)

Grisha


On Thu, 10 Aug 2000, Alexis Iglauer wrote:

> Has the cgi memory leak been sorted out yet?  I am
> having to restart my apache at least once a day to not
> swamp my machine......
> 
> Keep up the excellent work!
> Regards
> Alexis
> --- Gregory Trubetskoy <grisha@ispol.com> wrote:
> > 
> > Just FYI - 
> > 
> > I've checked in to the CVS server on sourceforge the
> > version of mod_python
> > that has a number of new features, fixes and
> > improvements. Some changes
> > were quite radical which is why I don't want to put
> > it out as a release
> > just yet.
> > 
> > There are instructions on how to retrieve code from
> > CVS on 
> > http://sourceforge.net/cvs/?group_id=7107
> > 
> > Some of the most significant changes are:
> > 
> > o New PythonEnablePdb directive that allows handlers
> > to be executed
> >   within pdb (Python debugger).
> > 
> > o Proper finalization - Py_Finalize() C API function
> > is called with a
> >   child proces exits, thus making sure all objects
> > are destroyed properly.
> > 
> > o Dynamic handler registration. Now you can add
> > handlers from within
> >   handlers. Extremely useful if you want, for
> > example, to write an
> >   authentication handler that decides based on the
> > userid which handler
> >   will handle the request.
> > 
> > o There is now a way to have multiple keys in a
> > table via the
> >   add() function. Having multiple keys is critical
> > to being able
> >   to set multiple cookies, as someone pointed out on
> > this list.
> > 
> > o mod_python.c should compile with the -ansi option
> > without warnings.
> > 
> > 
> > --
> >   Gregory (Grisha) Trubetskoy
> >        grisha@ispol.com
> > 
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://www.modpython.org/mailman/listinfo/mod_python
> 
> 
> __________________________________________________
> Do You Yahoo!?
> Kick off your party with Yahoo! Invites.
> http://invites.yahoo.com/
> 


From sbi at acse.be  Thu Aug 10 19:40:09 2000
From: sbi at acse.be (Stephane Bidoul)
Date: Fri Jan  9 22:02:25 2004
Subject: [mod_python] mod_python / win32all and COM
References: <2D0E3DBA4C66D31195920008C784F4AF01332A5C@nt_syd_ex08.macbank>
Message-ID: <00a801c002f2$0d882020$faa679c1@spirou>

I think you need to put COM in free-threaded mode
by doing

>>> sys.coinit_flags = 0

before anything else.

There is a mention of this in the Python COM readme,
but and can't recall where it's documented in more details...

Tell me if it works for you.

-sbi

----- Original Message -----
From: "Robert Nasca" <Robert.Nasca@macquarie.com.au>
To: <mod_python@modpython.org>
Sent: Tuesday, 08 August, 2000 01:27
Subject: [mod_python] mod_python / win32all and COM


> Hi,
>
> Is there an FAQ on using mod_python with COM? It seems that I am having
> problems due to the threaded nature of Apache on win32 and it's
> interaction with COM.
>
> I have created an interface to some COM objects using the "makepy.py"
> program which comes with win32all.
>
> When I run Apache with ThreadsPerChild set to 1, everything runs fine
> (albeit with only one client), but when I set this to something higher,
> I get errors saying "CoInitialise() has not been called", which I assume
> are related to Apache spawning multiple threads. I've attached the
> output below.
>
> Mod_python error: "PythonHandler pytest"Traceback (innermost last):
>   File "h:\website\python\mod_python\apache.py", line 119, in Dispatch
>     result = object(req)
>   File "h:/website/htdocs/test\pytest.py", line 8, in handler
>     d = Snakey.Database.RiskReporterDatabase()
>   File "H:\WebSite\Python\Snakey\Database.py", line 32, in __init__
>     self.openConnection("DSN=RISK_REPORTER")
>   File "H:\WebSite\Python\Snakey\Database.py", line 20, in
> openConnection
>     self.connection = msado21.Connection()
>   File "H:\PythonDev\Snakey\msado21.py", line 1607, in __init__
> com_error: (-2147221008, 'CoInitialize has not been called.', None,
> None)
>
> If anyone has a suggestion on what is happening, or pointers to some
> information on using mod_python and COM, it would be appreciated.
>
> Thanks,
> Rob.
>
>



From goodwin at apple.com  Fri Aug 11 10:59:21 2000
From: goodwin at apple.com (Larry Goodwin)
Date: Fri Jan  9 22:02:25 2004
Subject: [mod_python] Problems with getting mod_python into Apache
Message-ID: <39943D7C.CB56DBA0@apple.com>

Folks, I am still having problems with getting mod_python compiled into
Apache 1.3.12
I followed the procedures:
cd apache/src
vi Configuration
AddModule modules/extra/mod_python.c
./Configure

Get this error:
+ adding selected modules
    o python_module uses ConfigStart/End
 + checking sizeof various data types
 + doing sanity check on compiler and options
** A test compilation with your Makefile configuration
** failed.  The below error output from the compilation
** test will give you an idea what is failing. Note that
** Apache requires an ANSI C Compiler, such as gcc.

======== Error Output for sanity check ========
cd ..; gcc  -DAIX=41 -DNEED_RLIM_T -U__STR__ -DAIX_BIND_PROCESSOR -DUSE_HSREGEX
-DUSE_EXPAT -I./lib/expat-lite -DNO_DL_NEEDED 
-I/usr/local/include/python1.5  -
Wl,-bE:python.exp -lld      -o helpers/dummy helpers/dummy.c   /usr/local/lib/py
thon1.5/config/libpython1.5.a      -lm
ld: 0706-004 Cannot find or read export file: python.exp
        ld:accessx(): No such file or directory
collect2: ld returned 255 exit status
make: *** [dummy] Error 1
============= End of Error Report =============

 Aborting!

python.exp is in /usr/local/lib/python1.5/conf

My path is: 
PATH=/usr/local/bin:/usr/local/lib/python1.5:/usr/local/lib/python1.5/conf:/usr/
local/include/python1.5:/usr/bin:/etc:/usr/sbin:/usr/ucb:/usr/bin/X11:/sbin

Thanks,
Larry

From daniel at unity.copyleft.no  Fri Aug 11 21:29:58 2000
From: daniel at unity.copyleft.no (Daniel Mikkelsen)
Date: Fri Jan  9 22:02:25 2004
Subject: [mod_python] PythonImport
Message-ID: <Pine.LNX.4.10.10008112123040.27319-100000@unity.copyleft.no>

Hi.

I'm having problems with loading modules not located in the global
site-packages directory. 

I want to load a module that opens a connection to a database, and
I want this module to be located in the same directory as the .py
files that will make use of it. 

However, I always get:

  Fri Aug 11 21:16:46 2000] [error] directive_PythonImport: error
  importing open_db_con ImportError: No module named open_db_con

If I copy the module into site-packages, this works. But I don't want
do this, as I expect to have lots of different programs that will 
want to access lots of different databases. 

I've tried using the PythonPath directive, to no avail. I'm using 
mod_python 2.4.1 loaded dynamically with Apache 1.3.9 on OpenBSD 2.6. 

Anything obvious I'm doing wrong?

-- Daniel Mikkelsen, Copyleft Software



From michael at stroeder.com  Fri Aug 11 21:50:05 2000
From: michael at stroeder.com (Michael =?iso-8859-1?Q?Str=F6der?=)
Date: Fri Jan  9 22:02:25 2004
Subject: [mod_python] PythonImport
References: <Pine.LNX.4.10.10008112123040.27319-100000@unity.copyleft.no>
Message-ID: <399458ED.BC942863@stroeder.com>

Daniel Mikkelsen wrote:
> 
> I'm having problems with loading modules not located in the global
> site-packages directory.
> 
> I want to load a module that opens a connection to a database, and
> I want this module to be located in the same directory as the .py
> files that will make use of it.

sys.path.append() is not an option?

Ciao, Michael.

From bfordham at piratech.net  Fri Aug 11 16:07:15 2000
From: bfordham at piratech.net (bfordham@piratech.net)
Date: Fri Jan  9 22:02:25 2004
Subject: [mod_python] PythonImport
In-Reply-To: <Pine.LNX.4.10.10008112123040.27319-100000@unity.copyleft.no>
Message-ID: <399424B3.32484.9BFEE0@localhost>

-----BEGIN PGP SIGNED MESSAGE-----

On 11 Aug 2000, at 21:29, Daniel Mikkelsen wrote:

> Hi.
> 
> I'm having problems with loading modules not located in the global
> site-packages directory. 

I tried a couple of quick tests.  First I created a module (yoda.py)
with one line (x=1) and put it in the directory with my main script. 
Told the main script to import it and print yoda.x; worked fine.

Moved yoda.py to directory blah, and added:
PythonPath "sys.path+['/serverpath','/serverpath/blah']
to my httpd.conf file.  Restarted the server, it worked, too.

I'm running Debian 2.1, Apache 1.3.12 and mod_python as a DSO.

Are you sure the script to want imported is in a directory the server
can read?  Did you restart the server?

Sorry I can't be of more help

- --B

-----BEGIN PGP SIGNATURE-----
Version: N/A

iQCVAwUBOZRctw2B1TBOdblFAQE+6AP5AVcFKkk8lwXZg8aXrpIUFJ29dJ+es3zy
LA0uHhKr1GVP0MoGuU/K6ovw9jU+mQG/XweirNn1ZjcCj5tAbxx26V9d15fF5Llx
z2aklem04SOExXNcXsM4DWCm/Rpe4O79TEdrPB//ZcdBmoBXgPbEbZ8R033y54Hy
thKrNKNZcM0=
=U2pW
-----END PGP SIGNATURE-----


From grisha at ispol.com  Fri Aug 11 17:25:14 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 22:02:25 2004
Subject: [mod_python] PythonImport
In-Reply-To: <Pine.LNX.4.10.10008112123040.27319-100000@unity.copyleft.no>
Message-ID: <Pine.LNX.4.21.0008111723300.14946-100000@saturn.ispol.com>

Is your PythonImport within an appropriate <Directory> tag or just by
itself?

--
  Gregory (Grisha) Trubetskoy
       grisha@ispol.com

On Fri, 11 Aug 2000, Daniel Mikkelsen wrote:

> Hi.
> 
> I'm having problems with loading modules not located in the global
> site-packages directory. 
> 
> I want to load a module that opens a connection to a database, and
> I want this module to be located in the same directory as the .py
> files that will make use of it. 
> 
> However, I always get:
> 
>   Fri Aug 11 21:16:46 2000] [error] directive_PythonImport: error
>   importing open_db_con ImportError: No module named open_db_con
> 
> If I copy the module into site-packages, this works. But I don't want
> do this, as I expect to have lots of different programs that will 
> want to access lots of different databases. 
> 
> I've tried using the PythonPath directive, to no avail. I'm using 
> mod_python 2.4.1 loaded dynamically with Apache 1.3.9 on OpenBSD 2.6. 
> 
> Anything obvious I'm doing wrong?
> 
> -- Daniel Mikkelsen, Copyleft Software
> 
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 


From daniel at unity.copyleft.no  Fri Aug 11 23:26:13 2000
From: daniel at unity.copyleft.no (Daniel Mikkelsen)
Date: Fri Jan  9 22:02:25 2004
Subject: [mod_python] PythonTransHandler
Message-ID: <Pine.LNX.4.10.10008112323570.27319-100000@unity.copyleft.no>

Hi.

Anyone here know how the PythonTransHandler works? It looks like it's
supposed to let me translate the URI at an early stage. But I'm
uncertain as to how my transhandler(req) is supposed to realize the 
translation it does. 

-- Daniel Mikkelsen, Copyelft Software



From L.A.Timochouk at ukc.ac.uk  Fri Aug 11 23:00:29 2000
From: L.A.Timochouk at ukc.ac.uk (Dr. L.A. Timochouk)
Date: Fri Jan  9 22:02:25 2004
Subject: [mod_python] A patch for mod_python-2.4.1
Message-ID: <Pine.GSO.4.21.0008112257320.29709-100000@myrtle.ukc.ac.uk>

Hello All,

Please find attached a patch for mod_python-2.4.1. It addresses two issues:

(1) The current implementation of "req_read" method seems to contain a bug
    (or a problematic feature?): it may return less bytes than was requested,
    due to a known sockets phenomenon called "short read". Namely, a single
    "read" on a TCP socket returns data ONLY up to the end of the current
    IP packet; several "read"s may be required to get the whole amount
    requested. The current implementation did not guard against that; on the
    contrary, it shrank the output buffer is less-than-expected bytes were
    received. In particular, this may result in incomplete receiving of POSTed
    data (the problem shows up on large submissions only). The proposed
    patch fixes it.

(2) A new Apache directive,

    PythonOptimize On|Off

    is implemented. If set, it allows us to run the interpreter in the
    fully-optimising mode (equivalent to -OO Python command-line argument)
    which may be useful for time-critical applications.

Best regards,

Dr. Leonid Timochouk
Computing Laboratory
University of Kent at Canterbury
England
===============================================================================

--- mod_python.c.orig	Tue Jul  4 18:49:31 2000
+++ mod_python.c	Sun Jul 23 16:39:55 2000
@@ -1277,7 +1277,7 @@
 static PyObject * req_read(requestobject *self, PyObject *args)
 {
 
-    int len, rc, bytes_read;
+    int len, rc, bytes_read, chunk_len;
     char *buffer;
     PyObject *result;
 
@@ -1316,13 +1316,18 @@
 	return NULL;
 
     /* read it in */
+    /* BEWARE of short reads!  */
     buffer = PyString_AS_STRING((PyStringObject *) result);
-    bytes_read = ap_get_client_block(self->request_rec, buffer, len);
-
-    /* resize if necessary */
-    if (bytes_read < len) 
-	if(_PyString_Resize(&result, bytes_read))
+    bytes_read = 0;
+    while (bytes_read < len)
+    {
+	chunk_len = ap_get_client_block
+		    (self->request_rec, buffer+bytes_read, len-bytes_read);
+	if  (chunk_len == 0)
+	    /* Connection closed -- it's better not to return anything */
 	    return NULL;
+    	bytes_read += chunk_len;
+    }
 
     return result;
 }
@@ -2087,6 +2092,19 @@
 }
 
 /**
+ ** directive_PythonOptimize
+ **
+ *	This function called whenever PythonOptimize directive
+ *	is encountered.
+ */
+static const char *directive_PythonOptimize(cmd_parms *cmd, void *mconfig,
+					    int val) {
+    if (val)
+	Py_OptimizeFlag = 2; /* Optimize and remove function descr strings */
+    return NULL;
+}
+
+/**
  ** directive_PythonInterpPerDirectory
  **
  *      This function called whenever PythonInterpPerDirectory directive
@@ -2409,6 +2427,14 @@
 	OR_ALL,                         
 	FLAG,                               
 	"Send (most) Python error output to the client rather than logfile."
+    },
+    {
+	"PythonOptimize",
+	directive_PythonOptimize,
+	NULL,
+	OR_ALL,
+	FLAG,
+	"Set the equivalent of the -O command-line flag on the interpreter."
     },
     {
 	"PythonNoReload",                 



From dyeung at ust.hk  Mon Aug 14 09:26:49 2000
From: dyeung at ust.hk (David YEUNG)
Date: Fri Jan  9 22:02:25 2004
Subject: [mod_python] How to define an environment variable for other python module to use?
Message-ID: <39974AD9.2C33FAE1@ust.hk>

I have other python modules which usually need to read some environment
variables, e.g., an python-oracle interface module needs to read the "ORACLE_SID"
to know where the database to connect. I used to defining this variable in the "shell"
before invoking a python CGI program, e.g.:

   #!/bin/sh
   export ORACLE_SID=orcl
   exec /some/oracle/python/interface.cgi

I would like to try the mod_python using the default CGI handler, but does someone
know how to define some environment variable in mod_python?

Thanks

david

From jack at icecast.org  Sun Aug 13 18:37:05 2000
From: jack at icecast.org (Jack Moffitt)
Date: Fri Jan  9 22:02:25 2004
Subject: [mod_python] How to define an environment variable for other
 python module to use?
In-Reply-To: <39974AD9.2C33FAE1@ust.hk>
Message-ID: <Pine.LNX.4.10.10008131836030.24345-100000@deathstar.icecast.org>

generally when we do this with php, we define the ENV variables in the
apache startup script, so that they get into every child process.  then
they are readable with the normal environment functions.

we don't normally change where the oracle_sid is, so we have no need to
set them.

jack.

On Mon, 14 Aug 2000, David YEUNG wrote:

> I have other python modules which usually need to read some environment
> variables, e.g., an python-oracle interface module needs to read the "ORACLE_SID"
> to know where the database to connect. I used to defining this variable in the "shell"
> before invoking a python CGI program, e.g.:
> 
>    #!/bin/sh
>    export ORACLE_SID=orcl
>    exec /some/oracle/python/interface.cgi
> 
> I would like to try the mod_python using the default CGI handler, but does someone
> know how to define some environment variable in mod_python?
> 
> Thanks
> 
> david
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 


From rdevide at ican.at  Mon Aug 14 11:51:37 2000
From: rdevide at ican.at (Devide Robert)
Date: Fri Jan  9 22:02:25 2004
Subject: [mod_python] some bug fixes and new features in CVS
References: <Pine.LNX.4.21.0008101127050.10351-100000@saturn.ispol.com>
Message-ID: <3997C129.EA8F5DED@ican.at>

Gregory Trubetskoy wrote:
> 1. Some mod_python module that kills httpd when it reaches a certain
> size. That's the technique mod_perl folks use.

Would rather use something like

MaxRequestsPerChild 100

in apache config.
(as it had proofed to be the simplest and most effective way to 'handle'
memory leaks in various modules)

dave

From grisha at ispol.com  Mon Aug 14 08:31:17 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 22:02:25 2004
Subject: [mod_python] PythonTransHandler
In-Reply-To: <Pine.LNX.4.10.10008112323570.27319-100000@unity.copyleft.no>
Message-ID: <Pine.LNX.4.21.0008140827470.1734-100000@saturn.ispol.com>

You basically take assign a value to req.filename, usually based on
req.uri. There is a problem in 2.4.1 though - the filename attribute is
read-only. This has been fixed in the latest code which you can get from
CVS.

--
  Gregory (Grisha) Trubetskoy
       grisha@ispol.com

On Fri, 11 Aug 2000, Daniel Mikkelsen wrote:

> Hi.
> 
> Anyone here know how the PythonTransHandler works? It looks like it's
> supposed to let me translate the URI at an early stage. But I'm
> uncertain as to how my transhandler(req) is supposed to realize the 
> translation it does. 
> 
> -- Daniel Mikkelsen, Copyelft Software
> 
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 


From grisha at ispol.com  Mon Aug 14 08:36:09 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 22:02:25 2004
Subject: [mod_python] A patch for mod_python-2.4.1
In-Reply-To: <Pine.GSO.4.21.0008112257320.29709-100000@myrtle.ukc.ac.uk>
Message-ID: <Pine.LNX.4.21.0008140834280.1734-100000@saturn.ispol.com>

Thanks Leonid. I still have your original -OO patch in my INBOX and I'll
make sure to apply it.

Question - are you sure ap_get_client_block() doesn't take care of short
reads?

Thanks!

--
  Gregory (Grisha) Trubetskoy
       grisha@ispol.com

On Fri, 11 Aug 2000, Dr. L.A. Timochouk wrote:

> Hello All,
> 
> Please find attached a patch for mod_python-2.4.1. It addresses two issues:
> 
> (1) The current implementation of "req_read" method seems to contain a bug
>     (or a problematic feature?): it may return less bytes than was requested,
>     due to a known sockets phenomenon called "short read". Namely, a single
>     "read" on a TCP socket returns data ONLY up to the end of the current
>     IP packet; several "read"s may be required to get the whole amount
>     requested. The current implementation did not guard against that; on the
>     contrary, it shrank the output buffer is less-than-expected bytes were
>     received. In particular, this may result in incomplete receiving of POSTed
>     data (the problem shows up on large submissions only). The proposed
>     patch fixes it.
> 
> (2) A new Apache directive,
> 
>     PythonOptimize On|Off
> 
>     is implemented. If set, it allows us to run the interpreter in the
>     fully-optimising mode (equivalent to -OO Python command-line argument)
>     which may be useful for time-critical applications.
> 
> Best regards,
> 
> Dr. Leonid Timochouk
> Computing Laboratory
> University of Kent at Canterbury
> England
> ===============================================================================
> 
> --- mod_python.c.orig	Tue Jul  4 18:49:31 2000
> +++ mod_python.c	Sun Jul 23 16:39:55 2000
> @@ -1277,7 +1277,7 @@
>  static PyObject * req_read(requestobject *self, PyObject *args)
>  {
>  
> -    int len, rc, bytes_read;
> +    int len, rc, bytes_read, chunk_len;
>      char *buffer;
>      PyObject *result;
>  
> @@ -1316,13 +1316,18 @@
>  	return NULL;
>  
>      /* read it in */
> +    /* BEWARE of short reads!  */
>      buffer = PyString_AS_STRING((PyStringObject *) result);
> -    bytes_read = ap_get_client_block(self->request_rec, buffer, len);
> -
> -    /* resize if necessary */
> -    if (bytes_read < len) 
> -	if(_PyString_Resize(&result, bytes_read))
> +    bytes_read = 0;
> +    while (bytes_read < len)
> +    {
> +	chunk_len = ap_get_client_block
> +		    (self->request_rec, buffer+bytes_read, len-bytes_read);
> +	if  (chunk_len == 0)
> +	    /* Connection closed -- it's better not to return anything */
>  	    return NULL;
> +    	bytes_read += chunk_len;
> +    }
>  
>      return result;
>  }
> @@ -2087,6 +2092,19 @@
>  }
>  
>  /**
> + ** directive_PythonOptimize
> + **
> + *	This function called whenever PythonOptimize directive
> + *	is encountered.
> + */
> +static const char *directive_PythonOptimize(cmd_parms *cmd, void *mconfig,
> +					    int val) {
> +    if (val)
> +	Py_OptimizeFlag = 2; /* Optimize and remove function descr strings */
> +    return NULL;
> +}
> +
> +/**
>   ** directive_PythonInterpPerDirectory
>   **
>   *      This function called whenever PythonInterpPerDirectory directive
> @@ -2409,6 +2427,14 @@
>  	OR_ALL,                         
>  	FLAG,                               
>  	"Send (most) Python error output to the client rather than logfile."
> +    },
> +    {
> +	"PythonOptimize",
> +	directive_PythonOptimize,
> +	NULL,
> +	OR_ALL,
> +	FLAG,
> +	"Set the equivalent of the -O command-line flag on the interpreter."
>      },
>      {
>  	"PythonNoReload",                 
> 
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 


From grisha at ispol.com  Mon Aug 14 08:46:38 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 22:02:25 2004
Subject: [mod_python] some bug fixes and new features in CVS
In-Reply-To: <3997C129.EA8F5DED@ican.at>
Message-ID: <Pine.LNX.4.21.0008140845080.1734-100000@saturn.ispol.com>

That's the way I would do it. BTW - I heard that this directive does
nothing on Win32 where Apache is threaded. Of course the solution I
sugested (killing the process) wouldn't help either....

Grisha

On Mon, 14 Aug 2000, Devide Robert wrote:

> Gregory Trubetskoy wrote:
> > 1. Some mod_python module that kills httpd when it reaches a certain
> > size. That's the technique mod_perl folks use.
> 
> Would rather use something like
> 
> MaxRequestsPerChild 100
> 
> in apache config.
> (as it had proofed to be the simplest and most effective way to 'handle'
> memory leaks in various modules)
> 
> dave
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 


From miguel at yorku.ca  Mon Aug 14 09:20:56 2000
From: miguel at yorku.ca (Miguel Marques)
Date: Fri Jan  9 22:02:25 2004
Subject: [mod_python] some bug fixes and new features in CVS
In-Reply-To: <Pine.LNX.4.21.0008101127050.10351-100000@saturn.ispol.com>
References: <20000810135152.2096.qmail@web2206.mail.yahoo.com>
	<Pine.LNX.4.21.0008101127050.10351-100000@saturn.ispol.com>
Message-ID: <20000814092056B.miguel@yorku.ca>

On Thu, 10 Aug 2000 11:35:08 -0400 (EDT), Gregory Trubetskoy <grisha@ispol.com> wrote:
> 
> The CGI memory leak is not a problem with mod_python itself really. It has
> to do with cgi.py and what it does. The thing to realize about mod_python

Could you elaborate on why or how cgi.py leaks memory?  I'm using both
mod_python and cgi on a project that will see very large usage and I
would like to try and figure out if I should drop usage of cgi.py or not.
Thanks!

							Miguel

C. Miguel Marques, York University, Computing & Communications Services
e-mail: miguel@yorku.ca, voice: (416)736-2100x22684, fax: (416)736-5830

From L.A.Timochouk at ukc.ac.uk  Mon Aug 14 15:44:19 2000
From: L.A.Timochouk at ukc.ac.uk (Dr. L.A. Timochouk)
Date: Fri Jan  9 22:02:25 2004
Subject: [mod_python] A patch for mod_python-2.4.1
In-Reply-To: <Pine.LNX.4.21.0008140834280.1734-100000@saturn.ispol.com>
Message-ID: <Pine.GSO.4.21.0008141538030.24919-100000@myrtle.ukc.ac.uk>

Yes, it appeared to us that "ap_get_client_block" is susceptible to short
reads -- it indeed reads a BLOCK until the end of the current IP datagram
but no further. The problem was discovered when we implemented our Web
site with relatively large user submissions (by POST) using the current
version of mod_python. The exact cause of the problem was identified with
the help of "tcpdump".

Sincerely, L.A.Timochouk


From gstein at lyra.org  Mon Aug 14 12:53:29 2000
From: gstein at lyra.org (Greg Stein)
Date: Fri Jan  9 22:02:25 2004
Subject: [mod_python] A patch for mod_python-2.4.1 (fwd)
In-Reply-To: <Pine.LNX.4.21.0008141206500.2308-100000@saturn.ispol.com>; from grisha@ispol.com on Mon, Aug 14, 2000 at 12:08:19PM -0400
References: <Pine.LNX.4.21.0008141206500.2308-100000@saturn.ispol.com>
Message-ID: <20000814125329.X19525@lyra.org>

Nope. Haven't been reading it.

ap_get_client_block() returns a length. It can definitely return a length
less than that requested.

Or is it that length==0 gets returned before the end of the request? (which
would typically end the read loop)

Cheers,
-g

On Mon, Aug 14, 2000 at 12:08:19PM -0400, Gregory Trubetskoy wrote:
> 
> Greg -
> 
> Are you following this thread? This could could qualify as a bug in
> Apache if Dr. Timochouk is right.
> 
> Grisha
> 
> 
> ---------- Forwarded message ----------
> Date: Mon, 14 Aug 2000 15:44:19 +0100 (BST)
> From: Dr. L.A. Timochouk <L.A.Timochouk@ukc.ac.uk>
> To: Gregory Trubetskoy <grisha@ispol.com>
> Cc: mod_python@modpython.org
> Subject: Re: [mod_python] A patch for mod_python-2.4.1
> 
> Yes, it appeared to us that "ap_get_client_block" is susceptible to short
> reads -- it indeed reads a BLOCK until the end of the current IP datagram
> but no further. The problem was discovered when we implemented our Web
> site with relatively large user submissions (by POST) using the current
> version of mod_python. The exact cause of the problem was identified with
> the help of "tcpdump".
> 
> Sincerely, L.A.Timochouk

-- 
Greg Stein, http://www.lyra.org/

From jameswalker at clear.net.nz  Wed Aug 16 12:40:15 2000
From: jameswalker at clear.net.nz (James Walker)
Date: Fri Jan  9 22:02:26 2004
Subject: [mod_python] test.py runs even when deleted
Message-ID: <3999e2ef.dc4.0@clear.net.nz>

I've gotten mod_python (from the RPM) working on my Linux 6.2/Apache 1.3.12 box.
 I've sorted out all the <directory> stuff in httpd.conf and gotten the "Hello
to the ...." appear when accessing test.py or for that matter t.py (yes I understand
the "PythonHandler test" thing (I think)).

Now the issue.  I've deleted test.py and have a helloworld.py which has the
handler defined and which puts out a whole heap of html text.  However I still
get the same "Hello to ..." text from test.py (which is deleted!).  This happens
even after restarting apache and/or then rebooting the machine.

Anyone able to figure that one out?  I'm really looking forward to getting into
Python as I find it heaps easier to read/understand then Perl.  But while CGI
based Python scripts is an option I would prefer mod_python.

Hope somone can help,
James Walker.

From jameswalker at clear.net.nz  Thu Aug 17 10:02:52 2000
From: jameswalker at clear.net.nz (James Walker)
Date: Fri Jan  9 22:02:26 2004
Subject: [mod_python] test.py runs even when deleted
References: <3999e2ef.dc4.0@clear.net.nz>
Message-ID: <399B0F8C.208EDBC1@clear.net.nz>

Sorted.  Didn't realise that the .htaccess file actually had some stuff in it.  It's
directives were over-riding those I had in httpd.conf.  I commented those out and it
all started to behave as I was expecting.

Yah!  Off we go.

Cheers,
James.


James Walker wrote:

> I've gotten mod_python (from the RPM) working on my Linux 6.2/Apache 1.3.12 box.
>  I've sorted out all the <directory> stuff in httpd.conf and gotten the "Hello
> to the ...." appear when accessing test.py or for that matter t.py (yes I understand
> the "PythonHandler test" thing (I think)).
>
> Now the issue.  I've deleted test.py and have a helloworld.py which has the
> handler defined and which puts out a whole heap of html text.  However I still
> get the same "Hello to ..." text from test.py (which is deleted!).  This happens
> even after restarting apache and/or then rebooting the machine.
>
> Anyone able to figure that one out?  I'm really looking forward to getting into
> Python as I find it heaps easier to read/understand then Perl.  But while CGI
> based Python scripts is an option I would prefer mod_python.
>
> Hope somone can help,
> James Walker.
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python


From dirk at infostreet.com  Wed Aug 16 17:09:17 2000
From: dirk at infostreet.com (Dirk Leas)
Date: Fri Jan  9 22:02:26 2004
Subject: [mod_python] POSTed form fields?
Message-ID: <NBBBKMMANMGEEBHPJJECKEMDHKAA.dirk@infostreet.com>

How do I access them? I post a form with a hidden field, a text field, and
two fields encoded in the action. I dump all the request values (strings and
tables) and don't see my form fields, only values encoded in the URL. Quick
suggestion?

I've tried mod_python on both linux and win32 and get the same behavior.

Later,
D

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mailman.modpython.org/pipermail/mod_python/attachments/20000816/30422d2c/attachment-0003.htm
From L.A.Timochouk at ukc.ac.uk  Thu Aug 17 01:31:43 2000
From: L.A.Timochouk at ukc.ac.uk (Dr. L.A. Timochouk)
Date: Fri Jan  9 22:02:26 2004
Subject: [mod_python] POSTed form fields?
In-Reply-To: <NBBBKMMANMGEEBHPJJECKEMDHKAA.dirk@infostreet.com>
Message-ID: <Pine.GSO.4.21.0008170121130.7748-100000@myrtle.ukc.ac.uk>

The request object does not contain parsed (or even unparsed) POSTed
fields, so you need to read and parse them yourself:

(1) get the total length of the POSTed data from the "Content-length"
    header (available through the "headers_in" table in the request
    object);

(2) read the data in using the "read" method on the req object; NB:
    in mod_python 2.4.1, "read" can return a shorter data chunk than
    requested ("short read"); a patch had been submitted which
    rectifies the problem; alternatively you can do multiple "read"s
    until you get the whole length of your data;

(3) then you can parse the contents splitting it into key=value
    pairs separated by "&"s. There are some subtleties like multiple
    fields with the same name, file submission by POST,etc, to take
    care about.

Hope it will help,

Leonid Timochouk
Computing Laboratory
University of Kent at Canterbury
England


From kevin at GamesAndTheory.com  Wed Aug 16 21:04:11 2000
From: kevin at GamesAndTheory.com (Kevin Douglas)
Date: Fri Jan  9 22:02:26 2004
Subject: [mod_python] not compiling
Message-ID: <DKEEJHGMIIOMNIJFOCAICEKLCBAA.kevin@GamesAndTheory.com>

apache 1.3.12 and the latest release of mod_python

more info later after i beat it around


(this is also a test message)


h3ll0!
:P


-kev



From grisha at ispol.com  Thu Aug 17 09:05:24 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 22:02:26 2004
Subject: [mod_python] POSTed form fields?
In-Reply-To: <Pine.GSO.4.21.0008170121130.7748-100000@myrtle.ukc.ac.uk>
Message-ID: <Pine.LNX.4.21.0008170859400.13868-100000@saturn.ispol.com>

In other words, something like:

import cgi

len = int(req.headers_in["content-length"])
form_data = cgi.parse_qs(req.read(len))

Should do it. Dr. Timouchouk is right - if you're POSTing large files
(50K+), then you should check the size returned by read() and read() again
if it wasn't all.

The next release will make this unnecessary - read() will return all there
was to read. It will also follow the apache Timeout directive.

If you're handy with CVS - you can get that code right now from the
sourceforge CVS server.

--
  Gregory (Grisha) Trubetskoy
       grisha@ispol.com

On Thu, 17 Aug 2000, Dr. L.A. Timochouk wrote:

> The request object does not contain parsed (or even unparsed) POSTed
> fields, so you need to read and parse them yourself:
> 
> (1) get the total length of the POSTed data from the "Content-length"
>     header (available through the "headers_in" table in the request
>     object);
> 
> (2) read the data in using the "read" method on the req object; NB:
>     in mod_python 2.4.1, "read" can return a shorter data chunk than
>     requested ("short read"); a patch had been submitted which
>     rectifies the problem; alternatively you can do multiple "read"s
>     until you get the whole length of your data;
> 
> (3) then you can parse the contents splitting it into key=value
>     pairs separated by "&"s. There are some subtleties like multiple
>     fields with the same name, file submission by POST,etc, to take
>     care about.
> 
> Hope it will help,
> 
> Leonid Timochouk
> Computing Laboratory
> University of Kent at Canterbury
> England
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 



From lahondes at pasteur.fr  Thu Aug 17 18:12:09 2000
From: lahondes at pasteur.fr (Raynald de Lahondes)
Date: Fri Jan  9 22:02:26 2004
Subject: [mod_python] configuring mod_python in Debian 2.2
Message-ID: <20000817181209.C13600@pombe.vironc.pasteur.fr>

I am interested in mod_python but have difficulties in configuring the
program. I am using Debian 2.2 binaries, id est:

apache 1.3.9
python 1.5.2

I successfully compiled the lib and installed them in
/usr/lib/python1.5/site-packages/mod_python

the "compileall.py" was ok.

I compiled mod_python as suggested with apxs tool

apxs -I /usr/include/python1.5 -c mod_python.c \
/usr/lib/python1.5/config/libpython1.5.a -lpthread

and copied the resulting mod_python.so in /usr/lib/apache/1.3/

I modified the httpd.conf as suggested (first module, cf FAQ):
LoadModule python_module /usr/lib/apache/1.3/mod_python.so

(apache started OK)
I modified srm.conf (resource file for apache in Debian)

AddHandler python-program .py
PythonHandler test
PythonDebug On

and restarted apache again.

Then I create /var/www/test

and put the example test.py in /var/www/test/test.py

access to http://localfile/test/anything.py

generate an error: (in apache/error.log)

[Thu Aug 17 17:29:03 2000] [error] PythonHandler test: Traceback\
(innermost last):
[Thu Aug 17 17:29:03 2000] [error] PythonHandler test:   File\
"/usr/lib/python1.5/mod_python/apache.py", line 113, in Dispatch
[Thu Aug 17 17:29:03 2000] [error] PythonHandler test:   File\
"/usr/lib/python1.5/mod_python/apache.py", line 246, in import_module
[Thu Aug 17 17:29:03 2000] [error] PythonHandler test: ImportError: No\
module named test

I tried to check directly with python libs but I can't:

>>> from mod_python import apache
Traceback (innermost last):
  File "<stdin>", line 1, in ?
  File "/usr/lib/python1.5/mod_python/apache.py", line 18, in ?
ImportError: No module named _apache
>>> 


I have done nearly all I could do with the documentation I have, I need some
help please !

-- 
Raynald de Lahondes
Unite des Virus Oncogenes - Departement de Biotechnologie
Institut Pasteur - 25, rue du Docteur Roux
75724 Paris Cedex 15 - FRANCE
tel: 01.45.68.84.54 - fax: 01.40.61.30.33 - cellular: 06.15.65.85.08
email: lahondes@pasteur.fr 

From grisha at ispol.com  Thu Aug 17 13:48:49 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 22:02:26 2004
Subject: [mod_python] configuring mod_python in Debian 2.2
In-Reply-To: <20000817181209.C13600@pombe.vironc.pasteur.fr>
Message-ID: <Pine.LNX.4.21.0008171346430.14123-100000@saturn.ispol.com>

Make sure you have some <Directory> tags, i.e:

<Directory /var/www/test>
	AddHandler python-program .py
	PythonHandler test
	PythonDebug On
</Directory>


On Thu, 17 Aug 2000, Raynald de Lahondes wrote:

> I am interested in mod_python but have difficulties in configuring the
> program. I am using Debian 2.2 binaries, id est:
> 
> apache 1.3.9
> python 1.5.2
> 
> I successfully compiled the lib and installed them in
> /usr/lib/python1.5/site-packages/mod_python
> 
> the "compileall.py" was ok.
> 
> I compiled mod_python as suggested with apxs tool
> 
> apxs -I /usr/include/python1.5 -c mod_python.c \
> /usr/lib/python1.5/config/libpython1.5.a -lpthread
> 
> and copied the resulting mod_python.so in /usr/lib/apache/1.3/
> 
> I modified the httpd.conf as suggested (first module, cf FAQ):
> LoadModule python_module /usr/lib/apache/1.3/mod_python.so
> 
> (apache started OK)
> I modified srm.conf (resource file for apache in Debian)
> 
> AddHandler python-program .py
> PythonHandler test
> PythonDebug On
> 
> and restarted apache again.
> 
> Then I create /var/www/test
> 
> and put the example test.py in /var/www/test/test.py
> 
> access to http://localfile/test/anything.py
> 
> generate an error: (in apache/error.log)
> 
> [Thu Aug 17 17:29:03 2000] [error] PythonHandler test: Traceback\
> (innermost last):
> [Thu Aug 17 17:29:03 2000] [error] PythonHandler test:   File\
> "/usr/lib/python1.5/mod_python/apache.py", line 113, in Dispatch
> [Thu Aug 17 17:29:03 2000] [error] PythonHandler test:   File\
> "/usr/lib/python1.5/mod_python/apache.py", line 246, in import_module
> [Thu Aug 17 17:29:03 2000] [error] PythonHandler test: ImportError: No\
> module named test
> 
> I tried to check directly with python libs but I can't:
> 
> >>> from mod_python import apache
> Traceback (innermost last):
>   File "<stdin>", line 1, in ?
>   File "/usr/lib/python1.5/mod_python/apache.py", line 18, in ?
> ImportError: No module named _apache
> >>> 
> 
> 
> I have done nearly all I could do with the documentation I have, I need some
> help please !
> 
> -- 
> Raynald de Lahondes
> Unite des Virus Oncogenes - Departement de Biotechnologie
> Institut Pasteur - 25, rue du Docteur Roux
> 75724 Paris Cedex 15 - FRANCE
> tel: 01.45.68.84.54 - fax: 01.40.61.30.33 - cellular: 06.15.65.85.08
> email: lahondes@pasteur.fr 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 


From rsalz at caveosystems.com  Thu Aug 17 15:09:08 2000
From: rsalz at caveosystems.com (Rich Salz)
Date: Fri Jan  9 22:02:26 2004
Subject: [mod_python] Swig, and mod_ssl
References: <200007160231.WAA04120@pc1.caveosystems.com>
Message-ID: <399C3854.B91CE827@caveosystems.com>

Back in mid-July, I wrote rsalz@caveosystems.com wrote:
> Swig (http://www.swig.org) is a "compiler" that can parse most C
> header files and automatically generate code for Perl, Tcl, Python,
> and Java.  At a rough guess, approximately half of mod_python.c could
> be replaced by a couple-dozen lines.  I wonder if it makes sense
> to use SWIG, and for sites without it, include the Swig output.
> (Just like some programs include the output of Yacc, for those without it.)
> 
> Second question, which motivated the first: anyone looked at what
> could/should be added to the mod_python objects when mod_ssl is used?

Here is what I am going to end up doing.  I added a "get_swig_handle"
method that returns the request_rec code into the SWIG representation
of a pointer.  I'll then write little SWIG code to pull things out of
the mod_ssl context.  I'll send get_swig_handle and a sample use if
there's interest.
	/r$

From grisha at ispol.com  Thu Aug 17 15:37:54 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 22:02:26 2004
Subject: [mod_python] Swig, and mod_ssl
In-Reply-To: <399C3854.B91CE827@caveosystems.com>
Message-ID: <Pine.LNX.4.21.0008171533280.14123-100000@saturn.ispol.com>

That'd be interesting to see. 

I'd really appreciate a lamens terms explanation of what it is you're
trying to get out of mod_ssl and what are the steps issues involved with
it? I'm somewhat mod_ssl ingorant - I've used it to set up SSL sites and
I'm somwhat familiar with use of openssl to generate certificates and
such, but I know next to nothing about mod_ssl internals.

P.S. Does SWIG really have to be involved in order for this to work?

--
  Gregory (Grisha) Trubetskoy
       grisha@ispol.com

On Thu, 17 Aug 2000, Rich Salz wrote:

> Back in mid-July, I wrote rsalz@caveosystems.com wrote:
> > Swig (http://www.swig.org) is a "compiler" that can parse most C
> > header files and automatically generate code for Perl, Tcl, Python,
> > and Java.  At a rough guess, approximately half of mod_python.c could
> > be replaced by a couple-dozen lines.  I wonder if it makes sense
> > to use SWIG, and for sites without it, include the Swig output.
> > (Just like some programs include the output of Yacc, for those without it.)
> > 
> > Second question, which motivated the first: anyone looked at what
> > could/should be added to the mod_python objects when mod_ssl is used?
> 
> Here is what I am going to end up doing.  I added a "get_swig_handle"
> method that returns the request_rec code into the SWIG representation
> of a pointer.  I'll then write little SWIG code to pull things out of
> the mod_ssl context.  I'll send get_swig_handle and a sample use if
> there's interest.
> 	/r$
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 


From rsalz at caveosystems.com  Thu Aug 17 15:51:10 2000
From: rsalz at caveosystems.com (Rich Salz)
Date: Fri Jan  9 22:02:26 2004
Subject: [mod_python] Swig, and mod_ssl
References: <Pine.LNX.4.21.0008171533280.14123-100000@saturn.ispol.com>
Message-ID: <399C422E.1387F0CC@caveosystems.com>

> That'd be interesting to see.

Let me play with it a day or two and I'll send the patch along.

> I'd really appreciate a lamens terms explanation of what it is you're
> trying to get out of mod_ssl and what are the steps issues involved with
> it?

The simplest thing is: I want to be able to get the the DN of the client
and their entire cert, if there is one.  With this, I can do all my own
authorization rules in my python code.  Later on, I want to be able to
control what crypto protocols they're using, etc.

> I'm somwhat familiar with use of openssl to generate certificates and
> such, but I know next to nothing about mod_ssl internals.

> P.S. Does SWIG really have to be involved in order for this to work?

No.  It just saves me a lot of time. SWIG is a "compiler" that read C
(and, to some extent) C++ header files, and generates all the python
code to map the datatypes, and wrappers that convert from Py objects to
the C objects, and back.  Simple things (numbers strings) get mapped
directly, others are only exposed as pointers unless you write your own
conversions.  There are some good examples at http://www.swig.org

Ng Pheng Siong has a package, M2Crypto, that exposes most of the OpenSSL
functions up through python (via swig) -- see
http://www.post1.com/home/ngps.  So all I need is a little glue code
(i.e., my get_swig_handle patch) and I can do what I need.
	/r$

From grisha at ispol.com  Fri Aug 18 08:43:26 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 22:02:26 2004
Subject: [mod_python] Swig, and mod_ssl
In-Reply-To: <399C422E.1387F0CC@caveosystems.com>
Message-ID: <Pine.LNX.4.21.0008180839400.15289-100000@saturn.ispol.com>

On Thu, 17 Aug 2000, Rich Salz wrote:

> The simplest thing is: I want to be able to get the the DN of the client
> and their entire cert

BTW, one way to get DN is "SSLOptions +FakeBasicAuth", then the DN should
appear in req.connection.user.

http://www.modssl.org/docs/2.6/ssl_howto.html#ToC9


Grisha


From rsalz at caveosystems.com  Fri Aug 18 09:34:02 2000
From: rsalz at caveosystems.com (Rich Salz)
Date: Fri Jan  9 22:02:26 2004
Subject: [mod_python] Swig, and mod_ssl
References: <Pine.LNX.4.21.0008180839400.15289-100000@saturn.ispol.com>
Message-ID: <399D3B4A.7C5772BB@caveosystems.com>

> BTW, one way to get DN is "SSLOptions +FakeBasicAuth", then the DN should
> appear in req.connection.user.

Right.  But I need more than that.  I need to know *if* there's a client
cert, all the nitty-gritty details of it (e.g., what the keyUsage
extension is), I need to do my own verification, no CRL processing, my
own chain verification, etc.  Lots of stuff.  Ralph did a great job
writing a turn-key application that is great for most folks, but I need
to really get under the hood....

From pereran at yahoo.com  Fri Aug 18 07:57:16 2000
From: pereran at yahoo.com (Niranjan Perera)
Date: Fri Jan  9 22:02:26 2004
Subject: [mod_python] Trying to get mod_python+apache on FreeBSD working.
Message-ID: <20000818145716.24237.qmail@web512.mail.yahoo.com>

Hello:

I am  a newbie.

System: FreeBSD 4.0,
        Apache 1.3.12
        Python 1.5.2

Download mod_python, and followed instructions.

Added the following entry to httpd.conf

AddModule mod_python.c
<Directory /usr/local/www/data>
        AddHandler python-program .py
        PythonHandler test
        PythonDebug On
</Directory>

Placed in /usr/local/www/data the following code (
demo.py )
from mod_python import apache

def handler(req):
        req.send_http_header()
        req.write("Hello from Python!")
        return apache.OK

restarted httpd,

when I type http://xxx.yyy.zzz.com/demo.py
I get the following error message:

Mod_python error: "PythonHandler test"

Traceback (innermost last):

  File
"/usr/local/lib/python1.5/site-packages/mod_python/apache.py",
line 116, in Dispatch
    object = self.resolve_object(module, object_str)

  File
"/usr/local/lib/python1.5/site-packages/mod_python/apache.py",
line 51, in resolve_object
    raise AttributeError, s

AttributeError: module
'/usr/local/lib/python1.5/test/__init__.pyc' contains
no 'handler'


What am I missing ?


Thanks,

-- Niranjan






__________________________________________________
Do You Yahoo!?
Send instant messages & get email alerts with Yahoo! Messenger.
http://im.yahoo.com/

From michael at stroeder.com  Fri Aug 18 18:04:51 2000
From: michael at stroeder.com (Michael =?iso-8859-1?Q?Str=F6der?=)
Date: Fri Jan  9 22:02:26 2004
Subject: [mod_python] Swig, and mod_ssl
References: <Pine.LNX.4.21.0008180839400.15289-100000@saturn.ispol.com> <399D3B4A.7C5772BB@caveosystems.com>
Message-ID: <399D5EA3.7975AAEC@stroeder.com>

Rich Salz wrote:
> 
> > BTW, one way to get DN is "SSLOptions +FakeBasicAuth", then the DN 
> > should appear in req.connection.user.
> 
> Right.  But I need more than that.  I need to know *if* there's a client
> cert, all the nitty-gritty details of it (e.g., what the keyUsage
> extension is), I need to do my own verification, no CRL processing, my
> own chain verification, etc.  Lots of stuff.

I'm not sure I fully understand the problem but if you set

  SSLOptions +ExportCertData

you will get the client and server certs "PEM"-formatted exported to
the OS environment in variables SSL_CLIENT_CERT and SSL_SERVER_CERT.

Ciao, Michael.

From wmedia at hotmail.com  Fri Aug 18 12:22:02 2000
From: wmedia at hotmail.com (William Smith)
Date: Fri Jan  9 22:02:26 2004
Subject: [mod_python] Problems with mod_python
Message-ID: <F2176fQSgeR4UIS42NX000009c4@hotmail.com>

I am using RedHat 6.2 x86, Apache 1.3.12 and mod_python 2.4.1.
I compiled and installed mod_python with apxs.
Apache runs as user nobody and group nobody

I read the modpython archives and have the following server errors
which I saw mentioned in the archive message Aug 2, 2000 by
Boh Heong Yap (bohheong@asiacontent.com):

   make_obcallback(): could not import mod_python.apache.
    make_obcallback(): could not call init.

I tried in httpd.conf both:

<Directory /usr/apache/python>
        AddHandler python-program .py
        PythonHandler test
        PythonDebug On
</Directory>

and

<Directory /usr/apache/python>
    AddHandler python-program .py
    PythonHandler test
    PythonDebug On
</Directory>

which I also saw in the archives as a fix.  However this did not work.

The directories and files in
/usr/lib/python1.5/site-packages/mod_python are world readable but
owned by root.

Using the comand line I get:

File "/usr/lib/python1.5/site-packages/mod_python/apache.py", line
18, in ?
    import _apache
ImportError: No module named _apache

when I try "from mod_python import apache".

Any help getting this to work would be appreciated.
________________________________________________________________________
Get Your Private, Free E-mail from MSN Hotmail at http://www.hotmail.com


From rsalz at caveosystems.com  Fri Aug 18 12:29:42 2000
From: rsalz at caveosystems.com (Rich Salz)
Date: Fri Jan  9 22:02:26 2004
Subject: [mod_python] Swig, and mod_ssl
References: <Pine.LNX.4.21.0008180839400.15289-100000@saturn.ispol.com> <399D3B4A.7C5772BB@caveosystems.com> <399D5EA3.7975AAEC@stroeder.com>
Message-ID: <399D6476.62BE89E7@caveosystems.com>

>   SSLOptions +ExportCertData

Yes, thanks.  I need more than that.  I need just about full
programmatic control over SSL within my python module.

From grisha at ispol.com  Fri Aug 18 12:30:04 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 22:02:26 2004
Subject: [mod_python] Swig, and mod_ssl
In-Reply-To: <399D5EA3.7975AAEC@stroeder.com>
Message-ID: <Pine.LNX.4.21.0008181228110.18108-100000@saturn.ispol.com>


If that is correct - then all that stuff should show up in 

req.subprocess_env["SSL_CLIENT_CERT"] and ["SSL_SERVER_CERT"]

:-)

Rich - could you verify this?

Grisha

On Fri, 18 Aug 2000, Michael Str?der wrote:

> I'm not sure I fully understand the problem but if you set
> 
>   SSLOptions +ExportCertData
> 
> you will get the client and server certs "PEM"-formatted exported to
> the OS environment in variables SSL_CLIENT_CERT and SSL_SERVER_CERT.



From grisha at ispol.com  Fri Aug 18 12:38:23 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 22:02:26 2004
Subject: [mod_python] Problems with mod_python
In-Reply-To: <F2176fQSgeR4UIS42NX000009c4@hotmail.com>
Message-ID: <Pine.LNX.4.21.0008181237490.18108-100000@saturn.ispol.com>

the only thing I can think of is that the direcories where mod_python is
should also be world executable...

Grisha

On Fri, 18 Aug 2000, William Smith wrote:

> I am using RedHat 6.2 x86, Apache 1.3.12 and mod_python 2.4.1.
> I compiled and installed mod_python with apxs.
> Apache runs as user nobody and group nobody
> 
> I read the modpython archives and have the following server errors
> which I saw mentioned in the archive message Aug 2, 2000 by
> Boh Heong Yap (bohheong@asiacontent.com):
> 
>    make_obcallback(): could not import mod_python.apache.
>     make_obcallback(): could not call init.
> 
> I tried in httpd.conf both:
> 
> <Directory /usr/apache/python>
>         AddHandler python-program .py
>         PythonHandler test
>         PythonDebug On
> </Directory>
> 
> and
> 
> <Directory /usr/apache/python>
>     AddHandler python-program .py
>     PythonHandler test
>     PythonDebug On
> </Directory>
> 
> which I also saw in the archives as a fix.  However this did not work.
> 
> The directories and files in
> /usr/lib/python1.5/site-packages/mod_python are world readable but
> owned by root.
> 
> Using the comand line I get:
> 
> File "/usr/lib/python1.5/site-packages/mod_python/apache.py", line
> 18, in ?
>     import _apache
> ImportError: No module named _apache
> 
> when I try "from mod_python import apache".
> 
> Any help getting this to work would be appreciated.
> ________________________________________________________________________
> Get Your Private, Free E-mail from MSN Hotmail at http://www.hotmail.com
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 


From rsalz at caveosystems.com  Fri Aug 18 12:46:12 2000
From: rsalz at caveosystems.com (Rich Salz)
Date: Fri Jan  9 22:02:26 2004
Subject: [mod_python] Swig, and mod_ssl
References: <Pine.LNX.4.21.0008181228110.18108-100000@saturn.ispol.com>
Message-ID: <399D6854.B5B21303@caveosystems.com>

> >   SSLOptions +ExportCertData
> req.subprocess_env["SSL_CLIENT_CERT"] and ["SSL_SERVER_CERT"]
> Rich - could you verify this?

sure, yup, works fine.  The PEM-encoded server cert (and the client one,
if presented) is ther.  That's not enough for my app, but maybe that's
enough for everyone else, and my little hack isn't needed.
	/r$

From michael at stroeder.com  Fri Aug 18 19:10:49 2000
From: michael at stroeder.com (Michael =?iso-8859-1?Q?Str=F6der?=)
Date: Fri Jan  9 22:02:26 2004
Subject: [mod_python] Swig, and mod_ssl
References: <Pine.LNX.4.21.0008180839400.15289-100000@saturn.ispol.com> <399D3B4A.7C5772BB@caveosystems.com> <399D5EA3.7975AAEC@stroeder.com> <399D6476.62BE89E7@caveosystems.com>
Message-ID: <399D6E19.2B7BA55E@stroeder.com>

Rich Salz wrote:
> 
> >   SSLOptions +ExportCertData
> 
> Yes, thanks.  I need more than that.  I need just about full
> programmatic control over SSL within my python module.

You want to have your own Python written verify callback before
mod_ssl accepts the cert as being valid?

Ciao, Michael.

From grisha at ispol.com  Fri Aug 18 16:50:49 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 22:02:26 2004
Subject: [mod_python] How to define an environment variable for other
 python module to use?
In-Reply-To: <39974AD9.2C33FAE1@ust.hk>
Message-ID: <Pine.LNX.4.21.0008181646320.18916-100000@saturn.ispol.com>

Sorry for a late answer - 

If you are using strictly mod_python (without cgihandler), then the
standard apache SetEnv or PassEnv directives should work.

If you're using cgihandler, and if the python-oracle interface module is
written in C, then most likely it uses the actual process environment. In
this case you will have to use os.putenv() function prior to using the
oracle interface. Otherwise, simply assigning something to os.environ
should do it.

Does this answer your question?

--
  Gregory (Grisha) Trubetskoy
       grisha@ispol.com

On Mon, 14 Aug 2000, David YEUNG wrote:

> I have other python modules which usually need to read some environment
> variables, e.g., an python-oracle interface module needs to read the "ORACLE_SID"
> to know where the database to connect. I used to defining this variable in the "shell"
> before invoking a python CGI program, e.g.:
> 
>    #!/bin/sh
>    export ORACLE_SID=orcl
>    exec /some/oracle/python/interface.cgi
> 
> I would like to try the mod_python using the default CGI handler, but does someone
> know how to define some environment variable in mod_python?
> 
> Thanks
> 
> david
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 


From dyeung at ust.hk  Sat Aug 19 08:15:27 2000
From: dyeung at ust.hk (David Yeung)
Date: Fri Jan  9 22:02:26 2004
Subject: [mod_python] How to define an environment variable for otherpython 
 module to use?
References: <Pine.LNX.4.21.0008181646320.18916-100000@saturn.ispol.com>
Message-ID: <399DD19F.F4CC2B0E@ust.hk>

Gregory

According to the Python document, if os.putvar is used to change the
environment, such changes only affect subprocesses started with
os.system(), popen(), fork() and execv(), so it is probably not
able to solve the problem.

Thanks

david


Gregory Trubetskoy wrote:
> 
> Sorry for a late answer -
> 
> If you are using strictly mod_python (without cgihandler), then the
> standard apache SetEnv or PassEnv directives should work.
> 
> If you're using cgihandler, and if the python-oracle interface module is
> written in C, then most likely it uses the actual process environment. In
> this case you will have to use os.putenv() function prior to using the
> oracle interface. Otherwise, simply assigning something to os.environ
> should do it.
> 
> Does this answer your question?
> 
> --
>   Gregory (Grisha) Trubetskoy
>        grisha@ispol.com
> 
> On Mon, 14 Aug 2000, David YEUNG wrote:
> 
> > I have other python modules which usually need to read some environment
> > variables, e.g., an python-oracle interface module needs to read the "ORACLE_SID"
> > to know where the database to connect. I used to defining this variable in the "shell"
> > before invoking a python CGI program, e.g.:
> >
> >    #!/bin/sh
> >    export ORACLE_SID=orcl
> >    exec /some/oracle/python/interface.cgi
> >
> > I would like to try the mod_python using the default CGI handler, but does someone
> > know how to define some environment variable in mod_python?
> >
> > Thanks
> >
> > david
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://www.modpython.org/mailman/listinfo/mod_python
> >

From lahondes at pasteur.fr  Mon Aug 21 10:22:11 2000
From: lahondes at pasteur.fr (Raynald de Lahondes)
Date: Fri Jan  9 22:02:26 2004
Subject: [mod_python] Problems with mod_python
In-Reply-To: <F2176fQSgeR4UIS42NX000009c4@hotmail.com>; from wmedia@hotmail.com on Fri, Aug 18, 2000 at 12:22:02PM -0400
References: <F2176fQSgeR4UIS42NX000009c4@hotmail.com>
Message-ID: <20000821102211.A19171@pombe.vironc.pasteur.fr>

On Fri, Aug 18, 2000 at 12:22:02PM -0400, William Smith wrote:
> I am using RedHat 6.2 x86, Apache 1.3.12 and mod_python 2.4.1.
> I compiled and installed mod_python with apxs.
> Apache runs as user nobody and group nobody
>
> I read the modpython archives and have the following server errors
> which I saw mentioned in the archive message Aug 2, 2000 by
> Boh Heong Yap (bohheong@asiacontent.com):
>
>    make_obcallback(): could not import mod_python.apache.
>     make_obcallback(): could not call init.

Are you sure you installed the libs properly ? (I think I had those errors
when libs where not OK). When the python libs were installed (Ist part of
Install) recompiling whith apxs and re-installing the mod_python.so solved
the pb.

> Using the comand line I get:
> 
> File "/usr/lib/python1.5/site-packages/mod_python/apache.py", line
> 18, in ?
>     import _apache
> ImportError: No module named _apache
> 
> when I try "from mod_python import apache".
> 

I am not familiar neither with external extension of python nor apache but I
understand that "import _apache" only works within apache module, because
it's a call to mod_python.so code. Anyway my mod-python works and "import
_apache" still does not work...

I hope you find this usefull.

Raynald de Lahond?s
lahondes@pasteur.fr


From grisha at ispol.com  Mon Aug 21 16:54:29 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 22:02:26 2004
Subject: [mod_python] How to define an environment variable for otherpython
  module to use?
In-Reply-To: <399DD19F.F4CC2B0E@ust.hk>
Message-ID: <Pine.LNX.4.21.0008211652540.7663-100000@saturn.ispol.com>

David - 

I just looked at the docs, and I didn't see the word "only" mentioned
anywhere.

Grisha


On Sat, 19 Aug 2000, David Yeung wrote:

> Gregory
> 
> According to the Python document, if os.putvar is used to change the
> environment, such changes only affect subprocesses started with
> os.system(), popen(), fork() and execv(), so it is probably not
> able to solve the problem.
> 
> Thanks
> 
> david
> 
> 
> Gregory Trubetskoy wrote:
> > 
> > Sorry for a late answer -
> > 
> > If you are using strictly mod_python (without cgihandler), then the
> > standard apache SetEnv or PassEnv directives should work.
> > 
> > If you're using cgihandler, and if the python-oracle interface module is
> > written in C, then most likely it uses the actual process environment. In
> > this case you will have to use os.putenv() function prior to using the
> > oracle interface. Otherwise, simply assigning something to os.environ
> > should do it.
> > 
> > Does this answer your question?
> > 
> > --
> >   Gregory (Grisha) Trubetskoy
> >        grisha@ispol.com
> > 
> > On Mon, 14 Aug 2000, David YEUNG wrote:
> > 
> > > I have other python modules which usually need to read some environment
> > > variables, e.g., an python-oracle interface module needs to read the "ORACLE_SID"
> > > to know where the database to connect. I used to defining this variable in the "shell"
> > > before invoking a python CGI program, e.g.:
> > >
> > >    #!/bin/sh
> > >    export ORACLE_SID=orcl
> > >    exec /some/oracle/python/interface.cgi
> > >
> > > I would like to try the mod_python using the default CGI handler, but does someone
> > > know how to define some environment variable in mod_python?
> > >
> > > Thanks
> > >
> > > david
> > > _______________________________________________
> > > Mod_python mailing list
> > > Mod_python@modpython.org
> > > http://www.modpython.org/mailman/listinfo/mod_python
> > >
> 


From bryan at optimumnetwork.com  Tue Aug 22 12:00:04 2000
From: bryan at optimumnetwork.com (Bryan O'Shea)
Date: Fri Jan  9 22:02:26 2004
Subject: [mod_python] Build errors with php-4.0.1pl2
Message-ID: <39A224F4.14224BCE@optimumnetwork.com>

i am having troubles building with php-4.0.1pl2 and mod_python-2.4.1
i compiled installed php then followed installs instructions for
mod_python then went to build apache with

./configure --prefix=/home/apache
--activate-module=src/modules/extra/mod_python.c \
--activate-module=src/modules/php4/libphp4.a

if i build with one or the other the build turns out ok. when i
build both modules together it flops


any help would be apreciated
thanks

************************************************************************************************

<=== src/modules/standard
===> src/modules/extra
gcc -c -I/usr/local/include/python1.5 -I../../os/unix -I../../include
-DLINUX=2 -I/home/bryan/src/php-4.0.1pl2
-I/home/bryan/src/php-4.0.1pl2/main -I/home/bryan/src/php-4.0.1pl2/main
-I/home/bryan/src/php-4.0.1pl2/Zend -I/home/bryan/src/php-4.0.1pl2/Zend
-I/home/bryan/src/php-4.0.1pl2 -DUSE_EXPAT -I../../lib/expat-lite
-DNO_DL_NEEDED `../../apaci` mod_python.c
rm -f libextra.a
ar cr libextra.a mod_python.o
ranlib libextra.a
<=== src/modules/extra
===> src/modules/php4
gcc -c -I/usr/local/include/python1.5 -I../../os/unix -I../../include
-DLINUX=2 -I/home/bryan/src/php-4.0.1pl2
-I/home/bryan/src/php-4.0.1pl2/main -I/home/bryan/src/php-4.0.1pl2/main
-I/home/bryan/src/php-4.0.1pl2/Zend -I/home/bryan/src/php-4.0.1pl2/Zend
-I/home/bryan/src/php-4.0.1pl2 -DUSE_EXPAT -I../../lib/expat-lite
-DNO_DL_NEEDED `../../apaci`  mod_php4.c
cp libmodphp4.a libphp4.a
ar r libphp4.a mod_php4.o
ranlib libphp4.a
<=== src/modules/php4
<=== src/modules
gcc -c -I/usr/local/include/python1.5 -I./os/unix -I./include
-DLINUX=2 -I/home/bryan/src/php-4.0.1pl2
-I/home/bryan/src/php-4.0.1pl2/main -I/home/bryan/src/php-4.0.1pl2/main
-I/home/bryan/src/php-4.0.1pl2/Zend -I/home/bryan/src/php-4.0.1pl2/Zend
-I/home/bryan/src/php-4.0.1pl2 -DUSE_EXPAT -I./lib/expat-lite
-DNO_DL_NEEDED `./apaci` modules.c
gcc -c -I/usr/local/include/python1.5 -I./os/unix -I./include
-DLINUX=2 -I/home/bryan/src/php-4.0.1pl2
-I/home/bryan/src/php-4.0.1pl2/main -I/home/bryan/src/php-4.0.1pl2/main
-I/home/bryan/src/php-4.0.1pl2/Zend -I/home/bryan/src/php-4.0.1pl2/Zend
-I/home/bryan/src/php-4.0.1pl2 -DUSE_EXPAT -I./lib/expat-lite
-DNO_DL_NEEDED `./apaci` buildmark.c
gcc  -DLINUX=2 -I/home/bryan/src/php-4.0.1pl2
-I/home/bryan/src/php-4.0.1pl2/main -I/home/bryan/src/php-4.0.1pl2/main
-I/home/bryan/src/php-4.0.1pl2/Zend -I/home/bryan/src/php-4.0.1pl2/Zend
-I/home/bryan/src/php-4.0.1pl2 -DUSE_EXPAT -I./lib/expat-lite
-DNO_DL_NEEDED `./apaci` -Xlinker -export-dynamic       \
      -o httpd buildmark.o modules.o modules/standard/libstandard.a
modules/extra/libextra.a modules/php4/libphp4.a main/libmain.a
./os/unix/libos.a ap/libap.a  lib/expat-lite/libexpat.a
-Wl,-rpath,/usr/local/mysql/lib/mysql -Wl,-rpath,/usr/local/pgsql/lib
-rdynamic -L/usr/local/mysql/lib/mysql -L/usr/local/pgsql/lib
-Lmodules/php4 -L../modules/php4 -L../../modules/php4 -lmodphp4  -lgdbm
-lpam  -ldl -lpq -lmysqlclient -lresolv -lm -ldl -lcrypt -lnsl
-lresolv  -lm -lcrypt /usr/local/lib/python1.5/config/libpython1.5.a
-lieee -lnet -ldl  -lpthread   -lm
/usr/local/lib/python1.5/config/libpython1.5.a(pypcre.o): In function
`pcre_study':
/home/bryan/src/Python-1.5.2/Modules/./pypcre.c:501: multiple definition

of `pcre_malloc'
modules/php4/libphp4.a(pcre.o):/home/bryan/src/php-4.0.1pl2/ext/pcre/pcrelib/pcre.c:238:

first defined here
/usr/local/lib/python1.5/config/libpython1.5.a(pypcre.o): In function
`pcre_study':
/home/bryan/src/Python-1.5.2/Modules/./pypcre.c:501: multiple definition

of `pcre_free'
modules/php4/libphp4.a(pcre.o):/home/bryan/src/php-4.0.1pl2/ext/pcre/pcrelib/pcre.c:238:

first defined here
collect2: ld returned 1 exit status
make[2]: *** [target_static] Error 1
make[2]: Leaving directory `/home/bryan/src/apache_1.3.12/src'
make[1]: *** [build-std] Error 2
make[1]: Leaving directory `/home/bryan/src/apache_1.3.12'
make: *** [build] Error 2




From chris at zeus.foote.com.au  Wed Aug 23 14:12:05 2000
From: chris at zeus.foote.com.au (Chris Foote)
Date: Fri Jan  9 22:02:26 2004
Subject: [mod_python] interoperability with cgi module
Message-ID: <Pine.BSF.4.20.0008231317520.26683-100000@localhost>

Is there any way of getting the CGI environment from mod_python
(i.e. via req.add_common_vars()) usable by the Python libraries
standard cgi module ?

e.g. something like the following (html form POST's to this script):

import os
import cgi
from mod_python import apache

def handler(req):
	req.content_type  = "text/plain"
	req.send_http_header()
	
	req.add_common_vars()
	
	# add req's CGI vars into the environment
	for k in req.subprocess_env.keys():
		os.environ[k] = req.subprocess_env[k]

	form = cgi.FieldStorage()
	cgi.parse_header(str(req.headers_in))

	len = int(req.headers_in["content-length"])
	form_data = req.read(len)
	cgi.parse_qs(form_data)

	cgi.test()
	if form.has_key("field"):
		req.write('field = ' + form["field"].value + '\n')

	return apache.OK

however, the cgi module doesn't display anything for cgi.test()
and form['field'] doesn't exist.

I'm new to Python, and especially mod_pythod - am I going about
this in the wrong way ?  i.e. should I be bothering with the cgi
module at all ?



Cheers,

Chris Foote                        chris@zeus.foote.com.au


From R.Barrett at ftel.co.uk  Wed Aug 23 11:30:18 2000
From: R.Barrett at ftel.co.uk (Richard Barrett)
Date: Fri Jan  9 22:02:26 2004
Subject: [mod_python] extended access to conn_rec
Message-ID: <v04220803b5c94cb54996@[172.16.3.104]>

I've started working with mod_python-2.4.1; good stuff.

I wanted to access the local_addr and remote_addr fields of the 
conn_rec struct but access to the fields is not supported via the 
connection object by mod_python.so

Accordingly I've added some code to mod_python.c to return the 
contents of these fields. The code is a minor variation of functions 
'borrowed' from socketmodule.c in the standard Python 1.5.2 
distribution. The python object returned is the same as that returned 
by the getpeername and getsockname member functions on standard 
socket objects. I would have called functions makeipaddr  and 
makesockaddr in socketmodule.so instead of adding copies to 
mod_python but they are declared as static in socketmodule.c and 
hence are unavailable.

If there is a better way of doing this or anything I've said above is 
rubbish I would appreciate some (polite) feedback. I don't claim any 
particular expertise with C or python extensions so some reader may 
find fault with this stuff. But it works for me so far.

The diff for my changes to mod_python.c follow:
-----------------------------------------------------


91a92,94
>  /* Other headers */
>  #include <sys/socket.h>
>
928a932,954
>  static PyObject *
>  mymakeipaddr(struct sockaddr_in *addr)
>  {
>      long x = ntohl(addr->sin_addr.s_addr);
>      char buf[100];
>      sprintf(buf, "%d.%d.%d.%d",
>          (int) (x>>24) & 0xff, (int) (x>>16) & 0xff,
>          (int) (x>> 8) & 0xff, (int) (x>> 0) & 0xff);
>      return PyString_FromString(buf);
>  }
>
>  static PyObject *
>  mymakesockaddr(struct sockaddr_in *addr)
>  {
>      PyObject *addrobj = mymakeipaddr(addr);
>      PyObject *ret = NULL;
>      if (addrobj) {
>          ret = Py_BuildValue("Oi", addrobj, ntohs(addr->sin_port));
>          Py_DECREF(addrobj);
>      }
>      return ret;
>  }
>
968a995,1000
>      else if (strcmp(name, "local_addr") == 0) {
>  		return mymakesockaddr(&(self->conn->local_addr));
>  	}
>      else if (strcmp(name, "remote_addr") == 0) {
>  		return mymakesockaddr(&(self->conn->remote_addr));
>  	}
------------------------------------------------------------------
Richard Barrett, PostPoint 27,         e-mail:r.barrett@ftel.co.uk
Fujitsu Telecommunications Europe Ltd,      tel: (44) 121 717 6337
Solihull Parkway, Birmingham Business Park, B37 7YU, England
"Democracy is two wolves and a lamb voting on what to have for
lunch. Liberty is a well armed lamb contesting the vote."
Benjamin Franklin, 1759
------------------------------------------------------------------

From grisha at ispol.com  Wed Aug 23 09:22:50 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 22:02:26 2004
Subject: [mod_python] interoperability with cgi module
In-Reply-To: <Pine.BSF.4.20.0008231317520.26683-100000@localhost>
Message-ID: <Pine.LNX.4.21.0008230920200.14880-100000@saturn.ispol.com>

Look at how it's done in the cgihandler:
http://www.modpython.org/live/mod_python-2.4.1/lib/python/mod_python/cgihandler.py

apache.setup_cgi() is what you need.

as a shortcut, I think 

os.env = req.subprocess_env 

might just do the trick.

Grisha

--
  Gregory (Grisha) Trubetskoy
       grisha@ispol.com

On Wed, 23 Aug 2000, Chris Foote wrote:

> Is there any way of getting the CGI environment from mod_python
> (i.e. via req.add_common_vars()) usable by the Python libraries
> standard cgi module ?
> 
> e.g. something like the following (html form POST's to this script):
> 
> import os
> import cgi
> from mod_python import apache
> 
> def handler(req):
> 	req.content_type  = "text/plain"
> 	req.send_http_header()
> 	
> 	req.add_common_vars()
> 	
> 	# add req's CGI vars into the environment
> 	for k in req.subprocess_env.keys():
> 		os.environ[k] = req.subprocess_env[k]
> 
> 	form = cgi.FieldStorage()
> 	cgi.parse_header(str(req.headers_in))
> 
> 	len = int(req.headers_in["content-length"])
> 	form_data = req.read(len)
> 	cgi.parse_qs(form_data)
> 
> 	cgi.test()
> 	if form.has_key("field"):
> 		req.write('field = ' + form["field"].value + '\n')
> 
> 	return apache.OK
> 
> however, the cgi module doesn't display anything for cgi.test()
> and form['field'] doesn't exist.
> 
> I'm new to Python, and especially mod_pythod - am I going about
> this in the wrong way ?  i.e. should I be bothering with the cgi
> module at all ?
> 
> 
> 
> Cheers,
> 
> Chris Foote                        chris@zeus.foote.com.au
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 


From miguel at yorku.ca  Wed Aug 23 09:35:34 2000
From: miguel at yorku.ca (Miguel Marques)
Date: Fri Jan  9 22:02:26 2004
Subject: [mod_python] interoperability with cgi module
In-Reply-To: <Pine.BSF.4.20.0008231317520.26683-100000@localhost>
References: <Pine.BSF.4.20.0008231317520.26683-100000@localhost>
Message-ID: <20000823093534X.miguel@yorku.ca>

On Wed, 23 Aug 2000 14:12:05 +0930 (CST), Chris Foote <chris@zeus.foote.com.au> wrote:
> Is there any way of getting the CGI environment from mod_python
> (i.e. via req.add_common_vars()) usable by the Python libraries
> standard cgi module ?
> 
> e.g. something like the following (html form POST's to this script):
> 
> import os
> import cgi
> from mod_python import apache
> 
> def handler(req):
> 	req.content_type  = "text/plain"
> 	req.send_http_header()
> 	
> 	req.add_common_vars()
> 	
> 	# add req's CGI vars into the environment
> 	for k in req.subprocess_env.keys():
> 		os.environ[k] = req.subprocess_env[k]
> 
> 	form = cgi.FieldStorage()
> 	cgi.parse_header(str(req.headers_in))
> 
> 	len = int(req.headers_in["content-length"])
> 	form_data = req.read(len)
> 	cgi.parse_qs(form_data)
> 
> 	cgi.test()
> 	if form.has_key("field"):
> 		req.write('field = ' + form["field"].value + '\n')
> 
> 	return apache.OK
> 
> however, the cgi module doesn't display anything for cgi.test()
> and form['field'] doesn't exist.
Above try
    form = cgi.parse_qs(form_data)
to get the POST data.  cgi.parse_qs returns a dictionary with the
data.


						Miguel

C. Miguel Marques, York University, Computing & Communications Services
e-mail: miguel@yorku.ca, voice: (416)736-2100x22684, fax: (416)736-5830


From hdstich at commplex-media.de  Thu Aug 24 09:24:08 2000
From: hdstich at commplex-media.de (Hans-Dieter Stich)
Date: Fri Jan  9 22:02:26 2004
Subject: [mod_python] re.compile problem
Message-ID: <XFMail.000824092408.hdstich@commplex-media.de>

i have seen messages on the mailing list about problems with the compiling of
regular expressons! are there any new hints?

my mod_python is build also dynamically into the apache!

thanx!

ciao
h-d

____________________________________________________________________

  Commplex Media AG             Hans-Dieter Stich/CTO
  Office Ulm                    fon:  +49-7304-434997
  Development Team              fax:  +49-7304-434998
  Spatzenweg 12                 mail: hdstich@commplex-media.de
  89160 Dornstadt               web:  http://www.commplex-media.de/
____________________________________________________________________


From walaces at prasair.com.br  Mon Aug 28 12:23:24 2000
From: walaces at prasair.com.br (Walace Soares)
Date: Fri Jan  9 22:02:26 2004
Subject: [mod_python] Apache Problems
Message-ID: <E13FB1366C26D411BDD9000102240287046FC2@SERVIDOR>

Hi,

I have the mod_python instaled within Apache in a Linux slackware box.
Python is working fine.
But when I am trying to run mod_python, apache show me the message:

Mod_python error: "PythonHandler pytest.py"
Traceback (innermost last): File
"/usr/lib/python1.5/site-packages/mod_python/apache.py", line 113, in
Dispatch module = import_module(module_name, req)
File "/usr/lib/python1.5/site-packages/mod_python/apache.py", line 246, in
import_module module = __import__(module_name)
File "/usr/lib/python1.5/pytest.py", line 3
req.send_httpd header()
		^
SyntaxError: invalid syntax


Could Anyone please help me ?


Walace

My configuration:
Slacware 7.0
Apache 1.3.12
Python 1.5.2
mod_python 2.4.1





From miguel at yorku.ca  Mon Aug 28 11:49:05 2000
From: miguel at yorku.ca (Miguel Marques)
Date: Fri Jan  9 22:02:27 2004
Subject: [mod_python] Apache Problems
In-Reply-To: <E13FB1366C26D411BDD9000102240287046FC2@SERVIDOR>
References: <E13FB1366C26D411BDD9000102240287046FC2@SERVIDOR>
Message-ID: <20000828114905P.miguel@yorku.ca>

On Mon, 28 Aug 2000 12:23:24 -0300, "Walace Soares" <walaces@prasair.com.br> wrote:
> Hi,
> 
> I have the mod_python instaled within Apache in a Linux slackware box.
> Python is working fine.
> But when I am trying to run mod_python, apache show me the message:
> 
> Mod_python error: "PythonHandler pytest.py"
> Traceback (innermost last): File
> "/usr/lib/python1.5/site-packages/mod_python/apache.py", line 113, in
> Dispatch module = import_module(module_name, req)
> File "/usr/lib/python1.5/site-packages/mod_python/apache.py", line 246, in
> import_module module = __import__(module_name)
> File "/usr/lib/python1.5/pytest.py", line 3
> req.send_httpd header()
> 		^
> SyntaxError: invalid syntax
I think that should be:
req.send_http_header()

							Miguel

C. Miguel Marques, York University, Computing & Communications Services
e-mail: miguel@yorku.ca, voice: (416)736-2100x22684, fax: (416)736-5830

From bryan at optimumnetwork.com  Tue Aug 29 14:14:54 2000
From: bryan at optimumnetwork.com (Bryan O'Shea)
Date: Fri Jan  9 22:02:27 2004
Subject: [mod_python] test
Message-ID: <39AB7F0E.6219DB78@optimumnetwork.com>

does the list work ??


From bryan at optimumnetwork.com  Tue Aug 29 14:48:53 2000
From: bryan at optimumnetwork.com (Bryan O'Shea)
Date: Fri Jan  9 22:02:27 2004
Subject: [mod_python] php and mod_python compile problems with apache
Message-ID: <39AB8705.D8532012@optimumnetwork.com>

i am having troubles building with php-4.0.1pl2 and mod_python-2.4.1
i compiled installed php then followed installs instructions for
mod_python then went to build apache with

./configure --prefix=/home/apache
--activate-module=src/modules/extra/mod_python.c \
--activate-module=src/modules/php4/libphp4.a

if i build with one or the other the build turns out ok. when i
build both modules together it flops


any help would be apreciated
thanks

************************************************************************************************

<=== src/modules/standard
===> src/modules/extra
gcc -c -I/usr/local/include/python1.5 -I../../os/unix -I../../include
-DLINUX=2 -I/home/bryan/src/php-4.0.1pl2
-I/home/bryan/src/php-4.0.1pl2/main -I/home/bryan/src/php-4.0.1pl2/main
-I/home/bryan/src/php-4.0.1pl2/Zend -I/home/bryan/src/php-4.0.1pl2/Zend
-I/home/bryan/src/php-4.0.1pl2 -DUSE_EXPAT -I../../lib/expat-lite
-DNO_DL_NEEDED `../../apaci` mod_python.c
rm -f libextra.a
ar cr libextra.a mod_python.o
ranlib libextra.a
<=== src/modules/extra
===> src/modules/php4
gcc -c -I/usr/local/include/python1.5 -I../../os/unix -I../../include
-DLINUX=2 -I/home/bryan/src/php-4.0.1pl2
-I/home/bryan/src/php-4.0.1pl2/main -I/home/bryan/src/php-4.0.1pl2/main
-I/home/bryan/src/php-4.0.1pl2/Zend -I/home/bryan/src/php-4.0.1pl2/Zend
-I/home/bryan/src/php-4.0.1pl2 -DUSE_EXPAT -I../../lib/expat-lite
-DNO_DL_NEEDED `../../apaci`  mod_php4.c
cp libmodphp4.a libphp4.a
ar r libphp4.a mod_php4.o
ranlib libphp4.a
<=== src/modules/php4
<=== src/modules
gcc -c -I/usr/local/include/python1.5 -I./os/unix -I./include
-DLINUX=2 -I/home/bryan/src/php-4.0.1pl2
-I/home/bryan/src/php-4.0.1pl2/main -I/home/bryan/src/php-4.0.1pl2/main
-I/home/bryan/src/php-4.0.1pl2/Zend -I/home/bryan/src/php-4.0.1pl2/Zend
-I/home/bryan/src/php-4.0.1pl2 -DUSE_EXPAT -I./lib/expat-lite
-DNO_DL_NEEDED `./apaci` modules.c
gcc -c -I/usr/local/include/python1.5 -I./os/unix -I./include
-DLINUX=2 -I/home/bryan/src/php-4.0.1pl2
-I/home/bryan/src/php-4.0.1pl2/main -I/home/bryan/src/php-4.0.1pl2/main
-I/home/bryan/src/php-4.0.1pl2/Zend -I/home/bryan/src/php-4.0.1pl2/Zend
-I/home/bryan/src/php-4.0.1pl2 -DUSE_EXPAT -I./lib/expat-lite
-DNO_DL_NEEDED `./apaci` buildmark.c
gcc  -DLINUX=2 -I/home/bryan/src/php-4.0.1pl2
-I/home/bryan/src/php-4.0.1pl2/main -I/home/bryan/src/php-4.0.1pl2/main
-I/home/bryan/src/php-4.0.1pl2/Zend -I/home/bryan/src/php-4.0.1pl2/Zend
-I/home/bryan/src/php-4.0.1pl2 -DUSE_EXPAT -I./lib/expat-lite
-DNO_DL_NEEDED `./apaci` -Xlinker -export-dynamic       \
      -o httpd buildmark.o modules.o modules/standard/libstandard.a
modules/extra/libextra.a modules/php4/libphp4.a main/libmain.a
./os/unix/libos.a ap/libap.a  lib/expat-lite/libexpat.a
-Wl,-rpath,/usr/local/mysql/lib/mysql -Wl,-rpath,/usr/local/pgsql/lib
-rdynamic -L/usr/local/mysql/lib/mysql -L/usr/local/pgsql/lib
-Lmodules/php4 -L../modules/php4 -L../../modules/php4 -lmodphp4  -lgdbm
-lpam  -ldl -lpq -lmysqlclient -lresolv -lm -ldl -lcrypt -lnsl
-lresolv  -lm -lcrypt /usr/local/lib/python1.5/config/libpython1.5.a
-lieee -lnet -ldl  -lpthread   -lm
/usr/local/lib/python1.5/config/libpython1.5.a(pypcre.o): In function
`pcre_study':
/home/bryan/src/Python-1.5.2/Modules/./pypcre.c:501: multiple definition

of `pcre_malloc'
modules/php4/libphp4.a(pcre.o):/home/bryan/src/php-4.0.1pl2/ext/pcre/pcrelib/pcre.c:238:

first defined here
/usr/local/lib/python1.5/config/libpython1.5.a(pypcre.o): In function
`pcre_study':
/home/bryan/src/Python-1.5.2/Modules/./pypcre.c:501: multiple definition

of `pcre_free'
modules/php4/libphp4.a(pcre.o):/home/bryan/src/php-4.0.1pl2/ext/pcre/pcrelib/pcre.c:238:

first defined here
collect2: ld returned 1 exit status
make[2]: *** [target_static] Error 1
make[2]: Leaving directory `/home/bryan/src/apache_1.3.12/src'
make[1]: *** [build-std] Error 2
make[1]: Leaving directory `/home/bryan/src/apache_1.3.12'
make: *** [build] Error 2






From grisha at ispol.com  Tue Aug 29 15:39:07 2000
From: grisha at ispol.com (Gregory Trubetskoy)
Date: Fri Jan  9 22:02:27 2004
Subject: [mod_python] php and mod_python compile problems with apache
In-Reply-To: <39AB8705.D8532012@optimumnetwork.com>
Message-ID: <Pine.LNX.4.21.0008291537030.15779-100000@saturn.ispol.com>

I know this has something to do with the pcre (regular
expression) library. I think both PHP and Python have to be linked against
the same version or else it won't work. I saw something about this come
across the apache list - apache 2.0 uses pcre as well and that causes some
problems for Python.

Perhaps someone more knowledgeable on the subject can enlighten us?

--
  Gregory (Grisha) Trubetskoy
       grisha@ispol.com

On Tue, 29 Aug 2000, Bryan O'Shea wrote:

> i am having troubles building with php-4.0.1pl2 and mod_python-2.4.1
> i compiled installed php then followed installs instructions for
> mod_python then went to build apache with
> 
> ./configure --prefix=/home/apache
> --activate-module=src/modules/extra/mod_python.c \
> --activate-module=src/modules/php4/libphp4.a
> 
> if i build with one or the other the build turns out ok. when i
> build both modules together it flops
> 
> 
> any help would be apreciated
> thanks
> 
> ************************************************************************************************
> 
> <=== src/modules/standard
> ===> src/modules/extra
> gcc -c -I/usr/local/include/python1.5 -I../../os/unix -I../../include
> -DLINUX=2 -I/home/bryan/src/php-4.0.1pl2
> -I/home/bryan/src/php-4.0.1pl2/main -I/home/bryan/src/php-4.0.1pl2/main
> -I/home/bryan/src/php-4.0.1pl2/Zend -I/home/bryan/src/php-4.0.1pl2/Zend
> -I/home/bryan/src/php-4.0.1pl2 -DUSE_EXPAT -I../../lib/expat-lite
> -DNO_DL_NEEDED `../../apaci` mod_python.c
> rm -f libextra.a
> ar cr libextra.a mod_python.o
> ranlib libextra.a
> <=== src/modules/extra
> ===> src/modules/php4
> gcc -c -I/usr/local/include/python1.5 -I../../os/unix -I../../include
> -DLINUX=2 -I/home/bryan/src/php-4.0.1pl2
> -I/home/bryan/src/php-4.0.1pl2/main -I/home/bryan/src/php-4.0.1pl2/main
> -I/home/bryan/src/php-4.0.1pl2/Zend -I/home/bryan/src/php-4.0.1pl2/Zend
> -I/home/bryan/src/php-4.0.1pl2 -DUSE_EXPAT -I../../lib/expat-lite
> -DNO_DL_NEEDED `../../apaci`  mod_php4.c
> cp libmodphp4.a libphp4.a
> ar r libphp4.a mod_php4.o
> ranlib libphp4.a
> <=== src/modules/php4
> <=== src/modules
> gcc -c -I/usr/local/include/python1.5 -I./os/unix -I./include
> -DLINUX=2 -I/home/bryan/src/php-4.0.1pl2
> -I/home/bryan/src/php-4.0.1pl2/main -I/home/bryan/src/php-4.0.1pl2/main
> -I/home/bryan/src/php-4.0.1pl2/Zend -I/home/bryan/src/php-4.0.1pl2/Zend
> -I/home/bryan/src/php-4.0.1pl2 -DUSE_EXPAT -I./lib/expat-lite
> -DNO_DL_NEEDED `./apaci` modules.c
> gcc -c -I/usr/local/include/python1.5 -I./os/unix -I./include
> -DLINUX=2 -I/home/bryan/src/php-4.0.1pl2
> -I/home/bryan/src/php-4.0.1pl2/main -I/home/bryan/src/php-4.0.1pl2/main
> -I/home/bryan/src/php-4.0.1pl2/Zend -I/home/bryan/src/php-4.0.1pl2/Zend
> -I/home/bryan/src/php-4.0.1pl2 -DUSE_EXPAT -I./lib/expat-lite
> -DNO_DL_NEEDED `./apaci` buildmark.c
> gcc  -DLINUX=2 -I/home/bryan/src/php-4.0.1pl2
> -I/home/bryan/src/php-4.0.1pl2/main -I/home/bryan/src/php-4.0.1pl2/main
> -I/home/bryan/src/php-4.0.1pl2/Zend -I/home/bryan/src/php-4.0.1pl2/Zend
> -I/home/bryan/src/php-4.0.1pl2 -DUSE_EXPAT -I./lib/expat-lite
> -DNO_DL_NEEDED `./apaci` -Xlinker -export-dynamic       \
>       -o httpd buildmark.o modules.o modules/standard/libstandard.a
> modules/extra/libextra.a modules/php4/libphp4.a main/libmain.a
> ./os/unix/libos.a ap/libap.a  lib/expat-lite/libexpat.a
> -Wl,-rpath,/usr/local/mysql/lib/mysql -Wl,-rpath,/usr/local/pgsql/lib
> -rdynamic -L/usr/local/mysql/lib/mysql -L/usr/local/pgsql/lib
> -Lmodules/php4 -L../modules/php4 -L../../modules/php4 -lmodphp4  -lgdbm
> -lpam  -ldl -lpq -lmysqlclient -lresolv -lm -ldl -lcrypt -lnsl
> -lresolv  -lm -lcrypt /usr/local/lib/python1.5/config/libpython1.5.a
> -lieee -lnet -ldl  -lpthread   -lm
> /usr/local/lib/python1.5/config/libpython1.5.a(pypcre.o): In function
> `pcre_study':
> /home/bryan/src/Python-1.5.2/Modules/./pypcre.c:501: multiple definition
> 
> of `pcre_malloc'
> modules/php4/libphp4.a(pcre.o):/home/bryan/src/php-4.0.1pl2/ext/pcre/pcrelib/pcre.c:238:
> 
> first defined here
> /usr/local/lib/python1.5/config/libpython1.5.a(pypcre.o): In function
> `pcre_study':
> /home/bryan/src/Python-1.5.2/Modules/./pypcre.c:501: multiple definition
> 
> of `pcre_free'
> modules/php4/libphp4.a(pcre.o):/home/bryan/src/php-4.0.1pl2/ext/pcre/pcrelib/pcre.c:238:
> 
> first defined here
> collect2: ld returned 1 exit status
> make[2]: *** [target_static] Error 1
> make[2]: Leaving directory `/home/bryan/src/apache_1.3.12/src'
> make[1]: *** [build-std] Error 2
> make[1]: Leaving directory `/home/bryan/src/apache_1.3.12'
> make: *** [build] Error 2
> 
> 
> 
> 
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://www.modpython.org/mailman/listinfo/mod_python
> 


From kkinder at tridog.com  Tue Aug 29 14:36:09 2000
From: kkinder at tridog.com (Ken Kinder)
Date: Fri Jan  9 22:02:27 2004
Subject: [mod_python] PyApache, FastCGI, modpython comparison
Message-ID: <39AC1EB9.E59FDF64@tridog.com>

Can some give me a feel for the differences between PyApache,
FastCGI/Python, ModPython? I would like to know specifically about
portability, performance issues, and process control. I've written much
of a Python-based online store which I plan to Open Source and am now
needing to look at persistance. The non-serial, threaded environment is
a must.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: kkinder.vcf
Type: text/x-vcard
Size: 244 bytes
Desc: Card for Ken Kinder
Url : http://mailman.modpython.org/pipermail/mod_python/attachments/20000829/eebfd259/kkinder-0003.vcf
