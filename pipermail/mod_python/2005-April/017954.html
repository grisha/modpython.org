<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] SSL Socket Problem
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20SSL%20Socket%20Problem&In-Reply-To=016c01c5460f%24bb43e590%240300a8c0%40Dan">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017910.html">
   <LINK REL="Next"  HREF="017955.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] SSL Socket Problem</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Huzaifa Tapal</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20SSL%20Socket%20Problem&In-Reply-To=016c01c5460f%24bb43e590%240300a8c0%40Dan"
       TITLE="[mod_python] SSL Socket Problem">huzaifa at hostway.com
       </A><BR>
    <I>Wed Apr 27 15:27:45 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="017910.html">[mod_python] SSL Socket Problem
</A></li>
        <LI>Next message: <A HREF="017955.html">[mod_python] SSL Socket Problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17954">[ date ]</a>
              <a href="thread.html#17954">[ thread ]</a>
              <a href="subject.html#17954">[ subject ]</a>
              <a href="author.html#17954">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello Dan,

I have been doing some research and we checked tcpdump and netstats 
while the error is happening and there are no socket connections open.  
Is there a thread safety issue in httplib and socket?  What concerns me 
is that the ssl() method in socket.py is at the global level meaning 
that the somehow the sockets are being changed by multiple threads.

hozi

Dan Nelson wrote:

&gt;<i> If it's working for a while and then you get an error, perhaps it has 
</I>&gt;<i> something to do with apache reaching some limit, queueing/caching, too 
</I>&gt;<i> many threads, too many sockets...  That might be a place to start 
</I>&gt;<i> looking.
</I>&gt;<i>
</I>&gt;<i> Dan
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> ----- Original Message ----- From: &quot;Huzaifa Tapal&quot; &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">huzaifa at hostway.com</A>&gt;
</I>&gt;<i> To: &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">mod_python at modpython.org</A>&gt;
</I>&gt;<i> Sent: Thursday, 21 April, 2005 2:56 AM
</I>&gt;<i> Subject: [mod_python] SSL Socket Problem
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i> Hello All,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I am having a problem with making SSL socket connections in my 
</I>&gt;&gt;<i> mod_python application running with python 2.3.5.  The error I keep 
</I>&gt;&gt;<i> getting back is &quot;TypeError: ssl() argument 1 must be _socket.socket, 
</I>&gt;&gt;<i> not _socketobject&quot;. What is odd is that if I restart the apache2 web 
</I>&gt;&gt;<i> server, the error goes away and all the calls return back with a 
</I>&gt;&gt;<i> message.  However, after about 20 or so minutes we start getting this 
</I>&gt;&gt;<i> error almost instantaneously without any kind of message going out at 
</I>&gt;&gt;<i> all.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Here is the full traceback:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>         con.endheaders()
</I>&gt;&gt;<i>        File &quot;/usr/lib/python2.3/httplib.py&quot;, line 715, in endheaders
</I>&gt;&gt;<i>         self._send_output()
</I>&gt;&gt;<i>        File &quot;/usr/lib/python2.3/httplib.py&quot;, line 600, in _send_output
</I>&gt;&gt;<i>         self.send(msg)
</I>&gt;&gt;<i>        File &quot;/usr/lib/python2.3/httplib.py&quot;, line 567, in send
</I>&gt;&gt;<i>         self.connect()
</I>&gt;&gt;<i>        File &quot;/usr/lib/python2.3/httplib.py&quot;, line 988, in connect
</I>&gt;&gt;<i>         ssl = socket.ssl(sock, self.key_file, self.cert_file)
</I>&gt;&gt;<i>        File &quot;/usr/lib/python2.3/socket.py&quot;, line 73, in ssl
</I>&gt;&gt;<i>         return _realssl(sock, keyfile, certfile)
</I>&gt;&gt;<i>     TypeError: ssl() argument 1 must be _socket.socket, not 
</I>&gt;&gt;<i> _socketobject
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I have the same application running on another machine with python 
</I>&gt;&gt;<i> 2.3.4 and I can't replicate it in there.  Do you guys know of any 
</I>&gt;&gt;<i> known issues with sockets and ssl with python 2.3.5?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Any help would be appreciated.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Hozi
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> Mod_python mailing list
</I>&gt;&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="017910.html">[mod_python] SSL Socket Problem
</A></li>
	<LI>Next message: <A HREF="017955.html">[mod_python] SSL Socket Problem
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17954">[ date ]</a>
              <a href="thread.html#17954">[ thread ]</a>
              <a href="subject.html#17954">[ subject ]</a>
              <a href="author.html#17954">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
