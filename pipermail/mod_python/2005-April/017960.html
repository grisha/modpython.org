<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] bug in apache.import_module
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20bug%20in%20apache.import_module&In-Reply-To=1114731882.7600%40dscpl.user.openhosting.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017959.html">
   <LINK REL="Next"  HREF="017961.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] bug in apache.import_module</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Nicolas Lehuen</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20bug%20in%20apache.import_module&In-Reply-To=1114731882.7600%40dscpl.user.openhosting.com"
       TITLE="[mod_python] bug in apache.import_module">nicolas.lehuen at gmail.com
       </A><BR>
    <I>Fri Apr 29 04:33:53 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="017959.html">[mod_python] bug in apache.import_module
</A></li>
        <LI>Next message: <A HREF="017961.html">[mod_python] bug in apache.import_module
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17960">[ date ]</a>
              <a href="thread.html#17960">[ thread ]</a>
              <a href="subject.html#17960">[ subject ]</a>
              <a href="author.html#17960">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Sorry, reposting to the whole list :

Hi,

The change I've made for MODPYTHON-9 affects only the publisher
module. It solves the problem encountered when you had two pages, one
at /index.py, and the other at /foobar/index.py.

Huzaifa, what I don't understand here is whether moduleA has the same
name as moduleB, and whether you are using mod_python.publisher or
not.

If you use the publisher, your problem has been solved in the latest
development version, and the fix will be in the next release.

Anyway, if we put aside the fix specific to the publisher, the problem
you describe is real, and the workaround you provide is correct.

It is so correct that the only way I see of fixing that is to
integrate the workaround in the import_module function, that is to say
to check whether each path component passed in the path list argument
ends with a '/' (or '\'), and if not, add a '/' (or '\\'). This is
done easily in the first line of the function :

if path:
   path = map(lambda entry : (entry[-1]!='/' and entry+'/') or entry,path)

However, there is no easy way of telling what directory separator
should be used ; theoretically, os.sep gives us the correct directory
separator, but even under Win32 Apache admins are advised to use &quot;/&quot;
which is compatible (at the OS level). So, we might as well always use
&quot;/&quot;.

What I fear is that adding all these checks to import_module will make
it a little bit too slow, so what about adding a line or two in the
documentation about the fact that all directories mentioned in the
path argument should end with a '/' ?

Regards,

Nicolas

On 4/29/05, Graham Dumpleton &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">grahamd at dscpl.com.au</A>&gt; wrote:
&gt;<i> Nicolas, does the change you have already made for MODPYTHON-9
</I>&gt;<i> also address this slightly different variation on the problem?
</I>&gt;<i> 
</I>&gt;<i> Original report was based on same name module in parent and child
</I>&gt;<i> subdirectories, not sibling directories which share a common prefix
</I>&gt;<i> to the subdirectory name.
</I>&gt;<i> 
</I>&gt;<i> Graham
</I>&gt;<i> 
</I>&gt;<i> Huzaifa Tapal wrote ..
</I>&gt;<i> &gt; For my fix, I patched this issue by passing the import_module function
</I>&gt;<i> &gt; the path with &quot;/&quot; in the end.  That way it distinguishes from
</I>&gt;<i> &gt; /home/user/dir1 and /home/user/dir123
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; hozi
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Graham Dumpleton wrote:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &gt; See:
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;   <A HREF="http://issues.apache.org/jira/browse/MODPYTHON-9">http://issues.apache.org/jira/browse/MODPYTHON-9</A>
</I>&gt;<i> &gt; &gt;   <A HREF="http://issues.apache.org/jira/browse/MODPYTHON-10">http://issues.apache.org/jira/browse/MODPYTHON-10</A>
</I>&gt;<i> &gt; &gt;   <A HREF="http://issues.apache.org/jira/browse/MODPYTHON-11">http://issues.apache.org/jira/browse/MODPYTHON-11</A>
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; There are various known issues with using same name module in different
</I>&gt;<i> &gt; &gt; directories.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; The first one has been addressed for next version of mod_python.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; Graham
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; On 29/04/2005, at 8:22 AM, Huzaifa Tapal wrote:
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;&gt; I think there is a bug in apache.import_module.  I am using
</I>&gt;<i> &gt; &gt;&gt; apache.import_module passing in the path where I want the module
</I>&gt;<i> &gt; &gt;&gt; imported from.  I am seeing a very odd result as to sometimes, the
</I>&gt;<i> &gt; &gt;&gt; module that is loaded is not the right one.  Instead it loads a
</I>&gt;<i> &gt; &gt;&gt; module that is of the same name but in a different directory.  Here
</I>&gt;<i> &gt; &gt;&gt; is what is happening:
</I>&gt;<i> &gt; &gt;&gt;
</I>&gt;<i> &gt; &gt;&gt; I have two modules of same name in 2 different directories as follows;
</I>&gt;<i> &gt; &gt;&gt;
</I>&gt;<i> &gt; &gt;&gt; /home/user/dir1/moduleA
</I>&gt;<i> &gt; &gt;&gt; /home/user/dir123/moduleB
</I>&gt;<i> &gt; &gt;&gt;
</I>&gt;<i> &gt; &gt;&gt; Lets say I restart apache and load up moduleA.  At that point there
</I>&gt;<i> &gt; &gt;&gt; is an entry in sys.modules for moduleA.  Lets say then, I load up
</I>&gt;<i> &gt; &gt;&gt; moduleB, now the original entry for moduleA is overwritten by this
</I>&gt;<i> &gt; &gt;&gt; new entry.  Now when I go back to load moduleA, I get back moduleB
</I>&gt;<i> &gt; &gt;&gt; results. Here is why:
</I>&gt;<i> &gt; &gt;&gt;
</I>&gt;<i> &gt; &gt;&gt; In apache.import_module if I pass in the path to load moduleA from
</I>&gt;<i> &gt; &gt;&gt; '/home/user/dir1' and the last module was in '/home/user/dir123' then
</I>&gt;<i> &gt; &gt;&gt; the check in import_module to make sure both modules aren't the same
</I>&gt;<i> &gt; &gt;&gt; fails since it does a &quot;file.startswith()&quot; check on the path.  Since
</I>&gt;<i> &gt; &gt;&gt; the path moduleA is in the path to moduleB, it loads the wrong module.
</I>&gt;<i> &gt; &gt;&gt;
</I>&gt;<i> &gt; &gt;&gt; I see that somebody else had complained about this problem in
</I>&gt;<i> &gt; &gt;&gt; mod_python 1.3.1 but it still has not been patched.
</I>&gt;<i> &gt; &gt;&gt;
</I>&gt;<i> &gt; &gt;&gt; Any ideas?
</I>&gt;<i> &gt; &gt;&gt;
</I>&gt;<i> &gt; &gt;&gt; Hozi
</I>&gt;<i> &gt; &gt;&gt;
</I>&gt;<i> &gt; &gt;&gt;
</I>&gt;<i> &gt; &gt;&gt; _______________________________________________
</I>&gt;<i> &gt; &gt;&gt; Mod_python mailing list
</I>&gt;<i> &gt; &gt;&gt; <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;<i> &gt; &gt;&gt; <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mod_python mailing list
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I>&gt;<i>
</I>
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="017959.html">[mod_python] bug in apache.import_module
</A></li>
	<LI>Next message: <A HREF="017961.html">[mod_python] bug in apache.import_module
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17960">[ date ]</a>
              <a href="thread.html#17960">[ thread ]</a>
              <a href="subject.html#17960">[ subject ]</a>
              <a href="author.html#17960">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
