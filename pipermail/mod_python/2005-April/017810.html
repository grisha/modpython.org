<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Internal redirect does not end processing and
	session is not saved on internal redirect - mpservlets
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Internal%20redirect%20does%20not%20end%20processing%20and%0A%09session%20is%20not%20saved%20on%20internal%20redirect%20-%20mpservlets&In-Reply-To=42489712.30206%40mischko.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   
   <LINK REL="Next"  HREF="017811.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Internal redirect does not end processing and
	session is not saved on internal redirect - mpservlets</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Internal%20redirect%20does%20not%20end%20processing%20and%0A%09session%20is%20not%20saved%20on%20internal%20redirect%20-%20mpservlets&In-Reply-To=42489712.30206%40mischko.com"
       TITLE="[mod_python] Internal redirect does not end processing and
	session is not saved on internal redirect - mpservlets">grahamd at dscpl.com.au
       </A><BR>
    <I>Fri Apr  1 06:18:21 EST 2005</I>
    <P><UL>
        
        <LI>Next message: <A HREF="017811.html">[mod_python] Session always timeouts using XMLHttpRequest.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17810">[ date ]</a>
              <a href="thread.html#17810">[ thread ]</a>
              <a href="subject.html#17810">[ subject ]</a>
              <a href="author.html#17810">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>A delayed response. :-)

&gt;<i> Scott Chapman wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> Here's my uberServlet which demonstrates this &quot;interesting&quot; behavior. 
</I>&gt;&gt;<i>  If I use the external redirect and comment out the internal 
</I>&gt;&gt;<i> redirect, everything works perfectly.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Note that I have changed mpservlets to call prep BEFORE auth.  This 
</I>&gt;&gt;<i> makes better sense to me.
</I>
It is never a good idea to change third party pages in a way that makes
yours different to everyone else. If you ever upgrade and forget the
change you had made you will break your own code.

Also, the &quot;auth()&quot; method provided with mpservlets is there specifically
for dealing with HTTP basic authentication and it doesn't look to me 
like
it is intended that it be overridden to substitute your own 
authentication
mechanism. That it is called before any session creation makes it hard 
to
do that anyway.

Rather than swap the order of &quot;auth()&quot; and &quot;prep()&quot; you would have been
better off simply doing your authentication and session management 
within
the scope of &quot;respond()&quot; and ignore the existing &quot;auth()&quot; method. Ie.,

   def respond(self):
     self.myauth()
     self.myrespond()

Where &quot;myauth()&quot; contains the code currently in your &quot;auth()&quot; and 
&quot;myrespond()&quot;
containing the code currently in your &quot;respond()&quot;.

Do it that way and you don't have to fiddle the mpservlets code.

On 29/03/2005, at 9:45 AM, Scott Chapman wrote:

&gt;<i> I'm not sure how to transfer the session to the internal redirect at 
</I>&gt;<i> this point.  It would be nice if that worked because I'm pretty sure 
</I>&gt;<i> I'll need it later.  This is a brand new session and no cookie has 
</I>&gt;<i> been sent to the browser at the time of the internal redirect so 
</I>&gt;<i> things don't work very well there.  How should I transfer the session 
</I>&gt;<i> to the internally redirected URI?
</I>
You can't transfer any new session through to a handler triggered as a 
result
of an internal redirection, AFAIK it must be bounced back to the 
browser in some
way.

There are other restrictions on using internal redirection as well 
which mean
it isn't the magic pill some might think it is.

First, you can't stash data in the req object and have it passed 
through the
internal redirect because only the original Apache req object core is 
passed
through.

Second, if the top level servlet handler has already processed the form
parameters, ie. with util.FieldStorage, and the form request was 
performed
as a POST, the handler triggered by the redirection will not be able to
access the form parameters. This is because util.FieldStorage has 
already
consumed all the request content, it can't be done a second time and the
first form object can't be passed through the req object. This problem
affects mod_python.publisher and mpservlets.

Third, (from memory) if the original URL mapped to a physical directory 
and
was a POST request, when an internal redirection is done it magically 
turns
into a GET request and even if the top level handler didn't process the
form data, the sub handler can't get to the form data as 
util.FieldStorage
thinks it was a GET request and not the POST request it was. This issue
came up sometime in the last month and I think that was what the outcome
was.

Anyway, hope this might make you think twice about relying too much on 
internal
redirections, at least in a system where some amount of processing is 
done
prior to the actual redirection. :-)

Graham

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	
	<LI>Next message: <A HREF="017811.html">[mod_python] Session always timeouts using XMLHttpRequest.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17810">[ date ]</a>
              <a href="thread.html#17810">[ thread ]</a>
              <a href="subject.html#17810">[ subject ]</a>
              <a href="author.html#17810">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="DISABLEhttp://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
