<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] All spawned threads in Restricted Exection Mode
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20All%20spawned%20threads%20in%20Restricted%20Exection%20Mode&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017868.html">
   <LINK REL="Next"  HREF="017877.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] All spawned threads in Restricted Exection Mode</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Mike Solomon</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20All%20spawned%20threads%20in%20Restricted%20Exection%20Mode&In-Reply-To="
       TITLE="[mod_python] All spawned threads in Restricted Exection Mode">mike at mrlventures.com
       </A><BR>
    <I>Sat Apr  9 17:06:02 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="017868.html">[mod_python] Dictionary persistance weirdness
</A></li>
        <LI>Next message: <A HREF="017877.html">[mod_python] All spawned threads in Restricted Exection Mode
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17869">[ date ]</a>
              <a href="thread.html#17869">[ thread ]</a>
              <a href="subject.html#17869">[ subject ]</a>
              <a href="author.html#17869">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I too see this problem and it's driving me bananas.

I've got Apache 2.0.53, mod_python 3.1.4, python 2.4 installed under 
SuSE 9.1. My servlet code and apache config are exactly the same as 
Alan's (to minimize potential setup variables.)

My specific problem is that pickling causes this unmarshal error:

(it doesn't seem to matter what i pickle, or if i use cPickle vs pickle)

Traceback (most recent call last):
   File &quot;/home/msolomon/test/zclient/client.py&quot;, line 10, in
   RuntimeError: cannot unmarshal code objects in restricted execution 
mode

That line looks like this:
  9:  obj = None
10:  in_a_pickle = pickle.dumps(obj, 2)


Now here is a very strange observation - this exception does not occur 
if I put the contents of client.py into threadtest.py - it only happens 
when the code is imported.

I'm not sure why threads appear to be executing in restricted mode - 
but if that is the problem, I guess I'd like to know how to turn that 
off.  Despite stumbling onto a few occurrences of this problem, I have 
yet to see a solution posted anywhere.

If either of you gentlemen have any additional insight, I would 
appreciate it.

------

My servlet looks like this (threadtest.py):

import mod_python
from zclient.client import Client

def handler(req):
   c = Client()
   req.write(str(c.perform()))
   return mod_python.apache.OK


This is zclient/client.py:

import cPickle as pickle
import threading, traceback

class Client:
   def thread_op(self, results):
     try:
       obj = None
       in_a_pickle = pickle.dumps(obj, 2)
       results.append('ok')
     except Exception, e:
       results.extend(traceback.format_exc().split('\n'))

   def perform(self):
     results = []
     t = threading.Thread(target=self.thread_op, args=(results,))
     t.start()
     t.join()
     return str(results)

</PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="017868.html">[mod_python] Dictionary persistance weirdness
</A></li>
	<LI>Next message: <A HREF="017877.html">[mod_python] All spawned threads in Restricted Exection Mode
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17869">[ date ]</a>
              <a href="thread.html#17869">[ thread ]</a>
              <a href="subject.html#17869">[ subject ]</a>
              <a href="author.html#17869">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
