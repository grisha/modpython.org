<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Sessions performance and some numbers
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Sessions%20performance%20and%20some%20numbers&In-Reply-To=c298f2d705040713593d958c27%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017844.html">
   <LINK REL="Next"  HREF="017846.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Sessions performance and some numbers</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Nicolas Lehuen</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Sessions%20performance%20and%20some%20numbers&In-Reply-To=c298f2d705040713593d958c27%40mail.gmail.com"
       TITLE="[mod_python] Sessions performance and some numbers">nicolas.lehuen at gmail.com
       </A><BR>
    <I>Thu Apr  7 17:26:01 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="017844.html">[mod_python] Sessions performance and some numbers
</A></li>
        <LI>Next message: <A HREF="017846.html">[mod_python] Sessions performance and some numbers
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17845">[ date ]</a>
              <a href="thread.html#17845">[ thread ]</a>
              <a href="subject.html#17845">[ subject ]</a>
              <a href="author.html#17845">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Apr 7, 2005 10:59 PM, Nicolas Lehuen &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">nicolas.lehuen at gmail.com</A>&gt; wrote:
&gt;<i> On Apr 7, 2005 9:39 PM, Jim Gallacher &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">jg.lists at sympatico.ca</A>&gt; wrote:
</I>&gt;<i> &gt; Nicolas Lehuen wrote:
</I>&gt;<i> &gt; &gt; Hi,
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; Your code seems perfect to me. We could indeed add an extra hash to
</I>&gt;<i> &gt; &gt; the directory name so that all sessions do not end in the same
</I>&gt;<i> &gt; &gt; directory ; but I guess this is not needed on modern FS like ReiserFS
</I>&gt;<i> &gt; &gt; or WinFS.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; Also, the unlink call in do_delete needs an &quot;os.&quot; to be correct...
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; If everybody is OK I could integrate your class into the Session.py
</I>&gt;<i> &gt; &gt; module, so that it becomes a standard session implementation in the
</I>&gt;<i> &gt; &gt; next release.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Shouldn't a lock be aquired and released before reading and writing the
</I>&gt;<i> &gt; session to a file?
</I>&gt;<i> 
</I>&gt;<i> Yeah, of course, though we could rely on the native filesystem locking
</I>&gt;<i> capabilities.
</I>&gt;<i> 
</I>&gt;<i> Regards,
</I>&gt;<i> Nicolas
</I>
[switching to python-dev]

Woops, sorry, I did not see that the locking problem is handled in
BaseSession. From what I read in the source code, the locking is
handled with the granularity of one lock per session, am I right ? So,
as we have one file per session, we can reuse the same locking
mechanisms in do_load, do_save and do_delete. Does this sound OK to
you ?

I've seen a few problems in your implementation, so I've took the
liberty of modifying it I've checked it in so that anybody with commit
rights can modify the code. Here it is :

<A HREF="http://svn.apache.org/repos/asf/httpd/mod_python/trunk/lib/python/mod_python/FileSession.py">http://svn.apache.org/repos/asf/httpd/mod_python/trunk/lib/python/mod_python/FileSession.py</A>

Basically, I've added a few try...finally to make sure that opened
files are closed, but I've not done anything yet about the tempdir
issue, the locking issue or changing the pickling protocol. It's
coming soon.

Eventually, we could bring back the FileSession class into the Session
module ; I've put it in its own file for now so that we don't bring
too much noise with this new feature. Ideally I should build a branch
for this but I'm not too self-confident about branching and merging in
subversion...

Regards,
Nicolas
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="017844.html">[mod_python] Sessions performance and some numbers
</A></li>
	<LI>Next message: <A HREF="017846.html">[mod_python] Sessions performance and some numbers
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17845">[ date ]</a>
              <a href="thread.html#17845">[ thread ]</a>
              <a href="subject.html#17845">[ subject ]</a>
              <a href="author.html#17845">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
