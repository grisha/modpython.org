<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] KeyError Exception when doing
	sys.modules[class.__module__] (vampire?)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20KeyError%20Exception%20when%20doing%0A%09sys.modules%5Bclass.__module__%5D%20%28vampire%3F%29&In-Reply-To=b16e3ab705040217102760acef%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="017812.html">
   <LINK REL="Next"  HREF="017814.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] KeyError Exception when doing
	sys.modules[class.__module__] (vampire?)</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20KeyError%20Exception%20when%20doing%0A%09sys.modules%5Bclass.__module__%5D%20%28vampire%3F%29&In-Reply-To=b16e3ab705040217102760acef%40mail.gmail.com"
       TITLE="[mod_python] KeyError Exception when doing
	sys.modules[class.__module__] (vampire?)">grahamd at dscpl.com.au
       </A><BR>
    <I>Sat Apr  2 20:25:47 EST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="017812.html">[mod_python] KeyError Exception when doing
	sys.modules[class.__module__] (vampire?)
</A></li>
        <LI>Next message: <A HREF="017814.html">[mod_python] KeyError Exception when doing
	sys.modules[class.__module__] (vampire?)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17813">[ date ]</a>
              <a href="thread.html#17813">[ thread ]</a>
              <a href="subject.html#17813">[ subject ]</a>
              <a href="author.html#17813">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Vampire doesn't use the &quot;imp&quot; module for doing imports and as such the 
imported
modules do not appear in sys.modules.

What exactly are you trying to do? Am a bit concerned about the way you 
might
be doing things as it may cause problems with automatic module 
reloading. If
you can give an english description of what you want to do, may be able 
to
suggest a more appropriate way of doing it.

That said, you can probably say:

   module = 
vampire.ModuleCache().moduleInfo(FileHandler.__module__).module

On 03/04/2005, at 11:10 AM, Keerati Inochanon wrote:

&gt;<i> Hi,
</I>&gt;<i>
</I>&gt;<i> I'm getting this exception:
</I>&gt;<i> Mod_python error: &quot;PythonHandler vampire&quot;
</I>&gt;<i>
</I>&gt;<i> Traceback (most recent call last):
</I>&gt;<i>
</I>&gt;<i>   File &quot;/usr/lib/python2.3/site-packages/mod_python/apache.py&quot;, line
</I>&gt;<i> 299, in HandlerDispatch
</I>&gt;<i>     result = object(req)
</I>&gt;<i>
</I>&gt;<i>   File &quot;/usr/lib/python2.3/site-packages/vampire/lookup.py&quot;, line 641,
</I>&gt;<i> in _handler
</I>&gt;<i>     result = _execute(req,objects[-1])
</I>&gt;<i>
</I>&gt;<i>   File &quot;/usr/lib/python2.3/site-packages/vampire/lookup.py&quot;, line 445,
</I>&gt;<i> in _execute
</I>&gt;<i>     return object(**args)
</I>&gt;<i>
</I>&gt;<i>   File &quot;/home/www/testing/upload.py&quot;, line 56, in handler
</I>&gt;<i>     FileHandler.processUpload(filename, destination)
</I>&gt;<i>
</I>&gt;<i>   File &quot;/home/www/testing/modules/FileHandler.py&quot;, line 149, in 
</I>&gt;<i> processUpload
</I>&gt;<i>     def getFileHandler(filename, 
</I>&gt;<i> module=sys.modules[FileHandler.__module__]):
</I>&gt;<i>
</I>&gt;<i> KeyError: '_vampire_c5f8def7c7c8bbf5b9d75d365a5bbe67_37'
</I>&gt;<i> --
</I>&gt;<i>
</I>&gt;<i> I'm not sure this it is related to vampire or not, but it seems to
</I>&gt;<i> happen when I do module loading through vampire. I tried to run the
</I>&gt;<i> same code with python import, and the code was running fine.
</I>&gt;<i>
</I>&gt;<i> Here is my code snippet:
</I>&gt;<i>
</I>&gt;<i> FileHandler.py:
</I>&gt;<i> ------------------------------
</I>&gt;<i> import os
</I>&gt;<i> import sys
</I>&gt;<i> import vampire
</I>&gt;<i>
</I>&gt;<i> config = vampire.loadConfig(__req__, &quot;.vampire&quot;)
</I>&gt;<i> directory = config.get(&quot;Modules&quot;, &quot;common&quot;)
</I>&gt;<i> SessionManagement = vampire.importModule(&quot;SessionManagement&quot;, 
</I>&gt;<i> directory)
</I>&gt;<i> Settings = vampire.importModule(&quot;Settings&quot;, directory, __req__)
</I>&gt;<i>
</I>&gt;<i> class FileHandler:
</I>&gt;<i> ...
</I>&gt;<i> ...
</I>&gt;<i> ...
</I>&gt;<i>
</I>&gt;<i> class XYZFileHandler:
</I>&gt;<i> ...
</I>&gt;<i> ...
</I>&gt;<i> ...
</I>&gt;<i>
</I>&gt;<i> def processUpload(filename, directory):
</I>&gt;<i>   &quot;Process the user-uploaded files&quot;
</I>&gt;<i>
</I>&gt;<i>   def getFileHandler(filename, 
</I>&gt;<i> module=sys.modules[FileHandler.__module__]):
</I>&gt;<i>     &quot;Return the file handler class according to the file extension&quot;
</I>&gt;<i>
</I>&gt;<i>     subclass = &quot;%sFileHandler&quot; % 
</I>&gt;<i> os.path.splitext(filename)[1].upper()[1:]
</I>&gt;<i>     return hasattr(module, subclass) and getattr(module, subclass) or
</I>&gt;<i> FileHandler
</I>&gt;<i>
</I>&gt;<i>   getFileHandler(filename)(filename, directory)
</I>&gt;<i> ------------------------------------------------
</I>&gt;<i> upload.py:
</I>&gt;<i> from mod_python import apache, util
</I>&gt;<i> from mod_python.Session import Session
</I>&gt;<i> import vampire
</I>&gt;<i> import os
</I>&gt;<i>
</I>&gt;<i> config = vampire.loadConfig(__req__, &quot;.vampire&quot;)
</I>&gt;<i> directory = config.get(&quot;Modules&quot;, &quot;common&quot;)
</I>&gt;<i> SessionManagement = vampire.importModule(&quot;SessionManagement&quot;, 
</I>&gt;<i> directory)
</I>&gt;<i> Settings = vampire.importModule(&quot;Settings&quot;, directory)
</I>&gt;<i> FileHandler = vampire.importModule(&quot;FileHandler&quot;, directory, __req__)
</I>&gt;<i> Utility = vampire.importModule(&quot;Utility&quot;, directory, __req__)
</I>&gt;<i>
</I>&gt;<i> def handler(req, **kwargs):
</I>&gt;<i> ...
</I>&gt;<i> ...
</I>&gt;<i>   FileHandler.processUpload(filename, destination)
</I>&gt;<i> ...
</I>&gt;<i> ...
</I>&gt;<i>
</I>&gt;<i> ---------------------------------------------------
</I>&gt;<i> What am I doing wrong? Please let me know if you need more
</I>&gt;<i> information. Thank you very much in advance.
</I>&gt;<i>
</I>&gt;<i> Best regards,
</I>&gt;<i> Keerati Inochanon
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mod_python mailing list
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I>
</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="017812.html">[mod_python] KeyError Exception when doing
	sys.modules[class.__module__] (vampire?)
</A></li>
	<LI>Next message: <A HREF="017814.html">[mod_python] KeyError Exception when doing
	sys.modules[class.__module__] (vampire?)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#17813">[ date ]</a>
              <a href="thread.html#17813">[ thread ]</a>
              <a href="subject.html#17813">[ subject ]</a>
              <a href="author.html#17813">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
