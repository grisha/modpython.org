From m_norley_newsgroups at yahoo.co.uk  Wed Nov  1 05:02:57 2006
From: m_norley_newsgroups at yahoo.co.uk (Mark Norley)
Date: Wed Nov  1 05:03:02 2006
Subject: [mod_python] sendfile problems with IE
In-Reply-To: <29a6ca010610311619j4b96bf96i336433311fb81918@mail.gmail.com>
Message-ID: <000001c6fd9c$e8e33e10$efabcd53@MARK>

Hi Colin
Thanks for all the info...you were right, the problem was due to some
temporary cache-control headers I'd set in an .htaccess file further up the
directory tree. Got rid of the headers and now it works fine in all three
browsers.
Thanks again!
Mark

-----Original Message-----
From: Colin Bean [mailto:ccbean@gmail.com] 
Sent: 01 November 2006 00:19
To: Mark Norley
Cc: mod_python@modpython.org
Subject: Re: [mod_python] sendfile problems with IE

Hi Mark,

Here's a thread that might deal with the same problems (in this case getting
IE to correctly display generated pdfs):
http://modpython.org/pipermail/mod_python/2006-October/022341.html

And I just realized that I sent a message in reply to this and didn't
re: the list (crap!).  My response is quoted in the reply here,
though:
http://modpython.org/pipermail/mod_python/2006-October/022348.html

I don't know if any of this will actually apply to what you're doing, but in
the PDF example IE was behaving strangely if the cache-control
header was set at all.   Doesn't look like you're setting it in the
code you provided, but there are some cases where mod_python will set it on
its own (for instance, when you're using sessions or cookies).
Is your code a complete handler, or does it get called in the context of a
larger site?

If it is something with the headers, a lightweight http proxy (I like
webscarab) is a nice way be able to look at the headers exactly as they are
being sent to the client.  You can also use it to verify that the content is
being sent completely.  However you want to do it, it might be helpful to
determine exactly what headers are being set.

The only other thing I can think of is that I usually put quotes around the
filename part of the content-disposition header
('attachment;filename="taggedhits.xls"').  I don't know if this causes IE to
break or not, but it might be worth trying.

Hopefully some of this helps...

-Colin

On 10/31/06, Mark Norley <m_norley_newsgroups@yahoo.co.uk> wrote:
> Hello
>
> Hope this list can save me again ;-)
> This bit of code works fine in Firefox and Netscape but IE doesn't like
it:
>
> def handler(req):
>     req.content_type = "application/vnd.ms-excel"
>     req.set_content_length(os.path.getsize(ROOT+'\\taggedhits.xls'))
>     req.headers_out["Content-Disposition"] = "attachment; 
> filename=taggedhits.xls"
>     req.sendfile(ROOT+"\\taggedhits.xls")
>     return apache.OK
>
> With IE the File Download dialogue looks strange. IE thinks the 
> filename is filehandler_py rather than taggedhits.xls:
>
> Name: filehandler_py
> Type: Microsoft Excel Worksheet, 13.5 KB
> From: 'mysite'
>
> filehandler.py is the name of the script for starters, not the file I 
> want to download, and why has IE swapped the dot for an underscore?
>
> On pressing Save I get:
> Internet Explorer cannot download filehandler.py from 'mysite'.
> Internet Explorer was not able to open this internet site. The 
> requested site is either unavailable or cannot be found. Please try again
later.
>
> Does anyone know what I need to do for IE to recognise the file? I'm 
> thinking I'm missing a header field or something.
>
> Cheers
> Mark
>
> Win XP SP2
> Python 2.4.2
> Apache 2.2.2
> Mod_python 3.2.10
> Firefox 1.5.0.7
> Netscape 7.2
> IE 6
>
> --
> No virus found in this outgoing message.
> Checked by AVG Free Edition.
> Version: 7.1.409 / Virus Database: 268.13.20/508 - Release Date: 
> 31/10/06
>
>
> Send instant messages to your online friends 
> http://uk.messenger.yahoo.com 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>

--
No virus found in this incoming message.
Checked by AVG Free Edition.
Version: 7.1.409 / Virus Database: 268.13.20/508 - Release Date: 31/10/06
 

-- 
No virus found in this outgoing message.
Checked by AVG Free Edition.
Version: 7.1.409 / Virus Database: 268.13.20/508 - Release Date: 31/10/06
 

Send instant messages to your online friends http://uk.messenger.yahoo.com 
From grahamd at dscpl.com.au  Thu Nov  2 04:23:56 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Thu Nov  2 04:24:04 2006
Subject: [mod_python] Can i have both Marshal and Signed
	CookieswithPublisher?
In-Reply-To: <a595de7a0610310549j4b887b33t60a597e8f27f4050@mail.gmail.com>
References: <1162244414.20129@dscpl.user.openhosting.com>
	<a595de7a0610310543p428e291ay5a1d59857e63abd0@mail.gmail.com>
	<a595de7a0610310547ue966201l47e6c38e25aa40e3@mail.gmail.com>
	<a595de7a0610310549j4b887b33t60a597e8f27f4050@mail.gmail.com>
Message-ID: <B626B75F-C9F2-46B9-A6C6-967C54A137F1@dscpl.com.au>


On 01/11/2006, at 12:49 AM, Clodoaldo Pinto Neto wrote:

> 2006/10/31, Clodoaldo Pinto Neto <clodoaldo.pinto@gmail.com>:
>> >     def parse(Class, s, secret, downgrade=False, strict=False):
>>
>> Sorry, should be downgrade=True to not break existing applications.
>>
>> Regards, Clodoaldo Pinto Neto
>>
>
> And test not downgrade:
>
>    def parse(Class, s, secret, downgrade=False, strict=False):
>
>       dict = _parse_cookie(s, Class)
>
>       del_list = list()
>       for k in dict:
>           c = dict[k]
>           try:
>               c.unmarshal(secret)
>           except (CookieError, ValueError):
>              if not downgrade:
>                  del_list.append(k)
>              else:
>                  if strict:
>                      raise
>                  else:
>                      # downgrade to Cookie
>                      dict[k] = Cookie.parse(Cookie.__str__(c))[k]
>
>       for k in del_list:
>           del dict(k)
>       return dict

Except that we are now using two options to represent what should be
three exclusive possibilities. Possibly better off using a single  
argument
which can be assigned three values representing the possibilities of
what to do when a mismatch occurs.

1. Downgrade cookie if mismatch.
2. Ignore cookie if mismatch.
3. Raise exception if mismatch.

In some respects, it is actually wrong that the downgrading is being  
done
within the parse() method of the derived classes. The derived class  
should
really have let the exception be passed back. Instead I would have  
had the
get_cookies() method catch the exception and downgrade the cookie at
that point. Anyway, that is the way I would have designed it if  
starting from
scratch, but how it works is how it is documented and can't going  
changing
that now.

Back to the options, I'll have to think about what names make sense, but
the intent is something like:

   MISMATCH_DOWNGRADE = 0
   MISMATCH_IGNORE = 1
   MISMATCH_EXCEPTION = 2

   class MarshalCookie(Cookie):

      def parse(Class, s, secret, mismatch=MISMATCH_DOWNGRADE):

       dict = _parse_cookie(s, Class)

       del_list = list()
       for k in dict:
           c = dict[k]
           try:
               c.unmarshal(secret)
           except (CookieError, ValueError):
               if mismatch == MISMATCH_EXCEPTION:
                      raise
               elif mismatch == MISMATCH_IGNORE:
                      del_list.append(k)
               else:
                      # downgrade to Cookie
                      dict[k] = Cookie.parse(Cookie.__str__(c))[k]

       for k in del_list:
           del dict(k)
       return dict

I don't like the name 'mismatch' though. Maybe make them non namespaced
class attributes of Cookie instead. Thus you would ultimately write:

   cookies = Cookies.get_cookies(req, mismatch=Cookies.Cookie.IGNORE)

Any other suggestions?

Graham
From richardlewis at fastmail.co.uk  Thu Nov  2 05:06:15 2006
From: richardlewis at fastmail.co.uk (Richard Lewis)
Date: Thu Nov  2 05:06:33 2006
Subject: [mod_python] MySQL invalid pointer error
Message-ID: <200611021006.15472.richardlewis@fastmail.co.uk>

Hi there,

Apache: 2.2.3
mod_python: 3.2.10
MySQL: 5.0.26
MySQLdb: 1.2.1

I'm doing some stuff with MySQL and mod_python and have been noticing some 
concerning entries in my Apache error log:

*** glibc detected *** free(): invalid pointer: 0x0834241d ***
[Wed Nov 01 18:43:20 2006] [notice] child pid 7637 exit signal Aborted (6)

I /think/ they are coming from MySQL. Can anyone confirm this?

I've tried a couple of different strategies for connecting to the database. 
First I tried using a global connection object in the handler module. This 
seemed to work OK except for the error messages shown above. Next I tried 
making every function that needed the database create and close its own 
connection. This didn't give any errors but was /really/ slow. Now I have a 
connection object created at the start of the handler function (effectively), 
passed around between all the functions and objects of my application and 
then closed when the handler finishes. This seems to work at a good speed but 
still gives me these error messages.

One thing I often find is that the connection cannot be closed properly at the 
end of the handler function; it seems as though its already been closed by 
the time execution gets there.

Would using a database connection pooling tool like sqlrelay be of any help?

Cheers,
Richard 
-- 
-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
Richard Lewis
Sonic Arts Research Archive
http://www.sara.uea.ac.uk/
JID: ironchicken@jabber.earth.li
-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
From richardlewis at fastmail.co.uk  Thu Nov  2 06:10:38 2006
From: richardlewis at fastmail.co.uk (Richard Lewis)
Date: Thu Nov  2 06:10:45 2006
Subject: [mod_python] MySQL invalid pointer error
In-Reply-To: <200611021006.15472.richardlewis@fastmail.co.uk>
References: <200611021006.15472.richardlewis@fastmail.co.uk>
Message-ID: <200611021110.38871.richardlewis@fastmail.co.uk>

On Thursday 02 November 2006 10:06, Richard Lewis wrote:
>
> I'm doing some stuff with MySQL and mod_python and have been noticing some
> concerning entries in my Apache error log:
>
> *** glibc detected *** free(): invalid pointer: 0x0834241d ***
> [Wed Nov 01 18:43:20 2006] [notice] child pid 7637 exit signal Aborted (6)
>
> I /think/ they are coming from MySQL. Can anyone confirm this?
>
OK, I think this is actually a problem. I seem to get around 5 or 6 successful 
requests from my mod_python app without these error messages. After that, my 
browser says that the connection to localhost.localdomain is broken and the 
server doesn't process any more of these requests (though it does seem to 
continue serving non-database requests). Restarting Apache (not MySQL) solves 
the problem.

Any ideas? Should I try sqlrelay?

Cheers,
Richard
-- 
-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
Richard Lewis
Sonic Arts Research Archive
http://www.sara.uea.ac.uk/
JID: ironchicken@jabber.earth.li
-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
From jpg at jgassociates.ca  Thu Nov  2 08:16:13 2006
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Thu Nov  2 08:16:14 2006
Subject: [mod_python] MySQL invalid pointer error
In-Reply-To: <200611021110.38871.richardlewis@fastmail.co.uk>
References: <200611021006.15472.richardlewis@fastmail.co.uk>
	<200611021110.38871.richardlewis@fastmail.co.uk>
Message-ID: <4549EF9D.8000509@jgassociates.ca>

Richard Lewis wrote:
> On Thursday 02 November 2006 10:06, Richard Lewis wrote:
>> I'm doing some stuff with MySQL and mod_python and have been noticing some
>> concerning entries in my Apache error log:
>>
>> *** glibc detected *** free(): invalid pointer: 0x0834241d ***
>> [Wed Nov 01 18:43:20 2006] [notice] child pid 7637 exit signal Aborted (6)
>>
>> I /think/ they are coming from MySQL. Can anyone confirm this?
>>
> OK, I think this is actually a problem. I seem to get around 5 or 6 successful 
> requests from my mod_python app without these error messages. After that, my 
> browser says that the connection to localhost.localdomain is broken and the 
> server doesn't process any more of these requests (though it does seem to 
> continue serving non-database requests). Restarting Apache (not MySQL) solves 
> the problem.
> 
> Any ideas? Should I try sqlrelay?

I don't think we've seen this error messages exactly, but have seen 
segmentation faults related to mysql. The cause is generally a mismatch 
between the myclientlib used by python MySQLdb and some other apache 
module such as php.

This FAQ may help you track down the problem:
http://www.modpython.org/FAQ/faqw.py?req=show&file=faq02.013.htp

Jim

From fred at adventistcare.org  Thu Nov  2 10:50:30 2006
From: fred at adventistcare.org (Sells, Fred)
Date: Thu Nov  2 10:41:56 2006
Subject: [mod_python] RE: is mod_python borked?
Message-ID: <1A4BF05172023E468CB6E867923BC90402B6E33D@accmail2.sunbelt.org>

I've just gotten started with mod_python, using it for about 2 weeks, and
can offer these insights(?)
1. easy install and getting started
2. simple mods to apahce conf to "invoke" it
3. really cool code if using the publisher
4. only limitation I've found is that you need to restart apache when you
deploy .py changes.  There may be a way around this, but it wasn't worth the
effort to me to explore.
5. if you're using Session objects, take special note of the "lock" option.
If you try to get the same session object twice during the same execution
cycle (i.e. POST) it hangs with the default setting.  Some may argue that
getting the same thing twice is just sloppy code, and they may be right, but
when the wolf's at the door you gotta...

I was able to write a security handler that intercepts all .py and .html
references and assures login before access is granted.  web site developers
are unaware of my "intercept" so they cannot bypass it.

a simple controller, that is the only file that is web specific, calling my
backend logic that also runs from command line for debugging.

none of the above was more than 1/4 page of code.

There are (too?) many python web frameworks.  Others seem like they may be
better for my needs, but this works easily.  Will explore others when wolf's
on vacation.

-----Original Message-----
From: python-list-bounces+frsells=adventistcare.org@python.org
[mailto:python-list-bounces+frsells=adventistcare.org@python.org]On
Behalf Of Steve Holden
Sent: Thursday, November 02, 2006 10:23 AM
To: python-list@python.org
Cc: mod_python@modpython.org
Subject: Re: is mod_python borked?


walterbyrd wrote:
> I am considering python, instead of php, for web-application
> development. I often see mod_python.criticisized as being borked,
> broken, or just plain sucking.
> 
> Any truth to any of that?
> 
Why don't you ask the very active mod_python mailing list that?

Like all systems mod_python has its limitations, but it has an active 
development community who are extremely responsive to user and developer 
input.

Follow-ups set to gmane.comp.python.mod_python.

regards
  Steve
-- 
Steve Holden       +44 150 684 7255  +1 800 494 3119
Holden Web LLC/Ltd          http://www.holdenweb.com
Skype: holdenweb       http://holdenweb.blogspot.com
Recent Ramblings     http://del.icio.us/steve.holden

-- 
http://mail.python.org/mailman/listinfo/python-list
From joseph.r.buehre at boeing.com  Thu Nov  2 16:23:19 2006
From: joseph.r.buehre at boeing.com (Buehre, Joseph R)
Date: Thu Nov  2 16:23:31 2006
Subject: [mod_python] Mod_python on HP-UX 11.11
In-Reply-To: <1A4BF05172023E468CB6E867923BC90402B6E33D@accmail2.sunbelt.org>
Message-ID: <C12C17049E23854783042B3D0F25BB67029B7CBC@XCH-MW-2V2.mw.nos.boeing.com>

To All-

I have tried consently to get mod_python to compile and create the .so
file for Apache.  To date this has been an unsucessful adventure.  Has
anyone done this type of install with HP-UX 11.11, Apache 2.0 and the
latest version of mod_python.  Desperately seeking insight. 


Thanks, 
Joe Buehre 
Mission Critical Systems Support 
314-791-9725

 mailto:joseph.r.buehre@boeing.com


-----Original Message-----
From: Sells, Fred [mailto:fred@adventistcare.org] 
Sent: Thursday, November 02, 2006 9:51 AM
To: mod_python@modpython.org
Subject: [mod_python] RE: is mod_python borked?

I've just gotten started with mod_python, using it for about 2 weeks,
and can offer these insights(?) 1. easy install and getting started 2.
simple mods to apahce conf to "invoke" it 3. really cool code if using
the publisher 4. only limitation I've found is that you need to restart
apache when you deploy .py changes.  There may be a way around this, but
it wasn't worth the effort to me to explore.
5. if you're using Session objects, take special note of the "lock"
option.
If you try to get the same session object twice during the same
execution cycle (i.e. POST) it hangs with the default setting.  Some may
argue that getting the same thing twice is just sloppy code, and they
may be right, but when the wolf's at the door you gotta...

I was able to write a security handler that intercepts all .py and .html
references and assures login before access is granted.  web site
developers are unaware of my "intercept" so they cannot bypass it.

a simple controller, that is the only file that is web specific, calling
my backend logic that also runs from command line for debugging.

none of the above was more than 1/4 page of code.

There are (too?) many python web frameworks.  Others seem like they may
be better for my needs, but this works easily.  Will explore others when
wolf's on vacation.

-----Original Message-----
From: python-list-bounces+frsells=adventistcare.org@python.org
[mailto:python-list-bounces+frsells=adventistcare.org@python.org]On
Behalf Of Steve Holden
Sent: Thursday, November 02, 2006 10:23 AM
To: python-list@python.org
Cc: mod_python@modpython.org
Subject: Re: is mod_python borked?


walterbyrd wrote:
> I am considering python, instead of php, for web-application 
> development. I often see mod_python.criticisized as being borked, 
> broken, or just plain sucking.
> 
> Any truth to any of that?
> 
Why don't you ask the very active mod_python mailing list that?

Like all systems mod_python has its limitations, but it has an active
development community who are extremely responsive to user and developer
input.

Follow-ups set to gmane.comp.python.mod_python.

regards
  Steve
-- 
Steve Holden       +44 150 684 7255  +1 800 494 3119
Holden Web LLC/Ltd          http://www.holdenweb.com
Skype: holdenweb       http://holdenweb.blogspot.com
Recent Ramblings     http://del.icio.us/steve.holden

--
http://mail.python.org/mailman/listinfo/python-list
_______________________________________________
Mod_python mailing list
Mod_python@modpython.org
http://mailman.modpython.org/mailman/listinfo/mod_python

From grahamd at dscpl.com.au  Thu Nov  2 16:44:51 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Thu Nov  2 16:45:02 2006
Subject: [mod_python] RE: is mod_python borked?
Message-ID: <1162503891.21856@dscpl.user.openhosting.com>

Sells, Fred wrote ..
> I've just gotten started with mod_python, using it for about 2 weeks, and
> can offer these insights(?)
> 1. easy install and getting started
> 2. simple mods to apahce conf to "invoke" it
> 3. really cool code if using the publisher

As long as you don't run up against the trailing slash and base url issues. ;-)

Personally I don't like publisher as it is, but to fix it properly would most
likely break a lot of existing user code.

> 4. only limitation I've found is that you need to restart apache when you
> deploy .py changes.  There may be a way around this, but it wasn't worth
> the effort to me to explore.

In current versions of mod_python, although there are some fiddles you can do
to limit your need to do restarts, unless you use a particular third party
implementation of the publisher extension which embeds its own improved module
importer, often you still can't avoid the restarts.

The good news is that this improved module importer has been incorporated into
mod_python for 3.3, so practically all the problems most people encounter will
go away.

For more details see:

  http://www.dscpl.com.au/wiki/ModPython/Articles/ModuleImportingIsBroken

> 5. if you're using Session objects, take special note of the "lock" option.
> If you try to get the same session object twice during the same execution
> cycle (i.e. POST) it hangs with the default setting.  Some may argue that
> getting the same thing twice is just sloppy code, and they may be right,
> but when the wolf's at the door you gotta...

Best practice is to use code like:

  if not hasattr(req, 'session'):
    req.session = Session.Session(req)

  # then use req.session

This way if the session has already been created by an earlier handler, then
you will pick it up from req.session avoiding the creation of the session again
and a deadlock. PSP uses this convention, so if using PSP from inside of
publisher you will not have problems if the PSP pages use sessions.

Things can still get a bit tricky if you are using req.internal_redirect()
though. What you can do there depends on which version of mod_python you are
using.

> I was able to write a security handler that intercepts all .py and .html
> references and assures login before access is granted.  web site developers
> are unaware of my "intercept" so they cannot bypass it.
> a simple controller, that is the only file that is web specific, calling
> my backend logic that also runs from command line for debugging.
> none of the above was more than 1/4 page of code.

Hmmm, only a quarter of a page. Don't know how long your page is, but even if I
remove all the comments and blank lines from my forms based login/session
manager it is getting up around 100 lines. This doesn't even include the login
page itself which is outside of the handler. I also haven't updated it yet in
line with some recent changes in mod_python 3.3. I have though tried to make my
handler quite bullet proof, be generic and work in with Apache's auth
mechanisms properly so it is probably longer than what others may come up with.
The thing is that it is quite tricky to get correct and have it work in all
situations. Most implementations I have seen have some problem or limitation.

Anyway, important thing is that it sounds like you have at least not tried to
do it in the PythonHandler phase like most do, which to my mind is the wrong
way of going about it. It should be done in an earlier phase so that it can
cover non mod_python stuff as well, like you indicate your version does.

> There are (too?) many python web frameworks.

Agreed. What is also annoying is that none are really truly integrated with
mod_python and the Apache way of doing things. Instead they use the response
handler phase of mod_python as merely a jumping off point. A framework that
properly integrates with mod_python and Apache and harnesses the fact that
there are other modules for Apache which aren't written in Python and which can
be used would be quite powerful. Unfortunately, mod_python to date has had
various shortcomings which have made this hard to do. Changes in 3.3 improve
this situation immensely and some really good stuff should be able to be done
with it. Only thing which will be missing is the ability to use auth providers
in Apache 2.2 which is one thing we haven't got around to yet.

> > I am considering python, instead of php, for web-application
> > development. I often see mod_python.criticisized as being borked,
> > broken, or just plain sucking.
> > 
> > Any truth to any of that?

In answer to your question of whether mod_python is borked, the answer is yes
and no.

One sees various people complain about mod_python. In some cases their claims
are valid, but in other cases they are wrong and haven't bothered to work out
how it works. Even when their claims are valid, they often don't understand the
problem properly. To use mod_python properly also means in a lot of cases
understanding how Apache works, which many are too lazy to do. For example, the
difference between SetHandler and AddHandler and what happens when MultiViews
is enabled. 

One of the biggest problems is that a lot of ISPs still use Apache 1.3 and so
only mod_python 2.7.X is available on those platforms. This version is quite
old now and doesn't behave exactly the same as more recent versions, yet people
read the most recent documentation and complain it doesn't work as they expect.

Even where people are using Apache 2.0 and thus can use newer versions of
mod_python, they sometimes use RedHat enterprise versions of Linux which are
stuck in a time warp with only 3.1.X versions of mod_python available. Some of
the other Linux distributions haven't been much better until recently and with
people refusing to compile from source code and demanding RPMs, DEBs or other
prepackaged releases are only bringing it on themselves.

Version 3.2.X has been an improvement over older versions. Significantly it
fixed multithreading issues on Windows and with worker MPM on UNIX. For
publisher at least, it addressed some of the module importer issues, but not
all. It has also addressed some major memory leaks.

So in summary, if you use the most recent version you are obviously going to
have the least problems. Many still use older versions though and can't or
will not upgrade. Even the current version has known issues and you can get
a feel for what is known by going through issues at:

  http://issues.apache.org/jira/browse/MODPYTHON

In particular the number of separate issues which will be addressed in 3.3 is
getting up towards 100. These aren't all bug fixes, with many being new
features and improvements. The most important change will be the replacement of
the module importer, with the issues fixed by that being listed in the article
I referenced before.

So, use an older version of mod_python and the answer to the question of
whether it is borked is mostly yes. Use the current version and except for
module importer issues, the answer is mostly no. With version 3.3, the answer
should hopefully be a string no.

Anyway, that has satisfied by need for a Friday rant. :-)

Graham



From grahamd at dscpl.com.au  Thu Nov  2 16:49:39 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Thu Nov  2 16:49:42 2006
Subject: [mod_python] Mod_python on HP-UX 11.11
Message-ID: <1162504179.24329@dscpl.user.openhosting.com>

Buehre, Joseph R wrote ..
> To All-
> 
> I have tried consently to get mod_python to compile and create the .so
> file for Apache.  To date this has been an unsucessful adventure.  Has
> anyone done this type of install with HP-UX 11.11, Apache 2.0 and the
> latest version of mod_python.  Desperately seeking insight. 

Presuming you are the same version who was asking about this in the past couple
of weeks, what was the outcome from when I suggested you change the makefile to
use -L/-l to link your shared Python library rather than the .a? Without you
giving feedback on what the outcome was of our suggestions, including any error
messages the compiler, or Apache may have spat out, it is really hard to help
and we just end up guessing.

Graham
From deron.meranda at gmail.com  Thu Nov  2 17:11:30 2006
From: deron.meranda at gmail.com (Deron Meranda)
Date: Thu Nov  2 17:11:40 2006
Subject: [mod_python] Mod_python on HP-UX 11.11
In-Reply-To: <C12C17049E23854783042B3D0F25BB67029B7CBC@XCH-MW-2V2.mw.nos.boeing.com>
References: <1A4BF05172023E468CB6E867923BC90402B6E33D@accmail2.sunbelt.org>
	<C12C17049E23854783042B3D0F25BB67029B7CBC@XCH-MW-2V2.mw.nos.boeing.com>
Message-ID: <5c06fa770611021411v5f542d21r8544aa7849f0bcde@mail.gmail.com>

I think you replied to the wrong thread...

On 11/2/06, Buehre, Joseph R <joseph.r.buehre@boeing.com> wrote:
> I have tried consently to get mod_python to compile and create the .so
> file for Apache.  To date this has been an unsucessful adventure.  Has
> anyone done this type of install with HP-UX 11.11, Apache 2.0 and the
> latest version of mod_python.  Desperately seeking insight.

I did get it working (but not heavily tested) with these parts...

  HP-UX 11.0
  Apache 2.2 (mpm_worker, dso)
  OpenSSL 0.9.8d
  Python 2.4.3
  GNU readline 5.1
  mod_python 3.2.10

Everything (except the OS of course) was compiled from sources with
HP's ANSI-C cc compiler in 32-bit mode.

I've since got python 2.5 working now, but I haven't tried recompiling the
mod_python against it.

Did you also compile httpd?  If so did you make sure you used the
--enable-so option to configure?  Are you by chance trying to compile
64-bit applications?  Can you provide more information, such as what
kind of errors you might be seeing.  What configure options you've given,
etc.

I know getting stuff to compile under HP-UX can in general be
a real pain.  I may have done some sort of magic, but I honestly
can't remember what I did exactly.  At least it's not AIX; that
one always gives me terrible fits.
-- 
Deron Meranda
From deron.meranda at gmail.com  Thu Nov  2 17:54:35 2006
From: deron.meranda at gmail.com (Deron Meranda)
Date: Thu Nov  2 17:54:46 2006
Subject: [mod_python] RE: is mod_python borked?
In-Reply-To: <1162503891.21856@dscpl.user.openhosting.com>
References: <1162503891.21856@dscpl.user.openhosting.com>
Message-ID: <5c06fa770611021454r2f6b2869w7337e10a6ee9d38c@mail.gmail.com>

On 11/2/06, Graham Dumpleton <grahamd@dscpl.com.au> wrote:
> > There are (too?) many python web frameworks.
>
> Agreed. What is also annoying is that none are really truly integrated with
> mod_python and the Apache way of doing things. Instead they use the response
> handler phase of mod_python as merely a jumping off point. A framework that
> properly integrates with mod_python and Apache and harnesses the fact that
> there are other modules for Apache which aren't written in Python and which can
> be used would be quite powerful.

Although not fully integrated, at least I know about the Myghty
framework which is "decently" integrated.  It exposes the underlying
mod_python request object and makes it available in it's templating
system.

So I write a lot of mod_python handlers for different phases, etc.
in plain old mod_python; then I create Python objects of things,
stuff them into the req object, and then in Myghty I access those
values just like any other variable; and can even push values back
into the req object too.  Note that I'm not talking about serializing
objects or pushing them into cookies.  The actual python object
I create in a mod_python handler in an early phase is directly
accessible in Myghty.  And it's even pretty easy to link together
the mod_python session object and the Myghty session objects.

But other than that single data point, in general I agree that
mod_python integration is rather poor with other frameworks.
But I'd like to think that it is mainly because mod_python is
just being improved too quickly by Graham for the framework
developers to keep up the same pace.


> One sees various people complain about mod_python. In some cases their claims
> are valid, but in other cases they are wrong and haven't bothered to work out
> how it works. Even when their claims are valid, they often don't understand the
> problem properly. To use mod_python properly also means in a lot of cases
> understanding how Apache works, which many are too lazy to do. For example, the
> difference between SetHandler and AddHandler and what happens when MultiViews
> is enabled.

I really blame the Apache httpd group here.  They do a great job of
documenting all the directives, but a really poor job of documenting
the central "how it works" concepts.  Just trying to find ANY useful
information about the various request processing phases is quite
hard; and even then you'll find a really old out of date unfinished
beta-document on the subject.   I know for me, a lot of mod_python
didn't really click until I did some code diving sessions into the
httpd source code to see what Apache was doing.

I've been thinking about writing up some of this basic how-it-works
stuff for the mod_python wiki.


> Anyway, that has satisfied by need for a Friday rant. :-)

Wow, and those of us on the other side of the globe get
to enjoy it on Thursday.
-- 
Deron Meranda
From clodoaldo.pinto at gmail.com  Thu Nov  2 19:30:42 2006
From: clodoaldo.pinto at gmail.com (Clodoaldo Pinto Neto)
Date: Thu Nov  2 19:30:54 2006
Subject: [mod_python] RE: is mod_python borked?
In-Reply-To: <5c06fa770611021454r2f6b2869w7337e10a6ee9d38c@mail.gmail.com>
References: <1162503891.21856@dscpl.user.openhosting.com>
	<5c06fa770611021454r2f6b2869w7337e10a6ee9d38c@mail.gmail.com>
Message-ID: <a595de7a0611021630n1766b28cjcad23d445a6eb197@mail.gmail.com>

On 11/2/06, Graham Dumpleton <grahamd@dscpl.com.au> wrote:
>Personally I don't like publisher as it is, but to fix it properly would most
likely break a lot of existing user code.

What about publisher2? psycopg was rewritten as psycopg2 to not break
existing code.

Regards, Clodoaldo Pinto Neto
From enriquejr at gmail.com  Fri Nov  3 03:41:12 2006
From: enriquejr at gmail.com (Enrique Samson Jr.)
Date: Fri Nov  3 03:41:28 2006
Subject: [mod_python] FC6 and psp example
Message-ID: <1162543272.2702.22.camel@zeratul.aiur.org>

Hi!

I installed the psp example tarball at
http://www.modpython.org/examples/. It worked fine just for two errors.
When I clicked "Source code for this page", it resulted to error 404.
The other one is I had to add req.content_type = 'text/html' to view.py
before showme returns html, otherwise it returns 'plain/text', html tags
visible.

I also have this example on another distro, perhaps with different set
of versions for python, mod_python and apache, everything's fine. On
this box, python is 2.4.3. mod_python is 3.2.8-3.1 and apache is 2.2.3-5
(packaged as httpd). I hope this is worth mentioning.

Any insights will be appreciated. Tnx!



Enrique Samson Jr.

From clodoaldo.pinto at gmail.com  Fri Nov  3 07:38:48 2006
From: clodoaldo.pinto at gmail.com (Clodoaldo Pinto Neto)
Date: Fri Nov  3 07:38:56 2006
Subject: [mod_python] Can i have both Marshal and Signed
	CookieswithPublisher?
In-Reply-To: <B626B75F-C9F2-46B9-A6C6-967C54A137F1@dscpl.com.au>
References: <1162244414.20129@dscpl.user.openhosting.com>
	<a595de7a0610310543p428e291ay5a1d59857e63abd0@mail.gmail.com>
	<a595de7a0610310547ue966201l47e6c38e25aa40e3@mail.gmail.com>
	<a595de7a0610310549j4b887b33t60a597e8f27f4050@mail.gmail.com>
	<B626B75F-C9F2-46B9-A6C6-967C54A137F1@dscpl.com.au>
Message-ID: <a595de7a0611030438h4d9f734co365ae60b2955a17e@mail.gmail.com>

2006/11/2, Graham Dumpleton <grahamd@dscpl.com.au>:
>
> On 01/11/2006, at 12:49 AM, Clodoaldo Pinto Neto wrote:
>
> > 2006/10/31, Clodoaldo Pinto Neto <clodoaldo.pinto@gmail.com>:
> >> >     def parse(Class, s, secret, downgrade=False, strict=False):
> >>
> >> Sorry, should be downgrade=True to not break existing applications.
> >>
> >> Regards, Clodoaldo Pinto Neto
> >>
> >
> > And test not downgrade:
> >
> >    def parse(Class, s, secret, downgrade=False, strict=False):
> >
> >       dict = _parse_cookie(s, Class)
> >
> >       del_list = list()
> >       for k in dict:
> >           c = dict[k]
> >           try:
> >               c.unmarshal(secret)
> >           except (CookieError, ValueError):
> >              if not downgrade:
> >                  del_list.append(k)
> >              else:
> >                  if strict:
> >                      raise
> >                  else:
> >                      # downgrade to Cookie
> >                      dict[k] = Cookie.parse(Cookie.__str__(c))[k]
> >
> >       for k in del_list:
> >           del dict(k)
> >       return dict
>
> Except that we are now using two options to represent what should be
> three exclusive possibilities. Possibly better off using a single
> argument
> which can be assigned three values representing the possibilities of
> what to do when a mismatch occurs.
>
> 1. Downgrade cookie if mismatch.
> 2. Ignore cookie if mismatch.
> 3. Raise exception if mismatch.
>
> In some respects, it is actually wrong that the downgrading is being
> done
> within the parse() method of the derived classes. The derived class
> should
> really have let the exception be passed back. Instead I would have
> had the
> get_cookies() method catch the exception and downgrade the cookie at
> that point. Anyway, that is the way I would have designed it if
> starting from
> scratch, but how it works is how it is documented and can't going
> changing
> that now.
>
> Back to the options, I'll have to think about what names make sense, but
> the intent is something like:
>
>    MISMATCH_DOWNGRADE = 0
>    MISMATCH_IGNORE = 1
>    MISMATCH_EXCEPTION = 2
>
>    class MarshalCookie(Cookie):
>
>       def parse(Class, s, secret, mismatch=MISMATCH_DOWNGRADE):
>
>        dict = _parse_cookie(s, Class)
>
>        del_list = list()
>        for k in dict:
>            c = dict[k]
>            try:
>                c.unmarshal(secret)
>            except (CookieError, ValueError):
>                if mismatch == MISMATCH_EXCEPTION:
>                       raise
>                elif mismatch == MISMATCH_IGNORE:
>                       del_list.append(k)
>                else:
>                       # downgrade to Cookie
>                       dict[k] = Cookie.parse(Cookie.__str__(c))[k]
>
>        for k in del_list:
>            del dict(k)
>        return dict
>
> I don't like the name 'mismatch' though. Maybe make them non namespaced
> class attributes of Cookie instead. Thus you would ultimately write:
>
>    cookies = Cookies.get_cookies(req, mismatch=Cookies.Cookie.IGNORE)
>
> Any other suggestions?

As of me it is Ok.

Regards, Clodoaldo Pinto Neto
From joseph.r.buehre at boeing.com  Fri Nov  3 08:02:00 2006
From: joseph.r.buehre at boeing.com (Buehre, Joseph R)
Date: Fri Nov  3 08:02:38 2006
Subject: [mod_python] Mod_python on HP-UX 11.11
In-Reply-To: <1162504179.24329@dscpl.user.openhosting.com>
Message-ID: <C12C17049E23854783042B3D0F25BB67029B7CC4@XCH-MW-2V2.mw.nos.boeing.com>

 I tried linking as suggested to the .sl instead but to no avail.  I
will clean-up and start from scratch posting my results as I go through
the process....

FYI

This is a 32 bit compile and Apache was compiled with --enabled-so

Here is the compiler option in my script.

CC=cc CXX=aCC CFLAGS=+DD32 CXXFLAGS=+DD32
LDFLAGS=-L/opt/Boeing/python2.4.3/lib ./configure
--with-apxs=/wwimacs6/apache2/bin/apxs --with-python=/opt/Boeing/
python2.4.3/bin/python2.4


Thanks, 
Joe Buehre 
Mission Critical Systems Support 
314-791-9725

 mailto:joseph.r.buehre@boeing.com


-----Original Message-----
From: Graham Dumpleton [mailto:grahamd@dscpl.com.au] 
Sent: Thursday, November 02, 2006 3:50 PM
To: Buehre, Joseph R
Cc: mod_python@modpython.org
Subject: Re: [mod_python] Mod_python on HP-UX 11.11

Buehre, Joseph R wrote ..
> To All-
> 
> I have tried consently to get mod_python to compile and create the .so

> file for Apache.  To date this has been an unsucessful adventure.  Has

> anyone done this type of install with HP-UX 11.11, Apache 2.0 and the 
> latest version of mod_python.  Desperately seeking insight.

Presuming you are the same version who was asking about this in the past
couple of weeks, what was the outcome from when I suggested you change
the makefile to use -L/-l to link your shared Python library rather than
the .a? Without you giving feedback on what the outcome was of our
suggestions, including any error messages the compiler, or Apache may
have spat out, it is really hard to help and we just end up guessing.

Graham

From durumdara at gmail.com  Fri Nov  3 09:22:39 2006
From: durumdara at gmail.com (durumdara)
Date: Fri Nov  3 09:22:49 2006
Subject: [mod_python] Interesting PSP error...
Message-ID: <454B50AF.9010904@gmail.com>

Hi !

Interesting, because I copy this code from other module, paste into my 
psp page, and then I got error:

...
    # Mail to admin
    import mailtools
    mailtools.SendMail("xxxxxxxx.admin@xx.xxxxxx.org", 
["xxxx@xx.xxxxxx.org"],
        "Xxxxxxxxxxxxxxxxxxxx", body, Server="xx.xxxxxx.org",
        SmtpUsr = "xxxxxxxx.xxxxx@xx.xxxxxx.org", SmtpPwd = "xxxxxxxxxxxx")
%>
<center>


When I join to one line, the problem vanished:


    mailtools.SendMail("xxxxxxxx.admin@xx.xxxxxx.org", 
["xxxx@xx.xxxxxx.org"], "Xxxxxxxxxxxxxxxxxxxx", body, 
Server="xx.xxxxxx.org", SmtpUsr = "xxxxxxxx.xxxxx@xx.xxxxxx.org", 
SmtpPwd = "xxxxxxxxxxxx")


What happened ???

Thanks for your help !

dd
From fred at adventistcare.org  Fri Nov  3 09:31:47 2006
From: fred at adventistcare.org (Sells, Fred)
Date: Fri Nov  3 09:23:06 2006
Subject: [mod_python] best practices; was "is mod_python borked?"
Message-ID: <1A4BF05172023E468CB6E867923BC90402B6E342@accmail2.sunbelt.org>

The following is extracted from Graham's reply with questions of my own
added.  

Note that I use Apache 2.x and python 2.3 and mod_python 3.1.3 on linux.


>As long as you don't run up against the trailing slash and base url issues.
;-)
I gues I haven't hit them, not sure what they are, are they documented
somewhere. Isn't there an Apache module that fixes this?



>Personally I don't like publisher as it is, but to fix it properly would
most
>likely break a lot of existing user code.
I have found that while the publisher code looks cool, it is an empty shell
around my backend, where each function just calls a method in my application
"Controller".  I have to modify that "shell" and also my backend everytime I
add a feature/method to the backend, which is not "DRY".  Graham, do you
have a "best practices" snippet of writing your own handler to function
similar to the url mapping of the publisher.  I see no reason to do more
than pass **kwargs, since that means there is no impact on the backend api
(but of course on the logic) if I add a parameter in the post.


>if you're using Session objects, Best practice is to use code like:

  if not hasattr(req, 'session'):
    req.session = Session.Session(req)

>Things can still get a bit tricky if you are using req.internal_redirect()
>though. What you can do there depends on which version of mod_python you
are
>using.
This is really cool, I was afraid to mess with the request object, but from
this and other posts, it looks like that's a common practice. Is there a
place that documents the differences between 3.1 and 3.2 on the
internal_redirect()


>Anyway, important thing is that it sounds like you have at least not tried
to
>do it in the PythonHandler phase like most do, which to my mind is the
wrong
>way of going about it. It should be done in an earlier phase so that it can
>cover non mod_python stuff as well, like you indicate your version does.


OOPS! :(   I did exactly that.  I had read the info in the manual about not
doing that, 
but then my brain got full.  my apache.conf file follows, can you suggest
changes.

-----------------------apache.conf------------------------------------------
---------------------------
PythonPath "['.', '/home/acctools/accpython'] + sys.path"
ScriptAlias /logic/ "/var/www/modpy/logic/"

<Directory "/var/www/modpy/logic">  #publishers reside here, backend logic
on pythonpath per above
        SetHandler python-program
        PythonHandler  modpy.security mod_python.publisher
        PythonDebug On
</Directory>

<Directory "/var/www/html/rds">
        AddHandler mod_python .html
        PythonHandler  modpy.passthru #passthru calls the handler in
security, then writes the url
        PythonDebug On
</Directory>
-------------------------------------------------------------



-----------------------security.py---------------------------
#note: I've edited this to reflect the earlier advice on sessions, but have
not tested yet
# in cleaning this up for public viewing, it may not compile.


def handler(req):
    if not hasattr(req, 'session'):
	  req.session = Session.Session(req)    
    uname = req.session.get(UNAME, None)
    if uname==None: 
        cookie = get_cookie(req, ACC_COOKIE)  #my simple function, std
mod_python cookie stuff
        if cookie == None:
            return util.redirect(req, MY_LOGIN_URL)
        else:
            uname = get_uname_from_corporate_server(cookie)
            if uname==None:        
                return util.redirect(req, MY_LOGIN_URL)
            elif uname[:5]==ERROR: 
                return apache.HTTP_FORBIDDEN
            else:
                req.session[UNAME] = uname
    return apache.OK
----------------------------------------------------------------------------
----

---------------------------------------------------------------------------
The information contained in this message may be privileged and / or
confidential and protected from disclosure. If the reader of this message is
not the intended recipient, you are hereby notified that any dissemination,
distribution or copying of this communication is strictly prohibited. If you
have received this communication in error, please notify the sender
immediately by replying to this message and deleting the material from any
computer.
---------------------------------------------------------------------------

From durumdara at gmail.com  Fri Nov  3 09:48:19 2006
From: durumdara at gmail.com (durumdara)
Date: Fri Nov  3 09:48:25 2006
Subject: [mod_python] Syntax highlighter for psp ?
Message-ID: <454B56B3.4090004@gmail.com>

Hi !

I use Context and PyScripter for python and HTML editing.
Does anyone know about an editor that can handle psp syntax highlights ?

Thanks for help:
dd
From alex.greif at gmail.com  Fri Nov  3 10:02:59 2006
From: alex.greif at gmail.com (Alex Greif)
Date: Fri Nov  3 10:03:03 2006
Subject: [mod_python] Syntax highlighter for psp ?
In-Reply-To: <454B56B3.4090004@gmail.com>
References: <454B56B3.4090004@gmail.com>
Message-ID: <778770d80611030702red6e3efwdbcd1627d83dc38f@mail.gmail.com>

I use SciTE and told it to handle psp files the same way as html.

Alex.

On 11/3/06, durumdara <durumdara@gmail.com> wrote:
> Hi !
>
> I use Context and PyScripter for python and HTML editing.
> Does anyone know about an editor that can handle psp syntax highlights ?
>
> Thanks for help:
> dd
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From scavanagh at avaya.com  Fri Nov  3 11:07:51 2006
From: scavanagh at avaya.com (Cavanagh, Sean (Sean))
Date: Fri Nov  3 11:08:02 2006
Subject: [mod_python] Just finished installing mod_python,
	and boy are my arms tired
Message-ID: <5626D959080BBA49BBCA847DAE110FA4CA3108@on0010avexu1.cnda.avaya.com>

Hello all,

I just wanted to mention a couple of un-documented hiccups that tripped
me up during compile.  

1.	Seems that mod_python needs an up-to-date flex; I had to upgrade
to  2.5.33  (For the record, this is in the readme file, but not the
html docs)

2.	Seems that mod_python needs an _old_ libtools; I had to
downgrade from 1.5.20 to 1.5.6.  

Needless to say, there weren't any helpful error messages; this was a
couple hours of head banging and googling.  In the end, I found the
libtool dependency on this helpful forum:
http://www.webhostingtalk.pl/index.php?s=b60bac83029b4d20890b3d0fe4ceb99
4&showtopic=4720&pid=31248&st=0&#entry31248

And for the record, no, I don't speak Polish...

Anyway, to whom might I send some modifications to the
Doc/modpython2.tex file?  I don't have subversion running, and I'm not
inclined to do so just for a small doc update.

Thanks,

Sean Cavanagh | Software QA Manager | Communication Appliances Division
| P2P Business
Avaya | 1135 Innovation Drive Suite 100 | Ottawa, ON K2K 3J7
613.592.4343 x239 | scavanagh@avaya.com



From clodoaldo.pinto at gmail.com  Fri Nov  3 12:06:50 2006
From: clodoaldo.pinto at gmail.com (Clodoaldo Pinto Neto)
Date: Fri Nov  3 12:06:58 2006
Subject: [mod_python] Syntax highlighter for psp ?
In-Reply-To: <454B56B3.4090004@gmail.com>
References: <454B56B3.4090004@gmail.com>
Message-ID: <a595de7a0611030906m78ec391ctf4b50d9422b51ce6@mail.gmail.com>

2006/11/3, durumdara <durumdara@gmail.com>:
> Does anyone know about an editor that can handle psp syntax highlights ?

jEdit has a psp stylesheet.

Regards, Clodoaldo Pinto Neto
From jpg at jgassociates.ca  Fri Nov  3 15:30:00 2006
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Fri Nov  3 15:29:58 2006
Subject: [mod_python] Just finished installing mod_python,	and boy are
	my arms tired
In-Reply-To: <5626D959080BBA49BBCA847DAE110FA4CA3108@on0010avexu1.cnda.avaya.com>
References: <5626D959080BBA49BBCA847DAE110FA4CA3108@on0010avexu1.cnda.avaya.com>
Message-ID: <454BA6C8.9020706@jgassociates.ca>

Cavanagh, Sean (Sean) wrote:
> Hello all,
> 
> I just wanted to mention a couple of un-documented hiccups that tripped
> me up during compile.  
> 
> 1.	Seems that mod_python needs an up-to-date flex; I had to upgrade
> to  2.5.33  (For the record, this is in the readme file, but not the
> html docs)

Incorrect. Flex is listed in the index, and the flex requirement is 
detailed in the docs.
http://www.modpython.org/live/current/doc-html/inst-configure.html#l2h-12

As explained in the docs, you generally don't need flex unless you 
modify with the psp_parser.l file. Unless you are using mod_python < 
3.2, configure will issue a warning about the wrong flex, but will still 
proceed.

> 2.	Seems that mod_python needs an _old_ libtools; I had to
> downgrade from 1.5.20 to 1.5.6.  

I don't know what platform you are on, but I have 1.5.22 on my Ubuntu 
system and see no problems. None the less, please share what you found. 
Include:

OS
apache version (and mpm)
python version
mod_python version

> Needless to say, there weren't any helpful error messages; this was a
> couple hours of head banging and googling.  In the end, I found the
> libtool dependency on this helpful forum:
> http://www.webhostingtalk.pl/index.php?s=b60bac83029b4d20890b3d0fe4ceb99
> 4&showtopic=4720&pid=31248&st=0&#entry31248
> 
> And for the record, no, I don't speak Polish...
> 
> Anyway, to whom might I send some modifications to the
> Doc/modpython2.tex file?  I don't have subversion running, and I'm not
> inclined to do so just for a small doc update.

If it's something small, you can send it to me, send it to the 
mod_python list or to the dev mailing list. If it's a larger patch we 
prefer that a JIRA issue be created so we don't loose it in email 
archive vortex.

If you are sending a patch for anything other than the trunk development 
branch, please make sure the mod_python version you are patching is obvious.

Jim
From jpg at jgassociates.ca  Fri Nov  3 15:33:26 2006
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Fri Nov  3 15:33:20 2006
Subject: [mod_python] Syntax highlighter for psp ?
In-Reply-To: <454B56B3.4090004@gmail.com>
References: <454B56B3.4090004@gmail.com>
Message-ID: <454BA796.5060004@jgassociates.ca>

durumdara wrote:
> Hi !
> 
> I use Context and PyScripter for python and HTML editing.
> Does anyone know about an editor that can handle psp syntax highlights ?

vim and gvim

Jim
From jpg at jgassociates.ca  Fri Nov  3 16:14:00 2006
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Fri Nov  3 16:13:34 2006
Subject: [mod_python] Interesting PSP error...
In-Reply-To: <454B50AF.9010904@gmail.com>
References: <454B50AF.9010904@gmail.com>
Message-ID: <454BB118.4020508@jgassociates.ca>

durumdara wrote:
> Hi !
> 
> Interesting, because I copy this code from other module, paste into my 
> psp page, and then I got error:
> 
> ...
>    # Mail to admin
>    import mailtools
>    mailtools.SendMail("xxxxxxxx.admin@xx.xxxxxx.org", 
> ["xxxx@xx.xxxxxx.org"],
>        "Xxxxxxxxxxxxxxxxxxxx", body, Server="xx.xxxxxx.org",
>        SmtpUsr = "xxxxxxxx.xxxxx@xx.xxxxxx.org", SmtpPwd = "xxxxxxxxxxxx")
> %>
> <center>
> 
> 
> When I join to one line, the problem vanished:
> 
> 
>    mailtools.SendMail("xxxxxxxx.admin@xx.xxxxxx.org", 
> ["xxxx@xx.xxxxxx.org"], "Xxxxxxxxxxxxxxxxxxxx", body, 
> Server="xx.xxxxxx.org", SmtpUsr = "xxxxxxxx.xxxxx@xx.xxxxxx.org", 
> SmtpPwd = "xxxxxxxxxxxx")
> 
> 
> What happened ???

I don't know! :)

What was the error? What is in the error log? Also, could you indicate 
where the line breaks are in your original code. Email line wrap 
weirdness makes it hard to tell.

Jim
From grahamd at dscpl.com.au  Fri Nov  3 19:28:55 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Fri Nov  3 19:30:05 2006
Subject: [mod_python] Mod_python on HP-UX 11.11
In-Reply-To: <C12C17049E23854783042B3D0F25BB67029B7CC4@XCH-MW-2V2.mw.nos.boeing.com>
References: <C12C17049E23854783042B3D0F25BB67029B7CC4@XCH-MW-2V2.mw.nos.boeing.com>
Message-ID: <1DDB06C2-838E-48EA-9454-1ACFAE731820@dscpl.com.au>

I can't remember if I already suggested it or not, but also try building
some other third party Python module which has a C code component.
For example, something like cElementTree. If you can't even get that
to build and work, then there is an issue with the Python installation.
You might also be able to learn from the command like options that
building the third party module for Python results in being used. BTW,
avoid something that uses eggs, just use something that uses a standard
distutils setup.py file.

On 04/11/2006, at 12:02 AM, Buehre, Joseph R wrote:

>  I tried linking as suggested to the .sl instead but to no avail.  I
> will clean-up and start from scratch posting my results as I go  
> through
> the process....
>
> FYI
>
> This is a 32 bit compile and Apache was compiled with --enabled-so
>
> Here is the compiler option in my script.
>
> CC=cc CXX=aCC CFLAGS=+DD32 CXXFLAGS=+DD32
> LDFLAGS=-L/opt/Boeing/python2.4.3/lib ./configure
> --with-apxs=/wwimacs6/apache2/bin/apxs --with-python=/opt/Boeing/
> python2.4.3/bin/python2.4
>
>
> Thanks,
> Joe Buehre
> Mission Critical Systems Support
> 314-791-9725
>
>  mailto:joseph.r.buehre@boeing.com
>
>
> -----Original Message-----
> From: Graham Dumpleton [mailto:grahamd@dscpl.com.au]
> Sent: Thursday, November 02, 2006 3:50 PM
> To: Buehre, Joseph R
> Cc: mod_python@modpython.org
> Subject: Re: [mod_python] Mod_python on HP-UX 11.11
>
> Buehre, Joseph R wrote ..
>> To All-
>>
>> I have tried consently to get mod_python to compile and create  
>> the .so
>
>> file for Apache.  To date this has been an unsucessful adventure.   
>> Has
>
>> anyone done this type of install with HP-UX 11.11, Apache 2.0 and the
>> latest version of mod_python.  Desperately seeking insight.
>
> Presuming you are the same version who was asking about this in the  
> past
> couple of weeks, what was the outcome from when I suggested you change
> the makefile to use -L/-l to link your shared Python library rather  
> than
> the .a? Without you giving feedback on what the outcome was of our
> suggestions, including any error messages the compiler, or Apache may
> have spat out, it is really hard to help and we just end up guessing.
>
> Graham
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
From grahamd at dscpl.com.au  Fri Nov  3 19:39:10 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Fri Nov  3 19:40:23 2006
Subject: [mod_python] Just finished installing mod_python,
	and boy are my arms tired
In-Reply-To: <454BA6C8.9020706@jgassociates.ca>
References: <5626D959080BBA49BBCA847DAE110FA4CA3108@on0010avexu1.cnda.avaya.com>
	<454BA6C8.9020706@jgassociates.ca>
Message-ID: <E753E618-AE08-46A4-8EB5-6A0EDA1FDA0E@dscpl.com.au>


On 04/11/2006, at 7:30 AM, Jim Gallacher wrote:

> Cavanagh, Sean (Sean) wrote:
>> Hello all,
>> I just wanted to mention a couple of un-documented hiccups that  
>> tripped
>> me up during compile.  1.	Seems that mod_python needs an up-to- 
>> date flex; I had to upgrade
>> to  2.5.33  (For the record, this is in the readme file, but not the
>> html docs)
>
> Incorrect. Flex is listed in the index, and the flex requirement is  
> detailed in the docs.
> http://www.modpython.org/live/current/doc-html/inst- 
> configure.html#l2h-12
>
> As explained in the docs, you generally don't need flex unless you  
> modify with the psp_parser.l file. Unless you are using mod_python  
> < 3.2, configure will issue a warning about the wrong flex, but  
> will still proceed.

With the caveat that if you check out source code from subversion
rather than use the tarball, you usually need to go:

   touch src/psp_parser.c

to stop make wanting to rebuild it from the lex input file. This is
because the checkout often seems to leave the modification time
such that it isn't seen as being newer that then lex input file.

Even if using the tarball and somehow the timestamps get mucked
up, you can do the same thing.

Graham
From grahamd at dscpl.com.au  Fri Nov  3 19:48:28 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Fri Nov  3 19:49:44 2006
Subject: [mod_python] best practices; was "is mod_python borked?"
In-Reply-To: <1A4BF05172023E468CB6E867923BC90402B6E342@accmail2.sunbelt.org>
References: <1A4BF05172023E468CB6E867923BC90402B6E342@accmail2.sunbelt.org>
Message-ID: <FD8769DF-2A4D-4533-ACB4-7130E2190991@dscpl.com.au>


On 04/11/2006, at 1:31 AM, Sells, Fred wrote:

> The following is extracted from Graham's reply with questions of my  
> own
> added.
>
> Note that I use Apache 2.x and python 2.3 and mod_python 3.1.3 on  
> linux.
>
>
>> As long as you don't run up against the trailing slash and base  
>> url issues.
> ;-)
> I gues I haven't hit them, not sure what they are, are they documented
> somewhere. Isn't there an Apache module that fixes this?

You can read a bit about it at:

   http://www.modpython.org/pipermail/mod_python/2006-March/020501.html

On the other stuff in your email I'll get back to them later. I  
should really learn to
shut up though, as my preferred ways of doing things these days  
depend on
version 3.3 of mod_python, which hasn't even been released yet. I keep
forgetting that most are on versions and generally unwilling to use  
stuff out of
the repository. :-)

Graham
From joseph.r.buehre at boeing.com  Fri Nov  3 21:34:20 2006
From: joseph.r.buehre at boeing.com (Buehre, Joseph R)
Date: Fri Nov  3 21:34:29 2006
Subject: [mod_python] Mod_python on HP-UX 11.11
In-Reply-To: <1DDB06C2-838E-48EA-9454-1ACFAE731820@dscpl.com.au>
Message-ID: <C12C17049E23854783042B3D0F25BB67029B7CCB@XCH-MW-2V2.mw.nos.boeing.com>

I have already compiled cx_oracle for python and I had no trouble with
it other than not being able to get TNSNAMES or LDAP.ora to work
correctly for Database resolution, so the work around was to fully
qualify the DB connect string. 

I hope to work on the mod_python again this weekend.....thanks Graham


Thanks, 
Joe Buehre 
Mission Critical Systems Support 
314-791-9725

 mailto:joseph.r.buehre@boeing.com


-----Original Message-----
From: Graham Dumpleton [mailto:grahamd@dscpl.com.au] 
Sent: Friday, November 03, 2006 6:29 PM
To: Buehre, Joseph R
Cc: mod_python@modpython.org
Subject: Re: [mod_python] Mod_python on HP-UX 11.11

I can't remember if I already suggested it or not, but also try building
some other third party Python module which has a C code component.
For example, something like cElementTree. If you can't even get that to
build and work, then there is an issue with the Python installation.
You might also be able to learn from the command like options that
building the third party module for Python results in being used. BTW,
avoid something that uses eggs, just use something that uses a standard
distutils setup.py file.

On 04/11/2006, at 12:02 AM, Buehre, Joseph R wrote:

>  I tried linking as suggested to the .sl instead but to no avail.  I 
> will clean-up and start from scratch posting my results as I go 
> through the process....
>
> FYI
>
> This is a 32 bit compile and Apache was compiled with --enabled-so
>
> Here is the compiler option in my script.
>
> CC=cc CXX=aCC CFLAGS=+DD32 CXXFLAGS=+DD32 
> LDFLAGS=-L/opt/Boeing/python2.4.3/lib ./configure 
> --with-apxs=/wwimacs6/apache2/bin/apxs --with-python=/opt/Boeing/
> python2.4.3/bin/python2.4
>
>
> Thanks,
> Joe Buehre
> Mission Critical Systems Support
> 314-791-9725
>
>  mailto:joseph.r.buehre@boeing.com
>
>
> -----Original Message-----
> From: Graham Dumpleton [mailto:grahamd@dscpl.com.au]
> Sent: Thursday, November 02, 2006 3:50 PM
> To: Buehre, Joseph R
> Cc: mod_python@modpython.org
> Subject: Re: [mod_python] Mod_python on HP-UX 11.11
>
> Buehre, Joseph R wrote ..
>> To All-
>>
>> I have tried consently to get mod_python to compile and create the 
>> .so
>
>> file for Apache.  To date this has been an unsucessful adventure.   
>> Has
>
>> anyone done this type of install with HP-UX 11.11, Apache 2.0 and the

>> latest version of mod_python.  Desperately seeking insight.
>
> Presuming you are the same version who was asking about this in the 
> past couple of weeks, what was the outcome from when I suggested you 
> change the makefile to use -L/-l to link your shared Python library 
> rather than the .a? Without you giving feedback on what the outcome 
> was of our suggestions, including any error messages the compiler, or 
> Apache may have spat out, it is really hard to help and we just end up

> guessing.
>
> Graham
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python

From steve at holdenweb.com  Fri Nov  3 23:43:06 2006
From: steve at holdenweb.com (Steve Holden)
Date: Fri Nov  3 23:42:10 2006
Subject: [mod_python] Re: best practices; was "is mod_python borked?"
In-Reply-To: <FD8769DF-2A4D-4533-ACB4-7130E2190991@dscpl.com.au>
References: <1A4BF05172023E468CB6E867923BC90402B6E342@accmail2.sunbelt.org>
	<FD8769DF-2A4D-4533-ACB4-7130E2190991@dscpl.com.au>
Message-ID: <eih5mj$9qa$1@sea.gmane.org>

Graham Dumpleton wrote:
> 
> On 04/11/2006, at 1:31 AM, Sells, Fred wrote:
> 
>> The following is extracted from Graham's reply with questions of my  own
>> added.
>>
>> Note that I use Apache 2.x and python 2.3 and mod_python 3.1.3 on  linux.
>>
>>
>>> As long as you don't run up against the trailing slash and base  url 
>>> issues.
>>
>> ;-)
>> I gues I haven't hit them, not sure what they are, are they documented
>> somewhere. Isn't there an Apache module that fixes this?
> 
> 
> You can read a bit about it at:
> 
>   http://www.modpython.org/pipermail/mod_python/2006-March/020501.html
> 
Wasn't this kind of stuff why publisher was designed in the first place? 
I remember having a dialog with Grisha about similar topics, and his 
reply essentially being "Most of the web stuff I do uses CGI" :)

> On the other stuff in your email I'll get back to them later. I  should 
> really learn to
> shut up though, as my preferred ways of doing things these days  depend on
> version 3.3 of mod_python, which hasn't even been released yet. I keep
> forgetting that most are on versions and generally unwilling to use  
> stuff out of
> the repository. :-)
> 
I'd be using bleeding edge mod_python if I could persuade myself to 
upgrade to Apache 2.2. In my environment it's not that easy. IIRC I had 
to install Apache-with-SSL and then install Apache-without-SSL over it 
to get the working installation I have today. Windows can be a real pain.

regards
  Steve
-- 
Steve Holden       +44 150 684 7255  +1 800 494 3119
Holden Web LLC/Ltd          http://www.holdenweb.com
Skype: holdenweb       http://holdenweb.blogspot.com
Recent Ramblings     http://del.icio.us/steve.holden

From grahamd at dscpl.com.au  Sat Nov  4 00:53:19 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Sat Nov  4 00:54:37 2006
Subject: [mod_python] Re: best practices; was "is mod_python borked?"
In-Reply-To: <eih5mj$9qa$1@sea.gmane.org>
References: <1A4BF05172023E468CB6E867923BC90402B6E342@accmail2.sunbelt.org>
	<FD8769DF-2A4D-4533-ACB4-7130E2190991@dscpl.com.au>
	<eih5mj$9qa$1@sea.gmane.org>
Message-ID: <E89DA8C8-4F6B-47E2-981E-4216C290D4E0@dscpl.com.au>


On 04/11/2006, at 3:43 PM, Steve Holden wrote:

> Graham Dumpleton wrote:
>> On 04/11/2006, at 1:31 AM, Sells, Fred wrote:
>>> The following is extracted from Graham's reply with questions of  
>>> my  own
>>> added.
>>>
>>> Note that I use Apache 2.x and python 2.3 and mod_python 3.1.3  
>>> on  linux.
>>>
>>>
>>>> As long as you don't run up against the trailing slash and base   
>>>> url issues.
>>>
>>> ;-)
>>> I gues I haven't hit them, not sure what they are, are they  
>>> documented
>>> somewhere. Isn't there an Apache module that fixes this?
>> You can read a bit about it at:
>>   http://www.modpython.org/pipermail/mod_python/2006-March/ 
>> 020501.html
> Wasn't this kind of stuff why publisher was designed in the first  
> place? I remember having a dialog with Grisha about similar topics,  
> and his reply essentially being "Most of the web stuff I do uses  
> CGI" :)

Not having myself really qualified which part of that mail message I  
referred
to was what I saw as the problem, am not sure how your comment relates
and which bit you are saying publisher was designed for in the first  
place. :-)

In terms of what I had in mind as being an issue, there are few parts  
to it.

For the first, when a request arrives against a physical directory  
and there is
no trailing slash on the URL, Apache (unless it is disabled), will  
send a redirect
back to the browser forcing it send the request again but with a  
trailing slash
added. By doing this, it is helping the browser to understand what  
the effective
base URL is such that if relative URLs are then used to address other  
resources
within that directory, it will be able to construct the URL properly.

Thus, if we have a filesystem structure:

   /some/path/directory
   /some/path/directory/index.html
   /some/path/directory/file-1.html

and we pretend that the URL to access it is the same. If a URL  
arrives which
is:

   /some/path/directory

then Apache sends a redirect back to the browser asking it to re- 
request the
resource with the URL:

   /some/path/directory/

Where the DirectoryIndex directive is set and it contains  
'index.html', Apache
will now internally map the request, with trailing slash, to the  
'index.html' file
and serve up that page as the response content.

If that page then has a relative link in it for 'file-1.html', the  
browser will if told
to follow that link, will request:

   /some/path/directory/file-1.html

If this trailing slash redirection for the directory wasn't done, and  
the URL of:

   /some/path/directory

without the trailing slash were allowed to map to 'index.html', then  
the browser
when trying to follow the link would actually request:

   /some/path/file-1.html

as it wouldn't know that 'file-1.html' was actual a contained item  
underneath the
context of the resource, as opposed to a sibling.

Now when we look at how URLs are matched to object hierarchies in  
publisher,
something which if I understand the history correctly, follows from  
the bobo
publisher in what became Zope, it doesn't try and view the object  
hierarchy in
the same way as a directory structure and doesn't do any trailing  
slash redirection
to establish directory contexts when it perhaps should.

Thus if I have:

   class dummy:

     def __call__(req): return "<a href='file_1'>file_1</a>"
     def file_1(req): return "file_1"

   directory = dummy()

and I access this through publisher such that trailing part of the  
URL looks like:

   /directory

although the __call__ method acts like the index page for that level  
in the
hierarchy, publisher doesn't look at it that way and simply accepts  
the URL
without the trailing slash. Thus, if the link is now followed in that  
page, it will
end up mapping to:

   /file_1

and not to:

   /directory/file_1

Now although publisher doesn't force the browser to re-request for  
the __call__()
method, it will accept a trailing slash on the URL still and when  
that is done then
the link in the page does correctly resolve the correct resource.

Thus, everything can be made to work as long as whenever the target  
is a __call__()
method, that a trailing slash is always used on the URL. However, if  
the user sees
the URL and manually removes the trailing slash himself, then the  
links in then page
break.

So whereas one should be able to use fixed relative links in a page  
generated from
a __call__() method called by publisher, one is instead forced to  
either make them
absolute path links, or dynamically determine what the relative link  
should be by looking
at the URL and what is determinable about where the point sits in the  
object hierarchy.

This issue is further complicated by how publisher automatically maps  
a request
against a physical directory when SetHandler is used to the index.py  
file, and when
it maps a request against a physical file, whether SetHandler or  
AddHandler is used,
against the index() method contained within it.

Not only does one have to deal with the fact that publisher will  
accept a URL with
out without a trailing slash and doesn't force a trailing slash to be  
added in
appropriate contexts, you end up, as explained in the referenced  
email, with multiple
URLs that can map to the same resource. If all these URLs were at the  
same context
level that wouldn't really matter, but they aren't and have differing  
numbers of slashes
within the URL, further making the process of working with relative  
URLs a mess.

In summary, the problems I see are publisher not doing the trailing  
slash redirect
where appropriate and how automatic mapping to the index file and  
index function
are done resulting in different URLs working with different base URL  
contexts.

Having said all that, what did you mean when saying 'why publisher  
was designed
in the first place'? I have no issue with the object traversal, just  
how it deals with
nodes within the hierarchy.

Graham
From jpg at jgassociates.ca  Sat Nov  4 08:34:18 2006
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Sat Nov  4 08:35:00 2006
Subject: [mod_python] Just finished installing mod_python,	and boy are
	my arms tired
In-Reply-To: <E753E618-AE08-46A4-8EB5-6A0EDA1FDA0E@dscpl.com.au>
References: <5626D959080BBA49BBCA847DAE110FA4CA3108@on0010avexu1.cnda.avaya.com>	<454BA6C8.9020706@jgassociates.ca>
	<E753E618-AE08-46A4-8EB5-6A0EDA1FDA0E@dscpl.com.au>
Message-ID: <454C96DA.2000607@jgassociates.ca>

Graham Dumpleton wrote:
> 
> On 04/11/2006, at 7:30 AM, Jim Gallacher wrote:
> 
>> Cavanagh, Sean (Sean) wrote:
>>> Hello all,
>>> I just wanted to mention a couple of un-documented hiccups that tripped
>>> me up during compile.  1.    Seems that mod_python needs an 
>>> up-to-date flex; I had to upgrade
>>> to  2.5.33  (For the record, this is in the readme file, but not the
>>> html docs)
>>
>> Incorrect. Flex is listed in the index, and the flex requirement is 
>> detailed in the docs.
>> http://www.modpython.org/live/current/doc-html/inst-configure.html#l2h-12
>>
>> As explained in the docs, you generally don't need flex unless you 
>> modify with the psp_parser.l file. Unless you are using mod_python < 
>> 3.2, configure will issue a warning about the wrong flex, but will 
>> still proceed.
> 
> With the caveat that if you check out source code from subversion
> rather than use the tarball, you usually need to go:
> 
>   touch src/psp_parser.c
> 
> to stop make wanting to rebuild it from the lex input file. This is
> because the checkout often seems to leave the modification time
> such that it isn't seen as being newer that then lex input file.

This is something I've never need to do, but psp_parser.l and 
psp_parser.c do have exactly the same timestamps, so perhaps it depends 
on your particular make? I wonder if we just touched the psp_parser.c 
file to make sure it is at least 1 minute newer than psp_parser.l, and 
then commit, if the problem would go away in general?

Jim



From list at joreybump.com  Sat Nov  4 14:44:26 2006
From: list at joreybump.com (Jorey Bump)
Date: Sat Nov  4 14:44:41 2006
Subject: [mod_python] Re: best practices; was "is mod_python borked?"
In-Reply-To: <E89DA8C8-4F6B-47E2-981E-4216C290D4E0@dscpl.com.au>
References: <1A4BF05172023E468CB6E867923BC90402B6E342@accmail2.sunbelt.org>	<FD8769DF-2A4D-4533-ACB4-7130E2190991@dscpl.com.au>	<eih5mj$9qa$1@sea.gmane.org>
	<E89DA8C8-4F6B-47E2-981E-4216C290D4E0@dscpl.com.au>
Message-ID: <454CED9A.5000406@joreybump.com>

Graham Dumpleton wrote:

> So whereas one should be able to use fixed relative links in a page 
> generated from a __call__() method called by publisher, one is
> instead forced to either make them absolute path links, or
> dynamically determine what the relative link should be by looking at
> the URL and what is determinable about where the point sits in the 
> object hierarchy.
> 
> This issue is further complicated by how publisher automatically maps
> a request against a physical directory when SetHandler is used to the
> index.py file, and when it maps a request against a physical file,
> whether SetHandler or AddHandler is used, against the index() method
> contained within it.
> 
> Not only does one have to deal with the fact that publisher will
> accept a URL with out without a trailing slash and doesn't force a
> trailing slash to be added in appropriate contexts, you end up, as
> explained in the referenced email, with multiple URLs that can map to
> the same resource. If all these URLs were at the same context level
> that wouldn't really matter, but they aren't and have differing 
> numbers of slashes within the URL, further making the process of
> working with relative URLs a mess.
> 
> In summary, the problems I see are publisher not doing the trailing 
> slash redirect where appropriate and how automatic mapping to the
> index file and index function are done resulting in different URLs
> working with different base URL contexts.

I think you've overlooked another case: Instance attributes or methods 
can be accessed with either slashes or dots as separators:

class Dummy:
     def html(self):
         return """<html>
<head><title>What Am I?</title></head>
<body><h1>Hello! What am I?</h1></body>
</html>
"""

instance = Dummy()

Now we can access the method in multiple ways:

  http://host/dir/module/instance.html
  http://host/dir/module/instance/html
  http://host/dir/module/instance.html/
  http://host/dir/module/instance/html/

Determining the appropriate context to force a slash suddenly becomes a 
lot trickier. Clearly, there's a use for the dotted notation, not only 
as a way to obscure the technology used, but to replace static content 
without disturbing existing links, provide dynamically generated files 
with appropriate extensions for mime-handicapped browsers, and other 
clever uses best left to the programmer.

I like the flexibility, and I'm happy to handle the details of URL 
creation within my own code. I mostly construct absolute path links, and 
it doesn't seem like that much of a burden. When I do use relative 
links, I determine what resources they are relative to, and try to 
protect the user from ever needing to edit the URL in the browser. If 
someone does, and things break, how is that different from any other 
mistyped URL?

I understand the desire to include better support for relative and 
incorrect links, but it seems the only way to accomplish this 
automatically within Publisher is to introduce a limitation that is sure 
to break existing code (as Graham points out). Some developers really 
*like* to have URLs that never end in slashes, regardless of the 
resource's place in the heirarchy. I wouldn't be happy if Publisher 
suddenly started forcing slashes to appear where I didn't want them.

From papanii.okai at gmail.com  Sat Nov  4 21:12:55 2006
From: papanii.okai at gmail.com (Papanii Okai)
Date: Sat Nov  4 21:13:04 2006
Subject: [mod_python] session problems on mac os x
Message-ID: <454D48A7.6060304@gmail.com>

Hi Guys,
             i seem to have a problem with sessions i cannot seem to get 
my head around.  I am using the publisher as my dispatcher. When a 
person logs in i have a method  that creates the sessions. Below is the 
code..

def sessionCreation(req, id):
    packSession = Session.Session(req)
    packSession['userID'] = id
    packSession.save()

Now, when a page is requested i have another handler that does some 
stuff.. below is a stripped down version...


def getMain(req):
     packSession = Session.Session(req)
     req.write("cool")

For some reason i am getting the following error when this handler is 
executed...
-------------------------------------------------------------------------------------------------------
Mod_python error: "PythonHandler mod_python.publisher"

Traceback (most recent call last):

  File 
"/Library/Frameworks/Python.framework/Versions/2.4/lib/python2.4/site-packages/mod_python/apache.py", 
line 299, in HandlerDispatch
    result = object(req)

  File 
"/Library/Frameworks/Python.framework/Versions/2.4/lib/python2.4/site-packages/mod_python/publisher.py", 
line 213, in handler
    published = publish_object(req, object)

  File 
"/Library/Frameworks/Python.framework/Versions/2.4/lib/python2.4/site-packages/mod_python/publisher.py", 
line 412, in publish_object
    return publish_object(req,util.apply_fs_data(object, req.form, req=req))

  File 
"/Library/Frameworks/Python.framework/Versions/2.4/lib/python2.4/site-packages/mod_python/util.py", 
line 439, in apply_fs_data
    return object(**args)

  File "/Users/papaniiokai/Sites/citepack/citepack.py", line 35, in login
    sessionCreation(req, success)

  File "/Users/papaniiokai/Sites/citepack/citepack.py", line 79, in 
sessionCreation
    packSession = Session.Session(req)

  File 
"/Library/Frameworks/Python.framework/Versions/2.4/lib/python2.4/site-packages/mod_python/Session.py", 
line 735, in Session
    timeout=timeout, lock=lock)

  File 
"/Library/Frameworks/Python.framework/Versions/2.4/lib/python2.4/site-packages/mod_python/Session.py", 
line 337, in __init__
    timeout=timeout, lock=lock)

  File 
"/Library/Frameworks/Python.framework/Versions/2.4/lib/python2.4/site-packages/mod_python/Session.py", 
line 173, in __init__
    self.lock()                 # lock new sid

  File 
"/Library/Frameworks/Python.framework/Versions/2.4/lib/python2.4/site-packages/mod_python/Session.py", 
line 255, in lock
    _apache._global_lock(self._req.server, self._sid)

ValueError: Failed to acquire global mutex lock

---------------------------------------------------------------------------------
I checked around on Google and people said things like changing the User 
in the httpd.conf file from nobody to root or some other user. Even 
though i was not happy with that solution, it did not work for me even 
with root.

Any help will be greatly appreciated.

System: Mac OS X,  python 2.4.3,  mod_python 3.2.10

--Papanii


From grahamd at dscpl.com.au  Sun Nov  5 00:43:54 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Sun Nov  5 00:44:06 2006
Subject: [mod_python] Re: best practices; was "is mod_python borked?"
In-Reply-To: <454CED9A.5000406@joreybump.com>
References: <1A4BF05172023E468CB6E867923BC90402B6E342@accmail2.sunbelt.org>	<FD8769DF-2A4D-4533-ACB4-7130E2190991@dscpl.com.au>	<eih5mj$9qa$1@sea.gmane.org>
	<E89DA8C8-4F6B-47E2-981E-4216C290D4E0@dscpl.com.au>
	<454CED9A.5000406@joreybump.com>
Message-ID: <60FFE5F3-CB81-48F3-AB5C-A83C6A995927@dscpl.com.au>

Yes, forgot that '.' can be used in URL in place of '/' which can make
it even more interesting. I am guessing though that for this to work,
you would need to have been using SetHandler rather than AddHandler,
as imagine that using AddHandler would cause issues with Apache's
own attempt to match extensions against files. I'll have to try playing
with it some time to remind myself.

Graham

On 05/11/2006, at 6:44 AM, Jorey Bump wrote:

> Graham Dumpleton wrote:
>
>> So whereas one should be able to use fixed relative links in a  
>> page generated from a __call__() method called by publisher, one is
>> instead forced to either make them absolute path links, or
>> dynamically determine what the relative link should be by looking at
>> the URL and what is determinable about where the point sits in the  
>> object hierarchy.
>> This issue is further complicated by how publisher automatically maps
>> a request against a physical directory when SetHandler is used to the
>> index.py file, and when it maps a request against a physical file,
>> whether SetHandler or AddHandler is used, against the index() method
>> contained within it.
>> Not only does one have to deal with the fact that publisher will
>> accept a URL with out without a trailing slash and doesn't force a
>> trailing slash to be added in appropriate contexts, you end up, as
>> explained in the referenced email, with multiple URLs that can map to
>> the same resource. If all these URLs were at the same context level
>> that wouldn't really matter, but they aren't and have differing  
>> numbers of slashes within the URL, further making the process of
>> working with relative URLs a mess.
>> In summary, the problems I see are publisher not doing the  
>> trailing slash redirect where appropriate and how automatic  
>> mapping to the
>> index file and index function are done resulting in different URLs
>> working with different base URL contexts.
>
> I think you've overlooked another case: Instance attributes or  
> methods can be accessed with either slashes or dots as separators:
>
> class Dummy:
>     def html(self):
>         return """<html>
> <head><title>What Am I?</title></head>
> <body><h1>Hello! What am I?</h1></body>
> </html>
> """
>
> instance = Dummy()
>
> Now we can access the method in multiple ways:
>
>  http://host/dir/module/instance.html
>  http://host/dir/module/instance/html
>  http://host/dir/module/instance.html/
>  http://host/dir/module/instance/html/
>
> Determining the appropriate context to force a slash suddenly  
> becomes a lot trickier. Clearly, there's a use for the dotted  
> notation, not only as a way to obscure the technology used, but to  
> replace static content without disturbing existing links, provide  
> dynamically generated files with appropriate extensions for mime- 
> handicapped browsers, and other clever uses best left to the  
> programmer.
>
> I like the flexibility, and I'm happy to handle the details of URL  
> creation within my own code. I mostly construct absolute path  
> links, and it doesn't seem like that much of a burden. When I do  
> use relative links, I determine what resources they are relative  
> to, and try to protect the user from ever needing to edit the URL  
> in the browser. If someone does, and things break, how is that  
> different from any other mistyped URL?
>
> I understand the desire to include better support for relative and  
> incorrect links, but it seems the only way to accomplish this  
> automatically within Publisher is to introduce a limitation that is  
> sure to break existing code (as Graham points out). Some developers  
> really *like* to have URLs that never end in slashes, regardless of  
> the resource's place in the heirarchy. I wouldn't be happy if  
> Publisher suddenly started forcing slashes to appear where I didn't  
> want them.
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
From jpg at jgassociates.ca  Sun Nov  5 08:09:19 2006
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Sun Nov  5 08:05:30 2006
Subject: [mod_python] session problems on mac os x
In-Reply-To: <454D48A7.6060304@gmail.com>
References: <454D48A7.6060304@gmail.com>
Message-ID: <454DE27F.8030405@jgassociates.ca>

Papanii Okai wrote:
> Hi Guys,
>             i seem to have a problem with sessions i cannot seem to get 
> my head around.  I am using the publisher as my dispatcher. When a 
> person logs in i have a method  that creates the sessions. Below is the 
> code..
> 
> def sessionCreation(req, id):
>    packSession = Session.Session(req)
>    packSession['userID'] = id
>    packSession.save()
> 
> Now, when a page is requested i have another handler that does some 
> stuff.. below is a stripped down version...
> 
> 
> def getMain(req):
>     packSession = Session.Session(req)
>     req.write("cool")
> 
> For some reason i am getting the following error when this handler is 
> executed...
> ------------------------------------------------------------------------------------------------------- 
> 
> Mod_python error: "PythonHandler mod_python.publisher"
> 
> Traceback (most recent call last):
> 
>  File 
> "/Library/Frameworks/Python.framework/Versions/2.4/lib/python2.4/site-packages/mod_python/apache.py", 
> line 299, in HandlerDispatch
>    result = object(req)
> 
>  File 
> "/Library/Frameworks/Python.framework/Versions/2.4/lib/python2.4/site-packages/mod_python/publisher.py", 
> line 213, in handler
>    published = publish_object(req, object)
> 
>  File 
> "/Library/Frameworks/Python.framework/Versions/2.4/lib/python2.4/site-packages/mod_python/publisher.py", 
> line 412, in publish_object
>    return publish_object(req,util.apply_fs_data(object, req.form, req=req))
> 
>  File 
> "/Library/Frameworks/Python.framework/Versions/2.4/lib/python2.4/site-packages/mod_python/util.py", 
> line 439, in apply_fs_data
>    return object(**args)
> 
>  File "/Users/papaniiokai/Sites/citepack/citepack.py", line 35, in login
>    sessionCreation(req, success)
> 
>  File "/Users/papaniiokai/Sites/citepack/citepack.py", line 79, in 
> sessionCreation
>    packSession = Session.Session(req)
> 
>  File 
> "/Library/Frameworks/Python.framework/Versions/2.4/lib/python2.4/site-packages/mod_python/Session.py", 
> line 735, in Session
>    timeout=timeout, lock=lock)
> 
>  File 
> "/Library/Frameworks/Python.framework/Versions/2.4/lib/python2.4/site-packages/mod_python/Session.py", 
> line 337, in __init__
>    timeout=timeout, lock=lock)
> 
>  File 
> "/Library/Frameworks/Python.framework/Versions/2.4/lib/python2.4/site-packages/mod_python/Session.py", 
> line 173, in __init__
>    self.lock()                 # lock new sid
> 
>  File 
> "/Library/Frameworks/Python.framework/Versions/2.4/lib/python2.4/site-packages/mod_python/Session.py", 
> line 255, in lock
>    _apache._global_lock(self._req.server, self._sid)
> 
> ValueError: Failed to acquire global mutex lock
> 
> --------------------------------------------------------------------------------- 
> 
> I checked around on Google and people said things like changing the User 
> in the httpd.conf file from nobody to root or some other user. Even 
> though i was not happy with that solution, it did not work for me even 
> with root.
> 
> Any help will be greatly appreciated.
> 
> System: Mac OS X,  python 2.4.3,  mod_python 3.2.10
> 

Take a look at the apache error_log. How many mutexes are being created 
on startup? Are there any log entries complaining about running out of 
mutexes?

Jim
From clodoaldo.pinto at gmail.com  Sun Nov  5 09:03:39 2006
From: clodoaldo.pinto at gmail.com (Clodoaldo Pinto Neto)
Date: Sun Nov  5 09:03:44 2006
Subject: [mod_python] PSP global variables
Message-ID: <a595de7a0611050603l62f92e68kb4f02fd25991b894@mail.gmail.com>

I'm building a PSP tutorial and can't find in the mod_python manual
any references to the global variables req, form and session as in
this article:

http://www.onlamp.com/pub/a/python/2004/02/26/python_server_pages.html

Are they unsupported features?

http://webpython.codepoint.net/mod_python_psp

Regards, Clodoaldo Pinto Neto
From list at joreybump.com  Sun Nov  5 10:31:19 2006
From: list at joreybump.com (Jorey Bump)
Date: Sun Nov  5 10:31:23 2006
Subject: [mod_python] Re: best practices; was "is mod_python borked?"
In-Reply-To: <60FFE5F3-CB81-48F3-AB5C-A83C6A995927@dscpl.com.au>
References: <1A4BF05172023E468CB6E867923BC90402B6E342@accmail2.sunbelt.org>	<FD8769DF-2A4D-4533-ACB4-7130E2190991@dscpl.com.au>	<eih5mj$9qa$1@sea.gmane.org>
	<E89DA8C8-4F6B-47E2-981E-4216C290D4E0@dscpl.com.au>
	<454CED9A.5000406@joreybump.com>
	<60FFE5F3-CB81-48F3-AB5C-A83C6A995927@dscpl.com.au>
Message-ID: <454E03C7.4090607@joreybump.com>

Graham Dumpleton wrote:
> Yes, forgot that '.' can be used in URL in place of '/' which can make
> it even more interesting. I am guessing though that for this to work,
> you would need to have been using SetHandler rather than AddHandler,
> as imagine that using AddHandler would cause issues with Apache's
> own attempt to match extensions against files. I'll have to try playing
> with it some time to remind myself.

Yes, my example uses SetHandler. Things get even more interesting when 
we alter the example module a bit, name it index.py, and name the 
instance index:

page = """<html>
<head><title>What Am I?</title></head>
<body><h1>Hello! What am I?</h1></body>
</html>
"""

class Dummy:
     def __call__(self):
         return page
     def html(self):
         return page

index = Dummy()

This adds some interesting possibilities to the list of URLs:

  http://host/dir/index.py/index.html
  http://host/dir/index/index.html
  http://host/dir/index/
  http://host/dir/index.html
  http://host/dir/
  http://host/dir/... many other variations

Using this technique, you could probably replace a small site of static 
pages entirely with index.py without breaking existing URLs. This 
assumes access is always gained through one of the following URLs:

  http://host/
  http://host/index.html

Since SetHandler is used, you would need to adjust your configuration to 
support serving other resources like images, but it's doable. I think 
there is a small demand for this functionality, since the question of 
running an entire site via Publisher does pop up once in a while, as 
well as a desire to hide the technology driving the site.

So, back on topic, we can end up with ugly URLs like this:

  http://host/dir/index.py/index.html/
  http://host/dir/index.py/index/html/

that are the exact equivalent of these more friendly ones:

  http://host/dir/index.html/
  http://host/dir/

Now forcing slashes is no longer an issue of inserting them in the 
appropriate context, but of Publisher trying to determine the 
developer's intent. Since I don't believe that this is possible, and 
also find the default flexibility to be useful, maybe the best approach 
to provide such functionality to those who want it is to pass an option 
to Publisher, or even create a formal plugin system to strap on optional 
features.

From list at joreybump.com  Sun Nov  5 10:56:57 2006
From: list at joreybump.com (Jorey Bump)
Date: Sun Nov  5 10:57:03 2006
Subject: [mod_python] Re: best practices; was "is mod_python borked?"
In-Reply-To: <454E03C7.4090607@joreybump.com>
References: <1A4BF05172023E468CB6E867923BC90402B6E342@accmail2.sunbelt.org>	<FD8769DF-2A4D-4533-ACB4-7130E2190991@dscpl.com.au>	<eih5mj$9qa$1@sea.gmane.org>	<E89DA8C8-4F6B-47E2-981E-4216C290D4E0@dscpl.com.au>	<454CED9A.5000406@joreybump.com>	<60FFE5F3-CB81-48F3-AB5C-A83C6A995927@dscpl.com.au>
	<454E03C7.4090607@joreybump.com>
Message-ID: <454E09C9.2050906@joreybump.com>

Jorey Bump wrote:

> that are the exact equivalent of these more friendly ones:
> 
>  http://host/dir/index.html/

Doh! I meant:

  http://host/dir/index.html



From jpg at jgassociates.ca  Sun Nov  5 11:22:35 2006
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Sun Nov  5 11:16:28 2006
Subject: [mod_python] PSP global variables
In-Reply-To: <a595de7a0611050603l62f92e68kb4f02fd25991b894@mail.gmail.com>
References: <a595de7a0611050603l62f92e68kb4f02fd25991b894@mail.gmail.com>
Message-ID: <454E0FCB.30500@jgassociates.ca>

Clodoaldo Pinto Neto wrote:
> I'm building a PSP tutorial and can't find in the mod_python manual
> any references to the global variables req, form and session as in
> this article:
> 
> http://www.onlamp.com/pub/a/python/2004/02/26/python_server_pages.html
> 
> Are they unsupported features?

Completely supported, but poorly documented. There are some deficiencies 
  in the form and session support in 3.1 that are addressed in 3.2 and 
3.3. (We are hoping to do a 3.3 beta this week). I'm not sure how you'll 
deal with these changes in your tutorial. It may depend on your audience 
- beginner or more advanced?

Anyway, here are a few points to consider (bugs rather than features):

The session and form instances are created auto-magically when "session" 
or "form" are found in the psp code. eg.

name = session['name']
title = form['title']

-----
3.1.3
-----
The platform default session class will be used. There is no way to 
control this. If you need something else or want control over other 
aspects of your session such as timeout, *don't* reference "session" in 
the psp code. Use something else like sess, and create your own instance:

sess = Session.DbmSession(req, timeout=7200)

There are possible session locking issues if a session is created in 
other code outside the psp page, in another handler phase for example. 
It's easy to deadlock the session if you are not careful in manually 
unlocking the session.

You should only create a form once per request, as the request data is 
"consumed" when the FieldStorage instance is created. Attempting to 
create a second instance will result in a form object with no data. 
Again this is a problem if you want to access the form data outside of 
the psp page, such as in an earlier processing phase.

---
3.2
---
This version introduced a number of PythonOption's to allow 
configuration of the session, including the session type, directory (for 
dbm), session timeout and so on. This makes it much easer to control the 
session magic in psp pages. Check the docs for specifics, but note that 
we are introducing a new PythonOption namespace convention in version 3.3.

The req object is now checked for a session attribute, and if it is 
found it is used instead of creating a new one. This fixes one of the 
problems in 3.1 when the session object is created outside of the psp page.

The 3.2 PythonOption's which are deprecated in 3.3
session
	Deprecated in 3.3, use mod_python.session.session_type
ApplicationPath
	Deprecated in 3.3, use mod_python.session.application_path
session_cookie_name
	Deprecated in 3.3, use mod_python.session.cookie_name
session_directory
	Deprecated in 3.3, use mod_python.session.session_directory
session_dbm
	Deprecated, use mod_python.dbm_session.database_filename
session_cleanup_time_limit
	Deprecated in 3.3,
	use mod_python.file_session.cleanup_time_limit
session_fast_cleanup
	Deprecated in 3.3,
	use mod_python.file_session.enable_fast_cleanup
session_grace_period
	Deprecated in 3.3,
	use mod_python.file_session.cleanup_grace_period
session_verify_cleanup
	Deprecated in 3.3,
	use mod_python.file_session.cleanup_session_timeout
PSPDbmCache
	Deprecated in 3.3,
	use mod_python.psp.cache_database_filename
---
3.3
---
The req object is checked for a "session" attribute, and if it is found 
it used. If it is created, the req object also gets a reference to it. 
Thus, the session object can be accessed by later processing phases as 
well via req.session.

The req object is checked for a "form" attribute, and if it is found it 
used. If it is created, the req object also gets a reference to it. 
Thus, the form object can be accessed by later processing phases as well 
via req.form.

As mention above, we are introducing a new namespace for PythonOption:

mod_python.psp.cache_database_filename  	  	
mod_python.session.session_type 		
mod_python.session.cookie_name 		
mod_python.session.application_domain 		
mod_python.session.application_path 		
mod_python.session.database_directory 		
mod_python.dbm_session.database_filename 		
mod_python.dbm_session.database_directory 		
mod_python.file_session.enable_fast_cleanup 		
mod_python.file_session.verify_session_timeout 		
mod_python.file_session.cleanup_grace_period 		
mod_python.file_session.cleanup_time_limit 		
mod_python.file_session.database_directory


I'm hoping that I can nudge you in the direction of emphasizing 
mod_python 3.3 in your tutorial since there are a huge number of bug 
fixes and improvements in it - over 100 from 3.2. Although mod_python 
3.1 is still shipped by some linux distributions, it is over 2 years old 
and is getting quite crusty. With any luck we'll have 3.3 ready not long 
after you've completed your tutorial.

I can email you the html docs generated from svn trunk if that would be 
helpful.

  > http://webpython.codepoint.net/mod_python_psp

A couple of comments:

http://webpython.codepoint.net/mod_python_psp_apache_configuration

.htaccess is misspelled in "must not be used inside the .htacces file".

You might want to mention that the security implications of using .psp_. 
Perhaps use the example of making a database connection with the user 
name and password in the psp file. You wouldn't want to use this on a 
publicly facing website. :)

It's nice to see someone creating these tutorials. :) Keep up the good 
work Clodoaldo.

Jim

From wyatt at hackerforhire.org  Sun Nov  5 11:36:55 2006
From: wyatt at hackerforhire.org (Wyatt Neal)
Date: Sun Nov  5 11:36:59 2006
Subject: [mod_python] H-sphere and Mod_python
Message-ID: <000501c700f8$9b143270$7064a8c0@zeroone>

Has anyone been able to get mod_python-2.7.11 to work with h-sphere's apache
1.3.37?  I've been having a devil of a time.  From the logs I can see that
mod_python is actually being loaded.  

>From the httpd.conf:
...
...
#LoadModule scoreboard_send_module libexec/mod_scoreboard_send.so
#LoadModule extract_forwarded_module libexec/mod_extract_forwarded.so
#LoadModule gzip_module        libexec/mod_gzip.so
LoadModule perl_module        libexec/libperl.so
LoadModule python_module      libexec/mod_python.so
...
...
...
#AddModule mod_scoreboard_send.c
#AddModule mod_extract_forwarded.c
#AddModule mod_gzip.c
AddModule mod_perl.c
AddModule mod_python.c

>From the site specific configuration file:

...
<DIRECTORY /hsphere/local/home/htglimit/trac.htglimited.com>
AddHandler python-program .py
OPTIONS  Indexes ExecCGI FollowSymLinks
AllowOverride All
</DIRECTORY>
IndexOptions FancyIndexing

</VirtualHost>

Using the test.py program that looks like this:

from mod_python import apache
def handler(req):
        req.content_type = "text/plain"
        req.send_http_header()
        req.write("Hello World!")
        return apache.OK

Permissions are correct, and yet every time, I get just the text back on the
screen.  Can anyone shed some light on this?

Thanks,

Wyatt

From jpg at jgassociates.ca  Sun Nov  5 12:11:41 2006
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Sun Nov  5 12:05:09 2006
Subject: [mod_python] H-sphere and Mod_python
In-Reply-To: <000501c700f8$9b143270$7064a8c0@zeroone>
References: <000501c700f8$9b143270$7064a8c0@zeroone>
Message-ID: <454E1B4D.8050507@jgassociates.ca>

Wyatt Neal wrote:
> Has anyone been able to get mod_python-2.7.11 to work with h-sphere's apache
> 1.3.37?  I've been having a devil of a time.  From the logs I can see that
> mod_python is actually being loaded.  
> 
>>From the httpd.conf:
> ...
> ...
> #LoadModule scoreboard_send_module libexec/mod_scoreboard_send.so
> #LoadModule extract_forwarded_module libexec/mod_extract_forwarded.so
> #LoadModule gzip_module        libexec/mod_gzip.so
> LoadModule perl_module        libexec/libperl.so
> LoadModule python_module      libexec/mod_python.so
> ...
> ...
> ...
> #AddModule mod_scoreboard_send.c
> #AddModule mod_extract_forwarded.c
> #AddModule mod_gzip.c
> AddModule mod_perl.c
> AddModule mod_python.c
> 
>>From the site specific configuration file:
> 
> ...
> <DIRECTORY /hsphere/local/home/htglimit/trac.htglimited.com>
> AddHandler python-program .py
> OPTIONS  Indexes ExecCGI FollowSymLinks
> AllowOverride All
> </DIRECTORY>
> IndexOptions FancyIndexing
> 
> </VirtualHost>
> 
> Using the test.py program that looks like this:
> 
> from mod_python import apache
> def handler(req):
>         req.content_type = "text/plain"
>         req.send_http_header()
>         req.write("Hello World!")
>         return apache.OK
> 
> Permissions are correct, and yet every time, I get just the text back on the
> screen.  Can anyone shed some light on this?

Looks like you are missing the PythonHandler directive. eg.

AddHandler python-program .py
PythonHandler test

But I wouldn't use test.py as your handler name, as there is test module 
  in the python std library so things may get messed up. Better off with 
mptest.py

Jim



From list at joreybump.com  Sun Nov  5 12:53:15 2006
From: list at joreybump.com (Jorey Bump)
Date: Sun Nov  5 12:53:19 2006
Subject: [mod_python] Re: best practices; was "is mod_python borked?"
In-Reply-To: <E89DA8C8-4F6B-47E2-981E-4216C290D4E0@dscpl.com.au>
References: <1A4BF05172023E468CB6E867923BC90402B6E342@accmail2.sunbelt.org>	<FD8769DF-2A4D-4533-ACB4-7130E2190991@dscpl.com.au>	<eih5mj$9qa$1@sea.gmane.org>
	<E89DA8C8-4F6B-47E2-981E-4216C290D4E0@dscpl.com.au>
Message-ID: <454E250B.6040502@joreybump.com>

Graham Dumpleton wrote:

> For the first, when a request arrives against a physical directory
> and there is no trailing slash on the URL, Apache (unless it is
> disabled), will send a redirect back to the browser forcing it send
> the request again but with a trailing slash added. By doing this, it
> is helping the browser to understand what the effective base URL is
> such that if relative URLs are then used to address other resources 
> within that directory, it will be able to construct the URL properly.
> 
> Thus, if we have a filesystem structure:
> 
> /some/path/directory /some/path/directory/index.html 
> /some/path/directory/file-1.html
> 
> and we pretend that the URL to access it is the same. If a URL
> arrives which is:
> 
> /some/path/directory
> 
> then Apache sends a redirect back to the browser asking it to
> re-request the resource with the URL:
> 
> /some/path/directory/

An interesting side effect of this is how it affects handlers invoked in 
a Location container:

  <Location /virtual>
     SetHandler python-program
     # module must be in PythonPath!
     PythonHandler virtual
     PythonDebug On
  </Location>

If no corresponding directory exists, the handler can be invoked with or 
without a trailing slash:

  http://host/virtual
  http://host/virtual/

But when a matching directory exists, Apache will send a redirect to the 
browser, forcing it to always use:

  http://host/virtual/

This has nothing to do with Publisher, but it shows that factors outside 
of mod_python can also have an influence on relative links.
From scarfboy at gmail.com  Sun Nov  5 13:09:22 2006
From: scarfboy at gmail.com (Bart)
Date: Sun Nov  5 13:09:27 2006
Subject: [mod_python] Unicode convenience functions
Message-ID: <b71082d80611051009i85f26aah12a83e696e1f86ef@mail.gmail.com>

Because m_p was unicode-crippled last time I checked I first wrote
error-prone code, then added a gazillion .encode('utf8')s, then finally
wrote these helper functions and refactored for them.

To me they're a lot more comfortable than bare mod_python behaviour,
particularly since I'm writing something that occasionally needs to
handle unicode both for input and output, so I'm posting this in case
this is useful to someone else.

It uses UTF8, period. It should perhaps be configurable, set on the
req object and have utf8 merely as a default, but even hardcoded
it's fairly sane since aside from utf16 and perhaps gb18030 nothing
actually encodes even nearly enough codepoints to be considered
a practical encoding for unicode-as-in-*unicode*.



The major thing here is wrapping req.write with a filtering function.
On the hander side of things this means you add one line
and can forget the trouble existed:

def utf8write(req,s):
    """ Outputs str type()s unchanged, unicode as UTF8.
        The thing that gets returned from u8writer and you should
assign to your req.write.
        Currently str()s anything not a string, which is probably a
little too dynamic
        and not real feature, but useful for debugging your apps. """
       #raise TypeError('req.write only takes strings')
    if type(s)==str:
        req.oldwrite(s)
    elif type(s)==unicode:
        req.oldwrite(s.encode('utf8'))
    else:
        req.oldwrite( str(s) )
        #a stricter version would probably raise a ValueError

def utf8writer(req,mime='text/html;charset=utf-8'):
   """ You can use this to replace req.write with a unicode-capable
writer (using utf8).
       Use by putting the following in the handler before any writing:
         req.write = utils.utf8writer(req)
       Sets content_type to HTML using charset utf-8 (note the dash!).
       If you want something else, use e.g.
         req.write = utils.utf8writer(req,mime='text/plain;charset=utf-8')
       Since utf8 is currently hardcoded, you always need that charset bit.
   """
   req.content_type=mime #note this is only here to keep this a single
line in your code
   req.oldwrite=req.write #keep reference to the actual writer around
   return lambda s: utf8write(req,s)



Because I'm bad and py.xml is misdesigned (string based rather than
object based, which bites one in the arse in this sort of case),
I write my html as strings and so need functions for url encoding,
basically drop-in replacements for urllib.quote and urllib.urlencode.

def utf8quote(s):
    """ Returns string as url-encoded UTF8 bytes (that is,
urllib.quote(s.encode('utf8')) ) """
    return urllib.quote(s.encode('utf8'))

def utf8dictquote(d,joinOn='&amp;'):
    """ Acts like urllib.urlencode (url encode for dict) but encodes
vars and val as utf8 """
    parts=[]
    for var in d:
        val=d[var]
        if type(var) != unicode:
            var=unicode(var)
        if type(val) != unicode:
            val=unicode(val)
        parts.append( '%s=%s'%(utf8quote(var), utf8quote(val)) )
    return joinOn.join(parts)



And, because I like to be robust to input and some browsers may still send
form values in the outdated but once standard latin1.
Actually, the reason I did this is not so much forms, but the fact
that characters
added to the browser's location bar got encoded as latin1 way even when the
page (and possibly browser) default clearly wasn't.

def getfirst_unicode(form,var,ifAbsent=None):
    """ like form.getfirst(), and decodes utf8 (tries latin1 if that fails).
        Returns what you pass it in ifAbsent if there is no such
variable in the form *OR* if it didn't decode nicely.
        (ifAbsent is None by default, but making it u'' or 0 may be
convenient for you) """
    s=form.getfirst(var)
    if s==None:
        return ifAbsent
    s=utf8_or_latin1_to_unicode(s)
    if s==None:
        return ifAbsent
    return s

the ifAbsent allows me to handle absence of parameters quickly:
  r = getfirst_unicode(form,'regular')
  i = int(getfirst_unicode(form,'amount',0))
  s = getfirst_unicode(form,'strrring',u'') #, etc.

The integer case thing would otherwise be something like:
  i = form.getfirst(var)
  if i==None:
     i=0
  i=int(i)
...and I got tired of typing about five cases like that whenever I
wanted to be robust to bad users.



The utf8-or-latin1 function mentioned is failry trivial:

def utf8_or_latin1_to_unicode(s):
    """ Tries to decode a string as utf8 first, then as Latin1 (iso8859-1).
        Returns None if both fail."""
    try:
        return s.decode('utf8')
    except UnicodeDecodeError:
        try:
            return s.decode('latin1')
        except UnicodeDecodeError: #I believe this *is* technically possible
            return None
An alternative is replacing all high bytes, but you probably don't want that to
happen without being told, so you get to do that yourself...



Comments are welcome.
It's possible I broke some code, I was editing it in the gmail composer:)

Cheers,
--Bart Alewijnse
From clodoaldo.pinto at gmail.com  Sun Nov  5 14:14:26 2006
From: clodoaldo.pinto at gmail.com (Clodoaldo Pinto Neto)
Date: Sun Nov  5 14:14:30 2006
Subject: [mod_python] PSP global variables
In-Reply-To: <454E0FCB.30500@jgassociates.ca>
References: <a595de7a0611050603l62f92e68kb4f02fd25991b894@mail.gmail.com>
	<454E0FCB.30500@jgassociates.ca>
Message-ID: <a595de7a0611051114q700f4a79ge1dfa3d238ed3f44@mail.gmail.com>

2006/11/5, Jim Gallacher <jpg@jgassociates.ca>:
> Clodoaldo Pinto Neto wrote:
> > I'm building a PSP tutorial and can't find in the mod_python manual
> > any references to the global variables req, form and session as in
> > this article:
> >
> > http://www.onlamp.com/pub/a/python/2004/02/26/python_server_pages.html
> >
> > Are they unsupported features?
>
> Completely supported, but poorly documented.

Well, now the situation is definitely better ;) Thanks for the
datailed answer. I will start digesting it now.

> I'm hoping that I can nudge you in the direction of emphasizing
> mod_python 3.3 in your tutorial since there are a huge number of bug
> fixes and improvements in it - over 100 from 3.2. Although mod_python
> 3.1 is still shipped by some linux distributions, it is over 2 years old
> and is getting quite crusty. With any luck we'll have 3.3 ready not long
> after you've completed your tutorial.

If what you mean by "emphasizing mod_python 3.3" is to incentive
people to migrate to it, then i can do it. But if what you mean is
making it a 3.3 only tutorial then i don't know if it is a good move.
You know, in many environments changes are avoided and 3.1 is the only
choice.

> I can email you the html docs generated from svn trunk if that would be
> helpful.

That would be nice.

> A couple of comments:
>
> http://webpython.codepoint.net/mod_python_psp_apache_configuration
>
> .htaccess is misspelled in "must not be used inside the .htacces file".

It is corrected now.

> You might want to mention that the security implications of using .psp_.
> Perhaps use the example of making a database connection with the user
> name and password in the psp file. You wouldn't want to use this on a
> publicly facing website. :)

Ok. I will do it.

Regards, Clodoaldo Pinto Neto
From mail at cryptronic.de  Sun Nov  5 15:06:23 2006
From: mail at cryptronic.de (Cryptronic)
Date: Sun Nov  5 14:49:35 2006
Subject: [mod_python] mod_python only returns 404 error's
Message-ID: <200611052106.24071.mail@cryptronic.de>

Hi all,

i tried to use mod_python, installation from .deb works fine.

I'm running following configuration:
Apache/2.2.3 (Debian) mod_python/3.2.10 Python/2.4.4c0

then i tried to following skript:

?from mod_python import apache

?def handler(req):
? ? ?req.content_type = "text/plain"
? ? ?req.write("Hello World! Blarg!")
? ? ?return apache.OK


with rights: 755 owned by the suexec user

with the following vhost config:

? ? ? AddHandler python-program .py
? ? ? PythonHandler mod_python.publisher
? ? ? PythonDebug On

when i open the url in browser errlog shows me:
[notice] mod_python: (Re)importing module 'mod_python.publisher'
[notice] [client] Publisher loading page /var/www/test/test2.py

But i got in the browser only a 404 page - ?no error's ?in log - nothing :(

best regards

oliver werner

From jpg at jgassociates.ca  Sun Nov  5 14:59:02 2006
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Sun Nov  5 14:51:14 2006
Subject: [mod_python] PSP global variables
In-Reply-To: <a595de7a0611051114q700f4a79ge1dfa3d238ed3f44@mail.gmail.com>
References: <a595de7a0611050603l62f92e68kb4f02fd25991b894@mail.gmail.com>	<454E0FCB.30500@jgassociates.ca>
	<a595de7a0611051114q700f4a79ge1dfa3d238ed3f44@mail.gmail.com>
Message-ID: <454E4286.6050007@jgassociates.ca>

Clodoaldo Pinto Neto wrote:
> 2006/11/5, Jim Gallacher <jpg@jgassociates.ca>:
>> Clodoaldo Pinto Neto wrote:
>> > I'm building a PSP tutorial and can't find in the mod_python manual
>> > any references to the global variables req, form and session as in
>> > this article:
>> >
>> > http://www.onlamp.com/pub/a/python/2004/02/26/python_server_pages.html
>> >
>> > Are they unsupported features?
>>
>> Completely supported, but poorly documented.
> 
> Well, now the situation is definitely better ;) Thanks for the
> datailed answer. I will start digesting it now.
> 
>> I'm hoping that I can nudge you in the direction of emphasizing
>> mod_python 3.3 in your tutorial since there are a huge number of bug
>> fixes and improvements in it - over 100 from 3.2. Although mod_python
>> 3.1 is still shipped by some linux distributions, it is over 2 years old
>> and is getting quite crusty. With any luck we'll have 3.3 ready not long
>> after you've completed your tutorial.
> 
> If what you mean by "emphasizing mod_python 3.3" is to incentive
> people to migrate to it, then i can do it. But if what you mean is
> making it a 3.3 only tutorial then i don't know if it is a good move.
> You know, in many environments changes are avoided and 3.1 is the only
> choice.

Oh I know and for that reason I wouldn't make it exclusively about 3.3. 
For PSP the basics are going to be the same for all of the 3.x versions 
anyway, so it should not have a huge impact on the content of your 
tutorial. I don't know how extensive you plan to make it, but so far 
there is nothing that is version dependent.

The things that are different in 3.3 are there to address deficiencies 
in 3.1 or 3.2. Things like session locking will be a little less 
painless in 3.3 because of the way the session object is shared around 
as req.session. But again, if you don't plan on delving into more 
advanced topics the version does not matter.

My biggest concern is if you plan to use PythonOption to control the 
session behaviour. For that I'd use 3.3 as as the basis first, with a 
note explaining the PythonOption keywords are different in 3.2, and of 
course non-existent in 3.1.

I'm more than happy to review your tutorial, and I'm sure others on this 
list will do the same, so feel free to keep the list up to date on your 
work.

Jim
From jpg at jgassociates.ca  Sun Nov  5 15:26:06 2006
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Sun Nov  5 15:18:05 2006
Subject: [mod_python] mod_python only returns 404 error's
In-Reply-To: <200611052106.24071.mail@cryptronic.de>
References: <200611052106.24071.mail@cryptronic.de>
Message-ID: <454E48DE.3060406@jgassociates.ca>

Cryptronic wrote:
> Hi all,
> 
> i tried to use mod_python, installation from .deb works fine.
> 
> I'm running following configuration:
> Apache/2.2.3 (Debian) mod_python/3.2.10 Python/2.4.4c0
> 
> then i tried to following skript:
> 
>  from mod_python import apache
> 
>  def handler(req):
>      req.content_type = "text/plain"
>      req.write("Hello World! Blarg!")
>      return apache.OK
> 
> 
> with rights: 755 owned by the suexec user
> 
> with the following vhost config:
> 
>       AddHandler python-program .py
>       PythonHandler mod_python.publisher
>       PythonDebug On
> 
> when i open the url in browser errlog shows me:
> [notice] mod_python: (Re)importing module 'mod_python.publisher'
> [notice] [client] Publisher loading page /var/www/test/test2.py
> 
> But i got in the browser only a 404 page -  no error's  in log - nothing :(

Your test2.py file is something you might use if you were writing your 
own handler. Publisher is a little different. It first looks for the 
index method. Try this (Notice :

def index(req):
     req.content_type = "text/plain"
     return "Hello World! Blarg!"


You can also do something like this:

def index(req):
     req.content_type = "text/plain"
     req.write("Hello World! Blarg!")

Notice that we are *not* returning apache.OK. Publisher looks after this 
for you.

You can also publish other methods in your file:

def foo(req):
     return "This is foo"

and fetch it with http://localhost/test/test2.py/foo

Jim

From list at joreybump.com  Sun Nov  5 15:23:10 2006
From: list at joreybump.com (Jorey Bump)
Date: Sun Nov  5 15:23:14 2006
Subject: [mod_python] mod_python only returns 404 error's
In-Reply-To: <200611052106.24071.mail@cryptronic.de>
References: <200611052106.24071.mail@cryptronic.de>
Message-ID: <454E482E.1040705@joreybump.com>

Cryptronic wrote:
> Hi all,
> 
> i tried to use mod_python, installation from .deb works fine.
> 
> I'm running following configuration:
> Apache/2.2.3 (Debian) mod_python/3.2.10 Python/2.4.4c0
> 
> then i tried to following skript:
> 
>  from mod_python import apache
> 
>  def handler(req):
>      req.content_type = "text/plain"
>      req.write("Hello World! Blarg!")
>      return apache.OK
> 
> 
> with rights: 755 owned by the suexec user
> 
> with the following vhost config:
> 
>       AddHandler python-program .py
>       PythonHandler mod_python.publisher
>       PythonDebug On
> 
> when i open the url in browser errlog shows me:
> [notice] mod_python: (Re)importing module 'mod_python.publisher'
> [notice] [client] Publisher loading page /var/www/test/test2.py
> 
> But i got in the browser only a 404 page -  no error's  in log - nothing :(

You are not using Publisher correctly. Create a file named hello.py:

def bruce(req):
     return "Hello, Bruce!"

Now point your browser at the *function* in the module:

http://host/hello.py/bruce


From mail at cryptronic.de  Sun Nov  5 15:57:37 2006
From: mail at cryptronic.de (Cryptronic)
Date: Sun Nov  5 15:40:43 2006
Subject: [mod_python] mod_python only returns 404 error's
In-Reply-To: <454E48DE.3060406@jgassociates.ca>
References: <200611052106.24071.mail@cryptronic.de>
	<454E48DE.3060406@jgassociates.ca>
Message-ID: <200611052157.37738.mail@cryptronic.de>

Hi

thank you very much for this quick help.
All works fine. The problem was, that this was not for me but for a customer 
and I haven't even tried using python for myself so I doens't know how to 
create a testscript.

best regards

Oliver Werner

Am Sonntag, 5. November 2006 21:26 schrieben Sie:
> Cryptronic wrote:
> > Hi all,
> >
> > i tried to use mod_python, installation from .deb works fine.
> >
> > I'm running following configuration:
> > Apache/2.2.3 (Debian) mod_python/3.2.10 Python/2.4.4c0
> >
> > then i tried to following skript:
> >
> >  from mod_python import apache
> >
> >  def handler(req):
> >      req.content_type = "text/plain"
> >      req.write("Hello World! Blarg!")
> >      return apache.OK
> >
> >
> > with rights: 755 owned by the suexec user
> >
> > with the following vhost config:
> >
> >       AddHandler python-program .py
> >       PythonHandler mod_python.publisher
> >       PythonDebug On
> >
> > when i open the url in browser errlog shows me:
> > [notice] mod_python: (Re)importing module 'mod_python.publisher'
> > [notice] [client] Publisher loading page /var/www/test/test2.py
> >
> > But i got in the browser only a 404 page -  no error's  in log - nothing
> > :(
>
> Your test2.py file is something you might use if you were writing your
> own handler. Publisher is a little different. It first looks for the
> index method. Try this (Notice :
>
> def index(req):
>      req.content_type = "text/plain"
>      return "Hello World! Blarg!"
>
>
> You can also do something like this:
>
> def index(req):
>      req.content_type = "text/plain"
>      req.write("Hello World! Blarg!")
>
> Notice that we are *not* returning apache.OK. Publisher looks after this
> for you.
>
> You can also publish other methods in your file:
>
> def foo(req):
>      return "This is foo"
>
> and fetch it with http://localhost/test/test2.py/foo
>
> Jim

-- 
Mit freundlichen Gr??en

O. Werner

From grahamd at dscpl.com.au  Sun Nov  5 16:13:39 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Sun Nov  5 16:13:45 2006
Subject: [mod_python] PSP global variables
Message-ID: <1162761219.534@dscpl.user.openhosting.com>

Jim Gallacher wrote ..
> You might want to mention that the security implications of using .psp_.
> Perhaps use the example of making a database connection with the user 
> name and password in the psp file. You wouldn't want to use this on a 
> publicly facing website. :)

What one can do for .psp_ files is use:

  <Files *.psp_>
  deny from all
  allow from localhost
  </Files>

In other words, restrict access to requests from localhost, or some other
appropriate site.

Unfortunately there isn't any way (that I know of), of specifying using just
Apache configuration directives, that 'PythonDebug On' apply only to a
specific client site. What one can do though is use a transhandler(), if in
main configuration, or some later handler if in directory context and have:

  def transhandler(req):
    if req.connection. remote_ip in ['...']:
      req.get_config()['PythonDebug'] = '1'
    else:
      req.get_config()['PythonDebug'] = '0'
    return apache.DECLINED

In some respects a later handler might be better as you can possibly
override anything set in the Apache configuration to force such a policy.
Users could still override you again, in their own handler, but makes
them do one extra non obvious step.

One could even get quite tricky and require the presence of a special
cookie in the request, with the only way of getting the cookie being to
have logged into some special page of your web site and have it enabled.

Graham
From clodoaldo.pinto at gmail.com  Sun Nov  5 17:53:50 2006
From: clodoaldo.pinto at gmail.com (Clodoaldo Pinto Neto)
Date: Sun Nov  5 17:53:55 2006
Subject: [mod_python] PSP global variables
In-Reply-To: <454E0FCB.30500@jgassociates.ca>
References: <a595de7a0611050603l62f92e68kb4f02fd25991b894@mail.gmail.com>
	<454E0FCB.30500@jgassociates.ca>
Message-ID: <a595de7a0611051453x4f00d3a3w8b94a8d3cd0fbd40@mail.gmail.com>

2006/11/5, Jim Gallacher <jpg@jgassociates.ca>:

> You might want to mention that the security implications of using .psp_.
> Perhaps use the example of making a database connection with the user
> name and password in the psp file. You wouldn't want to use this on a
> publicly facing website. :)

There is now a db connection sample code illustrating the danger of .psp_

http://webpython.codepoint.net/mod_python_psp_debugging

Regards, Clodoaldo Pinto Neto
From clodoaldo.pinto at gmail.com  Sun Nov  5 18:09:53 2006
From: clodoaldo.pinto at gmail.com (Clodoaldo Pinto Neto)
Date: Sun Nov  5 18:09:58 2006
Subject: [mod_python] PSP global variables
In-Reply-To: <1162761219.534@dscpl.user.openhosting.com>
References: <1162761219.534@dscpl.user.openhosting.com>
Message-ID: <a595de7a0611051509x51f926a2yb9cd3ff88888d47b@mail.gmail.com>

2006/11/5, Graham Dumpleton <grahamd@dscpl.com.au>:
> Jim Gallacher wrote ..
> > You might want to mention that the security implications of using .psp_.
> > Perhaps use the example of making a database connection with the user
> > name and password in the psp file. You wouldn't want to use this on a
> > publicly facing website. :)
>
> What one can do for .psp_ files is use:
>
>   <Files *.psp_>
>   deny from all
>   allow from localhost
>   </Files>
>
> In other words, restrict access to requests from localhost, or some other
> appropriate site.

I added this nice and simple tip to the tutorial

> Unfortunately there isn't any way (that I know of), of specifying using just
> Apache configuration directives, that 'PythonDebug On' apply only to a
> specific client site. What one can do though is use a transhandler(), if in
> main configuration, or some later handler if in directory context and have:
>
>   def transhandler(req):
>     if req.connection. remote_ip in ['...']:
>       req.get_config()['PythonDebug'] = '1'
>     else:
>       req.get_config()['PythonDebug'] = '0'
>     return apache.DECLINED
>
> In some respects a later handler might be better as you can possibly
> override anything set in the Apache configuration to force such a policy.
> Users could still override you again, in their own handler, but makes
> them do one extra non obvious step.
>
> One could even get quite tricky and require the presence of a special
> cookie in the request, with the only way of getting the cookie being to
> have logged into some special page of your web site and have it enabled.

This is quite instructive. I don't know if you are suggesting to
include it in the tutorial. I fear that if i mention a transhandler in
a PSP tutorial the reader will flee in terror to never look back.

Regards, Clodoaldo Pinto Neto
From grahamd at dscpl.com.au  Sun Nov  5 18:18:43 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Sun Nov  5 18:18:57 2006
Subject: [mod_python] PSP global variables
Message-ID: <1162768723.25676@dscpl.user.openhosting.com>

Clodoaldo Pinto Neto wrote ..
> 2006/11/5, Graham Dumpleton <grahamd@dscpl.com.au>:
> > Unfortunately there isn't any way (that I know of), of specifying using
> just
> > Apache configuration directives, that 'PythonDebug On' apply only to
> a
> > specific client site. What one can do though is use a transhandler(),
> if in
> > main configuration, or some later handler if in directory context and
> have:
> >
> >   def transhandler(req):
> >     if req.connection. remote_ip in ['...']:
> >       req.get_config()['PythonDebug'] = '1'
> >     else:
> >       req.get_config()['PythonDebug'] = '0'
> >     return apache.DECLINED
> >
> > In some respects a later handler might be better as you can possibly
> > override anything set in the Apache configuration to force such a policy.
> > Users could still override you again, in their own handler, but makes
> > them do one extra non obvious step.
> >
> > One could even get quite tricky and require the presence of a special
> > cookie in the request, with the only way of getting the cookie being
> to
> > have logged into some special page of your web site and have it enabled.
> 
> This is quite instructive. I don't know if you are suggesting to
> include it in the tutorial. I fear that if i mention a transhandler in
> a PSP tutorial the reader will flee in terror to never look back.

Only mentioned it for the benefit of others who have used mod_python for
a while. Definitely should not be in a beginners tutorial.

Graham
From fred at adventistcare.org  Sun Nov  5 20:51:52 2006
From: fred at adventistcare.org (Sells, Fred)
Date: Sun Nov  5 20:43:09 2006
Subject: [mod_python] 3.3 release plans
Message-ID: <1A4BF05172023E468CB6E867923BC90402B6E345@accmail2.sunbelt.org>

our company's philosophy is that if it can't be installed with "apt-get" we
don't install it.  If I'm going to propose building mod_python, I would like
to only fight that battle once, for 3.3.

Is there a rough estimate on 3.3 release schedule?  even an approximate
"window" would help.

---------------------------------------------------------------------------
The information contained in this message may be privileged and / or
confidential and protected from disclosure. If the reader of this message is
not the intended recipient, you are hereby notified that any dissemination,
distribution or copying of this communication is strictly prohibited. If you
have received this communication in error, please notify the sender
immediately by replying to this message and deleting the material from any
computer.
---------------------------------------------------------------------------

From durumdara at gmail.com  Mon Nov  6 05:06:09 2006
From: durumdara at gmail.com (durumdara)
Date: Mon Nov  6 05:07:06 2006
Subject: [mod_python] Interesting PSP error...
In-Reply-To: <454BB118.4020508@jgassociates.ca>
References: <454B50AF.9010904@gmail.com> <454BB118.4020508@jgassociates.ca>
Message-ID: <454F0911.1050406@gmail.com>

Skipped content of type multipart/alternative-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20061106/746ef258/test2-0001.html
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20061106/746ef258/test_wrong-0001.html
-------------- next part --------------
print("""""",0);
if 1:
 	    #import mailtools
 	    def SendMail(From, To, Subj, Body, Server, SmtpUsr, SmtpPwd):
 	        pass
 	    Body = "aaa"
 	    # aaa
 	    SendMail("xxxxxxxx.xxxxx@xx.xxxxxx.xxx",
 	        ["xxxx@xxxxxxxxx.org"],
	        "xxxxxxxxxxxxxxxxxxx", Body,
 	        Server="xxxxxxxxx.org",
 	        SmtpUsr = "xxxxxxxxxxxxxx@xxxxxxxxx.org",
 	        SmtpPwd = "xxxxxxxxxxxx")
 	    a = 1
 	    print("""
 	""",0)
From durumdara at gmail.com  Mon Nov  6 05:06:37 2006
From: durumdara at gmail.com (durumdara)
Date: Mon Nov  6 05:07:07 2006
Subject: [mod_python] Interesting PSP error...
In-Reply-To: <454BB118.4020508@jgassociates.ca>
References: <454B50AF.9010904@gmail.com> <454BB118.4020508@jgassociates.ca>
Message-ID: <454F092D.8070209@gmail.com>

Skipped content of type multipart/alternative-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20061106/badfe5a7/test_wrong.html
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20061106/badfe5a7/test.html
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20061106/badfe5a7/test_good.html
From grahamd at dscpl.com.au  Mon Nov  6 05:39:54 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Mon Nov  6 05:40:19 2006
Subject: [mod_python] Interesting PSP error...
In-Reply-To: <454F092D.8070209@gmail.com>
References: <454B50AF.9010904@gmail.com> <454BB118.4020508@jgassociates.ca>
	<454F092D.8070209@gmail.com>
Message-ID: <BFDB039B-DAFF-4B29-9490-496DDFFB0326@dscpl.com.au>


On 06/11/2006, at 9:06 PM, durumdara wrote:
> So I don't understand it.
> Don't understand, because in another module a shorted version of  
> this SendMail call is working good !
>
> I think this error is generated by wrong PSP compiler, but I don't  
> understand, why it not handle the multiline commands.
>
> And the important infos: Apache/2.2.3 (Win32) mod_python/3.2.10  
> Python/2.4.3.

Short answer is that it appears to work in mod_python 3.3, at least  
on MacOSX.
Thus, it is either an issue with 3.2.10, or an issue with Win32  
platform.

Any chance you can try mod_python 3.3 source out of subversion  
repository,
or try it on a Linux platform?

I don't know if it is related in some way to:

     \item
       (\citetitle[http://issues.apache.org/jira/browse/MODPYTHON-168] 
{MODPYTHON-168})
       Fixed psp_parser error when CR is used as a line terminator in  
psp code.
       This may occur with some older editors such as GoLive on Mac  
OS X.

That is the only PSP change in 3.3 that I can see might be relevant.

Graham


From jpg at jgassociates.ca  Mon Nov  6 08:46:12 2006
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Mon Nov  6 08:46:09 2006
Subject: [mod_python] 3.3 release plans
In-Reply-To: <1A4BF05172023E468CB6E867923BC90402B6E345@accmail2.sunbelt.org>
References: <1A4BF05172023E468CB6E867923BC90402B6E345@accmail2.sunbelt.org>
Message-ID: <454F3CA4.3090100@jgassociates.ca>

Sells, Fred wrote:
> our company's philosophy is that if it can't be installed with "apt-get" we
> don't install it.  If I'm going to propose building mod_python, I would like
> to only fight that battle once, for 3.3.
> 
> Is there a rough estimate on 3.3 release schedule?  even an approximate
> "window" would help.

With luck we'll be in a beta testing round within a week. I think what 
we have is pretty solid, so hopefully the testing round won't turn up 
any disasters. This is a pretty major release in terms of the number of 
bugs fixed and new features though, so we'd like to have testing on as 
many platforms as possible.

Here is what I'm hoping:

This week: Snapshot for initial testing - just to make sure we haven't 
done anything really stupid. We also need a couple of days to flesh out 
some documentation on the new importer, and finish a couple of minor 
issues that should be fixed for this release.

Next week: First 3.3 beta

Mid to Late November: Additional betas if required.

End of November - early December: 3.3 Final

So, we are very close. The initial beta releases are not generally 
announced on this list. If anyone is interested in helping with the 
testing and is not subscribed to the developers list, drop me a note and 
I'll keep you in the loop. Testing consists of compiling the tarball, 
running the unit tests (but not on your production machine) and 
reporting back the results.

Jim



From ygutfreund at draper.com  Mon Nov  6 11:22:17 2006
From: ygutfreund at draper.com (Gutfreund, Yechezkal)
Date: Mon Nov  6 11:22:28 2006
Subject: [mod_python] Error: Cannot load mod_python module
Message-ID: <98B94F0758D7394CA057AE4898CBC85E01EC8F95@exchbk1.draper.com>

I am a long-time (25+ years) distributed system (and OS) programmer, but
a newbie at mod_python and apache.
 
I believed I followed the install procedures. I added:
 
1. put the following line in httpd.conf
     LoadModule python_module modules/mod_python.so
 
2. created the /tmp director for the mutex's
 
3. added the <directory> section and put the mptest.py file in the test
directory
 
    <Directory /some/directory/htdocs/test> 
        AddHandler mod_python .py
        PythonHandler mptest 
        PythonDebug On 
    </Directory>
 
4. Installed ActiveState Python Version 2.4 python24.dll and mod_python
3.2.8 (and told it where Apache 2.2.3 (win) is located
 
5. All of this is on an XP Pro SP 2 machine
 
6. I still get the following ERROR:
 
The Apache service named reported the following error:

>>> httpd.exe: Syntax error on line 98 of C:/Program Files/Apache
Software Foundation/Apache2.2/conf/httpd.conf: Cannot load C:/Program
Files/Apache Software Foundation/Apache2.2/modules/mod_python.so into
server: The specified procedure could not be found. .

 

I verified that the mod_python.so is indeed in this directory, and I
also tried moving python24.dll to the /bin directory of apache. But that
was the only relevant fixes I could see in the blogs, newsgroups, etc.

 

So I am posting here, to see if anyone has had similar problems.

 

 

 
Dr. Yechezkal Gutfreund
Draper Laboratory
555 Technology Square
Cambridge, MA 02139
 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20061106/5853e895/attachment.html
From fred at adventistcare.org  Mon Nov  6 15:16:43 2006
From: fred at adventistcare.org (Sells, Fred)
Date: Mon Nov  6 15:07:51 2006
Subject: [mod_python] how to set environment for shell
Message-ID: <1A4BF05172023E468CB6E867923BC90402B6E34B@accmail2.sunbelt.org>

Note that I use Apache 2.x and python 2.3 and mod_python 3.1.3 on  linux.
Upgrading mod_python is possible if required.

I need to run fop.sh as a shell command.  It needs the environment variable
JAVA_HOME.  When I run fop.sh from the command line all is good,  when I run
the same command using os.popen("..../fop.sh ......") the JAVA_HOME
environment variable is not defined.

I even tried os.putenv("JAVA_HOME", '/usr/java/java') and it was still
undefined in the fop.sh.

Can someone point me in the right direction, so far I'm just going in
circles.

---------------------------------------------------------------------------
The information contained in this message may be privileged and / or
confidential and protected from disclosure. If the reader of this message is
not the intended recipient, you are hereby notified that any dissemination,
distribution or copying of this communication is strictly prohibited. If you
have received this communication in error, please notify the sender
immediately by replying to this message and deleting the material from any
computer.
---------------------------------------------------------------------------

From brunson at brunson.com  Mon Nov  6 15:37:34 2006
From: brunson at brunson.com (Eric Brunson)
Date: Mon Nov  6 15:37:39 2006
Subject: [mod_python] how to set environment for shell
In-Reply-To: <1A4BF05172023E468CB6E867923BC90402B6E34B@accmail2.sunbelt.org>
References: <1A4BF05172023E468CB6E867923BC90402B6E34B@accmail2.sunbelt.org>
Message-ID: <454F9D0E.50703@brunson.com>

Sells, Fred wrote:
> Note that I use Apache 2.x and python 2.3 and mod_python 3.1.3 on  linux.
> Upgrading mod_python is possible if required.
>
> I need to run fop.sh as a shell command.  It needs the environment variable
> JAVA_HOME.  When I run fop.sh from the command line all is good,  when I run
> the same command using os.popen("..../fop.sh ......") the JAVA_HOME
> environment variable is not defined.
>
> I even tried os.putenv("JAVA_HOME", '/usr/java/java') and it was still
> undefined in the fop.sh.
>
> Can someone point me in the right direction, so far I'm just going in
> circles.
>   

http://httpd.apache.org/docs/2.0/mod/mod_env.html

> ---------------------------------------------------------------------------
> The information contained in this message may be privileged and / or
> confidential and protected from disclosure. If the reader of this message is
> not the intended recipient, you are hereby notified that any dissemination,
> distribution or copying of this communication is strictly prohibited. If you
> have received this communication in error, please notify the sender
> immediately by replying to this message and deleting the material from any
> computer.
> ---------------------------------------------------------------------------
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>   

From jpg at jgassociates.ca  Mon Nov  6 16:05:08 2006
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Mon Nov  6 16:05:08 2006
Subject: [mod_python] Error: Cannot load mod_python module
In-Reply-To: <98B94F0758D7394CA057AE4898CBC85E01EC8F95@exchbk1.draper.com>
References: <98B94F0758D7394CA057AE4898CBC85E01EC8F95@exchbk1.draper.com>
Message-ID: <454FA384.1040209@jgassociates.ca>

mod_python 3.2.8 doesn't support Apache 2.2. You need mod_python 3.2.10:

http://www.apache.org/dist/httpd/modpython/win/3.2.10/

Jim

Gutfreund, Yechezkal wrote:
> I am a long-time (25+ years) distributed system (and OS) programmer, but
> a newbie at mod_python and apache.
>  
> I believed I followed the install procedures. I added:
>  
> 1. put the following line in httpd.conf
>      LoadModule python_module modules/mod_python.so
>  
> 2. created the /tmp director for the mutex's
>  
> 3. added the <directory> section and put the mptest.py file in the test
> directory
>  
>     <Directory /some/directory/htdocs/test> 
>         AddHandler mod_python .py
>         PythonHandler mptest 
>         PythonDebug On 
>     </Directory>
>  
> 4. Installed ActiveState Python Version 2.4 python24.dll and mod_python
> 3.2.8 (and told it where Apache 2.2.3 (win) is located
>  
> 5. All of this is on an XP Pro SP 2 machine
>  
> 6. I still get the following ERROR:
>  
> The Apache service named reported the following error:
> 
>>>> httpd.exe: Syntax error on line 98 of C:/Program Files/Apache
> Software Foundation/Apache2.2/conf/httpd.conf: Cannot load C:/Program
> Files/Apache Software Foundation/Apache2.2/modules/mod_python.so into
> server: The specified procedure could not be found. .
> 
>  
> 
> I verified that the mod_python.so is indeed in this directory, and I
> also tried moving python24.dll to the /bin directory of apache. But that
> was the only relevant fixes I could see in the blogs, newsgroups, etc.
> 
>  
> 
> So I am posting here, to see if anyone has had similar problems.
> 
>  
> 
>  
> 
>  
> Dr. Yechezkal Gutfreund
> Draper Laboratory
> 555 Technology Square
> Cambridge, MA 02139
>  
> 
> 
> 
> ------------------------------------------------------------------------
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python

From deron.meranda at gmail.com  Mon Nov  6 16:08:22 2006
From: deron.meranda at gmail.com (Deron Meranda)
Date: Mon Nov  6 16:08:27 2006
Subject: [mod_python] how to set environment for shell
In-Reply-To: <1A4BF05172023E468CB6E867923BC90402B6E34B@accmail2.sunbelt.org>
References: <1A4BF05172023E468CB6E867923BC90402B6E34B@accmail2.sunbelt.org>
Message-ID: <5c06fa770611061308u2e7e7356le439c515594a4607@mail.gmail.com>

On 11/6/06, Sells, Fred <fred@adventistcare.org> wrote:
> I need to run fop.sh as a shell command.  It needs the environment variable
> JAVA_HOME.  When I run fop.sh from the command line all is good,  when I run
> the same command using os.popen("..../fop.sh ......") the JAVA_HOME
> environment variable is not defined.

You can also just set environment variables inside the shell script
itself and not even mess with Apache or mod_python.  If you can't
modify that shell script, create a different wrapper shell script.

  #!/bin/sh
  JAVA_HOME=xxxxx
  export JAVA_HOME
  exec fop.sh

-- 
Deron Meranda
From nhytro-python at web.de  Mon Nov  6 16:25:44 2006
From: nhytro-python at web.de (nhytro-python@web.de)
Date: Mon Nov  6 16:25:51 2006
Subject: [mod_python] Installing on W2K
Message-ID: <1108339220@web.de>

Hi guys, I&#180;m sure you might start groaning again about another newbie with the same "install" problems, I apologize beforehand :-)

I have actually scoured the archives and googled, I found useful information but none that can help me further.

My configuration:

Windows 2000 professional
XAMPP (http://www.apachefriends.org/en/xampp.html)
ActivePython (ActivePython-2.4.3.12-win32-x86.msi)
Mod_python(mod_python-3.2.10.win32-py2.4-apache2.2.exe)

I modified http.conf with thesde statements:

LoadModule python_module modules/mod_python.so
<Directory />
    Options FollowSymLinks
    AllowOverride None
    Order deny,allow
    Deny from all
</Directory>


<Directory /python> 
        AddHandler mod_python .py
        PythonHandler mptest 
        PythonDebug On 
 </Directory>

<Location /mpinfo>
      SetHandler mod_python
      PythonHandler mod_python.testhandler
 </Location>

I can call http://localhost/mpinfo, it works but http://localhost/python/mptest produces a "404, object not found error" but the file is there!! If I call http://localhost/python/mptest.py, the Server returns the source code of the mptest.py.

I took a look at the Apache error logs:

[Mon Nov 06 22:25:10 2006] [notice] mod_python: Creating 8 session mutexes based on 0 max processes and 250 max threads.
[Mon Nov 06 22:25:11 2006] [notice] Apache/2.2.3 (Win32) DAV/2 mod_ssl/2.2.3 OpenSSL/0.9.8d mod_python/3.2.10 Python/2.4.3 mod_autoindex_color PHP/5.1.6 configured -- resuming normal operations
[Mon Nov 06 22:25:11 2006] [notice] Server built: Sep 30 2006 21:24:06
[Mon Nov 06 22:25:11 2006] [notice] Parent: Created child process 1160
[Mon Nov 06 22:25:13 2006] [notice] mod_python: Creating 8 session mutexes based on 0 max processes and 250 max threads.
[Mon Nov 06 22:25:14 2006] [notice] Child 1160: Child process is running
[Mon Nov 06 22:25:14 2006] [notice] Child 1160: Acquired the start mutex.
[Mon Nov 06 22:25:14 2006] [notice] Child 1160: Starting 250 worker threads.
[Mon Nov 06 22:25:14 2006] [notice] Child 1160: Starting thread to listen on port 443.
[Mon Nov 06 22:25:14 2006] [notice] Child 1160: Starting thread to listen on port 80.
[Mon Nov 06 22:25:28 2006] [error] [client 192.168.2.100] File does not exist: C:/Program Files/xampp/htdocs/python/mptest

This does not really help.

Could someone help me out?

Thanks in advance!


_______________________________________________________________________
Viren-Scan f?r Ihren PC! Jetzt f?r jeden. Sofort, online und kostenlos.
Gleich testen! http://www.pc-sicherheit.web.de/freescan/?mc=022222


From grahamd at dscpl.com.au  Mon Nov  6 16:39:24 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Mon Nov  6 16:39:25 2006
Subject: [mod_python] Installing on W2K
Message-ID: <1162849164.30009@dscpl.user.openhosting.com>

Read:

  http://www.dscpl.com.au/wiki/ModPython/Articles/GettingModPythonWorking

You might need:

<Directory /python>
AllowOverride FileInfo
</Directory>

Graham

nhytro-python@web.de wrote ..
> Hi guys, I&#180;m sure you might start groaning again about another newbie
> with the same "install" problems, I apologize beforehand :-)
> 
> I have actually scoured the archives and googled, I found useful information
> but none that can help me further.
> 
> My configuration:
> 
> Windows 2000 professional
> XAMPP (http://www.apachefriends.org/en/xampp.html)
> ActivePython (ActivePython-2.4.3.12-win32-x86.msi)
> Mod_python(mod_python-3.2.10.win32-py2.4-apache2.2.exe)
> 
> I modified http.conf with thesde statements:
> 
> LoadModule python_module modules/mod_python.so
> <Directory />
>     Options FollowSymLinks
>     AllowOverride None
>     Order deny,allow
>     Deny from all
> </Directory>
> 
> 
> <Directory /python> 
>         AddHandler mod_python .py
>         PythonHandler mptest 
>         PythonDebug On 
>  </Directory>
> 
> <Location /mpinfo>
>       SetHandler mod_python
>       PythonHandler mod_python.testhandler
>  </Location>
> 
> I can call http://localhost/mpinfo, it works but http://localhost/python/mptest
> produces a "404, object not found error" but the file is there!! If I call
> http://localhost/python/mptest.py, the Server returns the source code of
> the mptest.py.
> 
> I took a look at the Apache error logs:
> 
> [Mon Nov 06 22:25:10 2006] [notice] mod_python: Creating 8 session mutexes
> based on 0 max processes and 250 max threads.
> [Mon Nov 06 22:25:11 2006] [notice] Apache/2.2.3 (Win32) DAV/2 mod_ssl/2.2.3
> OpenSSL/0.9.8d mod_python/3.2.10 Python/2.4.3 mod_autoindex_color PHP/5.1.6
> configured -- resuming normal operations
> [Mon Nov 06 22:25:11 2006] [notice] Server built: Sep 30 2006 21:24:06
> [Mon Nov 06 22:25:11 2006] [notice] Parent: Created child process 1160
> [Mon Nov 06 22:25:13 2006] [notice] mod_python: Creating 8 session mutexes
> based on 0 max processes and 250 max threads.
> [Mon Nov 06 22:25:14 2006] [notice] Child 1160: Child process is running
> [Mon Nov 06 22:25:14 2006] [notice] Child 1160: Acquired the start mutex.
> [Mon Nov 06 22:25:14 2006] [notice] Child 1160: Starting 250 worker threads.
> [Mon Nov 06 22:25:14 2006] [notice] Child 1160: Starting thread to listen
> on port 443.
> [Mon Nov 06 22:25:14 2006] [notice] Child 1160: Starting thread to listen
> on port 80.
> [Mon Nov 06 22:25:28 2006] [error] [client 192.168.2.100] File does not
> exist: C:/Program Files/xampp/htdocs/python/mptest
> 
> This does not really help.
> 
> Could someone help me out?
> 
> Thanks in advance!
> 
> 
> _______________________________________________________________________
> Viren-Scan f?r Ihren PC! Jetzt f?r jeden. Sofort, online und kostenlos.
> Gleich testen! http://www.pc-sicherheit.web.de/freescan/?mc=022222
> 
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
From grahamd at dscpl.com.au  Mon Nov  6 16:43:02 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Mon Nov  6 16:43:04 2006
Subject: [mod_python] Installing on W2K
Message-ID: <1162849382.31603@dscpl.user.openhosting.com>

Ignore my suggestion about FileInfo. That should only be required if you are
using .htaccess file.

All the same, read that article as something in it may help, although I can't
think what just now.

Graham

nhytro-python@web.de wrote ..
> Hi guys, I&#180;m sure you might start groaning again about another newbie
> with the same "install" problems, I apologize beforehand :-)
> 
> I have actually scoured the archives and googled, I found useful information
> but none that can help me further.
> 
> My configuration:
> 
> Windows 2000 professional
> XAMPP (http://www.apachefriends.org/en/xampp.html)
> ActivePython (ActivePython-2.4.3.12-win32-x86.msi)
> Mod_python(mod_python-3.2.10.win32-py2.4-apache2.2.exe)
> 
> I modified http.conf with thesde statements:
> 
> LoadModule python_module modules/mod_python.so
> <Directory />
>     Options FollowSymLinks
>     AllowOverride None
>     Order deny,allow
>     Deny from all
> </Directory>
> 
> 
> <Directory /python> 
>         AddHandler mod_python .py
>         PythonHandler mptest 
>         PythonDebug On 
>  </Directory>
> 
> <Location /mpinfo>
>       SetHandler mod_python
>       PythonHandler mod_python.testhandler
>  </Location>
> 
> I can call http://localhost/mpinfo, it works but http://localhost/python/mptest
> produces a "404, object not found error" but the file is there!! If I call
> http://localhost/python/mptest.py, the Server returns the source code of
> the mptest.py.
> 
> I took a look at the Apache error logs:
> 
> [Mon Nov 06 22:25:10 2006] [notice] mod_python: Creating 8 session mutexes
> based on 0 max processes and 250 max threads.
> [Mon Nov 06 22:25:11 2006] [notice] Apache/2.2.3 (Win32) DAV/2 mod_ssl/2.2.3
> OpenSSL/0.9.8d mod_python/3.2.10 Python/2.4.3 mod_autoindex_color PHP/5.1.6
> configured -- resuming normal operations
> [Mon Nov 06 22:25:11 2006] [notice] Server built: Sep 30 2006 21:24:06
> [Mon Nov 06 22:25:11 2006] [notice] Parent: Created child process 1160
> [Mon Nov 06 22:25:13 2006] [notice] mod_python: Creating 8 session mutexes
> based on 0 max processes and 250 max threads.
> [Mon Nov 06 22:25:14 2006] [notice] Child 1160: Child process is running
> [Mon Nov 06 22:25:14 2006] [notice] Child 1160: Acquired the start mutex.
> [Mon Nov 06 22:25:14 2006] [notice] Child 1160: Starting 250 worker threads.
> [Mon Nov 06 22:25:14 2006] [notice] Child 1160: Starting thread to listen
> on port 443.
> [Mon Nov 06 22:25:14 2006] [notice] Child 1160: Starting thread to listen
> on port 80.
> [Mon Nov 06 22:25:28 2006] [error] [client 192.168.2.100] File does not
> exist: C:/Program Files/xampp/htdocs/python/mptest
> 
> This does not really help.
> 
> Could someone help me out?
> 
> Thanks in advance!
> 
> 
> _______________________________________________________________________
> Viren-Scan f?r Ihren PC! Jetzt f?r jeden. Sofort, online und kostenlos.
> Gleich testen! http://www.pc-sicherheit.web.de/freescan/?mc=022222
> 
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
From jpg at jgassociates.ca  Mon Nov  6 18:06:12 2006
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Mon Nov  6 18:05:15 2006
Subject: [mod_python] Installing on W2K
In-Reply-To: <1108339220@web.de>
References: <1108339220@web.de>
Message-ID: <454FBFE4.8040501@jgassociates.ca>

nhytro-python@web.de wrote:
> Hi guys, I&#180;m sure you might start groaning again about another newbie with the same "install" problems, I apologize beforehand :-)
> 
> I have actually scoured the archives and googled, I found useful information but none that can help me further.
> 
> My configuration:
> 
> Windows 2000 professional
> XAMPP (http://www.apachefriends.org/en/xampp.html)
> ActivePython (ActivePython-2.4.3.12-win32-x86.msi)
> Mod_python(mod_python-3.2.10.win32-py2.4-apache2.2.exe)
> 
> I modified http.conf with thesde statements:
> 
> LoadModule python_module modules/mod_python.so
> <Directory />
>     Options FollowSymLinks
>     AllowOverride None
>     Order deny,allow
>     Deny from all
> </Directory>
> 
> 
> <Directory /python>
              ^^^^^^^

Are you sure about that? Is the directory C:/python? It should be the 
full path to the directory you want handled, possibly
	C:/Program Files/xampp/htdocs/python

>         AddHandler mod_python .py
>         PythonHandler mptest 
>         PythonDebug On 
>  </Directory>
> 
> <Location /mpinfo>
>       SetHandler mod_python
>       PythonHandler mod_python.testhandler
>  </Location>
> 
> I can call http://localhost/mpinfo, it works but http://localhost/python/mptest produces a "404, object not found error" but the file is there!! If I call http://localhost/python/mptest.py, the Server returns the source code of the mptest.py.

Jim
From nlv11281 at natlab.research.philips.com  Tue Nov  7 05:12:05 2006
From: nlv11281 at natlab.research.philips.com (Mike Looijmans)
Date: Tue Nov  7 05:12:19 2006
Subject: [mod_python] Syntax highlighter for psp ?
In-Reply-To: <454B56B3.4090004@gmail.com>
References: <454B56B3.4090004@gmail.com>
Message-ID: <45505BF5.1010605@natlab.research.philips.com>

I use PSPAD (freeware Windows editor).

Explained it that PSP files are "HTML" and they use Python internally, can be set easily from the 
config.

Works like a charm.

--
Mike Looijmans
Philips Natlab / Topic Automation


durumdara wrote:
> I use Context and PyScripter for python and HTML editing.
> Does anyone know about an editor that can handle psp syntax highlights ?

From durumdara at gmail.com  Tue Nov  7 05:40:03 2006
From: durumdara at gmail.com (durumdara)
Date: Tue Nov  7 05:40:07 2006
Subject: [mod_python] Syntax highlighter for psp ?
In-Reply-To: <45505BF5.1010605@natlab.research.philips.com>
References: <454B56B3.4090004@gmail.com>
	<45505BF5.1010605@natlab.research.philips.com>
Message-ID: <45506283.7050605@gmail.com>

Hi !

I tryed yesterday but I don't found good config for it.
But I found Crimson Editor and I set up PSP like PHP.

It seems to be good. JEdit is to slow for me, and it not have Project 
(collection of files).
Context is not supports multihighlighting.

Thanks for your help, if you have a config file for PSPad, send me. I 
wait for that.

dd

Mike Looijmans wrote:
> I use PSPAD (freeware Windows editor).
>
> Explained it that PSP files are "HTML" and they use Python internally, 
> can be set easily from the config.
>
> Works like a charm.
>
> -- 
> Mike Looijmans
> Philips Natlab / Topic Automation
>
>
> durumdara wrote:
>> I use Context and PyScripter for python and HTML editing.
>> Does anyone know about an editor that can handle psp syntax highlights ?
>
>

-------------- next part --------------
A non-text attachment was scrubbed...
Name: python-psp.spc
Type: application/x-pkcs7-certificates
Size: 563 bytes
Desc: not available
Url : http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20061107/8300a7ec/python-psp.bin
-------------- next part --------------
[-COMMENT-:GLOBAL]
# PYTHON LANGUAGE KEYWORDS FILE FOR CRIMSON EDITOR
# FIRST EDITED BY Geert van Boven (g.vanboven@dignion.com or gvb@vbit.nl) 26 sept. 2001

[KEYWORDS0:RANGE1]
# ===== program flow control =====
break
continue
elif else
for from
if import
pass
reload return
while

# ===== built in functions and other reserved words =====
abs and apply assert
buffer
callable chr class cmp coerce compile complex
def del delattr dir divmod
eval exec execfile
filter float
getattr global globals
hasattr hash hex
id in input int intern is isinstance issubclass
lambda len list locals long
map max min
not
oct open or ord
pow print
range raw_input reduce repr round
setattr slice str
tuple type
unichr unicode
vars
xrange
zip

# ===== exception handling =====
except
finally
raise
try

[KEYWORDS1:GLOBAL]

[KEYWORDS2:GLOBAL]

[KEYWORDS3:GLOBAL]

[KEYWORDS4:GLOBAL]

[KEYWORDS5:GLOBAL]

[KEYWORDS6:GLOBAL]

[KEYWORDS7:GLOBAL]

[KEYWORDS8:GLOBAL]

[KEYWORDS9:GLOBAL]

[KEYWORDS5:!R1&R2]
###################
## HTML ELEMENTS ##
###################
a abbr above acronym address applet array area
b base basefont bgsound bdo big blink blockquote body box br button
caption center cite code col colgroup comment
dd del dfn dir div dl doctype dt em embed fieldset fig font form frame frameset
h h1 h2 h3 h4 h5 h6 head hr hta html i iframe img input ins isindex
kbd label legend li link listing  map marquee menu meta multicol
nextid nobr noframes noscript note ol optgroup option p param plaintext pre q range root
s samp script select small sound spacer span sqrt style strike strong style sub sup
table tbody td text textarea textflow tfoot th thead title tr tt
u ul var wbr xmp

[KEYWORDS6:!R1&R2]
#####################
## HTML ATTRIBUTES ##
#####################
abbr accept accesskey action align alink alt applicationname archive axis
background behavior below bgcolor bgproperties border bordercolor bordercolordark bordercolorlight borderstyle
caption cellpadding cellspacing char charoff charset checked cite class classid clear code codebase codetype
color cols colspan compact content coords
data datetime declare defer dir direction disabled dynsrc
enctype equiv face for frame frameborder framespacing
gutter headers height href hreflang hspace http icon id ismap
label language leftmargin link longdesc loop lowsrc
marginheight marginwidth maximizebutton maxlength media method methods minimizebutton multiple
name nohref noresize noshade nowrap
object onabort onblur onchange onclick ondblclick onfocus onkeydown onkeypress onkeyup onload onmousedown
onmousemove onmouseout onmouseover onmouseup onreset onselect onsubmit onunload profile prompt
readonly rel rev rows rowspan rules runat
scheme scope scrollamount scrolldelay scrolling selected shape showintaskbar singleinstance
size span src standby start style summary sysmenu
tabindex target text title topmargin type url urn usemap
valign value valuetype version vlink vrml vspace
width windowstate wrap

[KEYWORDS7:!R1&R2]
####################
## HTML CONSTANTS ##
####################
white black red green blue yellow magenta orange purple
top bottom middle left right center
_blank hidden public

[KEYWORDS8:!RNGE1]
##################
## HTML ENTITIY ##
##################
&aacute &agrave &acirc &amp &atilde &aring &auml &aelig
&ccedil &copy &eacute &egrave &ecirc &euml
&iacute &igrave &icirc &iuml &eth &gt &lt &nbsp &ntilde
&oacute &ograve &ocirc &otilde &ouml &oslash &quot
&reg &szlig &uacute &ugrave &ucirc &uuml
&yacute &thorn &trade &yuml
From durumdara at gmail.com  Tue Nov  7 05:47:57 2006
From: durumdara at gmail.com (durumdara)
Date: Tue Nov  7 05:48:03 2006
Subject: [mod_python] ModPython archive problems...
Message-ID: <4550645D.9000408@gmail.com>

Hi !

I cannot access modpython archive from the link that modpython mails 
provided:

http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/

This caused that I cannot access the files attached to archived mails 
(they are accessible by links).

Any solution ?

dd
From grahamd at dscpl.com.au  Tue Nov  7 05:53:02 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Tue Nov  7 05:53:20 2006
Subject: [mod_python] ModPython archive problems...
In-Reply-To: <4550645D.9000408@gmail.com>
References: <4550645D.9000408@gmail.com>
Message-ID: <9A97F823-0011-44A5-BC91-0D0ED41FC160@dscpl.com.au>


On 07/11/2006, at 9:47 PM, durumdara wrote:

> Hi !
>
> I cannot access modpython archive from the link that modpython  
> mails provided:
>
> http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/ 
> mod_python/
>
> This caused that I cannot access the files attached to archived  
> mails (they are accessible by links).
>
> Any solution ?

Replace 'mm_cfg_has_not_been_edited_to_set_host_domains' in the URL
with 'www.modpython.org'.

Graham
From durumdara at gmail.com  Tue Nov  7 05:56:33 2006
From: durumdara at gmail.com (durumdara)
Date: Tue Nov  7 05:56:38 2006
Subject: [mod_python] Interesting PSP error...
In-Reply-To: <BFDB039B-DAFF-4B29-9490-496DDFFB0326@dscpl.com.au>
References: <454B50AF.9010904@gmail.com> <454BB118.4020508@jgassociates.ca>
	<454F092D.8070209@gmail.com>
	<BFDB039B-DAFF-4B29-9490-496DDFFB0326@dscpl.com.au>
Message-ID: <45506661.8080703@gmail.com>

Hi !

Sorry-sorry-sorry !!!

This error is not psp error. This is python error. I found the problem !
The editor options changed mistifically by update process (refresh 
editor software version), and then it use REAL TAB-s.
Before that I use 4 SPACES, not TABS.
That caused the problem. You see, when you use Context to view the 
attached files and make the special characters visible in editor.

Sorry !

dd

Graham Dumpleton wrote:
>
> Short answer is that it appears to work in mod_python 3.3, at least on 
> MacOSX.
> Thus, it is either an issue with 3.2.10, or an issue with Win32 platform.
>
> I don't know if it is related in some way to:
>
>     \item
>       
> (\citetitle[http://issues.apache.org/jira/browse/MODPYTHON-168]{MODPYTHON-168}) 
>
>       Fixed psp_parser error when CR is used as a line terminator in 
> psp code.
>       This may occur with some older editors such as GoLive on Mac OS X.
>
> That is the only PSP change in 3.3 that I can see might be relevant.
>
> Graham
>
>
>

From gregor.kling at dvz.fh-giessen.de  Tue Nov  7 06:14:45 2006
From: gregor.kling at dvz.fh-giessen.de (Gregor Kling)
Date: Tue Nov  7 06:15:14 2006
Subject: [mod_python] publisher cgi
Message-ID: <45506AA5.5040205@dvz.fh-giessen.de>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Hello,

With a short glimpse at mod_python's publisher default handler, I
assume I have to use 'raw' cgi's, if i have variable form data ?
The form should have the possibility to let a user adding fields before
submit the form.
So I can't use the neat feature of using functions for form handling as
the examples provided by mod_python.


- --
Gregor Kling

DV-Zentrum
Fachhochschule Giessen
Tel: 0641/309-1292
E-Mail: gregor.kling@dvz.fh-giessen.de
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.5 (GNU/Linux)

iD8DBQFFUGqlJFHWQ694uCYRAgtKAJ4ndEgEww/OAr52H0Cee5Y+nYxGJwCeJr7z
DRkx8kUyoOVwcOuPyq9K/MI=
=+8f0
-----END PGP SIGNATURE-----
From sdavis2 at mail.nih.gov  Tue Nov  7 06:40:48 2006
From: sdavis2 at mail.nih.gov (Sean Davis)
Date: Tue Nov  7 06:40:52 2006
Subject: [mod_python] publisher cgi
In-Reply-To: <45506AA5.5040205@dvz.fh-giessen.de>
References: <45506AA5.5040205@dvz.fh-giessen.de>
Message-ID: <200611070640.48858.sdavis2@mail.nih.gov>

On Tuesday 07 November 2006 06:14, Gregor Kling wrote:
> Hello,
>
> With a short glimpse at mod_python's publisher default handler, I
> assume I have to use 'raw' cgi's, if i have variable form data ?
> The form should have the possibility to let a user adding fields before
> submit the form.
> So I can't use the neat feature of using functions for form handling as
> the examples provided by mod_python.

You CAN use javascript to add fields before submitting the form.  That will 
work fine under CGI or mod_python.

Sean
From gregor.kling at dvz.fh-giessen.de  Tue Nov  7 07:31:28 2006
From: gregor.kling at dvz.fh-giessen.de (Gregor Kling)
Date: Tue Nov  7 07:31:57 2006
Subject: [mod_python] publisher cgi
In-Reply-To: <200611070640.48858.sdavis2@mail.nih.gov>
References: <45506AA5.5040205@dvz.fh-giessen.de>
	<200611070640.48858.sdavis2@mail.nih.gov>
Message-ID: <45507CA0.3080808@dvz.fh-giessen.de>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1


> You CAN use javascript to add fields before submitting the form.  That will 
> work fine under CGI or mod_python.
> 
Hm. Sure I can add it with JavaScript.
But as i understand mod_publisher, there is a mapping between form data
and paramaters in the equivalent method.
So with adding several fields with JavaScript I have to add functions
with a variable list of paramters, respectively for every probable
combination of arguments a specific method ....
- --
Gregor Kling

DV-Zentrum
Fachhochschule Giessen
Tel: 0641/309-1292
E-Mail: gregor.kling@dvz.fh-giessen.de
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.5 (GNU/Linux)

iD8DBQFFUHygJFHWQ694uCYRAhP9AJwNrwPAIIKalyHmoxjkvH/lulbkMwCeL9Kd
t5iKGjhI0j8aztiL2zMWmb8=
=SunL
-----END PGP SIGNATURE-----
From jpg at jgassociates.ca  Tue Nov  7 08:00:28 2006
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Tue Nov  7 08:00:31 2006
Subject: [mod_python] publisher cgi
In-Reply-To: <45506AA5.5040205@dvz.fh-giessen.de>
References: <45506AA5.5040205@dvz.fh-giessen.de>
Message-ID: <4550836C.1020900@jgassociates.ca>

Gregor Kling wrote:
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
> 
> Hello,
> 
> With a short glimpse at mod_python's publisher default handler, I
> assume I have to use 'raw' cgi's, if i have variable form data ?
> The form should have the possibility to let a user adding fields before
> submit the form.
> So I can't use the neat feature of using functions for form handling as
> the examples provided by mod_python.

Unless I'm misunderstanding your meaning, I can't see why you can't use 
publisher. Your form data will be available as an attribute of the 
request object. eg. req.form

Jim

From sdavis2 at mail.nih.gov  Tue Nov  7 08:01:16 2006
From: sdavis2 at mail.nih.gov (Sean Davis)
Date: Tue Nov  7 08:01:33 2006
Subject: [mod_python] publisher cgi
In-Reply-To: <45507CA0.3080808@dvz.fh-giessen.de>
References: <45506AA5.5040205@dvz.fh-giessen.de>
	<200611070640.48858.sdavis2@mail.nih.gov>
	<45507CA0.3080808@dvz.fh-giessen.de>
Message-ID: <200611070801.16799.sdavis2@mail.nih.gov>

On Tuesday 07 November 2006 07:31, Gregor Kling wrote:
> > You CAN use javascript to add fields before submitting the form.  That
> > will work fine under CGI or mod_python.
>
> Hm. Sure I can add it with JavaScript.
> But as i understand mod_publisher, there is a mapping between form data
> and paramaters in the equivalent method.
> So with adding several fields with JavaScript I have to add functions
> with a variable list of paramters, respectively for every probable
> combination of arguments a specific method ....

If I understand you correctly, this message from the archives might answer 
your question directly:

http://www.modpython.org/pipermail/mod_python/2005-August/018794.html

Sean
From gregor.kling at dvz.fh-giessen.de  Tue Nov  7 08:37:35 2006
From: gregor.kling at dvz.fh-giessen.de (Gregor Kling)
Date: Tue Nov  7 08:38:10 2006
Subject: [mod_python] publisher cgi
In-Reply-To: <4550836C.1020900@jgassociates.ca>
References: <45506AA5.5040205@dvz.fh-giessen.de>
	<4550836C.1020900@jgassociates.ca>
Message-ID: <45508C1F.4070007@dvz.fh-giessen.de>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

> Unless I'm misunderstanding your meaning, I can't see why you can't use
> publisher. Your form data will be available as an attribute of the
> request object. eg. req.form
I do not find more documentation what is accessible through the request
object req.
I only found the methods in
http://www.modpython.org/live/current/doc-html/pyapi-mprequest-meth.html.

In http://www.modpython.org/pipermail/mod_python/2005-May/018210.html
I found
def buy_fromstore(req,**params):
     for name in params.keys():
       req.log_error(str((name,params[name])))
but I would appreciate it to find more sustained documentation,what i
didn't right now.


- --
Gregor Kling

DV-Zentrum
Fachhochschule Giessen
Tel: 0641/309-1292
E-Mail: gregor.kling@dvz.fh-giessen.de
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.5 (GNU/Linux)

iD8DBQFFUIwfJFHWQ694uCYRAi4HAJ4uxhbTex6nEduSuzkqwilA6HdBogCeJMEa
HEUVVJMsS3re0qNiIO/jaek=
=Gpuc
-----END PGP SIGNATURE-----
From clodoaldo.pinto at gmail.com  Tue Nov  7 08:54:08 2006
From: clodoaldo.pinto at gmail.com (Clodoaldo Pinto Neto)
Date: Tue Nov  7 08:54:14 2006
Subject: [mod_python] publisher cgi
In-Reply-To: <45508C1F.4070007@dvz.fh-giessen.de>
References: <45506AA5.5040205@dvz.fh-giessen.de>
	<4550836C.1020900@jgassociates.ca>
	<45508C1F.4070007@dvz.fh-giessen.de>
Message-ID: <a595de7a0611070554q39c831fved47ecce527fbde2@mail.gmail.com>

2006/11/7, Gregor Kling <gregor.kling@dvz.fh-giessen.de>:
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>
> > Unless I'm misunderstanding your meaning, I can't see why you can't use
> > publisher. Your form data will be available as an attribute of the
> > request object. eg. req.form
> I do not find more documentation what is accessible through the request
> object req.
> I only found the methods in
> http://www.modpython.org/live/current/doc-html/pyapi-mprequest-meth.html.
>
> In http://www.modpython.org/pipermail/mod_python/2005-May/018210.html
> I found
> def buy_fromstore(req,**params):
>      for name in params.keys():
>        req.log_error(str((name,params[name])))
> but I would appreciate it to find more sustained documentation,what i
> didn't right now.

Look in the FieldStorage class documentation:

http://modpython.org/live/current/doc-html/pyapi-util-fstor.html

Regards, Clodoaldo Pinto Neto
From gregor.kling at dvz.fh-giessen.de  Tue Nov  7 09:02:04 2006
From: gregor.kling at dvz.fh-giessen.de (Gregor Kling)
Date: Tue Nov  7 09:02:33 2006
Subject: [mod_python] publisher cgi
In-Reply-To: <a595de7a0611070554q39c831fved47ecce527fbde2@mail.gmail.com>
References: <45506AA5.5040205@dvz.fh-giessen.de>	
	<4550836C.1020900@jgassociates.ca>	
	<45508C1F.4070007@dvz.fh-giessen.de>
	<a595de7a0611070554q39c831fved47ecce527fbde2@mail.gmail.com>
Message-ID: <455091DC.2080200@dvz.fh-giessen.de>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Clodoaldo Pinto Neto wrote:
> 2006/11/7, Gregor Kling <gregor.kling@dvz.fh-giessen.de>:
>> -----BEGIN PGP SIGNED MESSAGE-----
>> Hash: SHA1
>>
>> > Unless I'm misunderstanding your meaning, I can't see why you can't use
>> > publisher. Your form data will be available as an attribute of the
>> > request object. eg. req.form
>> I do not find more documentation what is accessible through the request
>> object req.
>> I only found the methods in
>> http://www.modpython.org/live/current/doc-html/pyapi-mprequest-meth.html.
>>
>> In http://www.modpython.org/pipermail/mod_python/2005-May/018210.html
>> I found
>> def buy_fromstore(req,**params):
>>      for name in params.keys():
>>        req.log_error(str((name,params[name])))
>> but I would appreciate it to find more sustained documentation,what i
>> didn't right now.
> 
> Look in the FieldStorage class documentation:
> 
> http://modpython.org/live/current/doc-html/pyapi-util-fstor.html
Oh, yes thanks.
> 
> Regards, Clodoaldo Pinto Neto


- --
Gregor Kling

DV-Zentrum
Fachhochschule Giessen
Tel: 0641/309-1292
E-Mail: gregor.kling@dvz.fh-giessen.de
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.5 (GNU/Linux)

iD8DBQFFUJHcJFHWQ694uCYRAvb2AJ9EYo1rqjcywhkX3jWKOo3D7FnmygCfTLoJ
puJOHrcSbHt7wpKlTfAd2CY=
=b6QR
-----END PGP SIGNATURE-----
From list at joreybump.com  Tue Nov  7 09:31:11 2006
From: list at joreybump.com (Jorey Bump)
Date: Tue Nov  7 09:31:22 2006
Subject: [mod_python] publisher cgi
In-Reply-To: <45507CA0.3080808@dvz.fh-giessen.de>
References: <45506AA5.5040205@dvz.fh-giessen.de>	<200611070640.48858.sdavis2@mail.nih.gov>
	<45507CA0.3080808@dvz.fh-giessen.de>
Message-ID: <455098AF.6070208@joreybump.com>

Gregor Kling wrote:

>> You CAN use javascript to add fields before submitting the form.  That will 
>> work fine under CGI or mod_python.
>>
> Hm. Sure I can add it with JavaScript.
> But as i understand mod_publisher, there is a mapping between form data
> and paramaters in the equivalent method.
> So with adding several fields with JavaScript I have to add functions
> with a variable list of paramters, respectively for every probable
> combination of arguments a specific method ....

The automatic mapping of form data can useful in a simple, strictly 
controlled environment, but it's much better to use the standardized 
interface of the dictionary-like object req.form, as Jim suggests. This 
allows you to do simple, safe operations like:

for key in req.form.keys():
     do_stuff_with_key(key)

or:

if req.form.has_key('foo'):
     do_foo(req)

Note that req.form is *dictionary-like* and may still undergo changes to 
  make it behave more like a real dictionary. Try to use a recent 
version of mod_python to reduce incompatibilities.

Letting users name fields that are directly converted to top-level 
objects could cause severe namespace collisions, so don't even attempt 
that route.
From fred at adventistcare.org  Tue Nov  7 10:12:35 2006
From: fred at adventistcare.org (Sells, Fred)
Date: Tue Nov  7 10:03:49 2006
Subject: [mod_python] installing xp problems
Message-ID: <1A4BF05172023E468CB6E867923BC90402B6E352@accmail2.sunbelt.org>

running apache 2.2, python 2.3 and got the mod_python 3.2.8 msi for
python2.3 from modpython site.

install process did not generate any errors.
mod_python.so is in the modules directory
adding the following line just after all the other LoadModule statements in
../conf/httpd.conf

LoadModule mod_python modules/mod_python.so

generated the following error.

[warn] (OS 995)The I/O operation has been aborted because of either a thread
exit or an application request.  : winnt_accept: Asynchronous AcceptEx
failed.

I'm totally lost at this point.  It should be noted that i also have
python24 on this system, but I watched the install and everything seemed to
go to 2.3.  I also notice that if I put a xxx.py somewhere under .../htdocs
the url actually runs.  I'm confused.

---------------------------------------------------------------------------
The information contained in this message may be privileged and / or
confidential and protected from disclosure. If the reader of this message is
not the intended recipient, you are hereby notified that any dissemination,
distribution or copying of this communication is strictly prohibited. If you
have received this communication in error, please notify the sender
immediately by replying to this message and deleting the material from any
computer.
---------------------------------------------------------------------------

From brunson at brunson.com  Tue Nov  7 11:33:58 2006
From: brunson at brunson.com (Eric Brunson)
Date: Tue Nov  7 11:34:02 2006
Subject: [mod_python] Syntax highlighter for psp ?
In-Reply-To: <454B56B3.4090004@gmail.com>
References: <454B56B3.4090004@gmail.com>
Message-ID: <4550B576.9090702@brunson.com>

Emacs with HTML/Python/MMM Mode.  MMM allows you to have multiple modes 
mixed withing a buffer.

durumdara wrote:
> Hi !
>
> I use Context and PyScripter for python and HTML editing.
> Does anyone know about an editor that can handle psp syntax highlights ?
>
> Thanks for help:
> dd
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python

From grahamd at dscpl.com.au  Tue Nov  7 15:30:44 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Tue Nov  7 15:30:53 2006
Subject: [mod_python] installing xp problems
In-Reply-To: <1A4BF05172023E468CB6E867923BC90402B6E352@accmail2.sunbelt.org>
References: <1A4BF05172023E468CB6E867923BC90402B6E352@accmail2.sunbelt.org>
Message-ID: <F0CAEAC3-1107-40CA-9B32-4B870C6A228C@dscpl.com.au>

Apache 2.2 requires mod_python 3.2.10.

On 08/11/2006, at 2:12 AM, Sells, Fred wrote:

> running apache 2.2, python 2.3 and got the mod_python 3.2.8 msi for
> python2.3 from modpython site.
>
> install process did not generate any errors.
> mod_python.so is in the modules directory
> adding the following line just after all the other LoadModule  
> statements in
> ../conf/httpd.conf
>
> LoadModule mod_python modules/mod_python.so
>
> generated the following error.
>
> [warn] (OS 995)The I/O operation has been aborted because of either  
> a thread
> exit or an application request.  : winnt_accept: Asynchronous AcceptEx
> failed.
>
> I'm totally lost at this point.  It should be noted that i also have
> python24 on this system, but I watched the install and everything  
> seemed to
> go to 2.3.  I also notice that if I put a xxx.py somewhere  
> under .../htdocs
> the url actually runs.  I'm confused.
>
> ---------------------------------------------------------------------- 
> -----
> The information contained in this message may be privileged and / or
> confidential and protected from disclosure. If the reader of this  
> message is
> not the intended recipient, you are hereby notified that any  
> dissemination,
> distribution or copying of this communication is strictly  
> prohibited. If you
> have received this communication in error, please notify the sender
> immediately by replying to this message and deleting the material  
> from any
> computer.
> ---------------------------------------------------------------------- 
> -----
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
From grahamd at dscpl.com.au  Tue Nov  7 15:39:22 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Tue Nov  7 15:39:28 2006
Subject: [mod_python] publisher cgi
In-Reply-To: <45506AA5.5040205@dvz.fh-giessen.de>
References: <45506AA5.5040205@dvz.fh-giessen.de>
Message-ID: <D7E5C001-FDD9-4038-80EF-A94D25A23C8E@dscpl.com.au>


On 07/11/2006, at 10:14 PM, Gregor Kling wrote:

> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>
> Hello,
>
> With a short glimpse at mod_python's publisher default handler, I
> assume I have to use 'raw' cgi's, if i have variable form data ?

To clarify one point. The publisher extension handler for mod_python
is not the default handler. Instead it builds on top of the basic  
handler
mechanism of mod_python. How you use publisher is different to
basic handlers in mod_python.

I point out the difference as too often people don't understand they
are different and mistakenly starting trying to return Apache status
codes as the result of a published function when they shouldn't. When
using publisher, the result of the function should be the data you
want to appear as content in the response. If it isn't a string, it will
be converted to one and then used as the content.

Thus, a basic handler:

   def handler(req): # No ability to have form fields as arguments.
     ...
     return apache.OK # Return Apache status code.

And publisher:

   def index(arg1, arg2): # Name of function used in URL, and form
     # fields mapped automatically to the function arguments. Use of
     # request argument as first argument is optional.
     ...
     return 'page content'

Graham
From steve at holdenweb.com  Tue Nov  7 16:07:56 2006
From: steve at holdenweb.com (Steve Holden)
Date: Tue Nov  7 16:07:55 2006
Subject: [mod_python] Re: installing xp problems
In-Reply-To: <F0CAEAC3-1107-40CA-9B32-4B870C6A228C@dscpl.com.au>
References: <1A4BF05172023E468CB6E867923BC90402B6E352@accmail2.sunbelt.org>
	<F0CAEAC3-1107-40CA-9B32-4B870C6A228C@dscpl.com.au>
Message-ID: <eiqsh5$20d$1@sea.gmane.org>

Graham Dumpleton wrote:
> Apache 2.2 requires mod_python 3.2.10.
> 
Hmm. I just discovered that I can run Apache 2,0 and 2.2 on the same 
(XP) machine. Unfortunately it seems that I can only run one mod_python 
using any given version of Python: in other words, I can't have 
mod_python available for both Apaches simultaneously unless they are 
using different Python interpreters. Correct?

regards
  Steve
-- 
Steve Holden       +44 150 684 7255  +1 800 494 3119
Holden Web LLC/Ltd          http://www.holdenweb.com
Skype: holdenweb       http://holdenweb.blogspot.com
Recent Ramblings     http://del.icio.us/steve.holden

From grahamd at dscpl.com.au  Tue Nov  7 16:18:29 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Tue Nov  7 16:18:38 2006
Subject: [mod_python] Re: installing xp problems
In-Reply-To: <eiqsh5$20d$1@sea.gmane.org>
References: <1A4BF05172023E468CB6E867923BC90402B6E352@accmail2.sunbelt.org>
	<F0CAEAC3-1107-40CA-9B32-4B870C6A228C@dscpl.com.au>
	<eiqsh5$20d$1@sea.gmane.org>
Message-ID: <C42D8653-9317-4A4A-BB9E-8984ECD6C499@dscpl.com.au>


On 08/11/2006, at 8:07 AM, Steve Holden wrote:

> Graham Dumpleton wrote:
>> Apache 2.2 requires mod_python 3.2.10.
> Hmm. I just discovered that I can run Apache 2,0 and 2.2 on the  
> same (XP) machine. Unfortunately it seems that I can only run one  
> mod_python using any given version of Python: in other words, I  
> can't have mod_python available for both Apaches simultaneously  
> unless they are using different Python interpreters. Correct?

Since the _apache module in mod_python is bound to the different
internals of each version of Apache at compile time, then yes, they
would need to be distinct.

I have speculated at one point whether we should allow somehow
the ability to extend/modify the PYTHONPATH in the Apache configuration
prior to mod_python being being initialised so that one could in the
Apache configuration specify extra directories to look.

In your case this would allow you to install one set of Python code
files for one version of Python, but put the _apache and PSP compiled
modules in separate directories based on Apache version and have
each version of Apache only look in the directory for their version.

This feature may also be useful in other cases as well where people
find Python looking in the wrong spot.

Graham
From grahamd at dscpl.com.au  Tue Nov  7 16:23:24 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Tue Nov  7 16:23:29 2006
Subject: [mod_python] Re: installing xp problems
In-Reply-To: <C42D8653-9317-4A4A-BB9E-8984ECD6C499@dscpl.com.au>
References: <1A4BF05172023E468CB6E867923BC90402B6E352@accmail2.sunbelt.org>
	<F0CAEAC3-1107-40CA-9B32-4B870C6A228C@dscpl.com.au>
	<eiqsh5$20d$1@sea.gmane.org>
	<C42D8653-9317-4A4A-BB9E-8984ECD6C499@dscpl.com.au>
Message-ID: <94D22709-C4D2-476C-83D7-6FCCC3F8EAF9@dscpl.com.au>

Hmmm, actually, I am talking nonsense, as the _apache module
is embeded within the Apachh mod_python module and isn't in
the Python installation. Only _psp.so is in the Python installation
and that shouldn't be Apache specific.

Thus, can't think know why there might be an issue. What actually
happens?

On 08/11/2006, at 8:18 AM, Graham Dumpleton wrote:

>
> On 08/11/2006, at 8:07 AM, Steve Holden wrote:
>
>> Graham Dumpleton wrote:
>>> Apache 2.2 requires mod_python 3.2.10.
>> Hmm. I just discovered that I can run Apache 2,0 and 2.2 on the  
>> same (XP) machine. Unfortunately it seems that I can only run one  
>> mod_python using any given version of Python: in other words, I  
>> can't have mod_python available for both Apaches simultaneously  
>> unless they are using different Python interpreters. Correct?
>
> Since the _apache module in mod_python is bound to the different
> internals of each version of Apache at compile time, then yes, they
> would need to be distinct.
>
> I have speculated at one point whether we should allow somehow
> the ability to extend/modify the PYTHONPATH in the Apache  
> configuration
> prior to mod_python being being initialised so that one could in the
> Apache configuration specify extra directories to look.
>
> In your case this would allow you to install one set of Python code
> files for one version of Python, but put the _apache and PSP compiled
> modules in separate directories based on Apache version and have
> each version of Apache only look in the directory for their version.
>
> This feature may also be useful in other cases as well where people
> find Python looking in the wrong spot.
>
> Graham
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
From grahamd at dscpl.com.au  Tue Nov  7 17:40:29 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Tue Nov  7 17:40:33 2006
Subject: [mod_python] Re: installing xp problems
Message-ID: <1162939229.15466@dscpl.user.openhosting.com>

Steve Holden wrote ..
> Graham Dumpleton wrote:
> > Hmmm, actually, I am talking nonsense, as the _apache module
> > is embeded within the Apachh mod_python module and isn't in
> > the Python installation. Only _psp.so is in the Python installation
> > and that shouldn't be Apache specific.
> > 
> > Thus, can't think know why there might be an issue. What actually
> > happens?
> > 
> I can't say, as I haven't tried it yet (not wanting to overwrite my 
> existing, functional mod_python). Observing that my site-packages 
> directory contained a mod_python directory which contained (among other
> things) an apache.py and a publisher.py was quite enough to have me hit
> the brake.
> 
> Won't that directory be used by both mod_pythons?

Yes, the same site packages directory is used by both if same Python
version.

FWIW, on Mac OS X I have both Apache 2.0 and 2.2 running at times
with both using same Python version and each using same version
of mod_python. I haven't specifically had any problems.

Graham
From steve at holdenweb.com  Tue Nov  7 17:49:42 2006
From: steve at holdenweb.com (Steve Holden)
Date: Tue Nov  7 17:49:07 2006
Subject: [mod_python] Re: installing xp problems
In-Reply-To: <1162939229.15466@dscpl.user.openhosting.com>
References: <1162939229.15466@dscpl.user.openhosting.com>
Message-ID: <eir2fv$ntb$1@sea.gmane.org>

Graham Dumpleton wrote:
> Steve Holden wrote ..
> 
>>Graham Dumpleton wrote:
>>
>>>Hmmm, actually, I am talking nonsense, as the _apache module
>>>is embeded within the Apachh mod_python module and isn't in
>>>the Python installation. Only _psp.so is in the Python installation
>>>and that shouldn't be Apache specific.
>>>
>>>Thus, can't think know why there might be an issue. What actually
>>>happens?
>>>
>>
>>I can't say, as I haven't tried it yet (not wanting to overwrite my 
>>existing, functional mod_python). Observing that my site-packages 
>>directory contained a mod_python directory which contained (among other
>>things) an apache.py and a publisher.py was quite enough to have me hit
>>the brake.
>>
>>Won't that directory be used by both mod_pythons?
> 
> 
> Yes, the same site packages directory is used by both if same Python
> version.
> 
> FWIW, on Mac OS X I have both Apache 2.0 and 2.2 running at times
> with both using same Python version and each using same version
> of mod_python. I haven't specifically had any problems.

Thanks. The mod_python I am currently running was probably installed 
when Apache 2.0.48 was current, so I'll definitely need an upgrade. I 
had previously thought that there was a distinct cutover point where 
mod_python stopped working in 2.0, so I'm happy to know this isn't the 
case (though I've been bitten before with Apache module inconsistency 
problems: for 2.0, at least on Windows, ISTR that modules had to be 
compiled for the exact Apache version in use - but that *was* a long 
time ago, so I may be suffering from CRS).

Anyway, you've encouraged me to be more adventurous!

regards
  Steve
-- 
Steve Holden       +44 150 684 7255  +1 800 494 3119
Holden Web LLC/Ltd          http://www.holdenweb.com
Skype: holdenweb       http://holdenweb.blogspot.com
Recent Ramblings     http://del.icio.us/steve.holden

From grahamd at dscpl.com.au  Tue Nov  7 18:09:36 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Tue Nov  7 18:09:39 2006
Subject: [mod_python] Re: installing xp problems
Message-ID: <1162940976.29536@dscpl.user.openhosting.com>

Steve Holden wrote ..
> Graham Dumpleton wrote:
> > Steve Holden wrote ..
> > 
> >>Graham Dumpleton wrote:
> >>
> >>>Hmmm, actually, I am talking nonsense, as the _apache module
> >>>is embeded within the Apachh mod_python module and isn't in
> >>>the Python installation. Only _psp.so is in the Python installation
> >>>and that shouldn't be Apache specific.
> >>>
> >>>Thus, can't think know why there might be an issue. What actually
> >>>happens?
> >>>
> >>
> >>I can't say, as I haven't tried it yet (not wanting to overwrite my 
> >>existing, functional mod_python). Observing that my site-packages 
> >>directory contained a mod_python directory which contained (among other
> >>things) an apache.py and a publisher.py was quite enough to have me hit
> >>the brake.
> >>
> >>Won't that directory be used by both mod_pythons?
> > 
> > 
> > Yes, the same site packages directory is used by both if same Python
> > version.
> > 
> > FWIW, on Mac OS X I have both Apache 2.0 and 2.2 running at times
> > with both using same Python version and each using same version
> > of mod_python. I haven't specifically had any problems.
> 
> Thanks. The mod_python I am currently running was probably installed 
> when Apache 2.0.48 was current, so I'll definitely need an upgrade. I 
> had previously thought that there was a distinct cutover point where 
> mod_python stopped working in 2.0, so I'm happy to know this isn't the
> case (though I've been bitten before with Apache module inconsistency 
> problems: for 2.0, at least on Windows, ISTR that modules had to be 
> compiled for the exact Apache version in use - but that *was* a long 
> time ago, so I may be suffering from CRS).

The mod_python Apache module does have to be compiled for the major/minor
version of Apache being used, preferably the same patch level version of Apache
but, but as a general rule of thumb, small differences in Apache patch level
version usually don't hurt as long as mod_python module being used was compiled
against an older patch level version and not some newer patch level version
than the Apache that you are running. The only caveat to this might be where
Apache switches which version of the underlying APR libraries it uses. In that
case a recompile of mod_python module would be needed in case dependencies
against old APR don't work for new. If I recall properly, there was an APR version
change in 2.0.X recently so that might be what you are thinking of.

Graham
From sam at robots.org.uk  Tue Nov  7 18:00:50 2006
From: sam at robots.org.uk (Sam Morris)
Date: Tue Nov  7 18:10:28 2006
Subject: [mod_python] mod_python, the ITK MPM and sessions
Message-ID: <eir372$687$1@sea.gmane.org>

I'm experimenting with the ITK MPM for Apache, available
from <http://home.samfundet.no/~sesse/mpm-itk/>. It is based on the
Prefork MPM; after a request is parsed, the process handling the
request changes user id to one specified in the config for the virtual
host.

I'm having trouble getting mod_python's session support to work. When
trying to create a new instance of Session, I get this message: 

 [warn] (13)Permission denied: Failed to acquire global mutex
 lock at index 6"

Strace says the following system call fails:

 semop(4227100, 0xb7ca6a30, 1)           = -1 EACCES (Permission denied)

and ipcs(1) says:

 ------ Semaphore Arrays --------
 0x00000000 4227100    www-data  600        1         

I assume this is because the child process (running as user test1) needs
access to the semaphore (for the Global Interpreter Lock?) living inside a
process that is running as www-data. If this is the case, I guess there's
no way past this problem short of redesigning (mod_)python and/or
apache/ITK? :)

Here's the full traceback:

Mod_python error: "PythonHandler pytest"

 Traceback (most recent call last):
  File "/usr/lib/python2.4/site-packages/mod_python/apache.py", line 299,
    in HandlerDispatch
    result = object(req)
  File "/home/sam/pytest/pytest.py", line 8, in handler
    s = Session.Session (req)
  File "/usr/lib/python2.4/site-packages/mod_python/Session.py", line 735,
    in Session
    timeout=timeout, lock=lock)
  File "/usr/lib/python2.4/site-packages/mod_python/Session.py", line 337,
    in __init__
    timeout=timeout, lock=lock)
  File "/usr/lib/python2.4/site-packages/mod_python/Session.py", line 165,
    in __init__
    self.lock()
  File "/usr/lib/python2.4/site-packages/mod_python/Session.py", line 255,
    in lock
    _apache._global_lock(self._req.server, self._sid)
 ValueError: Failed to acquire global mutex lock

And my apache configuration:

 <VirtualHost *>
    DocumentRoot /var/www/
    AssignUserId test1 test1
    ServerName test1

    ErrorLog /var/log/apache2/error.log
    LogLevel warn
    CustomLog /var/log/apache2/access.log combined

    SetHandler mod_python
    PythonPath "['/home/sam/pytest'] + sys.path"
    PythonHandler pytest
    PythonOption session_directory /tmp
    PythonOption mutex_directory /tmp
    PythonDebug on
 </VirtualHost>

-- 
Sam Morris
http://robots.org.uk/

PGP key id 1024D/5EA01078
3412 EA18 1277 354B 991B  C869 B219 7FDB 5EA0 1078

From grahamd at dscpl.com.au  Tue Nov  7 18:23:07 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Tue Nov  7 18:23:09 2006
Subject: [mod_python] mod_python, the ITK MPM and sessions
Message-ID: <1162941787.3988@dscpl.user.openhosting.com>

That is not the Python global interpreter lock. It is a mutex lock created
using Apache for the purposes of mediating access to session stuff. Thus,
you probably need to look into the lock mechanism of Apache and try
and understand it. The issue may be the initial permissions used when
mod_python initialises/acquires the locks. Specifically look around the
call to apr_global_mutex_create() in init_mutexes() in src/mod_python.c
source code.

Graham

Sam Morris wrote ..
> I'm experimenting with the ITK MPM for Apache, available
> from <http://home.samfundet.no/~sesse/mpm-itk/>. It is based on the
> Prefork MPM; after a request is parsed, the process handling the
> request changes user id to one specified in the config for the virtual
> host.
> 
> I'm having trouble getting mod_python's session support to work. When
> trying to create a new instance of Session, I get this message: 
> 
>  [warn] (13)Permission denied: Failed to acquire global mutex
>  lock at index 6"
> 
> Strace says the following system call fails:
> 
>  semop(4227100, 0xb7ca6a30, 1)           = -1 EACCES (Permission denied)
> 
> and ipcs(1) says:
> 
>  ------ Semaphore Arrays --------
>  0x00000000 4227100    www-data  600        1         
> 
> I assume this is because the child process (running as user test1) needs
> access to the semaphore (for the Global Interpreter Lock?) living inside
> a
> process that is running as www-data. If this is the case, I guess there's
> no way past this problem short of redesigning (mod_)python and/or
> apache/ITK? :)
> 
> Here's the full traceback:
> 
> Mod_python error: "PythonHandler pytest"
> 
>  Traceback (most recent call last):
>   File "/usr/lib/python2.4/site-packages/mod_python/apache.py", line 299,
>     in HandlerDispatch
>     result = object(req)
>   File "/home/sam/pytest/pytest.py", line 8, in handler
>     s = Session.Session (req)
>   File "/usr/lib/python2.4/site-packages/mod_python/Session.py", line 735,
>     in Session
>     timeout=timeout, lock=lock)
>   File "/usr/lib/python2.4/site-packages/mod_python/Session.py", line 337,
>     in __init__
>     timeout=timeout, lock=lock)
>   File "/usr/lib/python2.4/site-packages/mod_python/Session.py", line 165,
>     in __init__
>     self.lock()
>   File "/usr/lib/python2.4/site-packages/mod_python/Session.py", line 255,
>     in lock
>     _apache._global_lock(self._req.server, self._sid)
>  ValueError: Failed to acquire global mutex lock
> 
> And my apache configuration:
> 
>  <VirtualHost *>
>     DocumentRoot /var/www/
>     AssignUserId test1 test1
>     ServerName test1
> 
>     ErrorLog /var/log/apache2/error.log
>     LogLevel warn
>     CustomLog /var/log/apache2/access.log combined
> 
>     SetHandler mod_python
>     PythonPath "['/home/sam/pytest'] + sys.path"
>     PythonHandler pytest
>     PythonOption session_directory /tmp
>     PythonOption mutex_directory /tmp
>     PythonDebug on
>  </VirtualHost>
> 
> -- 
> Sam Morris
> http://robots.org.uk/
> 
> PGP key id 1024D/5EA01078
> 3412 EA18 1277 354B 991B  C869 B219 7FDB 5EA0 1078
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
From grahamd at dscpl.com.au  Tue Nov  7 18:46:44 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Tue Nov  7 18:46:45 2006
Subject: [mod_python] mod_python, the ITK MPM and sessions
Message-ID: <1162943204.15120@dscpl.user.openhosting.com>

Graham Dumpleton wrote ..
> That is not the Python global interpreter lock. It is a mutex lock created
> using Apache for the purposes of mediating access to session stuff. Thus,
> you probably need to look into the lock mechanism of Apache and try
> and understand it. The issue may be the initial permissions used when
> mod_python initialises/acquires the locks. Specifically look around the
> call to apr_global_mutex_create() in init_mutexes() in src/mod_python.c
> source code.

Looking at:

  http://apr.apache.org/docs/apr/apr__global__mutex_8h-source.html

you might consider changing mod_python code such that instead of
passing APR_LOCK_DEFAULT to the call of apr_global_mutex_create() in
src/mod_python.c, change it some some other specific locking
mechanism rather than relying on APR to choose one for you.

In other words, try in turn:

 APR_LOCK_FCNTL
 APR_LOCK_FLOCK
 APR_LOCK_SYSVSEM
 APR_LOCK_POSIXSEM
 APR_LOCK_PROC_PTHREAD

and see if you can find one which will work across processes which are
running as different users.

Because you are specifying the mechanism, it may not be portable, but
may allow you to get it to work for your platform at least.

Please do tell us what the results are.

Graham

> Sam Morris wrote ..
> > I'm experimenting with the ITK MPM for Apache, available
> > from <http://home.samfundet.no/~sesse/mpm-itk/>. It is based on the
> > Prefork MPM; after a request is parsed, the process handling the
> > request changes user id to one specified in the config for the virtual
> > host.
> > 
> > I'm having trouble getting mod_python's session support to work. When
> > trying to create a new instance of Session, I get this message: 
> > 
> >  [warn] (13)Permission denied: Failed to acquire global mutex
> >  lock at index 6"
> > 
> > Strace says the following system call fails:
> > 
> >  semop(4227100, 0xb7ca6a30, 1)           = -1 EACCES (Permission denied)
> > 
> > and ipcs(1) says:
> > 
> >  ------ Semaphore Arrays --------
> >  0x00000000 4227100    www-data  600        1         
> > 
> > I assume this is because the child process (running as user test1) needs
> > access to the semaphore (for the Global Interpreter Lock?) living inside
> > a
> > process that is running as www-data. If this is the case, I guess there's
> > no way past this problem short of redesigning (mod_)python and/or
> > apache/ITK? :)
> > 
> > Here's the full traceback:
> > 
> > Mod_python error: "PythonHandler pytest"
> > 
> >  Traceback (most recent call last):
> >   File "/usr/lib/python2.4/site-packages/mod_python/apache.py", line
> 299,
> >     in HandlerDispatch
> >     result = object(req)
> >   File "/home/sam/pytest/pytest.py", line 8, in handler
> >     s = Session.Session (req)
> >   File "/usr/lib/python2.4/site-packages/mod_python/Session.py", line
> 735,
> >     in Session
> >     timeout=timeout, lock=lock)
> >   File "/usr/lib/python2.4/site-packages/mod_python/Session.py", line
> 337,
> >     in __init__
> >     timeout=timeout, lock=lock)
> >   File "/usr/lib/python2.4/site-packages/mod_python/Session.py", line
> 165,
> >     in __init__
> >     self.lock()
> >   File "/usr/lib/python2.4/site-packages/mod_python/Session.py", line
> 255,
> >     in lock
> >     _apache._global_lock(self._req.server, self._sid)
> >  ValueError: Failed to acquire global mutex lock
> > 
> > And my apache configuration:
> > 
> >  <VirtualHost *>
> >     DocumentRoot /var/www/
> >     AssignUserId test1 test1
> >     ServerName test1
> > 
> >     ErrorLog /var/log/apache2/error.log
> >     LogLevel warn
> >     CustomLog /var/log/apache2/access.log combined
> > 
> >     SetHandler mod_python
> >     PythonPath "['/home/sam/pytest'] + sys.path"
> >     PythonHandler pytest
> >     PythonOption session_directory /tmp
> >     PythonOption mutex_directory /tmp
> >     PythonDebug on
> >  </VirtualHost>
> > 
> > -- 
> > Sam Morris
> > http://robots.org.uk/
> > 
> > PGP key id 1024D/5EA01078
> > 3412 EA18 1277 354B 991B  C869 B219 7FDB 5EA0 1078
> > 
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://mailman.modpython.org/mailman/listinfo/mod_python
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
From sam at robots.org.uk  Wed Nov  8 06:11:18 2006
From: sam at robots.org.uk (Sam Morris)
Date: Wed Nov  8 06:11:35 2006
Subject: [mod_python] Re: mod_python, the ITK MPM and sessions
References: <1162943204.15120@dscpl.user.openhosting.com> 
Message-ID: <eise0m$687$2@sea.gmane.org>

On Tue, 07 Nov 2006 18:46:44 -0500, Graham Dumpleton wrote:
> Looking at:
> 
>   http://apr.apache.org/docs/apr/apr__global__mutex_8h-source.html
> 
> you might consider changing mod_python code such that instead of
> passing APR_LOCK_DEFAULT to the call of apr_global_mutex_create() in
> src/mod_python.c, change it some some other specific locking
> mechanism rather than relying on APR to choose one for you.

Thanks very much for the pointers! My results:

APR_LOCK_FCNTL: works!
APR_LOCK_FLOCK: works!
APR_LOCK_SYSVSEM: fail (permission denied when acquiring semaphore)
APR_LOCK_POSIXSEM: fail (not implemented on my platform)
APR_LOCK_PROC_PTHREAD: works!

(On my platform, Debian GNU/Linux, APR_LOCK_DEFAULT causes SysV Semaphores
to be used).

Out of these, I guess pthread semaphores are the fastest.

Would you consider adding an option to mod_python's Apache configuration to
control which semaphore implementation is chosen? I can try to come up
with a patch for this.

-- 
Sam Morris
http://robots.org.uk/

PGP key id 1024D/5EA01078
3412 EA18 1277 354B 991B  C869 B219 7FDB 5EA0 1078

From ah at hatzis.de  Wed Nov  8 08:28:28 2006
From: ah at hatzis.de (Anastasios Hatzis)
Date: Wed Nov  8 08:28:31 2006
Subject: [mod_python] Trouble building mod_python from soruce on RHEL4
	64bit
In-Reply-To: <2590773a0610190746s29e21c81gbcf7ab95cff321a4@mail.gmail.com>
References: <2590773a0610190746s29e21c81gbcf7ab95cff321a4@mail.gmail.com>
Message-ID: <4551DB7C.90805@hatzis.de>

Christopher Taylor wrote:
> Hello all,
> 
> I'm running RHEL4 ES on a 2 proc x86_64 server.
> 
> I installed python 2.4 on top of python 2.3 with make altinstall so I
> had to build mod_python to use /usr/bin/python2.4 instead of
> /usr/bin/python (which points to /usr/bin/python2.3 for the sake of
> not breaking RH).
> 
> Well, when I try and compile up mod_python it breaks when trying to
> link in /usr/lib/libpython2.4.a:
> 
> /usr/bin/ld: /usr/lib/python2.4/config/libpython2.4.a(abstract.o):
> relocation R_X86_64_32 against `a local symbol' can not be used when
> making a shared object; recompile with -fPIC
> /usr/lib/python2.4/config/libpython2.4.a: could not read symbols: Bad value
> collect2: ld returned 1 exit status
> apxs:Error: Command failed with rc=65536
> 
> 
> Can someone please help with this?  I think it's a problem with the
> configure script either for mod-python or python.  Not entirely sure.
> 

Did you find a solution? I have a similar problem here on OpenSUSE 10.0 
64bit (ADM Opteron). I compiled Python with

# ./configure
and in a second attempt after failed with mod_python:
# ./configure --enabled-shared


In both cases after
# ./configure --with-max-locks=32

and

# make

I get this error:

/usr/include/features.h:150:1: warning: this is the location of the 
previous definition
/usr/local/apache2/build/libtool --silent --mode=link gcc -o 
mod_python.la  -rpath /usr/local/apache2/modules -module -avoid-version 
    hlistobject.lo hlist.lo filterobject.lo connobject.lo 
serverobject.lo util.lo tableobject.lo requestobject.lo _apachemodule.lo 
mod_python.lo -L/usr/local/lib/python2.5/config -Xlinker -export-dynamic 
-lm -lpython2.5 -lpthread -ldl -lutil -lm
/usr/lib64/gcc/x86_64-suse-linux/4.0.2/../../../../x86_64-suse-linux/bin/ld: 
/usr/local/lib/python2.5/config/libpython2.5.a(abstract.o): relocation 
R_X86_64_32S against `_Py_NotImplementedStruct' can not be used when 
making a shared object; recompile with -fPIC
/usr/local/lib/python2.5/config/libpython2.5.a: could not read symbols: 
Bad value
collect2: ld returned 1 exit status
apxs:Error: Command failed with rc=65536


Anyone who knows how to solve this problem? Many thanks.

Anastasios
From fred at adventistcare.org  Wed Nov  8 08:54:45 2006
From: fred at adventistcare.org (Sells, Fred)
Date: Wed Nov  8 08:45:59 2006
Subject: [Retrieved][mod_python] Error: Cannot load mod_python module
Message-ID: <1A4BF05172023E468CB6E867923BC90402B6E359@accmail2.sunbelt.org>

Since you're using XP.  I suggest you use the .msi installers for python,
apache and mod_python.  All installation problems that I have had have been
of my own making, these installers do a pretty good job.  Also I just found
out Apache 2.2 needs mod_python 3.2.10.

-----Original Message-----
From: mod_python-bounces@modpython.org
[mailto:mod_python-bounces@modpython.org]On Behalf Of Gutfreund, Yechezkal
Sent: Monday, November 06, 2006 11:22 AM
To: mod_python@modpython.org
Subject: [Retrieved][mod_python] Error: Cannot load mod_python module


I am a long-time (25+ years) distributed system (and OS) programmer, but a
newbie at mod_python and apache.
 
I believed I followed the install procedures. I added:
 
1. put the following line in httpd.conf
     LoadModule python_module modules/mod_python.so
 
2. created the /tmp director for the mutex's
 
3. added the <directory> section and put the mptest.py file in the test
directory
 
    <Directory /some/directory/htdocs/test> 
        AddHandler mod_python .py
        PythonHandler mptest 
        PythonDebug On 
    </Directory>
 
4. Installed ActiveState Python Version 2.4 python24.dll and mod_python
3.2.8 (and told it where Apache 2.2.3 (win) is located
 
5. All of this is on an XP Pro SP 2 machine
 
6. I still get the following ERROR:
 
The Apache service named reported the following error:

>>> httpd.exe: Syntax error on line 98 of C:/Program Files/Apache Software
Foundation/Apache2.2/conf/httpd.conf: Cannot load C:/Program Files/Apache
Software Foundation/Apache2.2/modules/mod_python.so into server: The
specified procedure could not be found. .

 

I verified that the mod_python.so is indeed in this directory, and I also
tried moving python24.dll to the /bin directory of apache. But that was the
only relevant fixes I could see in the blogs, newsgroups, etc.

 

So I am posting here, to see if anyone has had similar problems.

 

 

 
Dr. Yechezkal Gutfreund
Draper Laboratory
555 Technology Square
Cambridge, MA 02139
 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20061108/a525fb0e/attachment.html
From azaroth at liverpool.ac.uk  Wed Nov  8 09:40:44 2006
From: azaroth at liverpool.ac.uk (Dr R. Sanderson)
Date: Wed Nov  8 09:40:47 2006
Subject: [mod_python] Restricted Mode 
In-Reply-To: <1A4BF05172023E468CB6E867923BC90402B6E359@accmail2.sunbelt.org>
References: <1A4BF05172023E468CB6E867923BC90402B6E359@accmail2.sunbelt.org>
Message-ID: <Pine.GSO.4.64.0611081432400.887@uxa.liv.ac.uk>


Hi all,

http://64.233.183.104/search?q=cache:DffNofD9DXgJ:www.cardsnotwords.com/card.html%3Fc%3D192+-zope+RuntimeError:+function+attributes+not+accessible+in+restricted+mode&#38;hl=en&#38;gl=uk&#38;ct=clnk&#38;cd=9

We use 4Suite for XSLT processing within mod_python, however when we 
try to use functions within the stylesheets, it complains that python is 
in restricted mode.

We're using Python 2.4.3 and mod_python 3.2.10, so it's not the previous 
problem that was putting it into restricted mode fixed circa 
Python 2.3/mod_python 3.1

It doesn't /always/ do this, it seems to flip into it sometimes. 
Possibly when the httpd reloads, but we're not sure about that.
Given that, creating a minimal breaking script to demonstrate is quite 
complicated.

Any help or suggestions appreciated!

Thanks,

Rob Sanderson
From grahamd at dscpl.com.au  Wed Nov  8 15:58:57 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Wed Nov  8 15:59:05 2006
Subject: [mod_python] Restricted Mode 
Message-ID: <1163019537.20238@dscpl.user.openhosting.com>

Dr R. Sanderson wrote ..
> 
> Hi all,
> 
> http://64.233.183.104/search?q=cache:DffNofD9DXgJ:www.cardsnotwords.com/card.html%3Fc%3D192+-zope+RuntimeError:+function+attributes+not+accessible+in+restricted+mode&#38;hl=en&#38;gl=uk&#38;ct=clnk&#38;cd=9
> 
> We use 4Suite for XSLT processing within mod_python, however when we 
> try to use functions within the stylesheets, it complains that python is
> in restricted mode.
> 
> We're using Python 2.4.3 and mod_python 3.2.10, so it's not the previous
> problem that was putting it into restricted mode fixed circa 
> Python 2.3/mod_python 3.1
> 
> It doesn't /always/ do this, it seems to flip into it sometimes. 
> Possibly when the httpd reloads, but we're not sure about that.
> Given that, creating a minimal breaking script to demonstrate is quite
> complicated.
> 
> Any help or suggestions appreciated!

I don't know about any fixes in mod_python 3.1.X related to restricted mode,
but there were some changes in mod_python 3.2.10 related to it. Even when
using mod_python 3.2.10, for it to work you still have to do one extra step
which is to force all the requests handlers which use the problematic package
to run within the context of the 'main_interpreter' instance. To do this, you
must use:

  PythonInterpreter main_interpreter

in conjunction with the Python*Handler directive which you are using to
trigger your mod_python handlers to run.

To confirm that your code is working within the context of the correct
interpreter, log the value of 'req.interpreter' into the Apache error log from
your handler.

There is some history of the issue in:

  http://issues.apache.org/jira/browse/MODPYTHON-77

Please try this and then let us know if it works or not so we know whether this
can be given as a solution to others in the future.

Graham
From grahamd at dscpl.com.au  Wed Nov  8 16:20:39 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Wed Nov  8 16:20:42 2006
Subject: [mod_python] Re: mod_python, the ITK MPM and sessions
Message-ID: <1163020839.30323@dscpl.user.openhosting.com>

Sam Morris wrote ..
> On Tue, 07 Nov 2006 18:46:44 -0500, Graham Dumpleton wrote:
> > Looking at:
> > 
> >   http://apr.apache.org/docs/apr/apr__global__mutex_8h-source.html
> > 
> > you might consider changing mod_python code such that instead of
> > passing APR_LOCK_DEFAULT to the call of apr_global_mutex_create() in
> > src/mod_python.c, change it some some other specific locking
> > mechanism rather than relying on APR to choose one for you.
> 
> Thanks very much for the pointers! My results:
> 
> APR_LOCK_FCNTL: works!
> APR_LOCK_FLOCK: works!
> APR_LOCK_SYSVSEM: fail (permission denied when acquiring semaphore)
> APR_LOCK_POSIXSEM: fail (not implemented on my platform)
> APR_LOCK_PROC_PTHREAD: works!
> 
> (On my platform, Debian GNU/Linux, APR_LOCK_DEFAULT causes SysV Semaphores
> to be used).
> 
> Out of these, I guess pthread semaphores are the fastest.
> 
> Would you consider adding an option to mod_python's Apache configuration
> to
> control which semaphore implementation is chosen? I can try to come up
> with a patch for this.

Good to hear it works.

At this stage the best course of action is probably to create an issue on the
mod_python bug tracker with the suggested new feature of an option to configure
which allows the locking scheme used for the global locks to be overridden at
compile time. As well as the changes to configure, obviously need to make code
changes in src/mod_python.c and elsewhere.

Note that because of where we are at with releases this would not be looked at
until some future release after 3.3. Thus, for the time being at least, just go with
the manual change.

I'll create an issue in the bug tracking system later when I get a chance and after
I have done some research on what this experimental MPM is all about.

Graham
From MCStoufer at lbl.gov  Wed Nov  8 16:52:54 2006
From: MCStoufer at lbl.gov (Martin Stoufer)
Date: Wed Nov  8 16:53:02 2006
Subject: [mod_python] Trouble with multiple class objects in publisher model
Message-ID: <455251B6.9000008@lbl.gov>

I am moving a set of python classes out of the Apache CGI model and into 
mod_python. There is both inheritance and composition going on among 
these classes. A few factory classes as well. It seems that when it 
comes time to pull the generated content from the hierarchy of classes, 
the string object returned to the initial class end up 'None'.

I have stripped down my work as an example. If there is some larger 
example of how this class structure should work, I would love to see it.

from mod_python import apache

class Dom:
    def __call__(self, req):
        from DomProdLibOutput import Html
        self.form = req.form
        self.output = Html('modPython')
        self.host = self.form['host'].value
        self.sortBy = self.form['sortby'].value
        self.mode = self.form['mode'].value
        if self.form.has_key('term'):
           self.term=self.form['term'].value
        else:
           self.term = ""
        req.content_type = "text/html"
        req.send_http_header()
        result = self.generate()
        req.write(result)
        return apache.OK

    def generate(self):
        result = self.output.generate()
        return result

dom = Dom()

In the DomProdLibOutput file in the same dir:

class Html:
    def __init__(self, destination='screen'):
        self.output = HtmlOutputFactory(destination).getOutput()
        return

    def generate(self):
        #result = "Foo in Html"
        result = self.output.generate()
        return result

class HtmlModPython:
    def __init__(self):
        self.content = """Empty content in HtmlModPython"""
        return
   
    def update(self, content):
        self.content += content
        return

    def generate(self):
        return "Foo in HtmlModPython"
        #return self.content

class HtmlOutputFactory:
    def __init__(self, destination):
        self.dest = destination
        return

    def getOutput(self):
        if self.dest == 'screen': return HtmlScreen()
        elif self.dest == 'modPython': return HtmlModPython()
        elif self.dest == 'file': return HtmlFile()
        else:
            raise InvalidHtmlOutputDest, \
        "%s is not a supported output" % self.dest
        return

As an interesting side note, if I have the generate() in Html return 
just the string, things work fine. Its when I try and resolve the string 
stored by the HtmlModPython class instance that the resulting string 
comes back 'None' irregardless of what the deepest generate() returns. 
Do all these classes have to define __call__ as well?

-- 
* Martin C. Stoufer              *
* DIDC/DSD/ITG                   *
* Lawrence Berkeley National Lab *
* MS 50B-2215 510-486-8662       *

-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/x-pkcs7-signature
Size: 3423 bytes
Desc: S/MIME Cryptographic Signature
Url : http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20061108/2a36f5b5/smime.bin
From grahamd at dscpl.com.au  Wed Nov  8 17:21:00 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Wed Nov  8 17:21:07 2006
Subject: [mod_python] Trouble with multiple class objects in publisher
	model
Message-ID: <1163024460.25645@dscpl.user.openhosting.com>

For starters, you are mixing up mod_python basic handlers and
mod_python.publisher published functions. They are not the same
thing. See my recent comment on mailing list about this:

  http://www.modpython.org/pipermail/mod_python/2006-November/022529.html

BTW, which version of mod_python are you using?

A few more things pointed out below.

Martin Stoufer wrote ..
> I am moving a set of python classes out of the Apache CGI model and into
> mod_python. There is both inheritance and composition going on among 
> these classes. A few factory classes as well. It seems that when it 
> comes time to pull the generated content from the hierarchy of classes,
> the string object returned to the initial class end up 'None'.
> 
> I have stripped down my work as an example. If there is some larger 
> example of how this class structure should work, I would love to see it.
> 
> from mod_python import apache
> 
> class Dom:
>     def __call__(self, req):
>         from DomProdLibOutput import Html
>         self.form = req.form
>         self.output = Html('modPython')
>         self.host = self.form['host'].value
>         self.sortBy = self.form['sortby'].value
>         self.mode = self.form['mode'].value
>         if self.form.has_key('term'):
>            self.term=self.form['term'].value
>         else:
>            self.term = ""
>         req.content_type = "text/html"
>         req.send_http_header()

Only need to call req.send_http_header() if using mod_python 2.7.X.

>         result = self.generate()
>         req.write(result)
>         return apache.OK

You shouldn't be returning an Apache status code like this when using
publisher. Status codes are for mod_python basic handlers, not publisher.
Publisher needs to return the content, or if you have used req.write()
it should return None (if mod_python 3.2 or later), or a string consisting
of a singe space (prior to mod_python 3.2, to get around bug).

Also, because publisher will automatically detect and set content type
to 'text/html' when appropriate if returning the content, you don't need to
set it yourself. Thus you can just have:

        return self.generate()

and not worry about setting content, flush headers or explicitly
writing back content.

>     def generate(self):
>         result = self.output.generate()
>         return result
> 
> dom = Dom()

Although you have specified a __call__() method so URL can just be '/.../dom',
you are also exposing all the member data and member functions of your
object as well and they can be access directly, which is really bad for this
example. To hide member functions and data you don't want automatically
accessible via a URL request, precede them with an underscore. Ie., use
_generate() not generate() and store data like self._form and not self.form.

> In the DomProdLibOutput file in the same dir:
> 
> class Html:
>     def __init__(self, destination='screen'):
>         self.output = HtmlOutputFactory(destination).getOutput()
>         return
> 
>     def generate(self):
>         #result = "Foo in Html"
>         result = self.output.generate()
>         return result
> 
> class HtmlModPython:
>     def __init__(self):
>         self.content = """Empty content in HtmlModPython"""
>         return
>    
>     def update(self, content):
>         self.content += content
>         return
> 
>     def generate(self):
>         return "Foo in HtmlModPython"
>         #return self.content
> 
> class HtmlOutputFactory:
>     def __init__(self, destination):
>         self.dest = destination
>         return
> 
>     def getOutput(self):
>         if self.dest == 'screen': return HtmlScreen()
>         elif self.dest == 'modPython': return HtmlModPython()
>         elif self.dest == 'file': return HtmlFile()
>         else:
>             raise InvalidHtmlOutputDest, \
>         "%s is not a supported output" % self.dest
>         return
> 
> As an interesting side note, if I have the generate() in Html return 
> just the string, things work fine. Its when I try and resolve the string
> stored by the HtmlModPython class instance that the resulting string 
> comes back 'None' irregardless of what the deepest generate() returns.

Lost me there. I would very much suggest to track through what is
happening that you use req.log_error() to log progress messages to
the Apache error log file.

> Do all these classes have to define __call__ as well?

The __call__() method is only required for the Dom instance if you want
URL to use the instance variable name only.

Graham
From MCStoufer at lbl.gov  Wed Nov  8 17:38:04 2006
From: MCStoufer at lbl.gov (Martin Stoufer)
Date: Wed Nov  8 17:38:18 2006
Subject: [mod_python] Trouble with multiple class objects in publisher
	model
In-Reply-To: <1163024460.25645@dscpl.user.openhosting.com>
References: <1163024460.25645@dscpl.user.openhosting.com>
Message-ID: <45525C4C.6010305@lbl.gov>

An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20061108/be279601/attachment-0001.html
-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/x-pkcs7-signature
Size: 3423 bytes
Desc: S/MIME Cryptographic Signature
Url : http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20061108/be279601/smime-0001.bin
From grahamd at dscpl.com.au  Wed Nov  8 17:43:28 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Wed Nov  8 17:43:32 2006
Subject: [mod_python] Re: mod_python, the ITK MPM and sessions
Message-ID: <1163025807.3883@dscpl.user.openhosting.com>

Graham Dumpleton wrote ..
> Sam Morris wrote ..
> > On Tue, 07 Nov 2006 18:46:44 -0500, Graham Dumpleton wrote:
> > > Looking at:
> > > 
> > >   http://apr.apache.org/docs/apr/apr__global__mutex_8h-source.html
> > > 
> > > you might consider changing mod_python code such that instead of
> > > passing APR_LOCK_DEFAULT to the call of apr_global_mutex_create() in
> > > src/mod_python.c, change it some some other specific locking
> > > mechanism rather than relying on APR to choose one for you.
> > 
> > Thanks very much for the pointers! My results:
> > 
> > APR_LOCK_FCNTL: works!
> > APR_LOCK_FLOCK: works!
> > APR_LOCK_SYSVSEM: fail (permission denied when acquiring semaphore)
> > APR_LOCK_POSIXSEM: fail (not implemented on my platform)
> > APR_LOCK_PROC_PTHREAD: works!
> > 
> > (On my platform, Debian GNU/Linux, APR_LOCK_DEFAULT causes SysV Semaphores
> > to be used).
> > 
> > Out of these, I guess pthread semaphores are the fastest.
> > 
> > Would you consider adding an option to mod_python's Apache configuration
> > to
> > control which semaphore implementation is chosen? I can try to come up
> > with a patch for this.
> 
> Good to hear it works.
> 
> At this stage the best course of action is probably to create an issue
> on the
> mod_python bug tracker with the suggested new feature of an option to configure
> which allows the locking scheme used for the global locks to be overridden
> at
> compile time. As well as the changes to configure, obviously need to make
> code
> changes in src/mod_python.c and elsewhere.
> 
> Note that because of where we are at with releases this would not be looked
> at
> until some future release after 3.3. Thus, for the time being at least,
> just go with
> the manual change.
> 
> I'll create an issue in the bug tracking system later when I get a chance
> and after
> I have done some research on what this experimental MPM is all about.

For future reference, have created issue tracker item:

  http://issues.apache.org/jira/browse/MODPYTHON-202

If you ever come up with any problems with the solution or other gotchas,
best to add it against the bug tracker issue.

Graham
From grahamd at dscpl.com.au  Wed Nov  8 17:49:55 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Wed Nov  8 17:49:57 2006
Subject: [mod_python] Trouble with multiple class objects in publishermodel
Message-ID: <1163026195.6817@dscpl.user.openhosting.com>

Martin Stoufer wrote ..
> 
>    This is a bit to digest, thanks for being so thorough. In comment to your
>    mentioned article, I could not rectify if the named args (host, sortBy,
>    etc..) would be always required when passed to the __call__ function. Or is
>    that just when you are dealing with a standalone method in your example?

The short of it, is that using publisher instead of:

> class Dom:
>     def __call__(self, req):
>         from DomProdLibOutput import Html
>         self.form = req.form
>         self.output = Html('modPython')
>         self.host = self.form['host'].value
>         self.sortBy = self.form['sortby'].value
>         self.mode = self.form['mode'].value
>         if self.form.has_key('term'):
>            self.term=self.form['term'].value
>         else:
>            self.term = ""

you could have written:

  class Dom:
      def __call__(self, req, host, sortBy, mode, term=''):
          from DomProdLibOutput import Html
          self.host = host
          self.sortBy = sortyBy
          self.mode = mode
          self.term = term

If a form field is optional, give it a default value in the prototype. This might
be space if appropriate, or even None if you truly want to know if the field
was supplied.

Graham

> For starters, you are mixing up mod_python basic handlers and
> mod_python.publisher published functions. They are not the same
> thing. See my recent comment on mailing list about this:
> 
>   [1]http://www.modpython.org/pipermail/mod_python/2006-November/022529.html
> 
> BTW, which version of mod_python are you using?
> 
> 
>    Apache 2.2.3/mod_python 3.2.10/Python 2.5
> 
> A few more things pointed out below.
> 
> Martin Stoufer wrote ..
> 
> 
> I am moving a set of python classes out of the Apache CGI model and into
> mod_python. There is both inheritance and composition going on among
> these classes. A few factory classes as well. It seems that when it
> comes time to pull the generated content from the hierarchy of classes,
> the string object returned to the initial class end up 'None'.
> 
> I have stripped down my work as an example. If there is some larger
> example of how this class structure should work, I would love to see it.
> 
> from mod_python import apache
> 
> class Dom:
>     def __call__(self, req):
>         from DomProdLibOutput import Html
>         self.form = req.form
>         self.output = Html('modPython')
>         self.host = self.form['host'].value
>         self.sortBy = self.form['sortby'].value
>         self.mode = self.form['mode'].value
>         if self.form.has_key('term'):
>            self.term=self.form['term'].value
>         else:
>            self.term = ""
>         req.content_type = "text/html"
>         req.send_http_header()
> 
> 
> Only need to call req.send_http_header() if using mod_python 2.7.X.
> 
> 
> 
>         result = self.generate()
>         req.write(result)
>         return apache.OK
> 
> 
> You shouldn't be returning an Apache status code like this when using
> publisher. Status codes are for mod_python basic handlers, not publisher.
> Publisher needs to return the content, or if you have used req.write()
> it should return None (if mod_python 3.2 or later), or a string consisting
> of a singe space (prior to mod_python 3.2, to get around bug).
> 
> Also, because publisher will automatically detect and set content type
> to 'text/html' when appropriate if returning the content, you don't need
> to
> set it yourself. Thus you can just have:
> 
>         return self.generate()
> 
> and not worry about setting content, flush headers or explicitly
> writing back content.
> 
> 
> 
>     def generate(self):
>         result = self.output.generate()
>         return result
> 
> dom = Dom()
> 
> 
> Although you have specified a __call__() method so URL can just be '/.../dom',
> you are also exposing all the member data and member functions of your
> object as well and they can be access directly, which is really bad for
> this
> example. To hide member functions and data you don't want automatically
> accessible via a URL request, precede them with an underscore. Ie., use
> _generate() not generate() and store data like self._form and not self.form.
> 
> 
> 
> In the DomProdLibOutput file in the same dir:
> 
> class Html:
>     def __init__(self, destination='screen'):
>         self.output = HtmlOutputFactory(destination).getOutput()
>         return
> 
>     def generate(self):
>         #result = "Foo in Html"
>         result = self.output.generate()
>         return result
> 
> class HtmlModPython:
>     def __init__(self):
>         self.content = """Empty content in HtmlModPython"""
>         return
> 
>     def update(self, content):
>         self.content += content
>         return
> 
>     def generate(self):
>         return "Foo in HtmlModPython"
>         #return self.content
> 
> class HtmlOutputFactory:
>     def __init__(self, destination):
>         self.dest = destination
>         return
> 
>     def getOutput(self):
>         if self.dest == 'screen': return HtmlScreen()
>         elif self.dest == 'modPython': return HtmlModPython()
>         elif self.dest == 'file': return HtmlFile()
>         else:
>             raise InvalidHtmlOutputDest, \
>         "%s is not a supported output" % self.dest
>         return
> 
> As an interesting side note, if I have the generate() in Html return
> just the string, things work fine. Its when I try and resolve the string
> stored by the HtmlModPython class instance that the resulting string
> comes back 'None' irregardless of what the deepest generate() returns.
> 
> 
> Lost me there. I would very much suggest to track through what is
> happening that you use req.log_error() to log progress messages to
> the Apache error log file.
> 
> 
> 
> Do all these classes have to define __call__ as well?
> 
> 
> The __call__() method is only required for the Dom instance if you want
> URL to use the instance variable name only.
> 
> Graham
> 
> 
> --
> * Martin C. Stoufer              *
> * DIDC/DSD/ITG                   *
> * Lawrence Berkeley National Lab *
> * MS 50B-2215 510-486-8662       *
From MCStoufer at lbl.gov  Wed Nov  8 18:21:21 2006
From: MCStoufer at lbl.gov (Martin Stoufer)
Date: Wed Nov  8 18:21:28 2006
Subject: [mod_python] Trouble with multiple class objects in publisher
	model
In-Reply-To: <1163024460.25645@dscpl.user.openhosting.com>
References: <1163024460.25645@dscpl.user.openhosting.com>
Message-ID: <45526671.2020607@lbl.gov>

Well events are getting better/worse. It seems that when _generate() is 
called, it is now unable to properly invoke the method it is calling. 
I've successfully returned/logged the string representation of both 
self._output and self._output.generate. They reference what they should 
be. Am I using reserved mod_python variable names?

Class Dom:
 def __call__(self, req):
        from DomProdLibOutput import Html
        from DomProdLibDB import DomProdLibDB
        global sortBy
        self._req = req
        self._form = req.form
        self._output = Html('modPython')
        self._host = self._form['host'].value
        self._sortBy = sortBy[urllib.unquote(self._form['sortby'].value)]
        self._mode = self._form['mode'].value
        if self._form.has_key('term'):
           self._term=self._form['term'].value
        else:
           self._term = ""
        return self._generate()
  
  def _generate(self):
        #_result = self._output.generate()
        _result = str(self._output.generate)
        self._req.log_error("Result from Html() %s" % _result, 
apache.APLOG_NOTICE)
        return _result

-- 
* Martin C. Stoufer              *
* DIDC/DSD/ITG                   *
* Lawrence Berkeley National Lab *
* MS 50B-2215 510-486-8662       *

-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/x-pkcs7-signature
Size: 3423 bytes
Desc: S/MIME Cryptographic Signature
Url : http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20061108/2f6d18d1/smime.bin
From grahamd at dscpl.com.au  Wed Nov  8 18:29:50 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Wed Nov  8 18:29:54 2006
Subject: [mod_python] Trouble with multiple class objects in publishermodel
Message-ID: <1163028590.25987@dscpl.user.openhosting.com>

Martin Stoufer wrote ..
> Well events are getting better/worse. It seems that when _generate() is
> called, it is now unable to properly invoke the method it is calling. 
> I've successfully returned/logged the string representation of both 
> self._output and self._output.generate. They reference what they should
> be. Am I using reserved mod_python variable names?
> 
> ...
>
>   def _generate(self):
>         #_result = self._output.generate()
>         _result = str(self._output.generate)

    _result = str(self._output.generate())

You weren't invoking the method, you were turning a reference to it
into a string.

>         self._req.log_error("Result from Html() %s" % _result, 
> apache.APLOG_NOTICE)
>         return _result
From grahamd at dscpl.com.au  Wed Nov  8 19:12:25 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Wed Nov  8 19:12:35 2006
Subject: [mod_python] Trouble with multiple class objects in publishermodel
Message-ID: <1163031144.13571@dscpl.user.openhosting.com>

Martin Stoufer wrote ..
> This was part of the debugging process to verify that things were 
> actually getting instantiated and still in scope.
> 
> I brushed off some python black art debug tricks and found that the 
> secondary DomProdLibOutput module was being cached and not properly 
> unloaded/loaded when I modified it or the Dom class.
> 
> A quick restart of Apache resolved all problems and I'm clean sailing again.
> I didn't see any docs showing how we can force a reload/re byte-compile
> of a module.

Module reloading is a bit of a black art with the version of mod_python you
are using. The module importer in mod_python 3.3 has been reimplemented
and hopefully will be more predictable and be able to cope better with
automatic module reloading.

Anyway, at least you worked out the problem.

Graham

> Graham Dumpleton wrote:
> > Martin Stoufer wrote ..
> >   
> >> Well events are getting better/worse. It seems that when _generate()
> is
> >> called, it is now unable to properly invoke the method it is calling.
> >> I've successfully returned/logged the string representation of both
> >> self._output and self._output.generate. They reference what they should
> >> be. Am I using reserved mod_python variable names?
> >>
> >> ...
> >>
> >>   def _generate(self):
> >>         #_result = self._output.generate()
> >>         _result = str(self._output.generate)
> >>     
> >
> >     _result = str(self._output.generate())
> >
> > You weren't invoking the method, you were turning a reference to it
> > into a string.
> >
> >   
> >>         self._req.log_error("Result from Html() %s" % _result, 
> >> apache.APLOG_NOTICE)
> >>         return _result
> >>     
> 
> -- 
> * Martin C. Stoufer              *
> * DIDC/DSD/ITG                   *
> * Lawrence Berkeley National Lab *
> * MS 50B-2215 510-486-8662       *
From nchacon at caton.es  Thu Nov  9 05:19:20 2006
From: nchacon at caton.es (=?ISO-8859-15?Q?N=E9stor_Chac=F3n?= Manzano)
Date: Thu Nov  9 05:23:55 2006
Subject: [mod_python] publisher the requested URL /python/GetMonth.py was
 not found on this server.
In-Reply-To: <mailman.12268.1163067170.11769.mod_python@modpython.org>
References: <mailman.12268.1163067170.11769.mod_python@modpython.org>
Message-ID: <20061109111920.1c4219bc@localhost.localdomain>

Hello, i' am newer in mod_python.
I try to probe this example:
<html>
  <head>
    <title>Prueba mod_python</title>
  </head>
  <body>
    <form method='POST' action='python/getMonth'>
      <p>
      <hr>
      <br />
      Selecciona el mes: <br />
      <select name='month'>
        <option value='1'>Enero</option>
        <option value='2'>Febrero</option>
        <option value='3'>Marzo</option>
	(...)
      </select>
      </p>
      <br />
      <input type='submit' value="Muestra el mes">
    </form>
  </body>
</html>

In /var/www/python/ i have the script getMonth.py

import calendar
from mod_python import apache
def getMonth(req,month):
  req.write(calendar.month(2006,int(month),2,3))

My /etc/apache/apache2.conf have this entry:

<Directory /var/www/python>
        SetHandler mod_python 
        PythonHandler mod_python.publisher
        PythonDebug On
</Directory>

And the permisions of the files and directory are ugo+rx but when i probe this i get

"The requested URL /python/GetMonth.py was not found on this server."

Anyone idea?

Thanks.



From terry.macdonald at dsl.pipex.com  Thu Nov  9 05:36:32 2006
From: terry.macdonald at dsl.pipex.com (Terry Macdonald)
Date: Thu Nov  9 05:37:00 2006
Subject: [mod_python] publisher the requested URL /python/GetMonth.py
	was not found on this server.
In-Reply-To: <20061109111920.1c4219bc@localhost.localdomain>
References: <mailman.12268.1163067170.11769.mod_python@modpython.org>
	<20061109111920.1c4219bc@localhost.localdomain>
Message-ID: <455304B0.8030308@dsl.pipex.com>

N?stor Chac?n Manzano wrote:
>     <form method='POST' action='python/getMonth'>
>
> "The requested URL /python/GetMonth.py was not found on this server."
>
>   
...is their a case problem you are calling getMonth and the error says cannot find GetMonth


From nchacon at caton.es  Thu Nov  9 05:35:06 2006
From: nchacon at caton.es (=?ISO-8859-15?Q?N=E9stor_Chac=F3n?= Manzano)
Date: Thu Nov  9 05:40:07 2006
Subject: [mod_python] publisher the requested URL /python/GetMonth.py
	was not found on this server.
In-Reply-To: <455304B0.8030308@dsl.pipex.com>
References: <mailman.12268.1163067170.11769.mod_python@modpython.org>
	<20061109111920.1c4219bc@localhost.localdomain>
	<455304B0.8030308@dsl.pipex.com>
Message-ID: <20061109113506.70e60dcf@localhost.localdomain>

On Thu, 09 Nov 2006 10:36:32 +0000
Terry Macdonald <terry.macdonald@dsl.pipex.com> wrote:

> N?stor Chac?n Manzano wrote:
> >     <form method='POST' action='python/getMonth'>
> >
> > "The requested URL /python/GetMonth.py was not found on this server."
> >
> >   
> ...is their a case problem you are calling getMonth and the error says cannot find GetMonth
> 
> 
Sorry, it is my mystake whe i write the email, the real error is

The requested URL /python/getMonth.py was not found on this server.


From terry.macdonald at dsl.pipex.com  Thu Nov  9 05:40:50 2006
From: terry.macdonald at dsl.pipex.com (Terry Macdonald)
Date: Thu Nov  9 05:41:10 2006
Subject: [mod_python] publisher the requested URL /python/GetMonth.py
	was not found on this server.
In-Reply-To: <20061109111920.1c4219bc@localhost.localdomain>
References: <mailman.12268.1163067170.11769.mod_python@modpython.org>
	<20061109111920.1c4219bc@localhost.localdomain>
Message-ID: <455305B2.9000102@dsl.pipex.com>

N?stor Chac?n Manzano wrote:
> Hello, i' am newer in mod_python.
> I try to probe this example:
> <html>
>   <head>
>     <title>Prueba mod_python</title>
>   </head>
>   <body>
>     <form method='POST' action='python/getMonth'>
>       <p>
>       <hr>
>       <br />
>       Selecciona el mes: <br />
>       <select name='month'>
>         <option value='1'>Enero</option>
>         <option value='2'>Febrero</option>
>         <option value='3'>Marzo</option>
> 	(...)
>       </select>
>       </p>
>       <br />
>       <input type='submit' value="Muestra el mes">
>     </form>
>   </body>
> </html>
>
> In /var/www/python/ i have the script getMonth.py
>
> import calendar
> from mod_python import apache
> def getMonth(req,month):
>   req.write(calendar.month(2006,int(month),2,3))
>
> My /etc/apache/apache2.conf have this entry:
>
> <Directory /var/www/python>
>         SetHandler mod_python 
>         PythonHandler mod_python.publisher
>         PythonDebug On
> </Directory>
>
> And the permisions of the files and directory are ugo+rx but when i probe this i get
>
> "The requested URL /python/GetMonth.py was not found on this server."
>
> Anyone idea?
>
> Thanks.
>
>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>   
otherwise try putting an alias in the apache conf of

Alias /python  /var/www/python
From clodoaldo.pinto at gmail.com  Thu Nov  9 05:42:18 2006
From: clodoaldo.pinto at gmail.com (Clodoaldo Pinto Neto)
Date: Thu Nov  9 05:42:33 2006
Subject: [mod_python] publisher the requested URL /python/GetMonth.py was
	not found on this server.
In-Reply-To: <20061109111920.1c4219bc@localhost.localdomain>
References: <mailman.12268.1163067170.11769.mod_python@modpython.org>
	<20061109111920.1c4219bc@localhost.localdomain>
Message-ID: <a595de7a0611090242o2681bfd1sa1832652e61793f5@mail.gmail.com>

2006/11/9, N?stor Chac?n Manzano <nchacon@caton.es>:
> Hello, i' am newer in mod_python.
> I try to probe this example:

If you want to mantain this:

   <form method='POST' action='python/getMonth'>

You will have to rename getMonth.py to index.py or rename the function
getMonth() to index()

Otherwise you will have to use:

   <form method='POST' action='python/getMonth/getMonth'>

Regards, Clodoaldo Pinto Neto

From terry.macdonald at dsl.pipex.com  Thu Nov  9 05:49:54 2006
From: terry.macdonald at dsl.pipex.com (Terry Macdonald)
Date: Thu Nov  9 05:50:05 2006
Subject: [mod_python] publisher the requested URL /python/GetMonth.py
	was	not found on this server.
In-Reply-To: <a595de7a0611090242o2681bfd1sa1832652e61793f5@mail.gmail.com>
References: <mailman.12268.1163067170.11769.mod_python@modpython.org>	<20061109111920.1c4219bc@localhost.localdomain>
	<a595de7a0611090242o2681bfd1sa1832652e61793f5@mail.gmail.com>
Message-ID: <455307D2.8090905@dsl.pipex.com>

Clodoaldo Pinto Neto wrote:
> 2006/11/9, N?stor Chac?n Manzano <nchacon@caton.es>:
>> Hello, i' am newer in mod_python.
>> I try to probe this example:
>
> If you want to mantain this:
>
>   <form method='POST' action='python/getMonth'>
>
> You will have to rename getMonth.py to index.py or rename the function
> getMonth() to index()
>
> Otherwise you will have to use:
>
>   <form method='POST' action='python/getMonth/getMonth'>
>
> Regards, Clodoaldo Pinto Neto
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
Doh, I always miss that one.  I'll shut up then!!
From tyctor at post.cz  Thu Nov  9 07:03:57 2006
From: tyctor at post.cz (=?us-ascii?Q?viktor=20vraniak?=)
Date: Thu Nov  9 07:04:05 2006
Subject: [mod_python] mod_python application stoped serve pages
Message-ID: <1197.5599-31607-1816945144-1163073837@post.cz>

hallo

i am using mod_python 3.2.10 with apache 2.0.58. i am running one python application.
i wrote  simple handler for it.
everything working fine but today happend one thing which i cant understand where can be problem.

my application suddenly stop responding. 
but it was only python application, php application on te same server still worked good.

i try to stop start apache, but it didnot solve the problem.
i try to reboot machine, and after reboot everything working fine as before.

can it be a mod_python problem?
can you advice me how can i diagnose where the problem occurs?

thank for any answer

viktor vraniak

From julien.coron at free.fr  Thu Nov  9 08:24:40 2006
From: julien.coron at free.fr (julien.coron@free.fr)
Date: Thu Nov  9 07:56:48 2006
Subject: [mod_python] mod_python logo
Message-ID: <1163078680.45532c18a6329@imp8-g19.free.fr>

Hi,
I am a new user of mod_python and made a small tutorial for french beginners
of your software.
For this, I made a small logo (It uses the new python logo).


Bye,
Julien CORON


-------------- next part --------------
A non-text attachment was scrubbed...
Name: mod_python.png
Type: image/png
Size: 26433 bytes
Desc: not available
Url : http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20061109/367c905a/mod_python-0001.png
From julien.coron at free.fr  Thu Nov  9 08:33:26 2006
From: julien.coron at free.fr (julien.coron@free.fr)
Date: Thu Nov  9 08:08:29 2006
Subject: [mod_python] loglevel
Message-ID: <1163079206.45532e26b0f09@imp8-g19.free.fr>

Hi,

I want to send some messages to the log file, but none under "error" are traced:

apache.log_error("This is an ERROR", apache.APLOG_ERR)
apache.log_error("This is an INFO", apache.APLOG_INFO)
apache.log_error("This is a DEBUG", apache.APLOG_DEBUG)

...even if I set the loglevel of apache to "debug".


Is there a way to set the loglevel of mod_python to "debug" and the apache one
to "error" ?


Julien CORON
From jpg at jgassociates.ca  Thu Nov  9 08:09:21 2006
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Thu Nov  9 08:09:34 2006
Subject: [mod_python] mod_python application stoped serve pages
In-Reply-To: <1197.5599-31607-1816945144-1163073837@post.cz>
References: <1197.5599-31607-1816945144-1163073837@post.cz>
Message-ID: <45532881.1050000@jgassociates.ca>

viktor vraniak wrote:
> hallo
> 
> i am using mod_python 3.2.10 with apache 2.0.58. i am running one python application.
> i wrote  simple handler for it.
> everything working fine but today happend one thing which i cant understand where can be problem.
> 
> my application suddenly stop responding. 
> but it was only python application, php application on te same server still worked good.
> 
> i try to stop start apache, but it didnot solve the problem.
> i try to reboot machine, and after reboot everything working fine as before.
> 
> can it be a mod_python problem?
> can you advice me how can i diagnose where the problem occurs?

There is not enough information here to help you. Have you looked in the 
  Apache error_log?

Jim




From davidf at sjsoft.com  Thu Nov  9 08:52:27 2006
From: davidf at sjsoft.com (David Fraser)
Date: Thu Nov  9 08:53:31 2006
Subject: [mod_python] mod_python logo
In-Reply-To: <1163078680.45532c18a6329@imp8-g19.free.fr>
References: <1163078680.45532c18a6329@imp8-g19.free.fr>
Message-ID: <4553329B.1040109@sjsoft.com>

julien.coron@free.fr wrote:
> Hi,
> I am a new user of mod_python and made a small tutorial for french beginners
> of your software.
> For this, I made a small logo (It uses the new python logo).
>
>
> Bye,
> Julien CORON
>   
Hi Julien

Cool :-)
I like the idea you have used, but I think it would be nice to have an 
icon that could more easily scale down (to be used as a favicon for the 
site, etc).
I wonder how good it would look to simply overlay the Apache feather and 
the new Python logo

David
From list at joreybump.com  Thu Nov  9 09:09:50 2006
From: list at joreybump.com (Jorey Bump)
Date: Thu Nov  9 09:09:57 2006
Subject: [mod_python] publisher the requested URL /python/GetMonth.py
	was not found on this server.
In-Reply-To: <20061109111920.1c4219bc@localhost.localdomain>
References: <mailman.12268.1163067170.11769.mod_python@modpython.org>
	<20061109111920.1c4219bc@localhost.localdomain>
Message-ID: <455336AE.5000607@joreybump.com>

N?stor Chac?n Manzano wrote:
> Hello, i' am newer in mod_python.
> I try to probe this example:
> <html>
>   <head>
>     <title>Prueba mod_python</title>
>   </head>
>   <body>
>     <form method='POST' action='python/getMonth'>
>       <p>
>       <hr>
>       <br />
>       Selecciona el mes: <br />
>       <select name='month'>
>         <option value='1'>Enero</option>
>         <option value='2'>Febrero</option>
>         <option value='3'>Marzo</option>
> 	(...)
>       </select>
>       </p>
>       <br />
>       <input type='submit' value="Muestra el mes">
>     </form>
>   </body>
> </html>
> 
> In /var/www/python/ i have the script getMonth.py
> 
> import calendar
> from mod_python import apache
> def getMonth(req,month):
>   req.write(calendar.month(2006,int(month),2,3))
> 
> My /etc/apache/apache2.conf have this entry:
> 
> <Directory /var/www/python>
>         SetHandler mod_python 
>         PythonHandler mod_python.publisher
>         PythonDebug On
> </Directory>
> 
> And the permisions of the files and directory are ugo+rx but when i probe this i get
> 
> "The requested URL /python/GetMonth.py was not found on this server."
> 
> Anyone idea?

This is the default behaviour of Publisher. Modules are *not* 
publishable objects, only certain types of objects within them may be 
published.

Objects that are published:
===========================

Strings:

  hello = "Hello, Bruce!"

Lists and tuples:

  order = ['spam', 'spam', 'spam', 'spam', 'eggs', 'spam']

Dictionaries:

  color = {'Lance': 'blue', 'Galahad': 'yellow', 'Robin': None}

Instances (publishable attributes & methods):

  instance = MyClass

Functions (only the output):

  def hello(req):
      return "Hello, Bruce!"


Objects that are not published:
===============================

Objects named with leading underscore:

  _secret = "BIGsecret"

Classes:

  class MyClass:
      def __init__(self):
         self.attribute = "I can be published when I'm an instance."
      def function(self):
          return "Ocarina"

Objects within a function:

  def hello(req):
      name = "Michael Baldwin"
      return "Hello, Bruce!"

Imported modules and their objects (put the data into a publishable 
object first):

  import os

The module itself:

  test.py


This list is not exhaustive, I'm sure I've missed some objects. 
Publisher will produce a variety of errors or unusable output, depending 
on the object. Unfortunately, one of these is the somewhat misleading 
"not found" error when attempting to access the published module itself.

Note that you generally do not need to import apache or use req.write in 
you Publisher modules. Simply return a string:

import calendar
def getMonth(req,month):
     return calendar.month(2006,int(month),2,3)

And access it at:

  http://host/python/GetMonth/GetMonth


From jpg at jgassociates.ca  Thu Nov  9 09:32:38 2006
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Thu Nov  9 09:32:06 2006
Subject: [mod_python] mod_python logo
In-Reply-To: <1163078680.45532c18a6329@imp8-g19.free.fr>
References: <1163078680.45532c18a6329@imp8-g19.free.fr>
Message-ID: <45533C06.1060603@jgassociates.ca>

julien.coron@free.fr wrote:
> Hi,
> I am a new user of mod_python and made a small tutorial for french beginners
> of your software.
> For this, I made a small logo (It uses the new python logo).

Nice! You might want to lighten the blue sunbeams (or whatever they are) 
a little as both the feather and the python puzzle pieces are a little 
washed out.

On the other hand , there could be trademark issues in using both the 
Apache feather and the Python logo. :(

Jim

From steve at holdenweb.com  Thu Nov  9 09:55:46 2006
From: steve at holdenweb.com (Steve Holden)
Date: Thu Nov  9 09:55:05 2006
Subject: [mod_python] Re: mod_python logo
In-Reply-To: <45533C06.1060603@jgassociates.ca>
References: <1163078680.45532c18a6329@imp8-g19.free.fr>
	<45533C06.1060603@jgassociates.ca>
Message-ID: <eivffc$qh2$1@sea.gmane.org>

Jim Gallacher wrote:
> julien.coron@free.fr wrote:
>> Hi,
>> I am a new user of mod_python and made a small tutorial for french 
>> beginners
>> of your software.
>> For this, I made a small logo (It uses the new python logo).
> 
> Nice! You might want to lighten the blue sunbeams (or whatever they are) 
> a little as both the feather and the python puzzle pieces are a little 
> washed out.
> 
> On the other hand , there could be trademark issues in using both the 
> Apache feather and the Python logo. :(
> 
I'm afraid that could be the case. You'd probably be safest getting 
approval from the PSF and the ASF if you want to incorporate those 
graphics into a logo.

As a director of the PSF I can point you to

   http://www.python.org/psf/trademarks/

as a guideline to what would be considered acceptable. Email to 
psf-board@python.org should get you a fairly swift response. I happen to 
know there's a Board meeting next Monday.

regards
  Steve
-- 
Steve Holden       +44 150 684 7255  +1 800 494 3119
Holden Web LLC/Ltd          http://www.holdenweb.com
Skype: holdenweb       http://holdenweb.blogspot.com
Recent Ramblings     http://del.icio.us/steve.holden

From nchacon at caton.es  Thu Nov  9 10:13:22 2006
From: nchacon at caton.es (=?ISO-8859-15?Q?N=E9stor_Chac=F3n?= Manzano)
Date: Thu Nov  9 10:17:48 2006
Subject: [mod_python] how to write response in same page
In-Reply-To: <1197.5599-31607-1816945144-1163073837@post.cz>
References: <1197.5599-31607-1816945144-1163073837@post.cz>
Message-ID: <20061109161322.54c05ebf@localhost.localdomain>

Hello, i have a little form

<form action="python/cgi-bin/getFile" method="post" enctype="multipart/form-data">
   	<input type="file" name="file" />
   	<input type="submit" name="submit" value="Subir" />
</form> 

in /var/www/python/ i have the script that get the information

from mod_python import apache
def getFile(req, file=None):
     req.content_type = "text/html" 
     if file is None:
          req.write("Datos Nulos")
      if type(file) is str:
          req.write("Datos Err?neos")
      fileData = file.file.read()    
      if fileData:
	f=open("/tmp/archivo","w")
	f.write(fileData)
	f.close()
	req.write(str(dir(req)))
      else:
	req.write("Archivo vac?o")

When the process executes the "req.write" appears the menssage in a new ( reloaded ) window.
How i can for write the menssage in the same window ( with not reload ) ?

Thanks


From MCStoufer at lbl.gov  Thu Nov  9 13:23:01 2006
From: MCStoufer at lbl.gov (Martin Stoufer)
Date: Thu Nov  9 13:23:10 2006
Subject: [mod_python] loglevel
In-Reply-To: <1163079206.45532e26b0f09@imp8-g19.free.fr>
References: <1163079206.45532e26b0f09@imp8-g19.free.fr>
Message-ID: <45537205.6050609@lbl.gov>

Julien,
    This is stored in the httpd.conf file for apache. Look for 
"LogLevel" and change it so it includes the 'error' level. You may also 
want to look at any specialized logging parameters for the Directory you 
are serving content from. For this look for the "LogFormat". Someone may 
have redirected error messages to another log file.



julien.coron@free.fr wrote:
> Hi,
>
> I want to send some messages to the log file, but none under "error" are traced:
>
> apache.log_error("This is an ERROR", apache.APLOG_ERR)
> apache.log_error("This is an INFO", apache.APLOG_INFO)
> apache.log_error("This is a DEBUG", apache.APLOG_DEBUG)
>
> ...even if I set the loglevel of apache to "debug".
>
>
> Is there a way to set the loglevel of mod_python to "debug" and the apache one
> to "error" ?
>
>
> Julien CORON
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>   

-- 
* Martin C. Stoufer              *
* DST/DIDC/ITG                   *
* Lawrence Berkeley National Lab *
* MS 50B-2239 510-486-8662       *

-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/x-pkcs7-signature
Size: 3423 bytes
Desc: S/MIME Cryptographic Signature
Url : http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20061109/0d37f354/smime.bin
From grahamd at dscpl.com.au  Thu Nov  9 16:19:53 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Thu Nov  9 16:19:57 2006
Subject: [mod_python] mod_python application stoped serve pages
Message-ID: <1163107193.16937@dscpl.user.openhosting.com>

=?us-ascii?Q?viktor=20vraniak?= wrote ..
> hallo
> 
> i am using mod_python 3.2.10 with apache 2.0.58. i am running one python
> application.
> i wrote  simple handler for it.
> everything working fine but today happend one thing which i cant understand
> where can be problem.
> 
> my application suddenly stop responding. 
> but it was only python application, php application on te same server still
> worked good.
> 
> i try to stop start apache, but it didnot solve the problem.
> i try to reboot machine, and after reboot everything working fine as before.
> 
> can it be a mod_python problem?
> can you advice me how can i diagnose where the problem occurs?

As Jim suggested, ensure you look in the Apache error log file for any hints
as to what happened.

One possibility if you are using sessions in your mod_python code is
that the operating system had some issue with how mod_python/Apache
is using semaphore locks across processes to control access to certain
stuff, for example the operating system ran out of resources.

Another possibility, again if using sessions is that your session database
in /tmp got corrupted in some way and was causing problems. A reboot
would have cleared what was in /tmp and resolved any issue automatically.

That is probably all I can think of without more information.

Graham
From grahamd at dscpl.com.au  Thu Nov  9 16:39:17 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Thu Nov  9 16:39:25 2006
Subject: [mod_python] how to write response in same page
Message-ID: <1163108357.25748@dscpl.user.openhosting.com>

=?ISO-8859-15?Q?N=E9stor_Chac=F3n?= Manzano wrote ..
> Hello, i have a little form
> 
> <form action="python/cgi-bin/getFile" method="post" enctype="multipart/form-data">
>    	<input type="file" name="file" />
>    	<input type="submit" name="submit" value="Subir" />
> </form> 
> 
> in /var/www/python/ i have the script that get the information
> 
> from mod_python import apache
> def getFile(req, file=None):
>      req.content_type = "text/html" 
>      if file is None:
>           req.write("Datos Nulos")
>       if type(file) is str:
>           req.write("Datos Err?neos")
>       fileData = file.file.read()    
>       if fileData:
> 	f=open("/tmp/archivo","w")
> 	f.write(fileData)
> 	f.close()
> 	req.write(str(dir(req)))
>       else:
> 	req.write("Archivo vac?o")
> 
> When the process executes the "req.write" appears the menssage in a new
> ( reloaded ) window.
> How i can for write the menssage in the same window ( with not reload )
> ?

If I understand what you want correctly, only by embedding some fancy
Javascript in your pages which does sub requests and partial page updates
by manipulating the already drawn page.

I would suggest you do some research into what AJAX is all about. You
might start with the WikiPedia entry:

  http://en.wikipedia.org/wiki/Ajax_(programming)

and go from there.

Graham
From gregor.kling at dvz.fh-giessen.de  Fri Nov 10 04:53:28 2006
From: gregor.kling at dvz.fh-giessen.de (Gregor Kling)
Date: Fri Nov 10 04:54:05 2006
Subject: [mod_python] Session-Handling mod_publisher
Message-ID: <45544C18.2060803@dvz.fh-giessen.de>

Hello,

Once upon the time I used hidden fields for session tracking.
Now I want to use Cookies in combination with the FileSession class for
that.
The problem is how to assure the cookie was successfully added by the
browser.
Is there an idiom ?
Can I do something like that:
def start(req):
c = Cookie.Cookie('foobar',expires='')
Cookie.add_cookie(req, c)
t = get_cookies(req,Cookie,foobar)
if t:
go_on
else:
leave

-- 
Gregor Kling

DV-Zentrum
Fachhochschule Giessen
Tel: 0641/309-1292
E-Mail: gregor.kling@dvz.fh-giessen.de
From durumdara at gmail.com  Fri Nov 10 06:15:19 2006
From: durumdara at gmail.com (durumdara)
Date: Fri Nov 10 06:15:25 2006
Subject: [mod_python] BUG - modpython and setlocale hu
Message-ID: <45545F47.50208@gmail.com>

Hi !

When I set locale to hu, the Session handler broken.
Possible caused by that hun locale uses "," for dec. separator, not ".".
The error msg was:

[Fri Nov 10 12:04:55 2006] [error] [client 127.0.0.1] Traceback (most 
recent call last):\n\n  File "c:/web/zweb/htdocs\\__accesshandler.py", 
line 28, in accesshandler\n    ss = Session.DbmSession(req)\n\n  File 
"C:\\Python24\\lib\\site-packages\\mod_python\\Session.py", line 337, in 
__init__\n    timeout=timeout, lock=lock)\n\n  File 
"C:\\Python24\\lib\\site-packages\\mod_python\\Session.py", line 166, in 
__init__\n    if self.load():\n\n  File 
"C:\\Python24\\lib\\site-packages\\mod_python\\Session.py", line 225, in 
load\n    dict = self.do_load()\n\n  File 
"C:\\Python24\\lib\\site-packages\\mod_python\\Session.py", line 361, in 
do_load\n    return cPickle.loads(dbm[self._sid])\n\nValueError: could 
not convert string to float\n


dd
From gregor.kling at dvz.fh-giessen.de  Fri Nov 10 07:02:46 2006
From: gregor.kling at dvz.fh-giessen.de (Gregor Kling)
Date: Fri Nov 10 07:03:22 2006
Subject: [mod_python] publisher cgi
In-Reply-To: <D7E5C001-FDD9-4038-80EF-A94D25A23C8E@dscpl.com.au>
References: <45506AA5.5040205@dvz.fh-giessen.de>
	<D7E5C001-FDD9-4038-80EF-A94D25A23C8E@dscpl.com.au>
Message-ID: <45546A66.2060305@dvz.fh-giessen.de>

Graham Dumpleton wrote:
> 
> On 07/11/2006, at 10:14 PM, Gregor Kling wrote:
> 
>> -----BEGIN PGP SIGNED MESSAGE-----
>> Hash: SHA1
>>
>> Hello,
>>
>> With a short glimpse at mod_python's publisher default handler, I
>> assume I have to use 'raw' cgi's, if i have variable form data ?
> 
> To clarify one point. The publisher extension handler for mod_python
> is not the default handler. Instead it builds on top of the basic handler
> mechanism of mod_python. How you use publisher is different to
> basic handlers in mod_python.
> 
Sorry for being ambiguous. Sure mod_python's publisher is not the
default handler.

-- 
Gregor Kling

DV-Zentrum
Fachhochschule Giessen
Tel: 0641/309-1292
E-Mail: gregor.kling@dvz.fh-giessen.de
From jpg at jgassociates.ca  Fri Nov 10 08:09:13 2006
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Fri Nov 10 08:09:58 2006
Subject: [mod_python] BUG - modpython and setlocale hu
In-Reply-To: <45545F47.50208@gmail.com>
References: <45545F47.50208@gmail.com>
Message-ID: <455479F9.6060200@jgassociates.ca>

durumdara wrote:
> Hi !
> 
> When I set locale to hu, the Session handler broken.
> Possible caused by that hun locale uses "," for dec. separator, not ".".
> The error msg was:
> 
> [Fri Nov 10 12:04:55 2006] [error] [client 127.0.0.1] Traceback (most 
> recent call last):\n\n  File "c:/web/zweb/htdocs\\__accesshandler.py", 
> line 28, in accesshandler\n    ss = Session.DbmSession(req)\n\n  File 
> "C:\\Python24\\lib\\site-packages\\mod_python\\Session.py", line 337, in 
> __init__\n    timeout=timeout, lock=lock)\n\n  File 
> "C:\\Python24\\lib\\site-packages\\mod_python\\Session.py", line 166, in 
> __init__\n    if self.load():\n\n  File 
> "C:\\Python24\\lib\\site-packages\\mod_python\\Session.py", line 225, in 
> load\n    dict = self.do_load()\n\n  File 
> "C:\\Python24\\lib\\site-packages\\mod_python\\Session.py", line 361, in 
> do_load\n    return cPickle.loads(dbm[self._sid])\n\nValueError: could 
> not convert string to float\n

I'm not sure this is a mod_python problem, since it is just loading the 
pickle here. Could you test cPickle directly from a command line 
interpreter and see what happens.

Jim

From julien.coron at free.fr  Fri Nov 10 08:18:33 2006
From: julien.coron at free.fr (julien.coron@free.fr)
Date: Fri Nov 10 08:18:41 2006
Subject: [mod_python] loglevel
In-Reply-To: <45537205.6050609@lbl.gov>
References: <1163079206.45532e26b0f09@imp8-g19.free.fr>
	<45537205.6050609@lbl.gov>
Message-ID: <1163164713.45547c29d2c93@imp4-g19.free.fr>

Hi Martin,

Allright for the loglevel, but is there a way to set the loglevel of apache to
"error" and the loglevel of mod_python to "info" ?




Selon Martin Stoufer <MCStoufer@lbl.gov>:

> Julien,
>     This is stored in the httpd.conf file for apache. Look for
> "LogLevel" and change it so it includes the 'error' level. You may also
> want to look at any specialized logging parameters for the Directory you
> are serving content from. For this look for the "LogFormat". Someone may
> have redirected error messages to another log file.
>
>
>
> julien.coron@free.fr wrote:
> > Hi,
> >
> > I want to send some messages to the log file, but none under "error" are
> traced:
> >
> > apache.log_error("This is an ERROR", apache.APLOG_ERR)
> > apache.log_error("This is an INFO", apache.APLOG_INFO)
> > apache.log_error("This is a DEBUG", apache.APLOG_DEBUG)
> >
> > ...even if I set the loglevel of apache to "debug".
> >
> >
> > Is there a way to set the loglevel of mod_python to "debug" and the apache
> one
> > to "error" ?
> >
> >
> > Julien CORON
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://mailman.modpython.org/mailman/listinfo/mod_python
> >
>
> --
> * Martin C. Stoufer              *
> * DST/DIDC/ITG                   *
> * Lawrence Berkeley National Lab *
> * MS 50B-2239 510-486-8662       *
>
>


From julien.coron at free.fr  Fri Nov 10 08:36:28 2006
From: julien.coron at free.fr (julien.coron@free.fr)
Date: Fri Nov 10 08:36:34 2006
Subject: [mod_python] set the content-type
Message-ID: <1163165788.4554805c99577@imp4-g19.free.fr>

Hi,

Someone can explain me why the following line works well:

request.content_type = 'text/html'


But this not:

request.headers_out.add("Content-Type","text/html")


and seems to be "httpd/unix-directory"...


Julien
From gregor.kling at dvz.fh-giessen.de  Fri Nov 10 10:09:25 2006
From: gregor.kling at dvz.fh-giessen.de (Gregor Kling)
Date: Fri Nov 10 10:10:03 2006
Subject: [mod_python] Session-Handling mod_publisher
In-Reply-To: <45544C18.2060803@dvz.fh-giessen.de>
References: <45544C18.2060803@dvz.fh-giessen.de>
Message-ID: <45549625.2080102@dvz.fh-giessen.de>

This works:
def start(req):
  c = Cookie.Cookie('HasCookie',"")
  c.expires = time.time() + 60
  Cookie.add_cookie(req,c)
  login_file  =  open('login.html').read() # calls login
  return login_file

def login(req):
  coo = Cookie.get_cookies(req)
  if coo.has_key("hasCookie"):
	dothis
  else:
	dothat

-- 
Gregor Kling

DV-Zentrum
Fachhochschule Giessen
Tel: 0641/309-1292
E-Mail: gregor.kling@dvz.fh-giessen.de
From durumdara at gmail.com  Fri Nov 10 10:10:20 2006
From: durumdara at gmail.com (durumdara)
Date: Fri Nov 10 10:10:29 2006
Subject: [mod_python] Working example for custom errordocuments...
Message-ID: <4554965C.5050504@gmail.com>

Hi !

I want to customize my site's ErrorDocuments.
I want to create static pages.
Can I do it ?
Is apache supports the templates to put some dynamic data to the error 
page ?
Example: 404.html and the [wrong path].

Or I need to create my *.py document to handle these variables ?

Have anybody a working example in this theme ?

Thanks for it !

    dd

From administrator at leebrown.org  Fri Nov 10 10:42:48 2006
From: administrator at leebrown.org (Lee Brown)
Date: Fri Nov 10 10:43:20 2006
Subject: [mod_python] Working example for custom errordocuments...
In-Reply-To: <4554965C.5050504@gmail.com>
Message-ID: <01e501c704de$e02488d0$0301a8c0@uberbox>

Greetings!

You can write a custom error page handler for mod python, or you can use
Apache's SSI (server-Side Includes) in conjunction with a static template.

I have a single, static web page template that uses SSI to generate an error
page for all common HTTP errors.  I also use mod security to trap the common
patterns of script-kiddie nonsense.

For examples, have a look at www.fearelesse-shakespeare.org/fred
(non-existent page)
and www.fearelesse-shakespeare.org/cmd.exe (possible script attack)

While a static web page using SSI is not a mod python issue per se, I'll
gladly publish the source to the list if others would like to see it.

Best Regards,
Lee E. Brown
(administrator@leebrown.org)

-----Original Message-----
From: mod_python-bounces@modpython.org
[mailto:mod_python-bounces@modpython.org] On Behalf Of durumdara
Sent: Friday, November 10, 2006 10:10 AM
To: Mod_python@modpython.org
Subject: [mod_python] Working example for custom errordocuments...

Hi !

I want to customize my site's ErrorDocuments.
I want to create static pages.
Can I do it ?
Is apache supports the templates to put some dynamic data to the error page
?
Example: 404.html and the [wrong path].

Or I need to create my *.py document to handle these variables ?

Have anybody a working example in this theme ?

Thanks for it !

    dd

_______________________________________________
Mod_python mailing list
Mod_python@modpython.org
http://mailman.modpython.org/mailman/listinfo/mod_python

From sdavis2 at mail.nih.gov  Fri Nov 10 11:01:15 2006
From: sdavis2 at mail.nih.gov (Sean Davis)
Date: Fri Nov 10 11:01:19 2006
Subject: [mod_python] Working example for custom errordocuments...
In-Reply-To: <01e501c704de$e02488d0$0301a8c0@uberbox>
References: <01e501c704de$e02488d0$0301a8c0@uberbox>
Message-ID: <200611101101.15768.sdavis2@mail.nih.gov>

On Friday 10 November 2006 10:42, Lee Brown wrote:
> While a static web page using SSI is not a mod python issue per se, I'll
> gladly publish the source to the list if others would like to see it.

OK.  I'll bite, as having a nice, simple, and static page is convenient and 
easy to maintain.  

Thanks,
Sean
From administrator at leebrown.org  Fri Nov 10 11:46:00 2006
From: administrator at leebrown.org (Lee Brown)
Date: Fri Nov 10 11:46:28 2006
Subject: [mod_python] Working example for custom errordocuments...
In-Reply-To: <200611101101.15768.sdavis2@mail.nih.gov>
Message-ID: <01e601c704e7$b45515e0$0301a8c0@uberbox>

Greetings!

Page template and Apache Vhost snippet attached.

Enjoy! 

Best Regards,
Lee E. Brown
(administrator@leebrown.org)

-----Original Message-----
From: mod_python-bounces@modpython.org
[mailto:mod_python-bounces@modpython.org] On Behalf Of Sean Davis
Sent: Friday, November 10, 2006 11:01 AM
To: mod_python@modpython.org
Subject: Re: [mod_python] Working example for custom errordocuments...

On Friday 10 November 2006 10:42, Lee Brown wrote:
> While a static web page using SSI is not a mod python issue per se, 
> I'll gladly publish the source to the list if others would like to see it.

OK.  I'll bite, as having a nice, simple, and static page is convenient and
easy to maintain.  

Thanks,
Sean
_______________________________________________
Mod_python mailing list
Mod_python@modpython.org
http://mailman.modpython.org/mailman/listinfo/mod_python
-------------- next part --------------
A non-text attachment was scrubbed...
Name: error.shtml
Type: application/octet-stream
Size: 7272 bytes
Desc: not available
Url : http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20061110/a0a6270d/error.obj
-------------- next part --------------
<VirtualHost *:80>
	
	SSIStartTag "<%"
	SSIEndTag "%>"
	SSIErrorMsg '<!-- SSI ERROR -->'
	
	<Directory "C:/webdev/sites/fearelesse/error/">
        	Options IncludesNOEXEC
        	AddOutputFilter Includes .shtml
	</Directory>
	
	Alias /error/ "C:/webdev/sites/fearelesse/error/"
	
	ErrorDocument 400 /error/error.shtml
	ErrorDocument 401 /error/error.shtml
	ErrorDocument 403 /error/error.shtml
	ErrorDocument 404 /error/error.shtml
	ErrorDocument 405 /error/error.shtml
	ErrorDocument 408 /error/error.shtml
	ErrorDocument 410 /error/error.shtml
	ErrorDocument 411 /error/error.shtml
	ErrorDocument 412 /error/error.shtml
	ErrorDocument 413 /error/error.shtml
	ErrorDocument 414 /error/error.shtml
	ErrorDocument 415 /error/error.shtml
	ErrorDocument 500 /error/error.shtml
	ErrorDocument 501 /error/error.shtml
	ErrorDocument 502 /error/error.shtml
	ErrorDocument 503 /error/error.shtml
	ErrorDocument 506 /error/error.shtml
	
</VirtualHost>
From MCStoufer at lbl.gov  Fri Nov 10 12:44:59 2006
From: MCStoufer at lbl.gov (Martin Stoufer)
Date: Fri Nov 10 12:45:18 2006
Subject: [mod_python] loglevel
In-Reply-To: <1163164713.45547c29d2c93@imp4-g19.free.fr>
References: <1163079206.45532e26b0f09@imp8-g19.free.fr>
	<45537205.6050609@lbl.gov>
	<1163164713.45547c29d2c93@imp4-g19.free.fr>
Message-ID: <4554BA9B.4010802@lbl.gov>

As I recall, the apache.log_error() method is a direct wrapper to the 
Apache logging API.   By setting the LogLevel to 'debug'  in httpd.conf, 
you should be seeing all messages. If you have it set at 'error', you 
will be ignoring "info" logged from mod_python.

I have not seen anything inside mod_python that will allow you 
arbitrarily set a logging level threshold.

BTW, are you logging to the syslog mechanism, or to the apache logs? 
There may be a block in the syslog.conf dropping the messages.

julien.coron@free.fr wrote:
> Hi Martin,
>
> Allright for the loglevel, but is there a way to set the loglevel of apache to
> "error" and the loglevel of mod_python to "info" ?
>
>
>
>
> Selon Martin Stoufer <MCStoufer@lbl.gov>:
>
>   
>> Julien,
>>     This is stored in the httpd.conf file for apache. Look for
>> "LogLevel" and change it so it includes the 'error' level. You may also
>> want to look at any specialized logging parameters for the Directory you
>> are serving content from. For this look for the "LogFormat". Someone may
>> have redirected error messages to another log file.
>>
>>
>>
>> julien.coron@free.fr wrote:
>>     
>>> Hi,
>>>
>>> I want to send some messages to the log file, but none under "error" are
>>>       
>> traced:
>>     
>>> apache.log_error("This is an ERROR", apache.APLOG_ERR)
>>> apache.log_error("This is an INFO", apache.APLOG_INFO)
>>> apache.log_error("This is a DEBUG", apache.APLOG_DEBUG)
>>>
>>> ...even if I set the loglevel of apache to "debug".
>>>
>>>
>>> Is there a way to set the loglevel of mod_python to "debug" and the apache
>>>       
>> one
>>     
>>> to "error" ?
>>>
>>>
>>> Julien CORON
>>> _______________________________________________
>>> Mod_python mailing list
>>> Mod_python@modpython.org
>>> http://mailman.modpython.org/mailman/listinfo/mod_python
>>>
>>>       
>> --
>> * Martin C. Stoufer              *
>> * DST/DIDC/ITG                   *
>> * Lawrence Berkeley National Lab *
>> * MS 50B-2239 510-486-8662       *
>>
>>
>>     
>
>   

-- 
* Martin C. Stoufer              *
* DST/DIDC/ITG                   *
* Lawrence Berkeley National Lab *
* MS 50B-2239 510-486-8662       *

-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/x-pkcs7-signature
Size: 3423 bytes
Desc: S/MIME Cryptographic Signature
Url : http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20061110/3ed51daa/smime.bin
From jpg at jgassociates.ca  Fri Nov 10 15:35:15 2006
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Fri Nov 10 15:35:18 2006
Subject: [mod_python] loglevel
In-Reply-To: <4554BA9B.4010802@lbl.gov>
References: <1163079206.45532e26b0f09@imp8-g19.free.fr>	<45537205.6050609@lbl.gov>	<1163164713.45547c29d2c93@imp4-g19.free.fr>
	<4554BA9B.4010802@lbl.gov>
Message-ID: <4554E283.80201@jgassociates.ca>

Martin Stoufer wrote:
> As I recall, the apache.log_error() method is a direct wrapper to the 
> Apache logging API.   By setting the LogLevel to 'debug'  in httpd.conf, 
> you should be seeing all messages. If you have it set at 'error', you 
> will be ignoring "info" logged from mod_python.
> 
> I have not seen anything inside mod_python that will allow you 
> arbitrarily set a logging level threshold.

You are correct on both points.

Jim
From julien.coron at free.fr  Sat Nov 11 12:38:52 2006
From: julien.coron at free.fr (julien coron)
Date: Sat Nov 11 12:39:03 2006
Subject: [mod_python] loglevel
In-Reply-To: <4554BA9B.4010802@lbl.gov>
References: <1163079206.45532e26b0f09@imp8-g19.free.fr>
	<45537205.6050609@lbl.gov> <1163164713.45547c29d2c93@imp4-g19.free.fr>
	<4554BA9B.4010802@lbl.gov>
Message-ID: <76C4F396-7B38-4BF5-AC29-0BD0C7337620@free.fr>

Martin,

I would like to log my python handler only, not Apache. There is also  
no output when I try to do "print 'this is a log message' ".
The next try will be to use an other logger to manage that.

Thanks,
Julien

Le 10 nov. 06 ? 18:44, Martin Stoufer a ?crit :

> As I recall, the apache.log_error() method is a direct wrapper to  
> the Apache logging API.   By setting the LogLevel to 'debug'  in  
> httpd.conf, you should be seeing all messages. If you have it set  
> at 'error', you will be ignoring "info" logged from mod_python.
>
> I have not seen anything inside mod_python that will allow you  
> arbitrarily set a logging level threshold.
>
> BTW, are you logging to the syslog mechanism, or to the apache  
> logs? There may be a block in the syslog.conf dropping the messages.
>
> julien.coron@free.fr wrote:
>> Hi Martin,
>>
>> Allright for the loglevel, but is there a way to set the loglevel  
>> of apache to
>> "error" and the loglevel of mod_python to "info" ?
>>
>>
>>
>>
>> Selon Martin Stoufer <MCStoufer@lbl.gov>:
>>
>>
>>> Julien,
>>>     This is stored in the httpd.conf file for apache. Look for
>>> "LogLevel" and change it so it includes the 'error' level. You  
>>> may also
>>> want to look at any specialized logging parameters for the  
>>> Directory you
>>> are serving content from. For this look for the "LogFormat".  
>>> Someone may
>>> have redirected error messages to another log file.
>>>
>>>
>>>
>>> julien.coron@free.fr wrote:
>>>
>>>> Hi,
>>>>
>>>> I want to send some messages to the log file, but none under  
>>>> "error" are
>>>>
>>> traced:
>>>
>>>> apache.log_error("This is an ERROR", apache.APLOG_ERR)
>>>> apache.log_error("This is an INFO", apache.APLOG_INFO)
>>>> apache.log_error("This is a DEBUG", apache.APLOG_DEBUG)
>>>>
>>>> ...even if I set the loglevel of apache to "debug".
>>>>
>>>>
>>>> Is there a way to set the loglevel of mod_python to "debug" and  
>>>> the apache
>>>>
>>> one
>>>
>>>> to "error" ?
>>>>
>>>>
>>>> Julien CORON
>>>> _______________________________________________
>>>> Mod_python mailing list
>>>> Mod_python@modpython.org
>>>> http://mailman.modpython.org/mailman/listinfo/mod_python
>>>>
>>>>
>>> --
>>> * Martin C. Stoufer              *
>>> * DST/DIDC/ITG                   *
>>> * Lawrence Berkeley National Lab *
>>> * MS 50B-2239 510-486-8662       *
>>>
>>>
>>>
>>
>>
>
> -- 
> * Martin C. Stoufer              *
> * DST/DIDC/ITG                   *
> * Lawrence Berkeley National Lab *
> * MS 50B-2239 510-486-8662       *
>


From grahamd at dscpl.com.au  Sat Nov 11 20:06:36 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Sat Nov 11 20:06:47 2006
Subject: [mod_python] loglevel
In-Reply-To: <76C4F396-7B38-4BF5-AC29-0BD0C7337620@free.fr>
References: <1163079206.45532e26b0f09@imp8-g19.free.fr>
	<45537205.6050609@lbl.gov>
	<1163164713.45547c29d2c93@imp4-g19.free.fr>
	<4554BA9B.4010802@lbl.gov>
	<76C4F396-7B38-4BF5-AC29-0BD0C7337620@free.fr>
Message-ID: <F6DDE39F-AF37-4FE9-8E1F-B5C700A1C52A@dscpl.com.au>


On 12/11/2006, at 4:38 AM, julien coron wrote:
> I would like to log my python handler only, not Apache.

If you want to do something that isn't normal, then don't expect it
to do what you want. ;-)

> There is also no output when I try to do "print 'this is a log  
> message' ".

Correct. You shouldn't use 'print' in handlers as stdout stream of  
Apache
isn't guaranteed to go anywhere. If you go sys.stdout.flush() after
using 'print', if you are lucky it will end up in the Apache error log.

Where were you expecting it to go? Remember that Apache is generally
run as a daemon process and so it doesn't have a terminal to output
stuff to.

> The next try will be to use an other logger to manage that.

You probably want to investigate the 'logging' module in Python. If you
use that to log messages, you can then provide your own log handler
which logs either to the Apache error log file or to some other file of
your own. If you search the Internet properly, am sure you will find
examples of log handlers for log files already. There may even be one
in the logging module for all I know. In doing a separate log file  
through,
release that the logging system you use must support multiple processes
logging to it at the same time.

> Thanks,
> Julien
>
> Le 10 nov. 06 ? 18:44, Martin Stoufer a ?crit :
>
>> As I recall, the apache.log_error() method is a direct wrapper to  
>> the Apache logging API.   By setting the LogLevel to 'debug'  in  
>> httpd.conf, you should be seeing all messages. If you have it set  
>> at 'error', you will be ignoring "info" logged from mod_python.
>>
>> I have not seen anything inside mod_python that will allow you  
>> arbitrarily set a logging level threshold.
>>
>> BTW, are you logging to the syslog mechanism, or to the apache  
>> logs? There may be a block in the syslog.conf dropping the messages.
>>
>> julien.coron@free.fr wrote:
>>> Hi Martin,
>>>
>>> Allright for the loglevel, but is there a way to set the loglevel  
>>> of apache to
>>> "error" and the loglevel of mod_python to "info" ?
>>>
>>>
>>>
>>>
>>> Selon Martin Stoufer <MCStoufer@lbl.gov>:
>>>
>>>
>>>> Julien,
>>>>     This is stored in the httpd.conf file for apache. Look for
>>>> "LogLevel" and change it so it includes the 'error' level. You  
>>>> may also
>>>> want to look at any specialized logging parameters for the  
>>>> Directory you
>>>> are serving content from. For this look for the "LogFormat".  
>>>> Someone may
>>>> have redirected error messages to another log file.
>>>>
>>>>
>>>>
>>>> julien.coron@free.fr wrote:
>>>>
>>>>> Hi,
>>>>>
>>>>> I want to send some messages to the log file, but none under  
>>>>> "error" are
>>>>>
>>>> traced:
>>>>
>>>>> apache.log_error("This is an ERROR", apache.APLOG_ERR)
>>>>> apache.log_error("This is an INFO", apache.APLOG_INFO)
>>>>> apache.log_error("This is a DEBUG", apache.APLOG_DEBUG)
>>>>>
>>>>> ...even if I set the loglevel of apache to "debug".
>>>>>
>>>>>
>>>>> Is there a way to set the loglevel of mod_python to "debug" and  
>>>>> the apache
>>>>>
>>>> one
>>>>
>>>>> to "error" ?
>>>>>
>>>>>
>>>>> Julien CORON
>>>>> _______________________________________________
>>>>> Mod_python mailing list
>>>>> Mod_python@modpython.org
>>>>> http://mailman.modpython.org/mailman/listinfo/mod_python
>>>>>
>>>>>
>>>> --
>>>> * Martin C. Stoufer              *
>>>> * DST/DIDC/ITG                   *
>>>> * Lawrence Berkeley National Lab *
>>>> * MS 50B-2239 510-486-8662       *
>>>>
>>>>
>>>>
>>>
>>>
>>
>> -- 
>> * Martin C. Stoufer              *
>> * DST/DIDC/ITG                   *
>> * Lawrence Berkeley National Lab *
>> * MS 50B-2239 510-486-8662       *
>>
>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python

From grahamd at dscpl.com.au  Sat Nov 11 20:20:28 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Sat Nov 11 20:20:42 2006
Subject: [mod_python] loglevel
In-Reply-To: <F6DDE39F-AF37-4FE9-8E1F-B5C700A1C52A@dscpl.com.au>
References: <1163079206.45532e26b0f09@imp8-g19.free.fr>
	<45537205.6050609@lbl.gov>
	<1163164713.45547c29d2c93@imp4-g19.free.fr>
	<4554BA9B.4010802@lbl.gov>
	<76C4F396-7B38-4BF5-AC29-0BD0C7337620@free.fr>
	<F6DDE39F-AF37-4FE9-8E1F-B5C700A1C52A@dscpl.com.au>
Message-ID: <60660D12-DFC4-498F-AB98-8797104B2660@dscpl.com.au>


On 12/11/2006, at 12:06 PM, Graham Dumpleton wrote:

>> The next try will be to use an other logger to manage that.
>
> You probably want to investigate the 'logging' module in Python. If  
> you
> use that to log messages, you can then provide your own log handler
> which logs either to the Apache error log file or to some other  
> file of
> your own. If you search the Internet properly, am sure you will find
> examples of log handlers for log files already. There may even be one
> in the logging module for all I know. In doing a separate log file  
> through,
> release that the logging system you use must support multiple  
> processes
> logging to it at the same time.

Forgot to add this link:

   http://www.modpython.org/pipermail/mod_python/2005-October/ 
019296.html

This is a log handler for the 'logging' module which sends stuff to  
the Apache
error log. Use the search box on the mod_python web site to search back
through the mailing list for other discussion on this stuff.

Graham
From grahamd at dscpl.com.au  Sat Nov 11 20:37:02 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Sat Nov 11 20:37:11 2006
Subject: [mod_python] set the content-type
In-Reply-To: <1163165788.4554805c99577@imp4-g19.free.fr>
References: <1163165788.4554805c99577@imp4-g19.free.fr>
Message-ID: <E9FBA66F-67CF-421C-8114-1F565614C38F@dscpl.com.au>


On 11/11/2006, at 12:36 AM, julien.coron@free.fr wrote:

> Hi,
>
> Someone can explain me why the following line works well:
>
> request.content_type = 'text/html'
>
>
> But this not:
>
> request.headers_out.add("Content-Type","text/html")
>
>
> and seems to be "httpd/unix-directory"...

Because that is how Apache works. Specifically, the default header  
output
filter for the HTTP protocol in Apache takes the value of  
req.content_type
and saves it in the header as 'Content-Type' header.

Thus, if you set the header yourself, it will be overridden by  
whatever the
value of req.content_type is. In the above example, the request URL
matched to a directory and therefore the inbound content type as  
determined
by Apache was 'httpd/unix-directory'. Note that it even produces this  
on Win32
because of the heritage of Apache being written for UNIX first.

In summary, if you need to set the outbound content type use  
req.content_type.

Graham
From grahamd at dscpl.com.au  Sat Nov 11 22:00:32 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Sat Nov 11 22:00:41 2006
Subject: [mod_python] Session-Handling mod_publisher
In-Reply-To: <45544C18.2060803@dvz.fh-giessen.de>
References: <45544C18.2060803@dvz.fh-giessen.de>
Message-ID: <851AD478-8F53-4A8A-8D11-45D57184C335@dscpl.com.au>


On 10/11/2006, at 8:53 PM, Gregor Kling wrote:

> Hello,
>
> Once upon the time I used hidden fields for session tracking.
> Now I want to use Cookies in combination with the FileSession class  
> for
> that.
> The problem is how to assure the cookie was successfully added by the
> browser.
> Is there an idiom ?
> Can I do something like that:
> def start(req):
> c = Cookie.Cookie('foobar',expires='')
> Cookie.add_cookie(req, c)
> t = get_cookies(req,Cookie,foobar)
> if t:
> go_on
> else:
> leave

Why use cookies directly? Why not use the Session class instead as
underneath it does the cookie stuff for you. You also should not use
FileSession directly either. Always use Session.Session() to get the
reference to the session object and use the PythonOption to specify
the type of session to use.

BTW, if you dump out req.headers_out you can verify that the output
headers are setup correctly with the cookie stuff.

Graham
From gregor.kling at dvz.fh-giessen.de  Sun Nov 12 05:47:07 2006
From: gregor.kling at dvz.fh-giessen.de (Gregor Kling)
Date: Sun Nov 12 05:47:12 2006
Subject: [mod_python] Session-Handling mod_publisher
In-Reply-To: <851AD478-8F53-4A8A-8D11-45D57184C335@dscpl.com.au>
References: <45544C18.2060803@dvz.fh-giessen.de>
	<851AD478-8F53-4A8A-8D11-45D57184C335@dscpl.com.au>
Message-ID: <4556FBAB.4090405@dvz.fh-giessen.de>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Graham Dumpleton wrote:

> Why use cookies directly? 
I do not want to begin a session, before I can guarantee that the client
browser does accepting cookies.The session begins after the user
succeeded in login in.


> Why not use the Session class instead as
Indeed I do use Session, but as said, after the assurance.
> underneath it does the cookie stuff for you. You also should not use
> FileSession directly either. Always use Session.Session() to get the
> reference to the session object and use the PythonOption to specify
> the type of session to use.
Ok.
> 
> BTW, if you dump out req.headers_out you can verify that the output
> headers are setup correctly with the cookie stuff.
Thanks for this tip.

gregor.


-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.5 (GNU/Linux)

iD8DBQFFVvuqJFHWQ694uCYRAnNdAKCB7rp7ZHwTcds9Au9tTAM1YkHerQCfXSep
+wKaVckSEGpuDtTslbgFYt4=
=in4F
-----END PGP SIGNATURE-----
From g.farina at pharaondev.com  Mon Nov 13 04:01:53 2006
From: g.farina at pharaondev.com (g.farina@pharaondev.com)
Date: Mon Nov 13 04:01:58 2006
Subject: [mod_python] Newbie Questions
Message-ID: <49298.83.103.96.60.1163408513.squirrel@webmail.pharaondev.com>

Hi

I just started to develop with modpython and I have some questions about
quite simple topics.
First of all, correct me if I wrong, I read that modpython works as a
layer between Apache APIs and Python scripts: when apache needs an handler
for a particular operation, it asks modpython for this handler and
modpython returns it based on some configurations.
Is that right?

Based on this considerations, I have some questions:
1 - There is a way to call some code only when modpython is called for the
first time ? I have to load a huge configuration file, and I'd like to do
it only once and share the loaded object with all the handlers.
2 - I have to implement a simple MVC framework that uses a mechaninc
similar to the Publisher handler. But I need to interact with the object
that will be published, capturing the data returned by some functions and
sharing singleton among them. Previously I loaded the files using exec but
now I can't do that due to this reasons. Using import (or the imp module)
is not the right way because I'd like the memory used by the controllers
to be freed when the execution stops. There is a way to do that ?
3 - Modpython starts a subinterpreter for every call to the handler ?

Thanks,
Gabriele

From mateusz at ant.gliwice.pl  Mon Nov 13 04:10:48 2006
From: mateusz at ant.gliwice.pl (Mateusz Korniak)
Date: Mon Nov 13 04:10:26 2006
Subject: [mod_python] Newbie Questions
In-Reply-To: <49298.83.103.96.60.1163408513.squirrel@webmail.pharaondev.com>
References: <49298.83.103.96.60.1163408513.squirrel@webmail.pharaondev.com>
Message-ID: <200611131010.48257.mateusz@ant.gliwice.pl>

On Monday 13 November 2006 10:01, g.farina@pharaondev.com wrote:
> 1 - There is a way to call some code only when modpython is called for the
> first time ? I have to load a huge configuration file, and I'd like to do
> it only once and share the loaded object with all the handlers.

Code executed during module import is executed once per each apache process at 
time of first request.

> 3 - Modpython starts a subinterpreter for every call to the handler ?

There is one python interpreter per each apache process.

-- 
Mateusz Korniak
From grahamd at dscpl.com.au  Mon Nov 13 05:15:05 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Mon Nov 13 05:15:14 2006
Subject: [mod_python] Newbie Questions
In-Reply-To: <49298.83.103.96.60.1163408513.squirrel@webmail.pharaondev.com>
References: <49298.83.103.96.60.1163408513.squirrel@webmail.pharaondev.com>
Message-ID: <5442D91F-38AB-4B92-95B0-827369551022@dscpl.com.au>


On 13/11/2006, at 8:01 PM, g.farina@pharaondev.com wrote:

> Hi
>
> I just started to develop with modpython and I have some questions  
> about
> quite simple topics.

Not necessarily simple, as for some they open a can of worms. :-)

> First of all, correct me if I wrong, I read that modpython works as a
> layer between Apache APIs and Python scripts: when apache needs an  
> handler
> for a particular operation, it asks modpython for this handler and
> modpython returns it based on some configurations.
> Is that right?

Not exactly. Apache doesn't strictly ask mod_python for a handler.
For certain Apache request handling phases, the Python*Handler
directives are used to register mod_python handlers. The registration
causes Apache to actually pass handling of the request through to
mod_python at that point and mod_python invokes the handler.
The handler can simply return a status value, or it could write actual
content back for the response via the request object.

In the case of the actual response handler phase, it is also necessary
to tell Apache that the mod_python handler should be used in that
case. This is traditionally done using the SetHandler/AddHandler
directives. See:

   https://www.dscpl.com.au/wiki/ModPython/Articles/ 
SetHandlerVersusAddHandler

for more information.

> Based on this considerations, I have some questions:
> 1 - There is a way to call some code only when modpython is called  
> for the
> first time ?

The PythonImport directive allows one to specify modules that should
be imported at the time that the Apache child process is first created
and prior to any actual request being processed by that process.

> I have to load a huge configuration file, and I'd like to do
> it only once and share the loaded object with all the handlers.

It isn't that simple. If you do such a thing only at process start  
and as a
direct side effect of the import and the import fails but you always  
expect
it to work, the only way to recover is by restarting Apache.

In general it is still better to wait until the first request arrives  
and perform
the import at that point, but not as a side effect of the import, but by
calling a function which performs the load of any configuration data.
If a failure occurs, you can flag the loading of the configuration as  
having
failed in some way and thus retry it on subsequent requests in case the
failure was caused by a transient problem such as a database issue etc.

When mod_python 3.3 is available you will be able to mix the two
approaches by using a new ability in 3.3 to have a function optionally
called after PythonImport is used to import the module. This avoids  
issues
with failure during the actual import and more easily allows one to
recover from a failure.

You still have to be a bit careful where automatic reloading of modules
is enabled. This is because in current versions of mod_python data
can be overwritten and lost or simply lost on reloads. In mod_python 3.3
there is a proper way of maintaining data across reloads. This would
allow one to possibly avoid reloading the configuration if code files
giving access to it are changed.

> 2 - I have to implement a simple MVC framework that uses a mechaninc
> similar to the Publisher handler. But I need to interact with the  
> object
> that will be published, capturing the data returned by some  
> functions and
> sharing singleton among them.

The simplest thing to do is to pass the mod_python request object  
between
functions. You can store references to other data in the request object.
If the object you put in the request object is a transient object it  
will be
automatically reclaimed when the request processing is finished.

> Previously I loaded the files using exec but
> now I can't do that due to this reasons. Using import (or the imp  
> module)

In mod_python, if you need to load modules from specific locations,
you should use apache.import_module(). See:

   https://www.dscpl.com.au/wiki/ModPython/Articles/ 
BasicsOfModuleImporting

Module importing does have some problems with current versions of
mod_python though. See:

   https://www.dscpl.com.au/wiki/ModPython/Articles/ 
ModuleImportingIsBroken

Module importing is fixed up in mod_python 3.3.

> is not the right way because I'd like the memory used by the  
> controllers
> to be freed when the execution stops. There is a way to do that ?

It depends on to what level you expect to be able to free memory. Python
will obviously free up some stuff for you automatically, but if you  
expect
to be able to unload a module then no. You will need to be more specific
about your expectations. See my above comment about using the request
object as the means to provide access to stuff that any code used to
service a request needs.

> 3 - Modpython starts a subinterpreter for every call to the handler ?

No, mod_python does not start a sub interpreter for every call. Once an
interpreter instance is created it is retained for the life of the  
Apache
child process. There can still be multiple interpreter instances in a
process. These might be assigned against different virtual hosts or  
parts
of the URL namespace. Situations in which distinct interpreters are
created are controlled by PythonInterpreter, PythonInterPer* directives.

For a bit more information on the process/interpreter model of Apache
and mod_python read:

   https://www.dscpl.com.au/wiki/ModPython/Articles/ 
TheProcessInterpreterModel

Graham
From martijn at xs4us.nu  Mon Nov 13 10:33:11 2006
From: martijn at xs4us.nu (Martijn Moeling)
Date: Mon Nov 13 10:33:21 2006
Subject: [mod_python] Mod Python Programmers in Holland?
Message-ID: <B6C73A5E30565245BB6D32B5F5DF7A520BEDBA@sense.emmastraat.pijnacker>

Hi,

 

It might be a little off topic, if so sorry for that I am having a hard
time finding what I need....

 

I am building a web application framework, which is being used in a
production environment for almost a year now.

In January 2007 the original goal of starting this development is going
to be open for the public and more projects are waiting for me to start
on it.

Since I only have one head and one pair of hands I am looking for python
programmers with mod_python knowledge. Additionally good cross browser
knowledge of HTML, 

HTML-DOM, javascript and MySQL (and some basic Linux skills) is needed.
Most of the work will be the implementation of business logic but the
framework needs to be expanded too.

 

Expect to be working in an open and innovative environment where each
team member is expected to think forward and out of the box as my system
is changing the way browsers are used. 

 

You don't need be an academic or highly experienced, Motivation and
willing to learn (and the ability to do that quickly) is more important
as well as being honest

 

If you are interested, drop me an email with motivation and reference
projects. You must Speak Dutch but your email must be in English since I
need to see your English writing skills (all documentation will be in
English), there is no real hurry and expect work to start in the 2nd
quarter of 2007 but if things go wrong I will need you yesterday!!,

 

Work location will be Pijnacker (near Delft), the Netherlands

 

Kind regards,

 

Martijn Moeling

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20061113/af1ac706/attachment.html
From fred at adventistcare.org  Mon Nov 13 10:44:14 2006
From: fred at adventistcare.org (Sells, Fred)
Date: Mon Nov 13 10:35:27 2006
Subject: [mod_python] XP 3.2.8 install problem.
Message-ID: <1A4BF05172023E468CB6E867923BC90402B6E365@accmail2.sunbelt.org>

Tring to get compatible installation between my XP notebook and corporate
RedHat server.

Both are apache 2.0, Python 2.3.  under XP I've installed mod_python 3.2.8
using the mod_python-3.2.8.win32-py2.3.exe.  There is a mod_python.so file
in the modules directory with a date of 2/20/06 (I just installed today?)
with a size of 81,920 bytes.

When I add the following to httpd.conf (it is on line 173), 

LoadModule mod_python modules/mod_python.so

I get this error when starting Apache

C:\Program Files\Apache Group\Apache2\bin>apache
Syntax error on line 173 of C:/Program Files/Apache
Group/Apache2/conf/httpd.conf:
Can't locate API module structure `mod_python' in file C:/Program
Files/Apache Group/Apache2/modules/mod_python.so: 
No error

I have no idea where to go or what to try next.


---------------------------------------------------------------------------
The information contained in this message may be privileged and / or
confidential and protected from disclosure. If the reader of this message is
not the intended recipient, you are hereby notified that any dissemination,
distribution or copying of this communication is strictly prohibited. If you
have received this communication in error, please notify the sender
immediately by replying to this message and deleting the material from any
computer.
---------------------------------------------------------------------------

From grahamd at dscpl.com.au  Mon Nov 13 16:01:59 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Mon Nov 13 16:02:08 2006
Subject: [mod_python] Newbie Questions
Message-ID: <1163451719.356@dscpl.user.openhosting.com>

Please keep the discussion on the mod_python mailing list.

g.farina@pharaondev.com wrote ..
> Thanks
> your answers really helped me a lot. I think I'll pass the request object
> (or better a wrapper over it) to the controllers. then I have only to be
> sure that the controllers does not retain references (but week) to this
> object to be sure it is free automatically by mod_python.

The need to not hold references to the request object beyond the
life of the request is actually quite important. This is because the
internal Apache structures which it wraps will be destroyed regardless
at the end of the request. If you keep around the request object
and after the request has completed try to access it, you can
potentially crash the Apache child process.

> Another shourt question: how can I get the content-type of a request ?
> Using req.content_type or this property is used only for writing the
> response content-type ?

The req.content_type attribute will be populated by Apache for
a request based on what it can determine about the type of
resource being requested. For example, if you are using PSP
and have added to your Apache configuration:

  AddType text/html .psp

so that Apache knows that a request of a .psp file will result in
return of 'text/html' content, then req.content_type will already
be set for you before your response handler is run. I can't
remember what it sets it to if it can't work it out. It may even set
it to the value of the DefaultType directive already at that point.

The only tricky case is if the request mapped to a directory and
you are using SetHandler directive. In that case the value of
req.content_type will be 'httpd/unix-directory' regardless of
whether UNIX of Windows is used.

> > It depends on to what level you expect to be able to free memory. Python
> > will obviously free up some stuff for you automatically, but if you
> > expect
> > to be able to unload a module then no. You will need to be more specific
> > about your expectations. See my above comment about using the request
> > object as the means to provide access to stuff that any code used to
> > service a request needs.
> 
> I need to unload the controller (module) and be sure that all the
> submodules used are unloaded the same way.
> Any suggestions ?

Using apache.import_module() at least there is no way to unload a module
and in general it would be a very hard thing to achieve and potentially
dangerous to attempt depending on what your application does.

My question to you would be why you think you need to unload it? Having
to unload it every time would impact the performance and makes the idea
that the interpreter is persistent between requests allowing caching, to be
a pointless feature. If you want to unload stuff, you may as well just use CGI.

Note that if you want to unload it because you want any changes to code
to be picked up automatically, mod_python does have automatic module
reloading. It is a bit broken in current mod_python and you need to be
careful how you use it, but fixed in mod_python 3.3.

Graham
From grahamd at dscpl.com.au  Mon Nov 13 16:17:28 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Mon Nov 13 16:17:35 2006
Subject: [mod_python] XP 3.2.8 install problem.
Message-ID: <1163452648.10636@dscpl.user.openhosting.com>

Sells, Fred wrote ..
> Tring to get compatible installation between my XP notebook and corporate
> RedHat server.
> 
> Both are apache 2.0, Python 2.3.  under XP I've installed mod_python 3.2.8
> using the mod_python-3.2.8.win32-py2.3.exe.  There is a mod_python.so file
> in the modules directory with a date of 2/20/06 (I just installed today?)
> with a size of 81,920 bytes.
> 
> When I add the following to httpd.conf (it is on line 173), 
> 
> LoadModule mod_python modules/mod_python.so
> 
> I get this error when starting Apache
> 
> C:\Program Files\Apache Group\Apache2\bin>apache
> Syntax error on line 173 of C:/Program Files/Apache
> Group/Apache2/conf/httpd.conf:
> Can't locate API module structure `mod_python' in file C:/Program
> Files/Apache Group/Apache2/modules/mod_python.so: 
> No error
> 
> I have no idea where to go or what to try next.

Search back through the mailing list archives using the search box on
the mod_python web site for ideas.

Typical problems are:

- Can't find the MS C/C++ runtime library required by that version
of mod_python. This may be because it isn't installed, not in the
path or not got correct permissions access if running Apache as a
specific user.

- Using an incompatible version of Apache for mod_python version
being used. This might occur if you are using very latest Apache 2.0.X
as there were changes with version of Apache runtime library used.
You may have to use a slightly older version of Apache 2.0.X.

- Registry entries for Python are wrong and it can't find mod_python
Python bits. This usually though results in some errors in Apache
error log though.

Graham
From g.farina at pharaondev.com  Mon Nov 13 17:46:46 2006
From: g.farina at pharaondev.com (g.farina@pharaondev.com)
Date: Mon Nov 13 17:46:52 2006
Subject: [mod_python] Newbie Questions
In-Reply-To: <1163451719.356@dscpl.user.openhosting.com>
References: <1163451719.356@dscpl.user.openhosting.com>
Message-ID: <28601.82.56.77.83.1163458006.squirrel@webmail.pharaondev.com>

> Please keep the discussion on the mod_python mailing list.

Sorry, I wrong when answering from the webmail

Thanks for the answers

From durumdara at gmail.com  Tue Nov 14 04:52:24 2006
From: durumdara at gmail.com (durumdara)
Date: Tue Nov 14 04:52:32 2006
Subject: [mod_python] How to format ssi dates ?
Message-ID: <455991D8.2070606@gmail.com>

Hi !

1.)
Thanks for the SSI examples (to custom ErrorPages) !

2.)
I want to uniformize the local datetime.

<td>Id?:</td><td><!--#echo var="DATE_LOCAL" --></td>

("Id?" is "Time" in english)

The result in SSI:
Id?: Monday, 13-Nov-2006 14:34:54 K?z?p-eur?pai t?li id?
(Time: Monday, 13-Nov-2006 14:34:54 Central-European Winter Time)

This is mixed time string. The Monday, and the datetime format is 
english, another texts are hungarian.
How to force YYYY.MM.DD hh:mm:ss timestamp format in my SSI page ?

WXP, Py2.3.4, Apache 2.2.3.

Thanks for your help:
dd





From grahamd at dscpl.com.au  Tue Nov 14 05:06:50 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Tue Nov 14 05:06:57 2006
Subject: [mod_python] How to format ssi dates ?
In-Reply-To: <455991D8.2070606@gmail.com>
References: <455991D8.2070606@gmail.com>
Message-ID: <52560192-78CC-47EE-B63F-E75FD54301BA@dscpl.com.au>


On 14/11/2006, at 8:52 PM, durumdara wrote:

> Hi !
>
> 1.)
> Thanks for the SSI examples (to custom ErrorPages) !
>
> 2.)
> I want to uniformize the local datetime.
>
> <td>Id?:</td><td><!--#echo var="DATE_LOCAL" --></td>
>
> ("Id?" is "Time" in english)
>
> The result in SSI:
> Id?: Monday, 13-Nov-2006 14:34:54 K?z?p-eur?pai t?li id?
> (Time: Monday, 13-Nov-2006 14:34:54 Central-European Winter Time)
>
> This is mixed time string. The Monday, and the datetime format is  
> english, another texts are hungarian.
> How to force YYYY.MM.DD hh:mm:ss timestamp format in my SSI page ?

Have you tried looking at the SSI documentation on the Apache web site?

   http://httpd.apache.org/docs/2.2/howto/ssi.html

Specifically, look for:

   <!--#config timefmt="%A %B %d, %Y" -->
    Today is <!--#echo var="DATE_LOCAL" -->

The format string for time is based on what system strftime()  
function takes.
You can look at what these generally are by looking at the Python  
strftime()
documentation, although that isn't what is actually being used here.

   http://docs.python.org/lib/module-time.html

Graham
From durumdara at gmail.com  Tue Nov 14 07:12:22 2006
From: durumdara at gmail.com (durumdara)
Date: Tue Nov 14 07:12:34 2006
Subject: [mod_python] Accesshandler and normal handler... how they working ?
Message-ID: <4559B2A6.9060409@gmail.com>

Hi !

I have an access handler, and a normal python handler in my site.
I use directories, and some of them are need protection. I use my login
method to enable user access.

The access handler is check the needed rights to any object. It get user
data from Session.
When access granted, it finished it's working.
When access denied, it send http403 error, and I catch this with custom
error documents (ssi).

But I want to know something - the background of access handler.

1.)
The access handler is existing in same Thread as Handler ?
So I want to know. Is modpy do this:
get url, server info, etc.
build request + other objects
get thread
result = thread.startaccesshandler(req)
if not result:
  gotoerrorhandler
else:
  result = thread.handler(req)
....
or it use another technology ?

2.)
Can I exchange some data across them ?
In this time I use file based right table(s).
Every file in this table has right property.
I need to load this table in the accesshandler to check grants.
And later, in the menu building I also need to load this table to check
grants (the menus are not accessable by user are hided).
Can I share these infos ? Can I write to the request object, and this
object is hold these infos to get them in normal handler ?

3.)
Can I force the access handler to redirect request ?
Example: the user click on menu that preserved for special users. I
don't want to redirect to error pages. Can I redirect to my special
page, or it is useable only in normal handler ?


Thanks for your help:
    dd






From richardlewis at fastmail.co.uk  Tue Nov 14 07:34:39 2006
From: richardlewis at fastmail.co.uk (Richard Lewis)
Date: Tue Nov 14 07:34:50 2006
Subject: [mod_python] whole site handlers and authentication
Message-ID: <200611141234.39648.richardlewis@fastmail.co.uk>

Hi there,

I'm thinking of providing an HTTP interface for database editting and was 
wondering about how to use authentication.

Currently, my mod_python MySQL-backed site uses a handler inside a VirtualHost 
which handles all requests like this:

<VirtualHost [ipaddr]:80>
    ServerName www.sara.uea.ac.uk
    DocumentRoot /var/webapps/sara

    SetHandler mod_python
    PythonPath 'sys.path+["/var/webapps/sara"]'

    PythonHandler sara.web
</VirtualHost>

meaning that all requests are handled by the sara.web module. (This module 
uses URI regular expression pattern matching etc. etc. so request URI paths 
don't map to the server directory layout in any way.)

I plan to implement a URI-controlled API where all "commands" will begin 
with "/edit/". And I want to provide authentication for these commands (I 
have a MySQL user database). Because I have this "whole site" handler, will 
it be possible to use standard authentication directives? And will it be 
possible to use the Directory directive for "/edit/" requests, as I don't 
have actual directories?

If not, will it be possible to implement authentication manually with 
mod_python using the HTTP specification:
http://www.ietf.org/rfc/rfc2617.txt
?

Any thoughts?

Cheers,
Richard
-- 
-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
Richard Lewis
Sonic Arts Research Archive
http://www.sara.uea.ac.uk/
JID: ironchicken@jabber.earth.li
-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
From list at joreybump.com  Tue Nov 14 09:17:50 2006
From: list at joreybump.com (Jorey Bump)
Date: Tue Nov 14 09:17:54 2006
Subject: [mod_python] whole site handlers and authentication
In-Reply-To: <200611141234.39648.richardlewis@fastmail.co.uk>
References: <200611141234.39648.richardlewis@fastmail.co.uk>
Message-ID: <4559D00E.2080306@joreybump.com>

Richard Lewis wrote:

> I plan to implement a URI-controlled API where all "commands" will begin 
> with "/edit/". And I want to provide authentication for these commands (I 
> have a MySQL user database). Because I have this "whole site" handler, will 
> it be possible to use standard authentication directives? And will it be 
> possible to use the Directory directive for "/edit/" requests, as I don't 
> have actual directories?

Use Location, not Directory.
From richardlewis at fastmail.co.uk  Tue Nov 14 09:39:53 2006
From: richardlewis at fastmail.co.uk (Richard Lewis)
Date: Tue Nov 14 09:40:08 2006
Subject: [mod_python] whole site handlers and authentication
In-Reply-To: <4559D00E.2080306@joreybump.com>
References: <200611141234.39648.richardlewis@fastmail.co.uk>
	<4559D00E.2080306@joreybump.com>
Message-ID: <200611141439.53785.richardlewis@fastmail.co.uk>

On Tuesday 14 November 2006 14:17, Jorey Bump wrote:
> Richard Lewis wrote:
> > I plan to implement a URI-controlled API where all "commands" will begin
> > with "/edit/". And I want to provide authentication for these commands (I
> > have a MySQL user database). Because I have this "whole site" handler,
> > will it be possible to use standard authentication directives? And will
> > it be possible to use the Directory directive for "/edit/" requests, as I
> > don't have actual directories?
>
> Use Location, not Directory.
>
OK. But what I mean is, will it ever be able to use the Location directive? If 
I have a Python handler processing /all/ requests under a VirtualHost I don't 
think there are any circumstances under which Apache will even consider the 
Location directive. Is that right?

And does anyone know if there are any tutorials on using HTTP authentication? 
Particularly with mod_python?

Cheers,
Richard
-- 
-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
Richard Lewis
Sonic Arts Research Archive
http://www.sara.uea.ac.uk/
JID: ironchicken@jabber.earth.li
-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
From jpg at jgassociates.ca  Tue Nov 14 10:31:34 2006
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Tue Nov 14 10:30:52 2006
Subject: [mod_python] whole site handlers and authentication
In-Reply-To: <200611141439.53785.richardlewis@fastmail.co.uk>
References: <200611141234.39648.richardlewis@fastmail.co.uk>	<4559D00E.2080306@joreybump.com>
	<200611141439.53785.richardlewis@fastmail.co.uk>
Message-ID: <4559E156.40906@jgassociates.ca>

Richard Lewis wrote:
> On Tuesday 14 November 2006 14:17, Jorey Bump wrote:
>> Richard Lewis wrote:
>>> I plan to implement a URI-controlled API where all "commands" will begin
>>> with "/edit/". And I want to provide authentication for these commands (I
>>> have a MySQL user database). Because I have this "whole site" handler,
>>> will it be possible to use standard authentication directives? And will
>>> it be possible to use the Directory directive for "/edit/" requests, as I
>>> don't have actual directories?
>> Use Location, not Directory.
>>
> OK. But what I mean is, will it ever be able to use the Location directive? If 
> I have a Python handler processing /all/ requests under a VirtualHost I don't 
> think there are any circumstances under which Apache will even consider the 
> Location directive. Is that right?

I don't think so. Directives in the Location context should override the
directives higher up in the VirtualHost context. Try something like this:


<Location /edit>
   PythonDebug On
   AuthType Basic
   AuthName "Restricted"
   Require valid-user
   PythonAuthenHandler foo.bar
</Location>


foo/bar.py looks something like this:

from mod_python import apache

def authenhandler(req):

     pw = req.get_basic_auth_pw()
     user = req.user
     if user == "spam" and pw == "eggs":
         return apache.OK
     else:
         return apache.HTTP_UNAUTHORIZED

As you are working in an earlier Apache processing phase, this will work 
to protect all resources under /edit, even if they are not handled by 
mod_python. It's a powerful thing.

Jim

From jpg at jgassociates.ca  Tue Nov 14 10:45:00 2006
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Tue Nov 14 10:44:11 2006
Subject: [mod_python] Accesshandler and normal handler... how they working
	?
In-Reply-To: <4559B2A6.9060409@gmail.com>
References: <4559B2A6.9060409@gmail.com>
Message-ID: <4559E47C.9030604@jgassociates.ca>

durumdara wrote:
> Hi !
> 
> I have an access handler, and a normal python handler in my site.
> I use directories, and some of them are need protection. I use my login
> method to enable user access.
> 
> The access handler is check the needed rights to any object. It get user
> data from Session.
> When access granted, it finished it's working.
> When access denied, it send http403 error, and I catch this with custom
> error documents (ssi).
> 
> But I want to know something - the background of access handler.
> 
> 1.)
> The access handler is existing in same Thread as Handler ?

Yes.

> So I want to know. Is modpy do this:
> get url, server info, etc.
> build request + other objects
> get thread
> result = thread.startaccesshandler(req)
> if not result:
>  gotoerrorhandler
> else:
>  result = thread.handler(req)
> ....
> or it use another technology ?

Unless I'm misunderstanding your question, you don't need to mess with 
threads. You are always dealing with the same request object, regardless 
of which phase, and there is one process or thread per request.

Take a look at the mod_python documentation for PythonAuthenHandler, as 
well as my reply to Richard Lewis today on a similar question.

> 2.)
> Can I exchange some data across them ?

Yes.

def authenhandler(req):
     req.foo = 'something for later'
     ...


def handler(req):
     req.write(req.foo)
     ...


> In this time I use file based right table(s).
> Every file in this table has right property.
> I need to load this table in the accesshandler to check grants.
> And later, in the menu building I also need to load this table to check
> grants (the menus are not accessable by user are hided).
> Can I share these infos ? Can I write to the request object, and this
> object is hold these infos to get them in normal handler ?

Yes.

> 3.)
> Can I force the access handler to redirect request ?

Yes.

> Example: the user click on menu that preserved for special users. I
> don't want to redirect to error pages. Can I redirect to my special
> page, 

Yes.

Jim
From grahamd at dscpl.com.au  Tue Nov 14 15:44:43 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Tue Nov 14 15:44:46 2006
Subject: [mod_python] How to format ssi dates ?
Message-ID: <1163537083.13505@dscpl.user.openhosting.com>

Bouncing this back to list in case anyone else has any ideas.

durumdara wrote ..
> Hi !
> 
> Sorry, but I forgot to write that config command is not working for me.
> 
> I try with this:
> <!--#config timefmt="%Y" --><!--#echo var="DATE_LOCAL" -->
> The result is:
> Tuesday, 14-Nov-2006 13:17:43 K??z??p-eur??pai t??li id??
> 
> <!--#config timefmt="%m %Y" --><!--#echo var="DATE_LOCAL" -->
> Tuesday, 14-Nov-2006 13:18:30 K??z??p-eur??pai t??li id??
> 
> Nothing happened !
> 
> Why ???
> 
> Thanks for your help:
>     dd
> 
> Graham Dumpleton wrote:
> >
> >
> >
> >   http://httpd.apache.org/docs/2.2/howto/ssi.html
> >
> > Specifically, look for:
> >
> >   <!--#config timefmt="%A %B %d, %Y" -->
> >    Today is <!--#echo var="DATE_LOCAL" -->
> >
> > The format string for time is based on what system strftime() function
> > takes.
> > You can look at what these generally are by looking at the Python 
> > strftime()
> > documentation, although that isn't what is actually being used here.
> >
> >   http://docs.python.org/lib/module-time.html
> >
> > Graham
From grahamd at dscpl.com.au  Tue Nov 14 16:46:11 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Tue Nov 14 16:46:14 2006
Subject: [mod_python] Accesshandler and normal handler... how they working
	?
Message-ID: <1163540770.9524@dscpl.user.openhosting.com>

durumdara wrote ..
> 1.)
> The access handler is existing in same Thread as Handler ?
> So I want to know. Is modpy do this:
> get url, server info, etc.
> build request + other objects
> get thread
> result = thread.startaccesshandler(req)
> if not result:
>   gotoerrorhandler
> else:
>   result = thread.handler(req)
> ....
> or it use another technology ?

For some background, read:

  http://162.105.203.19/apache-doc/24.htm

This book is about using Perl and C with Apache, but the description
in this section still applies to mod_python.

The introduction and request loop descriptions are most relevant.

> 3.)
> Can I force the access handler to redirect request ?
> Example: the user click on menu that preserved for special users. I
> don't want to redirect to error pages. Can I redirect to my special
> page, or it is useable only in normal handler ?

Just be aware that there is a bug in mod_python 3.2.10 and older where
external redirects are performed from within a handler other than the
response handler phase. See:

  http://issues.apache.org/jira/browse/MODPYTHON-140

You will need to look at how util.redirect() works, do the same thing but
make sure it returns apache.DONE and not apache.OK.

Use of internal redirects is okay if that is appropriate for what you want
to do, noting that after triggering the internal redirect, you again probably
need to return apache.DONE as you don't want later phases to run.

Graham
From durumdara at gmail.com  Wed Nov 15 02:22:09 2006
From: durumdara at gmail.com (durumdara)
Date: Wed Nov 15 02:22:16 2006
Subject: [mod_python] How to format ssi dates ?
In-Reply-To: <52560192-78CC-47EE-B63F-E75FD54301BA@dscpl.com.au>
References: <455991D8.2070606@gmail.com>
	<52560192-78CC-47EE-B63F-E75FD54301BA@dscpl.com.au>
Message-ID: <455AC021.9090703@gmail.com>

Hi !

Sorry, but I forgot to write that config command is not working for me.

I try with this:
<!--#config timefmt="%Y" --><!--#echo var="DATE_LOCAL" -->
The result is:
Tuesday, 14-Nov-2006 13:17:43 K?z?p-eur?pai t?li id?

<!--#config timefmt="%m %Y" --><!--#echo var="DATE_LOCAL" -->
Tuesday, 14-Nov-2006 13:18:30 K?z?p-eur?pai t?li id?

Nothing happened !

Why ???

Thanks for your help:
    dd

Graham Dumpleton wrote:
>
>
>
>   http://httpd.apache.org/docs/2.2/howto/ssi.html
>
> Specifically, look for:
>
>   <!--#config timefmt="%A %B %d, %Y" -->
>    Today is <!--#echo var="DATE_LOCAL" -->
>
> The format string for time is based on what system strftime() function 
> takes.
> You can look at what these generally are by looking at the Python 
> strftime()
> documentation, although that isn't what is actually being used here.
>
>   http://docs.python.org/lib/module-time.html
>
> Graham


From joseph.r.buehre at boeing.com  Wed Nov 15 12:11:22 2006
From: joseph.r.buehre at boeing.com (Buehre, Joseph R)
Date: Wed Nov 15 12:11:35 2006
Subject: [mod_python] Mod_python on HP-UX 11.11
In-Reply-To: <5c06fa770611021411v5f542d21r8544aa7849f0bcde@mail.gmail.com>
Message-ID: <C12C17049E23854783042B3D0F25BB67029B7D32@XCH-MW-2V2.mw.nos.boeing.com>

Sorry for the slow response, but I will re-compile and send the errors
as I move along.
To answer the first questions, yes Apache was compiled with --enable-so
and I am doing a 32 bit compile.

Thanks in advance.!


Thanks, 
Joe Buehre 
Mission Critical Systems Support 
314-791-9725

 mailto:joseph.r.buehre@boeing.com


-----Original Message-----
From: Deron Meranda [mailto:deron.meranda@gmail.com] 
Sent: Thursday, November 02, 2006 4:12 PM
To: Buehre, Joseph R
Cc: mod_python@modpython.org
Subject: Re: [mod_python] Mod_python on HP-UX 11.11

I think you replied to the wrong thread...

On 11/2/06, Buehre, Joseph R <joseph.r.buehre@boeing.com> wrote:
> I have tried consently to get mod_python to compile and create the .so

> file for Apache.  To date this has been an unsucessful adventure.  Has

> anyone done this type of install with HP-UX 11.11, Apache 2.0 and the 
> latest version of mod_python.  Desperately seeking insight.

I did get it working (but not heavily tested) with these parts...

  HP-UX 11.0
  Apache 2.2 (mpm_worker, dso)
  OpenSSL 0.9.8d
  Python 2.4.3
  GNU readline 5.1
  mod_python 3.2.10

Everything (except the OS of course) was compiled from sources with HP's
ANSI-C cc compiler in 32-bit mode.

I've since got python 2.5 working now, but I haven't tried recompiling
the mod_python against it.

Did you also compile httpd?  If so did you make sure you used the
--enable-so option to configure?  Are you by chance trying to compile
64-bit applications?  Can you provide more information, such as what
kind of errors you might be seeing.  What configure options you've
given, etc.

I know getting stuff to compile under HP-UX can in general be a real
pain.  I may have done some sort of magic, but I honestly can't remember
what I did exactly.  At least it's not AIX; that one always gives me
terrible fits.
--
Deron Meranda

From joseph.r.buehre at boeing.com  Wed Nov 15 12:28:40 2006
From: joseph.r.buehre at boeing.com (Buehre, Joseph R)
Date: Wed Nov 15 12:28:51 2006
Subject: [mod_python] Mod_python on HP-UX 11.11
In-Reply-To: <C12C17049E23854783042B3D0F25BB67029B7D32@XCH-MW-2V2.mw.nos.boeing.com>
Message-ID: <C12C17049E23854783042B3D0F25BB67029B7D35@XCH-MW-2V2.mw.nos.boeing.com>

HERE IS THE CONFIGURE RUN:

CC=cc CXX=aCC CFLAGS=+DD32 CXXFLAGS=+DD32
LDFLAGS=-L/opt/Boeing/python2.4.3/lib ./configure
--with-apxs=/wwimacs6/apache2/bin/apxs
--with-python=/opt/Boeing/python2.4.3/bin/python2.4

CONFIGURE RESULTS:

checking for gcc... cc
checking for C compiler default output file name... a.out
checking whether the C compiler works... yes
checking whether we are cross compiling... no
checking for suffix of executables...
checking for suffix of object files... o
checking whether we are using the GNU C compiler... no
checking whether cc accepts -g... yes
checking for cc option to accept ANSI C... none needed
checking for ar... ar
checking for a BSD-compatible install... /opt/imake/bin/install -c
checking whether make sets $(MAKE)... yes
checking for main in -lm... yes
checking for an ANSI C-conforming const... yes
checking your blood pressure... a bit high, but we can proceed
configure: checking whether apxs is available...
checking for --with-apxs... /wwimacs6/apache2/bin/apxs executable, good
checking Apache version... 2.0.52
checking for Apache libexec directory... /wwimacs6/apache2/modules
checking for Apache include directory... -I/wwimacs6/apache2/include
checking for --with-python... /opt/Boeing/python2.4.3/bin/python2.4
checking Python version... 2.4
checking Python install prefix... /opt/Boeing/python2.4.3
checking checking where python libraries are installed...
/opt/Boeing/python2.4.3/lib/python2.4
checking for Py_NewInterpreter in -lpython2.4... yes
checking what libraries Python was linked with... -lpython2.4   -lnsl
-lrt -ldld  -lpthread   -lm
checking linker flags used to link Python...
checking where Python include files are...
-I/opt/Boeing/python2.4.3/include/python2.4
checking for --with-python-src... no
checking for --with-mutex-dir... no
Using MUTEX_DIR /tmp
checking for --with-max-locks... no
Using 8 MAX_LOCKS.
checking for --with-flex... no
checking for flex... no
configure: creating ./config.status
config.status: creating Makefile
config.status: creating src/Makefile
config.status: creating Doc/Makefile
config.status: creating src/include/mod_python.h
config.status: creating test/testconf.py
config.status: creating dist/setup.py
config.status: creating dist/Makefile

AND OF COURSE THE FLEX VERBAGE:

configure: WARNING: flex  not found
  You can generally ignore this warning unless you need to regenerate
  psp_parser.c from psp_parse.l.  If you do need regenerate
psp_parser.c,
  use --with-flex to specify the location of flex.
  See the README for more information.

FIRST RUN AT MAKE:

Compiling for DSO.

        /wwimacs6/apache2/bin/apxs -I/mod_python-3.2.10/src/include
-I/wwimacs6/apache2/include -I/opt/Boeing/python2.4.3/include/python2.4
-c mod_python.c _apachemodule.c requestobject.c tableobject.c util.c
serverobject.c connobject.c filterobject.c hlist.c hlistobject.c
-L/opt/Boeing/python2.4.3/lib
-L/opt/Boeing/python2.4.3/lib/python2.4/config  -Wl,-E -Wl,+s      -lm
-lpython2.4   -lnsl -lrt -ldld  -lpthread   -lm
/wwimacs6/apache2/build/libtool --silent --mode=compile
/opt/ansic/bin/cc -prefer-pic -O3 -DSSL_EXPERIMENTAL -DSSL_ENGINE
-D_REENTRANT -Ae +DAportable  -DHPUX11 -D_REENTRANT
-D_XOPEN_SOURCE_EXTENDED  -I/wwimacs6/apache2/include
-I/wwimacs6/apache2/include   -I/wwimacs6/apache2/include
-I/mod_python-3.2.10/src/include -I/wwimacs6/apache2/include
-I/opt/Boeing/python2.4.3/include/python2.4  -c -o mod_python.lo
mod_python.c && touch mod_python.slo
cc: "mod_python.c", line 313: warning 611: Type conversion loses "const"
qualifier.
cc: "mod_python.c", line 313: warning 563: Argument #1 is not the
correct type.
cc: "mod_python.c", line 427: warning 611: Type conversion loses "const"
qualifier.
cc: "mod_python.c", line 458: warning 611: Type conversion loses "const"
qualifier.
cc: "mod_python.c", line 540: warning 611: Type conversion loses "const"
qualifier.
/wwimacs6/apache2/build/libtool --silent --mode=compile
/opt/ansic/bin/cc -prefer-pic -O3 -DSSL_EXPERIMENTAL -DSSL_ENGINE
-D_REENTRANT -Ae +DAportable  -DHPUX11 -D_REENTRANT
-D_XOPEN_SOURCE_EXTENDED  -I/wwimacs6/apache2/include
-I/wwimacs6/apache2/include   -I/wwimacs6/apache2/include
-I/mod_python-3.2.10/src/include -I/wwimacs6/apache2/include
-I/opt/Boeing/python2.4.3/include/python2.4  -c -o _apachemodule.lo
_apachemodule.c && touch _apachemodule.slo
/wwimacs6/apache2/build/libtool --silent --mode=compile
/opt/ansic/bin/cc -prefer-pic -O3 -DSSL_EXPERIMENTAL -DSSL_ENGINE
-D_REENTRANT -Ae +DAportable  -DHPUX11 -D_REENTRANT
-D_XOPEN_SOURCE_EXTENDED  -I/wwimacs6/apache2/include
-I/wwimacs6/apache2/include   -I/wwimacs6/apache2/include
-I/mod_python-3.2.10/src/include -I/wwimacs6/apache2/include
-I/opt/Boeing/python2.4.3/include/python2.4  -c -o requestobject.lo
requestobject.c && touch requestobject.slo
cc: "requestobject.c", line 426: warning 611: Type conversion loses
"const" qualifier.
cc: "requestobject.c", line 427: warning 604: Pointers are not
assignment-compatible.
cc: "requestobject.c", line 1447: warning 604: Pointers are not
assignment-compatible.
cc: "requestobject.c", line 1454: warning 604: Pointers are not
assignment-compatible.
cc: "requestobject.c", line 1569: warning 604: Pointers are not
assignment-compatible.
/wwimacs6/apache2/build/libtool --silent --mode=compile
/opt/ansic/bin/cc -prefer-pic -O3 -DSSL_EXPERIMENTAL -DSSL_ENGINE
-D_REENTRANT -Ae +DAportable  -DHPUX11 -D_REENTRANT
-D_XOPEN_SOURCE_EXTENDED  -I/wwimacs6/apache2/include
-I/wwimacs6/apache2/include   -I/wwimacs6/apache2/include
-I/mod_python-3.2.10/src/include -I/wwimacs6/apache2/include
-I/opt/Boeing/python2.4.3/include/python2.4  -c -o tableobject.lo
tableobject.c && touch tableobject.slo
cc: "tableobject.c", line 1057: warning 604: Pointers are not
assignment-compatible.
/wwimacs6/apache2/build/libtool --silent --mode=compile
/opt/ansic/bin/cc -prefer-pic -O3 -DSSL_EXPERIMENTAL -DSSL_ENGINE
-D_REENTRANT -Ae +DAportable  -DHPUX11 -D_REENTRANT
-D_XOPEN_SOURCE_EXTENDED  -I/wwimacs6/apache2/include
-I/wwimacs6/apache2/include   -I/wwimacs6/apache2/include
-I/mod_python-3.2.10/src/include -I/wwimacs6/apache2/include
-I/opt/Boeing/python2.4.3/include/python2.4  -c -o util.lo util.c &&
touch util.slo
/wwimacs6/apache2/build/libtool --silent --mode=compile
/opt/ansic/bin/cc -prefer-pic -O3 -DSSL_EXPERIMENTAL -DSSL_ENGINE
-D_REENTRANT -Ae +DAportable  -DHPUX11 -D_REENTRANT
-D_XOPEN_SOURCE_EXTENDED  -I/wwimacs6/apache2/include
-I/wwimacs6/apache2/include   -I/wwimacs6/apache2/include
-I/mod_python-3.2.10/src/include -I/wwimacs6/apache2/include
-I/opt/Boeing/python2.4.3/include/python2.4  -c -o serverobject.lo
serverobject.c && touch serverobject.slo
cc: "serverobject.c", line 351: warning 604: Pointers are not
assignment-compatible.
/wwimacs6/apache2/build/libtool --silent --mode=compile
/opt/ansic/bin/cc -prefer-pic -O3 -DSSL_EXPERIMENTAL -DSSL_ENGINE
-D_REENTRANT -Ae +DAportable  -DHPUX11 -D_REENTRANT
-D_XOPEN_SOURCE_EXTENDED  -I/wwimacs6/apache2/include
-I/wwimacs6/apache2/include   -I/wwimacs6/apache2/include
-I/mod_python-3.2.10/src/include -I/wwimacs6/apache2/include
-I/opt/Boeing/python2.4.3/include/python2.4  -c -o connobject.lo
connobject.c && touch connobject.slo
/wwimacs6/apache2/build/libtool --silent --mode=compile
/opt/ansic/bin/cc -prefer-pic -O3 -DSSL_EXPERIMENTAL -DSSL_ENGINE
-D_REENTRANT -Ae +DAportable  -DHPUX11 -D_REENTRANT
-D_XOPEN_SOURCE_EXTENDED  -I/wwimacs6/apache2/include
-I/wwimacs6/apache2/include   -I/wwimacs6/apache2/include
-I/mod_python-3.2.10/src/include -I/wwimacs6/apache2/include
-I/opt/Boeing/python2.4.3/include/python2.4  -c -o filterobject.lo
filterobject.c && touch filterobject.slo
/wwimacs6/apache2/build/libtool --silent --mode=compile
/opt/ansic/bin/cc -prefer-pic -O3 -DSSL_EXPERIMENTAL -DSSL_ENGINE
-D_REENTRANT -Ae +DAportable  -DHPUX11 -D_REENTRANT
-D_XOPEN_SOURCE_EXTENDED  -I/wwimacs6/apache2/include
-I/wwimacs6/apache2/include   -I/wwimacs6/apache2/include
-I/mod_python-3.2.10/src/include -I/wwimacs6/apache2/include
-I/opt/Boeing/python2.4.3/include/python2.4  -c -o hlist.lo hlist.c &&
touch hlist.slo
/wwimacs6/apache2/build/libtool --silent --mode=compile
/opt/ansic/bin/cc -prefer-pic -O3 -DSSL_EXPERIMENTAL -DSSL_ENGINE
-D_REENTRANT -Ae +DAportable  -DHPUX11 -D_REENTRANT
-D_XOPEN_SOURCE_EXTENDED  -I/wwimacs6/apache2/include
-I/wwimacs6/apache2/include   -I/wwimacs6/apache2/include
-I/mod_python-3.2.10/src/include -I/wwimacs6/apache2/include
-I/opt/Boeing/python2.4.3/include/python2.4  -c -o hlistobject.lo
hlistobject.c && touch hlistobject.slo
/wwimacs6/apache2/build/libtool --silent --mode=link /opt/ansic/bin/cc
-o mod_python.la -I/mod_python-3.2.10/src/include
-I/wwimacs6/apache2/include -I/opt/Boeing/python2.4.3/include/python2.4
-rpath /wwimacs6/apache2/modules -module -avoid-version
hlistobject.lo hlist.lo filterobject.lo connobject.lo serverobject.lo
util.lo tableobject.lo requestobject.lo _apachemodule.lo mod_python.lo
-L/opt/Boeing/python2.4.3/lib
-L/opt/Boeing/python2.4.3/lib/python2.4/config -Wl,-E -Wl,+s -lm
-lpython2.4 -lnsl -lrt -ldld -lpthread -lm
         -R -opsp_parser.c --header-file=include/psp_flex.h psp_parser.l
sh: -R:  not found.
*** Error exit code 127

Stop.
*** Error exit code 1

Stop.
*** Error exit code 1

Stop.

I could remove the -R from /src/Makefile, it seems the HP c compiler
does not like that switch. Thoughts?


ENTRY FROM src/Makefile

psp_parser.c: psp_parser.l
        @rm -f psp_parser.c
	  $(LEX) -R -opsp_parser.c --header-file=include/psp_flex.h
psp_parser.l



Thanks, 
Joe Buehre 
Mission Critical Systems Support 
314-791-9725

 mailto:joseph.r.buehre@boeing.com


-----Original Message-----
From: Buehre, Joseph R 
Sent: Wednesday, November 15, 2006 11:11 AM
To: Deron Meranda
Cc: mod_python@modpython.org
Subject: RE: [mod_python] Mod_python on HP-UX 11.11

Sorry for the slow response, but I will re-compile and send the errors
as I move along.
To answer the first questions, yes Apache was compiled with --enable-so
and I am doing a 32 bit compile.

Thanks in advance.!


Thanks,
Joe Buehre
Mission Critical Systems Support
314-791-9725

 mailto:joseph.r.buehre@boeing.com


-----Original Message-----
From: Deron Meranda [mailto:deron.meranda@gmail.com]
Sent: Thursday, November 02, 2006 4:12 PM
To: Buehre, Joseph R
Cc: mod_python@modpython.org
Subject: Re: [mod_python] Mod_python on HP-UX 11.11

I think you replied to the wrong thread...

On 11/2/06, Buehre, Joseph R <joseph.r.buehre@boeing.com> wrote:
> I have tried consently to get mod_python to compile and create the .so

> file for Apache.  To date this has been an unsucessful adventure.  Has

> anyone done this type of install with HP-UX 11.11, Apache 2.0 and the 
> latest version of mod_python.  Desperately seeking insight.

I did get it working (but not heavily tested) with these parts...

  HP-UX 11.0
  Apache 2.2 (mpm_worker, dso)
  OpenSSL 0.9.8d
  Python 2.4.3
  GNU readline 5.1
  mod_python 3.2.10

Everything (except the OS of course) was compiled from sources with HP's
ANSI-C cc compiler in 32-bit mode.

I've since got python 2.5 working now, but I haven't tried recompiling
the mod_python against it.

Did you also compile httpd?  If so did you make sure you used the
--enable-so option to configure?  Are you by chance trying to compile
64-bit applications?  Can you provide more information, such as what
kind of errors you might be seeing.  What configure options you've
given, etc.

I know getting stuff to compile under HP-UX can in general be a real
pain.  I may have done some sort of magic, but I honestly can't remember
what I did exactly.  At least it's not AIX; that one always gives me
terrible fits.
--
Deron Meranda

_______________________________________________
Mod_python mailing list
Mod_python@modpython.org
http://mailman.modpython.org/mailman/listinfo/mod_python

From g.farina at pharaondev.com  Wed Nov 15 13:05:45 2006
From: g.farina at pharaondev.com (g.farina@pharaondev.com)
Date: Wed Nov 15 13:05:50 2006
Subject: [mod_python] Getting Hostname
Message-ID: <13283.82.56.77.83.1163613945.squirrel@webmail.pharaondev.com>

Hi,

in my simple MVC framework I'd like to use a different directory root for
controllers based on the website requested by the user.
For instance if someone connects to www.test.it/first I'd like to use
/var/www/test as controllers root, and if someone connects to
www.test2.it/first use /var/www/test2.

I didn't have enought knowledge of how Apache works, so I don't know if
the value of req.server.server_hostname is reliable to do the switch of
the root.
The solution used should work indipendently from Apache configuration, and
I don't want to rely on headers sent by the client.

The directory switching should be configured from the application, so I
can't use Virtual Hosting or Apache configuration directly.

Any suggestion ?

Gabriele

From deron.meranda at gmail.com  Wed Nov 15 13:06:33 2006
From: deron.meranda at gmail.com (Deron Meranda)
Date: Wed Nov 15 13:06:37 2006
Subject: [mod_python] Mod_python on HP-UX 11.11
In-Reply-To: <C12C17049E23854783042B3D0F25BB67029B7D35@XCH-MW-2V2.mw.nos.boeing.com>
References: <C12C17049E23854783042B3D0F25BB67029B7D32@XCH-MW-2V2.mw.nos.boeing.com>
	<C12C17049E23854783042B3D0F25BB67029B7D35@XCH-MW-2V2.mw.nos.boeing.com>
Message-ID: <5c06fa770611151006q4d0f539bxe6165afd98979910@mail.gmail.com>

On 11/15/06, Buehre, Joseph R <joseph.r.buehre@boeing.com> wrote:
> HERE IS THE CONFIGURE RUN:
>
> CC=cc CXX=aCC CFLAGS=+DD32 CXXFLAGS=+DD32
> LDFLAGS=-L/opt/Boeing/python2.4.3/lib ./configure
> --with-apxs=/wwimacs6/apache2/bin/apxs
> --with-python=/opt/Boeing/python2.4.3/bin/python2.4

...
> /wwimacs6/apache2/build/libtool --silent --mode=link /opt/ansic/bin/cc
> -o mod_python.la -I/mod_python-3.2.10/src/include
> -I/wwimacs6/apache2/include -I/opt/Boeing/python2.4.3/include/python2.4
> -rpath /wwimacs6/apache2/modules -module -avoid-version
> hlistobject.lo hlist.lo filterobject.lo connobject.lo serverobject.lo
> util.lo tableobject.lo requestobject.lo _apachemodule.lo mod_python.lo
> -L/opt/Boeing/python2.4.3/lib
> -L/opt/Boeing/python2.4.3/lib/python2.4/config -Wl,-E -Wl,+s -lm
> -lpython2.4 -lnsl -lrt -ldld -lpthread -lm
>          -R -opsp_parser.c --header-file=include/psp_flex.h psp_parser.l
> sh: -R:  not found.
> *** Error exit code 127

Hmmm.  I'm not sure what the -R option is there for.  It's certainly
wrong.

Note that you may get more information by copying that last
command (all the above quoted as a single line), and then run
it directly but with the --silent option removed.

Also, find the apxs Perl script you used and look inside it.  Somewhere
in the first page or so you'll see something like:

   my $installbuilddir = "/opt/xxxxx/apache/share/build";

which is where your Apache was built.  Then inside that
directory you'll find a file named "config_vars.mk".  Grep
through that file to find out where the libtool is located.

   grep LIBTOOL /opt/xxxxx/apache/share/build/config_vars.mk

Then run that "libtool" script with the --version option to see
what version it is:

   /opt/xxxxxx/apache/share/build/libtool --version

and report back what it says.

Also, inside the config_vars.mk file you'll also find a lot
of compiler options and such.  See if you can find any
"-R" mentioned in there as well.

What I'm trying to figure out is if the problem is with your
Apache build, or with mod_python.

-- 
Deron Meranda
From joseph.r.buehre at boeing.com  Wed Nov 15 14:04:36 2006
From: joseph.r.buehre at boeing.com (Buehre, Joseph R)
Date: Wed Nov 15 14:04:49 2006
Subject: [mod_python] Mod_python on HP-UX 11.11
In-Reply-To: <5c06fa770611151006q4d0f539bxe6165afd98979910@mail.gmail.com>
Message-ID: <C12C17049E23854783042B3D0F25BB67029B7D37@XCH-MW-2V2.mw.nos.boeing.com>

LIBTOOL VERSION:

ltmain.sh (GNU libtool) 1.4.3 (1.922.2.110 2002/10/23 01:39:54)

The -R is in the src/Makefile and is not in the Apache config_vars.mk
file. I believe it is a compiler switch for the C compiler. Reference
this link for -R http://docs.hp.com/en/B3901-90003/ch09s01.html

NEW MAKE RUN:  Removed silent as recommend but it must be hiding some
where else...I tried to find it but to no avail.

Compiling for DSO.

        /wwimacs6/apache2/bin/apxs -I/mod_python-3.2.10/src/include
-I/wwimacs6/apache2/include -I/opt/Boeing/python2.4.3/include/python2.4
-c mod_python.c _apachemodule.c requestobject.c tableobject.c util.c
serverobject.c connobject.c filterobject.c hlist.c hlistobject.c
-L/opt/Boeing/python2.4.3/lib
-L/opt/Boeing/python2.4.3/lib/python2.4/config  -Wl,-E -Wl,+s      -lm
-lpython2.4   -lnsl -lrt -ldld  -lpthread   -lm
/wwimacs6/apache2/build/libtool --silent --mode=compile
/opt/ansic/bin/cc -prefer-pic -O3 -DSSL_EXPERIMENTAL -DSSL_ENGINE
-D_REENTRANT -Ae +DAportable  -DHPUX11 -D_REENTRANT
-D_XOPEN_SOURCE_EXTENDED  -I/wwimacs6/apache2/include
-I/wwimacs6/apache2/include   -I/wwimacs6/apache2/include
-I/mod_python-3.2.10/src/include -I/wwimacs6/apache2/include
-I/opt/Boeing/python2.4.3/include/python2.4  -c -o mod_python.lo
mod_python.c && touch mod_python.slo
cc: "mod_python.c", line 313: warning 611: Type conversion loses "const"
qualifier.
cc: "mod_python.c", line 313: warning 563: Argument #1 is not the
correct type.
cc: "mod_python.c", line 427: warning 611: Type conversion loses "const"
qualifier.
cc: "mod_python.c", line 458: warning 611: Type conversion loses "const"
qualifier.
cc: "mod_python.c", line 540: warning 611: Type conversion loses "const"
qualifier.
/wwimacs6/apache2/build/libtool --silent --mode=compile
/opt/ansic/bin/cc -prefer-pic -O3 -DSSL_EXPERIMENTAL -DSSL_ENGINE
-D_REENTRANT -Ae +DAportable  -DHPUX11 -D_REENTRANT
-D_XOPEN_SOURCE_EXTENDED  -I/wwimacs6/apache2/include
-I/wwimacs6/apache2/include   -I/wwimacs6/apache2/include
-I/mod_python-3.2.10/src/include -I/wwimacs6/apache2/include
-I/opt/Boeing/python2.4.3/include/python2.4  -c -o _apachemodule.lo
_apachemodule.c && touch _apachemodule.slo
/wwimacs6/apache2/build/libtool --silent --mode=compile
/opt/ansic/bin/cc -prefer-pic -O3 -DSSL_EXPERIMENTAL -DSSL_ENGINE
-D_REENTRANT -Ae +DAportable  -DHPUX11 -D_REENTRANT
-D_XOPEN_SOURCE_EXTENDED  -I/wwimacs6/apache2/include
-I/wwimacs6/apache2/include   -I/wwimacs6/apache2/include
-I/mod_python-3.2.10/src/include -I/wwimacs6/apache2/include
-I/opt/Boeing/python2.4.3/include/python2.4  -c -o requestobject.lo
requestobject.c && touch requestobject.slo
cc: "requestobject.c", line 426: warning 611: Type conversion loses
"const" qualifier.
cc: "requestobject.c", line 427: warning 604: Pointers are not
assignment-compatible.
cc: "requestobject.c", line 1447: warning 604: Pointers are not
assignment-compatible.
cc: "requestobject.c", line 1454: warning 604: Pointers are not
assignment-compatible.
cc: "requestobject.c", line 1569: warning 604: Pointers are not
assignment-compatible.
/wwimacs6/apache2/build/libtool --silent --mode=compile
/opt/ansic/bin/cc -prefer-pic -O3 -DSSL_EXPERIMENTAL -DSSL_ENGINE
-D_REENTRANT -Ae +DAportable  -DHPUX11 -D_REENTRANT
-D_XOPEN_SOURCE_EXTENDED  -I/wwimacs6/apache2/include
-I/wwimacs6/apache2/include   -I/wwimacs6/apache2/include
-I/mod_python-3.2.10/src/include -I/wwimacs6/apache2/include
-I/opt/Boeing/python2.4.3/include/python2.4  -c -o tableobject.lo
tableobject.c && touch tableobject.slo
cc: "tableobject.c", line 1057: warning 604: Pointers are not
assignment-compatible.
/wwimacs6/apache2/build/libtool --silent --mode=compile
/opt/ansic/bin/cc -prefer-pic -O3 -DSSL_EXPERIMENTAL -DSSL_ENGINE
-D_REENTRANT -Ae +DAportable  -DHPUX11 -D_REENTRANT
-D_XOPEN_SOURCE_EXTENDED  -I/wwimacs6/apache2/include
-I/wwimacs6/apache2/include   -I/wwimacs6/apache2/include
-I/mod_python-3.2.10/src/include -I/wwimacs6/apache2/include
-I/opt/Boeing/python2.4.3/include/python2.4  -c -o util.lo util.c &&
touch util.slo
/wwimacs6/apache2/build/libtool --silent --mode=compile
/opt/ansic/bin/cc -prefer-pic -O3 -DSSL_EXPERIMENTAL -DSSL_ENGINE
-D_REENTRANT -Ae +DAportable  -DHPUX11 -D_REENTRANT
-D_XOPEN_SOURCE_EXTENDED  -I/wwimacs6/apache2/include
-I/wwimacs6/apache2/include   -I/wwimacs6/apache2/include
-I/mod_python-3.2.10/src/include -I/wwimacs6/apache2/include
-I/opt/Boeing/python2.4.3/include/python2.4  -c -o serverobject.lo
serverobject.c && touch serverobject.slo
cc: "serverobject.c", line 351: warning 604: Pointers are not
assignment-compatible.
/wwimacs6/apache2/build/libtool --silent --mode=compile
/opt/ansic/bin/cc -prefer-pic -O3 -DSSL_EXPERIMENTAL -DSSL_ENGINE
-D_REENTRANT -Ae +DAportable  -DHPUX11 -D_REENTRANT
-D_XOPEN_SOURCE_EXTENDED  -I/wwimacs6/apache2/include
-I/wwimacs6/apache2/include   -I/wwimacs6/apache2/include
-I/mod_python-3.2.10/src/include -I/wwimacs6/apache2/include
-I/opt/Boeing/python2.4.3/include/python2.4  -c -o connobject.lo
connobject.c && touch connobject.slo
/wwimacs6/apache2/build/libtool --silent --mode=compile
/opt/ansic/bin/cc -prefer-pic -O3 -DSSL_EXPERIMENTAL -DSSL_ENGINE
-D_REENTRANT -Ae +DAportable  -DHPUX11 -D_REENTRANT
-D_XOPEN_SOURCE_EXTENDED  -I/wwimacs6/apache2/include
-I/wwimacs6/apache2/include   -I/wwimacs6/apache2/include
-I/mod_python-3.2.10/src/include -I/wwimacs6/apache2/include
-I/opt/Boeing/python2.4.3/include/python2.4  -c -o filterobject.lo
filterobject.c && touch filterobject.slo
/wwimacs6/apache2/build/libtool --silent --mode=compile
/opt/ansic/bin/cc -prefer-pic -O3 -DSSL_EXPERIMENTAL -DSSL_ENGINE
-D_REENTRANT -Ae +DAportable  -DHPUX11 -D_REENTRANT
-D_XOPEN_SOURCE_EXTENDED  -I/wwimacs6/apache2/include
-I/wwimacs6/apache2/include   -I/wwimacs6/apache2/include
-I/mod_python-3.2.10/src/include -I/wwimacs6/apache2/include
-I/opt/Boeing/python2.4.3/include/python2.4  -c -o hlist.lo hlist.c &&
touch hlist.slo
/wwimacs6/apache2/build/libtool --silent --mode=compile
/opt/ansic/bin/cc -prefer-pic -O3 -DSSL_EXPERIMENTAL -DSSL_ENGINE
-D_REENTRANT -Ae +DAportable  -DHPUX11 -D_REENTRANT
-D_XOPEN_SOURCE_EXTENDED  -I/wwimacs6/apache2/include
-I/wwimacs6/apache2/include   -I/wwimacs6/apache2/include
-I/mod_python-3.2.10/src/include -I/wwimacs6/apache2/include
-I/opt/Boeing/python2.4.3/include/python2.4  -c -o hlistobject.lo
hlistobject.c && touch hlistobject.slo
/wwimacs6/apache2/build/libtool --silent --mode=link /opt/ansic/bin/cc
-o mod_python.la -I/mod_python-3.2.10/src/include
-I/wwimacs6/apache2/include -I/opt/Boeing/python2.4.3/include/python2.4
-rpath /wwimacs6/apache2/modules -module -avoid-version
hlistobject.lo hlist.lo filterobject.lo connobject.lo serverobject.lo
util.lo tableobject.lo requestobject.lo _apachemodule.lo mod_python.lo
-L/opt/Boeing/python2.4.3/lib
-L/opt/Boeing/python2.4.3/lib/python2.4/config -Wl,-E -Wl,+s -lm
-lpython2.4 -lnsl -lrt -ldld -lpthread -lm
        ln -s ../lib/python/mod_python mod_python
        ln -s ../src src
         -R -opsp_parser.c --header-file=include/psp_flex.h psp_parser.l
sh: -R:  not found.
*** Error exit code 127

Stop.
*** Error exit code 1

Stop.
*** Error exit code 1

Stop.



Thanks, 
Joe Buehre 
Mission Critical Systems Support 
314-791-9725

 mailto:joseph.r.buehre@boeing.com


-----Original Message-----
From: Deron Meranda [mailto:deron.meranda@gmail.com] 
Sent: Wednesday, November 15, 2006 12:07 PM
To: Buehre, Joseph R
Cc: mod_python@modpython.org
Subject: Re: [mod_python] Mod_python on HP-UX 11.11

On 11/15/06, Buehre, Joseph R <joseph.r.buehre@boeing.com> wrote:
> HERE IS THE CONFIGURE RUN:
>
> CC=cc CXX=aCC CFLAGS=+DD32 CXXFLAGS=+DD32 
> LDFLAGS=-L/opt/Boeing/python2.4.3/lib ./configure 
> --with-apxs=/wwimacs6/apache2/bin/apxs
> --with-python=/opt/Boeing/python2.4.3/bin/python2.4

...
> /wwimacs6/apache2/build/libtool --silent --mode=link /opt/ansic/bin/cc
-o mod_python.la -I/mod_python-3.2.10/src/include 
> -I/wwimacs6/apache2/include 
> -I/opt/Boeing/python2.4.3/include/python2.4
> -rpath /wwimacs6/apache2/modules -module -avoid-version hlistobject.lo

> hlist.lo filterobject.lo connobject.lo serverobject.lo util.lo 
> tableobject.lo requestobject.lo _apachemodule.lo mod_python.lo 
> -L/opt/Boeing/python2.4.3/lib 
> -L/opt/Boeing/python2.4.3/lib/python2.4/config -Wl,-E -Wl,+s -lm
> -lpython2.4 -lnsl -lrt -ldld -lpthread -lm
>          -R -opsp_parser.c --header-file=include/psp_flex.h 
> psp_parser.l
> sh: -R:  not found.
> *** Error exit code 127

Hmmm.  I'm not sure what the -R option is there for.  It's certainly
wrong.

Note that you may get more information by copying that last command (all
the above quoted as a single line), and then run it directly but with
the --silent option removed.

Also, find the apxs Perl script you used and look inside it.  Somewhere
in the first page or so you'll see something like:

   my $installbuilddir = "/opt/xxxxx/apache/share/build";

which is where your Apache was built.  Then inside that directory you'll
find a file named "config_vars.mk".  Grep through that file to find out
where the libtool is located.

   grep LIBTOOL /opt/xxxxx/apache/share/build/config_vars.mk

Then run that "libtool" script with the --version option to see what
version it is:

   /opt/xxxxxx/apache/share/build/libtool --version

and report back what it says.

Also, inside the config_vars.mk file you'll also find a lot of compiler
options and such.  See if you can find any "-R" mentioned in there as
well.

What I'm trying to figure out is if the problem is with your Apache
build, or with mod_python.

--
Deron Meranda

From deron.meranda at gmail.com  Wed Nov 15 14:49:35 2006
From: deron.meranda at gmail.com (Deron Meranda)
Date: Wed Nov 15 14:49:41 2006
Subject: [mod_python] Mod_python on HP-UX 11.11
In-Reply-To: <C12C17049E23854783042B3D0F25BB67029B7D37@XCH-MW-2V2.mw.nos.boeing.com>
References: <5c06fa770611151006q4d0f539bxe6165afd98979910@mail.gmail.com>
	<C12C17049E23854783042B3D0F25BB67029B7D37@XCH-MW-2V2.mw.nos.boeing.com>
Message-ID: <5c06fa770611151149k3ec6b269m2ddc93f4f41d391e@mail.gmail.com>

On 11/15/06, Buehre, Joseph R <joseph.r.buehre@boeing.com> wrote:
> LIBTOOL VERSION:
>
> ltmain.sh (GNU libtool) 1.4.3 (1.922.2.110 2002/10/23 01:39:54)

That libtool is quite old, and old libtools on HP-UX are buggy sometimes.
If all else fails you may try replacing it with a newer version.  It's a bit
hackish, but when I've gotten stuck in the past (on other OSS programs)
with mysterious compiler/linker options it's sometimes worked for me.

   http://directory.fsf.org/libtool.html

You may also consider whether you want to go up to Apache 2.2
rather than 2.0.  (You must use the newest mod_python though).


> The -R is in the src/Makefile and is not in the Apache config_vars.mk
> file. I believe it is a compiler switch for the C compiler. Reference
> this link for -R http://docs.hp.com/en/B3901-90003/ch09s01.html

Can you show us the snippets of the Makefile where -R appears?
What about Makefile.in ?

-R is an obscure option to the lower-level compiler-only phase of
the compiler (i.e., ccom not cc).  If it appears it should always be
encapsulated in a -w option, such as

   -wc,-R   (no spaces)

I can't see how -R is needed, as it is a very low level optimzation
hint.  (If, in fact, the -R you see is intended to be the same as the
HP documented one).

In the mod_python I compiled I have no such -R option anyplace.
I can't explain why yours has it.  (Are you sure you're not confusing
it with the -R option to lex/flex?)

You could try just manually removing all references to -R from the
makefiles (after the configure step obviously).


> NEW MAKE RUN:  Removed silent as recommend but it must be hiding some
> where else...I tried to find it but to no avail.

The --silent option is burried very very deep; it's almost imposible
to remove.  When I need to see more details I don't use make,
I run the actual commands directly (run make first to see what
commands it is launching, then cut-n-paste the one you want and
modify the options directly).

However in this case I'm not sure we need to see the details,
as the -R in src/Makefile is obviously the source of the problem.

-- 
Deron Meranda
From joseph.r.buehre at boeing.com  Wed Nov 15 15:15:51 2006
From: joseph.r.buehre at boeing.com (Buehre, Joseph R)
Date: Wed Nov 15 15:16:04 2006
Subject: [mod_python] Mod_python on HP-UX 11.11
In-Reply-To: <5c06fa770611151149k3ec6b269m2ddc93f4f41d391e@mail.gmail.com>
Message-ID: <C12C17049E23854783042B3D0F25BB67029B7D3B@XCH-MW-2V2.mw.nos.boeing.com>

Here is the -R and you are correct, I believe it is related to the FLEX,
this is in the src/Makefile and makefile.in

psp_parser.c: psp_parser.l
        @rm -f psp_parser.c
        $(LEX) -R -opsp_parser.c --header-file=include/psp_flex.h
psp_parser.l

NEXT MAKE RUN WITHOUT -R:

Compiling for DSO.

        /wwimacs6/apache2/bin/apxs -I/mod_python-3.2.10/src/include
-I/wwimacs6/apache2/include -I/opt/Boeing/python2.4.3/include/python2.4
-c mod_python.c _apachemodule.c requestobject.c tableobject.c util.c
serverobject.c connobject.c filterobject.c hlist.c hlistobject.c
-L/opt/Boeing/python2.4.3/lib
-L/opt/Boeing/python2.4.3/lib/python2.4/config  -Wl,-E -Wl,+s      -lm
-lpython2.4   -lnsl -lrt -ldld  -lpthread   -lm
/wwimacs6/apache2/build/libtool --silent --mode=compile
/opt/ansic/bin/cc -prefer-pic -O3 -DSSL_EXPERIMENTAL -DSSL_ENGINE
-D_REENTRANT -Ae +DAportable  -DHPUX11 -D_REENTRANT
-D_XOPEN_SOURCE_EXTENDED  -I/wwimacs6/apache2/include
-I/wwimacs6/apache2/include   -I/wwimacs6/apache2/include
-I/mod_python-3.2.10/src/include -I/wwimacs6/apache2/include
-I/opt/Boeing/python2.4.3/include/python2.4  -c -o mod_python.lo
mod_python.c && touch mod_python.slo
cc: "mod_python.c", line 313: warning 611: Type conversion loses "const"
qualifier.
cc: "mod_python.c", line 313: warning 563: Argument #1 is not the
correct type.
cc: "mod_python.c", line 427: warning 611: Type conversion loses "const"
qualifier.
cc: "mod_python.c", line 458: warning 611: Type conversion loses "const"
qualifier.
cc: "mod_python.c", line 540: warning 611: Type conversion loses "const"
qualifier.
/wwimacs6/apache2/build/libtool --silent --mode=compile
/opt/ansic/bin/cc -prefer-pic -O3 -DSSL_EXPERIMENTAL -DSSL_ENGINE
-D_REENTRANT -Ae +DAportable  -DHPUX11 -D_REENTRANT
-D_XOPEN_SOURCE_EXTENDED  -I/wwimacs6/apache2/include
-I/wwimacs6/apache2/include   -I/wwimacs6/apache2/include
-I/mod_python-3.2.10/src/include -I/wwimacs6/apache2/include
-I/opt/Boeing/python2.4.3/include/python2.4  -c -o _apachemodule.lo
_apachemodule.c && touch _apachemodule.slo
/wwimacs6/apache2/build/libtool --silent --mode=compile
/opt/ansic/bin/cc -prefer-pic -O3 -DSSL_EXPERIMENTAL -DSSL_ENGINE
-D_REENTRANT -Ae +DAportable  -DHPUX11 -D_REENTRANT
-D_XOPEN_SOURCE_EXTENDED  -I/wwimacs6/apache2/include
-I/wwimacs6/apache2/include   -I/wwimacs6/apache2/include
-I/mod_python-3.2.10/src/include -I/wwimacs6/apache2/include
-I/opt/Boeing/python2.4.3/include/python2.4  -c -o requestobject.lo
requestobject.c && touch requestobject.slo
cc: "requestobject.c", line 426: warning 611: Type conversion loses
"const" qualifier.
cc: "requestobject.c", line 427: warning 604: Pointers are not
assignment-compatible.
cc: "requestobject.c", line 1447: warning 604: Pointers are not
assignment-compatible.
cc: "requestobject.c", line 1454: warning 604: Pointers are not
assignment-compatible.
cc: "requestobject.c", line 1569: warning 604: Pointers are not
assignment-compatible.
/wwimacs6/apache2/build/libtool --silent --mode=compile
/opt/ansic/bin/cc -prefer-pic -O3 -DSSL_EXPERIMENTAL -DSSL_ENGINE
-D_REENTRANT -Ae +DAportable  -DHPUX11 -D_REENTRANT
-D_XOPEN_SOURCE_EXTENDED  -I/wwimacs6/apache2/include
-I/wwimacs6/apache2/include   -I/wwimacs6/apache2/include
-I/mod_python-3.2.10/src/include -I/wwimacs6/apache2/include
-I/opt/Boeing/python2.4.3/include/python2.4  -c -o tableobject.lo
tableobject.c && touch tableobject.slo
cc: "tableobject.c", line 1057: warning 604: Pointers are not
assignment-compatible.
/wwimacs6/apache2/build/libtool --silent --mode=compile
/opt/ansic/bin/cc -prefer-pic -O3 -DSSL_EXPERIMENTAL -DSSL_ENGINE
-D_REENTRANT -Ae +DAportable  -DHPUX11 -D_REENTRANT
-D_XOPEN_SOURCE_EXTENDED  -I/wwimacs6/apache2/include
-I/wwimacs6/apache2/include   -I/wwimacs6/apache2/include
-I/mod_python-3.2.10/src/include -I/wwimacs6/apache2/include
-I/opt/Boeing/python2.4.3/include/python2.4  -c -o util.lo util.c &&
touch util.slo
/wwimacs6/apache2/build/libtool --silent --mode=compile
/opt/ansic/bin/cc -prefer-pic -O3 -DSSL_EXPERIMENTAL -DSSL_ENGINE
-D_REENTRANT -Ae +DAportable  -DHPUX11 -D_REENTRANT
-D_XOPEN_SOURCE_EXTENDED  -I/wwimacs6/apache2/include
-I/wwimacs6/apache2/include   -I/wwimacs6/apache2/include
-I/mod_python-3.2.10/src/include -I/wwimacs6/apache2/include
-I/opt/Boeing/python2.4.3/include/python2.4  -c -o serverobject.lo
serverobject.c && touch serverobject.slo
cc: "serverobject.c", line 351: warning 604: Pointers are not
assignment-compatible.
/wwimacs6/apache2/build/libtool --silent --mode=compile
/opt/ansic/bin/cc -prefer-pic -O3 -DSSL_EXPERIMENTAL -DSSL_ENGINE
-D_REENTRANT -Ae +DAportable  -DHPUX11 -D_REENTRANT
-D_XOPEN_SOURCE_EXTENDED  -I/wwimacs6/apache2/include
-I/wwimacs6/apache2/include   -I/wwimacs6/apache2/include
-I/mod_python-3.2.10/src/include -I/wwimacs6/apache2/include
-I/opt/Boeing/python2.4.3/include/python2.4  -c -o connobject.lo
connobject.c && touch connobject.slo
/wwimacs6/apache2/build/libtool --silent --mode=compile
/opt/ansic/bin/cc -prefer-pic -O3 -DSSL_EXPERIMENTAL -DSSL_ENGINE
-D_REENTRANT -Ae +DAportable  -DHPUX11 -D_REENTRANT
-D_XOPEN_SOURCE_EXTENDED  -I/wwimacs6/apache2/include
-I/wwimacs6/apache2/include   -I/wwimacs6/apache2/include
-I/mod_python-3.2.10/src/include -I/wwimacs6/apache2/include
-I/opt/Boeing/python2.4.3/include/python2.4  -c -o filterobject.lo
filterobject.c && touch filterobject.slo
/wwimacs6/apache2/build/libtool --silent --mode=compile
/opt/ansic/bin/cc -prefer-pic -O3 -DSSL_EXPERIMENTAL -DSSL_ENGINE
-D_REENTRANT -Ae +DAportable  -DHPUX11 -D_REENTRANT
-D_XOPEN_SOURCE_EXTENDED  -I/wwimacs6/apache2/include
-I/wwimacs6/apache2/include   -I/wwimacs6/apache2/include
-I/mod_python-3.2.10/src/include -I/wwimacs6/apache2/include
-I/opt/Boeing/python2.4.3/include/python2.4  -c -o hlist.lo hlist.c &&
touch hlist.slo
/wwimacs6/apache2/build/libtool --silent --mode=compile
/opt/ansic/bin/cc -prefer-pic -O3 -DSSL_EXPERIMENTAL -DSSL_ENGINE
-D_REENTRANT -Ae +DAportable  -DHPUX11 -D_REENTRANT
-D_XOPEN_SOURCE_EXTENDED  -I/wwimacs6/apache2/include
-I/wwimacs6/apache2/include   -I/wwimacs6/apache2/include
-I/mod_python-3.2.10/src/include -I/wwimacs6/apache2/include
-I/opt/Boeing/python2.4.3/include/python2.4  -c -o hlistobject.lo
hlistobject.c && touch hlistobject.slo
/wwimacs6/apache2/build/libtool --silent --mode=link /opt/ansic/bin/cc
-o mod_python.la -I/mod_python-3.2.10/src/include
-I/wwimacs6/apache2/include -I/opt/Boeing/python2.4.3/include/python2.4
-rpath /wwimacs6/apache2/modules -module -avoid-version
hlistobject.lo hlist.lo filterobject.lo connobject.lo serverobject.lo
util.lo tableobject.lo requestobject.lo _apachemodule.lo mod_python.lo
-L/opt/Boeing/python2.4.3/lib
-L/opt/Boeing/python2.4.3/lib/python2.4/config -Wl,-E -Wl,+s -lm
-lpython2.4 -lnsl -lrt -ldld -lpthread -lm
        ln -s ../lib/python/mod_python mod_python
        ln -s ../src src
         -opsp_parser.c --header-file=include/psp_flex.h psp_parser.l
sh: -opsp_parser.c:  not found.
*** Error exit code 127

Stop.
*** Error exit code 1

Stop.
*** Error exit code 1

Stop.

The crazy thing about this is they removed the psp_parser.c object in
the Makefile prior to running:
 
$(LEX) -opsp_parser.c --header-file=include/psp_flex.h psp_parser.l


Thanks, 
Joe Buehre 
Mission Critical Systems Support 
314-791-9725

 mailto:joseph.r.buehre@boeing.com


-----Original Message-----
From: Deron Meranda [mailto:deron.meranda@gmail.com] 
Sent: Wednesday, November 15, 2006 1:50 PM
To: Buehre, Joseph R
Cc: mod_python@modpython.org
Subject: Re: [mod_python] Mod_python on HP-UX 11.11

On 11/15/06, Buehre, Joseph R <joseph.r.buehre@boeing.com> wrote:
> LIBTOOL VERSION:
>
> ltmain.sh (GNU libtool) 1.4.3 (1.922.2.110 2002/10/23 01:39:54)

That libtool is quite old, and old libtools on HP-UX are buggy
sometimes.
If all else fails you may try replacing it with a newer version.  It's a
bit hackish, but when I've gotten stuck in the past (on other OSS
programs) with mysterious compiler/linker options it's sometimes worked
for me.

   http://directory.fsf.org/libtool.html

You may also consider whether you want to go up to Apache 2.2 rather
than 2.0.  (You must use the newest mod_python though).


> The -R is in the src/Makefile and is not in the Apache config_vars.mk 
> file. I believe it is a compiler switch for the C compiler. Reference 
> this link for -R http://docs.hp.com/en/B3901-90003/ch09s01.html

Can you show us the snippets of the Makefile where -R appears?
What about Makefile.in ?

-R is an obscure option to the lower-level compiler-only phase of the
compiler (i.e., ccom not cc).  If it appears it should always be
encapsulated in a -w option, such as

   -wc,-R   (no spaces)

I can't see how -R is needed, as it is a very low level optimzation
hint.  (If, in fact, the -R you see is intended to be the same as the HP
documented one).

In the mod_python I compiled I have no such -R option anyplace.
I can't explain why yours has it.  (Are you sure you're not confusing it
with the -R option to lex/flex?)

You could try just manually removing all references to -R from the
makefiles (after the configure step obviously).


> NEW MAKE RUN:  Removed silent as recommend but it must be hiding some 
> where else...I tried to find it but to no avail.

The --silent option is burried very very deep; it's almost imposible to
remove.  When I need to see more details I don't use make, I run the
actual commands directly (run make first to see what commands it is
launching, then cut-n-paste the one you want and modify the options
directly).

However in this case I'm not sure we need to see the details, as the -R
in src/Makefile is obviously the source of the problem.

--
Deron Meranda

From grahamd at dscpl.com.au  Wed Nov 15 15:17:52 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Wed Nov 15 15:17:59 2006
Subject: [mod_python] Mod_python on HP-UX 11.11
In-Reply-To: <C12C17049E23854783042B3D0F25BB67029B7D35@XCH-MW-2V2.mw.nos.boeing.com>
References: <C12C17049E23854783042B3D0F25BB67029B7D35@XCH-MW-2V2.mw.nos.boeing.com>
Message-ID: <E065E78D-368E-43D6-B90E-F3474C34FB89@dscpl.com.au>


On 16/11/2006, at 4:28 AM, Buehre, Joseph R wrote:

>          -R -opsp_parser.c --header-file=include/psp_flex.h  
> psp_parser.l
> sh: -R:  not found.
> *** Error exit code 127
>
> Stop.
> *** Error exit code 1
>
> Stop.
> *** Error exit code 1
>
> Stop.
>
> I could remove the -R from /src/Makefile, it seems the HP c compiler
> does not like that switch. Thoughts?
>
>
> ENTRY FROM src/Makefile
>
> psp_parser.c: psp_parser.l
>         @rm -f psp_parser.c
> 	  $(LEX) -R -opsp_parser.c --header-file=include/psp_flex.h
> psp_parser.l

The -R option is not from the previous compile line but from running  
lex.
It would appear your make program doesn't defined LEX variable. Since
the psp_parser.c file with source is okay, simply touch the file so  
that it
isn't being regenerated from the .l file in the first place. Ie.,

   touch src/psp_parser.c

If you have managed to loose the file, get it back out of the tarball  
and
touch it after having done that.

Graham
From grahamd at dscpl.com.au  Wed Nov 15 16:12:12 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Wed Nov 15 16:12:30 2006
Subject: [mod_python] Getting Hostname
In-Reply-To: <13283.82.56.77.83.1163613945.squirrel@webmail.pharaondev.com>
References: <13283.82.56.77.83.1163613945.squirrel@webmail.pharaondev.com>
Message-ID: <F5737BA7-060D-4BB8-ADDE-70BC626C7CAD@dscpl.com.au>


On 16/11/2006, at 5:05 AM, g.farina@pharaondev.com wrote:

> Hi,
>
> in my simple MVC framework I'd like to use a different directory  
> root for
> controllers based on the website requested by the user.
> For instance if someone connects to www.test.it/first I'd like to use
> /var/www/test as controllers root, and if someone connects to
> www.test2.it/first use /var/www/test2.
>
> I didn't have enought knowledge of how Apache works, so I don't  
> know if
> the value of req.server.server_hostname is reliable to do the  
> switch of
> the root.
> The solution used should work indipendently from Apache  
> configuration, and
> I don't want to rely on headers sent by the client.
>
> The directory switching should be configured from the application,  
> so I
> can't use Virtual Hosting or Apache configuration directly.

Why can't you use virtual hosting, this is what it is designed for?  
If it is because
your site is already running within a virtual host and you don't want  
to pay some
ISP extra money for running an extra virtual host, then it will be  
pretty well
impossible to do what you want.

The reason it would be impossible if you are already running within a  
virtual
host is that the way virtual hosting works is that HTTP/1.1 compliant  
browsers
will set a 'Host' header in the HTTP request to identify the actual  
name of the
site it wants to connect to. The web server uses the value of this  
header to
determine which of many virtual hosts it may be hosting to direct the  
request to.
This is done by looking in the Apache configuration for VirtualHost  
directive
which lists that site:

   <VirtualHost www.test.it>
   ...
   </VirtualHost>

A second independent virtual host could be setup listing the second  
site, thus:

   <VirtualHost www.test.it>
   ...
   </VirtualHost>

   <VirtualHost www.test2.it>
   ...
   </VirtualHost>

If they need to share some but not all content, you'll need to use  
Alias directives
as well as setting the DocumentRoot to the main content.

Alternatively, if you want everything to be the same but do certain  
things differently
based on host connected to, you can also use:

   <VirtualHost www.test.it www.test2.it>
   ...
   </VirtualHost>

In either case, it is going to require a change to the Apache  
configuration. If you
can't get one of these done, you can't do it, as the request to the  
additional site
will not even be able to be routed to you.

If the second virtual hosting arrangement is used, or virtual hosting  
isn't used at
all, then you still have to use some trickery to have different parts  
of the filesystem
mapped if the desired host is different.

The cleanest way of doing this is to use a PythonTransHandler.  
Because it is
called prior to any URL mapping, it must be at the level of  
VirtualHost or in
main Apache configuration if virtual hosting is not used. It cannot  
be a Directory,
Location or .htaccess context as mapping is already done at that point.

The transhandler you use would need to use (untested) something like:

   from mod_python import apache

   def transhandler(req):
     if req.hostname == 'www.test2.it':
       req.filename = '/var/www/test2' + req.uri
       return apache.OK
     return apache.DECLINED

This assumes that default DocumentRoot is 'var/www/test'. It then  
sees if the target
host is 'www.test2.it' and overrides req.filename to cause mapping of  
requests
against the alternate document root.

A problem with this is that it will potentially override any other  
Alias/Location
mappings you might have defined, thus to accommodate that the trans  
handler
may have to only do it for certain values of req.uri.

NOTE, the above code may have to cleanup req.uri and normalise it  
before it
uses it to avoid attacks whereby people use '..' in a URI to try and  
get access to
files outside of the document tree. It might also normalise the path  
after creating
the combined path and ensuring the result still resides within the  
document
tree. If Apache has cleaned up req.uri already, this will not be  
needed. I need
to check for myself what Apache has already done at that point as not  
sure.

In terms of other ways of doing it, you might be able to use  
mod_rewrite, but for
this to work, the additional document tree would need to be available  
as a subtree
of the first. You would then be essentially using a internal redirect  
to get the
request applied against the subtree. This though can cause lots of  
base url
rewriting issues for pages. The subtree would also be directly  
accessible as
well unless you protect it by a handler in some way to ensure that is  
only
accessed as part of a subrequest.

In summary, you can't probably do it cleanly without modifying the  
main Apache
configuration, as you either have to setup a virtual host, or a trans  
handler, both
of which have to be done in the main configuration.

Can you now explain why you can't modify the main Apache configuration.

Graham
From joseph.r.buehre at boeing.com  Wed Nov 15 21:50:12 2006
From: joseph.r.buehre at boeing.com (Buehre, Joseph R)
Date: Wed Nov 15 21:50:20 2006
Subject: [mod_python] Mod_python on HP-UX 11.11
In-Reply-To: <E065E78D-368E-43D6-B90E-F3474C34FB89@dscpl.com.au>
Message-ID: <C12C17049E23854783042B3D0F25BB67029B7D3F@XCH-MW-2V2.mw.nos.boeing.com>

Well the touch worked for getting past the previous error....thanks for
the info.

I just need to trouble you all for one more look into the reason for
this failure.

Performing DSO installation.

        /opt/imake/bin/install -c -d /wwimacs6/apache2/modules
rm: /wwimacs6/apache2/modules/ directory
cp: illegal option -- d
Usage:  cp [-f|-i] [-p] [-S] [-e warn|force|ignore] source_file
target_file
        cp [-f|-i] [-p] [-S] [-e warn|force|ignore] source_file ...
target_directory
        cp [-f|-i] [-p] [-S] -R|-r [-e warn|force|ignore]
source_directory ... target_directory
        /opt/imake/bin/install -c src/mod_python.so
/wwimacs6/apache2/modules
cp: cannot access src/mod_python.so: No such file or directory

Now don't forget to edit your main config and add
    LoadModule python_module /wwimacs6/apache2/modules/mod_python.so
and if your configuration uses ClearModuleList, then also
    AddModule mod_python.c

        cd dist && make install_py_lib
`psp_parser.c' is up to date.
        if test -z "" ; then \
                /opt/Boeing/python2.4.3/bin/python2.4 setup.py install
--optimize 2 --force ; \
        else \
                /opt/Boeing/python2.4.3/bin/python2.4 setup.py install
--optimize 2 --force --root  ; \
        fi

This is all that is in .libs after the make install and I end up with no
.so file

-rw-r--r--   1 root       sys         161346 Nov 15 20:39 mod_python.a
lrwxr-xr-x   1 root       sys             16 Nov 15 20:39 mod_python.la
-> ../mod_python.la
-rw-r--r--   1 root       sys            848 Nov 15 20:39 mod_python.lai
-rwxr-xr-x   1 root       sys         188416 Nov 15 20:39 mod_python.sl 

THE COMPLETE MAKE INSTALL:

make install

Compiling for DSO.

        /wwimacs6/apache2/bin/apxs -I/mod_python-3.2.10/src/include
-I/wwimacs6/apache2/include -I/opt/Boeing/python2.4.3/include/python2.4
-c mod_python.c _apachemodule.c requestobject.c tableobject.c util.c
serverobject.c connobject.c filterobject.c hlist.c hlistobject.c
-L/opt/Boeing/python2.4.3/lib
-L/opt/Boeing/python2.4.3/lib/python2.4/config  -Wl,-E -Wl,+s      -lm
-lpython2.4   -lnsl -lrt -ldld  -lpthread   -lm
/wwimacs6/apache2/build/libtool --silent --mode=compile
/opt/ansic/bin/cc -prefer-pic -O3 -DSSL_EXPERIMENTAL -DSSL_ENGINE
-D_REENTRANT -Ae +DAportable  -DHPUX11 -D_REENTRANT
-D_XOPEN_SOURCE_EXTENDED  -I/wwimacs6/apache2/include
-I/wwimacs6/apache2/include   -I/wwimacs6/apache2/include
-I/mod_python-3.2.10/src/include -I/wwimacs6/apache2/include
-I/opt/Boeing/python2.4.3/include/python2.4  -c -o mod_python.lo
mod_python.c && touch mod_python.slo
cc: "mod_python.c", line 313: warning 611: Type conversion loses "const"
qualifier.
cc: "mod_python.c", line 313: warning 563: Argument #1 is not the
correct type.
cc: "mod_python.c", line 427: warning 611: Type conversion loses "const"
qualifier.
cc: "mod_python.c", line 458: warning 611: Type conversion loses "const"
qualifier.
cc: "mod_python.c", line 540: warning 611: Type conversion loses "const"
qualifier.
/wwimacs6/apache2/build/libtool --silent --mode=compile
/opt/ansic/bin/cc -prefer-pic -O3 -DSSL_EXPERIMENTAL -DSSL_ENGINE
-D_REENTRANT -Ae +DAportable  -DHPUX11 -D_REENTRANT
-D_XOPEN_SOURCE_EXTENDED  -I/wwimacs6/apache2/include
-I/wwimacs6/apache2/include   -I/wwimacs6/apache2/include
-I/mod_python-3.2.10/src/include -I/wwimacs6/apache2/include
-I/opt/Boeing/python2.4.3/include/python2.4  -c -o _apachemodule.lo
_apachemodule.c && touch _apachemodule.slo
/wwimacs6/apache2/build/libtool --silent --mode=compile
/opt/ansic/bin/cc -prefer-pic -O3 -DSSL_EXPERIMENTAL -DSSL_ENGINE
-D_REENTRANT -Ae +DAportable  -DHPUX11 -D_REENTRANT
-D_XOPEN_SOURCE_EXTENDED  -I/wwimacs6/apache2/include
-I/wwimacs6/apache2/include   -I/wwimacs6/apache2/include
-I/mod_python-3.2.10/src/include -I/wwimacs6/apache2/include
-I/opt/Boeing/python2.4.3/include/python2.4  -c -o requestobject.lo
requestobject.c && touch requestobject.slo
cc: "requestobject.c", line 426: warning 611: Type conversion loses
"const" qualifier.
cc: "requestobject.c", line 427: warning 604: Pointers are not
assignment-compatible.
cc: "requestobject.c", line 1447: warning 604: Pointers are not
assignment-compatible.
cc: "requestobject.c", line 1454: warning 604: Pointers are not
assignment-compatible.
cc: "requestobject.c", line 1569: warning 604: Pointers are not
assignment-compatible.
/wwimacs6/apache2/build/libtool --silent --mode=compile
/opt/ansic/bin/cc -prefer-pic -O3 -DSSL_EXPERIMENTAL -DSSL_ENGINE
-D_REENTRANT -Ae +DAportable  -DHPUX11 -D_REENTRANT
-D_XOPEN_SOURCE_EXTENDED  -I/wwimacs6/apache2/include
-I/wwimacs6/apache2/include   -I/wwimacs6/apache2/include
-I/mod_python-3.2.10/src/include -I/wwimacs6/apache2/include
-I/opt/Boeing/python2.4.3/include/python2.4  -c -o tableobject.lo
tableobject.c && touch tableobject.slo
cc: "tableobject.c", line 1057: warning 604: Pointers are not
assignment-compatible.
/wwimacs6/apache2/build/libtool --silent --mode=compile
/opt/ansic/bin/cc -prefer-pic -O3 -DSSL_EXPERIMENTAL -DSSL_ENGINE
-D_REENTRANT -Ae +DAportable  -DHPUX11 -D_REENTRANT
-D_XOPEN_SOURCE_EXTENDED  -I/wwimacs6/apache2/include
-I/wwimacs6/apache2/include   -I/wwimacs6/apache2/include
-I/mod_python-3.2.10/src/include -I/wwimacs6/apache2/include
-I/opt/Boeing/python2.4.3/include/python2.4  -c -o util.lo util.c &&
touch util.slo
/wwimacs6/apache2/build/libtool --silent --mode=compile
/opt/ansic/bin/cc -prefer-pic -O3 -DSSL_EXPERIMENTAL -DSSL_ENGINE
-D_REENTRANT -Ae +DAportable  -DHPUX11 -D_REENTRANT
-D_XOPEN_SOURCE_EXTENDED  -I/wwimacs6/apache2/include
-I/wwimacs6/apache2/include   -I/wwimacs6/apache2/include
-I/mod_python-3.2.10/src/include -I/wwimacs6/apache2/include
-I/opt/Boeing/python2.4.3/include/python2.4  -c -o serverobject.lo
serverobject.c && touch serverobject.slo
cc: "serverobject.c", line 351: warning 604: Pointers are not
assignment-compatible.
/wwimacs6/apache2/build/libtool --silent --mode=compile
/opt/ansic/bin/cc -prefer-pic -O3 -DSSL_EXPERIMENTAL -DSSL_ENGINE
-D_REENTRANT -Ae +DAportable  -DHPUX11 -D_REENTRANT
-D_XOPEN_SOURCE_EXTENDED  -I/wwimacs6/apache2/include
-I/wwimacs6/apache2/include   -I/wwimacs6/apache2/include
-I/mod_python-3.2.10/src/include -I/wwimacs6/apache2/include
-I/opt/Boeing/python2.4.3/include/python2.4  -c -o connobject.lo
connobject.c && touch connobject.slo
/wwimacs6/apache2/build/libtool --silent --mode=compile
/opt/ansic/bin/cc -prefer-pic -O3 -DSSL_EXPERIMENTAL -DSSL_ENGINE
-D_REENTRANT -Ae +DAportable  -DHPUX11 -D_REENTRANT
-D_XOPEN_SOURCE_EXTENDED  -I/wwimacs6/apache2/include
-I/wwimacs6/apache2/include   -I/wwimacs6/apache2/include
-I/mod_python-3.2.10/src/include -I/wwimacs6/apache2/include
-I/opt/Boeing/python2.4.3/include/python2.4  -c -o filterobject.lo
filterobject.c && touch filterobject.slo
/wwimacs6/apache2/build/libtool --silent --mode=compile
/opt/ansic/bin/cc -prefer-pic -O3 -DSSL_EXPERIMENTAL -DSSL_ENGINE
-D_REENTRANT -Ae +DAportable  -DHPUX11 -D_REENTRANT
-D_XOPEN_SOURCE_EXTENDED  -I/wwimacs6/apache2/include
-I/wwimacs6/apache2/include   -I/wwimacs6/apache2/include
-I/mod_python-3.2.10/src/include -I/wwimacs6/apache2/include
-I/opt/Boeing/python2.4.3/include/python2.4  -c -o hlist.lo hlist.c &&
touch hlist.slo
/wwimacs6/apache2/build/libtool --silent --mode=compile
/opt/ansic/bin/cc -prefer-pic -O3 -DSSL_EXPERIMENTAL -DSSL_ENGINE
-D_REENTRANT -Ae +DAportable  -DHPUX11 -D_REENTRANT
-D_XOPEN_SOURCE_EXTENDED  -I/wwimacs6/apache2/include
-I/wwimacs6/apache2/include   -I/wwimacs6/apache2/include
-I/mod_python-3.2.10/src/include -I/wwimacs6/apache2/include
-I/opt/Boeing/python2.4.3/include/python2.4  -c -o hlistobject.lo
hlistobject.c && touch hlistobject.slo
/wwimacs6/apache2/build/libtool --silent --mode=link /opt/ansic/bin/cc
-o mod_python.la -I/mod_python-3.2.10/src/include
-I/wwimacs6/apache2/include -I/opt/Boeing/python2.4.3/include/python2.4
-rpath /wwimacs6/apache2/modules -module -avoid-version
hlistobject.lo hlist.lo filterobject.lo connobject.lo serverobject.lo
util.lo tableobject.lo requestobject.lo _apachemodule.lo mod_python.lo
-L/opt/Boeing/python2.4.3/lib
-L/opt/Boeing/python2.4.3/lib/python2.4/config -Wl,-E -Wl,+s -lm
-lpython2.4 -lnsl -lrt -ldld -lpthread -lm
`psp_parser.c' is up to date.
        /opt/Boeing/python2.4.3/bin/python2.4 setup.py build
running build
running build_py
running build_ext

Now su and make install
  (or, if you only want to perform a partial install,
   you can use make install_dso and make install_py_lib)


Performing DSO installation.

        /opt/imake/bin/install -c -d /wwimacs6/apache2/modules
rm: /wwimacs6/apache2/modules/ directory
cp: illegal option -- d
Usage:  cp [-f|-i] [-p] [-S] [-e warn|force|ignore] source_file
target_file
        cp [-f|-i] [-p] [-S] [-e warn|force|ignore] source_file ...
target_directory
        cp [-f|-i] [-p] [-S] -R|-r [-e warn|force|ignore]
source_directory ... target_directory
        /opt/imake/bin/install -c src/mod_python.so
/wwimacs6/apache2/modules
cp: cannot access src/mod_python.so: No such file or directory

Now don't forget to edit your main config and add
    LoadModule python_module /wwimacs6/apache2/modules/mod_python.so
and if your configuration uses ClearModuleList, then also
    AddModule mod_python.c

        cd dist && make install_py_lib
`psp_parser.c' is up to date.
        if test -z "" ; then \
                /opt/Boeing/python2.4.3/bin/python2.4 setup.py install
--optimize 2 --force ; \
        else \
                /opt/Boeing/python2.4.3/bin/python2.4 setup.py install
--optimize 2 --force --root  ; \
        fi
running install
running build
running build_py
running build_ext
running install_lib
copying build/lib.hp-ux-B.11.11-9000/800-2.4/mod_python/testhandler.py
-> /opt/Boeing/python2.4.3/lib/python2.4/site-packages/mod_python
copying build/lib.hp-ux-B.11.11-9000/800-2.4/mod_python/Cookie.py ->
/opt/Boeing/python2.4.3/lib/python2.4/site-packages/mod_python
copying build/lib.hp-ux-B.11.11-9000/800-2.4/mod_python/publisher.py ->
/opt/Boeing/python2.4.3/lib/python2.4/site-packages/mod_python
copying build/lib.hp-ux-B.11.11-9000/800-2.4/mod_python/__init__.py ->
/opt/Boeing/python2.4.3/lib/python2.4/site-packages/mod_python
copying build/lib.hp-ux-B.11.11-9000/800-2.4/mod_python/util.py ->
/opt/Boeing/python2.4.3/lib/python2.4/site-packages/mod_python
copying build/lib.hp-ux-B.11.11-9000/800-2.4/mod_python/cgihandler.py ->
/opt/Boeing/python2.4.3/lib/python2.4/site-packages/mod_python
copying build/lib.hp-ux-B.11.11-9000/800-2.4/mod_python/apache.py ->
/opt/Boeing/python2.4.3/lib/python2.4/site-packages/mod_python
copying build/lib.hp-ux-B.11.11-9000/800-2.4/mod_python/psp.py ->
/opt/Boeing/python2.4.3/lib/python2.4/site-packages/mod_python
copying build/lib.hp-ux-B.11.11-9000/800-2.4/mod_python/Session.py ->
/opt/Boeing/python2.4.3/lib/python2.4/site-packages/mod_python
copying build/lib.hp-ux-B.11.11-9000/800-2.4/mod_python/cache.py ->
/opt/Boeing/python2.4.3/lib/python2.4/site-packages/mod_python
copying build/lib.hp-ux-B.11.11-9000/800-2.4/mod_python/python22.py ->
/opt/Boeing/python2.4.3/lib/python2.4/site-packages/mod_python
copying build/lib.hp-ux-B.11.11-9000/800-2.4/mod_python/_psp.sl ->
/opt/Boeing/python2.4.3/lib/python2.4/site-packages/mod_python
byte-compiling
/opt/Boeing/python2.4.3/lib/python2.4/site-packages/mod_python/testhandl
er.py to testhandler.pyc
byte-compiling
/opt/Boeing/python2.4.3/lib/python2.4/site-packages/mod_python/Cookie.py
to Cookie.pyc
byte-compiling
/opt/Boeing/python2.4.3/lib/python2.4/site-packages/mod_python/publisher
.py to publisher.pyc
byte-compiling
/opt/Boeing/python2.4.3/lib/python2.4/site-packages/mod_python/__init__.
py to __init__.pyc
byte-compiling
/opt/Boeing/python2.4.3/lib/python2.4/site-packages/mod_python/util.py
to util.pyc
byte-compiling
/opt/Boeing/python2.4.3/lib/python2.4/site-packages/mod_python/cgihandle
r.py to cgihandler.pyc
byte-compiling
/opt/Boeing/python2.4.3/lib/python2.4/site-packages/mod_python/apache.py
to apache.pyc
byte-compiling
/opt/Boeing/python2.4.3/lib/python2.4/site-packages/mod_python/psp.py to
psp.pyc
byte-compiling
/opt/Boeing/python2.4.3/lib/python2.4/site-packages/mod_python/Session.p
y to Session.pyc
byte-compiling
/opt/Boeing/python2.4.3/lib/python2.4/site-packages/mod_python/cache.py
to cache.pyc
byte-compiling
/opt/Boeing/python2.4.3/lib/python2.4/site-packages/mod_python/python22.
py to python22.pyc
writing byte-compilation script '/tmp/tmpuG8DE8.py'
/opt/Boeing/python2.4.3/bin/python2.4 -OO /tmp/tmpuG8DE8.py
removing /tmp/tmpuG8DE8.py


Thanks, 
Joe Buehre 
Mission Critical Systems Support 
314-791-9725

 mailto:joseph.r.buehre@boeing.com


-----Original Message-----
From: Graham Dumpleton [mailto:grahamd@dscpl.com.au] 
Sent: Wednesday, November 15, 2006 2:18 PM
To: Buehre, Joseph R
Cc: Deron Meranda; mod_python@modpython.org
Subject: Re: [mod_python] Mod_python on HP-UX 11.11


On 16/11/2006, at 4:28 AM, Buehre, Joseph R wrote:

>          -R -opsp_parser.c --header-file=include/psp_flex.h 
> psp_parser.l
> sh: -R:  not found.
> *** Error exit code 127
>
> Stop.
> *** Error exit code 1
>
> Stop.
> *** Error exit code 1
>
> Stop.
>
> I could remove the -R from /src/Makefile, it seems the HP c compiler 
> does not like that switch. Thoughts?
>
>
> ENTRY FROM src/Makefile
>
> psp_parser.c: psp_parser.l
>         @rm -f psp_parser.c
> 	  $(LEX) -R -opsp_parser.c --header-file=include/psp_flex.h 
> psp_parser.l

The -R option is not from the previous compile line but from running
lex.
It would appear your make program doesn't defined LEX variable. Since
the psp_parser.c file with source is okay, simply touch the file so that
it isn't being regenerated from the .l file in the first place. Ie.,

   touch src/psp_parser.c

If you have managed to loose the file, get it back out of the tarball
and touch it after having done that.

Graham

From grahamd at dscpl.com.au  Wed Nov 15 22:06:49 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Wed Nov 15 22:06:59 2006
Subject: [mod_python] Mod_python on HP-UX 11.11
Message-ID: <1163646409.19165@dscpl.user.openhosting.com>

Buehre, Joseph R wrote ..
> Well the touch worked for getting past the previous error....thanks for
> the info.
> 
> I just need to trouble you all for one more look into the reason for
> this failure.
> 
> Performing DSO installation.
> 
>         /opt/imake/bin/install -c -d /wwimacs6/apache2/modules
> rm: /wwimacs6/apache2/modules/ directory
> cp: illegal option -- d
> Usage:  cp [-f|-i] [-p] [-S] [-e warn|force|ignore] source_file
> target_file
>         cp [-f|-i] [-p] [-S] [-e warn|force|ignore] source_file ...
> target_directory
>         cp [-f|-i] [-p] [-S] -R|-r [-e warn|force|ignore]
> source_directory ... target_directory
>         /opt/imake/bin/install -c src/mod_python.so
> /wwimacs6/apache2/modules
> cp: cannot access src/mod_python.so: No such file or directory

Either you 'install' program is stuffed in some way, or it is configured for a
different 'cp' program than what you have in your path. If you go 'which cp'
does it find /bin/cp or some other cp?

You might also use a different 'install' program. You can get one from:

  http://svn.dscpl.com.au/makeit/trunk/scripts/install-sh

When you run configure for mod_python, do:

  INSTALL=/some/path/install-sh ./configure ......

so it will use this install program rather than the one it is finding.

> Now don't forget to edit your main config and add
>     LoadModule python_module /wwimacs6/apache2/modules/mod_python.so
> and if your configuration uses ClearModuleList, then also
>     AddModule mod_python.c
> 
>         cd dist && make install_py_lib
> `psp_parser.c' is up to date.
>         if test -z "" ; then \
>                 /opt/Boeing/python2.4.3/bin/python2.4 setup.py install
> --optimize 2 --force ; \
>         else \
>                 /opt/Boeing/python2.4.3/bin/python2.4 setup.py install
> --optimize 2 --force --root  ; \
>         fi
> 
> This is all that is in .libs after the make install and I end up with no
> .so file
> 
> -rw-r--r--   1 root       sys         161346 Nov 15 20:39 mod_python.a
> lrwxr-xr-x   1 root       sys             16 Nov 15 20:39 mod_python.la
> -> ../mod_python.la
> -rw-r--r--   1 root       sys            848 Nov 15 20:39 mod_python.lai
> -rwxr-xr-x   1 root       sys         188416 Nov 15 20:39 mod_python.sl

The mod_python.sl file is what you are after. The libtool program looks
not to be generating .so extension because of HPUX using a .sl extension.

Suggest you manually copy mod_python.sl into Apache modules directory,
renaming it to have a .so extension if that then matches other Apache modules.

If you do this manually, you don't need to use that other install script.
Instead, do:

  make install_py_lib

to install Python stuff and then manually copy module file to Apache
as described.

Graham
From deron.meranda at gmail.com  Thu Nov 16 01:00:47 2006
From: deron.meranda at gmail.com (Deron Meranda)
Date: Thu Nov 16 01:00:52 2006
Subject: [mod_python] Mod_python on HP-UX 11.11
In-Reply-To: <1163646409.19165@dscpl.user.openhosting.com>
References: <1163646409.19165@dscpl.user.openhosting.com>
Message-ID: <5c06fa770611152200j1e7ad8cbmc4c612d39c4db06e@mail.gmail.com>

> >         /opt/imake/bin/install -c -d /wwimacs6/apache2/modules
> > rm: /wwimacs6/apache2/modules/ directory
> > cp: illegal option -- d

The "install" that comes with imake (a really old build
system for X Window System) does not conform to the
the same options that the GNU install program does.
Unfortunately that's the only thing that comes with HP-UX,
so the autoconfigure scripts will try to use it.  Sometimes
it works and sometimes it doesn't.

You can either copy the files manually, or the best
option if you compile a lot of open source software is
to install the GNU version (it's in the "coreutils" package
these days).  http://www.gnu.org/software/coreutils/

In fact to make life happier I typically always install the
GNU versions of these before bulding much of anything
else: install, gmake, libtool


> > This is all that is in .libs after the make install and I end up with no
> > .so file
> >
> > -rw-r--r--   1 root       sys         161346 Nov 15 20:39 mod_python.a
> > lrwxr-xr-x   1 root       sys             16 Nov 15 20:39 mod_python.la
> > -> ../mod_python.la
> > -rw-r--r--   1 root       sys            848 Nov 15 20:39 mod_python.lai
> > -rwxr-xr-x   1 root       sys         188416 Nov 15 20:39 mod_python.sl
>
> The mod_python.sl file is what you are after. The libtool program looks
> not to be generating .so extension because of HPUX using a .sl extension.

Graham's right, rename the *.sl to *.so should work.

HP-UX uses a default *.sl extension for all shared libraries, as
well as shared objects (there's really no difference for 32-bit
SOM format).  For 64-bit HP-UX uses ELF, but still keeps the *.sl
convention.  The older Apache/libtool you have just aren't passing
all the options to the linker to make it use the alternate names.

However you can name the file anything you want, so just rename
it from *.sl to *.so.  The linker (ld) won't know what a *.so file is,
but Apache loads modules using the dlopen(3) calls, not ld, and
it is Apache which is expecting the file to have a *.so extension.

Since you're having to manually install the library, you may want
to check the file for dependencies first.  libtool will typically
re-link all shared libraries/objects during the install phase so
what you find in the build .libs directory may not be exactly what
you would get after the install phase.

To see if you're okay, do the following command on the library:

    chatr  mod_python.sl

Among the output you'll see any dynamic dependencies on
additional libraries.  You want to check for any libraries other
than the standard system ones (in /usr/lib).  In particular see
if there is a dependency on libpython* or any other non-HP
libraries.  I don't know if you'll see them or not, but if you do
check out if the references have the correct embded paths
to where the libraries are actually installed and not to where
you happened to build them.

If you don't know how to interpret the chatr output and are
still having problems post the output of chatr here.


One thing you may definitely want to try/test is that the
chained shared loading works.  Remember that Apache
loads shared objects dynamically, but so does Python.
So you can have a case where apache loads mod_python,
which then because of some import statement of a
C-extension module will then dynamically load another
shared object (from the python lib).  So to test that all
your dynamic linking stuff is working, write a simple
mod_python handler which imports some C-based python
module such as cStringIO (assuming your Python was
built to have it as a loadable module).  Look in the python
lib-dynload directory of your Python installation for
candidate modules to try.

Finally, also be aware of any potentially conflicting shared
objects/libraries that Apache vs. Python use.  Typical
potential conflicts are with zlib (libz) or the SSL libs
(libcrypto, libssl).  Make sure everything is linking against
the exact same versions of everything.


BTW, this is not a mod_python issue, but just so you
know there was an HP-UX specific bug in Apache 2.0.x
with the regex libraries; it would use HP's libraries thinking
they were POSIX regex compatible, but they weren't...
causing many Apache regex-based directives to fail
(such as <FileMatch>).   I filed a bug report/patch ages
ago and this seems to no longer be a problem with the
Apache 2.2 branch.
-- 
Deron Meranda
From jcigar at ulb.ac.be  Thu Nov 16 07:47:24 2006
From: jcigar at ulb.ac.be (Julien Cigar)
Date: Thu Nov 16 07:35:38 2006
Subject: [mod_python] high memory consumption with multiple Python
	interpreters ?
Message-ID: <455C5DDC.10208@ulb.ac.be>

Hello !

I'm using mod_python with several vhosts, so I have to use multiple 
interpreters with the PythonInterpreter directive to avoid namespaces 
conflicts.

If I understood well, every PythonInterpreter directive loads another 
Python interpreter in *each* Apache process, so with 5 PythonInterpreter 
directives it consumes 5 times more memory ? I wondered if this can lead 
to an high memory consumption with a lot of vhosts (how "heavy" is a 
Python interpreter ?) ?

Thansk,
Julien

-- 
Julien Cigar
Belgian Biodiversity Platform
http://www.biodiversity.be
Universit? Libre de Bruxelles
Campus de la Plaine CP 257
B?timent NO, Bureau 4 N4 115C (Niveau 4)
Boulevard du Triomphe, entr?e ULB 2
B-1050 Bruxelles
office: jcigar@ulb.ac.be
home: mage@mordor.ath.cx

From richardlewis at fastmail.co.uk  Thu Nov 16 08:05:15 2006
From: richardlewis at fastmail.co.uk (Richard Lewis)
Date: Thu Nov 16 08:06:10 2006
Subject: [mod_python] high memory consumption with multiple Python
	interpreters ?
In-Reply-To: <455C5DDC.10208@ulb.ac.be>
References: <455C5DDC.10208@ulb.ac.be>
Message-ID: <200611161305.15332.richardlewis@fastmail.co.uk>

On Thursday 16 November 2006 12:47, Julien Cigar wrote:
> (how "heavy" is a Python interpreter ?) ?
>
Assuming you're on Unix, I would suggest that you try it out. Try loading some 
python processing and importing the modules that you use. Then drop back into 
the shell and go:

repeat:
$ python -ic "import my_module" &
several times

$ ps aux | head -1
USER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND
$ ps aux | grep python
r  7884  0.5  1.6  11964  8576 pts/4    T    13:00   0:00 python -ic import m
r  7885  0.4  1.6  11972  8576 pts/4    T    13:00   0:00 python -ic import m
r  7886  0.7  1.6  11964  8576 pts/4    T    13:00   0:00 python -ic import m
r  7887  0.5  1.6  11972  8580 pts/4    T    13:00   0:00 python -ic import m
r  7888  0.6  1.6  11964  8576 pts/4    T    13:00   0:00 python -ic import m
r  7889  0.5  1.6  11964  8576 pts/4    T    13:00   0:00 python -ic import m
r  7892  1.5  1.6  11964  8576 pts/4    T    13:00   0:00 python -ic import m
r  7894  0.0  0.1   1952   632 pts/4    S+   13:00   0:00 grep python

As you can see, my python processes are each using 1.6% of my computer's 512MB 
of RAM. Its not the most accurate test, but its quite fun ;-)

Cheers,
Richard
-- 
-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
Richard Lewis
Sonic Arts Research Archive
http://www.sara.uea.ac.uk/
JID: ironchicken@jabber.earth.li
-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
From administrator at leebrown.org  Thu Nov 16 09:25:28 2006
From: administrator at leebrown.org (Lee Brown)
Date: Thu Nov 16 09:26:07 2006
Subject: [mod_python] Getting Hostname
In-Reply-To: <F5737BA7-060D-4BB8-ADDE-70BC626C7CAD@dscpl.com.au>
Message-ID: <008301c7098b$10cccd70$0301a8c0@uberbox>

Greetings!

One way to avoid attacks of all kinds is to use Mod Security, which checks
the entire request against a security rule set.  Rule sets are defined
within the main Apache configuration file and look like this (highly
abbreviated) example:

SecFilter "\.\./" "deny,log,status:666"
SecFilterSelective REQUEST_METHOD "SEARCH" "deny,log,status:405"
SecFilterSelective REQUEST_URI "\.exe"  "deny,log,status:666"

The first rule shown protects against symbolic directory traversal for any
kind of request.  If ".." is found, the rule causes Apache to deny access,
log the request, and return an HTTPD status code of 666.  The second rule
denies any request with HTTPD method "search."  The last rule denies any
request with ".exe" in the URI.  You can write a rule for any HTTPD header
field or URI form, and define the action to take and what status code to
return.

I'm not sure about this, but I think that Mod Security works in Apache's
PostReadRequest phase, so it (probably) won't interfere with a Mod Python
Translation phase handler.  Mod Security is exhaustively documented and they
are very responsive to e-mail queries.

I can't say enough good things about Mod Security.  See www.modsecurity.org

Best Regards,
Lee E. Brown
(administrator@leebrown.org)

-----Original Message-----
From: mod_python-bounces@modpython.org
[mailto:mod_python-bounces@modpython.org] On Behalf Of Graham Dumpleton
Sent: Wednesday, November 15, 2006 4:12 PM
To: g.farina@pharaondev.com
Cc: mod_python@modpython.org
Subject: Re: [mod_python] Getting Hostname

NOTE, the above code may have to cleanup req.uri and normalise it before it
uses it to avoid attacks whereby people use '..' in a URI to try and get
access to files outside of the document tree. It might also normalise the
path after creating the combined path and ensuring the result still resides
within the document tree. If Apache has cleaned up req.uri already, this
will not be needed. I need to check for myself what Apache has already done
at that point as not sure.


From deron.meranda at gmail.com  Thu Nov 16 11:10:42 2006
From: deron.meranda at gmail.com (Deron Meranda)
Date: Thu Nov 16 11:11:07 2006
Subject: [mod_python] high memory consumption with multiple Python
	interpreters ?
In-Reply-To: <200611161305.15332.richardlewis@fastmail.co.uk>
References: <455C5DDC.10208@ulb.ac.be>
	<200611161305.15332.richardlewis@fastmail.co.uk>
Message-ID: <5c06fa770611160810l7873f897s4c3ffb47970a7cf7@mail.gmail.com>

On 11/16/06, Richard Lewis <richardlewis@fastmail.co.uk> wrote:
> On Thursday 16 November 2006 12:47, Julien Cigar wrote:
> > (how "heavy" is a Python interpreter ?) ?
> >
> Assuming you're on Unix, I would suggest that you try it out. Try loading some
> python processing and importing the modules that you use. Then drop back into
> the shell and go:
>
> repeat:
> $ python -ic "import my_module" &
> several times
>
> $ ps aux | head -1
> USER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND
> $ ps aux | grep python
> r  7884  0.5  1.6  11964  8576 pts/4    T    13:00   0:00 python -ic import m
> r  7885  0.4  1.6  11972  8576 pts/4    T    13:00   0:00 python -ic import m
> r  7886  0.7  1.6  11964  8576 pts/4    T    13:00   0:00 python -ic import m
> r  7887  0.5  1.6  11972  8580 pts/4    T    13:00   0:00 python -ic import m
> r  7888  0.6  1.6  11964  8576 pts/4    T    13:00   0:00 python -ic import m
> r  7889  0.5  1.6  11964  8576 pts/4    T    13:00   0:00 python -ic import m
> r  7892  1.5  1.6  11964  8576 pts/4    T    13:00   0:00 python -ic import m
> r  7894  0.0  0.1   1952   632 pts/4    S+   13:00   0:00 grep python
>
> As you can see, my python processes are each using 1.6% of my computer's 512MB
> of RAM. Its not the most accurate test, but its quite fun ;-)

You also need to realize that having one process run multiple instances
of a Python interpreter (as with mod_python) is different than running
multiple processes entirely.  There are a lot of resources that will be
shared in the former case (such as all the C-based code that makes up
the Python core as well as any C-based python modules that are loaded).

The real memory usage is also highly dependent upon what your
mod_python handlers are doing.  If they are creating lots of objects,
store internal caches, load entire files into memory, do select * from
large database tables, etc.

Of course the only real way to tell what happens is to just try it out under
an actual Apache environment.  But aside from any mod_python memory
leaks (which tend to get fixed rather quickly when found), I think you'll
find that using multiple interpreters under mod_python is actually less
memory intensive (or no worse) than a multiple-process approach like
CGI.
-- 
Deron Meranda
From g.farina at pharaondev.com  Thu Nov 16 11:14:31 2006
From: g.farina at pharaondev.com (g.farina@pharaondev.com)
Date: Thu Nov 16 11:14:35 2006
Subject: [mod_python] Getting Hostname
In-Reply-To: <F5737BA7-060D-4BB8-ADDE-70BC626C7CAD@dscpl.com.au>
References: <13283.82.56.77.83.1163613945.squirrel@webmail.pharaondev.com>
	<F5737BA7-060D-4BB8-ADDE-70BC626C7CAD@dscpl.com.au>
Message-ID: <49497.83.103.96.60.1163693671.squirrel@webmail.pharaondev.com>

Trying to explain better my situation:

I have one server which hosts a lot of websites using only 1 IP address
and VirtualHosts for dispatching the requests.
Currently I have one framework installed for every document root but,
because the differences between each website are only static files and DB
content, I'd like to use only one framework/cms installation and, based on
the website requested, using different roots for static files and
different DNS for DB connections. The framework is quite customizable from
a config file, so also this file should be loaded based on the website
requested; this file contains also the definition of the DNS to connect to
the DB and the root of static files, so the dispatching should be done at
runtime by Python and cannot be done using Apache.

Gabriele

From surf-kid24 at freemail.hu  Fri Nov 17 04:09:29 2006
From: surf-kid24 at freemail.hu (Istvan De)
Date: Fri Nov 17 03:06:05 2006
Subject: [mod_python] getting cookies from the response
Message-ID: <1163754569.11489.4.camel@localhost>

Hi!

In my code, if I detect that a cookie is not set, I set it using
Cookie.add_cookie().

That is all well. However, if I read this cookie from the same request
at which it was added, it is not available. I guess this is because the
"cookie add" function puts the cookie into the reponse of the page, and
the "cookie get" function only looks at the request to see what cookies
are set.

What is the solution to my problem? 

Thank you,
Istvan

From grahamd at dscpl.com.au  Fri Nov 17 04:21:11 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Fri Nov 17 04:21:20 2006
Subject: [mod_python] getting cookies from the response
In-Reply-To: <1163754569.11489.4.camel@localhost>
References: <1163754569.11489.4.camel@localhost>
Message-ID: <35B7751B-09BB-43C2-B517-42864277B406@dscpl.com.au>


On 17/11/2006, at 8:09 PM, Istvan De wrote:

> Hi!
>
> In my code, if I detect that a cookie is not set, I set it using
> Cookie.add_cookie().
>
> That is all well. However, if I read this cookie from the same request
> at which it was added, it is not available. I guess this is because  
> the
> "cookie add" function puts the cookie into the reponse of the page,  
> and
> the "cookie get" function only looks at the request to see what  
> cookies
> are set.
>
> What is the solution to my problem?

Cookie.get_cookies() reads from req.headers_in. Cookie.add_cookie()
writes to req.headers_out. Thus, you can't read back what you only just
wrote.

Suggest you log using apache.log_error() the values of the input and
output headers to see what they are set to.

Note that Cookie.add_cookie() must be called prior to the first time  
that
any actual content is written back as the response.

Graham
From grahamd at dscpl.com.au  Fri Nov 17 04:27:36 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Fri Nov 17 04:27:43 2006
Subject: [mod_python] Getting Hostname
In-Reply-To: <49497.83.103.96.60.1163693671.squirrel@webmail.pharaondev.com>
References: <13283.82.56.77.83.1163613945.squirrel@webmail.pharaondev.com>
	<F5737BA7-060D-4BB8-ADDE-70BC626C7CAD@dscpl.com.au>
	<49497.83.103.96.60.1163693671.squirrel@webmail.pharaondev.com>
Message-ID: <2BDA89DF-7724-45A0-8AF8-41BD67462ADE@dscpl.com.au>


On 17/11/2006, at 3:14 AM, g.farina@pharaondev.com wrote:

> Trying to explain better my situation:
>
> I have one server which hosts a lot of websites using only 1 IP  
> address
> and VirtualHosts for dispatching the requests.
> Currently I have one framework installed for every document root but,
> because the differences between each website are only static files  
> and DB
> content, I'd like to use only one framework/cms installation and,  
> based on
> the website requested, using different roots for static files and
> different DNS for DB connections. The framework is quite  
> customizable from
> a config file, so also this file should be loaded based on the website
> requested; this file contains also the definition of the DNS to  
> connect to
> the DB and the root of static files, so the dispatching should be  
> done at
> runtime by Python and cannot be done using Apache.

Can you send an example of a couple of the VirtualHost configurations so
I can see how you are setting up mod_python to be triggered in each?
This will help me to understand what you are doing and how change it.

Graham
From fizban at paranoici.org  Fri Nov 17 05:36:16 2006
From: fizban at paranoici.org (fizban)
Date: Fri Nov 17 05:36:10 2006
Subject: [mod_python] Approach to mod_python "secure" code
Message-ID: <455D90A0.2000003@paranoici.org>

Hi all,

I'm new to python and mod_python, I've just started moving away from PHP
so I apology if my questions will look dumb :)
I'm finding it easy to learn python for now, there's plenty of docs
around, and mailing lists like this one (I've been lurking for a few
days) are pretty usefull. However there are things that I'm not sure I'm
approaching in the right way, so I'd need an hand by someone more
experienced than me.

I'm in the process of converting a website to mod_python, and after some
reading I decided to opt for the "my own handler" approach. I'll have an
"index.py" (the name isn't important) using SetHandler. So my handler
will deal with all the requests for that directory.

My approach to this is the following:

1* take req.uri, str() it (just in case?) and split('/') it.
[stuff = str(req.uri).split('/')
2* take stuff[1], see if isalpha(), if so see if stuff[1] is in a tuple
(contains all the valid "sections"). if it is, we assume stuff[1] is
safe to deal with. if not, we return a custom 404.
3* if stuff[1] is valid, and it is in a tuple containing a list of
special sections with a matching function, we run that function
[eval("%s(%s)" % (section, "req"))]. some of these functions take other
arguments, like a (pre validated with similar approach) stuff[2], or
req.args (same here). otherwise we run some other routine, by parsing
and req.writing a template.
[stuff[2] or req.args are this time matched against regular expressions,
to see if they fit the arguments taken by the section functions]

Do you guys think it's a decent approach in terms of "security"? Would
you take any other validation steps? As I said I'm really new to python
and mod_python, so since the website has some huge userbase, I'm really
worried about security.. We are not using (for various reasons) sql db,
only templates and local xml basically, so sql inj. is not an issue.

Since the site re-design will force us to change all the URI, I have
setup some other function to see if str(req.uri) matches moved or
deleted pages, if so we return 410 or 301 messages. 404 give the
impression of a messed up site. Is str(req.uri) safe enough to be passed
as argument to the notfound() or moved() functions I've made?

Thanks in advance for any hint or comment you may give me!
I'm also looking for any "guide" or paper about writing "secure" code
with mod_python, I haven't been able to find any on my own, for now :)

Ciao,

Andreas
From deron.meranda at gmail.com  Fri Nov 17 11:57:18 2006
From: deron.meranda at gmail.com (Deron Meranda)
Date: Fri Nov 17 11:57:23 2006
Subject: [mod_python] Approach to mod_python "secure" code
In-Reply-To: <455D90A0.2000003@paranoici.org>
References: <455D90A0.2000003@paranoici.org>
Message-ID: <5c06fa770611170857p2e8a6e8ajc053fe3521bb60ea@mail.gmail.com>

On 11/17/06, fizban <fizban@paranoici.org> wrote:
> 1* take req.uri, str() it (just in case?) and split('/') it.
> [stuff = str(req.uri).split('/')

There's no need to str() it.  It's already a string.  It will also have been
url decoded.

However req.uri is not UTF-8 decoded, in case you deal with
Unicode URLs.  If you care about that you should probably do

   try:
       uri = req.uri().decode('utf8')
   except UnicodeDecodeError:
       raise apache.SERVER_RETURN, apache.HTTP_BAD_REQUEST

Doing a split('/') is fine, assuming of course you are not overriding
the default Apache configuration of the AllowEncodedSlashes directive:
http://httpd.apache.org/docs/2.2/mod/core.html#allowencodedslashes

> 2* take stuff[1], see if isalpha(), if so see if stuff[1] is in a tuple
> (contains all the valid "sections"). if it is, we assume stuff[1] is
> safe to deal with. if not, we return a custom 404.

Watch out for empty parts.  For example if the url contains /////

The isalpha() test is fine.  If you've unicode decoded it just be
aware that isalpha() will also allow non-latin letters too.

> 3* if stuff[1] is valid, and it is in a tuple containing a list of
> special sections with a matching function, we run that function
> [eval("%s(%s)" % (section, "req"))].

This should be secure, if you are definitely checking the string
against a known acceptible list of them.

But it's bad Python form!  eval should only be used as a last
resort (unless you don't care about form/style).  It's almost
never necessary.  This is a bad habit encouraged by PHP that
you will want to unlearn quickly.

The simplest way to do this without eval is to change your
list into a dictionary.  Assuming you have something like

   allowed_sections = ['one', 'two', 'three']

change it to

   def one(req): ...
   def two(req): ...
   def three(req): ...
   section_mapping = { 'one': one,  'two': two,  'three': three }

and then rather than eval call them as

   try:
       section_mapping[section]( req )
   except KeyError:
       raise apache.SERVER_RETURN, apache.HTTP_NOT_FOUND

Another common way is to put all your functions inside a class
and use getattr and such.  You might want to get the O'Reilly
book "Python Cookbook" to learn more techniques of Python
programming.

> some of these functions take other
> arguments, like a (pre validated with similar approach) stuff[2], or
> req.args (same here). otherwise we run some other routine, by parsing
> and req.writing a template.
> [stuff[2] or req.args are this time matched against regular expressions,
> to see if they fit the arguments taken by the section functions]

It is very common to use regular expressions to parse URIs.  Many
python web frameworks do this, and no reason you shouldn't
as well.  Particularly in Python the named epxression ?P<..> syntax is
quite useful to keep your regex code readable,

   m = re.match( r'/one/(?P<size>\d+)', url)
   size = m.group('size')


> Do you guys think it's a decent approach in terms of "security"? Would
> you take any other validation steps? As I said I'm really new to python
> and mod_python, so since the website has some huge userbase, I'm really
> worried about security..

Lets just say that what you've shown us shouldn't be insecure,
but we can't say it's secure either.  There's so much that's not
even talked about.  For example the whole user authentication,
SSL, use of database queries, embedded/hardcoded passwords
(which are a definte no-no, especially if you have PythonDebug
turned on).

> We are not using (for various reasons) sql db,
> only templates and local xml basically, so sql inj. is not an issue.

Okay, but you still might want to worry about other kinds
of injection.  Such as pathname injection, javascript
injection, etc.

What if the URL contains the characters "<![CDATA["
for example.  That could really mess up some XML processors.

Just be cautious of where the data came from and how you
use it and you should be fine.


> Since the site re-design will force us to change all the URI, I have
> setup some other function to see if str(req.uri) matches moved or
> deleted pages, if so we return 410 or 301 messages. 404 give the
> impression of a messed up site. Is str(req.uri) safe enough to be passed
> as argument to the notfound() or moved() functions I've made?

Sending a 301 is a very good thing when you move URLs around.
For instance the googlebot indexer when seeing a 301 will be
more likely to trust the new URLs, carrying forward all your earned
rankings, etc.  Also 301's are used by some browsers' bookmark
systems, so that bookmarks are automatically updated.

As for 404s, don't worry about any "impression".  Use the correct
code for the correct situation.  The only case where I might deviate
from this is to send 302 rather than the recommended 307, since
many old browsers (IE) don't understand 307.

Also you may want to use the symbolic names, such as
apache.HTTP_NOT_FOUND, provided by the modpython.apache
module rather than numbers, as it makes your code more readable.

Good luck.
-- 
Deron Meranda
From fizban at paranoici.org  Fri Nov 17 12:38:17 2006
From: fizban at paranoici.org (fizban)
Date: Fri Nov 17 12:38:09 2006
Subject: [mod_python] Approach to mod_python "secure" code
In-Reply-To: <5c06fa770611170857p2e8a6e8ajc053fe3521bb60ea@mail.gmail.com>
References: <455D90A0.2000003@paranoici.org>
	<5c06fa770611170857p2e8a6e8ajc053fe3521bb60ea@mail.gmail.com>
Message-ID: <455DF389.2060309@paranoici.org>

Deron Meranda wrote:
> On 11/17/06, fizban <fizban@paranoici.org> wrote:
>> 1* take req.uri, str() it (just in case?) and split('/') it.
>> [stuff = str(req.uri).split('/')
> 
> There's no need to str() it.  It's already a string.  It will also have
> been url decoded.

Ok, I see.

[snip]
>> 3* if stuff[1] is valid, and it is in a tuple containing a list of
>> special sections with a matching function, we run that function
>> [eval("%s(%s)" % (section, "req"))].
> 
> This should be secure, if you are definitely checking the string
> against a known acceptible list of them.
> 
> But it's bad Python form!  eval should only be used as a last
> resort (unless you don't care about form/style).  It's almost
> never necessary.  This is a bad habit encouraged by PHP that
> you will want to unlearn quickly.

Heh, I was actually told to do so by someone more skilled in python than
me, let's blame him! I've never used eval myself.

I do care about form/style for this particular project -- I'm also
considering to release the code. It wouldn't probably be used by many
(it's pretty specific for this kind of site, so not much portable), but
maybe I can help convert someone else to python/mod_python, or help
similar projects dealing with their sites.

> The simplest way to do this without eval is to change your
> list into a dictionary.  Assuming you have something like
> 
>   allowed_sections = ['one', 'two', 'three']
> 
> change it to
> 
>   def one(req): ...
>   def two(req): ...
>   def three(req): ...
>   section_mapping = { 'one': one,  'two': two,  'three': three }
> 
> and then rather than eval call them as
> 
>   try:
>       section_mapping[section]( req )
>   except KeyError:
>       raise apache.SERVER_RETURN, apache.HTTP_NOT_FOUND

Ok cool, I'll do that

> Another common way is to put all your functions inside a class
> and use getattr and such.  You might want to get the O'Reilly
> book "Python Cookbook" to learn more techniques of Python
> programming.

I'm not a big fan of classes actually.. and it's not because of my PHP
"background".. But I'll sure get that book

[snip]
> Lets just say that what you've shown us shouldn't be insecure,
> but we can't say it's secure either.  There's so much that's not
> even talked about.  For example the whole user authentication,
> SSL, use of database queries, embedded/hardcoded passwords
> (which are a definte no-no, especially if you have PythonDebug
> turned on).

Yeah, PythonDebug will be off when we get in "production".. and
embedded/hardcoded passwords are bad in all the cases I can think at :)

However, I think I mis-used "userbase". The userbase is actually the
visitors plus the kiddies we attract because it's the site of a pretty
well known project. The "admin" zone has always been protected in
various ways (like, letting it being accessed by known IP and using a
login/pass, etc etc), and the protection method is likely to stay the
same. Also, I'll set it up to be dealt with another handler.
I think I'll let apache alone dealing with ip and login/password
restrictions.. Unless there's some good reason not to do so when using a
custom handler.. is there?

[snip]
> Just be cautious of where the data came from and how you
> use it and you should be fine.

> As for 404s, don't worry about any "impression".  Use the correct
> code for the correct situation.  The only case where I might deviate
> from this is to send 302 rather than the recommended 307, since
> many old browsers (IE) don't understand 307.

Oh, I didn't know IE doesn't deal with 307, good to know!

> Also you may want to use the symbolic names, such as
> apache.HTTP_NOT_FOUND, provided by the modpython.apache
> module rather than numbers, as it makes your code more readable.

Yep, I'm already doing so -- I was just being lazy so I used the numeric
error in the email :-)

> Good luck.

Thanks!

Ciao,

Andreas
From grahamd at dscpl.com.au  Sat Nov 18 01:43:08 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Sat Nov 18 01:43:19 2006
Subject: [mod_python] getting cookies from the response
In-Reply-To: <1163785561.11885.1.camel@localhost>
References: <1163754569.11489.4.camel@localhost>
	<35B7751B-09BB-43C2-B517-42864277B406@dscpl.com.au>
	<1163785561.11885.1.camel@localhost>
Message-ID: <AD6E7ABF-C97E-4DF3-8AA5-6BDDB8CD0462@dscpl.com.au>


On 18/11/2006, at 4:46 AM, Istvan De wrote:

> Hi Graham,
>
> On Fri, 2006-11-17 at 20:21 +1100, Graham Dumpleton wrote:
>> On 17/11/2006, at 8:09 PM, Istvan De wrote:
>>
>>> Hi!
>>>
>>> In my code, if I detect that a cookie is not set, I set it using
>>> Cookie.add_cookie().
>>>
>>> That is all well. However, if I read this cookie from the same  
>>> request
>>> at which it was added, it is not available. I guess this is because
>>> the
>>> "cookie add" function puts the cookie into the reponse of the page,
>>> and
>>> the "cookie get" function only looks at the request to see what
>>> cookies
>>> are set.
>>>
>>> What is the solution to my problem?
>>
>> Cookie.get_cookies() reads from req.headers_in. Cookie.add_cookie()
>> writes to req.headers_out. Thus, you can't read back what you only  
>> just
>> wrote.
>>
>> Suggest you log using apache.log_error() the values of the input and
>> output headers to see what they are set to.
>>
>> Note that Cookie.add_cookie() must be called prior to the first time
>> that
>> any actual content is written back as the response.
>
> Yes, these are all clear to me. But what do you advise as the solution
> to the problem? I need to read some cookies just created. Or maybe
> re-load the page with a meta tag after creating the cookies? But this
> would be sort of a hack.

Please keep discussion on the mailing list.

It is unclear why you would want to do it in the first place which  
possibly
suggests that whatever you are doing you are going about it all in the
wrong way. Can you explain what problem it is you are really trying to
solve.

Anyway, req.headers_in should be writable and so you could always
create the 'cookie' header and resave it. That can be a bit tricky  
though
if you are getting sent multiple cookies as you potentially have to  
merge
it back in with those other cookies.

Graham
From grahamd at dscpl.com.au  Sat Nov 18 01:52:15 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Sat Nov 18 01:52:25 2006
Subject: [mod_python] Approach to mod_python "secure" code
In-Reply-To: <455D90A0.2000003@paranoici.org>
References: <455D90A0.2000003@paranoici.org>
Message-ID: <3C8F7050-88E1-4766-8BA6-C52B29D94192@dscpl.com.au>

Given the nature of your questions and that you are new to Python,
as well as to mod_python, I would very much suggest that you not use
mod_python directly. Instead, I would recommend you go use one
of the higher level Python web frameworks such as Django and
Turbogears. So, go have a look at:

   http://www.djangoproject.com/
   http://www.turbogears.org/

Use one of these and it will solve you a lot of hard work and you will
not have to worry unnecessarily about the sort of things you are
worrying about as other people have solved it already.

Graham

On 17/11/2006, at 9:36 PM, fizban wrote:

> Hi all,
>
> I'm new to python and mod_python, I've just started moving away  
> from PHP
> so I apology if my questions will look dumb :)
> I'm finding it easy to learn python for now, there's plenty of docs
> around, and mailing lists like this one (I've been lurking for a few
> days) are pretty usefull. However there are things that I'm not  
> sure I'm
> approaching in the right way, so I'd need an hand by someone more
> experienced than me.
>
> I'm in the process of converting a website to mod_python, and after  
> some
> reading I decided to opt for the "my own handler" approach. I'll  
> have an
> "index.py" (the name isn't important) using SetHandler. So my handler
> will deal with all the requests for that directory.
>
> My approach to this is the following:
>
> 1* take req.uri, str() it (just in case?) and split('/') it.
> [stuff = str(req.uri).split('/')
> 2* take stuff[1], see if isalpha(), if so see if stuff[1] is in a  
> tuple
> (contains all the valid "sections"). if it is, we assume stuff[1] is
> safe to deal with. if not, we return a custom 404.
> 3* if stuff[1] is valid, and it is in a tuple containing a list of
> special sections with a matching function, we run that function
> [eval("%s(%s)" % (section, "req"))]. some of these functions take  
> other
> arguments, like a (pre validated with similar approach) stuff[2], or
> req.args (same here). otherwise we run some other routine, by parsing
> and req.writing a template.
> [stuff[2] or req.args are this time matched against regular  
> expressions,
> to see if they fit the arguments taken by the section functions]
>
> Do you guys think it's a decent approach in terms of "security"? Would
> you take any other validation steps? As I said I'm really new to  
> python
> and mod_python, so since the website has some huge userbase, I'm  
> really
> worried about security.. We are not using (for various reasons) sql  
> db,
> only templates and local xml basically, so sql inj. is not an issue.
>
> Since the site re-design will force us to change all the URI, I have
> setup some other function to see if str(req.uri) matches moved or
> deleted pages, if so we return 410 or 301 messages. 404 give the
> impression of a messed up site. Is str(req.uri) safe enough to be  
> passed
> as argument to the notfound() or moved() functions I've made?
>
> Thanks in advance for any hint or comment you may give me!
> I'm also looking for any "guide" or paper about writing "secure" code
> with mod_python, I haven't been able to find any on my own, for now :)
>
> Ciao,
>
> Andreas
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
From fizban at paranoici.org  Sat Nov 18 02:59:27 2006
From: fizban at paranoici.org (fizban)
Date: Sat Nov 18 02:59:18 2006
Subject: [mod_python] Approach to mod_python "secure" code
In-Reply-To: <3C8F7050-88E1-4766-8BA6-C52B29D94192@dscpl.com.au>
References: <455D90A0.2000003@paranoici.org>
	<3C8F7050-88E1-4766-8BA6-C52B29D94192@dscpl.com.au>
Message-ID: <455EBD5F.2060102@paranoici.org>

Graham Dumpleton wrote:
>   http://www.djangoproject.com/
>   http://www.turbogears.org/
> 
> Use one of these and it will solve you a lot of hard work and you will
> not have to worry unnecessarily about the sort of things you are
> worrying about as other people have solved it already.

Django sure looks pretty good and interesting; I've considered to use it
already. However I feel more comfortable with using mod_python directly
for this particular project.

Thanks,

Andreas
From seb.dailly at gmail.com  Sat Nov 18 04:51:27 2006
From: seb.dailly at gmail.com (Seb)
Date: Sat Nov 18 04:51:30 2006
Subject: [mod_python] How create a scheduler ?
Message-ID: <b4e79f7c0611180151t54217104h4ca6cc3f1659b8d3@mail.gmail.com>

Hello,

I would like to know if we can create a scheduler inside mod_python. I
seems that the threads are not "persistents" and are closed when the
page is load. Is there any particular way for keeping a running thread
? ( It is not for generating html but for periodic saves and data
updates )

Thank You
Seb
From alex.greif at gmail.com  Sat Nov 18 06:04:48 2006
From: alex.greif at gmail.com (Alex Greif)
Date: Sat Nov 18 06:04:53 2006
Subject: [mod_python] How create a scheduler ?
In-Reply-To: <b4e79f7c0611180151t54217104h4ca6cc3f1659b8d3@mail.gmail.com>
References: <b4e79f7c0611180151t54217104h4ca6cc3f1659b8d3@mail.gmail.com>
Message-ID: <778770d80611180304r1de89441s65253a9b7bba2324@mail.gmail.com>

Hi,
how about creating a cron entry that create a http request?

Alex.

On 11/18/06, Seb <seb.dailly@gmail.com> wrote:
> Hello,
>
> I would like to know if we can create a scheduler inside mod_python. I
> seems that the threads are not "persistents" and are closed when the
> page is load. Is there any particular way for keeping a running thread
> ? ( It is not for generating html but for periodic saves and data
> updates )
>
> Thank You
> Seb
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From nferrier at tapsellferrier.co.uk  Sat Nov 18 06:41:12 2006
From: nferrier at tapsellferrier.co.uk (Nic James Ferrier)
Date: Sat Nov 18 06:49:38 2006
Subject: [mod_python] How create a scheduler ?
In-Reply-To: <778770d80611180304r1de89441s65253a9b7bba2324@mail.gmail.com>
	(Alex Greif's message of "Sat\, 18 Nov 2006 12\:04\:48 +0100")
References: <b4e79f7c0611180151t54217104h4ca6cc3f1659b8d3@mail.gmail.com>
	<778770d80611180304r1de89441s65253a9b7bba2324@mail.gmail.com>
Message-ID: <87zmapj82v.fsf@tapsellferrier.co.uk>

"Alex Greif" <alex.greif@gmail.com> writes:

> Hi,
> how about creating a cron entry that create a http request?
>
> Alex.
>
> On 11/18/06, Seb <seb.dailly@gmail.com> wrote:
>> Hello,
>>
>> I would like to know if we can create a scheduler inside mod_python. I
>> seems that the threads are not "persistents" and are closed when the
>> page is load. Is there any particular way for keeping a running thread
>> ? ( It is not for generating html but for periodic saves and data
>> updates )

You could fork another process.


-- 
Nic Ferrier
http://www.tapsellferrier.co.uk   for all your tapsell ferrier needs
From grahamd at dscpl.com.au  Sat Nov 18 07:00:36 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Sat Nov 18 07:00:43 2006
Subject: [mod_python] How create a scheduler ?
In-Reply-To: <87zmapj82v.fsf@tapsellferrier.co.uk>
References: <b4e79f7c0611180151t54217104h4ca6cc3f1659b8d3@mail.gmail.com>
	<778770d80611180304r1de89441s65253a9b7bba2324@mail.gmail.com>
	<87zmapj82v.fsf@tapsellferrier.co.uk>
Message-ID: <CCD42FCB-080B-4195-B6E2-DD38EF4A2013@dscpl.com.au>


On 18/11/2006, at 10:41 PM, Nic James Ferrier wrote:

> "Alex Greif" <alex.greif@gmail.com> writes:
>
>> Hi,
>> how about creating a cron entry that create a http request?
>>
>> Alex.
>>
>> On 11/18/06, Seb <seb.dailly@gmail.com> wrote:
>>> Hello,
>>>
>>> I would like to know if we can create a scheduler inside  
>>> mod_python. I
>>> seems that the threads are not "persistents" and are closed when the
>>> page is load. Is there any particular way for keeping a running  
>>> thread
>>> ? ( It is not for generating html but for periodic saves and data
>>> updates )
>
> You could fork another process.

You can use the PythonImport directive to have a specific module  
imported
at the time that the Apache child process is created and prior to any  
actual
request having been received. From this you could create a new thread to
perform some periodic task.

As with any thread programming, you have to deal with all the  
concurrency
issues. Using mod_python you also have to deal with issues of automatic
module reloading. As such, you are best ensuring that any distinct  
thread
only operates within the context of modules which will not be  
candidates for
automatic module reloading. If you don't ensure this, things could  
screw up
quite badly. You also need to be mindful that there can be multiple  
Apache
child processes. This can be an issue if the thread is going to have  
to update
stuff on disk as well as you need to have external locking such that the
separate child processes don't interfere with each other.

For more information on the Apache/mod_python process/thread/interpreter
model read:

   http://www.dscpl.com.au/wiki/ModPython/Articles/ 
TheProcessInterpreterModel

BTW, what exactly is it that you want the thread to do?

Graham
From seb.dailly at gmail.com  Sat Nov 18 07:37:07 2006
From: seb.dailly at gmail.com (Seb)
Date: Sat Nov 18 07:37:11 2006
Subject: [mod_python] How create a scheduler ?
In-Reply-To: <CCD42FCB-080B-4195-B6E2-DD38EF4A2013@dscpl.com.au>
References: <b4e79f7c0611180151t54217104h4ca6cc3f1659b8d3@mail.gmail.com>
	<778770d80611180304r1de89441s65253a9b7bba2324@mail.gmail.com>
	<87zmapj82v.fsf@tapsellferrier.co.uk>
	<CCD42FCB-080B-4195-B6E2-DD38EF4A2013@dscpl.com.au>
Message-ID: <b4e79f7c0611180437r4309c903s89e2f66dda9909c7@mail.gmail.com>

> >> how about creating a cron entry that create a http request?

I would like to implant the scheduler inside the python site. I don't
know where my project can be hosted, and if I'll have the access to
crontab..

> >
> > You could fork another process.
>
> You can use the PythonImport directive to have a specific module
> imported
> at the time that the Apache child process is created and prior to any
> actual
> request having been received. From this you could create a new thread to
> perform some periodic task.
>
>
> BTW, what exactly is it that you want the thread to do?

Thanks for the information, I think I'll look on this way.
My goal is to create a persistent game with html acces. I need to
update the world periodicly, and not to wait that a user upload a page
for checking and launch all the tasks. Each tasks will be counted as a
thread, wich can be update for the game, mail on the intern mail
service, saves and more...
Before coding anything, I would like to be sure that what I want to do
is realizable..
From mod_python at turias.net  Sat Nov 18 10:20:02 2006
From: mod_python at turias.net (Sebastian Celis)
Date: Sat Nov 18 10:20:08 2006
Subject: [mod_python] getting cookies from the response
In-Reply-To: <AD6E7ABF-C97E-4DF3-8AA5-6BDDB8CD0462@dscpl.com.au>
References: <1163754569.11489.4.camel@localhost>
	<35B7751B-09BB-43C2-B517-42864277B406@dscpl.com.au>
	<1163785561.11885.1.camel@localhost>
	<AD6E7ABF-C97E-4DF3-8AA5-6BDDB8CD0462@dscpl.com.au>
Message-ID: <93f7db120611180720j4ad83446qcb6d97fbdc91cba9@mail.gmail.com>

Why not create a wrapper to Cookie.add_cookie() that, in addition to
writing the cookie, also saves it to a dictionary you create at
req.cookies_written?  That way, unless you are interfacing with other
cookie-writing code, you can always check which cookies you have
already placed in the outgoing headers.

- Sebastian


On 11/18/06, Graham Dumpleton <grahamd@dscpl.com.au> wrote:
>
> On 18/11/2006, at 4:46 AM, Istvan De wrote:
>
> > Hi Graham,
> >
> > On Fri, 2006-11-17 at 20:21 +1100, Graham Dumpleton wrote:
> >> On 17/11/2006, at 8:09 PM, Istvan De wrote:
> >>
> >>> Hi!
> >>>
> >>> In my code, if I detect that a cookie is not set, I set it using
> >>> Cookie.add_cookie().
> >>>
> >>> That is all well. However, if I read this cookie from the same
> >>> request
> >>> at which it was added, it is not available. I guess this is because
> >>> the
> >>> "cookie add" function puts the cookie into the reponse of the page,
> >>> and
> >>> the "cookie get" function only looks at the request to see what
> >>> cookies
> >>> are set.
> >>>
> >>> What is the solution to my problem?
> >>
> >> Cookie.get_cookies() reads from req.headers_in. Cookie.add_cookie()
> >> writes to req.headers_out. Thus, you can't read back what you only
> >> just
> >> wrote.
> >>
> >> Suggest you log using apache.log_error() the values of the input and
> >> output headers to see what they are set to.
> >>
> >> Note that Cookie.add_cookie() must be called prior to the first time
> >> that
> >> any actual content is written back as the response.
> >
> > Yes, these are all clear to me. But what do you advise as the solution
> > to the problem? I need to read some cookies just created. Or maybe
> > re-load the page with a meta tag after creating the cookies? But this
> > would be sort of a hack.
>
> Please keep discussion on the mailing list.
>
> It is unclear why you would want to do it in the first place which
> possibly
> suggests that whatever you are doing you are going about it all in the
> wrong way. Can you explain what problem it is you are really trying to
> solve.
>
> Anyway, req.headers_in should be writable and so you could always
> create the 'cookie' header and resave it. That can be a bit tricky
> though
> if you are getting sent multiple cookies as you potentially have to
> merge
> it back in with those other cookies.
>
> Graham
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From fumanchu at amor.org  Sat Nov 18 12:45:24 2006
From: fumanchu at amor.org (Robert Brewer)
Date: Sat Nov 18 12:40:24 2006
Subject: [mod_python] How create a scheduler ?
References: <b4e79f7c0611180151t54217104h4ca6cc3f1659b8d3@mail.gmail.com><778770d80611180304r1de89441s65253a9b7bba2324@mail.gmail.com><87zmapj82v.fsf@tapsellferrier.co.uk><CCD42FCB-080B-4195-B6E2-DD38EF4A2013@dscpl.com.au>
	<b4e79f7c0611180437r4309c903s89e2f66dda9909c7@mail.gmail.com>
Message-ID: <435DF58A933BA74397B42CDEB8145A86224CA9@ex9.hostedexchange.local>

Seb wrote:
> Graham Dumpleton wrote:
> > You can use the PythonImport directive to have a specific
> > module imported at the time that the Apache child process
> > is created and prior to any actual request having been
> > received. From this you could create a new thread to
> > perform some periodic task.
> 
> My goal is to create a persistent game with html access.
> I need to update the world periodicly, and not to wait
> that a user upload a page for checking and launch all
> the tasks. Each tasks will be counted as a thread, wich
> can be update for the game, mail on the intern mail
> service, saves and more...

It is. You might want to look at my http://projects.amor.org/misc/wiki/Recur which now includes a Worker class and a Scheduler class. There's also http://trac.turbogears.org/turbogears/browser/trunk/turbogears/scheduler.py, which is a webified version of Irmen de Jong's older Kronos module.


Robert Brewer
System Architect
Amor Ministries
fumanchu@amor.org
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20061118/3e437b8a/attachment.html
From grahamd at dscpl.com.au  Sat Nov 18 16:07:51 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Sat Nov 18 16:08:11 2006
Subject: [mod_python] How create a scheduler ?
In-Reply-To: <b4e79f7c0611180437r4309c903s89e2f66dda9909c7@mail.gmail.com>
References: <b4e79f7c0611180151t54217104h4ca6cc3f1659b8d3@mail.gmail.com>
	<778770d80611180304r1de89441s65253a9b7bba2324@mail.gmail.com>
	<87zmapj82v.fsf@tapsellferrier.co.uk>
	<CCD42FCB-080B-4195-B6E2-DD38EF4A2013@dscpl.com.au>
	<b4e79f7c0611180437r4309c903s89e2f66dda9909c7@mail.gmail.com>
Message-ID: <55DECF76-096B-4772-8B0F-4336A2E2B2B0@dscpl.com.au>


On 18/11/2006, at 11:37 PM, Seb wrote:

>> >> how about creating a cron entry that create a http request?
>
> I would like to implant the scheduler inside the python site. I don't
> know where my project can be hosted, and if I'll have the access to
> crontab..
>
>> >
>> > You could fork another process.
>>
>> You can use the PythonImport directive to have a specific module
>> imported
>> at the time that the Apache child process is created and prior to any
>> actual
>> request having been received. From this you could create a new  
>> thread to
>> perform some periodic task.
>>
>>
>> BTW, what exactly is it that you want the thread to do?
>
> Thanks for the information, I think I'll look on this way.
> My goal is to create a persistent game with html acces. I need to
> update the world periodicly, and not to wait that a user upload a page
> for checking and launch all the tasks. Each tasks will be counted as a
> thread, wich can be update for the game, mail on the intern mail
> service, saves and more...
> Before coding anything, I would like to be sure that what I want to do
> is realizable..

You are going to be much better off using a separate persistent process
which sits behind Apache for this, using something like XML-RPC to
communicate between the HTTP request handlers running in Apache
and the backend process. This will be easier as then you do not have
to deal with issue of how you are going to maintain your game state so
all Apache child processes can access it and update it as it will all be
done from one process rather than many. The problem of dealing with
the fact that Apache child processes can be shutdown or die at any time
is also less as the real work is being done in the backend server and it
will always be running.

Graham
From seb.dailly at gmail.com  Sun Nov 19 08:30:38 2006
From: seb.dailly at gmail.com (Seb)
Date: Sun Nov 19 08:30:42 2006
Subject: [mod_python] How create a scheduler ?
In-Reply-To: <435DF58A933BA74397B42CDEB8145A86224CA9@ex9.hostedexchange.local>
References: <b4e79f7c0611180151t54217104h4ca6cc3f1659b8d3@mail.gmail.com>
	<778770d80611180304r1de89441s65253a9b7bba2324@mail.gmail.com>
	<87zmapj82v.fsf@tapsellferrier.co.uk>
	<CCD42FCB-080B-4195-B6E2-DD38EF4A2013@dscpl.com.au>
	<b4e79f7c0611180437r4309c903s89e2f66dda9909c7@mail.gmail.com>
	<435DF58A933BA74397B42CDEB8145A86224CA9@ex9.hostedexchange.local>
Message-ID: <b4e79f7c0611190530h29c25f95occ53d179ab8f7171@mail.gmail.com>

>
>  It is. You might want to look at my
> http://projects.amor.org/misc/wiki/Recur which now includes
> a Worker class and a Scheduler class. There's also
> http://trac.turbogears.org/turbogears/browser/trunk/turbogears/scheduler.py,
> which is a webified version of Irmen de Jong's older Kronos module.

Ok, I ll take a look at the python frameworks. It seems to be a
solution for my problems, and does not have the apache limitations for
my specific problem, I think that a true python server will be able to
answer my waitings.

I thank you all for your answers :)

-- 
Seb
From grahamd at dscpl.com.au  Sun Nov 19 17:06:45 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Sun Nov 19 17:06:59 2006
Subject: [mod_python] How create a scheduler ?
Message-ID: <1163974004.8279@dscpl.user.openhosting.com>

Seb wrote ..
> >
> >  It is. You might want to look at my
> > http://projects.amor.org/misc/wiki/Recur which now includes
> > a Worker class and a Scheduler class. There's also
> > http://trac.turbogears.org/turbogears/browser/trunk/turbogears/scheduler.py,
> > which is a webified version of Irmen de Jong's older Kronos module.
> 
> Ok, I ll take a look at the python frameworks. It seems to be a
> solution for my problems, and does not have the apache limitations for
> my specific problem, I think that a true python server will be able to
> answer my waitings.

How complicated a system are you looking to develop?

I ask as I can suggest another system, although it is probably more
suited to use in much larger systems which need to span multiple hosts
and need to plug in both C++ code as well as Python. As an example,
this system has been used for a specialised printing application
spanning 800 processes across 150 sites. It is also being deployed
in an EFTPOS transaction system spanning the same 150 sites.
Although these are big applications, it is still quite able for standalone
simple systems as well and is used by various people in that way.

As far as a scheduler is concerned, it does have one, but it is a very
minor component when looked at against all the other features the
system provides. Even though you might only use a small bit of what
is provided initially, there is certainly a great deal of room for you to
expand what you application does.

In terms of interworking with Apache, the framework provides XML-RPC
interfaces into its messaging system. Alternatively, it is possible to hook
the message system framework direct into Apache child processes. This
allows you to run active services within Apache which could constantly
monitor and accumulate data from the backend processes allowing you
to cache stuff in Apache and avoid having to request through to the
backend in all cases. As the full facilities of the framework are available
even when running in Apache, you even have access to the scheduler.

Anyway, enough advertising, if it doesn't sound like too much overkill,
have a look at documentation at:

  http://www.dscpl.com.au/wiki/OSE/Python

Graham
From luismg at gmx.net  Sun Nov 19 21:42:16 2006
From: luismg at gmx.net (=?iso-8859-1?Q?Luis_M._Gonz=E1lez?=)
Date: Sun Nov 19 21:42:19 2006
Subject: [mod_python] Why this code fails?
Message-ID: <000f01c70c4d$806ab380$6e00a8c0@averatecdda041>

Hello all,

I have this script, which works fine when tested with the interpreter,
but fails when used with mod_python:

# index.py

import sys, os
sys.path.append(os.getcwd() + '/templates')
sys.path.append(os.getcwd() + '/models')
from models import *

result = Customers.select()

def index(req):
    req.content_type = 'text/html'
    for i in result:
        req.write(i.Company + '<br>')


Explanation:
I have a main directory and two subdirectories: templates and models.
Inside the models folder I have a module called "models.py", where I
imported an ORM and defined the db connection and models (included
"Customers").

Although it works perfectly as a standalone app, it doesn't work with
mod_python.
The error message I get is:

             NameError: name 'Clientes' is not defined

I guess it has to do with the way mod_python handles the import of
modules, or perhaps with the way I modify the sys.path... but I can't
figure out the solution.

Any hint would be highly appreciated...
Thanks!
Luis
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20061119/1e69f628/attachment.html
From grahamd at dscpl.com.au  Sun Nov 19 22:20:51 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Sun Nov 19 22:20:57 2006
Subject: [mod_python] Why this code fails?
Message-ID: <1163992851.6811@dscpl.user.openhosting.com>

=?iso-8859-1?Q?Luis_M._Gonz=E1lez?= wrote ..
> Hello all,
> 
> I have this script, which works fine when tested with the interpreter,
> but fails when used with mod_python:
> 
> # index.py
> 
> import sys, os
> sys.path.append(os.getcwd() + '/templates')
> sys.path.append(os.getcwd() + '/models')

You shouldn't modify sys.path from inside a handler code file as it can
cause lots of problems. Also, os.getcwd() is going to usually return '/'
and not the directory the file resides in. It is also not a good idea to be
placing modules required by your handlers within the document tree
like this because if you do not protect them properly from access in
the Apache configuration, users may be able to trigger code or access
data within the modules directly.

The better thing to do is to move those module directories somewhere
outside of the document tree and then use the PythonPath directive to
extend the value of sys.path with the directory you place the two module
directories in. 

Also note there are various problems with the module importer in
current versions of mod_python. See:

  http://www.dscpl.com.au/wiki/ModPython/Articles/ModuleImportingIsBroken

This could be resulting in you picking up a wrong version of a module
if the same module name is used in multiple places, or an old module
version cached in memory and not changes you may have made on disk
since it was loaded. You may as a result have to restart Apache if not
getting latest module changes. You may also need to use PythonInterpreter
to make sure distinct applications operate in their own interpreters to
avoid problems with similar module names being used.

Graham

> from models import *
> 
> result = Customers.select()
> 
> def index(req):
>     req.content_type = 'text/html'
>     for i in result:
>         req.write(i.Company + '<br>')
> 
> 
> Explanation:
> I have a main directory and two subdirectories: templates and models.
> Inside the models folder I have a module called "models.py", where I
> imported an ORM and defined the db connection and models (included
> "Customers").
> 
> Although it works perfectly as a standalone app, it doesn't work with
> mod_python.
> The error message I get is:
> 
>              NameError: name 'Clientes' is not defined
> 
> I guess it has to do with the way mod_python handles the import of
> modules, or perhaps with the way I modify the sys.path... but I can't
> figure out the solution.
> 
> Any hint would be highly appreciated...
> Thanks!
> Luis
From durumdara at gmail.com  Mon Nov 20 09:31:25 2006
From: durumdara at gmail.com (durumdara)
Date: Mon Nov 20 09:31:39 2006
Subject: [mod_python] Accesshandler and normal handler... how they working
	?
In-Reply-To: <4559E47C.9030604@jgassociates.ca>
References: <4559B2A6.9060409@gmail.com> <4559E47C.9030604@jgassociates.ca>
Message-ID: <4561BC3D.4010902@gmail.com>

Hi !

Interesting. Your example about Request Data Sharing sometimes working, 
and sometimes not.
I don't understand why !
In my little test site it is working good.
But when I put these sharing technics in the main site, then Apache said 
that Object member does not exists on mp_request.

Traceback (most recent call last):

  File "C:\Python24\lib\site-packages\mod_python\apache.py", line 299, in HandlerDispatch
    result = object(req)

  File "c:/web/zeusweb/htdocs\__handler.py", line 6, in handler
    RequestObject = req.Object

AttributeError: 'mp_request' object has no attribute 'Object'

It is very interesting, because I set this variable on the access handler.

def accesshandler(Request):
    hmod = apache.import_module("CustomHandler")
    siteroot = os.path.dirname(__file__)
    return hmod.CommonAccessHandler(Request, "ZeusWebHandler", siteroot)
...

def CommonAccessHandler(Request, HandlerModuleName, SiteRoot):
    zhmod = apache.import_module(HandlerModuleName)
    try:
        ROClass = zhmod.GetRequestObjectClass()
        RequestObject = ROClass(Request, SiteRoot)
        Request.Object = RequestObject # <===== here I set it !
        RequestObject.CheckLogin()
        valid = RequestObject.HaveUserRightTo(Request.filename)
        if valid:
            return apache.OK
        else:
            return apache.HTTP_FORBIDDEN
    except:
        dwtools = apache.import_module("dwtools")
        excmsg = dwtools.GetLastExcText()
        Request.log_error(excmsg, apache.APLOG_ERR)
    return apache.HTTP_INTERNAL_SERVER_ERROR

Interesting, because it's working recently ! In same site !
Possible it's caused by virtual hosting and more site handlers ??? I 
don't know.

But I need solution.

Please help me !

I thinking about that I not used direct filenames on protectable content 
(anydata.pdf).
If I use "aliases", I can check them in the handler, and I can rewrite 
them as stream, if use have enough rights to it.
In this time I can use accesshandler to deny accesses without rights. If 
rights are enough, I simply send apache.OK, and apache get back the 
content, handle the file types (PDF, XLS, etc.).

But if accesshandler cannot share data with handler safely, I need to 
drop accesshandler, and I need to handle all request with my handler.
This is not too hard with simple content, but problematic with big, 
protected, special files, example _*private*_ PDF-s, Pictures, other 
contents.
(I remember that in zope I must rename the dynamic image retreiver 
script to ".jpg" to Windows client handle the data correctly what the 
script provided.)

How to you do this ? How can I protect some areas ? How to I support the 
file downloading with protection ?

Thanks for your help:
    dd





Jim Gallacher wrote:
> durumdara wrote:
>> Hi !
>>
>> I have an access handler, and a normal python handler in my site.
>> I use directories, and some of them are need protection. I use my login
>> method to enable user access.
>>
>> The access handler is check the needed rights to any object. It get user
>> data from Session.
>> When access granted, it finished it's working.
>> When access denied, it send http403 error, and I catch this with custom
>> error documents (ssi).
>>
>> But I want to know something - the background of access handler.
>>
>> 1.)
>> The access handler is existing in same Thread as Handler ?
>
> Yes.
>
>> So I want to know. Is modpy do this:
>> get url, server info, etc.
>> build request + other objects
>> get thread
>> result = thread.startaccesshandler(req)
>> if not result:
>>  gotoerrorhandler
>> else:
>>  result = thread.handler(req)
>> ....
>> or it use another technology ?
>
> Unless I'm misunderstanding your question, you don't need to mess with 
> threads. You are always dealing with the same request object, 
> regardless of which phase, and there is one process or thread per 
> request.
>
> Take a look at the mod_python documentation for PythonAuthenHandler, 
> as well as my reply to Richard Lewis today on a similar question.
>
>> 2.)
>> Can I exchange some data across them ?
>
> Yes.
>
> def authenhandler(req):
>     req.foo = 'something for later'
>     ...
>
>
> def handler(req):
>     req.write(req.foo)
>     ...
>
>
>> In this time I use file based right table(s).
>> Every file in this table has right property.
>> I need to load this table in the accesshandler to check grants.
>> And later, in the menu building I also need to load this table to check
>> grants (the menus are not accessable by user are hided).
>> Can I share these infos ? Can I write to the request object, and this
>> object is hold these infos to get them in normal handler ?
>
> Yes.
>
>> 3.)
>> Can I force the access handler to redirect request ?
>
> Yes.
>
>> Example: the user click on menu that preserved for special users. I
>> don't want to redirect to error pages. Can I redirect to my special
>> page, 
>
> Yes.
>
> Jim
>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20061120/dc82ff61/attachment.html
From durumdara at gmail.com  Mon Nov 20 09:56:04 2006
From: durumdara at gmail.com (durumdara)
Date: Mon Nov 20 09:56:13 2006
Subject: [mod_python] Accesshandler and normal handler... how they working
	?
In-Reply-To: <4559E47C.9030604@jgassociates.ca>
References: <4559B2A6.9060409@gmail.com> <4559E47C.9030604@jgassociates.ca>
Message-ID: <4561C204.50504@gmail.com>

Hi !

Aha !!!
As I see that when NO FILENAME PRESENTED the accesshandler not started 
and sharing across request object not working.
http://localhost
This time the handler is started only, the accesshandler not.

    Mod_python error: "PythonHandler __zeuswebhandler"

    Traceback (most recent call last):

      File "C:\Python24\lib\site-packages\mod_python\apache.py", line 299, in HandlerDispatch
        result = object(req)

      File "c:/web/zeusweb/htdocs\__zeuswebhandler.py", line 6, in handler
        RequestObject = req.Object

    AttributeError: 'mp_request' object has no attribute 'Object'

dd


Jim Gallacher wrote:
> durumdara wrote:
>> Hi !
>>
>> I have an access handler, and a normal python handler in my site.
>> I use directories, and some of them are need protection. I use my login
>> method to enable user access.
>>
>> The access handler is check the needed rights to any object. It get user
>> data from Session.
>> When access granted, it finished it's working.
>> When access denied, it send http403 error, and I catch this with custom
>> error documents (ssi).
>>
>> But I want to know something - the background of access handler.
>>
>> 1.)
>> The access handler is existing in same Thread as Handler ?
>
> Yes.
>
>> So I want to know. Is modpy do this:
>> get url, server info, etc.
>> build request + other objects
>> get thread
>> result = thread.startaccesshandler(req)
>> if not result:
>>  gotoerrorhandler
>> else:
>>  result = thread.handler(req)
>> ....
>> or it use another technology ?
>
> Unless I'm misunderstanding your question, you don't need to mess with 
> threads. You are always dealing with the same request object, 
> regardless of which phase, and there is one process or thread per 
> request.
>
> Take a look at the mod_python documentation for PythonAuthenHandler, 
> as well as my reply to Richard Lewis today on a similar question.
>
>> 2.)
>> Can I exchange some data across them ?
>
> Yes.
>
> def authenhandler(req):
>     req.foo = 'something for later'
>     ...
>
>
> def handler(req):
>     req.write(req.foo)
>     ...
>
>
>> In this time I use file based right table(s).
>> Every file in this table has right property.
>> I need to load this table in the accesshandler to check grants.
>> And later, in the menu building I also need to load this table to check
>> grants (the menus are not accessable by user are hided).
>> Can I share these infos ? Can I write to the request object, and this
>> object is hold these infos to get them in normal handler ?
>
> Yes.
>
>> 3.)
>> Can I force the access handler to redirect request ?
>
> Yes.
>
>> Example: the user click on menu that preserved for special users. I
>> don't want to redirect to error pages. Can I redirect to my special
>> page, 
>
> Yes.
>
> Jim
>

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20061120/abab0827/attachment-0001.html
From grahamd at dscpl.com.au  Mon Nov 20 15:41:29 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Mon Nov 20 15:42:53 2006
Subject: [mod_python] Accesshandler and normal handler... how they working
	?
In-Reply-To: <4561C204.50504@gmail.com>
References: <4559B2A6.9060409@gmail.com> <4559E47C.9030604@jgassociates.ca>
	<4561C204.50504@gmail.com>
Message-ID: <4D778259-EE59-4A12-9FF9-93F2FEF238C4@dscpl.com.au>

Short answer:

   http://issues.apache.org/jira/browse/MODPYTHON-146

I'll read your email properly later and respond further if need be.

On 21/11/2006, at 1:56 AM, durumdara wrote:

> Hi !
>
> Aha !!!
> As I see that when NO FILENAME PRESENTED the accesshandler not  
> started and sharing across request object not working.
> http://localhost
> This time the handler is started only, the accesshandler not.
>
> Mod_python error: "PythonHandler __zeuswebhandler" Traceback (most  
> recent call last): File "C:\Python24\lib\site-packages\mod_python 
> \apache.py", line 299, in HandlerDispatch result = object(req) File  
> "c:/web/zeusweb/htdocs\__zeuswebhandler.py", line 6, in handler  
> RequestObject = req.Object AttributeError: 'mp_request' object has  
> no attribute 'Object' dd
>
>
> Jim Gallacher wrote:
>> durumdara wrote:
>>> Hi !
>>>
>>> I have an access handler, and a normal python handler in my site.
>>> I use directories, and some of them are need protection. I use my  
>>> login
>>> method to enable user access.
>>>
>>> The access handler is check the needed rights to any object. It  
>>> get user
>>> data from Session.
>>> When access granted, it finished it's working.
>>> When access denied, it send http403 error, and I catch this with  
>>> custom
>>> error documents (ssi).
>>>
>>> But I want to know something - the background of access handler.
>>>
>>> 1.)
>>> The access handler is existing in same Thread as Handler ?
>>
>> Yes.
>>
>>> So I want to know. Is modpy do this:
>>> get url, server info, etc.
>>> build request + other objects
>>> get thread
>>> result = thread.startaccesshandler(req)
>>> if not result:
>>>  gotoerrorhandler
>>> else:
>>>  result = thread.handler(req)
>>> ....
>>> or it use another technology ?
>>
>> Unless I'm misunderstanding your question, you don't need to mess  
>> with threads. You are always dealing with the same request object,  
>> regardless of which phase, and there is one process or thread per  
>> request.
>>
>> Take a look at the mod_python documentation for  
>> PythonAuthenHandler, as well as my reply to Richard Lewis today on  
>> a similar question.
>>
>>> 2.)
>>> Can I exchange some data across them ?
>>
>> Yes.
>>
>> def authenhandler(req):
>>     req.foo = 'something for later'
>>     ...
>>
>>
>> def handler(req):
>>     req.write(req.foo)
>>     ...
>>
>>
>>> In this time I use file based right table(s).
>>> Every file in this table has right property.
>>> I need to load this table in the accesshandler to check grants.
>>> And later, in the menu building I also need to load this table to  
>>> check
>>> grants (the menus are not accessable by user are hided).
>>> Can I share these infos ? Can I write to the request object, and  
>>> this
>>> object is hold these infos to get them in normal handler ?
>>
>> Yes.
>>
>>> 3.)
>>> Can I force the access handler to redirect request ?
>>
>> Yes.
>>
>>> Example: the user click on menu that preserved for special users. I
>>> don't want to redirect to error pages. Can I redirect to my special
>>> page,
>>
>> Yes.
>>
>> Jim
>>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
From slingareddy at Crossroads.com  Mon Nov 20 15:56:48 2006
From: slingareddy at Crossroads.com (Surendra Lingareddy)
Date: Mon Nov 20 15:57:06 2006
Subject: [mod_python] Newbie ?s regarding sessions
Message-ID: <43F5E8AE07F17C47BC16F7A159E9E700D93B86@mailnode1.commstor.crossroads.com>

I am attempting to create a login page and want to get to a point where
I can do the following. A) Login a user and redirect to website's
index.html, on failure redirect to loginFailed.html. B) Maintain user
session for 3 minutes and then force the user to re-login  C) Once
logged in, if the user is in-active for more than 3 minutes, then force
the login page back again when the user takes some action.

 

Do I have to use authenHandler for this or can I just use publishHandler
combined with sessions and cookies. All suggestions are welcome.

 

Thanks,
Suren

CONFIDENTIAL: This email, including its contents and attachments, if any, are confidential. If the reader of this e-mail is not an intended recipient, you have received this e-mail in error and any review, dissemination, distribution or copying is strictly prohibited. If you have received this e-mail in error, please notify the sender immediately by return e-mail at [emailaddress@crossroads.com] and permanently delete the copy you received. Copyright and other intellectual property rights in its contents are the sole property of Crossroads Systems, Inc. Email transmission cannot be guaranteed to be secure or error-free. The sender therefore does not accept liability for any errors or omissions in the contents of the message which arise as a result of email  transmission.  Although we routinely screen for viruses, addressees should check this email and any attachments for viruses. We make no representation or warranty as to the absence of viruses in this email or any attachments.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20061120/16c470f7/attachment.html
From grahamd at dscpl.com.au  Mon Nov 20 17:21:05 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Mon Nov 20 17:21:11 2006
Subject: [mod_python] Why this code fails?
Message-ID: <1164061265.31192@dscpl.user.openhosting.com>

=?iso-8859-1?Q?Luis_M._Gonz=E1lez?= wrote ..
> Thank you Graham!
> I will follow your suggestions to se how it goes...
> 
> By the way, it's worth mentioning that, for the sake of simplicity, I also
> tried placing my "models.py" module within the same directory of my 
> "index.py" script, in order to use a simple import statement (without 
> messing with sys.path and os) but the problem persists.
> 
> However, if I import my ORM into index.py and then I define my models there,
> it works.
> This is strange: why can I import the ORM script but not the models script?
> Is this because of the problem with the module importer you talked about?

It may not find the 'models.py' file in the same directory as the 'index.py'
file for a number of reasons.

First is that PythonPath is specified for that context meaning that mod_python
isn't adding the handler root directory where index.py is into sys.path
automatically.

Second is that 'index.py' wasn't in the handler root directory but a subdirectory.

Third is that there is a 'models' module elsewhere and the order of sys.path
is such that it finds this other one instead of that in the same directory.

For the record, all three of these problems are fixed in mod_python 3.3
and will work as one would expect it to work for file based modules like
'models.py'.

Graham

> --- Original Message ----- 
> From: "Graham Dumpleton" <grahamd@dscpl.com.au>
> To: "Luis M. Gonz?lez" <luismg@gmx.net>
> Cc: <mod_python@modpython.org>
> Sent: Monday, November 20, 2006 12:20 AM
> Subject: Re: [mod_python] Why this code fails?
> 
> 
> > =?iso-8859-1?Q?Luis_M._Gonz=E1lez?= wrote ..
> >> Hello all,
> >>
> >> I have this script, which works fine when tested with the interpreter,
> >> but fails when used with mod_python:
> >>
> >> # index.py
> >>
> >> import sys, os
> >> sys.path.append(os.getcwd() + '/templates')
> >> sys.path.append(os.getcwd() + '/models')
> >
> > You shouldn't modify sys.path from inside a handler code file as it can
> > cause lots of problems. Also, os.getcwd() is going to usually return
> '/'
> > and not the directory the file resides in. It is also not a good idea
> to 
> > be
> > placing modules required by your handlers within the document tree
> > like this because if you do not protect them properly from access in
> > the Apache configuration, users may be able to trigger code or access
> > data within the modules directly.
> >
> > The better thing to do is to move those module directories somewhere
> > outside of the document tree and then use the PythonPath directive to
> > extend the value of sys.path with the directory you place the two module
> > directories in.
> >
> > Also note there are various problems with the module importer in
> > current versions of mod_python. See:
> >
> >  http://www.dscpl.com.au/wiki/ModPython/Articles/ModuleImportingIsBroken
> >
> > This could be resulting in you picking up a wrong version of a module
> > if the same module name is used in multiple places, or an old module
> > version cached in memory and not changes you may have made on disk
> > since it was loaded. You may as a result have to restart Apache if not
> > getting latest module changes. You may also need to use PythonInterpreter
> > to make sure distinct applications operate in their own interpreters
> to
> > avoid problems with similar module names being used.
> >
> > Graham
> >
> >> from models import *
> >>
> >> result = Customers.select()
> >>
> >> def index(req):
> >>     req.content_type = 'text/html'
> >>     for i in result:
> >>         req.write(i.Company + '<br>')
> >>
> >>
> >> Explanation:
> >> I have a main directory and two subdirectories: templates and models.
> >> Inside the models folder I have a module called "models.py", where I
> >> imported an ORM and defined the db connection and models (included
> >> "Customers").
> >>
> >> Although it works perfectly as a standalone app, it doesn't work with
> >> mod_python.
> >> The error message I get is:
> >>
> >>              NameError: name 'Clientes' is not defined
> >>
> >> I guess it has to do with the way mod_python handles the import of
> >> modules, or perhaps with the way I modify the sys.path... but I can't
> >> figure out the solution.
> >>
> >> Any hint would be highly appreciated...
> >> Thanks!
> >> Luis
> > 
From jpg at jgassociates.ca  Mon Nov 20 17:57:15 2006
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Mon Nov 20 17:56:45 2006
Subject: [mod_python] Accesshandler and normal handler... how they working
	?
In-Reply-To: <4561BC3D.4010902@gmail.com>
References: <4559B2A6.9060409@gmail.com> <4559E47C.9030604@jgassociates.ca>
	<4561BC3D.4010902@gmail.com>
Message-ID: <456232CB.805@jgassociates.ca>

durumdara wrote:
> Hi !
> 
> Interesting. Your example about Request Data Sharing sometimes working, 
> and sometimes not.
> I don't understand why !
> In my little test site it is working good.
> But when I put these sharing technics in the main site, then Apache said 
> that Object member does not exists on mp_request.

There may be a problem with your apache configuration for your main 
site. If your access handler is not getting called it is likely an issue 
with the configuration. Are you using the same directives on the test 
and main site?

Jim

From slingareddy at Crossroads.com  Mon Nov 20 19:01:51 2006
From: slingareddy at Crossroads.com (Surendra Lingareddy)
Date: Tue Nov 21 12:56:03 2006
Subject: [mod_python] Newbie ?s regarding sessions
Message-ID: <43F5E8AE07F17C47BC16F7A159E9E700D79FD2@mailnode1.commstor.crossroads.com>

I found a few answers by experimentation. AuthenHandler results in a
login pop-up and that's not what I want. I am trying to use a form to
login. I tried session object and have been able to distinguish whether
it is the same session or not on a reload. How can I have this session
object be available to multiple browser pages? Should I pass it around?

 

Thanks,

Suren

 

  _____  

From: mod_python-bounces@modpython.org
[mailto:mod_python-bounces@modpython.org] On Behalf Of Surendra
Lingareddy
Sent: Monday, November 20, 2006 2:57 PM
To: mod_python@modpython.org
Subject: [mod_python] Newbie ?s regarding sessions

 

I am attempting to create a login page and want to get to a point where
I can do the following. A) Login a user and redirect to website's
index.html, on failure redirect to loginFailed.html. B) Maintain user
session for 3 minutes and then force the user to re-login  C) Once
logged in, if the user is in-active for more than 3 minutes, then force
the login page back again when the user takes some action.

 

Do I have to use authenHandler for this or can I just use publishHandler
combined with sessions and cookies. All suggestions are welcome.

 

Thanks,
Suren

CONFIDENTIAL: This email, including its contents and attachments, if
any, are confidential. If the reader of this e-mail is not an intended
recipient, you have received this e-mail in error and any review,
dissemination, distribution or copying is strictly prohibited. If you
have received this e-mail in error, please notify the sender immediately
by return e-mail at [emailaddress@crossroads.com] and permanently delete
the copy you received. Copyright and other intellectual property rights
in its contents are the sole property of Crossroads Systems, Inc. Email
transmission cannot be guaranteed to be secure or error-free. The sender
therefore does not accept liability for any errors or omissions in the
contents of the message which arise as a result of email transmission.
Although we routinely screen for viruses, addressees should check this
email and any attachments for viruses. We make no representation or
warranty as to the absence of viruses in this email or any attachments. 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20061120/eb75d95f/attachment.html
From jpg at jgassociates.ca  Tue Nov 21 17:28:25 2006
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Tue Nov 21 17:28:17 2006
Subject: [mod_python] Newbie ?s regarding sessions
In-Reply-To: <43F5E8AE07F17C47BC16F7A159E9E700D79FD2@mailnode1.commstor.crossroads.com>
References: <43F5E8AE07F17C47BC16F7A159E9E700D79FD2@mailnode1.commstor.crossroads.com>
Message-ID: <45637D89.8070604@jgassociates.ca>

Surendra Lingareddy wrote:
> I found a few answers by experimentation.

Always the best way to learn! Push the buttons until something breaks. :)

> AuthenHandler results in a
> login pop-up and that's not what I want. 

You need to modify your apache configuration slightly. The popup is 
triggered by AuthType "Basic". Instead try something like this:

PythonDebug On
AuthType MyCookieAuth
AuthName "Private"
PythonAuthenHandler foobar
require valid-user

"MyCookieAuth" in the above configuration is arbitrary and can be just 
about anything you want. You can retrieve its value in your handler if 
you want with req.auth_type().


> I am trying to use a form to
> login. I tried session object and have been able to distinguish whether
> it is the same session or not on a reload. How can I have this session
> object be available to multiple browser pages? Should I pass it around?

Yes. The usual practice is to pass it around as an attribute of the 
request object.

req.session = Session.Session(req)

Note the use of req.session here. Using "session" as the attribute name 
will allow you to transparently use the session object with the psp 
handler. You might not plan on using psp, but it does make it easy if 
you change your mind in the future. It's not a requirement, just a 
recommended practice. The same thing goes for your request form.

req.form = FieldStorage(req)

Have fun.

Jim
From grahamd at dscpl.com.au  Tue Nov 21 17:44:04 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Tue Nov 21 17:44:09 2006
Subject: [mod_python] Newbie ?s regarding sessions
Message-ID: <1164149044.2037@dscpl.user.openhosting.com>

Jim Gallacher wrote ..
> Surendra Lingareddy wrote:
> > AuthenHandler results in a
> > login pop-up and that's not what I want. 
> 
> You need to modify your apache configuration slightly. The popup is 
> triggered by AuthType "Basic". Instead try something like this:
> 
> PythonDebug On
> AuthType MyCookieAuth
> AuthName "Private"
> PythonAuthenHandler foobar
> require valid-user
> 
> "MyCookieAuth" in the above configuration is arbitrary and can be just
> about anything you want. You can retrieve its value in your handler if
> you want with req.auth_type().

The req.auth_type() method is only available from mod_python 3.3
onwards. You don't actually need to query its value if you ensure
your authenhandler is only being called for your application area
and no other authenhandlers are registered.

> > I am trying to use a form to
> > login. I tried session object and have been able to distinguish whether
> > it is the same session or not on a reload. How can I have this session
> > object be available to multiple browser pages? Should I pass it around?
> 
> Yes. The usual practice is to pass it around as an attribute of the 
> request object.
> 
> req.session = Session.Session(req)
> 
> Note the use of req.session here. Using "session" as the attribute name
> will allow you to transparently use the session object with the psp 
> handler. You might not plan on using psp, but it does make it easy if 
> you change your mind in the future. It's not a requirement, just a 
> recommended practice.

For PSP to see req.session you will need mod_python 3.2.8 or later.

> The same thing goes for your request form.
> 
> req.form = FieldStorage(req)

For PSP to see req.form you will need mod_python 3.3.

Won't it be nice when mod_python 3.3 is everywhere. :-)

Graham
From sliderw at hotmail.com  Tue Nov 21 21:09:15 2006
From: sliderw at hotmail.com (sliderw hotmail)
Date: Tue Nov 21 21:09:23 2006
Subject: [mod_python] meets_conditions does not seem to work
Message-ID: <BAY103-F13A3244CF4CDB2927A32FFBDE30@phx.gbl>

I followed the documentation of meets_conditions and wrote the following 
handler, but it doesn't work. 200 OK is always returned, never 304 Not 
Modified.

def handler(req):
    req.headers_out['ETag'] = '"12345"'
    req.headers_out['Last-Modified'] = 'Wed, 22 Nov 2006 01:00:00 GMT'
    req.headers_out['Expires'] = 'Fri, 13 Feb 2009 01:00:00 GMT'

    status = req.meets_conditions()
    if status != apache.OK:
        return status

    req.set_content_length(5)
    req.write('hello')

    return apache.OK

Versions used: Apache 2.2.2, mod_python 3.2.8

Any idea?

_________________________________________________________________
Get free, personalized commercial-free online radio with MSN Radio powered 
by Pandora http://radio.msn.com/?icid=T002MSN03A07001

From grahamd at dscpl.com.au  Tue Nov 21 22:27:11 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Tue Nov 21 22:27:15 2006
Subject: [mod_python] meets_conditions does not seem to work
Message-ID: <1164166030.2222@dscpl.user.openhosting.com>

sliderw hotmail wrote ..
> I followed the documentation of meets_conditions and wrote the following
> handler, but it doesn't work. 200 OK is always returned, never 304 Not
> Modified.
> 
> def handler(req):
>     req.headers_out['ETag'] = '"12345"'
>     req.headers_out['Last-Modified'] = 'Wed, 22 Nov 2006 01:00:00 GMT'
>     req.headers_out['Expires'] = 'Fri, 13 Feb 2009 01:00:00 GMT'
> 
>     status = req.meets_conditions()
>     if status != apache.OK:
>         return status
> 
>     req.set_content_length(5)
>     req.write('hello')
> 
>     return apache.OK
> 
> Versions used: Apache 2.2.2, mod_python 3.2.8
> 
> Any idea?

What headers is your client sending which denote the condition that has to be
satisfied. Ie., what headers are in req.headers_in such as:

  If-Match
  If-Unmodified-Since
  If-None-Match
  Range
  If-Modified-Since

If your client isn't sending any conditions, how can there be anything to
check.

Another issues is perhaps that 'Last-Modified' header isn't even consulted
anyway. Instead it looks at req.mtime attribute for when resource was last
modified. Getting this set to a sensible value in mod_python, because output is
generated dynamically, isn't that simple. In the version of mod_python you are
using it probably isn't even possible as there is no way to update req.mtime.

In mod_python 3.3, req.mtime is still read only, but req.set_last_modified() is
provided which allows req.mtime to be set from the mtime in req.finfo with
req.finfo being able to be updated by setting it to result of calling the
apache.stat() method with a file name. Problem is that in mod_python the mtime
may need to reflect changes across multiple files which comprise the source
code used to fulfil a request. Thus, in some respects, req.mtime should possibly
be directly modifiable to be of most use, but it isn't right now.

Anyway, having said all that, what are you expecting to happen and how
do you expect to be able to use req.meets_condition()?

Graham
From grahamd at dscpl.com.au  Tue Nov 21 22:35:13 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Tue Nov 21 22:35:15 2006
Subject: [mod_python] meets_conditions does not seem to work
Message-ID: <1164166513.5688@dscpl.user.openhosting.com>

Graham Dumpleton wrote ..
> sliderw hotmail wrote ..
> > I followed the documentation of meets_conditions and wrote the following
> > handler, but it doesn't work. 200 OK is always returned, never 304 Not
> > Modified.
> > 
> > def handler(req):
> >     req.headers_out['ETag'] = '"12345"'
> >     req.headers_out['Last-Modified'] = 'Wed, 22 Nov 2006 01:00:00 GMT'
> >     req.headers_out['Expires'] = 'Fri, 13 Feb 2009 01:00:00 GMT'
> > 
> >     status = req.meets_conditions()
> >     if status != apache.OK:
> >         return status
> > 
> >     req.set_content_length(5)
> >     req.write('hello')
> > 
> >     return apache.OK
> > 
> > Versions used: Apache 2.2.2, mod_python 3.2.8
> > 
> > Any idea?
> 
> What headers is your client sending which denote the condition that has
> to be
> satisfied. Ie., what headers are in req.headers_in such as:
> 
>   If-Match
>   If-Unmodified-Since
>   If-None-Match
>   Range
>   If-Modified-Since
> 
> If your client isn't sending any conditions, how can there be anything
> to
> check.
> 
> Another issues is perhaps that 'Last-Modified' header isn't even consulted
> anyway. Instead it looks at req.mtime attribute for when resource was last
> modified. Getting this set to a sensible value in mod_python, because output
> is
> generated dynamically, isn't that simple. In the version of mod_python
> you are
> using it probably isn't even possible as there is no way to update req.mtime.
> 
> In mod_python 3.3, req.mtime is still read only, but req.set_last_modified()
> is
> provided which allows req.mtime to be set from the mtime in req.finfo with
> req.finfo being able to be updated by setting it to result of calling the
> apache.stat() method with a file name. Problem is that in mod_python the
> mtime
> may need to reflect changes across multiple files which comprise the source
> code used to fulfil a request. Thus, in some respects, req.mtime should
> possibly
> be directly modifiable to be of most use, but it isn't right now.
> 
> Anyway, having said all that, what are you expecting to happen and how
> do you expect to be able to use req.meets_condition()?

Whoops. Forgot that in mod_python 3.3 there is req.update_mtime(), so
req.mtime can be updated, you just don't do it directly but through a
function.

Graham
From sliderw at hotmail.com  Tue Nov 21 22:53:28 2006
From: sliderw at hotmail.com (sliderw hotmail)
Date: Tue Nov 21 22:53:34 2006
Subject: [mod_python] meets_conditions does not seem to work
In-Reply-To: <1164166513.5688@dscpl.user.openhosting.com>
Message-ID: <BAY103-F14028A3AF83ED0D27EEB3CBDE30@phx.gbl>

>Graham Dumpleton wrote ..
> >
> > What headers is your client sending which denote the condition that has
> > to be
> > satisfied. Ie., what headers are in req.headers_in such as:
> >
> >   If-Match
> >   If-Unmodified-Since
> >   If-None-Match
> >   Range
> >   If-Modified-Since
> >
> > If your client isn't sending any conditions, how can there be anything
> > to
> > check.
> >
> > Another issues is perhaps that 'Last-Modified' header isn't even 
>consulted
> > anyway. Instead it looks at req.mtime attribute for when resource was 
>last
> > modified. Getting this set to a sensible value in mod_python, because 
>output
> > is
> > generated dynamically, isn't that simple. In the version of mod_python
> > you are
> > using it probably isn't even possible as there is no way to update 
>req.mtime.
> >
> > In mod_python 3.3, req.mtime is still read only, but 
>req.set_last_modified()
> > is
> > provided which allows req.mtime to be set from the mtime in req.finfo 
>with
> > req.finfo being able to be updated by setting it to result of calling 
>the
> > apache.stat() method with a file name. Problem is that in mod_python the
> > mtime
> > may need to reflect changes across multiple files which comprise the 
>source
> > code used to fulfil a request. Thus, in some respects, req.mtime should
> > possibly
> > be directly modifiable to be of most use, but it isn't right now.
> >
> > Anyway, having said all that, what are you expecting to happen and how
> > do you expect to be able to use req.meets_condition()?
>
>Whoops. Forgot that in mod_python 3.3 there is req.update_mtime(), so
>req.mtime can be updated, you just don't do it directly but through a
>function.
>
>Graham

304 Not Modified should be expected because my client sends:

If-Modified-Since: Wed, 22 Nov 2006 01:00:00 GMT
If-None-Match: "12345"

I also suspect that mtime is the issue. The value of req.mtime is 0.0 just 
before the meets_conditions call. Although I'm not familiar with the 
internals of mod_python and Apache, I looked at Apache's 
ap_meets_conditions, which uses current time as mtime if req.mtime is 0.

So meets_conditions is unusable until 3.3? Hmm....

BTW, when will 3.3 come out?

_________________________________________________________________
All-in-one security and maintenance for your PC. Get a free 90-day trial! 
http://clk.atdmt.com/MSN/go/msnnkwlo0050000002msn/direct/01/?href=http://clk.atdmt.com/MSN/go/msnnkwlo0050000001msn/direct/01/?href=http://www.windowsonecare.com/?sc_cid=msn_hotmail

From grahamd at dscpl.com.au  Wed Nov 22 01:37:41 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Wed Nov 22 01:37:46 2006
Subject: [mod_python] meets_conditions does not seem to work
Message-ID: <1164177461.25087@dscpl.user.openhosting.com>

sliderw hotmail wrote ..
> >Graham Dumpleton wrote ..
> > >
> > > What headers is your client sending which denote the condition that
> has
> > > to be
> > > satisfied. Ie., what headers are in req.headers_in such as:
> > >
> > >   If-Match
> > >   If-Unmodified-Since
> > >   If-None-Match
> > >   Range
> > >   If-Modified-Since
> > >
> > > If your client isn't sending any conditions, how can there be anything
> > > to
> > > check.
> > >
> > > Another issues is perhaps that 'Last-Modified' header isn't even 
> >consulted
> > > anyway. Instead it looks at req.mtime attribute for when resource was
> >last
> > > modified. Getting this set to a sensible value in mod_python, because
> >output
> > > is
> > > generated dynamically, isn't that simple. In the version of mod_python
> > > you are
> > > using it probably isn't even possible as there is no way to update
> >req.mtime.
> > >
> > > In mod_python 3.3, req.mtime is still read only, but 
> >req.set_last_modified()
> > > is
> > > provided which allows req.mtime to be set from the mtime in req.finfo
> >with
> > > req.finfo being able to be updated by setting it to result of calling
> >the
> > > apache.stat() method with a file name. Problem is that in mod_python
> the
> > > mtime
> > > may need to reflect changes across multiple files which comprise the
> >source
> > > code used to fulfil a request. Thus, in some respects, req.mtime should
> > > possibly
> > > be directly modifiable to be of most use, but it isn't right now.
> > >
> > > Anyway, having said all that, what are you expecting to happen and
> how
> > > do you expect to be able to use req.meets_condition()?
> >
> >Whoops. Forgot that in mod_python 3.3 there is req.update_mtime(), so
> >req.mtime can be updated, you just don't do it directly but through a
> >function.
> >
> >Graham
> 
> 304 Not Modified should be expected because my client sends:
> 
> If-Modified-Since: Wed, 22 Nov 2006 01:00:00 GMT
> If-None-Match: "12345"
> 
> I also suspect that mtime is the issue. The value of req.mtime is 0.0 just
> before the meets_conditions call. Although I'm not familiar with the 
> internals of mod_python and Apache, I looked at Apache's 
> ap_meets_conditions, which uses current time as mtime if req.mtime is 0.
> 
> So meets_conditions is unusable until 3.3? Hmm....

That is probably a reasonable assumption if the condition is based on a mtime
that you want to manipulate.

> BTW, when will 3.3 come out?

Hopefully a Christmas present for all. You can always check out current code
from subversion, or see:

  http://mail-archives.apache.org/mod_mbox/httpd-python-dev/200611.mbox/%3c45533499.5090600@jgassociates.ca%3e

Any delays at this point are my fault as lagging on some documentation and
also not happy with a couple of issues I thought had been resolved. Been hard to
find good blocks of time to work on it as having to take over extra projects in
my real job because of people leaving.

Graham
From ruben at ozonomultimedia.com  Wed Nov 22 07:10:08 2006
From: ruben at ozonomultimedia.com (=?ISO-8859-1?Q?Rub=E9n_da_Silva?=)
Date: Wed Nov 22 07:10:55 2006
Subject: [mod_python] Session timeout
Message-ID: <45643E20.7050504@ozonomultimedia.com>

I'm debugging an error:

     * id: 80b5b4b9af0a2e710195bab30cc3c358
     * is_new: False
     * created: 1164195872.07
     * last_accessed: 1164196137.86
     * timeout: 3600

i'm developing an application who uses Session for store user data after 
users logins correctly,

I use in every request after login:
ses = Session.Session(req, timeout = out)
This Session object is what i show you at mail head.

Session stores correctly all data and detects is_new ok, BUT, session 
expires in (created + timeout) time, NOT in (last_accessed + timeout) 
time. Last_accessed as you can see, changes correctly, but after timeout 
(3600s. - 1 Hr.) using the application, session is deleted an users must 
login again.

How can i correct this?

Regards.
Rub?n

P.D. Using Debian Sarge Mod_python version: 3.1.3-3
From jpg at jgassociates.ca  Wed Nov 22 08:52:54 2006
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Wed Nov 22 08:52:52 2006
Subject: [mod_python] Session timeout
In-Reply-To: <45643E20.7050504@ozonomultimedia.com>
References: <45643E20.7050504@ozonomultimedia.com>
Message-ID: <45645636.4070904@jgassociates.ca>

Rub?n da Silva wrote:
> I'm debugging an error:
> 
>     * id: 80b5b4b9af0a2e710195bab30cc3c358
>     * is_new: False
>     * created: 1164195872.07
>     * last_accessed: 1164196137.86
>     * timeout: 3600
> 
> i'm developing an application who uses Session for store user data after 
> users logins correctly,
> 
> I use in every request after login:
> ses = Session.Session(req, timeout = out)
> This Session object is what i show you at mail head.
> 
> Session stores correctly all data and detects is_new ok, BUT, session 
> expires in (created + timeout) time, NOT in (last_accessed + timeout) 
> time. Last_accessed as you can see, changes correctly, but after timeout 
> (3600s. - 1 Hr.) using the application, session is deleted an users must 
> login again.
> 
> How can i correct this?

It is necessary to save the session object after each request so that 
last_accessed gets updated. Are you doing so?

Jim
From jlabath at gmail.com  Wed Nov 22 12:36:33 2006
From: jlabath at gmail.com (Jakub Labath)
Date: Wed Nov 22 12:36:37 2006
Subject: [mod_python] Session problem
Message-ID: <252daa430611220936h75fe709vb6531071931b14b3@mail.gmail.com>

Hi,

I'm experiencing serious problems with my mod_python app.
User A gets an unique cookie from my app.
User B gets an unique cookie from my app.
They surf for a bit suddenly the same unique cookie is sent to both
the user A and user B.
In turn user A becomes user B or vice versa.
It seems as if the same cookie was served by mistake to two different clients.

See the attached log.

The other thing I noticed in the log is that the mod_python request
was actually the same. Is that OK would two diferent request have the
same memory address?

The mod_python app is django.
I've talked to one of the core django developers and he has never
heard of such a thing nor did anybody else.
My set-up is very similar to theirs nor am i doing anything special
that would explain such behaviour.

My set-up is

Python 2.4.3
Apache 2.0.58 (mpm_prefork)
Mod Python 3.1.4
Linux camembert 2.6.18-gentoo-r2camembert #1 SMP Sun Nov 19 11:05:54
EST 2006 i686 Intel(R) Xeon(TM) CPU 2.80GHzGenuineIntel GNU/Linux

Any help is much appreciated.

-- 
Jakub Labath
-------------- next part --------------
09:34:11 Process 20804 Request 0x417963cc Response 0x40d21a2c IP: 192.168.31.161 Session 64867a758e708588bacf224a2017707d modpython request is 0x41764ee8
09:47:13 Process 30323 Request 0x40d2522c Response 0x40d23aec IP: 192.168.31.161 Session 64867a758e708588bacf224a2017707d modpython request is 0x40878a18
09:47:33 Process 30343 Request 0x40bbabac Response 0x40d62dcc IP: 192.168.31.161 Session 64867a758e708588bacf224a2017707d modpython request is 0x40878a18
11:57:41 Process 30324 Request 0x40cf1cac Response 0x40d82d4c IP: 192.168.31.139 Session 64867a758e708588bacf224a2017707d modpython request is 0x40878a18
11:59:11 Process 30327 Request 0x40d299cc Response 0x40d4f6ac IP: 192.168.31.161 Session 64867a758e708588bacf224a2017707d modpython request is 0x40878a18
12:00:58 Process 30325 Request 0x40d440ec Response 0x40d3e26c IP: 192.168.31.139 Session 64867a758e708588bacf224a2017707d modpython request is 0x40878a18
From sliderw at hotmail.com  Wed Nov 22 15:38:52 2006
From: sliderw at hotmail.com (sliderw hotmail)
Date: Wed Nov 22 15:39:00 2006
Subject: [mod_python] meets_conditions does not seem to work
In-Reply-To: <1164177461.25087@dscpl.user.openhosting.com>
Message-ID: <BAY103-F22B4FB90304295773372C8BDE30@phx.gbl>

> > > > Anyway, having said all that, what are you expecting to happen and
> > how
> > > > do you expect to be able to use req.meets_condition()?

With update_mtime in 3.3, meets_conditions can be used like this:

    req.headers_out['ETag'] = '"12345"'
    req.headers_out['Expires'] = 'Fri, 13 Feb 2009 01:00:00 GMT'
    mtime = 1000000000
    req.update_mtime(mtime)
    req.headers_out['Last-Modified'] = rfc822.formatdate(mtime)

    status = req.meets_conditions()
    if status != apache.OK:
        return status

But I would prefer this (though not a strong preference):

    req.headers_out['ETag'] = '"12345"'
    req.headers_out['Expires'] = 'Fri, 13 Feb 2009 01:00:00 GMT'
    mtime = 1000000000
    req.set_last_modified(mtime)

    status = req.meets_conditions()
    if status != apache.OK:
        return status

where set_last_modified takes care of setting both mtime and Last-Modified 
header. This is also how mod_perl does it.

// from mod_perl source
static MP_INLINE void
mpxs_Apache2__RequestRec_set_last_modified(request_rec *r, apr_time_t mtime)
{
    if (mtime) {
        ap_update_mtime(r, mtime);
    }
    ap_set_last_modified(r);
}

Either way, the documentation of meets_conditions needs to be fixed in 3.3.

Thanks for your help.

_________________________________________________________________
Get FREE company branded e-mail accounts and business Web site from 
Microsoft Office Live 
http://clk.atdmt.com/MRT/go/mcrssaub0050001411mrt/direct/01/

From grahamd at dscpl.com.au  Wed Nov 22 15:57:21 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Wed Nov 22 15:57:25 2006
Subject: [mod_python] meets_conditions does not seem to work
Message-ID: <1164229041.26495@dscpl.user.openhosting.com>

sliderw hotmail wrote ..
> > > > > Anyway, having said all that, what are you expecting to happen
> and
> > > how
> > > > > do you expect to be able to use req.meets_condition()?
> 
> With update_mtime in 3.3, meets_conditions can be used like this:
> 
>     req.headers_out['ETag'] = '"12345"'
>     req.headers_out['Expires'] = 'Fri, 13 Feb 2009 01:00:00 GMT'
>     mtime = 1000000000
>     req.update_mtime(mtime)
>     req.headers_out['Last-Modified'] = rfc822.formatdate(mtime)
> 
>     status = req.meets_conditions()
>     if status != apache.OK:
>         return status
> 
> But I would prefer this (though not a strong preference):
> 
>     req.headers_out['ETag'] = '"12345"'
>     req.headers_out['Expires'] = 'Fri, 13 Feb 2009 01:00:00 GMT'
>     mtime = 1000000000
>     req.set_last_modified(mtime)
>
>     status = req.meets_conditions()
>     if status != apache.OK:
>         return status
> 
> where set_last_modified takes care of setting both mtime and Last-Modified
> header. This is also how mod_perl does it.
> 
> // from mod_perl source
> static MP_INLINE void
> mpxs_Apache2__RequestRec_set_last_modified(request_rec *r, apr_time_t mtime)
> {
>     if (mtime) {
>         ap_update_mtime(r, mtime);
>     }
>     ap_set_last_modified(r);
> }

You can do:

  req.update_mtime(mtime)
  req.set_last_modified()

This will achieve the same effect. Unless there is a good reason, where we
do expose underlying Apache functions, we tend to have them behave in the
same way, rather than adding additional functionality. That way people can
to a degree refer to Apache documentation and expect that it will work
the same way.

If you feel strongly about it, best thing to do is to log an 'improvement'
suggestion against issue tracking system so it can be considered in the
future at some point. Address is:

  http://issues.apache.org/jira/browse/MODPYTHON
 
> Either way, the documentation of meets_conditions needs to be fixed in
> 3.3.

If you want to provide a better example that is more complete and works, just
post it here and I will update the documentation. I haven't really fiddled with
this sort of stuff and so would only be assuming any example I put together
worked. If you have any suggestions for text changes to explain it better, by
all means send them along as well.

Graham
From grahamd at dscpl.com.au  Wed Nov 22 16:02:15 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Wed Nov 22 16:02:18 2006
Subject: [mod_python] Session problem
Message-ID: <1164229335.28640@dscpl.user.openhosting.com>

Jakub Labath wrote ..
> Hi,
> 
> I'm experiencing serious problems with my mod_python app.
> User A gets an unique cookie from my app.
> User B gets an unique cookie from my app.
> They surf for a bit suddenly the same unique cookie is sent to both
> the user A and user B.
> In turn user A becomes user B or vice versa.
> It seems as if the same cookie was served by mistake to two different clients.
> 
> See the attached log.
> 
> The other thing I noticed in the log is that the mod_python request
> was actually the same. Is that OK would two diferent request have the
> same memory address?
> 
> The mod_python app is django.
> I've talked to one of the core django developers and he has never
> heard of such a thing nor did anybody else.
> My set-up is very similar to theirs nor am i doing anything special
> that would explain such behaviour.
> 
> My set-up is
> 
> Python 2.4.3
> Apache 2.0.58 (mpm_prefork)
> Mod Python 3.1.4
> Linux camembert 2.6.18-gentoo-r2camembert #1 SMP Sun Nov 19 11:05:54
> EST 2006 i686 Intel(R) Xeon(TM) CPU 2.80GHzGenuineIntel GNU/Linux
> 
> Any help is much appreciated.

When you say cookies, are these cookies being constructed using Django's
infrastructure for creating them? Further, is the request object a mod_python
request object or a Django request object wrapper?

At this point it sounds like it may be a Django issue if you are using it as
it merely uses mod_python as a jumping off point and doesn't tightly
integrate with mod_python and use its cookies or sessions and provides
users with their own request object wrapper as far as I know.

That said, as a start I would strongly recommend that you upgrade to
mod_python 3.2.10 and see if your problems go away.

Graham
From grahamd at dscpl.com.au  Wed Nov 22 16:55:37 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Wed Nov 22 16:55:39 2006
Subject: [mod_python] Session problem
Message-ID: <1164232537.20709@dscpl.user.openhosting.com>

Bouncing this back to the mailing list where it belongs so everyone can
follow along.

Jakub Labath wrote ..

Hi,

> When you say cookies, are these cookies being constructed using Django's
> infrastructure for creating them?

Correct it's the sessionid cookie created by Django.

> Further, is the request object a mod_python
> request object or a Django request object wrapper?

In the previously attached log the request is Django request.
And the modpython request is the actual modpython request.

What I found weird is that the same mod_python request serviced two
different clients at different times, but perhaps that makes sense for
preforked apache.

>
> At this point it sounds like it may be a Django issue if you are using it as
> it merely uses mod_python as a jumping off point and doesn't tightly
> integrate with mod_python and use its cookies or sessions and provides
> users with their own request object wrapper as far as I know.

That was my first thought as well, and I reviewed our and django
session handling the best I could. I found nothing unusual. In fact we
have not touched the way django handles the sessions and cookies at
all. I tried the django users group nobody seems to have similar
problems, I even talked to one of the django's main devs he has no
clue either.

>
> That said, as a start I would strongly recommend that you upgrade to
> mod_python 3.2.10 and see if your problems go away.

I'll try that but I already tried upgrading from debian to gentoo and
from python2.3 to python2.4 and I had the same problem on both. I know
that would mean that it is something in our code ... but I haven't
changed anything ... oh the headache.

Thanks for help

-- 
Jakub Labath
From jpg at jgassociates.ca  Wed Nov 22 17:33:49 2006
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Wed Nov 22 17:33:41 2006
Subject: [mod_python] Session problem
In-Reply-To: <1164232537.20709@dscpl.user.openhosting.com>
References: <1164232537.20709@dscpl.user.openhosting.com>
Message-ID: <4564D04D.1010709@jgassociates.ca>

Graham Dumpleton wrote:
> Bouncing this back to the mailing list where it belongs so everyone can
> follow along.
> 
> Jakub Labath wrote ..
> 
> Hi,
> 
>> When you say cookies, are these cookies being constructed using Django's
>> infrastructure for creating them?
> 
> Correct it's the sessionid cookie created by Django.
> 
>> Further, is the request object a mod_python
>> request object or a Django request object wrapper?
> 
> In the previously attached log the request is Django request.
> And the modpython request is the actual modpython request.
> 
> What I found weird is that the same mod_python request serviced two
> different clients at different times, but perhaps that makes sense for
> preforked apache.

Just to clarify your terminology, it is the same mod_python *instance* 
servicing 2 different client requests. And no, it is not weird, but 
rather the whole point of mod_python. Well maybe not the *whole* point, 
but a very important one. :) In the simplest case you get one python 
interpreter per apache child process, thus avoiding the overhead of 
creating a new interpreter for each request.

>> At this point it sounds like it may be a Django issue if you are using it as
>> it merely uses mod_python as a jumping off point and doesn't tightly
>> integrate with mod_python and use its cookies or sessions and provides
>> users with their own request object wrapper as far as I know.
> 
> That was my first thought as well, and I reviewed our and django
> session handling the best I could. I found nothing unusual. In fact we
> have not touched the way django handles the sessions and cookies at
> all. I tried the django users group nobody seems to have similar
> problems, I even talked to one of the django's main devs he has no
> clue either.
> 
>> That said, as a start I would strongly recommend that you upgrade to
>> mod_python 3.2.10 and see if your problems go away.
> 
> I'll try that but I already tried upgrading from debian to gentoo and
> from python2.3 to python2.4 and I had the same problem on both. I know
> that would mean that it is something in our code ... but I haven't
> changed anything ... oh the headache.

Indeed.

A little light just went off in my head. Is it always *exactly* the same 
session id being served up for *all* requests?

There was a similar thread awhile ago where somebody was getting messed 
up md5sums and bad session id's with Django. IIRC it was some sort of 
library conflict between md5.so and libmhash.so. Take a look in the mail 
archives and see if you can find some help there:

http://www.modpython.org/pipermail/mod_python/2006-June/021482.html
http://www.modpython.org/pipermail/mod_python/2006-July/021544.html

Jim

From jlabath at gmail.com  Wed Nov 22 19:00:27 2006
From: jlabath at gmail.com (Jakub Labath)
Date: Wed Nov 22 19:00:30 2006
Subject: [mod_python] Session problem
In-Reply-To: <4564D04D.1010709@jgassociates.ca>
References: <1164232537.20709@dscpl.user.openhosting.com>
	<4564D04D.1010709@jgassociates.ca>
Message-ID: <252daa430611221600n5f7ff2daie19fb8069763be2c@mail.gmail.com>

On 11/22/06, Jim Gallacher <jpg@jgassociates.ca> wrote:
> Graham Dumpleton wrote:
> > Bouncing this back to the mailing list where it belongs so everyone can
> > follow along.
> >
> > Jakub Labath wrote ..
> >
> > Hi,
> >
> >> When you say cookies, are these cookies being constructed using Django's
> >> infrastructure for creating them?
> >
> > Correct it's the sessionid cookie created by Django.
> >
> >> Further, is the request object a mod_python
> >> request object or a Django request object wrapper?
> >
> > In the previously attached log the request is Django request.
> > And the modpython request is the actual modpython request.
> >
> > What I found weird is that the same mod_python request serviced two
> > different clients at different times, but perhaps that makes sense for
> > preforked apache.
>
> Just to clarify your terminology, it is the same mod_python *instance*
> servicing 2 different client requests. And no, it is not weird, but
> rather the whole point of mod_python. Well maybe not the *whole* point,
> but a very important one. :) In the simplest case you get one python
> interpreter per apache child process, thus avoiding the overhead of
> creating a new interpreter for each request.

It was the same child process (that much makes sense too me too), but
it also had the same address for modpython request object. Which I
thought is little weird since if request comes from address A it
should not be the same as if it comes from address B.
But the python id is just a memory address so it is possible that it
was just reusing the same memory space.

> >> At this point it sounds like it may be a Django issue if you are using it as
> >> it merely uses mod_python as a jumping off point and doesn't tightly
> >> integrate with mod_python and use its cookies or sessions and provides
> >> users with their own request object wrapper as far as I know.
> >
> > That was my first thought as well, and I reviewed our and django
> > session handling the best I could. I found nothing unusual. In fact we
> > have not touched the way django handles the sessions and cookies at
> > all. I tried the django users group nobody seems to have similar
> > problems, I even talked to one of the django's main devs he has no
> > clue either.
> >
> >> That said, as a start I would strongly recommend that you upgrade to
> >> mod_python 3.2.10 and see if your problems go away.
> >
> > I'll try that but I already tried upgrading from debian to gentoo and
> > from python2.3 to python2.4 and I had the same problem on both. I know
> > that would mean that it is something in our code ... but I haven't
> > changed anything ... oh the headache.
>
> Indeed.
>
> A little light just went off in my head. Is it always *exactly* the same
> session id being served up for *all* requests?

No 99% of the time all work works normally.
User A comes along gets his own cookie user B comes along gets her own
cookie ... and then in one moment user A gets the cookie that belongs
to user B. While B user still gets her own cookie. Then user A notices
that suddenly his username changed from Joe to Suzy and starts sending
rather angry emails, which I cannot really blame him for.
The problem seems to appear more often if the site is under heavier load.

> There was a similar thread awhile ago where somebody was getting messed
> up md5sums and bad session id's with Django. IIRC it was some sort of
> library conflict between md5.so and libmhash.so. Take a look in the mail
> archives and see if you can find some help there:

I looked at it I don't have libmash and my keys look like this
03d7f9b948174de277941ecf67feb7ee
which seems normal to me.
I went over the django code and I see that they make sure to
1. randomize the cookie key
2. check if such key exists in db before they send it to user in a cookie.

> http://www.modpython.org/pipermail/mod_python/2006-June/021482.html
> http://www.modpython.org/pipermail/mod_python/2006-July/021544.html
>
> Jim
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>


-- 
Jakub Labath
From grahamd at dscpl.com.au  Wed Nov 22 19:23:10 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Wed Nov 22 19:23:13 2006
Subject: [mod_python] Session problem
Message-ID: <1164241389.21167@dscpl.user.openhosting.com>

Jakub Labath wrote ..
> > > What I found weird is that the same mod_python request serviced two
> > > different clients at different times, but perhaps that makes sense
> for
> > > preforked apache.
> >
> > Just to clarify your terminology, it is the same mod_python *instance*
> > servicing 2 different client requests. And no, it is not weird, but
> > rather the whole point of mod_python. Well maybe not the *whole* point,
> > but a very important one. :) In the simplest case you get one python
> > interpreter per apache child process, thus avoiding the overhead of
> > creating a new interpreter for each request.
> 
> It was the same child process (that much makes sense too me too), but
> it also had the same address for modpython request object. Which I
> thought is little weird since if request comes from address A it
> should not be the same as if it comes from address B.
> But the python id is just a memory address so it is possible that it
> was just reusing the same memory space.

You could always print out:

  req.connection.id
  req.connection.remote_addr

It is possible that the connection ID might get reused, but if the remote
address is the same for both requests, then you would really worry.

> > A little light just went off in my head. Is it always *exactly* the same
> > session id being served up for *all* requests?
> 
> No 99% of the time all work works normally.
> User A comes along gets his own cookie user B comes along gets her own
> cookie ... and then in one moment user A gets the cookie that belongs
> to user B. While B user still gets her own cookie. Then user A notices
> that suddenly his username changed from Joe to Suzy and starts sending
> rather angry emails, which I cannot really blame him for.
> The problem seems to appear more often if the site is under heavier load.

Do both clients make requests to the server via any sort of proxy or otherwise
which could be caching pages? In your pages do you do anything to try and
manipulate how pages might be cached?

Graham
From sliderw at hotmail.com  Wed Nov 22 19:27:29 2006
From: sliderw at hotmail.com (sliderw hotmail)
Date: Wed Nov 22 19:27:34 2006
Subject: [mod_python] meets_conditions does not seem to work
In-Reply-To: <1164177461.25087@dscpl.user.openhosting.com>
Message-ID: <BAY103-F17B2A8B057ECE5FD937DB1BDE20@phx.gbl>

>You can do:
>
>   req.update_mtime(mtime)
>   req.set_last_modified()
>
>This will achieve the same effect. Unless there is a good reason, where we
>do expose underlying Apache functions, we tend to have them behave in the
>same way, rather than adding additional functionality. That way people can
>to a degree refer to Apache documentation and expect that it will work
>the same way.
>
>If you feel strongly about it, best thing to do is to log an 'improvement'
>suggestion against issue tracking system so it can be considered in the
>future at some point. Address is:
>
>   http://issues.apache.org/jira/browse/MODPYTHON
>  > Either way, the documentation of meets_conditions needs to be fixed in
> > 3.3.
>
>If you want to provide a better example that is more complete and works, 
>just
>post it here and I will update the documentation. I haven't really fiddled 
>with
>this sort of stuff and so would only be assuming any example I put together
>worked. If you have any suggestions for text changes to explain it better, 
>by
>all means send them along as well.
>
>Graham

The set_last_modified suggestion is a good one. The meets_conditions 
documentation may be changed to:

Calls the Apache ap_meets_conditions() function which returns a status code. 
If status is apache.OK, generate the content of the response normally. If 
not, simply return status. Note that mtime (and possibly ETag) should be set 
prior to calling this function. The same goes for req.status if the status 
differs from apache.OK.

Example:

...
r.headers_out['Expires'] = 'Mon, 18 Apr 2005 17:30:00 GMT'
r.headers_out['ETag'] = '"1130794f-3774-4584-a4ea-0ab19e684268"'
r.update_mtime(1000000000)
r.set_last_modified()

status = r.meets_conditions()
if status != apache.OK:
  return status

... do expensive generation of the response content ...

_________________________________________________________________
All-in-one security and maintenance for your PC. Get a free 90-day trial! 
http://clk.atdmt.com/MSN/go/msnnkwlo0050000002msn/direct/01/?href=http://clk.atdmt.com/MSN/go/msnnkwlo0050000001msn/direct/01/?href=http://www.windowsonecare.com/?sc_cid=msn_hotmail

From jlabath at gmail.com  Wed Nov 22 19:44:24 2006
From: jlabath at gmail.com (Jakub Labath)
Date: Wed Nov 22 19:50:44 2006
Subject: Fwd: [mod_python] Session problem
In-Reply-To: <252daa430611221643n656c1c49xe952e006dbb5ce1d@mail.gmail.com>
References: <1164241389.21167@dscpl.user.openhosting.com>
	<252daa430611221643n656c1c49xe952e006dbb5ce1d@mail.gmail.com>
Message-ID: <252daa430611221644u5648619nad095fc7de2edab5@mail.gmail.com>

I keep sending it to the person rather than list, sorry.

---------- Forwarded message ----------
From: Jakub Labath <jlabath@gmail.com>
Date: Nov 22, 2006 7:43 PM
Subject: Re: [mod_python] Session problem
To: Graham Dumpleton <grahamd@dscpl.com.au>


On 11/22/06, Graham Dumpleton <grahamd@dscpl.com.au> wrote:
> Jakub Labath wrote ..
> > > > What I found weird is that the same mod_python request serviced two
> > > > different clients at different times, but perhaps that makes sense
> > for
> > > > preforked apache.
> > >
> > > Just to clarify your terminology, it is the same mod_python *instance*
> > > servicing 2 different client requests. And no, it is not weird, but
> > > rather the whole point of mod_python. Well maybe not the *whole* point,
> > > but a very important one. :) In the simplest case you get one python
> > > interpreter per apache child process, thus avoiding the overhead of
> > > creating a new interpreter for each request.
> >
> > It was the same child process (that much makes sense too me too), but
> > it also had the same address for modpython request object. Which I
> > thought is little weird since if request comes from address A it
> > should not be the same as if it comes from address B.
> > But the python id is just a memory address so it is possible that it
> > was just reusing the same memory space.
>
> You could always print out:
>
>   req.connection.id
>   req.connection.remote_addr

I'll try this in my debugging output, thanks.

>
> It is possible that the connection ID might get reused, but if the remote
> address is the same for both requests, then you would really worry.
>
> > > A little light just went off in my head. Is it always *exactly* the same
> > > session id being served up for *all* requests?
> >
> > No 99% of the time all work works normally.
> > User A comes along gets his own cookie user B comes along gets her own
> > cookie ... and then in one moment user A gets the cookie that belongs
> > to user B. While B user still gets her own cookie. Then user A notices
> > that suddenly his username changed from Joe to Suzy and starts sending
> > rather angry emails, which I cannot really blame him for.
> > The problem seems to appear more often if the site is under heavier load.
>
> Do both clients make requests to the server via any sort of proxy or otherwise
> which could be caching pages? In your pages do you do anything to try and
> manipulate how pages might be cached?
>
> Graham
>

Nothing I know of I suspected something doing it behind my back, but
it happens on two different boxes in two different locations, to
different clients.
I think I will find/write a tool that can emulate users loging in and
out. Once I have more reliable way to reproduce the error I will know
more.
Thanks for help everybody.

--
Jakub Labath


-- 
Jakub Labath
From grahamd at dscpl.com.au  Wed Nov 22 19:52:26 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Wed Nov 22 19:52:28 2006
Subject: [mod_python] Session problem
Message-ID: <1164243146.1886@dscpl.user.openhosting.com>

Bouncing this back to the list again. :-)

On 11/22/06, Graham Dumpleton <grahamd@dscpl.com.au> wrote:
> Jakub Labath wrote ..
> > > > What I found weird is that the same mod_python request serviced two
> > > > different clients at different times, but perhaps that makes sense
> > for
> > > > preforked apache.
> > >
> > > Just to clarify your terminology, it is the same mod_python *instance*
> > > servicing 2 different client requests. And no, it is not weird, but
> > > rather the whole point of mod_python. Well maybe not the *whole* point,
> > > but a very important one. :) In the simplest case you get one python
> > > interpreter per apache child process, thus avoiding the overhead of
> > > creating a new interpreter for each request.
> >
> > It was the same child process (that much makes sense too me too), but
> > it also had the same address for modpython request object. Which I
> > thought is little weird since if request comes from address A it
> > should not be the same as if it comes from address B.
> > But the python id is just a memory address so it is possible that it
> > was just reusing the same memory space.
>
> You could always print out:
>
>   req.connection.id
>   req.connection.remote_addr

I'll try this in my debugging output, thanks.

>
> It is possible that the connection ID might get reused, but if the remote
> address is the same for both requests, then you would really worry.
>
> > > A little light just went off in my head. Is it always *exactly* the same
> > > session id being served up for *all* requests?
> >
> > No 99% of the time all work works normally.
> > User A comes along gets his own cookie user B comes along gets her own
> > cookie ... and then in one moment user A gets the cookie that belongs
> > to user B. While B user still gets her own cookie. Then user A notices
> > that suddenly his username changed from Joe to Suzy and starts sending
> > rather angry emails, which I cannot really blame him for.
> > The problem seems to appear more often if the site is under heavier load.
>
> Do both clients make requests to the server via any sort of proxy or otherwise
> which could be caching pages? In your pages do you do anything to try and
> manipulate how pages might be cached?
>
> Graham
>

Nothing I know of I suspected something doing it behind my back, but
it happens on two different boxes in two different locations, to
different clients.
I think I will find/write a tool that can emulate users loging in and
out. Once I have more reliable way to reproduce the error I will know
more.
Thanks for help everybody.

-- 
Jakub Labath
From richardlewis at fastmail.co.uk  Thu Nov 23 05:44:28 2006
From: richardlewis at fastmail.co.uk (Richard Lewis)
Date: Thu Nov 23 05:44:34 2006
Subject: [mod_python] 
	invalid pointer, child process dies, broken connections
Message-ID: <200611231044.28832.richardlewis@fastmail.co.uk>

Hi there,

Debian unstable; apache: 2.2.3; modpython: 3.2.10; python: 2.4.4; lxml 1.1.1: 
libxml: 2.6.16; libxslt: 1.1.8.

I posted on 2nd Nov about some invalid pointer errors in my Apache error log. 
At the time I thought they were coming from MySQL and received some 
interesting replies regarding the incompatibility of the mysql client 
libraries compiled into various apache modules.

However, since then I've decided to cut MySQL out of my web application and, 
instead of dynamically converting database records into XML, use 
filesystem-cached XML files which are generated periodically from the 
database by a separate process.

While there are a couple of other advantages to this approach, it hasn't 
solved my initial problem! I still have numerous errors like this in my 
Apache error log:

[Mon Nov 20 10:51:58 2006] [notice] child pid 7087 exit signal Aborted (6)
*** glibc detected *** free(): invalid pointer: 0x0835ab26 ***
*** glibc detected *** free(): invalid pointer: 0x0835ab26 ***
*** glibc detected *** free(): invalid pointer: 0x0835ab26 ***
*** glibc detected *** free(): invalid pointer: 0x0835ab26 ***
[Mon Nov 20 10:54:28 2006] [notice] child pid 7088 exit signal Aborted (6)
[Mon Nov 20 10:54:28 2006] [notice] child pid 7089 exit signal Aborted (6)
[Mon Nov 20 10:54:28 2006] [notice] child pid 7098 exit signal Aborted (6)

It seems to handle several requests and then you get an error message from the 
client (browser) saying that "the connection is broken". You can then retry 
the request and it works after one or two attempts.

I /think/ there is no direct correlation between the invalid pointer errors 
messages and the dropped connections; the times of the messages seem to be 
pretty evenly distributed and don't all result in a broken connection.

Also, the memory addresses of the invalid pointers are often (but not always) 
the same. While the child process ids are always different. What is the child 
process? Is it python?

I've checked to make sure that I'm always returning the content length and 
Apache status code; I'm pretty sure I am! My application is using a frameset 
where the frame document and its four frames are all generated using 
mod_python. Is there anything special I should do to help mod_python with 
this? (Like returning special Apache status codes?)

Apart from getting these errors, my code is pretty much ready to go live. So 
it would be really great if anyone could help me sort out this problem!

Cheers,
Richard
-- 
-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
Richard Lewis
Sonic Arts Research Archive
http://www.sara.uea.ac.uk/
JID: ironchicken@jabber.earth.li
-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
From downgrade at gmx.org  Thu Nov 23 06:47:45 2006
From: downgrade at gmx.org (Lars Eriksen)
Date: Thu Nov 23 06:47:47 2006
Subject: [mod_python] Changing server signature
Message-ID: <45658A61.7030004@gmx.org>

When I return apache.NOT_FOUND, for example, it automatically appends 
the following signature: "Apache/2.0.59 (Win32) mod_python/3.2.8 
Python/2.4.4 Server at localhost Port 80"

Is there a way to change this programatically with mod_python or only in 
httpd.conf?
From ruben at ozonomultimedia.com  Thu Nov 23 07:25:40 2006
From: ruben at ozonomultimedia.com (=?ISO-8859-1?Q?Rub=E9n_da_Silva?=)
Date: Thu Nov 23 07:25:45 2006
Subject: [mod_python] Session timeout
In-Reply-To: <45645636.4070904@jgassociates.ca>
References: <45643E20.7050504@ozonomultimedia.com>
	<45645636.4070904@jgassociates.ca>
Message-ID: <45659344.9090304@ozonomultimedia.com>

Jim Gallacher wrote:
> Rub?n da Silva wrote:
> 
>> I'm debugging an error:
>>
>>     * id: 80b5b4b9af0a2e710195bab30cc3c358
>>     * is_new: False
>>     * created: 1164195872.07
>>     * last_accessed: 1164196137.86
>>     * timeout: 3600
>>
>> i'm developing an application who uses Session for store user data 
>> after users logins correctly,
>>
>> I use in every request after login:
>> ses = Session.Session(req, timeout = out)
>> This Session object is what i show you at mail head.
>>
>> Session stores correctly all data and detects is_new ok, BUT, session 
>> expires in (created + timeout) time, NOT in (last_accessed + timeout) 
>> time. Last_accessed as you can see, changes correctly, but after 
>> timeout (3600s. - 1 Hr.) using the application, session is deleted an 
>> users must login again.
>>
>> How can i correct this?
> 
> 
> It is necessary to save the session object after each request so that 
> last_accessed gets updated. Are you doing so?
> 
> Jim

No, i only use save() first time user logins.
But session.last_accessed changes in every request.

Rub?n
From jpg at jgassociates.ca  Thu Nov 23 08:30:59 2006
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Thu Nov 23 08:30:58 2006
Subject: [mod_python] Session timeout
In-Reply-To: <45659344.9090304@ozonomultimedia.com>
References: <45643E20.7050504@ozonomultimedia.com>	<45645636.4070904@jgassociates.ca>
	<45659344.9090304@ozonomultimedia.com>
Message-ID: <4565A293.4010302@jgassociates.ca>

Rub?n da Silva wrote:
> Jim Gallacher wrote:
>> Rub?n da Silva wrote:
>>
>>> I'm debugging an error:
>>>
>>>     * id: 80b5b4b9af0a2e710195bab30cc3c358
>>>     * is_new: False
>>>     * created: 1164195872.07
>>>     * last_accessed: 1164196137.86
>>>     * timeout: 3600
>>>
>>> i'm developing an application who uses Session for store user data 
>>> after users logins correctly,
>>>
>>> I use in every request after login:
>>> ses = Session.Session(req, timeout = out)
>>> This Session object is what i show you at mail head.
>>>
>>> Session stores correctly all data and detects is_new ok, BUT, session 
>>> expires in (created + timeout) time, NOT in (last_accessed + timeout) 
>>> time. Last_accessed as you can see, changes correctly, but after 
>>> timeout (3600s. - 1 Hr.) using the application, session is deleted an 
>>> users must login again.
>>>
>>> How can i correct this?
>>
>>
>> It is necessary to save the session object after each request so that 
>> last_accessed gets updated. Are you doing so?
>>
>> Jim
> 
> No, i only use save() first time user logins.
> But session.last_accessed changes in every request.

I gets updated in every request but you need to save the session for the 
value to persist.

The session cleanup is handled by a separate mechanism which reads the 
session data to retrieve the last_accessed value. Since you are not 
saving your session, last_accessed is not getting updated in the session 
store, and so your session is getting removed in the cleanup.

You always need to save your session.

Jim

From grahamd at dscpl.com.au  Thu Nov 23 15:52:37 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Thu Nov 23 15:52:42 2006
Subject: [mod_python] Changing server signature
Message-ID: <1164315156.895@dscpl.user.openhosting.com>

Lars Eriksen wrote ..
> When I return apache.NOT_FOUND,

You mean apache.HTTP_NOT_FOUND. :-)

> for example, it automatically appends 
> the following signature: "Apache/2.0.59 (Win32) mod_python/3.2.8 
> Python/2.4.4 Server at localhost Port 80"
> 
> Is there a way to change this programatically with mod_python or only in
> httpd.conf?

This server string comes from the default error pages which are generated by
Apache automatically when you return an error status. There are two ways that
you can change what is shown, but in both cases it means you will have to
construct a new error page to be used.

The first approach is to use the Apache ErrorDocument directive to specify an
alternate error page. See:

  http://httpd.apache.org/docs/2.0/mod/core.html#errordocument

By default Apache uses a set of pages which are processed using server side
include mechanism of Apache to incorporate error details and stuff such as the
server string.

Using ErrorDocument directive, it will apply to all URLs falling under the
point where you specify the ErrorDocument directive.

The second approach is to have your handler return the actual body of the error
response that you want. To do this, the handler would construct a response like
it was doing so for a normal page with the exception that it needs to set
req.status to indicate the error type. Also, if the handler is not the content
handler phase but an earlier phase, the handler must return apache.DONE as the
result rather than apache.OK. Even if the content handler phase, still
preferable to return apache.DONE if the complete response is being returned.

  from mod_python import apache

  def handler(req):
    req.status = apache.HTTP_NOT_FOUND
    req.content_type = 'text/html'
    req.write(...)
    return apache.DONE

Graham
From grahamd at dscpl.com.au  Thu Nov 23 16:08:57 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Thu Nov 23 16:08:59 2006
Subject: [mod_python] invalid pointer, child process dies,
	broken connections
Message-ID: <1164316137.9198@dscpl.user.openhosting.com>

Only suggestions at this point are:

1. Use:

  PythonInterpreter main_interpreter

directive for the mod_python application in case some third party Python
module is doing strange stuff with threads but wasn't written to be able
to work properly where there are multiple Python interpreter instances.
By using that named interpreter it will force application to run within the
context of the very first interpreter created. This can help where a module
uses only the simplified GIL thread locking API.

Note that this only applies for mod_python 3.2.10 and later.

2. Read through:

  http://www.dscpl.com.au/wiki/ModPython/Articles/ExpatCausingApacheCrash

and run some of the checks talked about there to make sure this isn't being
caused by some expat library mismatch.

3. Run Apache in single process mode and attach a debugger process to the
process serving the requests (you might see 2 process, you will have to work
out which is the correct one). Then when it crashes you might be able to get
a stack trace back which might help to identify in which component it is
crashing.

  /usr/local/apache-2.0/bin/httpd -X -DONE_PROCESS

In a separate window:

graham-dumpletons-powerbook-g4-15:~ grahamd$ ps ax | grep httpd
  267  p1  S+     0:00.10 /usr/local/apache-2.2/bin/httpd -X -DONE_PROCESS
  268  p1  S+     0:00.00 /usr/local/apache-2.2/bin/httpd -X -DONE_PROCESS
  270  p2  R+     0:00.00 grep httpd

Run debugger. Usually on lowest number pid.

graham-dumpletons-powerbook-g4-15:~ grahamd$ gdb /usr/local/apache-2.2/bin/httpd -p 267
GNU gdb 6.3.50-20050815 (Apple version gdb-477) (Sun Apr 30 20:06:22 GMT 2006)
Copyright 2004 Free Software Foundation, Inc.
GDB is free software, covered by the GNU General Public License, and you are
welcome to change it and/or distribute copies of it under certain conditions.
Type "show copying" to see the conditions.
There is absolutely no warranty for GDB.  Type "show warranty" for details.
This GDB was configured as "powerpc-apple-darwin"...Reading symbols for shared libraries ....... done

/Users/grahamd/267: No such file or directory.
Attaching to program: `/usr/local/apache-2.2/bin/httpd', process 267.
Reading symbols for shared libraries .+++...................... done
0x900c7060 in sigwait ()
(gdb) 

Should see sigwait() from memory.

Type 'cont' command to gdb and then start sending requests until it crashes.
Then use 'where' to get a stack trace.

4. It would also be a good idea to simply start paring back the code of your
application bit by bit until you can come up with the most minimal bit of code
which causes the crash. In doing this, don't treat modules as black boxes, you
need to delve done into them and look at what they do, going deeper and deeper
until you get to the bottom.

5. Try the dev snapshot of mod_python 3.3. There were various crashes fixed
in that version, but these were generally odd things which probably only I
would ever think to try.

  http://mail-archives.apache.org/mod_mbox/httpd-python-dev/200611.mbox/%3c45533499.5090600@jgassociates.ca%3e

6. Post just the part of your Apache configuration which relates to how you
trigger mod_python and in what context. From that I might see if you are
managing to hit any of the issues referred to in 5.

Graham

Richard Lewis wrote ..
> Hi there,
> 
> Debian unstable; apache: 2.2.3; modpython: 3.2.10; python: 2.4.4; lxml
> 1.1.1: 
> libxml: 2.6.16; libxslt: 1.1.8.
> 
> I posted on 2nd Nov about some invalid pointer errors in my Apache error
> log. 
> At the time I thought they were coming from MySQL and received some 
> interesting replies regarding the incompatibility of the mysql client 
> libraries compiled into various apache modules.
> 
> However, since then I've decided to cut MySQL out of my web application
> and, 
> instead of dynamically converting database records into XML, use 
> filesystem-cached XML files which are generated periodically from the 
> database by a separate process.
> 
> While there are a couple of other advantages to this approach, it hasn't
> solved my initial problem! I still have numerous errors like this in my
> Apache error log:
> 
> [Mon Nov 20 10:51:58 2006] [notice] child pid 7087 exit signal Aborted
> (6)
> *** glibc detected *** free(): invalid pointer: 0x0835ab26 ***
> *** glibc detected *** free(): invalid pointer: 0x0835ab26 ***
> *** glibc detected *** free(): invalid pointer: 0x0835ab26 ***
> *** glibc detected *** free(): invalid pointer: 0x0835ab26 ***
> [Mon Nov 20 10:54:28 2006] [notice] child pid 7088 exit signal Aborted
> (6)
> [Mon Nov 20 10:54:28 2006] [notice] child pid 7089 exit signal Aborted
> (6)
> [Mon Nov 20 10:54:28 2006] [notice] child pid 7098 exit signal Aborted
> (6)
> 
> It seems to handle several requests and then you get an error message from
> the 
> client (browser) saying that "the connection is broken". You can then retry
> the request and it works after one or two attempts.
> 
> I /think/ there is no direct correlation between the invalid pointer errors
> messages and the dropped connections; the times of the messages seem to
> be 
> pretty evenly distributed and don't all result in a broken connection.
> 
> Also, the memory addresses of the invalid pointers are often (but not always)
> the same. While the child process ids are always different. What is the
> child 
> process? Is it python?
> 
> I've checked to make sure that I'm always returning the content length
> and 
> Apache status code; I'm pretty sure I am! My application is using a frameset
> where the frame document and its four frames are all generated using 
> mod_python. Is there anything special I should do to help mod_python with
> this? (Like returning special Apache status codes?)
> 
> Apart from getting these errors, my code is pretty much ready to go live.
> So 
> it would be really great if anyone could help me sort out this problem!
> 
> Cheers,
> Richard
> -- 
> -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
> Richard Lewis
> Sonic Arts Research Archive
> http://www.sara.uea.ac.uk/
> JID: ironchicken@jabber.earth.li
> -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
From jpg at jgassociates.ca  Thu Nov 23 16:39:15 2006
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Thu Nov 23 16:38:35 2006
Subject: [mod_python] 	invalid pointer, child process dies,
	broken connections
In-Reply-To: <200611231044.28832.richardlewis@fastmail.co.uk>
References: <200611231044.28832.richardlewis@fastmail.co.uk>
Message-ID: <45661503.8000300@jgassociates.ca>

Richard Lewis wrote:
> Hi there,
> 
> Debian unstable; apache: 2.2.3; modpython: 3.2.10; python: 2.4.4; lxml 1.1.1: 
> libxml: 2.6.16; libxslt: 1.1.8.

> I posted on 2nd Nov about some invalid pointer errors in my Apache error log. 
> At the time I thought they were coming from MySQL and received some 
> interesting replies regarding the incompatibility of the mysql client 
> libraries compiled into various apache modules.
> 
> However, since then I've decided to cut MySQL out of my web application and, 
> instead of dynamically converting database records into XML, use 
> filesystem-cached XML files which are generated periodically from the 
> database by a separate

Were you using lxml, libxml and libxslt previously from within 
mod_python? If you can reduce things to the simplest possible test case 
I can check it on my Debian test setup.

> While there are a couple of other advantages to this approach, it hasn't 
> solved my initial problem! I still have numerous errors like this in my 
> Apache error log:
> 
> [Mon Nov 20 10:51:58 2006] [notice] child pid 7087 exit signal Aborted (6)
> *** glibc detected *** free(): invalid pointer: 0x0835ab26 ***
> *** glibc detected *** free(): invalid pointer: 0x0835ab26 ***
> *** glibc detected *** free(): invalid pointer: 0x0835ab26 ***
> *** glibc detected *** free(): invalid pointer: 0x0835ab26 ***
> [Mon Nov 20 10:54:28 2006] [notice] child pid 7088 exit signal Aborted (6)
> [Mon Nov 20 10:54:28 2006] [notice] child pid 7089 exit signal Aborted (6)
> [Mon Nov 20 10:54:28 2006] [notice] child pid 7098 exit signal Aborted (6)
>
> It seems to handle several requests and then you get an error message from the 
> client (browser) saying that "the connection is broken". You can then retry 
> the request and it works after one or two attempts.
> 
> I /think/ there is no direct correlation between the invalid pointer errors 
> messages and the dropped connections; the times of the messages seem to be 
> pretty evenly distributed and don't all result in a broken connection.
> 
> Also, the memory addresses of the invalid pointers are often (but not always) 
> the same. While the child process ids are always different. What is the child 
> process? Is it python?

The child process refers to the Apache child process. The python 
interpreter is embedded in that process. The fact that the pids are 
different indicates that they are being killed off, which is generally a 
bad thing performance wise. Generally you want them to be long lived to 
avoid the overhead of forking a new process.

> I've checked to make sure that I'm always returning the content length and 
> Apache status code; I'm pretty sure I am! My application is using a frameset 
> where the frame document and its four frames are all generated using 
> mod_python. Is there anything special I should do to help mod_python with 
> this? (Like returning special Apache status codes?)

Nope. There is nothing special about framesets. As far as apache or 
mod_python are concerned it's just regular content. The only thing to be 
aware of is if you are accessing session data in each page of the 
frameset. You'll want to manually unlock the session as soon as possible 
for maximum performance. However this totally unrelated to your problem.

Jim



From downgrade at gmx.org  Fri Nov 24 08:13:23 2006
From: downgrade at gmx.org (Lars Eriksen)
Date: Fri Nov 24 08:13:34 2006
Subject: [mod_python] Changing server signature
In-Reply-To: <1164315156.895@dscpl.user.openhosting.com>
References: <1164315156.895@dscpl.user.openhosting.com>
Message-ID: <4566EFF3.8060100@gmx.org>

Excellent, Graham, thank you very much!


> Using ErrorDocument directive, it will apply to all URLs falling under the
> point where you specify the ErrorDocument directive.
> 
> The second approach is to have your handler return the actual body of the error
> response that you want. To do this, the handler would construct a response like
> it was doing so for a normal page with the exception that it needs to set
> req.status to indicate the error type. Also, if the handler is not the content
> handler phase but an earlier phase, the handler must return apache.DONE as the
> result rather than apache.OK. Even if the content handler phase, still
> preferable to return apache.DONE if the complete response is being returned.
> 
>   from mod_python import apache
> 
>   def handler(req):
>     req.status = apache.HTTP_NOT_FOUND
>     req.content_type = 'text/html'
>     req.write(...)
>     return apache.DONE
> 
> Graham
From richardlewis at fastmail.co.uk  Fri Nov 24 08:42:53 2006
From: richardlewis at fastmail.co.uk (Richard Lewis)
Date: Fri Nov 24 08:43:02 2006
Subject: [mod_python] invalid pointer, child process dies,
	broken connections
In-Reply-To: <1164316137.9198@dscpl.user.openhosting.com>
References: <1164316137.9198@dscpl.user.openhosting.com>
Message-ID: <200611241342.54166.richardlewis@fastmail.co.uk>

Thanks for these pointers:

On Thursday 23 November 2006 21:08, Graham Dumpleton wrote:
> Only suggestions at this point are:
>
> 1. Use:
>
>   PythonInterpreter main_interpreter
>
Didn't seem to make any difference.

>
> Note that this only applies for mod_python 3.2.10 and later.
>
> 2. Read through:
>
>   http://www.dscpl.com.au/wiki/ModPython/Articles/ExpatCausingApacheCrash
>
I tried this and the expat test worked fine. I'm pretty sure lxml doesn't use 
expat (because it uses libxml instead).

>
> 3. Run Apache in single process mode and attach a debugger process
> ...
> Type 'cont' command to gdb and then start sending requests until it
> crashes. Then use 'where' to get a stack trace.
>
OK. I've just tried this. I'm not all that familiar with gdb (I'm not a C 
programmer) but I managed to get it to work, though my session was a bit 
different to yours.

I think it may have highlighted the source of the problem. I don't know 
whether you know, but one of the reasons why the lxml module was created was 
because of memory management problems with the standard Python bindings to 
libxml. It seems that the stack trace I've got is showing exactly these 
problems:

#4  0xb7bd0811 in raise () from /lib/tls/i686/cmov/libc.so.6
#5  0xb7bd1fb9 in abort () from /lib/tls/i686/cmov/libc.so.6
#6  0xb7c05c8a in __fsetlocking () from /lib/tls/i686/cmov/libc.so.6
#7  0xb7c0d51f in mallopt () from /lib/tls/i686/cmov/libc.so.6
#8  0xb7c0d5c2 in free () from /lib/tls/i686/cmov/libc.so.6
#9  0xb727155d in xmlFreeNodeList () from /usr/lib/libxml2.so.2
#10 0xb72716a2 in xmlFreeProp () from /usr/lib/libxml2.so.2
#11 0xb727191b in xmlFreePropList () from /usr/lib/libxml2.so.2
#12 0xb72714fa in xmlFreeNodeList () from /usr/lib/libxml2.so.2
#13 0xb72714d6 in xmlFreeNodeList () from /usr/lib/libxml2.so.2
#14 0xb72714d6 in xmlFreeNodeList () from /usr/lib/libxml2.so.2
#15 0xb72712fe in xmlFreeDoc () from /usr/lib/libxml2.so.2
#16 0xb73edcc6 in initTagMatch () 
from /usr/lib/python2.4/site-packages/lxml/etree.so
#17 0xb73edaec in initTagMatch () 
from /usr/lib/python2.4/site-packages/lxml/etree.so
#18 0xb73b3826 in iteratorStoreNext () 
from /usr/lib/python2.4/site-packages/lxml/etree.so
#19 0xb73b368c in iteratorStoreNext () 
from /usr/lib/python2.4/site-packages/lxml/etree.so
#20 0xb73b8b06 in iteratorStoreNext () 
from /usr/lib/python2.4/site-packages/lxml/etree.so
#21 0xb775b255 in PyTuple_Size () from /usr/lib/libpython2.4.so.1.0
#22 0xb7786fe3 in PyEval_EvalFrame () from /usr/lib/libpython2.4.so.1.0
#23 0xb77878a5 in PyEval_EvalFrame () from /usr/lib/libpython2.4.so.1.0
#24 0xb77878a5 in PyEval_EvalFrame () from /usr/lib/libpython2.4.so.1.0
#25 0xb778878a in PyEval_EvalCodeEx () from /usr/lib/libpython2.4.so.1.0
#26 0xb77381c0 in PyClassMethod_New () from /usr/lib/libpython2.4.so.1.0
#27 0xb771d237 in PyObject_Call () from /usr/lib/libpython2.4.so.1.0
#28 0xb7724a72 in PyClass_IsSubclass () from /usr/lib/libpython2.4.so.1.0
#29 0xb771d237 in PyObject_Call () from /usr/lib/libpython2.4.so.1.0
#30 0xb771f67e in PyObject_CallMethod () from /usr/lib/libpython2.4.so.1.0
#31 0xb7836455 in python_cleanup () 
from /usr/lib/apache2/modules/mod_python.so
#32 0xb7837e1a in python_cleanup () 
from /usr/lib/apache2/modules/mod_python.so
#33 0x08074587 in ap_run_handler ()
#34 0x08077731 in ap_invoke_handler ()
#35 0x08084728 in ap_process_request ()
#36 0x080819ce in ap_register_input_filter ()
#37 0x0807b3c7 in ap_run_process_connection ()
#38 0x08088704 in ap_graceful_stop_signalled ()
#39 0x08088964 in ap_graceful_stop_signalled ()
#40 0x0808972a in ap_mpm_run ()
#41 0x080621ef in main ()

I don't know what the answer is, though?

The strange thing is that I've used lxml with mod_python before (in my Pycoon 
project) and I've never had this problem - I hope I'm not about to run into 
it in the near future!

> 4. It would also be a good idea to simply start paring back the code of
> your application bit by bit

Yes, this is a good idea, but very unappealing ;-)

>
> 5. Try the dev snapshot of mod_python 3.3.

OK, I may try this later on, the only thing is that I'm a Debian user and so 
am quite averse to manual compilation/installation ;-)

>
> 6. Post just the part of your Apache configuration which relates to how you
> trigger mod_python and in what context. From that I might see if you are
> managing to hit any of the issues referred to in 5.
>
This is my whole config:

NameVirtualHost *

<VirtualHost *>
    ServerName localhost
    DocumentRoot /home/richard/Documents/sara/python

    SetHandler mod_python
    #PythonInterpreter main_interpreter
    PythonPath 'sys.path+["/home/richard/Documents/sara/python"]'
    #PythonDebug on

    PythonHandler sara.web
</VirtualHost>

Thanks for your help!

Cheers,
Richard

>
> Richard Lewis wrote ..
>
> > Hi there,
> >
> > Debian unstable; apache: 2.2.3; modpython: 3.2.10; python: 2.4.4; lxml
> > 1.1.1:
> > libxml: 2.6.16; libxslt: 1.1.8.
> >
> > I posted on 2nd Nov about some invalid pointer errors in my Apache error
> > log.
> > At the time I thought they were coming from MySQL and received some
> > interesting replies regarding the incompatibility of the mysql client
> > libraries compiled into various apache modules.
> >
> > However, since then I've decided to cut MySQL out of my web application
> > and,
> > instead of dynamically converting database records into XML, use
> > filesystem-cached XML files which are generated periodically from the
> > database by a separate process.
> >
> > While there are a couple of other advantages to this approach, it hasn't
> > solved my initial problem! I still have numerous errors like this in my
> > Apache error log:
> >
> > [Mon Nov 20 10:51:58 2006] [notice] child pid 7087 exit signal Aborted
> > (6)
> > *** glibc detected *** free(): invalid pointer: 0x0835ab26 ***
> > *** glibc detected *** free(): invalid pointer: 0x0835ab26 ***
> > *** glibc detected *** free(): invalid pointer: 0x0835ab26 ***
> > *** glibc detected *** free(): invalid pointer: 0x0835ab26 ***
> > [Mon Nov 20 10:54:28 2006] [notice] child pid 7088 exit signal Aborted
> > (6)
> > [Mon Nov 20 10:54:28 2006] [notice] child pid 7089 exit signal Aborted
> > (6)
> > [Mon Nov 20 10:54:28 2006] [notice] child pid 7098 exit signal Aborted
> > (6)
> >
> > It seems to handle several requests and then you get an error message
> > from the
> > client (browser) saying that "the connection is broken". You can then
> > retry the request and it works after one or two attempts.
> >
> > I /think/ there is no direct correlation between the invalid pointer
> > errors messages and the dropped connections; the times of the messages
> > seem to be
> > pretty evenly distributed and don't all result in a broken connection.
> >
> > Also, the memory addresses of the invalid pointers are often (but not
> > always) the same. While the child process ids are always different. What
> > is the child
> > process? Is it python?
> >
> > I've checked to make sure that I'm always returning the content length
> > and
> > Apache status code; I'm pretty sure I am! My application is using a
> > frameset where the frame document and its four frames are all generated
> > using mod_python. Is there anything special I should do to help
> > mod_python with this? (Like returning special Apache status codes?)
> >
> > Apart from getting these errors, my code is pretty much ready to go live.
> > So
> > it would be really great if anyone could help me sort out this problem!
> >
> > Cheers,
> > Richard
> > --
> > -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
> > Richard Lewis
> > Sonic Arts Research Archive
> > http://www.sara.uea.ac.uk/
> > JID: ironchicken@jabber.earth.li
> > -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://mailman.modpython.org/mailman/listinfo/mod_python
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python

-- 
-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
Richard Lewis
Sonic Arts Research Archive
http://www.sara.uea.ac.uk/
JID: ironchicken@jabber.earth.li
-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
From nogradi at gmail.com  Sun Nov 26 13:10:42 2006
From: nogradi at gmail.com (Daniel Nogradi)
Date: Sun Nov 26 13:10:47 2006
Subject: [mod_python] hlist repr bug
Message-ID: <5f56302b0611261010u6bd9712aje95839ef30087fea@mail.gmail.com>

There seems to be a harmless bug in the hlistobject.c file. Line 145 is

PyString_ConcatAndDel(&s, PyString_FromString("'handler:'"));

but it should be

PyString_ConcatAndDel(&s, PyString_FromString("'handler':'"));

Note the ' between handler and :

The function involved only creates the repr output for hlist so
doesn't effect anything but got me slightly confused for a while :)
From grahamd at dscpl.com.au  Sun Nov 26 16:44:40 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Sun Nov 26 16:44:43 2006
Subject: [mod_python] hlist repr bug
Message-ID: <1164577480.26786@dscpl.user.openhosting.com>

Daniel Nogradi wrote ..
> There seems to be a harmless bug in the hlistobject.c file. Line 145 is
> 
> PyString_ConcatAndDel(&s, PyString_FromString("'handler:'"));
> 
> but it should be
> 
> PyString_ConcatAndDel(&s, PyString_FromString("'handler':'"));
> 
> Note the ' between handler and :
> 
> The function involved only creates the repr output for hlist so
> doesn't effect anything but got me slightly confused for a while :)

Already fixed in a mod_python 3.3.

Graham
From mh at pixar.com  Sun Nov 26 21:49:43 2006
From: mh at pixar.com (Mark Harrison)
Date: Sun Nov 26 21:50:10 2006
Subject: [mod_python] can't compile on linux?
Message-ID: <456A5247.8060300@pixar.com>

So I had no problem building apache, python, and mod_python
on my OS X box, but I'm having problems on my Linux box
(surprising, because that is usually the most trouble-free
compilation environment).

ohm ~/mp2/src/mod_python-3.2.10$ uname -a
Linux ohm 2.6.12-1.1372_FC3p2smp #1 SMP Wed Jul 27 18:07:20 PDT 2005 x86_64 x86_64 x86_64 GNU/Linux

httpd-2.2.3
Python-2.4.3

(both configured with ./configure --prefix=/u0/mh/mp)

mod_python-3.2.10

(configured with
./configure --with-apxs=/u0/mh/mp/bin/apxs --with-python=/u0/mh/mp/bin/python)

The httpd and python both seem good, but I get this
error when compiling mod_python.

Any clues appreciated!
Mark


/u0/mh/mp2/build/libtool --silent --mode=link gcc -o mod_python.la  -rpath /u0/m
h/mp2/modules -module -avoid-version    hlistobject.lo hlist.lo filterobject.lo
connobject.lo serverobject.lo util.lo tableobject.lo requestobject.lo _apachemod
ule.lo mod_python.lo -L/u0/mh/mp2/lib/python2.4/config -Xlinker -export-dynamic
-lm -lpython2.4 -lpthread -ldl -lutil -lm
/usr/bin/ld: /u0/mh/mp2/lib/python2.4/config/libpython2.4.a(abstract.o): relocat
ion R_X86_64_32 can not be used when making a shared object; recompile with -fPI
C
/u0/mh/mp2/lib/python2.4/config/libpython2.4.a: could not read symbols: Bad valu
e
collect2: ld returned 1 exit status
apxs:Error: Command failed with rc=65536

-- 
Mark Harrison
Pixar Animation Studios
From mh at pixar.com  Mon Nov 27 02:00:18 2006
From: mh at pixar.com (Mark Harrison)
Date: Mon Nov 27 02:00:46 2006
Subject: [mod_python] can't compile on linux?
In-Reply-To: <456A5247.8060300@pixar.com>
References: <456A5247.8060300@pixar.com>
Message-ID: <456A8D02.7030706@pixar.com>

Mark Harrison wrote:
> /usr/bin/ld: /u0/mh/mp2/lib/python2.4/config/libpython2.4.a(abstract.o): 
> relocat
> ion R_X86_64_32 can not be used when making a shared object; recompile 
> with -fPI
> C
> /u0/mh/mp2/lib/python2.4/config/libpython2.4.a: could not read symbols: 
> Bad valu
> e
> collect2: ld returned 1 exit status
> apxs:Error: Command failed with rc=65536
> 

Problem solved... python must be configured with --enable-shared

Sorry for the bother,
Mark

-- 
Mark Harrison
Pixar Animation Studios
From ah at hatzis.de  Mon Nov 27 03:32:09 2006
From: ah at hatzis.de (Anastasios Hatzis)
Date: Mon Nov 27 03:32:15 2006
Subject: [mod_python] can't compile on linux?
In-Reply-To: <456A5247.8060300@pixar.com>
References: <456A5247.8060300@pixar.com>
Message-ID: <456AA289.3090005@hatzis.de>

Mark Harrison wrote:
> So I had no problem building apache, python, and mod_python
> on my OS X box, but I'm having problems on my Linux box
> (surprising, because that is usually the most trouble-free
> compilation environment).
> 
> ohm ~/mp2/src/mod_python-3.2.10$ uname -a
> Linux ohm 2.6.12-1.1372_FC3p2smp #1 SMP Wed Jul 27 18:07:20 PDT 2005 
> x86_64 x86_64 x86_64 GNU/Linux
> 
> httpd-2.2.3
> Python-2.4.3
> 
> (both configured with ./configure --prefix=/u0/mh/mp)
> 
> mod_python-3.2.10
> 
> (configured with
> ./configure --with-apxs=/u0/mh/mp/bin/apxs 
> --with-python=/u0/mh/mp/bin/python)
> 
> The httpd and python both seem good, but I get this
> error when compiling mod_python.
> 
> Any clues appreciated!
> Mark
> 

I really can only clue, since I'm not used to compile software myself on 
Linux.  I had the same problems and I think the solution is as following 
(don't ask me for the technically accurate evidence, at least it worked 
on my OpenSUSE 10.0 64bit machine -- tribute goes also to Christopher 
Taylor who expierenced the same error message on his RHEL 64bit 
independent of me and put my nose to the right direction):

As I see on the citings you use a 64bit machine, right? When building 
Python I added the option "enable-shared" at the configuration. 
According to Christopher the 32bit linking/loading to a static library 
is not a problem but on 64bit it can be.

(1) tested with Python 2.5:
./configure --enable-shared

But this ain't enough. I also build Apache with 64bit support 
"-enable-lib64", but concrete configure options may be different on your 
machine.

(2) tested with Apache 2.2.3:
./configure --enable-mods-shared='headers dav dav-fs dav-lock ssl 
rewrite vhost-alias' -enable-lib64 --with-expat=builtin

Before you continue make sure that both libraries are there and to be 
found. As I see you explicitely defined apxs path. I did do this after 
my early attempts failed and pointed me to an apxs:error. I think you 
can leave that away.

(3) tested with mod_python 3.2.10:
./configure

I hope this works on your machine. But really make sure that the 
libraries can be found. I tried multiple times to compile and install 
these three apps from source and I always failed at mod_python and 
started again from the scratch (means: I installed Linux from image 
again). Even as I followed instruction as described here, it didn't work 
always. If you again get the problem just stubbornly retry "./configure" 
another time after first fail --this worked on my machine. Don't ask me 
why...! Also rebooting the machine worked after installing Python and 
HTTPD but before mod_python did work. I assume rebooting  was not the 
reason for success, but that I started a new shell which then set the 
library path variables to Python and Apache HTTPD which I have put into 
the .bashrc file after their successful installations.

Well, I hope I didn't confuse you too much and this will work for your 
machine. If not, hum,... hopefully there is someone else who can provide 
a better answer. ;-)

Good luck!

Anastasios



> 
> /u0/mh/mp2/build/libtool --silent --mode=link gcc -o mod_python.la  
> -rpath /u0/m
> h/mp2/modules -module -avoid-version    hlistobject.lo hlist.lo 
> filterobject.lo
> connobject.lo serverobject.lo util.lo tableobject.lo requestobject.lo 
> _apachemod
> ule.lo mod_python.lo -L/u0/mh/mp2/lib/python2.4/config -Xlinker 
> -export-dynamic
> -lm -lpython2.4 -lpthread -ldl -lutil -lm
> /usr/bin/ld: /u0/mh/mp2/lib/python2.4/config/libpython2.4.a(abstract.o): 
> relocat
> ion R_X86_64_32 can not be used when making a shared object; recompile 
> with -fPI
> C
> /u0/mh/mp2/lib/python2.4/config/libpython2.4.a: could not read symbols: 
> Bad valu
> e
> collect2: ld returned 1 exit status
> apxs:Error: Command failed with rc=65536
> 


-- 


Mit freundlichen Gr??en

i. A.
Anastasios Hatzis

Hatzis Edelstahlbearbeitung GmbH
Hojen 2
87490 Haldenwang (Allg?u)
Deutschland

Tel: 0 83 74 / 9 30 8-13
Fax: 0 83 74 / 9 30 8-10

Mobil: 0 15 20 / 8 59 28 78     ++NEU+++NEU+++NEU+

Handelsregister Kempten (Allg?u): HRB 4204
Umsatzsteuer-Identit?tsnummer: DE 128791802
Gesch?ftsf?hrer: Paulos Hatzis, Charalampos Hatzis

http://www.hatzis.de/
From martijn at xs4us.nu  Mon Nov 27 06:08:15 2006
From: martijn at xs4us.nu (Martijn Moeling)
Date: Mon Nov 27 06:08:24 2006
Subject: [mod_python] Session Storage : memory, file, dbm....Mysql?
Message-ID: <B6C73A5E30565245BB6D32B5F5DF7A520BEDCB@sense.emmastraat.pijnacker>

Hi,

I am building an application framework (yes!) with very specific needs.
One of the main problems I run into is session management, I'll explain:

My application (Running on Fedora) Is prepared for multiple front-end
servers communicating on an Internal backbone to a database server.
Think of it as some sort of web based Citrix able to run on all browsers
without the need of client-side software installation. Fully
programmable in python (even the front-end) and if the time gets there
even Visual. So build a browser based application within an application
with central storage and management. Mod Python is used to implement a
part of an OS if you wish to call it that way.

The front ends will be Apache servers with mod_python connected to the
Internet using round-robin DNS (Multiple ip addresses for one Host), In
theory a PC will do a DNS lookup and get the address of one of the
front-end, this PC will keep this address until the TTL makes it expire
in the DNS caches along the way, there is no problem since each session
will be served by the same front end.

But I need to find a way to get the session information into the MySQL
database in the backend server to enable central monitoring and inter
user communications etc. (think of a Messenger online userlist as an
example)

I can of course write stuff to maintain this sort of data in the MySQL
database but what if the session ends other than a user logging out
nicely (broken connection, browser close etc.)

It would be nice to have a MySQLsession object, an extra parameter could
be added like a MySQLdb cursor object, or am I wrong and are sessions
maintained by Apache (since modpython does not seem to keep track of
Session closing), or is there any way to "list" active sessions from
within modpython, so I can let the backend server send an http request
to the front-end and doing something like:
http://frontend1/getsessionlist which returns a comma separated list of
active session id's, so the stale session records in the database can be
removed.

I have been researching Session.py
Where I interestingly found:
(from def dbm_cleanup(data):)

If (time.time() - dict[_accessed]) > dict["_timeout]:
	old.append(key)
..
..
..
For key in old:
	Del db[key]

If I understand this right, this means that this is done to see if the
session is ended right? So It I alter Session.py I could make my own
MySQL Session right?

Would there be anyone else Interested in a MySQLSession object and what
do I need to take into account when modifying it?


Please feel free to comment on any of this,

Martijn Moeling

From durumdara at gmail.com  Mon Nov 27 10:00:53 2006
From: durumdara at gmail.com (durumdara)
Date: Mon Nov 27 10:01:03 2006
Subject: [mod_python] Session Hell...
Message-ID: <456AFDA5.5010704@gmail.com>

Hi !

I have a big problem. I've just finished my big site: this is a session 
based online shop.
But I'm get crazy...
When I want to control the number of elements (piece of the purcheasable 
items), the site is move in dead state (httpd).

I use the Session to store the items, and the first phase I check this 
array, change it with the input params, revalidate it, and deepcopy it 
to the request.

This what I do for minimize the session-locking, and multithreading 
problems.

I need to save Session, because it's lifetime must increasing in every 
request.

Today I build a version that containing threading.Lock. In this way only 
ONE request worked, next request are go to hell...

What is this problem?
Anyone knows about a session problems in WXP, Py2.2.4, ModPy3.2.10, 
Apache2.2.3?

I need to repair my site, the next day I need to demonstrate to it is 
working good... :-((((

Thanks for any idea that can help me:
  dd

From slingareddy at Crossroads.com  Mon Nov 27 10:03:07 2006
From: slingareddy at Crossroads.com (Surendra Lingareddy)
Date: Mon Nov 27 10:03:26 2006
Subject: [mod_python] Programmatic Redirection in Frames
Message-ID: <43F5E8AE07F17C47BC16F7A159E9E700D93B87@mailnode1.commstor.crossroads.com>

I am using util.redirect() to redirect to a particular page when a user
takes an action. The action is submitted via a form and read the action
via the req.form.getfirst() thingy. If the session is ended, my
redirection to the login page does not take me to the top-level frame,
instead it puts it into a child frame. Is there a way where I can
specify programmatically to be redirected to the top level frame?

 

On a href call, it is easy as it takes target=_top but can I specify it
somehow on a req object?

 

Thanks,

Suren 

CONFIDENTIAL: This email, including its contents and attachments, if any, are confidential. If the reader of this e-mail is not an intended recipient, you have received this e-mail in error and any review, dissemination, distribution or copying is strictly prohibited. If you have received this e-mail in error, please notify the sender immediately by return e-mail at [emailaddress@crossroads.com] and permanently delete the copy you received. Copyright and other intellectual property rights in its contents are the sole property of Crossroads Systems, Inc. Email transmission cannot be guaranteed to be secure or error-free. The sender therefore does not accept liability for any errors or omissions in the contents of the message which arise as a result of email  transmission.  Although we routinely screen for viruses, addressees should check this email and any attachments for viruses. We make no representation or warranty as to the absence of viruses in this email or any attachments.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20061127/09547320/attachment-0001.html
From martijn at xs4us.nu  Mon Nov 27 10:09:21 2006
From: martijn at xs4us.nu (Martijn Moeling)
Date: Mon Nov 27 10:09:31 2006
Subject: [mod_python] MySQLSession available!!
Message-ID: <B6C73A5E30565245BB6D32B5F5DF7A520BEDCC@sense.emmastraat.pijnacker>

Well after investigating "sessions.py" a bit more I have come up with a
working MySQLSession object added to "sessions.py"

See code (only the changed parts) below....

The nasty thing is that it will be overwritten by any mod_python
updates, or if it is interesting enough (hopefully) it gets into the
next major mod_python release.

By checking for the req.cursor, there is no need for importing MySQLdb
into session.py

See code (only the changed parts) below....

8<---------------------------------------------------------------------
########################################################################
###
## MySQLSession
## M. Moeling, martijn@xs4us.nu
##
## In order to use MySQLSession:
## in your handler.py:        
## import MySQLdb
##
##  Somewhere before the session stuff use:
##
##  req.db =
MySQLdb.connect(host=Chost,user=Cuser,passwd=Cpasswd,db=Cdb)
##  req.cursor = req.db.cursor()
## 
##  When req.cursor is existing, Session.py will default to MySQLSession
##  Can be overruled with pythonoptions in apache config
##
## To create table in MySQL use the following:
## CREATE TABLE `Session` (
##  `sid` varchar(50) NOT NULL,
##  `store` text NOT NULL,
##  PRIMARY KEY  (`sid`)
## ) TYPE=MyISAM;
        
def mysql_cleanup(req):
    req.cursor.execute("Select * from Session")
    AllSessions = req.cursor.fetchall()
    for records in AllSessions:
        session = cPicle.loads(record[1])
        if (time.time() - session["_accessed"]) > session["_timeout"]:
            req.cursor.execute("DELETE FROM Session where
sid='"+session[0]+"'")        

        
class MySQLSession(BaseSession):

    def __init__(self, req, sid=0, secret=None, timeout=0, lock=1):

        BaseSession.__init__(self, req, sid=sid, secret=secret,
                             timeout=timeout, lock=lock)

    def do_cleanup(self):
        self._req.register_cleanup(MySQL_cleanup, self._req)
        self._req.log_error("MySQLSession: registered session cleanup.",
                            apache.APLOG_NOTICE)

    def do_load(self):
        self._req.cursor.execute("Select store from Session where
sid='"+self._sid+"'")
        store=self._req.cursor.fetchone()
        if self._req.cursor.rowcount==1:
            return cPickle.loads(store[0])
        return None

    def do_save(self, dict):
        self._req.cursor.execute("Select store from Session where
sid='"+self._sid+"'")
        store=self._req.cursor.fetchone()
        if self._req.cursor.rowcount==1:
            Query="Update Session set store=\""+cPickle.dumps(dict)+"\"
where sid='"+self._sid+"'"
        else:
            Query="Insert into Session (sid,store) values
(\""+self._sid+"\",\""+cPickle.dumps(dict)+"\")"           
         self._req.cursor.execute(Query)
        
    def do_delete(self):
        try:
            self._req.cursor.execute("DELETE FROM Session where
sid='"+self._sid+"'")
        except:
            pass


########################################################################
###
## Session

## Changes made for MySQLSession
## the application should set req.cursor as an MySQLdb cursor object


def Session(req, sid=0, secret=None, timeout=0, lock=1):

    opts = req.get_options()
    if opts.has_key('session'):
        # Check the apache config for the type of session
        sess_type = opts['session']
    else:
        ## MySQLSession is default when req.cursor exists
        if req.cursor:
            sess_type = 'MySQLSession'
        else:
        ## END of MySQLSession modification
            # no session class in config so get the default for the
platform
            threaded = _apache.mpm_query(apache.AP_MPMQ_IS_THREADED)
            forked = _apache.mpm_query(apache.AP_MPMQ_IS_FORKED)
            daemons =  _apache.mpm_query(apache.AP_MPMQ_MAX_DAEMONS)
            if (threaded and ((not forked) or (daemons == 1))):
                sess_type = 'MemorySession'
            else:
                sess_type = 'DbmSession'

    if sess_type == 'FileSession':
        sess =  FileSession
    elif sess_type == 'DbmSession':
        sess = DbmSession
    elif sess_type == 'MemorySession':
        sess = MemorySession
    ## Added for MySQLSession
    elif sess_type == 'MySQLSession':
        sess = MySQLSession
    else:
        # TODO Add capability to load a user defined class
        # For now, just raise an exception.
        raise Exception, 'Unknown session type %s' % sess_type

    return sess(req, sid=sid, secret=secret,
                         timeout=timeout, lock=lock)
8<---------------------------------------------------------------------

-----Oorspronkelijk bericht-----
Van: mod_python-bounces@modpython.org
[mailto:mod_python-bounces@modpython.org] Namens Martijn Moeling
Verzonden: Monday, November 27, 2006 12:08 PM
Aan: mod_python@modpython.org
Onderwerp: [mod_python] Session Storage : memory, file, dbm....Mysql?

Hi,

I am building an application framework (yes!) with very specific needs.
One of the main problems I run into is session management, I'll explain:

My application (Running on Fedora) Is prepared for multiple front-end
servers communicating on an Internal backbone to a database server.
Think of it as some sort of web based Citrix able to run on all browsers
without the need of client-side software installation. Fully
programmable in python (even the front-end) and if the time gets there
even Visual. So build a browser based application within an application
with central storage and management. Mod Python is used to implement a
part of an OS if you wish to call it that way.

The front ends will be Apache servers with mod_python connected to the
Internet using round-robin DNS (Multiple ip addresses for one Host), In
theory a PC will do a DNS lookup and get the address of one of the
front-end, this PC will keep this address until the TTL makes it expire
in the DNS caches along the way, there is no problem since each session
will be served by the same front end.

But I need to find a way to get the session information into the MySQL
database in the backend server to enable central monitoring and inter
user communications etc. (think of a Messenger online userlist as an
example)

I can of course write stuff to maintain this sort of data in the MySQL
database but what if the session ends other than a user logging out
nicely (broken connection, browser close etc.)

It would be nice to have a MySQLsession object, an extra parameter could
be added like a MySQLdb cursor object, or am I wrong and are sessions
maintained by Apache (since modpython does not seem to keep track of
Session closing), or is there any way to "list" active sessions from
within modpython, so I can let the backend server send an http request
to the front-end and doing something like:
http://frontend1/getsessionlist which returns a comma separated list of
active session id's, so the stale session records in the database can be
removed.

I have been researching Session.py
Where I interestingly found:
(from def dbm_cleanup(data):)

If (time.time() - dict[_accessed]) > dict["_timeout]:
	old.append(key)
..
..
..
For key in old:
	Del db[key]

If I understand this right, this means that this is done to see if the
session is ended right? So It I alter Session.py I could make my own
MySQL Session right?

Would there be anyone else Interested in a MySQLSession object and what
do I need to take into account when modifying it?


Please feel free to comment on any of this,

Martijn Moeling

_______________________________________________
Mod_python mailing list
Mod_python@modpython.org
http://mailman.modpython.org/mailman/listinfo/mod_python

From martijn at xs4us.nu  Mon Nov 27 10:45:09 2006
From: martijn at xs4us.nu (Martijn Moeling)
Date: Mon Nov 27 10:45:48 2006
Subject: [mod_python] Programmatic Redirection in Frames
Message-ID: <B6C73A5E30565245BB6D32B5F5DF7A520BEDCF@sense.emmastraat.pijnacker>

Suren,

 

As far as I am aware this is not possible. Apache has absolutely no idea
about frames.

That is why I stopped using frames years ago.

 

On my current project I use absolute positioning and I am sending forms
using the XMLHTTPRequest object.

By doing so, the return from the server can be set to any object in
javascript, Google for XMLHTTPrequest, and do not get fooled by the XML
thingy in the name, you can send plain text or any format you like. Be
aware that if you want to be browser independent you run into trouble if
you use the <input=file...>.

 

Forms can have a target= too!!! Maybe you can alter all references to
the login page with a targe=_top.

 

I suggest you stop using frames

 

Martijn

 

 

________________________________

Van: mod_python-bounces@modpython.org
[mailto:mod_python-bounces@modpython.org] Namens Surendra Lingareddy
Verzonden: Monday, November 27, 2006 4:03 PM
Aan: mod_python@modpython.org
Onderwerp: [mod_python] Programmatic Redirection in Frames

 

I am using util.redirect() to redirect to a particular page when a user
takes an action. The action is submitted via a form and read the action
via the req.form.getfirst() thingy. If the session is ended, my
redirection to the login page does not take me to the top-level frame,
instead it puts it into a child frame. Is there a way where I can
specify programmatically to be redirected to the top level frame?

 

On a href call, it is easy as it takes target=_top but can I specify it
somehow on a req object?

 

Thanks,

Suren 

CONFIDENTIAL: This email, including its contents and attachments, if
any, are confidential. If the reader of this e-mail is not an intended
recipient, you have received this e-mail in error and any review,
dissemination, distribution or copying is strictly prohibited. If you
have received this e-mail in error, please notify the sender immediately
by return e-mail at [emailaddress@crossroads.com] and permanently delete
the copy you received. Copyright and other intellectual property rights
in its contents are the sole property of Crossroads Systems, Inc. Email
transmission cannot be guaranteed to be secure or error-free. The sender
therefore does not accept liability for any errors or omissions in the
contents of the message which arise as a result of email transmission.
Although we routinely screen for viruses, addressees should check this
email and any attachments for viruses. We make no representation or
warranty as to the absence of viruses in this email or any attachments. 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20061127/cd737daa/attachment.html
From derek.asleson at gmail.com  Mon Nov 27 11:04:10 2006
From: derek.asleson at gmail.com (Derek Asleson)
Date: Mon Nov 27 11:04:18 2006
Subject: [mod_python] Long URIs and Path Info
Message-ID: <6dda28010611270804l426d946fi4d4069fda4dee569@mail.gmail.com>

I've been trying to figure out how to make long URIs with mod_python for a
few days now. I don't want an extension (I've figured out how to have long
URIs with AddHandler, but this shows an extension), but I want my URIs
to/look/like/this. Here's more examples of the effect I am going for:

{index directory}/about/biography
{index directory}/blog/post/10-23-2007

I know I with publisher you can have this effect ({index directory}/about)
but I could not figure out how to add deeper URIs. Any ideas?

Regards,

d
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20061127/d2efeba1/attachment.html
From slingareddy at Crossroads.com  Mon Nov 27 11:00:49 2006
From: slingareddy at Crossroads.com (Surendra Lingareddy)
Date: Mon Nov 27 11:11:29 2006
Subject: [mod_python] Programmatic Redirection in Frames
Message-ID: <43F5E8AE07F17C47BC16F7A159E9E700D79FD5@mailnode1.commstor.crossroads.com>

Thanks for the answer. Fortunately my requirement I think is just to
kick it back to the login page on session expiry. So, login is the only
page that needs to break out of the frame (s)hell. I am forcing the
login page to always be on the top with a javascript. I will look into
what you suggested. 

 

Regards,

Suren

  _____  

From: Martijn Moeling [mailto:martijn@xs4us.nu] 
Sent: Monday, November 27, 2006 9:45 AM
To: Surendra Lingareddy; mod_python@modpython.org
Subject: RE: [mod_python] Programmatic Redirection in Frames

 

Suren,

 

As far as I am aware this is not possible. Apache has absolutely no idea
about frames.

That is why I stopped using frames years ago.

 

On my current project I use absolute positioning and I am sending forms
using the XMLHTTPRequest object.

By doing so, the return from the server can be set to any object in
javascript, Google for XMLHTTPrequest, and do not get fooled by the XML
thingy in the name, you can send plain text or any format you like. Be
aware that if you want to be browser independent you run into trouble if
you use the <input=file...>.

 

Forms can have a target= too!!! Maybe you can alter all references to
the login page with a targe=_top.

 

I suggest you stop using frames

 

Martijn

 

 

  _____  

Van: mod_python-bounces@modpython.org
[mailto:mod_python-bounces@modpython.org] Namens Surendra Lingareddy
Verzonden: Monday, November 27, 2006 4:03 PM
Aan: mod_python@modpython.org
Onderwerp: [mod_python] Programmatic Redirection in Frames

 

I am using util.redirect() to redirect to a particular page when a user
takes an action. The action is submitted via a form and read the action
via the req.form.getfirst() thingy. If the session is ended, my
redirection to the login page does not take me to the top-level frame,
instead it puts it into a child frame. Is there a way where I can
specify programmatically to be redirected to the top level frame?

 

On a href call, it is easy as it takes target=_top but can I specify it
somehow on a req object?

 

Thanks,

Suren 

CONFIDENTIAL: This email, including its contents and attachments, if
any, are confidential. If the reader of this e-mail is not an intended
recipient, you have received this e-mail in error and any review,
dissemination, distribution or copying is strictly prohibited. If you
have received this e-mail in error, please notify the sender immediately
by return e-mail at [emailaddress@crossroads.com] and permanently delete
the copy you received. Copyright and other intellectual property rights
in its contents are the sole property of Crossroads Systems, Inc. Email
transmission cannot be guaranteed to be secure or error-free. The sender
therefore does not accept liability for any errors or omissions in the
contents of the message which arise as a result of email transmission.
Although we routinely screen for viruses, addressees should check this
email and any attachments for viruses. We make no representation or
warranty as to the absence of viruses in this email or any attachments. 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20061127/2cb4b57d/attachment-0001.html
From downgrade at gmx.org  Mon Nov 27 11:39:10 2006
From: downgrade at gmx.org (Lars Eriksen)
Date: Mon Nov 27 11:39:07 2006
Subject: [mod_python] Programmatic Redirection in Frames
In-Reply-To: <43F5E8AE07F17C47BC16F7A159E9E700D79FD5@mailnode1.commstor.crossroads.com>
References: <43F5E8AE07F17C47BC16F7A159E9E700D79FD5@mailnode1.commstor.crossroads.com>
Message-ID: <456B14AE.8080208@gmx.org>

Yes, JS is the way to go. I personally prefer iFrames - they seem more 
lightweight (no seperate frameset page required).

Surendra Lingareddy wrote:
> Thanks for the answer. Fortunately my requirement I think is just to 
> kick it back to the login page on session expiry. So, login is the only 
> page that needs to break out of the frame (s)hell. I am forcing the 
> login page to always be on the top with a javascript. I will look into 
> what you suggested.
> 
>  
> 
> Regards,
> 
> Suren
> 
> ------------------------------------------------------------------------
> 
> *From:* Martijn Moeling [mailto:martijn@xs4us.nu]
> *Sent:* Monday, November 27, 2006 9:45 AM
> *To:* Surendra Lingareddy; mod_python@modpython.org
> *Subject:* RE: [mod_python] Programmatic Redirection in Frames
> 
>  
> 
> Suren,
> 
>  
> 
> As far as I am aware this is not possible. Apache has absolutely no idea 
> about frames.
> 
> That is why I stopped using frames years ago.
> 
>  
> 
> On my current project I use absolute positioning and I am sending forms 
> using the XMLHTTPRequest object.
> 
> By doing so, the return from the server can be set to any object in 
> javascript, Google for XMLHTTPrequest, and do not get fooled by the XML 
> thingy in the name, you can send plain text or any format you like. Be 
> aware that if you want to be browser independent you run into trouble if 
> you use the <input=file?>.
> 
>  
> 
> Forms can have a target= too!!! Maybe you can alter all references to 
> the login page with a targe=_top.
> 
>  
> 
> I suggest you stop using frames
> 
>  
> 
> Martijn
> 
>  
> 
>  
> 
> ------------------------------------------------------------------------
> 
> *Van:* mod_python-bounces@modpython.org 
> [mailto:mod_python-bounces@modpython.org] *Namens *Surendra Lingareddy
> *Verzonden:* Monday, November 27, 2006 4:03 PM
> *Aan:* mod_python@modpython.org
> *Onderwerp:* [mod_python] Programmatic Redirection in Frames
> 
>  
> 
> I am using util.redirect() to redirect to a particular page when a user 
> takes an action. The action is submitted via a form and read the action 
> via the req.form.getfirst() thingy. If the session is ended, my 
> redirection to the login page does not take me to the top-level frame, 
> instead it puts it into a child frame. Is there a way where I can 
> specify programmatically to be redirected to the top level frame?
> 
>  
> 
> On a href call, it is easy as it takes target=_top but can I specify it 
> somehow on a req object?
> 
>  
> 
> Thanks,
> 
> Suren
> 
> CONFIDENTIAL: This email, including its contents and attachments, if 
> any, are confidential. If the reader of this e-mail is not an intended 
> recipient, you have received this e-mail in error and any review, 
> dissemination, distribution or copying is strictly prohibited. If you 
> have received this e-mail in error, please notify the sender immediately 
> by return e-mail at [emailaddress@crossroads.com] and permanently delete 
> the copy you received. Copyright and other intellectual property rights 
> in its contents are the sole property of Crossroads Systems, Inc. Email 
> transmission cannot be guaranteed to be secure or error-free. The sender 
> therefore does not accept liability for any errors or omissions in the 
> contents of the message which arise as a result of email transmission. 
> Although we routinely screen for viruses, addressees should check this 
> email and any attachments for viruses. We make no representation or 
> warranty as to the absence of viruses in this email or any attachments.
> 
> 
> ------------------------------------------------------------------------
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python

From martijn at xs4us.nu  Mon Nov 27 11:59:22 2006
From: martijn at xs4us.nu (Martijn Moeling)
Date: Mon Nov 27 11:59:33 2006
Subject: [mod_python] Session Hell...
Message-ID: <B6C73A5E30565245BB6D32B5F5DF7A520BEDD1@sense.emmastraat.pijnacker>

Hi!

I do not think this has anything to do with your configuration but more
with a loop which does not exit. 

I just finished a new type of session which stores in a mysql database
(see my previous posts), so I am quit deep into sessions at the moment.
One of the great outcomes is that the session contents can be read with
any tool including phpmyadmin or within the modpython code.

I am now working on a online users list where I can follow the users
session parameters for debugging purposes.

Take a look at your loops first, what I do in such cases is add a lot of
reg.log_error(some_string_output,apache.APLOG_NOTICE) and then a "tail
-f /var/log/httpd/error_log" but since you are on XP you'll have to type
the error_log file. Or start the app in in debug mode from the
commandline...

Martijn

-----Oorspronkelijk bericht-----
Van: mod_python-bounces@modpython.org
[mailto:mod_python-bounces@modpython.org] Namens durumdara
Verzonden: Monday, November 27, 2006 4:01 PM
Aan: 'mod_python@modpython.org'
Onderwerp: [mod_python] Session Hell...

Hi !

I have a big problem. I've just finished my big site: this is a session 
based online shop.
But I'm get crazy...
When I want to control the number of elements (piece of the purcheasable

items), the site is move in dead state (httpd).

I use the Session to store the items, and the first phase I check this 
array, change it with the input params, revalidate it, and deepcopy it 
to the request.

This what I do for minimize the session-locking, and multithreading 
problems.

I need to save Session, because it's lifetime must increasing in every 
request.

Today I build a version that containing threading.Lock. In this way only

ONE request worked, next request are go to hell...

What is this problem?
Anyone knows about a session problems in WXP, Py2.2.4, ModPy3.2.10, 
Apache2.2.3?

I need to repair my site, the next day I need to demonstrate to it is 
working good... :-((((

Thanks for any idea that can help me:
  dd

_______________________________________________
Mod_python mailing list
Mod_python@modpython.org
http://mailman.modpython.org/mailman/listinfo/mod_python

From steve at holdenweb.com  Mon Nov 27 12:41:16 2006
From: steve at holdenweb.com (Steve Holden)
Date: Mon Nov 27 12:40:56 2006
Subject: [mod_python] Re: Session Hell...
In-Reply-To: <B6C73A5E30565245BB6D32B5F5DF7A520BEDD1@sense.emmastraat.pijnacker>
References: <B6C73A5E30565245BB6D32B5F5DF7A520BEDD1@sense.emmastraat.pijnacker>
Message-ID: <ekf7td$js0$1@sea.gmane.org>

Martijn Moeling wrote:
> Hi!
> 
> I do not think this has anything to do with your configuration but more
> with a loop which does not exit. 
> 
> I just finished a new type of session which stores in a mysql database
> (see my previous posts), so I am quit deep into sessions at the moment.
> One of the great outcomes is that the session contents can be read with
> any tool including phpmyadmin or within the modpython code.
> 
> I am now working on a online users list where I can follow the users
> session parameters for debugging purposes.
> 
> Take a look at your loops first, what I do in such cases is add a lot of
> reg.log_error(some_string_output,apache.APLOG_NOTICE) and then a "tail
> -f /var/log/httpd/error_log" but since you are on XP you'll have to type
> the error_log file. Or start the app in in debug mode from the
> commandline...
> 
Or use Cygwin, in which tail -f is available.

regards
  Steve
-- 
Steve Holden       +44 150 684 7255  +1 800 494 3119
Holden Web LLC/Ltd          http://www.holdenweb.com
Skype: holdenweb       http://holdenweb.blogspot.com
Recent Ramblings     http://del.icio.us/steve.holden

From grahamd at dscpl.com.au  Mon Nov 27 16:03:55 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Mon Nov 27 16:04:09 2006
Subject: [mod_python] MySQLSession available!!
Message-ID: <1164661435.14394@dscpl.user.openhosting.com>

Database backed session classes have been discussed before on the mailing
list with examples posted. Use the search box on the mod_python web site to
search for the past posts. For example:

  http://www.modpython.org/pipermail/mod_python/2006-June/021433.html

There is no need for you to embed your session class within the mod_python
Session.py code file. Keep it separate. Database backed session classes are
unlikely to be included in mod_python as that then imposes a dependency on
a third party package which isn't something we really want to have to have
because of maintenance/support issues.

Graham

Martijn Moeling wrote ..
> Well after investigating "sessions.py" a bit more I have come up with a
> working MySQLSession object added to "sessions.py"
> 
> See code (only the changed parts) below....
> 
> The nasty thing is that it will be overwritten by any mod_python
> updates, or if it is interesting enough (hopefully) it gets into the
> next major mod_python release.
> 
> By checking for the req.cursor, there is no need for importing MySQLdb
> into session.py
> 
> See code (only the changed parts) below....
> 
> 8<---------------------------------------------------------------------
> ########################################################################
> ###
> ## MySQLSession
> ## M. Moeling, martijn@xs4us.nu
> ##
> ## In order to use MySQLSession:
> ## in your handler.py:        
> ## import MySQLdb
> ##
> ##  Somewhere before the session stuff use:
> ##
> ##  req.db =
> MySQLdb.connect(host=Chost,user=Cuser,passwd=Cpasswd,db=Cdb)
> ##  req.cursor = req.db.cursor()
> ## 
> ##  When req.cursor is existing, Session.py will default to MySQLSession
> ##  Can be overruled with pythonoptions in apache config
> ##
> ## To create table in MySQL use the following:
> ## CREATE TABLE `Session` (
> ##  `sid` varchar(50) NOT NULL,
> ##  `store` text NOT NULL,
> ##  PRIMARY KEY  (`sid`)
> ## ) TYPE=MyISAM;
>         
> def mysql_cleanup(req):
>     req.cursor.execute("Select * from Session")
>     AllSessions = req.cursor.fetchall()
>     for records in AllSessions:
>         session = cPicle.loads(record[1])
>         if (time.time() - session["_accessed"]) > session["_timeout"]:
>             req.cursor.execute("DELETE FROM Session where
> sid='"+session[0]+"'")        
> 
>         
> class MySQLSession(BaseSession):
> 
>     def __init__(self, req, sid=0, secret=None, timeout=0, lock=1):
> 
>         BaseSession.__init__(self, req, sid=sid, secret=secret,
>                              timeout=timeout, lock=lock)
> 
>     def do_cleanup(self):
>         self._req.register_cleanup(MySQL_cleanup, self._req)
>         self._req.log_error("MySQLSession: registered session cleanup.",
>                             apache.APLOG_NOTICE)
> 
>     def do_load(self):
>         self._req.cursor.execute("Select store from Session where
> sid='"+self._sid+"'")
>         store=self._req.cursor.fetchone()
>         if self._req.cursor.rowcount==1:
>             return cPickle.loads(store[0])
>         return None
> 
>     def do_save(self, dict):
>         self._req.cursor.execute("Select store from Session where
> sid='"+self._sid+"'")
>         store=self._req.cursor.fetchone()
>         if self._req.cursor.rowcount==1:
>             Query="Update Session set store=\""+cPickle.dumps(dict)+"\"
> where sid='"+self._sid+"'"
>         else:
>             Query="Insert into Session (sid,store) values
> (\""+self._sid+"\",\""+cPickle.dumps(dict)+"\")"           
>          self._req.cursor.execute(Query)
>         
>     def do_delete(self):
>         try:
>             self._req.cursor.execute("DELETE FROM Session where
> sid='"+self._sid+"'")
>         except:
>             pass
> 
> 
> ########################################################################
> ###
> ## Session
> 
> ## Changes made for MySQLSession
> ## the application should set req.cursor as an MySQLdb cursor object
> 
> 
> def Session(req, sid=0, secret=None, timeout=0, lock=1):
> 
>     opts = req.get_options()
>     if opts.has_key('session'):
>         # Check the apache config for the type of session
>         sess_type = opts['session']
>     else:
>         ## MySQLSession is default when req.cursor exists
>         if req.cursor:
>             sess_type = 'MySQLSession'
>         else:
>         ## END of MySQLSession modification
>             # no session class in config so get the default for the
> platform
>             threaded = _apache.mpm_query(apache.AP_MPMQ_IS_THREADED)
>             forked = _apache.mpm_query(apache.AP_MPMQ_IS_FORKED)
>             daemons =  _apache.mpm_query(apache.AP_MPMQ_MAX_DAEMONS)
>             if (threaded and ((not forked) or (daemons == 1))):
>                 sess_type = 'MemorySession'
>             else:
>                 sess_type = 'DbmSession'
> 
>     if sess_type == 'FileSession':
>         sess =  FileSession
>     elif sess_type == 'DbmSession':
>         sess = DbmSession
>     elif sess_type == 'MemorySession':
>         sess = MemorySession
>     ## Added for MySQLSession
>     elif sess_type == 'MySQLSession':
>         sess = MySQLSession
>     else:
>         # TODO Add capability to load a user defined class
>         # For now, just raise an exception.
>         raise Exception, 'Unknown session type %s' % sess_type
> 
>     return sess(req, sid=sid, secret=secret,
>                          timeout=timeout, lock=lock)
> 8<---------------------------------------------------------------------
> 
> -----Oorspronkelijk bericht-----
> Van: mod_python-bounces@modpython.org
> [mailto:mod_python-bounces@modpython.org] Namens Martijn Moeling
> Verzonden: Monday, November 27, 2006 12:08 PM
> Aan: mod_python@modpython.org
> Onderwerp: [mod_python] Session Storage : memory, file, dbm....Mysql?
> 
> Hi,
> 
> I am building an application framework (yes!) with very specific needs.
> One of the main problems I run into is session management, I'll explain:
> 
> My application (Running on Fedora) Is prepared for multiple front-end
> servers communicating on an Internal backbone to a database server.
> Think of it as some sort of web based Citrix able to run on all browsers
> without the need of client-side software installation. Fully
> programmable in python (even the front-end) and if the time gets there
> even Visual. So build a browser based application within an application
> with central storage and management. Mod Python is used to implement a
> part of an OS if you wish to call it that way.
> 
> The front ends will be Apache servers with mod_python connected to the
> Internet using round-robin DNS (Multiple ip addresses for one Host), In
> theory a PC will do a DNS lookup and get the address of one of the
> front-end, this PC will keep this address until the TTL makes it expire
> in the DNS caches along the way, there is no problem since each session
> will be served by the same front end.
> 
> But I need to find a way to get the session information into the MySQL
> database in the backend server to enable central monitoring and inter
> user communications etc. (think of a Messenger online userlist as an
> example)
> 
> I can of course write stuff to maintain this sort of data in the MySQL
> database but what if the session ends other than a user logging out
> nicely (broken connection, browser close etc.)
> 
> It would be nice to have a MySQLsession object, an extra parameter could
> be added like a MySQLdb cursor object, or am I wrong and are sessions
> maintained by Apache (since modpython does not seem to keep track of
> Session closing), or is there any way to "list" active sessions from
> within modpython, so I can let the backend server send an http request
> to the front-end and doing something like:
> http://frontend1/getsessionlist which returns a comma separated list of
> active session id's, so the stale session records in the database can be
> removed.
> 
> I have been researching Session.py
> Where I interestingly found:
> (from def dbm_cleanup(data):)
> 
> If (time.time() - dict[_accessed]) > dict["_timeout]:
> 	old.append(key)
> ..
> ..
> ..
> For key in old:
> 	Del db[key]
> 
> If I understand this right, this means that this is done to see if the
> session is ended right? So It I alter Session.py I could make my own
> MySQL Session right?
> 
> Would there be anyone else Interested in a MySQLSession object and what
> do I need to take into account when modifying it?
> 
> 
> Please feel free to comment on any of this,
> 
> Martijn Moeling
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
From grahamd at dscpl.com.au  Mon Nov 27 16:12:08 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Mon Nov 27 16:12:11 2006
Subject: [mod_python] Long URIs and Path Info
Message-ID: <1164661928.18800@dscpl.user.openhosting.com>

Derek Asleson wrote ..
> I've been trying to figure out how to make long URIs with mod_python for
> a
> few days now. I don't want an extension (I've figured out how to have long
> URIs with AddHandler, but this shows an extension), but I want my URIs
> to/look/like/this. Here's more examples of the effect I am going for:
> 
> {index directory}/about/biography
> {index directory}/blog/post/10-23-2007
> 
> I know I with publisher you can have this effect ({index directory}/about)
> but I could not figure out how to add deeper URIs. Any ideas?

Are you using your own mod_python handler or are you using publisher?
What you are using in part dictates what you can do.

Even when using AddHandler, it is possible to avoid the need for an
extension in the URI if you set Apache up correctly for use of MultiViews.
Some details are contained in:

  http://www.dscpl.com.au/wiki/ModPython/Articles/SetHandlerVersusAddHandler

This can apply to publisher but also custom handlers.

If using publisher, one can use a trick to allow additional path information
to be processed using special wrapper classes around published functions.
I posted about this on the mailing list a long time back. I haven't read
through the post again and assume it is still valid, although more than
likely I am sure to do it a different way these days. See:

  http://www.modpython.org/pipermail/mod_python/2005-March/017560.html

Graham
From martijn at xs4us.nu  Mon Nov 27 16:38:02 2006
From: martijn at xs4us.nu (Martijn Moeling)
Date: Mon Nov 27 16:38:07 2006
Subject: [mod_python] MySQLSession available!! errata
Message-ID: <B6C73A5E30565245BB6D32B5F5DF7A520BEDD6@sense.emmastraat.pijnacker>



def mysql_cleanup(req): 
should be 
def MySQL_cleanup(req):


can Multiple cleanups be registered? Modpython doc is not clear on that,
and how about the order of processing,
My handler registers a cleanup for closing the Db.
This cleanup is "added".

-----Oorspronkelijk bericht-----
Van: mod_python-bounces@modpython.org
[mailto:mod_python-bounces@modpython.org] Namens Martijn Moeling
Verzonden: Monday, November 27, 2006 16:09
Aan: mod_python@modpython.org
Onderwerp: [mod_python] MySQLSession available!!

Well after investigating "sessions.py" a bit more I have come up with a
working MySQLSession object added to "sessions.py"

See code (only the changed parts) below....

The nasty thing is that it will be overwritten by any mod_python
updates, or if it is interesting enough (hopefully) it gets into the
next major mod_python release.

By checking for the req.cursor, there is no need for importing MySQLdb
into session.py

See code (only the changed parts) below....

8<---------------------------------------------------------------------
########################################################################
###
## MySQLSession
## M. Moeling, martijn@xs4us.nu
##
## In order to use MySQLSession:
## in your handler.py:        
## import MySQLdb
##
##  Somewhere before the session stuff use:
##
##  req.db =
MySQLdb.connect(host=Chost,user=Cuser,passwd=Cpasswd,db=Cdb)
##  req.cursor = req.db.cursor()
## 
##  When req.cursor is existing, Session.py will default to MySQLSession
##  Can be overruled with pythonoptions in apache config
##
## To create table in MySQL use the following:
## CREATE TABLE `Session` (
##  `sid` varchar(50) NOT NULL,
##  `store` text NOT NULL,
##  PRIMARY KEY  (`sid`)
## ) TYPE=MyISAM;
        
def mysql_cleanup(req):
    req.cursor.execute("Select * from Session")
    AllSessions = req.cursor.fetchall()
    for records in AllSessions:
        session = cPicle.loads(record[1])
        if (time.time() - session["_accessed"]) > session["_timeout"]:
            req.cursor.execute("DELETE FROM Session where
sid='"+session[0]+"'")        

        
class MySQLSession(BaseSession):

    def __init__(self, req, sid=0, secret=None, timeout=0, lock=1):

        BaseSession.__init__(self, req, sid=sid, secret=secret,
                             timeout=timeout, lock=lock)

    def do_cleanup(self):
        self._req.register_cleanup(MySQL_cleanup, self._req)
        self._req.log_error("MySQLSession: registered session cleanup.",
                            apache.APLOG_NOTICE)

    def do_load(self):
        self._req.cursor.execute("Select store from Session where
sid='"+self._sid+"'")
        store=self._req.cursor.fetchone()
        if self._req.cursor.rowcount==1:
            return cPickle.loads(store[0])
        return None

    def do_save(self, dict):
        self._req.cursor.execute("Select store from Session where
sid='"+self._sid+"'")
        store=self._req.cursor.fetchone()
        if self._req.cursor.rowcount==1:
            Query="Update Session set store=\""+cPickle.dumps(dict)+"\"
where sid='"+self._sid+"'"
        else:
            Query="Insert into Session (sid,store) values
(\""+self._sid+"\",\""+cPickle.dumps(dict)+"\")"           
         self._req.cursor.execute(Query)
        
    def do_delete(self):
        try:
            self._req.cursor.execute("DELETE FROM Session where
sid='"+self._sid+"'")
        except:
            pass


########################################################################
###
## Session

## Changes made for MySQLSession
## the application should set req.cursor as an MySQLdb cursor object


def Session(req, sid=0, secret=None, timeout=0, lock=1):

    opts = req.get_options()
    if opts.has_key('session'):
        # Check the apache config for the type of session
        sess_type = opts['session']
    else:
        ## MySQLSession is default when req.cursor exists
        if req.cursor:
            sess_type = 'MySQLSession'
        else:
        ## END of MySQLSession modification
            # no session class in config so get the default for the
platform
            threaded = _apache.mpm_query(apache.AP_MPMQ_IS_THREADED)
            forked = _apache.mpm_query(apache.AP_MPMQ_IS_FORKED)
            daemons =  _apache.mpm_query(apache.AP_MPMQ_MAX_DAEMONS)
            if (threaded and ((not forked) or (daemons == 1))):
                sess_type = 'MemorySession'
            else:
                sess_type = 'DbmSession'

    if sess_type == 'FileSession':
        sess =  FileSession
    elif sess_type == 'DbmSession':
        sess = DbmSession
    elif sess_type == 'MemorySession':
        sess = MemorySession
    ## Added for MySQLSession
    elif sess_type == 'MySQLSession':
        sess = MySQLSession
    else:
        # TODO Add capability to load a user defined class
        # For now, just raise an exception.
        raise Exception, 'Unknown session type %s' % sess_type

    return sess(req, sid=sid, secret=secret,
                         timeout=timeout, lock=lock)
8<---------------------------------------------------------------------

-----Oorspronkelijk bericht-----
Van: mod_python-bounces@modpython.org
[mailto:mod_python-bounces@modpython.org] Namens Martijn Moeling
Verzonden: Monday, November 27, 2006 12:08 PM
Aan: mod_python@modpython.org
Onderwerp: [mod_python] Session Storage : memory, file, dbm....Mysql?

Hi,

I am building an application framework (yes!) with very specific needs.
One of the main problems I run into is session management, I'll explain:

My application (Running on Fedora) Is prepared for multiple front-end
servers communicating on an Internal backbone to a database server.
Think of it as some sort of web based Citrix able to run on all browsers
without the need of client-side software installation. Fully
programmable in python (even the front-end) and if the time gets there
even Visual. So build a browser based application within an application
with central storage and management. Mod Python is used to implement a
part of an OS if you wish to call it that way.

The front ends will be Apache servers with mod_python connected to the
Internet using round-robin DNS (Multiple ip addresses for one Host), In
theory a PC will do a DNS lookup and get the address of one of the
front-end, this PC will keep this address until the TTL makes it expire
in the DNS caches along the way, there is no problem since each session
will be served by the same front end.

But I need to find a way to get the session information into the MySQL
database in the backend server to enable central monitoring and inter
user communications etc. (think of a Messenger online userlist as an
example)

I can of course write stuff to maintain this sort of data in the MySQL
database but what if the session ends other than a user logging out
nicely (broken connection, browser close etc.)

It would be nice to have a MySQLsession object, an extra parameter could
be added like a MySQLdb cursor object, or am I wrong and are sessions
maintained by Apache (since modpython does not seem to keep track of
Session closing), or is there any way to "list" active sessions from
within modpython, so I can let the backend server send an http request
to the front-end and doing something like:
http://frontend1/getsessionlist which returns a comma separated list of
active session id's, so the stale session records in the database can be
removed.

I have been researching Session.py
Where I interestingly found:
(from def dbm_cleanup(data):)

If (time.time() - dict[_accessed]) > dict["_timeout]:
	old.append(key)
..
..
..
For key in old:
	Del db[key]

If I understand this right, this means that this is done to see if the
session is ended right? So It I alter Session.py I could make my own
MySQL Session right?

Would there be anyone else Interested in a MySQLSession object and what
do I need to take into account when modifying it?


Please feel free to comment on any of this,

Martijn Moeling

_______________________________________________
Mod_python mailing list
Mod_python@modpython.org
http://mailman.modpython.org/mailman/listinfo/mod_python

_______________________________________________
Mod_python mailing list
Mod_python@modpython.org
http://mailman.modpython.org/mailman/listinfo/mod_python

From grahamd at dscpl.com.au  Mon Nov 27 16:46:35 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Mon Nov 27 16:46:38 2006
Subject: [mod_python] MySQLSession available!! errata
Message-ID: <1164663995.2258@dscpl.user.openhosting.com>

Martijn Moeling wrote ..
> 
> 
> def mysql_cleanup(req): 
> should be 
> def MySQL_cleanup(req):
> 
> 
> can Multiple cleanups be registered? Modpython doc is not clear on that,
> and how about the order of processing,

Yes, multiple cleanup handlers for a request can be registered. I would
guess that they are called in reverse order that they are registered.

Graham

> My handler registers a cleanup for closing the Db.
> This cleanup is "added".
> 
> -----Oorspronkelijk bericht-----
> Van: mod_python-bounces@modpython.org
> [mailto:mod_python-bounces@modpython.org] Namens Martijn Moeling
> Verzonden: Monday, November 27, 2006 16:09
> Aan: mod_python@modpython.org
> Onderwerp: [mod_python] MySQLSession available!!
> 
> Well after investigating "sessions.py" a bit more I have come up with a
> working MySQLSession object added to "sessions.py"
> 
> See code (only the changed parts) below....
> 
> The nasty thing is that it will be overwritten by any mod_python
> updates, or if it is interesting enough (hopefully) it gets into the
> next major mod_python release.
> 
> By checking for the req.cursor, there is no need for importing MySQLdb
> into session.py
> 
> See code (only the changed parts) below....
> 
> 8<---------------------------------------------------------------------
> ########################################################################
> ###
> ## MySQLSession
> ## M. Moeling, martijn@xs4us.nu
> ##
> ## In order to use MySQLSession:
> ## in your handler.py:        
> ## import MySQLdb
> ##
> ##  Somewhere before the session stuff use:
> ##
> ##  req.db =
> MySQLdb.connect(host=Chost,user=Cuser,passwd=Cpasswd,db=Cdb)
> ##  req.cursor = req.db.cursor()
> ## 
> ##  When req.cursor is existing, Session.py will default to MySQLSession
> ##  Can be overruled with pythonoptions in apache config
> ##
> ## To create table in MySQL use the following:
> ## CREATE TABLE `Session` (
> ##  `sid` varchar(50) NOT NULL,
> ##  `store` text NOT NULL,
> ##  PRIMARY KEY  (`sid`)
> ## ) TYPE=MyISAM;
>         
> def mysql_cleanup(req):
>     req.cursor.execute("Select * from Session")
>     AllSessions = req.cursor.fetchall()
>     for records in AllSessions:
>         session = cPicle.loads(record[1])
>         if (time.time() - session["_accessed"]) > session["_timeout"]:
>             req.cursor.execute("DELETE FROM Session where
> sid='"+session[0]+"'")        
> 
>         
> class MySQLSession(BaseSession):
> 
>     def __init__(self, req, sid=0, secret=None, timeout=0, lock=1):
> 
>         BaseSession.__init__(self, req, sid=sid, secret=secret,
>                              timeout=timeout, lock=lock)
> 
>     def do_cleanup(self):
>         self._req.register_cleanup(MySQL_cleanup, self._req)
>         self._req.log_error("MySQLSession: registered session cleanup.",
>                             apache.APLOG_NOTICE)
> 
>     def do_load(self):
>         self._req.cursor.execute("Select store from Session where
> sid='"+self._sid+"'")
>         store=self._req.cursor.fetchone()
>         if self._req.cursor.rowcount==1:
>             return cPickle.loads(store[0])
>         return None
> 
>     def do_save(self, dict):
>         self._req.cursor.execute("Select store from Session where
> sid='"+self._sid+"'")
>         store=self._req.cursor.fetchone()
>         if self._req.cursor.rowcount==1:
>             Query="Update Session set store=\""+cPickle.dumps(dict)+"\"
> where sid='"+self._sid+"'"
>         else:
>             Query="Insert into Session (sid,store) values
> (\""+self._sid+"\",\""+cPickle.dumps(dict)+"\")"           
>          self._req.cursor.execute(Query)
>         
>     def do_delete(self):
>         try:
>             self._req.cursor.execute("DELETE FROM Session where
> sid='"+self._sid+"'")
>         except:
>             pass
> 
> 
> ########################################################################
> ###
> ## Session
> 
> ## Changes made for MySQLSession
> ## the application should set req.cursor as an MySQLdb cursor object
> 
> 
> def Session(req, sid=0, secret=None, timeout=0, lock=1):
> 
>     opts = req.get_options()
>     if opts.has_key('session'):
>         # Check the apache config for the type of session
>         sess_type = opts['session']
>     else:
>         ## MySQLSession is default when req.cursor exists
>         if req.cursor:
>             sess_type = 'MySQLSession'
>         else:
>         ## END of MySQLSession modification
>             # no session class in config so get the default for the
> platform
>             threaded = _apache.mpm_query(apache.AP_MPMQ_IS_THREADED)
>             forked = _apache.mpm_query(apache.AP_MPMQ_IS_FORKED)
>             daemons =  _apache.mpm_query(apache.AP_MPMQ_MAX_DAEMONS)
>             if (threaded and ((not forked) or (daemons == 1))):
>                 sess_type = 'MemorySession'
>             else:
>                 sess_type = 'DbmSession'
> 
>     if sess_type == 'FileSession':
>         sess =  FileSession
>     elif sess_type == 'DbmSession':
>         sess = DbmSession
>     elif sess_type == 'MemorySession':
>         sess = MemorySession
>     ## Added for MySQLSession
>     elif sess_type == 'MySQLSession':
>         sess = MySQLSession
>     else:
>         # TODO Add capability to load a user defined class
>         # For now, just raise an exception.
>         raise Exception, 'Unknown session type %s' % sess_type
> 
>     return sess(req, sid=sid, secret=secret,
>                          timeout=timeout, lock=lock)
> 8<---------------------------------------------------------------------
> 
> -----Oorspronkelijk bericht-----
> Van: mod_python-bounces@modpython.org
> [mailto:mod_python-bounces@modpython.org] Namens Martijn Moeling
> Verzonden: Monday, November 27, 2006 12:08 PM
> Aan: mod_python@modpython.org
> Onderwerp: [mod_python] Session Storage : memory, file, dbm....Mysql?
> 
> Hi,
> 
> I am building an application framework (yes!) with very specific needs.
> One of the main problems I run into is session management, I'll explain:
> 
> My application (Running on Fedora) Is prepared for multiple front-end
> servers communicating on an Internal backbone to a database server.
> Think of it as some sort of web based Citrix able to run on all browsers
> without the need of client-side software installation. Fully
> programmable in python (even the front-end) and if the time gets there
> even Visual. So build a browser based application within an application
> with central storage and management. Mod Python is used to implement a
> part of an OS if you wish to call it that way.
> 
> The front ends will be Apache servers with mod_python connected to the
> Internet using round-robin DNS (Multiple ip addresses for one Host), In
> theory a PC will do a DNS lookup and get the address of one of the
> front-end, this PC will keep this address until the TTL makes it expire
> in the DNS caches along the way, there is no problem since each session
> will be served by the same front end.
> 
> But I need to find a way to get the session information into the MySQL
> database in the backend server to enable central monitoring and inter
> user communications etc. (think of a Messenger online userlist as an
> example)
> 
> I can of course write stuff to maintain this sort of data in the MySQL
> database but what if the session ends other than a user logging out
> nicely (broken connection, browser close etc.)
> 
> It would be nice to have a MySQLsession object, an extra parameter could
> be added like a MySQLdb cursor object, or am I wrong and are sessions
> maintained by Apache (since modpython does not seem to keep track of
> Session closing), or is there any way to "list" active sessions from
> within modpython, so I can let the backend server send an http request
> to the front-end and doing something like:
> http://frontend1/getsessionlist which returns a comma separated list of
> active session id's, so the stale session records in the database can be
> removed.
> 
> I have been researching Session.py
> Where I interestingly found:
> (from def dbm_cleanup(data):)
> 
> If (time.time() - dict[_accessed]) > dict["_timeout]:
> 	old.append(key)
> ..
> ..
> ..
> For key in old:
> 	Del db[key]
> 
> If I understand this right, this means that this is done to see if the
> session is ended right? So It I alter Session.py I could make my own
> MySQL Session right?
> 
> Would there be anyone else Interested in a MySQLSession object and what
> do I need to take into account when modifying it?
> 
> 
> Please feel free to comment on any of this,
> 
> Martijn Moeling
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
> 
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
From grahamd at dscpl.com.au  Mon Nov 27 17:03:01 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Mon Nov 27 17:03:04 2006
Subject: [mod_python] Wiki for mod_python. Contributors welcome.
Message-ID: <1164664981.11585@dscpl.user.openhosting.com>

Sean Davis wrote ..
> On Monday 27 November 2006 16:03, Graham Dumpleton wrote:
> > Database backed session classes have been discussed before on the mailing
> > list with examples posted. Use the search box on the mod_python web site
> to
> > search for the past posts. For example:
> >
> >   http://www.modpython.org/pipermail/mod_python/2006-June/021433.html
> >
> > There is no need for you to embed your session class within the mod_python
> > Session.py code file. Keep it separate. Database backed session classes
> are
> > unlikely to be included in mod_python as that then imposes a dependency
> on
> > a third party package which isn't something we really want to have to
> have
> > because of maintenance/support issues.
> 
> Graham,
> 
> This is a good sentiment.  But, does it make some sense to have a spot
> on the 
> wiki for code devoted to things like this?  Session handling can be 
> approached many ways, so it might be useful to have code examples hosted
> more 
> formally than simply via the email archive.  Also, one could envision a
> generic handlers section, a persistent objects section, etc.  All of these
> have been discussed relatively recently; wouldn't it be nice to say "put
> in 
> on the wiki" or "refer to the wiki" when these come up?
> 
> I'm asking off-list just because I imagine that you have an opinion on
> this 
> already, but I wasn't sure.

I am replying back on the mailing list as I think the answer is important
enough that everyone knows it.

That is that I am more than happy to see people contribute to the community
based mod_python wiki, and that means anyone. Personally I am quite flat out as
it is and taking on additional responsibility of trying to look after that wiki
or contribute to it is just more than I can handle. My lack of time at present is
already delaying the next version of mod_python as it is.

So, for anyone who doesn't know, there is a mod_python wiki available at:

  http://wiki.apache.org/mod_python/

Anyone can create an account and contribute to this wiki. It is not restricted
to just those who do code development on mod_python itself. I would love to see
a few people at least take it on board to try and develop the wiki further than
it is and collect material from the mailing lists and elsewhere and add it to
the wiki so there is a central repository for such contributed stuff.

At the moment the only person doing stuff with the wiki is Deron Meranda and I
am sure he wouldn't mind some help. If people do start adding stuff, then I'd
have no problem with occasionally casting an eye over it and commenting on or
fixing anything which I think might be wrong. When it comes though to setting
up the structure and getting stuff into it though, that is where I don't have time.

Graham
From jpg at jgassociates.ca  Mon Nov 27 17:26:17 2006
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Mon Nov 27 17:26:04 2006
Subject: [mod_python] MySQLSession available!! errata
In-Reply-To: <B6C73A5E30565245BB6D32B5F5DF7A520BEDD6@sense.emmastraat.pijnacker>
References: <B6C73A5E30565245BB6D32B5F5DF7A520BEDD6@sense.emmastraat.pijnacker>
Message-ID: <456B6609.9030904@jgassociates.ca>

Martijn Moeling wrote:
> 
> def mysql_cleanup(req): 
> should be 
> def MySQL_cleanup(req):
> 
> 
> can Multiple cleanups be registered? Modpython doc is not clear on that,
> and how about the order of processing,
> My handler registers a cleanup for closing the Db.
> This cleanup is "added".
> 
> -----Oorspronkelijk bericht-----
> Van: mod_python-bounces@modpython.org
> [mailto:mod_python-bounces@modpython.org] Namens Martijn Moeling
> Verzonden: Monday, November 27, 2006 16:09
> Aan: mod_python@modpython.org
> Onderwerp: [mod_python] MySQLSession available!!
> 
> Well after investigating "sessions.py" a bit more I have come up with a
> working MySQLSession object added to "sessions.py"
> 
> See code (only the changed parts) below....
> 
> The nasty thing is that it will be overwritten by any mod_python
> updates, or if it is interesting enough (hopefully) it gets into the
> next major mod_python release.
> 
> By checking for the req.cursor, there is no need for importing MySQLdb
> into session.py
> 
> See code (only the changed parts) below....
> 
> 8<---------------------------------------------------------------------
> ########################################################################
> ###
> ## MySQLSession
> ## M. Moeling, martijn@xs4us.nu
> ##
> ## In order to use MySQLSession:
> ## in your handler.py:        
> ## import MySQLdb
> ##
> ##  Somewhere before the session stuff use:
> ##
> ##  req.db =
> MySQLdb.connect(host=Chost,user=Cuser,passwd=Cpasswd,db=Cdb)
> ##  req.cursor = req.db.cursor()
> ## 
> ##  When req.cursor is existing, Session.py will default to MySQLSession
> ##  Can be overruled with pythonoptions in apache config
> ##
> ## To create table in MySQL use the following:
> ## CREATE TABLE `Session` (
> ##  `sid` varchar(50) NOT NULL,
> ##  `store` text NOT NULL,
> ##  PRIMARY KEY  (`sid`)
> ## ) TYPE=MyISAM;
>         
> def mysql_cleanup(req):
>     req.cursor.execute("Select * from Session")
>     AllSessions = req.cursor.fetchall()
>     for records in AllSessions:
>         session = cPicle.loads(record[1])
                     ^^^^^^
                     bug :(

>         if (time.time() - session["_accessed"]) > session["_timeout"]:
>             req.cursor.execute("DELETE FROM Session where
> sid='"+session[0]+"'")        


You might want to have separate fields for accessed and timeout in your 
table. That way you can do the cleanup with a single DELETE query. 
Unpickling *all* of the sessions just to read _accessed and _timeout can 
be are real performance killer if you have a lot of rows or the site is 
under heavy load. This one of the bottlenecks in DbmSession, but it is 
easily avoided with a sql database.

Jim
From mrlobster99 at gmail.com  Mon Nov 27 23:38:48 2006
From: mrlobster99 at gmail.com (Erik Thompson)
Date: Mon Nov 27 23:38:51 2006
Subject: [SPAM] Re: [mod_python] Wiki for mod_python. Contributors welcome.
In-Reply-To: <1164664981.11585@dscpl.user.openhosting.com>
References: <1164664981.11585@dscpl.user.openhosting.com>
Message-ID: <58d7d2590611272038h4a6dd0e6idedf1b8bc69d0d4e@mail.gmail.com>

>
> > This is a good sentiment.  But, does it make some sense to have a spot
> > on the
> > wiki for code devoted to things like this?  Session handling can be
> > approached many ways, so it might be useful to have code examples hosted
> > more
> > formally than simply via the email archive.  Also, one could envision a
> > generic handlers section, a persistent objects section, etc.  All of
> these
> > have been discussed relatively recently; wouldn't it be nice to say "put
> > in
> > on the wiki" or "refer to the wiki" when these come up?
> >
>
>
I took the liberty of adding a sample code page to the wiki and a PSP
example I wrote recently when I was attempting to learn the correct syntax
for using session and form variables.  Feel free to review, modify, delete,
or whatever =).  I'd personally love to see more examples of PSP and
mod_python to help myself and others learn.

http://wiki.apache.org/mod_python/
http://wiki.apache.org/mod_python/SampleCode
http://wiki.apache.org/mod_python/GuessingGame

Cheers,
Erik
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20061127/a629b156/attachment.html
From grahamd at dscpl.com.au  Mon Nov 27 23:59:56 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Tue Nov 28 00:00:00 2006
Subject: [mod_python] Wiki for mod_python. Contributors welcome.
Message-ID: <1164689996.22288@dscpl.user.openhosting.com>

Erik Thompson wrote ..
> >
> > > This is a good sentiment.  But, does it make some sense to have a spot
> > > on the
> > > wiki for code devoted to things like this?  Session handling can be
> > > approached many ways, so it might be useful to have code examples hosted
> > > more
> > > formally than simply via the email archive.  Also, one could envision
> a
> > > generic handlers section, a persistent objects section, etc.  All of
> > these
> > > have been discussed relatively recently; wouldn't it be nice to say
> "put
> > > in
> > > on the wiki" or "refer to the wiki" when these come up?
> > >
> >
> >
> I took the liberty of adding a sample code page to the wiki and a PSP
> example I wrote recently when I was attempting to learn the correct syntax
> for using session and form variables.  Feel free to review, modify, delete,
> or whatever =).  I'd personally love to see more examples of PSP and
> mod_python to help myself and others learn.
> 
> http://wiki.apache.org/mod_python/
> http://wiki.apache.org/mod_python/SampleCode
> http://wiki.apache.org/mod_python/GuessingGame

Thanks for getting the ball rolling.

BTW, you do not need to create a Session class instance in a PSP page
explicitly. It is enough to reference the 'session' variable and the underlying
PSP handler will create the Session class instance for you, it being
available through that same 'session' variable.

So, you should be able to delete:

  s = Session.Session(req)

and then instead of using 's', use 'session' instead.

By doing it this way you also avoid the need to have:

  s.save()

as the PSP handler will always save the session it creates when 'session'
variable reference triggers its creation.

You might like to give those changes a go and if it all works okay put up the
modified version.

Thanks again.

Graham
From nogradi at gmail.com  Tue Nov 28 05:46:12 2006
From: nogradi at gmail.com (Daniel Nogradi)
Date: Tue Nov 28 05:46:31 2006
Subject: [mod_python] Wiki for mod_python. Contributors welcome.
In-Reply-To: <1164689996.22288@dscpl.user.openhosting.com>
References: <1164689996.22288@dscpl.user.openhosting.com>
Message-ID: <5f56302b0611280246u4d3601b9td06e4733a08b13d0@mail.gmail.com>

> > http://wiki.apache.org/mod_python/
> > http://wiki.apache.org/mod_python/SampleCode
> > http://wiki.apache.org/mod_python/GuessingGame
>
> Thanks for getting the ball rolling.

Graham,

How does the new wiki (http://wiki.apache.org/mod_python/) relate to
the already present faq (http://modpython.org/FAQ/faqw.py)?

Should the faq be transferred to the wiki? Should the faq be updated
still or new stuff should go to the wiki? I'm just asking so that the
fragmentation of mod_python resources can be avoided.

Best,
Daniel
From grahamd at dscpl.com.au  Tue Nov 28 06:05:03 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Tue Nov 28 06:06:26 2006
Subject: [mod_python] Re: MySQLSession, wiki, development and other stuff
In-Reply-To: <B6C73A5E30565245BB6D32B5F5DF7A520BEDD8@sense.emmastraat.pijnacker>
References: <B6C73A5E30565245BB6D32B5F5DF7A520BEDD8@sense.emmastraat.pijnacker>
Message-ID: <5746FD9D-67A5-4E44-B789-EAFF2CBDED29@dscpl.com.au>


On 28/11/2006, at 10:04 AM, Martijn Moeling wrote:
> I emailed you guy's personally since you are the driving forces behind
> mod_python (i think) and this is not a real subject for that mailing
> list.

I see no reason why anything you talk about needs to be handled off
the mailing list, so have sent my response back there.

> I just send in a proposed new Session.py as a RFC backed with some
> documentation.
>
> I also found an today's article on the mailing list with subject:
> [mod_python] Wiki for mod_python. Contributors welcome.
> Which is about this subject, keeping the MySQLdb out as much as  
> possible
> was one of my goals, but I do not see another option.

There should be no reason for a MySQL session class to be within the
mod_python session code file for it to work. The only thing you don't  
get from
having it separate is the ability for it to be created underneath the  
Session.Session()
call based on the value of PythonOption for setting the session type.
Instead you would use:

   req.session = MySqlSession(req)

The only place where having to do this would be a problem is if you are
using mod_python.psp as it internally uses Session.Session(). It only
does this though if req.session doesn't exist as an attribute. Thus,  
if you are
using mod_python.psp you need to create your own handler which does:

   from mod_python import psp

   def handler(req):
     req.session = MySqlSession(req)
     return psp.handler(req)

By assigning session instance to req.session, mod_python.psp will use  
it.

You will need to have a recent version of mod_python for this to work
though.

In mod_python 3.3, the ability to use the Apache authentication handler
phase properly means that creating sessions in the main content handler
phase is probably not as a good an option as writing a proper  
authentication
handler for the job. In that scenario, you wouldn't even need to wrap
mod_python.psp as session creation would be in a separate handler
anyway.

> (yes I do: copy
> Session.py to my app dir and not include it from mod_python right?)

Making a copy of Session.py and modifying it is a bad idea as it is  
already
out of date if you are using mod_python 3.2.10 or older as various  
changes
have been made in code in mod_python 3.3. You will loose the benefit of
these changes/fixes if you have your own copy based on an older version.

> Storing the Sessions in an SQL database can be a huge advantage and I
> think it should be in Session.py since it expands possibilities.  
> (think
> of the multiple front end severs in my situation, and there are File,
> DBM memory possibilities, so why not add MySQL (which is used by most
> mod_python users anyway). With my current project I am preparing for
> 1.000.000 pageviews per hour!! One apache server with mod_python  
> can not
> handle that amount of users. (not all use sessions)
>
> Personally I think mod_python and MySQLdb should team up, I am an
> experienced programmer, but all those newbie guys run into trouble
> configuring the lot

The topic of having SQL database backed sessions included as a standard
part of mod_python has been discussed before and rejected. Even the
sqlite version which I referred you to was rejected. The issue was  
that having
dependencies on external packages was not desirable as it makes the
development and testing more burdensome. This was even though sqlite  
itself
doesn't require a big database system but can work direct out of the
filesystem.

If there is every to be database backed sessions included in  
mod_python as
a standard feature, I'd suggest it is more likely to be code which  
uses the
Apache 2.2 mod_dbd module in some way so that that stuff in Apache can
be leveraged for the task of database connection management etc. Keep in
mind that mod_python is all about trying to use what Apache provides as
much as possible, rather than creating a separate universe and just  
using
Apache as a hopping off point.

> I would love to contribute to the wiki, I'll see into it over the next
> few days. I have been a programmer devoted to Open Source since Linux
> was half a kernel (I implemented large parts of the V4 TCP/IP stack).

If you want to get involved in the wiki great. Adding the MySQLSession
class as an example would be a good thing to add to the wiki and for the
time being at least is probably the most appropriate place for it to go.

> Can you help me getting into mod_python development? I am  
> interested in
> adding useful features (like MySQLSession haha)

The way the Apache software foundation works is that new developers on
projects get commit access on the repository by way of invitation.  
They will
get an invitation by demonstrating good knowledge of the package by
helping out on the mailing lists by giving useful assistance to  
others. Finding
bugs in the package and investigating it to the level of being able  
to provide
a fix also helps. With the wiki now in place, contributing there  
would also
show your abilities and knowledge and in conjunction with other things
give confidence that providing you commit access to the source code  
would
be the right thing to do.

As a first step though, I would suggest you get yourself subscribed  
to the
mod_python developers mailing list in addition to the standard user  
mailing
list. I have never seen you post on the developers list so am  
assuming you
aren't subscribed there at present. Use the mailing list to learn,  
and contribute
as you can. If over time you give the core developers a good  
impression and
when we are looking for extra developers, then you would be considered.

Graham
From grahamd at dscpl.com.au  Tue Nov 28 06:12:21 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Tue Nov 28 06:13:37 2006
Subject: [mod_python] Wiki for mod_python. Contributors welcome.
In-Reply-To: <5f56302b0611280246u4d3601b9td06e4733a08b13d0@mail.gmail.com>
References: <1164689996.22288@dscpl.user.openhosting.com>
	<5f56302b0611280246u4d3601b9td06e4733a08b13d0@mail.gmail.com>
Message-ID: <CB02D907-5641-4A9D-BED0-2EF5244C186C@dscpl.com.au>


On 28/11/2006, at 9:46 PM, Daniel Nogradi wrote:

>> > http://wiki.apache.org/mod_python/
>> > http://wiki.apache.org/mod_python/SampleCode
>> > http://wiki.apache.org/mod_python/GuessingGame
>>
>> Thanks for getting the ball rolling.
>
> Graham,
>
> How does the new wiki (http://wiki.apache.org/mod_python/) relate to
> the already present faq (http://modpython.org/FAQ/faqw.py)?
>
> Should the faq be transferred to the wiki? Should the faq be updated
> still or new stuff should go to the wiki? I'm just asking so that the
> fragmentation of mod_python resources can be avoided.

Our feeling has been that the contents of the FAQ should be  
transferred to
the wiki with some items trimmed or cut and others expanded in the  
process.
We have some issues to sort out before we go too far down that track  
though
as the active developers on mod_python at the moment don't have access
to the main mod_python web site to be able to make changes to the  
site to have
it refer to an alternate location such as the wiki for more  
information. We have
been trying to sort through this issue and how to manage it but we  
don't have a
solution at the moment. This is in part why we haven't jumped in and  
done
too much on the wiki as we don't want to create the fragmentation  
that you are
also worried about.

Graham
From martijn at xs4us.nu  Tue Nov 28 07:11:42 2006
From: martijn at xs4us.nu (Martijn Moeling)
Date: Tue Nov 28 07:11:48 2006
Subject: [mod_python] register cleanup works fine,
	the call to the cleanup function fails...
Message-ID: <B6C73A5E30565245BB6D32B5F5DF7A520BEDDB@sense.emmastraat.pijnacker>

Hi

 

Whilst testing my MySQLSession object I temporarily set the
CLEANUP_CHANCE to 1 for force it to run

 

 

def MySLQ_cleanup(req):

...

...

...

 

The register_cleanup function runs fine... but the call by the cleanup
routines fails with an Error I cannot find. 

 

    def do_cleanup(self):

        self._req.register_cleanup(MySQL_cleanup, self._req)

        self._req.log_error("MySQLSession: registered session
cleanup.",apache.APLOG_NOTICE)

 

[Tue Nov 28 12:37:42 2006] [notice] [client xxx.xxx.xxx] MySQLSession:
registered session cleanup.

[Tue Nov 28 12:37:42 2006] [error] [client xxx.xxx.xxx.xxx]
python_cleanup: Error calling cleanup object <function MySQL_cleanup at
0xb7e0eed4>

[Tue Nov 28 12:37:42 2006] [error] [client xxx.xxx.xxx.xxx]
exceptions.ValueError: could not convert string to float

 

Python 2.4, mod_python 3.2.10 running on fedora 4 and Apache/2.0.54

 

Any suggestions?

 

Martijn

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20061128/1bd12b13/attachment.html
From sdavis2 at mail.nih.gov  Tue Nov 28 07:32:27 2006
From: sdavis2 at mail.nih.gov (Sean Davis)
Date: Tue Nov 28 07:32:34 2006
Subject: [mod_python] Wiki for mod_python. Contributors welcome.
In-Reply-To: <CB02D907-5641-4A9D-BED0-2EF5244C186C@dscpl.com.au>
References: <1164689996.22288@dscpl.user.openhosting.com>
	<5f56302b0611280246u4d3601b9td06e4733a08b13d0@mail.gmail.com>
	<CB02D907-5641-4A9D-BED0-2EF5244C186C@dscpl.com.au>
Message-ID: <200611280732.27497.sdavis2@mail.nih.gov>

On Tuesday 28 November 2006 06:12, Graham Dumpleton wrote:
> On 28/11/2006, at 9:46 PM, Daniel Nogradi wrote:
> >> > http://wiki.apache.org/mod_python/
> >> > http://wiki.apache.org/mod_python/SampleCode
> >> > http://wiki.apache.org/mod_python/GuessingGame
> >>
> >> Thanks for getting the ball rolling.
> >
> > Graham,
> >
> > How does the new wiki (http://wiki.apache.org/mod_python/) relate to
> > the already present faq (http://modpython.org/FAQ/faqw.py)?
> >
> > Should the faq be transferred to the wiki? Should the faq be updated
> > still or new stuff should go to the wiki? I'm just asking so that the
> > fragmentation of mod_python resources can be avoided.
>
> Our feeling has been that the contents of the FAQ should be
> transferred to
> the wiki with some items trimmed or cut and others expanded in the
> process.
> We have some issues to sort out before we go too far down that track
> though
> as the active developers on mod_python at the moment don't have access
> to the main mod_python web site to be able to make changes to the
> site to have
> it refer to an alternate location such as the wiki for more
> information. We have
> been trying to sort through this issue and how to manage it but we
> don't have a
> solution at the moment. This is in part why we haven't jumped in and
> done
> too much on the wiki as we don't want to create the fragmentation
> that you are
> also worried about.

Graham and Daniel,

I think this is great progress for 12 hours!  To go one step further: is there 
any thought that including a link to the wiki on the email footer would 
encourage its use?  

Sean
From martijn at xs4us.nu  Tue Nov 28 07:38:21 2006
From: martijn at xs4us.nu (Martijn Moeling)
Date: Tue Nov 28 07:38:27 2006
Subject: [mod_python] register cleanup works fine,
	the call to the cleanup function fails...
Message-ID: <B6C73A5E30565245BB6D32B5F5DF7A520BEDDC@sense.emmastraat.pijnacker>

Solved, it turns out that I manually corrupted the data in one of the
records

 

________________________________

Van: mod_python-bounces@modpython.org
[mailto:mod_python-bounces@modpython.org] Namens Martijn Moeling
Verzonden: Tuesday, November 28, 2006 1:12 PM
Aan: mod_python@modpython.org
Onderwerp: [mod_python] register cleanup works fine,the call to the
cleanup function fails...

 

Hi

 

Whilst testing my MySQLSession object I temporarily set the
CLEANUP_CHANCE to 1 for force it to run

 

 

def MySLQ_cleanup(req):

...

...

...

 

The register_cleanup function runs fine... but the call by the cleanup
routines fails with an Error I cannot find. 

 

    def do_cleanup(self):

        self._req.register_cleanup(MySQL_cleanup, self._req)

        self._req.log_error("MySQLSession: registered session
cleanup.",apache.APLOG_NOTICE)

 

[Tue Nov 28 12:37:42 2006] [notice] [client xxx.xxx.xxx] MySQLSession:
registered session cleanup.

[Tue Nov 28 12:37:42 2006] [error] [client xxx.xxx.xxx.xxx]
python_cleanup: Error calling cleanup object <function MySQL_cleanup at
0xb7e0eed4>

[Tue Nov 28 12:37:42 2006] [error] [client xxx.xxx.xxx.xxx]
exceptions.ValueError: could not convert string to float

 

Python 2.4, mod_python 3.2.10 running on fedora 4 and Apache/2.0.54

 

Any suggestions?

 

Martijn

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20061128/e765d2e3/attachment.html
From derek.asleson at gmail.com  Tue Nov 28 10:51:51 2006
From: derek.asleson at gmail.com (Derek Asleson)
Date: Tue Nov 28 10:51:57 2006
Subject: [mod_python] Long URIs and Path Info
In-Reply-To: <1164661928.18800@dscpl.user.openhosting.com>
References: <1164661928.18800@dscpl.user.openhosting.com>
Message-ID: <6dda28010611280751v32b39128j5e73322216ca262c@mail.gmail.com>

Thanks, Graham. I've looked at both methods; tried them both with little
luck, but I think I may be able to get the latter one working first.

So far I've tried both a custom publisher and Mod_python's publisher. I'm
happy to use either. I'll keep trying this and report any success I have.

regards

d


On 11/27/06, Graham Dumpleton <grahamd@dscpl.com.au> wrote:
>
> Derek Asleson wrote ..
> > I've been trying to figure out how to make long URIs with mod_python for
> > a
> > few days now. I don't want an extension (I've figured out how to have
> long
> > URIs with AddHandler, but this shows an extension), but I want my URIs
> > to/look/like/this. Here's more examples of the effect I am going for:
> >
> > {index directory}/about/biography
> > {index directory}/blog/post/10-23-2007
> >
> > I know I with publisher you can have this effect ({index
> directory}/about)
> > but I could not figure out how to add deeper URIs. Any ideas?
>
> 8EA6D2
> What you are using in part dictates what you can do.
>
> Even when using AddHandler, it is possible to avoid the need for an
> extension in the URI if you set Apache up correctly for use of MultiViews.
> Some details are contained in:
>
> http://www.dscpl.com.au/wiki/ModPython/Articles/SetHandlerVersusAddHandler
>
> This can apply to publisher but also custom handlers.
>
> If using publisher, one can use a trick to allow additional path
> information
> to be processed using special wrapper classes around published functions.
> I posted about this on the mailing list a long time back. I haven't read
> through the post again and assume it is still valid, although more than
> likely I am sure to do it a different way these days. See:
>
> http://www.modpython.org/pipermail/mod_python/2005-March/017560.html
>
> Graham
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20061128/1d26b2b6/attachment.html
From jpg at jgassociates.ca  Tue Nov 28 12:12:07 2006
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Tue Nov 28 12:12:06 2006
Subject: [SPAM] Re: [mod_python] Wiki for mod_python. Contributors welcome.
In-Reply-To: <58d7d2590611272038h4a6dd0e6idedf1b8bc69d0d4e@mail.gmail.com>
References: <1164664981.11585@dscpl.user.openhosting.com>
	<58d7d2590611272038h4a6dd0e6idedf1b8bc69d0d4e@mail.gmail.com>
Message-ID: <456C6DE7.5040508@jgassociates.ca>

Erik Thompson wrote:
>>
>> > This is a good sentiment.  But, does it make some sense to have a spot
>> > on the
>> > wiki for code devoted to things like this?  Session handling can be
>> > approached many ways, so it might be useful to have code examples 
>> hosted
>> > more
>> > formally than simply via the email archive.  Also, one could envision a
>> > generic handlers section, a persistent objects section, etc.  All of
>> these
>> > have been discussed relatively recently; wouldn't it be nice to say 
>> "put
>> > in
>> > on the wiki" or "refer to the wiki" when these come up?
>> >
>>
>>
> I took the liberty of adding a sample code page to the wiki and a PSP
> example I wrote recently when I was attempting to learn the correct syntax
> for using session and form variables.  Feel free to review, modify, delete,
> or whatever =).  I'd personally love to see more examples of PSP and
> mod_python to help myself and others learn.
> 
> http://wiki.apache.org/mod_python/
> http://wiki.apache.org/mod_python/SampleCode
> http://wiki.apache.org/mod_python/GuessingGame

Thanks for stepping forward Erik. It's a nice simple example.

Jim
From jpg at jgassociates.ca  Tue Nov 28 12:20:34 2006
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Tue Nov 28 12:20:29 2006
Subject: [mod_python] Re: MySQLSession, wiki, development and other stuff
In-Reply-To: <5746FD9D-67A5-4E44-B789-EAFF2CBDED29@dscpl.com.au>
References: <B6C73A5E30565245BB6D32B5F5DF7A520BEDD8@sense.emmastraat.pijnacker>
	<5746FD9D-67A5-4E44-B789-EAFF2CBDED29@dscpl.com.au>
Message-ID: <456C6FE2.4070101@jgassociates.ca>

Graham Dumpleton wrote:
> 
> On 28/11/2006, at 10:04 AM, Martijn Moeling wrote:
>> I emailed you guy's personally since you are the driving forces behind
>> mod_python (i think) and this is not a real subject for that mailing
>> list.
> 
> I see no reason why anything you talk about needs to be handled off
> the mailing list, so have sent my response back there.
> 
>> I just send in a proposed new Session.py as a RFC backed with some
>> documentation.
>>
>> I also found an today's article on the mailing list with subject:
>> [mod_python] Wiki for mod_python. Contributors welcome.
>> Which is about this subject, keeping the MySQLdb out as much as possible
>> was one of my goals, but I do not see another option.
> 
> There should be no reason for a MySQL session class to be within the
> mod_python session code file for it to work. The only thing you don't 
> get from
> having it separate is the ability for it to be created underneath the 
> Session.Session()
> call based on the value of PythonOption for setting the session type.
> Instead you would use:
> 
>   req.session = MySqlSession(req)
> 
> The only place where having to do this would be a problem is if you are
> using mod_python.psp as it internally uses Session.Session(). It only
> does this though if req.session doesn't exist as an attribute. Thus, if 
> you are
> using mod_python.psp you need to create your own handler which does:
> 
>   from mod_python import psp
> 
>   def handler(req):
>     req.session = MySqlSession(req)
>     return psp.handler(req)
> 
> By assigning session instance to req.session, mod_python.psp will use it.
> 
> You will need to have a recent version of mod_python for this to work
> though.
> 
> In mod_python 3.3, the ability to use the Apache authentication handler
> phase properly means that creating sessions in the main content handler
> phase is probably not as a good an option as writing a proper 
> authentication
> handler for the job. In that scenario, you wouldn't even need to wrap
> mod_python.psp as session creation would be in a separate handler
> anyway.
> 
>> (yes I do: copy
>> Session.py to my app dir and not include it from mod_python right?)
> 
> Making a copy of Session.py and modifying it is a bad idea as it is already
> out of date if you are using mod_python 3.2.10 or older as various changes
> have been made in code in mod_python 3.3. You will loose the benefit of
> these changes/fixes if you have your own copy based on an older version.
> 
>> Storing the Sessions in an SQL database can be a huge advantage and I
>> think it should be in Session.py since it expands possibilities. (think
>> of the multiple front end severs in my situation, and there are File,
>> DBM memory possibilities, so why not add MySQL (which is used by most
>> mod_python users anyway). With my current project I am preparing for
>> 1.000.000 pageviews per hour!! One apache server with mod_python can not
>> handle that amount of users. (not all use sessions)
>>
>> Personally I think mod_python and MySQLdb should team up, I am an
>> experienced programmer, but all those newbie guys run into trouble
>> configuring the lot
> 
> The topic of having SQL database backed sessions included as a standard
> part of mod_python has been discussed before and rejected. Even the
> sqlite version which I referred you to was rejected. The issue was that 
> having
> dependencies on external packages was not desirable as it makes the
> development and testing more burdensome. This was even though sqlite itself
> doesn't require a big database system but can work direct out of the
> filesystem.

Now that sqlite is included with python 2.5 I can see the possibility of 
adding that to Session.py at some point. Such an implementation could 
then be used as a reference for creating other database backends.


> If there is every to be database backed sessions included in mod_python as
> a standard feature, I'd suggest it is more likely to be code which uses the
> Apache 2.2 mod_dbd module in some way so that that stuff in Apache can
> be leveraged for the task of database connection management etc.

+1

This is something I think we should pursue. If we don't make any 
progress on it in the near term I think it might make a nice Google 
Summer of Code project for 2007.

> Keep in
> mind that mod_python is all about trying to use what Apache provides as
> much as possible, rather than creating a separate universe and just using
> Apache as a hopping off point.
> 
>> I would love to contribute to the wiki, I'll see into it over the next
>> few days. I have been a programmer devoted to Open Source since Linux
>> was half a kernel (I implemented large parts of the V4 TCP/IP stack).
> 
> If you want to get involved in the wiki great. Adding the MySQLSession
> class as an example would be a good thing to add to the wiki and for the
> time being at least is probably the most appropriate place for it to go.
> 
>> Can you help me getting into mod_python development? I am interested in
>> adding useful features (like MySQLSession haha)
> 
> The way the Apache software foundation works is that new developers on
> projects get commit access on the repository by way of invitation. They 
> will
> get an invitation by demonstrating good knowledge of the package by
> helping out on the mailing lists by giving useful assistance to others. 
> Finding
> bugs in the package and investigating it to the level of being able to 
> provide
> a fix also helps. With the wiki now in place, contributing there would also
> show your abilities and knowledge and in conjunction with other things
> give confidence that providing you commit access to the source code would
> be the right thing to do.
> 
> As a first step though, I would suggest you get yourself subscribed to the
> mod_python developers mailing list in addition to the standard user mailing
> list. I have never seen you post on the developers list so am assuming you
> aren't subscribed there at present. Use the mailing list to learn, and 
> contribute
> as you can. If over time you give the core developers a good impression and
> when we are looking for extra developers, then you would be considered.

Getting on the developers list is definitely  the first step. Subscribe 
by sending a message to python-dev-subscribe@httpd.apache.org.

Jim

From deron.meranda at gmail.com  Tue Nov 28 13:58:08 2006
From: deron.meranda at gmail.com (Deron Meranda)
Date: Tue Nov 28 13:58:11 2006
Subject: [mod_python] Wiki for mod_python. Contributors welcome.
In-Reply-To: <CB02D907-5641-4A9D-BED0-2EF5244C186C@dscpl.com.au>
References: <1164689996.22288@dscpl.user.openhosting.com>
	<5f56302b0611280246u4d3601b9td06e4733a08b13d0@mail.gmail.com>
	<CB02D907-5641-4A9D-BED0-2EF5244C186C@dscpl.com.au>
Message-ID: <5c06fa770611281058k18fa6050s874ea45ee43fd1a6@mail.gmail.com>

I'm glad there seems to be some desire to build up the wiki now.
I had previously just set up a bare-bones page to try to link
to all the various important information, but had been holding off
on contributing much new stuff until more was sorted out or
more interest occured.

I'll be happy to help coordinate or organize content, if it's even needed,
or to help any willing contributors with how to use the wiki, etc.

But anybody is welcome to contribute if you think you can help
the mod_python community out.  Even if you're a new user and
can't write a complete article, just getting some feedback about
what things you think need more explanation or you found
confusing would allow others to know what needs addressing.


The initial discussions about the wiki on the dev mailing list a few
weeks ago had raised a few questions about what kinds of things
should go on the wiki and how to transition to using it more, so
I'll respond belately on the more public list so hopefully the wider
community of users can start participating...


Concerning whether mod_python documentation should be moved
to the wiki: generally, due to legal/licensing concerns of the Apache
Foundation, the "core" documentation can not be wikified (or at
least not open to unauthorized edits).  But questions were raised
about specific chapters which may not be "core" documentation...

> Sections 4, 5 and 6 (API, Apache Configuration Directives and Standard
> Handlers) of the current docs stay with in the source distribution.
> Everything else would be a candidate for the wiki. (We should likely
> decide which should go in the wiki vs the modpython.org website vs the
> httpd.apache.org/modules/mod_python website).

Yes, chapters 4-6 seem to be the core "official" documentation
and make sense to lock down similar to the source code.
If other chapters like the tutorials are separated at all, putting them
in a wiki seems to make the most sense to me.

Things like the release change notes should probably either be
read-only static web pages, or perhaps moved to a protected wiki
area.  Perhaps it would be sufficient to use MoinMoin ACLs for
this.  That way the content is fixed, but still easily linked to, etc.

Is this wiki effort a good time to finally separate somewhat the
core mod_python from PSP in how the documentation is
organized?


Now, concerning the different topics....
> News
> Roadmap

Perhpaps news and roadmaps should be on a protected wiki
page.  Of course for major news (like new releases) there
should continue to be good old-fashioned blurbs on the
modpython.org home page too (but perhaps with all details
linking to the corresponding wiki page).  I would be in favor of
the bulk of all textual content moving to wiki pages; and ACL
protected where there is a need to lock them down.

> Installation help for various OS platforms

This makes sense to put on the wiki (if allowed), since it is
the one piece of documentation that can really benefit from
end-user experience and contributions the most.
Though we probably need to keep some minimal amount
of instructions bundled in the distribution though; but perhaps
none of the platform-specific or advanced stuff.


> FAQ

I'd say lets move everything in the current FAQ to the wiki,
and then stop using the FAQ-o-matic altogether.  Wikis are
from my experience so much easier to keep up to date,
as well as being easier to navigate (if written well) and
cross-link with other information.

If there is a general consensus that this what we should do
I can actually do most of the tedium of moving and
organizing the content.

> Tutorials
> Examples

Definite wiki candidates.  Except perhaps you want to keep
just a very small set in the official documentation too (?)

> Security considerations
> Troubleshooting applications

Yes, wikify these.

> Mailing list information
> Developer information
> Bug reporting information

I've already put some links on the wiki for these.  But regardless
where this information goes, it should be linked-to from *all*
the main mod_python starting points (modpython.org,
wiki, httpd.org).

Unless of course we want to choose one place to be the
new primary home page.  Certainly you could do this
with the MoinMoin wiki (with security on some pages).
For example the Fedora project homepage is now a
MoinMoin wiki (http://fedoraproject.org/wiki/)

* * *

Infrastructure technical issues:  Concerning past discussions about
whether MoinMoin is the best choice of wiki engine, or if perhaps
we should look at Confluence, etc...  (I think the quotes below are
Graham's)

> > I know that MoinMoin
> > has fine grained access permissions as well, but from my experience
> > it is a bit harder to configure as it requires changes to a file based
> > configuration file to setup the default policy. Requiring this means
> > intervention of the ASF infrastructure people and they are possibly
> > too busy as it is.

The amount of file-based configuration you have to do in MoinMoin is
actually pretty minimal unless you're really doing something advanced.
Basically you just delegate at least one user (or group) admin privileges
and turn on ACLs.  After that all the security permissions can be done
via the wiki interface itself.  Granted though, somebody at ASF has to
do that initial setup.

Can Jim or somebody look into that?  I can provide technical
assistance if needed on how MoinMoin ACLs work.  See also
http://wiki.apache.org/general/WikiFrequentlyAskedQuestions

> > How individual page access and groups are setup
> > with MoinMoin is also a fiddly process.

It may not be intuitive, but it's not actually that hard.  Especially if
your security model is pretty simple as I suspect ours would be.  But
you still have to set the ACL on each page, so that may qualify as
fiddly to some people.

> > At lease with Confluence such
> > things are all controllable through the web interface and somewhat
> > easier to manage. That MoinMoin is fiddly to setup is possibly why
> > they recommend a separate wiki space for the protected documentation
> > as then the default policy can be just to let the selected users edit
> > the pages and one doesn't have to worry about manipulating
> > access on individual pages.

The separate wiki setup is recommended because it is the easiest
way to partition the wikispace into areas with different policies (they
are in fact not really separate wiki setups, but what in MoinMoin
are called wiki farms....they share most configuration but have
independent content).

You can set almost all MoinMoin access control via the web interface,
except for declaring the wiki-wide default policies.  But you currently
have to set access policies on a page by page basis.

There are some moinmoin patches to make this much easier, and
such a feature is being considered for the next major MoinMon
release. But ASF is already running a quite old version of monmoin
anyway, so installing custom patches is probably never going
to happen.

I sometimes participate in the MoinMoin dev group, so maybe
I'll take some feedback about it here back there, and maybe help
fix them.  Feel free to post Moin specific stuff to my MoinMoin
homepage (except if it's also mod_python related, then keep it
on this mailing list)  -- http://moinmoin.wikiwikiweb.de/DeronMeranda

Confluence....
If it is decided to move the official docs into Confluence, it would be
nice if the MoinMoin interwiki links were configured, so it would make
cross-linking between the two sets of pages much easier.  Surely
the Apache guys could do this. (?)

Some useful links to the mod_python wiki configuration:
   http://wiki.apache.org/mod_python/InterWiki
   http://wiki.apache.org/mod_python/SystemInfo

Also it seems that the general Apache wiki front page has been
temporarily hidden/moved (perhaps to protect from spammers?).
So for more information on the wiki setup in general or a list of
all the other Apache-sponsored project wikis see (for now);
http://wiki.apache.org/general/FrontPage1

-- 
Deron Meranda
From downgrade at gmx.org  Tue Nov 28 14:17:57 2006
From: downgrade at gmx.org (Lars Eriksen)
Date: Tue Nov 28 14:17:34 2006
Subject: [mod_python] Profiling mod_python
Message-ID: <456C8B65.4020407@gmx.org>

Not that I couldn't isolate the code that I'm interested in and profile 
it "offline", but is there in the name of comfort a way to profile a 
mod_python app?

Psyco doesn't work here, I only get a list of "unknown opcode" errors in 
the profile log ... is it worth trying to make it work?
From MCStoufer at lbl.gov  Tue Nov 28 19:05:58 2006
From: MCStoufer at lbl.gov (Martin Stoufer)
Date: Tue Nov 28 19:06:04 2006
Subject: [mod_python] Wiki for mod_python. Contributors welcome.
In-Reply-To: <5c06fa770611281058k18fa6050s874ea45ee43fd1a6@mail.gmail.com>
References: <1164689996.22288@dscpl.user.openhosting.com>
	<5f56302b0611280246u4d3601b9td06e4733a08b13d0@mail.gmail.com>
	<CB02D907-5641-4A9D-BED0-2EF5244C186C@dscpl.com.au>
	<5c06fa770611281058k18fa6050s874ea45ee43fd1a6@mail.gmail.com>
Message-ID: <456CCEE6.1020704@lbl.gov>

My last collaboration project had to learn this the hard way. All our 
software design/usage documentation was put up on a WiKi and slowly 
dissolved into a morass of incorrect and incomplete entries. Those not 
fully versed in the inner workings of the software would post changes 
and suggestions (hacks in my book!) not knowing how it would effect 
other components. Not because they were stupid, they just didn't fully 
understand.

I have been an ardent supporter that real documentation should flow from 
those who know to those who don't. This doesn't mean that this info is 
static forever. There just has to be an absolute stop-gate in the 
feedback loop that can analyze and determine what should be changed. I 
would look to maintain both a read-only section and slowly incorporate 
only the very sound ideas from the world-writable area.

Such a "change control" mechanism would work best if it is started 
early. I would like to volunteer to review and help approve content in 
the 'OS install' area.

>> Sections 4, 5 and 6 (API, Apache Configuration Directives and Standard
>> Handlers) of the current docs stay with in the source distribution.
>> Everything else would be a candidate for the wiki. (We should likely
>> decide which should go in the wiki vs the modpython.org website vs the
>> httpd.apache.org/modules/mod_python website).
>
> Yes, chapters 4-6 seem to be the core "official" documentation
> and make sense to lock down similar to the source code.
> If other chapters like the tutorials are separated at all, putting them
> in a wiki seems to make the most sense to me.
>
> Things like the release change notes should probably either be
> read-only static web pages, or perhaps moved to a protected wiki
> area.  Perhaps it would be sufficient to use MoinMoin ACLs for
> this.  That way the content is fixed, but still easily linked to, etc.
>
> Is this wiki effort a good time to finally separate somewhat the
> core mod_python from PSP in how the documentation is
> organized?
>

-- 
* Martin C. Stoufer              *
* DST/DIDC/ITG                   *
* Lawrence Berkeley National Lab *
* MS 50B-2239 510-486-8662       *

-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/x-pkcs7-signature
Size: 3423 bytes
Desc: S/MIME Cryptographic Signature
Url : http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20061128/6bbfbead/smime-0001.bin
From steve at holdenweb.com  Tue Nov 28 20:18:10 2006
From: steve at holdenweb.com (Steve Holden)
Date: Tue Nov 28 20:17:05 2006
Subject: [mod_python] Re: Wiki for mod_python. Contributors welcome.
In-Reply-To: <456CCEE6.1020704@lbl.gov>
References: <1164689996.22288@dscpl.user.openhosting.com>	<5f56302b0611280246u4d3601b9td06e4733a08b13d0@mail.gmail.com>	<CB02D907-5641-4A9D-BED0-2EF5244C186C@dscpl.com.au>	<5c06fa770611281058k18fa6050s874ea45ee43fd1a6@mail.gmail.com>
	<456CCEE6.1020704@lbl.gov>
Message-ID: <ekin23$h3e$1@sea.gmane.org>

Martin Stoufer wrote:
[top-posting rectified: please don't do that ;-)]
>>> Sections 4, 5 and 6 (API, Apache Configuration Directives and Standard
>>> Handlers) of the current docs stay with in the source distribution.
>>> Everything else would be a candidate for the wiki. (We should likely
>>> decide which should go in the wiki vs the modpython.org website vs the
>>> httpd.apache.org/modules/mod_python website).
>>
>> Yes, chapters 4-6 seem to be the core "official" documentation
>> and make sense to lock down similar to the source code.
>> If other chapters like the tutorials are separated at all, putting them
>> in a wiki seems to make the most sense to me.
>>
>> Things like the release change notes should probably either be
>> read-only static web pages, or perhaps moved to a protected wiki
>> area.  Perhaps it would be sufficient to use MoinMoin ACLs for
>> this.  That way the content is fixed, but still easily linked to, etc.
>>
>> Is this wiki effort a good time to finally separate somewhat the
>> core mod_python from PSP in how the documentation is
>> organized?
>>
 > My last collaboration project had to learn this the hard way. All our
 > software design/usage documentation was put up on a WiKi and slowly
 > dissolved into a morass of incorrect and incomplete entries. Those not
 > fully versed in the inner workings of the software would post changes
 > and suggestions (hacks in my book!) not knowing how it would effect
 > other components. Not because they were stupid, they just didn't fully
 > understand.
 >
 > I have been an ardent supporter that real documentation should flow from
 > those who know to those who don't. This doesn't mean that this info is
 > static forever. There just has to be an absolute stop-gate in the
 > feedback loop that can analyze and determine what should be changed. I
 > would look to maintain both a read-only section and slowly incorporate
 > only the very sound ideas from the world-writable area.
 >
 > Such a "change control" mechanism would work best if it is started
 > early. I would like to volunteer to review and help approve content in
 > the 'OS install' area.
 >
Look at what Fredrik Lundh is doing with the "(Semi-Official) Python 
FAQ" at http://effbot.org/pyfaq/ - it allows comments, but the comments 
are folded in by someone "in charge". The developers could get to say 
who was "in charge" at any time.

While this approach does have merits, if the comments aren't sensibly 
processed then the text can biodegrade in the same way as a wiki. But I 
can testify that it does encourage people to contribute: while writing 
this mail I clicked the "random page" button a few times until I found 
and article I could usefully add comments for, and did so.

regards
  Steve
-- 
Steve Holden       +44 150 684 7255  +1 800 494 3119
Holden Web LLC/Ltd          http://www.holdenweb.com
Skype: holdenweb       http://holdenweb.blogspot.com
Recent Ramblings     http://del.icio.us/steve.holden

From MCStoufer at lbl.gov  Thu Nov 30 13:09:38 2006
From: MCStoufer at lbl.gov (Martin Stoufer)
Date: Thu Nov 30 13:09:54 2006
Subject: [mod_python] Re: Wiki for mod_python. Contributors welcome.
In-Reply-To: <ekin23$h3e$1@sea.gmane.org>
References: <1164689996.22288@dscpl.user.openhosting.com>
	<5f56302b0611280246u4d3601b9td06e4733a08b13d0@mail.gmail.com>
	<CB02D907-5641-4A9D-BED0-2EF5244C186C@dscpl.com.au>
	<5c06fa770611281058k18fa6050s874ea45ee43fd1a6@mail.gmail.com>
	<456CCEE6.1020704@lbl.gov> <ekin23$h3e$1@sea.gmane.org>
Message-ID: <456F1E62.1020801@lbl.gov>



Steve Holden wrote:
> Martin Stoufer wrote:
> [top-posting rectified: please don't do that ;-)]
Doh!
>
> Look at what Fredrik Lundh is doing with the "(Semi-Official) Python 
> FAQ" at http://effbot.org/pyfaq/ - it allows comments, but the 
> comments are folded in by someone "in charge". The developers could 
> get to say who was "in charge" at any time.
>
> While this approach does have merits, if the comments aren't sensibly 
> processed then the text can biodegrade in the same way as a wiki. But 
> I can testify that it does encourage people to contribute: while 
> writing this mail I clicked the "random page" button a few times until 
> I found and article I could usefully add comments for, and did so.
>
Thank you for referencing such a prime example. I forgot to pass along 
the 'lessons learned' from my experience; that this wasn't going to be 
an easy task to accomplish. It would of required a continual amount of 
dedicated work. The level and daily duration of work was geometrically 
proportional to the volume of postings and their apparent complexity.

I don't want this to squash anyone's hopes, I post this so we go in with 
our eyes open.

-- 
* Martin C. Stoufer              *
* DST/DIDC/ITG                   *
* Lawrence Berkeley National Lab *
* MS 50B-2239 510-486-8662       *

-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/x-pkcs7-signature
Size: 3423 bytes
Desc: S/MIME Cryptographic Signature
Url : http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20061130/b71c3e63/smime.bin
From ccbean at gmail.com  Thu Nov 30 14:35:27 2006
From: ccbean at gmail.com (Colin Bean)
Date: Thu Nov 30 14:35:32 2006
Subject: [mod_python] Profiling mod_python
In-Reply-To: <456C8B65.4020407@gmx.org>
References: <456C8B65.4020407@gmx.org>
Message-ID: <29a6ca010611301135s4113330ep7fe176d2c19bc1ef@mail.gmail.com>

Hi Lars,

I've never used psyco, but after a quick look at the documentation it
looks like "profiling" under psyco analyzes the code and creates and
optimized/compiled version.  Is this what you need to do?

If you're only interested in profiling as in seeing how much time each
function takes, you can use the python profile module, and create a
new handler that runs your original handler under profile, and saves
the results.  There's an example with PSP here:
http://www.modpython.org/pipermail/mod_python/2005-November/019513.html

hth,
Colin

On 11/28/06, Lars Eriksen <downgrade@gmx.org> wrote:
> Not that I couldn't isolate the code that I'm interested in and profile
> it "offline", but is there in the name of comfort a way to profile a
> mod_python app?
>
> Psyco doesn't work here, I only get a list of "unknown opcode" errors in
> the profile log ... is it worth trying to make it work?
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From jpg at jgassociates.ca  Thu Nov 30 18:48:00 2006
From: jpg at jgassociates.ca (Jim Gallacher)
Date: Thu Nov 30 18:43:25 2006
Subject: [mod_python] wiki change notifications
Message-ID: <456F6DB0.3090101@jgassociates.ca>

To everyone interested in working on the wiki I just want to make you 
aware that you can receive change notifications by subscribing to 
python-cvs@httpd.apache.org. That list gets notifications for both the 
wiki and svn commits.

Subscribe by sending a message to python-cvs-subscribe@httpd.apache.org.

Jim
From brunson at brunson.com  Thu Nov 30 19:41:56 2006
From: brunson at brunson.com (Eric Brunson)
Date: Thu Nov 30 19:41:55 2006
Subject: [mod_python] python path and 3.3
Message-ID: <456F7A54.60808@brunson.com>

I just grabbed the latest SVN snapshot and installed it and I'm having a 
problem with importing now.

Using the publisher handler I'm trying to get my app from 3.1.4 going, 
but 3.3 no longer seems to want to find my lib/ subdirectory.  I've 
added the following to my .htaccess:

PythonPath "['.']+sys.path"

I can display the sys.path in an app and it includes ".", but it just 
doesn't find a subdirectory "lib"

Is there something new with the module loading that I should be aware of?


From brunson at brunson.com  Thu Nov 30 20:02:39 2006
From: brunson at brunson.com (Eric Brunson)
Date: Thu Nov 30 20:02:37 2006
Subject: [mod_python] python path and 3.3
In-Reply-To: <456F7A54.60808@brunson.com>
References: <456F7A54.60808@brunson.com>
Message-ID: <456F7F2F.5030406@brunson.com>

Eric Brunson wrote:
> I just grabbed the latest SVN snapshot and installed it and I'm having 
> a problem with importing now.
>
> Using the publisher handler I'm trying to get my app from 3.1.4 going, 
> but 3.3 no longer seems to want to find my lib/ subdirectory.  I've 
> added the following to my .htaccess:
>
> PythonPath "['.']+sys.path"
>
> I can display the sys.path in an app and it includes ".", but it just 
> doesn't find a subdirectory "lib"
>
> Is there something new with the module loading that I should be aware of?

Sorry.  Got a little quick on the send...  Here's the error message:

  File "/usr/local/www/data/deviceWebGui/erictest.py", line 3, in <module>
    from lib import HTMLBuilder

ImportError: No module named lib


And lib is a subdirectory of /usr/local/www/data/deviceWebGui/ 

>
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python

From grahamd at dscpl.com.au  Thu Nov 30 20:12:12 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Thu Nov 30 20:12:21 2006
Subject: [mod_python] python path and 3.3
Message-ID: <1164935532.28914@dscpl.user.openhosting.com>

Eric Brunson wrote ..
> I just grabbed the latest SVN snapshot and installed it and I'm having
> a problem with importing now.
> 
> Using the publisher handler I'm trying to get my app from 3.1.4 going,
> but 3.3 no longer seems to want to find my lib/ subdirectory.  I've 
> added the following to my .htaccess:
> 
> PythonPath "['.']+sys.path"
> 
> I can display the sys.path in an app and it includes ".", but it just 
> doesn't find a subdirectory "lib"
> 
> Is there something new with the module loading that I should be aware of?

Where is your 'lib' subdirectory relative to the directory you specified the
handler for?

What are you using to import modules from that directory, 'import',
'__import__' or 'apache.import_module()'?

What is the argument you are supplying to these to identify your module?

Does the module argument you are using contain a '/'?

At the moment I can't see how it would have worked before if you never had
PythonPath defined unless you were using '/' in a module name, for example:

  module = apache.import('lib/name')

This should still work with the new importer, but only if done from a publisher
file in the handler root directory, and not one in a subdirectory.

Anyway, can you please post the Apache configuration snippet you are using
to set the directory up for publisher, including any PythonPath directive being
set. Also describe how your directories look and where files live relative to
each other.

Sorry for not just providing a possible solution, but we are going to have to
deal with subtle little differences between new and old importer and for the
first people who run up against them, I want to understand the use cases
properly so I know how to help others later in the best way.

I will explain everything, but if you give me the information I can do a better
job.

Thanks.

Graham
From grahamd at dscpl.com.au  Thu Nov 30 20:15:00 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Thu Nov 30 20:15:06 2006
Subject: [mod_python] python path and 3.3
Message-ID: <1164935700.29895@dscpl.user.openhosting.com>

Eric Brunson wrote ..
> Eric Brunson wrote:
> > I just grabbed the latest SVN snapshot and installed it and I'm having
> > a problem with importing now.
> >
> > Using the publisher handler I'm trying to get my app from 3.1.4 going,
> > but 3.3 no longer seems to want to find my lib/ subdirectory.  I've 
> > added the following to my .htaccess:
> >
> > PythonPath "['.']+sys.path"
> >
> > I can display the sys.path in an app and it includes ".", but it just
> > doesn't find a subdirectory "lib"
> >
> > Is there something new with the module loading that I should be aware
> of?
> 
> Sorry.  Got a little quick on the send...  Here's the error message:
> 
>   File "/usr/local/www/data/deviceWebGui/erictest.py", line 3, in <module>
>     from lib import HTMLBuilder
> 
> ImportError: No module named lib
> 
> 
> And lib is a subdirectory of /usr/local/www/data/deviceWebGui/ 

Ahhh, you are using a package.

I have to go out for a while, but I know what the issue will be. Please send
the other information I was after though for me and I'll explain later.

Graham
From grahamd at dscpl.com.au  Thu Nov 30 23:10:45 2006
From: grahamd at dscpl.com.au (Graham Dumpleton)
Date: Thu Nov 30 23:10:55 2006
Subject: [mod_python] python path and 3.3
Message-ID: <1164946245.5080@dscpl.user.openhosting.com>

Eric Brunson wrote ..
> Eric Brunson wrote:
> > I just grabbed the latest SVN snapshot and installed it and I'm having
> > a problem with importing now.
> >
> > Using the publisher handler I'm trying to get my app from 3.1.4 going,
> > but 3.3 no longer seems to want to find my lib/ subdirectory.  I've 
> > added the following to my .htaccess:
> >
> > PythonPath "['.']+sys.path"
> >
> > I can display the sys.path in an app and it includes ".", but it just
> > doesn't find a subdirectory "lib"
> >
> > Is there something new with the module loading that I should be aware
> of?
> 
> Sorry.  Got a little quick on the send...  Here's the error message:
> 
>   File "/usr/local/www/data/deviceWebGui/erictest.py", line 3, in <module>
>     from lib import HTMLBuilder
> 
> ImportError: No module named lib
> 
> And lib is a subdirectory of /usr/local/www/data/deviceWebGui/ 

The basic reason why this doesn't work for you is that in the old importer,
the directory the Python*Handler directive was specified for was automatically
added to sys.path, but in the new module importer this is no longer done.

The reason that the directory was added to sys.path in the old importer
was because the standard Python module import mechanism was used
underneath to find modules and without the directory in sys.path, it would
not find them.

Adding directories to sys.path like this caused a number or problems and
created some unpredictability as to what module would actually be found.
For descriptions of problems, see:

  http://www.dscpl.com.au/wiki/ModPython/Articles/ModuleImportingIsBroken

As such, in the new module importer, the standard Python module import
mechanism is not used to search for the modules to be imported. Further,
the directory is not added into sys.path as already mentioned and instead the
new module importer maintains its own concept of where to search for
modules.

Now, if you had been using a file based module and it was located within
the handler root directory, the new module importer would continue to find
it okay. However, because you are putting your modules together into a
subdirectory and faking (possibly) a package to hold them, it will not find it.

The reason that new the module importer will not find the package is
because it ignores packages altogether as packages can't be candidates
for automatic module reloading. When the new importer can't find a file
based module called 'lib.py', it will fallback to the standard Python module
import mechanism which will detect packages, however, because the directory
isn't in sys.path, it will not find it either.

That Python packages contained within the handler root directory would be
one point of incompatibility with the older importer was known, it just didn't
occur to me that you were using a package when I first responded.

As to a solution, there are a few, some being preferred over others depending
on what you expectations are.

First options is to add:

  # PLEASE DON'T DO THIS. SEE BELOW.

  PythonPath "sys.path+'/some/directory/where/htaccess/is']"

into your .htaccess file.

Although this is the simplest thing to do, it is also the least preferred and I
would strongly recommend not doing it.

The reason this is bad is that the new importer tries to keep separate its own
module search path and that of sys.path used by the standard Python module
search path.

If you allow an overlap, like this would create, you run into the possibility of
having unpredictable behaviour when searching for modules as well as other
problems, much like some of the problems with the old importer.

If you do try this, you should note that mod_python will output warnings to
the Apache error log saying you are doing bad things because you will be
telling it to look for reloadable modules in a directory which is also in sys.path.

Although it will issue these warnings, things will actually still work for simple
stuff at least. This is because the new importer will still pick file based modules
from the directory it is complaining about. At the same time, when it falls back
the standard Python module import mechanism for the package, it will work
as it now looks in the handler root directory where the package directory is
located.

The second option is simply to move your package directory to somewhere
outside of the document tree and use PythonPath to add to sys.path the
new directory where you put it. This is not much different to the first option
in that you are still using PythonPath, but mod_python will not complain as
there is no overlap in directories for each module importing mechanism.

Note that in both cases above, because a package is being used, none of
the modules in the package will be candidates for automatic reloading when
changes are made. You will need to restart Apache whenever you make changes
to the modules in the package.

If the modules in the package were third party stuff anyway, it is preferable
to do this. Same if the modules aren't really specific to the web application
anyway.

The third option is to not use a package. If you created the package merely
out of convenience to provide a namespace for the modules, this should
be okay. Thus, remove the empty __init__.py file so that it isn't actually a
package anymore. Then, change:

  from lib import HTMLBuilder

to:

  from mod_python import apache

  HTMLBuilder = apache.import_module('~/lib/HTMLBuilder.py')

This is using the mod_python module importer directly to import the module
by path. The '~/' prefix to the path is special and is understood by the
module importer to be the directory that the active Python*Handler directive
was specified for.

If modules within the package were importing other modules from the same
package using a global import. Ie.,

  from lib import othermodule

you can change it to just:

  import othermodule

and it will work.

This works because although it is not a package anymore, the new mod_python
module importer uses magic so that 'import' will map to mod_python's module
importer first when used in a module which was imported using the importer.
Further, the import will always look in the same directory as the module first,
something the old importer didn't do.

You could also have done:

  othermodule = apache.import_module('othermodule')

or:

  othermodule = apache.import_module('~/lib/othermodule.py')

or:

  othermodule = apache.import_module('./othermodule.py')

The last one uses an explicit path again, but expresses it relative to the same
directory that the parent is contained in.

This whole feature of using an actual path instead of the module name is
something new in mod_python 3.3 and means one can more predictably
import exactly the module you intend to import.

Using this third option, because file based modules are being used
and not a package, the modules are candidates for automatic reloading
when changes are made to them. This means you would not have to restart
Apache if reloading is enabled.

A fourth option is to again remove the package __init__.py file so it isn't
really a package anymore, but also move the directory to somewhere outside
of the document tree. In order to find the modules though, the PythonPath
directive is NOT used and instead the new module importers own search
path is set. For example:

  PythonOption mod_python.importer.path "['/some/path/lib']"

The module importer path SHOULD NOT mention sys.path, it should instead
be a distinct list of directories where only the new module importer will look.
Because the 'lib' directory is include and the contents of the directory will be
searched, can just say:

  import HTMLBuilder

If for some reason you wanted to do it this way, but not move the directory
outside of the document tree, you could also say:

  PythonOption mod_python.importer.path "['~/lib']"

Here the '~/' prefix is again used so you don't have to have an absolute path.
When used it will be expanded to the directory the handler was specified for.

BTW, I hope you 'lib' directory contains its own .htaccess file which contains:

  deny from all

If not, because publisher is used, someone could invoke code in the lib
subdirectory otherwise.

Anyway, hope I haven't confused you too much. 

Graham


