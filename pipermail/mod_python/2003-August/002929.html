<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Persistent db connections
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Persistent%20db%20connections&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002939.html">
   <LINK REL="Next"  HREF="002930.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Persistent db connections</H1>
    <B>Mike Looijmans</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Persistent%20db%20connections&In-Reply-To="
       TITLE="[mod_python] Persistent db connections">mike.looijmans at asml.com
       </A><BR>
    <I>Fri Aug  8 07:25:15 EST 2003</I>
    <P><UL>
        <LI>Previous message: <A HREF="002939.html">[mod_python] Re: Help with mod_python install
</A></li>
        <LI>Next message: <A HREF="002930.html">[mod_python] Problem understanding PythonAccessHandler
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2929">[ date ]</a>
              <a href="thread.html#2929">[ thread ]</a>
              <a href="subject.html#2929">[ subject ]</a>
              <a href="author.html#2929">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>More importantly, make sure that your DB engine supports multiple threads
over a single connection.

If you're using a threading MPM, there will be multiple clients sharing the
same connection.

For MySQL for example this will fail if you also use scrolling cursors,
since you can have only one such cursor per connection.

What I did was to use a threading-only MPM and have each request grab a DB
connection from a pool (and remove it), and when done, it returns the DB
object to the pool. If the pool is empty, a new connection object is created
(so the pool grows automatically to meet demand).
This allows many threads to use the same connection objects, but no threads
will ever share the same object.

If the number of connections is limited, you could create a fixed number of
objects and do a lock-and-wait until one is available when the pool is
drained.

Mike.

-----Original Message-----
From: VanL &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">vlindberg at verio.net</A>&gt;
To: Conrad Steenberg &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">conrad at hep.caltech.edu</A>&gt;
Cc: ModPython mail list &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">mod_python at modpython.org</A>&gt;
Date: Thursday, August 07, 2003 7:22 PM
Subject: Re: [mod_python] Persistent db connections


&gt;<i>Conrad Steenberg wrote:
</I>&gt;<i>
</I>&gt;&gt;<i>Using dbpool would make your web app fail more gracefully, i.e. get
</I>&gt;&gt;<i>slower with more connections, instead of giving some users an error that
</I>&gt;&gt;<i>it was unable to connect to the DB, as you often see on overloaded
</I>&gt;&gt;<i>discussion sites.
</I>&gt;&gt;<i>
</I>&gt;<i>Is this correct?  I thought that even dbpool would not pool resources
</I>&gt;<i>between different apache processes.  Thus having a
</I>&gt;<i>one-connection-per-process (or two, or three, but some fixed number)
</I>&gt;<i>rule along with an apache maxclients setting would tend to keep the
</I>&gt;<i>database connections within an acceptable range.
</I>&gt;<i>
</I>&gt;<i>If the max number of clients could be known, regardless of the number of
</I>&gt;<i>apache child processes, that would be great.  However, that doesn't
</I>&gt;<i>match my understanding of how it works.
</I>

</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002939.html">[mod_python] Re: Help with mod_python install
</A></li>
	<LI>Next message: <A HREF="002930.html">[mod_python] Problem understanding PythonAccessHandler
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2929">[ date ]</a>
              <a href="thread.html#2929">[ thread ]</a>
              <a href="subject.html#2929">[ subject ]</a>
              <a href="author.html#2929">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
