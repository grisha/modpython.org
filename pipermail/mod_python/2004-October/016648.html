<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] bug in apache.build_cgi_env
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20bug%20in%20apache.build_cgi_env&In-Reply-To=3A81C87DC164034AA4E2DDFE11D258E3022F81%40exchange.hqamor.amorhq.net">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016625.html">
   <LINK REL="Next"  HREF="016629.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] bug in apache.build_cgi_env</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Gregory (Grisha) Trubetskoy</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20bug%20in%20apache.build_cgi_env&In-Reply-To=3A81C87DC164034AA4E2DDFE11D258E3022F81%40exchange.hqamor.amorhq.net"
       TITLE="[mod_python] bug in apache.build_cgi_env">grisha at modpython.org
       </A><BR>
    <I>Sun Oct 17 20:51:11 EDT 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="016625.html">[mod_python] bug in apache.build_cgi_env
</A></li>
        <LI>Next message: <A HREF="016629.html">[mod_python] Udate python modules without restarting Apache
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16648">[ date ]</a>
              <a href="thread.html#16648">[ thread ]</a>
              <a href="subject.html#16648">[ subject ]</a>
              <a href="author.html#16648">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
This gives you an idea of how much that function is being used :-)

My guess is that in some prior versions of Python length on None used to 
be 0.

I'll add this to the list of things to be fixed, thanks!

Grisha


On Wed, 13 Oct 2004, Robert Brewer wrote:

&gt;<i> Hi,
</I>&gt;<i>
</I>&gt;<i> I'm running mod_python (3.1.3-win32) and trying to write a WSGI wrapper
</I>&gt;<i> for it. I figured I'd call apache.build_cgi_env to get an environ dict,
</I>&gt;<i> but I get the following error message:
</I>&gt;<i>
</I>&gt;<i>  File &quot;C:\Python23\lib\site-packages\mod_python\apache.py&quot;, line 541,
</I>&gt;<i> in build_cgi_env
</I>&gt;<i>    if len(req.path_info) &gt; 0:
</I>&gt;<i>
</I>&gt;<i> TypeError: len() of unsized object
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I've already worked around it, but the function in question is:
</I>&gt;<i>
</I>&gt;<i> def build_cgi_env(req):
</I>&gt;<i>    &quot;&quot;&quot;
</I>&gt;<i>    Utility function that returns a dictionary of
</I>&gt;<i>    CGI environment variables as described in
</I>&gt;<i>    <A HREF="http://hoohoo.ncsa.uiuc.edu/cgi/env.html">http://hoohoo.ncsa.uiuc.edu/cgi/env.html</A>
</I>&gt;<i>    &quot;&quot;&quot;
</I>&gt;<i>
</I>&gt;<i>    req.add_common_vars()
</I>&gt;<i>    env = req.subprocess_env.copy()
</I>&gt;<i>
</I>&gt;<i>    if len(req.path_info) &gt; 0:
</I>&gt;<i>        env[&quot;SCRIPT_NAME&quot;] = req.uri[:-len(req.path_info)]
</I>&gt;<i>    else:
</I>&gt;<i>        env[&quot;SCRIPT_NAME&quot;] = req.uri
</I>&gt;<i>
</I>&gt;<i>    env[&quot;GATEWAY_INTERFACE&quot;] = &quot;Python-CGI/1.1&quot;
</I>&gt;<i>
</I>&gt;<i>    # you may want to comment this out for better security
</I>&gt;<i>    if req.headers_in.has_key(&quot;authorization&quot;):
</I>&gt;<i>        env[&quot;HTTP_AUTHORIZATION&quot;] = req.headers_in[&quot;authorization&quot;]
</I>&gt;<i>
</I>&gt;<i>    return env
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> With a little printlining, it seems my req.path_info is None, and
</I>&gt;<i> therefore has no length. Could we just write the following instead? It
</I>&gt;<i> fixed the problem for me.
</I>&gt;<i>
</I>&gt;<i>    if req.path_info:
</I>&gt;<i>        env[&quot;SCRIPT_NAME&quot;] = req.uri[:-len(req.path_info)]
</I>&gt;<i>    else:
</I>&gt;<i>        env[&quot;SCRIPT_NAME&quot;] = req.uri
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Thanks for your time,
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Robert Brewer
</I>&gt;<i> MIS
</I>&gt;<i> Amor Ministries
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">fumanchu at amor.org</A>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mod_python mailing list
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I>&gt;<i>
</I></PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="016625.html">[mod_python] bug in apache.build_cgi_env
</A></li>
	<LI>Next message: <A HREF="016629.html">[mod_python] Udate python modules without restarting Apache
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16648">[ date ]</a>
              <a href="thread.html#16648">[ thread ]</a>
              <a href="subject.html#16648">[ subject ]</a>
              <a href="author.html#16648">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
