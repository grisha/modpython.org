<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Output from C functions
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Output%20from%20C%20functions&In-Reply-To=007c01c041a5%24d213dbe0%240401a8c0%40iglauer.UUCP">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="007783.html">
   <LINK REL="Next"  HREF="007786.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
<table border=0 width="100%"><tr><td valign="top">
   <H1>[mod_python] Output from C functions</H1>
    <B>Gregory Trubetskoy</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Output%20from%20C%20functions&In-Reply-To=007c01c041a5%24d213dbe0%240401a8c0%40iglauer.UUCP"
       TITLE="[mod_python] Output from C functions">grisha at modpython.org
       </A><BR>
    <I>Sun Oct 29 17:30:43 EST 2000</I>
    <P><UL>
        <LI>Previous message: <A HREF="007783.html">[mod_python] Output from C functions
</A></li>
        <LI>Next message: <A HREF="007786.html">[mod_python] Output from C functions
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7785">[ date ]</a>
              <a href="thread.html#7785">[ thread ]</a>
              <a href="subject.html#7785">[ subject ]</a>
              <a href="author.html#7785">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
The cgihandler redirects the sys.stdout to the client. Anything that uses
the real (non python) stdout will just print somewhere just like you
describe.

If you want to do this in C, you should use the req.write function. Here
is what a handler written in C might look like (skipping all the regular
python module stuff. Kids don't try this at home):

#include mod_python.h

static PyObject * handler(PyObject *self, PyObject *args)
{
	PyObject *r;
	requestobject *req = NULL;

	if (!PyArg_ParseTuple(args, &quot;O&quot;, &amp;r))
	    return NULL;

	req = (requestobject *)PyObject_GetAttrString(r, &quot;_req&quot;);

	ap_send_http_header(req-&gt;request_rec);
	req-&gt;header_sent = 1;

	ap_table_set(req-&gt;request_rec-&gt;headers_out, &quot;content-type&quot;, 
		     &quot;text/plain&quot;);

	PyObject_CallMethod((PyObject *)req, &quot;write&quot;, &quot;s&quot;, &quot;Hello World!\n&quot;);
	
	return PyInt_FromLong(OK);
}


--
  Gregory (Grisha) Trubetskoy
       <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">grisha at modpython.org</A>

On Sun, 29 Oct 2000, Alexis Iglauer wrote:

&gt;<i> I am running a long calculation using a web interface, and am having the
</I>&gt;<i> problem that the web client times out before the results come back.  I fixed
</I>&gt;<i> this by first printing a valid HTTP header and then having the Python script
</I>&gt;<i> print a counter, which the web browser picks up and prints - and then
</I>&gt;<i> doesn't time out.  Works very well.
</I>&gt;<i> 
</I>&gt;<i> BUT - I have now recoded the central calculation routine in C (all the
</I>&gt;<i> control/UI stuff is still Python), and placed a printf routine in there to
</I>&gt;<i> output the iterations like I did in the Python, but it doesn't get to the
</I>&gt;<i> webbrowser.  Any ideas why?  It prints to stdout if I just run the script
</I>&gt;<i> from the console, but not if I call it from apache.  Is there some buffering
</I>&gt;<i> when calling a C routine?
</I>&gt;<i> 
</I>&gt;<i> I am using mod_python 2.6.2 and I wrapped the C function using SWIG.
</I>&gt;<i> 
</I>&gt;<i> Grateful for any pointers.
</I>&gt;<i> 
</I>&gt;<i> Thanks
</I>&gt;<i> Alexis
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mod_python mailing list
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;<i> <A HREF="http://www.modpython.org/mailman/listinfo/mod_python">http://www.modpython.org/mailman/listinfo/mod_python</A>
</I>&gt;<i> 
</I>

</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="007783.html">[mod_python] Output from C functions
</A></li>
	<LI>Next message: <A HREF="007786.html">[mod_python] Output from C functions
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#7785">[ date ]</a>
              <a href="thread.html#7785">[ thread ]</a>
              <a href="subject.html#7785">[ subject ]</a>
              <a href="author.html#7785">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
