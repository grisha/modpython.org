<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] problem creating an instance and debugging
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20problem%20creating%20an%20instance%20and%20debugging&In-Reply-To=20030703132213.X23236%40onyx.ispol.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="013934.html">
   <LINK REL="Next"  HREF="013923.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] problem creating an instance and debugging</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Daniel Rubin</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20problem%20creating%20an%20instance%20and%20debugging&In-Reply-To=20030703132213.X23236%40onyx.ispol.com"
       TITLE="[mod_python] problem creating an instance and debugging">dlrubin at yahoo.com
       </A><BR>
    <I>Thu Jul  3 11:41:10 EST 2003</I>
    <P><UL>
        <LI>Previous message: <A HREF="013934.html">[mod_python] problem creating an instance and debugging
</A></li>
        <LI>Next message: <A HREF="013923.html">[mod_python] Cookie
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13935">[ date ]</a>
              <a href="thread.html#13935">[ thread ]</a>
              <a href="subject.html#13935">[ subject ]</a>
              <a href="author.html#13935">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Here's the xmlrpc.py code. My client code is calling
the &quot;evaluate&quot; function via a call like this:
server = xmlrpclib.ServerProxy(myURI)
server.evaluate(data)

If I put the &quot;return data&quot; statement right before the
&quot;model=Model()&quot; statement, then things work fine. If I
put the return statement after it, then I get the
stack dump I showed you earlier. The code never jupmps
to the except: clause, and no errors are being written
to the apache logs (and my conf file is set to record
everything with no virtual hosts).


from mod_python import apache
import xmlrpclib

def evaluate(data):
     import MyTools import Model
     try:
          model = Model()  &lt;--an error happens here
          return data
     except:
          open(&quot;/tmp/test_xmlrpc01&quot;,
'w').write(&quot;RUNNING ON %s&quot; % findings)
          import traceback
         
traceback.print_exc(file=open(&quot;/tmp/test_xmlrpc03&quot;,
'w'))
          raise

def handler(req):
    import sys
    
    module = sys.modules[__name__]

    # Load the method and arguments from the client.
    content = req.read()

    # xmlrpclib fails if there are characters with
ASCII code &gt;= 128.
    # Thus, change anything greater than that to a
space.
    table = ''.join(map(chr, range(128))) + &quot; &quot;*128
    content = content.translate(table)
        
    args, method_name = xmlrpclib.loads(content)

    # Call the method.
    if hasattr(module, method_name):
        try:
            retval = getattr(module,
method_name)(*args)
        except Exception, x:
            retval = xmlrpclib.Fault(
                0, &quot;Exception (%s) raised: %s&quot; %
(Exception.__name__, str(x)))
        except x:
            retval = xmlrpclib.Fault(
                0, &quot;General exception raised: %s&quot; %
str(x))
    else:
        retval = xmlrpclib.Fault(
            0, &quot;This server does not provide: '%s'&quot; %
method_name)

    # Marshal the return value and write the results
back to the
    # client.
    req.content_type = &quot;text/xml&quot;
    marshalled = xmlrpclib.dumps((retval,),
methodresponse=1)
    req.write(marshalled)
    
    return apache.OK



--- &quot;Gregory (Grisha) Trubetskoy&quot;
&lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">grisha at modpython.org</A>&gt; wrote:
&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> On Thu, 3 Jul 2003, Daniel Rubin wrote:
</I>&gt;<i> 
</I>&gt;<i> &gt; An error is happening in the xmlrpc.py program,
</I>&gt;<i> and this isn't making
</I>&gt;<i> &gt; it's own stack dump or errors written to the
</I>&gt;<i> apache logs on the server.
</I>&gt;<i> &gt; So I can't debug what the nature of the error that
</I>&gt;<i> is happening in the
</I>&gt;<i> &gt; remotely called function.
</I>&gt;<i> 
</I>&gt;<i> So, tell me if I understand this correctly (I'm not
</I>&gt;<i> familiar with
</I>&gt;<i> xmlrpc.py) -
</I>&gt;<i> 
</I>&gt;<i> Xmlrpc.py is a CGI script which reports its errors
</I>&gt;<i> by writing them to
</I>&gt;<i> stderr. Something happens when you run it under
</I>&gt;<i> mod_python, and you don't
</I>&gt;<i> know what it is because stderr goes nowhere.
</I>&gt;<i> 
</I>&gt;<i> As far as I know, stderr output may end up in your
</I>&gt;<i> error log, but I don't
</I>&gt;<i> think that's guaranteed and may be dependent on how
</I>&gt;<i> your httpd was
</I>&gt;<i> compiled.  I think there is really no solution to
</I>&gt;<i> this other than to tweak
</I>&gt;<i> xmlrpc into raising its exception or using
</I>&gt;<i> mod_python's log_error to
</I>&gt;<i> report it.
</I>&gt;<i> 
</I>&gt;<i> HTH,
</I>&gt;<i> 
</I>&gt;<i> Grisha
</I>

__________________________________
Do you Yahoo!?
SBC Yahoo! DSL - Now only $29.95 per month!
<A HREF="http://sbc.yahoo.com">http://sbc.yahoo.com</A>
</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="013934.html">[mod_python] problem creating an instance and debugging
</A></li>
	<LI>Next message: <A HREF="013923.html">[mod_python] Cookie
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#13935">[ date ]</a>
              <a href="thread.html#13935">[ thread ]</a>
              <a href="subject.html#13935">[ subject ]</a>
              <a href="author.html#13935">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
