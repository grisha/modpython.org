<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] A few questions about requestobject.c
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20A%20few%20questions%20about%20requestobject.c&In-Reply-To=1059554030.13258.71.camel%40hercules.dustbite.org">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010302.html">
   
 </HEAD>
 <BODY BGCOLOR="#ffffff">
<table border=0 width="100%"><tr><td valign="top">
   <H1>[mod_python] A few questions about requestobject.c</H1>
    <B>Gregory (Grisha) Trubetskoy</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20A%20few%20questions%20about%20requestobject.c&In-Reply-To=1059554030.13258.71.camel%40hercules.dustbite.org"
       TITLE="[mod_python] A few questions about requestobject.c">grisha at modpython.org
       </A><BR>
    <I>Wed Jul 30 09:05:53 EST 2003</I>
    <P><UL>
        <LI>Previous message: <A HREF="010302.html">[mod_python] A few questions about requestobject.c
</A></li>
        
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10303">[ date ]</a>
              <a href="thread.html#10303">[ thread ]</a>
              <a href="subject.html#10303">[ subject ]</a>
              <a href="author.html#10303">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>

On Wed, 30 Jul 2003, Indrek [ISO-8859-1] J?rve wrote:
&gt;<i>
</I>&gt;<i> I've been messing around in requestobject.c for a few hours and started
</I>&gt;<i> wondering about the way a few things work. Since I'm not sure whether
</I>&gt;<i> they are design decisions, apache related stuff or just weird things, I
</I>&gt;<i> thought I'd ask the list :)
</I>
It's been so long we lost track of which of the three they are :-) (BTW, a
better list for this sort of thing is <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">python-dev at httpd.apache.org</A>).

&gt;<i> 1. The use of apr_palloc
</I>&gt;<i>
</I>&gt;<i> Multipart POST forms are parsed in util.py/FieldStorage using req's
</I>&gt;<i> req_readline function, which happily apr_palloc'ates enough memory to
</I>&gt;<i> read the remaining request data into memory, but never seems to free it
</I>&gt;<i> (nasty if the users have a habit of uploading 100+MB files, especially
</I>&gt;<i> once multiplied with the number of apache processes). Since the pool
</I>&gt;<i> used is attached to the apache request, I'm not sure I should freely
</I>&gt;<i> apr_pool_clear() or apr_pool_destroy() it either.
</I>&gt;<i>
</I>&gt;<i> I managed to release memory by replacing apr_palloc with malloc and
</I>&gt;<i> adding a few free()s where required, but is this the right approach?
</I>
Yes, this would definitely be a problem because that memory isn't freed
until the end of the request... We could either create a separate pool,
which then can be apr_pool_cleared(), or just use malloc like you have...
I'll see if I can take a look at it later today. If you have a patch you
could send in, that'd be nice.

&gt;<i>
</I>&gt;<i> 2. The use of PyString_FromStringAndSize()
</I>&gt;<i>
</I>&gt;<i> Again in the req_readline() function, the result variable is initialized
</I>&gt;<i> at the size of the full remaining request data.
</I>
This would be a problem with 100M files too... Another thing that occured
to me is that it could be better to rewrite the request read() functions
to use the buckets interface, this way none of this would be an issue.

Grisha
</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="010302.html">[mod_python] A few questions about requestobject.c
</A></li>
	
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10303">[ date ]</a>
              <a href="thread.html#10303">[ thread ]</a>
              <a href="subject.html#10303">[ subject ]</a>
              <a href="author.html#10303">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
