<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Another sessions problem...
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Another%20sessions%20problem...&In-Reply-To=5213E58D85BC414998FA553C701E386C0EDCFAC590%40SGBD012511.dlrmail.ad.delarue.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025079.html">
   <LINK REL="Next"  HREF="025081.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Another sessions problem...</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Another%20sessions%20problem...&In-Reply-To=5213E58D85BC414998FA553C701E386C0EDCFAC590%40SGBD012511.dlrmail.ad.delarue.com"
       TITLE="[mod_python] Another sessions problem...">graham.dumpleton at gmail.com
       </A><BR>
    <I>Thu Mar 27 06:07:41 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="025079.html">[mod_python] Another sessions problem...
</A></li>
        <LI>Next message: <A HREF="025081.html">[mod_python] Another sessions problem...
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25080">[ date ]</a>
              <a href="thread.html#25080">[ thread ]</a>
              <a href="subject.html#25080">[ subject ]</a>
              <a href="author.html#25080">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I think you are missing the point, even when a session is new, it must
be saved, else when cookie comes back on next request it will not know
about it and create yet another new one. This will keep on going. Just
try saving it and see if it works.

Graham

On 27/03/2008, <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Dominique.Holzwarth at ch.delarue.com</A>
&lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Dominique.Holzwarth at ch.delarue.com</A>&gt; wrote:
&gt;<i> Yes, there is _no_ 'req.session.save()' inside the 'if' (but inside the 'else') because I don't really want that 'if' to be executed anyway!
</I>&gt;<i>  When 'sessiontest2.py' is called (by hitting the form button) there already should be a valid session, which was created inside 'sessiontest1.py'. That's actually what I wanted to try out:
</I>&gt;<i>  One script (sessiontest1.py here) creates a session, then calls some functions from other scripts (myClass.show() from sessiontest2.py here) and eventually there's a request for the index() function of those other scripts (sessiontest2.py here). And those scripts should still know that existing session which was created by the very first script... :-)
</I>&gt;<i>  So again, when the index() from sessiontest2.py is called the session _should not_ be new. If it is, then there's something wrong, thus I don't even save that session... :-)
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>  Dominique
</I>&gt;<i>
</I>&gt;<i>  -----Original Message-----
</I>&gt;<i>  From: Graham Dumpleton [mailto:<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">graham.dumpleton at gmail.com</A>]
</I>&gt;<i>
</I>&gt;<i> Sent: Donnerstag, 27. M&#228;rz 2008 10:31
</I>&gt;<i>  To: Holzwarth, Dominique (Berne Bauhaus)
</I>&gt;<i>  Cc: <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">mod_python at modpython.org</A>
</I>&gt;<i>  Subject: Re: [mod_python] Another sessions problem...
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> See comment below in source code.
</I>&gt;<i>
</I>&gt;<i>  On 27/03/2008, <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Dominique.Holzwarth at ch.delarue.com</A>
</I>&gt;<i>  &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Dominique.Holzwarth at ch.delarue.com</A>&gt; wrote:
</I>&gt;<i>  &gt; Hello everyone
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt;  I've already did some testing with mod_python's session mechanism and so far it seemed to work nice. My latest test case doesn't work at all tho...
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt;  I have to scripts, sessiontest1.py and sessiontest2.py, both are
</I>&gt;<i>  &gt; directly in my &quot;python-root&quot; (the folder the publisher handler is
</I>&gt;<i>  &gt; using)
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt;  Sessiontest1.py:
</I>&gt;<i>  &gt;  **************************************************
</I>&gt;<i>  &gt;  from mod_python import Session
</I>&gt;<i>  &gt;  import sessiontest2
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt;  secretText = &quot;mysecret&quot;
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt;  def index(req):
</I>&gt;<i>  &gt;   myClassObject = sessiontest2.myClass()
</I>&gt;<i>  &gt;   msg = myClassObject.add()
</I>&gt;<i>  &gt;   req.session = Session.FileSession(req)
</I>&gt;<i>  &gt;   req.session['test'] = 5
</I>&gt;<i>  &gt;   req.session['meinKlassenObjekt'] = myClassObject
</I>&gt;<i>  &gt;   req.session.save()
</I>&gt;<i>  &gt;   return myClassObject.show(req.session.id())
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt;  **************************************************
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt;  Sessiontest2.py
</I>&gt;<i>  &gt;  **************************************************
</I>&gt;<i>  &gt;  from mod_python import Session
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt;  secretText = &quot;mysecret&quot;
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt;  def index(req):
</I>&gt;<i>  &gt;     req.session = Session.FileSession(req)
</I>&gt;<i>  &gt;     if req.session.is_new():
</I>&gt;<i>  &gt;         return &quot;Session is new: &quot;+req.session.id()
</I>&gt;<i>
</I>&gt;<i>  Isn't there a req.session.save() missing in this part of if statement before returning?
</I>&gt;<i>
</I>&gt;<i>  Graham
</I>&gt;<i>
</I>&gt;<i>  &gt;     else:
</I>&gt;<i>  &gt;         lala = req.session['test']
</I>&gt;<i>  &gt;         myClassObject = req.session['meinKlassenObjekt']
</I>&gt;<i>  &gt;         newVal = req.form.getfirst('button')
</I>&gt;<i>  &gt;         cnt = myClassObject.add(newVal)
</I>&gt;<i>  &gt;         req.session['meinKlassenObjekt'] = myClassObject
</I>&gt;<i>  &gt;         req.session.save()
</I>&gt;<i>  &gt;         return cnt
</I>&gt;<i>  &gt;     return &quot;default return&quot;
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt;  class myClass:
</I>&gt;<i>  &gt;     def __init__(self):
</I>&gt;<i>  &gt;         self.counter = 0
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt;     def add(self, val=1):
</I>&gt;<i>  &gt;         self.counter = self.counter + val
</I>&gt;<i>  &gt;         return self.counter
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt;     def show(self, *value):
</I>&gt;<i>  &gt;         msg = &quot;&quot;&quot;
</I>&gt;<i>  &gt;  &lt;html&gt;&lt;body&gt;
</I>&gt;<i>  &gt;  &lt;form action='/python/sessiontest2.py' method='post'&gt;
</I>&gt;<i>  &gt;     &lt;input name='counter' type='text' readonly value='%s'/&gt;
</I>&gt;<i>  &gt;     &lt;input name='new' type='text' /&gt;
</I>&gt;<i>  &gt;     &lt;input name='button' type='submit' value='Add' /&gt;  &lt;/form&gt;
</I>&gt;<i>  &gt;  &lt;p&gt;ID: %s&lt;/p&gt;
</I>&gt;<i>  &gt;  &lt;/body&gt;&lt;/html&gt;
</I>&gt;<i>  &gt;         &quot;&quot;&quot; % (self.counter, value)
</I>&gt;<i>  &gt;         return msg
</I>&gt;<i>  &gt;  ****************************************************
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt;  Here's what's happening:
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt;  I call the sessiontest1.py which creates a new session (for a fresh browser window), does some stuff with the class-object, saves the object (resp. the session) and then it returns the html site generated from that class.
</I>&gt;<i>  &gt;  When I submit that form the sessiontest2.py script is called and in my opinion it should load the previously created session (and do the stuff inside the 'else'). However, it always creates a new session instead of using the old one...
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt;  Maybe anyone got an idea what could be wrong? Would be really nice!
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt;  Greetings
</I>&gt;<i>  &gt;  Dominique
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt;
</I>&gt;<i>  &gt;  _______________________________________________
</I>&gt;<i>  &gt;  Mod_python mailing list
</I>&gt;<i>  &gt;  <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;<i>  &gt;  <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I>&gt;<i>  &gt;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="025079.html">[mod_python] Another sessions problem...
</A></li>
	<LI>Next message: <A HREF="025081.html">[mod_python] Another sessions problem...
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25080">[ date ]</a>
              <a href="thread.html#25080">[ thread ]</a>
              <a href="subject.html#25080">[ subject ]</a>
              <a href="author.html#25080">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
