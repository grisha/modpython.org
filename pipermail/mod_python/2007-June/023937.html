<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Checking a PSP-generated response before starting to
	send it..?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Checking%20a%20PSP-generated%20response%20before%20starting%20to%0A%09send%20it..%3F&In-Reply-To=0JKA007GFL8PWT10%40smtp3.clear.net.nz">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023924.html">
   <LINK REL="Next"  HREF="023938.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Checking a PSP-generated response before starting to
	send it..?</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Aaron Robinson</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Checking%20a%20PSP-generated%20response%20before%20starting%20to%0A%09send%20it..%3F&In-Reply-To=0JKA007GFL8PWT10%40smtp3.clear.net.nz"
       TITLE="[mod_python] Checking a PSP-generated response before starting to
	send it..?">aaron.robinson at mojoworld.com
       </A><BR>
    <I>Thu Jun 28 18:30:59 EDT 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="023924.html">[mod_python] Checking a PSP-generated response before starting to
	send it..?
</A></li>
        <LI>Next message: <A HREF="023938.html">[mod_python] Checking a PSP-generated response before starting to
	send it..?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23937">[ date ]</a>
              <a href="thread.html#23937">[ thread ]</a>
              <a href="subject.html#23937">[ subject ]</a>
              <a href="author.html#23937">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>For lack of any feedback on this, I've come up with 1/2 a solution
(possibly), but would still very much appreciate *any* input..

 

I've written a output filter which read()'s all the input it gets, then
stores it in an attribute it creates on filter.req (and write()'s nothing),
then when it reads None (end of stream) it can compare the total page to the
last sent page and either write() the whole page (unmodified) or change the
'Last-Modified' date to the previous date + change the response code to a
304...  problem is that I don't know if it's possible for an output filter
to change the response code..

 

Any ideas on how to make an output filter change the response code, or
whether there are any holes in this plan - or preferably if there's a way to
avoid this completely?

 

Thanks,

Aaron.

 

  _____  

From: <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">mod_python-bounces at modpython.org</A>
[mailto:<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">mod_python-bounces at modpython.org</A>] On Behalf Of Aaron Robinson
Sent: Wednesday, 27 June 2007 11:28 p.m.
To: <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">mod_python at modpython.org</A>
Subject: [mod_python] Checking a PSP-generated response before starting to
send it..?

 

Hi all,

 

I'm running Apache 2.2.4 on Win32 with mod_python 3.3.1 and Python 2.5.1.

I'm completely new to Apache (and hence mod_python), but am reasonably
proficient with python itself.

 

I'm working on a web service where all content is generated on the fly, and
am wanting to use PSP to facilitate this.

Making as much use as possible of &quot;304: Not Modified&quot; is extremely important
to this project to reduce bandwidth, which is difficult as I have to
generate the content before I know whether it's different (&quot;been modified&quot;)
from the last time I sent it or not..

 

I previously used a mechanism (not using Apache) where I would generate the
response, then take a hash of it and if it matched the hash of the last
response I sent, I would instead send a &quot;304: Not Modified&quot;.

My problem is that when using PSP.run(), the response has already been sent
by the time it's finished being generated, so I have no opportunity to step
in and examine the response to see if sending a 304 is possible.

 

I'm needing an across-the-board mechanism for dealing with this - I thought
of serializing the &quot;vars&quot; dictionary before passing it in and taking a hash
of that for comparison, but this is hardly full-proof, as it would
(incorrectly) lead to responding with a 304 even with different &quot;session&quot;
information, or, in the slightly odd case that the PSP file made use of
random.random(), etc.

 

Just a thought: Is there a more general mechanism that can detect identical
content to a previous response on the way out and replace it with a 304?

 

Thanks in advance,

Aaron.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070629/c0ebb402/attachment.html">http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20070629/c0ebb402/attachment.html</A>
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="023924.html">[mod_python] Checking a PSP-generated response before starting to
	send it..?
</A></li>
	<LI>Next message: <A HREF="023938.html">[mod_python] Checking a PSP-generated response before starting to
	send it..?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23937">[ date ]</a>
              <a href="thread.html#23937">[ thread ]</a>
              <a href="subject.html#23937">[ subject ]</a>
              <a href="author.html#23937">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="DISABLEhttp://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
