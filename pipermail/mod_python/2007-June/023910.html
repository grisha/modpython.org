<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] object type. why it not works?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20object%20type.%20why%20it%20not%20works%3F&In-Reply-To=5aaed53f0706232211q5ae25488qd87f8d1aa6eb8ae4%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023907.html">
   <LINK REL="Next"  HREF="023913.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] object type. why it not works?</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20object%20type.%20why%20it%20not%20works%3F&In-Reply-To=5aaed53f0706232211q5ae25488qd87f8d1aa6eb8ae4%40mail.gmail.com"
       TITLE="[mod_python] object type. why it not works?">graham.dumpleton at gmail.com
       </A><BR>
    <I>Sun Jun 24 19:35:26 EDT 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="023907.html">[mod_python] object type. why it not works?
</A></li>
        <LI>Next message: <A HREF="023913.html">[mod_python] object type. why it not works?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23910">[ date ]</a>
              <a href="thread.html#23910">[ thread ]</a>
              <a href="subject.html#23910">[ subject ]</a>
              <a href="author.html#23910">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 24/06/07, Jeff Hinrichs - DM&amp;T &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">jeffh at dundeemt.com</A>&gt; wrote:
&gt;<i> On 6/23/07, <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">ziapannocchia at gmail.com</A> &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">ziapannocchia at gmail.com</A>&gt; wrote:
</I>&gt;<i> &gt; I have a selfmade apache server, and I'm writing  a little web
</I>&gt;<i> &gt; application with mod python.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Using this def:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; def testPython(contenuto):
</I>&gt;<i> &gt;   test=&quot;test&quot;
</I>&gt;<i> &gt;   return type(test)
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I obtain this error:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Mod_python error: &quot;PythonHandler mod_python.publisher&quot;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Traceback (most recent call last):
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;   File &quot;/usr/lib64/python2.4/site-packages/mod_python/apache.py&quot;, line
</I>&gt;<i> &gt; 299, in HandlerDispatch
</I>&gt;<i> &gt;     result = object(req)
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;   File &quot;/usr/lib64/python2.4/site-packages/mod_python/publisher.py&quot;,
</I>&gt;<i> &gt; line 213, in handler
</I>&gt;<i> &gt;     published = publish_object(req, object)
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;   File &quot;/usr/lib64/python2.4/site-packages/mod_python/publisher.py&quot;,
</I>&gt;<i> &gt; line 412, in publish_object
</I>&gt;<i> &gt;     return publish_object(req,util.apply_fs_data(object, req.form, req=req))
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;   File &quot;/usr/lib64/python2.4/site-packages/mod_python/publisher.py&quot;,
</I>&gt;<i> &gt; line 412, in publish_object
</I>&gt;<i> &gt;     return publish_object(req,util.apply_fs_data(object, req.form, req=req))
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;   File &quot;/usr/lib64/python2.4/site-packages/mod_python/util.py&quot;, line
</I>&gt;<i> &gt; 401, in apply_fs_data
</I>&gt;<i> &gt;     fc = object.__init__.im_func.func_code
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; AttributeError: 'wrapper_descriptor' object has no attribute 'im_func'
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Instead, on command line, the same istruction works well:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">cloc3 at s939</A> /home/cloc3 $ python
</I>&gt;<i> &gt; Python 2.4.4 (#1, May 18 2007, 08:25:49)
</I>&gt;<i> &gt; [GCC 4.1.2 (Gentoo 4.1.2)] on linux2
</I>&gt;<i> &gt; Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.
</I>&gt;<i> &gt; &gt;&gt;&gt; test=&quot;test&quot;
</I>&gt;<i> &gt; &gt;&gt;&gt; type(test)
</I>&gt;<i> &gt; &lt;type 'str'&gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; What may be wrong?
</I>&gt;<i>
</I>&gt;<i> Publisher wants to return a string -- and you are attempting to return
</I>&gt;<i> an object, <A HREF="http://docs.python.org/lib/bltin-type-objects.html">http://docs.python.org/lib/bltin-type-objects.html</A>
</I>&gt;<i>
</I>&gt;<i> try, return test  --or-- return str(type(test))
</I>
Actually, you are supposed to be able  to return anything from a
published function which can be converted to a string. Thus one can
return integers, dictionaries, lists, or custom data types provided
they defined a __str__() method.

Now, there is actually a problem here and it derives from fact that
publisher does something that I didn't even realise. Question is
whether it is an inadvertent feature added by accident or whether it
was intentional.

The problem is with the function:

def publish_object(req, object):
    if callable(object):

        # To publish callables, we call them an recursively publish the result
        # of the call (as done by util.apply_fs_data)

        req.form = util.FieldStorage(req, keep_blank_values=1)
        return publish_object(req,util.apply_fs_data(object, req.form, req=req))

    else:
       ...

The intent of this function is that it is called with the object which
the URL got matched to. If the target wasn't callable then resulted
would be that it gets converted to a string and written back as
response.

If the target was callable, then util.apply_fs_data() is called to
actually make the call against the target object. The result of this
is then passed back into publish_object() in a second call to have the
resulted converted to a string and written back as response.

Problem is that in calling publish_object() a second time, if the
result of calling util.apply_fs_data() was itself a callable, then a
subsequent attempt will be made to call that.

At this point I am going to assume that this wasn't intentional, and
if it was then it has a bug for other reasons besides what is being
seen. Namely, it creates an instance of util.FieldStorage on every
call and assigns it to req.form. This means that form data would get
wiped on a recursive call to a second callable object. If the feature
was intentional, then it should check to see if req.form exists and
use it rather than creating util.FieldStorage.

So, there are a few issues here that need to be sorted out.

1. Should publisher invoke a callable object returned by a function.

2. If answer to 1 is yes, then how form data is managed needs to be fixed.

3. If answer to 1 is yes, then before recursively calling a callable
then publisher should apply its rule set to ensure it isn't calling an
object type it isn't supposed to.

In respect of 3, if one has:

  index = type(&quot;test&quot;)

then accessing index will result in Forbidden response as rule set
denies access, not so with the recursive call though.

Anyone got any opinions on whether publisher should do 1?

Graham
</PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="023907.html">[mod_python] object type. why it not works?
</A></li>
	<LI>Next message: <A HREF="023913.html">[mod_python] object type. why it not works?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23910">[ date ]</a>
              <a href="thread.html#23910">[ thread ]</a>
              <a href="subject.html#23910">[ subject ]</a>
              <a href="author.html#23910">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
