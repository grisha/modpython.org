<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] req.sendfile and the Content-length header
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20req.sendfile%20and%20the%20Content-length%20header&In-Reply-To=B1348DE2-5D69-4D83-8B9A-B313D80492B7%40gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023805.html">
   <LINK REL="Next"  HREF="023808.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] req.sendfile and the Content-length header</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20req.sendfile%20and%20the%20Content-length%20header&In-Reply-To=B1348DE2-5D69-4D83-8B9A-B313D80492B7%40gmail.com"
       TITLE="[mod_python] req.sendfile and the Content-length header">graham.dumpleton at gmail.com
       </A><BR>
    <I>Sat Jun  9 02:02:07 EDT 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="023805.html">[mod_python] req.sendfile and the Content-length header
</A></li>
        <LI>Next message: <A HREF="023808.html">[mod_python] req.sendfile and the Content-length header
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23806">[ date ]</a>
              <a href="thread.html#23806">[ thread ]</a>
              <a href="subject.html#23806">[ subject ]</a>
              <a href="author.html#23806">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 09/06/07, Aaron Gallagher &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">habnabit at gmail.com</A>&gt; wrote:
&gt;<i>
</I>&gt;<i> Is there any easy way to make req.sendfile use a content-length header
</I>&gt;<i> instead of chunking the output? This is what I've been doing, and it's very
</I>&gt;<i> fast, but I'm sure there's a more elegant way of doing it.
</I>&gt;<i>
</I>&gt;<i>  st = open(req.filename)
</I>&gt;<i>  st.seek(0, 2)
</I>&gt;<i>  req.set_content_length(st.tell())
</I>&gt;<i>  st.close()
</I>&gt;<i>  req.sendfile(req.filename)
</I>
What you are doing isn't actually guaranteed to yield the correct
result as the file might be changed between the close() and the call
to sendfile() and thus you could end up sending a different amount of
data.

Note that if your mod_python handler simply returns apache.DECLINED,
the file defined by req.filename will be served up as static file for
you by Apache.

If you are instead using mod_python.publisher, use:

  raise apache.SERVER_RETURN, apache.DECLINED

Let us know if this works as I expect it should. If you have changed
req.filename there are some further steps you will need to possibly do
to have it work like I expect.

Graham
</PRE>








<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="023805.html">[mod_python] req.sendfile and the Content-length header
</A></li>
	<LI>Next message: <A HREF="023808.html">[mod_python] req.sendfile and the Content-length header
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23806">[ date ]</a>
              <a href="thread.html#23806">[ thread ]</a>
              <a href="subject.html#23806">[ subject ]</a>
              <a href="author.html#23806">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
