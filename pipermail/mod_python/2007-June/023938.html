<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Checking a PSP-generated response before starting to
	send it..?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Checking%20a%20PSP-generated%20response%20before%20starting%20to%0A%09send%20it..%3F&In-Reply-To=0JKD0095PALGDR30%40smtp4.clear.net.nz">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="023937.html">
   <LINK REL="Next"  HREF="023940.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Checking a PSP-generated response before starting to
	send it..?</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Checking%20a%20PSP-generated%20response%20before%20starting%20to%0A%09send%20it..%3F&In-Reply-To=0JKD0095PALGDR30%40smtp4.clear.net.nz"
       TITLE="[mod_python] Checking a PSP-generated response before starting to
	send it..?">graham.dumpleton at gmail.com
       </A><BR>
    <I>Thu Jun 28 18:44:29 EDT 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="023937.html">[mod_python] Checking a PSP-generated response before starting to
	send it..?
</A></li>
        <LI>Next message: <A HREF="023940.html">[mod_python] Checking a PSP-generated response before starting to
	send it..?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23938">[ date ]</a>
              <a href="thread.html#23938">[ thread ]</a>
              <a href="subject.html#23938">[ subject ]</a>
              <a href="author.html#23938">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 29/06/07, Aaron Robinson &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">aaron.robinson at mojoworld.com</A>&gt; wrote:
&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> For lack of any feedback on this, I've come up with 1/2 a solution
</I>&gt;<i> (possibly), but would still very much appreciate *any* input..
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I've written a output filter which read()'s all the input it gets, then
</I>&gt;<i> stores it in an attribute it creates on filter.req (and write()'s nothing),
</I>&gt;<i> then when it reads None (end of stream) it can compare the total page to the
</I>&gt;<i> last sent page and either write() the whole page (unmodified) or change the
</I>&gt;<i> 'Last-Modified' date to the previous date + change the response code to a
</I>&gt;<i> 304...  problem is that I don't know if it's possible for an output filter
</I>&gt;<i> to change the response code..
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Any ideas on how to make an output filter change the response code, or
</I>&gt;<i> whether there are any holes in this plan - or preferably if there's a way to
</I>&gt;<i> avoid this completely?
</I>
Can't be done.

I'm a bit busy to respond in detail on this at the moment, but do a
search through the mailing list archives using the search box on
www.modpython.org for 'publisher PSP'. This should pick up messages
which talk about using PSP from publisher, thus giving you more
control. There has also been past discussions on how to make PSP
output to a string so one can process output like you want. Look for
'PSP request wrapper'.

Graham

&gt;<i> Thanks,
</I>&gt;<i>
</I>&gt;<i> Aaron.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>  ________________________________
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> From: <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">mod_python-bounces at modpython.org</A>
</I>&gt;<i> [mailto:<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">mod_python-bounces at modpython.org</A>] On Behalf Of
</I>&gt;<i> Aaron Robinson
</I>&gt;<i>  Sent: Wednesday, 27 June 2007 11:28 p.m.
</I>&gt;<i>  To: <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">mod_python at modpython.org</A>
</I>&gt;<i>  Subject: [mod_python] Checking a PSP-generated response before starting to
</I>&gt;<i> send it..?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Hi all,
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I'm running Apache 2.2.4 on Win32 with mod_python 3.3.1 and Python 2.5.1.
</I>&gt;<i>
</I>&gt;<i> I'm completely new to Apache (and hence mod_python), but am reasonably
</I>&gt;<i> proficient with python itself.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I'm working on a web service where all content is generated on the fly, and
</I>&gt;<i> am wanting to use PSP to facilitate this.
</I>&gt;<i>
</I>&gt;<i> Making as much use as possible of &quot;304: Not Modified&quot; is extremely important
</I>&gt;<i> to this project to reduce bandwidth, which is difficult as I have to
</I>&gt;<i> generate the content before I know whether it's different (&quot;been modified&quot;)
</I>&gt;<i> from the last time I sent it or not..
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I previously used a mechanism (not using Apache) where I would generate the
</I>&gt;<i> response, then take a hash of it and if it matched the hash of the last
</I>&gt;<i> response I sent, I would instead send a &quot;304: Not Modified&quot;.
</I>&gt;<i>
</I>&gt;<i> My problem is that when using PSP.run(), the response has already been sent
</I>&gt;<i> by the time it's finished being generated, so I have no opportunity to step
</I>&gt;<i> in and examine the response to see if sending a 304 is possible.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I'm needing an across-the-board mechanism for dealing with this - I thought
</I>&gt;<i> of serializing the &quot;vars&quot; dictionary before passing it in and taking a hash
</I>&gt;<i> of that for comparison, but this is hardly full-proof, as it would
</I>&gt;<i> (incorrectly) lead to responding with a 304 even with different &quot;session&quot;
</I>&gt;<i> information, or, in the slightly odd case that the PSP file made use of
</I>&gt;<i> random.random(), etc.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Just a thought: Is there a more general mechanism that can detect identical
</I>&gt;<i> content to a previous response on the way out and replace it with a 304?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Thanks in advance,
</I>&gt;<i>
</I>&gt;<i> Aaron.
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mod_python mailing list
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I>&gt;<i>
</I>&gt;<i>
</I></PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="023937.html">[mod_python] Checking a PSP-generated response before starting to
	send it..?
</A></li>
	<LI>Next message: <A HREF="023940.html">[mod_python] Checking a PSP-generated response before starting to
	send it..?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#23938">[ date ]</a>
              <a href="thread.html#23938">[ thread ]</a>
              <a href="subject.html#23938">[ subject ]</a>
              <a href="author.html#23938">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="DISABLEhttp://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
