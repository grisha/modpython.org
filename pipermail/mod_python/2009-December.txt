From dave at davebritton.com  Tue Dec  1 09:50:04 2009
From: dave at davebritton.com (Dave Britton)
Date: Tue Dec  1 09:50:36 2009
Subject: [SPAM] Re: [mod_python] mod_python adapter for mod_wsgi in the make
In-Reply-To: <88e286470911270346i23c69831v4fadf2b6fb09acb8@mail.gmail.com>
References: <c2f9e3c20911122342g58179609s1bb0046b24ac6240@mail.gmail.com>
	<c2f9e3c20911122345i3812ac58qc69974240f980a65@mail.gmail.com>
	<a595de7a0911130107y1067a22exd498225e8aa4baf3@mail.gmail.com>
	<c2f9e3c20911130153y4f16535bg2759654e7cf92c86@mail.gmail.com>
	<a595de7a0911130256i6c82a8c4o1dfb199726e12a73@mail.gmail.com>
	<B6C73A5E30565245BB6D32B5F5DF7A52120724@sense.emmastraat.pijnacker>
	<88e286470911270346i23c69831v4fadf2b6fb09acb8@mail.gmail.com>
Message-ID: <1259679004.9290.2.camel@greenbox>

On Fri, 2009-11-27 at 22:46 +1100, Graham Dumpleton wrote:

> A few questions.
> 
> If you don't use publisher, what parts do you use?
> 
> 1. PSP?
> 2. cgihandler?
> 3. FieldStorage?
> 4. Session?
> 5. Cookie?
> 6. import_module() and import overlay?
> 7. request_rec, server_rec, conn_rec wrappers?
> 8. ap_internal_redirect() wrappers?
> 
> Overall, what is it about mod_python that you are doing would make it
> a better platform that WSGI?
> 
> Are you aiming for 100% compatibility or more just the style of
> writing applications?
> 
> Some stuff like Cookie and FieldStorage could be switched to more
> modern Python standard library equivalents, but obviously they would
> not be wholly interface compatible.

* I want an easy, straightforward way to create web applications with
python scripts. MP/Publisher provided that, more or less, easier than
WSGI by itself, where I need to use yet another wrapper, all of which
have added baggage to learn and problems to find out about and features
to avoid using. 
* Basically, all I mostly need to do is efficiently process forms POSTed
with hidden variables, so easy management of cgi variables is important,
eg. FieldStorage. 
* I really like the ability to hide the dot-py file extension that MP
offered, although it always seemed finicky to muck about in the apache
conf to get the precise combination of Add and Set handlers and
Directory specs required. 
* Being able to import new modules without restarting apache would be
nice. WSGI seems an improvement in both of these last two regards. 
* I never trusted cookies or sessions in MP so I do them myself with
MySQL and a passed-in cgi token, so a trustable database connection
management system would be convenient, although I admit I have always
opened and closed connections just when and only while needed, with no
apparent performance problems, and had a warm feeling inside that the
data always got saved, offset ocassionally when I forgot to close a
connection and crashed the system with too many open.
* I never used psp, preferring to incorporate my html inside functions
instead of vice versa. 
* Internal redirection was something that I have occasionally made use
of, and would like to have available from within my python scripts,
easily. Not having to deal with headers etc. is a nice thing too.
Thanks for asking!
-Dave 

From graham.dumpleton at gmail.com  Tue Dec  1 17:33:10 2009
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Tue Dec  1 17:33:20 2009
Subject: [SPAM] Re: [mod_python] mod_python adapter for mod_wsgi in the 
	make
In-Reply-To: <1259679004.9290.2.camel@greenbox>
References: <c2f9e3c20911122342g58179609s1bb0046b24ac6240@mail.gmail.com>
	<c2f9e3c20911122345i3812ac58qc69974240f980a65@mail.gmail.com>
	<a595de7a0911130107y1067a22exd498225e8aa4baf3@mail.gmail.com>
	<c2f9e3c20911130153y4f16535bg2759654e7cf92c86@mail.gmail.com>
	<a595de7a0911130256i6c82a8c4o1dfb199726e12a73@mail.gmail.com>
	<B6C73A5E30565245BB6D32B5F5DF7A52120724@sense.emmastraat.pijnacker>
	<88e286470911270346i23c69831v4fadf2b6fb09acb8@mail.gmail.com>
	<1259679004.9290.2.camel@greenbox>
Message-ID: <88e286470912011433p8750ecas32a798999a38f4b4@mail.gmail.com>

2009/12/2 Dave Britton <dave@davebritton.com>:
> On Fri, 2009-11-27 at 22:46 +1100, Graham Dumpleton wrote:
>
>> A few questions.
>>
>> If you don't use publisher, what parts do you use?
>>
>> 1. PSP?
>> 2. cgihandler?
>> 3. FieldStorage?
>> 4. Session?
>> 5. Cookie?
>> 6. import_module() and import overlay?
>> 7. request_rec, server_rec, conn_rec wrappers?
>> 8. ap_internal_redirect() wrappers?
>>
>> Overall, what is it about mod_python that you are doing would make it
>> a better platform that WSGI?
>>
>> Are you aiming for 100% compatibility or more just the style of
>> writing applications?
>>
>> Some stuff like Cookie and FieldStorage could be switched to more
>> modern Python standard library equivalents, but obviously they would
>> not be wholly interface compatible.
>
> * I want an easy, straightforward way to create web applications with
> python scripts. MP/Publisher provided that, more or less, easier than
> WSGI by itself, where I need to use yet another wrapper, all of which
> have added baggage to learn and problems to find out about and features
> to avoid using.
> * Basically, all I mostly need to do is efficiently process forms POSTed
> with hidden variables, so easy management of cgi variables is important,
> eg. FieldStorage.
> * I really like the ability to hide the dot-py file extension that MP
> offered, although it always seemed finicky to muck about in the apache
> conf to get the precise combination of Add and Set handlers and
> Directory specs required.

You can get URLs with no file extension with mod_wsgi as well. See:

http://code.google.com/p/modwsgi/wiki/ConfigurationGuidelines#The_Apache_Alias_Directive

In particular where it talks about MultiViews and MultiViewsMatch.

> * Being able to import new modules without restarting apache would be
> nice. WSGI seems an improvement in both of these last two regards.
> * I never trusted cookies or sessions in MP so I do them myself with
> MySQL and a passed-in cgi token, so a trustable database connection
> management system would be convenient, although I admit I have always
> opened and closed connections just when and only while needed, with no
> apparent performance problems, and had a warm feeling inside that the
> data always got saved, offset ocassionally when I forgot to close a
> connection and crashed the system with too many open.
> * I never used psp, preferring to incorporate my html inside functions
> instead of vice versa.
> * Internal redirection was something that I have occasionally made use
> of, and would like to have available from within my python scripts,
> easily. Not having to deal with headers etc. is a nice thing too.

Thanks for the feedback. More useful input into my thinking about
various things.

Graham
From martijn at xs4us.nu  Tue Dec  1 18:36:53 2009
From: martijn at xs4us.nu (Martijn Moeling)
Date: Tue Dec  1 18:38:21 2009
Subject: [SPAM] Re: [mod_python] mod_python adapter for mod_wsgi in the
	make
In-Reply-To: <88e286470912011433p8750ecas32a798999a38f4b4@mail.gmail.com>
References: <c2f9e3c20911122342g58179609s1bb0046b24ac6240@mail.gmail.com>
	<c2f9e3c20911122345i3812ac58qc69974240f980a65@mail.gmail.com>
	<a595de7a0911130107y1067a22exd498225e8aa4baf3@mail.gmail.com>
	<c2f9e3c20911130153y4f16535bg2759654e7cf92c86@mail.gmail.com>
	<a595de7a0911130256i6c82a8c4o1dfb199726e12a73@mail.gmail.com>
	<B6C73A5E30565245BB6D32B5F5DF7A52120724@sense.emmastraat.pijnacker>
	<88e286470911270346i23c69831v4fadf2b6fb09acb8@mail.gmail.com>
	<1259679004.9290.2.camel@greenbox>
	<88e286470912011433p8750ecas32a798999a38f4b4@mail.gmail.com>
Message-ID: <298CB4E3-91E0-4D8C-8C68-831DF8B7131C@xs4us.nu>

I comply in general with dave.
The possibility to set handlers to a python function with pythonic  
request object is both simple and flexible. From that respect mp was  
for me the way to go to start development. Clear config in httpd.conf,  
clear way to code

Martijn



On 1 dec 2009, at 23:44, "Graham Dumpleton"  
<graham.dumpleton@gmail.com> wrote:

> 2009/12/2 Dave Britton <dave@davebritton.com>:
>> On Fri, 2009-11-27 at 22:46 +1100, Graham Dumpleton wrote:
>>
>>> A few questions.
>>>
>>> If you don't use publisher, what parts do you use?
>>>
>>> 1. PSP?
>>> 2. cgihandler?
>>> 3. FieldStorage?
>>> 4. Session?
>>> 5. Cookie?
>>> 6. import_module() and import overlay?
>>> 7. request_rec, server_rec, conn_rec wrappers?
>>> 8. ap_internal_redirect() wrappers?
>>>
>>> Overall, what is it about mod_python that you are doing would make  
>>> it
>>> a better platform that WSGI?
>>>
>>> Are you aiming for 100% compatibility or more just the style of
>>> writing applications?
>>>
>>> Some stuff like Cookie and FieldStorage could be switched to more
>>> modern Python standard library equivalents, but obviously they would
>>> not be wholly interface compatible.
>>
>> * I want an easy, straightforward way to create web applications with
>> python scripts. MP/Publisher provided that, more or less, easier than
>> WSGI by itself, where I need to use yet another wrapper, all of which
>> have added baggage to learn and problems to find out about and  
>> features
>> to avoid using.
>> * Basically, all I mostly need to do is efficiently process forms  
>> POSTed
>> with hidden variables, so easy management of cgi variables is  
>> important,
>> eg. FieldStorage.
>> * I really like the ability to hide the dot-py file extension that MP
>> offered, although it always seemed finicky to muck about in the  
>> apache
>> conf to get the precise combination of Add and Set handlers and
>> Directory specs required.
>
> You can get URLs with no file extension with mod_wsgi as well. See:
>
> http://code.google.com/p/modwsgi/wiki/ConfigurationGuidelines#The_Apache_Alias_Directive
>
> In particular where it talks about MultiViews and MultiViewsMatch.
>
>> * Being able to import new modules without restarting apache would be
>> nice. WSGI seems an improvement in both of these last two regards.
>> * I never trusted cookies or sessions in MP so I do them myself with
>> MySQL and a passed-in cgi token, so a trustable database connection
>> management system would be convenient, although I admit I have always
>> opened and closed connections just when and only while needed, with  
>> no
>> apparent performance problems, and had a warm feeling inside that the
>> data always got saved, offset ocassionally when I forgot to close a
>> connection and crashed the system with too many open.
>> * I never used psp, preferring to incorporate my html inside  
>> functions
>> instead of vice versa.
>> * Internal redirection was something that I have occasionally made  
>> use
>> of, and would like to have available from within my python scripts,
>> easily. Not having to deal with headers etc. is a nice thing too.
>
> Thanks for the feedback. More useful input into my thinking about
> various things.
>
> Graham
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
From lgp171188 at gmail.com  Sat Dec  5 16:26:50 2009
From: lgp171188 at gmail.com (Guruprasad)
Date: Sat Dec  5 16:27:36 2009
Subject: [mod_python] Issues with multiple instances of mod_python websites
	on the same machine
Message-ID: <7c956f0c0912051326r36a6b450qbc2885e76bd18ebc@mail.gmail.com>

Hi all,
In our college, we have a mod_python based web application for our
intranet portal. We have a local testbed where the student devs have
their own logins and they work on their own subversion working copies
and publish their sites using mod_python configuration in
/etc/apache2/sites-available/default and userdir module. But we very
often face a problem like this.

All the users have their own copies of the web application and when
one user opens and navigates through the web application when other
user is doing the same with his copy, on clicking links and all, all
the addresses start getting changed into those of the other user and
not mine. We use Debian Lenny and the versions of apache2 and
mod_python shipped with them with the mpm-prefork module. How to avoid
such an issue.

For example when I click on a link in a site
http://localhost/~user1/blah it gets changed it to
http://localhost/~user2/blah and causes confusions. This issue happens
only when the users publish their own sites.



-- 
Thank you.

Regards,
Guruprasad.
From graham.dumpleton at gmail.com  Sun Dec  6 05:22:08 2009
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Sun Dec  6 05:22:17 2009
Subject: [mod_python] Issues with multiple instances of mod_python 
	websites on the same machine
In-Reply-To: <7c956f0c0912051326r36a6b450qbc2885e76bd18ebc@mail.gmail.com>
References: <7c956f0c0912051326r36a6b450qbc2885e76bd18ebc@mail.gmail.com>
Message-ID: <88e286470912060222l377654fcn55c09e0e70a5ce7e@mail.gmail.com>

Each user must be given a separate Python sub interpreter instance to
run their copy of the application in. This is done using the
PythonInterpreter directive. Thus, set this directive inside of a
Directory directive unique to web directory inside users account. For
example:

<Directory /home/joe/public_html>
PythonInterpreter user:joe
</Directory>

<Directory /home/bob/public_html>
PythonInterpreter user:bob
</Directory>

Graham

2009/12/6 Guruprasad <lgp171188@gmail.com>:
> Hi all,
> In our college, we have a mod_python based web application for our
> intranet portal. We have a local testbed where the student devs have
> their own logins and they work on their own subversion working copies
> and publish their sites using mod_python configuration in
> /etc/apache2/sites-available/default and userdir module. But we very
> often face a problem like this.
>
> All the users have their own copies of the web application and when
> one user opens and navigates through the web application when other
> user is doing the same with his copy, on clicking links and all, all
> the addresses start getting changed into those of the other user and
> not mine. We use Debian Lenny and the versions of apache2 and
> mod_python shipped with them with the mpm-prefork module. How to avoid
> such an issue.
>
> For example when I click on a link in a site
> http://localhost/~user1/blah it gets changed it to
> http://localhost/~user2/blah and causes confusions. This issue happens
> only when the users publish their own sites.
>
>
>
> --
> Thank you.
>
> Regards,
> Guruprasad.
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
From lgp171188 at gmail.com  Sun Dec  6 05:46:11 2009
From: lgp171188 at gmail.com (L.Guruprasad)
Date: Sun Dec  6 05:46:29 2009
Subject: [mod_python] Issues with multiple instances of mod_python websites
	on the same machine
In-Reply-To: <88e286470912060222l377654fcn55c09e0e70a5ce7e@mail.gmail.com>
References: <7c956f0c0912051326r36a6b450qbc2885e76bd18ebc@mail.gmail.com>
	<88e286470912060222l377654fcn55c09e0e70a5ce7e@mail.gmail.com>
Message-ID: <4B1B8B73.2010600@gmail.com>

Hi,
Graham Dumpleton wrote:
> Each user must be given a separate Python sub interpreter instance to
> run their copy of the application in. This is done using the
> PythonInterpreter directive. Thus, set this directive inside of a
> Directory directive unique to web directory inside users account. For
> example:
> 
> <Directory /home/joe/public_html>
> PythonInterpreter user:joe
> </Directory>
> 
> <Directory /home/bob/public_html>
> PythonInterpreter user:bob
> </Directory>
> 
> Graham


Thank you Graham. This solves the issue. :-)

Regards,
Guruprasad
From daniel.klaffenbach at informatik.tu-chemnitz.de  Thu Dec 10 11:57:51 2009
From: daniel.klaffenbach at informatik.tu-chemnitz.de (Daniel Klaffenbach)
Date: Thu Dec 10 11:58:29 2009
Subject: [mod_python] Credential caching for Apache/mod_python
Message-ID: <200912101757.57949.daniel.klaffenbach@informatik.tu-chemnitz.de>

Hi,

in my setup mod_python is being used for authentication (with 
PythonAuthenHandler). The Authentication process is pretty complex 
(hybrid mySQL/RADIUS).

Authentication with mod_python itself works very well on this setup. 
However there are some speed and server load issues. We are serving 
mostly SVN and WebDAV stuff over https.

Now whenever a user wants to upload a large number of small files to 
his/her DAV share, quite a few WebDAV commands are being issued.

The problem is that for every simple DAV command (PROPFIND, GET, 
OPTIONS,...) the Python auth handler is being asked if the 
user-provided credentials are valid - Apache does not seem to do any caching.

As a result of this the RADIUS and mySQL Servers are being asked for a 
username/password TWICE for every single file the user uploads, 
downloads or just lists in a directory, which is *really* bad.

So my question is: Is there a good way of telling Apache and/or 
mod_python to cache the "apache.OK" reply from the Python auth handler 
for a few seconds?

BTW: I am on Scientific Linux 5.3 with Apache 2.2.3 and mod_python 3.2.8.

Thanks in advance!


- Dan Klaffenbach
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 198 bytes
Desc: This is a digitally signed message part.
Url : http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20091210/315f8e3e/attachment.bin
From alertmaster at yahoo.com  Thu Dec 10 13:35:47 2009
From: alertmaster at yahoo.com (Samuel Hazelett)
Date: Thu Dec 10 13:35:54 2009
Subject: [mod_python] (no subject)
Message-ID: <107845.58302.qm@web57201.mail.re3.yahoo.com>





      
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20091210/46e40e53/attachment.html
From graham.dumpleton at gmail.com  Thu Dec 10 15:48:35 2009
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Thu Dec 10 15:48:44 2009
Subject: [mod_python] Credential caching for Apache/mod_python
In-Reply-To: <200912101757.57949.daniel.klaffenbach@informatik.tu-chemnitz.de>
References: <200912101757.57949.daniel.klaffenbach@informatik.tu-chemnitz.de>
Message-ID: <88e286470912101248g281bd74o6369d22cbce34475@mail.gmail.com>

2009/12/11 Daniel Klaffenbach <daniel.klaffenbach@informatik.tu-chemnitz.de>:
> Hi,
>
> in my setup mod_python is being used for authentication (with
> PythonAuthenHandler). The Authentication process is pretty complex (hybrid
> mySQL/RADIUS).
>
> Authentication with mod_python itself works very well on this setup. However
> there are some speed and server load issues. We are serving mostly SVN and
> WebDAV stuff over https.
>
> Now whenever a user wants to upload a large number of small files to his/her
> DAV share, quite a few WebDAV commands are being issued.
>
> The problem is that for every simple DAV command (PROPFIND, GET,
> OPTIONS,...) the Python auth handler is being asked if the user-provided
> credentials are valid - Apache does not seem to do any caching.
>
> As a result of this the RADIUS and mySQL Servers are being asked for a
> username/password TWICE for every single file the user uploads, downloads or
> just lists in a directory, which is *really* bad.
>
> So my question is: Is there a good way of telling Apache and/or mod_python
> to cache the "apache.OK" reply from the Python auth handler for a few
> seconds?
>
> BTW: I am on Scientific Linux 5.3 with Apache 2.2.3 and mod_python 3.2.8.

You should upgrade to mod_python 3.3.1 for a start, that older
versions has lots of bugs in it.

As to your issue, it is up to you to perform caching within your
authentication handler. You can keep a dictionary cache of whether
someone has successfully authenticated and when. If they requested
previously within some defined period, let them in again without
rechecking authentication. If period to great, expire information in
cache and reauthenticate them against the back end.

Graham
From daniel.klaffenbach at informatik.tu-chemnitz.de  Thu Dec 10 17:12:14 2009
From: daniel.klaffenbach at informatik.tu-chemnitz.de (Daniel Klaffenbach)
Date: Thu Dec 10 17:13:02 2009
Subject: [mod_python] Credential caching for Apache/mod_python
In-Reply-To: <88e286470912101248g281bd74o6369d22cbce34475@mail.gmail.com>
References: <200912101757.57949.daniel.klaffenbach@informatik.tu-chemnitz.de>
	<88e286470912101248g281bd74o6369d22cbce34475@mail.gmail.com>
Message-ID: <200912102312.31989.daniel.klaffenbach@informatik.tu-chemnitz.de>

Am Donnerstag 10 Dezember 2009 21:48:35 schrieben Sie:
> You should upgrade to mod_python 3.3.1 for a start, that older
> versions has lots of bugs in it.
OK, I'll look into it. The problem is that I have to use the packages from the 
SL repository, which kind of prevents me from upgrading. So far I did not 
experience any problems with the "old" version.

> As to your issue, it is up to you to perform caching within your
> authentication handler. You can keep a dictionary cache of whether
> someone has successfully authenticated and when.
OK, this is what I already had in mind, but I hoped there was another way. I 
guess I'll have to take care about caching by myself.

Thanks for the quick reply.


- Dan
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 198 bytes
Desc: This is a digitally signed message part.
Url : http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20091210/73d5fd08/attachment.bin
From alertmaster at yahoo.com  Thu Dec 10 17:37:11 2009
From: alertmaster at yahoo.com (Samuel Hazelett)
Date: Thu Dec 10 17:37:19 2009
Subject: [mod_python] mp 3.3.1 incompatible windows binaries won't install
	with py 2.6
Message-ID: <577467.50557.qm@web57203.mail.re3.yahoo.com>

Is there an upgrade of mod_python installer for windows to work with my python 2.6 installation?
Is there an uninstaller for python 2.6 so I can drop back to 2.5?
Will the "Add or remove programs" piece of the Windows control panel take care of the registry entries well enough?

Thanks, 

newbie



      
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20091210/ff3a8e78/attachment.html
From graham.dumpleton at gmail.com  Thu Dec 10 17:50:56 2009
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Thu Dec 10 17:51:09 2009
Subject: [mod_python] mp 3.3.1 incompatible windows binaries won't install
	with py 2.6
In-Reply-To: <577467.50557.qm@web57203.mail.re3.yahoo.com>
References: <577467.50557.qm@web57203.mail.re3.yahoo.com>
Message-ID: <88e286470912101450r1dcf1d6dif208f371a20012cf@mail.gmail.com>

2009/12/11 Samuel Hazelett <alertmaster@yahoo.com>:
> Is there an upgrade of mod_python installer for windows to work with my
> python 2.6 installation?

No.

> Is there an uninstaller for python 2.6 so I can drop back to 2.5?

Presumably part of the Python installation itself.

If you don't need mod_python specific features and are just wanting to
host a Python web application that supports the WSGI interface,
considering using Apache/mod_wsgi instead.

  http://www.modwsgi.org
  http://code.google.com/p/modwsgi/wiki/InstallationOnWindows

Graham
From p.m.robinson at bham.ac.uk  Tue Dec 15 19:12:30 2009
From: p.m.robinson at bham.ac.uk (Peter Robinson)
Date: Tue Dec 15 19:12:50 2009
Subject: [mod_python] Using mod_python Berkeley DB XML, XmlManager,
	with MacOSX Tiger/Leopard/SnowLeopard (again)
Message-ID: <82747AA0-2D0E-4528-ADA3-D83590BD565E@bham.ac.uk>

Folks
Last March there was a thread on the problems of getting mod_python  
running with Apache in Mac OSX, with a very thorough discussion by  
Graham Dumpleton a.o. on how to make it work.  (see http://www.modpython.org/pipermail/mod_python/2008-March/024955.html 
  ; also
http://www.modpython.org/pipermail/mod_python/2007-October/ 
024376.html).  This discussion should have solved the issue forever.   
Alas, it has not .. for me anyway.
In trying to run mod_python with Berkeley DB XML, in the mod_wsgi  
incarnation, an older problem has resurfaced.  This is to do with  
Apache locking up when python tries to access the key XmlManager class  
in bdbxml. A discussion on this list http://www.modpython.org/pipermail/mod_python/2007-April/023445.html 
  , under the topic Global Interpreter Lock problem with Berkeley DB  
XML and mod_python, dealt with this.  Graham (again) suggested two  
fixes:
1. recompile bdbxml with the compiler option -DSWIG_PYTHON_NO_USE_GIL
2.  reinstall the python bindings, editing dbxml/dist/s_swig so that '- 
threads' isn't in swig_args for Python
I tried the second, and this changed nothing.  I cannot figure out how  
to do the first (sh buildall.sh  --with-berkeleydb-conf=- 
DSWIG_PYTHON_NO_USE_GIL
and sh buildall.sh  --with-dbxml-conf=-DSWIG_PYTHON_NO_USE_GIL fail)...
so help would be really helpful!
I am trying to do this on SnowLeopard.
Peter
Peter Robinson
Institute for Textual Scholarship and Electronic Editing
Elmfield House, Selly Oak  Campus
University of Birmingham
Edgbaston B29 6LG
P.M.Robinson@bham.ac.uk
p. +44 (0)121 4158441, f. +44 (0) 121 415 8376
www.itsee.bham.ac.uk



From graham.dumpleton at gmail.com  Tue Dec 15 19:34:03 2009
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Tue Dec 15 19:34:12 2009
Subject: [mod_python] Using mod_python Berkeley DB XML, XmlManager, with 
	MacOSX Tiger/Leopard/SnowLeopard (again)
In-Reply-To: <82747AA0-2D0E-4528-ADA3-D83590BD565E@bham.ac.uk>
References: <82747AA0-2D0E-4528-ADA3-D83590BD565E@bham.ac.uk>
Message-ID: <88e286470912151634o28478c4fua21faff6aa3443e6@mail.gmail.com>

Are you definitely using PythonInterpreter set to 'main_interpreter'?

Are you stuck with using mod_python? Any way you can use mod_wsgi?

Since been discovered that even in main interpreter, mod_python's
usage of GIL thread state APIs is wrong. The mod_wsgi module gets it
right, although still have to tell mod_wsgi to use main interpreter as
well to avoid other issues.

Graham

2009/12/16 Peter Robinson <p.m.robinson@bham.ac.uk>:
> Folks
> Last March there was a thread on the problems of getting mod_python running
> with Apache in Mac OSX, with a very thorough discussion by Graham Dumpleton
> a.o. on how to make it work. ?(see
> http://www.modpython.org/pipermail/mod_python/2008-March/024955.html?; also
> http://www.modpython.org/pipermail/mod_python/2007-October/024376.html).
> ?This discussion should have solved the issue forever. ?Alas, it has not ..
> for me anyway.
> In trying to run mod_python with Berkeley DB XML, in the mod_wsgi
> incarnation, an older problem has resurfaced. ?This is to do with Apache
> locking up when python tries to access the key XmlManager class in bdbxml. A
> discussion on this list
> http://www.modpython.org/pipermail/mod_python/2007-April/023445.html?, under
> the topic Global Interpreter Lock problem with Berkeley DB XML and
> mod_python, dealt with this. ?Graham (again) suggested two fixes:
> 1. recompile bdbxml with the compiler option -DSWIG_PYTHON_NO_USE_GIL
> 2. ?reinstall the python bindings, editing dbxml/dist/s_swig so that
> '-threads' isn't in swig_args for Python
> I tried the second, and this changed nothing. ?I cannot figure out how to do
> the first (sh buildall.sh ?--with-berkeleydb-conf=-DSWIG_PYTHON_NO_USE_GIL
> and sh buildall.sh ?--with-dbxml-conf=-DSWIG_PYTHON_NO_USE_GIL fail)...
> so help would be really helpful!
> I am trying to do this on SnowLeopard.

From p.m.robinson at bham.ac.uk  Tue Dec 15 21:22:54 2009
From: p.m.robinson at bham.ac.uk (Peter Robinson)
Date: Tue Dec 15 21:23:05 2009
Subject: [mod_python] Using mod_python Berkeley DB XML, XmlManager, with
	MacOSX Tiger/Leopard/SnowLeopard (again)
In-Reply-To: <88e286470912151634o28478c4fua21faff6aa3443e6@mail.gmail.com>
References: <82747AA0-2D0E-4528-ADA3-D83590BD565E@bham.ac.uk>,
	<88e286470912151634o28478c4fua21faff6aa3443e6@mail.gmail.com>
Message-ID: <81FE5D570D9C664089E44A571FB586A10987EF2E@cal-eva-srv1>

Indeed I am using mod_wsgi. However, I cannot see how to set PythonInterpreter to 'main_interpreter'. So far as I can judge, this should be done through a declaration such as this in httpd.conf:
<Location /SDPublisher>
   SetHandler mod_wsgi
   PythonInterpreter main_interpreter
</Location>

(according to what I could find at http://trac.edgewall.org/wiki/TracModPython)
but this does not work, or rather Apache will not start with this included.
help..!

________________________________________
From: Graham Dumpleton [graham.dumpleton@gmail.com]
Sent: Wednesday, December 16, 2009 12:34 AM
To: Peter Robinson
Cc: mod_python@modpython.org
Subject: Re: [mod_python] Using mod_python Berkeley DB XML, XmlManager, with    MacOSX Tiger/Leopard/SnowLeopard (again)

Are you definitely using PythonInterpreter set to 'main_interpreter'?

Are you stuck with using mod_python? Any way you can use mod_wsgi?

Since been discovered that even in main interpreter, mod_python's
usage of GIL thread state APIs is wrong. The mod_wsgi module gets it
right, although still have to tell mod_wsgi to use main interpreter as
well to avoid other issues.

Graham

2009/12/16 Peter Robinson <p.m.robinson@bham.ac.uk>:
> Folks
> Last March there was a thread on the problems of getting mod_python running
> with Apache in Mac OSX, with a very thorough discussion by Graham Dumpleton
> a.o. on how to make it work.  (see
> http://www.modpython.org/pipermail/mod_python/2008-March/024955.html ; also
> http://www.modpython.org/pipermail/mod_python/2007-October/024376.html).
>  This discussion should have solved the issue forever.  Alas, it has not ..
> for me anyway.
> In trying to run mod_python with Berkeley DB XML, in the mod_wsgi
> incarnation, an older problem has resurfaced.  This is to do with Apache
> locking up when python tries to access the key XmlManager class in bdbxml. A
> discussion on this list
> http://www.modpython.org/pipermail/mod_python/2007-April/023445.html , under
> the topic Global Interpreter Lock problem with Berkeley DB XML and
> mod_python, dealt with this.  Graham (again) suggested two fixes:
> 1. recompile bdbxml with the compiler option -DSWIG_PYTHON_NO_USE_GIL
> 2.  reinstall the python bindings, editing dbxml/dist/s_swig so that
> '-threads' isn't in swig_args for Python
> I tried the second, and this changed nothing.  I cannot figure out how to do
> the first (sh buildall.sh  --with-berkeleydb-conf=-DSWIG_PYTHON_NO_USE_GIL
> and sh buildall.sh  --with-dbxml-conf=-DSWIG_PYTHON_NO_USE_GIL fail)...
> so help would be really helpful!
> I am trying to do this on SnowLeopard.

From graham.dumpleton at gmail.com  Tue Dec 15 21:30:29 2009
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Tue Dec 15 21:30:38 2009
Subject: [mod_python] Using mod_python Berkeley DB XML, XmlManager, with 
	MacOSX Tiger/Leopard/SnowLeopard (again)
In-Reply-To: <81FE5D570D9C664089E44A571FB586A10987EF2E@cal-eva-srv1>
References: <82747AA0-2D0E-4528-ADA3-D83590BD565E@bham.ac.uk>
	<88e286470912151634o28478c4fua21faff6aa3443e6@mail.gmail.com>
	<81FE5D570D9C664089E44A571FB586A10987EF2E@cal-eva-srv1>
Message-ID: <88e286470912151830y72a44d33h67e185e0367eb87@mail.gmail.com>

If you are using mod_wsgi, why are you asking on the mod_python list?

This particular issue for mod_wsgi is documented in:

http://code.google.com/p/modwsgi/wiki/ApplicationIssues#Python_Simplified_GIL_State_API

It explicitly tells you to use:

  WSGIApplicationGroup %{GLOBAL}

This is equivalent to the mod_python version of setting
PythonInterpreter to main_interpreter. Although the mod_python way
only works for mod_python, as the above only works for mod_wsgi.

Also be aware that if you still load mod_python at same time into
Apache, you might encounter over issues or loose some functionality of
mod_wsgi. If you no longer need mod_python, do not continue loading it
into Apache.

Graham

2009/12/16 Peter Robinson <p.m.robinson@bham.ac.uk>:
> Indeed I am using mod_wsgi. However, I cannot see how to set PythonInterpreter to 'main_interpreter'. So far as I can judge, this should be done through a declaration such as this in httpd.conf:
> <Location /SDPublisher>
> ? SetHandler mod_wsgi
> ? PythonInterpreter main_interpreter
> </Location>
>
> (according to what I could find at http://trac.edgewall.org/wiki/TracModPython)
> but this does not work, or rather Apache will not start with this included.
> help..!
>
> ________________________________________
> From: Graham Dumpleton [graham.dumpleton@gmail.com]
> Sent: Wednesday, December 16, 2009 12:34 AM
> To: Peter Robinson
> Cc: mod_python@modpython.org
> Subject: Re: [mod_python] Using mod_python Berkeley DB XML, XmlManager, with ? ?MacOSX Tiger/Leopard/SnowLeopard (again)
>
> Are you definitely using PythonInterpreter set to 'main_interpreter'?
>
> Are you stuck with using mod_python? Any way you can use mod_wsgi?
>
> Since been discovered that even in main interpreter, mod_python's
> usage of GIL thread state APIs is wrong. The mod_wsgi module gets it
> right, although still have to tell mod_wsgi to use main interpreter as
> well to avoid other issues.
>
> Graham
>
> 2009/12/16 Peter Robinson <p.m.robinson@bham.ac.uk>:
>> Folks
>> Last March there was a thread on the problems of getting mod_python running
>> with Apache in Mac OSX, with a very thorough discussion by Graham Dumpleton
>> a.o. on how to make it work. ?(see
>> http://www.modpython.org/pipermail/mod_python/2008-March/024955.html ; also
>> http://www.modpython.org/pipermail/mod_python/2007-October/024376.html).
>> ?This discussion should have solved the issue forever. ?Alas, it has not ..
>> for me anyway.
>> In trying to run mod_python with Berkeley DB XML, in the mod_wsgi
>> incarnation, an older problem has resurfaced. ?This is to do with Apache
>> locking up when python tries to access the key XmlManager class in bdbxml. A
>> discussion on this list
>> http://www.modpython.org/pipermail/mod_python/2007-April/023445.html , under
>> the topic Global Interpreter Lock problem with Berkeley DB XML and
>> mod_python, dealt with this. ?Graham (again) suggested two fixes:
>> 1. recompile bdbxml with the compiler option -DSWIG_PYTHON_NO_USE_GIL
>> 2. ?reinstall the python bindings, editing dbxml/dist/s_swig so that
>> '-threads' isn't in swig_args for Python
>> I tried the second, and this changed nothing. ?I cannot figure out how to do
>> the first (sh buildall.sh ?--with-berkeleydb-conf=-DSWIG_PYTHON_NO_USE_GIL
>> and sh buildall.sh ?--with-dbxml-conf=-DSWIG_PYTHON_NO_USE_GIL fail)...
>> so help would be really helpful!
>> I am trying to do this on SnowLeopard.
>

From p.m.robinson at bham.ac.uk  Tue Dec 15 21:55:09 2009
From: p.m.robinson at bham.ac.uk (Peter Robinson)
Date: Tue Dec 15 21:59:48 2009
Subject: [mod_python] Using mod_python Berkeley DB XML, XmlManager, with
	MacOSX Tiger/Leopard/SnowLeopard (again)
In-Reply-To: <88e286470912151830y72a44d33h67e185e0367eb87@mail.gmail.com>
References: <82747AA0-2D0E-4528-ADA3-D83590BD565E@bham.ac.uk>
	<88e286470912151634o28478c4fua21faff6aa3443e6@mail.gmail.com>
	<81FE5D570D9C664089E44A571FB586A10987EF2E@cal-eva-srv1>,
	<88e286470912151830y72a44d33h67e185e0367eb87@mail.gmail.com>
Message-ID: <81FE5D570D9C664089E44A571FB586A10987EF2F@cal-eva-srv1>

Graham
you are right: I started out installing mod-python, then realized that mod?wsgi is now the way to go. I posted to the mod python group because that was where the earlier correspondence was.
So, yes, I see now that the magic line is
WSGIApplicationGroup %{GLOBAL}
but where should this go... the google site does not make this clear.  If I put it in httpd.conf it stops apache loading.  Should it go in the swig file?
Peter
________________________________________
From: Graham Dumpleton [graham.dumpleton@gmail.com]
Sent: Wednesday, December 16, 2009 2:30 AM
To: Peter Robinson
Cc: mod_python@modpython.org
Subject: Re: [mod_python] Using mod_python Berkeley DB XML, XmlManager, with    MacOSX Tiger/Leopard/SnowLeopard (again)

If you are using mod_wsgi, why are you asking on the mod_python list?

This particular issue for mod_wsgi is documented in:

http://code.google.com/p/modwsgi/wiki/ApplicationIssues#Python_Simplified_GIL_State_API

It explicitly tells you to use:

  WSGIApplicationGroup %{GLOBAL}

This is equivalent to the mod_python version of setting
PythonInterpreter to main_interpreter. Although the mod_python way
only works for mod_python, as the above only works for mod_wsgi.

Also be aware that if you still load mod_python at same time into
Apache, you might encounter over issues or loose some functionality of
mod_wsgi. If you no longer need mod_python, do not continue loading it
into Apache.

Graham

2009/12/16 Peter Robinson <p.m.robinson@bham.ac.uk>:
> Indeed I am using mod_wsgi. However, I cannot see how to set PythonInterpreter to 'main_interpreter'. So far as I can judge, this should be done through a declaration such as this in httpd.conf:
> <Location /SDPublisher>
>   SetHandler mod_wsgi
>   PythonInterpreter main_interpreter
> </Location>
>
> (according to what I could find at http://trac.edgewall.org/wiki/TracModPython)
> but this does not work, or rather Apache will not start with this included.
> help..!
>
> ________________________________________
> From: Graham Dumpleton [graham.dumpleton@gmail.com]
> Sent: Wednesday, December 16, 2009 12:34 AM
> To: Peter Robinson
> Cc: mod_python@modpython.org
> Subject: Re: [mod_python] Using mod_python Berkeley DB XML, XmlManager, with    MacOSX Tiger/Leopard/SnowLeopard (again)
>
> Are you definitely using PythonInterpreter set to 'main_interpreter'?
>
> Are you stuck with using mod_python? Any way you can use mod_wsgi?
>
> Since been discovered that even in main interpreter, mod_python's
> usage of GIL thread state APIs is wrong. The mod_wsgi module gets it
> right, although still have to tell mod_wsgi to use main interpreter as
> well to avoid other issues.
>
> Graham
>
> 2009/12/16 Peter Robinson <p.m.robinson@bham.ac.uk>:
>> Folks
>> Last March there was a thread on the problems of getting mod_python running
>> with Apache in Mac OSX, with a very thorough discussion by Graham Dumpleton
>> a.o. on how to make it work.  (see
>> http://www.modpython.org/pipermail/mod_python/2008-March/024955.html ; also
>> http://www.modpython.org/pipermail/mod_python/2007-October/024376.html).
>>  This discussion should have solved the issue forever.  Alas, it has not ..
>> for me anyway.
>> In trying to run mod_python with Berkeley DB XML, in the mod_wsgi
>> incarnation, an older problem has resurfaced.  This is to do with Apache
>> locking up when python tries to access the key XmlManager class in bdbxml. A
>> discussion on this list
>> http://www.modpython.org/pipermail/mod_python/2007-April/023445.html , under
>> the topic Global Interpreter Lock problem with Berkeley DB XML and
>> mod_python, dealt with this.  Graham (again) suggested two fixes:
>> 1. recompile bdbxml with the compiler option -DSWIG_PYTHON_NO_USE_GIL
>> 2.  reinstall the python bindings, editing dbxml/dist/s_swig so that
>> '-threads' isn't in swig_args for Python
>> I tried the second, and this changed nothing.  I cannot figure out how to do
>> the first (sh buildall.sh  --with-berkeleydb-conf=-DSWIG_PYTHON_NO_USE_GIL
>> and sh buildall.sh  --with-dbxml-conf=-DSWIG_PYTHON_NO_USE_GIL fail)...
>> so help would be really helpful!
>> I am trying to do this on SnowLeopard.
>

From graham.dumpleton at gmail.com  Tue Dec 15 22:11:05 2009
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Tue Dec 15 22:11:14 2009
Subject: [mod_python] Using mod_python Berkeley DB XML, XmlManager, with 
	MacOSX Tiger/Leopard/SnowLeopard (again)
In-Reply-To: <81FE5D570D9C664089E44A571FB586A10987EF2F@cal-eva-srv1>
References: <82747AA0-2D0E-4528-ADA3-D83590BD565E@bham.ac.uk>
	<88e286470912151634o28478c4fua21faff6aa3443e6@mail.gmail.com>
	<81FE5D570D9C664089E44A571FB586A10987EF2E@cal-eva-srv1>
	<88e286470912151830y72a44d33h67e185e0367eb87@mail.gmail.com>
	<81FE5D570D9C664089E44A571FB586A10987EF2F@cal-eva-srv1>
Message-ID: <88e286470912151911o54032784u6ac7515d36fa0bc2@mail.gmail.com>

2009/12/16 Peter Robinson <p.m.robinson@bham.ac.uk>:
> Graham
> you are right: I started out installing mod-python, then realized that mod?wsgi is now the way to go. I posted to the mod python group because that was where the earlier correspondence was.
> So, yes, I see now that the magic line is
> WSGIApplicationGroup %{GLOBAL}
> but where should this go... the google site does not make this clear. ?If I put it in httpd.conf it stops apache loading.

Technically it can go anywhere in Apache configuration files so long
as it is after where mod_wsgi module was loaded. Normally one would
put it in Directory block that you created to allow Apache/mod_wsgi to
use WSGI script file from location you put it.

What is the actual error message?

If you are getting an error message with that then likely to be one of
the following:

1. You aren't actually loading mod_wsgi using LoadModule line.

2. You placed the directive in Apache configuration files prior to
where the LoadModule line is parsed from.

3. You spelt the directive wrong or much up the argument so it isn't
being interpreted as a single argument.

Have you even tried a simple hello world WSGI program to verify your
mod_wsgi installation is correct?

Perhaps go back and do that. See:

http://code.google.com/p/modwsgi/wiki/QuickInstallationGuide
http://code.google.com/p/modwsgi/wiki/QuickConfigurationGuide

Also have a read of the other more basic documentation on the mod_wsgi site.

Graham

> Should it go in the swig file?
> Peter
> ________________________________________
> From: Graham Dumpleton [graham.dumpleton@gmail.com]
> Sent: Wednesday, December 16, 2009 2:30 AM
> To: Peter Robinson
> Cc: mod_python@modpython.org
> Subject: Re: [mod_python] Using mod_python Berkeley DB XML, XmlManager, with ? ?MacOSX Tiger/Leopard/SnowLeopard (again)
>
> If you are using mod_wsgi, why are you asking on the mod_python list?
>
> This particular issue for mod_wsgi is documented in:
>
> http://code.google.com/p/modwsgi/wiki/ApplicationIssues#Python_Simplified_GIL_State_API
>
> It explicitly tells you to use:
>
> ?WSGIApplicationGroup %{GLOBAL}
>
> This is equivalent to the mod_python version of setting
> PythonInterpreter to main_interpreter. Although the mod_python way
> only works for mod_python, as the above only works for mod_wsgi.
>
> Also be aware that if you still load mod_python at same time into
> Apache, you might encounter over issues or loose some functionality of
> mod_wsgi. If you no longer need mod_python, do not continue loading it
> into Apache.
>
> Graham
>
> 2009/12/16 Peter Robinson <p.m.robinson@bham.ac.uk>:
>> Indeed I am using mod_wsgi. However, I cannot see how to set PythonInterpreter to 'main_interpreter'. So far as I can judge, this should be done through a declaration such as this in httpd.conf:
>> <Location /SDPublisher>
>> ? SetHandler mod_wsgi
>> ? PythonInterpreter main_interpreter
>> </Location>
>>
>> (according to what I could find at http://trac.edgewall.org/wiki/TracModPython)
>> but this does not work, or rather Apache will not start with this included.
>> help..!
>>
>> ________________________________________
>> From: Graham Dumpleton [graham.dumpleton@gmail.com]
>> Sent: Wednesday, December 16, 2009 12:34 AM
>> To: Peter Robinson
>> Cc: mod_python@modpython.org
>> Subject: Re: [mod_python] Using mod_python Berkeley DB XML, XmlManager, with ? ?MacOSX Tiger/Leopard/SnowLeopard (again)
>>
>> Are you definitely using PythonInterpreter set to 'main_interpreter'?
>>
>> Are you stuck with using mod_python? Any way you can use mod_wsgi?
>>
>> Since been discovered that even in main interpreter, mod_python's
>> usage of GIL thread state APIs is wrong. The mod_wsgi module gets it
>> right, although still have to tell mod_wsgi to use main interpreter as
>> well to avoid other issues.
>>
>> Graham
>>
>> 2009/12/16 Peter Robinson <p.m.robinson@bham.ac.uk>:
>>> Folks
>>> Last March there was a thread on the problems of getting mod_python running
>>> with Apache in Mac OSX, with a very thorough discussion by Graham Dumpleton
>>> a.o. on how to make it work. ?(see
>>> http://www.modpython.org/pipermail/mod_python/2008-March/024955.html ; also
>>> http://www.modpython.org/pipermail/mod_python/2007-October/024376.html).
>>> ?This discussion should have solved the issue forever. ?Alas, it has not ..
>>> for me anyway.
>>> In trying to run mod_python with Berkeley DB XML, in the mod_wsgi
>>> incarnation, an older problem has resurfaced. ?This is to do with Apache
>>> locking up when python tries to access the key XmlManager class in bdbxml. A
>>> discussion on this list
>>> http://www.modpython.org/pipermail/mod_python/2007-April/023445.html , under
>>> the topic Global Interpreter Lock problem with Berkeley DB XML and
>>> mod_python, dealt with this. ?Graham (again) suggested two fixes:
>>> 1. recompile bdbxml with the compiler option -DSWIG_PYTHON_NO_USE_GIL
>>> 2. ?reinstall the python bindings, editing dbxml/dist/s_swig so that
>>> '-threads' isn't in swig_args for Python
>>> I tried the second, and this changed nothing. ?I cannot figure out how to do
>>> the first (sh buildall.sh ?--with-berkeleydb-conf=-DSWIG_PYTHON_NO_USE_GIL
>>> and sh buildall.sh ?--with-dbxml-conf=-DSWIG_PYTHON_NO_USE_GIL fail)...
>>> so help would be really helpful!
>>> I am trying to do this on SnowLeopard.
>>
>

From p.m.robinson at bham.ac.uk  Wed Dec 16 01:37:18 2009
From: p.m.robinson at bham.ac.uk (Peter Robinson)
Date: Wed Dec 16 01:39:36 2009
Subject: [mod_python] Using mod_python Berkeley DB XML, XmlManager, with
	MacOSX Tiger/Leopard/SnowLeopard (again)
In-Reply-To: <88e286470912151911o54032784u6ac7515d36fa0bc2@mail.gmail.com>
References: <82747AA0-2D0E-4528-ADA3-D83590BD565E@bham.ac.uk>
	<88e286470912151634o28478c4fua21faff6aa3443e6@mail.gmail.com>
	<81FE5D570D9C664089E44A571FB586A10987EF2E@cal-eva-srv1>
	<88e286470912151830y72a44d33h67e185e0367eb87@mail.gmail.com>
	<81FE5D570D9C664089E44A571FB586A10987EF2F@cal-eva-srv1>,
	<88e286470912151911o54032784u6ac7515d36fa0bc2@mail.gmail.com>
Message-ID: <81FE5D570D9C664089E44A571FB586A10987EF31@cal-eva-srv1>

This worked!
placing the line after the WSGIScriptAlias declaration in httpdconf did it.
thanks hugely
peter
________________________________________
From: Graham Dumpleton [graham.dumpleton@gmail.com]
Sent: Wednesday, December 16, 2009 3:11 AM
To: Peter Robinson
Cc: mod_python@modpython.org
Subject: Re: [mod_python] Using mod_python Berkeley DB XML, XmlManager, with    MacOSX Tiger/Leopard/SnowLeopard (again)

2009/12/16 Peter Robinson <p.m.robinson@bham.ac.uk>:
> Graham
> you are right: I started out installing mod-python, then realized that mod?wsgi is now the way to go. I posted to the mod python group because that was where the earlier correspondence was.
> So, yes, I see now that the magic line is
> WSGIApplicationGroup %{GLOBAL}
> but where should this go... the google site does not make this clear.  If I put it in httpd.conf it stops apache loading.

Technically it can go anywhere in Apache configuration files so long
as it is after where mod_wsgi module was loaded. Normally one would
put it in Directory block that you created to allow Apache/mod_wsgi to
use WSGI script file from location you put it.

What is the actual error message?

If you are getting an error message with that then likely to be one of
the following:

1. You aren't actually loading mod_wsgi using LoadModule line.

2. You placed the directive in Apache configuration files prior to
where the LoadModule line is parsed from.

3. You spelt the directive wrong or much up the argument so it isn't
being interpreted as a single argument.

Have you even tried a simple hello world WSGI program to verify your
mod_wsgi installation is correct?

Perhaps go back and do that. See:

http://code.google.com/p/modwsgi/wiki/QuickInstallationGuide
http://code.google.com/p/modwsgi/wiki/QuickConfigurationGuide

Also have a read of the other more basic documentation on the mod_wsgi site.

Graham

> Should it go in the swig file?
> Peter
> ________________________________________
> From: Graham Dumpleton [graham.dumpleton@gmail.com]
> Sent: Wednesday, December 16, 2009 2:30 AM
> To: Peter Robinson
> Cc: mod_python@modpython.org
> Subject: Re: [mod_python] Using mod_python Berkeley DB XML, XmlManager, with    MacOSX Tiger/Leopard/SnowLeopard (again)
>
> If you are using mod_wsgi, why are you asking on the mod_python list?
>
> This particular issue for mod_wsgi is documented in:
>
> http://code.google.com/p/modwsgi/wiki/ApplicationIssues#Python_Simplified_GIL_State_API
>
> It explicitly tells you to use:
>
>  WSGIApplicationGroup %{GLOBAL}
>
> This is equivalent to the mod_python version of setting
> PythonInterpreter to main_interpreter. Although the mod_python way
> only works for mod_python, as the above only works for mod_wsgi.
>
> Also be aware that if you still load mod_python at same time into
> Apache, you might encounter over issues or loose some functionality of
> mod_wsgi. If you no longer need mod_python, do not continue loading it
> into Apache.
>
> Graham
>
> 2009/12/16 Peter Robinson <p.m.robinson@bham.ac.uk>:
>> Indeed I am using mod_wsgi. However, I cannot see how to set PythonInterpreter to 'main_interpreter'. So far as I can judge, this should be done through a declaration such as this in httpd.conf:
>> <Location /SDPublisher>
>>   SetHandler mod_wsgi
>>   PythonInterpreter main_interpreter
>> </Location>
>>
>> (according to what I could find at http://trac.edgewall.org/wiki/TracModPython)
>> but this does not work, or rather Apache will not start with this included.
>> help..!
>>
>> ________________________________________
>> From: Graham Dumpleton [graham.dumpleton@gmail.com]
>> Sent: Wednesday, December 16, 2009 12:34 AM
>> To: Peter Robinson
>> Cc: mod_python@modpython.org
>> Subject: Re: [mod_python] Using mod_python Berkeley DB XML, XmlManager, with    MacOSX Tiger/Leopard/SnowLeopard (again)
>>
>> Are you definitely using PythonInterpreter set to 'main_interpreter'?
>>
>> Are you stuck with using mod_python? Any way you can use mod_wsgi?
>>
>> Since been discovered that even in main interpreter, mod_python's
>> usage of GIL thread state APIs is wrong. The mod_wsgi module gets it
>> right, although still have to tell mod_wsgi to use main interpreter as
>> well to avoid other issues.
>>
>> Graham
>>
>> 2009/12/16 Peter Robinson <p.m.robinson@bham.ac.uk>:
>>> Folks
>>> Last March there was a thread on the problems of getting mod_python running
>>> with Apache in Mac OSX, with a very thorough discussion by Graham Dumpleton
>>> a.o. on how to make it work.  (see
>>> http://www.modpython.org/pipermail/mod_python/2008-March/024955.html ; also
>>> http://www.modpython.org/pipermail/mod_python/2007-October/024376.html).
>>>  This discussion should have solved the issue forever.  Alas, it has not ..
>>> for me anyway.
>>> In trying to run mod_python with Berkeley DB XML, in the mod_wsgi
>>> incarnation, an older problem has resurfaced.  This is to do with Apache
>>> locking up when python tries to access the key XmlManager class in bdbxml. A
>>> discussion on this list
>>> http://www.modpython.org/pipermail/mod_python/2007-April/023445.html , under
>>> the topic Global Interpreter Lock problem with Berkeley DB XML and
>>> mod_python, dealt with this.  Graham (again) suggested two fixes:
>>> 1. recompile bdbxml with the compiler option -DSWIG_PYTHON_NO_USE_GIL
>>> 2.  reinstall the python bindings, editing dbxml/dist/s_swig so that
>>> '-threads' isn't in swig_args for Python
>>> I tried the second, and this changed nothing.  I cannot figure out how to do
>>> the first (sh buildall.sh  --with-berkeleydb-conf=-DSWIG_PYTHON_NO_USE_GIL
>>> and sh buildall.sh  --with-dbxml-conf=-DSWIG_PYTHON_NO_USE_GIL fail)...
>>> so help would be really helpful!
>>> I am trying to do this on SnowLeopard.
>>
>

From bharathv6.project at gmail.com  Tue Dec 22 06:43:36 2009
From: bharathv6.project at gmail.com (bharath venkatesh)
Date: Tue Dec 22 06:43:40 2009
Subject: [mod_python] Django-mod_python taking time loading libraries
Message-ID: <2613171a0912220343s6a5c9195w96dff2e59b802e86@mail.gmail.com>

Hi,

    Django with mod python  is taking time loading libraries . I am using
python  open source libraries like montylingua , simplejson and django is
taking
time loading these libraries .

When django is run using python manage.py runserver first request takes time
but rest of the requests doesn't take time ( quite fast ) ,which  is
acceptable but when django is used along with apache and mod_python it takes
time as much time as django takes for first request  when run using python
manage.py runserver for almost every request.

How to avoid this as our performance is greatly hindered by this behaviour

is it possible to cache these external open source libraries  ?

Thanks in Advance,
Bharath
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20091222/dcc76160/attachment.html
From bharathv6.project at gmail.com  Tue Dec 22 11:08:28 2009
From: bharathv6.project at gmail.com (bharath venkatesh)
Date: Tue Dec 22 11:08:38 2009
Subject: [mod_python] Re: Django-mod_python taking time loading libraries
In-Reply-To: <2613171a0912220343s6a5c9195w96dff2e59b802e86@mail.gmail.com>
References: <2613171a0912220343s6a5c9195w96dff2e59b802e86@mail.gmail.com>
Message-ID: <2613171a0912220808q51fe7a0ud3e9e6028914cd86@mail.gmail.com>

will mod wsgi in Daemon mode  solve this issue  as loading libraries and
initialising is done only once ?

On Tue, Dec 22, 2009 at 5:13 PM, bharath venkatesh <
bharathv6.project@gmail.com> wrote:

> Hi,
>
>     Django with mod python  is taking time loading libraries . I am using
> python  open source libraries like montylingua , simplejson and django is
> taking
> time loading these libraries .
>
> When django is run using python manage.py runserver first request takes
> time but rest of the requests doesn't take time ( quite fast ) ,which  is
> acceptable but when django is used along with apache and mod_python it takes
> time as much time as django takes for first request  when run using python
> manage.py runserver for almost every request.
>
> How to avoid this as our performance is greatly hindered by this behaviour
>
> is it possible to cache these external open source libraries  ?
>
> Thanks in Advance,
> Bharath
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20091222/9bcbf7b3/attachment.html
From chen.zl at live.cn  Tue Dec 22 12:30:25 2009
From: chen.zl at live.cn (=?gbk?B?Y2hlbi56bA==?=)
Date: Tue Dec 22 12:30:31 2009
Subject: [mod_python] Re: Django-mod_python taking time loading libraries
Message-ID: <tencent_1F62E58B46EE0C512143DB02@qq.com>

thank you.
 
 
------------------ Original ------------------
From: "bharath venkatesh"<bharathv6.project@gmail.com>;
Date: 20091223() 0:38
To: "mod_python"<mod_python@modpython.org>;
Subject: [mod_python] Re: Django-mod_python taking time loading libraries

 
   will mod wsgi in Daemon mode? solve this issue? as loading libraries and initialising is done only once ?

 On Tue, Dec 22, 2009 at 5:13 PM, bharath venkatesh <bharathv6.project@gmail.com> wrote:
 Hi,

? ? Django with mod python? is taking time loading libraries . I am using python? open source libraries like montylingua , simplejson and django is taking
time loading these libraries .

When django is run using python manage.py runserver first request takes time but rest of the requests doesn't take time ( quite fast ) ,which? is acceptable but when django is used along with apache and mod_python it takes time as much time as django takes for first request? when run using python manage.py runserver for almost every request.

How to avoid this as our performance is greatly hindered by this behaviour

is it possible to cache these external open source libraries? ?

Thanks in Advance,
Bharath
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20091223/6dda7177/attachment.html
From graham.dumpleton at gmail.com  Tue Dec 22 16:49:58 2009
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Tue Dec 22 16:50:07 2009
Subject: [mod_python] Re: Django-mod_python taking time loading libraries
In-Reply-To: <2613171a0912220808q51fe7a0ud3e9e6028914cd86@mail.gmail.com>
References: <2613171a0912220343s6a5c9195w96dff2e59b802e86@mail.gmail.com>
	<2613171a0912220808q51fe7a0ud3e9e6028914cd86@mail.gmail.com>
Message-ID: <88e286470912221349q2afbc7b6x94063c598feab30@mail.gmail.com>

2009/12/23 bharath venkatesh <bharathv6.project@gmail.com>:
> will mod wsgi in Daemon mode? solve this issue? as loading libraries and
> initialising is done only once ?

Maybe.

As documented in:

  http://blog.dscpl.com.au/2009/03/load-spikes-and-excessive-memory-usage.html

the OP is having problems because of how embedded mode Python
applications work in Apache. This may be  exacerbated by using prefork
MPM with Apache. Same issues come up with mod_wsgi embedded mode as
with mod_python if you do not configure your Apache correctly for fat
Python web applications. If you are limited in being able to do that
because Apache is heavily used for static file serving or mod_php, you
really should use mod_wsgi daemon mode instead as described in that
post.

Why daemon mode will help is fixed number of persistent processes and
more specifically defaulting to one process, so you only incur startup
cost once and not for many processes, or in case of embedded mode also
not when the processes get recycled as is default for Apache.

Graham

> On Tue, Dec 22, 2009 at 5:13 PM, bharath venkatesh
> <bharathv6.project@gmail.com> wrote:
>>
>> Hi,
>>
>> ? ? Django with mod python? is taking time loading libraries . I am using
>> python? open source libraries like montylingua , simplejson and django is
>> taking
>> time loading these libraries .
>>
>> When django is run using python manage.py runserver first request takes
>> time but rest of the requests doesn't take time ( quite fast ) ,which? is
>> acceptable but when django is used along with apache and mod_python it takes
>> time as much time as django takes for first request? when run using python
>> manage.py runserver for almost every request.
>>
>> How to avoid this as our performance is greatly hindered by this behaviour
>>
>> is it possible to cache these external open source libraries? ?
>>
>> Thanks in Advance,
>> Bharath
>
> _______________________________________________
> Mod_python mailing list
> Mod_python@modpython.org
> http://mailman.modpython.org/mailman/listinfo/mod_python
>
>

From bharathv6.project at gmail.com  Wed Dec 23 05:50:39 2009
From: bharathv6.project at gmail.com (bharath venkatesh)
Date: Wed Dec 23 05:50:48 2009
Subject: [mod_python] Re: Django-mod_python taking time loading libraries
In-Reply-To: <88e286470912221349q2afbc7b6x94063c598feab30@mail.gmail.com>
References: <2613171a0912220343s6a5c9195w96dff2e59b802e86@mail.gmail.com>
	<2613171a0912220808q51fe7a0ud3e9e6028914cd86@mail.gmail.com>
	<88e286470912221349q2afbc7b6x94063c598feab30@mail.gmail.com>
Message-ID: <2613171a0912230250x3055e886se7b1c2dcdea37d7c@mail.gmail.com>

Hi Graham,

     Thanks for the link it was very informative
*- Technically running embedded mode with prefork MPM should offer the best
performance, especially for machines with many cpus/cores. *
*- just because mod_wsgi embedded mode and prefork MPM may be the fastest
solution out there for Apache*
**
As above lines (from link ) suggests ,can we use mod_wsgi embedded mode and
prefork MPM (as meantioned that it is best ) ?and tune apache not to load
libraries and intialise every thime  (as our apache is already running as
prefork MPM and also our machines are multi core (8 cores) and has 16 AG
Ram)  or we have to use mod_wsgi in daemon mode to pervent huge loading and
intialising time ? but  as daemon mode is used with worker MPM we have to
recompile apache
Thanks,
Bharath


On Wed, Dec 23, 2009 at 3:19 AM, Graham Dumpleton <
graham.dumpleton@gmail.com> wrote:

> 2009/12/23 bharath venkatesh <bharathv6.project@gmail.com>:
> > will mod wsgi in Daemon mode  solve this issue  as loading libraries and
> > initialising is done only once ?
>
> Maybe.
>
> As documented in:
>
>
> http://blog.dscpl.com.au/2009/03/load-spikes-and-excessive-memory-usage.html
>
> the OP is having problems because of how embedded mode Python
> applications work in Apache. This may be  exacerbated by using prefork
> MPM with Apache. Same issues come up with mod_wsgi embedded mode as
> with mod_python if you do not configure your Apache correctly for fat
> Python web applications. If you are limited in being able to do that
> because Apache is heavily used for static file serving or mod_php, you
> really should use mod_wsgi daemon mode instead as described in that
> post.
>
> Why daemon mode will help is fixed number of persistent processes and
> more specifically defaulting to one process, so you only incur startup
> cost once and not for many processes, or in case of embedded mode also
> not when the processes get recycled as is default for Apache.
>
> Graham
>
> > On Tue, Dec 22, 2009 at 5:13 PM, bharath venkatesh
> > <bharathv6.project@gmail.com> wrote:
> >>
> >> Hi,
> >>
> >>     Django with mod python  is taking time loading libraries . I am
> using
> >> python  open source libraries like montylingua , simplejson and django
> is
> >> taking
> >> time loading these libraries .
> >>
> >> When django is run using python manage.py runserver first request takes
> >> time but rest of the requests doesn't take time ( quite fast ) ,which
> is
> >> acceptable but when django is used along with apache and mod_python it
> takes
> >> time as much time as django takes for first request  when run using
> python
> >> manage.py runserver for almost every request.
> >>
> >> How to avoid this as our performance is greatly hindered by this
> behaviour
> >>
> >> is it possible to cache these external open source libraries  ?
> >>
> >> Thanks in Advance,
> >> Bharath
> >
> > _______________________________________________
> > Mod_python mailing list
> > Mod_python@modpython.org
> > http://mailman.modpython.org/mailman/listinfo/mod_python
> >
> >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20091223/cec115bf/attachment.html
From graham.dumpleton at gmail.com  Wed Dec 23 05:55:59 2009
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Wed Dec 23 05:56:08 2009
Subject: [mod_python] Re: Django-mod_python taking time loading libraries
In-Reply-To: <2613171a0912230250x3055e886se7b1c2dcdea37d7c@mail.gmail.com>
References: <2613171a0912220343s6a5c9195w96dff2e59b802e86@mail.gmail.com>
	<2613171a0912220808q51fe7a0ud3e9e6028914cd86@mail.gmail.com>
	<88e286470912221349q2afbc7b6x94063c598feab30@mail.gmail.com>
	<2613171a0912230250x3055e886se7b1c2dcdea37d7c@mail.gmail.com>
Message-ID: <88e286470912230255y559d494ckf196119dadc0a7e6@mail.gmail.com>

What else is your Apache being used for? If it is being use for other
stuff it may not be possible to tune Apache embedded in a way that is
best for Python web application as that will be too detriment of other
stuff you are hosting.

So, are you hosting static media on same Apache or using a separate
web server such as nginx for static media? Are you running PHP using
mod_php on same Apache? Are you running anything else using any
fastcgi/scgi/ajp hosting mechanisms?

In short, unless that Apache is dedicated to just the Python web
application, the trouble of trying to tune Apache for it is no worth
the trouble and just better off using daemon mode thus allowing you to
separately control things.

BTW, depends a bit on what your site is doing, but using nginx proxy
front end can be very advantageous as isolates Apache from slow
clients allowing Apache processes/threads to be better utilised.

Graham

2009/12/23 bharath venkatesh <bharathv6.project@gmail.com>:
> Hi Graham,
>
> ? ? ?Thanks for the link it was very informative
> - Technically running embedded mode with prefork MPM should offer the best
> performance, especially for machines with many cpus/cores.
> - just because mod_wsgi embedded mode and prefork MPM may be the fastest
> solution out there for Apache
> As above lines (from link ) suggests ,can we use mod_wsgi embedded mode and
> prefork MPM (as meantioned that it is best ) ?and tune apache not to load
> libraries and intialise every thime? (as our apache is already running as
> prefork MPM and also our machines are multi core (8 cores) and has 16 AG
> Ram) ?or we have to use mod_wsgi in daemon mode to pervent huge loading and
> intialising time ? but ?as daemon mode is used with worker MPM we have to
> recompile apache
> Thanks,
> Bharath
>
> On Wed, Dec 23, 2009 at 3:19 AM, Graham Dumpleton
> <graham.dumpleton@gmail.com> wrote:
>>
>> 2009/12/23 bharath venkatesh <bharathv6.project@gmail.com>:
>> > will mod wsgi in Daemon mode? solve this issue? as loading libraries and
>> > initialising is done only once ?
>>
>> Maybe.
>>
>> As documented in:
>>
>>
>> ?http://blog.dscpl.com.au/2009/03/load-spikes-and-excessive-memory-usage.html
>>
>> the OP is having problems because of how embedded mode Python
>> applications work in Apache. This may be ?exacerbated by using prefork
>> MPM with Apache. Same issues come up with mod_wsgi embedded mode as
>> with mod_python if you do not configure your Apache correctly for fat
>> Python web applications. If you are limited in being able to do that
>> because Apache is heavily used for static file serving or mod_php, you
>> really should use mod_wsgi daemon mode instead as described in that
>> post.
>>
>> Why daemon mode will help is fixed number of persistent processes and
>> more specifically defaulting to one process, so you only incur startup
>> cost once and not for many processes, or in case of embedded mode also
>> not when the processes get recycled as is default for Apache.
>>
>> Graham
>>
>> > On Tue, Dec 22, 2009 at 5:13 PM, bharath venkatesh
>> > <bharathv6.project@gmail.com> wrote:
>> >>
>> >> Hi,
>> >>
>> >> ? ? Django with mod python? is taking time loading libraries . I am
>> >> using
>> >> python? open source libraries like montylingua , simplejson and django
>> >> is
>> >> taking
>> >> time loading these libraries .
>> >>
>> >> When django is run using python manage.py runserver first request takes
>> >> time but rest of the requests doesn't take time ( quite fast ) ,which
>> >> is
>> >> acceptable but when django is used along with apache and mod_python it
>> >> takes
>> >> time as much time as django takes for first request? when run using
>> >> python
>> >> manage.py runserver for almost every request.
>> >>
>> >> How to avoid this as our performance is greatly hindered by this
>> >> behaviour
>> >>
>> >> is it possible to cache these external open source libraries? ?
>> >>
>> >> Thanks in Advance,
>> >> Bharath
>> >
>> > _______________________________________________
>> > Mod_python mailing list
>> > Mod_python@modpython.org
>> > http://mailman.modpython.org/mailman/listinfo/mod_python
>> >
>> >
>
>

From bharathv6.project at gmail.com  Wed Dec 23 07:03:14 2009
From: bharathv6.project at gmail.com (bharath venkatesh)
Date: Wed Dec 23 07:03:24 2009
Subject: [mod_python] Re: Django-mod_python taking time loading libraries
In-Reply-To: <88e286470912230318q77c47769pb1685e19e0daf373@mail.gmail.com>
References: <2613171a0912220343s6a5c9195w96dff2e59b802e86@mail.gmail.com>
	<2613171a0912220808q51fe7a0ud3e9e6028914cd86@mail.gmail.com>
	<88e286470912221349q2afbc7b6x94063c598feab30@mail.gmail.com>
	<2613171a0912230250x3055e886se7b1c2dcdea37d7c@mail.gmail.com>
	<88e286470912230255y559d494ckf196119dadc0a7e6@mail.gmail.com>
	<2613171a0912230310o104645bk9d58b8f04747cbdb@mail.gmail.com>
	<88e286470912230318q77c47769pb1685e19e0daf373@mail.gmail.com>
Message-ID: <2613171a0912230403g78e83e4cg7d3ec8f324e581e@mail.gmail.com>

>I note you have taken this off list.
sorry it is was not intended to take it off the list ,it was by mistake.
>How many Django applications?
we are using 4-5 Django application and we are using Django 0.97 (not sure
if this version is thread safe )
>There are so many variables to all of this as far as knowing what is
>the best configuration and unfortunately only you know your
>applications so is going to be very hard for me to say that one way is
>going to be the best.
I understand ,we will do lot of testing and tuning before we arrive at the
final configuration .Thanks a lot for the help.
Thanks,
Bharath


On Wed, Dec 23, 2009 at 4:48 PM, Graham Dumpleton <
graham.dumpleton@gmail.com> wrote:

> I note you have taken this off list.
>
> 2009/12/23 bharath venkatesh <bharathv6.project@gmail.com>:
> > we are using apache for mainly mod python and django applications ,
>  small
> > images such as logos are also served ( can be migrated ) and also one
> > mod_php application which receives very few request .
>
> How many Django applications?
>
> If many or memory requirements of each are large, then using embedded
> mode is a bad idea as only option is to have a copy of each in every
> process. So, if using one Apache for many Django instances, better off
> using daemon mode as gives better control over each application and
> can provision less processes for Django instances which are less used
> so overall memory is less. You can also make use of multithreading
> where appropriate, that is, can handle greater capacity requests where
> most of the time requests are stuck waiting on databases. Your code
> though then has to be thread safe.
>
> There are so many variables to all of this as far as knowing what is
> the best configuration and unfortunately only you know your
> applications so is going to be very hard for me to say that one way is
> going to be the best.
>
> Graham
>
> > On Wed, Dec 23, 2009 at 4:25 PM, Graham Dumpleton
> > <graham.dumpleton@gmail.com> wrote:
> >>
> >> What else is your Apache being used for? If it is being use for other
> >> stuff it may not be possible to tune Apache embedded in a way that is
> >> best for Python web application as that will be too detriment of other
> >> stuff you are hosting.
> >>
> >> So, are you hosting static media on same Apache or using a separate
> >> web server such as nginx for static media? Are you running PHP using
> >> mod_php on same Apache? Are you running anything else using any
> >> fastcgi/scgi/ajp hosting mechanisms?
> >>
> >> In short, unless that Apache is dedicated to just the Python web
> >> application, the trouble of trying to tune Apache for it is no worth
> >> the trouble and just better off using daemon mode thus allowing you to
> >> separately control things.
> >>
> >> BTW, depends a bit on what your site is doing, but using nginx proxy
> >> front end can be very advantageous as isolates Apache from slow
> >> clients allowing Apache processes/threads to be better utilised.
> >>
> >> Graham
> >>
> >> 2009/12/23 bharath venkatesh <bharathv6.project@gmail.com>:
> >> > Hi Graham,
> >> >
> >> >      Thanks for the link it was very informative
> >> > - Technically running embedded mode with prefork MPM should offer the
> >> > best
> >> > performance, especially for machines with many cpus/cores.
> >> > - just because mod_wsgi embedded mode and prefork MPM may be the
> fastest
> >> > solution out there for Apache
> >> > As above lines (from link ) suggests ,can we use mod_wsgi embedded
> mode
> >> > and
> >> > prefork MPM (as meantioned that it is best ) ?and tune apache not to
> >> > load
> >> > libraries and intialise every thime  (as our apache is already running
> >> > as
> >> > prefork MPM and also our machines are multi core (8 cores) and has 16
> AG
> >> > Ram)  or we have to use mod_wsgi in daemon mode to pervent huge
> loading
> >> > and
> >> > intialising time ? but  as daemon mode is used with worker MPM we have
> >> > to
> >> > recompile apache
> >> > Thanks,
> >> > Bharath
> >> >
> >> > On Wed, Dec 23, 2009 at 3:19 AM, Graham Dumpleton
> >> > <graham.dumpleton@gmail.com> wrote:
> >> >>
> >> >> 2009/12/23 bharath venkatesh <bharathv6.project@gmail.com>:
> >> >> > will mod wsgi in Daemon mode  solve this issue  as loading
> libraries
> >> >> > and
> >> >> > initialising is done only once ?
> >> >>
> >> >> Maybe.
> >> >>
> >> >> As documented in:
> >> >>
> >> >>
> >> >>
> >> >>
> http://blog.dscpl.com.au/2009/03/load-spikes-and-excessive-memory-usage.html
> >> >>
> >> >> the OP is having problems because of how embedded mode Python
> >> >> applications work in Apache. This may be  exacerbated by using
> prefork
> >> >> MPM with Apache. Same issues come up with mod_wsgi embedded mode as
> >> >> with mod_python if you do not configure your Apache correctly for fat
> >> >> Python web applications. If you are limited in being able to do that
> >> >> because Apache is heavily used for static file serving or mod_php,
> you
> >> >> really should use mod_wsgi daemon mode instead as described in that
> >> >> post.
> >> >>
> >> >> Why daemon mode will help is fixed number of persistent processes and
> >> >> more specifically defaulting to one process, so you only incur
> startup
> >> >> cost once and not for many processes, or in case of embedded mode
> also
> >> >> not when the processes get recycled as is default for Apache.
> >> >>
> >> >> Graham
> >> >>
> >> >> > On Tue, Dec 22, 2009 at 5:13 PM, bharath venkatesh
> >> >> > <bharathv6.project@gmail.com> wrote:
> >> >> >>
> >> >> >> Hi,
> >> >> >>
> >> >> >>     Django with mod python  is taking time loading libraries . I
> am
> >> >> >> using
> >> >> >> python  open source libraries like montylingua , simplejson and
> >> >> >> django
> >> >> >> is
> >> >> >> taking
> >> >> >> time loading these libraries .
> >> >> >>
> >> >> >> When django is run using python manage.py runserver first request
> >> >> >> takes
> >> >> >> time but rest of the requests doesn't take time ( quite fast )
> >> >> >> ,which
> >> >> >> is
> >> >> >> acceptable but when django is used along with apache and
> mod_python
> >> >> >> it
> >> >> >> takes
> >> >> >> time as much time as django takes for first request  when run
> using
> >> >> >> python
> >> >> >> manage.py runserver for almost every request.
> >> >> >>
> >> >> >> How to avoid this as our performance is greatly hindered by this
> >> >> >> behaviour
> >> >> >>
> >> >> >> is it possible to cache these external open source libraries  ?
> >> >> >>
> >> >> >> Thanks in Advance,
> >> >> >> Bharath
> >> >> >
> >> >> > _______________________________________________
> >> >> > Mod_python mailing list
> >> >> > Mod_python@modpython.org
> >> >> > http://mailman.modpython.org/mailman/listinfo/mod_python
> >> >> >
> >> >> >
> >> >
> >> >
> >
> >
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20091223/5172ca39/attachment-0001.html
From graham.dumpleton at gmail.com  Wed Dec 23 16:03:27 2009
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Wed Dec 23 16:03:35 2009
Subject: [mod_python] Re: Django-mod_python taking time loading libraries
In-Reply-To: <2613171a0912230403g78e83e4cg7d3ec8f324e581e@mail.gmail.com>
References: <2613171a0912220343s6a5c9195w96dff2e59b802e86@mail.gmail.com>
	<2613171a0912220808q51fe7a0ud3e9e6028914cd86@mail.gmail.com>
	<88e286470912221349q2afbc7b6x94063c598feab30@mail.gmail.com>
	<2613171a0912230250x3055e886se7b1c2dcdea37d7c@mail.gmail.com>
	<88e286470912230255y559d494ckf196119dadc0a7e6@mail.gmail.com>
	<2613171a0912230310o104645bk9d58b8f04747cbdb@mail.gmail.com>
	<88e286470912230318q77c47769pb1685e19e0daf373@mail.gmail.com>
	<2613171a0912230403g78e83e4cg7d3ec8f324e581e@mail.gmail.com>
Message-ID: <88e286470912231303u7408d726t72feb0cbfb34a65e@mail.gmail.com>

2009/12/23 bharath venkatesh <bharathv6.project@gmail.com>:
>>I note you have taken this off list.
> sorry it is was not intended to take it off the list ,it was by mistake.
>>How many Django applications?
> we are using 4-5 Django application and we are using Django 0.97 (not sure
> if this version is thread safe )

No it isn't regarded as thread safe.

I'll comment later when have time.

Graham

>>There are so many variables to all of this as far as knowing what is
>>the best configuration and unfortunately only you know your
>>applications so is going to be very hard for me to say that one way is
>>going to be the best.
> I understand ,we will do lot of testing and tuning before we arrive at the
> final configuration .Thanks a lot for the help.
> Thanks,
> Bharath
>
>
> On Wed, Dec 23, 2009 at 4:48 PM, Graham Dumpleton
> <graham.dumpleton@gmail.com> wrote:
>>
>> I note you have taken this off list.
>>
>> 2009/12/23 bharath venkatesh <bharathv6.project@gmail.com>:
>> > we are using apache for mainly mod python and django applications ,
>> > ?small
>> > images such as logos are also served ( can be migrated ) and also one
>> > mod_php application which receives very few request .
>>
>> How many Django applications?
>>
>> If many or memory requirements of each are large, then using embedded
>> mode is a bad idea as only option is to have a copy of each in every
>> process. So, if using one Apache for many Django instances, better off
>> using daemon mode as gives better control over each application and
>> can provision less processes for Django instances which are less used
>> so overall memory is less. You can also make use of multithreading
>> where appropriate, that is, can handle greater capacity requests where
>> most of the time requests are stuck waiting on databases. Your code
>> though then has to be thread safe.
>>
>> There are so many variables to all of this as far as knowing what is
>> the best configuration and unfortunately only you know your
>> applications so is going to be very hard for me to say that one way is
>> going to be the best.
>>
>> Graham
>>
>> > On Wed, Dec 23, 2009 at 4:25 PM, Graham Dumpleton
>> > <graham.dumpleton@gmail.com> wrote:
>> >>
>> >> What else is your Apache being used for? If it is being use for other
>> >> stuff it may not be possible to tune Apache embedded in a way that is
>> >> best for Python web application as that will be too detriment of other
>> >> stuff you are hosting.
>> >>
>> >> So, are you hosting static media on same Apache or using a separate
>> >> web server such as nginx for static media? Are you running PHP using
>> >> mod_php on same Apache? Are you running anything else using any
>> >> fastcgi/scgi/ajp hosting mechanisms?
>> >>
>> >> In short, unless that Apache is dedicated to just the Python web
>> >> application, the trouble of trying to tune Apache for it is no worth
>> >> the trouble and just better off using daemon mode thus allowing you to
>> >> separately control things.
>> >>
>> >> BTW, depends a bit on what your site is doing, but using nginx proxy
>> >> front end can be very advantageous as isolates Apache from slow
>> >> clients allowing Apache processes/threads to be better utilised.
>> >>
>> >> Graham
>> >>
>> >> 2009/12/23 bharath venkatesh <bharathv6.project@gmail.com>:
>> >> > Hi Graham,
>> >> >
>> >> > ? ? ?Thanks for the link it was very informative
>> >> > - Technically running embedded mode with prefork MPM should offer the
>> >> > best
>> >> > performance, especially for machines with many cpus/cores.
>> >> > - just because mod_wsgi embedded mode and prefork MPM may be the
>> >> > fastest
>> >> > solution out there for Apache
>> >> > As above lines (from link ) suggests ,can we use mod_wsgi embedded
>> >> > mode
>> >> > and
>> >> > prefork MPM (as meantioned that it is best ) ?and tune apache not to
>> >> > load
>> >> > libraries and intialise every thime? (as our apache is already
>> >> > running
>> >> > as
>> >> > prefork MPM and also our machines are multi core (8 cores) and has 16
>> >> > AG
>> >> > Ram) ?or we have to use mod_wsgi in daemon mode to pervent huge
>> >> > loading
>> >> > and
>> >> > intialising time ? but ?as daemon mode is used with worker MPM we
>> >> > have
>> >> > to
>> >> > recompile apache
>> >> > Thanks,
>> >> > Bharath
>> >> >
>> >> > On Wed, Dec 23, 2009 at 3:19 AM, Graham Dumpleton
>> >> > <graham.dumpleton@gmail.com> wrote:
>> >> >>
>> >> >> 2009/12/23 bharath venkatesh <bharathv6.project@gmail.com>:
>> >> >> > will mod wsgi in Daemon mode? solve this issue? as loading
>> >> >> > libraries
>> >> >> > and
>> >> >> > initialising is done only once ?
>> >> >>
>> >> >> Maybe.
>> >> >>
>> >> >> As documented in:
>> >> >>
>> >> >>
>> >> >>
>> >> >>
>> >> >> ?http://blog.dscpl.com.au/2009/03/load-spikes-and-excessive-memory-usage.html
>> >> >>
>> >> >> the OP is having problems because of how embedded mode Python
>> >> >> applications work in Apache. This may be ?exacerbated by using
>> >> >> prefork
>> >> >> MPM with Apache. Same issues come up with mod_wsgi embedded mode as
>> >> >> with mod_python if you do not configure your Apache correctly for
>> >> >> fat
>> >> >> Python web applications. If you are limited in being able to do that
>> >> >> because Apache is heavily used for static file serving or mod_php,
>> >> >> you
>> >> >> really should use mod_wsgi daemon mode instead as described in that
>> >> >> post.
>> >> >>
>> >> >> Why daemon mode will help is fixed number of persistent processes
>> >> >> and
>> >> >> more specifically defaulting to one process, so you only incur
>> >> >> startup
>> >> >> cost once and not for many processes, or in case of embedded mode
>> >> >> also
>> >> >> not when the processes get recycled as is default for Apache.
>> >> >>
>> >> >> Graham
>> >> >>
>> >> >> > On Tue, Dec 22, 2009 at 5:13 PM, bharath venkatesh
>> >> >> > <bharathv6.project@gmail.com> wrote:
>> >> >> >>
>> >> >> >> Hi,
>> >> >> >>
>> >> >> >> ? ? Django with mod python? is taking time loading libraries . I
>> >> >> >> am
>> >> >> >> using
>> >> >> >> python? open source libraries like montylingua , simplejson and
>> >> >> >> django
>> >> >> >> is
>> >> >> >> taking
>> >> >> >> time loading these libraries .
>> >> >> >>
>> >> >> >> When django is run using python manage.py runserver first request
>> >> >> >> takes
>> >> >> >> time but rest of the requests doesn't take time ( quite fast )
>> >> >> >> ,which
>> >> >> >> is
>> >> >> >> acceptable but when django is used along with apache and
>> >> >> >> mod_python
>> >> >> >> it
>> >> >> >> takes
>> >> >> >> time as much time as django takes for first request? when run
>> >> >> >> using
>> >> >> >> python
>> >> >> >> manage.py runserver for almost every request.
>> >> >> >>
>> >> >> >> How to avoid this as our performance is greatly hindered by this
>> >> >> >> behaviour
>> >> >> >>
>> >> >> >> is it possible to cache these external open source libraries? ?
>> >> >> >>
>> >> >> >> Thanks in Advance,
>> >> >> >> Bharath
>> >> >> >
>> >> >> > _______________________________________________
>> >> >> > Mod_python mailing list
>> >> >> > Mod_python@modpython.org
>> >> >> > http://mailman.modpython.org/mailman/listinfo/mod_python
>> >> >> >
>> >> >> >
>> >> >
>> >> >
>> >
>> >
>
>

From graham.dumpleton at gmail.com  Sat Dec 26 05:15:21 2009
From: graham.dumpleton at gmail.com (Graham Dumpleton)
Date: Sat Dec 26 05:15:32 2009
Subject: [mod_python] Re: Django-mod_python taking time loading libraries
In-Reply-To: <88e286470912231303u7408d726t72feb0cbfb34a65e@mail.gmail.com>
References: <2613171a0912220343s6a5c9195w96dff2e59b802e86@mail.gmail.com>
	<2613171a0912220808q51fe7a0ud3e9e6028914cd86@mail.gmail.com>
	<88e286470912221349q2afbc7b6x94063c598feab30@mail.gmail.com>
	<2613171a0912230250x3055e886se7b1c2dcdea37d7c@mail.gmail.com>
	<88e286470912230255y559d494ckf196119dadc0a7e6@mail.gmail.com>
	<2613171a0912230310o104645bk9d58b8f04747cbdb@mail.gmail.com>
	<88e286470912230318q77c47769pb1685e19e0daf373@mail.gmail.com>
	<2613171a0912230403g78e83e4cg7d3ec8f324e581e@mail.gmail.com>
	<88e286470912231303u7408d726t72feb0cbfb34a65e@mail.gmail.com>
Message-ID: <88e286470912260215v5cd60e2bqc1d154909da7e606@mail.gmail.com>

The problem you are going to have using such an older version of
Django is its lack of thread safety. This means that you can only use
single threaded processes. When using mod_python that means Apache
prefork MPM. The problem with that is that every Apache server child
process will have a copy of every one of your Django sites. This will
use up a lot of memory. Using mod_wsgi embedded mode you would have
same issue.

What I would suggest therefore is instead create a mod_wsgi daemon
process group for each distinct application. You can then control the
number of single threaded processes that each site gets. For less
trafficked sites you might get away with two single threaded process,
for those with a bit more traffic somewhere between 5 and 10 depending
on load. Even those figures may be overkill so long as you properly
tune your application/database to remove bottlenecks.

For example, look at:

  http://collingrady.wordpress.com/2009/01/06/mod_python-versus-mod_wsgi/

This person was actually only using one single threaded processes and
still getting very good performance on a site which was getting a fair
bit of traffic. They had they optimised the hell out of their Django
application and database though and new what they were doing in that
area. In the end they may have switched to 2 or 3 processes, but that
was just to get rid of some startup request delays they were seeing
due to recycling processes after a set number of requests to eliminate
risk of memory creep if Python object references leaks, or spikes in
transient memory usage.

Anyway, split the sites out into separate daemon process groups. You
don't loose anything by doing this and gives you better control over
each as to how many resources you give them. Because they are separate
daemon process groups, also gives you ability to restart sites
individually without restarting whole of Apache. For what I mean by
this read:

  http://code.google.com/p/modwsgi/wiki/ReloadingSourceCode

Graham

2009/12/24 Graham Dumpleton <graham.dumpleton@gmail.com>:
> 2009/12/23 bharath venkatesh <bharathv6.project@gmail.com>:
>>>I note you have taken this off list.
>> sorry it is was not intended to take it off the list ,it was by mistake.
>>>How many Django applications?
>> we are using 4-5 Django application and we are using Django 0.97 (not sure
>> if this version is thread safe )
>
> No it isn't regarded as thread safe.
>
> I'll comment later when have time.
>
> Graham
>
>>>There are so many variables to all of this as far as knowing what is
>>>the best configuration and unfortunately only you know your
>>>applications so is going to be very hard for me to say that one way is
>>>going to be the best.
>> I understand ,we will do lot of testing and tuning before we arrive at the
>> final configuration .Thanks a lot for the help.
>> Thanks,
>> Bharath
>>
>>
>> On Wed, Dec 23, 2009 at 4:48 PM, Graham Dumpleton
>> <graham.dumpleton@gmail.com> wrote:
>>>
>>> I note you have taken this off list.
>>>
>>> 2009/12/23 bharath venkatesh <bharathv6.project@gmail.com>:
>>> > we are using apache for mainly mod python and django applications ,
>>> > ?small
>>> > images such as logos are also served ( can be migrated ) and also one
>>> > mod_php application which receives very few request .
>>>
>>> How many Django applications?
>>>
>>> If many or memory requirements of each are large, then using embedded
>>> mode is a bad idea as only option is to have a copy of each in every
>>> process. So, if using one Apache for many Django instances, better off
>>> using daemon mode as gives better control over each application and
>>> can provision less processes for Django instances which are less used
>>> so overall memory is less. You can also make use of multithreading
>>> where appropriate, that is, can handle greater capacity requests where
>>> most of the time requests are stuck waiting on databases. Your code
>>> though then has to be thread safe.
>>>
>>> There are so many variables to all of this as far as knowing what is
>>> the best configuration and unfortunately only you know your
>>> applications so is going to be very hard for me to say that one way is
>>> going to be the best.
>>>
>>> Graham
>>>
>>> > On Wed, Dec 23, 2009 at 4:25 PM, Graham Dumpleton
>>> > <graham.dumpleton@gmail.com> wrote:
>>> >>
>>> >> What else is your Apache being used for? If it is being use for other
>>> >> stuff it may not be possible to tune Apache embedded in a way that is
>>> >> best for Python web application as that will be too detriment of other
>>> >> stuff you are hosting.
>>> >>
>>> >> So, are you hosting static media on same Apache or using a separate
>>> >> web server such as nginx for static media? Are you running PHP using
>>> >> mod_php on same Apache? Are you running anything else using any
>>> >> fastcgi/scgi/ajp hosting mechanisms?
>>> >>
>>> >> In short, unless that Apache is dedicated to just the Python web
>>> >> application, the trouble of trying to tune Apache for it is no worth
>>> >> the trouble and just better off using daemon mode thus allowing you to
>>> >> separately control things.
>>> >>
>>> >> BTW, depends a bit on what your site is doing, but using nginx proxy
>>> >> front end can be very advantageous as isolates Apache from slow
>>> >> clients allowing Apache processes/threads to be better utilised.
>>> >>
>>> >> Graham
>>> >>
>>> >> 2009/12/23 bharath venkatesh <bharathv6.project@gmail.com>:
>>> >> > Hi Graham,
>>> >> >
>>> >> > ? ? ?Thanks for the link it was very informative
>>> >> > - Technically running embedded mode with prefork MPM should offer the
>>> >> > best
>>> >> > performance, especially for machines with many cpus/cores.
>>> >> > - just because mod_wsgi embedded mode and prefork MPM may be the
>>> >> > fastest
>>> >> > solution out there for Apache
>>> >> > As above lines (from link ) suggests ,can we use mod_wsgi embedded
>>> >> > mode
>>> >> > and
>>> >> > prefork MPM (as meantioned that it is best ) ?and tune apache not to
>>> >> > load
>>> >> > libraries and intialise every thime? (as our apache is already
>>> >> > running
>>> >> > as
>>> >> > prefork MPM and also our machines are multi core (8 cores) and has 16
>>> >> > AG
>>> >> > Ram) ?or we have to use mod_wsgi in daemon mode to pervent huge
>>> >> > loading
>>> >> > and
>>> >> > intialising time ? but ?as daemon mode is used with worker MPM we
>>> >> > have
>>> >> > to
>>> >> > recompile apache
>>> >> > Thanks,
>>> >> > Bharath
>>> >> >
>>> >> > On Wed, Dec 23, 2009 at 3:19 AM, Graham Dumpleton
>>> >> > <graham.dumpleton@gmail.com> wrote:
>>> >> >>
>>> >> >> 2009/12/23 bharath venkatesh <bharathv6.project@gmail.com>:
>>> >> >> > will mod wsgi in Daemon mode? solve this issue? as loading
>>> >> >> > libraries
>>> >> >> > and
>>> >> >> > initialising is done only once ?
>>> >> >>
>>> >> >> Maybe.
>>> >> >>
>>> >> >> As documented in:
>>> >> >>
>>> >> >>
>>> >> >>
>>> >> >>
>>> >> >> ?http://blog.dscpl.com.au/2009/03/load-spikes-and-excessive-memory-usage.html
>>> >> >>
>>> >> >> the OP is having problems because of how embedded mode Python
>>> >> >> applications work in Apache. This may be ?exacerbated by using
>>> >> >> prefork
>>> >> >> MPM with Apache. Same issues come up with mod_wsgi embedded mode as
>>> >> >> with mod_python if you do not configure your Apache correctly for
>>> >> >> fat
>>> >> >> Python web applications. If you are limited in being able to do that
>>> >> >> because Apache is heavily used for static file serving or mod_php,
>>> >> >> you
>>> >> >> really should use mod_wsgi daemon mode instead as described in that
>>> >> >> post.
>>> >> >>
>>> >> >> Why daemon mode will help is fixed number of persistent processes
>>> >> >> and
>>> >> >> more specifically defaulting to one process, so you only incur
>>> >> >> startup
>>> >> >> cost once and not for many processes, or in case of embedded mode
>>> >> >> also
>>> >> >> not when the processes get recycled as is default for Apache.
>>> >> >>
>>> >> >> Graham
>>> >> >>
>>> >> >> > On Tue, Dec 22, 2009 at 5:13 PM, bharath venkatesh
>>> >> >> > <bharathv6.project@gmail.com> wrote:
>>> >> >> >>
>>> >> >> >> Hi,
>>> >> >> >>
>>> >> >> >> ? ? Django with mod python? is taking time loading libraries . I
>>> >> >> >> am
>>> >> >> >> using
>>> >> >> >> python? open source libraries like montylingua , simplejson and
>>> >> >> >> django
>>> >> >> >> is
>>> >> >> >> taking
>>> >> >> >> time loading these libraries .
>>> >> >> >>
>>> >> >> >> When django is run using python manage.py runserver first request
>>> >> >> >> takes
>>> >> >> >> time but rest of the requests doesn't take time ( quite fast )
>>> >> >> >> ,which
>>> >> >> >> is
>>> >> >> >> acceptable but when django is used along with apache and
>>> >> >> >> mod_python
>>> >> >> >> it
>>> >> >> >> takes
>>> >> >> >> time as much time as django takes for first request? when run
>>> >> >> >> using
>>> >> >> >> python
>>> >> >> >> manage.py runserver for almost every request.
>>> >> >> >>
>>> >> >> >> How to avoid this as our performance is greatly hindered by this
>>> >> >> >> behaviour
>>> >> >> >>
>>> >> >> >> is it possible to cache these external open source libraries? ?
>>> >> >> >>
>>> >> >> >> Thanks in Advance,
>>> >> >> >> Bharath
>>> >> >> >
>>> >> >> > _______________________________________________
>>> >> >> > Mod_python mailing list
>>> >> >> > Mod_python@modpython.org
>>> >> >> > http://mailman.modpython.org/mailman/listinfo/mod_python
>>> >> >> >
>>> >> >> >
>>> >> >
>>> >> >
>>> >
>>> >
>>
>>
>

