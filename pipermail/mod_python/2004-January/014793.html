<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] 3.1.2b InputFilter SegFault (w/Backtrace)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%203.1.2b%20InputFilter%20SegFault%20%28w/Backtrace%29&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014791.html">
   <LINK REL="Next"  HREF="014794.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] 3.1.2b InputFilter SegFault (w/Backtrace)</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Daniel West</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%203.1.2b%20InputFilter%20SegFault%20%28w/Backtrace%29&In-Reply-To="
       TITLE="[mod_python] 3.1.2b InputFilter SegFault (w/Backtrace)">dwmp at opti.cgi.net
       </A><BR>
    <I>Sun Jan 11 02:09:37 EST 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="014791.html">[mod_python] returning an integer instead of apache.OK
</A></li>
        <LI>Next message: <A HREF="014794.html">[mod_python] Problem w/ Session
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14793">[ date ]</a>
              <a href="thread.html#14793">[ thread ]</a>
              <a href="subject.html#14793">[ subject ]</a>
              <a href="author.html#14793">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
While setting up an InputFilter I ran across a segfault in 3.1.2b.  I 
created an InputFilter to add a few members to the request object 
(filter.req) before the request is sent to the handler and 
OutputFilter.  When run, the InputFilter is processed but the new members 
it adds to the request object are not to be found in the subsequent handler 
or output filter.  After receiving a traceback (PythonDebug On) for trying 
to access non-existent members of the request object the server process 
proceeds to segfault.  Other than setting a few new members to the request 
object, the input filter just calls filter.pass_on().

Extra info: &quot;virtualhost.com&quot; is the virtual host I'm working with.  When 
other virtual hosts are listed before my virtual host, I get their name in 
the second line of the backtrace instead of &quot;virtualhost.com&quot; even though 
the request was made to &quot;virtualhost.com&quot;.

The system is Linux 2.4, Apache 2.0.48, and Python 2.3.2.  Apache is 
compiled with the worker_mpm.  Please let me know if there is any other 
information I can provide.


(gdb) r
Starting program: /usr/local/apache2/bin/httpd -DONE_PROCESS
[New Thread 1024 (LWP 7082)]
[New Thread 2049 (LWP 7084)]
[New Thread 1026 (LWP 7085)]
[New Thread 2051 (LWP 7086)]
[New Thread 3076 (LWP 7087)]
[New Thread 4101 (LWP 7088)]
[New Thread 5126 (LWP 7089)]
[New Thread 6151 (LWP 7090)]
[New Thread 7176 (LWP 7091)]
[New Thread 8201 (LWP 7092)]
[New Thread 9226 (LWP 7093)]
[New Thread 10251 (LWP 7094)]
[New Thread 11276 (LWP 7095)]
[New Thread 12301 (LWP 7096)]
[New Thread 13326 (LWP 7097)]
[New Thread 14351 (LWP 7098)]
[New Thread 15376 (LWP 7099)]
[New Thread 16401 (LWP 7100)]
[New Thread 17426 (LWP 7101)]
[New Thread 18451 (LWP 7102)]
[New Thread 19476 (LWP 7103)]
[New Thread 20501 (LWP 7104)]
[New Thread 21526 (LWP 7105)]
[New Thread 22551 (LWP 7106)]
[New Thread 23576 (LWP 7107)]
[New Thread 24601 (LWP 7108)]
[New Thread 25626 (LWP 7109)]
[New Thread 26651 (LWP 7110)]
[New Thread 27676 (LWP 7111)]

Program received signal SIGSEGV, Segmentation fault.
[Switching to Thread 2051 (LWP 7086)]
ap_add_cgi_vars (r=0x81f3fd8) at util_script.c:390
390         if (!strcmp(r-&gt;protocol, &quot;INCLUDED&quot;)) {
(gdb) bt
#0  ap_add_cgi_vars (r=0x81f3fd8) at util_script.c:390
#1  0x401f488a in get_request_object (req=0x81f3fd8, interp_name=0x8127298 
&quot;virtualhost.com&quot;,
     phase=0x40289a8e &quot;PythonInputFilter&quot;) at mod_python.c:862
#2  0x401f50cc in python_filter (is_input=1, f=0x81f5708, bb=0x81f4c68, 
mode=AP_MODE_GETLINE,
     block=APR_BLOCK_READ, readbytes=0) at mod_python.c:1338
#3  0x401f5190 in python_input_filter (f=0x81f5708, bb=0x81f4c68, 
mode=AP_MODE_GETLINE, block=APR_BLOCK_READ,
     readbytes=0) at mod_python.c:1383
#4  0x0809024e in ap_get_brigade (next=0x81f5708, bb=0x81f4c68, 
mode=AP_MODE_GETLINE, block=APR_BLOCK_READ,
     readbytes=0) at util_filter.c:514
#5  0x0809024e in ap_get_brigade (next=0x81f4c08, bb=0x81f4c68, 
mode=AP_MODE_GETLINE, block=APR_BLOCK_READ,
     readbytes=0) at util_filter.c:514
#6  0x0809104b in ap_rgetline_core (s=0x81f3ff0, n=8192, read=0x40844958, 
r=0x81f3fd8, fold=0, bb=0x81f4c68)
     at protocol.c:256
#7  0x0809150d in read_request_line (r=0x81f3fd8, bb=0x81f4c68) at 
protocol.c:623
#8  0x08091a8f in ap_read_request (conn=0x81ee0b0) at protocol.c:900
#9  0x08069940 in ap_process_http_connection (c=0x81ee0b0) at http_core.c:312
#10 0x0808e742 in ap_run_process_connection (c=0x81ee0b0) at connection.c:85
#11 0x08082c22 in process_socket (p=0x81edf88, sock=0x81edfc0, 
my_child_num=0, my_thread_num=0,
     bucket_alloc=0x81f1f98) at worker.c:632
#12 0x080831f6 in worker_thread (thd=0x8116d48, dummy=0x81beb78) at 
worker.c:946
#13 0x4010e090 in dummy_worker (opaque=0x8116d48) at thread.c:127
#14 0x4011dfef in pthread_start_thread () from /lib/i686/libpthread.so.0
#15 0x4011e0df in pthread_start_thread_event () from /lib/i686/libpthread.so.0
(gdb)





</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="014791.html">[mod_python] returning an integer instead of apache.OK
</A></li>
	<LI>Next message: <A HREF="014794.html">[mod_python] Problem w/ Session
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14793">[ date ]</a>
              <a href="thread.html#14793">[ thread ]</a>
              <a href="subject.html#14793">[ subject ]</a>
              <a href="author.html#14793">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
