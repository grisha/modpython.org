<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Mod_Python not releasing memory?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Mod_Python%20not%20releasing%20memory%3F&In-Reply-To=200808181532.m7IFWd02022975%40modpython.org">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025549.html">
   <LINK REL="Next"  HREF="025557.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Mod_Python not releasing memory?</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Mod_Python%20not%20releasing%20memory%3F&In-Reply-To=200808181532.m7IFWd02022975%40modpython.org"
       TITLE="[mod_python] Mod_Python not releasing memory?">graham.dumpleton at gmail.com
       </A><BR>
    <I>Mon Aug 18 21:30:21 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="025549.html">[mod_python] Mod_Python not releasing memory?
</A></li>
        <LI>Next message: <A HREF="025557.html">[mod_python] Mod_Python not releasing memory?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25551">[ date ]</a>
              <a href="thread.html#25551">[ thread ]</a>
              <a href="subject.html#25551">[ subject ]</a>
              <a href="author.html#25551">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>2008/8/19  &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Scott.Chapman at verizonwireless.com</A>&gt;:
&gt;<i> I have Apache/2.2.8 (Unix) mod_python/3.3.1 Python/2.4.5 on Red Hat
</I>&gt;<i> Enterprise Linux AS release 4 (Nahant Update 6).
</I>&gt;<i> Apache compiled:
</I>&gt;<i> ./configure --with-mpm=prefork --enable-mods-shared=&quot;most proxy
</I>&gt;<i> charset_lite&quot; --with-expat=system
</I>&gt;<i>
</I>&gt;<i> Mod Python:
</I>&gt;<i> ./configure --with-apxs=/usr/local/apache2/bin/apxs
</I>&gt;<i> --with-python=/usr/local/bin/python2.4
</I>&gt;<i>
</I>&gt;<i> Python:
</I>&gt;<i> ./configure --enable-shared
</I>&gt;<i>
</I>&gt;<i> My application is using Cheetah to generate a very large HTML table and
</I>&gt;<i> sending it back to the client, after retrieving a bunch of database rows.
</I>&gt;<i>
</I>&gt;<i> One hit to Apache to generate one of these big tables runs memory usage up
</I>&gt;<i> to 30.6% of system RAM:
</I>&gt;<i>
</I>&gt;<i> $ ps aux | grep 30316 | grep -v grep
</I>&gt;<i> USER       PID %CPU %MEM   VSZ  RSS TTY      STAT START   TIME COMMAND
</I>&gt;<i> web      30316  2.7 27.7 1559948 1122772 ?   Rl   12:48   1:21
</I>&gt;<i> /usr/local/apache2/bin/httpd -k start
</I>&gt;<i>
</I>&gt;<i> $ ps aux | grep 30316 | grep -v grep
</I>&gt;<i> USER       PID %CPU %MEM   VSZ  RSS TTY      STAT START   TIME COMMAND
</I>&gt;<i> web      30316  2.7 30.6 1559948 1237948 ?   Rl   12:48   1:21
</I>&gt;<i> /usr/local/apache2/bin/httpd -k start
</I>&gt;<i>
</I>&gt;<i> After the query is done and the results delivered to the browser, the Apache
</I>&gt;<i> process is still holding about 25% of system memory.
</I>&gt;<i>
</I>&gt;<i> I don't see any way to free that memory.
</I>&gt;<i> Once I &quot;return result&quot; to the browser, I can't do &quot;result=None&quot; so I'm
</I>&gt;<i> relying on Python to release the memory and it is taking way too long for
</I>&gt;<i> that to happen.  I do set the database result set to None as soon as I can
</I>&gt;<i> and that helps some.
</I>&gt;<i>
</I>&gt;<i> If I get a number of these big hits, OOM starts killing PIDs which is a &quot;Bad
</I>&gt;<i> Thing&quot;.
</I>&gt;<i>
</I>&gt;<i> Any clues on how to make that memory release sooner?
</I>
This is normal behaviour. You need to do some reading/research on how
memory is used in operating systems.

In short though, in general once a process needs to allocate memory
from the operating system it is then marked as being in use by that
process for the life of the process, even if the individual memory
fragments are freed by code. Such freed memory can be reused within
the same process, but isn't released back to operating system for
other processes to use.

Graham
</PRE>







<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="025549.html">[mod_python] Mod_Python not releasing memory?
</A></li>
	<LI>Next message: <A HREF="025557.html">[mod_python] Mod_Python not releasing memory?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25551">[ date ]</a>
              <a href="thread.html#25551">[ thread ]</a>
              <a href="subject.html#25551">[ subject ]</a>
              <a href="author.html#25551">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="DISABLEhttp://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
