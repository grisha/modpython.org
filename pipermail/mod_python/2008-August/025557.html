<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Mod_Python not releasing memory?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Mod_Python%20not%20releasing%20memory%3F&In-Reply-To=NYOBGCEXSMTP21PkKTn000ba401%40nyobgcexsmtp21.uswin.ad.vzwcorp.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025551.html">
   <LINK REL="Next"  HREF="025558.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Mod_Python not releasing memory?</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Scott.Chapman at VerizonWireless.com</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Mod_Python%20not%20releasing%20memory%3F&In-Reply-To=NYOBGCEXSMTP21PkKTn000ba401%40nyobgcexsmtp21.uswin.ad.vzwcorp.com"
       TITLE="[mod_python] Mod_Python not releasing memory?">Scott.Chapman at VerizonWireless.com
       </A><BR>
    <I>Tue Aug 19 09:55:58 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="025551.html">[mod_python] Mod_Python not releasing memory?
</A></li>
        <LI>Next message: <A HREF="025558.html">[mod_python] Mod_Python not releasing memory?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25557">[ date ]</a>
              <a href="thread.html#25557">[ thread ]</a>
              <a href="subject.html#25557">[ subject ]</a>
              <a href="author.html#25557">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>

&gt;<i> -----Original Message-----
</I>&gt;<i> From: Graham Dumpleton [mailto:<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">graham.dumpleton at gmail.com</A>]
</I>&gt;<i> Sent: Monday, August 18, 2008 9:30 PM
</I>&gt;<i> To: Chapman, Scott Earl
</I>&gt;<i> Cc: <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">mod_python at modpython.org</A>
</I>&gt;<i> Subject: Re: [mod_python] Mod_Python not releasing memory?
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 2008/8/19  &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Scott.Chapman at verizonwireless.com</A>&gt;:
</I>&gt;<i> &gt; I have Apache/2.2.8 (Unix) mod_python/3.3.1 Python/2.4.5 on Red Hat
</I>&gt;<i> &gt; Enterprise Linux AS release 4 (Nahant Update 6).
</I>&gt;<i> &gt; Apache compiled:
</I>&gt;<i> &gt; ./configure --with-mpm=prefork --enable-mods-shared=&quot;most proxy
</I>&gt;<i> &gt; charset_lite&quot; --with-expat=system
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Mod Python:
</I>&gt;<i> &gt; ./configure --with-apxs=/usr/local/apache2/bin/apxs
</I>&gt;<i> &gt; --with-python=/usr/local/bin/python2.4
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Python:
</I>&gt;<i> &gt; ./configure --enable-shared
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; My application is using Cheetah to generate a very large 
</I>&gt;<i> HTML table and
</I>&gt;<i> &gt; sending it back to the client, after retrieving a bunch of 
</I>&gt;<i> database rows.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; One hit to Apache to generate one of these big tables runs 
</I>&gt;<i> memory usage up
</I>&gt;<i> &gt; to 30.6% of system RAM:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; $ ps aux | grep 30316 | grep -v grep
</I>&gt;<i> &gt; USER       PID %CPU %MEM   VSZ  RSS TTY      STAT START   
</I>&gt;<i> TIME COMMAND
</I>&gt;<i> &gt; web      30316  2.7 27.7 1559948 1122772 ?   Rl   12:48   1:21
</I>&gt;<i> &gt; /usr/local/apache2/bin/httpd -k start
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; $ ps aux | grep 30316 | grep -v grep
</I>&gt;<i> &gt; USER       PID %CPU %MEM   VSZ  RSS TTY      STAT START   
</I>&gt;<i> TIME COMMAND
</I>&gt;<i> &gt; web      30316  2.7 30.6 1559948 1237948 ?   Rl   12:48   1:21
</I>&gt;<i> &gt; /usr/local/apache2/bin/httpd -k start
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; After the query is done and the results delivered to the 
</I>&gt;<i> browser, the Apache
</I>&gt;<i> &gt; process is still holding about 25% of system memory.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I don't see any way to free that memory.
</I>&gt;<i> &gt; Once I &quot;return result&quot; to the browser, I can't do 
</I>&gt;<i> &quot;result=None&quot; so I'm
</I>&gt;<i> &gt; relying on Python to release the memory and it is taking 
</I>&gt;<i> way too long for
</I>&gt;<i> &gt; that to happen.  I do set the database result set to None 
</I>&gt;<i> as soon as I can
</I>&gt;<i> &gt; and that helps some.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; If I get a number of these big hits, OOM starts killing 
</I>&gt;<i> PIDs which is a &quot;Bad
</I>&gt;<i> &gt; Thing&quot;.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Any clues on how to make that memory release sooner?
</I>&gt;<i> 
</I>&gt;<i> This is normal behaviour. You need to do some reading/research on how
</I>&gt;<i> memory is used in operating systems.
</I>&gt;<i> 
</I>&gt;<i> In short though, in general once a process needs to allocate memory
</I>&gt;<i> from the operating system it is then marked as being in use by that
</I>&gt;<i> process for the life of the process, even if the individual memory
</I>&gt;<i> fragments are freed by code. Such freed memory can be reused within
</I>&gt;<i> the same process, but isn't released back to operating system for
</I>&gt;<i> other processes to use.
</I>
If that were true, how would a processes memory usage ever spike and then go back down? I have seen this behavior plenty of times.

Scott


The information contained in this message and any attachment may be
proprietary, confidential, and privileged or subject to the work
product doctrine and thus protected from disclosure.  If the reader
of this message is not the intended recipient, or an employee or
agent responsible for delivering this message to the intended
recipient, you are hereby notified that any dissemination,
distribution or copying of this communication is strictly prohibited.
If you have received this communication in error, please notify me
immediately by replying to this message and deleting it and all
copies and backups thereof.  Thank you.



</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="025551.html">[mod_python] Mod_Python not releasing memory?
</A></li>
	<LI>Next message: <A HREF="025558.html">[mod_python] Mod_Python not releasing memory?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25557">[ date ]</a>
              <a href="thread.html#25557">[ thread ]</a>
              <a href="subject.html#25557">[ subject ]</a>
              <a href="author.html#25557">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="DISABLEhttp://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
