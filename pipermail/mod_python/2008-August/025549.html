<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Mod_Python not releasing memory?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Mod_Python%20not%20releasing%20memory%3F&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025550.html">
   <LINK REL="Next"  HREF="025551.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Mod_Python not releasing memory?</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Scott.Chapman at VerizonWireless.com</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Mod_Python%20not%20releasing%20memory%3F&In-Reply-To="
       TITLE="[mod_python] Mod_Python not releasing memory?">Scott.Chapman at VerizonWireless.com
       </A><BR>
    <I>Mon Aug 18 11:32:30 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="025550.html">[mod_python] [SPAM] [Newbie] import_module() function or Python's
	import statement
</A></li>
        <LI>Next message: <A HREF="025551.html">[mod_python] Mod_Python not releasing memory?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25549">[ date ]</a>
              <a href="thread.html#25549">[ thread ]</a>
              <a href="subject.html#25549">[ subject ]</a>
              <a href="author.html#25549">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I have Apache/2.2.8 (Unix) mod_python/3.3.1 Python/2.4.5 on Red Hat Enterprise Linux AS release 4 (Nahant Update 6).
Apache compiled:
./configure --with-mpm=prefork --enable-mods-shared=&quot;most proxy charset_lite&quot; --with-expat=system 

Mod Python:
./configure --with-apxs=/usr/local/apache2/bin/apxs --with-python=/usr/local/bin/python2.4 

Python:
./configure --enable-shared 

My application is using Cheetah to generate a very large HTML table and sending it back to the client, after retrieving a bunch of database rows.

One hit to Apache to generate one of these big tables runs memory usage up to 30.6% of system RAM:

$ ps aux | grep 30316 | grep -v grep
USER       PID %CPU %MEM   VSZ  RSS TTY      STAT START   TIME COMMAND
web      30316  2.7 27.7 1559948 1122772 ?   Rl   12:48   1:21 /usr/local/apache2/bin/httpd -k start

$ ps aux | grep 30316 | grep -v grep
USER       PID %CPU %MEM   VSZ  RSS TTY      STAT START   TIME COMMAND
web      30316  2.7 30.6 1559948 1237948 ?   Rl   12:48   1:21 /usr/local/apache2/bin/httpd -k start

After the query is done and the results delivered to the browser, the Apache process is still holding about 25% of system memory.
I don't see any way to free that memory.  
Once I &quot;return result&quot; to the browser, I can't do &quot;result=None&quot; so I'm relying on Python to release the memory and it is taking way too long for that to happen.  I do set the database result set to None as soon as I can and that helps some.

If I get a number of these big hits, OOM starts killing PIDs which is a &quot;Bad Thing&quot;.

Any clues on how to make that memory release sooner?

Thanks,
Scott


The information contained in this message and any attachment may be
proprietary, confidential, and privileged or subject to the work
product doctrine and thus protected from disclosure.  If the reader
of this message is not the intended recipient, or an employee or
agent responsible for delivering this message to the intended
recipient, you are hereby notified that any dissemination,
distribution or copying of this communication is strictly prohibited.
If you have received this communication in error, please notify me
immediately by replying to this message and deleting it and all
copies and backups thereof.  Thank you.

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20080818/c5e8dede/attachment.html">http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20080818/c5e8dede/attachment.html</A>
</PRE>








<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="025550.html">[mod_python] [SPAM] [Newbie] import_module() function or Python's
	import statement
</A></li>
	<LI>Next message: <A HREF="025551.html">[mod_python] Mod_Python not releasing memory?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25549">[ date ]</a>
              <a href="thread.html#25549">[ thread ]</a>
              <a href="subject.html#25549">[ subject ]</a>
              <a href="author.html#25549">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
