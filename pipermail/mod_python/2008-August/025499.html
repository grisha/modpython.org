<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Re: python exceptions cause Apache to crash
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Re%3A%20python%20exceptions%20cause%20Apache%20to%20crash&In-Reply-To=85f667130808041151t10bb4738g43750e0cc1b03617%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="025498.html">
   <LINK REL="Next"  HREF="025504.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Re: python exceptions cause Apache to crash</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Jason Carver</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Re%3A%20python%20exceptions%20cause%20Apache%20to%20crash&In-Reply-To=85f667130808041151t10bb4738g43750e0cc1b03617%40mail.gmail.com"
       TITLE="[mod_python] Re: python exceptions cause Apache to crash">ynj0qeh02 at sneakemail.com
       </A><BR>
    <I>Mon Aug  4 16:55:26 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="025498.html">[mod_python] python exceptions cause Apache to crash
</A></li>
        <LI>Next message: <A HREF="025504.html">[mod_python] Re: python exceptions cause Apache to crash
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25499">[ date ]</a>
              <a href="thread.html#25499">[ thread ]</a>
              <a href="subject.html#25499">[ subject ]</a>
              <a href="author.html#25499">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Here is code that consistently crashes Apache for me:

import logging

def index(req):
    &quot;&quot;&quot;Handles all Browser Requests&quot;&quot;&quot;
    try:
        reqHandler = logging.StreamHandler(req)
        logging.getLogger('').addHandler(reqHandler)
        if req.form.has_key('action'):
            raise Exception('Goodbye Apache')
    except Exception, e:
        logging.exception('I crash')
        raise

Now just go to the site with /?action=dosomething and it will crash

Removing the if statement, the exception, or the logger are all ways of
alleviating the crash, but none of them should be necessary.

Cheers,
Jason

On Mon, Aug 4, 2008 at 2:51 PM, Jason Carver &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">ynj0qeh02 at sneakemail.com</A>&gt;wrote:

&gt;<i> Hi all,
</I>&gt;<i>
</I>&gt;<i> I am having the craziest error, confirmed on both a LAMPython and WAMPython
</I>&gt;<i> setup: exceptions in mod_python are causing Apache to crash hard.  Even
</I>&gt;<i> stranger is that the exceptions have to meet a few specific conditions to
</I>&gt;<i> cause Apache to crash.
</I>&gt;<i>
</I>&gt;<i> As best I can tell those conditions include:
</I>&gt;<i>
</I>&gt;<i>    - raising an exception (this problem always goes away if the exception
</I>&gt;<i>    is commented out)
</I>&gt;<i>    - having the exception be inside an if-block that tests a dictionary
</I>&gt;<i>    (the problem goes away if I do something like &quot;&quot;&quot;if 'hello' == 'hello':
</I>&gt;<i>    raise Exception('goodbye')&quot;&quot;&quot;)
</I>&gt;<i>    - catching the exception and logging it using the python built-in
</I>&gt;<i>    logging.exception(e) (the problem goes away if I comment out the logger)
</I>&gt;<i>
</I>&gt;<i> Apache does not write anything to its error.log, so it was a bit of an
</I>&gt;<i> adventure to discover all these elements.
</I>&gt;<i>
</I>&gt;<i> Any ideas?
</I>&gt;<i>
</I>&gt;<i> Cheers,
</I>&gt;<i> Jason
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20080804/0f8fc167/attachment.html">http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20080804/0f8fc167/attachment.html</A>
</PRE>









<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="025498.html">[mod_python] python exceptions cause Apache to crash
</A></li>
	<LI>Next message: <A HREF="025504.html">[mod_python] Re: python exceptions cause Apache to crash
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#25499">[ date ]</a>
              <a href="thread.html#25499">[ thread ]</a>
              <a href="subject.html#25499">[ subject ]</a>
              <a href="author.html#25499">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
