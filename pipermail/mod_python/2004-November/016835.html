<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] mod_python, best practices
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20mod_python%2C%20best%20practices&In-Reply-To=B966F18B-3E04-11D9-9EF8-000393BB31F6%40dscpl.com.au">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016833.html">
   <LINK REL="Next"  HREF="016836.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] mod_python, best practices</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20mod_python%2C%20best%20practices&In-Reply-To=B966F18B-3E04-11D9-9EF8-000393BB31F6%40dscpl.com.au"
       TITLE="[mod_python] mod_python, best practices">grahamd at dscpl.com.au
       </A><BR>
    <I>Wed Nov 24 07:04:11 EST 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="016833.html">[mod_python] mod_python, best practices
</A></li>
        <LI>Next message: <A HREF="016836.html">[mod_python] mod_python, best practices
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16835">[ date ]</a>
              <a href="thread.html#16835">[ thread ]</a>
              <a href="subject.html#16835">[ subject ]</a>
              <a href="author.html#16835">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On 24/11/2004, at 9:36 PM, Graham Dumpleton wrote:

&gt;<i>
</I>&gt;<i> On Wednesday, November 24, 2004, at 08:35  PM, Rune Hansen wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> Hi,
</I>&gt;&gt;<i> I've written a rather long and winding document which I've called  
</I>&gt;&gt;<i> &quot;mod_python, best practices&quot;.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> A better name would be &quot;mod_python, assumptions made on shaky ground  
</I>&gt;&gt;<i> - kept in a light tone to mask my inherent fear of making a complete  
</I>&gt;&gt;<i> fool of my self.&quot; Obviously, that title is to long.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Anyway, the document can be found here <A HREF="http://www.scanmine.com/mp/">http://www.scanmine.com/mp/</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I'd really like thoughts, comments and corrections... keep your  
</I>&gt;&gt;<i> smirks and laughs to your self :)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> As you read the document it will become apparent that english is not  
</I>&gt;&gt;<i> my native tongue, feel free to comment on that too.
</I>&gt;<i>
</I>&gt;<i> ...
</I>
&gt;<i> On the issue of configuration files, again, look at Vampire. It
</I>&gt;<i> provides a mechanism for configuration which also uses ConfigParser.
</I>&gt;<i> It has though a smart search ability to find the config file. Ie.,
</I>&gt;<i> rather than having to specify the exact location of the config file,
</I>&gt;<i> you simply ask for config file of certain name, and using the req
</I>&gt;<i> object will search back up the directory hierarchy until found,
</I>&gt;<i> or will stop searching if go up as far as where the PythonHandler
</I>&gt;<i> definition was found. Thus instead of writing:
</I>&gt;<i>
</I>&gt;<i> def handler(req):
</I>&gt;<i>     global CONFIG,cfgfile
</I>&gt;<i>     if not CONFIG:
</I>&gt;<i>        CONFIG =  
</I>&gt;<i> Cfgparser(&quot;/&quot;.join([os.path.dirname(__file__),cfgfile]),req.server)
</I>&gt;<i>        CONFIG.getConfig()
</I>&gt;<i>     req.CONFIG = CONFIG
</I>&gt;<i>
</I>&gt;<i> one can write something like:
</I>&gt;<i>
</I>&gt;<i> def handler_html(req):
</I>&gt;<i>     config = vampire.loadConfig(req,&quot;Globals.cfg&quot;)
</I>&gt;<i>
</I>&gt;<i> This means that you don't have to specify fixed relative pathnames in
</I>&gt;<i> subdirectory content handlers to refer to a config somewhere above
</I>&gt;<i> that directory, instead it will be automatically found. This allows
</I>&gt;<i> one to freely move stuff around and not have to fix up any fixed
</I>&gt;<i> location paths.
</I>&gt;<i>
</I>&gt;<i> The config object you get back also has some default values set which
</I>&gt;<i> allow one to easily create URLs which reference back to the root of
</I>&gt;<i> your application, again avoiding issues of having hardcoded relative
</I>&gt;<i> paths. Unfortunately, haven't yet released a newer version of Vampire I
</I>&gt;<i> have which takes this a bit further and makes it even more useful.
</I>&gt;<i>
</I>&gt;<i> Configs are cached automatically, but the cache will also reload them
</I>&gt;<i> automatically when it detects that the actual config file has changed.
</I>
In a rush of madness, I have released Vampire 1.3 which has the changes
to the config support I alluded to above.

As an quick illustration of how the config mechanism supplied with
Vampire can work, the Vampire web site tree has a &quot;.htaccess&quot; and
&quot;.vampire&quot; file in its root directory. You can see the content of
the .vampire file as:

   <A HREF="http://www.dscpl.com.au/projects/vampire/source/.vampire">http://www.dscpl.com.au/projects/vampire/source/.vampire</A>

The .htaccess file has various PythonOption settings:

   PythonOption VampireHandlersSection Handlers
   PythonOption VampireHandlersConfig .vampire
   PythonOption VisibleSourceExtensions .html .psp .py .rml .vampire
   PythonOption VampireDirectoryIndex index.html

In a subdirectory I have a content handler example which will display  
the
config as will be available when loaded. This example, will look for the
.vampire file starting in its directory and moving upwards. The source
code for this content handler is:

    
<A HREF="http://www.dscpl.com.au/projects/vampire/source/examples-01/vampire-">http://www.dscpl.com.au/projects/vampire/source/examples-01/vampire-</A> 
config.py
    
<A HREF="http://www.dscpl.com.au/projects/vampire/source/examples-01/vampire-">http://www.dscpl.com.au/projects/vampire/source/examples-01/vampire-</A> 
config.html

You can see what it produces by accessing:

    
<A HREF="http://www.dscpl.com.au/projects/vampire/examples-01/vampire-">http://www.dscpl.com.au/projects/vampire/examples-01/vampire-</A> 
config.html
    
<A HREF="http://www.dscpl.com.au/projects/vampire/examples-01/vampire-">http://www.dscpl.com.au/projects/vampire/examples-01/vampire-</A> 
config.html?mode=raw

Note this is actually an example designed to show what config is  
available,
you don't need to browse other like this example does, just get the  
variable
you need and your done. I just happen to use the HTMLTemplate package to
render pages, but you could be using mpservlets, psp or anything else  
for
that matter.

As you have used ConfigParser already you will understand the difference
between interpolated values and raw mode which shows values before being
interpolated.

As is standard with ConfigParser, interpolation will take values from  
the
same section in the config file. Vampire also sets things up though so  
that
values used for interpolation can be sourced from PythonOption settings  
in
the .htaccess file, although the example does use these as such in any  
of
the config file value strings.

Also, Vampire sets up some magic variables which can be used in string
interpolation. These are:

       __config_root__ --&gt; Absolute path to directory config file is in.
       __config_file__ --&gt; Absolute path to the actual config file.
       __config_mtime__ --&gt; Modification time of the config file.
       __baseurl_abs__ --&gt; Base URL of the directory where config file  
is in.
       __handler_root__ --&gt; Where PythonHandler directive was defined.
       __baseurl_rel__  --&gt; Base URL relative to the current request.

The base URL variables are useful as they relate to the URL used in a  
request.
One can thus put a config file at the top of your web application.  
Under that
you would have an &quot;images&quot; and &quot;styles&quot; directory. Your config can then  
have:

   images = %(__baseurl_rel__)s/images
   styles = %(__baseurl_rel__)s/styles

In content handlers anywhere in nested subdiretories, they can get the  
config
and grab those values and relative path will always be setup correctly  
to
reference the images and styles directory. This can be used to then  
fill out
content in HTML as appropriate. One could have used __baseurl_abs__ as  
well,
but then someone who scrapes your site into static files would have  
links
which reference a location which wouldn't exist if they hosted it in a  
different
location, thus relative paths preferable.

Hopefully you can see where I am going with this.

Bit more information in CHANGES file for Vampire 1.3.

   <A HREF="http://www.dscpl.com.au/projects/vampire/CHANGES">http://www.dscpl.com.au/projects/vampire/CHANGES</A>

I really got to log off now. Not sure when I'll be able to next read  
email. :-(

--
Graham Dumpleton (<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">grahamd at dscpl.com.au</A>)

</PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="016833.html">[mod_python] mod_python, best practices
</A></li>
	<LI>Next message: <A HREF="016836.html">[mod_python] mod_python, best practices
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16835">[ date ]</a>
              <a href="thread.html#16835">[ thread ]</a>
              <a href="subject.html#16835">[ subject ]</a>
              <a href="author.html#16835">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
