<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python]  Hello all,
	Questions about Mod Python sessions on Linux
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20%20Hello%20all%2C%0A%09Questions%20about%20Mod%20Python%20sessions%20on%20Linux&In-Reply-To=41954D4E.5050101%40qalabs.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016789.html">
   <LINK REL="Next"  HREF="016787.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python]  Hello all,
	Questions about Mod Python sessions on Linux</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>michael bayer</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20%20Hello%20all%2C%0A%09Questions%20about%20Mod%20Python%20sessions%20on%20Linux&In-Reply-To=41954D4E.5050101%40qalabs.com"
       TITLE="[mod_python]  Hello all,
	Questions about Mod Python sessions on Linux">mike_mp at zzzcomputing.com
       </A><BR>
    <I>Sat Nov 13 14:53:44 EST 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="016789.html">[mod_python]  Hello all,	Questions about Mod Python sessions
	on Linux
</A></li>
        <LI>Next message: <A HREF="016787.html">[mod_python] Strange bug in req.sendfile
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16790">[ date ]</a>
              <a href="thread.html#16790">[ thread ]</a>
              <a href="subject.html#16790">[ subject ]</a>
              <a href="author.html#16790">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>yikes !   a database connection is an active network connection to a 
database server in the current application's process space.  if you 
pack it up into a file, which is what the session really is, and pull 
it out again, its meaningless.

I would make a bet that your windows installation is working better 
than the linux one becuase the windows session is probably storing 
everything in memory.  but then, if you are holding one database 
connection per user in each user's session, what if you have 50,000 
users all visit your site in a day ?  youd be storing 50,000 database 
connections.  actually you wouldnt since your app would crash long 
before you got there.

just store user data only in the session...a good rule of thumb for 
starters is, if its not a string, dont store it.  don't put any kind of 
application resources in there.

On Nov 12, 2004, at 6:54 PM, Trevor West wrote:

&gt;<i> Hi Michael,
</I>&gt;<i>
</I>&gt;<i> The really funny thing is that it should be an instance, and it is the 
</I>&gt;<i> user specific information instance that I want to keep in the session. 
</I>&gt;<i> Something is really strange between my linux and windows build though. 
</I>&gt;<i> I can do very little with sessions on Linux for some reason. I've 
</I>&gt;<i> pulled apart my instance so that I'm now only trying to save the 
</I>&gt;<i> database connection (again something that works on Windows) and I get 
</I>&gt;<i> this error instead:
</I>&gt;<i>
</I>&gt;<i> Mod_python error: &quot;PythonHandler mod_python.publisher&quot;
</I>&gt;<i>
</I>&gt;<i> Traceback (most recent call last):
</I>&gt;<i>
</I>&gt;<i>  File &quot;/usr/local/lib/python2.3/site-packages/mod_python/apache.py&quot;, 
</I>&gt;<i> line 299, in HandlerDispatch
</I>&gt;<i>    result = object(req)
</I>&gt;<i>
</I>&gt;<i>  File 
</I>&gt;<i> &quot;/usr/local/lib/python2.3/site-packages/mod_python/publisher.py&quot;, line 
</I>&gt;<i> 136, in handler
</I>&gt;<i>    result = util.apply_fs_data(object, req.form, req=req)
</I>&gt;<i>
</I>&gt;<i>  File &quot;/usr/local/lib/python2.3/site-packages/mod_python/util.py&quot;, 
</I>&gt;<i> line 361, in apply_fs_data
</I>&gt;<i>    return object(**args)
</I>&gt;<i>
</I>&gt;<i>  File &quot;/usr/local/apache2/htdocs/test/mptest.py&quot;, line 43, in login
</I>&gt;<i>    sess.save()
</I>&gt;<i>
</I>&gt;<i>  File &quot;/usr/local/lib/python2.3/site-packages/mod_python/Session.py&quot;, 
</I>&gt;<i> line 204, in save
</I>&gt;<i>    self.do_save(dict)
</I>&gt;<i>
</I>&gt;<i>  File &quot;/usr/local/lib/python2.3/site-packages/mod_python/Session.py&quot;, 
</I>&gt;<i> line 329, in do_save
</I>&gt;<i>    dbm[self._sid] = cPickle.dumps(dict)
</I>&gt;<i>
</I>&gt;<i>  File &quot;/usr/local/lib/python2.3/copy_reg.py&quot;, line 70, in _reduce_ex
</I>&gt;<i>    state = base(self)
</I>&gt;<i>
</I>&gt;<i> TypeError: connect() argument 1 must be string, not Connection
</I>&gt;<i>
</I>&gt;<i> I'm wondering if my installation should be done again, or if I'm not 
</I>&gt;<i> doing the configuration of apache correctly, because as far as I can 
</I>&gt;<i> tell I'm writing the code correctly, and I'm running it on another OS 
</I>&gt;<i> and it works fine (I pulled it apart like you suggested so that all 
</I>&gt;<i> I'm saving now is the database connection, the username and a couple 
</I>&gt;<i> other small pieces of data).
</I>&gt;<i>
</I>&gt;<i> Cheers
</I>&gt;<i>
</I>&gt;<i> Trevor West
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> michael bayer wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> seems like you are trying to store a Python module in the Session, 
</I>&gt;&gt;<i> and Pickle isnt able to do that.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> regardless of which platforms this may or may not work on, it 
</I>&gt;&gt;<i> generally doesn't make sense to store a module in the session, since 
</I>&gt;&gt;<i> a Python module and its instance variables, assuming normal usage via 
</I>&gt;&gt;<i> &quot;import&quot;, are all shared amongst many requests and possibly across 
</I>&gt;&gt;<i> multiple concurrent threads, whereas the Session stores information 
</I>&gt;&gt;<i> specific to one user and that user's subset of requests.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> you probably want to figure out what application state it is exactly 
</I>&gt;&gt;<i> you want to store on a per-session basis, and stick it into an object 
</I>&gt;&gt;<i> instance that you can safely pickle away.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> if you are unsure what object in your Session is a module, you can 
</I>&gt;&gt;<i> always try walking through all the elements in the session and test 
</I>&gt;&gt;<i> obj.__class__.__name__ == 'module' to see who the offending element 
</I>&gt;&gt;<i> is.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On Nov 10, 2004, at 4:24 PM, Trevor West wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Setups for use in the below discussion:
</I>&gt;&gt;&gt;<i> Machine 1:
</I>&gt;&gt;&gt;<i> Windows 2000
</I>&gt;&gt;&gt;<i> Apache 2.0.52
</I>&gt;&gt;&gt;<i> Mod Python 3.1.3
</I>&gt;&gt;&gt;<i> MySQL_Python
</I>&gt;&gt;&gt;<i> Python 2.3
</I>&gt;&gt;&gt;<i> wxPython
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Machine 2:
</I>&gt;&gt;&gt;<i> Fedora Core 2
</I>&gt;&gt;&gt;<i> Apache 2.0.52
</I>&gt;&gt;&gt;<i> Mod Python 3.1.3
</I>&gt;&gt;&gt;<i> MySQL_Python
</I>&gt;&gt;&gt;<i> Python 2.3
</I>&gt;&gt;&gt;<i> wxPython
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> I'm writing a thin-client to a wxPython application and when I run 
</I>&gt;&gt;&gt;<i> the thin client on Machine 1(the windows box) everything works 
</I>&gt;&gt;&gt;<i> great, no problem. While when I try to move it to what is now the 
</I>&gt;&gt;&gt;<i> production box, Machine 2 (linux box), I get this error:
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Mod_python error: &quot;PythonHandler mod_python.publisher&quot;
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Traceback (most recent call last):
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>  File &quot;/usr/local/lib/python2.3/site-packages/mod_python/apache.py&quot;, 
</I>&gt;&gt;&gt;<i> line 299, in HandlerDispatch
</I>&gt;&gt;&gt;<i>    result = object(req)
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>  File 
</I>&gt;&gt;&gt;<i> &quot;/usr/local/lib/python2.3/site-packages/mod_python/publisher.py&quot;, 
</I>&gt;&gt;&gt;<i> line 136, in handler
</I>&gt;&gt;&gt;<i>    result = util.apply_fs_data(object, req.form, req=req)
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>  File &quot;/usr/local/lib/python2.3/site-packages/mod_python/util.py&quot;, 
</I>&gt;&gt;&gt;<i> line 361, in apply_fs_data
</I>&gt;&gt;&gt;<i>    return object(**args)
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>  File &quot;/usr/local/apache2/htdocs/test/mptest.py&quot;, line 42, in login
</I>&gt;&gt;&gt;<i>    sess.save()
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>  File 
</I>&gt;&gt;&gt;<i> &quot;/usr/local/lib/python2.3/site-packages/mod_python/Session.py&quot;, line 
</I>&gt;&gt;&gt;<i> 204, in save
</I>&gt;&gt;&gt;<i>    self.do_save(dict)
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>  File 
</I>&gt;&gt;&gt;<i> &quot;/usr/local/lib/python2.3/site-packages/mod_python/Session.py&quot;, line 
</I>&gt;&gt;&gt;<i> 329, in do_save
</I>&gt;&gt;&gt;<i>    dbm[self._sid] = cPickle.dumps(dict)
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>  File &quot;/usr/local/lib/python2.3/copy_reg.py&quot;, line 69, in _reduce_ex
</I>&gt;&gt;&gt;<i>    raise TypeError, &quot;can't pickle %s objects&quot; % base.__name__
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> TypeError: can't pickle module objects
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> So, as far as I can tell, on my Windows box I'm able to add class 
</I>&gt;&gt;&gt;<i> instances to the session (in this case, I'm sure it's my database 
</I>&gt;&gt;&gt;<i> class that is causing this) but on Linux, it won't add it to the 
</I>&gt;&gt;&gt;<i> session.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> If anyone can give him a heads up that would be great. I've been 
</I>&gt;&gt;&gt;<i> beating my head against the wall with the linux box because the 
</I>&gt;&gt;&gt;<i> windows setup was SO easy, and being a big linux fan I was 
</I>&gt;&gt;&gt;<i> disappointed in the strange problems I've run into.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Anyway, thanks in advance.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Trevor West
</I>&gt;&gt;&gt;<i> ------------------------
</I>&gt;&gt;&gt;<i> Developer for QA Labs
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;&gt;<i> Mod_python mailing list
</I>&gt;&gt;&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;&gt;&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> Mod_python mailing list
</I>&gt;&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I>&gt;&gt;<i>
</I></PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="016789.html">[mod_python]  Hello all,	Questions about Mod Python sessions
	on Linux
</A></li>
	<LI>Next message: <A HREF="016787.html">[mod_python] Strange bug in req.sendfile
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16790">[ date ]</a>
              <a href="thread.html#16790">[ thread ]</a>
              <a href="subject.html#16790">[ subject ]</a>
              <a href="author.html#16790">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="DISABLEhttp://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
