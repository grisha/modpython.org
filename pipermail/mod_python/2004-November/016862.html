<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] memory usage
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20memory%20usage&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016858.html">
   <LINK REL="Next"  HREF="016865.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] memory usage</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Yuri Ushakov</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20memory%20usage&In-Reply-To="
       TITLE="[mod_python] memory usage">yuri.ushakov at gmail.com
       </A><BR>
    <I>Sat Nov 27 13:34:48 EST 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="016858.html">[mod_python] DirectoryIndex and mod_python problem?
</A></li>
        <LI>Next message: <A HREF="016865.html">[mod_python] CWD
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16862">[ date ]</a>
              <a href="thread.html#16862">[ thread ]</a>
              <a href="subject.html#16862">[ subject ]</a>
              <a href="author.html#16862">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,

I've been running mod_python and found some difficulties.. I run
openload which does 50 concurrent connections to a test script (S1)
and within a few seconds memory obtained by the child apache process
grows from ~10mb to 215mb, and keeps growing...

S1:
from mod_python import apache

def handler(req):
    req.content_type = &quot;text/html&quot;
    req.write(&quot;Hello!&quot;)
    return apache.OK

Configuration:
Apache/2.0.52 (Win32) PHP/4.3.9 mod_python/3.1.3 Python/2.3.4
Python debug is off
The S1 script is configured as PythonHandler wiht no other M.P. directives.


When I try the same openload test on a different script (S2), the
process rapidly grows to ~120mb and almost stops there, continuing to
eat about 5k like each 10-20 seconds. Within about 200000 requests (50
per second), memory grew from 120 to 130 megabytes. If I turn on
PythonDebug, this growth step is much higher.

Then after stopping the testing memory does not get freed. So, after
like 20 minutes of idleness apache process still occupies the big size
(130, 215, whatever it was..).

I've been wondering whether such behaviour is caused by
misconfiguration of the apache server? Or should that memory growth
stop somewhere?Thanks for any help..

S2:
import em, StringIO
import MySQLdb
from mod_python import apache
import sys
from Pool import Pool, Constructor

def index(req):
    res = {
        'visual_title': &quot;Testing&quot;
    }

    req.content_type = &quot;text/html&quot;
    
    out = StringIO.StringIO()
    try:
        interp = em.Interpreter(output = out)
        interp.file(open(req.document_root() + &quot;/t1/cp/tpl.empy&quot;),\
                    locals = { 'res': res })
        req.write(out.getvalue())
    finally:
        interp.shutdown()

Configuration:
The handler is standard publisher with no other M.P. directives.

Yuri.
</PRE>







<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="016858.html">[mod_python] DirectoryIndex and mod_python problem?
</A></li>
	<LI>Next message: <A HREF="016865.html">[mod_python] CWD
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16862">[ date ]</a>
              <a href="thread.html#16862">[ thread ]</a>
              <a href="subject.html#16862">[ subject ]</a>
              <a href="author.html#16862">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
