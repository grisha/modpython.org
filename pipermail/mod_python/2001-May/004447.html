<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Win32 threading issue
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Win32%20threading%20issue&In-Reply-To=200105090830627.SM00265%40softwareag.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004445.html">
   <LINK REL="Next"  HREF="004448.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Win32 threading issue</H1>
    <B>Stephane Bidoul</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Win32%20threading%20issue&In-Reply-To=200105090830627.SM00265%40softwareag.com"
       TITLE="[mod_python] Win32 threading issue">stephane.bidoul at softwareag.com
       </A><BR>
    <I>Wed May  9 14:07:33 EST 2001</I>
    <P><UL>
        <LI>Previous message: <A HREF="004445.html">[mod_python] Use mod_python for root/home page requests
</A></li>
        <LI>Next message: <A HREF="004448.html">[mod_python] Win32 threading issue
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4447">[ date ]</a>
              <a href="thread.html#4447">[ thread ]</a>
              <a href="subject.html#4447">[ subject ]</a>
              <a href="author.html#4447">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<table border=0 width="100%"><tr><td>
<!--beginarticle-->
<PRE>Chris,

Could you send me your driver script?
I cannot reproduce the behaviour you describe with
my own test scripts.

BTW, do you have a multiprocessor machine?
I know some problems have been reported
but never reproced on MP WIN2K machines.

-sbi

&gt;<i> -----Original Message-----
</I>&gt;<i> From: <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">mod_python-admin at modpython.org</A>
</I>&gt;<i> [mailto:<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">mod_python-admin at modpython.org</A>]On Behalf Of Chris Trengove
</I>&gt;<i> Sent: 09 May, 2001 00:28
</I>&gt;<i> To: Gregory (Grisha) Trubetskoy
</I>&gt;<i> Cc: <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">mod_python at modpython.org</A>
</I>&gt;<i> Subject: RE: [mod_python] Win32 threading issue
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Grisha,
</I>&gt;<i> 
</I>&gt;<i> Exactly what I see is variable in nature. The most usual 
</I>&gt;<i> thing will be an
</I>&gt;<i> entry in the Apache error log like this
</I>&gt;<i> 
</I>&gt;<i> [Tue May 08 16:47:37 2001] [error] PythonHandler hwtest: 
</I>&gt;<i> Traceback (most
</I>&gt;<i> recent call last):
</I>&gt;<i> 
</I>&gt;<i> [Tue May 08 16:47:37 2001] [error] PythonHandler hwtest:   File
</I>&gt;<i> &quot;e:\python20\lib\mod_python\apache.py&quot;, line 189, in Dispatch 
</I>&gt;<i>     result =
</I>&gt;<i> object(self.req) [Tue May 08 16:47:37 2001] [error] 
</I>&gt;<i> PythonHandler hwtest:
</I>&gt;<i> File &quot;c:/apache/apache/htdocs/python\hwtest.py&quot;, line 24, in handler
</I>&gt;<i> req.write(&quot;%d: %d\n&quot; % (thread.get_ident(),counter)) 
</I>&gt;<i> 
</I>&gt;<i> [Tue May 08 16:47:37 2001] [error] PythonHandler hwtest: 
</I>&gt;<i> IOError: Write
</I>&gt;<i> failed, client closed connection. 
</I>&gt;<i> 
</I>&gt;<i> When I use my Python driver script, which keeps going even if 
</I>&gt;<i> no data is
</I>&gt;<i> returned from the server, I will often end up with an access violation
</I>&gt;<i> inside Apache.exe.
</I>&gt;<i> 
</I>&gt;<i> &quot;The instruction at &quot;0x6ff71679&quot; referenced memory at 
</I>&gt;<i> &quot;0x616c707b&quot;. The
</I>&gt;<i> memory could not be &quot;read&quot;.&quot;
</I>&gt;<i> 
</I>&gt;<i> Actually, this location appears to be always the same -- when 
</I>&gt;<i> it eventually
</I>&gt;<i> happens -- which might be after a significant number log 
</I>&gt;<i> error messages.
</I>&gt;<i> After the access violation, one of my driver scripts stops, because it
</I>&gt;<i> receives a socket exception (10054, &quot;Connection reset by 
</I>&gt;<i> peer&quot;), and the
</I>&gt;<i> other script continues merrily along.
</I>&gt;<i> 
</I>&gt;<i> Occassionally other things can happen too -- I think it just 
</I>&gt;<i> depends on
</I>&gt;<i> when the two threads conflict. As I mentioned earilier, one really
</I>&gt;<i> misterious occurrence is getting a &quot;double message&quot; returned 
</I>&gt;<i> to one thread,
</I>&gt;<i> just as the other receives no data. Like this
</I>&gt;<i> 
</I>&gt;<i> 632: 1515843&lt;LF&gt;568: 1572286
</I>&gt;<i> 
</I>&gt;<i> Here &lt;LF&gt; is a line feed, and the numbers before the colons 
</I>&gt;<i> are the thread
</I>&gt;<i> IDs. I know that Apache has 50 threads which it is cycling through in
</I>&gt;<i> order. On this occassion 568 was due to be the thread to be 
</I>&gt;<i> used for the
</I>&gt;<i> OTHER client.
</I>&gt;<i> 
</I>&gt;<i> Chris
</I>&gt;<i> 
</I>&gt;<i> At 09:47 AM 8/05/2001 -0400, Gregory (Grisha) Trubetskoy wrote:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;Interesting...
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;Another question - when you say a thread crashes, what 
</I>&gt;<i> exactly do you see
</I>&gt;<i> &gt;- is it something in the log or one of those dr. watson messages?
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;On Tue, 8 May 2001, Chris Trengove wrote:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;&gt; Grisha,
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt; I did have KeepAlive On, but it appears to make no 
</I>&gt;<i> difference. I have just
</I>&gt;<i> &gt;&gt; tried with KeepAlive Off, and I get the same behaviour. 
</I>&gt;<i> Also, the clients I
</I>&gt;<i> &gt;&gt; have been using would be closing the connection after each 
</I>&gt;<i> request. As
</I>&gt;<i> &gt;&gt; clients I have been using a Python script with urllib, and 
</I>&gt;<i> a little C++
</I>&gt;<i> &gt;&gt; test program I wrote to see if trying a different client made any
</I>&gt;<i> &gt;&gt; difference. It didn't.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mod_python mailing list
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;<i> <A HREF="http://www.modpython.org/mailman/listinfo/mod_python">http://www.modpython.org/mailman/listinfo/mod_python</A>
</I>

</PRE>
<!--endarticle-->
</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004445.html">[mod_python] Use mod_python for root/home page requests
</A></li>
	<LI>Next message: <A HREF="004448.html">[mod_python] Win32 threading issue
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4447">[ date ]</a>
              <a href="thread.html#4447">[ thread ]</a>
              <a href="subject.html#4447">[ subject ]</a>
              <a href="author.html#4447">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
