<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Session data
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Session%20data&In-Reply-To=3B15EDB5.7E8D811B%40netgroup.dk">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004511.html">
   <LINK REL="Next"  HREF="004500.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Session data</H1>
    <B>G . Sumner Hayes</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Session%20data&In-Reply-To=3B15EDB5.7E8D811B%40netgroup.dk"
       TITLE="[mod_python] Session data">SumnerH at fool.com
       </A><BR>
    <I>Thu May 31 12:09:37 EST 2001</I>
    <P><UL>
        <LI>Previous message: <A HREF="004511.html">[mod_python] Session data
</A></li>
        <LI>Next message: <A HREF="004500.html">[mod_python] Session data
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4514">[ date ]</a>
              <a href="thread.html#4514">[ thread ]</a>
              <a href="subject.html#4514">[ subject ]</a>
              <a href="author.html#4514">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<table border=0 width="100%"><tr><td>
<!--beginarticle-->
<PRE>Bo Lorentsen &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">bl at netgroup.dk</A>&gt; wrote:
&gt;<i> &gt; You can use either shared mmap or SysV shared mem (there are
</I>&gt;<i> &gt; python modules for both) to share memory.  I wound up writing
</I>&gt;<i> &gt; a Python shared dictionary (just pickles objects into the
</I>&gt;<i> &gt; filesystem when you set them, and unpickles them when you read
</I>&gt;<i> &gt; them)
</I>&gt;<i> 
</I>&gt;<i> How about performance ? Is'nt it expensive accessing file in a
</I>&gt;<i> dir. for shared data, I mean, you have to reload it if its RW
</I>&gt;<i> data, or is it write ones read many (it sounds like it) ?
</I>
I can write about 3000 entries to the dictionary per second.  I
can read about 8000 entries from the dictionary per second.  This
is with SMP-safe locking, but running on a uniprocessor (600 Mhz
PIII).  This is tha naive 30 minute implentation without any C
extensions or anything.

Most of the time is spent pickling, fs access is _really_ fast
on a decent operating system (e.g. Linux, FreeBSD).  If you're
storing really large objects, the pickling may take longer.

If you're storing a lot of items (more than a few thousands) use
the regular db-in-fs options (nested directories with a few 1000
files each or a btree filesystem like ReiserFS).

&gt;<i> &gt; Same idea would work for user sessions, and since it's in the
</I>&gt;<i> &gt; filesystem the kernel will take care of buffering for you and
</I>&gt;<i> &gt; you can use tools like &quot;find&quot; and &quot;rm&quot; to prune the cache.
</I>&gt;<i> &gt; :-)
</I>&gt;<i>
</I>&gt;<i> Hmm, If I like to change user session data offen, I quess I
</I>&gt;<i> would go for the &quot;shared mem&quot; solution.
</I>
I tried it when I first implemented the thing , the timing was
similar (within 2-3%).  Which makes sense, because the time to
pickle is dominating anyway.  Bear in mind that the fs cache is
going to keep all your recently accessed files in RAM anyway.

If you do it in the fs, the implementation is much simpler-- you
need to build a balanced tree or hash table in SHM to get good
performance with more than 20-30 items in the database.  And
you're not as portable.  The key for me, though, was that being
able to play with the cache w/ regular user tools and assign
permissions per-item can be extremely useful.

  Sumner

</PRE>
<!--endarticle-->
</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004511.html">[mod_python] Session data
</A></li>
	<LI>Next message: <A HREF="004500.html">[mod_python] Session data
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4514">[ date ]</a>
              <a href="thread.html#4514">[ thread ]</a>
              <a href="subject.html#4514">[ subject ]</a>
              <a href="author.html#4514">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
