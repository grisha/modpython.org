<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Request.sendfile() and symlinks
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Request.sendfile%28%29%20and%20symlinks&In-Reply-To=Pine.LNX.4.63.0510151431260.5850%40trappist.elis.UGent.be">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019277.html">
   <LINK REL="Next"  HREF="019279.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Request.sendfile() and symlinks</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Request.sendfile%28%29%20and%20symlinks&In-Reply-To=Pine.LNX.4.63.0510151431260.5850%40trappist.elis.UGent.be"
       TITLE="[mod_python] Request.sendfile() and symlinks">grahamd at dscpl.com.au
       </A><BR>
    <I>Sat Oct 15 09:16:33 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="019277.html">[mod_python] Request.sendfile() and symlinks
</A></li>
        <LI>Next message: <A HREF="019279.html">[mod_python] Request.sendfile() and symlinks
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19278">[ date ]</a>
              <a href="thread.html#19278">[ thread ]</a>
              <a href="subject.html#19278">[ subject ]</a>
              <a href="author.html#19278">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Can't look at it until tomorrow, but check code in src/ 
requestobject.c of mod_python
source code. The req_sendfile() may well have a bug in it as does a  
stat of  the
file to get the length and when it tells Apache to send the file it  
passes that length
to the underlying call as the number of bytes to send. If the stat  
call is being
performed on the symlink as it appears and not what it points at, the  
wrong length
would be used. The contents of the actual file will be sent though as  
the symlink
will be followed correctly at that point, just not enough is sent.

Maybe someone else can look at this while I get some sleep. ;-)

Graham

On 15/10/2005, at 10:37 PM, Wim Heirman wrote:

&gt;<i> Hello,
</I>&gt;<i>
</I>&gt;<i> When I call req.sendfile(filename) where filename is a symbolic  
</I>&gt;<i> link, only part of the file is sent to the client (as many bytes as  
</I>&gt;<i> there are characters in the symlink's file reference, so for a  
</I>&gt;<i> symlink pointing to '../index.html' I get the first 13 bytes of the  
</I>&gt;<i> correct file). Is this normal behaviour?
</I>&gt;<i>
</I>&gt;<i> Also, I would like to set the Content-Type correctly, based on the  
</I>&gt;<i> file I'm sending. Using the standard mimetypes package works fine,  
</I>&gt;<i> but is it possible to use Apache's mime-typing for this? Since the  
</I>&gt;<i> code for that is already loaded it should be a bit more efficient.
</I>&gt;<i>
</I>&gt;<i> Regards,
</I>&gt;<i>
</I>&gt;<i> Wim
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> -- 
</I>&gt;<i> ir. Wim Heirman,
</I>&gt;<i> ELIS Department, Ghent University, Belgium
</I>&gt;<i> Phone: +32-9-264.95.27
</I>&gt;<i> E-mail: <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">wim.heirman at elis.UGent.be</A>
</I>&gt;<i> <A HREF="http://www.elis.UGent.be/~wheirman/">http://www.elis.UGent.be/~wheirman/</A>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mod_python mailing list
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I>&gt;<i>
</I>
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="019277.html">[mod_python] Request.sendfile() and symlinks
</A></li>
	<LI>Next message: <A HREF="019279.html">[mod_python] Request.sendfile() and symlinks
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19278">[ date ]</a>
              <a href="thread.html#19278">[ thread ]</a>
              <a href="subject.html#19278">[ subject ]</a>
              <a href="author.html#19278">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
