<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] The DOs and DONTs of mod_python
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20The%20DOs%20and%20DONTs%20of%20mod_python&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019329.html">
   <LINK REL="Next"  HREF="019332.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] The DOs and DONTs of mod_python</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20The%20DOs%20and%20DONTs%20of%20mod_python&In-Reply-To="
       TITLE="[mod_python] The DOs and DONTs of mod_python">grahamd at dscpl.com.au
       </A><BR>
    <I>Tue Oct 18 19:33:20 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="019329.html">[mod_python] The DOs and DONTs of mod_python
</A></li>
        <LI>Next message: <A HREF="019332.html">[mod_python] The DOs and DONTs of mod_python
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19331">[ date ]</a>
              <a href="thread.html#19331">[ thread ]</a>
              <a href="subject.html#19331">[ subject ]</a>
              <a href="author.html#19331">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>A few additional comments on top of what Jorey has already said.

Philippe C. Martin wrote ..
&gt;<i> Please note that, although I must have bugs, the code I'm calling _seems_
</I>&gt;<i> to 
</I>&gt;<i> work flawlessly under Linux and Windows.
</I>
Besides issues with multiple interpreters, if using a multithread Apache
MPM, such as is the case for Win32 systems and &quot;worker&quot; MPM on UNIX, you
have to contend with multithreading. Your system may work quite happily
if you trickle requests in serially, but get requests come in at the
same time and they can trample all over each other if your module isn't
multithread safe.

There are also various issues because of mod_python's module reloading
system. Problems can also arise if you use a module which has a C code
component and it uses the simplified threading C APIs in Python.

There are a lot of gotchas.

&gt;<i> from mod_python import apache
</I>&gt;<i> import os
</I>&gt;<i> import sys
</I>&gt;<i> if os.name == 'nt':
</I>&gt;<i>      sys.path.append(&quot;Z:\\dev&quot;)
</I>&gt;<i> else:
</I>&gt;<i>      sys.path.append('/home/philippe/dev')
</I>
You shouldn't extend sys.path in Python code when mod_python is used.
The main reason is that if mod_python reloads the module, everytime that
occurs then sys.path will be extended even if the directory is already in
there. Thus, sys.path could grow and grow. This is made worse by bugs
in mod_python.publisher in versions of mod_python &lt; 3.2.

&gt;<i> from SC.pilot.SC_Script_Processor import *
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> def world(req):
</I>&gt;<i>      ls = SC_Script_Processor() #INSTANTIATE A _BIG_ OBJECT ==&gt; *** THIS
</I>&gt;<i> IS 
</I>&gt;<i> THE KILLER THAT CRASHES APACHE ***
</I>&gt;<i>      ll = ls.Reader_List() # get the reader list
</I>&gt;<i> 
</I>&gt;<i>      #Grab ATR from card - assume first reader
</I>&gt;<i>      l_appli_conn = ls.Get_Connection(r1)
</I>&gt;<i>      
</I>&gt;<i>      
</I>&gt;<i>      
</I>&gt;<i>      req.send_http_header()
</I>
You don't set req.content_type. How is the browser mean't to know what
to do with the response. You perhaps want:

  req.content_type = 'text/plain'
  req.send_http_header()

Although, in 3.X the call to 'req.send_http_header()' is actually redundant.
It was only required in 2.7.X.

&gt;<i>      req.write(&quot;RETURN CARD ATR= &quot; +  l_appli_conn.Get_Connection_ATR()
</I>&gt;<i> )
</I>&gt;<i>      
</I>&gt;<i>      return apache.OK
</I>
I have presumed that mod_python.publisher was being used because
you weren't using &quot;handler()&quot; for the function, but &quot;world()&quot;. If this is the
case, you shouldn't be returning &quot;apache.OK&quot; as it will result in the string
&quot;0&quot; being appended to the response sent back to the browser.

Overall, better off perhaps saying:

  req.content_type = 'text/plain'
  return &quot;RETURN CARD ATR= &quot; +  l_appli_conn.Get_Connection_ATR()

Graham
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="019329.html">[mod_python] The DOs and DONTs of mod_python
</A></li>
	<LI>Next message: <A HREF="019332.html">[mod_python] The DOs and DONTs of mod_python
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19331">[ date ]</a>
              <a href="thread.html#19331">[ thread ]</a>
              <a href="subject.html#19331">[ subject ]</a>
              <a href="author.html#19331">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
