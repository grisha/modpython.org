<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Session Pickling Error II - 3.2.2b
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Session%20Pickling%20Error%20II%20-%203.2.2b&In-Reply-To=20051004061756.31313.qmail%40web31911.mail.mud.yahoo.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019163.html">
   <LINK REL="Next"  HREF="019162.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Session Pickling Error II - 3.2.2b</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Nicolas Lehuen</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Session%20Pickling%20Error%20II%20-%203.2.2b&In-Reply-To=20051004061756.31313.qmail%40web31911.mail.mud.yahoo.com"
       TITLE="[mod_python] Session Pickling Error II - 3.2.2b">nicolas.lehuen at gmail.com
       </A><BR>
    <I>Tue Oct  4 02:32:05 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="019163.html">[mod_python] Session Pickling Error II - 3.2.2b
</A></li>
        <LI>Next message: <A HREF="019162.html">[mod_python] Session Pickling Error II - 3.2.2b
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19165">[ date ]</a>
              <a href="thread.html#19165">[ thread ]</a>
              <a href="subject.html#19165">[ subject ]</a>
              <a href="author.html#19165">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>As I've wrote in my previous mail, the new error is due to the way
mod_python imports the published modules in 3.2. The new way was designed to
solve a whole bunch of problems. Then again I must confess I had not
foreseen the pickling problem it would cause.

I'll report this problem as a bug against 3.2.2beta. The problem is that
this will not be easily fixed in 3.2. We (the development team) were
prepared to do a major overhaul of the import mechanism for the 3.3 release.
Solving the pickling problem would require that. Right now I can't see any
way to solve this easily in 3.2 while still retaining all the fixes the new
import system has brought.

In the meantime, my advice is that either you keep on using 3.1.4 (living
with its bugs), or work around the pickle problem using one of the solutions
I've wrote before. Maybe the solution where you define your functions and
classes that need to be pickled in a separate module found on the python
path is the easiest one.

Sorry for the inconvenience, and thanks for the bug report.

Nicolas

2005/10/4, GATOR AIDE &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">gator_aide2000 at yahoo.com</A>&gt;:
&gt;<i>
</I>&gt;<i> Actually, the same exact code works using mod_python
</I>&gt;<i> version 3.1.4.
</I>&gt;<i>
</I>&gt;<i> I only get get the error when I run the code using the
</I>&gt;<i> latest version of mod_python (3.2.2b).
</I>&gt;<i>
</I>&gt;<i> I guess I can work around the problem by storing
</I>&gt;<i> strings or something, but it seems odd that I only get
</I>&gt;<i> the error with the newest version.
</I>&gt;<i>
</I>&gt;<i> Sorry if that wasn't clear in the original post.
</I>&gt;<i>
</I>&gt;<i> Thanks for all of the feedback.
</I>&gt;<i>
</I>&gt;<i> Mike
</I>&gt;<i>
</I>&gt;<i> --- Nicolas Lehuen &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">nicolas.lehuen at gmail.com</A>&gt; wrote:
</I>&gt;<i>
</I>&gt;<i> &gt; Graham,
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Mr Gator Aide had the same problem with mod_python
</I>&gt;<i> &gt; 3.1.4, though the message
</I>&gt;<i> &gt; was a bit different. The point is that he is trying
</I>&gt;<i> &gt; to store too much in the
</I>&gt;<i> &gt; session and that he should work around that. The new
</I>&gt;<i> &gt; import mechanism may
</I>&gt;<i> &gt; make things a little more difficult, but the core
</I>&gt;<i> &gt; problem is in the way he
</I>&gt;<i> &gt; uses sessions, not in mod_python.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Regards,
</I>&gt;<i> &gt; Nicolas
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; 2005/10/4, Graham Dumpleton &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">grahamd at dscpl.com.au</A>&gt;:
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; GATOR AIDE wrote ..
</I>&gt;<i> &gt; &gt; &gt; After updating mod_python 3.1.4 to 3.2.2b I am
</I>&gt;<i> &gt; getting
</I>&gt;<i> &gt; &gt; &gt; an error:
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; PythonHandler mod_python.publisher: TypeError:
</I>&gt;<i> &gt; can't
</I>&gt;<i> &gt; &gt; &gt; pickle function objects
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; I am storing a function in the session and
</I>&gt;<i> &gt; calling
</I>&gt;<i> &gt; &gt; &gt; session.save(). (Which is when the error is
</I>&gt;<i> &gt; raised.)
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; Using mod_python 3.1.4 the code works just fine
</I>&gt;<i> &gt; but
</I>&gt;<i> &gt; &gt; &gt; after the update I am now seeing this error.
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; The code simply stores a dictionary and few
</I>&gt;<i> &gt; function
</I>&gt;<i> &gt; &gt; &gt; callbacks in the session and loops through
</I>&gt;<i> &gt; several
</I>&gt;<i> &gt; &gt; &gt; functions until it is done processing.
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; Not sure if anyone else has had this problem? I
</I>&gt;<i> &gt; &gt; &gt; running centos 2.4.21-27.0.4.ELsmp on a x86_64
</I>&gt;<i> &gt; &gt; &gt; platform. Python 2.4.2 (same error w/2.4.1).
</I>&gt;<i> &gt; Apache
</I>&gt;<i> &gt; &gt; &gt; 2.0.46.
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; I wasn't sure if this is the right place to post
</I>&gt;<i> &gt; this,
</I>&gt;<i> &gt; &gt; &gt; so I apologize if I should have posted the
</I>&gt;<i> &gt; question
</I>&gt;<i> &gt; &gt; &gt; elsewhere.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; I am going to hazard a guess and say that pickle
</I>&gt;<i> &gt; probably only allows
</I>&gt;<i> &gt; &gt; you to pickle a function objects where the
</I>&gt;<i> &gt; function object resides in a
</I>&gt;<i> &gt; &gt; module which was imported using &quot;import&quot;, ie.,
</I>&gt;<i> &gt; lives in &quot; sys.modules&quot;.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; In mod_python 3.2, mod_python.publisher handler
</I>&gt;<i> &gt; modules are no longer
</I>&gt;<i> &gt; &gt; imported using the Python &quot;import&quot; mechanism but
</I>&gt;<i> &gt; are instead read in as
</I>&gt;<i> &gt; &gt; strings and executed against a dictionary of an
</I>&gt;<i> &gt; empty module which does
</I>&gt;<i> &gt; &gt; not actually exist in sys.modules.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; def build(self, key, name, opened, entry):
</I>&gt;<i> &gt; &gt; try:
</I>&gt;<i> &gt; &gt; module = new.module(re_not_word.sub('_',key))
</I>&gt;<i> &gt; &gt; module.__file__ = key
</I>&gt;<i> &gt; &gt; exec opened in module.__dict__
</I>&gt;<i> &gt; &gt; return module
</I>&gt;<i> &gt; &gt; finally:
</I>&gt;<i> &gt; &gt; opened.close()
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; The error would seem reasonable under these
</I>&gt;<i> &gt; circumstances because if it
</I>&gt;<i> &gt; &gt; were pickled, it wouldn't perhaps be unable to
</I>&gt;<i> &gt; unpickle it later as it
</I>&gt;<i> &gt; &gt; wouldn't know the name of a module in
</I>&gt;<i> &gt; &quot;sys.modules&quot; to associate the
</I>&gt;<i> &gt; &gt; function reference to.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; Are you sure you can't use a string reference or
</I>&gt;<i> &gt; something else as a
</I>&gt;<i> &gt; &gt; handle
</I>&gt;<i> &gt; &gt; to refer to the callback function rather than an
</I>&gt;<i> &gt; actual function object?
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; Graham
</I>&gt;<i> &gt; &gt; _______________________________________________
</I>&gt;<i> &gt; &gt; Mod_python mailing list
</I>&gt;<i> &gt; &gt; <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt;
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> __________________________________
</I>&gt;<i> Yahoo! Mail - PC Magazine Editors' Choice 2005
</I>&gt;<i> <A HREF="http://mail.yahoo.com">http://mail.yahoo.com</A>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mod_python mailing list
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20051004/758d2f6e/attachment.html">http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20051004/758d2f6e/attachment.html</A>
</PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="019163.html">[mod_python] Session Pickling Error II - 3.2.2b
</A></li>
	<LI>Next message: <A HREF="019162.html">[mod_python] Session Pickling Error II - 3.2.2b
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19165">[ date ]</a>
              <a href="thread.html#19165">[ thread ]</a>
              <a href="subject.html#19165">[ subject ]</a>
              <a href="author.html#19165">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="DISABLEhttp://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
