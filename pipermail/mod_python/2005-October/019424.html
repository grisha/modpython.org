<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] mpservlets, hypertext and mathml 
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20mpservlets%2C%20hypertext%20and%20mathml%20&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019423.html">
   <LINK REL="Next"  HREF="019425.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] mpservlets, hypertext and mathml </H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Daniel A Graham</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20mpservlets%2C%20hypertext%20and%20mathml%20&In-Reply-To="
       TITLE="[mod_python] mpservlets, hypertext and mathml ">daniel.graham at duke.edu
       </A><BR>
    <I>Wed Oct 26 18:08:28 EDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="019423.html">[mod_python] I: Too many cookies using mod_python 3.2.2b from
	mod_python-3.2.2b.win32-py2.4.exe
</A></li>
        <LI>Next message: <A HREF="019425.html">[mod_python] strange import behaviour out of the blue
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19424">[ date ]</a>
              <a href="thread.html#19424">[ thread ]</a>
              <a href="subject.html#19424">[ subject ]</a>
              <a href="author.html#19424">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Greetings,

I'm a big fan of mpservlets and have recently been involved in an effort
to incorporate mathml support into HyperText via itex2mml.  To do this I
added the following to _HTML.py variant of HyperText used in the
mpservlets tutorial:

---------------------------------------
# expand_codes taken from mpservlets _TutorialBase.py with one modification
def expand_codes(s):

    '''Expand codes in string to HTML elements.

    For any text of the form X{text}, replace it with
    &lt;ELEMENT&gt;text&lt;/ELEMENT&gt;, where X and related elements are::

      C  &lt;CODE&gt;...&lt;/CODE&gt;
      E  &lt;EM&gt;...&lt;/EM&gt;
      S  &lt;STRONG&gt;...&lt;/STRONG&gt;

    or A{TEXT&lt;URL&gt;} will generate: &lt;A HREF=&quot;URL&quot;&gt;TEXT&lt;/A&gt;

    Inspired by epytext.  This simple version, however, does not
    allow embedding codes within each other.  :-(
    '''

    import re

    # so we can pass in non-string objects
    s = str(s)

    # iterate over our codes
    for code, elem in (('C', 'code'),
                       ('E', 'em'),
                       ('S', 'strong')):

        s = re.sub(r'%s{(.*?)}' % code,
                   r'&lt;%s&gt;\1&lt;/%s&gt;' % (elem, elem),
                   s)

    s = re.sub(r'A{(.*?)&lt;(.*?)&gt;}',
               r'&lt;a href=&quot;\2&quot;&gt;\1&lt;/a&gt;',
               s)

    # new support for inline math
    mre = re.compile(r'M{(.*)}')
    s = mre.sub(inline_math, s)

    return s

# called above to replace the itex math string with mathml
def inline_math(reo):
    from os import popen2
    s = reo.group(1)
    cmd = 'itex2mml --inline'
    (si, so) = popen2(cmd)
    si.write(s)
    si.close()
    s = so.read()
    so.close()
    return s

# used for display mathml
def M(s):
    from os import popen2
    cmd = 'itex2mml --display'
    (si, so) = popen2(cmd)
    si.write(s)
    si.close()
    s = so.read()
    so.close()
    return s
--------------------------------------------------

Now both
    expand_codes(P('''Here is some in-line math M{(x-y)^2}''')
and
    M('''F(b)-F(a) \equiv \int_a^b f(x) dx''')
work as expected.  Too cool!

One unexpected side effect (to me at least) is that the doctype needed
for mathml:

    DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.1 plus MathML 2.0

causes all the upper case tags generated by HyperText to be ignored. 
This too, was easily fixed by adding '.lower()' to the occurances of
'self.name'.  This means that P('...') will now generate '&lt;p&gt;...&lt;/p&gt;'.

Best wishes,
Dan Graham
<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">daniel.graham at duke.edu</A>

</PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="019423.html">[mod_python] I: Too many cookies using mod_python 3.2.2b from
	mod_python-3.2.2b.win32-py2.4.exe
</A></li>
	<LI>Next message: <A HREF="019425.html">[mod_python] strange import behaviour out of the blue
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19424">[ date ]</a>
              <a href="thread.html#19424">[ thread ]</a>
              <a href="subject.html#19424">[ subject ]</a>
              <a href="author.html#19424">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
