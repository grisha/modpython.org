<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] ValueError with Flash 8 FileReference.upload(url)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20ValueError%20with%20Flash%208%20FileReference.upload%28url%29&In-Reply-To=29942A59-8CF9-459C-BA6F-E12B0430277C%40dscpl.com.au">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020787.html">
   <LINK REL="Next"  HREF="020786.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] ValueError with Flash 8 FileReference.upload(url)</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Jim Gallacher</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20ValueError%20with%20Flash%208%20FileReference.upload%28url%29&In-Reply-To=29942A59-8CF9-459C-BA6F-E12B0430277C%40dscpl.com.au"
       TITLE="[mod_python] ValueError with Flash 8 FileReference.upload(url)">jpg at jgassociates.ca
       </A><BR>
    <I>Wed Apr  5 08:32:07 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="020787.html">[mod_python] ValueError with Flash 8 FileReference.upload(url)
</A></li>
        <LI>Next message: <A HREF="020786.html">[mod_python] ValueError with Flash 8 FileReference.upload(url)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20788">[ date ]</a>
              <a href="thread.html#20788">[ thread ]</a>
              <a href="subject.html#20788">[ subject ]</a>
              <a href="author.html#20788">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I don't have time to look at this in any detail right now, but I agree 
that it looks malformed. The last part of post.dat really shoud be:

------------KM7GI3gL6cH2gL6gL6cH2gL6cH2KM7\r\n
Content-Disposition: form-data; name=&quot;Upload&quot;\r\n
\r\n
Submit Query\r\n
------------KM7GI3gL6cH2gL6gL6cH2gL6cH2KM7


mod_python 3.2.8 should handle embedded \r\n or \r\r sequences in the 
file contents correctly. There is even a unit test for this. ;)

Jim


Graham Dumpleton wrote:
&gt;<i> I am coming to the conclusion that the file produced by Flash is  
</I>&gt;<i> malformed.
</I>&gt;<i> 
</I>&gt;<i> Even if I were to get rid of the double \r\r sequences, replacing  them 
</I>&gt;<i> with a
</I>&gt;<i> single \r, you end up with no blank like after:
</I>&gt;<i> 
</I>&gt;<i>   Content-Disposition: form-data; name=&quot;Upload&quot;
</I>&gt;<i> 
</I>&gt;<i> which means that:
</I>&gt;<i> 
</I>&gt;<i>   Submit Query
</I>&gt;<i> 
</I>&gt;<i> gets interpreted as a header and thus why it dies as there is no  colon 
</I>&gt;<i> on that
</I>&gt;<i> line.
</I>&gt;<i> 
</I>&gt;<i> Anyone got any better ideas?
</I>&gt;<i> 
</I>&gt;<i> Bedtime for me now.
</I>&gt;<i> 
</I>&gt;<i> Graham
</I>&gt;<i> 
</I>&gt;<i> On 05/04/2006, at 9:32 PM, Graham Dumpleton wrote:
</I>&gt;<i> 
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On 05/04/2006, at 9:28 PM, Harold J. Ship wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Ok, here's the output.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> ------------KM7GI3gL6cH2gL6gL6cH2gL6cH2KM7
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Content-Disposition: form-data; name=&quot;Filename&quot;
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> sample.txt
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> ------------KM7GI3gL6cH2gL6gL6cH2gL6cH2KM7
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Content-Disposition: form-data; name=&quot;Filedata&quot;;  filename=&quot;sample.txt&quot;
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Content-Type: application/octet-stream
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Start of Sample Text File Contents
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> End of Sample Text File Contents
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> ------------KM7GI3gL6cH2gL6gL6cH2gL6cH2KM7
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Content-Disposition: form-data; name=&quot;Upload&quot;
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Submit Query
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> ------------KM7GI3gL6cH2gL6gL6cH2gL6cH2KM7
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I'm not an expert on FieldStorage as I stayed out of all the  
</I>&gt;&gt;<i> discussions on
</I>&gt;&gt;<i> it when it was being improved. I am also not up on what the content  type
</I>&gt;&gt;<i> application/x-www-form-urlencoded is all about. All the same, I'll  share
</I>&gt;&gt;<i> what I found so far in case it helps someone else.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> First off, I don't get an error, but I don't believe I get correct  
</I>&gt;&gt;<i> results either.
</I>&gt;&gt;<i> To test, what I did was create a handler containing:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> from mod_python import apache, util
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> def handler(req):
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     apache.log_error('headers_in=%s'%req.headers_in)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     req.content_type = 'text/plain'
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     form = util.FieldStorage(req)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     for field in form.list:
</I>&gt;&gt;<i>         apache.log_error('name=%s' % `field.name`)
</I>&gt;&gt;<i>         apache.log_error('value=%s' % `field.value`)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     req.write('done')
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     return apache.OK
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I then used &quot;ab&quot; to post your file to a URL mapping to that handler.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>   ab -p post.dat -T 'multipart/form-data; boundary=---------- 
</I>&gt;&gt;<i> KM7GI3gL6cH2gL6gL6cH2gL6cH2KM7^M' <A HREF="http://localhost:8082/testing/">http://localhost:8082/testing/</A> 
</I>&gt;&gt;<i> upload-1/dummy
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Note that that is actually a real \r (CR) where ^M is shown in the  
</I>&gt;&gt;<i> boundary.
</I>&gt;&gt;<i> Without that it wouldn't work. I am not sure though whether that is  
</I>&gt;&gt;<i> simply due
</I>&gt;&gt;<i> to CR LF weirdness in way file was created and then how it is being  
</I>&gt;&gt;<i> interpreted
</I>&gt;&gt;<i> by &quot;ab&quot; on Mac OS X when given to it as input.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Anyway, result of that is:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> [Wed Apr 05 21:26:24 2006] [error] headers_in={'Content-type':  
</I>&gt;&gt;<i> 'multipart/form-data; boundary=---------- 
</I>&gt;&gt;<i> KM7GI3gL6cH2gL6gL6cH2gL6cH2KM7\r', 'Content-length': '498',  'Accept': 
</I>&gt;&gt;<i> '*/*', 'Host': 'localhost:8082', 'User-Agent':  'ApacheBench/1.3d'}
</I>&gt;&gt;<i> [Wed Apr 05 21:26:24 2006] [error] [client 127.0.0.1] PythonHandler  
</I>&gt;&gt;<i> upload: Traceback (most recent call last):
</I>&gt;&gt;<i> [Wed Apr 05 21:26:24 2006] [error] [client 127.0.0.1] PythonHandler  
</I>&gt;&gt;<i> upload:   File &quot;/System/Library/Frameworks/Python.framework/ 
</I>&gt;&gt;<i> Versions/2.3/lib/python2.3/site-packages/mod_python/apache.py&quot;,  line 
</I>&gt;&gt;<i> 308, in HandlerDispatch\n    result = object(req)
</I>&gt;&gt;<i> [Wed Apr 05 21:26:24 2006] [error] [client 127.0.0.1] PythonHandler  
</I>&gt;&gt;<i> upload:   File &quot;/Users/grahamd/Workspaces/testing/upload-1/ 
</I>&gt;&gt;<i> upload.py&quot;, line 9, in handler\n    form = util.FieldStorage(req)
</I>&gt;&gt;<i> [Wed Apr 05 21:26:24 2006] [error] [client 127.0.0.1] PythonHandler  
</I>&gt;&gt;<i> upload:   File &quot;/System/Library/Frameworks/Python.framework/ 
</I>&gt;&gt;<i> Versions/2.3/lib/python2.3/site-packages/mod_python/util.py&quot;, line  
</I>&gt;&gt;<i> 180, in __init__\n    h, v = line.split(&quot;:&quot;, 1)
</I>&gt;&gt;<i> [Wed Apr 05 21:26:24 2006] [error] [client 127.0.0.1] PythonHandler  
</I>&gt;&gt;<i> upload: ValueError: unpack list of wrong size
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Thus, have duplicated it.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Note that this may possibly be something to do with strangeness in  
</I>&gt;&gt;<i> line endings.
</I>&gt;&gt;<i> First their was the issue above with CR, but there are other  nasties 
</I>&gt;&gt;<i> in input with
</I>&gt;&gt;<i> CR LF. See following &quot;od&quot; dump.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> 0000000    -   -   -   -   -   -   -   -   -   -   -   -   K   M    7   G
</I>&gt;&gt;<i> 0000020    I   3   g   L   6   c   H   2   g   L   6   g   L   6    c   H
</I>&gt;&gt;<i> 0000040    2   g   L   6   c   H   2   K   M   7  \r  \r  \n   C    o   n
</I>&gt;&gt;<i> 0000060    t   e   n   t   -   D   i   s   p   o   s   i   t   i    o   n
</I>&gt;&gt;<i> 0000100    :       f   o   r   m   -   d   a   t   a   ;       n    a   m
</I>&gt;&gt;<i> 0000120    e   =   &quot;   F   i   l   e   n   a   m   e   &quot;  \r  \r   \n  \r
</I>&gt;&gt;<i> 0000140   \r  \n   s   a   m   p   l   e   .   t   x   t  \r  \r   \n   -
</I>&gt;&gt;<i> 0000160    -   -   -   -   -   -   -   -   -   -   -   K   M   7    G   I
</I>&gt;&gt;<i> 0000200    3   g   L   6   c   H   2   g   L   6   g   L   6   c    H   2
</I>&gt;&gt;<i> 0000220    g   L   6   c   H   2   K   M   7  \r  \r  \n   C   o    n   t
</I>&gt;&gt;<i> 0000240    e   n   t   -   D   i   s   p   o   s   i   t   i   o    n   :
</I>&gt;&gt;<i> 0000260        f   o   r   m   -   d   a   t   a   ;       n   a    m   e
</I>&gt;&gt;<i> 0000300    =   &quot;   F   i   l   e   d   a   t   a   &quot;   ;       f    i   l
</I>&gt;&gt;<i> 0000320    e   n   a   m   e   =   &quot;   s   a   m   p   l   e   .    t   x
</I>&gt;&gt;<i> 0000340    t   &quot;  \r  \r  \n   C   o   n   t   e   n   t   -   T    y   p
</I>&gt;&gt;<i> 0000360    e   :       a   p   p   l   i   c   a   t   i   o    n   /   o
</I>&gt;&gt;<i> 0000400    c   t   e   t   -   s   t   r   e   a   m  \r  \r  \n   \r  \r
</I>&gt;&gt;<i> 0000420   \n   S   t   a   r   t       o   f       S   a   m   p    l   e
</I>&gt;&gt;<i> 0000440        T   e   x   t       F   i   l   e       C   o   n    t   e
</I>&gt;&gt;<i> 0000460    n   t   s  \r  \r  \n   E   n   d       o   f       S    a   m
</I>&gt;&gt;<i> 0000500    p   l   e       T   e   x   t       F   i   l   e        C   o
</I>&gt;&gt;<i> 0000520    n   t   e   n   t   s  \r  \r  \n  \r  \r  \n   -   -    -   -
</I>&gt;&gt;<i> 0000540    -   -   -   -   -   -   -   -   K   M   7   G   I   3    g   L
</I>&gt;&gt;<i> 0000560    6   c   H   2   g   L   6   g   L   6   c   H   2   g    L   6
</I>&gt;&gt;<i> 0000600    c   H   2   K   M   7  \r  \r  \n   C   o   n   t   e    n   t
</I>&gt;&gt;<i> 0000620    -   D   i   s   p   o   s   i   t   i   o   n   :        f   o
</I>&gt;&gt;<i> 0000640    r   m   -   d   a   t   a   ;       n   a   m   e   =    &quot;   U
</I>&gt;&gt;<i> 0000660    p   l   o   a   d   &quot;  \r  \r  \n   S   u   b   m   i   t
</I>&gt;&gt;<i> 0000700    Q   u   e   r   y  \r  \r  \n   -   -   -   -   -   -    -   -
</I>&gt;&gt;<i> 0000720    -   -   -   -   K   M   7   G   I   3   g   L   6   c    H   2
</I>&gt;&gt;<i> 0000740    g   L   6   g   L   6   c   H   2   g   L   6   c   H    2   K
</I>&gt;&gt;<i> 0000760    M   7
</I>&gt;&gt;<i> 0000762
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> See the &quot;\r  \r  \n  \r  \r  \n&quot; sequences.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Not sure that I'll have much more time to play with this tonight,  so 
</I>&gt;&gt;<i> posting this
</I>&gt;&gt;<i> progress in case someone else wants to pick up and continue.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Graham
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> Mod_python mailing list
</I>&gt;&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mod_python mailing list
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I>&gt;<i> 
</I>
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="020787.html">[mod_python] ValueError with Flash 8 FileReference.upload(url)
</A></li>
	<LI>Next message: <A HREF="020786.html">[mod_python] ValueError with Flash 8 FileReference.upload(url)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20788">[ date ]</a>
              <a href="thread.html#20788">[ thread ]</a>
              <a href="subject.html#20788">[ subject ]</a>
              <a href="author.html#20788">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="DISABLEhttp://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
