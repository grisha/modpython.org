<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] The new module loader
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20The%20new%20module%20loader&In-Reply-To=4817b6fc0604221222j319195d8ne0946e914409dc3a%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020958.html">
   <LINK REL="Next"  HREF="020955.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] The new module loader</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Dan Eloff</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20The%20new%20module%20loader&In-Reply-To=4817b6fc0604221222j319195d8ne0946e914409dc3a%40mail.gmail.com"
       TITLE="[mod_python] The new module loader">dan.eloff at gmail.com
       </A><BR>
    <I>Sun Apr 23 13:27:05 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="020958.html">[mod_python] The new module loader
</A></li>
        <LI>Next message: <A HREF="020955.html">[mod_python] The new module loader
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20965">[ date ]</a>
              <a href="thread.html#20965">[ thread ]</a>
              <a href="subject.html#20965">[ subject ]</a>
              <a href="author.html#20965">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Loving that new importer Graham, thanks for all the trouble it must've
taken to create it. It's so painless working on my website now. The
sessions started working too, because suddenly there's only one
sessions module being loaded.

Thanks,
-Dan

On 4/22/06, Dan Eloff &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">dan.eloff at gmail.com</A>&gt; wrote:
&gt;<i> Well for now I'm putting pyserver back into a package, and dumping it
</I>&gt;<i> into the site-packages directory again.
</I>&gt;<i>
</I>&gt;<i> In an ideal world pyserver doesn't need to be relaoded, it's more of a
</I>&gt;<i> supporting framework for my web applciations and since it needs to be
</I>&gt;<i> accessible from all my web applications, it makes some sense for it to
</I>&gt;<i> be located on sys.path.
</I>&gt;<i>
</I>&gt;<i> In the real world pyserver is not stable yet, and changes frequently,
</I>&gt;<i> and I'll miss the reloading ability. But hey that's why I have restart
</I>&gt;<i> apache on hotkey. CTRL+ALT+A and hit refresh.
</I>&gt;<i>
</I>&gt;<i> In my case the only place I use mod_python is through pyserver and
</I>&gt;<i> it'd be nice to add directories to the search path with global defines
</I>&gt;<i> in the apache config for cases like this.
</I>&gt;<i>
</I>&gt;<i> -Dan
</I>&gt;<i>
</I>&gt;<i> On 4/22/06, Dan Eloff &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">dan.eloff at gmail.com</A>&gt; wrote:
</I>&gt;<i> &gt; It works! Nice feature, I don't see any trouble with it being the way
</I>&gt;<i> &gt; it is, maybe if you just added some __debug__ only code that squeals
</I>&gt;<i> &gt; if the same module is imported with a different search path.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Although something that would be nice is a feature like python has
</I>&gt;<i> &gt; with sys.path, that is the ability to globally add directories to the
</I>&gt;<i> &gt; search path (through code and through the apache config maybe.) I
</I>&gt;<i> &gt; would still like the ability to add the pyserver directory globally to
</I>&gt;<i> &gt; every module's search path, because for me, every module that
</I>&gt;<i> &gt; mod_python loads should have access to it.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I didn't realize you lived in the Australia, I just assumed you were
</I>&gt;<i> &gt; in the US. You're probably fine. Right now in North America the
</I>&gt;<i> &gt; housing bubble has just burst, but not many have figured it out yet.
</I>&gt;<i> &gt; When they do, most of those people who are buying real estate right
</I>&gt;<i> &gt; now are going to get burned. The real estate market is cyclical, so
</I>&gt;<i> &gt; it's not a big deal, more of an overdue correction, but I wouldn't
</I>&gt;<i> &gt; want to be the one having to pay for that. On the bright side, it's
</I>&gt;<i> &gt; good news for the stock market.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; -Dan
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; On 4/22/06, Graham Dumpleton &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">grahamd at dscpl.com.au</A>&gt; wrote:
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; On 22/04/2006, at 4:08 PM, Dan Eloff wrote:
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt;&gt; How are the files in this directory (_config.py) being imported in
</I>&gt;<i> &gt; &gt; &gt;&gt; the first place?
</I>&gt;<i> &gt; &gt; &gt;&gt; Is your pyserver.py file importing them explicitly using
</I>&gt;<i> &gt; &gt; &gt;&gt; apache.import_module()?
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; Yes, that's exactly it.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; If your pyserver.py is effectively acting as a dispatcher for
</I>&gt;<i> &gt; &gt; multiple pages
</I>&gt;<i> &gt; &gt; based on URL, and it is using apache.import_module() to load an actual
</I>&gt;<i> &gt; &gt; handler module file from your &quot;web&quot; directory by full path name, ie.,
</I>&gt;<i> &gt; &gt; something like:
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;    stub = posixpath.splitex(req.path_info)[0]
</I>&gt;<i> &gt; &gt;    file = os.path.join(&quot;C:/My Documents/PYROOT/web&quot;, stub) + &quot;.py&quot;
</I>&gt;<i> &gt; &gt;    module = apache.import_module(file)
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; Change it to:
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;    directory = os.path.dirname(__file__)
</I>&gt;<i> &gt; &gt;    stub = posixpath.splitex(req.path_info)[0]
</I>&gt;<i> &gt; &gt;    file = os.path.join(&quot;C:/My Documents/PYROOT/web&quot;, stub) + &quot;.py&quot;
</I>&gt;<i> &gt; &gt;    module = apache.import_module(file, path=[directory])
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; It is important you be providing a full pathname as first argument to
</I>&gt;<i> &gt; &gt; the
</I>&gt;<i> &gt; &gt; apache.import_module() as by doing so it triggers a special different
</I>&gt;<i> &gt; &gt; interpretation for the &quot;path&quot; argument.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; Namely, when the module is specified by a full or absolute pathname,
</I>&gt;<i> &gt; &gt; as opposed to just the module name, the &quot;path&quot; argument becomes a
</I>&gt;<i> &gt; &gt; search path which is embedded within the loaded module and which
</I>&gt;<i> &gt; &gt; is consulted when sub imports are done from within that module.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; Using this feature, you can then embed the directory the config module
</I>&gt;<i> &gt; &gt; is in as part of the module search path for the &quot;web&quot; module and using
</I>&gt;<i> &gt; &gt; the &quot;import&quot; statement or apache.import_module() to load it should
</I>&gt;<i> &gt; &gt; then work.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; Note that the search path is only embedded within the module directly
</I>&gt;<i> &gt; &gt; loaded by apache.import_module() when this is done. The search
</I>&gt;<i> &gt; &gt; path is not inherited by any modules it may then in turn import.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; Also note that this feature is an area which still has to be properly
</I>&gt;<i> &gt; &gt; thought out as to how it should work or be accessible. How it is
</I>&gt;<i> &gt; &gt; currently exposed is handy in some circumstances, but possibly
</I>&gt;<i> &gt; &gt; not as generally useful as it could be. How the ability to use it is
</I>&gt;<i> &gt; &gt; exposed may well change in time. One has to be really careful though
</I>&gt;<i> &gt; &gt; with such a feature because of the possibilities of introducing
</I>&gt;<i> &gt; &gt; unpredictable behaviour from when a module is imported from
</I>&gt;<i> &gt; &gt; different places with potentially different search paths defined. This
</I>&gt;<i> &gt; &gt; sort of path difference problem is a big problem with the current
</I>&gt;<i> &gt; &gt; importer, so rather want to avoid it.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; I'll probably talk again about these search path issues when I finally
</I>&gt;<i> &gt; &gt; get around to addressing Jorey's email.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; If you want some unasked for info on the housing, ....
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; Which country is this???? Doesn't quite reflect my situation here in Oz.
</I>&gt;<i> &gt; &gt; Anyway, with all those property terms in there, probably lucky my spam
</I>&gt;<i> &gt; &gt; filter didn't flag it. :-)
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; Graham
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt;
</I>&gt;<i>
</I>
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="020958.html">[mod_python] The new module loader
</A></li>
	<LI>Next message: <A HREF="020955.html">[mod_python] The new module loader
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20965">[ date ]</a>
              <a href="thread.html#20965">[ thread ]</a>
              <a href="subject.html#20965">[ subject ]</a>
              <a href="author.html#20965">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="DISABLEhttp://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
