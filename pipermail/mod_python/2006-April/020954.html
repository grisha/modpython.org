<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] The new module loader
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20The%20new%20module%20loader&In-Reply-To=4817b6fc0604212308v15e65e02y54111a99835be325%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020953.html">
   <LINK REL="Next"  HREF="020956.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] The new module loader</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20The%20new%20module%20loader&In-Reply-To=4817b6fc0604212308v15e65e02y54111a99835be325%40mail.gmail.com"
       TITLE="[mod_python] The new module loader">grahamd at dscpl.com.au
       </A><BR>
    <I>Sat Apr 22 08:14:37 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="020953.html">[SPAM] Re: [mod_python] The new module loader
</A></li>
        <LI>Next message: <A HREF="020956.html">[mod_python] The new module loader
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20954">[ date ]</a>
              <a href="thread.html#20954">[ thread ]</a>
              <a href="subject.html#20954">[ subject ]</a>
              <a href="author.html#20954">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On 22/04/2006, at 4:08 PM, Dan Eloff wrote:

&gt;&gt;<i> How are the files in this directory (_config.py) being imported in
</I>&gt;&gt;<i> the first place?
</I>&gt;&gt;<i> Is your pyserver.py file importing them explicitly using
</I>&gt;&gt;<i> apache.import_module()?
</I>&gt;<i>
</I>&gt;<i> Yes, that's exactly it.
</I>
If your pyserver.py is effectively acting as a dispatcher for  
multiple pages
based on URL, and it is using apache.import_module() to load an actual
handler module file from your &quot;web&quot; directory by full path name, ie.,
something like:

   stub = posixpath.splitex(req.path_info)[0]
   file = os.path.join(&quot;C:/My Documents/PYROOT/web&quot;, stub) + &quot;.py&quot;
   module = apache.import_module(file)

Change it to:

   directory = os.path.dirname(__file__)
   stub = posixpath.splitex(req.path_info)[0]
   file = os.path.join(&quot;C:/My Documents/PYROOT/web&quot;, stub) + &quot;.py&quot;
   module = apache.import_module(file, path=[directory])

It is important you be providing a full pathname as first argument to  
the
apache.import_module() as by doing so it triggers a special different
interpretation for the &quot;path&quot; argument.

Namely, when the module is specified by a full or absolute pathname,
as opposed to just the module name, the &quot;path&quot; argument becomes a
search path which is embedded within the loaded module and which
is consulted when sub imports are done from within that module.

Using this feature, you can then embed the directory the config module
is in as part of the module search path for the &quot;web&quot; module and using
the &quot;import&quot; statement or apache.import_module() to load it should
then work.

Note that the search path is only embedded within the module directly
loaded by apache.import_module() when this is done. The search
path is not inherited by any modules it may then in turn import.

Also note that this feature is an area which still has to be properly
thought out as to how it should work or be accessible. How it is
currently exposed is handy in some circumstances, but possibly
not as generally useful as it could be. How the ability to use it is
exposed may well change in time. One has to be really careful though
with such a feature because of the possibilities of introducing
unpredictable behaviour from when a module is imported from
different places with potentially different search paths defined. This
sort of path difference problem is a big problem with the current
importer, so rather want to avoid it.

I'll probably talk again about these search path issues when I finally
get around to addressing Jorey's email.

&gt;<i> If you want some unasked for info on the housing, ....
</I>
Which country is this???? Doesn't quite reflect my situation here in Oz.
Anyway, with all those property terms in there, probably lucky my spam
filter didn't flag it. :-)

Graham
</PRE>









<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="020953.html">[SPAM] Re: [mod_python] The new module loader
</A></li>
	<LI>Next message: <A HREF="020956.html">[mod_python] The new module loader
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20954">[ date ]</a>
              <a href="thread.html#20954">[ thread ]</a>
              <a href="subject.html#20954">[ subject ]</a>
              <a href="author.html#20954">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
