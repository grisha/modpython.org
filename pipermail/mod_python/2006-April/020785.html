<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] ValueError with Flash 8 FileReference.upload(url)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20ValueError%20with%20Flash%208%20FileReference.upload%28url%29&In-Reply-To=5B0ECC1928CB6C479A734A6BD6209EF0DDDDF7%40exchange.Giant-Steps.local">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020784.html">
   <LINK REL="Next"  HREF="020787.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] ValueError with Flash 8 FileReference.upload(url)</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20ValueError%20with%20Flash%208%20FileReference.upload%28url%29&In-Reply-To=5B0ECC1928CB6C479A734A6BD6209EF0DDDDF7%40exchange.Giant-Steps.local"
       TITLE="[mod_python] ValueError with Flash 8 FileReference.upload(url)">grahamd at dscpl.com.au
       </A><BR>
    <I>Wed Apr  5 07:32:50 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="020784.html">[mod_python] ValueError with Flash 8 FileReference.upload(url)
</A></li>
        <LI>Next message: <A HREF="020787.html">[mod_python] ValueError with Flash 8 FileReference.upload(url)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20785">[ date ]</a>
              <a href="thread.html#20785">[ thread ]</a>
              <a href="subject.html#20785">[ subject ]</a>
              <a href="author.html#20785">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On 05/04/2006, at 9:28 PM, Harold J. Ship wrote:

&gt;<i> Ok, here's the output.
</I>&gt;<i>
</I>&gt;<i> ------------KM7GI3gL6cH2gL6gL6cH2gL6cH2KM7
</I>&gt;<i>
</I>&gt;<i> Content-Disposition: form-data; name=&quot;Filename&quot;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> sample.txt
</I>&gt;<i>
</I>&gt;<i> ------------KM7GI3gL6cH2gL6gL6cH2gL6cH2KM7
</I>&gt;<i>
</I>&gt;<i> Content-Disposition: form-data; name=&quot;Filedata&quot;; filename=&quot;sample.txt&quot;
</I>&gt;<i>
</I>&gt;<i> Content-Type: application/octet-stream
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Start of Sample Text File Contents
</I>&gt;<i>
</I>&gt;<i> End of Sample Text File Contents
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> ------------KM7GI3gL6cH2gL6gL6cH2gL6cH2KM7
</I>&gt;<i>
</I>&gt;<i> Content-Disposition: form-data; name=&quot;Upload&quot;
</I>&gt;<i>
</I>&gt;<i> Submit Query
</I>&gt;<i>
</I>&gt;<i> ------------KM7GI3gL6cH2gL6gL6cH2gL6cH2KM7
</I>
I'm not an expert on FieldStorage as I stayed out of all the  
discussions on
it when it was being improved. I am also not up on what the content type
application/x-www-form-urlencoded is all about. All the same, I'll share
what I found so far in case it helps someone else.

First off, I don't get an error, but I don't believe I get correct  
results either.
To test, what I did was create a handler containing:

from mod_python import apache, util

def handler(req):

     apache.log_error('headers_in=%s'%req.headers_in)

     req.content_type = 'text/plain'

     form = util.FieldStorage(req)

     for field in form.list:
         apache.log_error('name=%s' % `field.name`)
         apache.log_error('value=%s' % `field.value`)

     req.write('done')

     return apache.OK


I then used &quot;ab&quot; to post your file to a URL mapping to that handler.

   ab -p post.dat -T 'multipart/form-data; boundary=---------- 
KM7GI3gL6cH2gL6gL6cH2gL6cH2KM7^M' <A HREF="http://localhost:8082/testing/">http://localhost:8082/testing/</A> 
upload-1/dummy

Note that that is actually a real \r (CR) where ^M is shown in the  
boundary.
Without that it wouldn't work. I am not sure though whether that is  
simply due
to CR LF weirdness in way file was created and then how it is being  
interpreted
by &quot;ab&quot; on Mac OS X when given to it as input.

Anyway, result of that is:

[Wed Apr 05 21:26:24 2006] [error] headers_in={'Content-type':  
'multipart/form-data; boundary=---------- 
KM7GI3gL6cH2gL6gL6cH2gL6cH2KM7\r', 'Content-length': '498', 'Accept':  
'*/*', 'Host': 'localhost:8082', 'User-Agent': 'ApacheBench/1.3d'}
[Wed Apr 05 21:26:24 2006] [error] [client 127.0.0.1] PythonHandler  
upload: Traceback (most recent call last):
[Wed Apr 05 21:26:24 2006] [error] [client 127.0.0.1] PythonHandler  
upload:   File &quot;/System/Library/Frameworks/Python.framework/Versions/ 
2.3/lib/python2.3/site-packages/mod_python/apache.py&quot;, line 308, in  
HandlerDispatch\n    result = object(req)
[Wed Apr 05 21:26:24 2006] [error] [client 127.0.0.1] PythonHandler  
upload:   File &quot;/Users/grahamd/Workspaces/testing/upload-1/ 
upload.py&quot;, line 9, in handler\n    form = util.FieldStorage(req)
[Wed Apr 05 21:26:24 2006] [error] [client 127.0.0.1] PythonHandler  
upload:   File &quot;/System/Library/Frameworks/Python.framework/Versions/ 
2.3/lib/python2.3/site-packages/mod_python/util.py&quot;, line 180, in  
__init__\n    h, v = line.split(&quot;:&quot;, 1)
[Wed Apr 05 21:26:24 2006] [error] [client 127.0.0.1] PythonHandler  
upload: ValueError: unpack list of wrong size

Thus, have duplicated it.

Note that this may possibly be something to do with strangeness in  
line endings.
First their was the issue above with CR, but there are other nasties  
in input with
CR LF. See following &quot;od&quot; dump.

0000000    -   -   -   -   -   -   -   -   -   -   -   -   K   M   7   G
0000020    I   3   g   L   6   c   H   2   g   L   6   g   L   6   c   H
0000040    2   g   L   6   c   H   2   K   M   7  \r  \r  \n   C   o   n
0000060    t   e   n   t   -   D   i   s   p   o   s   i   t   i   o   n
0000100    :       f   o   r   m   -   d   a   t   a   ;       n   a   m
0000120    e   =   &quot;   F   i   l   e   n   a   m   e   &quot;  \r  \r  \n  \r
0000140   \r  \n   s   a   m   p   l   e   .   t   x   t  \r  \r  \n   -
0000160    -   -   -   -   -   -   -   -   -   -   -   K   M   7   G   I
0000200    3   g   L   6   c   H   2   g   L   6   g   L   6   c   H   2
0000220    g   L   6   c   H   2   K   M   7  \r  \r  \n   C   o   n   t
0000240    e   n   t   -   D   i   s   p   o   s   i   t   i   o   n   :
0000260        f   o   r   m   -   d   a   t   a   ;       n   a   m   e
0000300    =   &quot;   F   i   l   e   d   a   t   a   &quot;   ;       f   i   l
0000320    e   n   a   m   e   =   &quot;   s   a   m   p   l   e   .   t   x
0000340    t   &quot;  \r  \r  \n   C   o   n   t   e   n   t   -   T   y   p
0000360    e   :       a   p   p   l   i   c   a   t   i   o   n   /   o
0000400    c   t   e   t   -   s   t   r   e   a   m  \r  \r  \n  \r  \r
0000420   \n   S   t   a   r   t       o   f       S   a   m   p   l   e
0000440        T   e   x   t       F   i   l   e       C   o   n   t   e
0000460    n   t   s  \r  \r  \n   E   n   d       o   f       S   a   m
0000500    p   l   e       T   e   x   t       F   i   l   e       C   o
0000520    n   t   e   n   t   s  \r  \r  \n  \r  \r  \n   -   -   -   -
0000540    -   -   -   -   -   -   -   -   K   M   7   G   I   3   g   L
0000560    6   c   H   2   g   L   6   g   L   6   c   H   2   g   L   6
0000600    c   H   2   K   M   7  \r  \r  \n   C   o   n   t   e   n   t
0000620    -   D   i   s   p   o   s   i   t   i   o   n   :       f   o
0000640    r   m   -   d   a   t   a   ;       n   a   m   e   =   &quot;   U
0000660    p   l   o   a   d   &quot;  \r  \r  \n   S   u   b   m   i   t
0000700    Q   u   e   r   y  \r  \r  \n   -   -   -   -   -   -   -   -
0000720    -   -   -   -   K   M   7   G   I   3   g   L   6   c   H   2
0000740    g   L   6   g   L   6   c   H   2   g   L   6   c   H   2   K
0000760    M   7
0000762

See the &quot;\r  \r  \n  \r  \r  \n&quot; sequences.

Not sure that I'll have much more time to play with this tonight, so  
posting this
progress in case someone else wants to pick up and continue.

Graham





</PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="020784.html">[mod_python] ValueError with Flash 8 FileReference.upload(url)
</A></li>
	<LI>Next message: <A HREF="020787.html">[mod_python] ValueError with Flash 8 FileReference.upload(url)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20785">[ date ]</a>
              <a href="thread.html#20785">[ thread ]</a>
              <a href="subject.html#20785">[ subject ]</a>
              <a href="author.html#20785">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
