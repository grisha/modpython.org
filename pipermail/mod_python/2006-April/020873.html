<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Output Filters Redeaux
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Output%20Filters%20Redeaux&In-Reply-To=4443C5AA.7040602%40dd.revealed.net">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020871.html">
   <LINK REL="Next"  HREF="020874.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Output Filters Redeaux</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Lee Brown</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Output%20Filters%20Redeaux&In-Reply-To=4443C5AA.7040602%40dd.revealed.net"
       TITLE="[mod_python] Output Filters Redeaux">administrator at leebrown.org
       </A><BR>
    <I>Mon Apr 17 13:04:45 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="020871.html">[mod_python] Output Filters Redeaux
</A></li>
        <LI>Next message: <A HREF="020874.html">[mod_python] Output Filters Redeaux
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20873">[ date ]</a>
              <a href="thread.html#20873">[ thread ]</a>
              <a href="subject.html#20873">[ subject ]</a>
              <a href="author.html#20873">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>That's a good question.  I don't know if the filter object is iterable or
not.

What's warping my noodle is handling the two different exit conditions in a
Pythonic way; if the filter returns '' you just want to hibernate but if the
filter returns None you want to wrap up and get out.  Kinda like this (given
an iterable filter object):

for streamlet in filter:
    if streamlet:
        streambuffer.write(streamlet)
    else:
        break
If streamlet is None:
    [proceed with your filter thing]

To me, this does not seem to be much more Pythonic that the previous version
- you still have to noodle on it a while to see the flow structure.


Best Regards,
Lee E. Brown
(<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">administrator at leebrown.org</A>)

-----Original Message-----
From: <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">mod_python-bounces at modpython.org</A>
[mailto:<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">mod_python-bounces at modpython.org</A>] On Behalf Of Nick
Sent: Monday, April 17, 2006 12:43 PM
To: Lee Brown
Cc: <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">mod_python at modpython.org</A>
Subject: Re: [mod_python] Output Filters Redeaux

Great example!  Thanks.

On a devel note, it looks like the filter object would be very handy if it
could be treated as in iterator, such as (using the sample code's
nomenclature):

for streamlet in filter:
  [do something with streamlet here]

It would definitely turn filter writing into something more Pythonic.  Does
that seem like something that would be useful?

Thanks,
Nick

Lee Brown wrote:
&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Greetings!
</I>&gt;<i> 
</I>&gt;<i> Just for fun, here is a handy template for constructing Mod Python 
</I>&gt;<i> output filters:
</I>&gt;<i> 
</I>&gt;<i>     from mod_python import apache
</I>&gt;<i>     from cStringIO import StringIO
</I>&gt;<i> 
</I>&gt;<i>     def outputfilter (filter):
</I>&gt;<i>            
</I>&gt;<i>         try:
</I>&gt;<i>             streambuffer = filter.req.streambuffer
</I>&gt;<i>         except AttributeError:
</I>&gt;<i>             filter.req.streambuffer = StringIO() # See Note 1
</I>&gt;<i>             streambuffer = filter.req.streambuffer
</I>&gt;<i>                 # See Note 2
</I>&gt;<i>        
</I>&gt;<i>         streamlet = filter.read()
</I>&gt;<i>         while streamlet:
</I>&gt;<i>                 # See Note 3
</I>&gt;<i>             streambuffer.write(streamlet)
</I>&gt;<i>             streamlet = filter.read()
</I>&gt;<i> 
</I>&gt;<i>         if streamlet is None:
</I>&gt;<i>                 # See Note 4
</I>&gt;<i>             filter.write(streambuffer)
</I>&gt;<i>             filter.close()
</I>&gt;<i> 
</I>&gt;<i> This is as stripped-down, bare-bones as a filter can get, IMHO.  Of 
</I>&gt;<i> course, this is just an echo filter until you add your own code to it.
</I>&gt;<i> 
</I>&gt;<i> Note 1:
</I>&gt;<i> 
</I>&gt;<i> When a filter is invoked once or only a few times, there is no real 
</I>&gt;<i> advantage in using a cStringIO buffer over a Python List buffer.
</I>&gt;<i> 
</I>&gt;<i> As the number of re-invocations goes up, cStringIO starts to show a 
</I>&gt;<i> speed advantage.
</I>&gt;<i> 
</I>&gt;<i> Note 2:
</I>&gt;<i> 
</I>&gt;<i> Anything else that you may want to initialize at the start of a 
</I>&gt;<i> request should go here, ex:
</I>&gt;<i>      filter.req.some_variable = some_value
</I>&gt;<i> 
</I>&gt;<i> Note 3:
</I>&gt;<i> 
</I>&gt;<i> Depending on your application, you may want to hack at the raw stream 
</I>&gt;<i> before putting it in the buffer, ex:
</I>&gt;<i>     streambuffer.write(streamlet.replace('\r\n', '\n'))
</I>&gt;<i> 
</I>&gt;<i> Note 4:
</I>&gt;<i> 
</I>&gt;<i> At this point, streambuffer contains the entire request response and 
</I>&gt;<i> you may go ahead and do whatever it is you wanted to accomplish, ex:
</I>&gt;<i> 
</I>&gt;<i>     filter.write(my_tranform_function(streambuffer))
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Best Regards,
</I>&gt;<i> Lee E. Brown
</I>&gt;<i> (<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">leebrown at leebrown.org</A>)
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> ----------------------------------------------------------------------
</I>&gt;<i> --
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mod_python mailing list
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I>
_______________________________________________
Mod_python mailing list
<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>

</PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="020871.html">[mod_python] Output Filters Redeaux
</A></li>
	<LI>Next message: <A HREF="020874.html">[mod_python] Output Filters Redeaux
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20873">[ date ]</a>
              <a href="thread.html#20873">[ thread ]</a>
              <a href="subject.html#20873">[ subject ]</a>
              <a href="author.html#20873">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
