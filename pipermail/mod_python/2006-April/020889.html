<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] finding length of user file before uploading
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20finding%20length%20of%20user%20file%20before%20uploading&In-Reply-To=44405C27.7050403%40cogeco.ca">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020882.html">
   <LINK REL="Next"  HREF="020869.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] finding length of user file before uploading</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Mike Looijmans</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20finding%20length%20of%20user%20file%20before%20uploading&In-Reply-To=44405C27.7050403%40cogeco.ca"
       TITLE="[mod_python] finding length of user file before uploading">nlv11281 at natlab.research.philips.com
       </A><BR>
    <I>Tue Apr 18 01:41:32 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="020882.html">[mod_python] finding length of user file before uploading
</A></li>
        <LI>Next message: <A HREF="020869.html">[mod_python] Output Filters Redeaux
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20889">[ date ]</a>
              <a href="thread.html#20889">[ thread ]</a>
              <a href="subject.html#20889">[ subject ]</a>
              <a href="author.html#20889">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>If you check the content-length header BEFORE you do anything with a 
form, PSP won't use the fieldstorage yet, and you'll be in time to 
report an error.

The correct behaviour for these cases is to use the '100 continue' 
system, but the client has to request that with an expect-continue 
header. I'm not sure how you can trigger a browser to wait for a 
'continue' request. Or is apache already handling this under water?

Note that you'll have to forcibly close the connection if you are not 
using the 100 continue response, because the client will keep dumping 
data your way...


Mike Looijmans
Philips Natlab / Topic Automation


greg wrote:
&gt;<i> I want a script (PSP preferred, custom handler if need be) that can
</I>&gt;<i> cancel an upload if the file is too large, or is taking too long.
</I>&gt;<i> The list archives have a few hacks for custom uploads using:
</I>&gt;<i> 
</I>&gt;<i>     util.FieldStorage(req, file_callback=FileFactory)
</I>&gt;<i> 
</I>&gt;<i> However, this parameter is not in the official docs, and several
</I>&gt;<i> previous posters noticed the behaviour breaking between versions.
</I>&gt;<i> My system is Debian, Apache2, mod_python 3.1.3-3.
</I>&gt;<i> When I try the file_callback trick, I get:
</I>&gt;<i> 
</I>&gt;<i>   File &quot;/var/www/upload.psp&quot;, line 40, in ?
</I>&gt;<i>     frm = util.FieldStorage(req, file_callback=make_file)
</I>&gt;<i> 
</I>&gt;<i> TypeError: __init__() got an unexpected keyword argument 'file_callback'
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> I presume that undocumented feature has become extinct in recent versions.
</I>&gt;<i> 
</I>&gt;<i> And, even if it had worked, it still doesn't relay the size of the
</I>&gt;<i> file until the transfer is eating time and memory.
</I>&gt;<i> I would like to avoid making a custom handler that gets the data 
</I>&gt;<i> directly from the client--it seems like I would re-invent the wheel. A 
</I>&gt;<i> slower wheel.
</I>&gt;<i> 
</I>&gt;<i> What is the best way to aquire the filesize before the upload starts?
</I>&gt;<i> 
</I>&gt;<i> Thanks,
</I>&gt;<i> 
</I>&gt;<i> Greg
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mod_python mailing list
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I>&gt;<i> 
</I>
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="020882.html">[mod_python] finding length of user file before uploading
</A></li>
	<LI>Next message: <A HREF="020869.html">[mod_python] Output Filters Redeaux
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20889">[ date ]</a>
              <a href="thread.html#20889">[ thread ]</a>
              <a href="subject.html#20889">[ subject ]</a>
              <a href="author.html#20889">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
