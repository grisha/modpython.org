<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] The new module loader
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20The%20new%20module%20loader&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020932.html">
   <LINK REL="Next"  HREF="020934.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] The new module loader</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20The%20new%20module%20loader&In-Reply-To="
       TITLE="[mod_python] The new module loader">grahamd at dscpl.com.au
       </A><BR>
    <I>Fri Apr 21 01:05:33 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="020932.html">[mod_python] PythonAuthzHandler not working
</A></li>
        <LI>Next message: <A HREF="020934.html">[mod_python] The new module loader
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20933">[ date ]</a>
              <a href="thread.html#20933">[ thread ]</a>
              <a href="subject.html#20933">[ subject ]</a>
              <a href="author.html#20933">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Dan Eloff wrote ..
&gt;<i> The test example you gave using publisher works great. But when I try and
</I>&gt;<i> use that with my current configuration:
</I>&gt;<i> 
</I>&gt;<i> PythonInterpreter testing
</I>&gt;<i> PythonOptimize Off
</I>&gt;<i> PythonDebug On
</I>&gt;<i> PythonAutoReload On
</I>&gt;<i> PythonOption mod_python.future.importer testing
</I>&gt;<i> # don't invoke our python handler if the file has an extension, it doesn't
</I>&gt;<i> handle any addresses like that
</I>&gt;<i> &lt;Directory /&gt;
</I>&gt;<i>     SetHandler mod_python
</I>&gt;<i>     PythonHandler PyServer.pyserver
</I>
The new module importer completely ignores packages as it is practically
impossible to get any form of automatic module reloading to work
correctly with them when they are more than trivial. As such, packages
are handed off to standard Python __import__ to deal with. That it even
finds the package means that you have it installed in sys.path. Even if
it was a file based module, because it is on sys.path and thus likely to
be installed in a standard location, the new module importer would again
ignore it as it leaves all sys.path modules up to Python __import__
as too dangerous to be mixing importing schemes.

Anyway, that all only applies if you were expecting PyServer.pyserver to
automatically reload upon changes.

&gt;<i> &lt;/Directory&gt;
</I>&gt;<i> 
</I>&gt;<i> &lt;LocationMatch &quot;^[^?]*?\.&quot;&gt;
</I>&gt;<i>     SetHandler None
</I>&gt;<i> &lt;/LocationMatch&gt;
</I>&gt;<i> 
</I>&gt;<i> I'm certain it's not using your importer. Nothing is reloaded when modified.
</I>&gt;<i> Nothing is printed to the log.
</I>&gt;<i> 
</I>&gt;<i> I'm calling apache.import_module(module, 1, 1, path).
</I>
With the new module importer, ensure you use:

  apache.import_module(module, path=path)

Do not supply the autoreload and log arguments as they will now
default to None which means that the values will be picked up
automatically from Apache configuration options PythonAutoReload
and PythonDebug. This is mentioned in my document.

Now, if the call to apache.import_module() is at global scope in
PyServer.pyserver, because the package module is not a candidate
for module reloading, that you use apache.import_module() is
not going to do anything. In general, if a package/module is
being imported from sys.path, you shouldn't be using the
apache.import_module() function, at least not at global scope.

A request handler within such a module could use apache.import_module()
as in that case it will be called on each request and the module will
come from the cache if not changed, or will be reloaded from disk if it
has, or isn't in the cache to begin with.

&gt;<i> Any idea why this could be?
</I>
Can you describe the structure of your modules and where your
apache.import_module() calls are.

&gt;<i> Does your importer only work with publisher?
</I>
Should work for normal handlers as well, with proviso that the handler
file would need to be in document tree directory for automatic
reloading to work from top level.

Graham

&gt;<i> Thanks,
</I>&gt;<i> -Dan
</I>&gt;<i> 
</I>&gt;<i> On 4/20/06, Graham Dumpleton &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">grahamd at dscpl.com.au</A>&gt; wrote:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Dan Eloff wrote ..
</I>&gt;<i> &gt; &gt; Neat, it works like you said it would, very nice. I'm not sure how
</I>&gt;<i> you
</I>&gt;<i> &gt; &gt; managed to reload parent when child changes, I'd like to take a peek
</I>&gt;<i> at
</I>&gt;<i> &gt; &gt; that
</I>&gt;<i> &gt; &gt; later, good job.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Lots of magic involved. :-)
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; What it does is keep a dependency tree of imports managed through the
</I>&gt;<i> &gt; importer and determines if parents need reloading based on mtime of
</I>&gt;<i> &gt; child being updated, or if the child had been reimported since the last
</I>&gt;<i> &gt; time the parent was imported.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; It does this to multiple levels, so you could copy child.py to
</I>&gt;<i> &gt; grandchild.py
</I>&gt;<i> &gt; and add &quot;import grandchild&quot; into &quot;child.py&quot; and you will see that touching
</I>&gt;<i> &gt; grandchild.py will correctly cause both child and parent to be imported
</I>&gt;<i> &gt; when parent accessed.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &gt; __purge__ is called if __clone__ raises and exception, to notify the
</I>&gt;<i> &gt; &gt; original module that it wasn't able to be cloned, and now it's just
</I>&gt;<i> &gt; going
</I>&gt;<i> &gt; &gt; to
</I>&gt;<i> &gt; &gt; be dumped without the data being copied over.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Yep. Sort of a failsafe. Not sure what you might use it for. Maybe to
</I>&gt;<i> &gt; force
</I>&gt;<i> &gt; close of database connections although you would have to be careful
</I>&gt;<i> &gt; doing that as they may be in use by parallel requests in same process.
</I>&gt;<i> &gt; So, more flag that its all going away and close idle connections and
</I>&gt;<i> &gt; when parallel request release connections they might close automatically.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &gt; I think I figured out what you used the intialized flag for in child.py,
</I>&gt;<i> &gt; &gt; it
</I>&gt;<i> &gt; &gt; let's you avoid initializing the parts that get overwritten by
</I>&gt;<i> &gt; __clone__()
</I>&gt;<i> &gt; &gt; in the event that __clone__ is called, afterall, it could be an
</I>&gt;<i> &gt; expensive
</I>&gt;<i> &gt; &gt; operation. I don't understand why you keep a reference in a temporary
</I>&gt;<i> &gt; &gt; location and then lock the object and copy outside of __clone__, why
</I>&gt;<i> not
</I>&gt;<i> &gt; &gt; lock and copy inside __clone__?
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; The temporary was just to show a different variation. There is lots of
</I>&gt;<i> &gt; ways
</I>&gt;<i> &gt; of doing it. The reason for doing the transfer outside of the clone
</I>&gt;<i> &gt; function
</I>&gt;<i> &gt; is that at the clone point the new module hasn't actually been loaded
</I>&gt;<i> and
</I>&gt;<i> &gt; you
</I>&gt;<i> &gt; may need to create instances of classes from the new module to pour the
</I>&gt;<i> &gt; transferred data into. These are only available later.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Graham
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &gt; Thanks,
</I>&gt;<i> &gt; &gt; -Dan
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; On 4/20/06, Graham Dumpleton &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">grahamd at dscpl.com.au</A>&gt; wrote:
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; Dan Eloff wrote ..
</I>&gt;<i> &gt; &gt; &gt; &gt; Yay! I've got it now, and it compiled fine. I suspect something
</I>&gt;<i> that
</I>&gt;<i> &gt; &gt; &gt; will
</I>&gt;<i> &gt; &gt; &gt; &gt; still be a hitch is the need for that __clone__() method you talked
</I>&gt;<i> &gt; &gt; &gt; about.
</I>&gt;<i> &gt; &gt; &gt; &gt; How do I use it, is it documented anywhere, or is there an example
</I>&gt;<i> &gt; &gt; &gt; &gt; __clone__() method I can see?
</I>&gt;<i> &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; Thanks,
</I>&gt;<i> &gt; &gt; &gt; &gt; -Dan
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; Note that the __clone__() method is something that I added because
</I>&gt;<i> of
</I>&gt;<i> &gt; &gt; &gt; a need I saw. I doubt that anyone else has burrowed into the code
</I>&gt;<i> for
</I>&gt;<i> &gt; &gt; &gt; the importer deep enough yet to understand what it is necessarily
</I>&gt;<i> all
</I>&gt;<i> &gt; &gt; &gt; about and thus the whole concept hasn't been peer reviewed as such.
</I>&gt;<i> &gt; &gt; &gt; Thus whether it is included at all, or in the form as it currently
</I>&gt;<i> &gt; exists
</I>&gt;<i> &gt; &gt; &gt; is not final.
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; That said, I have attached a very contrived set of examples of
</I>&gt;<i> &gt; migrating
</I>&gt;<i> &gt; &gt; &gt; data from an old module to a new. It looks messy purely because of
</I>&gt;<i> &gt; &gt; &gt; the different examples and support for multithreading. If a module
</I>&gt;<i> is
</I>&gt;<i> &gt; &gt; &gt; complicated and you want to be able to support multithreading and
</I>&gt;<i> &gt; &gt; &gt; module reloading, it will be complicated. I've seen a bit of dubious
</I>&gt;<i> &gt; &gt; code
</I>&gt;<i> &gt; &gt; &gt; posted in the past which given the right conditions would blow up,
</I>&gt;<i> &gt; &gt; &gt; but without a proper solution have generally refrained from pointing
</I>&gt;<i> &gt; &gt; &gt; out the problems.
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; Put the attached file in a directory configured for
</I>&gt;<i> &gt; mod_python.publisher
</I>&gt;<i> &gt; &gt; &gt; with a configuration something like:
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt;   PythonInterpreter testing
</I>&gt;<i> &gt; &gt; &gt;   AddHandler mod_python .py
</I>&gt;<i> &gt; &gt; &gt;   PythonHandler mod_python.publisher
</I>&gt;<i> &gt; &gt; &gt;   PythonDebug On
</I>&gt;<i> &gt; &gt; &gt;   PythonAutoReload On
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; The &quot;testing&quot; interpreter is the one I have the new module importer
</I>&gt;<i> &gt; &gt; &gt; enabled for. Ie., in main Apache configuration, outside of all
</I>&gt;<i> &gt; container
</I>&gt;<i> &gt; &gt; &gt; directives have:
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt;   PythonOption mod_python.future.importer testing
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; Check that all works by accessing page as &quot;child.py&quot;. Once it works,
</I>&gt;<i> &gt; &gt; &gt; copy &quot;child.py&quot; to &quot;parent.py&quot; and add at the start the line:
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt;   import child
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; Then access &quot;parent.py&quot;.
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; Now for some fun, update modification time on &quot;parent.py&quot; by touching
</I>&gt;<i> &gt; &gt; &gt; it or resaving it. Watch how reload counter increments. Touch it
</I>&gt;<i> again
</I>&gt;<i> &gt; &gt; &gt; and see how transfer counter increments. Work out from code what
</I>&gt;<i> &gt; &gt; &gt; each of the bits is doing and why certain things are done certain
</I>&gt;<i> &gt; ways.
</I>&gt;<i> &gt; &gt; &gt; If you don't understand, ask.
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; Now for some tricky stuff. Touch the &quot;child.py&quot; file, but still access
</I>&gt;<i> &gt; &gt; &gt; &quot;parent.py&quot;. See how the parent module gets reloaded. Keep touching
</I>&gt;<i> &gt; &gt; &gt; &quot;child.py&quot; if you don't believe what is happening. Also access &quot;
</I>&gt;<i> &gt; child.py&quot;
</I>&gt;<i> &gt; &gt; &gt; from browser as well to see how was also reloaded.
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; What is happening here is that new module importer doesn't just look
</I>&gt;<i> &gt; &gt; &gt; at page you are accessing, but looks at modules it imports and if
</I>&gt;<i> the
</I>&gt;<i> &gt; &gt; &gt; child changes, the parent gets reloaded automatically along with
</I>&gt;<i> the
</I>&gt;<i> &gt; &gt; &gt; child. With this working, you avoid all the horrible problems that
</I>&gt;<i> &gt; exist
</I>&gt;<i> &gt; &gt; &gt; now of having to force reloads by touching all files or restarting
</I>&gt;<i> &gt; Apache.
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; Finally, note how the reload is occurring even though child was
</I>&gt;<i> &gt; imported
</I>&gt;<i> &gt; &gt; &gt; using &quot;import&quot; statement. This is because underneath it is magically
</I>&gt;<i> &gt; &gt; &gt; mapping to apache.import_module(). Change the &quot;import&quot; from:
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt;   import child
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; to:
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt;   child = apache.import_module(&quot;child&quot;)
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; and you will see it works the same.
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; The rules are as per that incomplete document I referred you to
</I>&gt;<i> &gt; &gt; &gt; about the module importer.
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; BTW, you cant totally avoid Apache restarts when you start using
</I>&gt;<i> &gt; &gt; &gt; __clone__() unless you are quite careful that it handles gracefully
</I>&gt;<i> &gt; &gt; &gt; not finding the data in an existing module that it is looking to
</I>&gt;<i> copy
</I>&gt;<i> &gt; &gt; &gt; across. Anyway, experiment and you will see what I mean.
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; You might also see if you can work out what __purge__() function
</I>&gt;<i> &gt; &gt; &gt; does by looking at source code. :-)
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; Hope this provides you with hours of fun.
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; Graham
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; On 4/20/06, Graham Dumpleton &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">grahamd at dscpl.com.au</A>&gt; wrote:
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; Quoting from some of Jim's notes:
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt;    To access the Subversion repositories anonymously, you will
</I>&gt;<i> &gt; need
</I>&gt;<i> &gt; &gt; a
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; Subversion client.
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt;    Choose the branch you would like to work on and check it out.
</I>&gt;<i> &gt; &gt; For
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; example, to get the
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt;    current development branch (trunk), use:
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt;      svn co <A HREF="http://svn.apache.org/repos/asf/httpd/mod_python/trunk">http://svn.apache.org/repos/asf/httpd/mod_python/trunk</A>
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; mod_python
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; Graham
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; On 21/04/2006, at 4:17 AM, Dan Eloff wrote:
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; Excellent, now I just have to figure out how to get it from
</I>&gt;<i> the
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; svn. There's no instructions (that I found) on the mod_python
</I>&gt;<i> &gt; site,
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; probably because it's something everybody but me knows.Idownloaded
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; TortoiseSVN because that seems to be what you need on windows,
</I>&gt;<i> &gt; &gt; and
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; it when I click on checkout it wants to know the url of the
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; repository.
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; <A HREF="http://svn.apache.org">http://svn.apache.org</A> and
</I>&gt;<i> &gt; <A HREF="http://svn.apache.org/httpd/mod_python/">http://svn.apache.org/httpd/mod_python/</A>
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; do not work.
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; What's the url (and am I even going about this the right way?)
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; Thanks,
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; -Dan
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; On 4/19/06, Graham Dumpleton &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">grahamd at dscpl.com.au</A>&gt; wrote:
</I>&gt;<i> Dan
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; Eloff wrote ..
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; It sounds interesting, it might just finally solve all my
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; importing woes.
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; How do I enable this UMI?
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; Thanks,
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; -Dan
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; See:
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; <A HREF="http://issues.apache.org/jira/browse/MODPYTHON-143#action_12370976">http://issues.apache.org/jira/browse/MODPYTHON-143#action_12370976</A>
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; Graham
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; On 4/19/06, Graham Dumpleton &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">grahamd at dscpl.com.au</A>&gt; wrote:
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; Dan Eloff wrote ..
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; I am interested in how this unified module importer works
</I>&gt;<i> &gt; &gt; and
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; how it
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; avoids
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; these problems.
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; I'd really appreciate a brief description of it's
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; architecture, not
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; that
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; you
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; usually need all that much encouraging ;)
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; Thanks,
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; -Dan
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; Bit busy today to elaborate too much, but you can start
</I>&gt;<i> by
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; reading my
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; far from complete document on it:
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt;   <A HREF="http://www.dscpl.com.au/articles/modpython-007.html">http://www.dscpl.com.au/articles/modpython-007.html</A>
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; Graham
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; On 4/19/06, Graham Dumpleton &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">grahamd at dscpl.com.au</A>&gt; wrote:
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; On 20/04/2006, at 8:06 AM, Dan Eloff wrote:
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; I went digging through the mod_python files and
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; discovered how
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; the
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; new
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; publisher loader works (using ModuleCache) and I
</I>&gt;<i> &gt; borrowed
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; the idea
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; to
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; import modules for my handler.
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; Note that mod_python 3.3 will like be discarding that
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; module loader
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; and the original one and replacing it with a grand
</I>&gt;<i> &gt; unified
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; module
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; reloader. :-)
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; The purpose of ModuleCache was to avoid sys.modulesright?
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; Yes.
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; I'm having some trouble with this, and I eventually
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; tracked it
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; down
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; to
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; multiple versions of a dependancy module being loaded.
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; Known issue. See:
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; <A HREF="http://www.dscpl.com.au/articles/">http://www.dscpl.com.au/articles/</A>
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; modpython-003.html#multiple-module-
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; instances
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; My handler loads one version, with empty module
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; variables, while
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; the
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; actual modules for the pages load different version(s)
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; and populate
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; them with data. The changes are never reflected in
</I>&gt;<i> the
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; version
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; kept
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; by
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; my handler (because they are not the same)
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; This all makes sense, and is probably the intended
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; effect, but
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; what
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; do
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; you do for modules like Session in mod_python, where
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; MemorySession
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; uses a static class member to store sessions? Wouldn't
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; the page
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; modules each get their own version and thusly prevent
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; sessions
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; from
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; working?
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; Also see:
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; <A HREF="http://www.dscpl.com.au/articles/modpython-003.html#transfer-of-">http://www.dscpl.com.au/articles/modpython-003.html#transfer-of-</A>
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; module-
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; data
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; I need to be able to reload modified modules, but
</I>&gt;<i> also
</I>&gt;<i> &gt; &gt; to
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; make
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; use
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; of
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; shared modules. These seem to be conflicting needs,
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; however. Does
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; anybody have any inisght into this situation that
</I>&gt;<i> they
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; can share?
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; Only that mod_python 3.3 will hopefully fix a lot of
</I>&gt;<i> &gt; this
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; stuff.
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; If
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; you
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; are prepared to give 3.3 source code out of subversion
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; repository
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; a go
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; to see if things work as you expect, let me know and
</I>&gt;<i> &gt; will
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; tell you
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; the
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; magic to enable the unified module importer in 3.3
</I>&gt;<i> as at
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; moment it
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; is
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; still off by default.
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; Note though that even in 3.3, the &quot;transfer of module
</I>&gt;<i> &gt; data&quot;
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; issue
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; still
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; has to be explicitly dealt with in some way. Although
</I>&gt;<i> &gt; not
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; confirmed
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; how
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; this will be done, the new module importer as it stands
</I>&gt;<i> &gt; &gt; now
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; allows
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; a
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; module to define a __clone__() method which will be
</I>&gt;<i> &gt; called
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; and which
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; can be used to transfer data from an old module to
</I>&gt;<i> a new
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; where data
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; needs
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; to be preserved across reloads.
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; As I said, if interested I'll go into it more later.
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; Graham
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt; &gt; &gt;
</I>&gt;<i> &gt;
</I></PRE>










<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="020932.html">[mod_python] PythonAuthzHandler not working
</A></li>
	<LI>Next message: <A HREF="020934.html">[mod_python] The new module loader
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20933">[ date ]</a>
              <a href="thread.html#20933">[ thread ]</a>
              <a href="subject.html#20933">[ subject ]</a>
              <a href="author.html#20933">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
