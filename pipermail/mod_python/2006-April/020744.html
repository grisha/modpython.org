<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] mod_python session p roblem
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20mod_python%20session%20p%20roblem&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020743.html">
   <LINK REL="Next"  HREF="020745.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] mod_python session p roblem</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20mod_python%20session%20p%20roblem&In-Reply-To="
       TITLE="[mod_python] mod_python session p roblem">grahamd at dscpl.com.au
       </A><BR>
    <I>Sun Apr  2 18:54:29 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="020743.html">[mod_python] mod_python session p roblem
</A></li>
        <LI>Next message: <A HREF="020745.html">[mod_python] weird error in mod_python (3.1.4.r1) /scipy
	(0.4.8)/gentoo (~x86) web application
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20744">[ date ]</a>
              <a href="thread.html#20744">[ thread ]</a>
              <a href="subject.html#20744">[ subject ]</a>
              <a href="author.html#20744">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;<i> &gt; yjfuk wrote:
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt;&gt;code below:
</I>&gt;<i> &gt;&gt;from mod_python import Session
</I>&gt;<i> &gt;&gt;def index(req)
</I>&gt;<i> &gt;&gt;  sess=Session.Session(req)
</I>&gt;<i> &gt;&gt;  if sess.is_new():
</I>&gt;<i> &gt;&gt;    sess['num']=0
</I>&gt;<i> &gt;&gt;    sess.save()
</I>&gt;<i> &gt;&gt;  else:
</I>&gt;<i> &gt;&gt;    sess['num']+=1
</I>&gt;<i> &gt;&gt;    sess.save()
</I>&gt;<i> &gt;&gt;    req.write(str(sess['num']))
</I>&gt;<i> &gt;&gt; 
</I>&gt;<i> &gt;&gt; 
</I>&gt;<i> &gt;&gt;when I reflush the browser some times ,the session is usually lost .
</I>&gt;<i> &gt;&gt;I run it in windows XP(sp2),python 2.4.2, mod_python 3.2.8
</I>
Is this really the complete code you were using to experiment with
or have you thrown out a lot of stuff?

I ask as since you were using req.write(), no content type would be
set for case where existing session used and an empty response
would result from where it is a new session. Thus, the responses
wouldn't necessarily be as useful as they could be. This is assuming
the indenting of your code was simply stuffed up in one of the
posts.

Oh, there is also a ':' missing off function prototype, but again that
may also have dissappeared in posts.

The important thing is, if this isn't all your code, then it is possible
that the problem lies in stuff you didn't post.

Jim Gallacher wrote ..
&gt;<i> The code you show here looks OK, so I'm not sure what the problem may be.
</I>&gt;<i> 
</I>&gt;<i> So is a new session created for every request, where you always see &quot;0&quot;
</I>&gt;<i> returned in the response? Or do you sometimes see some number greater
</I>&gt;<i> than &quot;0&quot;, and then sometimes &quot;0&quot;? This is unclear in your original
</I>&gt;<i> message as well.
</I>&gt;<i> 
</I>&gt;<i> Is there anything in the apache error log indicating a problem?
</I>
I would suggest you experiment with something like the following code:

  from mod_python import Session
  import time

  def index(req):

    timestamp = time.time()

    req.log_error(&quot;index %s&quot; % `timestamp`)

    req.content_type = 'text/plain'

    sess=Session.Session(req)

    if sess.is_new():
      sess['num']=0
      sess.save()
    else:
      sess['num']+=1
      sess.save()

    req.write(&quot;index %s\n&quot; % `timestamp`)

    req.write(&quot;num %d\n&quot; % str(sess['num']))

The point of the logging is to prove that the function did in fact get
called. The point of returning the timestamp in the response is to
prove that you are in fact getting a different fresh page on each access
attempt.

If it isn't a problem in some other code of yours, one possibility if
you are accessing the server through a proxy is that you have an
overly agressive proxy cache. This can be a problem with GET requests
in some situations and in worst cases it may be necessary to specify
explicitly that responses should not be cached.

When you work out the problem or if you already have, please followup
saying it is fixed and describe what the problem is. :-)

Graham

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="020743.html">[mod_python] mod_python session p roblem
</A></li>
	<LI>Next message: <A HREF="020745.html">[mod_python] weird error in mod_python (3.1.4.r1) /scipy
	(0.4.8)/gentoo (~x86) web application
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20744">[ date ]</a>
              <a href="thread.html#20744">[ thread ]</a>
              <a href="subject.html#20744">[ subject ]</a>
              <a href="author.html#20744">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
