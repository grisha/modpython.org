<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] ValueError with Flash 8 FileReference.upload(url)  
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20ValueError%20with%20Flash%208%20FileReference.upload%28url%29%20%20&In-Reply-To=200604212234.k3LMYlXx025416%40dscpl.user.openhosting.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020950.html">
   <LINK REL="Next"  HREF="020963.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] ValueError with Flash 8 FileReference.upload(url)  </H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20ValueError%20with%20Flash%208%20FileReference.upload%28url%29%20%20&In-Reply-To=200604212234.k3LMYlXx025416%40dscpl.user.openhosting.com"
       TITLE="[mod_python] ValueError with Flash 8 FileReference.upload(url)  ">grahamd at dscpl.com.au
       </A><BR>
    <I>Sat Apr 22 23:49:51 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="020950.html">[mod_python] Problem with configure
</A></li>
        <LI>Next message: <A HREF="020963.html">[mod_python] session lock
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20962">[ date ]</a>
              <a href="thread.html#20962">[ thread ]</a>
              <a href="subject.html#20962">[ subject ]</a>
              <a href="author.html#20962">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On 22/04/2006, at 8:33 AM, Alec Matusis wrote:

&gt;<i> Is there a way to read the request by lines in the filter, rather than
</I>&gt;<i> trying to read the entire buffer?
</I>&gt;<i> That way at least the text that I am trying to replace will come in  
</I>&gt;<i> a single
</I>&gt;<i> read, when I read that line.
</I>&gt;<i>
</I>&gt;<i> Or will it be to slow?
</I>
There is no way to read a line at a time.

All I can suggest is that you read through the complete recent thread  
about
filters as described in:

     <A HREF="http://www.modpython.org/pipermail/mod_python/2006-April/">http://www.modpython.org/pipermail/mod_python/2006-April/</A> 
020869.html

For thread view see:

     <A HREF="http://www.modpython.org/pipermail/mod_python/2006-April/">http://www.modpython.org/pipermail/mod_python/2006-April/</A> 
thread.html

In that thread it gives recipes for how to buffer up data until it is  
all received
so that it can be processed in one go, thus avoiding problems with  
partial
reads of data you are interested in.

In terms of whether it would be slow or not, I would suggest you just  
get
something working first that would work reliably and only then worry  
about
performance. In the greater scheme of things, your traffic for these  
sort of
posts may be so minimal that you could ignore that they incur slightly
greater overhead.

Graham

&gt;<i> -----Original Message-----
</I>&gt;<i> From: Graham Dumpleton [mailto:<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">grahamd at dscpl.com.au</A>]
</I>&gt;<i> Sent: Friday, April 21, 2006 3:24 PM
</I>&gt;<i> To: Alec Matusis
</I>&gt;<i> Cc: <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">mod_python at modpython.org</A>
</I>&gt;<i> Subject: Re: [mod_python] ValueError with Flash 8  
</I>&gt;<i> FileReference.upload(url)
</I>&gt;<i>
</I>&gt;<i> Actually there is another problem that only came to me later. That is
</I>&gt;<i> that
</I>&gt;<i> there is no guarantee with an input filter that you are going to  
</I>&gt;<i> get the
</I>&gt;<i> complete text you are trying to replace in one read even if it was
</I>&gt;<i> written
</I>&gt;<i> in one go by the client. This is because you are at the mercy of how
</I>&gt;<i> blocking of data reads off the client socket works out. A patching of
</I>&gt;<i> the
</I>&gt;<i> util.FieldStorage class may be the only way around that.
</I>&gt;<i>
</I>&gt;<i> Graham
</I>&gt;<i>
</I>&gt;<i> On 21/04/2006, at 7:40 PM, Alec Matusis wrote:
</I>&gt;<i>
</I>&gt;&gt;<i>  Yes, I got that.
</I>&gt;&gt;<i> Thanks, I tested it, all works well.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I hope this filter does not tax the performance too much when I
</I>&gt;&gt;<i> submit large
</I>&gt;&gt;<i> files?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> -----Original Message-----
</I>&gt;&gt;<i> From: Graham Dumpleton [mailto:<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">grahamd at dscpl.com.au</A>]
</I>&gt;&gt;<i> Sent: Friday, April 21, 2006 2:39 AM
</I>&gt;&gt;<i> To: Alec Matusis
</I>&gt;&gt;<i> Cc: <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">mod_python at modpython.org</A>
</I>&gt;&gt;<i> Subject: Re: [mod_python] ValueError with Flash 8
</I>&gt;&gt;<i> FileReference.upload(url)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Whoops.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> On 21/04/2006, at 7:23 PM, Graham Dumpleton wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> A creative way of getting around the problem. I hadn't thought
</I>&gt;&gt;&gt;<i> of using a filter. Some suggested changes below.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> On 21/04/2006, at 6:12 PM, Alec Matusis wrote:
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> I figured out how to do this without changing mod_python source:
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> I wrote a mod_python input filter:
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> flashfilter.py:
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> from mod_python import apache
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> def inputfilter(filter):
</I>&gt;&gt;&gt;&gt;<i>     #this is a workaround flash 8 FileReference bug: Flash POST is
</I>&gt;&gt;&gt;&gt;<i> not
</I>&gt;&gt;&gt;&gt;<i> RFC-compliant as of Flash 8,0,22,0
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>     if 'flashfileref' in parse_args(filter.req.args):
</I>&gt;&gt;&gt;<i>       filter.pass_on()
</I>&gt;&gt;&gt;<i>       return
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Logic wrong way around.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>      if 'flashfileref' not in parse_args(filter.req.args):
</I>&gt;&gt;<i>        filter.pass_on()
</I>&gt;&gt;<i>        return
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Graham
</I>
</PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="020950.html">[mod_python] Problem with configure
</A></li>
	<LI>Next message: <A HREF="020963.html">[mod_python] session lock
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20962">[ date ]</a>
              <a href="thread.html#20962">[ thread ]</a>
              <a href="subject.html#20962">[ subject ]</a>
              <a href="author.html#20962">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
