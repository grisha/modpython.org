<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] ValueError with Flash 8 FileReference.upload(url)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20ValueError%20with%20Flash%208%20FileReference.upload%28url%29&In-Reply-To=F4D33C0B-AA5E-471B-A37B-60EBDC13024F%40dscpl.com.au">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020785.html">
   <LINK REL="Next"  HREF="020788.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] ValueError with Flash 8 FileReference.upload(url)</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20ValueError%20with%20Flash%208%20FileReference.upload%28url%29&In-Reply-To=F4D33C0B-AA5E-471B-A37B-60EBDC13024F%40dscpl.com.au"
       TITLE="[mod_python] ValueError with Flash 8 FileReference.upload(url)">grahamd at dscpl.com.au
       </A><BR>
    <I>Wed Apr  5 07:47:09 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="020785.html">[mod_python] ValueError with Flash 8 FileReference.upload(url)
</A></li>
        <LI>Next message: <A HREF="020788.html">[mod_python] ValueError with Flash 8 FileReference.upload(url)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20787">[ date ]</a>
              <a href="thread.html#20787">[ thread ]</a>
              <a href="subject.html#20787">[ subject ]</a>
              <a href="author.html#20787">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I am coming to the conclusion that the file produced by Flash is  
malformed.

Even if I were to get rid of the double \r\r sequences, replacing  
them with a
single \r, you end up with no blank like after:

   Content-Disposition: form-data; name=&quot;Upload&quot;

which means that:

   Submit Query

gets interpreted as a header and thus why it dies as there is no  
colon on that
line.

Anyone got any better ideas?

Bedtime for me now.

Graham

On 05/04/2006, at 9:32 PM, Graham Dumpleton wrote:

&gt;<i>
</I>&gt;<i> On 05/04/2006, at 9:28 PM, Harold J. Ship wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> Ok, here's the output.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> ------------KM7GI3gL6cH2gL6gL6cH2gL6cH2KM7
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Content-Disposition: form-data; name=&quot;Filename&quot;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> sample.txt
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> ------------KM7GI3gL6cH2gL6gL6cH2gL6cH2KM7
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Content-Disposition: form-data; name=&quot;Filedata&quot;;  
</I>&gt;&gt;<i> filename=&quot;sample.txt&quot;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Content-Type: application/octet-stream
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Start of Sample Text File Contents
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> End of Sample Text File Contents
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> ------------KM7GI3gL6cH2gL6gL6cH2gL6cH2KM7
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Content-Disposition: form-data; name=&quot;Upload&quot;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Submit Query
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> ------------KM7GI3gL6cH2gL6gL6cH2gL6cH2KM7
</I>&gt;<i>
</I>&gt;<i> I'm not an expert on FieldStorage as I stayed out of all the  
</I>&gt;<i> discussions on
</I>&gt;<i> it when it was being improved. I am also not up on what the content  
</I>&gt;<i> type
</I>&gt;<i> application/x-www-form-urlencoded is all about. All the same, I'll  
</I>&gt;<i> share
</I>&gt;<i> what I found so far in case it helps someone else.
</I>&gt;<i>
</I>&gt;<i> First off, I don't get an error, but I don't believe I get correct  
</I>&gt;<i> results either.
</I>&gt;<i> To test, what I did was create a handler containing:
</I>&gt;<i>
</I>&gt;<i> from mod_python import apache, util
</I>&gt;<i>
</I>&gt;<i> def handler(req):
</I>&gt;<i>
</I>&gt;<i>     apache.log_error('headers_in=%s'%req.headers_in)
</I>&gt;<i>
</I>&gt;<i>     req.content_type = 'text/plain'
</I>&gt;<i>
</I>&gt;<i>     form = util.FieldStorage(req)
</I>&gt;<i>
</I>&gt;<i>     for field in form.list:
</I>&gt;<i>         apache.log_error('name=%s' % `field.name`)
</I>&gt;<i>         apache.log_error('value=%s' % `field.value`)
</I>&gt;<i>
</I>&gt;<i>     req.write('done')
</I>&gt;<i>
</I>&gt;<i>     return apache.OK
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> I then used &quot;ab&quot; to post your file to a URL mapping to that handler.
</I>&gt;<i>
</I>&gt;<i>   ab -p post.dat -T 'multipart/form-data; boundary=---------- 
</I>&gt;<i> KM7GI3gL6cH2gL6gL6cH2gL6cH2KM7^M' <A HREF="http://localhost:8082/testing/">http://localhost:8082/testing/</A> 
</I>&gt;<i> upload-1/dummy
</I>&gt;<i>
</I>&gt;<i> Note that that is actually a real \r (CR) where ^M is shown in the  
</I>&gt;<i> boundary.
</I>&gt;<i> Without that it wouldn't work. I am not sure though whether that is  
</I>&gt;<i> simply due
</I>&gt;<i> to CR LF weirdness in way file was created and then how it is being  
</I>&gt;<i> interpreted
</I>&gt;<i> by &quot;ab&quot; on Mac OS X when given to it as input.
</I>&gt;<i>
</I>&gt;<i> Anyway, result of that is:
</I>&gt;<i>
</I>&gt;<i> [Wed Apr 05 21:26:24 2006] [error] headers_in={'Content-type':  
</I>&gt;<i> 'multipart/form-data; boundary=---------- 
</I>&gt;<i> KM7GI3gL6cH2gL6gL6cH2gL6cH2KM7\r', 'Content-length': '498',  
</I>&gt;<i> 'Accept': '*/*', 'Host': 'localhost:8082', 'User-Agent':  
</I>&gt;<i> 'ApacheBench/1.3d'}
</I>&gt;<i> [Wed Apr 05 21:26:24 2006] [error] [client 127.0.0.1] PythonHandler  
</I>&gt;<i> upload: Traceback (most recent call last):
</I>&gt;<i> [Wed Apr 05 21:26:24 2006] [error] [client 127.0.0.1] PythonHandler  
</I>&gt;<i> upload:   File &quot;/System/Library/Frameworks/Python.framework/ 
</I>&gt;<i> Versions/2.3/lib/python2.3/site-packages/mod_python/apache.py&quot;,  
</I>&gt;<i> line 308, in HandlerDispatch\n    result = object(req)
</I>&gt;<i> [Wed Apr 05 21:26:24 2006] [error] [client 127.0.0.1] PythonHandler  
</I>&gt;<i> upload:   File &quot;/Users/grahamd/Workspaces/testing/upload-1/ 
</I>&gt;<i> upload.py&quot;, line 9, in handler\n    form = util.FieldStorage(req)
</I>&gt;<i> [Wed Apr 05 21:26:24 2006] [error] [client 127.0.0.1] PythonHandler  
</I>&gt;<i> upload:   File &quot;/System/Library/Frameworks/Python.framework/ 
</I>&gt;<i> Versions/2.3/lib/python2.3/site-packages/mod_python/util.py&quot;, line  
</I>&gt;<i> 180, in __init__\n    h, v = line.split(&quot;:&quot;, 1)
</I>&gt;<i> [Wed Apr 05 21:26:24 2006] [error] [client 127.0.0.1] PythonHandler  
</I>&gt;<i> upload: ValueError: unpack list of wrong size
</I>&gt;<i>
</I>&gt;<i> Thus, have duplicated it.
</I>&gt;<i>
</I>&gt;<i> Note that this may possibly be something to do with strangeness in  
</I>&gt;<i> line endings.
</I>&gt;<i> First their was the issue above with CR, but there are other  
</I>&gt;<i> nasties in input with
</I>&gt;<i> CR LF. See following &quot;od&quot; dump.
</I>&gt;<i>
</I>&gt;<i> 0000000    -   -   -   -   -   -   -   -   -   -   -   -   K   M    
</I>&gt;<i> 7   G
</I>&gt;<i> 0000020    I   3   g   L   6   c   H   2   g   L   6   g   L   6    
</I>&gt;<i> c   H
</I>&gt;<i> 0000040    2   g   L   6   c   H   2   K   M   7  \r  \r  \n   C    
</I>&gt;<i> o   n
</I>&gt;<i> 0000060    t   e   n   t   -   D   i   s   p   o   s   i   t   i    
</I>&gt;<i> o   n
</I>&gt;<i> 0000100    :       f   o   r   m   -   d   a   t   a   ;       n    
</I>&gt;<i> a   m
</I>&gt;<i> 0000120    e   =   &quot;   F   i   l   e   n   a   m   e   &quot;  \r  \r   
</I>&gt;<i> \n  \r
</I>&gt;<i> 0000140   \r  \n   s   a   m   p   l   e   .   t   x   t  \r  \r   
</I>&gt;<i> \n   -
</I>&gt;<i> 0000160    -   -   -   -   -   -   -   -   -   -   -   K   M   7    
</I>&gt;<i> G   I
</I>&gt;<i> 0000200    3   g   L   6   c   H   2   g   L   6   g   L   6   c    
</I>&gt;<i> H   2
</I>&gt;<i> 0000220    g   L   6   c   H   2   K   M   7  \r  \r  \n   C   o    
</I>&gt;<i> n   t
</I>&gt;<i> 0000240    e   n   t   -   D   i   s   p   o   s   i   t   i   o    
</I>&gt;<i> n   :
</I>&gt;<i> 0000260        f   o   r   m   -   d   a   t   a   ;       n   a    
</I>&gt;<i> m   e
</I>&gt;<i> 0000300    =   &quot;   F   i   l   e   d   a   t   a   &quot;   ;       f    
</I>&gt;<i> i   l
</I>&gt;<i> 0000320    e   n   a   m   e   =   &quot;   s   a   m   p   l   e   .    
</I>&gt;<i> t   x
</I>&gt;<i> 0000340    t   &quot;  \r  \r  \n   C   o   n   t   e   n   t   -   T    
</I>&gt;<i> y   p
</I>&gt;<i> 0000360    e   :       a   p   p   l   i   c   a   t   i   o    
</I>&gt;<i> n   /   o
</I>&gt;<i> 0000400    c   t   e   t   -   s   t   r   e   a   m  \r  \r  \n   
</I>&gt;<i> \r  \r
</I>&gt;<i> 0000420   \n   S   t   a   r   t       o   f       S   a   m   p    
</I>&gt;<i> l   e
</I>&gt;<i> 0000440        T   e   x   t       F   i   l   e       C   o   n    
</I>&gt;<i> t   e
</I>&gt;<i> 0000460    n   t   s  \r  \r  \n   E   n   d       o   f       S    
</I>&gt;<i> a   m
</I>&gt;<i> 0000500    p   l   e       T   e   x   t       F   i   l   e        
</I>&gt;<i> C   o
</I>&gt;<i> 0000520    n   t   e   n   t   s  \r  \r  \n  \r  \r  \n   -   -    
</I>&gt;<i> -   -
</I>&gt;<i> 0000540    -   -   -   -   -   -   -   -   K   M   7   G   I   3    
</I>&gt;<i> g   L
</I>&gt;<i> 0000560    6   c   H   2   g   L   6   g   L   6   c   H   2   g    
</I>&gt;<i> L   6
</I>&gt;<i> 0000600    c   H   2   K   M   7  \r  \r  \n   C   o   n   t   e    
</I>&gt;<i> n   t
</I>&gt;<i> 0000620    -   D   i   s   p   o   s   i   t   i   o   n   :        
</I>&gt;<i> f   o
</I>&gt;<i> 0000640    r   m   -   d   a   t   a   ;       n   a   m   e   =    
</I>&gt;<i> &quot;   U
</I>&gt;<i> 0000660    p   l   o   a   d   &quot;  \r  \r  \n   S   u   b   m   i   t
</I>&gt;<i> 0000700    Q   u   e   r   y  \r  \r  \n   -   -   -   -   -   -    
</I>&gt;<i> -   -
</I>&gt;<i> 0000720    -   -   -   -   K   M   7   G   I   3   g   L   6   c    
</I>&gt;<i> H   2
</I>&gt;<i> 0000740    g   L   6   g   L   6   c   H   2   g   L   6   c   H    
</I>&gt;<i> 2   K
</I>&gt;<i> 0000760    M   7
</I>&gt;<i> 0000762
</I>&gt;<i>
</I>&gt;<i> See the &quot;\r  \r  \n  \r  \r  \n&quot; sequences.
</I>&gt;<i>
</I>&gt;<i> Not sure that I'll have much more time to play with this tonight,  
</I>&gt;<i> so posting this
</I>&gt;<i> progress in case someone else wants to pick up and continue.
</I>&gt;<i>
</I>&gt;<i> Graham
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mod_python mailing list
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I>
</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="020785.html">[mod_python] ValueError with Flash 8 FileReference.upload(url)
</A></li>
	<LI>Next message: <A HREF="020788.html">[mod_python] ValueError with Flash 8 FileReference.upload(url)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20787">[ date ]</a>
              <a href="thread.html#20787">[ thread ]</a>
              <a href="subject.html#20787">[ subject ]</a>
              <a href="author.html#20787">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
