<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Output Filters Redeaux
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Output%20Filters%20Redeaux&In-Reply-To=001c01c66241%24075bf0a0%240301a8c0%40uberbox">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020874.html">
   <LINK REL="Next"  HREF="020876.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Output Filters Redeaux</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Nick</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Output%20Filters%20Redeaux&In-Reply-To=001c01c66241%24075bf0a0%240301a8c0%40uberbox"
       TITLE="[mod_python] Output Filters Redeaux">nick at dd.revealed.net
       </A><BR>
    <I>Mon Apr 17 14:46:36 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="020874.html">[mod_python] Output Filters Redeaux
</A></li>
        <LI>Next message: <A HREF="020876.html">[mod_python] Output Filters Redeaux
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20875">[ date ]</a>
              <a href="thread.html#20875">[ thread ]</a>
              <a href="subject.html#20875">[ subject ]</a>
              <a href="author.html#20875">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>An iterator would take care of these kinds of questions internally.
Yielding '' does not signal the last iteration, nor should it according to
your example.  However, None should not be yielded by the iterator, and
would instead raise a StopIteration (or simply fall through to the end of
the __iter__ function, though being in C probably easier to raise
StopInteration).

In other words, you don't need the support code below.  You only need the
for, which will end when None has been returned from the read(), now hidden
in the iterator.

Nick

Lee Brown wrote:
&gt;<i> That's a good question.  I don't know if the filter object is iterable or
</I>&gt;<i> not.
</I>&gt;<i> 
</I>&gt;<i> What's warping my noodle is handling the two different exit conditions in a
</I>&gt;<i> Pythonic way; if the filter returns '' you just want to hibernate but if the
</I>&gt;<i> filter returns None you want to wrap up and get out.  Kinda like this (given
</I>&gt;<i> an iterable filter object):
</I>&gt;<i> 
</I>&gt;<i> for streamlet in filter:
</I>&gt;<i>     if streamlet:
</I>&gt;<i>         streambuffer.write(streamlet)
</I>&gt;<i>     else:
</I>&gt;<i>         break
</I>&gt;<i> If streamlet is None:
</I>&gt;<i>     [proceed with your filter thing]
</I>&gt;<i> 
</I>&gt;<i> To me, this does not seem to be much more Pythonic that the previous version
</I>&gt;<i> - you still have to noodle on it a while to see the flow structure.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Best Regards,
</I>&gt;<i> Lee E. Brown
</I>&gt;<i> (<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">administrator at leebrown.org</A>)
</I>&gt;<i> 
</I>&gt;<i> -----Original Message-----
</I>&gt;<i> From: <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">mod_python-bounces at modpython.org</A>
</I>&gt;<i> [mailto:<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">mod_python-bounces at modpython.org</A>] On Behalf Of Nick
</I>&gt;<i> Sent: Monday, April 17, 2006 12:43 PM
</I>&gt;<i> To: Lee Brown
</I>&gt;<i> Cc: <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">mod_python at modpython.org</A>
</I>&gt;<i> Subject: Re: [mod_python] Output Filters Redeaux
</I>&gt;<i> 
</I>&gt;<i> Great example!  Thanks.
</I>&gt;<i> 
</I>&gt;<i> On a devel note, it looks like the filter object would be very handy if it
</I>&gt;<i> could be treated as in iterator, such as (using the sample code's
</I>&gt;<i> nomenclature):
</I>&gt;<i> 
</I>&gt;<i> for streamlet in filter:
</I>&gt;<i>   [do something with streamlet here]
</I>&gt;<i> 
</I>&gt;<i> It would definitely turn filter writing into something more Pythonic.  Does
</I>&gt;<i> that seem like something that would be useful?
</I>&gt;<i> 
</I>&gt;<i> Thanks,
</I>&gt;<i> Nick
</I>&gt;<i> 
</I>&gt;<i> Lee Brown wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Greetings!
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Just for fun, here is a handy template for constructing Mod Python 
</I>&gt;&gt;<i> output filters:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     from mod_python import apache
</I>&gt;&gt;<i>     from cStringIO import StringIO
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     def outputfilter (filter):
</I>&gt;&gt;<i>            
</I>&gt;&gt;<i>         try:
</I>&gt;&gt;<i>             streambuffer = filter.req.streambuffer
</I>&gt;&gt;<i>         except AttributeError:
</I>&gt;&gt;<i>             filter.req.streambuffer = StringIO() # See Note 1
</I>&gt;&gt;<i>             streambuffer = filter.req.streambuffer
</I>&gt;&gt;<i>                 # See Note 2
</I>&gt;&gt;<i>        
</I>&gt;&gt;<i>         streamlet = filter.read()
</I>&gt;&gt;<i>         while streamlet:
</I>&gt;&gt;<i>                 # See Note 3
</I>&gt;&gt;<i>             streambuffer.write(streamlet)
</I>&gt;&gt;<i>             streamlet = filter.read()
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>         if streamlet is None:
</I>&gt;&gt;<i>                 # See Note 4
</I>&gt;&gt;<i>             filter.write(streambuffer)
</I>&gt;&gt;<i>             filter.close()
</I></PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="020874.html">[mod_python] Output Filters Redeaux
</A></li>
	<LI>Next message: <A HREF="020876.html">[mod_python] Output Filters Redeaux
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20875">[ date ]</a>
              <a href="thread.html#20875">[ thread ]</a>
              <a href="subject.html#20875">[ subject ]</a>
              <a href="author.html#20875">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="DISABLEhttp://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
