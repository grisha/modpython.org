<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Output Filters Redeaux
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Output%20Filters%20Redeaux&In-Reply-To=000601c6623a%24fb743500%240301a8c0%40uberbox">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020869.html">
   <LINK REL="Next"  HREF="020878.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Output Filters Redeaux</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Lee Brown</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Output%20Filters%20Redeaux&In-Reply-To=000601c6623a%24fb743500%240301a8c0%40uberbox"
       TITLE="[mod_python] Output Filters Redeaux">administrator at leebrown.org
       </A><BR>
    <I>Mon Apr 17 12:36:34 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="020869.html">[mod_python] Output Filters Redeaux
</A></li>
        <LI>Next message: <A HREF="020878.html">[mod_python] Output Filters Redeaux
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20870">[ date ]</a>
              <a href="thread.html#20870">[ thread ]</a>
              <a href="subject.html#20870">[ subject ]</a>
              <a href="author.html#20870">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Greetings!
 
This is the code for a Mod Python output filter that performs an XSLT
transform on XML data that I published a few weeks ago.  I've restructured
it as an example application of the filter template:
 
from mod_python import apache
from cStringIO import StringIO
import lxml.etree
import time
 
name = 'LXML'
timestring = 'Time to process XML/XSLT files using %s: %.3f milliseconds (%s
pages per second) [%s pass]\n'
 
xsltfile = open('c:/webdev/sites/crashtest/templates/template.xslt', 'rU')
styledoc = lxml.etree.parse(StringIO(xsltfile.read()))
transformer = lxml.etree.XSLT(styledoc)
xsltfile.close()
 
def outputfilter (filter):
            
    try:
        streambuffer = filter.req.streambuffer
    except AttributeError:
        filter.req.streambuffer = StringIO()
        streambuffer = filter.req.streambuffer
        filter.req.start = time.clock()
        filter.req.passes = 0
        
    streamlet = filter.read()
    while streamlet:
        filter.req.passes += 1
        streambuffer.write(streamlet.replace('\r\n', '\n'))
        streamlet = filter.read()
 
    if streamlet is None:
        doc = lxml.etree.parse(streambuffer)
        doc.xinclude()
        result = str(transformer(doc))
        end = time.clock()
        start = filter.req.start
        passes = filter.req.passes
        ms = (end-start)*1000
        pps = int(1/(end-start))
        timestamp = timestring % (name, ms, pps, passes)
        filter.write(result.replace('benchmark', timestamp))
        filter.close()

 




Best Regards, 
Lee E. Brown 
(<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">leebrown at leebrown.org</A>) 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20060417/e494c7ad/attachment.html">http://mm_cfg_has_not_been_edited_to_set_host_domains/pipermail/mod_python/attachments/20060417/e494c7ad/attachment.html</A>
</PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="020869.html">[mod_python] Output Filters Redeaux
</A></li>
	<LI>Next message: <A HREF="020878.html">[mod_python] Output Filters Redeaux
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20870">[ date ]</a>
              <a href="thread.html#20870">[ thread ]</a>
              <a href="subject.html#20870">[ subject ]</a>
              <a href="author.html#20870">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="DISABLEhttp://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
