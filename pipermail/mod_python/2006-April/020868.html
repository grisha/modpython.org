<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] finding length of user file before uploading
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20finding%20length%20of%20user%20file%20before%20uploading&In-Reply-To=453FC468-3C51-4686-AB35-21BA10560D68%40dscpl.com.au">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020867.html">
   <LINK REL="Next"  HREF="020872.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] finding length of user file before uploading</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20finding%20length%20of%20user%20file%20before%20uploading&In-Reply-To=453FC468-3C51-4686-AB35-21BA10560D68%40dscpl.com.au"
       TITLE="[mod_python] finding length of user file before uploading">grahamd at dscpl.com.au
       </A><BR>
    <I>Fri Apr 14 23:01:04 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="020867.html">[mod_python] finding length of user file before uploading
</A></li>
        <LI>Next message: <A HREF="020872.html">[mod_python] finding length of user file before uploading
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20868">[ date ]</a>
              <a href="thread.html#20868">[ thread ]</a>
              <a href="subject.html#20868">[ subject ]</a>
              <a href="author.html#20868">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On 15/04/2006, at 12:54 PM, Graham Dumpleton wrote:

&gt;<i>
</I>&gt;<i> On 15/04/2006, at 12:36 PM, greg wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> I want a script (PSP preferred, custom handler if need be) that can
</I>&gt;&gt;<i> cancel an upload if the file is too large, or is taking too long.
</I>&gt;&gt;<i> The list archives have a few hacks for custom uploads using:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> 	util.FieldStorage(req, file_callback=FileFactory)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> However, this parameter is not in the official docs, and several
</I>&gt;&gt;<i> previous posters noticed the behaviour breaking between versions.
</I>&gt;&gt;<i> My system is Debian, Apache2, mod_python 3.1.3-3.
</I>&gt;&gt;<i> When I try the file_callback trick, I get:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>   File &quot;/var/www/upload.psp&quot;, line 40, in ?
</I>&gt;&gt;<i>     frm = util.FieldStorage(req, file_callback=make_file)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> TypeError: __init__() got an unexpected keyword argument  
</I>&gt;&gt;<i> 'file_callback'
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I presume that undocumented feature has become extinct in recent  
</I>&gt;&gt;<i> versions.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> And, even if it had worked, it still doesn't relay the size of the
</I>&gt;&gt;<i> file until the transfer is eating time and memory.
</I>&gt;&gt;<i> I would like to avoid making a custom handler that gets the data  
</I>&gt;&gt;<i> directly from the client--it seems like I would re-invent the  
</I>&gt;&gt;<i> wheel. A slower wheel.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> What is the best way to aquire the filesize before the upload starts?
</I>&gt;<i>
</I>&gt;<i> The file_callback and field_callback parameters are new features in
</I>&gt;<i> unreleased 3.2.9 and 3.3.X. That is why you can find them. See
</I>&gt;<i> documentation at:
</I>
Whoops. The file_callback feature is in 3.2.8 source code, but web site
documentation doesn't mention it. The thing I got confused about as only
being in 3.2.9/3.3.X was some more recent performance improvements
to the same code.

Anyway, upgrade from your older 3.1.3 to 3.2.8 and you will have access
to the feature. You will though need to refer to documentation out of
the source code repository.

Graham
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="020867.html">[mod_python] finding length of user file before uploading
</A></li>
	<LI>Next message: <A HREF="020872.html">[mod_python] finding length of user file before uploading
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20868">[ date ]</a>
              <a href="thread.html#20868">[ thread ]</a>
              <a href="subject.html#20868">[ subject ]</a>
              <a href="author.html#20868">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
