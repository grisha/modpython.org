<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] ValueError with Flash 8 FileReference.upload(url)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20ValueError%20with%20Flash%208%20FileReference.upload%28url%29&In-Reply-To=1144220284.6391%40dscpl.user.openhosting.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020781.html">
   <LINK REL="Next"  HREF="020783.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] ValueError with Flash 8 FileReference.upload(url)</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20ValueError%20with%20Flash%208%20FileReference.upload%28url%29&In-Reply-To=1144220284.6391%40dscpl.user.openhosting.com"
       TITLE="[mod_python] ValueError with Flash 8 FileReference.upload(url)">grahamd at dscpl.com.au
       </A><BR>
    <I>Wed Apr  5 05:58:30 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="020781.html">[mod_python] ValueError with Flash 8 FileReference.upload(url)
</A></li>
        <LI>Next message: <A HREF="020783.html">[mod_python] ValueError with Flash 8 FileReference.upload(url)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20782">[ date ]</a>
              <a href="thread.html#20782">[ thread ]</a>
              <a href="subject.html#20782">[ subject ]</a>
              <a href="author.html#20782">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Sending the swf file as you did in other email isn't probably of any  
use.
We need to get what is actually received by the handler itself so we
can send that through the util.FieldStorage class to test it. This is  
what
the handler I sent below was about. Note though the small change I
marked against the code below. Don't forget to change the save path to
something meaningful.

Put the code in a file called grabinput.py in your directory:

   c:/Program Files/Apache Group/Apache2/htdocs/python

and change:

   PythonHandler mod_python.publisher

to:

   PythonHandler grabinput

in your config.

It is the file that the upload data is saved into that we would need not
the original swf file.

Graham

On 05/04/2006, at 4:58 PM, Graham Dumpleton wrote:

&gt;<i> Harold J. Ship wrote ..
</I>&gt;&gt;<i> Do you want an ethereal dump, or the flash program that generates
</I>&gt;&gt;<i> requests?
</I>&gt;<i>
</I>&gt;<i> Write a basic handler which does something like:
</I>&gt;<i>
</I>&gt;<i> from mod_python import apache
</I>&gt;<i>
</I>&gt;<i> def handler(req):
</I>&gt;<i>
</I>&gt;<i>     data = open(&quot;/some/path/post.dat&quot;, &quot;w&quot;)
</I>
This possible should be:

        data = open(&quot;/some/path/post.dat&quot;, &quot;wb&quot;)

Ie., use binary mode to ensure that \r\n sequences are maintained as is.
This may not be an issue on Win32, but might be still good to do it.

&gt;<i>     data.write(req.read())
</I>&gt;<i>     data.close()
</I>&gt;<i>
</I>&gt;<i>     req.content_type = 'text/plain'
</I>&gt;<i>     req.write(&quot;Done&quot;)
</I>&gt;<i>
</I>&gt;<i>     return apache.OK
</I>&gt;<i>
</I>&gt;<i> Have your post program post to URL that maps to that handler.
</I>&gt;<i>
</I>&gt;<i> This way it captures exactly what was sent in request and what
</I>&gt;<i> util.FieldStorage will consume and people can experiment.
</I>&gt;<i>
</I>&gt;<i> Just make sure any actual data posted is small. Add it as an
</I>&gt;<i> attachment to your mail.
</I>&gt;<i>
</I>&gt;<i> Graham
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;&gt;<i> -----Original Message-----
</I>&gt;&gt;<i> From: Graham Dumpleton [mailto:<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">grahamd at dscpl.com.au</A>]
</I>&gt;&gt;<i> Sent: Wednesday, April 05, 2006 8:12 AM
</I>&gt;&gt;<i> To: Harold J. Ship
</I>&gt;&gt;<i> Cc: <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">mod_python at modpython.org</A>
</I>&gt;&gt;<i> Subject: Re: [mod_python] ValueError with Flash 8
</I>&gt;&gt;<i> FileReference.upload(url)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Can you supply an example request body which has the actual data  
</I>&gt;&gt;<i> removed
</I>&gt;&gt;<i> but preserves the header lines you mention as being a potential  
</I>&gt;&gt;<i> issue?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Thanks.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Graham
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Harold J. Ship wrote ..
</I>&gt;&gt;&gt;<i> Attempting to upload a file using Flash 8 FileReference.upload(url)
</I>&gt;&gt;&gt;<i> causes a ValueError at line 173 of util.py.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Windows XP
</I>&gt;&gt;&gt;<i> Apache 2.0.54
</I>&gt;&gt;&gt;<i> mod_python 3.2.8
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> From httpd.conf:
</I>&gt;&gt;&gt;<i> &lt;VirtualHost *:8020&gt;
</I>&gt;&gt;&gt;<i>     ServerName python
</I>&gt;&gt;&gt;<i>     DocumentRoot &quot;c:/Program Files/Apache Group/Apache2/htdocs/ 
</I>&gt;&gt;&gt;<i> python&quot;
</I>&gt;&gt;&gt;<i>     &lt;Directory &quot;c:/Program Files/Apache Group/Apache2/htdocs/ 
</I>&gt;&gt;&gt;<i> python&quot;&gt;
</I>&gt;&gt;&gt;<i>         AddHandler mod_python .py
</I>&gt;&gt;&gt;<i>         PythonHandler deko_publisher
</I>&gt;&gt;&gt;<i>         PythonDebug Off
</I>&gt;&gt;&gt;<i>         RewriteEngine On
</I>&gt;&gt;&gt;<i>         RewriteRule ^$ ^$ [F]
</I>&gt;&gt;&gt;<i>         RewriteCond %{REQUEST_FILENAME} !-f
</I>&gt;&gt;&gt;<i>         RewriteRule ^(\w+)/(.*)$ $1.py/$2 [QSA,L]
</I>&gt;&gt;&gt;<i>         ErrorDocument 500 &quot;&lt;h2&gt;Application error&lt;/h2&gt;Problem with
</I>&gt;&gt;&gt;<i> Python Setup&quot;
</I>&gt;&gt;&gt;<i>     &lt;/Directory&gt;
</I>&gt;&gt;&gt;<i> &lt;/VirtualHost&gt;
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> deko_publisher is my own handler that delegates to
</I>&gt;&gt;&gt;<i> mod_python.publisher
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> It seems that the HTTP request has some header lines that aren't of
</I>&gt;&gt;&gt;<i> the form &quot;Name: value&quot; such as file boundaries.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> From error.log:
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> [Mon Apr 03 12:05:40 2006] [INFO] WebPython deko_publisher.py:17  
</I>&gt;&gt;&gt;<i> about
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> to run uploadFoo [Mon Apr 03 12:05:40 2006] [error] [client  
</I>&gt;&gt;&gt;<i> 127.0.0.1]
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> PythonHandler
</I>&gt;&gt;&gt;<i> deko_publisher: Traceback (most recent call last):
</I>&gt;&gt;&gt;<i> [Mon Apr 03 12:05:40 2006] [error] [client 127.0.0.1] PythonHandler
</I>&gt;&gt;&gt;<i> deko_publisher:   File
</I>&gt;&gt;&gt;<i> &quot;C:\\Python23\\Lib\\site-packages\\mod_python\\apache.py&quot;, line 299,
</I>&gt;&gt;<i> in
</I>&gt;&gt;&gt;<i> HandlerDispatch\n    result = object(req)
</I>&gt;&gt;&gt;<i> [Mon Apr 03 12:05:41 2006] [error] [client 127.0.0.1] PythonHandler
</I>&gt;&gt;&gt;<i> deko_publisher:   File &quot;C:/Program Files/Apache
</I>&gt;&gt;&gt;<i> Group/Apache2/htdocs/python/deko_publisher.py&quot;, line 18, in  
</I>&gt;&gt;&gt;<i> handler\n
</I>&gt;&gt;&gt;<i> return apache.handler(req) [Mon Apr 03 12:05:41 2006] [error]  
</I>&gt;&gt;&gt;<i> [client
</I>&gt;&gt;&gt;<i> 127.0.0.1] PythonHandler
</I>&gt;&gt;&gt;<i> deko_publisher:   File
</I>&gt;&gt;&gt;<i> &quot;C:\\Python23\\Lib\\site-packages\\mod_python\\publisher.py&quot;, line
</I>&gt;&gt;<i> 213,
</I>&gt;&gt;&gt;<i> in handler\n    published = publish_object(req, object)
</I>&gt;&gt;&gt;<i> [Mon Apr 03 12:05:41 2006] [error] [client 127.0.0.1] PythonHandler
</I>&gt;&gt;&gt;<i> deko_publisher:   File
</I>&gt;&gt;&gt;<i> &quot;C:\\Python23\\Lib\\site-packages\\mod_python\\publisher.py&quot;, line
</I>&gt;&gt;<i> 411,
</I>&gt;&gt;&gt;<i> in publish_object\n    req.form = util.FieldStorage(req,
</I>&gt;&gt;&gt;<i> keep_blank_values=1)
</I>&gt;&gt;&gt;<i> [Mon Apr 03 12:05:41 2006] [error] [client 127.0.0.1] PythonHandler
</I>&gt;&gt;&gt;<i> deko_publisher:   File
</I>&gt;&gt;&gt;<i> &quot;C:\\Python23\\Lib\\site-packages\\mod_python\\util.py&quot;, line  
</I>&gt;&gt;&gt;<i> 173, in
</I>&gt;&gt;&gt;<i> __init__\n    h, v = line.split(&quot;:&quot;, 1)
</I>&gt;&gt;&gt;<i> [Mon Apr 03 12:05:41 2006] [error] [client 127.0.0.1] PythonHandler
</I>&gt;&gt;&gt;<i> deko_publisher: ValueError: unpack list of wrong size
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> util.py (lines 169-175):
</I>&gt;&gt;&gt;<i>            while line not in ('\r','\r\n'):
</I>&gt;&gt;&gt;<i>                # we read the headers until we reach an empty line
</I>&gt;&gt;&gt;<i>                # NOTE : a single \n would mean the entity is
</I>&gt;&gt;&gt;<i> malformed, but
</I>&gt;&gt;&gt;<i>                # we're tolerating it anyway
</I>&gt;&gt;&gt;<i>                h, v = line.split(&quot;:&quot;, 1)
</I>&gt;&gt;&gt;<i>                headers.add(h, v)
</I>&gt;&gt;&gt;<i>                h = h.lower()
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> proposed change:
</I>&gt;&gt;&gt;<i>            while line not in ('\r','\r\n'):
</I>&gt;&gt;&gt;<i>                # we read the headers until we reach an empty line
</I>&gt;&gt;&gt;<i>                # NOTE : a single \n would mean the entity is
</I>&gt;&gt;&gt;<i> malformed, but
</I>&gt;&gt;&gt;<i>                # we're tolerating it anyway
</I>&gt;&gt;&gt;<i>                try:
</I>&gt;&gt;&gt;<i>                   h, v = line.split(&quot;:&quot;, 1)
</I>&gt;&gt;&gt;<i>                except ValueError:
</I>&gt;&gt;&gt;<i>                   h, v = &quot;&quot;, &quot;&quot;
</I>&gt;&gt;&gt;<i>                headers.add(h, v)
</I>&gt;&gt;&gt;<i>                h = h.lower()
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Harold Ship
</I>&gt;&gt;&gt;<i> Giant Steps Networks
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;&gt;<i> Mod_python mailing list
</I>&gt;&gt;&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;&gt;&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mod_python mailing list
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I>
</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="020781.html">[mod_python] ValueError with Flash 8 FileReference.upload(url)
</A></li>
	<LI>Next message: <A HREF="020783.html">[mod_python] ValueError with Flash 8 FileReference.upload(url)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20782">[ date ]</a>
              <a href="thread.html#20782">[ thread ]</a>
              <a href="subject.html#20782">[ subject ]</a>
              <a href="author.html#20782">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
