<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] PythonAuthzHandler not working
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20PythonAuthzHandler%20not%20working&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020968.html">
   <LINK REL="Next"  HREF="020970.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] PythonAuthzHandler not working</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20PythonAuthzHandler%20not%20working&In-Reply-To="
       TITLE="[mod_python] PythonAuthzHandler not working">grahamd at dscpl.com.au
       </A><BR>
    <I>Sun Apr 23 23:50:28 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="020968.html">&amp;nbsp;[mod_python]&amp;nbsp;session&amp;nb
 sp;lock
</A></li>
        <LI>Next message: <A HREF="020970.html">&amp;nbsp;[mod_python]&amp;nbsp;session&amp;nbsp;lock
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20969">[ date ]</a>
              <a href="thread.html#20969">[ thread ]</a>
              <a href="subject.html#20969">[ subject ]</a>
              <a href="author.html#20969">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Jim Gallacher wrote ..
&gt;<i> Ultimately however it seems to me there is a bug in mod_python.c related
</I>&gt;<i> to the whole AuthAthoritative business. Consider the following code 
</I>&gt;<i> pulled from the python_handler function. (mod_python.c line 1412 
</I>&gt;<i> revision 396250):
</I>&gt;<i> 
</I>&gt;<i>     if (strcmp(phase, &quot;PythonAuthenHandler&quot;) == 0) {
</I>&gt;<i>           ... snip ...
</I>&gt;<i> 
</I>&gt;<i>           if (result == HTTP_UNAUTHORIZED)
</I>&gt;<i>           {
</I>&gt;<i>                if   (! conf-&gt;authoritative)
</I>&gt;<i>                      result = DECLINED;
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> conf-&gt;authoritative is initialized to 1, but we don't have an Apache 
</I>&gt;<i> directive to set the value. I wonder if the assumption was that this was
</I>&gt;<i> set by AuthAuthoritative, or if it there was an oversight in not adding
</I>&gt;<i> a new directive? Either way it's a bug. Mod_python should not concern 
</I>&gt;<i> itself with AuthAuthoritative, as that is for use by mod_auth, so we 
</I>&gt;<i> really need our on directive.
</I>&gt;<i> 
</I>&gt;<i> As confirmation I modified python_handler to log conf-&gt;authoritative and
</I>&gt;<i> indeed it's value is unaffected by the AuthAthoritative setting. In it's
</I>&gt;<i> current state, PythonAuthenHander will *always* be authoritative.
</I>&gt;<i> 
</I>&gt;<i> Other mod_auth_* modules define their own  authoritative directives, for
</I>&gt;<i> example: AuthDBMAuthoritative, AuthLDAPAuthoritative, 
</I>&gt;<i> AuthMySQLAuthoritative and Anonymous_Authoritative. Following the most
</I>&gt;<i> common pattern I would suggest we add AuthPythonAuthoritative.
</I>&gt;<i> 
</I>&gt;<i> This issue may also be important to 
</I>&gt;<i> <A HREF="http://issues.apache.org/jira/browse/MODPYTHON-129">http://issues.apache.org/jira/browse/MODPYTHON-129</A>
</I>
I've noted the PythonAuthenHandler code in python_handler many times and
although I need to go back and look at it again I have been thinking
that that section of code may possibly be partly bogus and shouldn't be
in there. The warning message about req.user not being set is possibly
helpful, but why should mod_python be making a decision to change an
unauthorized response back to a declined and why should it be generating
a WWW-Authenticate header with an assumption that Basic authorisation
is being used when it may well not be. What is going to happen if I write
an authenhandler for Digest authentication and it returns unauthorised,
mod_python will obliterate any WWW-Authenticate header I may have
placed there specific to Digest authentication.

Thus I don't necessarily think it is a case of amending it some way, it
may be a case of obliterating it and make people do the correct thing
in their handlers to begin with rather than providing a crutch to fix their
omissions. This may mean adding means of calling further auth related
functions through the req object if there is something missing now,
such as access to ap_note_basic_auth_failure().

Graham
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="020968.html">&amp;nbsp;[mod_python]&amp;nbsp;session&amp;nb
 sp;lock
</A></li>
	<LI>Next message: <A HREF="020970.html">&amp;nbsp;[mod_python]&amp;nbsp;session&amp;nbsp;lock
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20969">[ date ]</a>
              <a href="thread.html#20969">[ thread ]</a>
              <a href="subject.html#20969">[ subject ]</a>
              <a href="author.html#20969">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="DISABLEhttp://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
