<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] ValueError with Flash 8 FileReference.upload(url)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20ValueError%20with%20Flash%208%20FileReference.upload%28url%29&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020779.html">
   <LINK REL="Next"  HREF="020782.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] ValueError with Flash 8 FileReference.upload(url)</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20ValueError%20with%20Flash%208%20FileReference.upload%28url%29&In-Reply-To="
       TITLE="[mod_python] ValueError with Flash 8 FileReference.upload(url)">grahamd at dscpl.com.au
       </A><BR>
    <I>Wed Apr  5 02:58:04 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="020779.html">[mod_python] ValueError with Flash 8 FileReference.upload(url)
</A></li>
        <LI>Next message: <A HREF="020782.html">[mod_python] ValueError with Flash 8 FileReference.upload(url)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20781">[ date ]</a>
              <a href="thread.html#20781">[ thread ]</a>
              <a href="subject.html#20781">[ subject ]</a>
              <a href="author.html#20781">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Harold J. Ship wrote ..
&gt;<i> Do you want an ethereal dump, or the flash program that generates
</I>&gt;<i> requests? 
</I>
Write a basic handler which does something like:

from mod_python import apache

def handler(req):

    data = open(&quot;/some/path/post.dat&quot;, &quot;w&quot;)
    data.write(req.read())
    data.close()

    req.content_type = 'text/plain'
    req.write(&quot;Done&quot;)

    return apache.OK

Have your post program post to URL that maps to that handler.

This way it captures exactly what was sent in request and what
util.FieldStorage will consume and people can experiment.

Just make sure any actual data posted is small. Add it as an
attachment to your mail.

Graham



&gt;<i> -----Original Message-----
</I>&gt;<i> From: Graham Dumpleton [mailto:<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">grahamd at dscpl.com.au</A>] 
</I>&gt;<i> Sent: Wednesday, April 05, 2006 8:12 AM
</I>&gt;<i> To: Harold J. Ship
</I>&gt;<i> Cc: <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">mod_python at modpython.org</A>
</I>&gt;<i> Subject: Re: [mod_python] ValueError with Flash 8
</I>&gt;<i> FileReference.upload(url)
</I>&gt;<i> 
</I>&gt;<i> Can you supply an example request body which has the actual data removed
</I>&gt;<i> but preserves the header lines you mention as being a potential issue?
</I>&gt;<i> 
</I>&gt;<i> Thanks.
</I>&gt;<i> 
</I>&gt;<i> Graham
</I>&gt;<i> 
</I>&gt;<i> Harold J. Ship wrote ..
</I>&gt;<i> &gt; Attempting to upload a file using Flash 8 FileReference.upload(url) 
</I>&gt;<i> &gt; causes a ValueError at line 173 of util.py.
</I>&gt;<i> &gt;  
</I>&gt;<i> &gt; Windows XP
</I>&gt;<i> &gt; Apache 2.0.54
</I>&gt;<i> &gt; mod_python 3.2.8
</I>&gt;<i> &gt;  
</I>&gt;<i> &gt; &gt;From httpd.conf:
</I>&gt;<i> &gt; &lt;VirtualHost *:8020&gt;
</I>&gt;<i> &gt;     ServerName python
</I>&gt;<i> &gt;     DocumentRoot &quot;c:/Program Files/Apache Group/Apache2/htdocs/python&quot;
</I>&gt;<i> &gt;     &lt;Directory &quot;c:/Program Files/Apache Group/Apache2/htdocs/python&quot;&gt;
</I>&gt;<i> &gt;         AddHandler mod_python .py
</I>&gt;<i> &gt;         PythonHandler deko_publisher
</I>&gt;<i> &gt;         PythonDebug Off
</I>&gt;<i> &gt;         RewriteEngine On
</I>&gt;<i> &gt;         RewriteRule ^$ ^$ [F]
</I>&gt;<i> &gt;         RewriteCond %{REQUEST_FILENAME} !-f
</I>&gt;<i> &gt;         RewriteRule ^(\w+)/(.*)$ $1.py/$2 [QSA,L]
</I>&gt;<i> &gt;         ErrorDocument 500 &quot;&lt;h2&gt;Application error&lt;/h2&gt;Problem with 
</I>&gt;<i> &gt; Python Setup&quot;
</I>&gt;<i> &gt;     &lt;/Directory&gt;
</I>&gt;<i> &gt; &lt;/VirtualHost&gt;
</I>&gt;<i> &gt;  
</I>&gt;<i> &gt; deko_publisher is my own handler that delegates to 
</I>&gt;<i> &gt; mod_python.publisher
</I>&gt;<i> &gt;  
</I>&gt;<i> &gt; It seems that the HTTP request has some header lines that aren't of 
</I>&gt;<i> &gt; the form &quot;Name: value&quot; such as file boundaries.
</I>&gt;<i> &gt;  
</I>&gt;<i> &gt; &gt;From error.log:
</I>&gt;<i> &gt;  
</I>&gt;<i> &gt; [Mon Apr 03 12:05:40 2006] [INFO] WebPython deko_publisher.py:17 about
</I>&gt;<i> 
</I>&gt;<i> &gt; to run uploadFoo [Mon Apr 03 12:05:40 2006] [error] [client 127.0.0.1]
</I>&gt;<i> 
</I>&gt;<i> &gt; PythonHandler
</I>&gt;<i> &gt; deko_publisher: Traceback (most recent call last):
</I>&gt;<i> &gt; [Mon Apr 03 12:05:40 2006] [error] [client 127.0.0.1] PythonHandler
</I>&gt;<i> &gt; deko_publisher:   File
</I>&gt;<i> &gt; &quot;C:\\Python23\\Lib\\site-packages\\mod_python\\apache.py&quot;, line 299,
</I>&gt;<i> in
</I>&gt;<i> &gt; HandlerDispatch\n    result = object(req)
</I>&gt;<i> &gt; [Mon Apr 03 12:05:41 2006] [error] [client 127.0.0.1] PythonHandler
</I>&gt;<i> &gt; deko_publisher:   File &quot;C:/Program Files/Apache
</I>&gt;<i> &gt; Group/Apache2/htdocs/python/deko_publisher.py&quot;, line 18, in handler\n
</I>&gt;<i> &gt; return apache.handler(req) [Mon Apr 03 12:05:41 2006] [error] [client
</I>&gt;<i> &gt; 127.0.0.1] PythonHandler
</I>&gt;<i> &gt; deko_publisher:   File
</I>&gt;<i> &gt; &quot;C:\\Python23\\Lib\\site-packages\\mod_python\\publisher.py&quot;, line
</I>&gt;<i> 213,
</I>&gt;<i> &gt; in handler\n    published = publish_object(req, object)
</I>&gt;<i> &gt; [Mon Apr 03 12:05:41 2006] [error] [client 127.0.0.1] PythonHandler
</I>&gt;<i> &gt; deko_publisher:   File
</I>&gt;<i> &gt; &quot;C:\\Python23\\Lib\\site-packages\\mod_python\\publisher.py&quot;, line
</I>&gt;<i> 411,
</I>&gt;<i> &gt; in publish_object\n    req.form = util.FieldStorage(req,
</I>&gt;<i> &gt; keep_blank_values=1)
</I>&gt;<i> &gt; [Mon Apr 03 12:05:41 2006] [error] [client 127.0.0.1] PythonHandler
</I>&gt;<i> &gt; deko_publisher:   File
</I>&gt;<i> &gt; &quot;C:\\Python23\\Lib\\site-packages\\mod_python\\util.py&quot;, line 173, in
</I>&gt;<i> &gt; __init__\n    h, v = line.split(&quot;:&quot;, 1)
</I>&gt;<i> &gt; [Mon Apr 03 12:05:41 2006] [error] [client 127.0.0.1] PythonHandler
</I>&gt;<i> &gt; deko_publisher: ValueError: unpack list of wrong size
</I>&gt;<i> &gt;  
</I>&gt;<i> &gt; util.py (lines 169-175):
</I>&gt;<i> &gt;            while line not in ('\r','\r\n'):
</I>&gt;<i> &gt;                # we read the headers until we reach an empty line
</I>&gt;<i> &gt;                # NOTE : a single \n would mean the entity is 
</I>&gt;<i> &gt; malformed, but
</I>&gt;<i> &gt;                # we're tolerating it anyway
</I>&gt;<i> &gt;                h, v = line.split(&quot;:&quot;, 1)
</I>&gt;<i> &gt;                headers.add(h, v)
</I>&gt;<i> &gt;                h = h.lower()
</I>&gt;<i> &gt;  
</I>&gt;<i> &gt; proposed change:
</I>&gt;<i> &gt;            while line not in ('\r','\r\n'):
</I>&gt;<i> &gt;                # we read the headers until we reach an empty line
</I>&gt;<i> &gt;                # NOTE : a single \n would mean the entity is 
</I>&gt;<i> &gt; malformed, but
</I>&gt;<i> &gt;                # we're tolerating it anyway
</I>&gt;<i> &gt;                try:
</I>&gt;<i> &gt;                   h, v = line.split(&quot;:&quot;, 1)
</I>&gt;<i> &gt;                except ValueError:
</I>&gt;<i> &gt;                   h, v = &quot;&quot;, &quot;&quot;
</I>&gt;<i> &gt;                headers.add(h, v)
</I>&gt;<i> &gt;                h = h.lower()
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt;  
</I>&gt;<i> &gt;  
</I>&gt;<i> &gt; Harold Ship
</I>&gt;<i> &gt; Giant Steps Networks
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; _______________________________________________
</I>&gt;<i> &gt; Mod_python mailing list
</I>&gt;<i> &gt; <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;<i> &gt; <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I></PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="020779.html">[mod_python] ValueError with Flash 8 FileReference.upload(url)
</A></li>
	<LI>Next message: <A HREF="020782.html">[mod_python] ValueError with Flash 8 FileReference.upload(url)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20781">[ date ]</a>
              <a href="thread.html#20781">[ thread ]</a>
              <a href="subject.html#20781">[ subject ]</a>
              <a href="author.html#20781">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="DISABLEhttp://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
