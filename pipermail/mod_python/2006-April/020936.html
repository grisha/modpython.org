<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] The new module loader
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20The%20new%20module%20loader&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="020955.html">
   <LINK REL="Next"  HREF="020938.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] The new module loader</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20The%20new%20module%20loader&In-Reply-To="
       TITLE="[mod_python] The new module loader">grahamd at dscpl.com.au
       </A><BR>
    <I>Fri Apr 21 03:01:31 EDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="020955.html">[mod_python] The new module loader
</A></li>
        <LI>Next message: <A HREF="020938.html">[mod_python] ValueError with Flash 8 FileReference.upload(url)  
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20936">[ date ]</a>
              <a href="thread.html#20936">[ thread ]</a>
              <a href="subject.html#20936">[ subject ]</a>
              <a href="author.html#20936">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Dan Eloff wrote ..
&gt;<i> Thanks a bundle Graham, I get the gist of it. Tomorrow I'll back everything
</I>&gt;<i> up and then start reworking it with all that in mind. Much appreciated.
</I>&gt;<i> The
</I>&gt;<i> pyserver stuff wasn't being reloaded because it's in site-packages, and
</I>&gt;<i> the
</I>&gt;<i> rest of the stuff was being loaded *AFTER* being placed in sys.path. I
</I>&gt;<i> did a
</I>&gt;<i> pretty good job of shooting myself in the foot there. I'll fix it all up
</I>&gt;<i> and
</I>&gt;<i> give it another go and let you know what happens.
</I>&gt;<i> 
</I>&gt;<i> You're right about the packages too, other than as a namespace and for
</I>&gt;<i> convenience, I don't need it, and it makes more sense for it to live
</I>&gt;<i> elsewhere. You put an awful lot of thought into this, I think it will be
</I>&gt;<i> the
</I>&gt;<i> death of all those auto reload woes.
</I>
If you are going to go off and restructure your code, I'll let you know of
one more thing that may be useful.

When you use apache.import_module(), like the directive in the Apache
configuration, you can use an absolute pathname instead of a straight
module name.

  mystuff1 = apache.import_module(&quot;/some/path/mystuff1.py&quot;)

Also, within a module managed by the new importer, as well as being
able to say:

  import mystuff2

or:

  mystuff2 = apache.import_module(&quot;mystuff2&quot;)

to get &quot;mystuff2&quot; from the same directory, you can also say:

  mystuff2 = apache.import_module(&quot;./mystuff2.py&quot;)

When using an absolute path or relative path, the file doesn't even
strictly need to have a .py extension. For example, if someone
wanted to rewrite high level dispatcher for mpservlets framework
to use new importer, they could use:

  servlet = apache.import_module(&quot;/some/path/servlet.mps&quot;)

Unless you have a good reason, I would suggest sticking with .py
extension.

You might perhaps see the next step from &quot;./&quot; above and that is that
relative paths in general work. Thus, to get module from a subdir
you can use:

  subdir_mystuff3 = apache.import_module(&quot;./subdir/mystuff3.py&quot;)

The &quot;./&quot; is important, you can't just have &quot;subdir/...&quot; it will not work
and will take it as a normal module import rather than a relative path.

Finally, if need be, you can say:

  parentdir_mystuff4 = apache.import_module(&quot;../parent/mystuff4.py&quot;)

This relative path importing should be sufficient to replace any of the
inter package imports used with a package.

BTW, if you stumble across &quot;~/...&quot; in source code of importer, ignore it
and do not try and use it. Originally I saw it as a useful shortcut, but I
now see problems with it, so it is going to go away.

Graham

&gt;<i> On 4/20/06, Graham Dumpleton &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">grahamd at dscpl.com.au</A>&gt; wrote:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Graham Dumpleton wrote ..
</I>&gt;<i> &gt; &gt; Dan Eloff wrote ..
</I>&gt;<i> &gt; &gt; &gt; &lt;Directory /&gt;
</I>&gt;<i> &gt; &gt; &gt;     SetHandler mod_python
</I>&gt;<i> &gt; &gt; &gt;     PythonHandler PyServer.pyserver
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; The new module importer completely ignores packages as it is practically
</I>&gt;<i> &gt; &gt; impossible to get any form of automatic module reloading to work
</I>&gt;<i> &gt; &gt; correctly with them when they are more than trivial. As such, packages
</I>&gt;<i> &gt; &gt; are handed off to standard Python __import__ to deal with. That it
</I>&gt;<i> even
</I>&gt;<i> &gt; &gt; finds the package means that you have it installed in sys.path. Even
</I>&gt;<i> if
</I>&gt;<i> &gt; &gt; it was a file based module, because it is on sys.path and thus likely
</I>&gt;<i> to
</I>&gt;<i> &gt; &gt; be installed in a standard location, the new module importer would
</I>&gt;<i> again
</I>&gt;<i> &gt; &gt; ignore it as it leaves all sys.path modules up to Python __import__
</I>&gt;<i> &gt; &gt; as too dangerous to be mixing importing schemes.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; Anyway, that all only applies if you were expecting PyServer.pyserver
</I>&gt;<i> to
</I>&gt;<i> &gt; &gt; automatically reload upon changes.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; BTW, that something outside of the document tree, possibly in sys.path,
</I>&gt;<i> &gt; is dealt with by Python __import__ doesn't mean you can't have module
</I>&gt;<i> &gt; reloading on stuff outside of the document tree. The idea is that if
</I>&gt;<i> it is
</I>&gt;<i> &gt; part of the web application and needs to be reloadable, that it doesn't
</I>&gt;<i> &gt; really belong in standard Python directories anyway. People only install
</I>&gt;<i> &gt; it there at present because it is convenient.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; The better way of dealing with this with the new module importer is to
</I>&gt;<i> &gt; put your web application modules elsewhere, ie., not on sys.path. You
</I>&gt;<i> then
</I>&gt;<i> &gt; specify an absolute path to the actual .py file in the handler directive.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; &lt;Directory /&gt;
</I>&gt;<i> &gt;      SetHandler mod_python
</I>&gt;<i> &gt;      PythonHandler /path/to/web/application/PyServer/pserver.py
</I>&gt;<i> &gt;      ...
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Most cases I have seen is that people use packages purely to create a
</I>&gt;<i> &gt; namespace to group the modules. With the new module importer that
</I>&gt;<i> &gt; doesn't really need to be done anymore. That is because you can
</I>&gt;<i> &gt; directly reference an arbitrary module by its path. When you use the
</I>&gt;<i> &gt; &quot;import&quot; statement in files in that directory, one of the places it will
</I>&gt;<i> &gt; automatically look, without that directory needing to be in sys.path,
</I>&gt;<i> &gt; is the same directory the file is in. This achieves the same result as
</I>&gt;<i> &gt; what people are using packages for now but you can still have module
</I>&gt;<i> &gt; reloading work.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; If you need a working example of this let me know.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Graham
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;
</I></PRE>























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="020955.html">[mod_python] The new module loader
</A></li>
	<LI>Next message: <A HREF="020938.html">[mod_python] ValueError with Flash 8 FileReference.upload(url)  
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#20936">[ date ]</a>
              <a href="thread.html#20936">[ thread ]</a>
              <a href="subject.html#20936">[ subject ]</a>
              <a href="author.html#20936">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
