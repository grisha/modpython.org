<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Session unable to acquire mutex lock?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Session%20unable%20to%20acquire%20mutex%20lock%3F&In-Reply-To=200312271944.55425.RussLear314%40yahoo.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="014701.html">
   <LINK REL="Next"  HREF="014705.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Session unable to acquire mutex lock?</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Gregory (Grisha) Trubetskoy</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Session%20unable%20to%20acquire%20mutex%20lock%3F&In-Reply-To=200312271944.55425.RussLear314%40yahoo.com"
       TITLE="[mod_python] Session unable to acquire mutex lock?">grisha at modpython.org
       </A><BR>
    <I>Sun Dec 28 13:28:12 EST 2003</I>
    <P><UL>
        <LI>Previous message: <A HREF="014701.html">[mod_python] Session unable to acquire mutex lock?
</A></li>
        <LI>Next message: <A HREF="014705.html">[mod_python] Session unable to acquire mutex lock?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14703">[ date ]</a>
              <a href="thread.html#14703">[ thread ]</a>
              <a href="subject.html#14703">[ subject ]</a>
              <a href="author.html#14703">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
If you restart the server, and try this code, does the error happen on the
first hit, or only starting with the second and after waiting for a while?

If if it's the former, then there probably is some problem with locking in
general (are there any warning messages on server startup?). If it's
latter, then the session does not get unlocked properly. It should get
unlocked when the sess object goes out of scope (and looking at your code
it should), but perhpas try unlocking it manually (sess.unlock()) and see
if this fixes the problem.

Grisha

On Sat, 27 Dec 2003, Russell Lear wrote:

&gt;<i> Hi,
</I>&gt;<i>
</I>&gt;<i> I'm a newbie to mod_python so forgive me if this is a terribly obvious
</I>&gt;<i> question (I've looked through the archives without much success).
</I>&gt;<i>
</I>&gt;<i> I'm trying to use sessions.  Right now I have a slightly modified version
</I>&gt;<i> of mptest.py as follows (it doesn't make sense, but it does show my
</I>&gt;<i> problem):
</I>&gt;<i>
</I>&gt;<i>     from mod_python import apache, Session
</I>&gt;<i>     import sys
</I>&gt;<i>
</I>&gt;<i>     def handler(req):
</I>&gt;<i>         req.content_type = 'text/plain'
</I>&gt;<i>         req.write(&quot;Creating...\n&quot;)
</I>&gt;<i>         sess = Session.Session(req)
</I>&gt;<i>         req.write(&quot;Hello World!&quot;)
</I>&gt;<i>         return apache.OK
</I>&gt;<i>
</I>&gt;<i> When I run it, I see:
</I>&gt;<i>
</I>&gt;<i>      Mod_python error: &quot;PythonHandler mptest&quot;
</I>&gt;<i>
</I>&gt;<i>      Traceback (most recent call last):
</I>&gt;<i>
</I>&gt;<i>        File &quot;/usr/lib/python2.3/site-packages/mod_python/apache.py&quot;, line 338, in HandlerDispatch
</I>&gt;<i>          result = object(req)
</I>&gt;<i>
</I>&gt;<i>        File &quot;/srv/www/htdocs/test/mptest.py&quot;, line 7, in handler
</I>&gt;<i>          sess = Session.Session(req)
</I>&gt;<i>
</I>&gt;<i>        File &quot;/usr/lib/python2.3/site-packages/mod_python/Session.py&quot;, line 411, in Session
</I>&gt;<i>          timeout=timeout)
</I>&gt;<i>
</I>&gt;<i>        File &quot;/usr/lib/python2.3/site-packages/mod_python/Session.py&quot;, line 316, in __init__
</I>&gt;<i>          secret=secret, timeout=timeout)
</I>&gt;<i>
</I>&gt;<i>        File &quot;/usr/lib/python2.3/site-packages/mod_python/Session.py&quot;, line 170, in __init__
</I>&gt;<i>          self.lock()                 # lock new sid
</I>&gt;<i>
</I>&gt;<i>        File &quot;/usr/lib/python2.3/site-packages/mod_python/Session.py&quot;, line 241, in lock
</I>&gt;<i>          _apache._global_lock(self._req.server, self._sid)
</I>&gt;<i>
</I>&gt;<i>      ValueError: Failed to acquire global mutex lock
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> What am I doing wrong here?!
</I>&gt;<i>
</I>&gt;<i> Thanks for any suggestions,
</I>&gt;<i> Russell.
</I>&gt;<i>
</I>&gt;<i> PS:
</I>&gt;<i>
</I>&gt;<i> I'm running on SuSE 9.0 Linux.
</I>&gt;<i>
</I>&gt;<i> Python reports version &quot;Python 2.3+ (#1, Sep 23 2003, 23:07:16)&quot;.
</I>&gt;<i>
</I>&gt;<i> &gt;From the Apache error page:
</I>&gt;<i>     Apache/2.0.48 (Linux/SuSE),
</I>&gt;<i>     mod_python/3.1.2b
</I>&gt;<i>     Python/2.3+.
</I>&gt;<i>
</I>&gt;<i> The only glitch I had in building mod_python was that I needed to specify
</I>&gt;<i>     ./configure --with-apxs=/usr/sbin/apxs2
</I>&gt;<i>
</I>&gt;<i> rather than just refering to apxs.
</I>&gt;<i>
</I>&gt;<i> My apache configuration is (from the tutorial):
</I>&gt;<i> &lt;Directory /srv/www/htdocs/test&gt;
</I>&gt;<i>   AddHandler python-program .py
</I>&gt;<i>   PythonHandler mptest
</I>&gt;<i>   PythonDebug On
</I>&gt;<i> &lt;/Directory&gt;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mod_python mailing list
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I>&gt;<i>
</I></PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="014701.html">[mod_python] Session unable to acquire mutex lock?
</A></li>
	<LI>Next message: <A HREF="014705.html">[mod_python] Session unable to acquire mutex lock?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#14703">[ date ]</a>
              <a href="thread.html#14703">[ thread ]</a>
              <a href="subject.html#14703">[ subject ]</a>
              <a href="author.html#14703">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
