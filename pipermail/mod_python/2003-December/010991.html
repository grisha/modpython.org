<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Re: FW: Any way to embed Python in HTML?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Re%3A%20FW%3A%20Any%20way%20to%20embed%20Python%20in%20HTML%3F&In-Reply-To=004201c3c8e3%241acc16a0%246502a8c0%40securia.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="010993.html">
   <LINK REL="Next"  HREF="010987.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
<table border=0 width="100%"><tr><td valign="top">
   <H1>[mod_python] Re: FW: Any way to embed Python in HTML?</H1>
    <B>StianS&#248;iland</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Re%3A%20FW%3A%20Any%20way%20to%20embed%20Python%20in%20HTML%3F&In-Reply-To=004201c3c8e3%241acc16a0%246502a8c0%40securia.com"
       TITLE="[mod_python] Re: FW: Any way to embed Python in HTML?">stian at soiland.no
       </A><BR>
    <I>Tue Dec 23 02:45:36 EST 2003</I>
    <P><UL>
        <LI>Previous message: <A HREF="010993.html">[mod_python] FW: Any way to embed Python in HTML?
</A></li>
        <LI>Next message: <A HREF="010987.html">[mod_python] Problem keeing the db connection open
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10991">[ date ]</a>
              <a href="thread.html#10991">[ thread ]</a>
              <a href="subject.html#10991">[ subject ]</a>
              <a href="author.html#10991">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 2003-12-23 00:27:02, Jalil Feghhi wrote:

&gt;<i> I am new to mod_python and haven't seen any examples where you can put
</I>&gt;<i> python code in HTML pages. Is this not supported? If not supported, is
</I>&gt;<i> there any way or work around (other than using the request write method)
</I>&gt;<i> to separate HTML writing from coding?
</I>
Take a look at upcoming PSP from Mod-python 3.1.2b:

<A HREF="http://www.modpython.org/live/mod_python-3.1.2b/doc-html/pyapi-psp.html">http://www.modpython.org/live/mod_python-3.1.2b/doc-html/pyapi-psp.html</A>



I've also experienced some success with using template engines like
Cheetah combined with mod_python.

This is how we've done things using cheetah and mod_python's
Publisher-handler:


Made a general page template MainTemplate.tmpl:

    #attr title = &quot;Default title&quot;
    &lt;html&gt;
      &lt;head&gt;
        &lt;title&gt;$title&lt;/title&gt;
      &lt;/head&gt;
      &lt;body&gt;
        &lt;h1&gt;$title&lt;/h1&gt;
        &lt;div class=&quot;menu&quot;&gt;
          menu blabla
          (details left out)
        &lt;/div&gt;  
        &lt;div class=&quot;content&quot;&gt;
    #def content    
            No content here yet, this is just
            the base template
    #end def
    $content()
        &lt;/div&gt;


Here's a specialized page template WelcomeTemplate.tmpl

    #extends MainTemplate
    #def content
            Welcome to our world. Blablabla
            blablabla.
    #end def     
 

These template-files are compiled with cheetah-compile - which produces
a rather nasty .py-file. This file could be imported and used from
Python.

In .htaccess:

    SetHandler mod_python
    PythonHandler mod_python.publisher


in welcome.py:

    from WelcomeTemplate import WelcomeTemplate 
    def index(req):
        templ = WelcomeTemplate()
        templ.title = &quot;Welcome, my friend&quot;
        return templ


Blocks made within templates (the #def's) are callable methods from
within Python, and therefore templates could be used for smaller building
blocks as well.  templ.content could be changed to any other template,
or even a python function defined somewhere else.


Model view controller
=====================

In our current ongoing project, Cerebrum, we've succeeded in seperating
content from control, and even seperating the model from control. This
is the old MVC (model-view-controller) principle as we've used it:

       model          controller                  view
  business logic      web logic             presentation logic
  (what to do)      (what to show)             (how to view)

 python classes     python classes           cheetah templates
 representing the   for web access, ie.      with calls to other
 data, methods      each method accessed     templates and
 for operations     from the browser.        helper classes in
                    Performs operations on   python
                    model and views by
                    calling cheetah 
                    templates. 
 

Example:
========
code is simplified, and never tested in simplified form. It will
probably not work directly. The real code can be viewed on 
<A HREF="http://cvs.sourceforge.net/viewcvs.py/cerebrum/cerebrum/">http://cvs.sourceforge.net/viewcvs.py/cerebrum/cerebrum/</A> under the
directories Cerebrum/client and web/ - note however
that the code is constantly changing at this part of the web project.


Model - Cerebrum/client/BofhModel.py
------------------------------------


class Entity:
    def __init__(self, server):
        # xmlrpc-connection
        self.server = server

    def fetch_by_id(cls, server, id):
        # make a new instance of the called-on class,
        # ie. a Group or Entity
        entity = cls(server)
        entity.load_entity_info(id)
        return entity
    fetch_by_id = classmethod(fetch_by_id)

    def load_entity_info(self, id):
        self.id = id
        info = self.server.entity_info(id)
        self.type = info['type']
        return info

class Group(Entity):
    def load_entity_info(self, id):
        info = Entity.load_entity_info(self, id)
        self.name = info['name']
        self.description = info['description']
        return info
    

View - web/lib/cereweb/templates/GroupViewTemplate.tmpl
--------------------------------------------------------

## Be international, import function gettext() as _()
#from gettext import gettext as _
#def viewGroup(group)
    &lt;h1&gt;$_(&quot;Group&quot;) $group.name&lt;/h1&gt;
    $groupInfo($group)
#end def

#def groupInfo(group)
    &lt;div class=&quot;info&quot;&gt;
    &lt;dl&gt;
        &lt;dt&gt;$_(&quot;Name&quot;)&lt;/dt&gt;
        &lt;dd&gt;$group.name&lt;/dd&gt;
        &lt;dt&gt;$_(&quot;Description&quot;)&lt;/dt&gt;
        &lt;dd&gt;$group.description&lt;/dd&gt;
    &lt;/dl&gt;
    &lt;/div&gt;
#end def

MainTemplate.tmpl almost like shown in previous text.


Controller - htdocs/group.py
----------------------------

from Cerebrum.web.templates.MainTemplate import MainTemplate
from Cerebrum.web.templates.GroupViewTemplate import GroupViewTemplate
from Cerebrum.client import BofhModel

def view(req, id):
    # Get a generic view (menu, header, footer)
    page = MainTemplate()
    # the session and the xmlrpc server connection has been prepared by
    # a handler in .htaccess
    server = req.session['server']
    # get the object from the model   
    group = BofhModel.Group.fetch_by_id(server, id)
    # prepare the specialiced view
    view = GroupViewTemplate()
    # pass the model to the view 
    page.content = view.viewGroup(group)
    # and return the final result (within the MainTemplate)
    # to the browser
    return page
    

Notice how the controller is rather small and only glues together the view
and the model. In this example, the model is just an xmlrpc abstraction,
so even the business logic is hidden.  In this case the controller
actually uses two views, both MainTemplate (the menu, footer, etc.) and
GroupViewTemplate.  The reason for not subclassing MainTemplate into
GroupViewTemplate is that we needed to pass on the chosen group object
(from the Model), and that a groupview could be usable from within other
views as well. 


-- 
Stian S&#248;iland               Work toward win-win situation. Win-lose
Trondheim, Norway           is where you win and the other lose.
<A HREF="http://www.soiland.no/">http://www.soiland.no/</A>      Lose-lose and lose-win are left as an
                            exercise to the reader.  [Limoncelli/Hogan]

</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="010993.html">[mod_python] FW: Any way to embed Python in HTML?
</A></li>
	<LI>Next message: <A HREF="010987.html">[mod_python] Problem keeing the db connection open
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10991">[ date ]</a>
              <a href="thread.html#10991">[ thread ]</a>
              <a href="subject.html#10991">[ subject ]</a>
              <a href="author.html#10991">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="DISABLEhttp://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
