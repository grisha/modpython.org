<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Connection handler behaviour
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=Re%3A%20%5Bmod_python%5D%20Connection%20handler%20behaviour&In-Reply-To=%3C20150123122102.GJ5431%40eldamar.org.uk%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   
   
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Connection handler behaviour</H1>
    <B>Alexander Frolkin</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=Re%3A%20%5Bmod_python%5D%20Connection%20handler%20behaviour&In-Reply-To=%3C20150123122102.GJ5431%40eldamar.org.uk%3E"
       TITLE="[mod_python] Connection handler behaviour">avf at eldamar.org.uk
       </A><BR>
    <I>Fri Jan 23 12:21:02 UTC 2015</I>
    <P><UL>
        
        
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26646">[ date ]</a>
              <a href="thread.html#26646">[ thread ]</a>
              <a href="subject.html#26646">[ subject ]</a>
              <a href="author.html#26646">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,

I'm having two issues trying to implement a connection handler.  The
first is that it seems to be impossible to write data to the client
before a line has been read from the client.  The second is that the
connection isn't closed when the handler returns apache.OK.

Surely the latter isn't correct behaviour?  As for the former, is this
the expected behaviour?  Is there any way to change it?

I'm running mod_python 3.3.1 and Apache 2.4.7.  Virtual host config:

-----
Listen 10.1.2.3:9999
&lt;VirtualHost 10.1.2.3:9999&gt;
	ServerName tcp_test
	PythonPath &quot;sys.path + ['/var/www']&quot;
	PythonDebug On
	PythonConnectionHandler tcp_test
&lt;/VirtualHost&gt;
-----

The handler:

-----
from mod_python import apache

def connectionhandler(conn):
	conn.write('Hello\r\n')

	line = conn.readline()
	conn.write('You said {0}\r\n'.format(line))

	return apache.OK
-----

An example session:

----
$ telnet 10.1.2.3 9999
Trying 10.1.2.3...
Connected to 10.1.2.3.
Escape character is '^]'.
test
Hello
You said test





^]
telnet&gt; q
Connection closed.
-----

What I would expect:

-----
$ telnet 10.1.2.3 9999
Trying 10.1.2.3...
Connected to 10.1.2.3.
Escape character is '^]'.
Hello
test
You said test
Connection closed by foreign host.
-----

Could anyone shed some light on what's going on?  Am I just missing
something?

Thanks! :-)


Alex

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	
	
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#26646">[ date ]</a>
              <a href="thread.html#26646">[ thread ]</a>
              <a href="subject.html#26646">[ subject ]</a>
              <a href="author.html#26646">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the mod_python
mailing list</a><br>
</body></html>
