<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Singleton Object
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Singleton%20Object&In-Reply-To=ed756d900712122358r1af9a5cew2cc05e01cf88e35%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="024576.html">
   <LINK REL="Next"  HREF="024578.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Singleton Object</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Singleton%20Object&In-Reply-To=ed756d900712122358r1af9a5cew2cc05e01cf88e35%40mail.gmail.com"
       TITLE="[mod_python] Singleton Object">graham.dumpleton at gmail.com
       </A><BR>
    <I>Thu Dec 13 03:13:04 EST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="024576.html">[mod_python] Singleton Object
</A></li>
        <LI>Next message: <A HREF="024578.html">[mod_python] Singleton Object
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24577">[ date ]</a>
              <a href="thread.html#24577">[ thread ]</a>
              <a href="subject.html#24577">[ subject ]</a>
              <a href="author.html#24577">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 13/12/2007, Tom Wells &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">drshade at gmail.com</A>&gt; wrote:
&gt;<i> Hi everyone,
</I>&gt;<i>
</I>&gt;<i> I've been evaluating mod_python to implement a particular set of
</I>&gt;<i> requirements, and am now convinced that it is going to work for me, however
</I>&gt;<i> I have one remaining problem to solve:
</I>&gt;<i>
</I>&gt;<i> I need to be able to spawn a single &quot;watchdog&quot; thread within my module which
</I>&gt;<i> connects back to a central server (via webservice calls) to provide
</I>&gt;<i> monitoring data, plus synchronize certain session data. I need to support
</I>&gt;<i> apache2.2 running in worker mpm (on linux platform), as well as winnt. In
</I>&gt;<i> the winnt deployment it's easy to spawn a single thread, as i can do this
</I>&gt;<i> the first time my module imports, but in worker mpm my module is imported
</I>&gt;<i> for each apache process started (I haven't actually tested the winnt side so
</I>&gt;<i> it's an assumption after some heavy reading up on the apache threading
</I>&gt;<i> models).
</I>&gt;<i>
</I>&gt;<i> After some research with the C apache api I've noticed a hook called
</I>&gt;<i> &quot;ap_hook_post_config&quot; which seems like a good place to spawn singleton
</I>&gt;<i> objects, but I couldn't track this down in the mod_python hooks, nor have I
</I>&gt;<i> actually tried it with the C api, so I could be very wrong!
</I>&gt;<i>
</I>&gt;<i> I've also taken a look at the mod_python Session bits, hoping to be able to
</I>&gt;<i> possibly set a global flag somewhere so that further module imports don't
</I>&gt;<i> spawn more threads, but I need something which is non-persistent (so if
</I>&gt;<i> apache restarts that cache is cleared, which I get from the MemorySession,
</I>&gt;<i> except I can't share this across processes, catch-22).
</I>&gt;<i>
</I>&gt;<i> Anyways, any suggestions would be greatly appreciated!
</I>
If you expect state to be available in each Apache child process when
run on UNIX, you cant avoid having multiple distinct connections back
to the back end system to collect the data. Playing with the C API
post config hook isn't going to help you.

If a connection from each Apache child process is okay, then use
PythonImport directive to import a module on process startup which
does any once of initialisation.

Graham
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="024576.html">[mod_python] Singleton Object
</A></li>
	<LI>Next message: <A HREF="024578.html">[mod_python] Singleton Object
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#24577">[ date ]</a>
              <a href="thread.html#24577">[ thread ]</a>
              <a href="subject.html#24577">[ subject ]</a>
              <a href="author.html#24577">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
