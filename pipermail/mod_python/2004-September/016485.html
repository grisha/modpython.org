<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Sessions + Publisher
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Sessions%20%2B%20Publisher&In-Reply-To=1095861030.12184.14.camel%40bigmac.taumu.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016483.html">
   <LINK REL="Next"  HREF="016487.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Sessions + Publisher</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Todd Boland</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Sessions%20%2B%20Publisher&In-Reply-To=1095861030.12184.14.camel%40bigmac.taumu.com"
       TITLE="[mod_python] Sessions + Publisher">itodd at itodd.org
       </A><BR>
    <I>Wed Sep 22 12:24:16 EDT 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="016483.html">[mod_python] Sessions + Publisher
</A></li>
        <LI>Next message: <A HREF="016487.html">[mod_python] Sessions + Publisher
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16485">[ date ]</a>
              <a href="thread.html#16485">[ thread ]</a>
              <a href="subject.html#16485">[ subject ]</a>
              <a href="author.html#16485">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Sep 22, 2004, at 9:50 AM, Terry MacDonald wrote:

&gt;<i> If is_new() is always true it means that a session cookie is not in the
</I>&gt;<i> request.
</I>&gt;<i>
</I>&gt;<i> util.redirect does not set up the cookie in the response, calling
</I>&gt;<i> Session(req, secret...) does that (if the request does not have a valid
</I>&gt;<i> one already set)
</I>
My understanding of Session is as follows: When I call Session(req, 
secret=''), I am assuming that the class first checks for existing 
cookies sent by the client, if it doesn't find one, it generates the 
sid and sends the set-cookie header to the client. It also sets a 
private member to 1 for Session.is_new() to return.

Is this accurate?

&gt;<i>
</I>&gt;<i> Not knowing what is going on in your login script its hard to tell what
</I>&gt;<i> the exact problem is but I would check that session cookies are being
</I>&gt;<i> exchnged between the browser and the server.
</I>
The cookie is definitely being set. Firefox and Safari both report 
having pysid cookies. All my login script is at the moment is:

def login(req, url=None):
	req.write('login')

Safari bitches about too many redirects and firefox is sent into an 
infinite redirect loop.

Thanks for your help and time Terry.

Todd

&gt;<i>
</I>&gt;<i> On Wed, 2004-09-22 at 01:12, Todd Boland wrote:
</I>&gt;&gt;<i> Hello again!
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> In my experiences as a web developer (I'm coming from a Perl/Mason
</I>&gt;&gt;<i> environment), I've found that the convenience of &quot;transparently&quot;
</I>&gt;&gt;<i> generating sessions outweighs the performance hit.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I'm trying to implement sessions &quot;transparently&quot; using 2 handlers for
</I>&gt;&gt;<i> every request. The first handler makes sure a session is set, if it 
</I>&gt;&gt;<i> was
</I>&gt;&gt;<i> just created, it will forward the browser to a login page (like the
</I>&gt;&gt;<i> documentation suggests). More code that checks session ids against
</I>&gt;&gt;<i> values in the database to authenticate users will eventually be added.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> By the time a request gets to the second handler (the Publisher
</I>&gt;&gt;<i> handler), sessions have preemptively been taken care of (it's totally
</I>&gt;&gt;<i> &quot;transparent&quot;).
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> The problem I'm having is: I end up in an infinite redirect loop:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> The session handler:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> from mod_python import apache, util
</I>&gt;&gt;<i> from mod_python.Session import Session
</I>&gt;&gt;<i> from RPM.common import web_root
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> def handler(req):
</I>&gt;&gt;<i>          session = Session(req, secret='********')
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>          # if the session is new, they need to log in
</I>&gt;&gt;<i>          if session.is_new():
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>                  # Using util's redirect will set the cookie
</I>&gt;&gt;<i>                  util.redirect(req, web_root('index.py/login?url=%s' %
</I>&gt;&gt;<i> req.uri))
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> 	# TODO: Make sure sid is logged in
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> 	# Hand off to Publisher handler by returning 200 OK
</I>&gt;&gt;<i>          return apache.OK
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> session.is_new() always returns 1 even after the session cookie is set
</I>&gt;&gt;<i> (after the redirect). Any ideas or nudges in the right direction would
</I>&gt;&gt;<i> greatly be appreciated. Thanks!
</I>&gt;<i> -- 
</I>&gt;<i> Terry
</I>&gt;<i> Registered Linux User # 311806
</I>&gt;<i> www.taumu.com
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mod_python mailing list
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I>&gt;<i>
</I>

-- 
Todd Boland
Software Engineer
Charged Software
(508) 887-2885
Facsimile: (978) 264-0058

-- 
Statement of Confidentiality:

The information contained in this electronic message and any 
attachments to this message are intended for the exclusive use of the 
addressee(s) and may contain confidential or privileged information.

If you are not the intended recipient, please notify Todd Boland, at 
(508) 887-2885 immediately, and destroy all copies of this message and 
any attachments.

</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="016483.html">[mod_python] Sessions + Publisher
</A></li>
	<LI>Next message: <A HREF="016487.html">[mod_python] Sessions + Publisher
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16485">[ date ]</a>
              <a href="thread.html#16485">[ thread ]</a>
              <a href="subject.html#16485">[ subject ]</a>
              <a href="author.html#16485">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
