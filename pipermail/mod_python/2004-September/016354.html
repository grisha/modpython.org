<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Bug in BaseSession.py
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Bug%20in%20BaseSession.py&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016343.html">
   <LINK REL="Next"  HREF="016355.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Bug in BaseSession.py</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Brian Bird</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Bug%20in%20BaseSession.py&In-Reply-To="
       TITLE="[mod_python] Bug in BaseSession.py">brian.bird at securetrading.com
       </A><BR>
    <I>Mon Sep  6 12:11:24 EDT 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="016343.html">[mod_python] mod_python bake-off?
</A></li>
        <LI>Next message: <A HREF="016355.html">[mod_python] bake-off use cases
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16354">[ date ]</a>
              <a href="thread.html#16354">[ thread ]</a>
              <a href="subject.html#16354">[ subject ]</a>
              <a href="author.html#16354">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I posted a similar question about this a while ago but got no reply, so I've
done some more investigation:

In Session.py, the BaseSession class takes an optional secret parameter.
However, when the cookie is created it's type is not checked to ensure it is
of type &quot;SignedCookie&quot; instead of just &quot;Cookie&quot;. The documentation
(<A HREF="http://www.modpython.org/live/current/doc-html/pyapi-cookie-classes.html">http://www.modpython.org/live/current/doc-html/pyapi-cookie-classes.html</A>)
says you must do this otherwise the secret parameter is essentially
irrelevant.

(I can't write my own subclass to fix this because the cookies variable is
local and unavailable to subclasses)

I'd suggest having an extra couple of lines at line 117 of Session.py saying
something like:

if secret and (type(cookies[COOKIE_NAME]) is not Cookie.SignedCookie):
	raise Exception(&quot;Tampered Cookie&quot;)

Or perhaps instead of raising an exception we should just not set self._sid
which will mean the existing cookie will be ignored:

if cookies.has_key(COOKIE_NAME):
	if secret and (type(cookies[COOKIE_NAME]) is not
Cookie.SignedCookie):
		pass
	else:
		self._sid = cookies[COOKIE_NAME].value


Any comments? I need this fixing for the project I'm writing - if there are
no better suggestions, how do I get this patched? I think the second
solution is better (but only because it's more convenient for my particular
project ;-) so perhaps someone can think of a more generic solution?

Thanks,
Brian
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://modpython.org/pipermail/mod_python/attachments/20040906/9f5126e2/attachment.html">http://modpython.org/pipermail/mod_python/attachments/20040906/9f5126e2/attachment.html</A>
</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="016343.html">[mod_python] mod_python bake-off?
</A></li>
	<LI>Next message: <A HREF="016355.html">[mod_python] bake-off use cases
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16354">[ date ]</a>
              <a href="thread.html#16354">[ thread ]</a>
              <a href="subject.html#16354">[ subject ]</a>
              <a href="author.html#16354">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
