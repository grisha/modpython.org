<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] Mac OS X / Apache 2.0 / mod_python 3.1.3 / Python
	2.3.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Mac%20OS%20X%20/%20Apache%202.0%20/%20mod_python%203.1.3%20/%20Python%0A%092.3.&In-Reply-To=D2D3276C-0E1C-11D9-8C95-000393DCF16E%40dscpl.com.au">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016510.html">
   <LINK REL="Next"  HREF="016512.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] Mac OS X / Apache 2.0 / mod_python 3.1.3 / Python
	2.3.</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Mark McClain</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20Mac%20OS%20X%20/%20Apache%202.0%20/%20mod_python%203.1.3%20/%20Python%0A%092.3.&In-Reply-To=D2D3276C-0E1C-11D9-8C95-000393DCF16E%40dscpl.com.au"
       TITLE="[mod_python] Mac OS X / Apache 2.0 / mod_python 3.1.3 / Python
	2.3.">mark at gsoa.net
       </A><BR>
    <I>Fri Sep 24 15:12:18 EDT 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="016510.html">[mod_python] Mac OS X / Apache 2.0 / mod_python 3.1.3 / Python
	2.3.
</A></li>
        <LI>Next message: <A HREF="016512.html">[mod_python] Mac OS X / Apache 2.0 / mod_python 3.1.3 / Python
	2.3.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16514">[ date ]</a>
              <a href="thread.html#16514">[ thread ]</a>
              <a href="subject.html#16514">[ subject ]</a>
              <a href="author.html#16514">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I have built mod_python on 10.3.[2,3,4,5] for multiple machines in our  
office without problems.  I use the version of python shipped with OS X  
and apache 2.0 which I compiled.

I did run into some weirdness with the gcc depending on the method for  
installing Xcode.  That issue was because apple changed the libraries  
that the Xcode installed versus the OS installation provided; however,  
that problem would present itself at compile time not runtime.

I have another clean machine that I'll try it out on this weekend.

mark

On Sep 24, 2004, at 7:28 AM, Graham Dumpleton wrote:

&gt;<i> The problem I was having with both Apache 1.3/2.0 and corresponding  
</I>&gt;<i> mod_python
</I>&gt;<i> for those versions loaded, was that as soon as Apache was started, all  
</I>&gt;<i> the forked
</I>&gt;<i> processes would crash.
</I>&gt;<i>
</I>&gt;<i> [Fri Sep 24 15:06:01 2004] [notice] SIGHUP received.  Attempting to  
</I>&gt;<i> restart
</I>&gt;<i> [Fri Sep 24 15:06:02 2004] [notice] Apache/2.0.51 (Unix) configured --  
</I>&gt;<i> resuming normal operations
</I>&gt;<i> [Fri Sep 24 15:06:10 2004] [notice] child pid 15196 exit signal Bus  
</I>&gt;<i> error (10)
</I>&gt;<i> [Fri Sep 24 15:06:10 2004] [notice] child pid 15194 exit signal Bus  
</I>&gt;<i> error (10)
</I>&gt;<i> [Fri Sep 24 15:06:10 2004] [notice] child pid 15192 exit signal Bus  
</I>&gt;<i> error (10)
</I>&gt;<i> [Fri Sep 24 15:06:10 2004] [notice] child pid 15190 exit signal Bus  
</I>&gt;<i> error (10)
</I>&gt;<i> [Fri Sep 24 15:06:10 2004] [notice] child pid 15188 exit signal Bus  
</I>&gt;<i> error (10)
</I>&gt;<i>
</I>&gt;<i> Make the mod_python.c file fix I described and it all works fine.
</I>&gt;<i>
</I>&gt;<i> Thus, has nothing to do with command line execution of Python.
</I>&gt;<i>
</I>&gt;<i> On 24/09/2004, at 9:13 PM, John Raines wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> There's a Macpython IDE that would run a lot of python code and  
</I>&gt;&gt;<i> necessarily initialize some things, I think. Is that really the issue  
</I>&gt;&gt;<i> or are you dealing with python itself from the command line? I'm  
</I>&gt;&gt;<i> still trying to get things working myself and I did download a new  
</I>&gt;&gt;<i> version of python although I think I'm one version behind you on both  
</I>&gt;&gt;<i> Apache and python.
</I>&gt;&gt;<i> On Sep 24, 2004, at 12:37 AM, Graham Dumpleton wrote:
</I>&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> A while back, I posted as to how I managed to get standard Apache  
</I>&gt;&gt;&gt;<i> 1.3 and
</I>&gt;&gt;&gt;<i> Python 2.3 as supplied with the Mac OS X (10.3.5) operating system,  
</I>&gt;&gt;&gt;<i> working
</I>&gt;&gt;&gt;<i> with the older mod_python 2.7.10. Specifically, a hack was required  
</I>&gt;&gt;&gt;<i> because
</I>&gt;&gt;&gt;<i> the Python framework library as supplied with the Mac was appearing  
</I>&gt;&gt;&gt;<i> to
</I>&gt;&gt;&gt;<i> already be initialised when mod_python was initialised, even though  
</I>&gt;&gt;&gt;<i> it hadn't.
</I>&gt;&gt;&gt;<i> The original email and the hack made is attached below.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Anyway, I have now installed Apache 2.0.51 and mod_python 3.1.3 and  
</I>&gt;&gt;&gt;<i> have
</I>&gt;&gt;&gt;<i> run up against the exact same problem. Remembering, this is with the
</I>&gt;&gt;&gt;<i> version of Python that comes with the operating system, ie., Python  
</I>&gt;&gt;&gt;<i> 2.3.
</I>&gt;&gt;&gt;<i> I even rebuilt my box from scratch recently so it is a relatively  
</I>&gt;&gt;&gt;<i> fresh install
</I>&gt;&gt;&gt;<i> of Mac OS X.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> My question is whether anyone running Apache 2.0 and mod_python 3.1.3
</I>&gt;&gt;&gt;<i> on Mac OS X, has done so by using the version of Python that comes  
</I>&gt;&gt;&gt;<i> with
</I>&gt;&gt;&gt;<i> the operating system? The various posts I have seen talk about having
</I>&gt;&gt;&gt;<i> downloaded the more recent Python 2.3.4 and compiling it from  
</I>&gt;&gt;&gt;<i> scratch.
</I>&gt;&gt;&gt;<i> Ie., not using that supplied with the operating system.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> If this is the case, and everyone has been building a new version of  
</I>&gt;&gt;&gt;<i> Python,
</I>&gt;&gt;&gt;<i> it suggests that the problem I am seeing is generic to Python 2.3  
</I>&gt;&gt;&gt;<i> that comes
</I>&gt;&gt;&gt;<i> with the Mac and applies to any version of mod_python.  
</I>&gt;&gt;&gt;<i> Alternatively, it
</I>&gt;&gt;&gt;<i> comes about because of underlying problems with how the loadable  
</I>&gt;&gt;&gt;<i> object
</I>&gt;&gt;&gt;<i> for mod_python is being created on the Mac.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> On Aug 04 21:37, Graham Dumpleton &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">grahamd at dscpl.com.au</A>&gt; wrote:
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> Subject: Re: [mod_python] Status of Mac OS X / Apache 1.3 /  
</I>&gt;&gt;&gt;&gt;<i> mod_python 2.7.10.
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> On Aug 04 15:26, Justin Ryan &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">jryan at qutang.net</A>&gt; wrote:
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i> Subject: Re: [mod_python] Status of Mac OS X / Apache 1.3 /  
</I>&gt;&gt;&gt;&gt;&gt;<i> mod_python 2.7.10.
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i> Be careful when playing with the file/directory/link/whateva that  
</I>&gt;&gt;&gt;&gt;&gt;<i> is
</I>&gt;&gt;&gt;&gt;&gt;<i> /System/Library/Frameworks/Python.Framework.  I ran into some  
</I>&gt;&gt;&gt;&gt;&gt;<i> wierdness
</I>&gt;&gt;&gt;&gt;&gt;<i> trying to change this into a symlink and move it around (i.e.  
</I>&gt;&gt;&gt;&gt;&gt;<i> change it
</I>&gt;&gt;&gt;&gt;&gt;<i> back and forth from pointing to Apple's python and my own).
</I>&gt;&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;&gt;<i> Also, take care when using the 'python' command after installing  
</I>&gt;&gt;&gt;&gt;&gt;<i> your
</I>&gt;&gt;&gt;&gt;&gt;<i> own framework build.  It's kind of a pain to get a framework build  
</I>&gt;&gt;&gt;&gt;&gt;<i> to
</I>&gt;&gt;&gt;&gt;&gt;<i> stick python, pythonw, etc.. in /usr/bin - all of my stuff was in
</I>&gt;&gt;&gt;&gt;&gt;<i> /usr/local/bin, even though I passed --prefix=/usr to the configure
</I>&gt;&gt;&gt;&gt;&gt;<i> script.
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> I would agree and why I didn't want to go down the path of having  
</I>&gt;&gt;&gt;&gt;<i> to replace
</I>&gt;&gt;&gt;&gt;<i> the standard version of Python on MacOSX with a newer version to  
</I>&gt;&gt;&gt;&gt;<i> get mod_python
</I>&gt;&gt;&gt;&gt;<i> to work. Similarly, I didn't want to be replacing their version of  
</I>&gt;&gt;&gt;&gt;<i> Apache.
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> Anyway, listed below is the changes I had to make to get it to  
</I>&gt;&gt;&gt;&gt;<i> build and work
</I>&gt;&gt;&gt;&gt;<i> on MacOSX (10.3.3) with the standard Python (2.3) and Apache (1.3)  
</I>&gt;&gt;&gt;&gt;<i> that come
</I>&gt;&gt;&gt;&gt;<i> with the operating system.
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> First off, after running configure, change &quot;src/Makefile&quot; and  
</I>&gt;&gt;&gt;&gt;<i> replace:
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i>    
</I>&gt;&gt;&gt;&gt;<i> /System/Library/Frameworks/Python.framework/Versions/2.3/lib/ 
</I>&gt;&gt;&gt;&gt;<i> python2.3/config/libpython2.3.a
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> with:
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i>   -framework Python
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> in LIBS variable.
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> Second, in the same makefile, change CFLAGS and add in:
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i>   -DEAPI
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> as a compiler option.
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> This will allow mod_python to build, but the result will crash.
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> Final step is to modify src/mod_python.c. The diff is below. There  
</I>&gt;&gt;&gt;&gt;<i> are
</I>&gt;&gt;&gt;&gt;<i> more comments after that diff as to why the original code is wrong  
</I>&gt;&gt;&gt;&gt;<i> anyway.
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> *** mod_python.c.dist   Tue May 29 06:00:41 2001
</I>&gt;&gt;&gt;&gt;<i> --- mod_python.c        Thu Aug  5 13:21:22 2004
</I>&gt;&gt;&gt;&gt;<i> ***************
</I>&gt;&gt;&gt;&gt;<i> *** 260,265 ****
</I>&gt;&gt;&gt;&gt;<i> --- 260,268 ----
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i>       char buff[255];
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> +     /* fudge for Mac OS X with Apache 1.3 where  
</I>&gt;&gt;&gt;&gt;<i> Py_IsInitialized() broke */
</I>&gt;&gt;&gt;&gt;<i> +     static int initialized = 0;
</I>&gt;&gt;&gt;&gt;<i> +
</I>&gt;&gt;&gt;&gt;<i>       /* pool given to us in ChildInit. We use it for
</I>&gt;&gt;&gt;&gt;<i>          server.register_cleanup() */
</I>&gt;&gt;&gt;&gt;<i>       pool *child_init_pool = NULL;
</I>&gt;&gt;&gt;&gt;<i> ***************
</I>&gt;&gt;&gt;&gt;<i> *** 272,279 ****
</I>&gt;&gt;&gt;&gt;<i>       ap_add_version_component(buff);
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i>       /* initialize global Python interpreter if necessary */
</I>&gt;&gt;&gt;&gt;<i> !     if (! Py_IsInitialized())
</I>&gt;&gt;&gt;&gt;<i>       {
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i>         /* initialze the interpreter */
</I>&gt;&gt;&gt;&gt;<i>         Py_Initialize();
</I>&gt;&gt;&gt;&gt;<i> --- 275,283 ----
</I>&gt;&gt;&gt;&gt;<i>       ap_add_version_component(buff);
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i>       /* initialize global Python interpreter if necessary */
</I>&gt;&gt;&gt;&gt;<i> !     if (initialized == 0 || ! Py_IsInitialized())
</I>&gt;&gt;&gt;&gt;<i>       {
</I>&gt;&gt;&gt;&gt;<i> +         initialized = 1;
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i>         /* initialze the interpreter */
</I>&gt;&gt;&gt;&gt;<i>         Py_Initialize();
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> The problem on MacOSX is that Py_IsInitialized() is returning true  
</I>&gt;&gt;&gt;&gt;<i> on the
</I>&gt;&gt;&gt;&gt;<i> first time it is called even though Python hadn't up until that  
</I>&gt;&gt;&gt;&gt;<i> point actually
</I>&gt;&gt;&gt;&gt;<i> been initialised. This means initialisation is skipped and the  
</I>&gt;&gt;&gt;&gt;<i> first time
</I>&gt;&gt;&gt;&gt;<i> something tries to use Python methods later, it crashes.
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> To my mind the use of Py_IsInitialized() is partly bogus anyway.  
</I>&gt;&gt;&gt;&gt;<i> This is
</I>&gt;&gt;&gt;&gt;<i> because if someone did come up with a different apache module which
</I>&gt;&gt;&gt;&gt;<i> also tried to use Python and it got loaded first and called  
</I>&gt;&gt;&gt;&gt;<i> Py_Initialize(),
</I>&gt;&gt;&gt;&gt;<i> it would mean when mod_python got loaded it would skip  
</I>&gt;&gt;&gt;&gt;<i> initialisation
</I>&gt;&gt;&gt;&gt;<i> and wouldn't initialise as a result the &quot;interpreters&quot; dictionary  
</I>&gt;&gt;&gt;&gt;<i> nor would
</I>&gt;&gt;&gt;&gt;<i> it necessarily initialise threading if the other module didn't do  
</I>&gt;&gt;&gt;&gt;<i> it.
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> Thus, even though people might reckon that this patch may only be
</I>&gt;&gt;&gt;&gt;<i> relevant to the MacOSX problem I have, I would disagree, because I  
</I>&gt;&gt;&gt;&gt;<i> would
</I>&gt;&gt;&gt;&gt;<i> say the code is wrong anyway.
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> As a demonstration, you might modify the code and add an extra call  
</I>&gt;&gt;&gt;&gt;<i> to
</I>&gt;&gt;&gt;&gt;<i> Py_Initialize() just prior to the &quot;if&quot; statement where  
</I>&gt;&gt;&gt;&gt;<i> Py_IsInitialized() is
</I>&gt;&gt;&gt;&gt;<i> called as if it was done somewhere else. Do this and mod_python  
</I>&gt;&gt;&gt;&gt;<i> should
</I>&gt;&gt;&gt;&gt;<i> by observation break since &quot;interpreters&quot; will never get set as  
</I>&gt;&gt;&gt;&gt;<i> described above.
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> --
</I>&gt;&gt;&gt;&gt;<i> Graham Dumpleton (<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">grahamd at dscpl.com.au</A>)
</I>&gt;&gt;&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;&gt;&gt;<i> Mod_python mailing list
</I>&gt;&gt;&gt;&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;&gt;&gt;&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> --
</I>&gt;&gt;&gt;<i> Graham Dumpleton (<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">grahamd at dscpl.com.au</A>)
</I>&gt;&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;&gt;<i> Mod_python mailing list
</I>&gt;&gt;&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;&gt;&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> Mod_python mailing list
</I>&gt;&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Mod_python mailing list
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">Mod_python at modpython.org</A>
</I>&gt;<i> <A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">http://mailman.modpython.org/mailman/listinfo/mod_python</A>
</I>&gt;<i>
</I>
</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="016510.html">[mod_python] Mac OS X / Apache 2.0 / mod_python 3.1.3 / Python
	2.3.
</A></li>
	<LI>Next message: <A HREF="016512.html">[mod_python] Mac OS X / Apache 2.0 / mod_python 3.1.3 / Python
	2.3.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16514">[ date ]</a>
              <a href="thread.html#16514">[ thread ]</a>
              <a href="subject.html#16514">[ subject ]</a>
              <a href="author.html#16514">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="DISABLEhttp://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
