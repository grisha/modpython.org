<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] How to handle exceptions and initialization in
	mpservlet
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20How%20to%20handle%20exceptions%20and%20initialization%20in%0A%09mpservlet&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="016339.html">
   <LINK REL="Next"  HREF="016351.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] How to handle exceptions and initialization in
	mpservlet</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Vinj Vinj</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20How%20to%20handle%20exceptions%20and%20initialization%20in%0A%09mpservlet&In-Reply-To="
       TITLE="[mod_python] How to handle exceptions and initialization in
	mpservlet">vinjvinj at yahoo.com
       </A><BR>
    <I>Fri Sep  3 12:54:10 EDT 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="016339.html">[mod_python] Questions on _call_ with mp servlets and python
</A></li>
        <LI>Next message: <A HREF="016351.html">[mod_python] How to handle exceptions and initialization in
	mpservlet
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16340">[ date ]</a>
              <a href="thread.html#16340">[ thread ]</a>
              <a href="subject.html#16340">[ subject ]</a>
              <a href="author.html#16340">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>It woudl be helpful to add to the tutorial how to
handle exceptions in mpservlet. I have spent a
signifcant amount of time trying to track down
exceptions. 

1. If there is an exception in a function called
thorugh _call_ the servlet just returns a blank page. 

I added a try/except block in respond using the
following two receips from ASPN (I've attached the
code). This not only gives you the exceptions but also
gives the values of the local variables.

2. Add a file upload example to the tutorial

3. How do you initialize server level code. I plan on
having several python processes (each linked to one
apache fork) listening on each port and then use a
sticky load balancer to ake sure the user goes back to
the same process that was handling his request. Also
in my db I keep track of all the mod_python servers.
Each of these need to read from its own configuration
file. I was planning on putting a PYTHON_OPTION in the
httpd configuration. But how do i get access to it at
init time. I know you can get to it by req.get_option
but that happens only a request time. Is there any way
to get access to this at mod_python initialization
time. 
import sys, traceback

-----------------------------------------------------

def print_exc_web(servlet):
    &quot;&quot;&quot;
    Print the usual traceback information, followed by
a listing of all the
    local variables in each frame.
    &quot;&quot;&quot;
    tb = sys.exc_info()[2]
    while 1:
        if not tb.tb_next:
            break
        tb = tb.tb_next
    stack = []
    f = tb.tb_frame
    while f:
        stack.append(f)
        f = f.f_back
    stack.reverse()
    servlet.writeln(ErrorMsg())
    servlet.writeln(&quot;Locals by frame, innermost last&quot;)
    for frame in stack:
        servlet.writeln('')
        servlet.writeln(&quot;Frame %s in %s at line %s&quot; %
(frame.f_code.co_name,
                                            
frame.f_code.co_filename,
                                            
frame.f_lineno))
        for key, value in frame.f_locals.items():
            servlet.writeln(&quot;\t%20s = &quot; % key,)
            #We have to be careful not to cause a new
error in our error
            #printer! Calling str() on an unknown
object could cause an
            #error we don't want.
            try:
                servlet.writeln(value)
            except:
                servlet.writeln(&quot;&lt;ERROR WHILE PRINTING
VALUE&gt;&quot;)

def ErrorMsg(escape=0):
    &quot;&quot;&quot;
    returns: string

    simualtes the traceback output and if argemument
    &lt;escape&gt; set to 1 (true) the string will be
    converted to fit into html documents without
problems.
    &quot;&quot;&quot;
    import traceback, sys, string

    type=None
    value=None
    tb=None
    limit=None
    type, value, tb = sys.exc_info()
    body = &quot;Traceback (innermost last):\n&quot;
    list = traceback.format_tb(tb, limit) +           
traceback.format_exception_only(type, value)
    body = body + &quot;%-20s %s&quot; % (
        string.join(list[:-1], &quot;&quot;),
        list[-1],
        )
    if escape:
        import cgi
        body = cgi.escape(body)
    return body



</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="016339.html">[mod_python] Questions on _call_ with mp servlets and python
</A></li>
	<LI>Next message: <A HREF="016351.html">[mod_python] How to handle exceptions and initialization in
	mpservlet
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#16340">[ date ]</a>
              <a href="thread.html#16340">[ thread ]</a>
              <a href="subject.html#16340">[ subject ]</a>
              <a href="author.html#16340">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
