<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] mod_python authentication
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20mod_python%20authentication&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019582.html">
   <LINK REL="Next"  HREF="019584.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] mod_python authentication</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20mod_python%20authentication&In-Reply-To="
       TITLE="[mod_python] mod_python authentication">grahamd at dscpl.com.au
       </A><BR>
    <I>Tue Nov 22 20:29:40 EST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="019582.html">[SPAM] [mod_python] [SPAM] apache + python
</A></li>
        <LI>Next message: <A HREF="019584.html">[mod_python] apache aborted when SOAPpy function called
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19583">[ date ]</a>
              <a href="thread.html#19583">[ thread ]</a>
              <a href="subject.html#19583">[ subject ]</a>
              <a href="author.html#19583">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Bjorn Sundberg wrote ..
&gt;<i> Thanks Graham for your quick response. Its 2 am and my head is abit slow.
</I>&gt;<i> But is the idea to let apache do the digest authentication, that is apache
</I>&gt;<i> takes care of matching username against the password supplied in the
</I>&gt;<i> authenhandler()?
</I>
If you use AuthDigestFile to specify a user/password file that Apache can
itself use, the authenhandler() isn't even required. As you probably know,
you can find more details of how to set up Apache at:

  <A HREF="http://httpd.apache.org/docs/2.0/mod/mod_auth_digest.html">http://httpd.apache.org/docs/2.0/mod/mod_auth_digest.html</A>

Given that Apache will handle all aspects of authorisation, all that needs
to be done now is to work around the problem in mod_python.publisher
that prevents it being used in a directory authenticated using digest
authentication.

I was putting that workaround in authenhandler(), but probably shouldn't
have suggested it as it has probably confused the issue. What has to be
done though is to hook in a bit of code somehow before the handler
for mod_python.publisher. This could be done in an earlier processing
phase or as a content handler just prior to mod_python.publisher is
triggered. I would suggest the latter.

To do that, where you currently have:

  PythonHandler mod_python.publisher

change it to:

  PythonHandler my_digest_workaround::_delete_authorization_header
  PythonHandler mod_python.publisher

When you specify two handlers like this, mod_python will execute each in
turn. Thus, by adding a _delete_authorization_header() method to a module
my_digest_workaround we can hook in some code to run before
mod_python.publisher. The content of my_digest_workaround would thus be:

   from mod_python import apache
   def _delete_authorization_header(req):
     if req.headers_in.has_key(&quot;Authorization&quot;):
        del req.headers_in[&quot;Authorization&quot;]
     return apache.OK

The my_digest_workaround module could be put in the same directory as
.htaccess file, or if using global Apache configuration in root directory of
where your published files are kept. I explicitly called the handler
_delete_authorization_header(), with a leading underscore so that it
will not be found if some addressed a URL for publisher at it directly.

End result is that the workaround gets called first and it removes the
problem header and then publisher gets executed and your function
called.

Graham

&gt;<i> Bj&#246;rn S
</I>&gt;<i> 
</I>&gt;<i> On 11/23/05, Graham Dumpleton &lt;<A HREF="http://mailman.modpython.org/mailman/listinfo/mod_python">grahamd at dscpl.com.au</A>&gt; wrote:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Graham Dumpleton wrote ..
</I>&gt;<i> &gt; &gt; Bjorn Sundberg wrote ..
</I>&gt;<i> &gt; &gt; &gt; Is there a way do use http digest authentication?
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; No. HTTP digest authentication and mod_python.publisher are currently
</I>&gt;<i> &gt; &gt; incompatible. See:
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt;   <A HREF="http://issues.apache.org/jira/browse/MODPYTHON-47">http://issues.apache.org/jira/browse/MODPYTHON-47</A>
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; It is actually a simple fix, but wasn't done for mod_python 3.2.
</I>&gt;<i> &gt; &gt;
</I>&gt;<i> &gt; &gt; Even if fixed, the HTTP digest authentication has to be done by Apache,
</I>&gt;<i> &gt; &gt; it cannot be done by mod_python.publisher when using __auth__ etc.
</I>&gt;<i> &gt; &gt; The fix is merely to stop mod_python.publisher barfing when it is being
</I>&gt;<i> &gt; &gt; done by Apache.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Actually, as usual there is nearly always a way to fudge things. You
</I>&gt;<i> could
</I>&gt;<i> &gt; still use Apache HTTP digest authentication (managed by Apache) and
</I>&gt;<i> &gt; still use mod_python.publisher by having an authenhandler() which
</I>&gt;<i> &gt; deleted the &quot;Authorization&quot; header so that mod_python.publisher didn't
</I>&gt;<i> &gt; find it and therefore didn't barf.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;   def authenhandler(req):
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;     if req.headers_in.has_key(&quot;Authorization&quot;):
</I>&gt;<i> &gt;        del req.headers_in[&quot;Authorization&quot;]
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;     ... etc.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; I haven't tried this, but it should work.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Graham
</I>&gt;<i> &gt;
</I></PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="019582.html">[SPAM] [mod_python] [SPAM] apache + python
</A></li>
	<LI>Next message: <A HREF="019584.html">[mod_python] apache aborted when SOAPpy function called
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19583">[ date ]</a>
              <a href="thread.html#19583">[ thread ]</a>
              <a href="subject.html#19583">[ subject ]</a>
              <a href="author.html#19583">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-42971867-2', 'modpython.org');
  ga('send', 'pageview');
</script>

</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
