<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [mod_python] [Vampire] &quot;.vampire&quot; not loaded but I do not see why
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20%5BVampire%5D%20%22.vampire%22%20not%20loaded%20but%20I%20do%20not%20see%20why&In-Reply-To=20051107134908.GA22662%40nic.fr">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="019472.html">
   <LINK REL="Next"  HREF="019477.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[mod_python] [Vampire] &quot;.vampire&quot; not loaded but I do not see why</H1>
<table border=0 width="100%"><tr><td valign="top">
    <B>Graham Dumpleton</B> 
    <A HREF="mailto:mod_python%40modpython.org?Subject=%5Bmod_python%5D%20%5BVampire%5D%20%22.vampire%22%20not%20loaded%20but%20I%20do%20not%20see%20why&In-Reply-To=20051107134908.GA22662%40nic.fr"
       TITLE="[mod_python] [Vampire] &quot;.vampire&quot; not loaded but I do not see why">grahamd at dscpl.com.au
       </A><BR>
    <I>Tue Nov  8 04:04:35 EST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="019472.html">[mod_python] [Vampire] &quot;.vampire&quot; not loaded but I do not see why
</A></li>
        <LI>Next message: <A HREF="019477.html">[mod_python] Re: [Vampire] &quot;.vampire&quot; not loaded but I do not see
	why
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19476">[ date ]</a>
              <a href="thread.html#19476">[ thread ]</a>
              <a href="subject.html#19476">[ subject ]</a>
              <a href="author.html#19476">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On 08/11/2005, at 12:49 AM, Stephane Bortzmeyer wrote:

&gt;<i> I have a Vampire 1.7 + mod_python 3.1.3 installation where the
</I>&gt;<i> &quot;.vampire&quot; file is apparently not loaded (for instance, the &quot;handler
</I>&gt;<i> =&quot; option seems ignored). The problem is that I do not find why!
</I>&gt;<i>
</I>&gt;<i> * The Apache Virtual Host has a &quot;PythonOption VampireDefaultHandlers
</I>&gt;<i> On&quot;
</I>&gt;<i>
</I>&gt;<i> * .vampire exists and is world-readable
</I>&gt;<i>
</I>&gt;<i> On another machine, with the same OS (Debian &quot;sarge&quot;), everything is
</I>&gt;<i> fine.
</I>&gt;<i>
</I>&gt;<i> So, what could I do to investigate? Is there a way to be absolutely
</I>&gt;<i> certain that &quot;.vampire&quot; is found and loaded?
</I>
To confirm that the config file is being loaded at any point, introduce
a syntax error into it. For example, add a first line to the  
configuration
file of the form:

   [XXX

If the config file is loaded at any point, you should get an error such  
as
that include below.

Mod_python error: &quot;PythonHandler vampire&quot;

Traceback (most recent call last):

   File  
&quot;/System/Library/Frameworks/Python.framework/Versions/2.3/lib/ 
python2.3/site-packages/mod_python/apache.py&quot;, line 299, in  
HandlerDispatch
     result = object(req)

   File  
&quot;/System/Library/Frameworks/Python.framework/Versions/2.3/lib/ 
python2.3/site-packages/vampire/lookup.py&quot;, line 735, in _handler
     config = _configCache.loadConfig(req,file)

   File  
&quot;/System/Library/Frameworks/Python.framework/Versions/2.3/lib/ 
python2.3/site-packages/vampire/config.py&quot;, line 246, in loadConfig
     config.read(file)

   File  
&quot;/System/Library/Frameworks/Python.framework/Versions/2.3/lib/ 
python2.3/ConfigParser.py&quot;, line 263, in read
     self._read(fp, filename)

   File  
&quot;/System/Library/Frameworks/Python.framework/Versions/2.3/lib/ 
python2.3/ConfigParser.py&quot;, line 456, in _read
     raise MissingSectionHeaderError(fpname, lineno, `line`)

MissingSectionHeaderError: File contains no section headers.
file: /Users/grahamd/Sites/vampire/.vampire, line: 1
'[XXX\n'

If the file isn't even loaded, then could possibly be a file permission
or ownership issue. Ie., the user that Apache runs as can't read the
file. It is probably unlikely that Apache can't read the directory
itself as would imagine that would cause other more obvious problems as
Apache wouldn't be able to derive what the target of the URL should be
matched to and would return 404.

Next thing to realise is that if &quot;handler&quot; is what you intend to be
used, then there is an expectation that there is no extension on the URL
being used. You have been using Vampire long enough probably to know
that though.

Next thing is to delve into what is in the config which is being found.
To do that, stick the following .py file in directory where .vampire
file is located, or some subdirectory which you expect to inherit the
.vampire file from the parent directory.

from mod_python import apache
import vampire

def handler(req,raw=None):
   req.content_type = 'text/plain'
   for option in req.get_options().keys():
     req.write('%s = %s\n'%(option,req.get_options().get(option)))
   req.write('\n')
   config = vampire.loadConfig(req,'.vampire')
   for option in config.defaults():
     req.write('%s = %s\n'%(option,config.defaults().get(option)))
   req.write('\n')
   for section in config.sections():
     req.write('[%s]\n'%section)
     for option in config.options(section):
       req.write('  %s =  
%s\n'%(option,config.get(section,option,raw=raw)))
     req.write('\n')
   return apache.OK

If this is called &quot;config.py&quot; accessing as URL &quot;.../config&quot; using the
.vampire file with Vampire itself as an example, expect to see:

VampireDefaultHandlers = On
VampireDirectoryIndex = index.html

__config_root__ = /Users/grahamd/Sites/vampire
__handler_root__ = /Users/grahamd/Sites/vampire
__baseurl_abs__ = /~grahamd/vampire
__config_file__ = /Users/grahamd/Sites/vampire/.vampire
__config_mtime__ = 1131438786
__baseurl_rel__ = .

[Handlers]
   handler_html = /Users/grahamd/Sites/vampire/layouts/skidoo.py
   layouts_root = /Users/grahamd/Sites/vampire/layouts

[Settings]
   website_home = ./../..
   document_root = /Users/grahamd/Sites/vampire
   vampire_home = .
   styles_home = ./styles

Using instead the URL &quot;.../config?raw=1&quot;, expect to see:

VampireDefaultHandlers = On
VampireDirectoryIndex = index.html

__config_root__ = /Users/grahamd/Sites/vampire
__handler_root__ = /Users/grahamd/Sites/vampire
__baseurl_abs__ = /~grahamd/vampire
__config_file__ = /Users/grahamd/Sites/vampire/.vampire
__config_mtime__ = 1131438786
__baseurl_rel__ = .

[Handlers]
   handler_html = %(layouts_root)s/skidoo.py
   layouts_root = %(__config_root__)s/layouts

[Settings]
   website_home = %(__baseurl_rel__)s/../..
   document_root = %(__config_root__)s
   vampire_home = %(__baseurl_rel__)s
   styles_home = %(__baseurl_rel__)s/styles

If you don't see the config file you expect then only next step I can
think of would be to modify vampire/config.py source code in Vampire
package itself to log messages about what file it is looking for and in
what locations.

See what you come up with with that first. If all that looks okay and
URL being used is correct, ie., no extension and &quot;handler&quot; in &quot;Handlers&quot;
section isn't being used let me know and I will see what else I can
suggest. Will probably need to see what configuration you are using at
that point and how directories are structured and what URL is targeting.

Graham

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="019472.html">[mod_python] [Vampire] &quot;.vampire&quot; not loaded but I do not see why
</A></li>
	<LI>Next message: <A HREF="019477.html">[mod_python] Re: [Vampire] &quot;.vampire&quot; not loaded but I do not see
	why
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#19476">[ date ]</a>
              <a href="thread.html#19476">[ thread ]</a>
              <a href="subject.html#19476">[ subject ]</a>
              <a href="author.html#19476">[ author ]</a>
         </LI>
       </UL>

</td>
<td align="right" valign="top">
<script type="text/javascript"><!--
google_ad_client = "pub-9718360309690383";
google_ad_width = 120;
google_ad_height = 600;
google_ad_format = "120x600_as";
google_color_border = "CCCCCC";
google_color_bg = "FFFFFF";
google_color_link = "000000";
google_color_url = "666666";
google_color_text = "333333";
//--></script>
<script type="text/javascript"
  src="DISABLEhttp://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</td>
</table>

<hr>
<a href="http://mailman.modpython.org/mailman/listinfo/mod_python">More information about the Mod_python
mailing list</a><br>
</body></html>
